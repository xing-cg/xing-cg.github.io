[{"title":"Cpp_å¥‡å¼‚é€’å½’æ¨¡æ¿æ¨¡å¼ï¼ˆCRTPï¼‰","url":"/Cpp/Cpp_å¥‡å¼‚é€’å½’æ¨¡æ¿æ¨¡å¼ï¼ˆCRTPï¼‰/","content":"# 1\n```cpp\ntemplate <typename Derived>\nclass Base\n{\npublic:\n    void show(void)\n    {\n        static_cast<Derived*>(this)->show();\n    }\nprotected:\n    void show(void)\n    {\n        std::wcout << L\"Base::show()\" << std::endl;\n    }\n};\n\nclass Client : public Base<Client>\n{\npublic:\n\n};\nint main()\n{\n    Client client;\n    client.show();\n    return 0;\n}\n```\n\nè¾“å‡ºï¼š\n```\nBase::show()\n```\n# 2\n```cpp\ntemplate <typename Derived>\nclass Base\n{\npublic:\n    void show(void)\n    {\n        static_cast<Derived*>(this)->show();\n    }\nprotected:\n    void show(void)\n    {\n        std::wcout << L\"Base::show()\" << std::endl;\n    }\n};\n\nclass Client : public Base<Client>\n{\npublic:\n    void show(void) // hidden\n    {\n        std::wcout << L\"Client::show()\" << std::endl;\n    }\n};\nint main()\n{\n    Client client;\n    client.show();\n    return 0;\n}\n```\n\nè¾“å‡ºï¼š\n```\nClient::show()\n```\n# é™æ€å¤šæ€\n```cpp\n#include <iostream>\n\n// åŸºç±»æ¨¡æ¿ï¼Œä¾èµ–æ´¾ç”Ÿç±»æä¾› impl()\ntemplate<class Derived>\nstruct Algo {\n    void run() {\n        // å…±äº«çš„æµç¨‹éª¨æ¶\n        pre();\n        static_cast<Derived*>(this)->impl(); // æ´¾ç”Ÿç±»å®šåˆ¶ç‚¹\n        post();\n    }\n    void pre()  { /* å…¬å…±å‡†å¤‡é€»è¾‘ */ }\n    void post() { /* å…¬å…±æ”¶å°¾é€»è¾‘ */ }\n};\n\n// æ´¾ç”Ÿç±» Aï¼šæä¾›è‡ªå·±çš„å®ç°\nstruct AlgoA : Algo<AlgoA> {\n    void impl() { std::cout << \"AlgoA fast path\\n\"; }\n};\n\n// æ´¾ç”Ÿç±» Bï¼šå¦ä¸€ç§å®ç°\nstruct AlgoB : Algo<AlgoB> {\n    void impl() { std::cout << \"AlgoB precise path\\n\"; }\n};\n\nint main() {\n    AlgoA a; a.run();   // æ— è™šè¡¨ï¼Œç¼–è¯‘æœŸé™æ€è§£æï¼Œæ˜“äºå†…è”\n    AlgoB b; b.run();\n}\n\n```\n# å®é™…åœºæ™¯\nWTLã€ATLï¼ˆæ´»åŠ¨æ¨¡æ¿åº“ï¼Œ90å¹´ä»£çš„ï¼Œç”¨äºCOMï¼‰","categories":["Cpp","Modern","æ¨¡æ¿"]},{"title":"åç¨‹_Agaveè®¾è®¡åŸç†","url":"/å¤šçº¿ç¨‹/åç¨‹_Agaveè®¾è®¡åŸç†/","content":"# é¡¹ç›®ä»‹ç»\nAgave(TM) `C++20`æ ‡å‡†åç¨‹åº“æ¡†æ¶\n1. ä¸¥æ ¼éµå¾ªC++20æ ‡å‡†ï¼Œå¹¶å¯¹å…¶è¿›è¡Œäº†æ·±åº¦è®¾è®¡ã€å°è£…ï¼Œæ€§èƒ½ä¼˜è‰¯ï¼Œæ˜“ç”¨ï¼Œé€‚ç”¨äºåç¨‹åº“å¼€å‘å‚å•†å’Œç»ˆç«¯ç”¨æˆ·ä½¿ç”¨\n2. è®¾è®¡äº†é€šç”¨åç¨‹ç±»å‹è¿”å›å¯¹è±¡ï¼š`AsyncAction`ã€`AsyncActionWithProgress`ã€`AsyncOperation`ã€`AsyncOperationWithProgress`ï¼Œå¼€å‘æ–¹å¼åˆäºŒä¸ºä¸€ï¼Œæ— è®ºåº“å‚å•†è¿˜æ˜¯æœ€ç»ˆç”¨æˆ·ï¼Œä½¿ç”¨æ–¹å¼å®Œå…¨ç›¸åŒï¼Œå¹¶å¯å†æ¬¡`co_await`ç­‰å¾…ï¼Œè½»æ¾æ„æˆåç¨‹ä»»åŠ¡é“¾\n3. åªä½¿ç”¨co_awaitæ ‡å‡†å…³é”®å­—å‡ ä¹å¯ä»¥å®Œæˆæ‰€æœ‰æ“ä½œï¼Œå¦‚ï¼šè¿›è¡Œç¯å¢ƒåˆ‡æ¢ã€åŠŸèƒ½è®¾ç½®ç­‰ç­‰ã€‚\n    1. `co_await agave::resume_background();`è¿›å…¥åå°çº¿ç¨‹ç¯å¢ƒ\n    2. `co_await agave::resume_foreground();`è¿›å…¥å‰å°çº¿ç¨‹ç¯å¢ƒ\n    3. `co_await agave::get_cancellation_token();`è·å–åœæ­¢tokenã€‚\n4. æ·±åº¦æ•´åˆäº†`chrono`åº“ï¼Œå¹¶è®¾è®¡äº†`BJobScheduler`å¹¶è¡Œåç¨‹è°ƒåº¦å™¨ï¼Œæ”¯æŒä¾¿æ·è¯­æ³•ï¼š`co_await 30ms;`æš‚åœå½“å‰åç¨‹ï¼Œå¹¶é€å…¥è°ƒåº¦å™¨å¾…åç»­å”¤é†’æ‰§è¡Œã€‚\n5. é«˜åº¦å¯æ‰©å±•è®¾è®¡ï¼Œæ‰€æœ‰æ‰§è¡Œç¯å¢ƒå‡å¯é…ç½®ï¼Œå¦‚å‰å°ã€åå°ã€æ—¶é—´è°ƒåº¦ç­‰ï¼Œå‡å¯ä»¥é…ç½®è¿æ¥è‡ªå®šä¹‰çš„é«˜æ•ˆçº¿ç¨‹æ± \n6. åç¨‹è¿”å›å¯¹è±¡ä¸­å‡é…ç½®äº†`condition variable`å¯¹è±¡ï¼ŒåŒ…å«äº`get`æ–¹æ³•ä¸­ï¼Œæ—¢å¯ä»¥ä½¿ç”¨å¼‚æ­¥åŠŸèƒ½åˆå¯å…¼å®¹ç»å…¸åŒæ­¥æ¨¡å‹ä½¿ç”¨æ–¹æ³•ã€‚\n7. æ”¯æŒ`progress`è‡ªå®šä¹‰è¿›åº¦ç±»å‹ï¼Œå¹¶é€šè¿‡`co_await`å³å¯è·å¾—ï¼ˆå†…éƒ¨ä½¿ç”¨`co_yield`å®ç°ï¼Œå¯å¤šæ¬¡`co_await`ï¼‰\n8. ç°æœ‰å¤šä¸ªåŸºäºæ­¤æ¡†æ¶çš„å•†ä¸šé¡¹ç›®å·²è¿è¡Œè‡³å°‘ 2 å¹´ï¼š`DevilStation`ã€`TeXsh`ç­‰ï¼Œæ€§èƒ½ç¨³å®š\n# C++åç¨‹çš„æ ·å­\n```cpp\nRTN_OBJ MyCoroutine()\n{\n    co_await / co_yield / co_return;\n}\n```\n# å®˜æ–¹ç¤ºä¾‹\n![](../../images/åç¨‹_Agaveè®¾è®¡åŸç†/image-20250827191845939.png)\n\n# RTN_OBJä¸­æœ‰ä¸ªpromise_type\n```cpp\nclass RTN_OBJ\n{\npublic:\n    class promise_type\n    {\n    public:\n        RTN_OBJ get_return_object(){ return {}; }\n        std::suspend_never initial_suspend() noexcept { return {}; }\n        std::suspend_never final_suspend() noexcept { return {}; }\n        void return_void() {}\n        //int return_value(int v) { return v; }\n        void unhandled_exception() {}\n    };\n};\nRTN_OBJ MyCoroutine()\n{\n    co_return;\n}\nint main()\n{\n    auto promise = new RTN_OBJ::promise_type;\n    RTN_OBJ rtn_obj = promise->get_return_object();\n    return 0;\n}\n```\nç»è¿‡promise_typeåˆ›å»ºã€‚RTN_OBJçš„å†…å®¹ä¸promiseç»‘å®šã€‚promiseçš„æ¥å£å‡½æ•°å¯ä»¥ç›´æ¥æ“ä½œRTN_OBJã€‚\n\nRTN_OBJæ˜¯å®ä¾‹ã€‚\npromise_typeæ˜¯åœ¨RTN_OBJä¸­çš„ä¸€ä¸ªæŒ‡é’ˆã€‚\n\npromise_typeæ˜¯ç³»ç»Ÿæ§åˆ¶å’Œåç¨‹å†…éƒ¨äº¤äº’çš„ã€‚å°±åƒæ˜¯åç¨‹çš„æ€»ç»ç†çš„åœ°ä½ï¼Œå¯ä»¥åœ¨`initial_suspend`ã€`final_suspend`å‡½æ•°ä½“å†…å†™æ˜è¦åšçš„äº‹åŠ¡ã€‚\né™¤äº†è¿™ä¸¤ä¸ªæ¥å£ï¼Œè¿˜è¦å®ç°`return_void`æˆ–`return_value`ï¼Œå’Œ`unhandled_exception`ã€‚\nè¿™æ ·ï¼ŒC++æ‰è®¤ä¸ºä½ æ˜¯ä¸€ä¸ªåˆæ ¼çš„ç»ç†ã€‚\n\næ€»çš„æ¥è¯´ï¼Œè®°ä½ï¼Œpromise_typeç”¨äºæ§åˆ¶åç¨‹å†…éƒ¨è¡Œä¸ºã€‚\n```cpp\nclass promise_type\n{\npublic:\n    RTN_OBJ get_return_object()\n    {\n        auto h = std::coroutine_handle<promise_type>::from_promise(*this);\n    }\n};\n```\næ¯”å¦‚ï¼Œå¯ä»¥åœ¨promise_typeæˆå‘˜å‡½æ•°ä½“ä¸­ï¼šé€šè¿‡`promise_type`ä½œä¸ºæ¨¡æ¿å‚æ•°ï¼Œè°ƒç”¨`from_promise(*this)`ï¼Œè·å¾—æ­¤åç¨‹çš„å†…éƒ¨å¥æŸ„ã€‚\nå¯ä»¥é€šè¿‡è¿™ä¸ªå¥æŸ„ï¼Œè°ƒç”¨destroyç­‰ç­‰ï¼Œæ¯”å¦‚ç”¨æ¥æ§åˆ¶åç¨‹å¸§ã€‚[std::coroutine_handle, std::noop_coroutine_handle - cppreference.com](https://en.cppreference.com/w/cpp/coroutine/coroutine_handle.html)\n# Awaiter\nå¯ä»¥`co_await`çš„å¯¹è±¡ã€‚\né‡Œé¢å¿…é¡»æœ‰æ¥å£ï¼š`bool await_ready`ã€`void await_suspend(coroutine_handle<>)`ã€`void await_resume()`ï¼ˆæœ€åä¸€ä¸ªï¼Œè¿”å›å€¼ä¸ä¸€å®šæ˜¯voidï¼Œå¯ä»¥æ˜¯å…¶ä»–ï¼‰ã€‚\n\n`await_suspend(std::coroutine_handle<> h)`ä¸­çš„hæ˜¯å¤–éƒ¨ä¼ å…¥çš„ã€‚ç”¨äºå’Œå¤–ç•Œå‘é€ä¿¡å·ã€‚\nå½“å¤–ç•Œ`co_await`æ­¤`Awaiter`æ—¶ï¼Œå¤–éƒ¨hä¼ å…¥ï¼Œåˆ™`await_suspend`å‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ˆæ¯”å¦‚è¯»å–æ–‡ä»¶å®Œæˆï¼‰å¯ä»¥è°ƒç”¨`h.resume`ï¼Œå”¤é†’å¤–éƒ¨ã€‚\nå¦‚æœ`await_suspend`å‡½æ•°ä¸­èµ·äº†ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å¯ä»¥å¼‚æ­¥IOï¼ˆdetachï¼‰ã€‚`await_suspend`å¯ä»¥è¿”å›äº†ã€‚\nå¼‚æ­¥çº¿ç¨‹å‡½æ•°å¯ä»¥æ‹©æœºè°ƒç”¨`h.resume`ã€‚åˆ™è¯¥Awaiteræ­¤æ—¶å°±è¦è½¬å‘æ‰§è¡Œ`await_resume()`ï¼Œæ‰§è¡Œå®Œåï¼Œå¤–éƒ¨çš„`co_await`å°±å®Œæ¯•ï¼Œæ¢å¤æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚\n```cpp\nstruct Awaiter\n{\n    constexpr bool await_ready() const noexcept\n    {\n        return false;\n    }\n    /* constexpr */ void await_suspend(std::coroutine_handle<> h) const noexcept\n    {\n        // create a new thread for IO operation...\n        std::thread t([h]() -> void)\n        {\n            // IO operation...\n            // h.resume\n        });\n        t.detach();\n        return;\n    }\n    constexpr int await_resume() const noexcept\n    {\n        return 100;\n    }\n};\nRTN_OBJ MyCoroutine(void)\n{\n    std::println(\"running MyCoroutine...\");\n    int res = co_await Awaiter{}; // å¯ä»¥æ¥æ”¶await_resume()çš„è¿”å›å€¼ã€‚\n    co_return;\n}\n```\nå®é™…ä¸Šï¼ŒAwaiterï¼Œæ˜¯`ReadFileAsync`è¿™æ ·çš„å¼‚æ­¥æ“ä½œå¯¹è±¡çš„æœ¬è´¨ã€‚\n\næˆ‘ä»¬è¦åšçš„æ˜¯ï¼Œæ€ä¹ˆåŒ…è£…è¿™æ ·çš„Awaiterï¼Œè®©ç”¨æˆ·ç”¨èµ·æ¥ç®€å•ï¼Ÿ\n## suspend_always / suspend_never\n```cpp\n_EXPORT_STD struct suspend_never\n{\n    _NODISCARD constexpr bool await_ready() const noexcept\n    {\n        return true;\n    }\n    constexpr void await_suspend(coroutine_handle<>) const noexcept\n    {\n    }\n    constexpr void await_resume() const noexcept\n    {\n    }\n}\n```\n# æµ‹è¯•\n```cpp\n#include <iostream>\n#include <coroutine>\n#include <thread>\n#include <chrono>\n#include <print>\nusing namespace std::chrono_literals;\nclass RTN_OBJ\n{\npublic:\n    class promise_type\n    {\n    public:\n        RTN_OBJ get_return_object()\n        {\n            std::println(\"get_return_object()...\");\n            return {};\n        }\n        std::suspend_never initial_suspend() noexcept\n        {\n            std::println(\"initial_suspend()...\");\n            return {};\n        }\n        std::suspend_never final_suspend() noexcept\n        {\n            std::println(\"final_suspend()...\");\n            return {};\n        }\n        void return_void()\n        {\n            std::println(\"return_void()...\");\n        }\n        void unhandled_exception()\n        {\n            std::println(\"unhandled_exception()...\");\n        }\n    };\n};\nstruct Awaiter\n{\n    /*constexpr*/ bool await_ready() const noexcept\n    {\n        std::println(\"{} {}\", std::this_thread::get_id(), \"await_ready()...\");\n        return false;\n    }\n    // å¾€å¾€å¼€è¾Ÿä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œå¼‚æ­¥è¿›è¡Œè€—æ—¶çš„IOæ“ä½œ\n    // æ“ä½œå®Œæ¯•åï¼Œè°ƒç”¨hçš„resume\n    /*constexpr*/ void await_suspend(std::coroutine_handle<> h) noexcept\n    {\n        std::println(\"{} {}\", std::this_thread::get_id(), \"await_suspend()...\");\n\n        std::thread t([h](int &m_res) -> void \n        {\n            // IO operation...\n            std::println(\"{} {}\", std::this_thread::get_id(), \"sleep 5s...\");\n            std::this_thread::sleep_for(5s);\n            m_res = 100;\n            std::println(\"{} {} {}{}\", std::this_thread::get_id(), \"write m_res\", m_res, \"...\");\n        }, std::ref(m_res));\n        t.join();\n        h.resume();\n        return;\n    }\n    /*constexpr*/ int await_resume() const noexcept\n    {\n        std::println(\"{} {}\", std::this_thread::get_id(), \"await_resume()...\");\n        return m_res;\n    }\n    int m_res;\n};\nRTN_OBJ MyCoroutine()\n{\n    std::println(\"{} {}\", std::this_thread::get_id(), \"Running MyCoroutine...\");\n    // è¿›å»å…ˆçœ‹await_ready()æ˜¯å¦ä¸ºtrueï¼Œæ˜¯trueåˆ™ä¸ä¼šç­‰å¾…ã€‚\n    // æ˜¯falseåˆ™æ‰§è¡Œawait_suspend()ï¼Œ\n    // æ‰§è¡Œå®Œawait_suspend()åï¼Œæ”¾å¼ƒè¿è¡Œæƒã€‚äº¤ç»™caller\n    // ç›´åˆ°h.resume()ã€‚è·å¾—æ‰§è¡Œæƒåï¼Œco_awaitç»“æŸï¼Œæ¥ç€å»æ‰§è¡Œawait_resume()\n    // å¯ä»¥æ¥æ”¶åˆ°await_resume()çš„è¿”å›å€¼ã€‚\n    auto res = co_await Awaiter{};\n    std::println(\"{} {} {}\", std::this_thread::get_id(), \"After Awaiter get res:\", res);\n    co_return;\n}\n\nint main()\n{\n    std::println(\"{} {}\", std::this_thread::get_id(), \"Create MyCoroutine\");\n    // è¿”å›ä¸€ä¸ªRTN_OBJå¯¹è±¡\n    auto rtn = MyCoroutine();\n    std::println(\"{} {}\", std::this_thread::get_id(), \"Finish MyCoroutine\");\n    return 0;\n}\n```\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸»çº¿ç¨‹çš„æ“ä½œï¼š\n1. è°ƒç”¨åç¨‹å‡½æ•°ï¼Œä¸€æ—¦è°ƒç”¨äº†åç¨‹å‡½æ•°ï¼Œå°±ä¼šè§¦å‘`promise_type`çš„æˆå‘˜å‡½æ•°ï¼Œç±»ä¼¼äºæ„é€ çš„`await_ready()`ã€‚ç„¶åä¸»çº¿ç¨‹ç»§ç»­è°ƒç”¨åç¨‹å‡½æ•°çš„æ¯ä¸€å¥ã€‚\n2. ç›´åˆ°é‡åˆ°äº†`co_await`ï¼Œåˆ™å°±æ‰åˆ°äº†Awaiterå¯¹è±¡å†…éƒ¨çš„æ“ä½œï¼Œå¦‚`await_ready()`ã€`await_suspend()`ã€‚\n3. æ–°åç¨‹ï¼ˆAwaiterï¼‰å†…éƒ¨ï¼Œèµ·çº¿ç¨‹ã€‚è¿›è¡Œ`await_suspend()`çš„å†…éƒ¨æ“ä½œã€‚\n4. æ“ä½œå®Œåï¼Œä¸»åŠ¨`h.resume`ï¼Œå›åˆ°äº†ä¸»çº¿ç¨‹ã€‚æ‰§è¡Œ`await_resume()`ã€‚\n5. ä¹‹åï¼Œå›åˆ°ä¸€å¼€å§‹çš„åç¨‹å‡½æ•°ã€‚`co_await`è¿™ä¸€è¡Œç»“æŸã€‚ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œ`co_await`çš„ä¸‹é¢çš„å†…å®¹ã€‚\n6. ä¸»çº¿ç¨‹æ‰§è¡Œåç¨‹å‡½æ•°ä¸­çš„`co_return`ã€‚ä¼šè§¦å‘åç¨‹å†…éƒ¨`promise_type`çš„æˆå‘˜å‡½æ•°ï¼Œ`return_void()`ï¼Œå’Œç±»ä¼¼äºææ„çš„`final_suspend()`ã€‚\n\n```\n100592 Create MyCoroutine\nget_return_object()...\ninitial_suspend()...\n100592 Running MyCoroutine...\n100592 await_ready()...\n100592 await_suspend()...\n101320 sleep 5s...\n101320 write m_res 100...\n100592 await_resume()...\n100592 After Awaiter get res: 100\nreturn_void()...\nfinal_suspend()...\n100592 Finish MyCoroutine\n\n```\n# å¦‚ä½•åŒ…è£…ç®€å•æ˜“ç”¨çš„`Awaiter`\nå¥‡æŠ€æ·«å·§ï¼šé‡è½½`operator co_await`ã€‚\n\n```cpp\n//--------------------------------------------------------------------\n//  overload co_await for async action.\n//--------------------------------------------------------------------\ntemplate <typename P>\ninline\nagave::details::async_action_t<P>\noperator co_await(agave::details::async_action_base_t<P> const& async)\n{\n    return agave::details::async_action_t<P>{ async };\n}\n\n\n//--------------------------------------------------------------------\n//  overload co_await for async operation.\n//--------------------------------------------------------------------\ntemplate <typename T, typename P>\ninline\nagave::details::async_operation_t<T, P>\noperator co_await(agave::details::async_operation_base_t<T, P> const& async)\n{\n    return agave::details::async_operation_t<T, P>{ async };\n}\n```\n## AsyncAction / AsyncOperation\n\n```cpp\n    //--------------------------------------------------------------------\n    //\t*** for asynchronous function with no returned value ***\n    //--------------------------------------------------------------------\n    template <typename Progress = void, typename Action = async_action_t<Progress>>\n    class async_action_base_t : public async_progress_base_t<Progress>\n\n    //--------------------------------------------------------------------\n    //\timplementations for async_action_base_t.\n    //--------------------------------------------------------------------\n    template <typename Progress = void>\n    class async_action_t : public async_action_base_t<Progress, async_action_t<Progress>>\n```\n\n```cpp\n    //--------------------------------------------------------------------\n    //  *** for asynchronous function with returned value of T ***\n    //--------------------------------------------------------------------\n    template <typename T, typename Progress = void, typename Operation = async_operation_t<T, Progress>>\n        requires(!std::is_void_v<T>)\n    class async_operation_base_t : public async_progress_base_t<Progress>\n\n    //--------------------------------------------------------------------\n    //\timplementations for async_operation_base_t.\n    //--------------------------------------------------------------------\n    template <typename T, typename Progress = void>\n    class async_operation_t : \n        public async_operation_base_t<T, Progress, async_operation_t<T, Progress>>\n```\n\n```cpp\n    //--------------------------------------------------------------------\n    //  specializations for async_progress_base_t class.\n    //--------------------------------------------------------------------\n    template <>\n    class async_progress_base_t<void>\n    {\n    public:\n        //\n\n    };\n```\n\nç±»`async_action_t`ä¸`async_operation_t`ã€‚å†…éƒ¨éƒ½å®šä¹‰äº†`await_ready()`ã€`await_suspend()`ã€`await_resume()`ã€‚æ˜¯ä¸ªAwaiterå¯¹è±¡ã€‚\n## ç”¨æˆ·æ¥å£\n```cpp\n    //--------------------------------------------------------------------\n    //\t*** returned objects for asynchronous functions ***\n\t//--------------------------------------------------------------------\n\tusing AsyncAction = details::async_action_base_t<>;\n\n    //--------------------------------------------------------------------\n    template <typename P>\n    using AsyncActionWithProgress = details::async_action_base_t<P>;\n\n    //--------------------------------------------------------------------\n    template <typename T>\n    using AsyncOperation = details::async_operation_base_t<T>;\n\n    //--------------------------------------------------------------------\n\ttemplate <typename T, typename P>\n\tusing AsyncOperationWithProgress = details::async_operation_base_t<T, P>;\n```\n\n","categories":["æ“ä½œç³»ç»Ÿ","å¤šçº¿ç¨‹","Cpp","Modern"]},{"title":"Linux_rgæ£€ç´¢","url":"/Linux/Linux_rgæ£€ç´¢/","content":"# ä»‹ç»\n\nrgï¼Œå…¨ç§°ripgrepï¼Œæ–‡æœ¬æœç´¢å·¥å…·ï¼Œæœ‰grepã€Ackã€Agã€‚rgå…¨ç§°RipGrepï¼Œæ˜¯ä¸€ä¸ªæŒ‰è¡Œæœç´¢å·¥å…·ï¼Œå®ƒæ ¹æ®æä¾›çš„patterné€’å½’åœ°åœ¨æŒ‡å®šçš„ç›®å½•é‡Œæœç´¢ã€‚ç”±Rustå†™æˆï¼Œç›¸è¾ƒäºåŒç±»å·¥å…·çš„ç‰¹ç‚¹æ˜¯å¿«ã€çœç”µã€‚\n\n1. è‡ªåŠ¨é€’å½’æœç´¢\n2. è‡ªåŠ¨å¿½ç•¥.gitignoreä¸­çš„æ–‡ä»¶ä»¥åŠäºŒè¿›åˆ¶æ–‡ä»¶\n3. å¯ä»¥é™åˆ¶æ–‡ä»¶ç±»å‹\n   4. `rg -t py foo`é™å®špythonæ–‡ä»¶\n   5. `rg -T js foo`æ’é™¤jsæ–‡ä»¶\n6. æ”¯æŒå„ç§æ–‡ä»¶ç¼–ç ï¼ˆUTF-8ã€UTF-16ã€GBKï¼‰\n7. æ”¯æŒæœç´¢å¸¸è§çš„å‹ç¼©æ–‡ä»¶ï¼ˆgzipã€xzã€bzip2ï¼‰\n8. è‡ªåŠ¨é«˜äº®åŒ¹é…çš„ç»“æœ\n\n>æ‰©å±•ï¼šå¼ºä¸­æ›´æœ‰å¼ºä¸­æ‰‹ï¼Œç°åœ¨æ›´æœ‰rgçš„åŠ å¼ºç‰ˆripgrep-allï¼Œèƒ½æœç´¢pdf, e-book, office documents, zip, tar.gzç­‰\n\n# å°è¯•ç‰›åˆ€\n\nä»¥ä¸‹é¢çš„æ–‡ä»¶ä¸ºæµ‹è¯•æ–‡ä»¶, å‘½åä¸ºa.txt\n\n```\ntest\na\nb\nc\nd\ne\nf\ng\ntest1\nTEST2\n```\n\n1. åŸºç¡€æœç´¢\n\n```bash\nrg 'test' a.txt\n1:test\n9:test1\n```\n\n```bash\ngrep 'test' a.txt\ntest\ntest1\n```\n\nå¯è§ï¼Œrgå’Œgrepçš„åŒºåˆ«æœ‰ä¸€ç‚¹åœ¨äºrgè¿˜é¢å¤–åŠ äº†è¡Œå·\n\n2. `-w`æœ‰wordä¹‹æ„ï¼Œè¡¨ç¤ºæœç´¢çš„å­—ç¬¦ä¸²ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„å•è¯æ—¶æ‰èƒ½è¢«åŒ¹é…åˆ°ã€‚\n\n```bash\nrg -w 'test' a.txt\n1:test\n```\n\n3. ä½¿ç”¨`-i`é€‰é¡¹ï¼Œä¸åŒºåˆ†å¤§å°å†™\n\n```bash\nrg -i 'test' a.txt\n1:test\n9:test1\n10:TEST2\n```\n\n4. `-l`åªæ‰“å°æœ‰åŒ¹é…ä¿¡æ¯çš„æ–‡ä»¶åå­—\n\n```bash\nrg -l 'test' a.txt\na.txt\n```\n\n5. `-C`è¾“å‡ºåŒ¹é…ä¸Šä¸‹å‡ è¡Œçš„å†…å®¹\n\n```bash\nrg -C 2 'c' a.txt#æ„æ€æ˜¯ï¼Œè¾“å‡º'c'æ‰€åœ¨è¿™ä¸€è¡Œçš„ä¸Šä¸‹ä¸¤è¡Œä¿¡æ¯\n2-a\n3-b\n4:c\n5-d\n6-e\n```\n\n# é«˜çº§æœç´¢\n\n1. ä½¿ç”¨`-e REGEX`æ¥æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼\n\n```bash\nrg -e \"*sql\" -C2\n```\n\n2. é»˜è®¤rgä¼šå¿½ç•¥`.gitignore`å’Œéšè—æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨`-uu`æ¥æŸ¥è¯¢æ‰€æœ‰å†…å®¹\n\n```bash\nrg -uu \"word\" .\n```\n\n3. å¯ä»¥ä½¿ç”¨`-t type`æ¥æŒ‡å®šæ–‡ä»¶ç±»å‹\n\n```bash\nrg -t markdown \"mysql\" . #åœ¨mdæ–‡ä»¶ä¸­æŸ¥æ‰¾\"mysql\"å…³é”®å­—\n```\n\n# æœç´¢æ–‡ä»¶\n\nåˆ—å‡ºå½“å‰æ–‡ä»¶å¤¹ä¼šè¿›è¡ŒæŸ¥è¯¢çš„æ‰€æœ‰æ–‡ä»¶ï¼Œè¯¥é€‰é¡¹å…¶å®å¯ä»¥ç›¸å½“äº`find . -type f`ï¼ŒæŸ¥æ‰¾å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ã€‚\n\n```bash\nrg --files .\n```","categories":["Linux"]},{"title":"20250815é¢è¯•å¿«é€Ÿå¤ç›˜","url":"/é¢è¯•ç»éªŒ/20250815é¢è¯•å¿«é€Ÿå¤ç›˜/","content":"# Modern Cpp\n1. auto\n2. èŒƒå›´forå¾ªç¯\n3. å‡½æ•°å¯¹è±¡ã€lambda\n4. æ™ºèƒ½æŒ‡é’ˆ\n5. å³å€¼å¼•ç”¨\n\n## lambda\næŒ‰å€¼æ•è·ï¼Œåœ¨å‡½æ•°ä½“å†…èƒ½å˜å—ï¼Ÿ\næŒ‰å¼•ç”¨æ•è·ï¼Œä¸ºä»€ä¹ˆèƒ½å˜ï¼Ÿ\n\n# OOPçš„æ€æƒ³\n1. å°è£…ï¼Œä¸»è¦ä»æ§åˆ¶è®¿é—®æƒé™åˆ‡å…¥\n2. ç»§æ‰¿\n    1. éšè—\n    2. å¤šé‡ç»§æ‰¿\n        1. è±å½¢ç»§æ‰¿\n            1. è™šç»§æ‰¿\n3. å¤šæ€\n    1. é‡è½½ï¼ˆé™å¤šæ€ï¼‰ï¼šåå­—ç›¸åŒï¼Œå‚æ•°åˆ—è¡¨ä¸åŒã€‚è¿”å›å€¼ä¸å‚ä¸ã€‚\n        1. ç¼–è¯‘æœŸå°±ç¡®å®šäº†ã€‚\n        2. ä¸»è¦é¢å‘æ³›å‹ç¼–ç¨‹ã€‚\n        3. å¯ä»¥é€šè¿‡é‡è½½ã€å‡½æ•°æ¨¡æ¿å®ç°ã€‚\n    2. é‡å†™ï¼ˆåŠ¨å¤šæ€ï¼‰\n        1. è™šå‡½æ•°ï¼ˆåŠ¨æ€è”ç¼–ï¼‰\n        2. åœ¨æ„é€ å‡½æ•°ä¸­å¯ä»¥è°ƒç”¨è™šå‡½æ•°ï¼Œä½†æ˜¯æ²¡æœ‰å¤šæ€æ€§ã€‚\n\n## å››ä¸ªç±»å‹è½¬æ¢\n\n# æ™ºèƒ½æŒ‡é’ˆ\n## uniqueå’Œè£¸æŒ‡é’ˆæ€§èƒ½æ¯”è¾ƒ\nå¦‚æœæœªå¼€å¯ä¼˜åŒ–ï¼Œuniqueæ€§èƒ½ç¡®å®æ¯”è£¸æŒ‡é’ˆå·®ã€‚\nä½†æ˜¯å¦‚æœå¼€å¯ä¼˜åŒ–ï¼Œæ¯”å¦‚releaseæ—¶ï¼Œuniqueçš„åæ±‡ç¼–ä»£ç ï¼Œå’Œè£¸æŒ‡é’ˆä¸€æ ·ï¼Œè€Œä¸”è¿˜æ˜¯å®‰å…¨çš„ã€‚\n\nunique_ptræ€§èƒ½ç¡®å®æ¯”è£¸æŒ‡é’ˆå·®ã€‚â€‹â€‹\nâ€‹â€‹åŸå› ï¼šâ€‹â€‹ ç¼–è¯‘å™¨ä¸ä¼šè¿›è¡Œå†…è”ä¼˜åŒ–ã€‚æ¯æ¬¡ unique_ptrçš„æ„é€ ã€ææ„ã€ç§»åŠ¨èµ‹å€¼ã€`reset()`ã€`release()`æ“ä½œï¼Œä»¥åŠé€šè¿‡ `operator->`æˆ– `operator*`è®¿é—®æˆå‘˜/è§£å¼•ç”¨ï¼Œéƒ½ä¼šç”Ÿæˆå¯¹ç›¸åº”æˆå‘˜å‡½æ•°çš„è°ƒç”¨æŒ‡ä»¤ã€‚\nâ€‹â€‹ä»£ä»·ï¼šâ€‹â€‹ è¿™äº›å‡½æ•°è°ƒç”¨ï¼ˆå³ä½¿æ˜¯ç®€å•çš„ï¼‰ä¼šå¼•å…¥é¢å¤–çš„æŒ‡ä»¤ï¼ˆå‹æ ˆã€è·³è½¬ã€å¼¹æ ˆç­‰ï¼‰ï¼Œå¢åŠ äº†ä»£ç å¤§å°å’Œæ‰§è¡Œæ—¶é—´ã€‚æ„é€ /ææ„å¯èƒ½æ¶‰åŠè®¾ç½®/æ¸…é™¤å†…éƒ¨æŒ‡é’ˆå’Œå¯èƒ½çš„è‡ªå®šä¹‰åˆ é™¤å™¨çŠ¶æ€ã€‚ç§»åŠ¨æ“ä½œè™½ç„¶ä¸æ‹·è´èµ„æºï¼Œä½†å‡½æ•°è°ƒç”¨å¼€é”€ä¾ç„¶å­˜åœ¨ã€‚\nè£¸æŒ‡é’ˆä¼˜åŠ¿ï¼šâ€‹â€‹ è£¸æŒ‡é’ˆçš„æ“ä½œï¼ˆèµ‹å€¼ã€è§£å¼•ç”¨ã€æ¯”è¾ƒï¼‰é€šå¸¸ç›´æ¥å¯¹åº”ä¸€æ¡æˆ–å‡ æ¡éå¸¸åº•å±‚çš„ CPU æŒ‡ä»¤ï¼ˆå¦‚ mov, lea, cmpï¼‰ï¼Œå‡ ä¹æ²¡æœ‰é¢å¤–å¼€é”€ã€‚\n\n## sharedçš„å®ç°åŸç†\n## sharedéœ€è¦é¿å…çš„é—®é¢˜\nå¾ªç¯å¼•ç”¨ã€‚å¯¼è‡´å¯¹è±¡ä¸€ç›´é©»å­˜åœ¨å†…å­˜ä¸­ï¼Œæ— æ³•é”€æ¯ï¼Œå†…å­˜æ³„æ¼ã€‚\n## weakå¯ä»¥å•ç‹¬ä½¿ç”¨å—\nä¸å¯ä»¥è‡ªå·±æ„é€ ï¼Œè€Œæ˜¯é€šè¿‡sharedèµ‹å€¼æˆ–æ„é€ ã€‚\nä¸»è¦åœºæ™¯æ˜¯é…åˆsharedä½¿ç”¨ã€‚\n## weakå¯ä»¥ç›´æ¥è§£å¼•ç”¨å—\néœ€è¦çœ‹å¼ºå¼•ç”¨è®¡æ•°æ˜¯å¦ä¸º0ã€‚\néœ€è¦è°ƒç”¨`lock()`ï¼Œè¿”å›ä¸€ä¸ªå¼ºsharedå¼•ç”¨ã€‚\nweakæ€ä¹ˆçŸ¥é“çš„ï¼Ÿç»“æ„ä¸­ï¼Œæœ‰ä¸€ä¸ªæ§åˆ¶å—ï¼Œå­˜æ”¾äº†å¼ºå¼•ç”¨å’Œå¼±å¼•ç”¨è®¡æ•°ã€‚\n## makeuniqueå’Œmakeshared\næ²¡ä½¿ç”¨ï¼Œåˆ™å¯¹è±¡å’Œæ§åˆ¶å—åˆ†å¼€å­˜æ”¾ã€‚\nå¦‚æœä½¿ç”¨ï¼Œåˆ™åœ¨ä¸€èµ·å­˜æ”¾ã€‚\n\nmakeçš„ä¼˜ç‚¹ï¼šç©ºé—´å±€éƒ¨æ€§å¥½ã€‚\n\nä»€ä¹ˆæ—¶å€™è¯¥é‡Šæ”¾å¯¹è±¡å†…å­˜äº†ï¼Ÿå¼ºå¼•ç”¨æŠ€æœ¯ä¸º0å°±è¯¥é‡Šæ”¾äº†ï¼Œå¯¹è±¡åœ¨è¿™æ—¶åº”è¯¥å°±ç®—æ˜¯å¤±æ•ˆäº†ã€‚ä½†æ˜¯å¦‚æœå¼±å¼•ç”¨è®¡æ•°ä¸ä¸º0ï¼Œé‚£ä¹ˆmakeçš„å¯¹è±¡å°±å› ä¸ºæ§åˆ¶å—æœªé‡Šæ”¾è€Œä¸èƒ½é‡Šæ”¾ã€‚\n\n**å¼±å¼•ç”¨è®¡æ•°çš„ç»´æŠ¤ï¼šâ€‹**â€‹ å¦‚æœå­˜åœ¨Â `std::weak_ptr`ï¼Œè¿˜éœ€è¦ç»´æŠ¤é¢å¤–çš„å¼±å¼•ç”¨è®¡æ•°(`weak_count`)ã€‚å½“**å¼ºå¼•ç”¨è®¡æ•°å½’é›¶æ—¶ï¼Œåªé”€æ¯å¯¹è±¡**ï¼›åªæœ‰**å½“å¼±å¼•ç”¨è®¡æ•°ä¹Ÿå½’é›¶æ—¶ï¼Œæ‰é‡Šæ”¾æ§åˆ¶å—æœ¬èº«**ã€‚\n# STL\n## å…­å¤§ç»„ä»¶\n1. å®¹å™¨\n2. è¿­ä»£å™¨\n3. ç®—æ³•\n4. ä»¿å‡½æ•°\n5. é€‚é…å™¨\n6. åˆ†é…å™¨\n## å®¹å™¨\né¡ºåºå‹ï¼šVectorï¼ˆå‘é‡ï¼‰ã€Listï¼ˆï¼‰ã€Array\nå…³ç³»å‹ï¼šmapã€setã€‚unorderedmapã€unorderedsetã€‚\n### setã€mapçš„åº•å±‚\næœ‰åºçš„ï¼Œä½¿ç”¨çº¢é»‘æ ‘å®ç°çš„\n### unorderedsetã€unorderedmapçš„åº•å±‚\nå“ˆå¸Œè¡¨å®ç°ã€‚\n### å¦‚ä½•è§£å†³å“ˆå¸Œå†²çª\nå“ˆå¸Œå†²çªæ˜¯å“ˆå¸Œè¡¨ä¸­æ— æ³•é¿å…çš„ç°è±¡ï¼ˆå¤šä¸ªä¸åŒé”®æ˜ å°„åˆ°åŒä¸€ä¸ªå“ˆå¸Œæ§½ä½ï¼‰ã€‚ä»¥ä¸‹æ˜¯è§£å†³å“ˆå¸Œå†²çªçš„ä¸»è¦æ–¹æ³•åŠå…¶ç‰¹ç‚¹ï¼š\n#### â€‹**â€‹1. å¼€æ”¾å®šå€æ³• (Open Addressing)â€‹**â€‹\nâ€‹**â€‹æ ¸å¿ƒæ€æƒ³â€‹**â€‹ï¼šå½“å‘ç”Ÿå†²çªæ—¶ï¼Œåœ¨å“ˆå¸Œè¡¨ä¸­â€‹**â€‹å¯»æ‰¾ä¸‹ä¸€ä¸ªç©ºé—²æ§½ä½â€‹**â€‹å­˜å‚¨æ•°æ®\n- â€‹**â€‹å¸¸è§æ¢æµ‹æ–¹å¼â€‹**â€‹ï¼š\n    - â€‹**â€‹çº¿æ€§æ¢æµ‹ (Linear Probing)â€‹**â€‹ï¼š\n        å†²çªæ—¶é¡ºåºæ£€æŸ¥ä¸‹ä¸€ä¸ªæ§½ä½ï¼ˆ`index = (hash(key) + i) % size`, `i=1,2,3...`ï¼‰ã€‚\n        _ç¼ºç‚¹ï¼šæ˜“äº§ç”Ÿâ€œèšé›†æ•ˆåº”â€ï¼Œé™ä½æŸ¥è¯¢æ•ˆç‡ã€‚_\n    - â€‹**â€‹äºŒæ¬¡æ¢æµ‹ (Quadratic Probing)â€‹**â€‹ï¼š\n        æŒ‰äºŒæ¬¡æ–¹è·³è·ƒæ¢æµ‹ï¼ˆ`index = (hash(key) + iÂ²) % size`, `i=1,2,3...`ï¼‰ã€‚\n        _ç¼ºç‚¹ï¼šå¯èƒ½æ— æ³•æ‰¾åˆ°ç©ºé—²æ§½ä½ï¼ˆå³ä½¿å­˜åœ¨ï¼‰ã€‚_\n    - â€‹**â€‹åŒé‡æ•£åˆ— (Double Hashing)â€‹**â€‹ï¼š\n        ä½¿ç”¨ç¬¬äºŒä¸ªå“ˆå¸Œå‡½æ•°è®¡ç®—æ­¥é•¿ï¼ˆ`index = (hash1(key) + i * hash2(key)) % size`ï¼‰ã€‚\n        _ä¼˜ç‚¹ï¼šåˆ†å¸ƒæ›´å‡åŒ€ï¼Œæ˜¯å¼€æ”¾å®šå€æ³•ä¸­çš„æœ€ä¼˜æ–¹æ¡ˆã€‚_\n- â€‹**â€‹é€‚ç”¨åœºæ™¯â€‹**â€‹ï¼šæ•°æ®é‡è¾ƒå°ã€å†…å­˜ç´§å‡‘çš„åœºæ™¯ï¼ˆå¦‚åµŒå…¥å¼ç³»ç»Ÿï¼‰ã€‚\n#### â€‹**â€‹2. é“¾åœ°å€æ³• (Separate Chaining)â€‹**â€‹\nâ€‹**â€‹æ ¸å¿ƒæ€æƒ³â€‹**â€‹ï¼šå°†æ¯ä¸ªå“ˆå¸Œæ§½ä½ä½œä¸ºâ€‹**â€‹é“¾è¡¨/æ ‘çš„å¤´èŠ‚ç‚¹â€‹**â€‹ï¼Œå†²çªçš„é”®å€¼å¯¹å­˜å‚¨åœ¨åŒä¸€æ§½ä½çš„é“¾è¡¨ä¸­ã€‚\n- â€‹**â€‹å®ç°æ–¹å¼â€‹**â€‹ï¼š\n    - å†²çªæ—¶ï¼Œå°†æ–°æ•°æ®â€‹**â€‹æ’å…¥æ§½ä½å¯¹åº”çš„é“¾è¡¨æœ«å°¾â€‹**â€‹ã€‚\n    - æŸ¥è¯¢æ—¶éå†é“¾è¡¨æŸ¥æ‰¾ç›®æ ‡é”®ã€‚\n- â€‹**â€‹ä¼˜åŒ–æ–¹æ¡ˆâ€‹**â€‹ï¼š\n    - â€‹**â€‹é“¾è¡¨è½¬çº¢é»‘æ ‘â€‹**â€‹ï¼ˆå¦‚Java 8+çš„HashMapï¼‰ï¼šå½“é“¾è¡¨é•¿åº¦è¶…è¿‡é˜ˆå€¼ï¼ˆå¦‚8ï¼‰æ—¶ï¼Œå°†é“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘ï¼Œå°†æŸ¥è¯¢æ•ˆç‡ä»`O(n)`æå‡è‡³`O(log n)`ã€‚\n- â€‹**â€‹ä¼˜åŠ¿â€‹**â€‹ï¼š\n    - å¤„ç†å†²çªç®€å•ï¼Œæ— èšé›†é—®é¢˜ã€‚\n    - æ”¯æŒé«˜æ•ˆåŠ¨æ€æ‰©å®¹ã€‚\n- â€‹**â€‹å·¥ä¸šåº”ç”¨â€‹**â€‹ï¼šJava `HashMap`ã€Python `dict`ã€C++ `unordered_map`å‡é‡‡ç”¨æ­¤æ–¹æ¡ˆã€‚\n#### â€‹**â€‹3. å…¬å…±æº¢å‡ºåŒºæ³• (Overflow Area)â€‹**â€‹\nâ€‹**â€‹æ ¸å¿ƒæ€æƒ³â€‹**â€‹ï¼šåˆ†é…ç‹¬ç«‹ç©ºé—´å­˜å‚¨æ‰€æœ‰å†²çªæ•°æ®\n- å“ˆå¸Œè¡¨åˆ†ä¸ºâ€‹**â€‹ä¸»è¡¨â€‹**â€‹å’Œâ€‹**â€‹æº¢å‡ºåŒºâ€‹**â€‹ã€‚\n- å†²çªæ—¶ï¼Œå°†æ•°æ®å­˜å…¥æº¢å‡ºåŒºï¼Œä¸»è¡¨å¯¹åº”æ§½ä½â€‹**â€‹æŒ‡å‘æº¢å‡ºåŒºçš„é“¾è¡¨â€‹**â€‹ã€‚\n- â€‹**â€‹é€‚ç”¨åœºæ™¯â€‹**â€‹ï¼šå†²çªç‡è¾ƒä½æˆ–æ•°æ®é‡å›ºå®šçš„åœºæ™¯ï¼ˆè¾ƒå°‘ç”¨ï¼‰ã€‚\n#### â€‹**â€‹4. å†å“ˆå¸Œæ³• (Rehashing)â€‹**â€‹\n- å†²çªæ—¶ä½¿ç”¨â€‹**â€‹å¦ä¸€ä¸ªå“ˆå¸Œå‡½æ•°â€‹**â€‹é‡æ–°è®¡ç®—ä½ç½®ã€‚\n- éœ€è¦é¢„ç½®å¤šä¸ªå“ˆå¸Œå‡½æ•°ï¼ˆå¦‚`hash1(key)`, `hash2(key)`...ï¼‰ã€‚\n- â€‹**â€‹ç¼ºç‚¹â€‹**â€‹ï¼šè®¡ç®—æˆæœ¬é«˜ï¼Œé€šå¸¸ç”¨äºç‰¹æ®Šåœºæ™¯ï¼ˆå¦‚å¸ƒéš†è¿‡æ»¤å™¨ï¼‰ã€‚\n#### â€‹**â€‹å®é™…å·¥ç¨‹ä¸­çš„å…³é”®è€ƒé‡â€‹**â€‹\n1. â€‹**â€‹è´Ÿè½½å› å­ (Load Factor)â€‹**â€‹\n    å®šä¹‰ï¼šå·²å­˜å‚¨é”®å€¼å¯¹æ•° / å“ˆå¸Œè¡¨æ€»æ§½ä½æ•°ã€‚\n    â€‹**â€‹å½“è´Ÿè½½å› å­è¶…è¿‡é˜ˆå€¼ï¼ˆå¦‚0.75ï¼‰æ—¶è§¦å‘æ‰©å®¹â€‹**â€‹ï¼ˆå¦‚Java HashMapï¼‰ï¼Œé¿å…å†²çªç‡æ€¥å‰§ä¸Šå‡ã€‚\n2. â€‹**â€‹åŠ¨æ€æ‰©å®¹ (Resizing)â€‹**â€‹\n    æ‰©å®¹æ­¥éª¤ï¼š\n    - æ–°å»ºæ›´å¤§çš„å“ˆå¸Œè¡¨ï¼ˆé€šå¸¸ç¿»å€ï¼‰ã€‚\n    - å°†æ—§è¡¨æ•°æ®â€‹**â€‹é‡æ–°å“ˆå¸Œâ€‹**â€‹åˆ°æ–°è¡¨ã€‚\n    - _å‡æ‘Šæ—¶é—´å¤æ‚åº¦ä¸ºO(1)_ã€‚\n3. â€‹**â€‹å“ˆå¸Œå‡½æ•°è®¾è®¡â€‹**â€‹\n    ç›®æ ‡ï¼šå°½å¯èƒ½å‡åŒ€åˆ†å¸ƒï¼ˆé›ªå´©æ•ˆåº”ï¼‰ã€‚\n    å¸¸è§ç®—æ³•ï¼šMurmurHashã€CityHashï¼ˆéåŠ å¯†åœºæ™¯ï¼‰ï¼›SHA-256ï¼ˆå®‰å…¨åœºæ™¯ï¼‰ã€‚\n#### â€‹**â€‹é€‰æ‹©æŒ‡å—â€‹**â€‹\n\n|â€‹**â€‹æ–¹æ³•â€‹**â€‹|â€‹**â€‹ä¼˜åŠ¿â€‹**â€‹|â€‹**â€‹åŠ£åŠ¿â€‹**â€‹|\n|---|---|---|\n|â€‹**â€‹é“¾åœ°å€æ³•â€‹**â€‹|é«˜æ•ˆå¤„ç†é«˜å†²çªï¼Œæ˜“å®ç°åˆ é™¤|æŒ‡é’ˆå ç”¨é¢å¤–å†…å­˜ï¼Œç¼“å­˜ä¸å‹å¥½|\n|â€‹**â€‹å¼€æ”¾å®šå€æ³•â€‹**â€‹|å†…å­˜ç´§å‡‘ï¼Œç¼“å­˜å‹å¥½|åˆ é™¤å¤æ‚ï¼Œæ˜“èšé›†|\n|â€‹**â€‹å…¬å…±æº¢å‡ºåŒºâ€‹**â€‹|å®ç°ç®€å•|æº¢å‡ºåŒºè¿‡å¤§æ—¶æ€§èƒ½ä¸‹é™|\n\n> ğŸ“Œ â€‹**â€‹å·¥ä¸šå®è·µå»ºè®®â€‹**â€‹ï¼š\n> - é€šç”¨åœºæ™¯ä¼˜å…ˆé€‰æ‹©â€‹**â€‹é“¾åœ°å€æ³•â€‹**â€‹ï¼ˆå¦‚Java/Pythonå†…ç½®å®ç°ï¼‰ã€‚\n> - å†…å­˜æ•æ„Ÿåœºæ™¯ï¼ˆå¦‚åµŒå…¥å¼ï¼‰è€ƒè™‘â€‹**â€‹å¼€æ”¾å®šå€æ³•â€‹**â€‹ã€‚\n> - åŠ¡å¿…é€šè¿‡â€‹**â€‹è´Ÿè½½å› å­æ§åˆ¶æ‰©å®¹â€‹**â€‹ä»¥ç»´æŒ`O(1)`æ“ä½œå¤æ‚åº¦ã€‚\n# cç¨‹åºçš„ç¼–è¯‘é“¾æ¥è¿‡ç¨‹\n1. é¢„ç¼–è¯‘ã€‚\n    1. å®å®šä¹‰\n    2. ä»£ç å¼€å…³\n    3. å¤´æ–‡ä»¶\n2. ç¼–è¯‘ã€‚\n    1. ç”Ÿæˆæ±‡ç¼–ä»£ç \n3. æ±‡ç¼–\n    1. ç”ŸæˆäºŒè¿›åˆ¶çš„ç›®æ ‡æ–‡ä»¶\n4. é“¾æ¥\n    1. ç”Ÿæˆå¯æ‰§è¡Œç¨‹åºã€‚\n# æµ®ç‚¹æ•°ç›¸ç­‰æ€ä¹ˆåˆ¤æ–­\n# æ•°æ®ç»“æ„\n\n## Bæ ‘ï¼ˆBä»£è¡¨Balancedï¼‰\næ˜¯ä¸€ä¸ªæœç´¢æ ‘ï¼Œè€Œä¸”æ˜¯å¹³è¡¡çš„ã€‚\nBSTï¼ˆBinary Search Treeï¼ŒäºŒå‰æœç´¢æ ‘ï¼‰åªæœ‰æœç´¢æ€§è´¨ï¼Œæ²¡æœ‰å¹³è¡¡æ€§è´¨ã€‚\n\næœç´¢æ€§èƒ½ï¼šmé˜¶ï¼ŒæŒ‡çš„æ˜¯1ä¸ªèŠ‚ç‚¹ï¼Œæœ€å¤šæœ‰å¤šå°‘åˆ†æ”¯ã€‚Næ˜¯æ•°æ®è§„æ¨¡ï¼š$log_m N$\n\n## çº¢é»‘æ ‘çš„æ€§è´¨ï¼ˆé€šè¿‡ä»€ä¹ˆè§„èŒƒè¾¾åˆ°å¹³è¡¡ï¼‰\n1. æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²ã€‚\n2. å¦‚æœå·¦å³å­©å­æ˜¯NIL, åˆ™æŠŠæ­¤å­©å­çœ‹ä½œé»‘è‰²èŠ‚ç‚¹; å®é™…ä¸Šè¿™ä¸ªNILèŠ‚ç‚¹æ˜¯å“¨å…µèŠ‚ç‚¹, å¯çœ‹ä½œä¸€ä¸ªå…¬å…±å¶å­èŠ‚ç‚¹; \n3. ä»æ¯ä¸ªå¶å­åˆ°æ ¹çš„æ‰€æœ‰è·¯å¾„ä¸Šä¸èƒ½æœ‰ä¸¤ä¸ªè¿ç»­çš„çº¢è‰²èŠ‚ç‚¹; å¦‚æ­¤, æ¯ä¸ªçº¢è‰²èŠ‚ç‚¹çš„ä¸¤ä¸ªå­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²ã€‚\n4. **ä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ¯ä¸ªå¶å­(å¯ä»¥åŒ…å«NILå…¬å…±å¶èŠ‚ç‚¹)çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹**ã€‚\n\nçº¢é»‘æ ‘å…¶å®æ˜¯2-3æ ‘çš„ä¸€ä¸ªå˜å½¢ï¼ˆä¸å­˜åœ¨4å‹èŠ‚ç‚¹ï¼‰ã€‚\nç”±äºä¸å­˜åœ¨4å‹èŠ‚ç‚¹ï¼Œæ‰€ä»¥ä¸èƒ½å‡ºç°2ä¸ªè¿ç»­çš„çº¢è‰²èŠ‚ç‚¹ã€‚\n\n![](../../images/Cè¯­è¨€_æ ‘/image-20250225072634225.png)\n\nçº¢é»‘æ ‘æœ€é•¿æ”¯çš„é•¿åº¦ ä¸è¶…è¿‡ æœ€çŸ­æ”¯çš„é•¿åº¦çš„2å€ã€‚è™½ç„¶AVLæ ‘æœ€å¤§å·®1ï¼Œä½†AVLæ ‘æ’å…¥æ€§èƒ½å¤ªæ…¢ã€‚çº¢é»‘æ ‘å°±å¾ˆå¥½åœ°å¹³è¡¡äº†å±‚æ•°å·®å¼‚å’Œæ€§èƒ½ã€‚\n\näºŒå‰æ ‘çš„æç«¯å½¢å¼å°±æ˜¯ï¼šä¸€æ”¯æœ€é•¿ã€ä¸€æ”¯æœ€çŸ­ã€‚\næ ¹æ®**ä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ¯ä¸ªå¶å­(å¯ä»¥åŒ…å«NILå…¬å…±å¶èŠ‚ç‚¹)çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹**ï¼Œåªè¦é»‘è‰²èŠ‚ç‚¹æ•°ä¸€æ ·ï¼Œå°±ç®—æ˜¯çº¢é»‘æ ‘ã€‚é‚£ä¹ˆï¼š\nå·¦å­æ ‘æœ€é•¿æƒ…å†µä¸‹æ˜¯ä¸€çº¢çº¿ä¸€é»‘çº¿äº¤æ›¿ç©¿æ’ã€‚å³å­æ ‘æœ€çŸ­æƒ…å†µä¸‹æ˜¯å…¨é»‘ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå·¦å³ä¸¤æ”¯é»‘èŠ‚ç‚¹æ•°ä¸€æ ·ï¼Œè€Œå·¦æ”¯å’Œå³æ”¯çš„é«˜åº¦å·®æœ€å¤§æ˜¯2å€ã€‚\n# ç®—æ³•\nä»¥åŠ¨æ€è§„åˆ’å’Œæ•°æ®ç»“æ„ä¸ºä¸»Â  åŸºç¡€é¢˜ä¼šå‡ºç°å¦‚é‡è½½æ“ä½œç¬¦Â  å›æ–‡åºåˆ—ç­‰é—®é¢˜\nè´ªå¿ƒç®—æ³•å’Œæ´—ç‰Œç®—æ³•å¤§å…¬å¸ä¸€èˆ¬éƒ½ä¼šé—®\nTop ké—®é¢˜\n## æ’åºç®—æ³•\n1. æ’å…¥å‹ï¼šç›´æ¥æ’å…¥ã€å¸Œå°”æ’åº\n2. é€‰æ‹©å‹ï¼šé€‰æ‹©æ’åºã€å †æ’åº\n3. æ¯”è¾ƒå‹ï¼šå†’æ³¡æ’åºã€å¿«é€Ÿæ’åº\n4. å½’å¹¶æ’åº\n\n## å¿«é€Ÿæ’åºçš„æ€æƒ³\n### æ€ä¹ˆé€‰åŸºå‡†å€¼\nå¿«é€Ÿæ’åºï¼Œè¶Šä¹±åºï¼Œè¶Šå¿«ã€‚è¶Šæœ‰åºï¼Œè¶Šæ…¢\n1. éšæœºé€‰ï¼Œè¾¾åˆ°ä¹±åºçš„æ•ˆæœã€‚\n2. ä¸‰ä½å–ä¸­ã€‚å°½é‡é€‰åˆ°é è¿‘ä¸­é—´çš„å€¼ã€‚åˆ’åˆ†çš„ä¸¤æ”¯æ¯”è¾ƒå‡è¡¡ã€‚\n\n### æ€ä¹ˆä¼˜åŒ–\n1. è§„æ¨¡å°çš„æ—¶å€™ï¼Œç”¨ç›´æ¥æ’å…¥æ’åº\n2. é€’å½’æ·±åº¦æ€ä¹ˆæ§åˆ¶ã€‚è®°å½•ä¸€ä¸ªé€’å½’æ·±åº¦çš„å˜é‡ï¼Œå‡åˆ°é›¶çš„æ—¶å€™ï¼Œå°±ä½¿ç”¨å †æ’åºè¿›è¡Œä¼˜åŒ–ã€‚\n    1. å°¾é€’å½’çš„æ¶ˆé™¤\n    2. å†…çœæ’åºã€‚\n## åˆ†æ²»ç®—æ³•\n## åŠ¨æ€è§„åˆ’\n### åŠ¨æ€è§„åˆ’çš„æ€æƒ³\nçŠ¶æ€é‡å ï¼Ÿ\n\næ ¸å¿ƒæ€æƒ³ï¼šä»¥ç©ºé—´æ¢æ—¶é—´ã€‚æŠŠåŸé—®é¢˜æ‹†æˆå‡ ä¸ªé‡å å­é—®é¢˜ã€‚é€šè¿‡å‡ ä¸ªå°é—®é¢˜å»æ¨å¯¼å¤§é—®é¢˜çš„è§£ã€‚\n# æ“ä½œç³»ç»Ÿ\n## è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«\n1. è¿›ç¨‹æ˜¯èµ„æºï¼ˆåŒ…æ‹¬å†…å­˜ã€æ‰“å¼€çš„æ–‡ä»¶ç­‰ï¼‰åˆ†é…çš„å•ä½ï¼Œçº¿ç¨‹æ˜¯ CPU æ‰§è¡Œè°ƒåº¦çš„å•ä½ã€‚\n2. çº¿ç¨‹çš„åˆ›å»ºæ—¶é—´æ¯”è¿›ç¨‹å¿«ï¼Œå› ä¸ºè¿›ç¨‹åœ¨åˆ›å»ºçš„è¿‡ç¨‹ä¸­ï¼Œè¿˜éœ€è¦èµ„æºç®¡ç†ä¿¡æ¯ï¼Œæ¯”å¦‚å†…å­˜ç®¡ç†ä¿¡æ¯ã€æ–‡ä»¶ç®¡ç†ä¿¡æ¯ï¼Œè€Œçº¿ç¨‹ä¸ä¼šæ¶‰åŠè¿™äº›èµ„æºç®¡ç†ä¿¡æ¯ï¼Œè€Œæ˜¯å…±äº«è¿›ç¨‹çš„èµ„æºã€‚\n3. çº¿ç¨‹çš„ç»ˆæ­¢æ—¶é—´æ¯”è¿›ç¨‹å¿«ï¼Œå› ä¸ºçº¿ç¨‹é‡Šæ”¾çš„èµ„æºç›¸æ¯”è¿›ç¨‹å°‘å¾ˆå¤š\n4. åŒä¸€ä¸ªè¿›ç¨‹å†…çš„çº¿ç¨‹åˆ‡æ¢æ¯”è¿›ç¨‹åˆ‡æ¢å¿«ï¼Œå› ä¸ºçº¿ç¨‹å…·æœ‰ç›¸åŒçš„åœ°å€ç©ºé—´ï¼ˆè™šæ‹Ÿå†…å­˜å…±äº«ï¼‰ï¼Œè¿™æ„å‘³ç€åŒä¸€ä¸ªè¿›ç¨‹çš„çº¿ç¨‹éƒ½å…·æœ‰åŒä¸€ä¸ªé¡µè¡¨ï¼Œé‚£ä¹ˆåœ¨åˆ‡æ¢çš„æ—¶å€™ä¸éœ€è¦åˆ‡æ¢é¡µè¡¨ã€‚è€Œå¯¹äºè¿›ç¨‹ï¼Œé¡µè¡¨åˆ‡æ¢å¼€é”€æ˜¯æ¯”è¾ƒå¤§çš„ã€‚\n## è¿›ç¨‹çš„é€šä¿¡æ–¹å¼\n1. ç®¡é“\n    1. åŒ¿åç®¡é“ï¼š`int pipe(int fd[2])`ã€‚\n        1. é€šä¿¡èŒƒå›´æ˜¯å­˜åœ¨çˆ¶å­å…³ç³»çš„è¿›ç¨‹\n        2. è¿”å›æ—¶å‘ä¼ å…¥çš„fdæ•°ç»„å†™å…¥äº†ä¸¤ä¸ªæè¿°ç¬¦ã€‚è¿™ä¸¤ä¸ªæè¿°ç¬¦åŒå±ä¸€ä¸ªè¿›ç¨‹ã€‚ä¸€ä¸ªæ˜¯å†™ç«¯ï¼Œä¸€ä¸ªæ˜¯è¯»ç«¯ã€‚ç®¡é“åªèƒ½ä¸€ç«¯å†™å…¥ï¼Œå¦ä¸€ç«¯è¯»å‡ºã€‚\n        3. forkä¼šå¤åˆ¶æè¿°ç¬¦ã€‚ä¸ºäº†é¿å…forkåï¼Œçˆ¶å­è¿›ç¨‹è¯»å†™æ··ä¹±ã€‚çˆ¶è¿›ç¨‹å…³é—­è¯»å–çš„ `fd[0]`ï¼Œåªä¿ç•™å†™å…¥çš„ `fd[1]`ï¼›å­è¿›ç¨‹å…³é—­å†™å…¥çš„ `fd[1]`ï¼Œåªä¿ç•™è¯»å–çš„ `fd[0]`ã€‚\n        4. å¦‚æœéœ€è¦åŒå‘é€šä¿¡ï¼Œåˆ™åº”è¯¥åˆ›å»ºä¸¤ä¸ªç®¡é“ã€‚\n    2. å‘½åç®¡é“ï¼Œä¹Ÿè¢«å«åšÂ `FIFO`ã€‚å› ä¸ºæ•°æ®æ˜¯å…ˆè¿›å…ˆå‡ºçš„ä¼ è¾“æ–¹å¼\n        1. åœ¨ä¸ç›¸å…³çš„è¿›ç¨‹é—´ï¼ˆéçˆ¶å­ï¼‰ä¹Ÿèƒ½ç›¸äº’é€šä¿¡\n        2. éœ€è¦é€šè¿‡Â `mkfifo`Â å‘½ä»¤æ¥åˆ›å»ºï¼Œå¹¶ä¸”æŒ‡å®šç®¡é“åå­—`mkfifo myPipe`\n        3. ä»¥æ–‡ä»¶çš„æ–¹å¼å­˜åœ¨ï¼š\n           `prw-r--r--. 1 root    root 0 Jul 17 02:45 myPipe`\n        4. å‘è¿™ä¸ªæ–‡ä»¶å†™å…¥æ•°æ®æ—¶ï¼Œå¦ä¸€ç«¯å°±å¯ä»¥è¯»å–ã€‚\n           `echo \"hello\" > myPipe`\n        5. æ“ä½œäº†åï¼Œå‘½ä»¤å°±åœåœ¨è¿™äº†ï¼Œå› ä¸ºç®¡é“é‡Œçš„å†…å®¹æ²¡æœ‰è¢«è¯»å–ï¼Œåªæœ‰å½“ç®¡é“é‡Œçš„æ•°æ®è¢«è¯»å®Œåï¼Œå‘½ä»¤æ‰å¯ä»¥æ­£å¸¸é€€å‡ºã€‚\n    3. æ•ˆç‡ä½ï¼Œç®¡é“ä¸é€‚åˆè¿›ç¨‹é—´é¢‘ç¹åœ°äº¤æ¢æ•°æ®\n2. æ¶ˆæ¯é˜Ÿåˆ—\n    1. æ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä¿å­˜åœ¨å†…æ ¸ä¸­çš„æ¶ˆæ¯é“¾è¡¨ã€‚å­˜åœ¨ç”¨æˆ·æ€ä¸å†…æ ¸æ€ä¹‹é—´çš„æ•°æ®æ‹·è´å¼€é”€\n3. å…±äº«å†…å­˜\n    1. è™šæ‹Ÿå†…å­˜æ˜ å°„åˆ°åŒä¸€å—ç‰©ç†å†…å­˜ã€‚\n    2. é¿å…äº†æ‹·è´å†…æ ¸çš„å¼€é”€ã€‚\n4. ä¿¡å·é‡\n    1. åŒæ­¥æ§åˆ¶å…±äº«å†…å­˜ã€‚\n5. ä¿¡å·\n    1. å¼‚æ­¥é€šä¿¡æœºåˆ¶ã€‚å¯ä»¥ä¸ºä¿¡å·å®šä¹‰ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼Œæœ‰ä¿¡å·æ—¶ï¼Œæ‰§è¡Œå›è°ƒã€‚\n6. socket\n### ç®¡é“å›¾ç¤º\nè¿›ç¨‹ä¸­pipeåˆ›å»ºåŒ¿åç®¡é“å¹¶fork\n![](../../images/20250815é¢è¯•å¿«é€Ÿå¤ç›˜/image-20250820092506190.png)\n\nå‘½ä»¤è¡Œ`A | B`çš„åŸç†ï¼šShellè¿›ç¨‹åˆ›å»ºåŒ¿åç®¡é“ï¼Œforkå‡ºä¸¤ä¸ªå­è¿›ç¨‹ã€‚\n![](../../images/20250815é¢è¯•å¿«é€Ÿå¤ç›˜/image-20250820092600867.png)\n\n## è¿›ç¨‹è°ƒåº¦ç®—æ³•\n1. FIFOï¼ˆFCFSï¼ŒFirst Come First Serveï¼‰\n2. æœ€çŸ­ä½œä¸šä¼˜å…ˆ\n3. é«˜å“åº”æ¯”ã€‚å…¼é¡¾äº†FIFOå’Œæœ€çŸ­ä½œä¸šä¼˜å…ˆã€‚\n    1. å“åº”æ¯”æŒ‡ï¼š(ç­‰å¾…æ—¶é—´+éœ€è¦æ‰§è¡Œæ—¶é—´) / éœ€è¦æ‰§è¡Œæ—¶é—´ã€‚å¦‚æœç­‰å¾…æ—¶é—´è¿‡é•¿ï¼Œåˆ™ä¼˜å…ˆæ‰§è¡Œã€‚å¦‚æœç­‰å¾…æ—¶é—´ä¸€è‡´ï¼Œåˆ™è°éœ€è¦æ‰§è¡Œæ—¶é—´è¶ŠçŸ­ï¼Œè°ä¼˜å…ˆ\n4. æ—¶é—´ç‰‡è½®è½¬\n    1. å¦‚æœæ—¶é—´ç‰‡ç”¨å®Œï¼Œè¿›ç¨‹è¿˜åœ¨è¿è¡Œï¼Œé‚£ä¹ˆå°†ä¼šæŠŠæ­¤è¿›ç¨‹ä» CPU é‡Šæ”¾å‡ºæ¥ï¼Œå¹¶æŠŠ CPU åˆ†é…å¦å¤–ä¸€ä¸ªè¿›ç¨‹ï¼›\n    2. å¦‚æœè¯¥è¿›ç¨‹åœ¨æ—¶é—´ç‰‡ç»“æŸå‰é˜»å¡æˆ–ç»“æŸï¼Œåˆ™ CPU ç«‹å³è¿›è¡Œåˆ‡æ¢ï¼›\n5. æœ€é«˜ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•\n    1. ä¸¤ç§å¤„ç†ä¼˜å…ˆçº§é«˜çš„æ–¹æ³•ï¼šéæŠ¢å å¼å’ŒæŠ¢å å¼\n        1. éæŠ¢å å¼ï¼šå½“å°±ç»ªé˜Ÿåˆ—ä¸­å‡ºç°ä¼˜å…ˆçº§é«˜çš„è¿›ç¨‹ï¼Œè¿è¡Œå®Œå½“å‰è¿›ç¨‹ï¼Œå†é€‰æ‹©ä¼˜å…ˆçº§é«˜çš„è¿›ç¨‹\n        2. æŠ¢å å¼ï¼šå½“å°±ç»ªé˜Ÿåˆ—ä¸­å‡ºç°ä¼˜å…ˆçº§é«˜çš„è¿›ç¨‹ï¼Œå½“å‰è¿›ç¨‹æŒ‚èµ·ï¼Œè°ƒåº¦ä¼˜å…ˆçº§é«˜çš„è¿›ç¨‹è¿è¡Œã€‚\n6. å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•\n    1. æ˜¯ã€Œæ—¶é—´ç‰‡è½®è½¬ç®—æ³•ã€å’Œã€Œæœ€é«˜ä¼˜å…ˆçº§ç®—æ³•ã€çš„ç»¼åˆã€‚\n    2. ã€Œå¤šçº§ã€è¡¨ç¤ºæœ‰å¤šä¸ªé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼ŒåŒæ—¶ä¼˜å…ˆçº§è¶Šé«˜æ—¶é—´ç‰‡è¶ŠçŸ­\n    3. ã€Œåé¦ˆã€è¡¨ç¤ºå¦‚æœæœ‰æ–°çš„è¿›ç¨‹åŠ å…¥ä¼˜å…ˆçº§é«˜çš„é˜Ÿåˆ—æ—¶ï¼Œç«‹åˆ»åœæ­¢å½“å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œè½¬è€Œå»è¿è¡Œä¼˜å…ˆçº§é«˜çš„é˜Ÿåˆ—ï¼›\n\n![](../../images/20250815é¢è¯•å¿«é€Ÿå¤ç›˜/image-20250820074634077.png)\n\n\n## ä¹è§‚é”ã€æ‚²è§‚é”ï¼Ÿ\nä¹è§‚é”æ˜¯ä»€ä¹ˆåœºæ™¯ç”¨ã€‚é»˜è®¤ä¸ä¼šè¢«æ”¹ï¼Œå³å¤šè¯»å°‘å†™çš„åœºæ™¯ã€‚\n## æ­»é”\n### äº§ç”Ÿæ­»é”çš„æ¡ä»¶\néœ€è¦åŒæ—¶æ»¡è¶³ï¼š\n1. äº’æ–¥\n2. æŒæœ‰å¹¶ç­‰å¾…\n3. ä¸å¯æŠ¢å \n4. ç¯è·¯ç­‰å¾…\n### å¦‚ä½•é¿å…æ­»é”\né“¶è¡Œå®¶ç®—æ³•ã€‚\n\nç ´é™¤å››ä¸ªæ¡ä»¶ä¹‹ä¸€å°±è¡Œï¼š\nä¸»è¦æ˜¯ç ´é™¤ç¯è·¯ç­‰å¾…ã€‚\n\næœ€å¸¸è§çš„å¹¶ä¸”å¯è¡Œçš„å°±æ˜¯**ä½¿ç”¨èµ„æºæœ‰åºåˆ†é…æ³•ï¼Œæ¥ç ´ç¯ç¯è·¯ç­‰å¾…æ¡ä»¶**ã€‚\n\nå³ï¼Œä¸¤ä¸ªçº¿ç¨‹éƒ½å…ˆè·å–äº’æ–¥é” Aï¼Œç„¶åè·å–äº’æ–¥é” Bã€‚é¡ºåºä¸€è‡´ã€‚\n### å¦‚æœå‘ç”Ÿæ­»é”ï¼Œæ€ä¹ˆåˆ¤æ–­æ­»é”çš„ä½ç½®\nLinux ä¸‹çš„ C ç¨‹åºï¼Œå¯ä»¥ä½¿ç”¨Â `pstack`Â +Â `gdb`Â å·¥å…·æ¥å®šä½æ­»é”é—®é¢˜\n\npstack å‘½ä»¤å¯ä»¥æ˜¾ç¤ºæ¯ä¸ªçº¿ç¨‹çš„æ ˆè·Ÿè¸ªä¿¡æ¯ï¼ˆå‡½æ•°è°ƒç”¨è¿‡ç¨‹ï¼‰ï¼Œ`pstack <pid>`Â å°±å¯ä»¥äº†ã€‚\n\n![](../../images/20250815é¢è¯•å¿«é€Ÿå¤ç›˜/image-20250820073330063.png)\n\nä½†æ˜¯ï¼Œè¿˜ä¸èƒ½å¤Ÿç¡®è®¤è¿™ä¸¤ä¸ªçº¿ç¨‹æ˜¯åœ¨äº’ç›¸ç­‰å¾…å¯¹æ–¹çš„é”çš„é‡Šæ”¾ï¼Œå› ä¸ºæˆ‘ä»¬çœ‹ä¸åˆ°å®ƒä»¬æ˜¯ç­‰åœ¨å“ªä¸ªé”å¯¹è±¡ï¼Œ\n\nå¯ä»¥ä½¿ç”¨ gdb å·¥å…·è¿›ä¸€æ­¥ç¡®è®¤ï¼ˆ`gdb -p <pid>`ï¼‰ã€‚\n`info thread`ï¼šæ‰“å°çº¿ç¨‹ä¿¡æ¯ã€‚æ¯ä¸ªçº¿ç¨‹å¯¹åº”äº†ä¸€ä¸ªLWPã€‚\n`thread 2`ï¼šåˆ‡æ¢åˆ°æŒ‡å®šçº¿ç¨‹\n`bt`ï¼šæ‰“å°å‡½æ•°å †æ ˆ\n`frame 3`ï¼šæ‰“å°æŸä¸ªå‡½æ•°å¸§çš„ä¿¡æ¯ï¼ˆå‡½æ•°ä»£ç ï¼‰\n`p mutex_A`ï¼šæ‰“å°äº’æ–¥é‡çš„å†…å®¹å€¼ã€‚`__owner`æ ‡ç¤ºäº†å“ªä¸ªçº¿ç¨‹ï¼ˆLWPï¼‰æŒæœ‰ã€‚\n\n![](../../images/20250815é¢è¯•å¿«é€Ÿå¤ç›˜/image-20250820073440504.png)\n\n\n## çº¿ç¨‹å´©æºƒäº†ï¼Œè¿›ç¨‹ä¼šå´©æºƒå—ï¼Ÿ\nä¸ç®¡æ˜¯å­çº¿ç¨‹è¿˜æ˜¯ä¸»çº¿ç¨‹å´©æºƒï¼Œè¿›ç¨‹éƒ½ä¼šå´©æºƒã€‚\næ¯”å¦‚ï¼Œå­çº¿ç¨‹éæ³•è®¿é—®æ— æƒé™å†…å­˜ã€‚\n\næ®µé”™è¯¯ã€‚ï¼ˆsegment faultï¼‰\n## å†…å­˜æ³„æ¼å¦‚ä½•æ’æŸ¥ï¼Ÿ\n1. é™æ€åˆ†æå·¥å…·â€‹â€‹ï¼ˆé¢„é˜²é˜¶æ®µï¼‰\n    1. ç¼–è¯‘å™¨è­¦å‘Šâ€‹â€‹ï¼šå¼€å¯ `-Wall -Wextra`ï¼ˆGCC/Clangï¼‰æˆ– `/W4`ï¼ˆMSVCï¼‰\n    2. Clang-Tidyâ€‹â€‹ï¼šä½¿ç”¨ `clang-tidy -checks=*,-llvm* *.cpp` --æ£€æŸ¥ä»£ç æ¨¡å¼\n    3. Cppcheckâ€‹â€‹ï¼šè¿è¡Œ `cppcheck --enable=all --inconclusive`\n2. åŠ¨æ€åˆ†æï¼ˆè¿è¡Œæ—¶æ£€æµ‹ï¼‰\n    1. Linuxã€Macé¦–é€‰ï¼šValgrindå·¥å…·ã€‚\n    2. è·¨å¹³å°é«˜æ•ˆæ–¹æ¡ˆï¼šAddressSanitizer (ASan)â€‹â€‹\n\nä¹Ÿå¯ä»¥é‡è½½newã€deleteï¼Œç”¨ä¸€ä¸ªmapå­˜å‚¨åˆ›å»ºã€åˆ é™¤å¯¹è±¡çš„è®°å½•ï¼šç¨‹åºé€€å‡ºæ—¶æ£€æŸ¥Â `allocMap`å‰©ä½™é¡¹\n```cpp\nstatic std::map<void*, std::string> allocMap;\n\nvoid* operator new(size_t size, const char* file, int line) {\n    void* ptr = malloc(size);\n    allocMap[ptr] = fmt::format(\"{}:{}\", file, line);\n    return ptr;\n}\n\nvoid operator delete(void* ptr) noexcept {\n    allocMap.erase(ptr);\n    free(ptr);\n}\n#define new new(__FILE__, __LINE__)  // å…³é”®å®å®šä¹‰\n```\n## é¡µé¢ç½®æ¢ç®—æ³•\n1. æœ€ä½³é¡µé¢ç½®æ¢ç®—æ³•ã€‚åŸºæœ¬æ€è·¯æ˜¯ï¼Œç½®æ¢åœ¨ã€Œæœªæ¥ã€æœ€é•¿æ—¶é—´ä¸è®¿é—®çš„é¡µé¢ã€‚å®é™…æ— æ³•å®ç°ï¼Œæ„ä¹‰æ˜¯è¡¡é‡ç®—æ³•çš„æ•ˆç‡\n2. FIFOï¼šé€‰æ‹©åœ¨å†…å­˜é©»ç•™æ—¶é—´æœ€é•¿çš„é¡µé¢æ·˜æ±°ã€‚æœ‰Beladyç°è±¡ã€‚å³cacheå®¹é‡è¶Šå¤§ï¼Œç¼ºé¡µç‡è¶Šé«˜ã€‚\n3. LRUï¼ˆLeast Recently Usedï¼Œè¿‘æ¥æœ€å°‘ä½¿ç”¨ï¼‰\n    1. é€‰æ‹©æœ€é•¿æ—¶é—´æ²¡æœ‰è¢«è®¿é—®çš„é¡µé¢æ·˜æ±°ã€‚\n    2. è¿‘ä¼¼æœ€ä¼˜ç½®æ¢ç®—æ³•ï¼Œæœ€ä¼˜ç½®æ¢ç®—æ³•æ˜¯é€šè¿‡ã€Œæœªæ¥ã€çš„ä½¿ç”¨æƒ…å†µæ¥æ¨æµ‹è¦æ·˜æ±°çš„é¡µé¢ï¼Œè€Œ LRU åˆ™æ˜¯é€šè¿‡ã€Œå†å²ã€çš„ä½¿ç”¨æƒ…å†µæ¥æ¨æµ‹è¦æ·˜æ±°çš„é¡µé¢ã€‚\n    3. å¯ä»¥ç”¨å“ˆå¸Œè¡¨ + åŒé“¾è¡¨å®ç°ã€‚å“ˆå¸Œè¡¨å­˜keyï¼ŒåŒé“¾è¡¨æ˜¯cacheã€‚\n        1. å¦‚æœæˆ‘ä»¬æ¯æ¬¡é»˜è®¤ä»é“¾è¡¨å¤´éƒ¨æ·»åŠ å…ƒç´ ï¼Œé‚£ä¹ˆæ˜¾ç„¶è¶Šé å¤´éƒ¨çš„å…ƒç´ å°±æ˜¯**æœ€è¿‘ä½¿ç”¨**çš„ï¼Œè¶Šé å°¾éƒ¨çš„å…ƒç´ å°±æ˜¯**æœ€ä¹…æœªä½¿ç”¨**çš„\n        2. å¦‚æœè°ƒç”¨äº†ä¸€ä¸ªcacheä¸­çš„é¡µé¢ï¼Œéœ€è¦æŠŠå®ƒç§»åŠ¨åˆ°å¤´éƒ¨ã€‚\n        3. ä¸ºä»€ä¹ˆè¦ç”¨åŒé“¾ä¸ç”¨å•é“¾ï¼Ÿ\n            1. å› ä¸ºæˆ‘ä»¬éœ€è¦åˆ é™¤æ“ä½œã€‚åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ä¸å…‰è¦å¾—åˆ°è¯¥èŠ‚ç‚¹æœ¬èº«çš„æŒ‡é’ˆï¼Œä¹Ÿéœ€è¦æ“ä½œå…¶å‰é©±èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œè€ŒåŒå‘é“¾è¡¨æ‰èƒ½æ”¯æŒç›´æ¥æŸ¥æ‰¾å‰é©±ï¼Œä¿è¯æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ O(1)ã€‚\n        4. ä¸ºä»€ä¹ˆè¦åœ¨é“¾è¡¨ä¸­åŒæ—¶å­˜å‚¨ keyï¼Œè€Œä¸æ˜¯åªå­˜å‚¨ valï¼Ÿ\n            1. å½“ç¼“å­˜å®¹é‡å·²æ»¡ï¼Œæˆ‘ä»¬ä¸ä»…ä»…è¦åˆ é™¤å°¾éƒ¨çš„å…ƒç´ ï¼Œè¿˜è¦æŠŠ map ä¸­æ˜ å°„åˆ°è¯¥èŠ‚ç‚¹çš„ key åŒæ—¶åˆ é™¤ï¼Œè€Œè¿™ä¸ª key åªèƒ½ç”± Node å¾—åˆ°ã€‚å¦‚æœ Node ç»“æ„ä¸­åªå­˜å‚¨ valï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ— æ³•å¾—çŸ¥ key æ˜¯ä»€ä¹ˆï¼Œå°±æ— æ³•åˆ é™¤ map ä¸­çš„é”®ã€‚\n    4. æ€»çš„æ¥è¯´ï¼šä½¿ç”¨ â€‹**â€‹å“ˆå¸Œè¡¨ + ä¸¥æ ¼æ’åºçš„åŒé“¾è¡¨â€‹**â€‹\n4. æ—¶é’Ÿé¡µé¢ç½®æ¢ç®—æ³•\n    1. ä½¿ç”¨ **â€‹å“ˆå¸Œè¡¨â€‹** + **â€‹å¾ªç¯é“¾è¡¨** + è¡¨é’ˆï¼Œè¡¨é’ˆæŒ‡å‘æœ€è€çš„é¡µé¢\n    2. å‘ç”Ÿç¼ºé¡µä¸­æ–­æ—¶ï¼Œç®—æ³•é¦–å…ˆæ£€æŸ¥è¡¨é’ˆæŒ‡å‘çš„é¡µé¢ã€‚\n        1. å¦‚æœå®ƒçš„è®¿é—®ä½ä½æ˜¯ 0 å°±æ·˜æ±°è¯¥é¡µé¢ï¼Œå¹¶æŠŠæ–°çš„é¡µé¢æ’å…¥è¿™ä¸ªä½ç½®ï¼Œç„¶åæŠŠè¡¨é’ˆå‰ç§»ä¸€ä¸ªä½ç½®\n        2. å¦‚æœè®¿é—®ä½æ˜¯ 1 å°±æ¸…é™¤è®¿é—®ä½ï¼Œå¹¶æŠŠè¡¨é’ˆå‰ç§»ä¸€ä¸ªä½ç½®ï¼Œé‡å¤è¿™ä¸ªè¿‡ç¨‹ç›´åˆ°æ‰¾åˆ°äº†ä¸€ä¸ªè®¿é—®ä½ä¸º 0 çš„é¡µé¢ä¸ºæ­¢ã€‚\n5. æœ€ä¸å¸¸ç”¨é¡µé¢æ·˜æ±°\n    1. å½“å‘ç”Ÿç¼ºé¡µä¸­æ–­æ—¶ï¼Œé€‰æ‹©ã€Œè®¿é—®æ¬¡æ•°ã€æœ€å°‘çš„é‚£ä¸ªé¡µé¢ï¼Œå¹¶å°†å…¶æ·˜æ±°\n    2. å®ç°æ–¹å¼æ˜¯ï¼Œå¯¹æ¯ä¸ªé¡µé¢è®¾ç½®ä¸€ä¸ªã€Œè®¿é—®è®¡æ•°å™¨ã€ï¼Œæ¯å½“ä¸€ä¸ªé¡µé¢è¢«è®¿é—®æ—¶ï¼Œè¯¥é¡µé¢çš„è®¿é—®è®¡æ•°å™¨å°±ç´¯åŠ  1ã€‚åœ¨å‘ç”Ÿç¼ºé¡µä¸­æ–­æ—¶ï¼Œæ·˜æ±°è®¡æ•°å™¨å€¼æœ€å°çš„é‚£ä¸ªé¡µé¢\n    3. è¦å¢åŠ ä¸€ä¸ªè®¡æ•°å™¨æ¥å®ç°\n    4. å¦‚æœè¦å¯¹è¿™ä¸ªè®¡æ•°å™¨æŸ¥æ‰¾å“ªä¸ªé¡µé¢è®¿é—®æ¬¡æ•°æœ€å°ï¼Œéœ€è¦æŸ¥æ‰¾é“¾è¡¨æœ¬èº«ï¼Œå¦‚æœé“¾è¡¨é•¿åº¦å¾ˆå¤§ï¼Œæ˜¯éå¸¸è€—æ—¶çš„ï¼Œæ•ˆç‡ä¸é«˜\n    5. è¿˜æœ‰ä¸ªç¼ºé™·ï¼šLFU ç®—æ³•åªè€ƒè™‘äº†é¢‘ç‡é—®é¢˜ï¼Œæ²¡è€ƒè™‘æ—¶é—´çš„é—®é¢˜ï¼Œæ¯”å¦‚æœ‰äº›é¡µé¢åœ¨è¿‡å»æ—¶é—´é‡Œè®¿é—®çš„é¢‘ç‡å¾ˆé«˜ï¼Œä½†æ˜¯ç°åœ¨å·²ç»æ²¡æœ‰è®¿é—®äº†ï¼Œè€Œå½“å‰é¢‘ç¹è®¿é—®çš„é¡µé¢ç”±äºæ²¡æœ‰è¿™äº›é¡µé¢è®¿é—®çš„æ¬¡æ•°é«˜ï¼Œåœ¨å‘ç”Ÿç¼ºé¡µä¸­æ–­æ—¶ï¼Œå°±ä¼šå¯èƒ½ä¼šè¯¯ä¼¤å½“å‰åˆšå¼€å§‹é¢‘ç¹è®¿é—®ï¼Œä½†è®¿é—®æ¬¡æ•°è¿˜ä¸é«˜çš„é¡µé¢\n        1. è§£å†³çš„åŠæ³•è¿˜æ˜¯æœ‰çš„ï¼Œå¯ä»¥å®šæœŸå‡å°‘è®¿é—®çš„æ¬¡æ•°ï¼Œæ¯”å¦‚å½“å‘ç”Ÿæ—¶é—´ä¸­æ–­æ—¶ï¼ŒæŠŠè¿‡å»æ—¶é—´è®¿é—®çš„é¡µé¢çš„è®¿é—®æ¬¡æ•°é™¤ä»¥ 2ï¼Œä¹Ÿå°±è¯´ï¼Œéšç€æ—¶é—´çš„æµå¤±ï¼Œä»¥å‰çš„é«˜è®¿é—®æ¬¡æ•°çš„é¡µé¢ä¼šæ…¢æ…¢å‡å°‘ï¼Œç›¸å½“äºåŠ å¤§äº†è¢«ç½®æ¢çš„æ¦‚ç‡ã€‚\n### LRUå›¾ç¤º\n![](../../images/20250815é¢è¯•å¿«é€Ÿå¤ç›˜/image-20250820075643281.png)\n### LRUå®ç°\n```cpp\nstruct Node {\n    int key;\n    int value;\n    Node* prev;\n    Node* next;\n\n    Node(int k = 0, int v = 0) : key(k), value(v) {}\n};\n\nclass LRUCache {\nprivate:\n    int capacity;\n    Node* dummy; // å“¨å…µèŠ‚ç‚¹\n    unordered_map<int, Node*> key_to_node;\n\n    // åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆæŠ½å‡ºä¸€æœ¬ä¹¦ï¼‰\n    void remove(Node* x) {\n        x->prev->next = x->next;\n        x->next->prev = x->prev;\n    }\n\n    // åœ¨é“¾è¡¨å¤´æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆæŠŠä¸€æœ¬ä¹¦æ”¾åˆ°æœ€ä¸Šé¢ï¼‰\n    void push_front(Node* x) {\n        x->prev = dummy;\n        x->next = dummy->next;\n        x->prev->next = x;\n        x->next->prev = x;\n    }\n\n    // è·å– key å¯¹åº”çš„èŠ‚ç‚¹ï¼ŒåŒæ—¶æŠŠè¯¥èŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å¤´éƒ¨\n    Node* get_node(int key) {\n        auto it = key_to_node.find(key);\n        if (it == key_to_node.end()) { // æ²¡æœ‰è¿™æœ¬ä¹¦\n            return nullptr;\n        }\n        Node* node = it->second; // æœ‰è¿™æœ¬ä¹¦\n        remove(node); // æŠŠè¿™æœ¬ä¹¦æŠ½å‡ºæ¥\n        push_front(node); // æ”¾åˆ°æœ€ä¸Šé¢\n        return node;\n    }\n\npublic:\n    LRUCache(int capacity) : capacity(capacity), dummy(new Node()) {\n        dummy->prev = dummy;\n        dummy->next = dummy;\n    }\n\n    int get(int key) {\n        Node* node = get_node(key); // get_node ä¼šæŠŠå¯¹åº”èŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å¤´éƒ¨\n        return node ? node->value : -1;\n    }\n\n    void put(int key, int value) {\n        Node* node = get_node(key); // get_node ä¼šæŠŠå¯¹åº”èŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å¤´éƒ¨\n        if (node) { // æœ‰è¿™æœ¬ä¹¦\n            node->value = value; // æ›´æ–° value\n            return;\n        }\n        key_to_node[key] = node = new Node(key, value); // æ–°ä¹¦\n        push_front(node); // æ”¾åˆ°æœ€ä¸Šé¢\n        if (key_to_node.size() > capacity) { // ä¹¦å¤ªå¤šäº†\n            Node* back_node = dummy->prev;\n            key_to_node.erase(back_node->key);\n            remove(back_node); // å»æ‰æœ€åä¸€æœ¬ä¹¦\n            delete back_node; // é‡Šæ”¾å†…å­˜\n        }\n    }\n};\n```\n### Clockå›¾ç¤º\n![](../../images/20250815é¢è¯•å¿«é€Ÿå¤ç›˜/image-20250820085133517.png)\n\n\n# ç½‘ç»œ\n## IOå¤ç”¨ï¼Ÿ\n## è¾“å…¥ç½‘å€ï¼Œæ˜¾ç¤ºç½‘é¡µï¼Œéƒ½ç»å†äº†ä»€ä¹ˆè¿‡ç¨‹\n1. åŸŸåè§£æ - DNS\n2. åè®®å¯¹åº”ç«¯å£ã€‚httpæ˜¯80ç«¯å£ï¼Œhttpsæ˜¯443ç«¯å£ã€‚\n    1. httpséœ€è¦é¢å¤–æ¡æ‰‹ï¼Œç¡®è®¤è¯ä¹¦\n    2. æµè§ˆå™¨å‘é€httpè¯·æ±‚ã€‚è¯·æ±‚å†…å®¹ï¼Œæ˜¯TCPæŠ¥æ–‡çš„æ•°æ®éƒ¨åˆ†ã€‚\n3. ä¸¤ä¸ªIP + ç«¯å£ï¼Œå¯ä»¥ç»„æˆä¸€ä¸ªTCPè¿æ¥ã€‚èµ°ä¼ è¾“å±‚ã€‚\n4. äº¤ç»™ç½‘ç»œå±‚ã€‚èµ°è·¯ç”±å™¨\n5. å†äº¤ç»™æ•°æ®é“¾è·¯å±‚ã€‚\n## 3æ¬¡æ¡æ‰‹\nç¬¬3æ¬¡å¯ä»¥æºå¸¦æ•°æ®ã€‚\n## 4æ¬¡æŒ¥æ‰‹\n## IPåè®®åˆ†ç±»ï¼Ÿ\nå¿˜äº†ã€‚äº”ç±»ã€‚\n## å¤šæ’­åœ°å€ã€å¹¿æ’­åœ°å€çš„åŒºåˆ«ï¼Ÿ\n## TCPå’ŒUDPåˆ†ç‰‡ï¼Ÿ\næ ¹æ®MTUï¼ŒTCPæŠ¥æ–‡æœ‰æ ‡è¯†ä½ã€‚åœ¨ä¼ è¾“å±‚æœ¬èº«å°±å¯ä»¥åˆ†ç‰‡ã€‚\nä½†UDPæ²¡æœ‰åˆ†ç‰‡æ ‡è¯†ä½ã€‚å¦‚æœUDPæŠ¥æ–‡å¾ˆå¤§ï¼Œç”¨çš„æ˜¯IPå±‚æŠ¥æ–‡æä¾›çš„åº•å±‚åˆ†ç‰‡æœåŠ¡ã€‚\nä½†æ˜¯ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ï¼Œä¸€ä½†ä¸€ä¸ªIPåŒ…ä¸¢å¤±ï¼Œå…¨éƒ¨æ•°æ®å°±ä¼šå…¨ä¸¢å¼ƒï¼Œå¤§å¤§å¢åŠ ä¸¢åŒ…æ¦‚ç‡ã€‚\nå¯ä»¥åœ¨åº”ç”¨å±‚æ§åˆ¶UDPä¼ è¾“çš„æ•°æ®ä¸è¦å¤ªå¤§ï¼Œè¾¾åˆ°ä¸€ä¸ªåˆ†ç‰‡çš„æ•ˆæœã€‚è¿™æ ·ï¼Œå³ä½¿ä¸¢IPåŒ…ï¼Œä¹Ÿåªä¸¢å¤±äº†å°éƒ¨åˆ†æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸€ä¸¢ä¸¢ä¸€ä¸²ã€‚\n### å¦‚æœå°±æ˜¯æƒ³ä¼ ä¸€ä¸ªå¾ˆå¤§çš„UDPæ•°æ®åŒ…æ€ä¹ˆåŠï¼Ÿ\nå¦‚æœè¦æ±‚UDPæŠ¥æ–‡100%ä¼ è¾¾ï¼Œéœ€è¦æ¨¡æ‹Ÿå®ç°TCPåŠŸèƒ½æˆ–è€…QUICåè®®ã€‚","categories":["é¢è¯•ç»éªŒ"]},{"title":"Androidæ—¥å¿—åˆ†æç³»ç»Ÿå¤ç›˜","url":"/é¢è¯•ç»éªŒ/Androidæ—¥å¿—åˆ†æç³»ç»Ÿä»¥åŠè¿œç¨‹è¯Šæ–­ã€å±è”½æ¥å£å¤ç›˜/","content":"æ­å»ºä¸€ä¸ªHTTPåå°æœåŠ¡ï¼Œï¼ˆç½‘ç»œåº“ï¼Œçº¿ç¨‹å®‰å…¨ï¼‰\næ ¹æ®æä¾›çš„URLï¼Œä¸‹è½½æ—¥å¿—å‹ç¼©åŒ…ï¼Œï¼ˆä¸‹è½½æœåŠ¡ï¼Œwgetï¼‰\nç„¶åè¿›è¡Œå‹ç¼©åŒ…çš„è§£å‹æ“ä½œã€‚ï¼ˆè§£å‹æœåŠ¡ï¼Œtarã€7zï¼‰\nè§£å‹ä¹‹åï¼Œç¼–å†™è„šæœ¬ç¨‹åºç»Ÿè®¡æ—¥å¿—æ–‡ä»¶æ•°ç›®ã€åˆ†ç±»ã€‚ï¼ˆè„šæœ¬ç¼–ç¨‹ï¼ŒShellï¼‰\nä½¿ç”¨æ£€ç´¢å·¥å…·ï¼Œè§£ææ—¥å¿—çš„å…³é”®å†…å®¹ã€‚ï¼ˆæ£€ç´¢ï¼Œrgï¼‰\n\n# ç›®å‰æ”¯æŒè§£æçš„æ—¥å¿—ç±»å‹\n1. anrã€tombstoneçš„æ•°ç›®\n2. logdumpã€kernel logã€tombstoneçš„å…·ä½“äº‹ä»¶\n    1. å‡å·²æ”¯æŒæ£€ç´¢æ­£åˆ™è¡¨è¾¾å¼åŠæ˜¾ç¤ºå…¶åŸå¥\n3. dropbox panicå­—çœ¼\n\n# é—®é¢˜è§£å†³ - æŠ¥æ–‡æ‹†åˆ†ã€è¶…é¢‘é‡å‘\nå“åº”çš„æ¶ˆæ¯è¦å‘åˆ°ä¼ä¸šå¾®ä¿¡APIã€‚\næ¯æ¬¡çš„æ¶ˆæ¯éƒ½æœ‰é•¿åº¦é™åˆ¶ä¸º5120ä¸ªå­—ç¬¦ï¼Œå¦‚æœè¶…è¿‡äº†é™åˆ¶å°±éœ€è¦åšä¸€ä¸ªæŠ¥æ–‡æ‹†åˆ†å¤„ç†\n\nè™½ç„¶ä¼ä¸šå¾®ä¿¡apiå‘é€æˆåŠŸç‡å¾ˆé«˜ï¼Œä½†æ˜¯æœåŠ¡å™¨ä¹Ÿæœ‰å¿…è¦ç¡®è®¤å®¢æˆ·ç«¯æ”¶åˆ°äº†æ¶ˆæ¯ï¼Œç›´åˆ°æ”¶åˆ°å›å‘çš„okæ‰æ”¾å¿ƒã€‚\n\næŒ‰ç›®å‰é¡¹ç›®è¦å¤„ç†çš„å†…å®¹çš„ä½“é‡æ¥è¯´ä¸é‚£ä¹ˆç´§è¦ï¼Œä½†æ˜¯å¯¹äºå¯èƒ½æ‰©å¤§è§„æ¨¡å¾ˆæœ‰å¿…è¦ï¼Œ\nä¼ä¸šå¾®ä¿¡æ¥å£æ¯åˆ†é’Ÿåªèƒ½å‘20æ¡æ¶ˆæ¯ï¼Œå¦‚æœæ”¶åˆ°è¶…é¢‘ç‡åº”ç­”ï¼Œéœ€è¦é˜»å¡1åˆ†é’Ÿé‡å‘ã€‚æ€»çš„æ¥è¯´ï¼Œéœ€è¦å®Œå–„ä¸€ä¸‹ç³»ç»Ÿçš„ç¡®è®¤åº”ç­”æœºåˆ¶ã€‚\n## ä¸‰ç§å¼‚å¸¸å¤„ç†ï¼šåˆ†åŒ…ã€å¾ªç¯+é‡ä¼ é€’å½’\n```cpp\n    // æŸ¥é¡¹ç›®ç›®å‰æ”¯æŒçš„errcodeè¡¨\n    if(WorkWXErrCodeErrMsg.find(receivedJson[\"errcode\"]) != WorkWXErrCodeErrMsg.end())\n    {\n        // æ¥æ”¶åˆ°okæŠ¥æ–‡ï¼Œå³å®¢æˆ·ç«¯ç¡®è®¤æ”¶åˆ°\n        if(receivedJson[\"errcode\"] == 0){\n            return true;\n        }\n        else // å¼‚å¸¸å¤„ç†\n        {\n            LOG_ERROR << \"WorkWX API Return Json ErrMsg: \" << string(receivedJson[\"errmsg\"]);\n            // è¶…é•¿ï¼Œåˆ†åŒ…å¤„ç†\n            if(receivedJson[\"errcode\"] == WorkWXErrCode::MSG_OUT_OF_LENGTH)\n            {\n                vector<json> splitContentJsonVec;\n                SplitJsonMsgPack(splitContentJsonVec, contentJson, fileName);\n                for(const auto & pack : splitContentJsonVec)\n                {\n                    if(!SendJsonToWX(webhook, fileName, pack, level + 1))\n                    {\n                        LOG_ERROR << \"Failed to send split message pack, contentJson was log to the file.\";\n                        LOG_ERROR << contentJson.dump();\n                        return false;\n                    }\n                }\n                return true;\n            }// ä¼ä¸šå¾®ä¿¡apiè§„å®š1åˆ†é’Ÿåªèƒ½å‘20æ¡æ¶ˆæ¯ã€‚è¶…é¢‘ï¼Œé˜»å¡1minå¤„ç†\n            else if(receivedJson[\"errcode\"] == WorkWXErrCode::FREQ_OUT_OF_LIMIT){\n                sleep(60);\n                return SendJsonToWX(webhook, fileName, contentJson, level + 1);\n            }// å¾®ä¿¡ç³»ç»Ÿç¹å¿™ï¼Œè¶…æ—¶ï¼Œé˜»å¡level miné‡å‘\n            else if(receivedJson[\"errcode\"] == WorkWXErrCode::BUSY){\n                sleep(level * 60);\n                return SendJsonToWX(webhook, fileName, contentJson, level + 1);\n            }\n        }\n    }\n```\n\n```cpp\nvoid SplitJsonMsgPack(vector<json> & jsonVec, const json &j, const string &fileName)\n{\n    string msgtype = j[\"msgtype\"];\n    string content = j[msgtype][\"content\"];\n    //æ¯ä¸ªåŒ…åŠ  æ–‡ä»¶å+count(é¡µæ•°)  å› ä¸ºä¸èƒ½è¶…è¿‡4096ä¸ªæ‰€ä»¥æ­¤å¤„æŠ½å‡º72ä¸ªå­—èŠ‚å­˜æ”¾åŒ…å\n    for(int count = 1, pos = 0; pos <= content.size(); pos += 4024, ++count)\n    {\n        string head = fileName + \" :\" + to_string(count) + \"\\n\";\n        string splitMsg = head + content.substr(pos, 4024);\n        json contentJson = {{\"content\", splitMsg.c_str()}};\n        contentJson = {{\"msgtype\", \"markdown\"}, {\"markdown\", contentJson}};\n        jsonVec.emplace_back(contentJson);\n    }\n}\n```\n# é—®é¢˜è§£å†³ - æœ¬åœ°ä¸‹è½½é—®é¢˜\nwget -N å‚æ•°ï¼šå¦‚æœæœ¬åœ°æ–‡ä»¶â€‹**â€‹ä¸å­˜åœ¨â€‹**â€‹ï¼Œå®ƒä¼šç›´æ¥ä¸‹è½½è¯¥æ–‡ä»¶ï¼›å¦‚æœæœ¬åœ°æ–‡ä»¶â€‹**â€‹å·²ç»å­˜åœ¨â€‹**â€‹ï¼ŒWget ä¼šå‘æœåŠ¡å™¨å‘å‡ºä¸€ä¸ª â€‹**â€‹`HEAD`è¯·æ±‚â€‹**â€‹ï¼ˆè€Œéå®Œæ•´çš„Â `GET`è¯·æ±‚ï¼‰æ¥è·å–è¯¥èµ„æºçš„â€‹**â€‹æœ€åä¿®æ”¹æ—¶é—´â€‹**â€‹ (`Last-Modified`å¤´éƒ¨)ã€‚\n\nå¦‚æœä¸€ä¸ªç»ˆç«¯ä¸‹è½½äº†æ­¤æ–‡ä»¶ï¼Œç„¶ååœ¨æœ¬åœ°åˆ é™¤æ‰æ­¤æ–‡ä»¶ï¼Œå†å°è¯•ä¸‹è½½æ—¶ï¼Œå‘ç°æœ‰æ—¶ä¸ä¼šä¸‹è½½ï¼Œå³è¯¯è®¤ä¸ºå­˜åœ¨ä¸€æ ·çš„æ–‡ä»¶ã€‚\n\néœ€è¦å’Œåå°é‚£è¾¹è¿›è¡Œæ²Ÿé€šï¼Œè®©å…¶æä¾›ä¸€ä¸ªæ ¡éªŒç æ¥å£ï¼Œä»¥ä¾¿å¯ä»¥å’Œæœ¬åœ°å¯¹æ¯”ã€‚\n## å…ˆå°è¯•è§£å‹ï¼Œåä¸‹è½½\nä¼˜åŒ–äº†ä¸€ä¸‹å¤„ç†é€»è¾‘ï¼Œå…ˆå°è¯•è§£å‹å†è¿›è¡Œä¸‹è½½ï¼Œå¯¹äºå·²ç»ä¸‹è½½å¥½çš„æ—¥å¿—åŒ…ï¼Œæ•ˆæœå¾ˆæ˜æ˜¾ï¼Œç›´æ¥ç•¥å»äº†ä¸å¿…è¦çš„ä¸‹è½½ã€‚\n## å’Œåå°è”è°ƒ - å‹ç¼©åŒ…æ£€éªŒç é—®é¢˜\né—®äº†åå°é‚£è¾¹ç½‘å€åŒ…å«ä¸åŒ…å«å‹ç¼©åŒ…æ ¡éªŒç ï¼Œ\nå¦‚æœä¸åŒ…å«ï¼Œé‚£å°±æŠŠå¼‚å¸¸æƒ…å†µæ”¾åœ¨è§£å‹ç¼©çš„ç¯èŠ‚ä¸Šï¼Œåœ¨è§£å‹ç¼©è„šæœ¬ä¸Šè¿›è¡Œå¼‚å¸¸å¤„ç†\n# Cè°ƒç”¨Shell\npopenã€systemã€fork+execä¸‰è€…çš„åŒºåˆ«ã€å’Œå¼‚å¸¸å¤„ç†ï¼Œ\n\nå…¶ä¸­systemå¯ä»¥è®©çˆ¶è¿›ç¨‹è‡ªåŠ¨é˜»å¡ï¼Œé¿å…äº†ä¸‹è½½æ–‡ä»¶ã€è§£å‹ç¼©çš„è¿›ç¨‹å®‰å…¨é—®é¢˜ï¼Œçœå»äº†å¥½å¤šè¿›ç¨‹æ§åˆ¶çš„ä»£ç ã€‚ä½†æ˜¯è¿”å›å€¼æŒºå¤šçš„ï¼Œå¾—åˆ†å¥½å¤šæƒ…å†µï¼Œ\n\npopenæ˜¯å°è£…äº†forkã€pipeã€execï¼Œè‡ªåŠ¨å…³é—­äº†ä¸éœ€è¦çš„è¯»å†™ç«¯ï¼Œç”±äºå°è£…äº†ä¸‰ä¸ªæ“ä½œï¼Œå¯èƒ½ä»£ç ä¸Šå¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯å¯èƒ½å†…éƒ¨ä¼šå‡ºç°ä¸€äº›å¼‚å¸¸ï¼Œéœ€è¦å»é¿å¼€å‘ç‚¹ï¼Œ\n\nè€Œfork+execè™½ç„¶å¾ˆåŸå§‹ï¼Œä½†æ˜¯è®©ä»£ç é€»è¾‘å¾ˆæ˜äº†ï¼Œä¸»è¿›ç¨‹å¯ä»¥åœ¨ç­‰å¾…æœŸé—´åšä¸€äº›è‡ªå®šä¹‰çš„äº‹ã€‚\n\næ‰€ä»¥æŠŠä»£ç ä¸­éœ€è¦è°ƒç”¨è„šæœ¬çš„åœ°æ–¹å„å–æ‰€éœ€ï¼Œåˆ†æƒ…å†µè°ƒç”¨ã€‚è¿™ä¹Ÿç»™äº†ä¸€ä¸ªå¯å‘ï¼Œéœ€è¦åœ¨è°ƒç”¨æ—¶å¤šçœ‹æ‰‹å†Œã€å¤šGoogleï¼Œæ˜ç¡®ç»†èŠ‚å’Œå‘ç‚¹ã€‚\n\n# æ—¥å¿—åˆ†æç³»ç»Ÿæ€»ä½“æµç¨‹\n\n# è¿œç¨‹è¯Šæ–­æ–°çš„éœ€æ±‚\nå­¦ä¹ å®ˆæŠ¤å¹³å°è¿œç¨‹è¯Šæ–­æ—¥å¿—ä¸ŠæŠ¥æ¨¡å—æœ‰æ–°çš„éœ€æ±‚ï¼Œæ˜¨å¤©å¼€å‘çš„æ˜¯æ‰«æå±€åŸŸç½‘è®¾å¤‡æ•°çš„ä»£ç ï¼Œéœ€äº†è§£å®‰å“å¤šçº¿ç¨‹å’Œå¼‚æ­¥ç¼–ç¨‹çš„çŸ¥è¯†ï¼Œå­¦ä¹ serviceæœ‰å…³å†…å®¹æ¥æ›´å¥½çš„è¿›è¡Œå¼€å‘è¿œç¨‹è¯Šæ–­æ¨¡å—ã€‚\n\nå‰æœŸä¸»è¦åšçš„æ˜¯è®¾å¤‡ç«¯çš„è¯Šæ–­ä»£ç å®ç°ï¼Œç†Ÿæ‚‰ä¸€ä¸‹IoTçš„æ¥å£è§„èŒƒï¼Œå’Œåå°é‚£è¾¹å¯¹æ¥ä¸€ä¸‹æ•°æ®æ ¼å¼ï¼Œç†Ÿæ‚‰ä¸€ä¸‹ä¼ æ„Ÿå™¨çš„çŸ¥è¯†ï¼Œå¦‚ä½•è·å–æ•°æ®ã€‚\n\nç†Ÿæ‚‰è¿œç¨‹è¯Šæ–­ç°æœ‰çš„ä»£ç æ¡†æ¶ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œæ‰©å±•ï¼Œå®Œæˆè·å–æ—¶é—´çš„ä»£ç ï¼Œç†Ÿæ‚‰éº¦å…‹é£æ£€æµ‹å’Œè·å–ä¼ æ„Ÿå™¨çš„ä»£ç ã€‚\n\nä»£ç å®Œæˆåï¼Œå’Œåå°æ²Ÿé€šæ•°æ®æ¨¡å‹ï¼Œå’Œåå°è¿›è¡Œè”è°ƒã€‚\n\nå®Œæˆç½‘å¡ä¿¡æ¯çš„è·å–ä»£ç ï¼Œå®ŒæˆJSONçš„æ•´åˆã€‚è‡ªæµ‹ä¹‹åï¼Œå’Œåå°é‚£è¾¹è¿›è¡Œè”è°ƒï¼Œç›®å‰é“¾è·¯æ˜¯é€šçš„ï¼Œæ ¼å¼æ­£ç¡®ï¼Œä½†æ˜¯æœ‰äº›å€¼è·å–çš„æœ‰ç‚¹å°é—®é¢˜ï¼Œæ¯”å¦‚å­ç½‘æ©ç ã€‚\n\næ•´ç†è¿œç¨‹è¯Šæ–­çš„ä»£ç ï¼Œæäº¤åˆ°ä»“åº“ã€‚\n\nè°ƒè¯•äº†ä¸€ä¸‹TC02å’ŒDT15çš„IoTè¿œç¨‹è¯Šæ–­åŠŸèƒ½ï¼Œè§£å†³äº†ä¸€äº›å°é—®é¢˜ï¼Œæäº¤æœ€æ–°çš„ä»£ç ç­‰å¾…åˆå¹¶ã€‚\n\n","categories":["é¢è¯•ç»éªŒ"]},{"title":"Mac_ç»ˆç«¯é…ç½®","url":"/ä¸€äº›å·¥å…·çš„ä½¿ç”¨/Mac_ç»ˆç«¯é…ç½®/","content":"# é€‰æ‹©\nMacçš„ç»ˆç«¯æœ‰å¾ˆå¤šé€‰æ‹©ã€‚\næ¨èå¾—æ¯”è¾ƒå¤šçš„ï¼š\n1. iTerm2ï¼Œæ˜¯ä¸ªè€ç‰ŒmacOSç»ˆç«¯ï¼Œç²¾å·§ã€‚å¹¶ä¸”æ›´æ–°é¢‘ç¹ã€‚ç¼ºç‚¹æ˜¯ä¸è·¨å¹³å°ã€‚\n2. warpã€‚rustå†™çš„ã€‚GPUæ¸²æŸ“ï¼Œçœ‹èµ·æ¥å¾ˆç°ä»£ã€‚è¯Ÿç—…æ¯”è¾ƒå¤šçš„æ˜¯æœ‰æ—¶å¤ªå å†…å­˜ï¼Œç”šè‡³æœ‰æ—¶èƒ½åƒ2Gã€‚ä½†æ˜¯é›†æˆçš„æ— ç¼AIäº¤äº’ä½“éªŒå¾ˆå¥½ã€‚\n3. Termiusã€‚æ˜¯ä¸“é—¨ç»™å¤šç«¯ä½¿ç”¨çš„ï¼Œä¸»è¦ç”¨äºç®¡ç†SSHã€‚ç”¨äº†ç”¨ï¼Œæ„Ÿè§‰ä¸å¤ªä¹ æƒ¯ã€‚\n# ç»ˆç«¯é…ç½®\nwarpé»˜è®¤ä½¿ç”¨çš„æ˜¯zshé…ç½®æ–‡ä»¶ã€‚åœ¨`/Users/mrcan/.zshrc`ã€‚\nä½†zshé…ç½®æ–‡ä»¶åœ¨macOSé»˜è®¤æ˜¯æ²¡æœ‰çš„ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºã€‚\n\n```sh\n# Warp Terminal & Zsh Configuration\n# Colors for different file types in ls command\n\n# Enable colors for ls on macOS\nexport CLICOLOR=1\n\n# macOS BSD ls colors (LSCOLORS format)\n# Format: directory:symlink:socket:pipe:executable:block:character:setuid:setgid:dir_w_sticky:dir_wo_sticky\nexport LSCOLORS=ExGxBxDxCxEgEdxbxgxcxd\n\n# If you have GNU coreutils installed (brew install coreutils), uncomment these:\n# alias ls='gls --color=auto'\n# export LS_COLORS='di=1;34:ln=1;36:so=1;35:pi=1;33:ex=1;32:bd=1;34:cd=1;34:su=0;41:sg=0;46:tw=0;42:ow=0;43:mi=1;37;41:*.tar=1;31:*.tgz=1;31:*.zip=1;31:*.gz=1;31:*.bz2=1;31:*.xz=1;31:*.jpg=1;35:*.jpeg=1;35:*.png=1;35:*.gif=1;35:*.mp3=1;33:*.mp4=1;33:*.avi=1;33:*.mov=1;33:*.pdf=1;31:*.doc=1;31:*.txt=0;37:*.md=1;37:*.json=1;33:*.xml=1;33:*.yml=1;33:*.yaml=1;33:*.js=1;32:*.ts=1;32:*.py=1;32:*.go=1;32:*.rs=1;32:*.cpp=1;32:*.c=1;32:*.h=1;32'\n\n# Useful aliases for colorful output\nalias ll='ls -la'\nalias la='ls -A'\nalias l='ls -CF'\n\n# Enable color support for grep\nalias grep='grep --color=auto'\nalias fgrep='fgrep --color=auto'\nalias egrep='egrep --color=auto'\n\n# Git colors (if you use git)\nalias git='git --no-pager'\n\n# Warp works great with these modern alternatives (install via brew if desired):\n# brew install exa && alias ls='exa --color=always --icons'\n# brew install lsd && alias ls='lsd --color=always'\n# brew install bat && alias cat='bat --style=auto'\n```\nä»¥ä¸Šé…ç½®æ–‡ä»¶çš„æ•ˆæœï¼š\nWhat's now working:\nâ€¢  Colored directories - Blue folders\nâ€¢  Colored file types - Different colors for executables, links, etc.\nâ€¢  Useful aliases - ll, la, l for different listing views\nâ€¢  Colored grep - Search results will be highlighted\n\nå†™å…¥é…ç½®æ–‡ä»¶åï¼Œè¿˜éœ€è¦`source ~/.zshrc`ä½¿è¿™ä¸ªé…ç½®æ–‡ä»¶ç«‹å³ç”Ÿæ•ˆã€‚\n\n# macOSä½¿ç”¨brewå®‰è£…å¼€å‘å·¥å…·ï¼Œä»¥å®‰è£…gitä¸ºä¾‹\né€šå¸¸åœ¨macOSä¸Šæœ‰ä¸¤ç§å¸¸ç”¨çš„å®‰è£…æ–¹å¼ï¼šbrew installæˆ–è€…xcode-select --install\nxcode-select and brew, which is better? what are the difference of them\n## ä¸¤è€…çš„å¯¹æ¯”\nHere are the key differences between installing Git via `xcode-select` and Homebrew:\n\n### Xcode Command Line Tools (`xcode-select --install`)\n\n**Pros:**\n- **Apple-maintained**: Official Apple distribution, well-integrated with macOS\n- **Comes with essential dev tools**: Includes GCC, make, and other development utilities\n- **System-level installation**: Installed in `/usr/bin/git`\n- **No additional dependencies**: Built into macOS\n- **Required for many dev tasks anyway**: Needed for compiling software from source\n\n**Cons:**\n- **Slower updates**: Git version updates only come with macOS/Xcode updates\n- **Older versions**: Often ships with older Git versions\n- **Less control**: Can't easily switch versions or customize installation\n\n### Homebrew (`brew install git`)\n\n**Pros:**\n- **Latest versions**: Usually has the most recent Git releases\n- **Easy updates**: `brew upgrade git` keeps you current\n- **Version management**: Can install multiple versions if needed\n- **Package ecosystem**: Access to thousands of other developer tools\n- **Customizable**: Various installation options and configurations\n\n**Cons:**\n- **Additional dependency**: Requires Homebrew to be installed first\n- **PATH management**: Need to ensure Homebrew's path comes before system paths\n- **User-space installation**: Installed in `/opt/homebrew/bin/git` (Apple Silicon) or `/usr/local/bin/git` (Intel)\n\n### Which is Better?\n\n**For most developers, Homebrew is better** because:\n1. You get newer Git features and security fixes faster\n2. You'll likely want Homebrew for other development tools anyway\n3. Easy to keep everything updated\n\n**Use Xcode Command Line Tools if:**\n- You prefer minimal system modifications\n- You don't need the latest Git features\n- You're doing iOS/Mac development (you'll need Xcode tools anyway)\n\n**Recommendation**: Install Xcode Command Line Tools first (many things depend on it), then install Git via Homebrew for the best of both worlds.\n## brewçš„å®‰è£…\né»˜è®¤macOSæ˜¯æ²¡æœ‰brewçš„ã€‚éœ€è¦å…ˆå®‰è£…ã€‚è€Œå®‰è£…brewè¿˜éœ€è¦å®‰è£…xcode command line toolsï¼ˆåœ¨å®‰è£…brewæ—¶å¦‚æœæ£€æµ‹åˆ°æ²¡æœ‰è¿™ä¸ªï¼Œä¼šè‡ªåŠ¨å¸®ä½ è£…ï¼‰ã€‚\n```bash\n/bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\"\n```\n\nå®‰è£…å®Œä¹‹åï¼Œå®ƒä¼šæç¤ºä½ ï¼ŒåŠ å…¥PATHï¼š\n```bash\n# Run these commands in your terminal to add Homebrew to your PATH:\necho >> /Users/mrcan/.zprofile\necho 'eval \"$(/opt/homebrew/bin/brew shellenv)\"' >> /Users/mrcan/.zprofile\neval \"$(/opt/homebrew/bin/brew shellenv)\"\n```\nä¹‹åï¼Œå°±å¯ä»¥`brew help`æµ‹è¯•äº†ã€‚\n\n>ä½†æ˜¯ï¼Œè¿™é‡Œæœ‰ä¸ªå‘ï¼Œå°±æ˜¯ç¬¬äºŒå¥ï¼Œå®é™…æœ€å`.zprofile`æ–‡ä»¶ä¸­ä¿å­˜æˆäº†`eval \\\"$(/opt/homebrew/bin/brew shellenv)\\\"`ã€‚\n>å¯¼è‡´ä¸‹ä¸€æ¬¡æ‰“å¼€ç»ˆç«¯æŠ¥é”™ï¼š\n\n```\n(eval):1: no such file or directory: export HOMEBREW_PREFIX=/opt/homebrew; export HOMEBREW_CELLAR=/opt/homebrew/Cellar; export HOMEBREW_REPOSITORY=/opt/homebrew; fpath[1,0]=/opt/homebrew/share/zsh/site-functions; PATH=/opt/homebrew/bin:/opt/homebrew/sbin:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/local/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/appleinternal/bin; export PATH; [ -z  ] || export MANPATH=:; export INFOPATH=/opt/homebrew/share/info:;\n```\n\n>åº”è¯¥å­˜æˆ`eval \"$(/opt/homebrew/bin/brew shellenv)\"`æ‰å¯¹ã€‚\n>ä¿®æ”¹ä¹‹åï¼Œ`source ~/.zprofile`å³å¯ç”Ÿæ•ˆã€‚\n>The issue was in your .zprofile file where the quotes around the eval command were escaped (with backslashes), which caused the shell to interpret them incorrectly.\n>This command properly sets up your Homebrew environment variables (like HOMEBREW_PREFIX, PATH, etc.) that you saw in the error message. The error occurred because the shell couldn't properly execute the command due to the escaped quotes.\n>Your shell should now work properly without that error. You can restart your terminal or run source `~/.zprofile` to apply the changes.\n## brewå®‰è£…git\n```bash\nbrew install git\ngit --version\n```\n# gité…ç½®\n## ç”Ÿæˆå…¬é’¥\n```bash\nssh-keygen -t ed25519 -C \"your_email@example.com\"\n```\né»˜è®¤ç”Ÿæˆåˆ°äº†`~/.ssh/id_rsa`or`~/.ssh/id_ed25519`\n\nå®é™…æµ‹è¯•ï¼Œé»˜è®¤ä¿å­˜åˆ°äº†`/Users/mrcan/.ssh/id_ed25519`ï¼Œè¿™æ˜¯ç§é’¥ï¼Œå…¬é’¥ä¿å­˜åˆ°äº†`/Users/mrcan/.ssh/id_ed25519.pub`\n\nä¹‹åï¼ŒæŠŠå…¬é’¥ä¸Šä¼ åˆ°GitHubå³å¯ã€‚\n## å‘ç°ä¸èƒ½è¯»å–repo\n```bash\nssh -T git@github.com\n```\nè¿™æ˜¯é€šç”¨çš„æ£€æµ‹æ–¹æ³•ã€‚å‘ç°ä¸è¡Œã€‚\nåŸå› æ˜¯æˆ‘ä»¬æ²¡æœ‰æŠŠgithub.comæ·»åŠ åˆ°å¯ä¿¡åå•ä¸­ã€‚\n```bash\nssh-keyscan -H github.com >> ~/.ssh/known_hosts\n```\nç°åœ¨ï¼Œå†æ¬¡\n```bash\nssh -T git@github.com\n```\nå›å¤ï¼š\n```\nHi xing-cg! You've successfully authenticated, but GitHub does not provide shell access.\n```\nç°åœ¨è¿˜éœ€è¦åœ¨æœ¬åœ°é…ç½®è‡ªå·±çš„user.email\n```bash\ngit config --global user.email \"myemail@xxx.com\"\n```\nç°åœ¨å°±å¯ä»¥æ­£å¸¸gitç®¡ç†repoäº†ã€‚\n# å®‰è£…npm\nmacOSé»˜è®¤æ²¡æœ‰npmã€‚\nå¯ä»¥ç”¨brewå®‰è£…node.jsã€‚\n```bash\nbrew install node\nnode --version\n```\nä¹‹åï¼Œåœ¨æœ‰`package.json`çš„ç›®å½•ä¸­ï¼Œå°±å¯ä»¥ç›´æ¥`npm install`å®‰è£…ä¾èµ–äº†ã€‚\n## hexoåšå®¢ä¾èµ–å®‰è£…\nhexoåšå®¢ç›®å½•ä¸‹åª`npm install`è¿˜ä¸å¤Ÿï¼Œè¿˜éœ€è¦å®‰è£…`hexo-cli`\n```bash\nnpm install -g hexo-cli\n```\n# è¿œç¨‹è¿æ¥äº‘æœåŠ¡å™¨\n```\nssh-keyscan -H mrcan.work >> ~/.ssh/known_hosts\n```\nä¹‹åæ‰èƒ½è¿›è¡Œè¿æ¥è¯·æ±‚ï¼š\n```\nssh root@mrcan.work\n```","categories":["ä¸€äº›å·¥å…·çš„ä½¿ç”¨"]},{"title":"Mac_ç™»å½•é¡¹ä¸æ‰©å±•é¡¹ç›®ç®¡ç†","url":"/ä¸€äº›å·¥å…·çš„ä½¿ç”¨/Mac_ç™»å½•é¡¹ä¸æ‰©å±•é¡¹ç›®ç®¡ç†/","content":"å‚è€ƒæ–‡ç« ï¼šhttps://www.cnblogs.com/Flat-White/p/18095629\n\nè®¸å¤šè½¯ä»¶å¸è½½ååœ¨â€œç™»é™†é¡¹ - å…è®¸åœ¨åå°â€ä¼šå‡ºç°æ®‹ç•™é¡¹ç›®\n\n# åˆ é™¤å¸è½½æ®‹ç•™â€œå…è®¸åœ¨åå°â€é¡¹ç›®\n\nTerminalè¿è¡Œä»¥ä¸‹å‘½ä»¤\n```bash\nsudo -- bash -c 'echo \" - $(date) -\"; while IFS= read -r eachPlist; do echo \"-$eachPlist\"; /usr/bin/defaults read \"$eachPlist\"; done <<< \"$(/usr/bin/find /Library/LaunchDaemons /Library/LaunchAgents ~/Library/LaunchAgents /private/var/root/Library/LaunchAgents /private/var/root/Library/LaunchDaemons -name \"*.plist\")\"; /usr/bin/defaults read com.apple.loginWindow LogoutHook; /usr/bin/defaults read com.apple.loginWindow LoginHook' > ~/Desktop/launch.json\n```\næŸ¥çœ‹æ¡Œé¢ç”Ÿæˆçš„JSONæ–‡ä»¶åå¯»æ‰¾éœ€è¦åˆ é™¤é¡¹ç›®\n\nå¯ä»¥é€šè¿‡`WorkingDirectory`é¡¹ç›®åˆ¤æ–­æ˜¯å¦è¯¥é¡¹ç›®ä¸ºå¸è½½æ®‹ç•™\n\nä¾‹å¦‚ä¸‹é¢é¡¹ç›®éœ€è¦åˆ é™¤\n```json\n-/Users/saber/Library/LaunchAgents/com.shoplex.pandaclearproxy.plist\n{\n    EnvironmentVariables =     {\n        \"DYLD_LIBRARY_PATH\" = \"/Applications/Plex/Contents/Frameworks/\";\n    };\n    KeepAlive = 0;\n    Label = \"com.shoplex.pandaclearproxy\";\n    ProgramArguments =     (\n        \"/Applications/Panda.app/Contents/MacOS/CloseProxy\"\n    );\n    RunAtLoad = 1;\n    WorkingDirectory = \"/Applications/Panda.app/Contents/MacOS\";\n    version = \"1.1.1\";\n}\n```\næ ¹æ®è·¯å¾„æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯åˆ é™¤\n```bash\nsudo rm -f ~/Library/LaunchAgents/com.shoplex.pandaclearproxy.plist\n```\n\n# è¯¦ç»†æ£€ç´¢â€œå…è®¸åœ¨åå°â€é¡¹ç›®\nå¦‚æœä»ç„¶æœ‰é¡¹ç›®æ— æ³•æœç´¢åˆ°ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤å¹¶ä¸”æŸ¥çœ‹ç”Ÿæˆçš„`BTM.json`\n```bash\nsfltool dumpbtm > ~/Desktop/BTM.json\n```\næŸ¥çœ‹åå‘ç°éƒ¨åˆ† â€œå…è®¸åœ¨åå°â€ é¡¹ç›®åœ¨è®¾ç½®é¢æ¿æ˜¾ç¤ºçš„æ˜¯`Developer Name`å¥å€¼\n\nä¹Ÿæœ‰éƒ¨åˆ†æ˜¾ç¤ºçš„æ˜¯`Assoc. Bundle IDs`å¥å€¼\n\nå…·ä½“æƒ…å†µå¯ä»¥è‡ªè¡Œå¯¹æ¯”ä¸Šè¿°å‘½ä»¤ç”Ÿæˆçš„`BTM.json`ä¸è®¾ç½®é¢æ¿\n\nä¾‹å¦‚ä¸‹å›¾çš„ä¸­çš„é¡¹ç›®åœ¨æŸ¥çœ‹äº†`BTM.json`åå‘ç°éƒ½æ˜¯ç›®å‰ä»ç„¶åœ¨ä½¿ç”¨çš„åº”ç”¨ç¨‹åº\n\nå¦‚ï¼š\n![](../../images/Mac_ç™»å½•é¡¹ä¸æ‰©å±•é¡¹ç›®ç®¡ç†/image-20250813234907743.png)\n\n\nwon fenæ˜¯Clash Vergeçš„å¼€å‘è€…\nzhou huabingæ˜¯RustDeskçš„å¼€å‘è€…\n![](../../images/Mac_ç™»å½•é¡¹ä¸æ‰©å±•é¡¹ç›®ç®¡ç†/image-20250813235002948.png)\n\nMicrosoft Corporationæ˜¯Remote Desktopç›¸å…³çš„æœåŠ¡\n\nå› æ­¤ä¸å»ºè®®åˆ é™¤\n\nå¦‚æœéœ€è¦åˆ é™¤\n\nä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¡Œ\n```bash\nsudo find /Library/LaunchDaemons /Library/LaunchAgents ~/Library/LaunchAgents -name \"com.west2online.ClashXPro\" -type f -delete\n```\n\n`com.west2online.ClashXPro`å¯ä»¥æ›¿æ¢ä¸ºå…¶ä»–éœ€è¦åˆ é™¤çš„`Assoc. Bundle IDs`å¯¹åº”å¥å€¼","categories":["ä¸€äº›å·¥å…·çš„ä½¿ç”¨"]},{"title":"tar_å¸¸ç”¨å‘½ä»¤","url":"/ä¸€äº›å·¥å…·çš„ä½¿ç”¨/tar_å¸¸ç”¨å‘½ä»¤/","content":"\n```sh\ntar -czvf xxx.tar.gz source_file (tar -czvf åŒ…å.tar.gz æºæ–‡ä»¶) #ä»¥tar.gzæ–¹å¼æ‰“åŒ…å¹¶gzæ–¹å¼å‹ç¼©\ntar -xzvf xxx.tar.gz -C path     (tar -xzvf xxx.tar.gz -C ç›®æ ‡è·¯å¾„) #è§£å‹ç¼©åŒ…\n```\n","categories":["ä¸€äº›å·¥å…·çš„ä½¿ç”¨"]},{"title":"æ€è™«çŸ¥è¯†_è›¾è “","url":"/ç”Ÿæ´»/æ€è™«çŸ¥è¯†_è›¾è “/","content":"\n# æ€è›¾è “å’Œå°é£è™«æœ€å¥½ç”¨ä»€ä¹ˆæˆåˆ†ï¼Ÿ\n\næ¶ˆç­è›¾è “å’Œå°é£è™«ï¼Œæœ€æœ‰æ•ˆä¸”ç›¸å¯¹å®‰å…¨çš„æˆåˆ†é€šå¸¸æ˜¯â€‹**â€‹æ‹Ÿé™¤è™«èŠé…¯ç±»æ€è™«å‰‚â€‹**â€‹ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†åˆ†æå’Œæ¨èï¼š\n\n## ğŸ§ª 1. æœ€æ¨èçš„æ ¸å¿ƒæˆåˆ†ï¼šæ‹Ÿé™¤è™«èŠé…¯ç±»\n\n- â€‹**â€‹å¸¸è§æœ‰æ•ˆæˆåˆ†ï¼šâ€‹**â€‹ æ°¯èŠé…¯ã€èƒºèŠé…¯ã€æ°¯æ°°èŠé…¯ã€æº´æ°°èŠé…¯ã€é«˜æ•ˆæ°¯æ°Ÿæ°°èŠé…¯ç­‰ã€‚\n- â€‹**â€‹ä¼˜ç‚¹ï¼šâ€‹**â€‹\n    - â€‹**â€‹é«˜æ•ˆå¹¿è°±ï¼šâ€‹**â€‹ å¯¹è›¾è “ã€å°é£è™«ï¼ˆæœè‡ã€èš¤è‡ç­‰ï¼‰ã€èšŠå­ã€è‹è‡ç­‰å¤šç§é£è¡Œå’Œçˆ¬è¡Œæ˜†è™«éƒ½æœ‰å¾ˆå¥½çš„è§¦æ€å’Œå‡»å€’æ•ˆæœã€‚\n    - â€‹**â€‹ä½æ¯’ï¼ˆç›¸å¯¹ï¼‰ï¼šâ€‹**â€‹ ç›¸è¾ƒäºæœ‰æœºç£·ç±»ç­‰è€å¼æ€è™«å‰‚ï¼ŒèŠé…¯ç±»å¯¹å“ºä¹³åŠ¨ç‰©çš„æ¯’æ€§è¾ƒä½ï¼Œåœ¨æ­£ç¡®ä½¿ç”¨ä¸‹ç›¸å¯¹å®‰å…¨ã€‚\n    - â€‹**â€‹ä½œç”¨è¿…é€Ÿï¼šâ€‹**â€‹ æ¥è§¦åèƒ½å¿«é€Ÿå‡»å€’å®³è™«ã€‚\n    - â€‹**â€‹æœ‰ä¸€å®šæ»ç•™æ€§ï¼šâ€‹**â€‹ å–·æ´’åœ¨è¡¨é¢åèƒ½ç»´æŒä¸€æ®µæ—¶é—´çš„è¯æ•ˆï¼Œèµ·åˆ°é¢„é˜²ä½œç”¨ã€‚\n- â€‹**â€‹äº§å“å½¢å¼ï¼šâ€‹**â€‹\n    - â€‹**â€‹æ°”é›¾æ€è™«å‰‚ï¼šâ€‹**â€‹ è¶…å¸‚å¸¸è§çš„ç½è£…å–·é›¾ï¼Œé€šå¸¸å«æœ‰å¤šç§èŠé…¯å¤é…ï¼ˆå¦‚èƒºèŠé…¯+æ°¯èŠé…¯ï¼‰ï¼Œå¹¶é…æœ‰æ¨è¿›å‰‚ï¼Œèƒ½å¿«é€Ÿæ€ç­ç©ºä¸­é£è™«ã€‚è¿™æ˜¯å¯¹ä»˜æˆè™«æœ€ç›´æ¥å¿«é€Ÿçš„æ–¹æ³•ã€‚\n    - â€‹**â€‹æ»ç•™å–·æ´’å‰‚/æµ“ç¼©æ¶²ï¼šâ€‹**â€‹ éœ€è¦ç”¨æ°´ç¨€é‡Šåç”¨å–·å£¶å–·æ´’åœ¨å¢™é¢ã€è§’è½ã€ç¼éš™ã€åƒåœ¾æ¡¶å‘¨å›´ã€ä¸‹æ°´é“å£ç­‰å®³è™«æ –æ¯å’Œæ´»åŠ¨åŒºåŸŸã€‚è¯æ¶²å¹²åä¼šå½¢æˆä¸€å±‚è¯è†œï¼Œå®³è™«æ¥è§¦åä¸­æ¯’æ­»äº¡ï¼Œè¯æ•ˆå¯æŒç»­æ•°å‘¨ã€‚è¿™æ˜¯é•¿æ•ˆé˜²æ²»çš„å…³é”®ã€‚\n    - â€‹**â€‹èšŠé¦™/ç”µçƒ­èšŠé¦™æ¶²ï¼šâ€‹**â€‹ ä¸»è¦æˆåˆ†ä¹Ÿæ˜¯èŠé…¯ç±»ï¼ˆå¦‚æ°¯æ°Ÿé†šèŠé…¯ï¼‰ï¼Œå¯¹å®¤å†…é£è™«æœ‰ä¸€å®šé©±é¿å’Œæ€ç­ä½œç”¨ï¼Œä½†æ•ˆæœä¸å¦‚ç›´æ¥å–·æ´’ã€‚\n\n## ğŸ¦  2. é’ˆå¯¹å¹¼è™«ï¼ˆæºå¤´æ²»ç†ï¼‰ï¼šç”Ÿç‰©åˆ¶å‰‚\n\n- â€‹**â€‹æœ‰æ•ˆæˆåˆ†ï¼šâ€‹**â€‹ â€‹**â€‹è‹äº‘é‡‘æ†èŒä»¥è‰²åˆ—äºšç§â€‹**â€‹ã€‚\n- â€‹**â€‹ä¼˜ç‚¹ï¼šâ€‹**â€‹\n    - â€‹**â€‹é«˜åº¦ç‰¹å¼‚ï¼šâ€‹**â€‹ åªå¯¹èšŠã€è “ã€èš‹ç­‰åŒç¿…ç›®æ˜†è™«çš„å¹¼è™«æœ‰æ•ˆï¼Œå¯¹é±¼è™¾ã€äººç•œã€ç›Šè™«åŸºæœ¬æ— å®³ï¼Œéå¸¸ç¯ä¿å®‰å…¨ã€‚\n    - â€‹**â€‹æºå¤´æ§åˆ¶ï¼šâ€‹**â€‹ ç›´æ¥æ€ç­åœ¨ç§¯æ°´ï¼ˆå¦‚åœ°æ¼ã€ä¸‹æ°´é“ã€èŠ±ç›†æ‰˜ç›˜ã€ç©ºè°ƒç§¯æ°´ç›˜ï¼‰ä¸­å­³ç”Ÿçš„å¹¼è™«ï¼Œä»æ ¹æºä¸Šå‡å°‘æˆè™«æ•°é‡ã€‚\n- â€‹**â€‹äº§å“å½¢å¼ï¼šâ€‹**â€‹\n    - â€‹**â€‹BTIé¢—ç²’å‰‚/ç‰‡å‰‚ï¼šâ€‹**â€‹ æŠ•å…¥ç§¯æ°´å¤„ï¼ˆå¦‚åœ°æ¼å­˜æ°´å¼¯ã€ä¸‹æ°´é“å£ã€èŠ±ç›†åº•æ‰˜ç­‰ï¼‰ï¼Œç¼“æ…¢é‡Šæ”¾æœ‰æ•ˆæˆåˆ†ï¼ŒæŒç»­æ€ç­å¹¼è™«æ•°å‘¨ã€‚\n\n## ğŸš« 3. å…¶ä»–æˆåˆ†ï¼ˆéœ€è°¨æ…ä½¿ç”¨æˆ–ä¸æ¨èï¼‰\n\n- â€‹**â€‹æœ‰æœºç£·ç±»ï¼šâ€‹**â€‹ å¦‚æ•Œæ•Œç•ã€æ¯’æ­»èœ±ç­‰ã€‚è™½ç„¶æœ‰æ•ˆï¼Œä½†æ¯’æ€§è¾ƒé«˜ï¼Œæ®‹ç•™æœŸé•¿ï¼Œå¯¹äººå’Œå® ç‰©é£é™©è¾ƒå¤§ï¼Œâ€‹**â€‹å¼ºçƒˆä¸æ¨èâ€‹**â€‹åœ¨å®¶åº­å®¤å†…ç¯å¢ƒä½¿ç”¨ã€‚\n- â€‹**â€‹æ°¨åŸºç”²é…¸é…¯ç±»ï¼šâ€‹**â€‹ å¦‚æ®‹æ€å¨ç­‰ã€‚æ•ˆæœä¹Ÿä¸é”™ï¼Œä½†æ¯’æ€§ä¹Ÿç›¸å¯¹è¾ƒé«˜ï¼Œå®¶ç”¨äº§å“ä¸­ä¸å¦‚èŠé…¯ç±»å¸¸è§å’Œå®‰å…¨ã€‚\n- â€‹**â€‹å¡è™«å•‰ç­‰æ–°çƒŸç¢±ç±»ï¼šâ€‹**â€‹ å¯¹èšœè™«ã€ç²‰è™±ç­‰åˆºå¸å¼å£å™¨å®³è™«æ•ˆæœæ˜¾è‘—ï¼Œä½†å¯¹è›¾è “ã€å°é£è™«ç­‰æ•ˆæœé€šå¸¸ä¸å¦‚èŠé…¯ç±»ç›´æ¥ã€‚\n\n## ğŸ“Œ æ€»ç»“ä¸å»ºè®®\n\n1. â€‹**â€‹å¯¹ä»˜æˆè™«ï¼ˆç©ºä¸­é£è™«ï¼‰ï¼šâ€‹**â€‹\n    - â€‹**â€‹é¦–é€‰ï¼šâ€‹**â€‹ å«æœ‰â€‹**â€‹æ°¯èŠé…¯ã€èƒºèŠé…¯ã€æ°¯æ°°èŠé…¯â€‹**â€‹ç­‰æˆåˆ†çš„â€‹**â€‹æ°”é›¾æ€è™«å‰‚â€‹**â€‹ã€‚å¯¹å‡†é£è™«ç›´æ¥å–·å°„ã€‚\n    - â€‹**â€‹é•¿æ•ˆé¢„é˜²ï¼šâ€‹**â€‹ ä½¿ç”¨â€‹**â€‹èŠé…¯ç±»æµ“ç¼©æ¶²â€‹**â€‹è¿›è¡Œâ€‹**â€‹æ»ç•™å–·æ´’â€‹**â€‹ï¼Œé‡ç‚¹å¤„ç†å«ç”Ÿé—´ã€å¨æˆ¿ã€åƒåœ¾æ¡¶å‘¨å›´ã€çª—æ¡†ã€å¢™è§’ã€ä¸‹æ°´é“å£ç­‰åŒºåŸŸã€‚\n2. â€‹**â€‹å¯¹ä»˜å¹¼è™«ï¼ˆæºå¤´æ§åˆ¶ï¼‰ï¼šâ€‹**â€‹\n    - â€‹**â€‹æœ€å®‰å…¨æœ‰æ•ˆï¼šâ€‹**â€‹ ä½¿ç”¨â€‹**â€‹è‹äº‘é‡‘æ†èŒä»¥è‰²åˆ—äºšç§â€‹**â€‹åˆ¶æˆçš„â€‹**â€‹é¢—ç²’å‰‚æˆ–ç‰‡å‰‚â€‹**â€‹ï¼Œå®šæœŸæŠ•æ”¾äºåœ°æ¼ã€ä¸‹æ°´é“ã€èŠ±ç›†åº•æ‰˜ç­‰æ‰€æœ‰å¯èƒ½çš„ç§¯æ°´å¤„ã€‚è¿™æ˜¯æ²»æœ¬çš„å…³é”®â—ï¸\n3. â€‹**â€‹ç¯å¢ƒæ²»ç†è‡³å…³é‡è¦ï¼šâ€‹**â€‹\n    - â€‹**â€‹æ¸…é™¤å­³ç”Ÿåœ°ï¼šâ€‹**â€‹ è¿™æ˜¯æœ€æ ¹æœ¬çš„æ–¹æ³•ï¼ä¿æŒç¯å¢ƒå¹²ç‡¥ï¼Œæ¸…é™¤æ‰€æœ‰ä¸å¿…è¦çš„ç§¯æ°´ï¼ˆèŠ±ç›†æ‰˜ç›˜ã€åºŸå¼ƒå®¹å™¨ã€å µå¡çš„æ’æ°´æ²Ÿã€ç©ºè°ƒå†·å‡æ°´ç›˜ç­‰ï¼‰ã€‚\n    - â€‹**â€‹æ¸…æ´å«ç”Ÿï¼šâ€‹**â€‹ åŠæ—¶æ¸…ç†å¨ä½™åƒåœ¾ã€è…çƒ‚æ°´æœğŸï¼Œä¿æŒåƒåœ¾æ¡¶æ¸…æ´å¹¶ç›–å¥½ç›–å­ã€‚æ¸…æ´å«ç”Ÿé—´ã€å¨æˆ¿çš„æ±¡å¢å’Œæ°´æ¸ï¼Œç‰¹åˆ«æ˜¯åœ°æ¼å‘¨å›´ã€‚\n    - â€‹**â€‹æ£€æŸ¥åœ°æ¼å’Œä¸‹æ°´é“ï¼šâ€‹**â€‹ ç¡®ä¿åœ°æ¼æœ‰å­˜æ°´å¼¯ä¸”æ°´ä¸å¹²æ¶¸ï¼Œå®šæœŸç”¨çƒ­æ°´æˆ–æ¶ˆæ¯’æ¶²å†²æ´—ä¸‹æ°´é“ã€‚\n    - â€‹**â€‹ç‰©ç†æ–¹æ³•ï¼šâ€‹**â€‹ å®‰è£…çº±çª—çº±é—¨ï¼Œä½¿ç”¨ç”µèšŠæ‹ã€ç²˜è™«çº¸ä½œä¸ºè¾…åŠ©ã€‚\n\n## ğŸ“Œ é‡è¦æç¤º\n\n- â€‹**â€‹å®‰å…¨ç¬¬ä¸€ï¼šâ€‹**â€‹ ä½¿ç”¨ä»»ä½•åŒ–å­¦æ€è™«å‰‚æ—¶ï¼ŒåŠ¡å¿…ä»”ç»†é˜…è¯»å¹¶éµå¾ªäº§å“æ ‡ç­¾è¯´æ˜ã€‚æ³¨æ„é€šé£ï¼Œé¿å…å¸å…¥ï¼Œå–·æ´’æ—¶é¿å¼€é£Ÿç‰©ã€é¤å…·ã€å® ç‰©å’Œå„¿ç«¥ã€‚å–·æ´’åç¦»å¼€æˆ¿é—´ä¸€æ®µæ—¶é—´å†è¿›å…¥ã€‚\n- â€‹**â€‹ç»¼åˆæ²»ç†ï¼šâ€‹**â€‹ å•ä¸€æ–¹æ³•æ•ˆæœæœ‰é™ã€‚â€‹**â€‹æºå¤´æ²»ç†ï¼ˆæ¸…é™¤ç§¯æ°´+BTIæ€å¹¼è™«ï¼‰+ ç¯å¢ƒæ¸…æ´ + æˆè™«æ€ç­ï¼ˆèŠé…¯å–·é›¾/æ»ç•™å–·æ´’ï¼‰â€‹**â€‹ æ‰æ˜¯æœ€æœ‰æ•ˆçš„ç»„åˆæ‹³ã€‚\n- â€‹**â€‹è¯†åˆ«è™«ç§ï¼šâ€‹**â€‹ ç¡®è®¤æ˜¯è›¾è “è¿˜æ˜¯å…¶ä»–å°é£è™«ï¼ˆå¦‚æœè‡ï¼‰ï¼Œå› ä¸ºå®ƒä»¬çš„å­³ç”Ÿç¯å¢ƒç•¥æœ‰ä¸åŒï¼Œä½†ä¸Šè¿°æ–¹æ³•åŸºæœ¬é€šç”¨ã€‚\n\nâ€‹**â€‹ç»¼ä¸Šæ‰€è¿°ï¼Œæ‹Ÿé™¤è™«èŠé…¯ç±»æ€è™«å‰‚ï¼ˆå¦‚æ°¯èŠé…¯ï¼‰æ˜¯æ€ç­è›¾è “å’Œå°é£è™«æˆè™«çš„æœ€ä½³é€‰æ‹©ï¼Œè€Œè‹äº‘é‡‘æ†èŒæ˜¯æ¶ˆç­å…¶å¹¼è™«æœ€å®‰å…¨æœ‰æ•ˆçš„ç”Ÿç‰©æ­¦å™¨ã€‚â€‹**â€‹ é…åˆå½»åº•çš„ç¯å¢ƒæ²»ç†ï¼Œæ‰èƒ½æœ‰æ•ˆæ§åˆ¶è¿™äº›æ¼äººçš„å°é£è™«ã€‚\n\n# è›¾è “çš„ç¾½åŒ–åŸç†\nå•æ‰€é‡Œä¸Šä¸€ä¸ªå°æ—¶è¿˜æ²¡æœ‰å°é£è™«ï¼Œéš”ä¸€ä¼šå„¿è¿›å»çªç„¶å°±å‡ºç°äº†3åˆ°5åªå°é£è™«ï¼Œæ¯è¿›å»ä¸€æ¬¡æˆ‘éƒ½æ€æ­»3ã€4ä¸ªï¼Œä½†æ˜¯æ¯æ¬¡è¿›å»å±…ç„¶éƒ½ä¼šæœ‰æ–°çš„ï¼Œæ´—æ‰‹æ± çš„ä¸‹æ°´é“å£æˆ‘ç”¨èµ·æ³¡èƒ¶å°ä½äº†ï¼Œåœ°æ¼æœ‰ç›–å­ï¼Œæ’é£æ‰‡æˆ‘ä¸çŸ¥é“ä¼šä¸ä¼šå› ä¸ºå‘å¤–é€šé£çš„åŸå› ä¼šä»è¿™é‡Œé£è¿›æ¥ã€‚åˆ°åº•æ˜¯å› ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ\n\nè¯´æ˜é£è™«çš„â€‹**â€‹å­³ç”Ÿæºå°±åœ¨å•æ‰€å†…éƒ¨æˆ–æå…¶è¿‘çš„åœ°æ–¹â€‹**â€‹ï¼è™½ç„¶ä½ å°ä½äº†æ´—æ‰‹æ± ä¸‹æ°´é“å£ã€ç›–äº†åœ°æ¼ç›–ï¼Œä½†è™«åµæˆ–å¹¼è™«å¾ˆå¯èƒ½éšè—åœ¨ä½ å¿½ç•¥çš„â€‹**â€‹æ›´éšè”½ã€æ›´æ½®æ¹¿çš„è§’è½æˆ–ç¼éš™é‡Œâ€‹**â€‹ã€‚\n\n## ğŸ” é£è™«çˆ†å‘æ€§å‡ºç°çš„åŸå› åˆ†æ\n\n1. â€‹**â€‹å­³ç”Ÿç‚¹æœªè¢«å½»åº•æ¸…é™¤ï¼ˆæœ€å¯èƒ½ï¼ï¼‰ï¼šâ€‹**â€‹\n    \n    - â€‹**â€‹åœ°æ¼éšæ‚£æœ€å¤§ï¼â€‹**â€‹ å³ä½¿æœ‰ç›–å­ï¼Œé—®é¢˜å¯èƒ½å‡ºåœ¨ï¼š\n        - â€‹**â€‹ç›–å­çš„å¯†å°æ€§ï¼šâ€‹**â€‹ ç›–å­è¾¹ç¼˜æ˜¯å¦å˜å½¢ã€æœ‰ç¼éš™ï¼Ÿè™«å­ï¼ˆå°¤å…¶æ˜¯è›¾è “å¹¼è™«/è›¹ï¼‰å¯èƒ½å°±ä»è¿™é‡Œçˆ¬å‡ºæ¥ç¾½åŒ–ã€‚â€‹**â€‹ç”¨åŠ›æŒ‰å‹ç›–å­ï¼Œæ£€æŸ¥å››å‘¨æ˜¯å¦æœ‰æ˜æ˜¾ç¼éš™ã€‚â€‹**â€‹\n        - â€‹**â€‹åœ°æ¼å†…éƒ¨å­˜æ°´å¼¯å¤±æ•ˆ/å¹²ç‡¥ï¼šâ€‹**â€‹ å­˜æ°´å¼¯å¹²æ¶¸æˆ–è®¾è®¡ä¸ä½³ï¼ˆæœ‰äº›åŠ£è´¨åœ°æ¼å­˜æ°´å¼¯å¾ˆæµ…ï¼‰ï¼Œæ— æ³•é˜»éš”ä¸‹æ°´é“é‡Œçš„è™«å­æˆ–æ°”å‘³ï¼ˆå¸å¼•è™«å­ï¼‰ã€‚â€‹**â€‹å¾€åœ°æ¼é‡Œç¼“ç¼“å€’ä¸€æ¯æ°´ï¼Œå¬å¬æ˜¯å¦æœ‰â€œå’•å’šâ€å£°ï¼ˆè¡¨ç¤ºæ°´è¿›å…¥å­˜æ°´å¼¯ï¼‰ï¼Œè§‚å¯Ÿæ°´æµä¸‹å¾—å¿«ä¸å¿«ï¼ˆå¦‚æœç«‹å³æ¶ˆå¤±ï¼Œå¯èƒ½å­˜æ°´å¼¯æµ…æˆ–æ°´å°å¤±æ•ˆï¼‰ã€‚â€‹**â€‹\n        - â€‹**â€‹åœ°æ¼å†…å£ç§¯ç´¯æ±¡å¢ï¼šâ€‹**â€‹ ç›–å­ä¸‹é¢ã€åœ°æ¼ç¯¦å­ä¸‹ã€å­˜æ°´å¼¯å†…å£ç§¯ç´¯åšåšçš„ç²˜æ»‘æœ‰æœºæ±¡å¢ï¼ˆè‚¥çš‚å¢ã€æ¯›å‘ã€çš®å±‘ç­‰ï¼‰ï¼Œè¿™æ˜¯è›¾è “å¹¼è™«çš„å®Œç¾é£Ÿç‰©æ¥æºå’Œè—èº«å¤„ï¼â€‹**â€‹ç”¨ç­·å­è£¹ä¸Šå¸ƒæˆ–æ£‰ç­¾ä¼¸è¿›å»æ“¦æ‹­å†…å£æ„Ÿå—æ˜¯å¦æœ‰æ»‘è…»æ„Ÿã€‚â€‹**â€‹\n    - â€‹**â€‹æ´—æ‰‹æ± å°å µå¯èƒ½ä¸å½»åº•ï¼šâ€‹**â€‹\n        - â€‹**â€‹èµ·æ³¡èƒ¶çš„æ¸—é€æ€§/æŒä¹…æ€§ï¼šâ€‹**â€‹ èµ·æ³¡èƒ¶æœ¬èº«æ˜¯å¦æœ‰å¾®å°ç¼éš™ï¼Ÿæ˜¯å¦è¢«æ°´æµæˆ–æ¹¿æ°”è½¯åŒ–ã€è„±è½äº†éƒ¨åˆ†ï¼Ÿè™«å­å¯èƒ½æ‰¾åˆ°è–„å¼±ç‚¹é’»å‡ºã€‚â€‹**â€‹ç”¨æ‰‹ç”µç­’ä»”ç»†ç…§å°„èµ·æ³¡èƒ¶è¾¹ç¼˜å’Œè¡¨é¢ï¼Œçœ‹æ˜¯å¦æœ‰å°å­”æˆ–è£‚çº¹ã€‚â€‹**â€‹\n        - â€‹**â€‹æ´—æ‰‹æ± ä¸‹æ–¹ç®¡é“ï¼šâ€‹**â€‹ æ´—æ‰‹ç›†ä¸‹æ–¹çš„æ°´ç®¡è¿æ¥å¤„ï¼ˆè½¯ç®¡æ¥å¤´ã€Uå‹å¼¯å¤´èƒŒé¢ï¼‰æ˜¯å¦é˜´æš—æ½®æ¹¿æˆ–æœ‰æ¸—æ¼ï¼Ÿè¿™é‡Œä¹Ÿæ˜¯å­³ç”Ÿåœ°ã€‚â€‹**â€‹å¼¯è…°æ£€æŸ¥æ´—æ‰‹ç›†ä¸‹æ–¹çš„æ©±æŸœé‡Œï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œç”¨æ‰‹ç”µç…§è§’è½ã€çœ‹ç®¡å£æ˜¯å¦æœ‰æ°´æ¸ã€éœ‰æ–‘ã€‚â€‹**â€‹\n    - â€‹**â€‹å…¶ä»–è¢«å¿½ç•¥çš„å­³ç”Ÿç‚¹ï¼ˆå¸¸è¢«å¿½è§†ï¼ï¼‰ï¼šâ€‹**â€‹\n        - â€‹**â€‹æ‹–æŠŠ/æ‰«å¸š/æŠ¹å¸ƒï¼šâ€‹**â€‹ æ²¾æ»¡æ±¡æ°´ã€æ½®æ¹¿çš„æ‹–æŠŠã€æ‰«å¸šã€æŠ¹å¸ƒï¼ˆå°¤å…¶æ”¾åœ¨å•æ‰€è§’è½é‡Œæˆ–æ¡¶é‡Œæ³¡ç€ï¼‰æ˜¯äº§åµå’Œå­³ç”Ÿçš„ç»ä½³åœºæ‰€ï¼â€‹**â€‹é—»é—»æ‹–æŠŠæ˜¯å¦æœ‰é¦Šå‘³éœ‰å‘³ã€‚â€‹**â€‹\n        - â€‹**â€‹åƒåœ¾æ¡¶ï¼šâ€‹**â€‹ å³ä½¿æœ‰ç›–ï¼Œå†…å£ã€ç›–å­ç¼éš™ä¹Ÿå¯èƒ½æ®‹ç•™æ¹¿åƒåœ¾æ¶²ã€æ±¡å¢ï¼Œå¸å¼•äº§åµã€‚â€‹**â€‹æ“¦ä¸€ä¸‹åƒåœ¾æ¡¶å†…å£æ˜¯å¦æœ‰é»æ¶²æ„Ÿã€‚â€‹**â€‹\n        - â€‹**â€‹æ½®æ¹¿å¢™é¢/å¢™è§’/ç“·ç –ç¼éš™ï¼šâ€‹**â€‹ å•æ‰€é•¿æœŸæ½®æ¹¿å¯¼è‡´è¿™äº›åœ°æ–¹é•¿éœ‰ã€ç§¯ç´¯æœ‰æœºè´¨ï¼Œä¹Ÿå¯èƒ½æˆä¸ºé£Ÿç‰©æºã€‚â€‹**â€‹ä»”ç»†çœ‹å¢™é¢ç“·ç –ç¼æ˜¯å¦å‘é»‘ï¼Ÿâ€‹**â€‹\n        - â€‹**â€‹é©¬æ¡¶å‘¨å›´/åº•åº§åæ–¹ç¼éš™ï¼šâ€‹**â€‹ é©¬æ¡¶åº•åº§ä¸åœ°ç –ä¹‹é—´çš„ç»ç’ƒèƒ¶å¯†å°å¤„è€åŒ–å‘é»‘ï¼Œæ»‹ç”Ÿéœ‰èŒï¼Œæˆ–è€…åæ–¹éšè”½å¤„æœ‰æ®‹ç•™æ±¡æ¸ã€‚â€‹**â€‹ç”¨é•œå­åå°„è§‚å¯Ÿé©¬æ¡¶èƒŒåã€‚â€‹**â€‹\n        - â€‹**â€‹æ’é£æ‰‡å†…éƒ¨/ç®¡é“ï¼šâ€‹**â€‹ æ’é£æ‰‡çš„é£å¶ã€ç®¡é“æ¥å£å¤„ç§¯ç´¯ç°å°˜ï¼Œå¦‚æœç®¡é“æœ‰ç ´æŸæˆ–å€’çŒï¼Œå¯èƒ½å¼•å…¥æˆ–æ»‹ç”Ÿè™«å­ï¼ˆä½†æ›´å¯èƒ½æ˜¯å†…éƒ¨å­³ç”Ÿæºå¤´ç¾½åŒ–åé£è¿‘æ’é£æ‰‡ï¼‰ã€‚\n2. â€‹**â€‹å¤–éƒ¨è¿å…¥ï¼ˆå¯èƒ½æ€§è¾ƒå°ä½†éœ€æ’æŸ¥ï¼‰ï¼šâ€‹**â€‹\n    \n    - â€‹**â€‹æ’é£æ‰‡å€’çŒï¼šâ€‹**â€‹ è™½ç„¶æ’é£æ‰‡æ˜¯å‘å¤–æ’é£ï¼Œä½†å¦‚æœå…¶å†…éƒ¨æˆ–è¿æ¥ç®¡é“çš„å¯†å°ä¸å¥½ï¼Œåœ¨å…³é—­çŠ¶æ€ä¸‹ï¼Œæ°”å‹ã€é£å‘å˜åŒ–ã€æˆ–é‚»å±…å®¶ä¹Ÿåœ¨ä½¿ç”¨æ’é£æ‰‡æ—¶ï¼Œå¯èƒ½å‡ºç°çŸ­æš‚çš„å€’å¸ç°è±¡ï¼Œå°†é™„è¿‘ç®¡é“æˆ–å…¶ä»–åŒºåŸŸçš„è™«å­æˆ–æ°”å‘³å¸å…¥ã€‚â€‹**â€‹å°è¯•åœ¨ä¸‹æ¬¡è¿›å…¥å•æ‰€å‰1å°æ—¶æ‰“å¼€æ’é£æ‰‡å¼ºåŠ›æ’é£30åˆ†é’Ÿï¼Œå†å…³é—­è¿›å»çœ‹çœ‹æ˜¯å¦æœ‰æ”¹å–„ï¼ˆå¦‚æœæ˜¯å€’çŒï¼Œå¼ºåŠ›æ’é£èƒ½å‡å°‘å…¥å£é™„è¿‘çš„è™«å­ï¼‰ã€‚â€‹**â€‹\n3. â€‹**â€‹æˆè™«ç¾½åŒ–&ç¹æ®–é€Ÿåº¦ï¼šâ€‹**â€‹\n    \n    - è›¾è “ä»åµåˆ°æˆè™«åªéœ€1-3å‘¨ã€‚éšè”½å­³ç”Ÿç‚¹ä¸­çš„è›¹æºæºä¸æ–­åœ°ç¾½åŒ–æˆè™«ï¼Œå³ä½¿ä½ æ¯æ¬¡è¿›å»éƒ½æ€æ­»å‡ åªæˆè™«ï¼Œâ€‹**â€‹æºå¤´æœªæ–­ï¼Œæ–°çš„è›¹åˆæºæºä¸æ–­å­µåŒ–å‡ºæ¥â€‹**â€‹ï¼Œå½¢æˆâ€œæ€ä¹‹ä¸å°½â€çš„å±€é¢ã€‚\n## ğŸ“Œ å…³é”®æ€»ç»“\n\n- â€‹**â€‹é—®é¢˜æ ¸å¿ƒï¼šâ€‹**â€‹ å•æ‰€é‡Œå¿…ç„¶å­˜åœ¨ä¸€ä¸ªè¢«é—æ¼çš„ã€æ½®æ¹¿å¯Œå«æœ‰æœºè´¨çš„â€‹**â€‹éšè”½å­³ç”Ÿç‚¹â€‹**â€‹ï¼ˆâ€‹**â€‹åœ°æ¼å†…éƒ¨â€‹**â€‹å«Œç–‘æœ€å¤§ï¼Œå…¶æ¬¡æ˜¯æ‹–æŠŠ/å¢™è§’éœ‰èŒ/æ´—æ‰‹æ± ä¸‹ï¼‰ã€‚\n- â€‹**â€‹æ²»æ ‡æ— æ•ˆï¼šâ€‹**â€‹ å…‰æ€æˆè™«ä¸è§£å†³æºå¤´æ˜¯å¾’åŠ³çš„ã€‚\n- â€‹**â€‹æ²»æœ¬æ ¸å¿ƒï¼šâ€‹**â€‹ â€‹**â€‹å½»åº•æ·±åº¦æ¸…æ´æ‰€æœ‰å¯èƒ½çš„ç§¯æ±¡æ½®æ¹¿ç‚¹ï¼ˆå°¤å…¶æ˜¯åœ°æ¼å†…éƒ¨ï¼ŒåŠ¡å¿…æ¸…ç†å¹²å‡€+æ¢å¤æ°´å°ï¼ï¼‰ï¼Œä¿è¯ç¯å¢ƒå«ç”Ÿå¹²ç‡¥ï¼â€‹**â€‹\n- â€‹**â€‹èŠé…¯ç±»æ€è™«å‰‚â€‹**â€‹æ˜¯å¿«é€Ÿé«˜æ•ˆæ€ç­æˆè™«çš„å¥½å·¥å…·ï¼ˆåŠ¡å¿…æŒ‰è¯´æ˜å®‰å…¨ä½¿ç”¨ï¼‰ã€‚\n- å¯¹æ’é£æ‰‡è¿›è¡Œç®€å•éªŒè¯è¯•éªŒï¼ˆç½©çº±ç½‘ï¼‰èƒ½å¿«é€Ÿæ’é™¤æˆ–ç¡®è®¤å…¶å½±å“ã€‚\n\nâ€‹**â€‹ç«‹å³æ‰§è¡Œåœ°æ¼æ·±åº¦æ¸…æ´è®¡åˆ’ï¼â€‹**â€‹ æŠŠåœ°æ¼å½“æˆé‡ç‚¹å«Œç–‘äººæ·±æŒ–å½»æŸ¥ï¼ŒåŒæ—¶æ¸…ç†æ‰€æœ‰æ½®æ¹¿è§’è½ï¼Œé…åˆå–·æ€æˆè™«ï¼ŒåšæŒå‡ å¤©ï¼Œæºå¤´æ–­æ‰åä½ ä¼šå‘ç°é£è™«æ•°é‡éª¤å‡ç›´è‡³æ¶ˆå¤±ï¼ğŸ’ªğŸ»\n\n## ä¸ºä»€ä¹ˆçªç„¶å°±æœ‰æˆè™«äº†å‘¢ï¼Ÿæˆ‘å¹³æ—¶ä¹Ÿçœ‹ä¸åˆ°ä»–ä»¬çš„åµå•Šï¼Œæ€ä¹ˆçªç„¶è¿™ä¹ˆå¿«çš„é•¿å¤§çš„å‘¢ï¼Ÿ\n â€œâ€‹**çªç„¶å‡ºç°â€ã€â€œæ•°é‡ä¸å¤§ä½†æŒç»­ä¸æ–­â€â€‹**â€‹ çš„æˆè™«ç°è±¡ï¼Œæ­£æ˜¯è›¾è “ï¼ˆæˆ–ç±»ä¼¼å°é£è™«ï¼‰â€‹**â€‹ç‹¬ç‰¹ç”Ÿæ´»å²å’Œå­³ç”Ÿç‰¹ç‚¹â€‹**â€‹çš„å…¸å‹è¡¨ç°ï¼ä¸ºä»€ä¹ˆçœ‹ä¸è§åµã€ä¹Ÿçœ‹ä¸åˆ°å¹¼è™«ï¼Ÿä¸ºä»€ä¹ˆæ„Ÿè§‰å®ƒä»¬â€œçªç„¶é•¿å¤§â€ï¼Ÿä¸»è¦åŸå› å¦‚ä¸‹ï¼š\n\nğŸ§© â€‹**â€‹æ ¸å¿ƒè§£é‡Šï¼šéšç§˜å­³ç”Ÿ + åŒæ­¥ç¾½åŒ– + é—´æ–­è¡¥å……â€‹**â€‹\n1. â€‹**â€‹åµå’Œå¹¼è™«è—åœ¨æ‚¨çœ‹ä¸åˆ°çš„â€œå¾®è§‚æ¹¿åœ°â€é‡Œï¼šâ€‹**â€‹\n    - â€‹**â€‹å­³ç”Ÿç‚¹æéšè”½ä¸”å¾®å°ï¼šâ€‹**â€‹ é£è™«ï¼ˆå°¤å…¶è›¾è “ï¼‰çš„åµå’Œå¹¼è™«â€‹**â€‹ä¸éœ€è¦å¤§ç‰‡æ°´åŸŸâ€‹**â€‹ï¼å®ƒä»¬åªéœ€è¦ â€‹**â€‹ä¸€å±‚æ¹¿æ¶¦çš„æœ‰æœºç”Ÿç‰©è†œï¼ˆBiofilmï¼‰â€‹**â€‹ã€‚è¿™ç§ç”Ÿç‰©è†œå­˜åœ¨äºï¼š\n        - â€‹**â€‹åœ°æ¼å­˜æ°´å¼¯å†…å£ã€ç›–æ¿ä¸‹æ–¹å‡¹æ§½â€‹**â€‹ï¼šå³ä½¿æœ‰æ°´å°ï¼Œå†…å£ç§¯ç´¯çš„ç²˜æ»‘æ±¡å¢è–„å±‚å°±è¶³å¤Ÿï¼\n        - â€‹**â€‹ä¸‹æ°´ç®¡é“å£ï¼ˆå°¤å…¶æ’æ°´æ…¢çš„ç®¡é“ï¼‰ï¼šâ€‹**â€‹ é™„ç€åœ¨æ°´çº¿ä»¥ä¸Šçš„ç®¡å£æ±¡å¢è–„è†œï¼Œæˆ–æ°´ä½æ³¢åŠ¨ç•™ä¸‹çš„æ¹¿æ¶¦å¸¦ã€‚\n        - â€‹**â€‹ç“·ç –å¡«ç¼å‰‚ç»†å¾®è£‚ç¼/å‘éœ‰å¤„ã€‚â€‹**â€‹\n        - â€‹**â€‹æ‹–æŠŠå¸ƒçº¤ç»´æ·±å¤„ã€‚â€‹**â€‹\n        - â€‹**â€‹åƒåœ¾æ¡¶å†…å£æ®‹ç•™çš„æ¹¿åƒåœ¾æ¶²è†œã€‚â€‹**â€‹\n    - â€‹**â€‹è¿™äº›åŒºåŸŸè‚‰çœ¼éš¾ä»¥è§‚å¯Ÿï¼šâ€‹**â€‹ ç¼éš™å¤ªçª„ã€å…‰çº¿å¤ªæš—ã€æ±¡å¢é¢œè‰²ä¸èƒŒæ™¯èåˆã€‚æ‚¨ä¸ä¼šåˆ»æ„å»ç¿»çœ‹åœ°æ¼ç›–å­ä¸‹æˆ–ç®¡é“å†…å£çš„â€‹**â€‹å¾®è§‚æƒ…å†µâ€‹**â€‹ã€‚\n2. â€‹**â€‹å‘è‚²è¿‡ç¨‹éšåŒ¿æ€§å¼ºï¼šâ€‹**â€‹\n    - â€‹**â€‹åµæå°ä¸”ç²˜é™„ï¼šâ€‹**â€‹ è™«åµå¾®å°ï¼ˆå°äº0.5mmï¼‰ï¼Œå‘ˆåŠé€æ˜æˆ–ä¹³ç™½è‰²ï¼Œâ€‹**â€‹ç´§å¯†ç²˜é™„åœ¨æ½®æ¹¿æ±¡å¢è¡¨é¢â€‹**â€‹ï¼Œè‚‰çœ¼æéš¾åˆ†è¾¨ã€‚\n    - â€‹**â€‹å¹¼è™«ï¼ˆå­‘å­“çŠ¶ï¼‰ä¸æ´»è·ƒï¼šâ€‹**â€‹ å¹¼è™«ç”Ÿæ´»åœ¨é‚£å±‚ç²˜æ»‘çš„ç”Ÿç‰©è†œä¸­ï¼Œâ€‹**â€‹å¾ˆå°‘å¤§è§„æ¨¡ç§»åŠ¨â€‹**â€‹ï¼Œåªåœ¨é£Ÿç‰©ä¸°å¯Œçš„å±€éƒ¨åŒºåŸŸæ´»åŠ¨ï¼Œä¸æ˜“è¢«å‘ç°ã€‚\n    - â€‹**â€‹è›¹æœŸæ˜¯â€œéšå½¢â€çš„å…³é”®ï¼ï¼šâ€‹**â€‹\n        - â€‹**â€‹é™æ­¢ä¸åŠ¨ï¼šâ€‹**â€‹ å¹¼è™«æˆç†Ÿåä¼šçˆ¬åˆ°ç¨å¹²ç‡¥ä¸€ç‚¹çš„åœ°æ–¹ï¼ˆå¦‚åœ°æ¼ç›–å­ä¸‹æ²¿ã€ç®¡é“å£ä¸Šç«¯ã€ç“·ç –ç¼éš™è¾¹ç¼˜ï¼‰â€‹**â€‹åŒ–è›¹â€‹**â€‹ã€‚è›¹â€‹**â€‹å®Œå…¨ä¸æ´»åŠ¨â€‹**â€‹ã€‚\n        - â€‹**â€‹ä¼ªè£…è‰²ï¼šâ€‹**â€‹ è›¹é€šå¸¸å‘ˆâ€‹**â€‹æ·±è¤è‰²æˆ–é»‘è‰²â€‹**â€‹ï¼Œä¸”ä½“å‹å¾ˆå°ï¼ˆçº¦2-5mmé•¿ï¼‰ï¼Œâ€‹**â€‹å®Œç¾èå…¥â€‹**â€‹å‘¨å›´çš„æ±¡å¢å’Œé˜´å½±ä¸­ã€‚\n        - â€‹**â€‹ä½ç½®åˆé’»ï¼šâ€‹**â€‹ å®ƒä»¬ç²˜é™„åœ¨å‚ç›´æˆ–å€’æ‚¬çš„è¡¨é¢ï¼ˆæ­£æ˜¯æ‚¨ä¸ä¼šåˆ»æ„æ£€æŸ¥çš„åœ°æ–¹ï¼‰ã€‚\n3. â€‹**â€‹â€œçªç„¶å‡ºç°â€çš„çœŸç›¸ï¼šåŒæ­¥ç¾½åŒ–ï¼â€‹**â€‹\n    - åŒä¸€ä¸ªå­³ç”Ÿç‚¹ï¼ˆæ¯”å¦‚åœ°æ¼å†…å£çš„ä¸€å°ç‰‡åŒºåŸŸï¼‰çš„è›¹ï¼Œâ€‹**â€‹å¾€å¾€åœ¨ç›¸è¿‘æ—¶é—´å‘è‚²æˆç†Ÿâ€‹**â€‹ã€‚\n    - â€‹**â€‹ç¯å¢ƒåˆºæ¿€è§¦å‘â€œé›†ä½“ç¾½åŒ–â€ï¼šâ€‹**â€‹ å½“ç¯å¢ƒæ¡ä»¶æˆç†Ÿï¼ˆå¦‚æ¸©åº¦æ¹¿åº¦é€‚å®œï¼Œæˆ–å—åˆ°â€‹**â€‹å…‰çº¿å˜åŒ–ã€éœ‡åŠ¨ã€æ°”æµï¼ˆå¦‚å¼€é—¨ã€æ’é£æ‰‡å¯åŠ¨ï¼‰â€‹**â€‹ çš„åˆºæ¿€æ—¶ï¼‰ï¼Œè¿™äº›æˆç†Ÿçš„è›¹ä¼šâ€‹**â€‹å‡ ä¹åŒæ—¶ç¾½åŒ–â€‹**â€‹ï¼\n    - â€‹**â€‹ç¾½åŒ–è¿‡ç¨‹æå¿«ï¼šâ€‹**â€‹ æˆè™«ç ´è›¹å£³è€Œå‡ºåªéœ€å‡ åˆ†é’Ÿï¼Œç¿…è†€å±•å¼€åâ€‹**â€‹ç«‹å³å…·æœ‰é£è¡Œèƒ½åŠ›â€‹**â€‹ã€‚\n    - â€‹**â€‹è¿™å°±æ˜¯ä¸ºä»€ä¹ˆï¼šâ€‹**â€‹\n        - â€‹**â€‹æ‚¨éš”ä¸€ä¼šå„¿è¿›å»å°±å‘ç°æ–°è™«ï¼šâ€‹**â€‹ å°±åœ¨æ‚¨ç¦»å¼€çš„è¿™æ®µæ—¶é—´ï¼Œä¸Šä¸€æ‰¹è›¹åœ¨æ‚¨â€œæ‰“æ‰°â€ï¼ˆå¼€é—¨ã€èµ°åŠ¨ã€ç¯å…‰åˆºæ¿€ï¼‰åç¾½åŒ–æˆè™«äº†ã€‚\n        - â€‹**â€‹æ•°é‡ä¸å¤šä¸å°‘ï¼ˆ3-5åªï¼‰ï¼šâ€‹**â€‹ å•ä¸ªå¾®å°å­³ç”Ÿç‚¹ä¸€æ¬¡èƒ½äº§ç”Ÿçš„è›¹æ•°é‡å°±è¿™ä¹ˆå¤šã€‚\n        - â€‹**â€‹æ€å®Œåˆå‡ºç°ï¼šâ€‹**â€‹ æºå¤´å­³ç”Ÿç‚¹æŒç»­äº§å‡ºæ–°çš„è›¹ï¼Œè¿™äº›æ–°è›¹åœ¨æ‚¨ç¦»å¼€åå‘è‚²æˆç†Ÿï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡â€œåˆºæ¿€â€å°±ç¾½åŒ–å‡ºæ¥â€œæŠ¥é“â€ã€‚\n4. â€‹**â€‹å­³ç”Ÿç‚¹æœ‰â€œåå¤‡åŠ›é‡â€ï¼šâ€‹**â€‹\n    - å­³ç”Ÿç‚¹æ˜¯â€‹**â€‹æŒç»­äº§ç”Ÿåä»£â€‹**â€‹çš„â€œå·¥å‚â€ã€‚åœ¨æ‚¨æ€æ­»æˆè™«æ—¶ï¼Œå­³ç”Ÿç‚¹é‡Œçš„â€‹**â€‹åµè¿˜åœ¨å­µåŒ–ï¼Œå¹¼è™«è¿˜åœ¨ç”Ÿé•¿ï¼Œæ–°è›¹è¿˜åœ¨å½¢æˆâ€‹**â€‹ã€‚ä¸€æ³¢æˆè™«è¢«æ€æ‰ï¼Œä¸‹ä¸€æ³¢å¹¼è™«å’Œè›¹æ­£åœ¨ç§¯è“„åŠ›é‡ï¼Œå‡†å¤‡ä¸‹ä¸€è½®ç¾½åŒ–ã€‚\n    - åœ¨æ¸©æš–ï¼ˆå¦‚å•æ‰€ï¼‰çš„ç¯å¢ƒä¸­ï¼Œâ€‹**â€‹å‘è‚²å‘¨æœŸå¯èƒ½çŸ­è‡³1å‘¨å·¦å³â€‹**â€‹ï¼Œæ„Ÿè§‰å°±åƒâ€œæ€ä¸å®Œâ€ã€‚\n\nğŸ” â€‹**â€‹æ€»ç»“æƒ…å†µï¼šâ€‹**â€‹\n\n- â€‹**â€‹ä¸æ˜¯â€œçªç„¶é•¿å¤§â€ï¼šâ€‹**â€‹ å®ƒä»¬ä¸€ç›´åœ¨æ‚¨çœ‹ä¸è§çš„åœ°æ–¹ï¼ˆæ±¡å¢è†œã€ç¼éš™ä¸­ï¼‰é»˜é»˜å‘è‚²ï¼ˆåµâ†’å¹¼è™«â†’è›¹ï¼‰ã€‚\n- â€‹**â€‹â€œçªç„¶å‡ºç°â€=åŒæ­¥ç¾½åŒ–ï¼šâ€‹**â€‹ éšè”½çš„è›¹å—åˆ°â€‹**â€‹ç¯å¢ƒå˜åŒ–ï¼ˆæ‚¨çš„è¿›å…¥â€”â€”å…‰çº¿ã€æ°”æµã€éœ‡åŠ¨ï¼‰åˆºæ¿€â€‹**â€‹ï¼Œå‡ ä¹åŒæ—¶ç¾½åŒ–æˆè™«ã€‚\n- â€‹**â€‹â€œæºæºä¸æ–­â€= å­³ç”Ÿç‚¹æŒç»­è¿ä½œï¼šâ€‹**â€‹ å­³ç”Ÿç‚¹æœªè¢«æ¸…é™¤ï¼Œä¸æ–­äº§ç”Ÿæ–°çš„åµã€å¹¼è™«å’Œè›¹ã€‚\n- â€‹**â€‹â€œæ•°é‡ä¸å¤šä½†é¢‘ç¹â€= å°å‹éšç§˜å­³ç”Ÿç‚¹ï¼šâ€‹**â€‹ è¯´æ˜å­³ç”Ÿæºæ¯”è¾ƒå±€é™ï¼ˆå¯èƒ½å°±åœ¨ä¸€ä¸ªåœ°æ¼æˆ–ä¸€å°ç‰‡åŒºåŸŸï¼‰ï¼Œä½†éå¸¸éšè”½ä¸”æ•ˆç‡é«˜ã€‚\n\nğŸ› ï¸ â€‹**â€‹åº”å¯¹å…³é”®ï¼ˆç ´è§£â€œéšç§˜-çˆ†å‘â€å¾ªç¯ï¼‰ï¼šâ€‹**â€‹\n\n1. â€‹**â€‹æ‰¾åˆ°å¹¶æ‘§æ¯é‚£ä¸ªâ€œå¾®å‹å·¥å‚â€ï¼ˆå­³ç”Ÿç‚¹ï¼‰ï¼šâ€‹**â€‹ â€‹**â€‹å¿…é¡»æ‰“ç ´ç ‚é”…é—®åˆ°åº•â€‹**â€‹ï¼\n    - â€‹**â€‹åœ°æ¼æ˜¯å¤´å·å«Œç–‘çŠ¯ï¼â€‹**â€‹ æŒ‰ä¸Šæ¬¡å»ºè®®ï¼Œâ€‹**â€‹æ·±åº¦æ¸…æ´åœ°æ¼å†…å£å’Œç›–å­â€‹**â€‹ã€‚ç”¨å¼ºå…‰æ‰‹ç”µ+å°é•œå­ä»”ç»†è§‚å¯Ÿå¹³æ—¶çœ‹ä¸è§çš„è§’è½ã€‚\n    - â€‹**â€‹æ£€æŸ¥ä¸€åˆ‡å¯èƒ½å½¢æˆâ€œæ¹¿æ¶¦è–„è†œâ€çš„åœ°æ–¹ï¼šâ€‹**â€‹ åŒ…æ‹¬ä¸‹æ°´ç®¡ä¸Šç«¯ã€é©¬æ¡¶åä¾§å¯†å°èƒ¶ã€æ½®æ¹¿æ‹–æŠŠã€åƒåœ¾æ¡¶å†…å£ã€‚\n2. â€‹**â€‹ä½¿ç”¨é’ˆå¯¹å¹¼è™«çš„ç”Ÿç‰©æ­¦å™¨ï¼šâ€‹**â€‹\n    - åœ¨æ¸…æ´å®Œå­³ç”Ÿç‚¹åï¼Œå®šæœŸæŠ•å…¥ â€‹**â€‹BTIï¼ˆè‹äº‘é‡‘æ†èŒï¼‰â€‹**â€‹ é¢—ç²’/ç‰‡å‰‚åˆ°åœ°æ¼ã€ä¸‹æ°´å£ã€‚å®ƒèƒ½â€‹**â€‹æ€æ­»æ°´ä¸­/æ±¡å¢è†œä¸­çš„å¹¼è™«â€‹**â€‹ï¼Œä»æ ¹æœ¬ä¸Šå‡å°‘è›¹å’Œæˆè™«çš„æ•°é‡ã€‚\n3. â€‹**â€‹æ€ç­æˆè™«çš„åŒæ—¶â€œå›´å‰¿â€æ–°è›¹ï¼šâ€‹**â€‹\n    - åœ¨æ€€ç–‘æœ‰å­³ç”Ÿç‚¹çš„åœ°æ–¹ï¼ˆå¦‚åœ°æ¼å‘¨å›´å¢™é¢ã€æ°´æ± ä¸‹æ–¹å¢™é¢ï¼‰ï¼Œä½¿ç”¨ â€‹**â€‹æ»ç•™å‹èŠé…¯æ€è™«å‰‚â€‹**â€‹ å–·æ´’ï¼ˆæŒ‰è¯´æ˜ï¼‰ã€‚æ–°ç¾½åŒ–çš„æˆè™«åœ¨çˆ¬è¡Œæˆ–åœè½æ—¶ä¼šæ¥è§¦åˆ°è¯å‰‚æ­»äº¡ã€‚\n    - åœ¨æˆè™«å¸¸å‡ºç°çš„åŒºåŸŸï¼ˆå¦‚å¢™é¢åº•éƒ¨ã€è§’è½ï¼‰è´´ä¸Š â€‹**â€‹é»„è‰²ç²˜è™«æ¿â€‹**â€‹ï¼Œç‰©ç†æ•è·ã€‚\n4. â€‹**â€‹å‡å°‘ç¯å¢ƒåˆºæ¿€ï¼ˆç¨ä½œå¦¥åçš„è¾…åŠ©åŠæ³•ï¼‰ï¼šâ€‹**â€‹\n    - å¦‚æœæ‚¨èƒ½é•¿æ—¶é—´ï¼ˆæ¯”å¦‚24-48å°æ—¶ï¼‰ä¿æŒå•æ‰€â€‹**â€‹é»‘æš—ã€å®‰é™ã€ä¸è¿›å…¥ï¼ˆåŒ…æ‹¬ä¸å¼€æ’é£æ‰‡ï¼‰â€‹**â€‹ï¼Œå¯èƒ½æ‰“ä¹±å®ƒä»¬çš„ç¾½åŒ–èŠ‚å¥ï¼Œéƒ¨åˆ†è›¹å¯èƒ½åœ¨æ²¡æœ‰åˆºæ¿€æ—¶æ…¢æ…¢ç¾½åŒ–é£å‡ºè¢«å›°ä½ã€‚ä½†è¿™åœ¨å®é™…ç”Ÿæ´»ä¸­è¾ƒéš¾åšåˆ°ï¼Œä¸”ä¸èƒ½æ ¹é™¤æºå¤´ã€‚\n\n# æœ‰æ—¶å€™ï¼Œè¿˜ä¼šæœ‰ä¸€ä¸¤ä¸ªèšŠå­ï¼ŒèšŠå­æ˜¯ä»å“ªé‡Œæ¥çš„ï¼Œä¹Ÿæ˜¯åœ°æ¼å—ï¼Ÿ\nèšŠå­ï¼ˆä¸»è¦æ˜¯åº“èšŠ/å®¶èšŠï¼‰å’Œè›¾è “ã€æœè‡ç­‰å°é£è™«çš„å­³ç”Ÿç¯å¢ƒå’Œä¹ æ€§â€‹**â€‹æœ‰æ˜¾è‘—åŒºåˆ«â€‹**â€‹ã€‚è™½ç„¶æ‚¨å¶å°”åœ¨å•æ‰€çœ‹åˆ°çš„ç¡®å®â€‹**â€‹å¯èƒ½æ˜¯èšŠå­â€‹**â€‹ï¼Œä½†å®ƒä»¬é€šå¸¸â€‹**â€‹ä¸æ˜¯ä»åœ°æ¼æˆ–ä¸‹æ°´é“é‡Œç›´æ¥å­³ç”Ÿâ€‹**â€‹å‡ºæ¥çš„ã€‚\n\nä»¥ä¸‹æ˜¯èšŠå­è¿›å…¥å•æ‰€çš„å¯èƒ½é€”å¾„å’ŒåŸå› åˆ†æï¼š\n\n## ğŸ¦Ÿ èšŠå­è¿›å…¥å•æ‰€çš„ä¸»è¦é€”å¾„\n\n1. â€‹**â€‹ä»å…¶ä»–æˆ¿é—´/å®¤å¤–é£å…¥ï¼ˆæœ€å¤§å¯èƒ½ï¼ï¼‰ï¼šâ€‹**â€‹\n    \n    - â€‹**â€‹é—¨çª—ç¼éš™ï¼šâ€‹**â€‹ èšŠå­éå¸¸æ“…é•¿é€šè¿‡â€‹**â€‹æå…¶å¾®å°çš„ç¼éš™â€‹**â€‹ï¼ˆå‡ æ¯«ç±³ç”šè‡³æ›´å°ï¼‰é’»å…¥å®¤å†…ã€‚å³ä½¿è£…äº†çº±çª—çº±é—¨ï¼Œå¦‚æœè¾¹ç¼˜æœ‰ç ´æŸã€å¯†å°ä¸ä¸¥ã€æˆ–è€…å¼€å…³é—¨æ—¶å¿«é€Ÿè·Ÿè¿›ï¼ŒèšŠå­å°±èƒ½è¿›å…¥ã€‚å•æ‰€å¯èƒ½æ˜¯å®ƒä»¬å¯»æ‰¾æ°´æºæˆ–é¿å…‰çš„æš‚æ—¶åœç•™ç‚¹ã€‚\n    - â€‹**â€‹æ’é£æ‰‡é€šé“ï¼ˆå…³é”®ï¼ï¼‰ï¼šâ€‹**â€‹ è¿™æ˜¯å•æ‰€ç‰¹æœ‰çš„é€šé“ï¼æ‚¨æ‹…å¿ƒçš„æ’é£æ‰‡ï¼Œæ­£æ˜¯èšŠå­è¿›å…¥çš„ä¸»è¦å«Œç–‘ä¹‹ä¸€ï¼š\n        - â€‹**â€‹ç®¡é“ç¼éš™ï¼šâ€‹**â€‹ æ’é£æ‰‡é€šå‘å®¤å¤–çš„ç®¡é“è¿æ¥å¤„å¦‚æœå¯†å°ä¸ä¸¥å®ï¼ŒèšŠå­å°±èƒ½ä»å¤–éƒ¨ç›´æ¥é£è¿›æ¥ã€‚\n        - â€‹**â€‹æ­¢å›é˜€å¤±æ•ˆ/ç¼ºå¤±ï¼šâ€‹**â€‹ å¾ˆå¤šæ’é£æ‰‡æœ¬èº«æˆ–ç®¡é“é‡Œæ²¡æœ‰æœ‰æ•ˆâ€‹**â€‹æ­¢å›é˜€â€‹**â€‹ï¼ˆé˜²å€’çŒé£é—¨ï¼‰ï¼Œæˆ–è€…æ­¢å›é˜€è¢«ç°å°˜ã€æ²¹æ±¡å¡ä½æ— æ³•å®Œå…¨å…³é—­ã€‚å½“é£æ‰‡â€‹**â€‹åœæ­¢è½¬åŠ¨æ—¶â€‹**â€‹ï¼ŒèšŠå­å°±èƒ½é¡ºç€ç®¡é“å€’é£å…¥å®¤å†…ã€‚â€‹**â€‹å¤–éƒ¨æ°”å‹å˜åŒ–â€‹**â€‹ï¼ˆæ¯”å¦‚æ¥¼ä¸‹æ’æ°”æˆ–å¤§é£ï¼‰ä¹Ÿå¯èƒ½å°†èšŠå­æ¨å…¥ã€‚\n        - â€‹**â€‹çº±ç½‘ç ´æŸ/æœªè£…ï¼šâ€‹**â€‹ æ’é£æ‰‡é€šå‘å®¤å¤–çš„å‡ºé£å£å¤–å¦‚æœæ²¡æœ‰å®‰è£…â€‹**â€‹ç»†å¯†çš„é˜²è™«çº±ç½‘â€‹**â€‹ï¼Œæˆ–è€…çº±ç½‘ç ´æŸï¼ŒèšŠå­å°±èƒ½ç›´æ¥ä»å¤–é¢é£å…¥ã€‚\n    - â€‹**â€‹å…¶ä»–ç®¡é“å£/é€šé“ï¼šâ€‹**â€‹ ç©ºè°ƒç®¡é“å­”ã€æŠ½æ²¹çƒŸæœºæ’æ°”å£ç­‰å¦‚æœä¸å•æ‰€ç›¸è¿æˆ–å­˜åœ¨é—´æ¥é€šé“ï¼Œä¹Ÿå¯èƒ½æˆä¸ºå…¥å£ã€‚\n2. â€‹**â€‹å•æ‰€æœ‰ç‹¬ç«‹çš„å­³ç”Ÿæºï¼ˆä¸å¤ªå¸¸è§ï¼Œä½†æœ‰æ¡ä»¶å‘ç”Ÿï¼‰ï¼šâ€‹**â€‹\n    \n    - â€‹**â€‹éšè”½çš„å°‘é‡ç§¯æ°´ï¼šâ€‹**â€‹ èšŠå­ï¼ˆåº“èšŠï¼‰é›Œè™«éœ€è¦åœ¨â€‹**â€‹ç›¸å¯¹æ¸…æ´çš„é™æ°´ä¸­â€‹**â€‹äº§åµï¼ˆä¸è›¾è “å–œè„æ±¡ç¯å¢ƒä¸åŒï¼‰ã€‚å¦‚æœæ‚¨å•æ‰€ä¸­å­˜åœ¨â€‹**â€‹æ„å¤–çš„å°‘é‡ç§¯æ°´â€‹**â€‹ä¸”â€‹**â€‹è¶…è¿‡1å‘¨â€‹**â€‹æœªæ¸…ç†ï¼ŒèšŠå­å¯èƒ½ä¼šåœ¨æ­¤å­³ç”Ÿã€‚å¯èƒ½çš„ç§¯æ°´ç‚¹ï¼š\n        - â€‹**â€‹èŠ±ç›†æ‰˜ç›˜ï¼šâ€‹**â€‹ æ”¾ç½®çš„ç»¿æ¤æ°´ç›˜ç§¯æ°´æœªåŠæ—¶å€’æ‰ã€‚\n        - â€‹**â€‹åºŸå¼ƒå®¹å™¨ï¼šâ€‹**â€‹ è§’è½é‡Œçš„ç©ºç“¶å­ã€ç½å­ã€è„¸ç›†ç­‰ç§¯äº†é›¨æ°´æˆ–ç©ºè°ƒæ°´ã€‚\n        - â€‹**â€‹å µå¡æˆ–æ’æ°´ä¸ç•…çš„åœ°é¢ï¼šâ€‹**â€‹ æŸå¤„åœ°é¢ä¸å¹³æ•´å¯¼è‡´å†²æ´—åå½¢æˆå°æ°´æ´¼æœªå¹²ã€‚\n        - â€‹**â€‹å«ç”Ÿæ­»è§’ï¼šâ€‹**â€‹ æ°´ç®±åæ–¹è¾¹ç¼˜ã€å¾ˆå°‘ç§»åŠ¨çš„ç“¶ç“¶ç½ç½åº•åº§ä¸‹ã€æ‹–æŠŠæ¡¶åº•éƒ¨æ®‹ç•™çš„æ°´ï¼ˆå¿…é¡»è¶³å¤Ÿâ€œé™ç½®â€ï¼‰ã€‚\n    - â€‹**â€‹å­³ç”Ÿè§„æ¨¡å¾ˆå°ï¼šâ€‹**â€‹ ç”±äºå•æ‰€ç¯å¢ƒä¸åƒå¤§å‹èŠ±ç“¶ã€æ°´ç¼¸é‚£æ ·ç†æƒ³ï¼Œå³ä½¿æœ‰å­³ç”Ÿï¼Œé€šå¸¸ä¸€æ¬¡åªèƒ½äº§ç”Ÿâ€‹**â€‹å°‘é‡èšŠå­ï¼ˆ1-5åªï¼‰â€‹**â€‹ã€‚\n\n## ğŸ” å¦‚ä½•åŒºåˆ†å•æ‰€é‡Œçš„èšŠå­æ˜¯â€œé£å…¥â€è¿˜æ˜¯â€œå­³ç”Ÿâ€ï¼Ÿ\n\n- â€‹**â€‹æ—¶é—´æ®µå’Œæ´»åŠ¨æ€§ï¼šâ€‹**â€‹\n    - â€‹**â€‹é£å…¥çš„èšŠå­ï¼šâ€‹**â€‹ é€šå¸¸åœ¨æ‚¨â€‹**â€‹å¼€ç¯åâ€‹**â€‹æˆ–â€‹**â€‹å¼€é—¨è¿›å…¥æ—¶â€‹**â€‹è¢«å‘ç°æ­£åœ¨é£è¡Œï¼Œæˆ–åœè½åœ¨æ˜äº®ã€è¾ƒé«˜çš„åœ°æ–¹ï¼ˆå¢™ä¸Šã€å¤©èŠ±æ¿ä¸Šï¼‰ã€‚å®ƒä»¬ç›¸å¯¹æ´»è·ƒï¼Œå®¹æ˜“è¢«å‘ç°ã€‚\n    - â€‹**â€‹å­³ç”Ÿçš„èšŠå­ï¼šâ€‹**â€‹ ç¾½åŒ–ååˆæœŸæ´»åŠ¨æ€§ç¨å¼±ï¼Œå¯èƒ½åœ¨é è¿‘å­³ç”Ÿæºï¼ˆç§¯æ°´ç‚¹ï¼‰çš„ä½å¤„ã€é˜´æš—è§’è½ï¼ˆå¦‚æ´—æ‰‹ç›†ä¸‹ã€é©¬æ¡¶åï¼‰åœç•™ã€‚ä½†åŒºåˆ«ä¸æ˜æ˜¾ï¼Œä»…ä¾›å‚è€ƒã€‚\n- â€‹**â€‹æ•°é‡ï¼šâ€‹**â€‹\n    - â€‹**â€‹é£å…¥ï¼šâ€‹**â€‹ æ•°é‡ä¸å®šï¼Œå¯èƒ½ä¸€æ¬¡1åªæˆ–2-3åªã€‚\n    - â€‹**â€‹å­³ç”Ÿï¼šâ€‹**â€‹ åŒä¸€æ‰¹å­³ç”Ÿç‚¹å‘è‚²å‡ºæ¥çš„èšŠå­æ•°é‡ä¼šé›†ä¸­å‡ºç°ï¼ˆä½†ä¹Ÿå¯èƒ½æ˜¯å‡ åªï¼‰ã€‚\n- â€‹**â€‹æœ€å¯é æ–¹æ³• â€”â€” å½»åº•æ£€æŸ¥å¯èƒ½çš„å­³ç”Ÿç‚¹ï¼â€‹**â€‹ æ’é™¤æ‰æ‰€æœ‰ç§¯æ°´æ¥æºã€‚\n\n## ğŸ›¡ï¸ åº”å¯¹ç­–ç•¥ï¼ˆé’ˆå¯¹èšŠå­ï¼‰\n\n1. â€‹**â€‹å µä½å…¥å£ï¼ˆé‡ç‚¹æ”»ç ´æ’é£æ‰‡ï¼ï¼‰ï¼šâ€‹**â€‹\n    \n    - â€‹**â€‹æ£€æŸ¥å¹¶å¯†å°æ’é£æ‰‡ï¼šâ€‹**â€‹\n        - â€‹**â€‹å¤–éƒ¨é˜²æŠ¤ï¼šâ€‹**â€‹ æ–­ç”µåï¼Œå¸ä¸‹æ’é£æ‰‡å¤–ç½©ï¼ˆå®¤å†…ä¾§ï¼‰ï¼Œä»”ç»†æ£€æŸ¥é€šå‘å¤–éƒ¨ç®¡é“å£çš„â€‹**â€‹é˜²è™«çº±ç½‘â€‹**â€‹æ˜¯å¦æœ‰ç ´æŸï¼Ÿæ²¡è£…çº±ç½‘ï¼Ÿå­”å¾„æ˜¯å¦å¤ªå¤§ï¼ˆå¿…é¡»<1mmï¼‰ï¼Ÿ â€‹**â€‹ç«‹å³å®‰è£…æˆ–æ›´æ¢è‡´å¯†çš„é‡‘å±/å°¼é¾™é˜²è™«ç½‘ï¼â€‹**â€‹ è¿™æ˜¯é˜»æ–­å¤–éƒ¨èšŠå­æœ€æœ‰æ•ˆçš„ç‰©ç†æ–¹æ³•ï¼\n        - â€‹**â€‹å†…éƒ¨æ¸…æ´ä¸å¯†å°ï¼šâ€‹**â€‹ æ¸…æ´æ‰‡å¶å’Œå†…éƒ¨è…”ä½“ç°å°˜æ²¹æ±¡ï¼ŒæŸ¥çœ‹æ­¢å›é˜€æ˜¯å¦èƒ½è‡ªç”±æ´»åŠ¨ã€å®Œå…¨é—­åˆï¼Ÿé˜€é—¨è¾¹ç¼˜æ˜¯å¦å˜å½¢ï¼Ÿç®¡é“æ¥å£å¤„æ˜¯å¦ç”¨â€‹**â€‹é“ç®”èƒ¶å¸¦æˆ–å¡«ç¼èƒ¶â€‹**â€‹å¯†å°ä¸¥å®ï¼Ÿ â€‹**â€‹æ›´æ¢å¤±æ•ˆçš„æ­¢å›é˜€ã€‚â€‹**â€‹\n    - â€‹**â€‹å°å µé—¨çª—ç¼éš™ï¼šâ€‹**â€‹ æ£€æŸ¥çº±çª—çº±é—¨æ˜¯å¦å®Œå¥½æ— ç ´æ´ï¼Œè¾¹ç¼˜æ˜¯å¦è´´åˆç´§å¯†ï¼ŸåŠæ—¶ä¿®å¤æ›´æ¢ã€‚å…³é—¨æ—¶æ³¨æ„ã€‚\n    - â€‹**â€‹ä¸‹æ°´å£/åœ°æ¼ï¼šâ€‹**â€‹ ä¿æŒç›–å¥½æˆ–æ°´å°æ­£å¸¸ï¼ˆä¸»è¦æ˜¯éš”ç¦»æ°”å‘³å’Œå°é£è™«ï¼Œå¯¹é˜»æ­¢èšŠå­é£å…¥æ•ˆæœæœ‰é™ï¼‰ã€‚\n2. â€‹**â€‹æ¸…é™¤æ½œåœ¨å­³ç”Ÿç‚¹ï¼ˆé¿å…â€œå†…æ‚£â€ï¼‰ï¼šâ€‹**â€‹\n    \n    - â€‹**â€‹ç¿»ç›†å€’ç½æ¸…ç§¯æ°´ï¼šâ€‹**â€‹ æ£€æŸ¥æ‰€æœ‰å¯èƒ½ç§¯æ°´çš„ç‰©å“ï¼ˆèŠ±ç›†æ‰˜ã€æ¡¶ã€ç“¶ã€ç½ï¼‰ï¼Œå½»åº•æ¸…ç©ºç§¯æ°´å¹¶æ“¦å¹²å†…å£ï¼ˆèšŠå­åµå¯ä»¥å¹²æ­»ï¼‰ã€‚â€‹**â€‹é‡ç‚¹æ¸…ç†ä¸å¸¸ç§»åŠ¨çš„å«ç”Ÿæ­»è§’åº•éƒ¨ã€‚â€‹**â€‹\n    - â€‹**â€‹ä¿æŒåœ°é¢å¹²ç‡¥ï¼šâ€‹**â€‹ é¿å…å†²æ´—åå½¢æˆæ— æ³•æµèµ°çš„ç§¯æ°´æ´¼ã€‚åŠæ—¶æ‹–å¹²æ°´æ¸ã€‚\n3. â€‹**â€‹æ€ç­æˆè™«ï¼šâ€‹**â€‹\n    \n    - â€‹**â€‹ç”µèšŠæ‹ï¼šâ€‹**â€‹ æœ€ç›´æ¥ã€‚\n    - â€‹**â€‹èŠé…¯ç±»æ°”é›¾å‰‚ï¼šâ€‹**â€‹ å¯¹èšŠå­åŒæ ·é«˜æ•ˆã€‚ä½¿ç”¨æ—¶å¯¹å‡†èšŠå­ï¼ˆæˆ–ç©ºé—´å–·æ´’ï¼‰åå…³é—¨é—·æ€ã€‚æ³¨æ„å®‰å…¨ã€‚\n    - â€‹**â€‹æ»ç•™å–·æ´’ï¼šâ€‹**â€‹ åœ¨èšŠå­å¯èƒ½åœè½çš„å¢™é¢ï¼ˆå°¤å…¶å•æ‰€ä¸Šéƒ¨ç©ºé—´ã€é è¿‘æ’é£æ‰‡å‘¨å›´ã€çª—æ¡†ï¼‰ã€å¤©èŠ±æ¿è§’è½å–·èŠé…¯ç±»æ»ç•™è¯ç‰©ã€‚\n4. â€‹**â€‹è¾…åŠ©é˜²æŠ¤ï¼šâ€‹**â€‹\n    \n    - â€‹**â€‹ç”µçƒ­èšŠé¦™æ¶²ï¼šâ€‹**â€‹ é•¿æœŸåœ¨å•æ‰€æ’ç€ï¼ˆé€‰æ‹©å«æ°Ÿæ°¯æ°°èŠé…¯ã€æ°¯æ°Ÿé†šèŠé…¯ç­‰æœ‰æ•ˆæˆåˆ†ï¼‰ï¼ŒæŒç»­é‡Šæ”¾æœ‰æ•ˆæˆåˆ†é©±èµ¶å’Œæ€ç­èšŠå­ã€‚æ•ˆæœå¯èƒ½æœ‰é™ã€‚\n    - â€‹**â€‹æ”¾ç½®æ•èšŠç¯ï¼ˆè°¨æ…ï¼‰ï¼šâ€‹**â€‹ æ”¾åœ¨è§’è½å¸å¼•æˆè™«ï¼Œä½†è¦ç¡®ä¿å…¶å…‰æºå¯¹æ‚¨å¤œé—´å¦‚å•ä¸é€ æˆå¹²æ‰°ï¼Œæ•ˆæœå­˜åœ¨äº‰è®®ã€‚\n\n# èŠé…¯ç±»æ€è™«å‰‚ï¼ˆå¦‚æ°¯èŠé…¯ï¼‰èƒ½æ€è™«åµå—ï¼Ÿ\nèŠé…¯ç±»æ€è™«å‰‚ï¼ˆå¦‚æ°¯èŠé…¯ã€é«˜æ•ˆæ°¯æ°°èŠé…¯ã€æº´æ°°èŠé…¯ç­‰ï¼‰â€‹**â€‹å¯¹è™«åµçš„æ€ç­æ•ˆæœé€šå¸¸è¾ƒå¼±ï¼Œç”šè‡³æ— æ•ˆâ€‹**â€‹ã€‚è¿™æ˜¯ç”±å…¶ä½œç”¨æœºç†å’Œè™«åµç»“æ„ç‰¹ç‚¹å†³å®šçš„ï¼š\n\n### ğŸ§ª æ ¸å¿ƒåŸå› åˆ†æ\n\n1. â€‹**â€‹ä½œç”¨æœºç†é™åˆ¶â€‹**â€‹ï¼š\n    \n    - èŠé…¯ç±»æ€è™«å‰‚ä¸»è¦æ˜¯â€‹**â€‹ç¥ç»æ¯’å‰‚â€‹**â€‹ï¼Œé€šè¿‡ç ´åæ˜†è™«çš„ç¥ç»ç³»ç»Ÿï¼ˆä½œç”¨äºé’ ç¦»å­é€šé“ï¼‰ä½¿å…¶å¿«é€Ÿç˜«ç—ªã€æ­»äº¡ã€‚\n    - â€‹**â€‹è™«åµå†…éƒ¨çš„èƒšèƒåœ¨å‘è‚²æ—©æœŸå°šæœªå½¢æˆå®Œå–„çš„ç¥ç»ç³»ç»Ÿâ€‹**â€‹ï¼Œè¯ç‰©éš¾ä»¥å‘æŒ¥ç¥ç»æ¯’æ€§ä½œç”¨ã€‚\n2. â€‹**â€‹ç‰©ç†å±éšœä¿æŠ¤â€‹**â€‹ï¼š\n    \n    - è™«åµï¼ˆå°¤å…¶æ˜¯é£è™«å¦‚è›¾è “ã€èšŠå­ã€æœè‡çš„åµï¼‰é€šå¸¸æœ‰ä¸€å±‚â€‹**â€‹åšç¡¬æˆ–ç–æ°´æ€§çš„åµå£³â€‹**â€‹ã€‚\n    - è¿™å±‚å¤–å£³èƒ½â€‹**â€‹æœ‰æ•ˆé˜»æŒ¡æ€è™«å‰‚çš„æ¸—é€â€‹**â€‹ï¼Œä½¿æ´»æ€§æˆåˆ†æ— æ³•æ¥è§¦åˆ°å†…éƒ¨æ­£åœ¨å‘è‚²çš„èƒšèƒã€‚\n3. â€‹**â€‹ä»£è°¢å·®å¼‚â€‹**â€‹ï¼š\n    \n    - åµå†…èƒšèƒçš„ä»£è°¢æ´»åŠ¨çŠ¶æ€ä¸å¹¼è™«ã€æˆè™«ä¸åŒï¼Œå¯¹è¿™ç±»ç¥ç»æ¯’å‰‚çš„æ•æ„Ÿæ€§å¾ˆä½ã€‚\n\n### ğŸ“Š å®é™…æ•ˆæœæ€»ç»“\n\n|å¯¹è±¡|æ•ˆæœ|\n|---|---|\n|â€‹**â€‹æˆè™«â€‹**â€‹|âœ… â€‹**â€‹æé«˜æ•ˆæœâ€‹**â€‹ï¼šå¿«é€Ÿå‡»å€’ï¼Œé«˜æ•ˆæ€ç­ï¼ˆæ¥è§¦æˆ–å¸å…¥åç¥ç»éº»ç—¹æ­»äº¡ï¼‰ã€‚|\n|â€‹**â€‹å¹¼è™«â€‹**â€‹|âœ… â€‹**â€‹æœ‰æ•ˆâ€‹**â€‹ï¼šå¦‚æœèŠé…¯æˆåˆ†èƒ½æ¥è§¦åˆ°å¹¼è™«ï¼ˆå¦‚åœ¨æ°´ä¸­æˆ–æœ‰ä¿æŠ¤è†œçš„ç¯å¢ƒä¸‹ï¼Œæ•ˆæœä¸å¦‚BTIç­‰ä¸“ç”¨æ€å¹¼å‰‚ï¼‰ã€‚|\n|â€‹**â€‹è›¹â€‹**â€‹|âš ï¸ â€‹**â€‹æ•ˆæœæœ‰é™â€‹**â€‹ï¼šè›¹å£³ä¹Ÿæ˜¯ä¸€å±‚ä¿æŠ¤å±éšœï¼Œå¯èƒ½éœ€è¾ƒé«˜æµ“åº¦æˆ–é•¿æ—¶é—´æ¥è§¦ã€‚|\n|â€‹**â€‹åµ (Eggs)â€‹**â€‹|âŒ â€‹**â€‹æä½/æ— æ•ˆâ€‹**â€‹ï¼šéš¾ä»¥ç©¿é€åµå£³ï¼Œå†…éƒ¨æ— é¶æ ‡ç³»ç»Ÿèµ·ä½œç”¨ã€‚|\n# è‹äº‘é‡‘æ†èŒå¿…é¡»æ˜¯ä»¥è‰²åˆ—äºšç§å—ï¼Ÿå…¶ä»–äºšç§æœ‰åŒºåˆ«å—\n### ğŸ§« ä¸ºä»€ä¹ˆå¿…é¡»æ˜¯ä»¥è‰²åˆ—äºšç§ï¼ˆBTIï¼‰ï¼Ÿ\n\n1. â€‹**â€‹ç‹¬ç‰¹çš„æ¯’ç´ è›‹ç™½ç»„åˆâ€‹**â€‹ï¼š\n    \n    - BTI èƒ½äº§ç”Ÿ â€‹**â€‹4ç§ä¸»è¦æ™¶ä½“è›‹ç™½ï¼ˆCry4Aa, Cry4Ba, Cry10Aa, Cry11Aaï¼‰å’Œ Cyt1Aa è›‹ç™½â€‹**â€‹ã€‚\n    - â€‹**â€‹Cyt1Aa è›‹ç™½æ˜¯å…³é”®â€‹**â€‹ï¼å®ƒèƒ½ç ´åå¹¼è™«è‚ é“ç»†èƒï¼Œä½¿å…¶ä»–æ¯’ç´ æ›´å®¹æ˜“è¿›å…¥ä½“å†…ï¼Œäº§ç”Ÿå¼ºåŠ›ååŒä½œç”¨ã€‚\n    - â€‹**â€‹ä¸“æ€åŒç¿…ç›®â€‹**â€‹ï¼šè¿™äº›æ¯’ç´ â€‹**â€‹ç‰¹å¼‚æ€§ç»“åˆâ€‹**â€‹èšŠã€è “ã€èš‹ã€æ‘‡èšŠç­‰åŒç¿…ç›®å¹¼è™«ä¸­è‚ ä¸Šçš®ç»†èƒçš„å—ä½“ï¼Œå¯¼è‡´è‚ é“ç©¿å­”æ­»äº¡ã€‚\n2. â€‹**â€‹å…¶ä»–å¸¸è§äºšç§çš„ä½œç”¨å¯¹è±¡å®Œå…¨ä¸åŒâ€‹**â€‹ï¼š\n    \n    - â€‹**â€‹Bt åº“æ–¯å¡”å…‹äºšç§ (_B.t._Â subsp.Â _kurstaki_, Btk)â€‹**â€‹ï¼š\n        - â€‹**â€‹ä¸»è¦æ¯’ç´ â€‹**â€‹ï¼šCry1 ç±»è›‹ç™½ï¼ˆå¦‚ Cry1Ab, Cry1Acï¼‰ã€‚\n        - â€‹**â€‹ç›®æ ‡å®³è™«â€‹**â€‹ï¼šâ€‹**â€‹é³ç¿…ç›®å¹¼è™«â€‹**â€‹ï¼ˆè›¾ç±»ã€è¶ç±»çš„æ¯›æ¯›è™«ï¼Œå¦‚èœé’è™«ã€æ£‰é“ƒè™«ã€æ¾æ¯›è™«ï¼‰ã€‚\n        - â€‹**â€‹å¯¹åŒç¿…ç›®æ— æ•ˆï¼â€‹**â€‹\n    - â€‹**â€‹Bt æ‹Ÿæ­¥è¡Œç”²äºšç§ (_B.t._Â subsp.Â _tenebrionis_, Btt)â€‹**â€‹ï¼š\n        - â€‹**â€‹ä¸»è¦æ¯’ç´ â€‹**â€‹ï¼šCry3 ç±»è›‹ç™½ï¼ˆå¦‚ Cry3Aaï¼‰ã€‚\n        - â€‹**â€‹ç›®æ ‡å®³è™«â€‹**â€‹ï¼šâ€‹**â€‹é˜ç¿…ç›®å¹¼è™«â€‹**â€‹ï¼ˆç”²è™«ç±»ï¼Œå¦‚é©¬é“ƒè–¯ç”²è™«ã€é»„æ›²æ¡è·³ç”²ï¼‰ã€‚\n        - â€‹**â€‹å¯¹åŒç¿…ç›®æ— æ•ˆï¼â€‹**â€‹\n    - â€‹**â€‹Bt é²‡æ³½äºšç§ (_B.t._Â subsp.Â _aizawai_, Bta)â€‹**â€‹ï¼š\n        - â€‹**â€‹ä¸»è¦æ¯’ç´ â€‹**â€‹ï¼šCry1 ç±»è›‹ç™½ï¼ˆéƒ¨åˆ†èŒæ ªå« Cry2ï¼‰ã€‚\n        - â€‹**â€‹ç›®æ ‡å®³è™«â€‹**â€‹ï¼šâ€‹**â€‹é³ç¿…ç›®å¹¼è™«â€‹**â€‹ï¼ˆå°¤å…¶å¯¹å¤œè›¾ç§‘ã€å°èœè›¾ç­‰æ•ˆæœè¾ƒå¥½ï¼‰ã€‚\n        - â€‹**â€‹å¯¹åŒç¿…ç›®æ— æ•ˆï¼â€‹**â€‹\n\n---\n\n### ğŸ“Š ä¸åŒè‹äº‘é‡‘æ†èŒäºšç§çš„ä½œç”¨èŒƒå›´å¯¹æ¯”è¡¨\n\n|â€‹**â€‹äºšç§åç§°â€‹**â€‹|â€‹**â€‹ç¼©å†™â€‹**â€‹|â€‹**â€‹ä¸»è¦ç›®æ ‡å®³è™«â€‹**â€‹|â€‹**â€‹èƒ½å¦æ€èšŠ/è “/èš‹ï¼Ÿâ€‹**â€‹|\n|---|---|---|---|\n|â€‹**â€‹ä»¥è‰²åˆ—äºšç§â€‹**â€‹|â€‹**â€‹BTIâ€‹**â€‹|â€‹**â€‹åŒç¿…ç›®å¹¼è™«â€‹**â€‹  <br>ï¼ˆèšŠã€è “ã€èš‹ã€æ‘‡èšŠï¼‰|âœ… â€‹**â€‹é«˜æ•ˆä¸“æ€ï¼â€‹**â€‹|\n|åº“æ–¯å¡”å…‹äºšç§|Btk|é³ç¿…ç›®å¹¼è™«  <br>ï¼ˆè›¾ã€è¶ç±»æ¯›æ¯›è™«ï¼‰|âŒ å®Œå…¨æ— æ•ˆ|\n|æ‹Ÿæ­¥è¡Œç”²äºšç§|Btt|é˜ç¿…ç›®å¹¼è™«  <br>ï¼ˆç”²è™«ç±»ï¼‰|âŒ å®Œå…¨æ— æ•ˆ|\n|é²‡æ³½äºšç§|Bta|é³ç¿…ç›®å¹¼è™«  <br>ï¼ˆéƒ¨åˆ†æŠ—æ€§å®³è™«ï¼‰|âŒ å®Œå…¨æ— æ•ˆ|\n|åœ£åœ°äºšå“¥äºšç§|Btsd|é˜ç¿…ç›®å¹¼è™«  <br>ï¼ˆéƒ¨åˆ†ç”²è™«ï¼‰|âŒ å®Œå…¨æ— æ•ˆ|\n\n---\n\n### ğŸ’¡ ä¸ºä»€ä¹ˆä¸èƒ½ä¹±ç”¨å…¶ä»–äºšç§ï¼Ÿ\n\n1. â€‹**â€‹å®Œå…¨æ— æ•ˆâ€‹**â€‹ï¼š  \n    å…¶ä»–äºšç§äº§ç”Ÿçš„æ¯’ç´ è›‹ç™½â€‹**â€‹æ— æ³•è¯†åˆ«å’Œç»“åˆâ€‹**â€‹åŒç¿…ç›®å¹¼è™«çš„è‚ é“å—ä½“ï¼Œå› æ­¤å¯¹èšŠã€è “ã€èš‹ç­‰â€‹**â€‹æ¯«æ— æ€ç­ä½œç”¨â€‹**â€‹ã€‚\n2. â€‹**â€‹æµªè´¹èµ„æºâ€‹**â€‹ï¼š  \n    è´­ä¹°æˆ–ä½¿ç”¨é”™è¯¯çš„äºšç§ï¼ˆå¦‚Btkï¼‰æ¥å¯¹ä»˜å•æ‰€é£è™«ï¼Œæ—¢æ— æ³•è§£å†³é—®é¢˜ï¼Œåˆæµªè´¹æ—¶é—´å’Œé‡‘é’±ã€‚\n3. â€‹**â€‹å¯èƒ½è¯¯ä¼¤éç›®æ ‡ç”Ÿç‰©â€‹**â€‹ï¼š  \n    è‹¥å°†Btkå–·æ´’åˆ°æ¤ç‰©ä¸Šé˜²æ²»é£è™«ï¼ˆå®é™…æ— æ•ˆï¼‰ï¼Œå¯èƒ½è¯¯æ€è´è¶ã€è›¾ç±»çš„æœ‰ç›Šå¹¼è™«ï¼ˆå¦‚èš•ã€ä¼ ç²‰æ˜†è™«ï¼‰ã€‚\n\n---\n\n### âœ… å¦‚ä½•ç¡®ä¿ä¹°åˆ°çœŸæ­£çš„BTIäº§å“ï¼Ÿ\n\n1. â€‹**â€‹è®¤å‡†å…³é”®æ ‡è¯†â€‹**â€‹ï¼š\n    - åŒ…è£…ä¸Šå¿…é¡»æ˜ç¡®æ ‡æ³¨ â€‹**â€‹â€œè‹äº‘é‡‘æ†èŒä»¥è‰²åˆ—äºšç§â€â€‹**â€‹ã€â€‹**â€‹â€œBTIâ€â€‹**â€‹ æˆ– â€‹**â€‹â€œ_Bacillus thuringiensis_Â subsp.Â _israelensis_â€â€‹**â€‹ã€‚\n    - è‹±æ–‡å•†å“åå¸¸å« â€‹**â€‹â€œMosquito Dunksâ€â€‹**â€‹ã€â€‹**â€‹â€œMosquito Bitsâ€â€‹**â€‹ã€â€‹**â€‹â€œGnatrolâ€â€‹**â€‹ï¼ˆå›­è‰ºç”¨ï¼‰ã€‚\n2. â€‹**â€‹æŸ¥çœ‹é˜²æ²»å¯¹è±¡â€‹**â€‹ï¼š  \n    äº§å“è¯´æ˜åº”å†™æ˜ç”¨äºé˜²æ²» â€‹**â€‹â€œèšŠå­å¹¼è™«â€ã€â€œè “â€ã€â€œèš‹â€ã€â€œæ‘‡èšŠâ€â€‹**â€‹ æˆ– â€‹**â€‹â€œåŒç¿…ç›®æ°´ç”Ÿå¹¼è™«â€â€‹**â€‹ã€‚\n3. â€‹**â€‹è­¦æƒ•æ¨¡ç³Šæ ‡æ³¨â€‹**â€‹ï¼š  \n    åªå†™â€œè‹äº‘é‡‘æ†èŒâ€ä½†æœªæ³¨æ˜äºšç§ï¼Œæˆ–æ ‡æ³¨é˜²æ²»å¯¹è±¡ä¸ºâ€œé’è™«â€ã€â€œæ¯›è™«â€ã€â€œç”²è™«â€çš„ï¼Œä¸€å®šæ˜¯å…¶ä»–äºšç§ï¼ˆBtk/Bttï¼‰ï¼Œâ€‹**â€‹å¯¹é£è™«æ— æ•ˆï¼â€‹**â€‹\n\n---\n\n### ğŸŒ± BTIçš„å®‰å…¨æ€§ä¼˜åŠ¿ï¼ˆé‡ç”³ï¼‰\n\n- â€‹**â€‹é«˜åº¦ç‰¹å¼‚â€‹**â€‹ï¼šåªæ€åŒç¿…ç›®å¹¼è™«ï¼Œå¯¹é±¼è™¾ã€è›™ç±»ã€é¸Ÿç±»ã€å“ºä¹³åŠ¨ç‰©ï¼ˆåŒ…æ‹¬äººã€å® ç‰©ï¼‰ã€èœœèœ‚ã€ç“¢è™«ç­‰â€‹**â€‹éç›®æ ‡ç”Ÿç‰©æ— å®³â€‹**â€‹ã€‚\n- â€‹**â€‹ç¯å¢ƒå‹å¥½â€‹**â€‹ï¼šå¤©ç„¶å¾®ç”Ÿç‰©åˆ¶å‰‚ï¼Œæ— åŒ–å­¦æ®‹ç•™ã€‚\n- â€‹**â€‹ä¸æ˜“äº§ç”ŸæŠ—æ€§â€‹**â€‹ï¼šå¤šæ¯’ç´ ååŒä½œç”¨ï¼Œé™ä½æŠ—è¯æ€§é£é™©ã€‚\n# æŸäº§å“\n![](../../images/æ€è™«çŸ¥è¯†_è›¾è “/image-20250803015125921.png)\n\n![](../../images/æ€è™«çŸ¥è¯†_è›¾è “/image-20250803015144555.png)\n\n**è¿™æ¬¾è‹äº‘é‡‘æ†èŒï¼ˆä»¥è‰²åˆ—äºšç§ï¼‰å¯æ¹¿æ€§ç²‰å‰‚å®Œå…¨é€‚ç”¨äºæ€ç­å•æ‰€é£è™«ï¼ˆè›¾è “/èšŠå­ï¼‰çš„å¹¼è™«ï¼â€‹**â€‹ ä»¥ä¸‹æ˜¯å…³é”®ç¡®è®¤ç‚¹ï¼š\n\n---\n\n### âœ… â€‹**â€‹æ˜ç¡®æœ‰æ•ˆçš„è¯æ®â€‹**â€‹\n\n1. â€‹**â€‹æ ¸å¿ƒæˆåˆ†æ ‡æ³¨æ¸…æ™°â€‹**â€‹ï¼š\n    \n    - åŒ…è£…æ˜ç¡®æ ‡æ³¨ â€‹**â€‹â€œè‹äº‘é‡‘æ†èŒ(ä»¥è‰²åˆ—äºšç§)â€â€‹**â€‹ï¼ˆå³BTIï¼‰ï¼Œè¿™æ˜¯ä¸“æ€åŒç¿…ç›®å¹¼è™«ï¼ˆèšŠã€è “ã€èš‹ï¼‰çš„èŒç§ï¼Œä¸æ‚¨éœ€æ±‚å®Œå…¨åŒ¹é…ã€‚\n2. â€‹**â€‹é˜²æ²»å¯¹è±¡æ­£ç¡®â€‹**â€‹ï¼š\n    \n    - è¯´æ˜ä¸­æ˜ç¡®å†™ â€‹**â€‹â€œå¯¹èšŠå¹¼è™«æœ‰è¾ƒå¥½çš„é˜²æ²»æ•ˆæœâ€â€‹**â€‹ï¼Œå¹¶é’ˆå¯¹ â€‹**â€‹â€œèšŠå­³ç”Ÿåœ°ä¸­çš„å­‘å­“ï¼ˆå¹¼è™«ï¼‰â€â€‹**â€‹ã€‚å•æ‰€åœ°æ¼ã€ä¸‹æ°´é“æ­£æ˜¯å…¸å‹çš„å­³ç”Ÿåœ°ã€‚\n3. â€‹**â€‹ä½œç”¨æœºç†ç²¾å‡†â€‹**â€‹ï¼š\n    \n    - æ¯’ç´ è›‹ç™½å¯ç ´åèšŠ/è “å¹¼è™«çš„è‚ é“ç»†èƒï¼ˆä¸ç§‘å­¦åŸç†ä¸€è‡´ï¼‰ï¼Œå¯¹è›¾è “åŒæ ·æœ‰æ•ˆï¼ˆäºŒè€…åŒå±åŒç¿…ç›®ï¼‰ã€‚\n\n---\n\n### ğŸ“ â€‹**â€‹ä½¿ç”¨æ³¨æ„äº‹é¡¹ï¼ˆé’ˆå¯¹å•æ‰€åœºæ™¯ï¼‰â€‹**â€‹\n\n1. â€‹**â€‹ç”¨æ³•è°ƒæ•´â€‹**â€‹ï¼š\n    \n    - â€‹**â€‹äº§å“å»ºè®®â€‹**â€‹ï¼šå®¤å¤–å–·æ´’ï¼ˆ1-2å…‹/ã¡æ°´é¢ï¼‰ã€‚\n    - â€‹**â€‹å•æ‰€ç”¨æ³•â€‹**â€‹ï¼šå– â€‹**â€‹5å…‹ï¼ˆçº¦1å‹ºï¼‰+ 500mlæ°´â€‹**â€‹ï¼Œæ··åˆåçŒå…¥åœ°æ¼/æ´—æ‰‹æ± ä¸‹æ°´é“ï¼Œâ€‹**â€‹æ— éœ€å–·æ´’â€‹**â€‹ã€‚\n    - â€‹**â€‹é¢‘ç‡â€‹**â€‹ï¼šé¦–æ¬¡è¿ç”¨3å¤©ï¼Œåç»­æ¯å‘¨1æ¬¡ï¼ˆé¢„é˜²ï¼‰ã€‚\n2. â€‹**â€‹å®‰å…¨é‡ç‚¹â€‹**â€‹ï¼š\n    \n    - âš ï¸ â€‹**â€‹é¿å¼€é±¼ç±»/èœœèœ‚â€‹**â€‹ï¼šè™½å•æ‰€æ— æ­¤é£é™©ï¼Œä½†å‹¿å€’å…¥é±¼ç¼¸æˆ–é˜³å°èŠ±ç›†ç§¯æ°´ã€‚\n    - ğŸ§¤ â€‹**â€‹æ“ä½œé˜²æŠ¤â€‹**â€‹ï¼šæˆ´æ‰‹å¥—ï¼Œé¿å…è¯ç²‰æ¥è§¦çš®è‚¤ï¼ˆç²‰å‰‚è¾ƒæ‚¬æµ®å‰‚æ›´æ˜“é£æ•£ï¼‰ã€‚\n    - ğŸ’§ â€‹**â€‹æ¸…æ´â€‹**â€‹ï¼šæ“ä½œåæ´—æ‰‹ï¼Œå·¥å…·å†²æ´—å¹²å‡€ã€‚\n3. â€‹**â€‹æ•ˆæœé¢„æœŸâ€‹**â€‹ï¼š\n    \n    - å¹¼è™«æ¥è§¦è¯æ¶²å â€‹**â€‹24-48å°æ—¶æ­»äº¡â€‹**â€‹ï¼Œæˆè™«éœ€é…åˆèŠé…¯å–·é›¾ï¼ˆå¦‚é›·è¾¾ï¼‰æ¸…é™¤ã€‚\n\n---\n\n### ğŸ”„ â€‹**â€‹ä¸å…¶ä»–äº§å“çš„å¯¹æ¯”â€‹**â€‹\n\n|â€‹**â€‹äº§å“ç±»å‹â€‹**â€‹|æœ¬æ¬¡BTIå¯æ¹¿æ€§ç²‰å‰‚|æ­¤å‰é—®é¢˜æ‚¬æµ®å‰‚|\n|---|---|---|\n|â€‹**â€‹äºšç§â€‹**â€‹|âœ… æ˜ç¡®ä»¥è‰²åˆ—äºšç§ï¼ˆä¸“æ€èšŠè “ï¼‰|âŒ æœªæ ‡æ³¨æˆ–é”™è¯¯äºšç§|\n|â€‹**â€‹é€‚ç”¨æ€§â€‹**â€‹|âœ… æº¶è§£åçŒåœ°æ¼ï¼Œå®Œç¾åŒ¹é…å•æ‰€ç¯å¢ƒ|âŒ éœ€å–·æ´’ï¼ˆä¸é€‚ç”¨ä¸‹æ°´é“ï¼‰|\n|â€‹**â€‹ç”Ÿäº§ä¿¡æ¯â€‹**â€‹|âœ… æ­£è§„ä¼ä¸šï¼ˆæ­¦æ±‰åº·æ¬£ï¼‰|âŒ æ ‡ç­¾çŸ›ç›¾/è¿‡æœŸ|\n|â€‹**â€‹æ¨èåº¦â€‹**â€‹|ğŸ‘ â€‹**â€‹å¼ºçƒˆæ¨èâ€‹**â€‹|ğŸš« â€‹**â€‹ç¦æ­¢ä½¿ç”¨â€‹**â€‹|\n\n---\n\n### ğŸ“Œ â€‹**â€‹æ“ä½œæŒ‡å—ï¼ˆé’ˆå¯¹å•æ‰€ï¼‰â€‹**â€‹\n\n1. â€‹**â€‹è°ƒé…â€‹**â€‹ï¼š5å…‹è¯ç²‰ + 500mlæ°´ â†’ æ‘‡åŒ€é™ç½®10åˆ†é’Ÿã€‚\n2. â€‹**â€‹çŒå…¥â€‹**â€‹ï¼š\n    - åœ°æ¼ï¼šæ€ç›–ç›´æ¥å€’å…¥æ··åˆæ¶²ã€‚\n    - æ´—æ‰‹æ± ï¼šç§»å¼€èµ·æ³¡èƒ¶ï¼Œå€’å…¥ç®¡é“æ·±å¤„ã€‚\n3. â€‹**â€‹å¼ºåŒ–â€‹**â€‹ï¼šè¿ç»­3å¤©æ“ä½œï¼Œåˆ‡æ–­ç¹æ®–é“¾ã€‚\n4. â€‹**â€‹é˜²æŠ¤â€‹**â€‹ï¼šæ“ä½œæ—¶æˆ´å£ç½©æ‰‹å¥—ï¼Œé€šé£30åˆ†é’Ÿã€‚\n\n---\n\n### ğŸ’ æ€»ç»“\n\nâ€‹**â€‹è¿™æ¬¾äº§å“æ˜¯æ ¹é™¤å•æ‰€é£è™«å¹¼è™«çš„ç†æƒ³é€‰æ‹©ï¼â€‹**â€‹  \nè¯·æŒ‰ä¸Šè¿°æ–¹æ³•ä½¿ç”¨ï¼ŒåšæŒ1-2å‘¨ï¼ˆé…åˆæˆè™«æ‰‘æ€ï¼‰ï¼Œå³å¯æ˜¾è‘—è§£å†³é£è™«åå¤é—®é¢˜ã€‚  \nâ€‹**â€‹æç¤ºâ€‹**â€‹ï¼šå¼€è¢‹åå¯†å°å­˜æ”¾ï¼Œé¿å…å—æ½®å¤±æ•ˆï¼\n# æ‹œå°”çš„ç‰¹å§†å¾—\næ‹œå°”çš„ç‰¹å§†å¾—ï¼šå¡è™«ç³å«é‡ï¼š21%ï¼Œé«˜æ•ˆæ°Ÿæ°¯æ°°èŠé…¯å«é‡ï¼š10%ã€‚ç”¨è¿™ä¸ªé™¤è›¾è “æ€ä¹ˆæ ·ï¼Ÿ\n\næ ¹æ®é…æ–¹æˆåˆ†åˆ†æï¼Œæ‹œè€³ã€Œç‰¹å§†å¾—ã€ï¼ˆå¡è™«å•‰21% + é«˜æ•ˆæ°Ÿæ°¯æ°°èŠé…¯10%ï¼‰â€‹**â€‹å¯é«˜æ•ˆç­æ€è›¾è “æˆè™«â€‹**â€‹ï¼Œä½†æ— æ³•æ ¹é™¤å¹¼è™«æºå¤´ï¼Œä¸”å­˜åœ¨â€‹**â€‹è¾ƒé«˜å®‰å…¨é£é™©â€‹**â€‹ï¼Œéœ€è°¨æ…ä½¿ç”¨ã€‚ä»¥ä¸‹æ˜¯å…·ä½“åˆ†æå’Œæ“ä½œå»ºè®®ï¼š\n\n---\n\n### âœ… â€‹**â€‹ä¼˜åŠ¿ï¼ˆé’ˆå¯¹æˆè™«ï¼‰â€‹**â€‹\n\n1. â€‹**â€‹åŒé‡é€Ÿæ•ˆç­æ€â€‹**â€‹ï¼š\n    \n    - â€‹**â€‹é«˜æ•ˆæ°Ÿæ°¯æ°°èŠé…¯â€‹**â€‹ï¼ˆ10%é«˜æµ“åº¦ï¼‰ï¼š\n        - å¼ºåŠ›ç¥ç»æ¯’å‰‚ï¼Œæ¥è§¦åâ€‹**â€‹è¿…é€Ÿå‡»å€’è›¾è “æˆè™«â€‹**â€‹ã€‚\n        - æŒæ•ˆæœŸé•¿ï¼Œå–·æ´’è¡¨é¢åå½¢æˆè¯è†œï¼ŒæŒç»­æ€æ­»æ–°åœè½çš„æˆè™«ã€‚\n    - â€‹**â€‹å¡è™«å•‰â€‹**â€‹ï¼ˆ21%ï¼‰ï¼š\n        - å¹²æ‰°æ˜†è™«ç¥ç»ç³»ç»Ÿï¼Œä¸èŠé…¯ååŒå¢å¼ºæ€è™«æ•ˆæœã€‚\n        - å¯¹è›¾è “æˆè™«æœ‰æ•ˆï¼ˆä½†å¯¹å¹¼è™«æ•ˆæœå¼±ï¼‰ã€‚\n2. â€‹**â€‹å¯¹è›¾è “æˆè™«é«˜æ•ˆâ€‹**â€‹ï¼š\n    \n    - å¤é…æˆåˆ†å¯¹é£è¡Œç±»å®³è™«ï¼ˆè›¾è “ã€èšŠå­ã€è‹è‡ï¼‰â€‹**â€‹å‡»å€’ç‡ï¼95%â€‹**â€‹ã€‚\n\n---\n\n### âš ï¸ â€‹**â€‹å±€é™ä¸é£é™©â€‹**â€‹\n\n|â€‹**â€‹é—®é¢˜â€‹**â€‹|â€‹**â€‹åŸå› ä¸åæœâ€‹**â€‹|\n|---|---|\n|â€‹**â€‹æ— æ³•ç­å¹¼è™«/åµâ€‹**â€‹|å¡è™«å•‰å¯¹åŒç¿…ç›®å¹¼è™«æ•ˆæœå·®ï¼ŒèŠé…¯ä¸æ€åµã€‚â€‹**â€‹æºå¤´æœªæ–­ï¼Œæ²»æ ‡ä¸æ²»æœ¬â€‹**â€‹ã€‚|\n|â€‹**â€‹æµ“åº¦è¿‡é«˜â€‹**â€‹|å®¶ç”¨èŠé…¯å–·é›¾æµ“åº¦é€šå¸¸ä»…â€‹**â€‹0.03%-0.1%â€‹**â€‹ï¼Œæœ¬å“é«˜è¾¾10%ï¼â€‹**â€‹è¿‡åº¦æ¥è§¦æ˜“å¼•å‘å¤´ç—›ã€çš®è‚¤åˆºæ¿€â€‹**â€‹ã€‚|\n|â€‹**â€‹æ¯’æ€§é£é™©â€‹**â€‹|å¯¹é±¼ã€èœ‚å‰§æ¯’ï¼Œå¯¹å“ºä¹³åŠ¨ç‰©ä¸­ç­‰æ¯’æ€§ã€‚å•æ‰€é‚»è¿‘ç”Ÿæ´»åŒºï¼Œâ€‹**â€‹è¯¯è§¦æ®‹ç•™è¯è†œå¯èƒ½å±å®³å¥åº·â€‹**â€‹ã€‚|\n|â€‹**â€‹å‰‚å‹ä¸é€‚â€‹**â€‹|è®¾è®¡ä¸ºæˆ·å¤–æˆ–å†œç”¨å–·é›¾ï¼Œâ€‹**â€‹å•æ‰€æ½®æ¹¿ç¯å¢ƒæ˜“å¯¼è‡´è¯å‰‚æ°´è§£å¤±æ•ˆâ€‹**â€‹ã€‚|\n\n---\n\n### ğŸ“Œ â€‹**â€‹ä½¿ç”¨å»ºè®®ï¼ˆå¦‚å¿…é¡»ä½¿ç”¨ï¼‰â€‹**â€‹\n\n#### 1. â€‹**â€‹ä¸¥æ ¼é˜²æŠ¤æªæ–½â€‹**â€‹\n\n- â€‹**â€‹ç©¿æˆ´â€‹**â€‹ï¼šN95å£ç½© + æŠ¤ç›®é•œ + æ©¡èƒ¶æ‰‹å¥— + é•¿è¢–è¡£ç‰©ï¼ˆé¿å…çš®è‚¤æ¥è§¦ï¼‰ã€‚\n- â€‹**â€‹é€šé£â€‹**â€‹ï¼šå–·æ´’åå…³é—­é—¨çª—2å°æ—¶ï¼Œå†é€šé£30åˆ†é’Ÿä»¥ä¸Šæ‰å¯è¿›å…¥ã€‚\n\n#### 2. â€‹**â€‹ç²¾å‡†æ“ä½œï¼ˆé™ä½é£é™©ï¼‰â€‹**â€‹\n\n- â€‹**â€‹ä¸å–·é›¾ï¼â€‹**â€‹ æ”¹ä¸ºâ€‹**â€‹é’ˆå¯¹æ€§ç‚¹å–·â€‹**â€‹ï¼š\n    - ç”¨é’ˆç­’æŠ½å–è¯å‰‚ï¼Œâ€‹**â€‹æ··åˆæ¸…æ°´ç¨€é‡Š10å€â€‹**â€‹ï¼ˆå³1ä»½è¯+9ä»½æ°´ï¼‰ã€‚\n    - ä»…å–·åœ¨â€‹**â€‹éæ¥è§¦é¢â€‹**â€‹ï¼šå¢™é¢é¡¶éƒ¨ã€å¤©èŠ±æ¿è§’è½ã€æ’é£å£è¾¹ç¼˜ï¼ˆé¿å¼€åœ°æ¼ã€æ´—æ‰‹å°ç­‰æ½®æ¹¿åŒºï¼‰ã€‚\n- â€‹**â€‹ä¸¥ç¦å–·æ´’èŒƒå›´â€‹**â€‹ï¼š  \n    âŒ åœ°æ¼ã€æ´—æ‰‹æ± ã€æ¯›å·¾æ¶ã€é©¬æ¡¶åº§åœˆç­‰å¯èƒ½æ¥è§¦çš®è‚¤çš„åŒºåŸŸã€‚\n\n#### 3. â€‹**â€‹å¿…é¡»é…åˆæºå¤´æ²»ç†â€‹**â€‹\n\n|â€‹**â€‹æ­¥éª¤â€‹**â€‹|â€‹**â€‹æ“ä½œâ€‹**â€‹|\n|---|---|\n|æ€å¹¼è™«æºå¤´|åšæŒä½¿ç”¨â€‹**â€‹BTIé¢—ç²’/ç‰‡å‰‚â€‹**â€‹æŠ•å…¥åœ°æ¼ï¼ˆæ¯å‘¨1æ¬¡ï¼‰|\n|ç¯å¢ƒæ¸…æ´|åˆ·æ´—åœ°æ¼å†…å£é»æ¶² + ä¿æŒå¹²ç‡¥|\n|ç‰©ç†é˜²æˆè™«|æ¢è£…â€‹**â€‹å¯†å°é˜²è™«åœ°æ¼ç›–â€‹**â€‹ + ç²˜è™«æ¿è¾…åŠ©|\n\n---\n\n### ğŸ’ â€‹**â€‹æ›¿ä»£æ–¹æ¡ˆï¼ˆæ›´æ¨èï¼‰â€‹**â€‹\n\n1. â€‹**â€‹å®‰å…¨ç­æˆè™«â€‹**â€‹ï¼š\n    \n    - â€‹**â€‹å®¶ç”¨èŠé…¯å–·é›¾â€‹**â€‹ï¼ˆå¦‚é›·è¾¾ã€æªæ‰‹ï¼‰ï¼šå«â€‹**â€‹0.03%-0.1%æ°¯èŠé…¯â€‹**â€‹ï¼Œå®‰å…¨é«˜æ•ˆï¼Œç›´æ¥å–·é›¾å‡»æ€ã€‚\n    - â€‹**â€‹ç”µèšŠæ‹â€‹**â€‹ï¼šç‰©ç†ç­è™«é›¶é£é™©ã€‚\n2. â€‹**â€‹æ ¹æ²»å¹¼è™«â€‹**â€‹ï¼š\n    \n    - â€‹**â€‹BTIä»¥è‰²åˆ—äºšç§â€‹**â€‹ï¼ˆå¦‚æ‚¨å·²æœ‰çš„ã€Œå¹¼æ¸…ã€ç²‰å‰‚ï¼‰ï¼šå®šæœŸçŒå…¥ä¸‹æ°´é“ã€‚\n\n---\n\n### ğŸ“Š æ•ˆæœä¸é£é™©å¯¹æ¯”è¡¨\n\n|â€‹**â€‹æ–¹æ¡ˆâ€‹**â€‹|ç­æˆè™«æ•ˆæœ|ç­å¹¼è™«æ•ˆæœ|å®‰å…¨æ€§|é€‚ç”¨æ€§|\n|---|---|---|---|---|\n|ç‰¹å§†å¾—ï¼ˆç¨€é‡Šç‚¹å–·ï¼‰|â­â­â­â­â­|âŒ|âš ï¸âš ï¸âš ï¸|åº”æ€¥çŸ­æœŸä½¿ç”¨|\n|å®¶ç”¨èŠé…¯å–·é›¾ï¼ˆå¦‚é›·è¾¾ï¼‰|â­â­â­â­|âŒ|â­â­|æ—¥å¸¸é¦–é€‰|\n|BTIçŒåœ°æ¼|âŒ|â­â­â­â­â­|â­â­â­â­|å¿…é¡»é•¿æœŸæ‰§è¡Œ|\n\n---\n\n### ğŸ”š æ€»ç»“\n\n- â€‹**â€‹çŸ­æœŸåº”æ€¥â€‹**â€‹ï¼šå¯ç¨€é‡Šåç‚¹å–·å¤©èŠ±æ¿è§’è½ï¼Œâ€‹**â€‹åŠ¡å¿…åšå¥½é˜²æŠ¤+é€šé£â€‹**â€‹ã€‚\n- â€‹**â€‹é•¿æœŸæ ¹æ²»â€‹**â€‹ï¼š\n    1. â€‹**â€‹æˆè™«â€‹**â€‹ â†’ å®¶ç”¨ä½æ¯’å–·é›¾/ç”µèšŠæ‹\n    2. â€‹**â€‹å¹¼è™«â€‹**â€‹ â†’ BTIçŒåœ°æ¼\n    3. â€‹**â€‹ç¯å¢ƒâ€‹**â€‹ â†’ æ¸…æ´åœ°æ¼ + å¯†å°æ½®æ¹¿åŒº\n- â€‹**â€‹å®‰å…¨è­¦ç¤ºâ€‹**â€‹ï¼šæœ¬å“å†œç”¨é«˜æ¯’é…æ–¹ï¼Œâ€‹**â€‹å‹¿ç”¨äºåœ°é¢ã€æ´—æ‰‹å°ç­‰æ¥è§¦é¢â€‹**â€‹ï¼Œå®¶æœ‰å­•å¦‡/å® ç‰©åˆ™ç¦ç”¨ï¼\n# è€ç®¡å®¶æ€è™«æ°´ä¹³å‰‚æœ‰ç”¨å—ï¼Ÿ\n![](../../images/æ€è™«çŸ¥è¯†_è›¾è “/image-20250803015310881.png)\n\n\næ ¹æ®äº§å“ä¿¡æ¯åˆ†æï¼Œè¿™æ¬¾ã€Œè€ç®¡å®¶æ€è™«æ°´ä¹³å‰‚ã€â€‹**â€‹å€’å…¥ä¸‹æ°´é“å¯¹ç­æ€è›¾è “æˆè™«æœ‰ä¸€å®šå³æ—¶æ•ˆæœï¼Œä½†æ— æ³•æ ¹æ²»å¹¼è™«æºå¤´ï¼Œä¸”å­˜åœ¨æ“ä½œé£é™©å’Œå‰¯ä½œç”¨â€‹**â€‹ã€‚ä»¥ä¸‹æ˜¯å…³é”®ç»“è®ºå’Œä½¿ç”¨å»ºè®®ï¼š\n\n---\n\n### âœ… â€‹**â€‹æ­£é¢ä½œç”¨ï¼ˆçŸ­æœŸæ²»æ ‡ï¼‰â€‹**â€‹\n\n1. â€‹**â€‹èŠé…¯æˆåˆ†å³æ—¶ç­æ€â€‹**â€‹ï¼š\n    \n    - â€‹**â€‹æ°¯èŠé…¯ï¼ˆ0.3%ï¼‰+ é«˜æ•ˆæ°¯æ°°èŠé…¯ï¼ˆ0.06%ï¼‰â€‹**â€‹ èƒ½å¿«é€Ÿå‡»å€’ä¸‹æ°´é“å£é™„è¿‘æ´»åŠ¨çš„â€‹**â€‹æˆè™«â€‹**â€‹ï¼ˆæ¥è§¦è¯æ¶²åç˜«ç—ªæ­»äº¡ï¼‰ã€‚\n    - å¯¹åˆšç¾½åŒ–çˆ¬å‡ºçš„æ–°æˆè™«æœ‰â€œå®ˆæ ªå¾…å…”â€æ•ˆæœã€‚\n2. â€‹**â€‹å‰‚å‹éƒ¨åˆ†é€‚é…â€‹**â€‹ï¼š\n    \n    - æ°´ä¹³å‰‚ï¼ˆEWï¼‰æ¯”æ™®é€šå–·é›¾æ›´æ˜“é™„ç€ç®¡å£ï¼ŒçŸ­æš‚æ»ç•™ã€‚\n\n---\n\n### âš ï¸ â€‹**â€‹ä¸¥é‡ç¼ºé™·ä¸é£é™©ï¼ˆæ— æ³•æ²»æœ¬ï¼‰â€‹**â€‹\n\n|â€‹**â€‹é—®é¢˜â€‹**â€‹|â€‹**â€‹åŸå› åˆ†æâ€‹**â€‹|\n|---|---|\n|â€‹**â€‹ä¸æ€å¹¼è™«/åµâ€‹**â€‹|èŠé…¯æ— æ³•ç©¿é€è™«åµå’Œè›¹å£³ï¼Œå¯¹è—åœ¨ä¸‹æ°´é“æ·±å¤„çš„å¹¼è™«å‡ ä¹æ— æ•ˆã€‚|\n|â€‹**â€‹è¯æ•ˆçŸ­æš‚â€‹**â€‹|ä¸‹æ°´é“æ°´æµä¼šå†²èµ°è¯å‰‚ï¼Œæ®‹ç•™æ—¶é—´ä»…å‡ å°æ—¶ï¼Œæ— æ³•æŒä¹…é˜²æŠ¤ã€‚|\n|â€‹**â€‹æ±¡æŸ“é£é™©â€‹**â€‹|ç›´æ¥å€’è¯å‰‚ä¼šâ€‹**â€‹æ±¡æŸ“æ°´ä½“â€‹**â€‹ï¼ˆå¯¹é±¼ç±»å‰§æ¯’ï¼‰ï¼Œè¿åç¯ä¿æ³•è§„ï¼ˆåŒ…è£…æ ‡æ³¨â€œä½æ¯’â€æŒ‡æ¥è§¦æ¯’æ€§ï¼Œéç¯å¢ƒæ¯’æ€§ï¼‰ã€‚|\n|â€‹**â€‹è…èš€ç®¡é“â€‹**â€‹|é•¿æœŸä½¿ç”¨ä¹³å‰‚ä¸­çš„æº¶å‰‚å¯èƒ½è…èš€PVCç®¡é“æ¥å£æˆ–é‡‘å±éƒ¨ä»¶ã€‚|\n|â€‹**â€‹è¯±å¯¼æŠ—è¯æ€§â€‹**â€‹|åå¤ä½å‰‚é‡æš´éœ²ä¼šè®©é£è™«äº§ç”ŸèŠé…¯æŠ—æ€§ï¼Œåç»­æ›´éš¾é˜²æ²»ã€‚|\n\n---\n\n### ğŸ“‰ â€‹**â€‹æ•ˆæœå¯¹æ¯”è¡¨â€‹**â€‹\n\n|â€‹**â€‹å¤„ç†æ–¹å¼â€‹**â€‹|ç­æˆè™«ï¼ˆå³æ—¶ï¼‰|ç­å¹¼è™«ï¼ˆæ ¹æºï¼‰|æŒæ•ˆæœŸ|ç¯å¢ƒå½±å“|\n|---|---|---|---|---|\n|ç›´æ¥å€’å…¥ä¸‹æ°´é“|â­â­|âŒ|ï¼œ1å¤©|ğŸš« é«˜æ±¡æŸ“|\n|BTIé¢—ç²’æŠ•åœ°æ¼|âŒ|âœ…â­â­â­â­|1-2å‘¨|âœ… å®‰å…¨|\n|æ»ç•™å–·æ´’å¢™é¢|âœ…â­â­â­|âŒ|2å‘¨|âš ï¸ ä½é£é™©|\n\n---\n\n### ğŸ“Œ â€‹**â€‹ç§‘å­¦æ“ä½œå»ºè®®â€‹**â€‹\n\n1. â€‹**â€‹æ›¿ä»£æ–¹æ¡ˆï¼ˆæ¨èç»„åˆæ‹³ï¼‰â€‹**â€‹ï¼š\n    \n    - â€‹**â€‹å¹¼è™«æºå¤´ç­ç»â€‹**â€‹ï¼š  \n        âœ… ç”¨ â€‹**â€‹BTIä»¥è‰²åˆ—äºšç§é¢—ç²’å‰‚â€‹**â€‹ï¼ˆå¦‚ã€Œç­å­‘çµã€ï¼‰æŠ•å…¥åœ°æ¼ï¼Œæ¯2å‘¨1æ¬¡ï¼Œæ€å¹¼è™«æ–­æ ¹ã€‚\n    - â€‹**â€‹æˆè™«å¿«é€Ÿå‡»æ€â€‹**â€‹ï¼š  \n        âœ… åœ¨å¢™é¢ â€‹**â€‹30cmä»¥ä¸‹â€‹**â€‹ å–·æœ¬å“ï¼ˆæŒ‰è¯´æ˜ç¨€é‡Šï¼‰ä½œâ€‹**â€‹æ»ç•™å±‚â€‹**â€‹ï¼Œæˆè™«åœè½æ—¶è§¦æ€ã€‚\n2. â€‹**â€‹è‹¥åšæŒå€’å…¥ä¸‹æ°´é“ï¼ˆåº”æ€¥ï¼‰â€‹**â€‹ï¼š\n    \n    - â€‹**â€‹é™é¢‘æ¬¡â€‹**â€‹ï¼šæ¯æœˆâ‰¤1æ¬¡ï¼Œæ¯æ¬¡â‰¤20mlï¼ˆé¿å…ç§¯ç´¯æ±¡æŸ“ï¼‰ã€‚\n    - â€‹**â€‹é˜²æŠ¤â€‹**â€‹ï¼šæ“ä½œæ—¶æˆ´æ‰‹å¥—å£ç½©ï¼Œé€šé£2å°æ—¶ã€‚\n    - â€‹**â€‹å†²æ°´â€‹**â€‹ï¼šå€’å…¥åç«‹å³ç”¨å¤§é‡æ¸…æ°´å†²åˆ·ï¼Œå‡å°‘è¯å‰‚æ®‹ç•™ã€‚\n3. â€‹**â€‹å¢æ•ˆæŠ€å·§â€‹**â€‹ï¼š\n    \n    - å…ˆå€’å…¥ â€‹**â€‹çƒ­æ°´+å°è‹æ‰“â€‹**â€‹ æ¸…æ´ç®¡å£ç”Ÿç‰©è†œï¼Œå†æŠ•BTIé¢—ç²’ï¼ˆæ¸…æ´åå¹¼è™«æ›´æ˜“æ¥è§¦è¯å‰‚ï¼‰ã€‚\n\n---\n\n### ğŸŒ± â€‹**â€‹ç¯ä¿æé†’â€‹**â€‹\n\nç“¶èº«è™½æ ‡â€œä½æ¯’â€ï¼Œä½†â€‹**â€‹â€œç›´æ¥å€’å…¥ä¸‹æ°´é“â€è¿èƒŒå†œè¯ä½¿ç”¨è§„èŒƒâ€‹**â€‹ï¼ˆç™»è®°è¯WPâ€‹**â€‹â€‹**â€‹ä¸ºæ»ç•™å–·æ´’ç”¨é€”ï¼‰ã€‚  \nâŒ â€‹**â€‹åˆ‡å‹¿ç›²ç›®è·ŸéšåŒ…è£…å›¾ç¤ºæ“ä½œâ€‹**â€‹ï¼Œè¯¥è®¾è®¡ä»…ä¸ºè¥é”€è¯¯å¯¼æ¶ˆè´¹è€…ï¼\n\n---\n\n### ğŸ’ ç»ˆæå»ºè®®\n\nâ€‹**â€‹åœç”¨å€’å…¥æ³•ï¼â€‹**â€‹  \nğŸ‘‰ æŒ‰ã€Œæ»ç•™å–·æ´’ã€è¯´æ˜ä½¿ç”¨æœ¬å“ç­æˆè™«ï¼ˆå–·å¢™è§’ï¼‰+ â€‹**â€‹åšæŒç”¨BTIç­å¹¼è™«â€‹**â€‹ï¼ˆå¦‚æ‚¨å·²æœ‰çš„ã€Œå¹¼æ¸…ã€ç²‰å‰‚ï¼‰ï¼ŒåŒæ—¶ â€‹**â€‹æ¯å‘¨å¼€æ°´çƒ«åœ°æ¼+ç‰©ç†å¯†å°ç¼éš™â€‹**â€‹ï¼Œæ‰æ˜¯æ ¹é™¤é£è™«çš„å”¯ä¸€è·¯å¾„ã€‚","categories":["ç”Ÿæ´»"]},{"title":"ç½‘ç»œ_Boost.Asioåº“","url":"/ç½‘ç»œ/ç½‘ç»œ_Boost.Asioåº“/","content":"# `Boost::Asio`åº“\n`Boost::Asio`æ˜¯ä¸€ä¸ªç”¨äºç½‘ç»œå’Œå¼‚æ­¥ç¼–ç¨‹çš„`C++`åº“ï¼Œå®ƒæä¾›äº†ä¸€å¥—**è·¨å¹³å°çš„ç½‘ç»œç¼–ç¨‹æ¥å£**ï¼Œèƒ½å¤Ÿæ–¹ä¾¿åœ°åˆ›å»ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åº”ç”¨ç¨‹åºã€‚`Boost::Asio`æ”¯æŒåŒæ­¥å’Œå¼‚æ­¥æ“ä½œï¼Œå¯ä»¥å¤„ç†å¤šç§ç±»å‹çš„ç½‘ç»œåè®®ï¼ŒåŒ…æ‹¬TCPã€UDPã€SSLç­‰ã€‚\n## å®‰è£…\n```sh\nsudo apt-get install libboost-all-dev\n```\n## cmakeé…ç½®\nåœ¨Linuxç³»ç»Ÿä¸Šï¼Œé™¤äº†é“¾æ¥booståº“ä»¥å¤–ï¼Œè¿˜éœ€è¦é“¾æ¥pthreadåº“ã€‚\n```cmake\ncmake_minimum_required(VERSION 3.10.0)\nproject(boost-asio-demo VERSION 0.1.0 LANGUAGES C CXX)\n\nset(CMAKE_CXX_STANDARD 11)\n\nfind_package(Boost REQUIRED COMPONENTS system)\n\ninclude_directories(${Boost_INCLUDE_DIRS})\n\nadd_executable(server server.cpp)\ntarget_link_libraries(server ${Boost_LIBRARIES} pthread)\n\nadd_executable(client client.cpp)\ntarget_link_libraries(client ${Boost_LIBRARIES} pthread)\n\n```\n# demo\n## æœåŠ¡å™¨\n```cpp\n#include <iostream>\n#include <boost/asio.hpp>\nint main(int argc, char *argv[])\n{\n    boost::asio::io_service service;\n    boost::asio::ip::tcp::acceptor acceptor(service, \n        boost::asio::ip::tcp::endpoint(boost::asio::ip::tcp::v4(), 8888));\n    std::cout << \"Server started, listening on port 8888\" << std::endl;\n\n    while (1)\n    {\n        boost::asio::ip::tcp::socket socket(service);\n        acceptor.accept(socket);\n        std::cout <<\"Connection\" << std::endl;\n\n        std::string msg = \"Hello From Boost.Asio Server\\n\";\n        boost::system::error_code err;\n        boost::asio::write(socket, boost::asio::buffer(msg), err);\n    }\n}\n```\n## å®¢æˆ·ç«¯\n```cpp\n#include <iostream>\n#include <boost/asio.hpp>\nint main(int argc, char *argv[])\n{\n    boost::asio::io_service service;\n    boost::asio::ip::tcp::endpoint endpoint(boost::asio::ip::address::from_string(\"127.0.0.1\"), 8888);\n    boost::asio::ip::tcp::socket socket(service);\n    socket.connect(endpoint);\n    \n    boost::asio::streambuf buf;\n    boost::asio::read_until(socket, buf, \"\\n\");\n    \n    std::istream in(&buf);\n    std::string msg;\n    std::getline(in, msg);\n    std::cout << \"Received msg from server: \" << msg << std::endl;\n}\n```\n## æµ‹è¯•\n```\nmrcan@ubuntu:~/boost-asio-demo/build$ ./server \nServer started, listening on port 8888\nConnection\n```\n\n```\nmrcan@ubuntu:~/boost-asio-demo/build$ ./client \nReceived msg from server: Hello From Boost.Asio Server\n```","categories":["Cpp","ç½‘ç»œ"]},{"title":"ç½‘ç»œ_HTTPåè®®","url":"/ç½‘ç»œ/ç½‘ç»œ_HTTPåè®®/","content":"# httpåè®®æ ¼å¼è§„èŒƒ\nHTTPåè®®æ˜¯ä¸€ç§åº”ç”¨å±‚åè®®ï¼Œç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ•°æ®ã€‚\n\nHTTPåè®®è§„å®šäº†åœ¨ä¼ è¾“æ•°æ®æ—¶éœ€è¦éµå®ˆçš„ä¸€äº›çº¦å®šå’Œè§„èŒƒï¼Œä»¥ç¡®ä¿æ•°æ®çš„æ­£ç¡®ä¼ è¾“å’Œè§£é‡Šã€‚\nä»¥ä¸‹æ˜¯HTTPåè®®å¿…é¡»åŒ…å«çš„å‡ ä¸ªè¦ç´ ï¼š\n1. è¯·æ±‚è¡Œï¼šè¯·æ±‚è¡ŒåŒ…å«äº†å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚æ–¹æ³•ã€è¯·æ±‚çš„èµ„æºåœ°å€å’ŒHTTPåè®®çš„ç‰ˆæœ¬å·ã€‚ä¾‹å¦‚ï¼š\n\n```\nGET /index.htm1 HTTP/1.1\n```\n\nè¿™é‡Œçš„è¯·æ±‚æ–¹æ³•æ˜¯GETï¼Œè¯·æ±‚çš„èµ„æºåœ°å€æ˜¯`/index.html`ï¼ŒHTTPåè®®çš„ç‰ˆæœ¬å·æ˜¯1.1ã€‚\n\n2. è¯·æ±‚å¤´éƒ¨ï¼šè¯·æ±‚å¤´éƒ¨åŒ…å«äº†å®¢æˆ·ç«¯å‘é€è¯·æ±‚çš„ç›¸å…³ä¿¡æ¯ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯çš„User-Agentã€Accept-Languageç­‰ä¿¡æ¯ã€‚è¯·æ±‚å¤´éƒ¨ä»¥ä¸€ä¸ªç©ºè¡Œï¼ˆCRLFï¼‰ä½œä¸ºç»“æŸæ ‡å¿—ã€‚ä¾‹å¦‚ï¼š\n\n```\nHost: www.example.com\nUser-Agent: Mozi11a/5.0 (Windows NT 10.0; win64; x64; rv:89.0) Gecko/20100101 Firefox/89.0\nAccept: text/htm1,app1ication/xhtm1+xm1,app1ication/xm1;q=0.9,image/webp,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nConnection: keep-alive\n```\n\n3. è¯·æ±‚æ­£æ–‡ï¼ˆå¯é€‰ï¼‰ï¼šè¯·æ±‚æ­£æ–‡æ˜¯å®¢æˆ·ç«¯å‘é€è¯·æ±‚æ—¶æºå¸¦çš„æ•°æ®ï¼Œä¾‹å¦‚POSTè¯·æ±‚ä¸­çš„è¡¨å•æ•°æ®ã€‚è¯·æ±‚æ­£æ–‡é€šå¸¸ä»¥Content-Typeå¤´éƒ¨æŒ‡å®šæ•°æ®ç±»å‹ï¼Œä»¥åŠContent-Lengthå¤´éƒ¨æŒ‡å®šæ•°æ®é•¿åº¦ã€‚è¯·æ±‚æ­£æ–‡ä¸è¯·æ±‚å¤´éƒ¨ä¹‹é—´ä¹Ÿä»¥ä¸€ä¸ªç©ºè¡Œï¼ˆCRLFï¼‰ä½œä¸ºåˆ†éš”ç¬¦ã€‚\n4. å“åº”è¡Œï¼šå“åº”è¡ŒåŒ…å«äº†æœåŠ¡å™¨çš„å“åº”çŠ¶æ€ç ã€çŠ¶æ€ç å¯¹åº”çš„åŸå› çŸ­è¯­å’ŒHTTPåè®®çš„ç‰ˆæœ¬å·ã€‚ä¾‹å¦‚ï¼š\n\n```\nHTTP/1.1 200 OK\n```\n\nè¿™é‡Œçš„å“åº”çŠ¶æ€ç æ˜¯200ï¼ŒçŠ¶æ€ç å¯¹åº”çš„åŸå› çŸ­è¯­æ˜¯OKï¼ŒHTTPåè®®çš„ç‰ˆæœ¬å·æ˜¯1.1ã€‚\n\n5. å“åº”å¤´éƒ¨ï¼šå“åº”å¤´éƒ¨åŒ…å«äº†æœåŠ¡å™¨å‘é€å“åº”çš„ç›¸å…³ä¿¡æ¯ï¼Œä¾‹å¦‚æœåŠ¡å™¨çš„Serverã€Content-Typeã€Content-Lengthç­‰ä¿¡æ¯ã€‚å“åº”å¤´éƒ¨ä»¥ä¸€ä¸ªç©ºè¡Œï¼ˆCRLFï¼‰ä½œä¸ºç»“æŸæ ‡å¿—ã€‚ä¾‹å¦‚ï¼š\n\n```\nServer: Apache/2.4.41 (Ubuntu)\nContent-Type: text/html; charset=UTF-8\nContent-Length: 1234\n<htm1>\n  <body>He11o HTTP</body>\n</html>\n```\n\n6. å“åº”æ­£æ–‡ï¼ˆå¯é€‰ï¼‰ï¼šå“åº”æ­£æ–‡æ˜¯æœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯çš„æ•°æ®ï¼Œä¾‹å¦‚HTMLé¡µé¢ã€å›¾ç‰‡ã€JSONæ•°æ®ç­‰ã€‚å“åº”æ­£æ–‡é€šå¸¸ä»¥ Content-Type å¤´éƒ¨æŒ‡å®šæ•°æ®ç±»å‹ï¼Œä»¥åŠ Content-Length å¤´éƒ¨æŒ‡å®šæ•°æ®é•¿åº¦ã€‚å“åº”æ­£æ–‡ä¸å“åº”å¤´éƒ¨ä¹‹é—´ä¹Ÿä»¥ä¸€ä¸ªç©ºè¡Œï¼ˆCRLFï¼‰ä½œä¸ºåˆ†éš”ç¬¦ã€‚\n\næ€»ä¹‹ï¼ŒHTTPåè®®è¦æ±‚æ¯ä¸ªè¯·æ±‚å’Œå“åº”éƒ½åŒ…å«ä¸€äº›å¿…è¦çš„å…ƒç´ ï¼ŒåŒ…æ‹¬è¯·æ±‚è¡Œã€è¯·æ±‚å¤´éƒ¨ã€è¯·æ±‚æ­£æ–‡ã€å“åº”è¡Œã€å“åº”å¤´éƒ¨å’Œå“åº”æ­£æ–‡ã€‚è¿™äº›å…ƒç´ åŒ…å«äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ•°æ®æ‰€å¿…éœ€çš„ä¿¡æ¯ï¼Œä»¥ç¡®ä¿æ•°æ®çš„æ­£ç¡®ä¼ è¾“å’Œè§£é‡Šã€‚\n# HttpServer\nä»¥ä¸‹ä»£ç ï¼ŒServerå¯ä»¥åšåˆ°ï¼š\nç»‘å®šç«¯å£ï¼Œç›‘å¬è¿æ¥ã€‚\næ¥å—è¿æ¥ï¼Œæ¥æ”¶è¯·æ±‚æ•°æ®ã€‚\nè§£æè¯·æ±‚æ•°æ®ã€‚\n```cpp\n// http_server.cpp\n#include <iostream>\n#include <netinet/in.h>\n#include <arpa/inet.h>\n#include <unistd.h>\n#include <sstream>\nclass HttpServer\n{\npublic:\n    HttpServer(unsigned short port) : m_port(port)\n    {\n\n    }\n    void start()\n    {\n        int error = 0;\n        int server_fd = socket(AF_INET, SOCK_STREAM, 0);\n        if (server_fd < 0)\n        {\n            std::cerr << \"Failed to create socket\" << std::endl;\n            return;\n        }\n        struct sockaddr_in server_addr;\n        server_addr.sin_family = AF_INET;\n        server_addr.sin_port = htons(m_port);\n        error = inet_pton(AF_INET, \"127.0.0.1\", &(server_addr.sin_addr.s_addr));\n        if (error == -1)\n        {\n            std::cerr << \"Failed to inet_pton\" << std::endl;\n            return;\n        }\n        error = bind(server_fd, (struct sockaddr*)&server_addr, sizeof(server_addr));\n        if (error == -1)\n        {\n            std::cerr << \"Failed to bind\" << std::endl;\n            return;\n        }\n        error = listen(server_fd, 5);\n        if (error == -1)\n        {\n            std::cerr << \"Failed to listen\" << std::endl;\n            return;\n        }\n        std::cout << \"Server started on port: \" << m_port << std::endl;\n        struct sockaddr_in client_addr;\n        while (1)\n        {\n            socklen_t client_addr_len = sizeof(client_addr);\n            int client_fd = accept(server_fd, (struct sockaddr*)&client_addr, &client_addr_len);\n            if (client_fd < 0)\n            {\n                std::cerr << \"Failed to accept\" << std::endl;\n                return;\n            }\n            std::cout << \"Accepted connection from \" << inet_ntoa(client_addr.sin_addr) << std::endl;\n            char request[1024] = {0};\n            int len = read(client_fd, request, sizeof(request));\n            if (len < 0)\n            {\n                std::cerr << \"Failed to read\" << std::endl;\n                close(client_fd);\n                return;\n            }\n            std::cout << \"=========================\" << std::endl;\n            printf(\"%s\", request);\n            std::cout << \"=========================\" << std::endl;\n            std::stringstream request_stream(request);\n            std::string method, path, http_version;\n            request_stream >> method >> path >> http_version;\n            std::cout << \"http method:\" << method << std::endl;\n            std::cout << \"http path:\" << path << std::endl;\n            std::cout << \"http version:\" << http_version << std::endl;\n            close(client_fd);\n        }\n        close(server_fd);\n    }\nprivate:\n    unsigned short m_port;\n};\nint main(int argc, char *argv[])\n{\n    if (argc < 2)\n    {\n        std::cerr << \"Usage: HttpServer <port>\\n\";\n        return 1;\n    }\n    HttpServer http_server(std::atoi(argv[1]));\n    http_server.start();\n    return 0;\n}\n```\nè¿è¡Œï¼š\n```sh\n./HttpServer 9999\n```\nå½“æµè§ˆå™¨è®¿é—®`http://127.0.0.1:9999/index.thml`æ—¶ï¼Œæ§åˆ¶å°è¾“å‡ºï¼š\n```\nAccepted connection from 127.0.0.1\n=========================\nGET /index.html HTTP/1.1\nHost: 127.0.0.1:9999\nUser-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:136.0) Gecko/20100101 Firefox/136.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate, br, zstd\nConnection: keep-alive\nUpgrade-Insecure-Requests: 1\nSec-Fetch-Dest: document\nSec-Fetch-Mode: navigate\nSec-Fetch-Site: none\nSec-Fetch-User: ?1\nPriority: u=0, i\n\n=========================\nhttp method:GET\nhttp path:/index.html\nhttp version:HTTP/1.1\n\n```\n## å“åº”\n```cpp\n#include <iostream>\n#include <netinet/in.h>\n#include <arpa/inet.h>\n#include <unistd.h>\n#include <sstream>\n#include <fstream>\nclass HttpServer\n{\npublic:\n    HttpServer(unsigned short port) : m_port(port)\n    {\n\n    }\n    void start()\n    {\n        int error = 0;\n        \n        // ...\n        \n        struct sockaddr_in client_addr;\n        while (1)\n        {\n            socklen_t client_addr_len = sizeof(client_addr);\n            int client_fd = accept(server_fd, (struct sockaddr*)&client_addr, &client_addr_len);\n            if (client_fd < 0)\n            {\n                std::cerr << \"Failed to accept\" << std::endl;\n                return;\n            }\n            std::cout << \"Accepted connection from \" << inet_ntoa(client_addr.sin_addr) << std::endl;\n            char request[1024] = {0};\n            int len = read(client_fd, request, sizeof(request));\n            if (len < 0)\n            {\n                std::cerr << \"Failed to read\" << std::endl;\n                close(client_fd);\n                return;\n            }\n            std::cout << \"=========================\" << std::endl;\n            printf(\"%s\", request);\n            std::cout << \"=========================\" << std::endl;\n            std::stringstream request_stream(request);\n            std::string method, path, http_version;\n            request_stream >> method >> path >> http_version;\n            std::cout << \"http method:\" << method << std::endl;\n            std::cout << \"http path:\" << path << std::endl;\n            std::cout << \"http version:\" << http_version << std::endl;\n\n            if (method != \"GET\")\n            {\n                bad_request(client_fd);\n            }\n            else\n            {\n                std::string filename = \".\" + path;\n                if (filename.find(\"..\") != std::string::npos)\n                {\n                    forbidden(client_fd);\n                }\n                else\n                {\n                    std::string content = get_file_content(filename);\n                    if (content.empty())\n                    {\n                        not_found(client_fd);\n                    }\n                    else\n                    {\n                        ok(client_fd, content);\n                    }\n                }\n            }\n            close(client_fd);\n        }\n        close(server_fd);\n    }\nprivate:\n    std::string get_file_content(const std::string& filename)\n    {\n        std::fstream fs(filename);\n        std::stringstream buffer;\n        buffer << fs.rdbuf();   // fs.rebuf()çš„å†…å®¹è¾“å‡ºç»™buffer\n        return buffer.str();\n    }\n    void bad_request(int client_fd)\n    {\n        std::string response = \"HTTP/1.1 400 Bad Request\\r\\n\";\n        send(client_fd, response.c_str(), response.length(), 0);\n    }\n    void not_found(int client_fd)\n    {\n        std::string response = \"HTTP/1.1 404 Not Found\\r\\n\";\n        send(client_fd, response.c_str(), response.length(), 0);\n    }\n    void forbidden(int client_fd)\n    {\n        std::string response = \"HTTP/1.1 403 Forbidden\\r\\n\";\n        send(client_fd, response.c_str(), response.length(), 0);\n    }\n    void ok(int client_fd, std::string content)\n    {\n        std::ostringstream response_steam;\n        response_steam  << \"HTTP/1.1 200 OK\\r\\n\"\n                        << \"Content-Type: text/html\\r\\n\"\n                        << \"Content-Length: \" << content.length() << \"\\r\\n\"\n                        << \"\\r\\n\"\n                        << content;\n        std::string response(response_steam.str());\n        send(client_fd, response.c_str(), response.length(), 0);\n    }\nprivate:\n    unsigned short m_port;\n};\nint main(int argc, char *argv[])\n{\n    if (argc < 2)\n    {\n        std::cerr << \"Usage: HttpServer <port>\\n\";\n        return 1;\n    }\n    HttpServer http_server(std::atoi(argv[1]));\n    http_server.start();\n    return 0;\n}\n```\næˆ‘ä»¬åœ¨ä¸»ç¨‹åºçš„å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª`index.html`\n```html\nThis is xcg test HTML\n```\nè¿è¡Œï¼š\n```sh\n./HttpServer 9999\n```\nç»“æœï¼š\n```\nmrcan@ubuntu:~/http_demo/build$ ./HttpServer 9999\nServer started on port: 9999\nAccepted connection from 127.0.0.1\n=========================\nGET /index.html HTTP/1.1\nHost: 127.0.0.1:9999\nUser-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:136.0) Gecko/20100101 Firefox/136.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate, br, zstd\nConnection: keep-alive\nUpgrade-Insecure-Requests: 1\nSec-Fetch-Dest: document\nSec-Fetch-Mode: navigate\nSec-Fetch-Site: none\nSec-Fetch-User: ?1\nPriority: u=0, i\n\n=========================\nhttp method:GET\nhttp path:/index.html\nhttp version:HTTP/1.1\nAccepted connection from 127.0.0.1\n=========================\nGET /favicon.ico HTTP/1.1\nHost: 127.0.0.1:9999\nUser-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:136.0) Gecko/20100101 Firefox/136.0\nAccept: image/avif,image/webp,image/png,image/svg+xml,image/*;q=0.8,*/*;q=0.5\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate, br, zstd\nConnection: keep-alive\nReferer: http://127.0.0.1:9999/index.html\nSec-Fetch-Dest: image\nSec-Fetch-Mode: no-cors\nSec-Fetch-Site: same-origin\nPriority: u=6\n\n=========================\nhttp method:GET\nhttp path:/favicon.ico\nhttp version:HTTP/1.1\n\n```\nå®¢æˆ·ç«¯æµè§ˆå™¨æ˜¾ç¤ºï¼š\n![](../../images/ç½‘ç»œ_HTTPåè®®/image-20250726160319160.png)\n\n","categories":["ç½‘ç»œ","HTTP"]},{"title":"ç½‘ç»œ_UDP","url":"/ç½‘ç»œ/ç½‘ç»œ_UDP/","content":"# UDPç»„æ’­çš„æ¦‚å¿µ\nå•æ’­æ˜¯æŒ‡å°†æ•°æ®åŒ…ä»1ä¸ªå‘é€æ–¹åˆ°1ä¸ªç‰¹å®šçš„æ¥æ”¶æ–¹ã€‚\nç»„æ’­æ˜¯æŒ‡å°†æ•°æ®åŒ…ä»1ä¸ªå‘é€æ–¹åˆ°1ç»„ç‰¹å®šçš„æ¥æ”¶æ–¹ã€‚è¿™ä¸ªç»„æ˜¯é¢„å…ˆå®šä¹‰çš„ï¼Œè¿™äº›æ¥æ”¶æ–¹å…±äº«åŒä¸€ä¸ªç»„æ’­åœ°å€ã€‚\n\nåœ¨IPv4ä¸­ï¼Œç»„æ’­åœ°å€æ˜¯æœ‰èŒƒå›´å’Œè§„å®šçš„ï¼Œä¸èƒ½éšä¾¿å†™ã€‚IPv4çš„ç»„æ’­åœ°å€èŒƒå›´æ˜¯`224.0.0.0`åˆ°`239.255.255.255`ã€‚\nå…¶ä¸­ï¼Œ`224.0.0.0`åˆ°`224.0.0.255`æ˜¯é¢„ç•™çš„ï¼Œç”¨äºæœ¬åœ°é“¾æ¥çš„å¤šæ’­åœ°å€ï¼ˆLink-Local Multicast Addressesï¼‰ï¼Œè€Œå…¶ä»–èŒƒå›´çš„åœ°å€æ‰å¯ä»¥ç”¨äºå…¨å±€ç»„æ’­ã€‚\nåœ¨é€‰æ‹©ç»„æ’­åœ°å€æ—¶ï¼Œåº”è¯¥éµå¾ªè§„èŒƒï¼Œé¿å…ä½¿ç”¨é¢„ç•™çš„åœ°å€æˆ–è€…å…¶ä»–å¯èƒ½ä¼šå¼•èµ·å†²çªçš„åœ°å€ã€‚\né€šå¸¸å»ºè®®ä»`239.0.0.0`å¼€å§‹å‘ä¸Šé€‰æ‹©ï¼Œç¡®ä¿ä¸ä¼šä¸å…¶ä»–ç»„æ’­ç»„å†²çªã€‚\n\n# setsockopt()\n`setsockopt()`å‡½æ•°æ˜¯ç³»ç»Ÿè°ƒç”¨ï¼Œç”¨äºè®¾ç½®å¥—æ¥å­—é€‰é¡¹ï¼Œå®ƒå…è®¸ç¨‹åºå‘˜ä¸ºæ‰“å¼€çš„å¥—æ¥å­—è®¾ç½®ä¸åŒçš„é€‰é¡¹å’Œå‚æ•°\n```c\nint setsockpt(int sockfd, int level, int optname, const void *optval, socklen_t optlen);\n```\n\nå‚æ•°ï¼š\n1. `sockfd`ï¼šæŒ‡å®šè¦è®¾ç½®é€‰é¡¹çš„å¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦ã€‚\n2. `level`ï¼šæŒ‡å®šé€‰é¡¹æ‰€åœ¨çš„åè®®å±‚ã€‚å¸¸ç”¨çš„æœ‰`SOL_SOCKET`è¡¨ç¤ºå¥—æ¥å­—çº§åˆ«çš„é€‰é¡¹ï¼Œ`IPPROTO_IP`è¡¨ç¤ºIPå±‚çš„é€‰é¡¹ï¼Œ`IPPROTO_TCP`è¡¨ç¤ºTCPå±‚çš„é€‰é¡¹ï¼Œ`IPPROTO_IPV6`è¡¨ç¤ºIPV6å±‚çš„é€‰é¡¹ç­‰ã€‚\n3. `optname`ï¼šæŒ‡å®šè¦è®¾ç½®çš„é€‰é¡¹åã€‚\n    1. `IP_ADD_MEMBERSHIP`ï¼šåŠ å…¥ç»„æ’­ç»„\n    2. `IP_DROP_MEMBERSHIP`ï¼šé€€å‡ºç»„æ’­ç»„\n4. `optval`ï¼šæŒ‡å‘åŒ…å«é€‰é¡¹å€¼çš„ç¼“å†²åŒºçš„æŒ‡é’ˆã€‚\n5. `optlen`ï¼šæŒ‡å®šé€‰é¡¹å€¼çš„é•¿åº¦ã€‚\n\n# å‘é€ç«¯\n```cpp\n// multicast_send.cpp\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <arpa/inet.h>\n#include <iostream>\n#include <unistd.h>\nconst int PORT = 8888;\nconst char *MULTICAST_ADDR = \"239.0.0.1\";\nconst int MAX_MSG_LEN = 1024;\n\nvoid sender()\n{\n    int sock;\n    sock = socket(AF_INET, SOCK_DGRAM, 0);\n\n    struct sockaddr_in addr;\n    addr.sin_family = AF_INET;\n    addr.sin_port = htons(PORT);\n    inet_pton(AF_INET, MULTICAST_ADDR, &(addr.sin_addr.s_addr));\n\n    std::string msg = \"Hello, multicast\";\n\n    sendto(sock, msg.c_str(), msg.length(), 0, (struct sockaddr*)&addr, sizeof(addr));\n\n    std::cout << \"Message sent: \" << msg << std::endl;\n\n}\nint main()\n{\n    sender();\n}\n```\n# æ¥æ”¶ç«¯\n1. ä¸å•æ’­ä¸åŒï¼Œsockaddréœ€è¦å†™å…¥IPåœ°å€ä¸º`0.0.0.0`ã€ç«¯å£å·ä¸ºä¸æœåŠ¡ç«¯çº¦å®šå¥½çš„ç»„æ’­ç«¯å£ï¼ˆæœ¬ä¾‹ä¸º8888ï¼‰\n2. éœ€è¦ç»‘å®šåˆ›å»ºçš„sock å’Œ ä¸Šé¢å¡«å†™å¥½çš„sockaddr\n3. è¿˜éœ€è¦å†™å…¥ä¸€ä¸ª`ip_mreq`ç»“æ„ã€‚\n    1. æŒ‡æ˜`imr_multiaddr`ï¼Œå†™å…¥ä¸æœåŠ¡ç«¯çº¦å®šå¥½çš„ç»„æ’­åœ°å€ï¼ˆæœ¬ä¾‹ä¸º`239.0.0.1`ï¼‰\n    2. æŒ‡æ˜`imr_interface`ï¼Œå†™å…¥`0.0.0.0`ï¼ˆæœ¬åœ°åœ°å€ï¼‰\n4. setsockopt è®¾ç½® sock åŠ å…¥ç»„æ’­ç»„ã€‚\n    1. åœ¨è°ƒç”¨`setsockopt`å‡½æ•°æ—¶ï¼Œå‚æ•°`&mreq, sizeof(mreq)`çš„ä½œç”¨æ˜¯ä¼ é€’ä¸€ä¸ª`ip_mreq`ç»“æ„ä½“åŠå…¶å¤§å°ç»™å†…æ ¸ï¼Œä»¥ä¾¿å†…æ ¸æ ¹æ®è¿™ä¸ªç»“æ„ä½“ä¸­çš„ä¿¡æ¯å°†å¥—æ¥å­—åŠ å…¥åˆ°æŒ‡å®šçš„ç»„æ’­ç»„ã€‚\n5. ç”¨çš„æ˜¯recvæ¥æ”¶ï¼Œè€Œä¸æ˜¯å•æ’­æ—¶çš„recvfromã€‚ï¼ˆå…¶å®recvfromä¹Ÿè¡Œï¼Œä½†æ˜¯æ¥æ”¶æ–¹å¿…é¡»ç»‘å®šsockå’Œç»„æ’­ç«¯å£ï¼‰\n\n## `imr_multiaddr`å’Œ`imr_interface`æœ‰ä»€ä¹ˆåŒºåˆ«\n```c\nstruct ip_mreq\n{\n    struct in_addr imr_multiaddr;  /* ç»„æ’­ç»„IPåœ°å€ */\n    struct in_addr imr_interface;  /* æœ¬åœ°æ¥å£IPåœ°å€ */\n};\n```\nåœ¨ç»„æ’­ç¼–ç¨‹ä¸­ï¼Œ`struct ip_mreq`Â ç»“æ„ä½“ç”¨äºç®¡ç†ç»„æ’­ç»„æˆå‘˜å…³ç³»ï¼Œå…¶ä¸­ä¸¤ä¸ªå…³é”®å­—æ®µçš„åŒºåˆ«å¦‚ä¸‹ï¼š\n\n|ç‰¹æ€§|`imr_multiaddr`|`imr_interface`|\n|---|---|---|\n|â€‹**â€‹ä½œç”¨â€‹**â€‹|æŒ‡å®šè¦åŠ å…¥/ç¦»å¼€çš„â€‹**â€‹ç»„æ’­ç»„â€‹**â€‹|æŒ‡å®šç”¨äºç»„æ’­é€šä¿¡çš„â€‹**â€‹ç½‘ç»œæ¥å£â€‹**â€‹|\n|â€‹**â€‹åœ°å€ç±»å‹â€‹**â€‹|Dç±»IPåœ°å€ï¼ˆ224.0.0.0-239.255.255.255ï¼‰|æœ¬æœºçœŸå®IPåœ°å€æˆ–`INADDR_ANY`|\n|â€‹**â€‹ç¤ºä¾‹å€¼â€‹**â€‹|239.0.0.1|192.168.1.100 æˆ–Â `INADDR_ANY`|\n|â€‹**â€‹å¿…è¦æ€§â€‹**â€‹|å¿…é¡»æ­£ç¡®è®¾ç½®|å¯é€‰ï¼ˆä¸è®¾ç½®æ—¶ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©ï¼‰|\n|â€‹**â€‹ç”¨é€”â€‹**â€‹|æ ‡è¯†é€šä¿¡çš„ç›®æ ‡ç»„|é€‰æ‹©æ”¶å‘ç»„æ’­æ•°æ®çš„ç‰©ç†/è™šæ‹Ÿç½‘å¡|\n### `imr_multiaddr`ï¼ˆç»„æ’­ç»„åœ°å€ï¼‰\n- â€‹**â€‹å®šä¹‰â€‹**â€‹ï¼šè¡¨ç¤ºè¦åŠ å…¥æˆ–ç¦»å¼€çš„ç»„æ’­ç»„\n- â€‹**â€‹ç»„æ’­åœ°å€èŒƒå›´â€‹**â€‹ï¼š224.0.0.0 åˆ° 239.255.255.255ï¼ˆDç±»IPï¼‰\n- â€‹**â€‹æ°¸ä¹…ç»„æ’­åœ°å€â€‹**â€‹ï¼š224.0.0.1ï¼ˆæ‰€æœ‰ä¸»æœºï¼‰ã€224.0.0.2ï¼ˆæ‰€æœ‰è·¯ç”±å™¨ï¼‰\n- â€‹**â€‹ä¸´æ—¶ç»„æ’­åœ°å€â€‹**â€‹ï¼š239.x.x.xï¼ˆç®¡ç†å‘˜å®šä¹‰èŒƒå›´ï¼‰\n### `imr_interface`ï¼ˆæœ¬åœ°æ¥å£åœ°å€ï¼‰\n- **å®šä¹‰â€‹**â€‹ï¼šæŒ‡å®šç”¨äºç»„æ’­é€šä¿¡çš„ç½‘ç»œæ¥å£\n- â€‹**â€‹ç‰¹ç‚¹â€‹**â€‹ï¼š\n    - å¯ä»¥æ˜¯æœ¬æœºå…·ä½“IPï¼ˆ192.168.1.100ï¼‰\n    - ä¹Ÿå¯ä»¥æ˜¯ç‰¹æ®Šå€¼ï¼š\n        - `INADDR_ANY`Â (0.0.0.0)ï¼šè®©â€‹**â€‹ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©â€‹**â€‹é»˜è®¤è·¯ç”±æ¥å£\n        - `INADDR_LOOPBACK`Â (127.0.0.1)ï¼šé™å®šä¸ºæœ¬åœ°ç¯å›\n\n```c\n// è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜ç½‘å¡ï¼ˆæ¨èï¼‰\nmreq.imr_interface.s_addr = htonl(INADDR_ANY);\n\n// æŒ‡å®šå…·ä½“æ¥å£ï¼ˆæœ‰å¤šä¸ªç½‘å¡æ—¶ï¼‰\ninet_pton(AF_INET, \"192.168.1.100\", &mreq.imr_interface);\n```\n\nä¸èƒ½æŒ‡å®š`127.0.0.1`æ¢å›æ¥å£ã€‚å½“æ¥æ”¶å¤–éƒ¨ç»„æ’­æ—¶ï¼Œå³ä½¿å‘é€æ–¹æ˜¯åœ¨æœ¬æœºä¸Šï¼Œä½†æŒ‡å®šç¯å›åœ°å€ä¼šå¯¼è‡´æ¥æ”¶æ–¹ä¸èƒ½æ¥æ”¶æœ¬åœ°çš„ç»„æ’­æ•°æ®ã€‚\n### æ­£ç¡®ç¤ºä¾‹\n```c\nstruct ip_mreq mreq;\n\n// 1. è®¾ç½®ç»„æ’­ç»„ï¼ˆå›ºå®šDç±»åœ°å€ï¼‰\ninet_pton(AF_INET, \"239.0.0.100\", &mreq.imr_multiaddr);\n\n// 2 ä»¥ä¸‹è€ƒè™‘åˆ°äº†å¤šç½‘å¡çš„åœºæ™¯ï¼Œä¸‰é€‰ä¸€ï¼š\n// 2.1 ç›‘å¬æ‰€æœ‰å¯ç”¨ç½‘å¡ä¸Šçš„ç»„æ’­æµé‡ï¼ˆè®©ç³»ç»Ÿé€‰æ‹©æœ€ä¼˜æ¥å£ï¼‰\nmreq.imr_interface.s_addr = INADDR_ANY;\n// æˆ–è€…æŒ‡å®šç‰¹å®šç½‘å¡ï¼Œéœ€è¦å†™æœ¬åœ°å…·ä½“ipåœ°å€\n// 2.2 æœ‰çº¿ç½‘å¡\nconst char* iface_ip = \"192.168.1.100\"; \ninet_pton(AF_INET, iface_ip, &mreq.imr_interface);\n// 2.3 æ— çº¿ç½‘å¡\nconst char* wifi_ip = \"10.0.0.5\"; \ninet_pton(AF_INET, wifi_ip, &mreq.imr_interface);\n\n// 3. åŠ å…¥ç»„æ’­ç»„\nsetsockopt(sock, IPPROTO_IP, IP_ADD_MEMBERSHIP, &mreq, sizeof(mreq));\n```\n\n## ä¸ºä»€ä¹ˆæ¥æ”¶ç«¯è¦ç»‘å®šï¼Ÿ\nåœ¨ç»„æ’­æ¥æ”¶ç«¯ï¼Œ`bind`æ“ä½œæ˜¯â€‹**â€‹å¿…é¡»â€‹**â€‹çš„ï¼Œå› ä¸ºï¼š\n1. ç»„æ’­æ•°æ®åŒ…æ˜¯é€šè¿‡UDPä¼ è¾“çš„ï¼Œè€ŒUDPæ˜¯æ— è¿æ¥çš„ã€‚\n2. æ“ä½œç³»ç»Ÿéœ€è¦çŸ¥é“å°†å“ªäº›ç«¯å£ä¸Šçš„æ•°æ®ä¼ é€’ç»™åº”ç”¨ç¨‹åºã€‚\n\nå¦‚æœä½ ä¸è°ƒç”¨`bind`ï¼Œé‚£ä¹ˆä½ çš„å¥—æ¥å­—å°±æ²¡æœ‰ä¸æœ¬åœ°ç«¯å£å…³è”ï¼Œæ“ä½œç³»ç»Ÿå°±ä¸ä¼šå°†æ”¶åˆ°çš„æ•°æ®åŒ…é€’é€åˆ°è¯¥å¥—æ¥å­—ã€‚å› æ­¤ï¼Œä½ æ— æ³•æ”¶åˆ°ä»»ä½•ç»„æ’­æ•°æ®ã€‚\n\n`recvfrom`å‡½æ•°æ˜¯ç”¨æ¥æ¥æ”¶æ•°æ®å¹¶è·å–å‘é€è€…çš„åœ°å€ï¼Œä½†æ˜¯å®ƒå¹¶ä¸èƒ½æ›¿ä»£`bind`ã€‚å®é™…ä¸Šï¼Œ`recvfrom`é€šå¸¸æ˜¯åœ¨å·²ç»ç»‘å®šçš„å¥—æ¥å­—ä¸Šä½¿ç”¨çš„ã€‚\n\nå› æ­¤ï¼Œæ­£ç¡®çš„æ­¥éª¤æ˜¯ï¼š\n1. åˆ›å»ºå¥—æ¥å­—ã€‚\n2. ç»‘å®šåˆ°æŒ‡å®šçš„ç«¯å£ï¼ˆé€šå¸¸è¿˜ä¼šæŒ‡å®šåœ°å€ä¸º`INADDR_ANY`ï¼Œå³`0.0.0.0`ï¼‰ã€‚\n3. åŠ å…¥ç»„æ’­ç»„ï¼ˆé€šè¿‡`setsockopt`è®¾ç½®IP_ADD_MEMBERSHIPï¼‰ã€‚\n4. ä½¿ç”¨`recvfrom`ï¼ˆæˆ–è€…`recv`ï¼‰æ¥æ”¶æ•°æ®ã€‚\n\næ‰€ä»¥ï¼Œå³ä½¿ä½ æƒ³ä½¿ç”¨`recvfrom`æ¥è·å–å‘é€è€…çš„ä¿¡æ¯ï¼Œä½ ä»ç„¶éœ€è¦å…ˆç»‘å®šç«¯å£ã€‚\n\nå¦‚æœä½ å°è¯•ä¸ç»‘å®šï¼Œé‚£ä¹ˆä½ å°†ä¼šçœ‹åˆ°`recvfrom`è°ƒç”¨ä¼šå¤±è´¥ï¼Œå¹¶è¿”å›ä¸€ä¸ªé”™è¯¯ï¼ˆä¾‹å¦‚â€œTransport endpoint is not connectedâ€æˆ–è€…â€œInvalid argumentâ€ï¼‰ã€‚\n\nå› æ­¤ï¼Œç»“è®ºæ˜¯ï¼šä¸èƒ½çœç•¥`bind`æ­¥éª¤ï¼Œå³ä½¿ä½ æ‰“ç®—ä½¿ç”¨`recvfrom`ã€‚\n### `bind()`çš„æ ¸å¿ƒä½œç”¨ - â€‹å£°æ˜ç«¯å£æ‰€æœ‰æƒâ€‹\n- ä½œç”¨ï¼šå‘ŠçŸ¥å†…æ ¸ï¼š\"æˆ‘è´Ÿè´£å¤„ç†æœ¬æœºæ‰€æœ‰ç½‘å¡ä¸ŠæŒ‡å®šç«¯å£çš„UDPæµé‡\"\n\nåº•å±‚åŸç†ï¼š\n```c\n// å†…æ ¸ç½‘ç»œæ ˆä¼ªä»£ç \nvoid udp_input(struct sk_buff *skb) {\n    // æŸ¥æ‰¾ç»‘å®šå¯¹åº”ç«¯å£çš„å¥—æ¥å­—\n    sock = udp_v4_lookup(skb->dport); \n    if (sock) deliver_to_socket(sock, skb);\n    else discard_packet(); // âš ï¸ æœªç»‘å®šåˆ™ä¸¢å¼ƒåŒ…\n}\n```\n### `setsockopt()`çš„ä½œç”¨ - â€‹è®¢é˜…ç»„æ’­é¢‘é“â€‹\n- ä½œç”¨ï¼šå‘Šè¯‰ç½‘ç»œé©±åŠ¨ï¼š\"æˆ‘å¯¹Â ç‰¹å®šç»„æ’­åœ°å€Â çš„æµé‡æ„Ÿå…´è¶£\"\n- è§¦å‘å†…æ ¸è¿›è¡Œï¼š\n    - IGMPåŠ å…¥æŠ¥æ–‡å‘é€ï¼ˆé€šçŸ¥è·¯ç”±å™¨ï¼‰\n    - è®¾ç½®ç½‘å¡ç»„æ’­è¿‡æ»¤å™¨\n## ä»£ç \n```cpp\n// multicast_recv.cpp\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <arpa/inet.h>\n#include <iostream>\n#include <unistd.h>\nconst int PORT = 8888;\nconst char *MULTICAST_ADDR = \"239.0.0.1\";\nconst int MAX_MSG_LEN = 1024;\nvoid receiver()\n{\n    int sock = socket(AF_INET, SOCK_DGRAM, 0);\n\n    struct sockaddr_in addr;\n    addr.sin_family = AF_INET;\n    addr.sin_port = htons(PORT);\n    inet_pton(AF_INET, \"0.0.0.0\", &(addr.sin_addr.s_addr));\n    // ç»‘å®šsock å’Œ addr\n    bind(sock, (struct sockaddr*)&addr, sizeof(addr));\n\n    // æœ¬åœ°çš„IPæ¥å£åŠ å…¥åˆ°ç»„æ’­åœ°å€ä¸­\n    // IPv4 multicast request.\n    struct ip_mreq mreq;\n    // æŒ‡å®šç»„æ’­åœ°å€\n    inet_pton(AF_INET, MULTICAST_ADDR, &(mreq.imr_multiaddr.s_addr));\n    inet_pton(AF_INET, \"0.0.0.0\", &(mreq.imr_interface.s_addr));\n\n    setsockopt(sock, IPPROTO_IP, IP_ADD_MEMBERSHIP, &mreq, sizeof(mreq));\n\n    char buffer[MAX_MSG_LEN + 1] = {0};\n    int len = recv(sock, buffer, MAX_MSG_LEN, 0);\n\n    buffer[len] = '\\0';\n\n    std::cout << \"Received message: \" << buffer << std::endl;\n    close(sock);\n}\nint main()\n{\n    receiver();\n}\n```\n# é—®é¢˜\n## ä¸ºä»€ä¹ˆå‘é€ç«¯å‘ç»™çš„æ˜¯8888ï¼Œæ¥æ”¶ç«¯ä¹Ÿè¦ä»æœ¬åœ°çš„8888æ¥æ”¶ï¼Ÿ\n1. â€‹**â€‹ç»„æ’­åœ°å€æ˜¯é€»è¾‘åˆ†ç»„â€‹**â€‹ï¼ˆå¦‚239.0.0.1ï¼‰\n    - åªè´Ÿè´£æ ‡è¯†ç»„æ’­ç»„ï¼Œä¸åŒ…å«ç«¯å£ä¿¡æ¯\n    - ç›¸å½“äº\"å¹¿æ’­é¢‘é“\"ï¼Œä½†æ— æ³•å•ç‹¬åŒºåˆ†ä¸åŒåº”ç”¨\n2. â€‹**â€‹ç«¯å£å·æ ‡è¯†å…·ä½“æœåŠ¡â€‹**â€‹\n    - æ¥æ”¶ç«¯é€šè¿‡ç»‘å®šç‰¹å®šç«¯å£ï¼ˆ8888ï¼‰å£°æ˜ï¼š\"æˆ‘æ˜¯è¿™ä¸ªç»„æ’­ç»„ä¸­è´Ÿè´£8888ç«¯å£çš„åº”ç”¨\"\n    - å‘é€ç«¯å¿…é¡»å°†æ•°æ®å‘é€åˆ°è¯¥ç»„æ’­åœ°å€+æŒ‡å®šç«¯å£çš„ç»„åˆ\n\næƒ³è±¡ä¸€ä¸ªæ— çº¿ç”µç³»ç»Ÿï¼š\n- ç»„æ’­åœ°å€ = é¢‘é“ï¼ˆå¦‚FM 239.0ï¼‰\n- ç«¯å£å· = å­é¢‘é“ï¼ˆå¦‚\"æ–°é—»å­é¢‘é“8888\"ï¼‰\n- å‘é€ç«¯å¿…é¡»åœ¨æŒ‡å®šé¢‘é“(FM 239.0)ç”¨æŒ‡å®šå­é¢‘é“(8888)å‘å°„ä¿¡å·\n- æ¥æ”¶ç«¯å¿…é¡»è°ƒåˆ°ç›¸åŒé¢‘é“(FM 239.0)+ç›¸åŒå­é¢‘é“(8888)æ‰èƒ½æ¥æ”¶\n\n## ç«¯å£é‡ç”¨é—®é¢˜\n- åŒä¸€å°æœºå™¨ä¸Šçš„ä¸åŒç¨‹åºä¸èƒ½åŒæ—¶ç»‘å®šç›¸åŒç«¯å£\n- å¦‚éœ€å¤šè¿›ç¨‹æ¥æ”¶ï¼Œéœ€è¦è®¾ç½®`SO_REUSEPORT`é€‰é¡¹\n## é˜²ç«å¢™é…ç½®â€‹â€‹\n- æ¥æ”¶ç«¯å¿…é¡»å¼€æ”¾å¯¹åº”çš„UDPç«¯å£ï¼ˆç¤ºä¾‹ä¸­æ˜¯8888ï¼‰\n- Linuxæ£€æŸ¥ï¼š`sudo ufw allow 8888/udp`","categories":["ç½‘ç»œ"]},{"title":"Linux_cutå‘½ä»¤","url":"/Linux/Linux_cutå‘½ä»¤/","content":"cutæ˜¯`/usr/bin/`ä¸‹çš„ç¨‹åºã€‚\n\n```sh\ncut  -d.  -f1  -s  IPs.txt\n```\nä»¥ä¸Šå‘½ä»¤è¯´çš„æ˜¯ï¼š\n1. `-d`ï¼šä»¥`.`ä¸ºåˆ†å‰²ã€‚\n2. `-f1`ï¼šåˆ‡å‰²ä¸‹æ¥ç¬¬1åˆ—ã€‚\n3. `-s`ï¼šä»¥å“ªä¸ªæ–‡ä»¶çš„å†…å®¹åˆ‡å‰²ã€‚\n\n\n```sh\nmrcan@ubuntu:~$ echo 192.168.0.1 > IP.txt\nmrcan@ubuntu:~$ cut -d. -f1 -s IP.txt \n192\nmrcan@ubuntu:~$ cut -d. -f2 -s IP.txt \n168\nmrcan@ubuntu:~$ cut -d. -f3 -s IP.txt \n0\nmrcan@ubuntu:~$ cut -d. -f4 -s IP.txt\n1\nmrcan@ubuntu:~$ cut -d. -f5 -s IP.txt\nï¼ˆç©ºï¼‰\n```\n","categories":["Linux"]},{"title":"Linux_æ­£åˆ™è¡¨è¾¾å¼","url":"/Linux/Linux_æ­£åˆ™è¡¨è¾¾å¼_grep_awk/","content":"# æ­£åˆ™è¡¨è¾¾å¼\nRegular Expression\n\nä¸»è¦å‚è€ƒæ–‡æ¡£ï¼š\nhttps://legacy.cplusplus.com/reference/regex/ECMAScript/\n\n[[Linux_Shellç¼–ç¨‹#ç»“åˆæ­£åˆ™è¡¨è¾¾å¼çš„ç¤ºä¾‹]]ï¼šcaseçš„ç¤ºä¾‹ä¸­\n\n```sh\n[][][]ä»£è¡¨ä¸‰ä¸ªå­—ç¬¦ã€‚\n[]ä»£è¡¨ä¸€ä¸ªå­—ç¬¦ã€‚\n[]é‡Œå¯ä»¥å¡«æ­£åˆ™è¡¨è¾¾å¼ã€‚\n1.[a-z]è¡¨ç¤ºä¸€ä¸ªå°å†™çš„aåˆ°zå‡å¯\n2.[abcde]è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦çš„å¯å–èŒƒå›´\n```\n# Quantifiersï¼ˆ`*`ã€`+`ã€`?`ã€`{n}`ï¼‰\né‡è¯\n\nä»£è¡¨é€šç”¨çš„ä¿¡æ¯çš„éƒ¨åˆ†ã€‚\n1. `*`ï¼šå¯èƒ½æœ‰ï¼ˆ0åˆ°æ— æ•°ä¸ªï¼‰å‰å¯¼å­—ç¬¦ã€‚`*`åªæ˜¯æŒ‡ç¤ºç¬¦ï¼Œæœ¬èº«ä¸å‚ä¸ï¼ŒæŒ‡ç¤ºå‰é¢çš„å­—ç¬¦ä¼šé‡å¤0åˆ°æ— æ•°æ¬¡ã€‚\n2. `+`ï¼šæœ€å°‘1ä¸ªå‰å¯¼å­—ç¬¦ã€‚\n3. `?`ï¼šåªæœ‰1ä¸ªå‰å¯¼å­—ç¬¦ã€‚\n4. `{n}`ï¼šæœ‰nä¸ªå‰å¯¼å­—ç¬¦ã€‚\n    1. `{n,}`ï¼šæœ‰å¤§äºç­‰äºnä¸ªçš„å‰å¯¼å­—ç¬¦ã€‚\n    2. `{min,max}`ï¼šè‡³å°‘æœ‰minä¸ªï¼Œä½†ä¸è¶…è¿‡maxä¸ªï¼ˆå·¦é—­å³å¼€ï¼‰\n# Special Pattern Charactersï¼ˆ`[]`ï¼‰\nç‰¹æ®Šæ¨¡å¼å­—ç¬¦\n\n1. `.`ï¼šåŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦\n2. `[...]`ï¼šåŒ¹é…`[]`ä¸­åŒ…å«çš„ä»»æ„å­—ç¬¦ã€‚\n    1. æ¯”å¦‚`[1234567890]`æˆ–`[0-9]`éƒ½è¡¨ç¤ºï¼šå­—ç¬¦0åˆ°9\n    2. `[A-Z]`è¡¨ç¤ºå¤§å†™å­—æ¯\n    3. `[A-Za-z]`è¡¨ç¤ºå¤§å°å†™å­—æ¯ã€‚\n    4. åˆ†ç±»å­—ç¬¦ï¼Œè§ã€Š[Character classes](#Character%20classes)ï¼ˆå­—ç¬¦ç±»ï¼‰ã€‹ä¸€èŠ‚\n3. `\\s`ï¼šè¡¨ç¤ºç©ºæ ¼å­—ç¬¦ï¼Œç©ºæ ¼ã€åˆ¶è¡¨ç¬¦éƒ½å¯ä»¥ã€‚ï¼ˆå¯æ›¿ä»£`[[:space:]]`ï¼‰\n\næ›´å¤šç‰¹æ®Šå­—ç¬¦è§æ‰‹å†Œã€‚\nhttps://legacy.cplusplus.com/reference/regex/ECMAScript/\n\n`.*`è¡¨ç¤ºæ‰€æœ‰å­—ç¬¦ã€‚\n## Character classes\nå­—ç¬¦ç±»\n1. `[:alpha:]`ï¼šè¡¨ç¤ºæ‰€æœ‰å­—æ¯\n    1. `grep '[[:alpha:]]' file.txt`\n2. `[:digit:]`ï¼šè¡¨ç¤ºæ•°å­—\n3. `[:alnum:]`ï¼šè¡¨ç¤ºå­—æ¯+æ•°å­—\n4. `^[:alpha:]`ï¼šè¡¨ç¤ºé™¤äº†å­—æ¯ä»¥å¤–\n    1. `grep '[^[:alpha:]]' file.txt`\n# Assertionsï¼ˆ`^`ã€`$`ï¼‰\næ–­è¨€\n\n1. `^`ï¼šå‡ºç°åœ¨è¡Œé¦–çš„æŒ‡å®šå­—ç¬¦ä¸²ã€‚\n    1. æ³¨æ„ï¼Œåœ¨`[]`å†…å¤–ï¼Œ`^`è¡¨è¾¾çš„æ„æ€æ˜¯ä¸ä¸€æ ·çš„ã€‚\n        1. åœ¨`[]`å†…ï¼Œè¡¨ç¤ºâ€œéâ€\n        2. åœ¨`[]`å¤–ï¼Œæ‰è¡¨ç¤ºâ€œé¦–â€\n        3. å¯¹äºåˆ†ç±»å­—ç¬¦ï¼ˆæ¯”å¦‚`[:alpha:]`ï¼‰ï¼Œéœ€è¦æ”¾åˆ°ä¸¤å±‚`[]`ä¹‹å†…ï¼Œåˆ†ç±»å­—ç¬¦çš„`[]`ä¹‹å¤–ï¼Œå³ï¼š`[^[:alpha:]]`ã€‚\n2. `$`ï¼šå‡ºç°åœ¨è¡Œå°¾çš„æŒ‡å®šå­—ç¬¦ä¸²ã€‚\n\n# Alternativesï¼ˆæˆ–å…³ç³»ï¼š`|`ï¼‰\n![](../../images/Linux_æ­£åˆ™è¡¨è¾¾å¼/image-20250717211217323.png)\n\n\n![](../../images/Linux_æ­£åˆ™è¡¨è¾¾å¼/image-20250717025024296.png)\næ‰¾å‡ºå¸¦Aæˆ–å¸¦Bçš„è¡Œã€‚\nç›¸å½“äºæ±‚äº†ä¸¤æ¬¡grepï¼Œç»“æœåˆåœ¨ä¸€èµ·ã€‚\n\næ³¨æ„`|`éœ€è¦è½¬ä¹‰ã€‚\n# Groups\nç»„\n![](../../images/Linux_æ­£åˆ™è¡¨è¾¾å¼/image-20250717211508114.png)\n## æ ¸å¿ƒæ¦‚å¿µï¼šåˆ†ç»„çš„ä½œç”¨\n\n1. â€‹**â€‹å°†é‡è¯åº”ç”¨äºå­—ç¬¦åºåˆ—ï¼šâ€‹**â€‹ è¿™æ˜¯æœ€åŸºæœ¬çš„ä½œç”¨ã€‚æƒ³è±¡ä½ è¦åŒ¹é…å¤šæ¬¡å‡ºç°çš„å•è¯â€œhelloâ€è€Œä¸æ˜¯å•ä¸ªå­—æ¯â€œlâ€å¤šæ¬¡ã€‚ä½ éœ€è¦æŠŠâ€œhelloâ€å½“æˆä¸€ä¸ªæ•´ä½“æ¥é‡åŒ–ã€‚\n    - _é”™è¯¯ç¤ºä¾‹ï¼š_Â `hel{2,}o`ï¼šè¿™ä¸ªåŒ¹é…çš„æ˜¯ 'he' + â€‹**â€‹è‡³å°‘2ä¸ª'l'â€‹**â€‹ + 'o'ï¼Œ å¯ä»¥åŒ¹é… \"hello\", \"hellllo\"ï¼Œä½†ä¸èƒ½åŒ¹é… \"hellohello\" (ä¸¤ä¸ªhelloè¿åœ¨ä¸€èµ·)ã€‚\n    - _æ­£ç¡®ç¤ºä¾‹ï¼š_Â `(hello){2,}`ï¼šè¿™ä¸ªåŒ¹é…çš„æ˜¯ â€‹**â€‹\"(hello)\"è¿™ä¸ªæ•´ä½“â€‹**â€‹ è‡³å°‘å‡ºç°2æ¬¡ï¼Œå¯ä»¥åŒ¹é… \"hellohello\", \"hellohellohello\" ç­‰ã€‚\n2. â€‹**â€‹åˆ›å»ºå­åŒ¹é…é¡¹ï¼ˆåå‘å¼•ç”¨ï¼‰ï¼šâ€‹**â€‹ è¿™æ˜¯æ™®é€šåˆ†ç»„Â `(subpattern)`Â ç‹¬ç‰¹ä¸”å¼ºå¤§çš„åŠŸèƒ½ã€‚å®ƒä¸ä»…ä»…æ˜¯åŒ¹é…ï¼Œè¿˜ä¼šâ€‹**â€‹è®°ä½â€‹**â€‹åˆ†ç»„å†…åŒ¹é…åˆ°çš„â€‹**â€‹å…·ä½“å†…å®¹â€‹**â€‹ï¼Œå¹¶åˆ†é…ä¸€ä¸ªâ€‹**â€‹ç¼–å·â€‹**â€‹ï¼ˆæŒ‰ç…§å·¦æ‹¬å·Â `(`Â å‡ºç°çš„é¡ºåºï¼‰ã€‚è¿™äº›è¢«è®°ä½çš„å†…å®¹ç§°ä¸ºâ€œå­åŒ¹é…é¡¹â€æˆ–â€œæ•è·ç»„â€ã€‚\n## æ™®é€šåˆ†ç»„ï¼ˆåˆ†ç»„ä¸”æ•è·ï¼‰ï¼š`(subpattern)`\n- å°†Â `subpattern`Â ä½œä¸ºä¸€ä¸ªæ•´ä½“å•å…ƒè¿›è¡Œæ“ä½œï¼ˆç‰¹åˆ«æ˜¯åº”ç”¨é‡è¯ï¼‰ã€‚\n- æ•è·Â `subpattern`Â åŒ¹é…åˆ°çš„å®é™…æ–‡æœ¬å†…å®¹ã€‚\n- ï¼ˆé‡è¦ï¼‰åˆ›å»ºåå‘å¼•ç”¨ï¼ˆåœ¨â€‹**â€‹åŒä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å†…éƒ¨â€‹**â€‹ï¼Œç”¨Â `\\1`,Â `\\2`,Â `\\3`... æ¥æŒ‡ä»£ç¬¬1ã€2ã€3...ä¸ªåˆ†ç»„æ•è·çš„å†…å®¹ï¼‰ã€‚\n- åœ¨â€‹**â€‹æ­£åˆ™åŒ¹é…ç»“æœâ€‹**â€‹ä¸­ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•ï¼ˆå¦‚ C++ çš„Â `smatch[1]`,Â `smatch[2]`ï¼‰è·å–æ¯ä¸ªå­åŒ¹é…é¡¹çš„å€¼ã€‚\n- åœ¨â€‹**â€‹æ›¿æ¢æ“ä½œâ€‹**â€‹ä¸­ï¼Œå¯ä»¥é€šè¿‡ç±»ä¼¼Â `$1`,Â `$2`,Â `$3`... çš„è¯­æ³•æ¥å¼•ç”¨è¿™äº›å­åŒ¹é…é¡¹ã€‚\n### ç¤ºä¾‹1ï¼šåŒ¹é…é‡å¤çš„å•è¯æˆ–è¿ç»­å­—æ¯\n```\næ­£åˆ™: (\\w+)\\s+\\1\nè§£é‡Š:\n  (\\w+) : ç¬¬1ä¸ªåˆ†ç»„ï¼ŒåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ¯æ•°å­—ä¸‹åˆ’çº¿ï¼ˆå°±æ˜¯ä¸€ä¸ªå•è¯ï¼‰ï¼Œå¹¶æŠŠåŒ¹é…åˆ°çš„è¯è®°ä½ã€‚\n  \\s+   : åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªç©ºç™½å­—ç¬¦ï¼ˆç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ç­‰ï¼‰ã€‚\n  \\1    : åå‘å¼•ç”¨ï¼ŒåŒ¹é…çš„å†…å®¹å¿…é¡»ä¸ç¬¬1ä¸ªåˆ†ç»„æ•è·çš„å†…å®¹ å®Œå…¨ç›¸åŒã€‚\n\nç›®æ ‡å­—ç¬¦ä¸²: \"hello world hello again\"\nåŒ¹é…ç»“æœ: åŒ¹é…åˆ° \"hello hello\"ï¼ˆç¬¬ä¸€ä¸ª \"hello\" è¢«æ•è·ä¸ºåˆ†ç»„1ï¼Œ\\1 è¦æ±‚å†æ¬¡å‡ºç° \"hello\"ï¼‰\n         \"world\"å’Œ\"again\" ä¸ä¼šè¢«åŒ¹é…ï¼Œå› ä¸º \"world\" != \"again\"\n```\n### ç¤ºä¾‹2ï¼šæå–æ—¥æœŸå„éƒ¨åˆ†ï¼ˆå¹´ã€æœˆã€æ—¥ï¼‰\n```\næ­£åˆ™: (\\d{4})-(\\d{2})-(\\d{2})\nè§£é‡Š:\n  (\\d{4}) : ç¬¬1ä¸ªåˆ†ç»„ï¼ŒåŒ¹é…4ä½æ•°å­—ï¼ˆå¹´ï¼‰ï¼Œæ•è·ã€‚\n  -       : åŒ¹é…æ¨ªæ  \"-\"\n  (\\d{2}) : ç¬¬2ä¸ªåˆ†ç»„ï¼ŒåŒ¹é…2ä½æ•°å­—ï¼ˆæœˆï¼‰ï¼Œæ•è·ã€‚\n  -       : åŒ¹é…æ¨ªæ  \"-\"\n  (\\d{2}) : ç¬¬3ä¸ªåˆ†ç»„ï¼ŒåŒ¹é…2ä½æ•°å­—ï¼ˆæ—¥ï¼‰ï¼Œæ•è·ã€‚\n\nç›®æ ‡å­—ç¬¦ä¸²: \"Today is 2023-10-27.\"\nåŒ¹é…ç»“æœ:\n    æ•´ä¸ªåŒ¹é…: \"2023-10-27\"\n    å­åŒ¹é…é¡¹:\n     smatch[0] æˆ– $0: \"2023-10-27\" (æ•´ä¸ªåŒ¹é…é¡¹)\n     smatch[1] æˆ– $1: \"2023\"        (ç¬¬1åˆ†ç»„æ•è·çš„å¹´)\n     smatch[2] æˆ– $2: \"10\"          (ç¬¬2åˆ†ç»„æ•è·çš„æœˆ)\n     smatch[3] æˆ– $3: \"27\"          (ç¬¬3åˆ†ç»„æ•è·çš„æ—¥)\nç¼–ç¨‹ä¸­è®¿é—®: match[1], match[2], match[3] (C++çš„smatchç´¢å¼•é€šå¸¸ä»1å¼€å§‹è¡¨ç¤ºåˆ†ç»„)\n```\n## è¢«åŠ¨/éæ•è·åˆ†ç»„ï¼š`(?:subpattern)`\n### ä½œç”¨\n- å°†Â `subpattern`Â ä½œä¸ºä¸€ä¸ªæ•´ä½“å•å…ƒè¿›è¡Œæ“ä½œï¼ˆåº”ç”¨é‡è¯ï¼‰ã€‚\n- â€‹**â€‹ä¸ä¼šâ€‹**â€‹æ•è·åŒ¹é…åˆ°çš„æ–‡æœ¬å†…å®¹ã€‚\n- â€‹**â€‹ä¸ä¼šâ€‹**â€‹åˆ›å»ºå­åŒ¹é…é¡¹ã€‚\n- â€‹**â€‹ä¸åˆ†é…â€‹**â€‹åˆ†ç»„ç¼–å·ï¼ˆå› æ­¤ä¸ä¼šå½±å“å…¶ä»–æ™®é€šåˆ†ç»„çš„ç¼–å·ï¼‰ã€‚\n- â€‹**â€‹æ— æ³•â€‹**â€‹åœ¨æ­£åˆ™è¡¨è¾¾å¼å†…éƒ¨ç”¨Â `\\n`Â åå‘å¼•ç”¨ã€‚\n- â€‹**â€‹æ— æ³•â€‹**â€‹åœ¨åŒ¹é…ç»“æœæˆ–æ›¿æ¢æ“ä½œä¸­å•ç‹¬è®¿é—®ã€‚\n\nä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿâ€‹\n- â€‹**â€‹æ€§èƒ½ï¼šâ€‹**â€‹ å¦‚æœä¸å…³å¿ƒåˆ†ç»„å†…å®¹ï¼Œé¿å…æ•è·å¯ä»¥æé«˜æ•ˆç‡ï¼ˆå°¤å…¶æ˜¯åœ¨å¤§é‡é‡å¤åŒ¹é…æ—¶ï¼‰ã€‚\n- â€‹**â€‹ç®€åŒ–ç¼–å·ï¼šâ€‹**â€‹ å½“ä½ åªæƒ³åˆ†ç»„åº”ç”¨é‡è¯ï¼Œä½†åˆä¸æƒ³è¿™ä¸ªåˆ†ç»„è®¡å…¥ç¼–å·ä½“ç³»ã€å¹²æ‰°ä½ çœŸæ­£å…³å¿ƒçš„æ•è·ç»„ï¼ˆæ™®é€šåˆ†ç»„ï¼‰æ—¶ã€‚å®ƒè®©åç»­æ™®é€šåˆ†ç»„çš„ç¼–å·æ›´æ¸…æ™°ã€‚\n- â€‹**â€‹é¿å…ä¸å¿…è¦çš„å†…å­˜å¼€é”€ï¼šâ€‹**â€‹ ä¸ç”¨å­˜å‚¨ä¸å…³å¿ƒçš„åŒ¹é…æ–‡æœ¬ã€‚\n\n### ç¤ºä¾‹ï¼šåŒ¹é…æ–‡ä»¶æ‰©å±•åï¼ˆä½†åªå…³å¿ƒæ‰©å±•åæœ¬èº«ï¼‰\n```\nç›®æ ‡ï¼šä» \"report.txt\", \"data.csv.zip\", \"image.png\" ä¸­æå–æ‰©å±•å (txt, zip, png)\næ­£åˆ™ï¼š\\.(?:[a-z]{3,4})$   (ä¸ç†æƒ³ï¼Œåªä¸ºæ¼”ç¤ºéæ•è·)\nç†æƒ³æ­£åˆ™ï¼š\\.([a-z]{3,4})$  (ä¸€ä¸ªæ•è·ç»„å°±å¤Ÿ)\n\nä½†å‡è®¾æœ‰ä¸ªæ›´å¤æ‚çš„æ¨¡å¼ï¼š\næ­£åˆ™ï¼š^(?:https?:\\/\\/)?(?:www\\.)?example\\.com\\/(\\w+)\\.html$\nè§£é‡Š:\n  ^            : å­—ç¬¦ä¸²å¼€å§‹\n  (?:https?:\\/\\/)? : éæ•è·åˆ†ç»„ï¼ŒåŒ¹é…å¯é€‰çš„ \"http://\" æˆ– \"https://\" (?åŒ¹é…0æ¬¡æˆ–1æ¬¡)\n  (?:www\\.)?     : éæ•è·åˆ†ç»„ï¼ŒåŒ¹é…å¯é€‰çš„ \"www.\"\n  example\\.com  : åŒ¹é…å›ºå®šåŸŸå\n  \\/            : åŒ¹é…æ–œæ  \"/\"\n  (\\w+)         : **æ™®é€šæ•è·åˆ†ç»„1!** åŒ¹é…å¹¶æ•è·ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ¯æ•°å­—ä¸‹åˆ’çº¿ï¼ˆæ–‡ä»¶åï¼‰\n  \\.html        : åŒ¹é… \".html\"\n  $            : å­—ç¬¦ä¸²ç»“æŸ\n\nç›®æ ‡å­—ç¬¦ä¸²: \"https://www.example.com/news.html\"\nåŒ¹é…ç»“æœ:\n    æ•´ä¸ªåŒ¹é…: \"https://www.example.com/news.html\"\n    å­åŒ¹é…é¡¹:\n        [1]: \"news\" (å”¯ä¸€æ•è·çš„åˆ†ç»„)\n    æ‰€æœ‰ `(?:...)` åˆ†ç»„åŒ¹é…çš„å†…å®¹ (http, www) éƒ½ä¸ä¼šè¢«æ•è·æˆ–åˆ†é…ç¼–å·ã€‚æˆ‘ä»¬å…³å¿ƒçš„åªæ˜¯æ–‡ä»¶å \"news\"ã€‚\n    \nå¦‚æœæ²¡æœ‰éæ•è·åˆ†ç»„ï¼š\n    æ­£åˆ™ï¼š ^(https?:\\/\\/)?(www\\.)?example\\.com\\/(\\w+)\\.html$\n    å­åŒ¹é…é¡¹:\n        [1]: \"https://\"   (å¯èƒ½ä¸éœ€è¦)\n        [2]: \"www.\"       (å¯èƒ½ä¸éœ€è¦)\n        [3]: \"news\"       (æˆ‘ä»¬æƒ³è¦çš„)\n    æ­¤æ—¶è¦è®¿é—®æ–‡ä»¶åå°±éœ€è¦ [3] è€Œä¸æ˜¯ [1]ï¼Œéæ•è·åˆ†ç»„è®©å…³å¿ƒçš„éƒ¨åˆ†ç¼–å·æ›´æ¸…æ™°ã€‚\n```\n### ç¤ºä¾‹2ï¼šåº”ç”¨é‡è¯ä½†ä¸æ•è·ï¼ˆçº¯ç²¹ä¸ºäº†ç»“æ„ï¼‰\n```\nåŒ¹é…è¿ç»­å‡ºç°çš„ \"hello\" æˆ– \"world\" ä¸¤æ¬¡\næ­£åˆ™: (?:hello|world){2}\nè§£é‡Š:\n    (?:hello|world) : éæ•è·åˆ†ç»„ï¼ŒåŒ¹é…æ•´ä½“ \"hello\" æˆ– \"world\"ã€‚\n    {2}             : è¦æ±‚å‰é¢è¿™ä¸ªéæ•è·åˆ†ç»„æ•´ä½“å‡ºç°2æ¬¡ã€‚\n\nå¯ä»¥åŒ¹é…: \"hellohello\", \"helloworld\", \"worldhello\", \"worldworld\"\nåŒ¹é…ç»“æœä¸­æ‰¾ä¸åˆ°å“ªä¸ªåˆ†ç»„åŒ¹é…äº† \"hello\" è¿˜æ˜¯ \"world\"ï¼Œå› ä¸ºå®ƒæ²¡æœ‰è¢«æ•è·ã€‚\nä½¿ç”¨æ™®é€šåˆ†ç»„ä¹Ÿå¯ä»¥ `(hello|world){2}` ä½†ä¼šé¢å¤–æ•è·äº†æ¯æ¬¡çš„å†…å®¹ï¼ˆå¯èƒ½ç”¨ä¸åˆ°ï¼‰ã€‚\n```\n## æ€»ç»“\n![](../../images/Linux_æ­£åˆ™è¡¨è¾¾å¼/image-20250717212452387.png)\n# grep\nGet Regular Expression Print\n## `*`\n```sh\necho \"AAAA\" > aa.txt\necho \"BB\"  >> aa.txt\n```\n\n```sh\ngrep B* aa.txt\n```\nç»“æœï¼š\n```\nAAAA\nBB\n```\nå¦‚ä¸Šç»“æœï¼Œå› ä¸º`B*`ä»£è¡¨å‰é¢çš„Bå¯èƒ½ä¼šå‡ºç°`0`åˆ°`n`æ¬¡ã€‚æ‰€ä»¥ï¼ŒAAAAä¹ŸåŒ¹é…ä¸Šäº†ã€‚\n\n```sh\ngrep BB* aa.txt\n```\nç»“æœï¼š\n```\nBB\n```\nå¦‚ä¸Šç»“æœï¼Œè¿™æ¬¡æ²¡å‡ºç°AAAAï¼Œå› ä¸ºæˆ‘ä»¬é™åˆ¶äº†`BB*`ï¼Œå³ç¬¬ä¸€ä¸ªå­—ç¬¦å¿…é¡»æ˜¯Båé¢å¯èƒ½å‡ºç°0åˆ°nä¸ªBã€‚å¯ä»¥ç”¨`B+`æ›¿ä»£ä¸Šè¿°è¯­ä¹‰ï¼š[`+`](#`+`)ã€‚\n\nå› æ­¤`*`è¿˜æ˜¯è¦æ…ç”¨ï¼Œèƒ½ä»£è¡¨çš„èŒƒå›´å¤ªå¤§äº†ã€‚\n## `+`\nç±»ä¼¼äº`*`ï¼ŒåŒºåˆ«æ˜¯1åˆ°næ¬¡ã€‚æ’é™¤äº†0æ¬¡çš„å¯èƒ½ã€‚\n```sh\ngrep 'B\\+' aa.txt\n```\n\n**éœ€è¦è½¬ä¹‰ï¼Œå¹¶åœ¨å•å¼•å·ä¸­ä½¿ç”¨**ã€‚\n\nç»“æœï¼š\n```\nBB\n```\n### ç¤ºä¾‹1\n```sh\necho \"123.456\" >> aa.txt\necho \"222.333\" >> aa.txt\necho \"845.143\" >> aa.txt\necho \"a2a.7a3\" >> aa.txt\necho \"a23.833\" >> aa.txt\necho \"a23.83q\" >> aa.txt\n```\næ€ä¹ˆæå–å‡º`.`å‰åå…¨æ˜¯æ•°å­—çš„**è¡Œ**ï¼Ÿ\n```sh\ngrep '[0-9]\\+\\.[0-9]\\+' aa.txt\n```\nä»¥ä¸Šå‘½ä»¤è¡¨ç¤ºï¼š\n1. `\\.`æ˜¯è½¬ä¹‰ï¼Œæ„æ€æ˜¯ä¸­é—´æœ‰ä¸ª`.`\n2. `.`å‰é¢æœ‰æœ€å°‘1ä¸ª`0åˆ°9`çš„å­—ç¬¦\n3. `.`åé¢æœ‰æœ€å°‘1ä¸ª`0åˆ°9`çš„å­—ç¬¦\n\n\nç»“æœï¼š\n![](../../images/Linux_æ­£åˆ™è¡¨è¾¾å¼/image-20250717022242078.png)\n### ç¤ºä¾‹2 - ç²¾ç¡®æŒ‡ç¤ºnä¸ªå­—ç¬¦\néœ€è¦ç”¨åˆ°`{}`ï¼Œæ³¨æ„åœ¨å•å¼•å·ä¸­ï¼Œ`{`å’Œ`}`å‡éœ€è½¬ä¹‰ã€‚\n\næŒ‡ç¤ºæœ‰4ä¸ª`Aåˆ°Z`å­—ç¬¦ã€‚\n```sh\ngrep '[A-Z]\\{4\\}' aa.txt\n```\nç»“æœï¼šAAAA\n\næŒ‡ç¤ºæœ‰å¤§äºç­‰äº2ä¸ªçš„`Aåˆ°Z`å­—ç¬¦ã€‚åœ¨å³æ‹¬å·å‰åŠ `,`\n```sh\ngrep '[A-Z]\\{3,\\}' aa.txt\n```\nç»“æœï¼š\n```\nAAAA\nBB\n```\n### ç»“åˆåˆ†ç±»å­—ç¬¦ï¼ˆå¦‚`[:alpha:]`ï¼‰\næ³¨æ„å¤–é¢è¿˜éœ€è¦åŠ ä¸€å±‚`[]`\n\næƒ³æ‰¾åˆ°æ–‡ä»¶ä¸­å¸¦æ•°å­—çš„è¡Œï¼š\n```sh\ngrep '[[:digit:]]' aa.txt\n```\n![](../../images/Linux_æ­£åˆ™è¡¨è¾¾å¼/image-20250717024050328.png)\næƒ³æ‰¾åˆ°æ–‡ä»¶ä¸­å¸¦å­—æ¯çš„è¡Œï¼š\n![](../../images/Linux_æ­£åˆ™è¡¨è¾¾å¼/image-20250717024105776.png)\næƒ³æ‰¾åˆ°æ–‡ä»¶ä¸­å¸¦å­—æ¯æˆ–æœ‰0åˆ°3å­—ç¬¦çš„è¡Œï¼š\n![](../../images/Linux_æ­£åˆ™è¡¨è¾¾å¼/image-20250717024550755.png)\næƒ³æ‰¾åˆ°æ–‡ä»¶ä¸­**æœ‰éå­—æ¯å­—ç¬¦**çš„è¡Œï¼š\n![](../../images/Linux_æ­£åˆ™è¡¨è¾¾å¼/image-20250717024146037.png)\næƒ³æ‰¾åˆ°æ–‡ä»¶ä¸­**æœ‰éå­—æ¯ã€éæ•°å­—å­—ç¬¦**çš„è¡Œï¼š\n![](../../images/Linux_æ­£åˆ™è¡¨è¾¾å¼/image-20250717024255587.png)\n## `?`\nåªå‡ºç°äº†1æ¬¡å‰é¢çš„å­—ç¬¦ã€‚\n## `$`\nä»¥ä»€ä¹ˆå­—ç¬¦ç»“å°¾ã€‚\n```sh\ngrep '[C-Z]\\+$' aa.txt\n```\nè¡¨ç¤ºï¼šç»“å°¾æœ€å°‘æœ‰1ä¸ªCåˆ°Zçš„å­—ç¬¦ã€‚\n\nå¦‚æœ`aa.txt`çš„å†…å®¹æ˜¯ï¼š\n```\nAAAA\nBB\n123.456\nCABCC\nABCC\nCDEFGHIJKL\nCCCCC\n```\nåˆ™æ‰§è¡Œ`grep '[C-Z]\\+$' aa.txt`çš„ç»“æœï¼š\n![](../../images/Linux_æ­£åˆ™è¡¨è¾¾å¼/image-20250717171927467.png)\n## æ—¢ä»¥...ä¸ºå¼€å¤´ï¼Œåˆä»¥å®ƒä¸ºç»“å°¾ï¼Ÿ\n```sh\ngrep '^[C-Z]\\+$' aa.txt\n```\næˆ‘åŸå…ˆæƒ³çš„æ˜¯ï¼Œè¿™ä¸ªå‘½ä»¤è¡¨ç¤ºæ—¢ä»¥è‡³å°‘1ä¸ª`Cåˆ°Zçš„å­—ç¬¦`å¼€å¤´ï¼Œåˆä»¥è‡³å°‘1ä¸ª`Cåˆ°Zçš„å­—ç¬¦`ç»“å°¾ã€‚ï¼ˆé”™è¯¯è§£é‡Šï¼ï¼‰\nè®©Deepseekåˆ†æåï¼Œä¸æ˜¯è¿™æ ·è§£é‡Šçš„ã€‚è€Œæ˜¯ï¼š\n\næ­£åˆ™è¡¨è¾¾å¼Â `^[C-Z]\\+$`Â è¦æ±‚ï¼š\n- æ•´è¡Œâ€‹**â€‹å¿…é¡»å®Œå…¨ç”±â€‹**â€‹ C-Z çš„å¤§å†™å­—æ¯ç»„æˆï¼ˆå­—æ¯å¿…é¡» â‰¥ Cï¼‰\n- â€‹**â€‹Aå’ŒBå­—æ¯ä¸è¢«å…è®¸â€‹**â€‹\n- â€‹**â€‹æ— ä»»ä½•æ•°å­—/ç¬¦å·/å°å†™å­—æ¯**\n\nå› æ­¤ï¼Œå¦‚æœ`aa.txt`çš„å†…å®¹æ˜¯ï¼š\n```\nAAAA\nBB\n123.456\nCABCC\nABCC\nCDEFGHIJKL\nCCCCC\n```\nåˆ™æ‰§è¡Œ`grep '^[C-Z]\\+$' aa.txt`çš„ç»“æœï¼š\n![](../../images/Linux_æ­£åˆ™è¡¨è¾¾å¼/image-20250717171833045.png)\n### è¡¨è¾¾å¼æ‹†è§£ä¸æ‰§è¡Œé€»è¾‘\n\n1. â€‹**â€‹`^`Â é”šç‚¹â€‹**â€‹ï¼ˆè¡Œé¦–ï¼‰\n    \n    - å¼ºåˆ¶åŒ¹é…â€‹**â€‹å¿…é¡»ä»è¡Œé¦–å¼€å§‹â€‹**â€‹\n2. â€‹**â€‹`[C-Z]`Â +Â `\\+`Â ç»„åˆâ€‹**â€‹\n    \n    - `[C-Z]`Â åªåŒ¹é… â€‹**â€‹å•ä¸ªâ€‹**â€‹ C-Z èŒƒå›´å†…çš„å¤§å†™å­—æ¯\n    - `\\+`Â è¡¨ç¤ºå‰é¢çš„Â `[C-Z]`Â â€‹**â€‹è‡³å°‘å‡ºç°ä¸€æ¬¡â€‹**â€‹ï¼ˆå¯ä»¥å‡ºç°å¤šæ¬¡ï¼‰\n    - â€‹**â€‹å…³é”®æ•ˆæœâ€‹**â€‹ï¼šæ¯ä¸€ä¸ªä½ç½®éƒ½éœ€åŒ¹é…Â `[C-Z]`  \n        ï¼ˆä¸èƒ½æ˜¯ç©ºæ ¼/æ•°å­—/å°å†™å­—æ¯/å…¶ä»–å­—ç¬¦ï¼‰\n3. â€‹**â€‹`$`Â é”šç‚¹â€‹**â€‹ï¼ˆè¡Œå°¾ï¼‰\n    \n    - å¼ºåˆ¶åŒ¹é…â€‹**â€‹å¿…é¡»å»¶ä¼¸åˆ°è¡Œå°¾ç»“æŸâ€‹**\n\n### å¼ºåˆ¶çº¦æŸçš„é€»è¾‘é“¾\n\nå½“æ­£åˆ™å¼•æ“æ‰§è¡ŒÂ `^[C-Z]\\+$`Â æ—¶ï¼Œå®ƒçš„åŒ¹é…è§„åˆ™å¦‚ä¸‹ï¼š\n\n1. ä»è¡Œé¦– (`^`) å¼€å§‹æ£€æŸ¥ç¬¬ä¸€ä¸ªå­—ç¬¦  \n    â†’ å¿…é¡»æ˜¯Â `C-Z`Â çš„å¤§å†™å­—æ¯\n2. ç»§ç»­æ£€æŸ¥åç»­å­—ç¬¦  \n    â†’ å› ä¸ºÂ `\\+`Â è¦æ±‚è¿ç»­å¤šä¸ªåŒ¹é…ï¼Œæ‰€ä»¥â€‹**â€‹ç¬¬äºŒä¸ªå­—ç¬¦å¿…é¡»ä¹Ÿæ˜¯â€‹**â€‹Â `C-Z`Â çš„å¤§å†™å­—æ¯  \n    â†’ ç¬¬ä¸‰ä¸ªã€ç¬¬å››ä¸ª...æ‰€æœ‰å­—ç¬¦éƒ½å¿…é¡»æ»¡è¶³\n3. ç›´åˆ°é‡è§è¡Œå°¾ (`$`)  \n    â†’ æ­¤æ—¶æ•´è¡Œå·²è¢«å®Œå…¨åŒ¹é…\n\n> âœ¨ â€‹**â€‹æ ¸å¿ƒæœºåˆ¶â€‹**â€‹ï¼š`[C-Z]\\+`Â ä½œä¸ºè¿ç»­çš„æ•´ä½“å……å½“äº† â€‹**â€‹â€œå¡«å……å†…å®¹â€â€‹**â€‹ çš„è§’è‰²ï¼Œå®ƒä»è¡Œé¦–ä¸€ç›´å»¶ä¼¸åˆ°è¡Œå°¾ï¼Œä¸å…è®¸ä¸­é—´æ’å…¥ä»»ä½•é C-Z å­—ç¬¦ã€‚\n\n\nè¿™ç§ä¸¥æ ¼çº¦æŸä¸»è¦ç”¨äºéªŒè¯â€‹**â€‹æ ¼å¼çº¯å‡€çš„å­—ç¬¦ä¸²â€‹**â€‹ï¼Œå…¸å‹åœºæ™¯åŒ…æ‹¬ï¼š\n\n- æ£€æµ‹ä¸å«ç©ºæ ¼çš„è‹±æ–‡å•è¯ï¼ˆå¦‚Â `\"PYTHON\"`ï¼‰\n- è¿‡æ»¤æ— æ•°å­—/ç¬¦å·çš„çº¯å¤§å†™æ–‡æœ¬ï¼ˆå¦‚éªŒè¯å•†å“ä»£ç Â `\"SKUXYZ\"`ï¼‰\n- ä¹Ÿå¯ä»¥æœ‰ç­‰æ•ˆçš„ã€æ›´ç®€æ´çš„å½¢å¼ï¼š`grep -x '[C-Z]\\+' aa.txt`Â ï¼ˆ`-x`Â è¡¨ç¤ºæ•´è¡ŒåŒ¹é…ï¼‰\n# awk\n**A**lfred Aho, Peter **W**einberger, Brian **K**ernighan\n![](../../images/Linux_æ­£åˆ™è¡¨è¾¾å¼/image-20250717213735273.png)\n![](../../images/Linux_æ­£åˆ™è¡¨è¾¾å¼/image-20250717213911332.png)\n\n\ngrepæ˜¯æ‰«ææ¯ä¸€æ•´è¡Œçš„ï¼ŒæŒ‰è¡Œä¸ºå•ä½ã€‚è€Œawkæ˜¯æŒ‰ä¸€è¡Œä¸­çš„æ¯ä¸ªå­—æ®µä¸ºå•ä½æŸ¥è¯¢çš„ï¼Œç±»ä¼¼äºexcelè¡¨æ ¼ï¼Œå¯ä»¥åˆ‡åˆ†å„ä¸ªå­—æ®µã€‚å³å¯ä»¥æŒ‰åˆ—æ“ä½œã€‚\n## ç»“åˆæ­£åˆ™è¡¨è¾¾å¼\n>åœ¨ awkå‘½ä»¤ä¸­ï¼Œ`/tty/`ä¸­çš„ `â€‹â€‹/`ï¼ˆæ­£æ–œæ ï¼‰â€‹â€‹ æ˜¯â€‹â€‹æ­£åˆ™è¡¨è¾¾å¼ï¼ˆRegular Expressionï¼‰çš„å®šç•Œç¬¦â€‹â€‹ã€‚å®ƒè¡¨ç¤ºä¸­é—´çš„å†…å®¹ï¼ˆttyï¼‰æ˜¯ä¸€ä¸ªéœ€è¦åŒ¹é…çš„æ¨¡å¼ã€‚\n\n```sh\nawk '/tty/{print $0}' ps.txt\n```\n![](../../images/Linux_æ­£åˆ™è¡¨è¾¾å¼/image-20250717214111511.png)\nå‡å¦‚`ps.txt`æ–‡ä»¶å†…å®¹å¦‚ä¸Šï¼Œæˆ‘ä»¬æƒ³æ‰¾åˆ°å­—æ®µæœ‰`tty`çš„å­—æ®µã€‚\nåˆ™ï¼Œåœ¨awkå‘½ä»¤åé¢å…ˆç”¨`å•å¼•å·' '`åŒ…è£¹ï¼Œå†åœ¨é‡Œé¢å†™`æ–œæ / /`åŒ…è£¹æ­£åˆ™è¡¨è¾¾å¼ã€‚ååŠéƒ¨åˆ†å†ç”¨`å¤§æ‹¬å·{ }`åŒ…è£¹è¦è¿›è¡Œçš„æ‰“å°æ“ä½œã€‚\n![](../../images/Linux_æ­£åˆ™è¡¨è¾¾å¼/image-20250717214628141.png)\n## printå¯ä»¥è‡ªå®šä¹‰å†…å®¹\n![](../../images/Linux_æ­£åˆ™è¡¨è¾¾å¼/image-20250717214811959.png)\n\n![](../../images/Linux_æ­£åˆ™è¡¨è¾¾å¼/image-20250717214847197.png)\n### å¯ä»¥ç”¨printfè¿›è¡Œæ ¼å¼åŒ–è¾“å‡º\npså†…å®¹ï¼š\n![](../../images/Linux_æ­£åˆ™è¡¨è¾¾å¼/image-20250717215028874.png)\n![](../../images/Linux_æ­£åˆ™è¡¨è¾¾å¼/image-20250717215043574.png)\n\n## å•ç‹¬æŒ‡å®šåŒ¹é…æ¯ä¸€è¡Œçš„ç¬¬nåˆ—ï¼Œå…¶ä»–åˆ—è·³è¿‡\nemployeesæ–‡ä»¶å†…å®¹ï¼š\n![](../../images/Linux_æ­£åˆ™è¡¨è¾¾å¼/image-20250717215231997.png)\nå½¢å¼ï¼š\n```sh\nawk '$2~/^[A-z][a-z]+/ {print $1}' employees\n```\nå³ï¼Œåœ¨`' '`å†…çš„å‰é¢åŠ ä¸€ä¸ªç¬¬å‡ åˆ—`$2`å’Œæ³¢æµªå·`~`ã€‚\n\n![](../../images/Linux_æ­£åˆ™è¡¨è¾¾å¼/image-20250717215328968.png)\nç¬¬ä¸€å¥awkçš„æ„æ€æ˜¯æœç´¢**æ¯ä¸€è¡Œ**çš„**æ‰€æœ‰åˆ—**ï¼ŒæŸ¥æ‰¾ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œåé¢è‡³å°‘æœ‰ä¸€ä¸ªå°å†™å­—æ¯ã€‚åŒ¹é…åˆ°åï¼Œæ‰“å°è¯¥è¡Œçš„ç¬¬1åˆ—ã€‚\nç¬¬äºŒå¥awkçš„æ„æ€æ˜¯åªæœç´¢**æ¯ä¸€è¡Œ**çš„**ç¬¬2åˆ—**ï¼ŒæŸ¥æ‰¾ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œåé¢è‡³å°‘æœ‰ä¸€ä¸ªå°å†™å­—æ¯ã€‚åŒ¹é…åˆ°åï¼Œæ‰“å°è¯¥è¡Œçš„ç¬¬1åˆ—ã€‚\nç¬¬äºŒå¥awkçš„æ„æ€æ˜¯åªæœç´¢**æ¯ä¸€è¡Œ**çš„**ç¬¬3åˆ—**ï¼ŒæŸ¥æ‰¾ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œåé¢è‡³å°‘æœ‰ä¸€ä¸ªå°å†™å­—æ¯ã€‚åŒ¹é…åˆ°åï¼Œæ‰“å°è¯¥è¡Œçš„ç¬¬1åˆ—ã€‚ç”±äºç¬¬ä¸‰åˆ—å…¨æ˜¯æ•°å­—ï¼Œæ²¡æœ‰åŒ¹é…åˆ°ç¬¦åˆæ¡ä»¶çš„è¡Œï¼Œæ‰€ä»¥æ‰“å°ç©ºã€‚\n\n## å¯ä»¥åœ¨`{}`ä¸­å¯¹æ–‡ä»¶ä¿¡æ¯è¿›è¡Œä¿®æ”¹\n![](../../images/Linux_æ­£åˆ™è¡¨è¾¾å¼/image-20250717220024588.png)\nä»¥ä¸Šè¯­å¥çš„æ„æ€ï¼šæ‰¾æ¯ä¸€è¡Œçš„ç¬¬1åˆ—ä¸­å«Billyçš„ï¼Œä¹‹åï¼ŒæŠŠè¯¥è¡Œç¬¬1åˆ—ä¿®æ”¹ä¸º`Gilly`ã€‚ä¹‹åï¼Œæ‰“å°åŒ¹é…åˆ°çš„æ‰€æœ‰è¡Œã€‚\n## åœ¨å•å¼•å·ä¸­ï¼Œå†…ç½®äº†æ•°å­—å¤§å°æ¯”è¾ƒå™¨\npså†…å®¹ï¼š\n![](../../images/Linux_æ­£åˆ™è¡¨è¾¾å¼/image-20250717220401897.png)\næˆ‘ä»¬æƒ³è¦è¾“å‡ºæ‰€æœ‰PIDå¤§äº776çš„ï¼š\nå¯ä»¥åœ¨awkåçš„`' '`å•å¼•å·å†…å†™`$1>776`ï¼Œå®ƒå†…ç½®äº†æŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—ä¹‹åæ¯”è¾ƒçš„æ“ä½œï¼Œä¹‹åå¸®æˆ‘ä»¬ç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„ã€‚\n![](../../images/Linux_æ­£åˆ™è¡¨è¾¾å¼/image-20250717220429523.png)\n\nç”šè‡³è¿˜å¯ä»¥åœ¨é‡Œé¢å†™ä¸€äº›ç®€å•çš„è¿ç®—ï¼šï¼ˆ`'$1>776+1'`ï¼‰\n![](../../images/Linux_æ­£åˆ™è¡¨è¾¾å¼/image-20250717220555388.png)\n# sed\nStream Editor\n\nç”¨äºå¤„ç†æµã€‚æŠŠå­—ç¬¦ä¸²ã€æ–‡ä»¶æŒ‰æµçš„æ–¹å¼å¤„ç†ã€‚æµçš„ç‰¹ç‚¹æ˜¯åªèƒ½å•å‘ï¼Œä¸èƒ½åæ’¤ã€‚\n","categories":["Linux"]},{"title":"Linux_exprå‘½ä»¤","url":"/Linux/Linux_exprå‘½ä»¤/","content":"# å…ˆçœ‹`var=$var2+$var3`\n```sh\nmrcan@ubuntu:~$ var=1+2\nmrcan@ubuntu:~$ echo $var\n1+2\nmrcan@ubuntu:~$ var2=2\nmrcan@ubuntu:~$ var3=3\nmrcan@ubuntu:~$ var=$var2+$var3\nmrcan@ubuntu:~$ echo $var\n2+3\n```\næˆ‘ä»¬å‘ç°ï¼Œ`var=$var2+$var3`æœªèƒ½è®©2+3çš„ç»“æœ5èµ‹ç»™varï¼Œè€Œæ˜¯ä»¥å­—ç¬¦ä¸²çš„å½¢å¼ç»™äº†varã€‚\n# expr\nç”¨äºè®¡ç®—æ•°å€¼ç±»ã€‚\n\nwhichå‘ç°`expr`æ˜¯å­˜åœ¨`/usr/bin/expr`ä¸‹çš„ï¼Œè¯´æ˜æ˜¯ä¸ªå¸¸ç”¨çš„å‘½ä»¤ã€‚\n```sh\nmrcan@ubuntu:~$ expr 1+2\n1+2\n```\næˆ‘ä»¬å‘ç°ï¼Œä»¥å­—ç¬¦ä¸²çš„å½¢å¼è¾“å‡ºäº†exprçš„ç»“æœã€‚æ˜æ˜¾ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚\nå› ä¸ºè¦è®¡ç®—æ•°å€¼çš„è¯ï¼Œåœ¨è¿ç®—ç¬¦å‰åè¦åŠ ç©ºæ ¼åˆ†éš”å¼€ï¼\n```sh\nmrcan@ubuntu:~$ expr 1 + 2\n3\n```\n\n```sh\nmrcan@ubuntu:~$ expr $var2 + $var3\n5\n```\n# æŠŠexprçš„ç»“æœèµ‹ç»™ç¯å¢ƒå˜é‡\n```sh\nmrcan@ubuntu:~$ var=expr $var2 + $var3\n2: command not found\n```\n\n```sh\nmrcan@ubuntu:~$ var=(expr $var2 + $var3)\nmrcan@ubuntu:~$ echo $var\nexpr\n```\nä»¥ä¸Šä¸¤ç§éƒ½æ˜¯é”™è¯¯çš„ã€‚\n\nè¦ç”¨â€œå‘½ä»¤ä»£æ¢â€ã€‚\n\nçœ‹ï¼šã€ŠLinux_é‡å®šå‘#å‘½ä»¤ä»£æ¢ã€‹![å‘½ä»¤ä»£æ¢](Linux_é‡å®šå‘.md#å‘½ä»¤ä»£æ¢)\næ­£ç¡®çš„æ–¹å¼ï¼š****\n```sh\nmrcan@ubuntu:~$ var=$(expr $var2 + $var3)\nmrcan@ubuntu:~$ echo $var\n5\n```\n\n\n# ä½¿ç”¨exprç¼–å†™ä»1åŠ åˆ°100çš„è„šæœ¬\n```sh\n#! /bin/sh\n\nI=1\nSUM=0\nwhile (test $I -le 100) # å¯ä»¥ç®€å†™ä¸º while [ $I -le 100 ]\ndo\n    SUM=$(expr $SUM + $I)\n    I=$(expr $I + 1)\ndone\necho \"sum of 1 ... 50 is \"$SUM\n```\n\n```sh\nmrcan@ubuntu:~$ ./testif.sh \nsum of 1 ... 50 is 505\n```\n# ä¹˜å·éœ€è¦è½¬ä¹‰\n```sh\nmrcan@ubuntu:~$ expr 56 * 9\nexpr: syntax error: unexpected argument â€˜a.câ€™\nmrcan@ubuntu:~$ echo $?\n2\n```\nåœ¨exprå‘½ä»¤ä¸­ï¼Œä¹˜å·ä¸èƒ½ç›´æ¥å†™ï¼Œè€Œæ˜¯è¦`\\*`è½¬ä¹‰ã€‚\n```sh\nmrcan@ubuntu:~$ expr 56 \\* 9\n504\n```\n\né™¤å·ä¸ç”¨è½¬ä¹‰ã€‚\n```sh\nmrcan@ubuntu:~$ expr 56 / 9\n6\n```","categories":["Linux"]},{"title":"Linux_testå‘½ä»¤","url":"/Linux/Linux_testå‘½ä»¤/","content":"`-e`æŒ‡å®šæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼ˆç›®å½•ä¹Ÿæ˜¯æ–‡ä»¶ï¼‰\n\n`-d`æŒ‡å®šæ–‡ä»¶æ˜¯å¦å­˜åœ¨å¹¶ä¸”æ˜¯ç›®å½•\n\n`-f`æŒ‡å®šæ–‡ä»¶æ˜¯å¦å­˜åœ¨å¹¶ä¸”æ˜¯æ™®é€šæ–‡ä»¶\n\n`-r`æŒ‡å®šæ–‡ä»¶æ˜¯å¦ç”¨æˆ·å¯è¯»\n\n`-w`æŒ‡å®šæ–‡ä»¶æ˜¯å¦ç”¨æˆ·å¯å†™\n\n`-x`æŒ‡å®šæ–‡ä»¶æ˜¯å¦ç”¨æˆ·å¯æ‰§è¡Œ\n\n`-O`ç”¨æˆ·æ˜¯å¦æ˜¯è¯¥æ–‡ä»¶çš„æ‹¥æœ‰è€…\n# ä¸ä¼šç›´æ¥è¾“å‡ºç»“æœ\nç»“æœä¸ä¼šç›´æ¥è¾“å‡ºåˆ°å±å¹•ä¸Šï¼Œå¯ä»¥ç”¨`$?`æŸ¥çœ‹è¯¥å‘½ä»¤çš„æ‰§è¡Œç»“æœã€‚\n```sh\ntest -e xxx\necho $?\n\n```\nå¦‚æœè¾“å‡º 0ï¼Œä»£è¡¨çœŸï¼Œè¡¨ç¤ºå­˜åœ¨ã€‚\næµ‹è¯•ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¼šè¾“å‡º 1ï¼Œè¡¨ç¤ºä¸å­˜åœ¨ã€‚ï¼ˆ`$?`çš„ç»“æœä¸ºé 0 æ—¶ä»£è¡¨å‡ï¼‰\n\n>å…³äº`$?`è§ã€ŠLinux_Shellç¼–ç¨‹ã€‹çš„ã€Šç‰¹æ®Šå˜é‡ã€‹ä¸€èŠ‚ã€‚\n\nç»æµ‹è¯•ï¼Œç®¡é“é‡å®šå‘åˆ°echoä¹Ÿæ²¡æœ‰è¾“å‡ºç»“æœã€‚\n```sh\ntest -e xxx | echo\nï¼ˆæ— è¾“å‡ºï¼‰\n```\n# ä¸€èˆ¬å’ŒShellç¼–ç¨‹çš„ifåˆ¤æ–­ç»“åˆ\n```sh\n#!/bin/sh\nif (test -e $1)\nthen\n    echo \"$1 exists!\"\nelse\n    echo \"$1 not exists!\"\nfi\n```\n\n```sh\nchmod u+x c.sh\n./sh xxx\n```\n![](../../images/Linux_testå‘½ä»¤/image-20250716014144080.png)\n\n# testç»“åˆif - ç›¸å½“äº`[]`\nifåè·Ÿçš„`[ ... ]`ç›¸å½“äºï¼š`(test ...)`\n\nè§ã€ŠLinux_Shellç¼–ç¨‹#ifè¯­å¥ã€‹![[Linux_Shellç¼–ç¨‹#ifè¯­å¥]]\n# testç»“åˆæ¯”è¾ƒè¿ç®—ç¬¦\n\n```sh\nmrcan@ubuntu:~$ test 2 -gt 3\nmrcan@ubuntu:~$ echo $? # $? è¡¨ç¤ºä¸Šä¸€ä¸ªå‘½ä»¤çš„è¿”å›ç»“æœ\n1 # 1 è¡¨ç¤º å‡\nmrcan@ubuntu:~$ test 20 -gt 3\nmrcan@ubuntu:~$ echo $?\n0 # 0 è¡¨ç¤º çœŸ\n```\n\nteståœ¨å’Œ`-gt`ï¼ˆæˆ–`-lt`ã€`-le`ç­‰ç­‰ï¼‰ç»“åˆä½¿ç”¨çš„æ—¶å€™ï¼Œ`-gt`å‰åä¸æ˜¯çœ‹ä½œå­—ç¬¦ä¸²çš„ï¼Œæ˜¯å†…éƒ¨æŠŠ20è¿›è¡Œäº†ç±»ä¼¼äº`expr`çš„æ“ä½œè½¬æ¢æˆäº†æ•°å­—å†è¿›è¡Œæ¯”è¾ƒã€‚\n\n","categories":["Linux"]},{"title":"Linux_wcå‘½ä»¤(word count)","url":"/Linux/Linux_wcå‘½ä»¤(word count)/","content":"```sh\nwc file.txt\n```\n\n```sh\nmrcan@ubuntu:~$ wc testif.sh\n  9  27 131 testif.sh\n è¡Œ  è¯ å­—ç¬¦\n```\n\né»˜è®¤æ˜¾ç¤ºè¡Œã€è¯ã€å­—ç¬¦æ•°ã€‚\n\nå¯ä»¥å•ç‹¬æŒ‡å®šï¼š\n```sh\nmrcan@ubuntu:~$ wc -w testif.sh \n27 testif.sh\nmrcan@ubuntu:~$ wc -l testif.sh \n9 testif.sh\nmrcan@ubuntu:~$ wc -c testif.sh \n131 testif.sh\n```\n# word `-w`\nåªè¦ä¸­é—´æ²¡æœ‰ç©ºæ ¼ã€æ¢è¡Œç¬¦ï¼Œå°±æ˜¯1ä¸ªwordã€‚\n# line `-l`\n# character `-c`\n1ä¸ªè‹±æ–‡å­—æ¯ç®—1ä¸ªå­—ç¬¦\n# byte","categories":["Linux"]},{"title":"Linux_é‡å®šå‘","url":"/Linux/Linux_é‡å®šå‘/","content":"# æœ‰å“ªäº›\næœ‰æ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºé‡å®šå‘ã€‚\næœ‰å‘½ä»¤ä»£æ¢ã€‚\næœ‰ç®¡é“ã€‚\n# æ ‡å‡†è¾“å‡ºé‡å®šå‘\n```c\n#include <stdio.h>\nint main()\n{\n    printf(\"C Program!\\n\");\n    return 0;\n}\n```\nç¼–è¯‘ä¸º`a.out`ã€‚\n`>`ä¸ºå®Œå…¨è¦†ç›–å†™ã€‚\n```sh\n./a.out > aa.txt\n```\nç›®å‰`aa.txt`å†…å®¹ä¸º\n```\nC Program!\n```\n`>>`ä¸ºè¿½åŠ å†™ã€‚\n```sh\n./a.out >> aa.txt\n```\nç›®å‰`aa.txt`å†…å®¹ä¸º\n```\nC Program!\nC Program!\n```\n# æ ‡å‡†è¾“å…¥é‡å®šå‘\n```c\n#include <stdio.h>\nint main()\n{\n    char str[50];\n    scanf(\"%s\", str);\n    printf(\"%s\\n\", str);\n    return 0;\n}\n```\nç¼–è¯‘ä¸º`b.out`\n```sh\n./b.out < \"hello\"\n```\næç¤ºï¼š\n![](../../images/Linux_é‡å®šå‘/image-20250716002226113.png)\næ‰€ä»¥æ ‡å‡†è¾“å…¥é‡å®šå‘ä¸èƒ½æ˜¯ç®€å•çš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯è¦é‡å®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶ã€‚\nå…ˆç”¨`echo`æŠŠä¸€äº›å†…å®¹è¾“å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼š\n```sh\necho \"hello\" > aa.txt\n./b.out < aa.txt\n```\næ‰§è¡Œç»“æœï¼š\n```\nhello\n```\n# ç®¡é“\næˆ‘ä»¬ä¸Šé¢è®²çš„æ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºé‡å®šå‘éƒ½æ˜¯æ–‡ä»¶å’Œç¨‹åºä¹‹é—´çš„äº¤äº’ã€‚\nè€Œç®¡é“æ˜¯è¿›ç¨‹ä¹‹é—´çš„äº¤äº’ã€‚\n\nç”¨ä¸Šé¢çš„`a.out`å’Œ`b.out`ç¤ºä¾‹ä¸€ä¸‹ç®¡é“ï¼š\n```sh\n./a.out | ./b.out\n```\næ‰§è¡Œç»“æœï¼š\n```\nC\n```\nï¼ˆæ²¡æœ‰æ˜¾ç¤ºå…¨`C Program!`ï¼Œæ˜¯å› ä¸ºä¸­é—´æœ‰ç©ºæ ¼ï¼Œscanfåªè¾“å…¥äº†ç©ºæ ¼å‰çš„Cå­—ç¬¦ã€‚ï¼‰\n# å‘½ä»¤ä»£æ¢\nCommand Substitution\n\nå½¢å¦‚ï¼š\n```sh\nvar2=$(./a.out)\nvar3=$(./1st.sh)\n```\nå³ï¼Œå¯ä»¥æŠŠ**ç¨‹åºã€shellè„šæœ¬è¿è¡Œçš„ç»“æœå†™å…¥åˆ°ç¯å¢ƒå˜é‡**ä¸­ã€‚\n\nä¾¿äºè„šæœ¬ç¼–å†™ä¸­æ¶‰åŠåˆ°çš„å‘½ä»¤ä¸­è½¬ï¼Œå¯ä»¥å…ˆä¿å­˜åˆ°ç¯å¢ƒå˜é‡ä¸­ã€‚ä½¿ç”¨å‘½ä»¤ä»£æ¢ï¼Œé¿å…äº†åœ¨ä»£ç ä¸­ç¼–å†™è¯»å†™æ–‡ä»¶çš„ç¹çã€‚\n![](../../images/Linux_é‡å®šå‘/image-20250716004406561.png)\n\n![](../../images/Linux_é‡å®šå‘/image-20250716004422370.png)\n\n","categories":["Linux"]},{"title":"Linux_å¯åŠ¨è¿‡ç¨‹","url":"/Linux/Linux_å¯åŠ¨è¿‡ç¨‹/","content":"è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°å…¨éƒ¨è¿›ç¨‹ã€‚\n```bash\nps -aux | less\n```\nä¸‹é¢æ˜¯FreeBSDçš„ Unix ç³»ç»Ÿçš„æµ‹è¯•ç»“æœï¼š\n\n![](../../images/Linux_å¯åŠ¨è¿‡ç¨‹/image-20250715233203947.png)\n\n0 å·è¿›ç¨‹ä¸º`[kernel]`ã€‚ï¼ˆæµ‹è¯•çš„Ubuntu Linux ç³»ç»Ÿæ²¡æœ‰æ˜¾ç¤º 0 å·è¿›ç¨‹ï¼‰\n\n1å·è¿›ç¨‹ä¸º`/sbin/init`ã€‚ç”¨äºåˆå§‹åŒ–ã€‚\n\n`[ctypto]`ç”¨äºåŠ å¯†ã€‚\n\næœ‰ä¸€ä¸ªç‰¹æ®Šçš„`[idle]`è¿›ç¨‹ï¼Œç”¨äºç©ºé—²æ—¶çš„è°ƒåº¦ã€‚æŸä¸ªè¿›ç¨‹æ—¶é—´ç‰‡ç»“æŸï¼Œåˆ™æŠŠæƒåŠ›ä¸Šäº¤`[idle]`ã€‚ç”±`[idle]`å†³å®šä¸‹ä¸€æ¬¡è°ƒç”¨è°ã€‚\n\n![](../../images/Linux_å¯åŠ¨è¿‡ç¨‹/image-20250715234246004.png)\n\n\nUnix ç³»ç»Ÿæœ‰å¤šä¸ª gettyï¼Œæ˜¯ç»ˆç«¯ç¨‹åºã€‚ä¸€æ—¦æœ‰å“ªä¸ªäººç™»å½•ï¼Œå…¶ä¸­ä¸€ä¸ª getty å°±è´Ÿè´£è°ƒç”¨ loginï¼ˆç™»é™†å™¨ï¼‰ï¼Œç”¨äºç™»å½•ç›¸å…³ã€‚\nå¦‚æœç”¨æˆ·åã€å¯†ç åŒ¹é…ï¼Œæœ€ç»ˆå°±ä¼šæ‰“å¼€Shellã€‚\n\n![](../../images/Linux_å¯åŠ¨è¿‡ç¨‹/image-20250715232614864.png)\n\n\n\n","categories":["æ“ä½œç³»ç»Ÿ","Linux"]},{"title":"Linux_å®‰è£…è½¯ä»¶","url":"/Linux/Linux_å®‰è£…è½¯ä»¶/","content":"# è§£å‹\nå¤§éƒ¨åˆ†æºä»£ç åŒ…éƒ½ä»¥`.tar.gz`å½¢å¼å­˜å‚¨ã€‚\nç”¨`tar -xzvf make-4.2.tar.gz (åé¢å¯ä»¥åŠ å‚æ•°ï¼ŒæŒ‡å®šè§£å‹åˆ°å“ªä¸ªç›®å½•)`è§£å‹ã€‚\n\n# æºç ç›®å½•\n```sh\ncd make-4.2\nls\n```\n# configure\næ¯ä¸€ä¸ªé¡¹ç›®æºç ç›®å½•ä¸‹ï¼ŒåŸºæœ¬éƒ½æœ‰configureæ–‡ä»¶ã€‚è¿™æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå†…å®¹æ˜¯Shellè„šæœ¬ã€‚\né‡Œé¢ä¼šæŒ‡ç¤ºè¦æŒ‰ç…§è¿™ä¸ªè½¯ä»¶éœ€è¦ç³»ç»Ÿæœ‰ä»€ä¹ˆå¿…è¦çš„ç¯å¢ƒã€å‰ç½®è½¯ä»¶ã€‚\n```sh\n./configure\n```\n\n![](../../images/Linux_å®‰è£…è½¯ä»¶/image-20250716175803575.png)\n\nå¦‚ä¸Šï¼Œconfigureä¼šç»™ä½ æ£€æŸ¥ç³»ç»Ÿç¯å¢ƒã€‚\nå¦‚æœæ£€æŸ¥æ— è¯¯ï¼Œåˆ™ä¼šç»™ä½ ç”Ÿæˆ`build.sh`ä»¥åŠé¡¹ç›®ç®¡ç†æ–‡ä»¶Makefileã€‚\n# make install\n```sh\nmake install\n```\nä¼šå¸®ä½ è°ƒç”¨ç³»ç»Ÿå¯ç”¨çš„ç¼–è¯‘å™¨ï¼Œè¿›è¡Œç¼–è¯‘ã€å®‰è£…ã€‚\nä¸€èˆ¬é»˜è®¤å®‰è£…ä½ç½®æ˜¯`/usr/local/bin`ä¸‹\n\nå¦‚æœåªæ˜¯makeï¼Œåˆ™åªç¼–è¯‘ã€‚\nå¦‚æœè¦å®‰è£…ï¼Œéœ€è¦`make install`ã€‚ç›¸å½“äºæŠŠå¯æ‰§è¡Œæ–‡ä»¶ç§»åŠ¨åˆ°ç³»ç»Ÿå¯æ‰§è¡Œç›®å½•ï¼ˆ`/.../bin`ï¼‰ä¸‹ã€‚\nå¯ä»¥ç”¨`make uninstall`å¸è½½ã€‚","categories":["Linux"]},{"title":"Linux_ç¼–è¾‘å™¨","url":"/Linux/Linux_ç¼–è¾‘å™¨/","content":"\n# æœ‰å“ªäº›\nviã€vimã€Emacsã€eeï¼ˆUnixè‡ªå¸¦çš„ï¼‰\n\nEmacsæ˜¯æœ€éš¾ç”¨çš„ï¼Œä½†æ˜¯å¦‚æœæŒæ¡äº†ï¼Œèƒ½è·ç›Šä¸å°‘ï¼Ÿ\n# eeç¼–è¾‘å™¨\n```shell\nee 1st.sh\n```\nè¿›å…¥ç¼–è¾‘å™¨åçš„æ ·å­ï¼š\n\nä¸ŠåŠéƒ¨åˆ†ï¼šæŒ‰CtrlåŠ ç›¸åº”çš„ç¬¦å·å¯ä»¥è°ƒç”¨ä¸€äº›åŠŸèƒ½ã€‚\n\n![](../../images/Linux_ç¼–è¾‘å™¨/image-20250715235658871.png)\n\n## æŒ‰CtrlåŠ `[`æˆ–æŒ‰ESCè¿›å…¥èœå•\n![](../../images/Linux_ç¼–è¾‘å™¨/image-20250716000216760.png)\n\nåœ¨æŒ‰`a`ç¦»å¼€ç¼–è¾‘å™¨æ—¶ï¼Œå¦‚æœæ²¡ä¿å­˜æ–‡ä»¶ä¼šæç¤ºä½ ä¿å­˜ï¼š\n![](../../images/Linux_ç¼–è¾‘å™¨/image-20250716000318642.png)\n\n# Emacsç¼–è¾‘å™¨\næ‰“å¼€æ–‡ä»¶ã€‚\n\n```sh\nemacs 3th.sh\n```\n\næŒ‰ä¸€ä¸‹ESCï¼Œå†æŒ‰ä¸€ä¸‹xï¼ˆæ˜ å°„Emacsçš„M-xå‘½ä»¤ï¼‰ã€‚åœ¨åº•è¡Œè¾“å…¥linumï¼Œè¡¨ç¤ºï¼šLine Numï¼Œè®¾ç½®æ˜¾ç¤ºè¡Œå·ã€‚\n![](../../images/Linux_ç¼–è¾‘å™¨/image-20250716182031711.png)\n\n\n## é€€å‡ºã€ä¿å­˜\nCtrlåŠ xã€CtrlåŠ cæ˜¯é€€å‡ºã€‚\nä¹‹åï¼Œåº•è¡Œä¼šé—®ä½ ï¼Œæ˜¯å¦ä¿å­˜ï¼ŒæŒ‰yå³å¯ä¿å­˜ã€‚\n![](../../images/Linux_ç¼–è¾‘å™¨/image-20250716185429960.png)\n\n# ä¿®æ”¹æ˜ å°„\né»˜è®¤é…ç½®ä¸‹ï¼ŒEmacsæ²¡æœ‰é€€æ ¼é”®ï¼ˆBackspaceï¼‰ã€åˆ é™¤é”®ï¼ˆDeleteï¼‰çš„æ˜ å°„ï¼Œåœ¨æˆ‘ä»¬ç¼–è¾‘æ–‡ä»¶æ—¶ä¸æ–¹ä¾¿åˆ å­—ç¬¦ã€‚æˆ‘ä»¬åœ¨ç”¨æˆ·å®¶ç›®å½•ä¸‹çš„`.emacs`ä¸­è¿½åŠ é…ç½®ä»¥ä¸‹å†…å®¹ï¼š\n```\n(global-set-key) \"\\C-h\" 'backward-delete-char-untabify)\n(global-set-key) \"\\d\" 'delete-char)\n```\n","categories":["Linux"]},{"title":"Cpp11å¤šçº¿ç¨‹ç¼–ç¨‹_å¤ä¹ ","url":"/å¤šçº¿ç¨‹/Cpp11å¤šçº¿ç¨‹ç¼–ç¨‹_å¤ä¹ /","content":"# è¿›ç¨‹å’Œçº¿ç¨‹\nè¿›ç¨‹æ˜¯è¿è¡Œä¸­çš„ç¨‹åºã€‚çº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­çš„è¿›ç¨‹ã€‚\n# C++11 Threadåº“\n## åˆ›å»ºçº¿ç¨‹\nåˆ›å»ºçº¿ç¨‹éœ€è¦ä¸€ä¸ªå¯è°ƒç”¨çš„å‡½æ•°æˆ–å‡½æ•°å¯¹è±¡ï¼Œä½œä¸ºçº¿ç¨‹çš„å…¥å£ç‚¹ã€‚åœ¨C++11ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å‡½æ•°æŒ‡é’ˆã€å‡½æ•°å¯¹è±¡æˆ–lambdaè¡¨è¾¾å¼æ¥å®ç°ã€‚\n```cpp\n#include <iostream>\n#include <thread>\nvoid printHelloWorld()\n{\n    std::cout << \"Hello World\" << std::endl;\n}\nint main()\n{\n    // 1 create a thread\n    std::thread thread1(printHelloWorld);\n    return 0;\n}\n```\nä¸Šé¢è¿™ä¸ªç¨‹åºè¿è¡Œåï¼Œå¯èƒ½ä¼šæŠ¥é”™ã€‚\n![](../../images/Cpp11å¤šçº¿ç¨‹ç¼–ç¨‹_å¤ä¹ /image-20250714141601405.png)\n![](../../images/Cpp11å¤šçº¿ç¨‹ç¼–ç¨‹_å¤ä¹ /image-20250714141622256.png)\nå› ä¸ºä¸»çº¿ç¨‹mainå¼€å¯çº¿ç¨‹åï¼Œç»§ç»­æ‰§è¡Œè‡ªå·±çš„å†…å®¹ï¼Œä¸ä¼šç­‰å¾…å­çº¿ç¨‹ã€‚\nä½†æ˜¯ä¸€æ—¦ä¸»çº¿ç¨‹ç»“æŸï¼Œæ§åˆ¶å°çª—å£å°±ä¼šç»“æŸã€‚å› æ­¤å­çº¿ç¨‹å¯èƒ½æ‰“å°ä¸å…¨ã€‚è¿™ä¼šå¯¼è‡´è¿è¡Œç»“æœä¸ç¬¦é¢„æœŸã€‚\n## join - ä¸»çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹\nä¸ºäº†è®©å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸»çº¿ç¨‹ä¸­åŠ å…¥`join()`ã€‚è¿™æ ·ï¼Œå¦‚æœå­çº¿ç¨‹æ²¡æœ‰ç»“æŸï¼Œåˆ™ä¸»çº¿ç¨‹ä¹Ÿä¸ä¼šé€€å‡ºã€‚\n```cpp\nint main()\n{\n    // 1 create a thread\n    std::thread thread1(printHelloWorld);\n    \n    thread1.join();\n    return 0;\n}\n```\n![](../../images/Cpp11å¤šçº¿ç¨‹ç¼–ç¨‹_å¤ä¹ /image-20250714142050094.png)\n### joinæ˜¯é˜»å¡çš„ï¼šç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œä¸»çº¿ç¨‹æ‰ä¼šç»§ç»­æ‰§è¡Œjoinåé¢çš„å†…å®¹\n```cpp\n#include <iostream>\n#include <thread>\nvoid printHelloWorld(std::string msg)\n{\n    //std::cout << \"Hello World\" << std::endl;\n    std::cout << msg << std::endl;\n    std::cin >> msg;\n}\nint main()\n{\n    // 1 create a thread\n    std::thread thread1(printHelloWorld, \"Hello Thread\");\n    \n    thread1.join();\n    std::cout << \"Hello World\" << std::endl;\n    return 0;\n}\n```\næ‰§è¡Œåå‘ç°ï¼Œç”±äºä¸»çº¿ç¨‹çš„æ‰“å°æ˜¯åœ¨joinåé¢çš„ï¼Œå½“æˆ‘ä»¬åœ¨é”®ç›˜ä¸Šè¾“å…¥å­—ç¬¦ä¸²åå›è½¦ï¼Œä¸»çº¿ç¨‹æ‰ä¼šç»§ç»­æ‰“å°ã€‚\næ‰§è¡Œç»“æœï¼š\n```\nHello Thread    # å­çº¿ç¨‹æ‰“å°\n123             # æˆ‘ä»¬è‡ªå·±è¾“å…¥çš„\nHello World     # ä¸»çº¿ç¨‹æ‰“å°\n```\n## ä¼ å‚\nä¸»çº¿ç¨‹å¯ä»¥ç»™å­çº¿ç¨‹ä¼ å…¥å‚æ•°ã€‚\n```cpp\n#include <iostream>\n#include <thread>\nvoid printHelloWorld(std::string msg)\n{\n    //std::cout << \"Hello World\" << std::endl;\n    std::cout << msg << std::endl;\n}\nint main()\n{\n    // 1 create a thread\n    std::thread thread1(printHelloWorld, \"Hello Thread\");\n    \n    thread1.join();\n    return 0;\n}\n```\næ‰§è¡Œç»“æœï¼š\n```\nHello Thread\n```\n## detach\nåˆ†ç¦»çº¿ç¨‹ã€‚\nè¿™ä¼šè®©å­çº¿ç¨‹åœ¨åå°è¿è¡Œï¼Œè„±ç¦»ä¸»çº¿ç¨‹çš„ç®¡åˆ¶ã€‚\n```cpp\n#include <iostream>\n#include <thread>\nvoid printHelloWorld(std::string msg)\n{\n    //std::cout << \"Hello World\" << std::endl;\n    std::cout << msg << std::endl;\n}\nint main()\n{\n    // 1 create a thread\n    std::thread thread1(printHelloWorld, \"Hello Thread\");\n\n    thread1.detach();\n    \n    return 0;\n}\n```\næ­¤æ—¶æ‰§è¡Œç»“æœä¸ºç©ºï¼š\n```\nï¼ˆç©ºï¼‰\n```\nè¿™æ˜¯å› ä¸ºå­çº¿ç¨‹è¿˜æ²¡æ¥å¾—åŠæ‰“å°ï¼Œä¸»çº¿ç¨‹å°±å·²ç»ç»“æŸäº†ï¼Œä½†æ˜¯ä¸ä¼šæŠ¥é”™ã€‚\n## joinable()æ–¹æ³•\n```cpp\nint main()\n{\n    // 1 create a thread\n    std::thread thread1(printHelloWorld, \"Hello Thread\");\n\n    bool canJoin = thread1.joinable();\n    if (canJoin)\n    {\n        thread1.join();\n    }\n    \n    return 0;\n```\nä¼šè¿”å›ä¸€ä¸ªboolå€¼ï¼Œä¸ºçœŸæ—¶ï¼Œè¿™ä¸ªçº¿ç¨‹æ‰èƒ½joinæˆ–è€…detachã€‚\nå¦‚æœçº¿ç¨‹ä¸æ˜¯joinableçš„è¯ï¼Œå»å¼ºè¡Œjoinï¼Œç³»ç»Ÿå°±ä¼šæŠ¥é”™ï¼š`system_error`ã€‚\nä¸¥è°¨èµ·è§ï¼Œåœ¨é¡¹ç›®ä¸­åº”è¯¥å…ˆåˆ¤æ–­çº¿ç¨‹æ˜¯å¦joinableã€‚\n# ä¼ å‚ï¼šä¼ é€’å¼•ç”¨ç±»å‹\næˆ‘ä»¬çŸ¥é“ï¼Œå‡½æ•°å‚æ•°ä¸ºå¼•ç”¨æ—¶ï¼Œä¸å¯ä»¥ä¼ å…¥çº¯å³å€¼ã€‚\n```cpp\n#include <iostream>\n#include <thread>\nvoid foo(int& x)\n{\n    x += 1;\n}\nint main()\n{\n    int a = 1;  \n\n    foo(1);     // error\n}// æ— æ³•ç¼–è¯‘\n```\nèƒ½ä¸èƒ½ä¼ å…¥æ™®é€šå˜é‡å‘¢ï¼Ÿé—´æ¥æ“ä½œæºå¤´æ•°æ®ã€‚\næ™®é€šå‡½æ•°å¯ä»¥ã€‚\n```cpp\n#include <iostream>\n#include <thread>\nvoid foo(int& x)\n{\n    x += 1;\n}\nint main()\n{\n    int a = 1;  \n\n    foo(a);     // a = 2\n}// å¯ä»¥ç¼–è¯‘é€šè¿‡ã€è¿è¡Œ\n```\n## çº¿ç¨‹å‡½æ•°ä¸ºå¼•ç”¨ç±»å‹æ—¶\nä½†æ˜¯å½“**çº¿ç¨‹å‡½æ•°**å‚æ•°ä¸ºå¼•ç”¨æ—¶ï¼Œæˆ‘ä»¬ä¸èƒ½ä¼ å…¥æ™®é€šå˜é‡ç±»å‹ã€‚\nä¼ å…¥æ™®é€šå˜é‡ç±»å‹ï¼Œç¼–è¯‘ä¸é€šè¿‡ã€‚\n```cpp\n#include <iostream>\n#include <thread>\nvoid foo(int& x)\n{\n    x += 1;\n}\nint main()\n{\n    int a = 1;\n    std::thread t(foo, a); // error\n    t.join();\n    return 0;\n}// ç¼–è¯‘ä¸é€šè¿‡\n```\n![](../../images/Cpp11å¤šçº¿ç¨‹ç¼–ç¨‹_å¤ä¹ /image-20250714144737398.png)\n## `std::ref`\nä¸Šé¢çš„ç¼–è¯‘ä¸é€šè¿‡çš„é—®é¢˜æ˜¯å› ä¸ºæ™®é€šå˜é‡ç±»å‹å’Œçº¿ç¨‹å‡½æ•°å‚æ•°çš„å·¦å€¼å¼•ç”¨ç±»å‹ä¸åŒ¹é…ã€‚å¯ä»¥ä½¿ç”¨`std::ref`åŒ…è£…ä¼ å…¥ã€‚\n```cpp\n#include <iostream>\n#include <thread>\nvoid foo(int& x)\n{\n    x += 1;\n}\nint main()\n{\n    int a = 1;\n    std::thread t(foo, std::ref(a)); // a = 2\n    t.join();\n\n    return 0;\n}// ç¼–è¯‘æ²¡é—®é¢˜ï¼Œè¿è¡Œæ²¡é—®é¢˜ã€‚\n```\nä¸Šé¢è¿™ä¸ªç¨‹åºï¼šç¼–è¯‘æ²¡é—®é¢˜ï¼Œè¿è¡Œæ²¡é—®é¢˜ã€‚\n# çº¿ç¨‹æ‰§è¡Œæ—¶çš„é—®é¢˜\n## ä¼ é€’å¼•ç”¨ç±»å‹åçš„æœªå®šä¹‰è¡Œä¸º\nè™½ç„¶ä¼ å…¥`std::ref`è®©ç¨‹åºç¼–è¯‘æˆåŠŸï¼Œä½†æ˜¯å®é™…ä¸Šçº¿ç¨‹å‡½æ•°æ‰§è¡Œæ—¶ï¼Œå¯èƒ½æºå¤´aè¢«ææ„ï¼Œä»è€Œå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºã€‚\n```cpp\n#include <iostream>\n#include <thread>\nstd::thread t;\nvoid foo(int& x)\n{\n    x += 1;\n}\nvoid test()\n{\n    int a = 1;       // error\n    t = std::thread(foo, std::ref(a)); // å¼€å§‹æ‰§è¡Œçº¿ç¨‹\n    // test å‡½æ•° ç»“æŸï¼Œaé”€æ¯ã€‚\n}\nint main()\n{\n    test();\n    t.join();\n    return 0;\n}\n```\n![](../../images/Cpp11å¤šçº¿ç¨‹ç¼–ç¨‹_å¤ä¹ /image-20250714151706860.png)\nä¸Šé¢è¿™ä¸ªç¨‹åºï¼Œ**ç¼–è¯‘å¯ä»¥é€šè¿‡ï¼Œä½†æ‰§è¡Œæ—¶æŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸**ã€‚\n\nå†æ¥çœ‹ä¸€ä¸ªç¨‹åºï¼š\n```cpp\n#include <iostream>\n#include <thread>\nstd::thread t;\nvoid foo(int* x)\n{\n    std::cout << *x << std::endl;\n}\nint main()\n{\n    int* ptr = new int{ 1 };\n    std::thread t(foo, ptr);\n    delete ptr;             // åœ¨å­çº¿ç¨‹æ“ä½œç»“æŸå‰é”€æ¯ptræŒ‡å‘çš„å˜é‡\n    t.join();\n    return 0;\n}\n```\nä¸Šé¢è¿™ä¸ªç¨‹åºï¼Œ**ç¼–è¯‘å¯ä»¥é€šè¿‡ï¼Œä½†è¾“å‡ºç»“æœæ˜¯é”™è¯¯çš„**ã€‚\nè¾“å‡ºï¼š-572662307ã€‚\nè¿™æ˜¯æ˜æ˜¾çš„æœªå®šä¹‰è¡Œä¸ºã€‚\n\nè§£å†³æ–¹æ¡ˆæ˜¯å°†è¯¥å˜é‡çš„ç”Ÿå‘½æœŸå»¶é•¿åˆ°å­çº¿ç¨‹ç»“æŸï¼Œå³å…ˆå­˜åˆ°ä¸€ä¸ªæŒä¹…çš„å¯¹è±¡ä¸­ï¼Œå†æŠŠè¯¥å¯¹è±¡çš„å¼•ç”¨ä¼ é€’ç»™çº¿ç¨‹ã€‚\næˆ‘ä»¬æŠŠ`int a = 1;`æŒªåˆ°å…¨å±€å®šä¹‰å³å¯ã€‚\n```cpp\n#include <iostream>\n#include <thread>\nstd::thread t;\nint a = 1;       // ok\nvoid foo(int& x)\n{\n    x += 1;\n}\nvoid test()\n{\n    t = std::thread(foo, std::ref(a));\n}\nint main()\n{\n    test();     // a = 2\n    t.join();\n    return 0;\n}\n```\næ­¤æ—¶ï¼Œç¼–è¯‘æˆåŠŸï¼Œè¿è¡Œä¹Ÿæ­£ç¡®ã€‚\n\n## çº¿ç¨‹å‡½æ•°ä¸ºæˆå‘˜å‡½æ•°æ—¶éœ€è¦æ³¨æ„çš„\n```cpp\n#include <iostream>\n#include <thread>\n#include <memory>\nclass A\n{\nprivate:\n    friend int main();\n    void foo()\n    {\n        std::cout << value << std::endl;\n    }\n    int value = 1;\n};\nint main()\n{\n    A* a = new A();\n    std::thread t(&A::foo, a);\n    delete a;\n    t.join();\n}\n```\næ­¤æ—¶ç¼–è¯‘é€šè¿‡ï¼Œè¾“å‡ºç»“æœé”™è¯¯ï¼š-572662307ã€‚\næˆ‘ä»¬å¯ä»¥é€šè¿‡sharedæ™ºèƒ½æŒ‡é’ˆæ¥è§£å†³ã€‚\n```cpp\n#include <iostream>\n#include <thread>\n#include <memory>\nclass A\n{\nprivate:\n    friend int main();\n    void foo()\n    {\n        std::cout << value << std::endl;\n    }\n    int value = 1;\n};\nint main()\n{\n    std::shared_ptr<A> a = std::make_shared<A>();\n    std::thread t(&A::foo, a);\n    a.reset();   // æ¨¡æ‹Ÿä¸»çº¿ç¨‹åœ¨å­çº¿ç¨‹æ‰§è¡Œå‰é”€æ¯Aå¯¹è±¡\n    t.join();\n}\n```\næ­¤æ—¶ç¼–è¯‘é€šè¿‡ï¼Œè¾“å‡ºç»“æœæ­£ç¡®ï¼š1ã€‚\n# äº’æ–¥é‡ `std::mutex`\nå¯¹ä¸€ä¸ªå…±äº«å˜é‡ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½å»å¯¹å…¶åŠ 1ï¼Œ10000æ¬¡ã€‚\n```cpp\n#include<iostream>\n#include<thread>\n#include<mutex>\nint a = 0;\nvoid func()\n{\n    for (int i = 0; i < 10000; ++i)\n    {\n        a = a + 1;\n    }\n}\nint main()\n{\n    std::thread t1(func);\n    std::thread t2(func);\n\n    t1.join();\n    t2.join();\n\n    std::cout << a << std::endl;\n}\n```\nè¿è¡Œç»“æœï¼š11083\n\næˆ‘ä»¬çš„é¢„æœŸæ˜¯20000ã€‚\nè¿è¡Œç»“æœä¸ç¬¦æ˜¯å› ä¸ºï¼Œä¸¤ä¸ªçº¿ç¨‹å¯èƒ½åŒæ—¶è¯»åˆ°äº†ç›¸åŒçš„æ•°æ®ï¼Œè€ŒååŠ 1è¿”å›ç»™aï¼Œç›¸å½“äºå°‘åŠ äº†1æ¬¡ã€‚\n\nå¯ä»¥ç»™äº’æ–¥é‡åŠ é”è§£å†³ï¼š\n```cpp\n#include<iostream>\n#include<thread>\n#include<mutex>\nint a = 0;\nstd::mutex mtx;\nvoid func()\n{\n    for (int i = 0; i < 10000; ++i)\n    {\n        mtx.lock();\n        a += 1;\n        mtx.unlock();\n    }\n}\nint main()\n{\n    std::thread t1(func);\n    std::thread t2(func);\n\n    t1.join();\n    t2.join();\n\n    std::cout << a << std::endl;\n}\n```\nè¿è¡Œç»“æœ20000ã€‚\n## çº¿ç¨‹å®‰å…¨çš„å®šä¹‰ï¼Ÿ\nå¦‚æœå¤šçº¿ç¨‹ç¨‹åºæ¯ä¸€æ¬¡çš„è¿è¡Œç»“æœå’Œå•çº¿ç¨‹è¿è¡Œçš„ç»“æœå§‹ç»ˆæ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚\n## äº’æ–¥é‡æ­»é”\n```cpp\n#include<iostream>\n#include<thread>\n#include<mutex>\nint a = 0;\nstd::mutex mtx1;\nstd::mutex mtx2;\nvoid func1()\n{\n    for (int i = 0; i < 50; ++i)\n    {\n        mtx1.lock();\n        mtx2.lock();\n        mtx1.unlock();\n        mtx2.unlock();\n    }\n}\nvoid func2()\n{\n    for (int i = 0; i < 50; ++i)\n    {\n        mtx2.lock();\n        mtx1.lock();\n        mtx2.unlock();\n        mtx1.unlock();\n    }\n}\nint main()\n{\n    std::cout << \"begin\" << std::endl;\n\n    std::thread t1(func1);\n    std::thread t2(func2);\n\n    t1.join();\n    t2.join();\n\n    std::cout << \"over\" << std::endl;\n}\n```\nè¿è¡Œç»“æœï¼š\n```\nbegin\n...ï¼ˆæ­»é”ï¼‰\n```\n## `std::lock_guard`\n`std::lock_guard`æ˜¯`C++`æ ‡å‡†åº“ä¸­çš„ä¸€ç§äº’æ–¥é‡å°è£…ç±»ï¼Œç‰¹ç‚¹å¦‚ä¸‹ï¼š\n* æ„é€ å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œäº’æ–¥é‡ä¼šè¢«è‡ªåŠ¨é”å®š\n* ææ„å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œäº’æ–¥é‡ä¼šè¢«è‡ªåŠ¨è§£é”\n* lock_guardå¯¹è±¡ä¸èƒ½å¤åˆ¶æˆ–ç§»åŠ¨ã€‚\n\n```cpp\n#include<iostream>\n#include<thread>\n#include<mutex>\nint a = 0;\nstd::mutex mtx;\nvoid func()\n{\n    for (int i = 0; i < 10000; ++i)\n    {\n        std::lock_guard<std::mutex> lg(mtx);\n        a = a + 1;\n    }\n}\nint main()\n{\n    std::thread t1(func);\n    std::thread t2(func);\n\n    t1.join();\n    t2.join();\n\n    std::cout << a << std::endl;\n}//20000\n```\n### æºç å®ç°\nå¾ˆç®€å•ã€‚å°±æ˜¯åœ¨æ„é€ å‡½æ•°ä¸­åŠ é”ï¼Œåœ¨ææ„å‡½æ•°ä¸­è§£é”ã€‚\n![](../../images/Cpp11å¤šçº¿ç¨‹ç¼–ç¨‹_å¤ä¹ /image-20250714195038734.png)\n### explicitæ„é€ \n```cpp\nexplicit lock_guard(_Mutex& _Mtx) : _MyMutex(_Mtx)\n{\n    _MyMutex.lock();\n}\n```\næŒ‡ç¤ºç¦æ­¢éšå¼è½¬æ¢è¿›è¡Œæ„é€ å‡½æ•°ä¼ å‚ï¼Œå¿…é¡»æŒ‡æ˜mutexç±»å‹ã€‚\n### `adopt_lock`\nå¦‚æœæ„é€ æ—¶é™¤äº†ä¼ å…¥`std::mutex`ï¼Œè¿˜ä¼ å…¥äº†`adopt_lock`ï¼Œå°±åªæ„é€ ï¼Œè€Œä¸å¯¹`mutex`è¿›è¡Œ`lock`ã€‚è¿™å¯ä»¥ç”¨åˆ°åœ¨å·²ç»æŒæ¡äº†äº’æ–¥é‡çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚\nä½†æ˜¯ææ„æ˜¯ä¸€å®šä¼šå¯¹mutexè¿›è¡Œè§£é”çš„ã€‚\n```cpp\n#include<iostream>\n#include<thread>\n#include<mutex>\nint a = 0;\nstd::mutex mtx;\nvoid func()\n{\n    for (int i = 0; i < 10000; ++i)\n    {\n        std::lock_guard<std::mutex> lg(mtx, std::adopt_lock);\n        mtx.lock();\n        a = a + 1;\n    }\n}\nint main()\n{\n    std::thread t1(func);\n    std::thread t2(func);\n\n    t1.join();\n    t2.join();\n\n    std::cout << a << std::endl;\n}// 20000\n```\n\n## `std::unique_lock`\n`std::unique_lock`æ˜¯`C++`æ ‡å‡†åº“ä¸­çš„ä¸€ç§äº’æ–¥é‡å°è£…ç±»ã€‚å¯ä»¥çœ‹ä½œ`std::lock_guard`çš„å¢å¼ºç‰ˆï¼Œå¯ä»¥å¯¹äº’æ–¥é‡è¿›è¡Œæ›´åŠ çµæ´»çš„ç®¡ç†ã€‚\n* å»¶è¿ŸåŠ è½½\n* æ¡ä»¶å˜é‡\n* è¶…æ—¶\n\n```cpp\n#include<iostream>\n#include<thread>\n#include<mutex>\nint a = 0;\nstd::mutex mtx;\nvoid func()\n{\n    for (int i = 0; i < 10000; ++i)\n    {\n        std::unique_lock<std::mutex> ul(mtx);\n        a = a + 1;\n    }\n}\nint main()\n{\n    std::thread t1(func);\n    std::thread t2(func);\n\n    t1.join();\n    t2.join();\n\n    std::cout << a << std::endl;\n}//20000\n```\n### å¸¸è§çš„æˆå‘˜å‡½æ•°\n* `lock()`ï¼šå°è¯•å¯¹äº’æ–¥é‡è¿›è¡ŒåŠ é”æ“ä½œï¼Œå¦‚æœå½“å‰äº’æ–¥é‡å·²ç»è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œåˆ™é˜»å¡ï¼Œç›´åˆ°æˆåŠŸåŠ é”ã€‚\n* `unlock()`ï¼šå¯¹äº’æ–¥é‡è§£é”ã€‚\n* `try_lock()`ï¼šå°è¯•å¯¹äº’æ–¥é‡è¿›è¡ŒåŠ é”æ“ä½œï¼Œå¦‚æœå½“å‰äº’æ–¥é‡å·²ç»è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œåˆ™å‡½æ•°**ç«‹å³**è¿”å›falseï¼Œå¦åˆ™è¿”å›trueã€‚\n* `try_lock_for(const std::chrono::duration<Rep, Period>&)`ï¼šå°è¯•å¯¹äº’æ–¥é‡è¿›è¡ŒåŠ é”æ“ä½œï¼Œå¦‚æœå½“å‰äº’æ–¥é‡å·²ç»è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œåˆ™é˜»å¡ï¼Œç›´åˆ°æˆåŠŸåŠ é”ï¼Œæˆ–è€…**è¶…è¿‡äº†æŸä¸€æ—¶é—´æ®µ**å°±è¿”å›ã€‚\n* `try_lock_until(const std::chrono::time_point<Clock, Duration>&)`ï¼šå’Œ`try_lock_for`çš„åŒºåˆ«åœ¨äºï¼Œ**è¶…è¿‡äº†è®¾å®šçš„æ—¶é—´ç‚¹**å°±è¿”å›ã€‚\n### å¦‚ä½•åšåˆ°å»¶è¿ŸåŠ é” - `defer_lock`\nå½“ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°ï¼š`defer_lock_t`è¿™ä¸ªå¸¸é‡æ—¶ï¼Œ`unique_lock`ä¸åŠ é”ï¼Œéœ€è¦æ‰‹åŠ¨åŠ é”ã€‚ä½†æ˜¯ææ„æ—¶`unique_lock`è¿˜æ˜¯ä¼šè‡ªåŠ¨è§£é”çš„ã€‚\n```cpp\n#include<iostream>\n#include<thread>\n#include<mutex>\nint a = 0;\nstd::mutex mtx;\nvoid func()\n{\n    for (int i = 0; i < 10000; ++i)\n    {\n        std::unique_lock<std::mutex> ul(mtx, std::defer_lock);\n        ul.lock();\n        a = a + 1;\n    }\n}\nint main()\n{\n    std::thread t1(func);\n    std::thread t2(func);\n\n    t1.join();\n    t2.join();\n\n    std::cout << a << std::endl;\n}//20000\n```\n`defer_lock`æ˜¯å»¶è¿ŸåŠ é”çš„å®ç°åŸºç¡€ã€‚\n### `std::timed_mutex`å’Œ`try_lock_for`æ­é…\n1. ç”±äºæ¶‰åŠåˆ°æ—¶é—´ï¼Œå¿…é¡»ä½¿ç”¨`std::timed_mutex`ã€‚\n2. å¦‚æœä¸ä¼ å…¥`std::std::defer_lock`ï¼Œç¨‹åºä¼šæŠ¥é”™ã€‚\n\n```cpp\n#include<iostream>\n#include<thread>\n#include<mutex>\nint a = 0;\nstd::timed_mutex t_mtx;\nvoid func()\n{\n    for (int i = 0; i < 10000; ++i)\n    {\n        std::unique_lock<std::timed_mutex> ul(t_mtx, std::defer_lock);\n        ul.try_lock_for(std::chrono::seconds(5));\n        a = a + 1;\n    }\n}\nint main()\n{\n    std::thread t1(func);\n    std::thread t2(func);\n\n    t1.join();\n    t2.join();\n\n    std::cout << a << std::endl;\n}// 20000\n```\n# `call_once`\nè§ã€Šè®¾è®¡æ¨¡å¼ã€‹ä¹‹ã€Šå•ä¾‹æ¨¡å¼ã€‹ç¯‡çš„ï¼šçº¿ç¨‹å®‰å…¨çš„æ‡’æ±‰å¼ - `call_once`ä¸€ç« èŠ‚ã€‚\n# ç”Ÿäº§è€…æ¶ˆè´¹è€…\n```cpp\n#include<iostream>\n#include<thread>\n#include<mutex>\n#include<condition_variable>\n#include<queue>\n\nstd::queue<int> g_queue;\nstd::condition_variable g_cv;\nusing namespace std::chrono_literals;\n\nvoid Producer()\n{\n    int i = 0;\n    while (1)\n    {\n\n        while (g_queue.size() < 10)\n        {\n            std::this_thread::sleep_for(3ms);\n            g_queue.push(i);\n            std::cout << \"push \" << i++ << std::endl;\n        }\n    }\n}\nvoid Consumer()\n{\n    while (1)\n    {\n        while (!g_queue.empty())\n        {\n            std::this_thread::sleep_for(100ms);\n            int value = g_queue.front();\n            g_queue.pop();\n            std::cout << \"pop \" << value << std::endl;\n        }\n        std::this_thread::sleep_for(100ms);\n    }\n}\nint main()\n{\n    std::thread t1(Producer);\n    std::thread t2(Consumer);\n    std::thread t3(Consumer);\n    std::thread t4(Consumer);\n    t1.join();\n    t2.join();\n    t3.join();\n    t4.join();\n}\n```\nè¾“å‡ºç»“æœ\n```bash\npush 0\npush 1\npush 2\npush 3\npush 4\npush 5\npush 6\npush 7\npush 8\npush 9\npop 0\npop 2\npop 0\npush 10\npush 11\npush 12\npop 3\npop 3\npop 5\npush 13\npush 14\npush 15\npop 6\npop 6\npop 8\npush 16\npush 17\npush 18\npop 9\npop 11pop 9\n...\n```\nå‡ºé”™ã€‚æ•°æ®ç«æ€ã€‚\n## ç”¨`unique_lock`é…åˆsleepè§£å†³\n```cpp\n#include<iostream>\n#include<thread>\n#include<mutex>\n#include<condition_variable>\n#include<queue>\n\nstd::queue<int> g_queue;\nstd::condition_variable g_cv;\nusing namespace std::chrono_literals;\nstd::mutex mtx;\nvoid Producer()\n{\n    int i = 0;\n    while (1)\n    {\n        std::unique_lock<std::mutex> ul(mtx);\n        while (g_queue.size() < 10)\n        {\n            std::this_thread::sleep_for(10ms);\n            g_queue.push(i);\n            std::cout << \"push \" << i++ << std::endl;\n        }\n    }\n}\nvoid Consumer()\n{\n    while (1)\n    {\n        std::unique_lock<std::mutex> ul(mtx);\n        while (!g_queue.empty())\n        {\n            std::this_thread::sleep_for(1ms);\n            int value = g_queue.front();\n            g_queue.pop();\n            std::cout << \"pop \" << value << std::endl;\n        }\n    }\n}\nint main()\n{\n    std::thread t1(Producer);\n    std::thread t2(Consumer);\n    std::thread t3(Consumer);\n    std::thread t4(Consumer);\n    t1.join();\n    t2.join();\n    t3.join();\n    t4.join();\n}\n```\nè¾“å‡ºç»“æœï¼Œæ­£ç¡®ã€‚\n```bash\npush 0\npush 1\npush 2\npush 3\npush 4\npush 5\npush 6\npush 7\npush 8\npush 9\npop 0\npop 1\npop 2\npop 3\npop 4\npop 5\npop 6\npop 7\npop 8\npop 9\n```\n## ç”¨`unique_lock`é…åˆcvè§£å†³\n```cpp\n#include<iostream>\n#include<thread>\n#include<mutex>\n#include<condition_variable>\n#include<queue>\n\nstd::queue<int> g_queue;\nstd::condition_variable g_cv;\nusing namespace std::chrono_literals;\nstd::mutex mtx;\nvoid Producer()\n{\n    for (int i = 0; i < 10; ++i)\n    {\n        std::unique_lock<std::mutex> lock(mtx);\n        g_queue.push(i);\n        std::cout << \"push \" << i << std::endl;\n        // é€šçŸ¥\n        g_cv.notify_all();\n    }\n}\nvoid Consumer()\n{\n    while (1)\n    {\n        std::unique_lock<std::mutex> ul(mtx);\n        while (g_queue.empty())\n        {\n            g_cv.wait(ul);\n        }\n        int value = g_queue.front();\n        g_queue.pop();\n        std::cout << \"pop \" << value << std::endl;\n    }\n}\nint main()\n{\n    std::thread t1(Producer);\n    std::thread t2(Consumer);\n    std::thread t3(Consumer);\n    std::thread t4(Consumer);\n    t1.join();\n    t2.join();\n    t3.join();\n    t4.join();\n}\n```\n\n```bash\npush 0\npop 0\npush 1\npop 1\npush 2\npop 2\npush 3\npop 3\npush 4\npop 4\npush 5\npop 5\npush 6\npop 6\npush 7\npush 8\npush 9\npop 7\npop 8\npop 9\n```\nå…¶ä¸­ï¼Œè¿˜å¯ä»¥ç”¨lambdaè¡¨è¾¾å¼æŒ‡ç¤ºwaitçš„è¡Œä¸ºã€‚ç­‰æ•ˆäºä¸Šé¢çš„ä»£ç ã€‚\n```cpp\nvoid Consumer()\n{\n    while (1)\n    {\n        std::unique_lock<std::mutex> ul(mtx);\n        g_cv.wait(ul, []() -> bool {return !g_queue.empty(); });\n        int value = g_queue.front();\n        g_queue.pop();\n        std::cout << \"pop \" << value << std::endl;\n    }\n}\n```\n# çº¿ç¨‹æ± \néœ€è¦çš„ç»„ä»¶ï¼š\n1. ä»»åŠ¡é˜Ÿåˆ—ï¼Œç”¨queueã€‚\n    1. é‡Œé¢è£…çš„æ˜¯`function`\n2. äº’æ–¥é‡ï¼Œmutex\n3. æ¡ä»¶å˜é‡ï¼Œcv\n4. çº¿ç¨‹æ•°ç»„ï¼Œvector\n    1. é‡Œé¢è£…çš„æ˜¯`thread`\n\n```cpp\n#include<iostream>\n#include<thread>\n#include<mutex>\n#include<condition_variable>\n#include<queue>\n#include<vector>\n#include<functional>\nclass ThreadPool\n{\npublic:\n    ThreadPool(int threadNum) : stop(false)\n    {\n        for (int i = 0; i < threadNum; ++i)\n        {\n            threads.emplace_back([this]() {\n                while (1)\n                {\n                    std::unique_lock<std::mutex> u_lock(mtx);\n                    condition.wait(u_lock, [this]() {\n                        return !tasks.empty() || stop;\n                        });\n                    if (stop && tasks.empty()) // å¦‚æœåªæ˜¯stopä½†ä»»åŠ¡é˜Ÿåˆ—ä¸ç©ºï¼Œåˆ™éœ€è¦ç›´åˆ°å–å®Œä»»åŠ¡æ‰èƒ½é€€å‡º\n                    {\n                        return; // é€€å‡ºæœ¬çº¿ç¨‹\n                    }\n                    std::function<void()> task(std::move(tasks.front()));\n                    tasks.pop();\n                    u_lock.unlock(); // ???\n                    task();  // æ‰§è¡Œä»»åŠ¡\n                }\n                });\n        }\n    }\n    ~ThreadPool()\n    {\n        {\n            std::unique_lock<std::mutex> u_lock(mtx);\n            stop = true;\n        }\n        condition.notify_all();  // ???\n        for (auto& t : threads)\n        {\n            t.join();  // ???\n        }\n    }\n    template<class F, class ... Args>\n    void enqueue(F&& f, Args&& ...args)\n    {\n        std::function<void()> task =\n            std::bind(std::forward<F>(f), std::forward<Args>(args)...); // ???\n        {\n            std::unique_lock<std::mutex> u_lock(mtx);\n            tasks.emplace(std::move(task)); // ??? // queue æ²¡æœ‰emplace_backæ–¹æ³•\n        }\n        condition.notify_one(); // ????\n    }\nprivate:\n    std::vector<std::thread> threads;\n    std::queue<std::function<void()>> tasks;\n    std::mutex mtx;\n    std::condition_variable condition;\n    bool stop;\n};\nint main()\n{\n    ThreadPool threadpool(4);\n    for (int i = 0; i < 20; ++i)\n    {\n        threadpool.enqueue([i]() {\n            std::cout << \"consuming task: \" << i << std::endl;\n            std::this_thread::sleep_for(std::chrono::milliseconds(100));\n            std::cout << \"task \" << i << \" done\" << std::endl;\n            });\n    }\n}\n```\nè¾“å‡ºç»“æœï¼š\n```\nconsuming task: consuming task: 1consuming task: 3\n\n0\nconsuming task: 2\ntask 1 donetask 2 done\ntask task 3 done\nconsuming task: 5\n0\nconsuming task: 4\n doneconsuming task: 6\n\nconsuming task: 7\ntask 5 donetask 7 done\n\ntask 4 done\ntask 6 done\nconsuming task: 8\nconsuming task: 11\nconsuming task: 9consuming task: 10\n\ntask 11task 9 done done\ntask 8 done\n\ntask 10 done\nconsuming task: 12consuming task: 14\n\nconsuming task: 15\nconsuming task: 13\ntask 13 donetask task task 15 done12 done14\n\n\n done\nconsuming task: 17consuming task: 16\n\nconsuming task: 19\nconsuming task: 18\ntask 16 donetask 18 done\ntask 19 done\n\ntask 17 done\n\n```\nå‡ ä¸ªç–‘ç‚¹ï¼š\n1. ææ„å‡½æ•°ä¸­ï¼Œåˆ‡æ¢çŠ¶æ€åˆ°stopåï¼Œä¸ºä»€ä¹ˆæ˜¯`notify_all`ï¼Œè€Œç”Ÿäº§è€…enqueueæ—¶ï¼Œä¸ºä»€ä¹ˆæ˜¯`notify_one`ï¼Ÿèƒ½ä¸èƒ½ä¹Ÿç”¨`notify_all`ï¼Ÿ\n2. åœ¨çº¿ç¨‹lambdaå‡½æ•°ä¸­ï¼Œ`task();`æ‰§è¡Œä»»åŠ¡å‰ï¼Œè¿›è¡Œ`u_lock.unlock()`è§£é”ï¼Œè€Œæ‰§è¡Œä»»åŠ¡åï¼Œ`u_lock`ï¼ˆ`unique_lock`ï¼‰ä¼šææ„ï¼Œä¼šå¯¼è‡´é‡å¤`unlock`ï¼Œæœ‰å½±å“å—ï¼Ÿ\n\nçŸ¥è¯†ç‚¹ï¼š\n1. functionalï¼Œå‡½æ•°å¯¹è±¡\n2. `emplace_back`\n3. lambda\n\nå…³é”®ç‚¹ï¼š\n1. çº¿ç¨‹æ± çŠ¶æ€åˆ‡æ¢ä¼šç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ï¼š\n    1. çº¿ç¨‹å‡½æ•°åœ¨waitè¢«å”¤é†’æ—¶è¦çœ‹stopæ¡ä»¶å†³å®šæ˜¯å¦é€€å‡º\n    2. ææ„å‡½æ•°ä¸­ï¼Œåˆ‡æ¢stopçŠ¶æ€ï¼Œä¸è¦å¿˜è®°ç»™stopåŠ é”ã€‚ä½¿ç”¨åˆ°äº†å±€éƒ¨ä½œç”¨åŸŸã€‚\n    3. åœ¨å–å‡ºtaskæ—¶ï¼Œç”¨moveï¼Œæ˜¯ä¸ºäº†é¿å…æ‹·è´å—ï¼Ÿ\n    4. ææ„å‡½æ•°ä¸­ï¼Œstopåï¼Œéœ€è¦æœ€åæ‰‹åŠ¨å”¤é†’ä¸€æ¬¡ï¼Œè®©çº¿ç¨‹æ± å¤„ç†æ®‹ç•™çš„ä»»åŠ¡\n2. å˜å‚æ¨¡æ¿ï¼Œç”Ÿäº§è€…æ”¾å…¥ä»»åŠ¡çš„enqueueå‡½æ•°ï¼Œä½¿ç”¨åˆ°äº†ï¼š\n        1. å¯å˜å‚æ¨¡æ¿\n        2. ä¸‡èƒ½å¼•ç”¨ï¼ˆè½¬å‘å¼•ç”¨ï¼‰\n        3. å¼•ç”¨æŠ˜å \n        4. bindå‡½æ•°ç»‘å®šå™¨\n        5. å¯å˜å‚å¡«å†™å®å‚çš„`<Args>(args)...`å†™æ³•å½¢å¼\n        6. `std::move`ï¼ˆå–å‡ºä»»åŠ¡ã€æ”¾å…¥ä»»åŠ¡æ—¶å‡ä½¿ç”¨ï¼‰\n        7. å±€éƒ¨ä½œç”¨åŸŸï¼ˆåœ¨unique_lockå¤–åŠ å¤§æ‹¬å·ï¼‰\n\n# future\nfutureè¿™ä¸ªä¸œè¥¿ï¼Œä¸»è¦ç”¨äºè¡¨ç¤ºå¼‚æ­¥æ“ä½œçš„ç»“æœã€‚\n## `std::async`\nç±»ä¼¼äº`std::thread`ï¼Œå¯ä»¥ç†è§£ä¸ºå¼‚æ­¥çš„çº¿ç¨‹ã€‚ç”¨äºå¼‚æ­¥æ‰§è¡Œä¸€ä¸ªå‡½æ•°ã€‚\nä½¿ç”¨å®ƒï¼Œå¯ä»¥é¿å…æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹å’Œç®¡ç†çº¿ç¨‹çš„éº»çƒ¦ã€‚\n```cpp\n#include<iostream>\n#include<future>\nint func()\n{\n    for (int i = 0; i < 1000; ++i)\n    {\n        ++i;\n    }\n    return i;\n}\nint main()\n{\n    // å­çº¿ç¨‹å¼‚æ­¥æ‰§è¡Œ\n    std::future<int> future_result = std::async(std::launch::async, func);\n    // ä¸»çº¿ç¨‹æ‰§è¡Œ\n    std::cout << func() << std::endl; \n    // ä¸»çº¿ç¨‹getç­‰å¾…ï¼Œç›´åˆ°è¿”å›ç»“æœã€‚\n    std::cout << future_result.get() << std::endl;\n}\n```\nç»“æœï¼š\n```\n1000\n1000\n```\n## `packaged_task`\næ˜¯ä¸€ä¸ªç±»æ¨¡æ¿ï¼Œç”¨äºå°†ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼ˆæ¯”å¦‚å‡½æ•°ã€å‡½æ•°å¯¹è±¡ã€lambdaè¡¨è¾¾å¼ï¼‰å°è£…ä¸ºä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œå¹¶ä¸”å¯ä»¥è¿”å›ä¸€ä¸ª`std::future`å¯¹è±¡ï¼Œå¯ä»¥ç”¨äºè¡¨ç¤ºå¼‚æ­¥æ“ä½œçš„ç»“æœã€‚\n\nå°è£…å¥½çš„è¿™ä¸ªpackaged_taskå¯ä»¥ä¾›å…¶ä»–çº¿ç¨‹ä½¿ç”¨ã€‚\n\nç›¸å½“äºï¼Œå¯ä»¥æš‚æ—¶ä¸ç”¨asyncå»æ‰§è¡Œå¼‚æ­¥æ“ä½œï¼Œè€Œæ˜¯å…ˆå°è£…èµ·æ¥ï¼Œä¾¿äºåœ¨æƒ³ç”¨çš„æ—¶å€™å¼€ç®±å³ç”¨ã€‚ï¼ˆä¸ªäººç†è§£ï¼‰\n```cpp\n#include<iostream>\n#include<future>\nint func()\n{\n    int i = 0;\n    for (; i < 1000; ++i)\n    {\n        ++i;\n    }\n    return i;\n}\nint main()\n{\n    std::packaged_task<int()> task(func);\n    auto future_task = task.get_future();\n    // å­çº¿ç¨‹æ‰§è¡Œä¸€étaskä¸­çš„func\n    std::thread t1(std::move(task)); // è®°å¾—moveï¼Œä¸ç„¶ç¼–è¯‘ä¸é€šè¿‡\n    // ä¸»çº¿ç¨‹æ‰§è¡Œä¸€éfunc\n    std::cout << func() << std::endl;\n\n    t1.join(); // æ—¢ç„¶ä¸‹é¢æœ‰äº†getç­‰å¾…ï¼Œè¿˜éœ€è¦å»joinå—ï¼Ÿ // éœ€è¦ï¼ä¸ç„¶ä¼šå´©æºƒ\n    // ç­‰å¾…taskæ‰§è¡Œå®Œæ¯•\n    std::cout << future_task.get() << std::endl;\n}\n```\nç»“æœ\n```\n1000\n1000\n```\n## promise\næ˜¯ä¸€ä¸ªç±»æ¨¡æ¿ï¼Œç”¨äºåœ¨å­çº¿ç¨‹ä¸­è®¾ç½®ä¸€ä¸ªå€¼ï¼Œå¹¶åœ¨ä¸»çº¿ç¨‹ä¸­è·å–è¿™ä¸ªå€¼ã€‚å€¼é€šè¿‡promiseå†…éƒ¨çš„futureè¯»å–ã€‚\n\né€šå¸¸äºfutureå’Œasyncä¸€èµ·ä½¿ç”¨ï¼Œç”¨äºå®ç°å¼‚æ­¥ç¼–ç¨‹ã€‚\n\n>åœ¨Açº¿ç¨‹æœ‰ä¸€ä¸ªå€¼ï¼ŒBçº¿ç¨‹æ€ä¹ˆè·å¾—å®ƒï¼Ÿ\n\nå‚æ•°ä¼ é€’ã€å…±äº«å˜é‡éƒ½å¯ä»¥ã€‚\npromiseæä¾›äº†æ–°æ–¹æ³•ã€‚\n```cpp\n#include<iostream>\n#include<future>\nvoid func(std::promise<int> &f)\n{\n    f.set_value(1000);\n    \n}\nint main()\n{\n    std::promise<int> f;\n    auto future_result = f.get_future();\n    std::thread t1(func, std::ref(f));   // åœ¨å­çº¿ç¨‹ä¸­è®¾ç½®å€¼\n\n    t1.join();\n    // åœ¨ä¸»çº¿ç¨‹ä¸­è·å¾—å€¼\n    std::cout << future_result.get() << std::endl;\n    return 0;\n}// 1000\n```\n# atomic - è½»é‡è§£å†³æ•°æ®ç«æ€\n`std::atomic`æ˜¯`C++11`æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªæ¨¡æ¿ç±»ï¼Œç”¨äºå®ç°å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„åŸå­æ“ä½œã€‚\nå®ƒæä¾›äº†ä¸€ç§çº¿ç¨‹å®‰å…¨çš„æ–¹å¼æ¥è®¿é—®å’Œä¿®æ”¹å…±äº«å˜é‡ï¼Œå¯ä»¥é¿å…å¤šçº¿ç¨‹ç¯å¢ƒä¸­çš„æ•°æ®ç«äº‰é—®é¢˜ã€‚\n`std::atomic`çš„ä½¿ç”¨æ–¹å¼ç±»ä¼¼äºæ™®é€šçš„å˜é‡ï¼Œä¸åŒä¹‹å¤„æ˜¯å®ƒçš„æ“ä½œæ˜¯åŸå­æ€§çš„ã€‚\nä»¥ä¸‹æ˜¯å¸¸ç”¨çš„`std::atomic`æ“ä½œï¼š\n* `load()`ï¼Œç›¸å½“äºè¯»å€¼ã€‚\n* `store(val)`ï¼Œç›¸å½“äºå†™å€¼ã€‚æ˜¯åŸå­æ€§çš„æ“ä½œã€‚\n* \n\næµ‹è¯•ç”¨mutexäº’æ–¥é‡ï¼Œå¼€5ä¸ªçº¿ç¨‹ï¼ŒåŠ åˆ°50000çš„æ—¶é—´ï¼š\n```cpp\n#include<iostream>\n#include<thread>\n#include<mutex>\nint a = 0;\nstd::mutex mtx;\nvoid func()\n{\n    for (int i = 0; i < 10000; ++i)\n    {\n        mtx.lock();\n        a += 1;\n        mtx.unlock();\n    }\n}\nint main()\n{\n    auto cur = std::chrono::duration_cast<std::chrono::microseconds>\n        (std::chrono::system_clock::now().time_since_epoch()).count();\n    std::thread t1(func);\n    std::thread t2(func);\n    std::thread t3(func);\n    std::thread t4(func);\n    std::thread t5(func);\n\n    t1.join();\n    t2.join();\n    t3.join();\n    t4.join();\n    t5.join();\n\n    std::cout << a << std::endl;\n    auto last = std::chrono::duration_cast<std::chrono::microseconds>\n        (std::chrono::system_clock::now().time_since_epoch()).count();\n    std::cout << last - cur << std::endl;\n\n}\n```\n8000åˆ°9000å¾®ç§’ã€‚\n\næµ‹è¯•intåŸå­å˜é‡ï¼Œå¼€5ä¸ªçº¿ç¨‹ï¼ŒåŠ åˆ°50000çš„æ—¶é—´ï¼š\n```cpp\n#include<iostream>\n#include<thread>\n#include<mutex>\nstd::atomic<int> a = 0;\nvoid func()\n{\n    for (int i = 0; i < 10000; ++i)\n    {\n        a += 1;\n    }\n}\nint main()\n{\n    auto cur = std::chrono::duration_cast<std::chrono::microseconds>\n        (std::chrono::system_clock::now().time_since_epoch()).count();\n    std::thread t1(func);\n    std::thread t2(func);\n    std::thread t3(func);\n    std::thread t4(func);\n    std::thread t5(func);\n\n    t1.join();\n    t2.join();\n    t3.join();\n    t4.join();\n    t5.join();\n\n    std::cout << a << std::endl;\n    auto last = std::chrono::duration_cast<std::chrono::microseconds>\n        (std::chrono::system_clock::now().time_since_epoch()).count();\n    std::cout << last - cur << std::endl;\n\n}\n```\n6000åˆ°7000å¾®ç§’ã€‚\næå‡äº†20%åˆ°30%ã€‚\n## çŸ¥è¯†ç‚¹\n1. `duration_cast<std::chrono::microseconds>`æ˜¯æŠŠ`std::chrono::system_clock::now().time_since_epoch()`è½¬æˆäº†è®¾å®šçš„æ—¶é—´æ ¼å¼ï¼Œæ­¤ä¾‹è½¬çš„æ˜¯å¾®ç§’ã€‚","categories":["æ“ä½œç³»ç»Ÿ","å¤šçº¿ç¨‹","Cpp","Modern"]},{"title":"èŒä¸šè§„åˆ’2025","url":"/è¯¾å ‚ç¬”è®°/èŒä¸šè§„åˆ’2025/","content":"# è¯­è¨€\n## C++\näº†è§£ä¸€äº›C++æ–°ç‰¹æ€§ï¼Œæ¯”å¦‚conceptã€Policyã€constexprï¼Œå¯¹æ‰¾é«˜è–ªå·¥ä½œæœ‰å¸®åŠ©å—ï¼Ÿjthreadã€ranged_forã€‚\nC++20çš„åç¨‹ã€‚\nC++26çš„åå°„ã€‚\næœ‰æ²¡æœ‰å¿…è¦èŠ±æ—¶é—´åœ¨æ–°æ ‡å‡†ä¸Šï¼Ÿ\n## Goï¼Ÿ\næœ‰å¿…è¦è½¬Goå—ï¼Ÿ\n## Javaï¼Ÿ\näº†è§£ä¸€äº›ï¼Œåç«¯æ˜¯ä¸æ˜¯æœ€å¥½ç”¨Javaåšï¼Ÿå²—ä½å¤šã€‚å‘å±•è·¯å¾„ã€‚\n\n## æ€»ç»“\n\n---\n# æ“ä½œç³»ç»Ÿ\n## Linux\nä¸»è¦å­¦çš„æ˜¯Linuxï¼Œgccã€CMakeã€‚\ngdbåªä¼šç®€å•çš„è°ƒè¯•ã€‚\n## Windows\nåªäº†è§£å¾ˆç®€å•çš„çª—å£å¼€å‘ï¼Œçœ‹æ‰‹å†Œã€‚\n## å¤šçº¿ç¨‹\næŒæ¡åˆ°ä»€ä¹ˆç¨‹åº¦ï¼Ÿ\nä¹‹å‰å­¦äº†ä¸å°‘ç›¸å…³çŸ¥è¯†ï¼Œä½†éƒ½å·®ä¸å¤šå¿˜è®°äº†ã€‚\nå¦‚æœè®©ç°åœºç¼–ã€è®¾è®¡å¤šçº¿ç¨‹ç¨‹åºï¼Œä¸ç†Ÿç»ƒã€‚\n## æ€»ç»“\n\n---\n\n# ç½‘ç»œ\nå‰æ®µæ—¶é—´åˆšå¤§æ¦‚å¤ä¹ äº†ä¸€ä¸‹4å±‚æ¨¡å‹ã€‚å’ŒTCPåè®®ã€‚\nHTTPäº†è§£åœ°ä¸å¤Ÿç»†è‡´ï¼Œæ²¡æœ‰æ·±å…¥å­¦ã€‚\n\n\n## æ€»ç»“\n\n---\n\n# æ•°æ®åº“\nå¤§å¤šæ•°éƒ½å¿˜è®°äº†ã€‚æŒæ¡å“ªäº›çŸ¥è¯†ï¼Ÿå¤šæ·±å…¥ï¼Ÿ","categories":["è¯¾å ‚ç¬”è®°"]},{"title":"01_ä¸ºä»€ä¹ˆè¦ç”¨RPCåˆ†å¸ƒå¼","url":"/RPC/01_ä¸ºä»€ä¹ˆè¦ç”¨RPCåˆ†å¸ƒå¼/","content":"# æé«˜ç¡¬ä»¶ä¸Šé™\nå—é™äºç¡¬ä»¶æ¡ä»¶ï¼ŒæœåŠ¡å™¨æ‰€èƒ½æ‰¿å—çš„ç”¨æˆ·çš„å¹¶å‘é‡ã€‚\n# è§£è€¦é¡¹ç›®æ¶æ„ï¼Œä¾¿äºç®¡ç†\nå¦‚æœæ•´ä¸ªé¡¹ç›®ä»£ç å…¨éƒ¨åœ¨ä¸€èµ·ï¼Œå‡è®¾åªä¿®æ”¹ä¸€ä¸ªå•å…ƒæ¨¡å—çš„å‡ è¡Œä»£ç ï¼Œåˆ™å¯èƒ½éœ€è¦æŠŠæ•´ä¸ªé¡¹ç›®é‡æ–°ç¼–è¯‘ã€éƒ¨ç½²ï¼Œè€—æ—¶å¤ªé•¿ã€‚\n# å„æ¨¡å—å¯¹ç¡¬ä»¶è¦æ±‚ä¸ä¸€æ ·\næœ‰äº›æ¨¡å—æ˜¯CPUå¯†é›†å‹ï¼Œæœ‰äº›æ¨¡å—æ˜¯I/Oå¯†é›†å‹ã€‚å„æ¨¡å—å¯¹ç¡¬ä»¶èµ„æºçš„éœ€æ±‚ä¸ä¸€æ ·ã€‚åˆ†æ¨¡å—ï¼Œåˆ†å¸ƒå¼ï¼Œå¯ä»¥å……åˆ†å‘æŒ¥æ¯ä¸ªæœåŠ¡å™¨ç¡¬ä»¶çš„ä¼˜åŠ¿ã€‚\nCPUå¯†é›†å‹ç”¨äºæ•°æ®å¤„ç†ã€è®¡ç®—ã€‚è¦æ±‚CPUæ€§èƒ½ã€‚\nI/Oå¯†é›†å‹ç”¨äºå¤„ç†è¯·æ±‚ã€è¿æ¥ã€‚è¦æ±‚ç½‘ç»œå¸¦å®½ã€‚\n# å•çº¯çš„é›†ç¾¤\n1. ä¼˜ç‚¹ï¼šé›†ç¾¤åªèƒ½è§£å†³æé«˜ç¡¬ä»¶çš„ä¸Šé™ã€‚\n2. ç¼ºç‚¹ï¼šå¦‚æœåªåšé›†ç¾¤ï¼Œä¸åšåˆ†å¸ƒå¼ï¼Œåœ¨åªä¿®æ”¹å‡ è¡Œä»£ç åæ¯ä¸ªæœåŠ¡å™¨éƒ½éœ€è¦é‡æ–°ç¼–è¯‘ã€éƒ¨ç½²å…¨éƒ¨ä»£ç ã€‚æ›´å¤´ç–¼äº†ã€‚\n3. ç¼ºç‚¹ï¼šä¸èƒ½ç²¾ç»†åœ°æ§åˆ¶ç¡¬ä»¶èµ„æºå’Œæ¨¡å—çš„é€‚é…ã€‚\n# å¯ä»¥åœ¨åˆ†å¸ƒå¼çš„åŸºç¡€ä¸Šé›†ç¾¤\næ ¹æ®èŠ‚ç‚¹å¯¹åº”çš„åŠŸèƒ½æ¨¡å—çš„å¹¶å‘è¦æ±‚ï¼Œå¯ä»¥é’ˆå¯¹æ€§åœ°å¯¹æŸä¸€æ¨¡å—è¿›è¡Œé›†ç¾¤éƒ¨ç½²ã€‚\n# åˆ†å¸ƒå¼è™½å¥½ï¼Œä½†è¦è§£å†³çš„é—®é¢˜\n## å¤§ç³»ç»Ÿçš„è½¯ä»¶æ¨¡å—æ€ä¹ˆåˆ’åˆ†\nå„æ¨¡å—å¯èƒ½ä¼šå®ç°å¤§é‡é‡å¤çš„ä»£ç \n## å„æ¨¡å—ä¹‹é—´æ€ä¹ˆè®¿é—®\nå„æ¨¡å—éƒ½è¿è¡Œåœ¨ä¸åŒçš„è¿›ç¨‹ä¸­ã€‚\nï¼ˆæ¯”å¦‚å¯ä»¥è¿è¡Œåœ¨dockerè™šæ‹ŸåŒ–ç¯å¢ƒä¸­ï¼Œå„ä¸ªæ¨¡å—å•ç‹¬è¿è¡Œåœ¨ä¸€ä¸ªç¯å¢ƒä¸­ï¼‰\næ¯”å¦‚ï¼Œç”¨æˆ·ç®¡ç†æ˜¯ä¸€ä¸ªå•ç‹¬çš„æ¨¡å—ï¼Œå’Œå¥½å‹ç®¡ç†æ¨¡å—è¿è¡Œåœ¨ä¸åŒçš„ç¯å¢ƒã€è¿›ç¨‹ã€‚\nç”¨æˆ·ç®¡ç†ï¼Œå¯èƒ½æŸä¸ªç”¨æˆ·éœ€è¦è°ƒç”¨user.GetUserFriendLists(userid)ã€‚\nè€Œè¿™ä¸ªæ¥å£/å‡½æ•°å¯èƒ½å¤„äºå¥½å‹ç®¡ç†æ¨¡å—ä¸­ã€‚\n```cpp\n// æœºå™¨1\nuser.GetUserFriendLists(userid);\n// æœºå™¨2\nlist<User> GetUserFriendLists(int userid);\n```\næœºå™¨1ä¸Šçš„æ¨¡å—æ€ä¹ˆè°ƒç”¨æœºå™¨2ä¸Šçš„æ¨¡å—çš„ä¸€ä¸ªä¸šåŠ¡æ–¹æ³•å‘¢ï¼Ÿï¼Ÿï¼Ÿ\næœºå™¨1ä¸Šçš„ä¸€ä¸ªæ¨¡å—è¿›ç¨‹1æ€ä¹ˆè°ƒç”¨æœºå™¨1ä¸Šçš„æ¨¡å—è¿›ç¨‹2é‡Œé¢çš„ä¸€ä¸ªä¸šåŠ¡æ–¹æ³•å‘¢ï¼Ÿï¼Ÿï¼Ÿ\n## è§£å†³æ–¹æ¡ˆ\nè§ã€ŠRPCé€šä¿¡åŸç†ã€‹ä¸€ç¯‡ã€‚","categories":["é¡¹ç›®","rpc"]},{"title":"SSHè¿æ¥","url":"/é¡¹ç›®/SSHè¿æ¥/","content":"æƒ³ç”¨windowsä¸»æœºsshè¿æ¥è™šæ‹Ÿæœºï¼Œè¿ä¸ä¸Šã€‚\n# ç¡®ä¿ SSH æœåŠ¡å·²å®‰è£…å¹¶è¿è¡Œ\nè™½ç„¶Ubuntuç³»ç»Ÿè‡ªå¸¦äº†sshï¼Œä½†æ˜¯è¿™æ˜¯å®¢æˆ·ç«¯çš„ï¼ŒæœåŠ¡ç«¯çš„openssh-serveræ²¡æœ‰å®‰è£…ã€‚\n```bash\n# æ£€æŸ¥æœåŠ¡çŠ¶æ€\nsudo systemctl status ssh    # Ubuntu/Debian\nsudo systemctl status sshd   # CentOS/RHEL\n\n# è‹¥æœªå®‰è£…\nsudo apt install openssh-server  # Ubuntu\nsudo yum install openssh-server  # CentOS\n\n# å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯\nsudo systemctl start ssh\nsudo systemctl enable ssh\n```\n## æ£€æŸ¥SSHç«¯å£ç›‘å¬\n```bash\nsudo netstat -tuln | grep :22\n```\n- æ­£å¸¸åº”æ˜¾ç¤ºï¼š`tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN`\n- è‹¥æœªç›‘å¬ï¼Œä¿®æ”¹é…ç½®ï¼š`sudo nano /etc/ssh/sshd_config`\n\nç¡®ä¿å­˜åœ¨ï¼š\n```bash\nPort 22\nListenAddress 0.0.0.0  # å…è®¸æ‰€æœ‰IPè¿æ¥\nPermitRootLogin yes    # ä¸´æ—¶å…è®¸rootç™»å½•ï¼ˆæµ‹è¯•åå»ºè®®å…³é—­ï¼‰\n```\n## é‡å¯SSHæœåŠ¡\n```bash\nsudo systemctl restart ssh\n```\n# VSCodeè¿œç¨‹è¿æ¥\nåœ¨Extensionsä¸­æœç´¢Remoteï¼Œå®‰è£…Remote Developmentã€‚\nä¹‹åå·¦è¾¹å°±ä¼šå¤šå‡ºä¸€ä¸ªé€‰é¡¹ï¼š\n![](../../images/SSHè¿æ¥/image-20250712225052906.png)\n\nç‚¹å‡»åï¼Œåœ¨è¾¹æ å³ä¸Šè§’é€‰æ‹©Remotesï¼ˆSSHï¼‰\n![](../../images/SSHè¿æ¥/image-20250712225121541.png)\n\nç„¶åç‚¹SSHæ å³è¾¹çš„é½¿è½®ã€‚\n![](../../images/SSHè¿æ¥/image-20250712225212657.png)\n\nä¸Šè¾¹æ å°±ä¼šå‡ºç°ï¼š\n![](../../images/SSHè¿æ¥/image-20250712225229502.png)\n\næˆ‘ä»¬é€‰æ‹©ç¬¬ä¸€ä¸ªï¼Œä¹Ÿæ˜¯Windowsä¸‹å½“å‰ç”¨æˆ·é»˜è®¤çš„sshé…ç½®æ–‡ä»¶å¤¹ã€‚\n![](../../images/SSHè¿æ¥/image-20250712225309404.png)\n\nåœ¨é‡Œé¢é…ç½®è¿œç¨‹ä¸»æœºçš„è¿æ¥ä¿¡æ¯\n![](../../images/SSHè¿æ¥/image-20250712225327413.png)\n\nHostæŒ‡ä¸»æœºåï¼ŒLinuxä¸­@åé¢çš„å°±æ˜¯ã€‚\n![](../../images/SSHè¿æ¥/image-20250712225420004.png)\nHostNameæŒ‡ipåœ°å€ã€‚Linuxä¸‹ifconfigå¯ä»¥æŸ¥çœ‹ã€‚\nUseræŒ‡@å‰é¢çš„ã€‚\n\nä¿å­˜æ–‡ä»¶ä¹‹åï¼Œå·¦è¾¹æ å°±ä¼šå‡ºç°ï¼š\n![](../../images/SSHè¿æ¥/image-20250712225556409.png)\n\n# SSHè¿œç¨‹è¿æ¥è™šæ‹Ÿæœº æ€ä¹ˆç”¨å…¬é’¥å…é™¤æ¯æ¬¡ç™»å½•è¾“å…¥å¯†ç çš„çƒ¦æ¼\n## ç”Ÿæˆå¯†é’¥å¯¹ï¼ˆä¸»æœºæ“ä½œï¼‰\n\næ‰“å¼€ç»ˆç«¯ï¼ˆWindows ä½¿ç”¨ PowerShell æˆ– CMDï¼›Mac/Linux ç”¨ç³»ç»Ÿç»ˆç«¯ï¼‰\nç”Ÿæˆå¯†é’¥ï¼š\n```sh\nssh-keygen -t ed25519 -C \"your_email@example.com\"  # æ¨è ed25519\n# æˆ–ä¼ ç»Ÿ RSAï¼šssh-keygen -t rsa -b 4096\n```\n\næŒ‰æç¤ºå®Œæˆï¼ˆé»˜è®¤ä¿å­˜ä½ç½®Â `~/.ssh/id_ed25519`ï¼‰\n\n## å¤åˆ¶å…¬é’¥åˆ°è™šæ‹Ÿæœº\næ–¹æ³•ä¸€ï¼šè‡ªåŠ¨å¤åˆ¶ï¼ˆæ¨èï¼‰ï¼ˆä¸»æœºæ“ä½œï¼‰\n\n```sh\nssh-copy-id -i ~/.ssh/id_ed25519.pub user@vm_ip\n# è¾“å…¥è™šæ‹Ÿæœºå¯†ç ä¸€æ¬¡\n```\n\næ–¹æ³•äºŒï¼šæ‰‹åŠ¨å¤åˆ¶\n\n```sh\ncat ~/.ssh/id_ed25519.pub # æŸ¥çœ‹ä¸»æœºä¸Šçš„å…¬é’¥å†…å®¹\nssh user@vm_ip            # ç™»å½•è™šæ‹Ÿæœº\n\nmkdir -p ~/.ssh\necho \"ç²˜è´´çš„å…¬é’¥å†…å®¹\" >> ~/.ssh/authorized_keys\nchmod 700 ~/.ssh\nchmod 600 ~/.ssh/authorized_keys\n```\n\n## é…ç½®ä¸»æœºçš„VSCode\næŒ‰ `F1` > é€‰æ‹© â€‹â€‹`Remote-SSH: Connect to Host...â€‹â€‹`\né€‰æ‹© â€‹â€‹`Configure SSH Hosts...`â€‹â€‹ > æ·»åŠ é…ç½®ï¼šï¼ˆå…¶å®æ˜¯å¸®ä½ æ‰“å¼€`~/.ssh/config`ï¼‰\n\n```\nHost MyVM   # è‡ªå®šä¹‰åˆ«å\n  HostName 192.168.1.100          # è™šæ‹ŸæœºIP\n  User your_username\n  IdentityFile ~/.ssh/id_ed25519  # ç§é’¥è·¯å¾„\n```\n\nä¿å­˜é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯Â `~/.ssh/config`ï¼‰\n## å¸¸è§é—®é¢˜è§£å†³\n1. â€‹**â€‹æƒé™é”™è¯¯â€‹**â€‹ï¼š\n    `chmod 600 ~/.ssh/config   # ç¡®ä¿æœ¬åœ° config æ–‡ä»¶æƒé™æ­£ç¡®`\n2. â€‹**â€‹æœåŠ¡ç«¯é…ç½®æ£€æŸ¥â€‹**â€‹ï¼š\n    - ç¡®è®¤è™šæ‹ŸæœºÂ `/etc/ssh/sshd_config`Â åŒ…å«ï¼š\n        `PubkeyAuthentication yes AuthorizedKeysFile .ssh/authorized_keys`\n    - é‡å¯ SSH æœåŠ¡ï¼š\n        `sudo systemctl restart sshd`\n3. â€‹**â€‹è°ƒè¯•è¿æ¥â€‹**â€‹ï¼š\n    `ssh -Tv user@vm_ip   # -v æŸ¥çœ‹è¯¦ç»†æ—¥å¿—`\n\n\n> âœ… æˆåŠŸæ ‡å¿—ï¼šä½¿ç”¨Â `ssh user@vm_ip`Â æˆ– VSCode è¿æ¥æ—¶æ— éœ€è¾“å…¥å¯†ç å³å¯ç™»å½•ã€‚\n> é‡åˆ°é—®é¢˜å»ºè®®æ£€æŸ¥ä¸¤è¾¹æ—¥å¿—ï¼ˆæœ¬åœ°ç»ˆç«¯ debug ä¿¡æ¯æˆ–è™šæ‹ŸæœºÂ `/var/log/auth.log`ï¼‰","categories":["é¡¹ç›®"]},{"title":"å­¦ä¹ é¡¹ç›®ä¸­è¸©çš„å‘å’Œæ³¨æ„ç‚¹","url":"/é¡¹ç›®/å­¦ä¹ é¡¹ç›®ä¸­è¸©çš„å‘å’Œæ³¨æ„ç‚¹/","content":"æœ‰çš„é¡¹ç›®è¯¾ç¨‹æ˜¯2020å¹´å·¦å³çš„ï¼Œå½“æ—¶ä½¿ç”¨çš„boost 1.69å’Œgcc 4.6ç‰ˆæœ¬ï¼Œæ”¾åˆ°ç°åœ¨ï¼ˆ2025å¹´ï¼‰çš„Ubuntu 24ç‰ˆæœ¬ä¸‹ï¼Œä¸èƒ½å¾ˆå¥½åœ°å…¼å®¹ã€‚\næ­¤æ—¶ä¸ºäº†å°½å¿«é¡ºåˆ©è¿›å…¥åˆ°è¯¾ç¨‹å­¦ä¹ çš„è½¨é“ä¸Šï¼Œè€Œä¸æ˜¯ä¸ºäº†æƒ³åŠæ³•å»å…¼å®¹æ–°Ubuntuï¼Œå¦¥åçš„åšæ³•æ˜¯å®‰è£…ä¸€ä¸ªé™çº§çš„Ubuntu 20ç‰ˆæœ¬ã€‚\n# è®°å½•å®‰è£…muduoè¿‡ç¨‹çš„é…å¥—å·¥å…·çš„ç‰ˆæœ¬\nä»¥ä¸‹ç¯å¢ƒèƒ½æˆåŠŸå®‰è£…muduoè€ç‰ˆæœ¬\n1. Ubuntu 20.04.6\n2. gcc (Ubuntu 9.4.0-1ubuntu1~20.04.2) 9.4.0\n3. g++ (Ubuntu 9.4.0-1ubuntu1~20.04.2) 9.4.0\n4. cmake version 3.16.3\n5. make: GNU Make 4.2.1 Built for x86_64-pc-linux-gnu\n\nä»¥ä¸Šï¼Œéƒ½æ˜¯Ubuntuæ­¤ç‰ˆæœ¬aptå®‰è£…çš„é»˜è®¤çš„ç‰ˆæœ¬ã€‚\n# Ubuntuçš„è·¨è™šæ‹Ÿæœºå¤åˆ¶ç²˜è´´é—®é¢˜\nVMwareè™šæ‹ŸæœºLinuxä¸ä¸»æœºWindowsä¹‹é—´ä¸èƒ½æ‹–æ‹½ã€è·¨ç«¯å¤åˆ¶ç²˜è´´\n## éªŒè¯VMware Toolså®‰è£…çŠ¶æ€\n```bash\n# æ£€æŸ¥VMwareæœåŠ¡çŠ¶æ€\nsudo systemctl status vmware-tools\n\n# ç¡®è®¤open-vm-toolså·²å®‰è£…\nsudo apt list --installed | grep open-vm-tools  # Debian/Ubuntu\nrpm -qa | grep open-vm-tools                  # CentOS/RHEL\n```\n## é‡å¯å…³é”®æœåŠ¡\n```bash\nsudo systemctl restart vmware-tools\nsudo systemctl restart vmtoolsd\n```\n## å¦‚æœvmware-tools.service could not be found\nå®‰è£…/é‡è£… open-vm-tools\n```bash\n# Ubuntu/Debian\nsudo apt update\nsudo apt install --reinstall open-vm-tools open-vm-tools-desktop\n\n# CentOS/RHEL\nsudo yum reinstall open-vm-tools open-vm-tools-desktop\n\n# å¯ç”¨æœåŠ¡ï¼ˆæœåŠ¡åæ˜¯ vmtoolsdï¼‰\nsudo systemctl enable --now vmtoolsd\n```\n## æ£€æŸ¥é©±åŠ¨åŠ è½½çŠ¶æ€\n```bash\nlsmod | grep -E 'vmw_vmci|vmw_vsock_vmci_transport'\n# åº”æœ‰ç±»ä¼¼è¾“å‡ºï¼š\n# vmw_vmci               98304  1\n# vmw_vsock_vmci_transport    45056  0\n```\n## å¼ºåˆ¶é‡è£…å·¥å…·\n```bash\nsudo apt purge open-vm-tools && sudo apt autoremove\nsudo apt install open-vm-tools open-vm-tools-desktop\n```\n## å¦‚æœä¸ç¨³å®šï¼Œå»ºè®®ä½¿ç”¨æŒ‚è½½ç‚¹å…±äº«æ–‡ä»¶\nç›®å‰ç¡®å®å¯ä»¥å¤åˆ¶ç²˜è´´æ–‡æœ¬ã€å°æ–‡ä»¶äº†ï¼Œä½†æ˜¯å¤§æ–‡ä»¶ä¸è¡Œï¼Œå¾ˆä¸ç¨³å®šã€‚\n\nè™šæ‹Ÿæœºè®¾ç½® â†’ é€‰é¡¹ â†’ å…±äº«æ–‡ä»¶å¤¹ â†’ æ·»åŠ ä¸»æœºç›®å½•\n\nä¼šæŒ‚è½½åˆ°Linuxçš„`/mnt/hgfs`ä¸‹ã€‚","categories":["é¡¹ç›®"]},{"title":"01_æ•°ç»„_01_äºŒåˆ†æŸ¥æ‰¾","url":"/ç®—æ³•/01_æ•°ç»„_01_äºŒåˆ†æŸ¥æ‰¾/","content":"https://leetcode.cn/problems/binary-search/\n# å†…å®¹\n\nç»™å®šä¸€ä¸ªÂ `n`Â ä¸ªå…ƒç´ æœ‰åºçš„ï¼ˆå‡åºï¼‰æ•´å‹æ•°ç»„Â `nums`Â å’Œä¸€ä¸ªç›®æ ‡å€¼Â `target`Â Â ï¼Œå†™ä¸€ä¸ªå‡½æ•°æœç´¢Â `nums`Â ä¸­çš„Â `target`ï¼Œå¦‚æœç›®æ ‡å€¼å­˜åœ¨è¿”å›ä¸‹æ ‡ï¼Œå¦åˆ™è¿”å›Â `-1`ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n**è¾“å…¥:** `nums` = `[-1,0,3,5,9,12]`, `target` = 9\n**è¾“å‡º:** 4\n**è§£é‡Š:** 9 å‡ºç°åœ¨ `nums` ä¸­å¹¶ä¸”ä¸‹æ ‡ä¸º 4\n\n**ç¤ºä¾‹Â 2:**\n\n**è¾“å…¥:** `nums` = `[-1,0,3,5,9,12]`, `target` = 2\n**è¾“å‡º:** -1\n**è§£é‡Š:** 2 ä¸å­˜åœ¨ `nums` ä¸­å› æ­¤è¿”å› -1\n\n**æç¤ºï¼š**\n\n1. ä½ å¯ä»¥å‡è®¾Â `nums`Â ä¸­çš„æ‰€æœ‰å…ƒç´ æ˜¯ä¸é‡å¤çš„ã€‚\n2. `n`Â å°†åœ¨Â `[1, 10000]`ä¹‹é—´ã€‚\n3. `nums`Â çš„æ¯ä¸ªå…ƒç´ éƒ½å°†åœ¨Â `[-9999, 9999]`ä¹‹é—´ã€‚\n# ä»£ç ï¼ˆçº¿æ€§æ¢æµ‹é‡å¤å€¼ï¼‰\n```cpp\nclass Solution {\npublic:\n    int search(vector<int>& nums, int target) {\n        int pos = -1;\n        int left = 0;\n        int right = nums.size() - 1;\n        while (left <= right)\n        {\n            int mid = ((right - left) >> 1) + left;\n            if (target < nums[mid])\n            {\n                right = mid - 1;\n            }\n            else if (target > nums[mid])\n            {\n                left = mid + 1;\n            }\n            else // ==\n            {\n                pos = mid;\n                while (pos > left && nums[pos - 1] == target)\n                {\n                    --pos;\n                }\n                break;\n            }\n        }\n        return pos;\n    }\n};\n```\n## å‘1\næˆ‘ç¬¬ä¸€æ¬¡åœ¨çº¿æ€§å‘å‰æ¢æµ‹é‡å¤å€¼çš„æ—¶å€™å†™é”™äº† while çš„åˆ¤æ–­æ¡ä»¶ï¼Œä¸åº”è¯¥æ˜¯`pos > 0`ï¼Œè€Œæ˜¯`pos > left`\n## å‘2\nç¬¬ä¸€æ¬¡å†™çš„æ—¶å€™ï¼ŒæŠŠ`>> 2`å³ç§»è¿ç®—ç¬¦å†™æˆäº†å¤§äºå·`> 2`ï¼Œè€Œä¸”ï¼Œä¸åº”è¯¥æ˜¯`>> 2`ï¼Œåº”è¯¥æ˜¯`>> 1`å³ç§»1ä½ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”ç€é™¤ä»¥2ã€‚è¿™æ˜¯è‡´å‘½çš„é”™è¯¯ã€‚\n![](../../images/åˆ·é¢˜_äºŒåˆ†æŸ¥æ‰¾/image-20250326101058377.png)\nä½†æ˜¯æµ‹è¯•ç”¨ä¾‹å±…ç„¶å…¨éƒ½é€šè¿‡äº†ï¼è¿™å¯èƒ½æ˜¯å› ä¸ºæˆ‘ç”¨åˆ°äº†çº¿æ€§æ¢æµ‹ï¼Œè®©ç®—æ³•å®é™…ä»¥éå†çš„å½¢å¼æ‰¾åˆ°äº†æ­£ç¡®ç­”æ¡ˆ......\n# å¿ƒå¾—\nåœ¨åšäºŒåˆ†æŸ¥æ‰¾æˆ–è€…åˆ†æ²»æ€æƒ³ç±»çš„é¢˜ç›®ï¼Œæœ€éš¾ã€æœ€é‡è¦çš„æŠŠæ¡ç‚¹æ˜¯ç‰©ç†ä¸‹æ ‡å’Œé€»è¾‘ä¸‹æ ‡çš„å…³ç³»ã€‚\nåƒè¿™ä¸ªé¢˜ç›®ä¸­ï¼Œ`left`ã€`right`ã€`mid`éƒ½æ˜¯ç‰©ç†ä¸‹æ ‡ã€‚\nç‰©ç†ä¸‹æ ‡åº”è¯¥å®æ—¶æ›´æ–°ã€‚\nä¸åº”è¯¥åªå‡ºç°é€»è¾‘ä¸‹æ ‡ã€‚\nå°±åƒçº¿æ€§æ¢æµ‹æ—¶çš„ while æ¡ä»¶ä¸­åˆ¤æ–­`pos > 0`å°±æ˜¯é”™è¯¯ä½¿ç”¨äº†é€»è¾‘ä¸‹æ ‡å»å……å½“æ¡ä»¶ã€‚åº”å½“æ˜¯`pos > left + 0`ï¼Œçœç•¥`+ 0`å³ä¸º`pos > left`ã€‚\n# ä¼˜åŒ–ä»£ç ï¼ˆç»§ç»­äºŒåˆ†æ¢æµ‹ï¼‰\n```cpp\nclass Solution {\npublic:\n    int search(vector<int>& nums, int target) {\n        int pos = -1;\n        int left = 0;\n        int right = nums.size() - 1;\n        while (left <= right)\n        {\n            int mid = ((right - left) >> 1) + left;\n            if (target < nums[mid])\n            {\n                right = mid - 1;\n            }\n            else if (target > nums[mid])\n            {\n                left = mid + 1;\n            }\n            else // ==\n            {\n                pos = mid;\n                right = mid - 1;\n            }\n        }\n        return pos;\n    }\n};\n```\nè¿™èƒ½è®©æ¢æµ‹è¡Œä¸ºç»§ç»­ä¿æŒäºŒåˆ†çš„$O(\\log {n})$çš„å¤æ‚åº¦è¿›è¡Œã€‚\nä» $O(\\log {n} + k)$ï¼ˆkä¸ºé‡å¤æ¬¡æ•°ï¼‰ä¼˜åŒ–è‡³ $O(\\log {n})$ï¼Œå®Œå…¨æ¶ˆé™¤äº†çº¿æ€§æ¢æµ‹çš„å¼€é”€ã€‚\n# æ€»ç»“\n","categories":["ç®—æ³•","äºŒåˆ†æŸ¥æ‰¾"]},{"title":"01_æ•°ç»„_02_ç§»é™¤é‡å¤å…ƒç´ ","url":"/ç®—æ³•/01_æ•°ç»„_02_ç§»é™¤é‡å¤å…ƒç´ /","content":"https://leetcode.cn/problems/remove-element/\n# å†…å®¹\n\nç»™ä½ ä¸€ä¸ªæ•°ç»„Â `nums`Â å’Œä¸€ä¸ªå€¼Â `val`ï¼Œä½ éœ€è¦Â **[åŸåœ°](https://baike.baidu.com/item/%E5%8E%9F%E5%9C%B0%E7%AE%97%E6%B3%95)**Â ç§»é™¤æ‰€æœ‰æ•°å€¼ç­‰äºÂ `val`Â çš„å…ƒç´ ã€‚å…ƒç´ çš„é¡ºåºå¯èƒ½å‘ç”Ÿæ”¹å˜ã€‚ç„¶åè¿”å›Â `nums`Â ä¸­ä¸Â `val`Â ä¸åŒçš„å…ƒç´ çš„æ•°é‡ã€‚\n\nå‡è®¾Â `nums`Â ä¸­ä¸ç­‰äºÂ `val`Â çš„å…ƒç´ æ•°é‡ä¸ºÂ `k`ï¼Œè¦é€šè¿‡æ­¤é¢˜ï¼Œæ‚¨éœ€è¦æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š\n\n- æ›´æ”¹Â `nums`Â æ•°ç»„ï¼Œä½¿Â `nums`Â çš„å‰Â `k`Â ä¸ªå…ƒç´ åŒ…å«ä¸ç­‰äºÂ `val`Â çš„å…ƒç´ ã€‚`nums`Â çš„å…¶ä½™å…ƒç´ å’ŒÂ `nums`Â çš„å¤§å°å¹¶ä¸é‡è¦ã€‚\n- è¿”å›Â `k`ã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n**è¾“å…¥ï¼š** nums = `[3,2,2,3]`, val = 3\n**è¾“å‡ºï¼š** 2, nums = `[2,2,_,_]`\n**è§£é‡Šï¼š** ä½ çš„å‡½æ•°å‡½æ•°åº”è¯¥è¿”å› k = 2, å¹¶ä¸” nums ä¸­çš„å‰ä¸¤ä¸ªå…ƒç´ å‡ä¸º 2ã€‚\nä½ åœ¨è¿”å›çš„ k ä¸ªå…ƒç´ ä¹‹å¤–ç•™ä¸‹äº†ä»€ä¹ˆå¹¶ä¸é‡è¦ï¼ˆå› æ­¤å®ƒä»¬å¹¶ä¸è®¡å…¥è¯„æµ‹ï¼‰ã€‚\n\n**ç¤ºä¾‹ 2ï¼š**\n\n**è¾“å…¥ï¼š** nums = `[0,1,2,2,3,0,4,2]`, val = 2\n**è¾“å‡ºï¼š** 5, nums = `[0,1,4,0,3,_,_,_]`\n**è§£é‡Šï¼š** ä½ çš„å‡½æ•°åº”è¯¥è¿”å› k = 5ï¼Œå¹¶ä¸” nums ä¸­çš„å‰äº”ä¸ªå…ƒç´ ä¸º 0,0,1,3,4ã€‚\næ³¨æ„è¿™äº”ä¸ªå…ƒç´ å¯ä»¥ä»»æ„é¡ºåºè¿”å›ã€‚\nä½ åœ¨è¿”å›çš„ k ä¸ªå…ƒç´ ä¹‹å¤–ç•™ä¸‹äº†ä»€ä¹ˆå¹¶ä¸é‡è¦ï¼ˆå› æ­¤å®ƒä»¬å¹¶ä¸è®¡å…¥è¯„æµ‹ï¼‰ã€‚\n\n**æç¤ºï¼š**\n- `0 <= nums.length <= 100`\n- `0 <= nums[i] <= 50`\n- `0 <= val <= 100`\n# ä»£ç ï¼ˆåè¾¹ç•Œèµ·éå†ï¼‰\n```cpp\nclass Solution {\npublic:\n    int removeElement(vector<int>& nums, int val) {\n        int r = nums.size(); // removed flag\n        int t = r - 1;       // travel flag\n        while (t >= 0)\n        {\n            if (val == nums[t])\n            {\n                --r;\n                std::swap(nums[t], nums[r]);\n            }\n            --t;\n        }\n        return r;\n    }\n};\n```\n## æ€æƒ³\nè¿™æ˜¯å¿«æ…¢æŒ‡é’ˆçš„ä¸€ä¸ªè§£æ³•ã€‚æµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡ã€‚\nä½†æ˜¯ï¼Œå¯¹äº`[0,1,2,2,3,0,4,2]`ï¼Œç»“æœæ˜¯`[0,1,0,4,3]`ã€‚\nè™½ç„¶ç¬¦åˆäº†é¢˜ç›®ä¸­çš„â€è¿™äº”ä¸ªå…ƒç´ å¯ä»¥ä»»æ„é¡ºåºè¿”å›â€œã€‚\nä½†æ˜¯æœ€å¥½è¿˜æ˜¯ä¸è¦æ”¹å˜å…ƒç´ åŸå…ˆåœ¨æ•°ç»„ä¸­çš„é¡ºåºã€‚\n## å¯ä»¥æ”¹è¿›çš„ç‚¹\nå®é™…ä¸Šä¸éœ€è¦swapå‡½æ•°ï¼Œè€Œæ˜¯ç›´æ¥`nums[t] = nums[r]`å³å¯ï¼Œå› ä¸ºåˆ é™¤ä¹‹åï¼Œåˆ é™¤åŒºçš„å…ƒç´ æ˜¯ä»€ä¹ˆä¸é‡è¦äº†ï¼Œä¸éœ€è¦ä¿ç•™åŸå…ˆçš„åˆ é™¤çš„æ•°æ®ã€‚\n# ä»£ç ï¼ˆå·¦è¾¹ç•Œèµ·éå†ï¼‰\n```cpp\nclass Solution {\npublic:\n    int removeElement(vector<int>& nums, int val) {\n        int processed = -1;      // processed flag\n        int travel = 0;       // travel flag\n        while (travel < nums.size())\n        {\n            if (val != nums[travel])\n            {\n                ++processed;\n                nums[processed] = nums[travel];\n            }\n            ++travel;\n        }\n        return processed + 1;\n    }\n};\n```\n# å¤æ‚åº¦åˆ†æ\nç›¸æ¯”äºåŒå±‚forå¾ªç¯çš„æš´åŠ›è§£æ³•ï¼Œå¿«æ…¢æŒ‡é’ˆçš„æ–¹æ³•å¯ä»¥è®©æ—¶é—´å¤æ‚åº¦é™ä¸º$O(n)$ï¼Œè¿™ä¹Ÿæ˜¯STLä¸­vectorä¸­eraseçš„æ—¶é—´å¤æ‚åº¦ã€‚\nç©ºé—´å¤æ‚åº¦$O(1)$ã€‚","categories":["ç®—æ³•","åŒæŒ‡é’ˆ"]},{"title":"01_æ•°ç»„_03_éé€’å‡æ•°ç»„çš„å¹³æ–¹","url":"/ç®—æ³•/01_æ•°ç»„_03_éé€’å‡æ•°ç»„çš„å¹³æ–¹/","content":"https://leetcode.cn/problems/squares-of-a-sorted-array/description/\n# å†…å®¹\n\nç»™ä½ ä¸€ä¸ªæŒ‰Â **éé€’å‡é¡ºåº**Â æ’åºçš„æ•´æ•°æ•°ç»„Â `nums`ï¼Œè¿”å›Â **æ¯ä¸ªæ•°å­—çš„å¹³æ–¹**Â ç»„æˆçš„æ–°æ•°ç»„ï¼Œè¦æ±‚ä¹ŸæŒ‰Â **éé€’å‡é¡ºåº**Â æ’åºã€‚\n\n**ç¤ºä¾‹ 1ï¼š**\n\n**è¾“å…¥ï¼š** nums = `[-4,-1,0,3,10]`\n**è¾“å‡ºï¼š** `[0,1,9,16,100]`\n**è§£é‡Šï¼š** å¹³æ–¹åï¼Œæ•°ç»„å˜ä¸º `[16,1,0,9,100]`\næ’åºåï¼Œæ•°ç»„å˜ä¸º `[0,1,9,16,100]`\n\n**ç¤ºä¾‹ 2ï¼š**\n\n**è¾“å…¥ï¼š** nums = `[-7,-3,2,3,11]`\n**è¾“å‡ºï¼š** `[4,9,9,49,121]`\n\n**æç¤ºï¼š**\n\n- `1 <= nums.length <= 104`\n- `-104 <= nums[i] <= 104`\n- `nums`Â å·²æŒ‰Â **éé€’å‡é¡ºåº**Â æ’åº\n\n**è¿›é˜¶ï¼š**\n\n- è¯·ä½ è®¾è®¡æ—¶é—´å¤æ‚åº¦ä¸ºÂ `O(n)`Â çš„ç®—æ³•è§£å†³æœ¬é—®é¢˜\n# ä»£ç ï¼ˆåè¾¹ç•Œèµ·éå†ï¼‰\n```cpp\nclass Solution {\npublic:\n    vector<int> sortedSquares(vector<int>& nums) {\n        int left = 0;\n        int right = nums.size() - 1;\n        vector<int> newnums(nums.size());\n        for (int i = newnums.size() - 1; i >= 0; --i)\n        {\n            int a = nums[left]  > 0 ? nums[left]  : -nums[left];\n            int b = nums[right] > 0 ? nums[right] : -nums[right];\n            if (a >= b)\n            {\n                newnums[i] = a * a;\n                ++left;\n            }\n            else\n            {\n                newnums[i] = b * b;\n                --right;\n            }\n        }\n        return newnums;\n    }\n};\n```\n## æ€æƒ³\næ•°ç»„å…¶å®æ˜¯æœ‰åºçš„ï¼Œ åªä¸è¿‡è´Ÿæ•°å¹³æ–¹ä¹‹åå¯èƒ½æˆä¸ºæœ€å¤§æ•°äº†ã€‚\n\né‚£ä¹ˆ**æ•°ç»„å¹³æ–¹çš„æœ€å¤§å€¼å°±åœ¨æ•°ç»„çš„ä¸¤ç«¯**ï¼Œä¸æ˜¯æœ€å·¦è¾¹å°±æ˜¯æœ€å³è¾¹ï¼Œä¸å¯èƒ½æ˜¯ä¸­é—´ã€‚\n\næ­¤æ—¶å¯ä»¥è€ƒè™‘åŒæŒ‡é’ˆæ³•äº†ï¼Œleft æŒ‡å‘èµ·å§‹ä½ç½®ï¼Œright æŒ‡å‘ç»ˆæ­¢ä½ç½®ã€‚\n\nå®šä¹‰ä¸€ä¸ªæ–°æ•°ç»„newnumsï¼Œå’ŒåŸæ•°ç»„ä¸€æ ·çš„å¤§å°ï¼Œè®© i æŒ‡å‘æ–°æ•°ç»„ç»ˆæ­¢ä½ç½®ã€‚\n\nå¦‚æœ`A[left] * A[left] < A[right] * A[right]`Â é‚£ä¹ˆ`newnums[i] = A[left] * A[left];`Â ã€‚åä¹‹`= A[right] * A[right]`\n# å¤æ‚åº¦åˆ†æ\nç›¸æ¯”äºåŒå±‚forå¾ªç¯çš„æš´åŠ›è§£æ³•ï¼Œå¿«æ…¢æŒ‡é’ˆçš„æ–¹æ³•å¯ä»¥è®©æ—¶é—´å¤æ‚åº¦é™ä¸º$O(n)$ã€‚\nç©ºé—´å¤æ‚åº¦$O(n)$ã€‚\n![](../../images/01_æ•°ç»„_03_éé€’å‡æ•°ç»„çš„å¹³æ–¹/image-20250326232703496.png)\n\n","categories":["ç®—æ³•","åŒæŒ‡é’ˆ"]},{"title":"å¹¶æŸ¥é›†","url":"/é«˜çº§æ•°æ®ç»“æ„/å¹¶æŸ¥é›†/","content":"# å¹¶æŸ¥é›†\nä¸»è¦ç”¨äºè§£å†³**å…ƒç´ åˆ†ç»„**çš„é—®é¢˜ã€‚ä¸»è¦æ“ä½œæœ‰**é›†åˆï¼ˆæˆ–å•ä¸ªå…ƒç´ ï¼‰çš„åˆå¹¶**å’Œ**æŸ¥è¯¢å…ƒç´ æ‰€åœ¨çš„é›†åˆ**ã€‚\nå…ƒç´ ä»¥åœ¨åŒä¸€æ£µæ ‘ä¸‹ä¸ºæ ‡å¿—ï¼Œè®¤ä¸ºåœ¨åŒä¸€é›†åˆä¸­ã€‚å¤šä¸ªé›†åˆå¯¹åº”ç€å¤šæ£µä¸åŒçš„æ ‘ï¼Œç»„æˆäº†æ£®æ—ã€‚\né€»è¾‘ä¸Šæ˜¯æ ‘å½¢ç»“æ„ï¼Œå®é™…ä¸Šç”¨æ•°ç»„å­˜å‚¨å…ƒç´ æ‰€åœ¨é›†åˆçš„æ ¹èŠ‚ç‚¹ã€‚\n# åˆå¹¶\nåˆå¹¶ x å’Œ y ä¸¤ä¸ªå…ƒç´ æ—¶ï¼Œä¸èƒ½ç›´æ¥åˆå¹¶ä¸¤ä¸ªå…ƒç´ ï¼Œè€Œæ˜¯è¦åˆå¹¶ä¸¤ä¸ªå…ƒç´ æ‰€åœ¨æ ‘çš„æ ¹èŠ‚ç‚¹ã€‚\n# æŸ¥è¯¢\næŸ¥è¯¢ x å’Œ y æ˜¯å¦åœ¨åŒä¸€ä¸ªé›†åˆï¼Œæ˜¯æŸ¥è¯¢ x å’Œ y å¯¹åº”çš„æ ¹èŠ‚ç‚¹æ˜¯å¦ç›¸åŒã€‚\n# åˆå¹¶ç¤ºä¾‹\n![](../../images/å¹¶æŸ¥é›†/image-20250325235047075.png)\n\n![](../../images/å¹¶æŸ¥é›†/image-20250325235101586.png)\n## ä»£ç \n```cpp\n#include<iostream>\nconst int SIZE = 9;\nint parent[SIZE];\n// éé€’å½’ç‰ˆæŸ¥è¯¢xçš„æ ¹èŠ‚ç‚¹\nint find(int x)\n{\n    while(x != parent[x])\n    {\n        x = parent[x];\n    }\n    return x;\n}\n// é€’å½’ç‰ˆæŸ¥è¯¢xçš„æ ¹èŠ‚ç‚¹\nint r_find(int x)\n{\n    if(x == parent[x]) return x;\n    return r_find(parent[x]);\n}\n// åˆå¹¶xå’Œy\nvoid merge(int x, int y)\n{\n    int x_root = find(x);\n    int y_root = find(y);\n    if (x_root != y_root)\n    {\n        parent[y_root] = x_root;\n    }\n}\nint main()\n{\n    for(int i = 1; i < SIZE; ++i)\n    {\n        parent[i] = i;\n    }\n    int x, y;\n    // è¾“å…¥6ç»„ä¸¤ä¸ªæ•´æ•°ï¼Œå…¨éƒ½åˆå¹¶ã€‚\n    for(int i = 1; i <= 6; ++i)\n    {\n        std::cin >> x >> y;\n        merge(x, y);\n    }\n    for(int i = 1; i < SIZE; ++i)\n    {\n        std::cout << parent[i] << \" \";\n    }\n    std::cout << std::endl;\n    std::cout << \"è¾“å…¥è¦æŸ¥è¯¢çš„2ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆï¼š\";\n    std::cin >> x >> y;\n    std::cout << (find(x) == find(y) ? \"åœ¨\" : \"ä¸åœ¨\") << std::endl;\n}\n```\n\n```bash\nè¾“å…¥ï¼š\n1 3\n1 2\n5 4\n2 4\n6 8\n8 7\nè¾“å‡ºparentæ•°ç»„ï¼š\n1 1 1 5 1 6 6 6 \nè¾“å…¥è¦æŸ¥è¯¢çš„2ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆï¼š\n2 4\nè¾“å‡ºï¼š\nåœ¨\n```\n# è·¯å¾„å‹ç¼©\n","categories":["ç®—æ³•","é«˜çº§æ•°æ®ç»“æ„"]},{"title":"å¤§æ•°æ®æŸ¥é‡","url":"/ç®—æ³•/å¤§æ•°æ®æŸ¥é‡/","content":"# å“ˆå¸Œè¡¨ - æ‰¾é‡å¤æ•°å­—ã€å­—ç¬¦ï¼ˆä¸é™åˆ¶å†…å­˜ï¼‰\n```cpp\n#include<iostream>\n#include<vector>\n#include<ctime>\n#include<unordered_set>\n#include<unordered_map>\nusing namespace std;\nint main()\n{\n    vector<int> vec;\n    srand(time(NULL));\n    for(int i = 0; i < 1000; ++i)\n    {\n        vec.push_back(rand() % 100);\n    }\n    // é—®é¢˜1ï¼šæ‰¾ç¬¬ä¸€ä¸ªå‡ºç°é‡å¤çš„æ•°å­— - éœ€è¦setæ¥ç»Ÿè®¡\n    unordered_set<int> set1;\n    int count = 0;\n    for(const auto & key : vec)\n    {\n        const auto it = set1.find(key); // O(1)\n        if (it == set1.end())\n        {\n            set1.insert(key);\n        }\n        else\n        {\n            cout << \"é‡å¤çš„æ•°å­—æ˜¯\" << key << endl;\n            ++count;\n            // break; // æ‰¾æ‰€æœ‰é‡å¤å‡ºç°çš„æ•°å­—æ—¶ï¼Œå»æ‰break\n        }\n    }\n    std::cout << \"æ€»å…±é‡å¤äº†\" << count << \"ä¸ªæ•°\" << endl;\n    // é—®é¢˜2ï¼šç»Ÿè®¡é‡å¤çš„æ•°å­—ä»¥åŠå‡ºç°çš„æ¬¡æ•° - éœ€è¦mapæ¥ç»Ÿè®¡æ•°å­—åŠæ¬¡æ•°\n    unordered_map<int, int> map1;\n    for(const auto & key : vec)\n    {\n        const auto it = map1.find(key);   // O(1)\n        if (it == map1.end()) \n        {\n            // mapæ’å…¥çš„æ˜¯pairï¼Œè¿™é‡Œemplaceå¯ä»¥ç›´æ¥æ„å»º\n            map1.emplace(key, 1); // O(1)\n        }\n        else\n        {\n            ++it->second;\n        }\n        // ä»¥ä¸ŠforåŒºåŸŸä¸­çš„è¯­å¥å¯ä»¥è¢«ä¸€è¡Œä»£ç ä»£æ›¿ï¼š++map1[key]\n    }\n    for(const auto & pair : map1)\n    {\n        if(pair.second > 1)\n        {\n            cout << \"æ•°å­—\" << pair.first << \"é‡å¤\" << pair.second << \"æ¬¡\" << endl;\n        }\n    }\n    // é—®é¢˜3ï¼šå»é‡\n    unordered_set<int> set2;\n    for(const auto & key : vec)\n    {\n        set2.emplace(key);\n    }\n    // é—®é¢˜4ï¼šå­—ç¬¦ä¸²ä¸­æ‰¾ç¬¬ä¸€ä¸ªæ²¡æœ‰é‡å¤å‡ºç°è¿‡çš„å­—ç¬¦\n    bool haveDuplicate = false;\n    string str = \"fgodgnffinogiofdngps\";\n    unordered_map<char, int> map2;\n    for(const auto & key : str)\n    {\n        ++map2[key];\n    }\n    for(const auto & key : str)\n    {\n        if (map2[key] == 1)\n        {\n            haveDuplicate = true;\n            cout << \"ç¬¬ä¸€ä¸ªä¸é‡å¤çš„å­—ç¬¦ä¸º\" << key << endl;\n            break;\n        }\n    }\n    if (!haveDuplicate)\n    {\n        cout << \"æ‰€æœ‰å­—ç¬¦éƒ½é‡å¤\" << endl;\n    }\n}\n```\n# å“ˆå¸Œè¡¨åˆ†æ¡¶ - ä¸¤ä¸ªå¤§æ–‡ä»¶ï¼Œæ‰¾é‡å¤å†…å®¹ï¼ˆé€‚å½“é™åˆ¶å†…å­˜ï¼‰\næœ‰ä¸¤ä¸ªæ–‡ä»¶åˆ†åˆ«æ˜¯aå’Œbï¼Œå„è‡ªå­˜æ”¾äº†1äº¿æ¡IPåœ°å€ï¼Œé™åˆ¶å†…å­˜100MBï¼Œæ‰¾å‡ºä¸¤ä¸ªæ–‡ä»¶ä¸­é‡å¤çš„ipåœ°å€ã€‚\næ€»ä½“æ€è·¯æ˜¯ï¼ŒæŠŠä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹è¾“å…¥åˆ°å“ˆå¸Œè¡¨ä¸­ï¼Œéå†å¦ä¸€ä¸ªæ–‡ä»¶ä¸­çš„æ¯ä¸€æ¡IPåœ°å€ï¼Œä¸å“ˆå¸Œè¡¨ä¸­çš„keyæ¯”å¯¹ã€‚å› æ­¤åªéœ€è¦æä¾›1ä¸ªæ–‡ä»¶çš„å†…å­˜å ç”¨å³å¯ã€‚\nIPv4åœ°å€çš„å¤§å°æ˜¯4ä¸ªå­—èŠ‚ã€‚1äº¿æ˜¯100Mï¼Œåˆ™1äº¿æ¡IPåœ°å€å°±æ˜¯400MBã€‚å¦‚æœå†åŠ ä¸Šunordered_mapç»“æ„çš„åœ°å€åŸŸï¼Œé‚£å°±è¦å†ç¿»å€ï¼ŒæŠŠä¸€ä¸ªæ–‡ä»¶è¾“å…¥åˆ°å“ˆå¸Œè¡¨ä¸­å°±è¦å 800MBå†…å­˜ã€‚è¿™æ˜¾ç„¶æ˜¯è¶…å‡ºäº†100MBçš„è¦æ±‚ã€‚\nå¯ä»¥è¿™æ ·ï¼šæ–‡ä»¶açš„IPåœ°å€ä¾æ¬¡è¯»å–ï¼Œå–æ¨¡ï¼ˆæˆ–è€…ç§°ä¹‹ä¸ºå“ˆå¸Œå‡½æ•°ï¼‰ï¼Œæ¯”å¦‚`%11`ï¼Œè¿™æ ·æŠŠä»–ä»¬éƒ½åˆ†æ•£åˆ°11ä¸ªâ€œæ¡¶â€é‡Œã€‚\næŠŠæ–‡ä»¶bä¹Ÿåƒè¿™æ ·ï¼ŒæŒ¨ä¸ªIPåœ°å€å–æ¨¡ï¼Œåœ¨açš„ç›¸åº”çš„â€œæ¡¶â€å·ä¸‹ï¼Œå»å¯»æ‰¾ã€‚å› ä¸ºå¦‚æœIPåœ°å€ä¸€æ ·ï¼Œç”¨äº†ç›¸åŒçš„å–æ¨¡è¿ç®—ï¼ˆå“ˆå¸Œè¿ç®—ï¼‰ï¼Œæ‰€ä»¥æ˜¯åœ¨åŒä¸€ä¸ªæ¡¶å·é‡Œã€‚\nè¿™æ ·ï¼Œå°±æŠŠ1äº¿ä¸ªIPåœ°å€åˆ†æˆäº†11æ³¢ã€‚å†…å­˜å‹åŠ›å‡å°‘åˆ°äº†80MBã€‚\n# ä½æ•°ç»„ - ï¼ˆå°å†…å­˜ï¼‰\nå¦‚æœæ•°æ®é›†ä¸­çš„æœ€å¤§å€¼å¾ˆå¤§ï¼Œé‚£ä¹ˆä¸­é—´æœ‰å¥½å¤šæ— æ•ˆçš„ç©ºä½è¢«æµªè´¹ã€‚æ€»ä½“ä¸Šè¿˜æ˜¯æµªè´¹å†…å­˜çš„ã€‚\n# Bloom Filter å¸ƒéš†è¿‡æ»¤å™¨ - ï¼ˆæé™å†…å­˜ï¼‰\nç»“åˆäº†å“ˆå¸Œ+ä½æ•°ç»„çš„ä¼˜åŠ¿ã€‚å†…å­˜ä½¿ç”¨æ•ˆç‡é«˜ã€‚","categories":["ç®—æ³•","åœºæ™¯é¢˜"]},{"title":"é«˜çº§æ•°æ®ç»“æ„_Bæ ‘å®¶åº­_ç´¢å¼•ç®¡ç†æ€æƒ³","url":"/é«˜çº§æ•°æ®ç»“æ„/é«˜çº§æ•°æ®ç»“æ„_Bæ ‘å®¶åº­_ç´¢å¼•ç®¡ç†æ€æƒ³/","content":"# Bçš„å«ä¹‰\nBæ ‘æ˜¯ç”±Rudolf Bayerå’ŒEdward M. McCreightåœ¨æ³¢éŸ³ç ”ç©¶å®éªŒå®¤å·¥ä½œæ—¶å‘æ˜çš„ï¼Œç›®çš„æ˜¯æœ‰æ•ˆåœ°**ç®¡ç†å¤§å‹éšæœºè®¿é—®æ–‡ä»¶çš„ç´¢å¼•é¡µé¢**ã€‚\n\nåŸºæœ¬å‡è®¾æ˜¯ç´¢å¼•ä¼šéå¸¸åºå¤§ï¼Œä»¥è‡³äºåªæœ‰æ ‘çš„å°å—å¯ä»¥æ”¾å…¥ä¸»å†…å­˜ä¸­ã€‚\n\nBayerå’ŒMcCreightä»æœªè§£é‡Šè¿‡\"B\"ä»£è¡¨ä»€ä¹ˆ, å¦‚æœå¯èƒ½çš„è¯, å¯èƒ½ä¼šæ˜¯ï¼šBoeingã€**balanced**ã€broadã€busyå’ŒBayerã€‚\nMcCreightæ›¾è¯´è¿‡â€œä½ å¯¹Bæ ‘ä¸­çš„'B'çš„å«ä¹‰æ€è€ƒå¾—è¶Šå¤šï¼Œä½ å¯¹Bæ ‘çš„ç†è§£å°±è¶Šå¥½ã€‚â€\n\nä¸ç®¡\"B\"ä»£è¡¨çš„ä»€ä¹ˆå«ä¹‰, **æ€»ä¹‹è‚¯å®šä¸æ˜¯\"Binary\", å› ä¸ºBæ ‘ä¸æ˜¯äºŒå‰æ ‘**; \né‚£ä¹ˆ, æˆ‘ä»¬æš‚ä¸”å°±æŠŠB Treeä¸­çš„\"B\"å½“åšæ˜¯\"Balanced\"å§!\n# mé˜¶å¹³è¡¡æ ‘\n\nmé˜¶, è¿™ä¸ª\"é˜¶\"å¯¹äºæ ‘æ¥è¯´æ€ä¹ˆè§£é‡Š?\n\næ‹¿ä¾‹å­è¯´è¯å§!\n\n**AVLæ ‘**, å°±æ˜¯ä¸€ä¸ª**2é˜¶å¹³è¡¡æ ‘**, æ‰€è°“2é˜¶, æŒ‡çš„æ˜¯, 1ä¸ªèŠ‚ç‚¹æœ‰2ä¸ªæŒ‡é’ˆåŸŸæŒ‡å‘2ä¸ªå­©å­, å’Œ1ä¸ªæ•°æ®åŸŸ;\n\né‚£ä¹ˆ, mé˜¶çš„æ„æ€å°±æ˜¯: $1$ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰$m$ä¸ªæŒ‡é’ˆåŸŸæŒ‡å‘$m$ä¸ªå­©å­, å’Œæœ€å¤šæœ‰$m-1$ä¸ªæ•°æ®åŸŸ;\n\nBæ ‘çš„ç‰¹ç‚¹æ˜¯å’ŒAVLå¦‚å‡ºä¸€è¾™çš„, ç”šè‡³æ¯”AVLè¿˜è¦é“é«˜ä¸€å°º, AVLåªèƒ½ä¿è¯å·¦å³å­æ ‘é«˜åº¦å·®ä¸è¶…è¿‡1, \nè€Œ**Bæ ‘çš„æ€§è´¨ä¿è¯äº†æ‰€æœ‰å¶èŠ‚ç‚¹åŒæ—¶åœ¨åŒä¸€å±‚**, ç”±æ­¤å¯ä»¥çœ‹å‡º, Bæ ‘æ˜¯æ¯”AVLæ›´å¹³è¡¡çš„æ ‘; \n\nç”±æ­¤å¯è§, Bæ ‘åªä¸è¿‡æ˜¯ä¸€ä¸ª2é˜¶å¹³è¡¡æ ‘(AVL)çš„ä¸€ä¸ªæ¨ªå‘å˜ç§ç½¢äº†! æœ¬è´¨ä¸Šè¿˜æ˜¯AVLçš„çµé­‚; \n\n> å½¢å¼ä¸Šéƒ½æ˜¯å¹³è¡¡çš„, ä½†, ä¸AVLæœ€å¤§çš„ä¸åŒæ˜¯, Bæ ‘æ²¡æœ‰èŠ‚ç‚¹çš„æ—‹è½¬æ“ä½œ, è€Œæ˜¯æ¶‰åŠåˆ°åˆ†è£‚/åˆå¹¶;\n# Bæ ‘çš„æ€§è´¨\n\næ ¹æ®Knuthçš„å®šä¹‰ï¼Œ$m$é˜¶Bæ ‘æ˜¯æ»¡è¶³ä»¥ä¸‹æ€§è´¨çš„æ ‘ï¼š\n\n1. æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰$m$ä¸ªå­èŠ‚ç‚¹ã€‚\n2. æ¯ä¸ªå†…éƒ¨èŠ‚ç‚¹è‡³å°‘æœ‰$\\lceil m/2 \\rceil$ä¸ªå­èŠ‚ç‚¹ã€‚\n3. æ¯ä¸ªéå¶èŠ‚ç‚¹è‡³å°‘æœ‰2ä¸ªå­©å­ã€‚\n4. æ‰€æœ‰å¶å­éƒ½å‡ºç°åœ¨åŒä¸€å±‚æ¬¡ä¸Šå¹¶ä¸”ä¸æºå¸¦ä»»ä½•ä¿¡æ¯ã€‚\n5. å…·æœ‰$k$ä¸ªå­èŠ‚ç‚¹çš„éå¶èŠ‚ç‚¹åŒ…å«$k-1$ä¸ªé”®ã€‚\n\næ¯ä¸ªå†…éƒ¨èŠ‚ç‚¹çš„é”®å……å½“åˆ†å‰²å…¶å­æ ‘çš„åˆ†éš”å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªå†…éƒ¨èŠ‚ç‚¹æœ‰3ä¸ªå­èŠ‚ç‚¹ï¼ˆæˆ–å­æ ‘ï¼‰ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»æœ‰2ä¸ªé”®ï¼š$a_1$å’Œ$a_2$ã€‚ æœ€å·¦å­æ ‘ä¸­çš„æ‰€æœ‰å€¼éƒ½å°äº$a_1$ï¼Œä¸­é—´å­æ ‘ä¸­çš„æ‰€æœ‰å€¼éƒ½åœ¨$a_1$å’Œ$a_2$ä¹‹é—´ï¼Œæœ€å³å­æ ‘ä¸­çš„æ‰€æœ‰å€¼éƒ½å¤§äº$a_2$ã€‚\n# Bæ ‘ã€AVLã€çº¢é»‘æ ‘ã€BSTè¿™äº›æœç´¢æ ‘çš„å¯¹æ¯”\n**Bæ ‘å³å¹³è¡¡æ ‘ï¼Œmé˜¶å¹³è¡¡æ ‘**ã€‚ç¬¦åˆæœç´¢æ ‘çš„æ€§è´¨ï¼ˆä¸­åºéå†æœ‰åºï¼‰ã€‚\n\n**4é˜¶å¹³è¡¡æ ‘å³2-3-4æ ‘**ï¼ŒæŒ‡æ ‘çš„èŠ‚ç‚¹æœ€å¤šæœ‰3ä¸ªå…³é”®ç ï¼Œ4ä¸ªåˆ†æ”¯ã€‚2-3-4æ ‘å®é™…ä¸Šå°±æ˜¯4é˜¶Bæ ‘ã€‚å³: æ¯ä¸ªèŠ‚ç‚¹, æœ€å¤šæœ‰ä¸‰ä¸ªæ•°æ®, 4ä¸ªå­©å­èŠ‚ç‚¹\n\n**2é˜¶å¹³è¡¡æ ‘å³AVLæ ‘**ã€‚ä¸€ä¸ªèŠ‚ç‚¹æœ‰2ä¸ªåˆ†æ”¯ã€‚\n\nä½†**BSTï¼ˆBinary Search Treeï¼‰ä¸æ˜¯2é˜¶å¹³è¡¡æ ‘**ï¼Œå› ä¸ºBSTä¸­çš„BæŒ‡çš„ä¸æ˜¯Balancedï¼Œè€Œæ˜¯Binaryï¼Œå› æ­¤**BSTæ²¡æœ‰å¹³è¡¡æ€§è´¨**ã€‚\n\nAVLæ ‘èŠ‚ç‚¹çš„å·¦å³å­æ ‘é«˜åº¦å·®ä¸è¶…è¿‡1ã€‚\n\nBæ ‘ç›¸æ¯”AVLæ›´å¹³è¡¡ï¼Œå› ä¸ºæ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½åœ¨åŒä¸€å±‚ã€‚é€‚ç”¨äºæ–‡ä»¶ç´¢å¼•ç³»ç»Ÿã€‚\n\nBæ ‘ã€AVLæ ‘ã€çº¢é»‘æ ‘ã€BSTæœ¬è´¨ä¸Š**éƒ½æ˜¯ä¸€æ£µæœç´¢æ ‘**ï¼Œ\nåªä¸è¿‡Bæ ‘æ˜¯mé˜¶çš„ã€‚BSTã€AVLã€**çº¢é»‘æ ‘æ˜¯2é˜¶çš„**ã€‚\nBæ ‘å®Œå…¨å¹³è¡¡ï¼ŒAVLæ ‘é«˜åº¦å¹³è¡¡ï¼Œçº¢é»‘æ ‘è¿‘ä¹å¹³è¡¡ï¼ŒBSTä¸å¹³è¡¡ã€‚\n# Bæ ‘çš„è¡Œä¸º\n## æ’å…¥\nç‰¹ç‚¹æ˜¯ï¼Œå¦‚æœèŠ‚ç‚¹å†…çš„å…³é”®ç è¾¾åˆ°äº†mä¸ªï¼Œå°†ä¼šåˆ†è£‚ã€‚æŠŠmä¸ªå…³é”®ç ä¸­çš„ä¸­é—´å€¼å¾€ä¸Šæ¨ä¸€å±‚ã€‚è¢«ä¸Šç§»çš„èŠ‚ç‚¹å·¦å³æŒ‡å‘å‰©ä¸‹çš„ä¸¤åŠã€‚\n## åˆ é™¤\næœ‰ä¸¤ç§å¸¸ç”¨çš„åˆ é™¤ç­–ç•¥ï¼š\n1. å®šä½å¹¶åˆ é™¤å…ƒç´ ï¼Œç„¶åè°ƒæ•´æ ‘ä½¿å®ƒæ»¡è¶³çº¦æŸæ¡ä»¶ã€‚\n2. ä»ä¸Šåˆ°ä¸‹å¤„ç†è¿™æ£µæ ‘ï¼Œåœ¨è¿›å…¥ä¸€ä¸ªèŠ‚ç‚¹ä¹‹å‰ï¼Œè°ƒæ•´æ ‘ä½¿å¾—ä¹‹åä¸€æ—¦é‡åˆ°äº†è¦åˆ é™¤çš„å…ƒç´ ï¼Œå®ƒå¯ä»¥è¢«ç›´æ¥åˆ é™¤è€Œä¸éœ€è¦å†è¿›è¡Œè°ƒæ•´ã€‚\n    1. è¿™ç§ç­–ç•¥å°±ç±»ä¼¼äºï¼Œçº¢é»‘æ ‘çš„åˆ é™¤æ“ä½œå‰ï¼Œå…ˆè®©æ‰€æœ‰çš„2-å‹èŠ‚ç‚¹æ‰©å¼ ä¸º3-å‹æˆ–4-å‹èŠ‚ç‚¹ï¼Œå†å»ç›´æ¥åˆ é™¤ã€‚è§â€œCè¯­è¨€_æ ‘â€\n\nä»¥ä¸‹è®¨è®ºçš„æ˜¯ç¬¬1ç§ç­–ç•¥ã€‚\n\n1. æœ‰æ²¡æœ‰å­©å­\n    1. å¦‚æœåˆ é™¤çš„å…³é”®ç æ²¡æœ‰å­©å­ï¼Œå¯ä»¥ç›´æ¥åˆ é™¤ã€‚\n    2. å¦‚æœåˆ é™¤çš„å…³é”®ç æœ‰å­©å­ï¼Œéœ€è¦ä»å·¦å­©å­èŠ‚ç‚¹ä¸­æ‰¾æœ€å³å€¼æˆ–å³å­©å­æ‰¾æœ€å·¦å€¼ï¼Œå°†å…¶ä¸Šç§»è¡¥ä½ã€‚ç­‰äºæ˜¯æŠŠå­©å­ä¸­çš„ä¸€ä¸ªå…³é”®ç åˆ å»äº†ã€‚\n2. åˆ é™¤å\n    1. å¦‚æœåˆ é™¤åï¼ŒèŠ‚ç‚¹çš„å…³é”®ç æ•°å°äº$(m/2)(ä¸Šå–æ•´)-1$ã€‚ï¼ˆæ¯”å¦‚ï¼Œ5é˜¶Bæ ‘ï¼Œåˆ é™¤åèŠ‚ç‚¹å…³é”®ç æ•°ç›®å°äº2ï¼ˆå³1ä¸ªï¼‰ï¼›4é˜¶Bæ ‘ï¼ˆ2-3-4æ ‘ï¼‰ä¸­åˆ é™¤åèŠ‚ç‚¹å…³é”®ç æ•°ç›®å°äº1ï¼ˆå³0ä¸ªï¼‰ï¼‰ã€‚è¿™å«åšâ€œ**ä¸ä¸°æ»¡**â€ã€‚\n    2. å¦‚æœèŠ‚ç‚¹çš„å…³é”®ç æ•°å¤§äº$(m/2)(ä¸Šå–æ•´)-1$ï¼Œå«åšâ€œ**ä¸°æ»¡**â€ã€‚\n    3. è‹¥ç­‰äºï¼Œåˆ™ç±»ä¼¼äºâ€œ**åˆšåˆšè„±è´«**â€ã€‚æ­¤æ—¶å¦‚æœåˆ å»ä¸€ä¸ªå…ƒç´ ï¼Œå°±ä¼šâ€œä¸ä¸°æ»¡â€ã€‚\n    4. å…„å¼Ÿä¸°æ»¡ï¼Œ**å€Ÿ**ï¼šå¦‚æœåˆ é™¤åâ€œä¸ä¸°æ»¡â€ï¼Œåˆ™æŠŠçˆ¶èŠ‚ç‚¹å…ƒç´ ä¸‹ç§»è¡¥å……ï¼Œè€Œçˆ¶èŠ‚ç‚¹éœ€è¦å‘è¯¥åˆ é™¤åçš„èŠ‚ç‚¹ç›¸é‚»çš„ä¸°æ»¡çš„å…„å¼ŸèŠ‚ç‚¹ä¸­å€Ÿä¸€ä¸ªå…ƒç´ ã€‚\n    5. å…„å¼Ÿå¤ªç©·ï¼Œ**å¹¶**ï¼šå¦‚æœç›¸é‚»çš„å…„å¼ŸèŠ‚ç‚¹éƒ½æ˜¯â€œåˆšåˆšè„±è´«â€çš„ï¼Œå°±è¦é çˆ¶èŠ‚ç‚¹ä¸‹ç§»ä¸€ä¸ªå…ƒç´ ï¼Œè¡¥å……åˆ°è¿™ä¸ªåˆ é™¤çš„ä½ç½®ï¼Œç„¶åä¸ç›¸é‚»çš„ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹è¿›è¡Œâ€œåˆå¹¶â€æˆä¸ºä¸€ä¸ªèŠ‚ç‚¹ã€‚\n\n5é˜¶Bæ ‘ä¸ºä¾‹ï¼Œåˆ é™¤ï¼š\n![](../../images/é«˜çº§æ•°æ®ç»“æ„_Bæ ‘å®¶åº­/b-tree-2.svg)\nå¦‚å›¾æ‰€ç¤ºï¼Œæ¥ä¸‹æ¥è¦ä¾æ¬¡åˆ é™¤ 8ï¼Œ20ï¼Œ18ï¼Œ5ã€‚\n\né¦–å…ˆè¦åˆ é™¤å…ƒç´  8ã€‚å…ˆæŸ¥æ‰¾åˆ°å…ƒç´  8 åœ¨å¶å­èŠ‚ç‚¹ä¸­ï¼Œåˆ é™¤ 8 åå¶å­èŠ‚ç‚¹çš„å…ƒç´ ä¸ªæ•°ä¸º 2ï¼Œç¬¦åˆ B æ ‘çš„è§„åˆ™ã€‚ç„¶åéœ€è¦æŠŠå…ƒç´  11 å’Œ 12 éƒ½å‘å‰ç§»åŠ¨ä¸€ä½ã€‚å®Œæˆåå¦‚å›¾æ‰€ç¤ºã€‚\n![](../../images/é«˜çº§æ•°æ®ç»“æ„_Bæ ‘å®¶åº­/b-tree-3.svg)\nä¸‹ä¸€æ­¥ï¼Œåˆ é™¤ 20ï¼Œå› ä¸º 20 æ²¡æœ‰åœ¨å¶å­èŠ‚ç‚¹ä¸­ï¼Œè€Œæ˜¯åœ¨ä¸­é—´èŠ‚ç‚¹ä¸­æ‰¾åˆ°ï¼Œå¯ä»¥å‘ç° 20 çš„ç»§æ‰¿è€…æ˜¯ 23ï¼ˆå­—æ¯å‡åºçš„ä¸‹ä¸ªå…ƒç´ ï¼‰ï¼Œç„¶åéœ€è¦å°† 23 ä¸Šç§»åˆ° 20 çš„ä½ç½®ï¼Œä¹‹åå°†å­©å­èŠ‚ç‚¹ä¸­çš„ 23 è¿›è¡Œåˆ é™¤ã€‚\n\nåˆ é™¤åæ£€æŸ¥ä¸€ä¸‹ï¼Œè¯¥å­©å­èŠ‚ç‚¹ä¸­å…ƒç´ ä¸ªæ•°å¤§äº 2ï¼Œæ— éœ€è¿›è¡Œåˆå¹¶æ“ä½œã€‚\n\næ‰€ä»¥è¿™ä¸€æ­¥ä¹‹åï¼ŒB æ ‘å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n![](../../images/é«˜çº§æ•°æ®ç»“æ„_Bæ ‘å®¶åº­/b-tree-4.svg)\nä¸‹ä¸€æ­¥åˆ é™¤ 18ï¼Œ18 åœ¨å¶å­èŠ‚ç‚¹ä¸­ï¼Œä½†æ˜¯è¯¥èŠ‚ç‚¹ä¸­å…ƒç´ æ•°ç›®ä¸º 2ï¼Œåˆ é™¤å¯¼è‡´åªæœ‰ 1 ä¸ªå…ƒç´ ï¼Œå·²ç»å°äºæœ€å°å…ƒç´ æ•°ç›® 2ã€‚\n\nè€Œç”±å‰é¢å·²ç»çŸ¥é“ï¼šå¦‚æœå…¶æŸä¸ªç›¸é‚»å…„å¼ŸèŠ‚ç‚¹ä¸­æ¯”è¾ƒä¸°æ»¡ï¼ˆå…ƒç´ ä¸ªæ•°å¤§äºÂ $\\lceil \\dfrac{5}{2} \\rceil - 1$ï¼‰ï¼Œåˆ™å¯ä»¥å‘çˆ¶èŠ‚ç‚¹å€Ÿä¸€ä¸ªå…ƒç´ ï¼Œç„¶åå°†æœ€ä¸°æ»¡çš„ç›¸é‚»å…„å¼ŸèŠ‚ç‚¹ä¸­ä¸Šç§»æœ€åæˆ–æœ€å‰ä¸€ä¸ªå…ƒç´ åˆ°çˆ¶èŠ‚ç‚¹ä¸­ã€‚\n\nåœ¨è¿™ä¸ªå®ä¾‹ä¸­ï¼Œå³ç›¸é‚»å…„å¼ŸèŠ‚ç‚¹ä¸­æ¯”è¾ƒä¸°æ»¡ï¼ˆ3 ä¸ªå…ƒç´ å¤§äº 2ï¼‰ï¼Œæ‰€ä»¥å…ˆå‘çˆ¶èŠ‚ç‚¹å€Ÿä¸€ä¸ªå…ƒç´  23 ä¸‹ç§»åˆ°è¯¥å¶å­èŠ‚ç‚¹ä¸­ï¼Œä»£æ›¿åŸæ¥ 19 çš„ä½ç½®ã€‚19 å‰ç§»ã€‚\n\nç„¶å 24 åœ¨ç›¸é‚»å³å…„å¼ŸèŠ‚ç‚¹ä¸­ï¼Œéœ€è¦ä¸Šç§»åˆ°çˆ¶èŠ‚ç‚¹ä¸­ã€‚æœ€ååœ¨ç›¸é‚»å³å…„å¼ŸèŠ‚ç‚¹ä¸­åˆ é™¤ 24ï¼Œåé¢çš„å…ƒç´ å‰ç§»ã€‚\n\nè¿™ä¸€æ­¥ä¹‹åï¼ŒB æ ‘å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n![](../../images/é«˜çº§æ•°æ®ç»“æ„_Bæ ‘å®¶åº­/b-tree-5.svg)\næœ€åä¸€æ­¥éœ€è¦åˆ é™¤å…ƒç´  5ï¼Œä½†æ˜¯åˆ é™¤åä¼šå¯¼è‡´å¾ˆå¤šé—®é¢˜ã€‚å› ä¸º 5 æ‰€åœ¨çš„èŠ‚ç‚¹æ•°ç›®åˆšå¥½è¾¾æ ‡ä¹Ÿå°±æ˜¯åˆšå¥½æ»¡è¶³æœ€å°å…ƒç´ ä¸ªæ•° 2ã€‚\n\nè€Œç›¸é‚»çš„å…„å¼ŸèŠ‚ç‚¹ä¹Ÿæ˜¯åŒæ ·çš„æƒ…å†µï¼Œåˆ é™¤ä¸€ä¸ªå…ƒç´ éƒ½ä¸èƒ½æ»¡è¶³æ¡ä»¶ï¼Œæ‰€ä»¥éœ€è¦è¯¥èŠ‚ç‚¹å…ˆå€Ÿçˆ¶èŠ‚ç‚¹ä¸€ä¸ªå…ƒç´ ï¼Œå†ä¸æŸç›¸é‚»å…„å¼ŸèŠ‚ç‚¹è¿›è¡Œåˆå¹¶æ“ä½œï¼›é¦–å…ˆç§»åŠ¨çˆ¶èŠ‚ç‚¹ä¸­çš„å…ƒç´ ï¼ˆè¯¥å…ƒç´ åœ¨ä¸¤ä¸ªéœ€è¦åˆå¹¶çš„ä¸¤ä¸ªèŠ‚ç‚¹å…ƒç´ ä¹‹é—´ï¼‰ä¸‹ç§»åˆ°å…¶å­èŠ‚ç‚¹ä¸­ã€‚\n\nç„¶åå°†è¿™ä¸¤ä¸ªèŠ‚ç‚¹è¿›è¡Œåˆå¹¶æˆä¸€ä¸ªèŠ‚ç‚¹ã€‚æ‰€ä»¥åœ¨è¯¥å®ä¾‹ä¸­ï¼Œé¦–å…ˆå°†çˆ¶èŠ‚ç‚¹ä¸­çš„å…ƒç´  4 ä¸‹ç§»åˆ°å·²ç»åˆ é™¤ 5 è€Œåªæœ‰ 6 çš„èŠ‚ç‚¹ä¸­ï¼Œç„¶åå°†å«æœ‰ 4 å’Œ 6 çš„èŠ‚ç‚¹å’Œå«æœ‰ 1ï¼Œ3 çš„ç›¸é‚»å…„å¼ŸèŠ‚ç‚¹è¿›è¡Œåˆå¹¶æˆä¸€ä¸ªèŠ‚ç‚¹ã€‚\n\nè¿™ä¸€æ­¥ä¹‹åï¼ŒB æ ‘å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n![](../../images/é«˜çº§æ•°æ®ç»“æ„_Bæ ‘å®¶åº­/b-tree-6.svg)\nä½†æ˜¯è¿™é‡Œè§‚å¯Ÿåˆ°çˆ¶èŠ‚ç‚¹åªåŒ…å«äº†ä¸€ä¸ªå…ƒç´  7ï¼Œè¿™å°±æ²¡æœ‰è¾¾æ ‡ï¼ˆå› ä¸ºéæ ¹èŠ‚ç‚¹åŒ…æ‹¬å¶å­èŠ‚ç‚¹çš„å…ƒç´ æ•°é‡Â ![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 \"K\")Â å¿…é¡»æ»¡è¶³äºÂ $2\\le K\\le 4$)ï¼Œè€Œæ­¤å¤„çš„Â $K=1$ï¼‰ã€‚\n\nå¦‚æœè¿™ä¸ªé—®é¢˜èŠ‚ç‚¹çš„ç›¸é‚»å…„å¼Ÿæ¯”è¾ƒä¸°æ»¡ï¼Œåˆ™å¯ä»¥å‘çˆ¶èŠ‚ç‚¹å€Ÿä¸€ä¸ªå…ƒç´ ã€‚è€Œæ­¤æ—¶å…„å¼ŸèŠ‚ç‚¹å…ƒç´ åˆšå¥½ä¸º 2ï¼Œåˆšåˆšæ»¡è¶³ï¼Œåªèƒ½è¿›è¡Œåˆå¹¶ï¼Œè€Œæ ¹èŠ‚ç‚¹ä¸­çš„å”¯ä¸€å…ƒç´  13 ä¸‹ç§»åˆ°å­èŠ‚ç‚¹ã€‚è¿™æ ·ï¼Œæ ‘çš„é«˜åº¦å‡å°‘ä¸€å±‚ã€‚\n\næ‰€ä»¥æœ€ç»ˆçš„æ•ˆæœå¦‚ä¸‹å›¾ã€‚\n![](../../images/é«˜çº§æ•°æ®ç»“æ„_Bæ ‘å®¶åº­/b-tree-7.svg)\n# Bæ ‘çš„åº”ç”¨åœºæ™¯ - æ–‡ä»¶ç´¢å¼•(æ•°æ®åº“ç´¢å¼•)\nBæ ‘æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€æ£µæœç´¢æ ‘ï¼Œåªä¸è¿‡æ˜¯mé˜¶çš„å®Œå…¨å¹³è¡¡æ ‘ã€‚\n\nå¦‚æœç³»ç»Ÿæ‰€ç®¡ç†çš„æ•°æ®é‡å¾ˆå¤§ï¼Œéœ€è¦ç”¨ç£ç›˜ã€ç¡¬ç›˜ã€å¤–å­˜å­˜å‚¨ï¼Œé‚£ä¹ˆä¸ºäº†æé«˜æ•ˆç‡ï¼Œä¼šç»™æ•°æ®åˆ›å»ºç´¢å¼•ã€‚ä¸ºäº†ç´¢å¼•æŸ¥è¯¢çš„é«˜æ•ˆï¼Œéœ€è¦ç»™ç´¢å¼•æ’åºã€‚\n\nå¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œå¦‚æœæ•°æ®è¡¨æœ‰1000wè¡Œæ•°æ®ï¼Œåˆ™éœ€è¦æ•´è¡¨çº¿æ€§æœç´¢ã€‚\nå¦‚æœæœ‰ç´¢å¼•ï¼Œåˆ™æœ‰æœç´¢æ ‘ç»“æ„ã€‚åˆ™æŸ¥æ‰¾æ•ˆç‡ä¸º$O(log_2 N)$ã€‚ï¼ˆè¿™ä¸€ç‚¹åœ¨AVLæ ‘å’ŒBæ ‘ä¸ŠæŸ¥æ‰¾æ•ˆç‡æ˜¯ä¸€æ ·çš„ï¼‰\nå¦‚æœæ˜¯æ ‘èŠ‚ç‚¹æ˜¯mé˜¶ã€‚åˆ™**ä¼ è¾“æ¬¡æ•°**ä¸º$log_m N$ã€‚ï¼ˆæ ‘çš„å±‚é«˜ï¼Œå†³å®šäº†AVLæ ‘å’ŒBæ ‘å®é™…çš„æŸ¥æ‰¾æ•ˆç‡ä¸åŒï¼‰\n\næ³¨æ„åŒºåˆ†ä¼ è¾“æ¬¡æ•°å’ŒæŸ¥æ‰¾æ•ˆç‡ï¼š\nä¼ è¾“æ¬¡æ•°æŒ‡çš„æ˜¯ï¼ŒæŒ‰ç…§å¤§èŠ‚ç‚¹åˆ’å—ã€‚\næœ€ç»ˆè¿˜æ˜¯å¾—åœ¨å¤§èŠ‚ç‚¹çš„å†…éƒ¨è¿›è¡ŒæŸ¥æ‰¾ï¼Œè€ŒæŸ¥æ‰¾çš„æœ€å¿«ç®—æ³•åªèƒ½æ˜¯äºŒåˆ†æŸ¥æ‰¾ã€‚\n\næ‰€ä»¥è¿™ä¸ªä¾‹å­å¾ˆå¥½åœ°è¯´æ˜äº†ï¼Œç®—æ³•å’Œæ•°æ®ç»“æ„äºŒè€…çš„åœ°ä½ï¼Œç¼ºä¸€ä¸å¯ã€‚\nç®—æ³•æ•ˆç‡å›ºç„¶é‡è¦ï¼Œä½†ï¼š\næ•°æ®ç»“æ„å°†å†³å®šæ˜¯å¦èƒ½å¾ˆå¥½åœ°é€‚é…è®¡ç®—æœºçš„æ•´ä½“å­˜å‚¨ç»“æ„ï¼Œè¾¾åˆ°å®é™…çš„è¾ƒé«˜æ€§èƒ½ã€‚\n## æ“ä½œç³»ç»ŸåŸç†\næ“ä½œç³»ç»Ÿä¸­\n1. å†…å­˜ï¼ŒæŒ‰é¡µé¢(page)ä¸ºæœ€å°å•ä½åˆ†é…ã€ç®¡ç†ï¼Œé»˜è®¤æ¯ä¸€é¡µ4Kã€‚\n    1. æ‰€ä»¥ä»£ç ä¸Šçœ‹ä¼¼æˆ‘ä»¬åªå ç”¨äº†å‡ å­—èŠ‚ï¼Œä½†æ˜¯å®é™…ä¸Šå¯èƒ½å ç”¨äº†1é¡µã€‚\n    2. æŸäº›åœºæ™¯ä¼šä½¿ç”¨å¤§é¡µï¼ˆHuge Pagesï¼Œå¦‚ 2MB æˆ– 1GBï¼‰ä»¥ä¼˜åŒ–æ€§èƒ½ï¼Œä½†è¿™éœ€è¦æ˜¾å¼é…ç½®ï¼Œå¹¶éé»˜è®¤è¡Œä¸ºã€‚\n2. ç£ç›˜ï¼ŒæŒ‰å—(block)ä¸ºæœ€å°å•ä½åˆ†é…ã€ç®¡ç†ã€‚å¤§å¤šæ•°æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ ext4ã€NTFSï¼‰é»˜è®¤ä½¿ç”¨ â€‹4KB çš„å—å¤§å°ï¼Œä¸å†…å­˜é¡µå¯¹é½ä»¥æé«˜æ•ˆç‡ã€‚\n    1. æ‰€ä»¥æ“ä½œç³»ç»Ÿåœ¨è¯»å–æ–‡ä»¶æ—¶ï¼Œå¹¶ä¸æ˜¯åªè¯»å–äº†å‡ ä¸ªå­—èŠ‚ï¼Œè€Œæ˜¯æ•´ä¸ªå—å¤§å°ã€‚\n    2. **å¯é…ç½®æ€§**ï¼šå—å¤§å°å¯ä»¥æŒ‰éœ€è°ƒæ•´ï¼ˆå¦‚ 1KBã€8KBã€16KB ç­‰ï¼‰ï¼Œé€šå¸¸ç”¨äºç‰¹å®šåœºæ™¯ï¼ˆå¦‚å¤„ç†è¶…å¤§æ–‡ä»¶æˆ–æ•°æ®åº“ä¼˜åŒ–ï¼‰ã€‚\n    3. **ç‰©ç†æ‰‡åŒºä¸é€»è¾‘å—**ï¼šç£ç›˜çš„ç‰©ç†æ‰‡åŒºå¤§å°å¯èƒ½ä¸º 512B æˆ– 4KBï¼Œä½†æ–‡ä»¶ç³»ç»Ÿçš„é€»è¾‘å—ï¼ˆBlockï¼‰ä¼šç»„åˆå¤šä¸ªæ‰‡åŒºï¼Œå½¢æˆæ›´å¤§çš„é€»è¾‘å•å…ƒï¼Œ16KB çš„å—å°±æ˜¯ç”± 32 ä¸ª 512B æ‰‡åŒºç»„æˆçš„ã€‚\n### å…ˆç”¨å†…å­˜ç®¡ç†ä¸¾ä¾‹å­ï¼Œç±»æ¯”ç£ç›˜è¯»å–\næˆ‘ä»¬mallocæˆ–è€…newä¸€ä¸ªintï¼Œè¡¨é¢ä¸Šç”³è¯·äº†4å­—èŠ‚ã€‚ä½†æ˜¯å†…æ ¸çš„å†…å­˜ç®¡ç†æ˜¯æŒ‰æœ€å°ä¸€ä¸ªé¡µé¢å¤§å°ï¼ˆ4 KBï¼‰æ¥ç”³è¯·çš„ã€‚\nè¿™æ˜¯ç”±å†…æ ¸ä¸­ï¼Œ`libc.so`æˆ–`libc++.so`åº“ä¸­ptmallocæˆ–è€…tcmallocæ¥ç®¡ç†çš„å†…å­˜æ± å®ç°ã€‚\nå¦‚æœç”³è¯·äº†ä¸‹ä¸€ä¸ªå¯¹è±¡çš„å†…å­˜ç©ºé—´ï¼Œå†…å­˜æ± ç®¡ç†çš„è¿™ä¸ªé¡µé¢å°šæœ‰ç©ºé—´ï¼Œåˆ™ç›´æ¥è¿”å›é¢„ç”³è¯·å¥½çš„è¿™ä¸ªé¡µé¢ä¸­ç©ºé—²çš„åœ°å€ã€‚\n\né‚£ä¹ˆï¼Œç¡¬ç›˜ï¼ˆç£ç›˜ï¼‰è¯»å–æ•°æ®åˆ°å†…å­˜ä¸­ï¼Œä¹Ÿæ˜¯åŒæ ·çš„é“ç†ï¼ŒæŒ‰å—æ¥è¯»å–ï¼Œç£ç›˜æ‰‡åŒºä¸€èˆ¬æ˜¯ 512B ï¼Œæ–‡ä»¶ç³»ç»Ÿé€»è¾‘å—ç»„åˆå¤šä¸ªæ‰‡åŒºï¼Œå¯èƒ½æ˜¯ 16KB ï¼Œæ˜¯é¡µé¢å¤§å°ï¼ˆ4KBï¼‰çš„æ•´æ•°å€ã€‚\næ‰€ä»¥ï¼Œè¯»å–ä¸€æ¬¡ç¡¬ç›˜ï¼ˆç£ç›˜ï¼‰æ•°æ®ï¼Œå¹¶ä¸åªæ˜¯è¯»å–äº†å‡ ä¸ªå­—èŠ‚ï¼Œè€Œæ˜¯æŠŠä¸€æ•´å—æ•°æ®è¯»åˆ°äº†å†…å­˜ç¼“å†²åŒºä¸­ã€‚\n### åˆ†æå’Œæ–¹æ¡ˆ - å‡è®¾æœ‰1åƒä¸‡ä»½ç®€å† - è®¾è®¡ç´¢å¼•\nå¦‚æœæˆ‘ä»¬æœ‰1åƒä¸‡ä»½ç®€å†æ–‡ä»¶ï¼Œæ¯ä»½ç®€å†æ–‡ä»¶ä¸º10Mï¼Œåˆ™ç²—ç•¥è®¡ç®—å…¶æœ‰9000Gã€‚\nå¦‚ä½•å¯¹æ‰€æœ‰ç®€å†æ–‡ä»¶çš„å†…å®¹è¿›è¡ŒæŸ¥è¯¢ï¼Ÿ\næˆ‘ä»¬çš„å†…å­˜æ˜¯æœ‰é™çš„ï¼ŒæŒ‰ç…§æ•°ç»„çš„æ–¹å¼è¿›è¡ŒæŸ¥è¯¢ï¼Œä¸€æ¬¡åªèƒ½åŠ è½½ä¸€éƒ¨åˆ†ã€‚å¦‚æœå¯ç”¨çš„å†…å­˜å¤§å°åªæœ‰1Gï¼Œæœ‰å¯èƒ½éœ€è¦åŠ è½½9000æ¬¡ï¼Œå¤ªæ…¢äº†ã€‚\n\nå¦‚æœç®€å†ä»¥èº«ä»½è¯å·ä¸ºå…³é”®ç ï¼Œæˆ‘ä»¬**åªéœ€è¦åœ¨å†…å­˜ä¸­åŠ è½½å®ƒä»¬çš„èº«ä»½è¯å·**å’Œ**å…¶ç®€å†å¯¹åº”çš„æ–‡ä»¶æŒ‡é’ˆ**å³å¯ã€‚è¿™å°±æ˜¯æ–‡ä»¶ç´¢å¼•ã€‚\n\nå†ç»“åˆæœç´¢ç®—æ³•ï¼Œå¦‚æœè¦é«˜æ•ˆåœ°æœç´¢ï¼Œå¦‚äºŒåˆ†æŸ¥æ‰¾ï¼Œåˆ™éœ€è¦å¯¹å…³é”®ç è¿›è¡Œæ’åºã€‚\n\næ–‡ä»¶åœ¨ç£ç›˜ä¸­å¯ä»¥ä¸æŒ‰èº«ä»½è¯å·æ’åºã€‚\n\nå¦‚æœæƒ³è¦åˆ›å»ºæ–°çš„ç®€å†ï¼Œé‚£ä¹ˆå…³é”®ç éœ€è¦æ’å…¥å·²æœ‰çš„å…³é”®ç ä¸­ã€‚\n\nè¿™æ—¶å€™å…³é”®ç çš„æ•°æ®ç»“æ„å°±ä¼šå½±å“åˆ°æ•ˆç‡ã€‚\n\nå¦‚æœæ˜¯ç”¨æ•°ç»„å­˜å‚¨ï¼Œè™½ç„¶è¯»å–ä¸Šå¾ˆææ•ˆï¼Œä½†æ’å…¥ã€åˆ é™¤æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚\nå¦‚æœæ˜¯ç”¨é“¾è¡¨å­˜å‚¨ï¼Œè™½ç„¶æ’å…¥ã€åˆ é™¤å¾ˆé«˜æ•ˆï¼Œä½†è¯»å–ä¸Šå°±å¾ˆæ…¢ã€‚\nè¿™ç§é™æ€çš„å­˜å‚¨æ–¹å¼ä¸è¡Œã€‚\n\nå¦‚æœæ˜¯æ ‘å½¢å­˜å‚¨ï¼Œå¦‚çº¢é»‘æ ‘å­˜å‚¨ï¼Œè™½ç„¶å¯ä»¥è¾ƒå¥½åœ°å¹³è¡¡æŸ¥è¯¢ã€ä¿®æ”¹çš„æ—¶é—´å¤æ‚åº¦ï¼Œä½†æ˜¯æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ˜¯mallocç”³è¯·çš„å †ä¸Šå†…å­˜ï¼Œæ ¹æ®è®¡ç®—æœºçš„å­˜å‚¨ä½“ç³»ç»“æ„ï¼Œä¼šå¯¼è‡´å…¶èŠ‚ç‚¹åœ°å€åœ¨å†…å­˜ç»“æ„ä¸­å‘ˆç¢ç‰‡åŒ–ï¼Œä¸åˆ©äºç¼“å­˜çš„å‘½ä¸­ï¼Œæ•ˆç‡ä¾ç„¶ä¸å¤Ÿé«˜ã€‚\n**èŠ‚ç‚¹åœ¨å†…å­˜ä¸­ç¢ç‰‡åŒ–çš„å½±å“æ˜¯ä¼šè§¦å‘å†…å­˜çš„ç¼ºé¡µä¸­æ–­ï¼Œéœ€è¦æ¢é¡µï¼Œæ¢é¡µä¼šè§¦å‘è¯»å–ç£ç›˜IOï¼Œæ¶ˆè€—æ—¶é—´**ã€‚\n\nå¯ä»¥è€ƒè™‘ä¸¤ç§æ–¹æ¡ˆï¼š\n1. å“ˆå¸Œè¡¨ã€‚\n2. 300é˜¶Bæ ‘ã€‚çº¢é»‘æ ‘æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª4é˜¶Bæ ‘ï¼Œå…¶æ¯ä¸€ä¸ªèŠ‚ç‚¹æœ€å¤šå­˜å‚¨3ä¸ªç´¢å¼•ã€‚è€Œ300é˜¶Bæ ‘åˆ™å¯ä»¥è®©èŠ‚ç‚¹å­˜å‚¨æ›´å¤šè¿ç»­çš„æ•°æ®ã€‚å°½é‡è®©è¿™ä¸ªæ•°æ®å—çš„å¤§å°æ­£å¥½æ˜¯å†…å­˜çš„é¡µå¤§å°ï¼ˆ4KBï¼‰ã€‚æé«˜äº†å†…å­˜ã€ç¼“å­˜å‘½ä¸­ç‡ã€‚\n## AVLæ ‘å’ŒBæ ‘å­˜å‚¨ç´¢å¼•çš„å¯¹æ¯”ï¼ˆå‡è®¾ç´¢å¼•å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ï¼‰\nå‡å¦‚, ç›®å‰æœ‰1åƒä¸‡ä¸ªç´¢å¼•è¦ä»ç£ç›˜ä¸­è¿›è¡Œè¯»å–å¹¶ä¸”è¿›è¡Œæœç´¢ã€‚\nå¯¹äºAVLæ ‘ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹åªèƒ½å¯¹åº” 1 ä¸ªç´¢å¼•å…ƒç´ ï¼ˆå…³é”®ç ï¼‰ã€‚\nå¯¹äºBæ ‘ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥å®¹çº³$m-1$ä¸ªç´¢å¼•å…ƒç´ ï¼ˆå…³é”®ç ï¼‰ã€‚\n\nå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª300é˜¶Bæ ‘ã€‚ï¼ˆ300é˜¶æ˜¯ç»¼åˆè€ƒè™‘ä¸€ä¸ªBæ ‘èŠ‚ç‚¹å¤§å°çº¦ä¸º4KBçš„æƒ…å†µï¼Œæ›´æœ‰æ•ˆåœ°é˜²æ­¢è·¨ç£ç›˜å—ï¼‰\né‚£ä¹ˆï¼Œ1åƒä¸‡ä¸ªç´¢å¼•æ„å»ºåˆ°Bæ ‘ä¸­ï¼Œåªéœ€è¦3å±‚ã€‚è€ŒAVLæ ‘éœ€è¦24å±‚ã€‚\nç›¸å½“äºï¼ŒäºŒåˆ†æŸ¥æ‰¾ä¸€ä¸ªç´¢å¼•ï¼ŒBæ ‘åªéœ€è¦è®¿é—®3ä¸ªèŠ‚ç‚¹ï¼Œè€ŒAVLæ ‘å¯èƒ½éœ€è¦è®¿é—®24ä¸ªèŠ‚ç‚¹ï¼ˆæœ€å·®æƒ…å†µï¼‰ã€‚\n\n| å‚æ•°                               | AVLçš„é«˜åº¦                      | 300é˜¶Bæ ‘çš„é«˜åº¦                      |\n| -------------------------------- | --------------------------- | ------------------------------ |\n| 10,000,000ä¸ªç´¢å¼•å…ƒç´ ($n=1\\times10^7$) | $\\lceil\\log_2 n\\rceil = 24$ | $\\lceil\\log_{300} n\\rceil = 3$ |\n### å¦‚æœç´¢å¼•å¯ä»¥å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­\n1. â€‹**ç´¢å¼•çš„æœç´¢è¿‡ç¨‹åœ¨å†…å­˜ä¸­å®Œæˆ**ï¼š\n    æ— è®ºæ˜¯AVLæ ‘è¿˜æ˜¯Bæ ‘ï¼ŒæŸ¥æ‰¾ç›®æ ‡ç´¢å¼•çš„è·¯å¾„ï¼ˆä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹ï¼‰å…¨éƒ¨åœ¨å†…å­˜ä¸­è¿›è¡Œï¼Œ**ä¸æ¶‰åŠç£ç›˜IO**ã€‚åªæœ‰æœ€åæ ¹æ®æ–‡ä»¶æŒ‡é’ˆè¯»å–å®é™…æ–‡ä»¶æ—¶æ‰ä¼šè§¦å‘ç£ç›˜IOã€‚\n2. â€‹**æ–‡ä»¶è¯»å–çš„ç£ç›˜IOæ¬¡æ•°**ï¼š1æ¬¡\n    æ‰¾åˆ°ç›®æ ‡ç´¢å¼•åï¼Œéœ€é€šè¿‡æ–‡ä»¶æŒ‡é’ˆä»ç£ç›˜è¯»å–å¯¹åº”çš„å®é™…æ–‡ä»¶ã€‚æ— è®ºç´¢å¼•ç»“æ„å±‚æ•°å¤šå°‘ï¼Œ**ä»…éœ€1æ¬¡ç£ç›˜IO**â€‹ï¼ˆè¯»å–ç›®æ ‡æ–‡ä»¶ï¼‰ã€‚\n### å®é™…æ•°æ®åº“ä¸­ï¼Œç´¢å¼•å¯èƒ½è¿œå¤§äºå†…å­˜å®¹é‡\n- â€‹å¤§è§„æ¨¡æ•°æ®ç´¢å¼•æ— æ³•å®Œå…¨æ”¾å…¥å†…å­˜\n    - å®é™…æ•°æ®åº“ä¸­ï¼Œç´¢å¼•å¯èƒ½è¿œå¤§äºå†…å­˜å®¹é‡ã€‚Bæ ‘é€šè¿‡å¤šçº§èŠ‚ç‚¹å°†çƒ­ç‚¹æ•°æ®ä¿ç•™åœ¨å†…å­˜ï¼ˆå¦‚æ ¹èŠ‚ç‚¹å¸¸é©»å†…å­˜ï¼‰ï¼Œå†·æ•°æ®å­˜å‚¨åœ¨ç£ç›˜ï¼Œ**å‡å°‘å†…å­˜å‹åŠ›**ã€‚ \n    - çº¢é»‘æ ‘/AVLæ ‘ï¼šè‹¥ç´¢å¼•æ— æ³•å…¨æ”¾å…¥å†…å­˜ï¼Œæ¯æ¬¡è®¿é—®æ·±å±‚èŠ‚ç‚¹éƒ½å¯èƒ½è§¦å‘ç£ç›˜I/Oï¼Œæ€§èƒ½æ€¥å‰§ä¸‹é™ã€‚\n- â€‹å†™æ“ä½œçš„ç£ç›˜å‹å¥½æ€§\n    - å¯¹äºè¯»å–æ“ä½œï¼Œæ— æ‰€è°“ã€‚ä½†æ˜¯å¯¹äºä¿®æ”¹æ“ä½œï¼Œé‚£ä¹ˆå¦‚æœæ’å…¥ã€åˆ é™¤ä¸€æ¡æ•°æ®è®°å½•ï¼Œå°±ä¼šè®©æ ‘ç»“æ„è¿›è¡Œè°ƒæ•´ã€‚â€‹\n    - Bæ ‘çš„èŠ‚ç‚¹åˆ†è£‚/åˆå¹¶æ“ä½œæ˜¯ â€‹**å±€éƒ¨æ€§ä¿®æ”¹**â€‹ï¼ˆä»…å½±å“ç›¸é‚»èŠ‚ç‚¹ï¼‰ï¼Œé€‚åˆæ‰¹é‡å†™å…¥ç£ç›˜ï¼›\n    - è€Œçº¢é»‘æ ‘/AVLæ ‘çš„æ—‹è½¬æ“ä½œå¯èƒ½å¯¼è‡´ â€‹**å…¨å±€ç»“æ„è°ƒæ•´**ï¼Œäº§ç”Ÿæ›´å¤šéšæœºI/Oã€‚\n# æ€»ç»“ï¼ˆâ­ï¼‰\næ–‡ä»¶ç´¢å¼•ç®¡ç†æœ€ä¸»è¦çš„ 2 ä¸ªé—®é¢˜ï¼š\n1. æ›´å¿«çš„æœç´¢ç®—æ³•ï¼ˆç´¢å¼•çš„å…³é”®ç ï¼‰\n    1. å¯¹äºæœç´¢ç®—æ³•å€’æ˜¯æ²¡ä»€ä¹ˆå·®å¼‚ï¼ŒAVLæ ‘å’ŒBæ ‘åŒæ ·éƒ½æ˜¯äºŒåˆ†æŸ¥æ‰¾çš„åˆ†æ²»ç­–ç•¥, æ—¶é—´å¤æ‚åº¦éƒ½ä¸º$O(\\log n)$ã€‚\n2. æ›´å°‘çš„ç£ç›˜IOã€æ›´ä½çš„å†…å­˜ç¼ºé¡µç‡\n    1. å¯¹äºæ ‘çš„å±‚æ•°æ¥è¯´ï¼ŒAVLæ ‘å’ŒBæ ‘æ˜¯æœ‰å¾ˆå¤§å·®å¼‚çš„ã€‚\n    2. è‹¥ç´¢å¼•å¤ªåºå¤§ï¼Œ**æœ€å·®æƒ…å†µä¸‹**å¿…é¡»æ¯æ¬¡ä»ç£ç›˜ä¸­è¯»å–ï¼šï¼ˆçœ‹è·¯å¾„å±‚æ•°ï¼Œå±‚ä½æœ‰ä¼˜åŠ¿ï¼‰\n        1. **æ ‘çš„å±‚é«˜**ï¼Œä¼šç›´æ¥å½±å“åˆ°åœ¨**æœ€å·®æƒ…å†µ**ä¸‹çš„**ç£ç›˜I/Oæ¬¡æ•°**ã€‚\n        2. å› ä¸ºæ¯æ¬¡è®¿é—®ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œéƒ½éœ€è¦å°†ç£ç›˜å—ï¼ˆBlockï¼‰åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ï¼ˆæœ€å·®æƒ…å†µä¸‹ï¼Œç´¢å¼•åˆ†å¸ƒåœ¨ä¸åŒç£ç›˜å—ä¸­ï¼‰\n        3. 300é˜¶Bæ ‘åˆšå¥½æŠŠä¸€ä¸ªæœ€å¤§èŠ‚ç‚¹çš„å¤§å°æ¥è¿‘4KBå³é¡µå¤§å°ã€‚ä¸€ä¸ªèŠ‚ç‚¹å¯¹åº”ç€1é¡µï¼Œè‹¥ç´¢å¼•ç›¸é‚»ï¼Œåˆ™åˆ©ç”¨å±€éƒ¨æ€§åŸç†ææ•ˆã€‚\n    3. è‹¥ç´¢å¼•å¯ä»¥ä»ç£ç›˜ä¸€æ¬¡æ€§åŠ è½½åˆ°å†…å­˜ä¸­ï¼šï¼ˆçœ‹èŠ‚ç‚¹ä¸€æ¬¡æ€§èƒ½å®¹çº³ç´¢å¼•çš„æ•°é‡ï¼Œå®¹çº³è¶Šå¤šè¶Šæœ‰ä¼˜åŠ¿ï¼‰\n        1. ä¸€ä¸ªèŠ‚ç‚¹èƒ½å®¹çº³çš„ç´¢å¼•æ•°é‡ï¼Œå†³å®šäº†ç´¢å¼•åœ¨å†…å­˜ä¸­çš„åˆ†æ•£åº¦ã€‚\n        2. å¦‚æœèŠ‚ç‚¹å†…å­˜åœ°å€å¤ªåˆ†æ•£ï¼ˆåƒçº¢é»‘æ ‘ï¼Œåªèƒ½å­˜3ä¸ªç´¢å¼•ï¼‰ï¼Œå¯èƒ½ä¼šé¢ä¸´æ›´é«˜çš„**å†…å­˜ç¼ºé¡µä¸­æ–­**ç‡ã€‚**é—´æ¥å½±å“äº†ç£ç›˜I/Oæ¬¡æ•°**ã€‚\n3. æ€»ä¹‹ï¼Œæ— è®ºç´¢å¼•èƒ½ä¸èƒ½ä¸€æ¬¡æ€§è½½å…¥å†…å­˜ï¼ŒBæ ‘éƒ½å æœ‰ä¼˜åŠ¿ï¼Œ**é›†åˆäº†å±‚ä½ã€èŠ‚ç‚¹å®¹é‡å¤§**çš„ä¼˜åŠ¿ã€‚\n    1. å±‚æ•°å°‘ï¼Œé¿å…äº†ç£ç›˜IOæ¬¡æ•°ã€‚\n    2. èŠ‚ç‚¹å®¹é‡å¤§ï¼Œé¿å…äº†å†…å­˜ç¼ºé¡µã€‚\n# B+æ ‘ï¼ŒBæ ‘çš„æ”¹è¿›\nB+æ ‘å¯ä»¥çœ‹ä½œæ˜¯Bæ ‘çš„ä¼˜åŒ–ï¼Œæ¯” B æ ‘æ›´é€‚åˆå®é™…åº”ç”¨ä¸­çš„ç´¢å¼•ã€‚ç›®å‰ç°ä»£å…³ç³»å‹æ•°æ®åº“æœ€å¹¿æ³›çš„æ”¯æŒç´¢å¼•ç»“æ„å°±æ˜¯ B+ æ ‘ã€‚\n\næ€»ä¹‹ï¼šB+æ ‘æ˜ç¡®åˆ†å‡º`leaf`/`internal`èŠ‚ç‚¹ï¼Œ è®©`internal`åªå­˜`key`ï¼Œåªæœ‰`leaf`å­˜å…¨éƒ¨çš„ç´¢å¼•ä¿¡æ¯ã€‚\nï¼ˆ`Bâˆ—`æ ‘åˆ™æ˜¯èŠ‚ç‚¹æ»¡çš„æ—¶å€™å…ˆä¸æ‹†åˆ†è€Œæ˜¯å°½å¯èƒ½åˆå¹¶åˆ°é‚»å±…èŠ‚ç‚¹ï¼‰\n\n![](../../images/é«˜çº§æ•°æ®ç»“æ„_Bæ ‘å®¶åº­/image-20250305071843256.png)\n\nB+æ ‘ä¸Bæ ‘å·®å¼‚çš„ç‚¹ï¼Œä¸»è¦æ˜¯ä»¥ä¸‹è¿™å‡ ç‚¹ï¼š\n1. éå¶å­èŠ‚ç‚¹åªä¼šå­˜æ”¾å…³é”®ç ï¼Œä¸å­˜å‚¨å®é™…æ•°æ®ã€‚\n2. å¶å­èŠ‚ç‚¹æ‰ä¼šå­˜æ”¾å®é™…æ•°æ®ã€‚\n3. å…¨éƒ¨çš„ä¿¡æ¯éƒ½ä¼šåœ¨å¶å­èŠ‚ç‚¹å‡ºç°ã€‚\n4. éå¶å­èŠ‚ç‚¹å­˜å‚¨çš„å…³é”®ç æ˜¯æ¯ä¸ªå­èŠ‚ç‚¹ä¸­çš„æœ€å°å€¼ã€‚\n5. å¶å­èŠ‚ç‚¹ä¹‹é—´æ„æˆä¸€ä¸ªæœ‰åºé“¾è¡¨ã€‚\n\n## ç›¸æ¯”Bæ ‘çš„ä¼˜åŠ¿\n1. æ•°æ®é‡ç›¸åŒçš„æƒ…å†µä¸‹ï¼ŒB+æ ‘çš„éå¶å­èŠ‚ç‚¹æ•°æ®å¯†åº¦æ›´å¤§ï¼Œå­˜å‚¨æ•ˆç‡é«˜ã€‚B+æ ‘çš„éå¶å­èŠ‚ç‚¹å¯ä»¥å­˜æ”¾æ›´å¤šçš„å…³é”®ç ï¼Œå› æ­¤B+æ ‘å¯ä»¥æ¯”Bæ ‘æ›´ã€ŒçŸ®èƒ–ã€ï¼ŒæŸ¥è¯¢åº•å±‚èŠ‚ç‚¹çš„ç£ç›˜IOæ¬¡æ•°ä¼šæ›´å°‘ã€‚\n2. **æŸ¥è¯¢æ›´ç¨³å®š**ï¼Œç”±äºéå¶ç»“ç‚¹å¹¶ä¸æ˜¯æœ€ç»ˆæŒ‡å‘æ–‡ä»¶å†…å®¹çš„ç»“ç‚¹ï¼Œä»»ä½•å…³é”®å­—çš„æŸ¥æ‰¾å¿…é¡»èµ°ä¸€æ¡ä»æ ¹ç»“ç‚¹åˆ°å¶å­ç»“ç‚¹çš„è·¯ã€‚**æ‰€æœ‰å…³é”®å­—æŸ¥è¯¢çš„è·¯å¾„é•¿åº¦ç›¸åŒ**ï¼Œå¯¼è‡´æ¯ä¸€ä¸ªæ•°æ®çš„æŸ¥è¯¢æ•ˆç‡ç›¸å½“ã€‚\n3. B+æ ‘çš„å¶å­èŠ‚ç‚¹é€šè¿‡æŒ‡é’ˆå½¢æˆæœ‰åºé“¾è¡¨ï¼Œ**èŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚`WHERE id BETWEEN 100 AND 200`ï¼‰åªéœ€éå†å¶å­èŠ‚ç‚¹**ï¼Œé¿å…äº†å›æº¯åˆ°ä¸Šå±‚èŠ‚ç‚¹ã€‚ \n\nä¾‹å­ï¼šå‡è®¾ç£ç›˜ä¸­çš„ä¸€ä¸ªç›˜å—å¯å®¹çº³ 16 Bï¼Œè€Œä¸€ä¸ªå…³é”®å­—å¤§å° 2 Bã€‚ä¸€ä¸ªå…³é”®å­—å…·ä½“ä¿¡æ¯æŒ‡é’ˆå¤§å° 2 Bã€‚\nä¸€æ£µ9é˜¶Bæ ‘ï¼ˆä¸€ä¸ªç»“ç‚¹æœ€å¤š 8 ä¸ªå…³é”®å­—ï¼‰çš„å†…éƒ¨ç»“ç‚¹éœ€è¦ 2 ä¸ªç›˜å—ã€‚è€ŒB+æ ‘å†…éƒ¨ç»“ç‚¹åªéœ€è¦ 1 ä¸ªç›˜å—ã€‚å½“éœ€è¦æŠŠå†…éƒ¨ç»“ç‚¹è¯»å…¥å†…å­˜ä¸­çš„æ—¶å€™ï¼ŒBæ ‘å°±æ¯”B+æ ‘å¤šä¸€æ¬¡ç›˜å—æŸ¥æ‰¾æ—¶é—´ï¼ˆåœ¨ç£ç›˜ä¸­å°±æ˜¯ç›˜ç‰‡æ—‹è½¬çš„æ—¶é—´ï¼‰ã€‚","categories":["é«˜çº§æ•°æ®ç»“æ„","æ ‘","æ•°æ®åº“","MySQL"]},{"title":"é‡åŒ–äº¤æ˜“","url":"/é‡åŒ–äº¤æ˜“/é‡åŒ–äº¤æ˜“/","content":"# æŠ€æœ¯äº¤æ˜“\n\n# é‡åŒ–äº¤æ˜“\né‡åŒ–äº¤æ˜“ï¼Œåœ¨å­¦æœ¯ä¸ŠæŒ‡åˆ©ç”¨ç°ä»£ç»Ÿè®¡å­¦ã€æ•°å­¦ç®—æ³•ã€è®¡ç®—æœºæŠ€æœ¯ï¼Œè¿›è¡Œäº¤æ˜“çš„è¯åˆ¸æŠ•èµ„æ–¹å¼ã€‚ä»åºå¤§çš„å†å²æ•°æ®ä¸­ç­›é€‰å¯èƒ½å¸¦æ¥è¶…é¢æ”¶ç›Šçš„ï¼Œç”¨å¤šç§å¤§æ¦‚ç‡äº‹ä»¶çš„æ–¹å¼æ¥åˆ¶å®šç­–ç•¥ã€‚ç”¨æ•°é‡æ¨¡å‹æ¥æ£€éªŒã€å›ºåŒ–è¿™äº›ç­–ç•¥ï¼Œå†ä¸¥æ ¼åœ°æ‰§è¡Œè¿™äº›ç­–ç•¥ï¼Œä»è€ŒæŒ‡å¯¼æŠ•èµ„ã€‚ç›®çš„æ˜¯è·å¾—å¯æŒç»­çš„ã€ç¨³å®šçš„ã€é«˜äºå¹³å‡æ”¶ç›Šçš„è¶…é¢å›æŠ¥ã€‚\né‡åŒ–äº¤æ˜“çš„æ¦‚å¿µå¾ˆå¹¿ï¼Œæœ¬è´¨ä¸Šå’Œç¨‹åºåŒ–å¹¶æ— å…³ç³»ï¼Œå› ä¸ºå®ƒåªæ˜¯åœ¨å†å²ä¸­è¿›è¡Œåˆ†æï¼Œåˆ†æçš„ç»“æœåœ¨ç¨‹åºåŒ–äº¤æ˜“ä¹‹å‰å°±ä¼šå®Œæˆï¼Œæ¢å¥è¯è¯´ï¼Œå®Œå…¨å¯ä»¥ä¾èµ–çº¸å’Œç¬”è®¡ç®—ã€‚å› æ­¤é‡åŒ–äº¤æ˜“åªæ˜¯ä¸€ç§æ€æƒ³ï¼Œä¸å¿…é¡»æ˜¯è‡ªåŠ¨åŒ–äº¤æ˜“ã€‚\n# é«˜é¢‘äº¤æ˜“\né«˜é¢‘äº¤æ˜“æ˜¯é‡åŒ–æŠ•èµ„é¢†åŸŸçš„ä¸€ä¸ªæµæ´¾ã€‚å­—é¢ä¸Šçš„é«˜é¢‘ï¼ŒæŒ‡æ¯æ¬¡äº¤æ˜“ä»å¼€ä»“åˆ°å¹³ä»“åªæœ‰å¾ˆçŸ­çš„æ—¶é—´ï¼Œä¸€èˆ¬ä»å‡ åˆ†é’Ÿåˆ°å‡ å¾®ç§’ã€‚æœ‰çš„æ—¶å€™ä¸ºäº†è¯•æ¢ï¼ˆåå¤æŒ‚å•ã€æ’¤å•ï¼‰ï¼Œè¿˜ä¼šæ›´å¿«ï¼Œåˆ°çº³ç§’çº§åˆ«ã€‚\né«˜é¢‘äº¤æ˜“ä¸»è¦ä¾èµ–å¸‚åœºçš„ä»·æ ¼æ³¢åŠ¨è·åˆ©ã€‚é«˜é¢‘äº¤æ˜“ä»¥å¤–çš„ï¼Œå¤šä¾èµ–â€œè¶‹åŠ¿â€è·åˆ©ã€‚ä¾èµ–å¸‚åœºçš„æ³¢åŠ¨ï¼Œå°±å†³å®šäº†å…¶éœ€è¦ç¨‹åºåŒ–ã€‚","categories":["é‡åŒ–äº¤æ˜“"]},{"title":"å­˜å‚¨å¡ï¼ˆTFå¡æˆ–Micro SDå¡ï¼‰","url":"/æ ‡å‡†è§„æ ¼ç¬”è®°/å­˜å‚¨å¡ï¼ˆTFå¡æˆ–Micro SDå¡ï¼‰/","content":"# ç»“æ„\n![](../../images/å­˜å‚¨å¡ï¼ˆTFå¡æˆ–Micro%20SDå¡ï¼‰/image-20250221002138663.png)\nä¸»è¦ç”±ä¸»æ§å’ŒNANDé—ªå­˜é¢—ç²’ç»„æˆã€‚Micro SDå¡å¸¸ç”¨äºæ¸¸æˆæœºã€æ— äººæœºã€è¡Œè½¦è®°å½•ä»ªã€Switchç­‰ç´§å‡‘çš„ç”µå­è®¾å¤‡ä¸­ã€‚\n![](../../images/å­˜å‚¨å¡ï¼ˆTFå¡æˆ–Micro%20SDå¡ï¼‰/image-20250221003017314.png)\né™¤äº†å°å¡ï¼Œè¿˜æœ‰å¤§å·çš„æ ‡å‡†SDå¡ï¼Œå¸¸ç”¨äºæ•°ç ç›¸æœºã€å£°å¡ã€é‡‡é›†å¡ã€‚\n![](../../images/å­˜å‚¨å¡ï¼ˆTFå¡æˆ–Micro%20SDå¡ï¼‰/image-20250221003034976.png)\nMicro SDå¡å¯ä»¥é€šè¿‡å¡å¥—è½¬æ¥ä¸ºæ ‡å‡†SDå¡ã€‚\n![](../../images/å­˜å‚¨å¡ï¼ˆTFå¡æˆ–Micro%20SDå¡ï¼‰/image-20250221002721445.png)\nä½†æ˜¯ï¼š1ã€å½±å“æ•£çƒ­ï¼›2ã€å¯èƒ½ä¼šæ¥è§¦ä¸è‰¯ï¼Œè¾ƒä¸ç¨³å®šã€‚\n## è¡Œä¸šSDå¡\nå½±è§†è¡Œä¸šä¸­è§„æ ¼æ›´é«˜çš„å¡ï¼š\n![](../../images/å­˜å‚¨å¡ï¼ˆTFå¡æˆ–Micro%20SDå¡ï¼‰/image-20250221003110610.png)\n\n![](../../images/å­˜å‚¨å¡ï¼ˆTFå¡æˆ–Micro%20SDå¡ï¼‰/image-20250221003123308.png)\n\nCFe-Aå¡ä½¿ç”¨äº†PCIeæ€»çº¿ä½œä¸ºæ•°æ®ä¼ è¾“ï¼Œè¯»å†™é€Ÿåº¦å¾€å¾€å¯è¾¾700 MB/såˆ°800 MB/sã€‚\n![](../../images/å­˜å‚¨å¡ï¼ˆTFå¡æˆ–Micro%20SDå¡ï¼‰/image-20250221003416279.png)\n\nCFe-Aå¡ä¹Ÿå¯ä»¥é€šè¿‡å¡å¥—è½¬æ¥ä¸ºCFe-Bå¡ã€‚\n![](../../images/å­˜å‚¨å¡ï¼ˆTFå¡æˆ–Micro%20SDå¡ï¼‰/image-20250221003458137.png)\n\n# æ€§èƒ½æŒ‡æ ‡\nä¸»è¦çœ‹è¯»å†™é€Ÿåº¦ã€‚è¯»å†™é€Ÿåº¦åˆå¯åˆ†ä¸ºé¡ºåºè¯»å†™ã€éšæœºè¯»å†™ã€‚\né¡ºåºè¯»å†™å¸¸è§äºè§†é¢‘å½•åˆ¶ã€ç¼–è¾‘ï¼›éšæœºè¯»å†™å¸¸è§ç³»ç»Ÿå’Œè½¯ä»¶ï¼ˆå¦‚æ¸¸æˆï¼‰çš„è¿è¡Œè¿‡ç¨‹ã€‚\n## æœ€ä½é¡ºåºå†™å…¥é€Ÿåº¦\nå¾ˆå¤šå¡åœ¨ç›¸æœºå½•åˆ¶è¿‡ç¨‹ä¸­ä¼šä¸­æ–­ï¼Œè¿™æ—¶ä¸â€œæœ€ä½é¡ºåºå†™å…¥é€Ÿåº¦â€æœ‰å…³ã€‚å­˜å‚¨å¡çš„å„ä¸ªåä¼šå°†ä¹‹ä½œä¸ºå¸¦åœˆçš„æ•°å­—æ ‡è¯†åœ¨äº†å¡é¢ã€‚æœ‰Cç³»åˆ—ã€Uç³»åˆ—ã€Vç³»åˆ—ã€‚è¿˜æœ‰CFeå¡çš„VPGæ ‡è¯†ã€‚\n![](../../images/å­˜å‚¨å¡ï¼ˆTFå¡æˆ–Micro%20SDå¡ï¼‰/image-20250221004333952.png)\n![](../../images/å­˜å‚¨å¡ï¼ˆTFå¡æˆ–Micro%20SDå¡ï¼‰/image-20250221004455543.png)\n# å¡é¢æ ‡è¯†\n![](../../images/å­˜å‚¨å¡ï¼ˆTFå¡æˆ–Micro%20SDå¡ï¼‰/image-20250221003815716.png)\n\n![](../../images/å­˜å‚¨å¡ï¼ˆTFå¡æˆ–Micro%20SDå¡ï¼‰/image-20250221003823652.png)\n\nå¦‚æœå¡é¢ä¸Šåªæ ‡æ³¨äº†ä¸€ä¸ªæ•°æ®ï¼Œä¸€èˆ¬æŒ‡é¡ºåºè¯»å–é€Ÿåº¦ï¼Œå¤§æ¦‚ç‡æ˜¯ç†æƒ³çš„å³°å€¼é€Ÿåº¦ï¼Œå®é™…ä½¿ç”¨æ—¶éš¾ä»¥è¾¾åˆ°ã€‚\n![](../../images/å­˜å‚¨å¡ï¼ˆTFå¡æˆ–Micro%20SDå¡ï¼‰/image-20250221003848629.png)\n![](../../images/å­˜å‚¨å¡ï¼ˆTFå¡æˆ–Micro%20SDå¡ï¼‰/image-20250221004616029.png)\nå¤§å¤šæ•°æ¶ˆè´¹è€…åªéœ€è¦å…³æ³¨æ¥å£çš„è§„æ ¼å’Œåè®®èƒ½å¦å’Œè®¾å¤‡åŒ¹é…ã€‚\n![](../../images/å­˜å‚¨å¡ï¼ˆTFå¡æˆ–Micro%20SDå¡ï¼‰/image-20250221004801407.png)\nUHS-Iä¸€èˆ¬æ¯”UHS-IIæ…¢ã€‚å¦‚æœè®¾å¤‡åªæ”¯æŒUHS-Içš„å¡æ§½ï¼Œåˆ™ä½¿ç”¨UHS-IIçš„å¡ä¼šé™åˆ¶å…¶å‘æŒ¥ã€‚\n## A1å’ŒA2çš„åŒºåˆ«\nå­˜å‚¨å¡çš„A1ï¼ˆApp Performance A1ï¼‰å’ŒA2ï¼ˆApp Performance A2ï¼‰æ˜¯SDå¡åä¼šåˆ¶å®šçš„**åº”ç”¨æ€§èƒ½ç­‰çº§æ ‡å‡†**ï¼Œä¸»è¦é’ˆå¯¹åœ¨ç§»åŠ¨è®¾å¤‡ï¼ˆå¦‚æ™ºèƒ½æ‰‹æœºã€å¹³æ¿ç”µè„‘ï¼‰ä¸Šè¿è¡Œåº”ç”¨ç¨‹åºæ—¶çš„æ€§èƒ½éœ€æ±‚ã€‚ä¸¤è€…çš„æ ¸å¿ƒåŒºåˆ«åœ¨äº**éšæœºè¯»å†™é€Ÿåº¦**å’Œ**æ€§èƒ½ä¼˜åŒ–**ã€‚\n![](../../images/å­˜å‚¨å¡ï¼ˆTFå¡æˆ–Micro%20SDå¡ï¼‰/image-20250221010103228.png)\n# è¯»å¡å™¨\nä¸€èˆ¬åªæœ‰æ­é…å®˜æ–¹çš„è¯»å¡å™¨æ‰èƒ½è¾¾åˆ°é¢„æœŸé€Ÿåº¦ï¼Œä½¿ç”¨ç›¸æœºã€ç¬¬ä¸‰æ–¹è¯»å¡å™¨ä¼šå¯¼è‡´é€Ÿåº¦åä½ã€‚\n![](../../images/å­˜å‚¨å¡ï¼ˆTFå¡æˆ–Micro%20SDå¡ï¼‰/image-20250221004006007.png)\n\n# æµ‹é€Ÿ\nå¤šç”¨CDMè½¯ä»¶æµ‹é€Ÿã€‚\n# å®‰å…¨æ€§\næœ€å¥½åœ¨äº§å“è¯¦æƒ…ä¸­å…³æ³¨å…¶å·¥ä½œç¯å¢ƒé™åˆ¶ã€‚\n![](../../images/å­˜å‚¨å¡ï¼ˆTFå¡æˆ–Micro%20SDå¡ï¼‰/image-20250221005056093.png)\n\n","categories":["æ ‡å‡†è§„æ ¼"]},{"title":"ç”µå½±å…æ”¾æ˜ æŠ€æœ¯è§„æ ¼","url":"/æ ‡å‡†è§„æ ¼ç¬”è®°/ç”µå½±å…æ”¾æ˜ æŠ€æœ¯è§„æ ¼/","content":"# å¯¹æ¯”å›¾\n![](../../images/ç”µå½±å…æ”¾æ˜ æŠ€æœ¯è§„æ ¼/image-20250221160754091.png)\nã€å…¨çƒ IMAX åŠå…¶ä»–å½±å…æ•°æ®ã€‘é“¾æ¥ï¼šhttps://docs.qq.com/sheet/DQ3FEUUZJdklNSWJP?tab=240rc1\n# æ€»ç»“\nä¼˜é€‰IMAX GTï¼ˆä¸­å›½åªæœ‰åŒ—äº¬ç”µå½±åšç‰©é¦†ä¸€å®¶å•†ä¸šå¼€æ”¾çš„ï¼‰ã€‚\næ¬¡é€‰CINITYã€æœæ¯”å½±é™¢ã€‚\næ¬¡ä¹‹IMAX CoLaï¼ˆCommercial Laserï¼‰ã€ä¸­å›½å·¨å¹•CGSã€‚\nIMAX XTè™½ç„¶æ˜¯æ¿€å…‰ä½†æ˜¯å‡é…ã€‚\næ²¡æœ‰æ ‡æ³¨æ¿€å…‰çš„æ™®é€šIMAXå°±æ˜¯æ•°å­—IMAX Xenonï¼ˆæ°™ç¯ï¼‰ã€‚","categories":["æ ‡å‡†è§„æ ¼"]},{"title":"ç®—æ³•_å›æº¯","url":"/ç®—æ³•/ç®—æ³•_å›æº¯/","content":"# å†…å®¹\n1. å­é›†æ ‘\n2. æ’åˆ—æ ‘\n# ç”Ÿæˆå­é›†æ ‘\nå­é›†æ ‘å¯ä»¥ç”¨æ¥è§£å†³ä»é›†åˆä¸­æŒ‘é€‰ä¸€äº›å…ƒç´ ä»¥è¾¾åˆ°ä¸€å®šæ¡ä»¶çš„é—®é¢˜ã€‚\n```cpp\nvoid func(int arr[], int length, int x[])\n{\n    if (i == length)\n    {\n        for (int j = 0; j < length; ++j)\n        {\n            if (x[j] == 1)\n            {\n                std::cout << arr[j] << \" \";\n            }\n        }\n        std::cout << std::endl;\n    }\n    else\n    {\n        x[i] = 1;\n        func(arr, i + 1, length, x);\n        x[i] = 0;\n        func(arr, i + 1, length, x);\n    }\n}\n```\nå¦ä¸€ç§å½¢å¼ï¼š\n```cpp\nvoid func(int arr[], int i, int length, int x[])\n{\n    if (i == length)\n    {\n        for (int j = 0; j < length; ++j)\n        {\n            if (x[j] == 1)\n            {\n                std::cout << arr[j] << \" \";\n            }\n        }\n        std::cout << std::endl;\n    }\n    else\n    {\n        // another form\n        for (int k = 1; k >= 0; --k)\n        {\n            x[i] = k;\n            func(arr, i + 1, length, x);\n        }\n    }\n}\n```\nä½†æ˜¯è¿™ä¸€ç§å½¢å¼ä¸å¤ªåˆ©äºç›´æ¥æ·»åŠ å‰ªæ”¯æ“ä½œã€‚\n![](../../images/ç®—æ³•_å›æº¯/image-20241126164920385.png)\n# é€‰æ•°å­—ï¼Œè¾¾åˆ°ç»™å®šå’Œ\nå‰ªå·¦æ”¯çš„æ¡ä»¶ï¼šé€‰æ‹©ç¬¬`i`æ•°æ—¶ï¼Œå½“å‰ç´¯è®¡å’Œå·²ç»è¶…è¿‡äº†`given_sum`ï¼Œåˆ™æ²¡å¿…è¦å†å¾€ä¸‹è¿›è¡Œã€‚\nå‰ªå³æ”¯çš„æ¡ä»¶ï¼šé€‰æ‹©ç¬¬`i`æ•°æ—¶ï¼Œå‰©ä¸‹çš„`i + 1`åˆ°`n`çš„ç´¯è®¡å’Œï¼ˆå³å‰©ä½™æœªå¤„ç†çš„æ•°çš„å’Œï¼Œæ³¨æ„ï¼Œä¸æ˜¯â€æœªé€‰æ‹©â€œï¼Œè€Œæ˜¯â€æœªå¤„ç†â€œï¼Œâ€å¤„ç†â€œæ˜¯å±‚çº§åˆ«çš„æ¦‚å¿µï¼Œâ€é€‰æ‹©â€œæ˜¯å·¦å³å­æ ‘æ¦‚å¿µï¼‰`rest`åŠ ä¸Šå½“å‰ç´¯è®¡å’Œä¸å¤Ÿ`given_sum`ï¼Œåˆ™æ²¡å¿…è¦å¾€ä¸‹è¿›è¡Œã€‚\n```cpp\n// æŒ‘é€‰æ•°å­—ï¼šæœ‰ä¸€ç»„æ•´æ•°ï¼Œè¯·æŒ‘é€‰å‡ºä¸€ç»„æ•°å­—ï¼Œä½¿å®ƒä»¬çš„å’Œç­‰äºæŒ‡å®šçš„å€¼\n#include<iostream>\n#include<vector>\nint arr[] = { 4,8,12,16,7,9,3 };\nint given_sum = 18;\nint res = 0;\nstd::vector<int> aux;\nbool func(int* arr, int i, int length)\n{\n    bool have = false;\n\n    if (i == length)\n    {\n        if(res == given_sum)\n        {\n            for (int v : aux)\n            {\n                std::cout << v << \" \";\n            }\n            std::cout << std::endl;\n            have = true;\n        }\n    }\n    else\n    {\n        if (res + arr[i] <= given_sum)\n        {\n            res += arr[i];\n            aux.push_back(arr[i]);\n            return func(arr, i + 1, length);\n\n            res -= arr[i];\n            aux.pop_back();\n        }\n        int rest = 0;\n        for (int j = i + 1; j < length; ++j)\n        {\n            rest += arr[j];\n        }\n        if (res + rest >= given_sum)\n        {\n            return func(arr, i + 1, length);\n        }\n    }\n    return have;\n}\nint main()\n{\n    bool have = func(arr, 0, sizeof(arr) / sizeof(arr[0]));\n    if (!have)\n    {\n        std::cout << \"have not resolution.\" << std::endl;\n    }\n}\n```\næ›´å¥½çš„å†™æ³•ï¼šåœ¨mainå‡½æ•°ä¸­å…ˆç»™å‡ºrestçš„æ€»å€¼ã€‚åœ¨å¤„ç†ç¬¬`i + 1`å±‚å‰ï¼Œå‡å»ç¬¬`i`ä¸ªæ•°ã€‚å¤„ç†å®Œç¬¬`i + 1`å±‚åï¼Œå³å¼€å§‹å›æº¯åˆ°`i`ï¼Œåˆ™`i`å±‚åˆæ´»äº†ï¼Œéœ€è¦åŠ å›ç¬¬`i`ä¸ªæ•°ã€‚\nè¿™æ ·çš„å†™æ³•ï¼Œå¯ä»¥é¿å…æ¯æ¬¡è®¡ç®—å‰ªå³æ”¯æ¡ä»¶éƒ½è¦èµ°ä¸€éå¾ªç¯è®¡ç®—å‰©ä½™æ•°å­—ï¼ˆ`i + 1`åˆ°`n`ï¼‰çš„å’Œï¼Œè€Œæ›¿æ¢æˆæ¯æ¬¡åªéœ€ç®€å•åœ°å‡ã€åŠ ä¸€ä¸ª`arr[i]`ã€‚\n```cpp\n// æŒ‘é€‰æ•°å­—ï¼šæœ‰ä¸€ç»„æ•´æ•°ï¼Œè¯·æŒ‘é€‰å‡ºä¸€ç»„æ•°å­—ï¼Œä½¿å®ƒä»¬çš„å’Œç­‰äºæŒ‡å®šçš„å€¼\n#include<iostream>\n#include<vector>\nint arr[] = { 4,8,12,16,7,9,3 };\nint given_sum = 18;\nint res = 0;\nint rest = 0;\n\nstd::vector<int> aux;\nbool func(int* arr, int i, int length)\n{\n    bool have = false;\n\n    if (i == length)\n    {\n        if(res == given_sum)\n        {\n            for (int v : aux)\n            {\n                std::cout << v << \" \";\n            }\n            std::cout << std::endl;\n            have = true;\n        }\n    }\n    else\n    {\n        rest -= arr[i];\n        if (res + arr[i] <= given_sum)\n        {\n            res += arr[i];\n            aux.push_back(arr[i]);\n            return func(arr, i + 1, length);\n\n            res -= arr[i];\n            aux.pop_back();\n        }\n        \n        if (res + rest >= given_sum)\n        {\n            return func(arr, i + 1, length);\n        }\n        rest += arr[i];\n    }\n    return have;\n}\nint main()\n{\n    for (int v : arr)\n    {\n        rest += v;\n    }\n\n\n    bool have = func(arr, 0, sizeof(arr) / sizeof(arr[0]));\n    if (!have)\n    {\n        std::cout << \"have not resolution.\" << std::endl;\n    }\n}\n```\nåŒæ—¶è¿˜éœ€è¦æ³¨æ„ï¼Œæœªå¤„ç†å’Œæœªé€‰æ‹©çš„æ¦‚å¿µä¸è¦æ··æ·†ï¼Œæˆ‘ç¬¬ä¸€æ¬¡å†™æˆäº†å¦‚ä¸‹å½¢å¼ï¼šè¿™æ˜¯é”™è¯¯çš„ã€‚\n```cpp\n    // ...\n    else\n    {\n        if (res + arr[i] <= given_sum)\n        {\n            res += arr[i];\n            rest -= arr[i];   // é€‰æ‹©\n            aux.push_back(arr[i]);\n            return func(arr, i + 1, length);\n\n            res -= arr[i];\n            rest += arr[i];   // æœªé€‰æ‹©\n            aux.pop_back();\n        }\n        \n        if (res + rest >= given_sum)\n        {\n            return func(arr, i + 1, length);\n        }\n    }\n    return have;\n}\nint main()\n{\n    for (int v : arr)\n    {\n        rest += v;\n    }\n    // ...\n}\n```\nè¿™ä¸ä¸Šé¢çš„å«ä¹‰å®Œå…¨ä¸ä¸€æ ·ã€‚æˆ‘ä»¬è¦åšçš„æ˜¯â€å¤„ç†â€œã€â€æœªå¤„ç†â€œæ—¶ï¼Œrestå˜é‡çš„å˜åŒ–ã€‚è€Œä¸æ˜¯â€é€‰æ‹©â€œã€â€æœªé€‰æ‹©â€œæ—¶ï¼Œrestå˜é‡çš„å˜åŒ–ã€‚â€å¤„ç†â€œæ˜¯å±‚çº§åˆ«çš„æ¦‚å¿µï¼Œâ€é€‰æ‹©â€œæ˜¯å·¦å³å­æ ‘æ¦‚å¿µã€‚\nå³ï¼Œä¸ç®¡é€‰ä¸é€‰ï¼Œèµ°ä¸èµ°å·¦å³å­æ ‘ï¼Œrestéƒ½è¦åœ¨ä¹‹å‰å‡å»`arr[i]`ï¼›ä¸ç®¡é€‰ä¸é€‰ï¼Œèµ°ä¸èµ°å·¦å³å­æ ‘ï¼Œä¹‹årestéƒ½è¦åŠ ä¸Š`arr[i]`ã€‚\n## å¤šå‰å­é›†æ ‘-æ›´é«˜æ•ˆ\nä»¥ä¸‹ç¨‹åºç”Ÿæˆçš„æ˜¯å¦‚ä¸‹å›¾çš„å­é›†æ ‘ï¼š\n![](../../images/ç®—æ³•_å›æº¯/image-20241126164737080.png)\n\n```cpp\n#include<iostream>\n#include<vector>\nint arr[] = { 4,8,12,16,7,9,3 };\nint given_sum = 18;\nint res = 0;\nint rest = 0;\n\nstd::vector<int> aux;\nvoid func(int i, int length, int number)\n{\n    if (number == 0)\n    {\n        for (int v : aux)\n        {\n            std::cout << v << \" \";\n        }\n        std::cout << std::endl;\n    }\n    else\n    {\n        // ä»¥å±‚çš„è§†è§’çœ‹ï¼Œç”Ÿæˆ(k, k+1, ..., n)å­æ ‘å¹¶éå†ã€‚\n        for (int k = i; k < length; ++k)\n        {\n            if (number >= arr[k]) // æ¥ä¸‹æ¥çš„kå…ƒç´ ä¸èƒ½å¤§äºnumber\n            {\n                aux.push_back(arr[k]);\n                // é€‰æ‹© k + 1ï¼Œåˆ™å‘æ·±åº¦éå†ï¼Œnumberæ¡ä»¶æ”¹å˜\n                func(k + 1, length, number - arr[k]);\n\n                // ä¸é€‰æ‹© k + 1ï¼Œåˆ™å›æº¯åˆ°ä¸Šä¸€å±‚ï¼Œnumberæ¡ä»¶ä¸æ”¹å˜\n                aux.pop_back();\n            }\n        }\n    }\n}\nint main()\n{\n    func(0, 7, given_sum);\n    return 0;\n}\n```\nè¾“å‡ºï¼š8 7 3\n## å˜ç§ï¼šå¯ä»¥é‡å¤é€‰æ‹©å…ƒç´ \n```cpp\n    // ...\n    else\n    {\n        // ä»¥å±‚çš„è§†è§’çœ‹ï¼Œç”Ÿæˆ(k, k+1, ..., n)å­æ ‘å¹¶éå†ã€‚\n        for (int k = i; k < length; ++k)\n        {\n            if (number >= arr[k]) // æ¥ä¸‹æ¥çš„kå…ƒç´ ä¸èƒ½å¤§äºnumber\n            {\n                aux.push_back(arr[k]);\n                // æ›´æ”¹ï¼š\n                // é€‰æ‹© kï¼Œåˆ™å‘æ·±åº¦éå†ï¼Œnumberæ¡ä»¶æ”¹å˜\n                func(k, length, number - arr[k]);\n\n                // ä¸é€‰æ‹© kï¼Œåˆ™å›æº¯åˆ°ä¸Šä¸€å±‚ï¼Œnumberæ¡ä»¶ä¸æ”¹å˜\n                aux.pop_back();\n            }\n        }\n    }\n}\nint main()\n{\n    func(0, 7, given_sum);\n    return 0;\n}\n```\nè¾“å‡º\n```\n4 4 4 3 3\n4 4 7 3\n4 8 3 3\n4 7 7\n8 7 3\n12 3 3\n9 9\n9 3 3 3\n3 3 3 3 3 3\n```\n# æ’åˆ—æ ‘\nåºåˆ—æœ‰ä¸åŒçš„æ’åˆ—æ–¹å¼ï¼Œæ±‚è§£åŸå§‹åºåˆ—çš„æŸä¸€ç§ç‰¹å®šçš„æ’åˆ—æ–¹å¼ä»¥è¾¾åˆ°ä¸€å®šæ¡ä»¶çš„é—®é¢˜ã€‚\n\næ’åˆ—é—®é¢˜å¯ä»¥è¡¨ç¤ºä¸ºä»¥ä¸‹å½¢å¼ï¼š\nè®¾$R=\\{ r_1, r_2, r_3, \\cdots, r_n \\}$æ˜¯è¦è¿›è¡Œæ’åˆ—çš„$n$ä¸ªå…ƒç´ ï¼Œ$R_i=R-\\{r_i\\}$ã€‚\né›†åˆ$X$ä¸­å…ƒç´ çš„å…¨æ’åˆ—è®°ä¸º$perm(X)$ã€‚$(r_i)perm(X)$è¡¨ç¤ºåœ¨å…¨æ’åˆ—$perm(X)$çš„æ¯ä¸€ä¸ªæ’åˆ—å‰åŠ ä¸Šå‰ç¼€$r_i$å¾—åˆ°çš„æ’åˆ—ã€‚\n$R$çš„å…¨æ’åˆ—å¯å½’çº³å®šä¹‰å¦‚ä¸‹ï¼š\n- å½“$n=1$æ—¶ï¼Œ$perm(R)=(r)$ï¼Œå…¶ä¸­$r$æ˜¯é›†åˆ$R$ä¸­å”¯ä¸€çš„å…ƒç´ \n- å½“$n>1$æ—¶ï¼Œ$perm(R)$ç”±$(r_1)perm(R_1),(r_2)perm(R_2),\\cdots,(r_n)perm(R_n)$æ„æˆã€‚ï¼ˆ$R_i=R-\\{r_i\\}$ï¼‰\n\næ¯”å¦‚ï¼š$R=\\{1,2,3\\}$ï¼Œåˆ™$perm(R)$ç”±$(1)perm(\\{2,3\\}),(2)perm(\\{1,3\\}),(3)perm(\\{1,2\\})$æ„æˆã€‚\n\nåœ¨ç¬¬iå±‚è§†è§’ä¸Šï¼Œé›†åˆå†…æ¯ä¸ªå…ƒç´ éƒ½ä¾æ¬¡ä¸ç¬¬iä¸ªä½ç½®è¿›è¡Œäº¤æ¢ã€‚å¦‚ä¸‹å›¾ï¼šå…ƒç´ 1åˆ°äº†ç¬¬1çš„ä½ç½®ï¼Œåˆ™å‡ºç°ï¼š`(1)R{2,3}`ï¼Œå…ƒç´ 2åˆ°äº†ç¬¬1çš„ä½ç½®ï¼Œåˆ™å‡ºç°ï¼š`(2)R{1,3}`ï¼Œå…ƒç´ 3åˆ°äº†ç¬¬1çš„ä½ç½®ï¼Œåˆ™å‡ºç°ï¼š`(3)R{1,2}`ã€‚\n\n![](../../images/ç®—æ³•_å›æº¯/image-20241128231648914.png)\n\näºæ˜¯ï¼Œåœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å†™å‡ºforå¾ªç¯çš„æ¡ä»¶ï¼šç¬¬iå±‚æ—¶ï¼Œï¼ˆä»¥ä¸‹è¡¨è¿°å‡å¯¹åº”å®é™…å…ƒç´ æ•°ç»„çš„ä¸‹æ ‡ï¼Œä¾‹å¦‚ï¼šç¬¬0å±‚ï¼Œå¯¹åº”ç¬¬1ä¸ªå…ƒç´ çš„ä½ç½®ï¼Œä¸‹æ ‡ä¸º0ï¼‰ï¼Œå°±è¦æŠŠä»`k`ï¼ˆç”¨`k`ä½œä¸º`i`çš„å‰¯æœ¬ï¼‰åˆ°`n-1`çš„å…ƒç´ å¾ªç¯ä¸ç¬¬`i`ä¸ªä½ç½®è¿›è¡Œäº¤æ¢ã€‚\n\näº¤æ¢åå†æ¬¡è¿›è¡Œpermè®¡ç®—ï¼Œä¸‹ä¸€æ¬¡çš„`i`æ›´æ–°ä¸º`i+1`ã€‚\n\nä»å±‚æ¬¡è§†è§’çœ‹ï¼Œæœ¬å±‚çš„`perm`è°ƒç”¨ç»“æŸåï¼Œä¸è¦å¿˜è®°æŠŠçŠ¶æ€å›é€€ï¼Œå³ç¬¬`k`ä¸ªå…ƒç´ æ¢å›`i`ä½ç½®ã€‚\n\nå½“åˆ°è¾¾ç¬¬`n`å±‚ï¼Œè¾¾åˆ°é€’å½’ç»ˆæ­¢æ¡ä»¶ï¼Œè¿™æ—¶`arr`æ•°ç»„ä¸­è®°å½•çš„å„ä¸ªå…ƒç´ çš„ä½ç½®å³ä¸ºæ­¤æ—¶åºåˆ—çš„æŸç§å…¨æ’åˆ—ã€‚ç›´æ¥å…¨éƒ¨è¾“å‡ºå³å¯ã€‚\n```cpp\n#include<iostream>\nvoid swap(int* arr, int i, int j)\n{\n    int tmp = arr[i];\n    arr[i] = arr[j];\n    arr[j] = tmp;\n}\nvoid func(int* arr, int i, int length)\n{\n    if (i == length)\n    {\n        for (int j = 0; j < length; ++j)\n        {\n            std::cout << arr[j] << \" \";\n        }\n        std::cout << std::endl;\n    }\n    else\n    {\n        // ç”Ÿæˆå­æ ‘ï¼Œéå†å­©å­èŠ‚ç‚¹\n        for (int k = i; k < length; ++k)\n        {\n            // ä» i åˆ° nï¼Œæ¯æ¬¡arræ•°ç»„å…ƒç´ çš„è¯¥ä½ç½® éƒ½ä¸ k ä½ç½®äº¤æ¢ä¸€ä¸‹\n            swap(arr, i, k);\n            // æ³¨æ„æ­¤å¤„å¾ˆé‡è¦ï¼Œä¸å†æ˜¯k + 1ï¼Œè€Œæ˜¯i + 1ã€‚\n            // å¦‚æœæˆ‘ä»¬ææˆäº†k + 1ï¼Œåˆ™å˜æˆäº†ä¸Šé¢çš„å¤šå‰å­é›†æ ‘ï¼ˆé€‰æ•°å­—é—®é¢˜ï¼‰ã€‚\n            // å› ä¸ºç»™å‡ºäº†i+1ï¼Œforå¾ªç¯ä¸­kåœ¨å˜ï¼Œiæ˜¯ä¸å˜çš„ï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½ä¼šæ˜¯ç›¸åŒæ•°ä¸ªå…ƒç´ è¿›è¡Œéå†ã€‚\n            // å› æ­¤æ‰èƒ½å‡ºç°æ’åˆ—æ–¹å¼ä¸åŒçš„å…¨é›†ï¼ˆå³å…¨æ’åˆ—ï¼‰ã€‚\n            func(arr, i + 1, length);\n            swap(arr, i, k);\n        }\n    }\n}\nint main()\n{\n    int arr[] = { 1, 2, 3, 4 };\n    const int length = sizeof(arr) / sizeof(arr[0]);\n    func(arr, 0, length);\n}\n```\nè¾“å‡º\n```\n1 2 3 4\n1 2 4 3\n1 3 2 4\n1 3 4 2\n1 4 3 2\n1 4 2 3\n2 1 3 4\n2 1 4 3\n2 3 1 4\n2 3 4 1\n2 4 3 1\n2 4 1 3\n3 2 1 4\n3 2 4 1\n3 1 2 4\n3 1 4 2\n3 4 1 2\n3 4 2 1\n4 2 3 1\n4 2 1 3\n4 3 2 1\n4 3 1 2\n4 1 3 2\n4 1 2 3\n\n```\n# nçš‡åé—®é¢˜ï¼ˆnåã€å…«çš‡åï¼‰\nåœ¨$n\\times n$æ ¼çš„å›½é™…è±¡æ£‹æ£‹ç›˜ä¸Šæ”¾ç½®å½¼æ­¤ä¸å—æ”»å‡»çš„$n$ä¸ªçš‡åã€‚çš‡åå¯ä»¥æ”»å‡»åŒä¸€è¡Œã€åŒä¸€åˆ—æˆ–åŒä¸€æ–œçº¿ä¸Šçš„æ£‹å­ã€‚\n\n## éé€’å½’\n```cpp\nvoid NiceBackTrack()\n{\n    x[1] = 0;\n    int k = 1;\n    while (k >= 1)\n    {\n        x[k] += 1;\n        while ((x[k]) <= n) && !Place(k))\n        {\n            x[k] += 1;\n        }\n        if (x[k] <= n)\n        {\n            if (k == n)\n            {\n                sum += 1;\n                PrintQ();\n            }\n            else\n            {\n                k += 1;\n                x[k] = 0;\n            }\n        }\n        else\n        {\n            --k;\n        }\n    }\n}\n```","categories":["ç®—æ³•","å›æº¯"]},{"title":"ç½‘ç»œ_è‡ªå»ºè¿œç¨‹æ¡Œé¢æœåŠ¡å™¨","url":"/ç½‘ç»œ/ç½‘ç»œ_è‡ªå»ºè¿œç¨‹æ¡Œé¢æœåŠ¡å™¨/","content":"# äº‘æœåŠ¡å™¨é€‰è´­\né˜¿é‡Œäº‘2C2G3Mï¼ˆ2 CPUã€2G RAMã€3Må›ºå®šå¸¦å®½ï¼ˆæ— é™æµé‡ï¼‰ï¼‰ï¼Œ1å¹´99å…ƒã€‚é€‰åŒ—äº¬åœ°åŒºçš„ï¼Œåœ¨å›½å†…å»¶è¿Ÿå¯èƒ½ä½ä¸€äº›ã€‚\n# è½¯ä»¶é€‰æ‹©\nè¿œç¨‹æ¡Œé¢è½¯ä»¶é€‰æ‹©RustDeskï¼Œå¼€æºçš„ã€‚\nserverç«¯ï¼š\nhttps://github.com/rustdesk/rustdesk-server/releases\nclientç«¯ï¼š\nhttps://github.com/rustdesk/rustdesk/releases\n# RustDeskä¸‹è½½\næ ¹æ®[RustDeskå®˜æ–¹æ–‡æ¡£](https://rustdesk.com/docs/en/self-host/rustdesk-server-oss/install/)ã€‚\næœåŠ¡ç«¯çš„æ–‡ä»¶æœ‰ï¼šä¸¤ä¸ªå¯æ‰§è¡Œæ–‡ä»¶å’Œä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚\n\n- `hbbs`Â - RustDesk ID/Rendezvous server\n- `hbbr`Â - RustDesk Relay server\n\nä¸€èˆ¬ï¼Œä¸‹è½½è¿™ä¸ªï¼š\nhttps://github.com/rustdesk/rustdesk-server/releases/download/1.1.12/rustdesk-server-linux-amd64.zip\n\nä½¿ç”¨`wget + url`å‘½ä»¤å³å¯ä¸‹è½½ã€‚\n\n# ä»£ç†\n\nLinuxæœåŠ¡å™¨è¦ä¸‹è½½å¥½å¤šå¼€æºé¡¹ç›®æˆ–è€…å›½é™…è½¯ä»¶ã€‚å¾€å¾€éœ€è¦ä»£ç†ç½‘ç»œã€‚\n\näº‘æœåŠ¡å™¨åªæœ‰Linuxå‘½ä»¤è¡Œï¼Œå› æ­¤éœ€è¦ä¸‹è½½mihomoé¡¹ç›®ï¼ˆClash Metaï¼‰æ¥ç”¨å‘½ä»¤è¡Œé…ç½®ã€‚\nhttps://github.com/MetaCubeX/mihomo/releases\nä¸‹è½½å…¶ä¸­çš„ï¼š\nhttps://github.com/MetaCubeX/mihomo/releases/download/v1.18.10/mihomo-linux-amd64-v1.18.10.deb\næ˜¯debæ ¼å¼çš„å®‰è£…åŒ…ã€‚å¯ä»¥ä½¿ç”¨`apt install + æ–‡ä»¶å`å®‰è£…è¿™ç§ç¦»çº¿å®‰è£…åŒ…ã€‚\n\nå®‰è£…åï¼Œå¯ä»¥é€šè¿‡`find / -name mihomo`æ¥æŸ¥æ‰¾æœåŠ¡å™¨ä¸Šåå­—åŒ…å«mihomoçš„æ–‡ä»¶åœ¨å“ªé‡Œã€‚\n```\n/root/.config/mihomo\n/etc/mihomo\n/usr/share/licenses/mihomo\n/usr/bin/mihomo\n```\n\n`/root/.config/mihomo/`æ˜¯mihomoçš„é…ç½®æ–‡ä»¶ç›®å½•ã€‚\næœ‰ä»¥ä¸‹å†…å®¹ï¼š\n`config.yaml   geoip.metadb`\n\n`/etc/mihomo/`ä¹Ÿæ˜¯mihomoçš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ç›®å½•ï¼Œä½†æ˜¯è²Œä¼¼ä¼˜å…ˆç”¨çš„æ˜¯rootçš„ï¼ˆå³å½“å‰ç”¨æˆ·çš„é…ç½®ä¼˜äºetcç›®å½•ä¸‹çš„å…¨å±€é…ç½®ï¼‰\n\n## å®ˆæŠ¤è¿›ç¨‹\nå®‰è£…åï¼Œéœ€è¦æŠŠmihomoä½œä¸ºä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹è·‘åœ¨æœåŠ¡å™¨ä¸Šã€‚\nå‚è€ƒæ–‡æ¡£ï¼š\nhttps://wiki.metacubex.one/en/startup/service/\nå¦‚ä¸‹åˆ›å»ºç³»ç»Ÿé…ç½®æ–‡ä»¶Â `/etc/systemd/system/mihomo.service`\n```\n[Unit]\nDescription=mihomo Daemon, Another Clash Kernel.\nAfter=network.target NetworkManager.service systemd-networkd.service iwd.service\n\n[Service]\nType=simple\nLimitNPROC=500\nLimitNOFILE=1000000\nCapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_RAW CAP_NET_BIND_SERVICE CAP_SYS_TIME CAP_SYS_PTRACE CAP_DAC_READ_SEARCH CAP_DAC_OVERRIDE\nAmbientCapabilities=CAP_NET_ADMIN CAP_NET_RAW CAP_NET_BIND_SERVICE CAP_SYS_TIME CAP_SYS_PTRACE CAP_DAC_READ_SEARCH CAP_DAC_OVERRIDE\nRestart=always\nExecStartPre=/usr/bin/sleep 1s\nExecStart=/usr/local/bin/mihomo -d /etc/mihomo\nExecReload=/bin/kill -HUP $MAINPID\n\n[Install]\nWantedBy=multi-user.target\n```\n\nä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é‡æ–°åŠ è½½ systemdï¼š\n`systemctl daemon-reload`\nå¯ç”¨MihomoæœåŠ¡ï¼š\n`systemctl enable mihomo`\nä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç«‹å³å¯åŠ¨ Mihomoï¼š\n`systemctl start mihomo`\nä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é‡æ–°åŠ è½½ Mihomoï¼š\n`systemctl reload mihomo`\nä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ Mihomo çš„çŠ¶æ€ï¼š\n`systemctl status mihomo`\nä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹Mihomoçš„è¿è¡Œæ—¥å¿—ï¼š\n`journalctl -u mihomo -o cat -e`æˆ–è€…`journalctl -u mihomo -o cat -f`\n## é…ç½®æ–‡ä»¶\n`wget + ä»£ç†æœåŠ¡å•†çš„clashè®¢é˜…é“¾æ¥`ä¸‹è½½`config.yaml`åˆ°LinuxæœåŠ¡å™¨ä¸Šã€‚ç„¶åæŠŠ`config.yaml`æ‹·è´åˆ°mihomoé…ç½®ç›®å½•ä¸‹ã€‚\nå¦‚æœé…ç½®ç›®å½•ä¸å¯¹åŠ²ï¼Œå¯ä»¥é€šè¿‡`mihomo -d [é…ç½®ç›®å½•]`æŒ‡å®šã€è‡ªå®šä¹‰ã€‚\n## ç»ˆç«¯è‡ªåŠ¨ä»£ç†\néœ€è¦é…ç½®`/etc/profile`ã€‚\nåœ¨å†…å®¹ä¸­åŠ å…¥ï¼š\n```bash\nexport http_proxy=127.0.0.1:7890\nexport https_proxy=127.0.0.1:7890\nexport all_proxy=127.0.0.1:7890\n```\n## æµ‹è¯•è¿é€š\n`curl www.google.com`ï¼Œå¦‚æœè¾“å‡ºäº†å†…å®¹ï¼Œåˆ™å¯ä»¥äº†ã€‚\n## UIæ§åˆ¶\nå¯ä»¥é…ç½®`config.yaml`ä¸­çš„ï¼š\n```yaml\nexternal-controller: '0.0.0.0:9090'\n# RESTful API çš„å£ä»¤\nsecret: 'YourPassword'\n\n# æ‚¨å¯ä»¥å°†é™æ€ç½‘é¡µèµ„æºï¼ˆå¦‚ clash-dashboardï¼‰æ”¾ç½®åœ¨ä¸€ä¸ªç›®å½•ä¸­ï¼Œclash å°†ä¼šæœåŠ¡äº `RESTful API/ui`\n# å‚æ•°åº”å¡«å†™é…ç½®ç›®å½•çš„ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„ã€‚\nexternal-ui: ./public\n```\nå¦‚æœè¦ç»‘å®šåˆ°å…¬ç½‘IPï¼Œéœ€è¦æŠŠé»˜è®¤çš„`127.0.0.1`æ”¹ä¸º`0.0.0.0`ã€‚\nå¦‚æœå¯¹å¤–ç½‘å¼€æ”¾ï¼Œå¼ºçƒˆå»ºè®®éœ€è¦secreté‰´æƒã€‚\næˆ‘ä»¬è¿˜éœ€è¦æä¾›ä¸€ä¸ªUIçš„webç›®å½•ã€‚\nä»¥é€‰ç”¨yacdä¸ºä¾‹ã€‚\nhttps://github.com/haishanh/yacd/releases\nä¸‹è½½`yacd.tar.xz`ã€‚è§£å‹æ“ä½œç•¥ã€‚\nç„¶åæˆ‘ä»¬åœ¨é…ç½®ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªpublicï¼Œåœ¨publicé‡Œåˆ›å»ºyacdã€‚æŠŠå†…å®¹ç§»åŠ¨åˆ°yacdä¸‹é¢ã€‚\nç„¶åï¼Œå°±å¯ä»¥é€šè¿‡`http://YourIP:9090/ui/yacd/?hostname=YourIP&port=9090&secret=YourSecret`è¿›å…¥UIç•Œé¢äº†ã€‚\n# Node.jså®‰è£…\n\nhttps://pm2.keymetrics.io/docs/usage/quick-start/\n\nrustdeskå®˜æ–¹å»ºè®®æˆ‘ä»¬ä½¿ç”¨pm2ç®¡ç†æœåŠ¡ã€‚\n\nè€Œpm2éœ€è¦npmå®‰è£…ï¼Œå³éœ€è¦å®‰è£…`Node.js`ã€‚\nNode.jsçš„å®‰è£…åˆéœ€è¦ç”¨åˆ°NVMã€‚\næ ¹æ®ï¼š\nhttps://nodejs.org/en/download/package-manager\n\n```bash\n# installs nvm (Node Version Manager)\ncurl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.0/install.sh | bash\n# download and install Node.js (you may need to restart the terminal)\nnvm install 22\n# verifies the right Node.js version is in the environment\nnode -v # should print `v22.11.0`\n# verifies the right npm version is in the environment\nnpm -v # should print `10.9.0`\n```\n## sudo npm installå‘½ä»¤æ— æ•ˆ\nä½†æ˜¯æˆ‘ä»¬ä¹‹åå‘ç°pm2çš„å®‰è£…éœ€è¦`sudo npm install`æƒé™ã€‚\n\nä½†æç¤ºï¼š`sudo npm install command not found`\n\næ ¹æ®\nhttps://stackoverflow.com/a/73308302/16887299\n\n```bash\nsudo ln -s $(which npm) /usr/local/bin/npm\nsudo ln -s $(which node) /usr/local/bin/node\n```\nå³å¯è§£å†³ã€‚\nä¸»è¦åŸå› æ˜¯æŒ‰ç…§node.jså®˜æ–¹çš„å®‰è£…æ–¹æ³•ï¼Œä»–ä»¬ç»™æˆ‘ä»¬å®‰åˆ°äº†ï¼š`/root/.nvm/versions/node/v22.11.0/bin/node`ã€`/root/.nvm/versions/node/v22.11.0/bin/npm`ã€‚\næ‰€ä»¥sudoå‘½ä»¤ä¸è¯†åˆ«ã€‚\n## npmè®¾ç½®ä»£ç†\nåŒæ—¶å‘ç°éœ€è¦ç»™npmå•ç‹¬é…ç½®ä»£ç†ã€‚ç»ˆç«¯çš„ä»£ç†æ— æ•ˆã€‚\n`npm config set proxy http://127.0.0.1:7890`\nè®¾ç½®å¥½åï¼Œå¯ä»¥é€šè¿‡`npm config list`æŸ¥çœ‹proxyå­—æ®µæ˜¯å¦æ­£ç¡®ã€‚\n\nè‡³æ­¤ï¼Œå°±å¯ä»¥å®‰è£…pm2äº†ã€‚\n# pm2å®‰è£…\n```bash\nsudo npm install pm2@latest -g\n```\nå®‰è£…å®Œæˆåï¼Œåˆ™å¯ä»¥æŒ‰ç…§rustdeskæ–‡æ¡£ä¸­ç”¨pm2æ¥å¯åŠ¨æœåŠ¡ã€‚\n```bash\npm2 start hbbs\npm2 start hbbr\n```\nå¯ä»¥é€šè¿‡`pm2 list`æ¥æŸ¥çœ‹å½“å‰pm2ç®¡ç†çš„æœåŠ¡ã€‚\nå¦‚æœæƒ³è®©`hbbs`Â /Â `hbbr`åœ¨é‡å¯åè‡ªåŠ¨è¿è¡Œï¼Œæœ€å¥½å†æ‰§è¡Œä¸€ä¸‹`pm2 startup`å’Œ`pm2 save`ã€‚ï¼ˆè¯¦ç»†æŸ¥é˜…pm2æ–‡æ¡£ï¼‰\n\nè‡³æ­¤ï¼ŒrustdeskæœåŠ¡å°±è¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šäº†ã€‚\n# rustdeskçš„key\næœåŠ¡ä¸€è¿è¡Œï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€å¯¹åŠ å¯†çš„ç§é’¥å’Œå…¬é’¥ï¼ˆåˆ†åˆ«ä½äºè¿è¡Œç›®å½•ä¸‹çš„`id_ed25519`å’Œ`id_ed25519.pub`æ–‡ä»¶ä¸­ï¼‰ï¼Œå…¶ä¸»è¦ç”¨é€”æ˜¯é€šä¿¡åŠ å¯†ã€‚\n\nè¿™ä¸ª`id_ed25519.pub`æ–‡ä»¶çš„å†…å®¹éœ€è¦å¡«å†™åˆ°å®¢æˆ·ç«¯çš„keyä¸­ã€‚\n\nå¦‚æœè¦æ›´æ”¹å¯†é’¥ï¼Œè¯·åˆ é™¤`id_ed25519`å’Œ`id_ed25519.pub`æ–‡ä»¶å¹¶é‡æ–°å¯åŠ¨`hbbs` / `hbbr` ï¼Œ `hbbs`å°†ç”Ÿæˆæ–°çš„å¯†é’¥å¯¹ã€‚\n# äº‘æœåŠ¡å™¨é˜²ç«å¢™é…ç½®\næ ¹æ®æ–‡æ¡£ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ hbbsç›‘å¬ 21114ï¼ˆTCPï¼Œç”¨äº Web æ§åˆ¶å°ï¼Œä»…åœ¨ Pro ç‰ˆæœ¬ä¸­å¯ç”¨ï¼‰ã€21115 (TCP)ã€21116 (TCP/UDP) å’Œ 21118 (TCP)ï¼Œ hbbrç›‘å¬ 21117 (TCP) å’Œ 21119 (TCP) ã€‚è¯·åŠ¡å¿…åœ¨é˜²ç«å¢™ä¸­æ‰“å¼€è¿™äº›ç«¯å£ã€‚è¯·æ³¨æ„ï¼Œåº”ä¸º TCP å’Œ UDP å¯ç”¨ 21116ã€‚ 21115ç”¨äºNATç±»å‹æµ‹è¯•ï¼Œ21116/UDPç”¨äºIDæ³¨å†Œå’Œå¿ƒè·³æœåŠ¡ï¼Œ21116/TCPç”¨äºTCPæ‰“æ´å’Œè¿æ¥æœåŠ¡ï¼Œ21117ç”¨äºRelayæœåŠ¡ï¼Œ21118å’Œ21119ç”¨äºæ”¯æŒç½‘ç»œå®¢æˆ·ç«¯ã€‚å¦‚æœä¸éœ€è¦Webå®¢æˆ·ç«¯ï¼ˆ21118ã€21119ï¼‰æ”¯æŒï¼Œå¯ä»¥ç¦ç”¨ç›¸åº”ç«¯å£ã€‚\n\nè®¾ç½®æˆå¦‚ä¸‹çš„å³å¯ï¼š\n![](../../images/ç½‘ç»œ_è‡ªå»ºè¿œç¨‹æ¡Œé¢æœåŠ¡å™¨/image-20241123235654198.png)\n\n22æ˜¯ä¸ºäº†sshåè®®ï¼ˆè¿œç¨‹shellï¼‰ã€‚\n## å‘ï¼šä¸è¦è´¸ç„¶å¼€æ”¾æ‰€æœ‰ç«¯å£\nä¸è¦è´¸ç„¶å¼€æ”¾æ‰€æœ‰ç«¯å£ï¼Œç»è¿‡æµ‹è¯•ï¼ŒæœåŠ¡å™¨ä¼šè«åé­åˆ°DDoSæ”»å‡»ï¼Œå¯¼è‡´CPUã€å¸¦å®½é«˜å ç”¨ï¼ŒæœåŠ¡å™¨è¿æ¥æ•°å³°å€¼è¾¾åˆ°10Kï¼Œå¯¹äº2C2G3Mçš„æœåŠ¡å™¨æ¥è¯´ï¼Œè‚¯å®šç¦ä¸ä½ã€‚å¯¼è‡´sshç»å¸¸æ–­è”ã€æ— å“åº”ï¼›è¿œç¨‹æ¡Œé¢ä¹Ÿå¾ˆå¡é¡¿ã€‚\nè¿˜å¥½åˆ†æäº†ä¸€çœ¼é˜¿é‡Œäº‘åå°çš„ç›‘æ§æ•°æ®ï¼Œä¸ç„¶æˆ‘ä»¥ä¸ºæ˜¯ç½‘ç»œå¸¦å®½å¤ªå°çš„é—®é¢˜ã€‚å…¶å®å°±æ˜¯ç«¯å£å…¨å¼€æ”¾å¯¼è‡´æ”»å‡»æ¼æ´å¤ªå¤§çš„é—®é¢˜ã€‚ï¼ˆä¹Ÿç®—æ˜¯äº²è‡ªä½“éªŒè¿‡DDoSæ”»å‡»äº†ï¼Œè¿™æ‰çŸ¥é“äº†é˜²ç«å¢™çš„ä½œç”¨æœ‰å¤šä¹ˆé‡è¦ï¼Œè‡ªæ­¤ä¸å†æ˜¯ç´¯èµ˜ï¼‰\n# rustdeskå®¢æˆ·ç«¯é…ç½®\nè®¾ç½®-ç½‘ç»œä¸­ã€‚\n![](../../images/ç½‘ç»œ_è‡ªå»ºè¿œç¨‹æ¡Œé¢æœåŠ¡å™¨/image-20241123235810792.png)\n\nIDæœåŠ¡å™¨IP+21116ç«¯å£ï¼Œä¸­ç»§æœåŠ¡å™¨IP+21117ç«¯å£ã€‚\n\nå¯åŠ¨æœåŠ¡ï¼Œè‹¥ä¸»é¡µä¸‹é¢å›¾æ ‡æ˜¾ç¤ºå°±ç»ªï¼Œå³å¯ä»¥ä½¿ç”¨ã€‚","categories":["ç½‘ç»œ"]},{"title":"Windows_ç½‘ç»œæ¨¡å‹","url":"/Windows/Windows_ç½‘ç»œæ¨¡å‹/","content":"# å¼‚æ­¥é€‰æ‹©æ¨¡å‹\nè¿™é‡Œçš„å¼‚æ­¥ä¿®é¥°çš„æ˜¯ç­‰å¾…ã€é€‰æ‹©ï¼ŒæŒ‡çš„ä¸æ˜¯åŒæ—¶é€šä¿¡ï¼Œè€Œæ˜¯åŒæ—¶ç­‰å¾…ã€‚ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶ç›‘æ§å¤šä¸ªå¯¹è±¡ã€‚ä½†æ˜¯åªæ˜¯ç›‘æ§SOCKETçš„æ´»åŠ¨ï¼Œå…·ä½“ä¸šåŠ¡è¿˜æ˜¯éœ€è¦ç¨‹åºå‘˜å®Œå–„ï¼ˆæ¯”å¦‚æŸä¸ªsocketæœ‰æ•°æ®åªæ˜¯è¿”å›é€šçŸ¥ä¸€ä¸‹ï¼Œä¸ä¼šä¸»åŠ¨å¸®ä½ è¯»ï¼‰ã€‚\nå…·ä½“çš„å®ç°æ–¹æ³•ï¼Œæ ¹æ®æ“ä½œç³»ç»Ÿçš„å®ç°ï¼Œæœ‰è½®è¯¢æ–¹æ³•ï¼Œè½¯ä¸­æ–­æ–¹æ³•ï¼ˆæœ‰æ•°æ®æ—¶å‘ä¿¡å·ï¼‰ï¼Œæœ‰åˆ©äºèŠ‚çœç³»ç»Ÿèµ„æºã€‚\nWindowsä¸­çš„å¼‚æ­¥é€‰æ‹©æ¨¡å‹æœ‰ï¼š\n1. Selectï¼šåœ¨ç±»Unixç³»ç»Ÿä¸‹ï¼Œå‡ ä¹éƒ½ç”¨çš„è¿™ä¸ªï¼ŒBerkeley Socket\n2. WSAAsyncSelect\n3. WSAEventSelect\n## å¼‚æ­¥é€šä¿¡æ¨¡å‹\nä¸Šé¢è®¨è®ºçš„æ˜¯å¼‚æ­¥é€‰æ‹©æ¨¡å‹ï¼Œæ­¤å¤„çš„åŠŸèƒ½æ›´å¼ºå¤§äº†ï¼Œå«åšå¼‚æ­¥é€šä¿¡æ¨¡å‹ï¼Œæ„æ€æ˜¯ä¸€ä¸ªçº¿ç¨‹ä¸ä»…å¯ä»¥åŒæ—¶ç›‘æ§å¤šä¸ªè¿æ¥ï¼Œè¿˜å¯ä»¥å¤„ç†é€šä¿¡ä¸šåŠ¡ï¼ˆæ¯”å¦‚æŸä¸ªsocketæœ‰æ•°æ®ï¼Œä¼šä¸»åŠ¨å¸®ä½ è¯»ï¼Œé€šè¿‡ç³»ç»Ÿå†…éƒ¨çš„çº¿ç¨‹æˆ–ä¸­æ–­ï¼Œè‡ªåŠ¨å¡«å…¥ä½ ä¹‹å‰ç»™å®ƒçš„ç¼“å†²åŒºã€‚ç­‰åˆ°å®ƒé€šçŸ¥ä½ æ—¶ï¼Œè¯»å†™å·²ç»å¤„ç†å®Œæ¯•ï¼‰ã€‚\n# WSAAsyncSelect\n[WSAAsyncSelect function (winsock.h)](https://learn.microsoft.com/en-us/windows/win32/api/winsock/nf-winsock-wsaasyncselect)\nå‡½æ•°åŸå‹ï¼š\n![](../../images/Windows_ç½‘ç»œæ¨¡å‹/image-20241011082306440.png)\n1. å‚æ•°1ï¼šSocketï¼Œéœ€è¦ç›‘æ§å“ªä¸ªsocket\n2. å‚æ•°2ï¼šçª—å£å¥æŸ„ï¼Œç”¨äºæ ‡è¯†åœ¨å‘ç”Ÿç½‘ç»œäº‹ä»¶æ—¶å°†æ¥æ”¶æ¶ˆæ¯çš„çª—å£ã€‚\n3. å‚æ•°3ï¼šå‘ç”Ÿç½‘ç»œäº‹ä»¶æ—¶è¦æ¥æ”¶çš„æ¶ˆæ¯ç±»å‹ï¼ˆæŠ•é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆæ¯ç±»å‹ï¼‰ã€‚\n4. å‚æ•°4ï¼šæŒ‡å®šå¯¹å“ªä¸ªæˆ–å“ªäº›ç½‘ç»œäº‹ä»¶æ„Ÿå…´è¶£ï¼Œç”¨ä½æ©ç è¡¨ç¤ºã€‚\n5. è¿”å›å€¼ï¼šæˆåŠŸè¿”å›0ï¼Œå¤±è´¥æ—¶è¿”å›`SOCKET_ERROR`ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨WSAGetLastErroræ¥æ£€ç´¢é”™è¯¯å·ã€‚\n## åˆ›å»ºé¡¹ç›®\nç”±äºWSAAsyncSelectéœ€è¦æ¶ˆæ¯å¾ªç¯ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ª`Windows Desktop Wizard`é¡¹ç›®ï¼Œå–åä¸º`WSAAsyncSelectModel`ï¼Œé€‰æ‹©Application Typeä¸ºDesktop Application (.exe)ï¼ŒAdditional Optionsé€‰æ‹©Empty Projectã€‚\næ–°å»ºæºæ–‡ä»¶`wsa_async_select.cpp`ã€‚\nä»£ç æ‹·è´Element Studioä¸­çš„Spawnä¸­Most Usedä¸­çš„Message Loopçš„ä»£ç ã€‚\nåŒæ—¶åœ¨mainå‡½æ•°å‰éƒ¨è´´å…¥`file_server.cpp`ä¸­ä»åˆå§‹åŒ–åˆ°å»ºç«‹`listen_sock`çš„ä»£ç ã€‚\n\néœ€è¦æ³¨æ„ï¼Œ`#pragma comment(lib, \"Ws2_32.lib\")`åˆ«å¿˜äº†å¤åˆ¶è¿‡å»ï¼Œå¦åˆ™ä¼šæŠ¥ä»¥ä¸‹çš„é”™è¯¯ï¼š\nï¼ˆæœ€åï¼Œåˆ«å¿˜è®°åœ¨wWinMainå‡½æ•°returnçš„å‰ä¸€å¥`WSACleanup()`ï¼‰\n```\nBuild started at 8:10 AM...\n1>------ Build started: Project: WSAAsyncSelectModel, Configuration: Debug x64 ------\n1>wsa_async_select.cpp\n1>C:\\Users\\mrcan\\source\\repos\\MetaLearning\\WSAAsyncSelectModel\\wsa_async_select.cpp(68,15): warning C4244: 'return': conversion from 'WPARAM' to 'int', possible loss of data\n1>wsa_async_select.obj : error LNK2019: unresolved external symbol __imp_socket referenced in function wWinMain\n1>wsa_async_select.obj : error LNK2019: unresolved external symbol __imp_WSAStartup referenced in function wWinMain\n1>wsa_async_select.obj : error LNK2019: unresolved external symbol __imp_WSAGetLastError referenced in function wWinMain\n1>wsa_async_select.obj : error LNK2019: unresolved external symbol __imp_WSAAsyncSelect referenced in function wWinMain\n1>C:\\Users\\mrcan\\source\\repos\\MetaLearning\\x64\\Debug\\WSAAsyncSelectModel.exe : fatal error LNK1120: 4 unresolved externals\n1>Done building project \"WSAAsyncSelectModel.vcxproj\" -- FAILED.\n========== Build: 0 succeeded, 1 failed, 0 up-to-date, 0 skipped ==========\n========== Build completed at 8:10 AM and took 00.582 seconds ==========\n```\nç¼–è¯‘å¤±è´¥çš„åŸå› æ˜¯é“¾æ¥å™¨æ— æ³•æ‰¾åˆ° WinSock åº“ä¸­çš„ç›¸å…³å‡½æ•°å®šä¹‰ã€‚WinSock å‡½æ•°å¦‚ `socket()`ã€`WSAStartup()`ã€`WSAGetLastError()` å’Œ `WSAAsyncSelect()` éƒ½åœ¨ `Ws2_32.lib` ä¸­å®šä¹‰ï¼Œå› æ­¤éœ€è¦åœ¨é¡¹ç›®ä¸­æ˜¾å¼åœ°é“¾æ¥è¯¥åº“ã€‚\n## æ³¨æ„ï¼ˆéé˜»å¡æ¨¡å¼ï¼‰\nWSAAsyncSelectå‡½æ•°è‡ªåŠ¨å°†å¥—æ¥å­—sè®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ï¼Œè€Œä¸è€ƒè™‘`lEvent`çš„å€¼ã€‚è¦å°†å¥—æ¥å­—sè®¾ç½®å›é˜»å¡æ¨¡å¼ï¼Œé¦–å…ˆå¿…é¡»é€šè¿‡è°ƒç”¨`å°†lEventè®¾ç½®ä¸ºé›¶çš„WSAAsyncSelect`æ¥æ¸…é™¤ä¸å¥—æ¥å­—så…³è”çš„äº‹ä»¶è®°å½•ã€‚ç„¶åå¯ä»¥è°ƒç”¨`ioctlsocket`æˆ–`WSAIoctl`å°†å¥—æ¥å­—è®¾ç½®ä¸ºé˜»å¡æ¨¡å¼ã€‚\n[ioctlsocket function (winsock.h)](https://learn.microsoft.com/en-us/windows/win32/api/winsock/nf-winsock-ioctlsocket)\n### ioctlsocketç¤ºä¾‹\n```cpp\n#include <winsock2.h>\n#include <stdio.h>\n#pragma comment(lib, \"Ws2_32.lib\")\nvoid main()\n{\n    //-------------------------\n    // Initialize Winsock\n    WSADATA wsaData;\n    int iResult;\n    u_long iMode = 0;\n\n    iResult = WSAStartup(MAKEWORD(2,2), &wsaData);\n    if (iResult != NO_ERROR)\n          printf(\"Error at WSAStartup()\\n\");\n    //-------------------------\n    // Create a SOCKET object.\n    SOCKET m_socket;\n    m_socket = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);\n    if (m_socket == INVALID_SOCKET)\n    {\n        printf(\"Error at socket(): %ld\\n\", WSAGetLastError());\n        WSACleanup();\n        return;\n    }\n    //-------------------------\n    // Set the socket I/O mode: In this case FIONBIO\n    // enables or disables the blocking mode for the \n    // socket based on the numerical value of iMode.\n    // If iMode = 0, blocking is enabled; \n    // If iMode != 0, non-blocking mode is enabled.\n\n    iResult = ioctlsocket(m_socket, FIONBIO, &iMode);\n    if (iResult != NO_ERROR)\n          printf(\"ioctlsocket failed with error: %ld\\n\", iResult);\n}\n```\n## ç½‘ç»œäº‹ä»¶\nlEventå‚æ•°æ˜¯é€šè¿‡ä½¿ç”¨ä¸‹è¡¨ä¸­åˆ—å‡ºçš„ä»»æ„å€¼çš„æŒ‰ä½ORè¿ç®—ç¬¦æ„é€ çš„ã€‚\n\n|Value|Meaning|\n|---|---|\n|**FD_READ**|Set to receive notification of readiness for reading.|\n|**FD_WRITE**|Wants to receive notification of readiness for writing.|\n|**FD_OOB**|Wants to receive notification of the arrival of OOB data.|\n|**FD_ACCEPT**|Wants to receive notification of incoming connections.|\n|**FD_CONNECT**|Wants to receive notification of completed connection or multipoint join operation.|\n|**FD_CLOSE**|Wants to receive notification of socket closure.|\n|**FD_QOS**|Wants to receive notification of socket Quality of Service (QoS) changes.|\n|**FD_GROUP_QOS**|Wants to receive notification of socket group Quality of Service (QoS) changes (reserved for future use with socket groups). Reserved.|\n|**FD_ROUTING_INTERFACE_CHANGE**|Wants to receive notification of routing interface changes for the specified destination(s).|\n|**FD_ADDRESS_LIST_CHANGE**|Wants to receive notification of local address list changes for the socket protocol family.|\nä¸ºå¥—æ¥å­—å‘å‡ºWSAAsyncSelectå°†å–æ¶ˆè¿™ä¸ªå¥—æ¥å­—çš„ä»»ä½•å…ˆå‰çš„WSAAsyncSelectæˆ–WSAEventSelectã€‚ä¾‹å¦‚ï¼Œè¦æ¥æ”¶è¯»å†™é€šçŸ¥ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»ä½¿ç”¨FD_READå’ŒFD_WRITEè°ƒç”¨WSAAsyncSelectï¼Œå¦‚ä¸‹æ‰€ç¤º\n```cpp\nrc = WSAAsyncSelect(s, hWnd, wMsg, FD_READ|FD_WRITE);\n```\nä¸èƒ½ä¸ºä¸åŒçš„äº‹ä»¶æŒ‡å®šä¸åŒçš„æ¶ˆæ¯ã€‚ä¸‹é¢çš„ä»£ç å°†ä¸èµ·ä½œç”¨ï¼šç¬¬äºŒä¸ªè°ƒç”¨å°†å–æ¶ˆç¬¬ä¸€ä¸ªçš„æ•ˆæœï¼Œå¹¶ä¸”åªæœ‰FD_WRITEäº‹ä»¶å°†ä¸æ¶ˆæ¯wMsg2ä¸€èµ·æŠ¥å‘Šï¼š\n```cpp\nrc = WSAAsyncSelect(s, hWnd, wMsg1, FD_READ);\nrc = WSAAsyncSelect(s, hWnd, wMsg2, FD_WRITE);\n```\nè¦å–æ¶ˆæ‰€æœ‰é€šçŸ¥ï¼ŒæŒ‡ç¤ºWindowså¥—æ¥å­—ä¸åº”å‘é€ä¸å¥—æ¥å­—ä¸Šçš„ç½‘ç»œäº‹ä»¶ç›¸å…³çš„å…¶ä»–æ¶ˆæ¯ï¼Œè¯·å°†lEventè®¾ç½®ä¸ºé›¶ã€‚\n```cpp\nrc = WSAAsyncSelect(s, hWnd, 0, 0);\n```\n## wWinMainä»£ç \næŠŠæ­¤å‡½æ•°æ”¾åˆ°çª—å£åˆå§‹åŒ–ã€æ˜¾ç¤ºå®Œæ¯•å’Œæ¶ˆæ¯å¾ªç¯å¼€å§‹ä¹‹é—´ã€‚\n```cpp\n// wsa_async_select.cpp\n#include <windows.h>\n#include <WinSock2.h>\n#include <WS2tcpip.h>\n#define MY_WMACCEPT WM_USER + 0x1\n\n// declarations\nLRESULT __stdcall WndProcdure(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam);\n// function defines\nint __stdcall wWinMain(HINSTANCE hInstance, HINSTANCE hPreInstance, wchar_t* lpCmdLine, int iCmdShow)\n{\n    // socket setting\n    WORD wVersionRequested;\n    WSADATA wsaData;\n    int err;\n    wVersionRequested = MAKEWORD(2, 2);\n\n    err = ::WSAStartup(wVersionRequested, &wsaData);\n    if (err != 0) {\n        // è¿™æ˜¯Window Applicationï¼Œä¸èƒ½è°ƒç”¨coutæˆ–wcoutï¼Œå› ä¸ºæ²¡æœ‰æ§åˆ¶å°ã€‚\n        //std::wcout << std::format(L\"WSAStartup failed with error : {}\\n\", err);\n        return 1;\n    }\n\n    SOCKET listen_sock = ::socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);\n    if (listen_sock == INVALID_SOCKET)\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n\n    sockaddr_in server_addr;\n    server_addr.sin_family = AF_INET;\n    //service.sin_addr.S_un.S_addr = inet_addr(\"127.0.0.1\");\n    if (1 != ::inet_pton(AF_INET, \"127.0.0.1\", &server_addr.sin_addr))\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n    server_addr.sin_port = htons(9008);\n\n    if (SOCKET_ERROR == ::bind(listen_sock,\n        reinterpret_cast<const sockaddr*>(&server_addr),\n        sizeof(server_addr)))\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n\n    if (SOCKET_ERROR == ::listen(listen_sock, SOMAXCONN))\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n\n    // Window Initialization and Showing\n    wchar_t szAppName[] = L\"WinApp\";\n    WNDCLASSEX wcex = { 0 };\n    wcex.cbSize = sizeof(wcex);\n    wcex.style = CS_HREDRAW | CS_VREDRAW;\n    wcex.lpfnWndProc = &WndProcdure;\n    wcex.cbClsExtra = 0;\n    wcex.cbWndExtra = 0;\n    wcex.hInstance = hInstance;\n    wcex.hIcon = LoadIcon(NULL, IDI_APPLICATION);\n    wcex.hCursor = LoadCursor(NULL, IDC_ARROW);\n    wcex.hbrBackground = (HBRUSH)(GetStockObject(WHITE_BRUSH));\n    wcex.lpszMenuName = NULL;\n    wcex.lpszClassName = szAppName;\n    wcex.hIconSm = wcex.hIcon;\n    if (!RegisterClassEx(&wcex))\n    {\n        return -1;\n    }\n    HWND hWnd = NULL;\n    hWnd = CreateWindowEx(WS_EX_OVERLAPPEDWINDOW, szAppName, L\"App\", WS_OVERLAPPEDWINDOW, CW_USEDEFAULT, 0, CW_USEDEFAULT, 0, NULL, NULL, hInstance, NULL);\n    ShowWindow(hWnd, iCmdShow);\n    UpdateWindow(hWnd);\n\n    // Select\n    if (SOCKET_ERROR == ::WSAAsyncSelect(listen_sock, hWnd, MY_WMACCEPT, FD_ACCEPT))\n    {\n        err = ::WSAGetLastError();\n    }\n\n    // Message Loop\n    MSG msg;\n    while (GetMessage(&msg, NULL, 0, 0))\n    {\n        TranslateMessage(&msg);\n        DispatchMessage(&msg);\n    }\n    ::WSACleanup();\n    return msg.wParam;\n}\n```\nå…ˆç¼–è¯‘è¿è¡Œä¸€ä¸‹ï¼Œå‘ç°æç¤ºï¼š\n```\nBuild started at 8:16 AM...\n1>------ Build started: Project: WSAAsyncSelectModel, Configuration: Debug x64 ------\n1>wsa_async_select.cpp\n1>C:\\Users\\mrcan\\source\\repos\\MetaLearning\\WSAAsyncSelectModel\\wsa_async_select.cpp(68,15): warning C4244: 'return': conversion from 'WPARAM' to 'int', possible loss of data\n1>C:\\Users\\mrcan\\source\\repos\\MetaLearning\\WSAAsyncSelectModel\\wsa_async_select.cpp(57,27): error C4996: 'WSAAsyncSelect': Use WSAEventSelect() instead or define _WINSOCK_DEPRECATED_NO_WARNINGS to disable deprecated API warnings\n1>Done building project \"WSAAsyncSelectModel.vcxproj\" -- FAILED.\n========== Build: 0 succeeded, 1 failed, 0 up-to-date, 0 skipped ==========\n========== Build completed at 8:16 AM and took 00.538 seconds ==========\n```\nMSå»ºè®®æˆ‘ä»¬ä½¿ç”¨`WSAEventSelect()`ä½œä¸ºä»£æ›¿ï¼Œå› ä¸º`WSAAsyncSelect`è¢«åºŸå¼ƒäº†ï¼Œå¦‚æœè¦ä½¿ç”¨ï¼Œéœ€è¦`define _WINSOCK_DEPRECATED_NO_WARNINGS`ã€‚å¯ä»¥å³é”®é¡¹ç›®ï¼Œå±æ€§ï¼Œ`C/C++`ï¼ŒPreprocessorï¼Œä¸‹æ‹‰`Preprocessor Definitions`ï¼Œé€‰æ‹©`<Edit...>`ã€‚åœ¨è¾“å…¥æ–‡æœ¬æ¡†ä¸­å·²æœ‰å†…å®¹çš„æœ€ä¸‹é¢å†™ä¸€è¡Œè¿™ä¸²ç¬¦å·ä¸Šå»ã€‚\n![](../../images/Windows_ç½‘ç»œæ¨¡å‹/image-20241011081849722.png)\n![](../../images/Windows_ç½‘ç»œæ¨¡å‹/image-20241011081956658.png)\n## WndProcdureå›è°ƒå‡½æ•°\nä¸»è¦å¤„ç†æ¶ˆæ¯å¾ªç¯æ—¶ï¼Œä¸åŒæ¶ˆæ¯ç±»å‹çš„å¤„ç†ï¼Œæ­¤å¤„æˆ‘ä»¬å¤„ç†è‡ªå®šä¹‰æ¶ˆæ¯ç±»å‹`MY_WMACCEPT`ï¼Œå³æˆ‘ä»¬åœ¨`WSAAsyncSelect`ç»™socketç»‘å®šçš„äº‹ä»¶é€šçŸ¥çš„æ¶ˆæ¯ç±»å‹ã€‚\n```cpp\nLRESULT __stdcall WndProcdure(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)\n{\n    HDC hDC = NULL;\n    PAINTSTRUCT ps;\n    switch (message)\n    {\n    case WM_CREATE:\n    {\n        return 0;\n    }\n    case WM_PAINT:\n    {\n        hDC = BeginPaint(hWnd, &ps);\n        EndPaint(hWnd, &ps);\n        return 0;\n    }\n    case MY_WMACCEPT:\n    {\n        return 0;   // break point\n    }\n    case WM_DESTROY:\n    {\n        PostQuitMessage(0);\n        return 0;\n    }\n    }\n    return DefWindowProc(hWnd, message, wParam, lParam);\n}\n```\n## æµ‹è¯•\næ–­ç‚¹å¯ä»¥è®¾ç½®åœ¨`case MY_WMACCEPT`ä¸­çš„breakä¸Šã€‚\nè¿è¡Œ`wsa_async_select`åï¼Œå†è¿è¡Œä¸€ä¸ªSocketClienté¡¹ç›®ä¸­çš„`basic_stream_client`ã€‚\nå¯ä»¥çœ‹åˆ°æ–­ç‚¹è½åœ¨returnè¯­å¥ä¸Šã€‚è¯´æ˜æ¥æ”¶åˆ°äº†acceptäº‹ä»¶ã€‚\n## å…·ä½“å†™`case MY_WMACCEPT`\n```cpp\n{\n    case MY_WMACCEPT:\n    {\n        sockaddr_in client_addr;\n        int addrlen{ sizeof(client_addr) };\n        SOCKET work_sock = ::accept(\n            listen_sock,\n            reinterpret_cast<sockaddr*>(&client_addr),\n            &addrlen);\n        if (work_sock == INVALID_SOCKET)\n        {\n            err = ::WSAGetLastError();\n            return 1;\n        }\n\n        return 0;\n    }\n}\n```\nå¦‚æ­¤å†™ï¼Œéœ€è¦è°ƒæ•´`listen_sock`å’Œ`err`ä¸ºå…¨å±€å˜é‡ã€‚\n```cpp\n// ...\nSOCKET listen_sock = INVALID_SOCKET;\nint err;\n// ...\n```\n### æ˜¾ç¤ºå®¢æˆ·ç«¯ä¿¡æ¯ã€æ”¶å‘æ•°æ®\næ¥ç€ï¼Œè¡¥å……ä¸Šä¹‹å‰æœåŠ¡ç«¯ã€å®¢æˆ·ç«¯çš„æ”¶å‘ä»£ç ã€‚æœåŠ¡ç«¯è¿˜è¦æ˜¾ç¤ºè¿æ¥çš„å®¢æˆ·ç«¯çš„ä¿¡æ¯ï¼Œç”±äºé¡¹ç›®æ˜¯Windows Applicationï¼Œä¸èƒ½è¿›è¡Œcoutè¾“å‡ºï¼Œå› æ­¤éœ€è¦ç”¨MessageBoxæ›¿æ¢ã€‚\n```cpp\n{\n    case MY_WMACCEPT:\n    {\n        // accept\n        // ...\n\n        wchar_t addr_str[46] = L\"\";\n        InetNtopW(AF_INET, reinterpret_cast<void*>(&client_addr.sin_addr), addr_str, 46);\n        std::wstring info = std::format(L\"client address: {}, port: {}\\n\", addr_str, ntohs(client_addr.sin_port));\n\n        ::MessageBox(hWnd, info.c_str(), L\"info\", MB_OK);\n\n        // send ...\n        std::wstring message{ L\"Welcome to server!\" };\n        ::send(\n            work_sock,\n            reinterpret_cast<const char*>(message.c_str()),\n            sizeof(wchar_t) * message.size(),\n            0);\n        // recv ...\n        wchar_t buf[100] = { 0 };\n        int bytes_received = ::recv(work_sock, reinterpret_cast<char*>(buf), sizeof(wchar_t) * sizeof(buf), 0);\n        if (bytes_received > 0)\n        {\n            ::MessageBox(hWnd, buf, L\"recv\", MB_OK);\n        }\n        else\n        {\n            err = ::WSAGetLastError();\n        }\n        ::closesocket(work_sock);\n        work_sock = INVALID_SOCKET;\n\n        return 0;\n    }\n}\n```\n## æµ‹è¯•1\nåˆšæ‰“å¼€å®¢æˆ·ç«¯æ—¶ï¼ŒæœåŠ¡ç«¯çª—å£ä¼šå¼¹å‡ºï¼š\n![](../../images/Windows_ç½‘ç»œæ¨¡å‹/image-20241012130048427.png)\nä½†æ˜¯åé¢ï¼Œå®¢æˆ·ç«¯è¾“å…¥å†…å®¹å›è½¦åï¼ŒæœåŠ¡ç«¯çª—å£æœ‰æ—¶ä¸ä¼šå¼¹å‡ºæ¥æ”¶åˆ°çš„å†…å®¹ã€‚\n![](../../images/Windows_ç½‘ç»œæ¨¡å‹/image-20241012130305976.png)\n### åŸå› \nç»è¿‡è°ƒè¯•ï¼Œå‘ç°æœåŠ¡ç«¯çš„recvè¿”å›`-1`ã€‚\næŸ¥è¯¢errorç ï¼Œå‘ç°ï¼š\n![](../../images/Windows_ç½‘ç»œæ¨¡å‹/image-20241012130707547.png)\n## è°ƒæ•´selectçš„socketä¸ºé˜»å¡\nåœ¨acceptä¹‹åï¼Œé€šè¿‡`ioctlsocket`å‡½æ•°è®¾ç½®`work_sock`ä¸ºé˜»å¡ã€‚`FIONBIO`ã€‚è§[ioctlsocketç¤ºä¾‹](#ioctlsocketç¤ºä¾‹)\n```cpp\n// ...\n    case MY_WMACCEPT:\n    {\n        sockaddr_in client_addr;\n        int addrlen{ sizeof(client_addr) };\n        SOCKET work_sock = ::accept(\n            listen_sock,\n            reinterpret_cast<sockaddr*>(&client_addr),\n            &addrlen);\n        if (work_sock == INVALID_SOCKET)\n        {\n            err = ::WSAGetLastError();\n            return 1;\n        }\n\n        // set socket blocking mode\n        u_long iMode = 0;\n        if (SOCKET_ERROR == ::ioctlsocket(work_sock, FIONBIO, &iMode))\n        {\n            err = ::WSAGetLastError();\n        }\n// ...\n```\nä½†æ˜¯åªè¿™æ ·ä¸è¡Œï¼š\n![](../../images/Windows_ç½‘ç»œæ¨¡å‹/image-20241012131341949.png)\nåŸå› è§[æ³¨æ„ï¼ˆéé˜»å¡æ¨¡å¼ï¼‰](#æ³¨æ„ï¼ˆéé˜»å¡æ¨¡å¼ï¼‰)ï¼š\nè¦è°ƒæ•´é˜»å¡æ¨¡å¼ï¼Œé¦–å…ˆå¿…é¡»é€šè¿‡è°ƒç”¨`å°†lEventè®¾ç½®ä¸ºé›¶çš„WSAAsyncSelect`æ¥æ¸…é™¤ä¸å¥—æ¥å­—så…³è”çš„äº‹ä»¶è®°å½•ã€‚ç„¶åå†è°ƒç”¨`ioctlsocket`æˆ–`WSAIoctl`å°†å¥—æ¥å­—è®¾ç½®ä¸ºé˜»å¡æ¨¡å¼ã€‚\nå› æ­¤éœ€è¦æ”¹`WSAAsyncSelect`çš„æœ€åä¸€ä¸ªå‚æ•°ï¼Œç”±`FD_ACCEPT`æ”¹ä¸º`0`ã€‚\n```cpp\n// ...\n\n    if (SOCKET_ERROR == ::WSAAsyncSelect(listen_sock, hWnd, MY_WMACCEPT, 0))\n    {\n        err = ::WSAGetLastError();\n    }\n\n    MSG msg;\n    while (GetMessage(&msg, NULL, 0, 0))\n    {\n        TranslateMessage(&msg);\n        DispatchMessage(&msg);\n    }\n    ::WSACleanup();\n    return msg.wParam;\n}\n```\nè‡³æ­¤ï¼ŒsocketæˆåŠŸè¢«è®¾ç½®ä¸ºé˜»å¡æ¨¡å¼äº†ã€‚\n## æµ‹è¯•2\nå…ˆè¿è¡ŒæœåŠ¡ç«¯ã€‚\nåˆšæ‰“å¼€å®¢æˆ·ç«¯æ—¶ï¼ŒæœåŠ¡ç«¯çª—å£ä¼šå¼¹å‡ºï¼š\n![](../../images/Windows_ç½‘ç»œæ¨¡å‹/image-20241012131828939.png)\nå®¢æˆ·ç«¯è¾“å…¥å†…å®¹å›è½¦åï¼š\n![](../../images/Windows_ç½‘ç»œæ¨¡å‹/image-20241012131919359.png)\næœåŠ¡ç«¯å¼¹å‡ºçª—å£ï¼š\n![](../../images/Windows_ç½‘ç»œæ¨¡å‹/image-20241012131907928.png)\nä»¥ä¸Šç‰ˆæœ¬çš„æœåŠ¡ç«¯åªæ˜¯ç”¨selectç›‘æ§äº†ACCEPTè¿æ¥äº‹ä»¶ï¼Œè€Œåœ¨`work_sock`ä¸Šçš„è¯»å†™äº‹ä»¶é€šçŸ¥æ˜¯æˆ‘ä»¬åœ¨selectæœ‰äº†è¿æ¥äº‹ä»¶ååŒæ—¶å‘æ¶ˆæ¯é˜Ÿåˆ—æŠ•å‡º`MY_WMACCEPT`æ¶ˆæ¯ï¼Œåœ¨å›è°ƒå‡½æ•°ä¸­çš„`switch-case`æ‰å»å¤„ç†è¯»å†™ã€‚\nä»¥ä¸Šçš„è¯»å†™å¤„ç†æ˜¯æ¯”è¾ƒåƒµç¡¬çš„ï¼Œä»…ç”¨äºæµ‹è¯•ã€‚æ­£è§„ç¨‹åºä¸­çš„è¯»å†™äº‹ä»¶åº”è¯¥ä¹Ÿç”¨Selectæ¥ç›‘æ§ï¼Œè§ä¸‹æ–‡ã€‚\n## éé˜»å¡æ¨¡å¼ä¸‹ä¾é selectå¤„ç†å¯è¯»äº‹ä»¶\nåœ¨åŸæœ‰ç¨‹åºçš„åŸºç¡€ä¸Šï¼Œä¿®æ”¹`case WM_ACCEPT`ä¸­çš„æ“ä½œï¼šä¸å†é˜»å¡å¼è¯»å–æ•°æ®ã€‚è€Œæ˜¯åœ¨å…¶ä¸­å†ä¸€æ¬¡selectã€‚\néœ€è¦æ”¹ä¸¤ä¸ªåœ°æ–¹ï¼š\n1. æ·»åŠ selectï¼Œå…³æ³¨`FD_READ`ï¼Œå‘å‡º`WM_READ`\n2. ä¿®æ”¹`iMode`ä¸º1ã€‚è§[ioctlsocketç¤ºä¾‹](#ioctlsocketç¤ºä¾‹)\n\n```cpp\n// ...\n    case MY_WMACCEPT:\n    {\n        sockaddr_in client_addr;\n        int addrlen{ sizeof(client_addr) };\n        SOCKET work_sock = ::accept(\n            listen_sock,\n            reinterpret_cast<sockaddr*>(&client_addr),\n            &addrlen);\n        if (work_sock == INVALID_SOCKET)\n        {\n            err = ::WSAGetLastError();\n            return 1;\n        }\n\n        // select\n        if (::WSAAsyncSelect(work_sock, hWnd, MY_WMREAD, FD_READ) == SOCKET_ERROR)\n        {\n            err = ::WSAGetLastError();\n        }\n\n        // set socket non-blocking mode\n        u_long iMode = 1; // 1 to non-block\n        if (SOCKET_ERROR == ::ioctlsocket(work_sock, FIONBIO, &iMode))\n        {\n            err = ::WSAGetLastError();\n        }\n        \n        // MessageBoxæ˜¾ç¤ºå®¢æˆ·ç«¯ä¿¡æ¯ ...\n        // send data to client...\n        // recv ç§»åŠ¨åˆ° case WM_READ\n    }\n// ...\n```\nè§ï¼š[æ˜¾ç¤ºå®¢æˆ·ç«¯ä¿¡æ¯ã€æ”¶å‘æ•°æ®](#æ˜¾ç¤ºå®¢æˆ·ç«¯ä¿¡æ¯ã€æ”¶å‘æ•°æ®)\nå›è°ƒå‡½æ•°ä¸­ï¼Œå¯¹åº”çš„`case MY_WMREAD`ï¼Œé‡Œé¢çš„åŠ¨ä½œå°±å¯¹åº”äºåŸå…ˆ`case MY_WMACCEPT`ä¸­çš„`recv`æ“ä½œäº†ã€‚å³recvæ“ä½œå‰ªåˆ‡è¿‡æ¥ã€‚\næ­¤æ—¶å‘ç°ä¸ªé—®é¢˜ï¼š`work_sock`åœ¨æ­¤ä½œç”¨åŸŸä¸­ä¸æ˜ï¼Œéœ€è¦ä¼ å…¥ã€‚ä½†æ˜¯å¥½åœ¨selectå‡½æ•°ä¸ºæˆ‘ä»¬å¤„ç†äº†ï¼šå¾®è½¯å®˜æ–¹æ–‡æ¡£ä¸­æŒ‡å‡ºï¼š\n[WSAAsyncSelect function (winsock2.h)](https://learn.microsoft.com/en-us/windows/win32/api/winsock2/nf-winsock2-wsaasyncselect)\nå½“æŒ‡å®šçš„å¥—æ¥å­—`s`ä¸Šå‘ç”ŸæŒ‡å®šçš„ç½‘ç»œäº‹ä»¶ä¹‹ä¸€æ—¶ï¼Œåº”ç”¨ç¨‹åºçª—å£`hWnd`æ¥æ”¶æ¶ˆæ¯`wMsg`ã€‚`wParam`å‚æ•°æ ‡è¯†å‘ç”Ÿç½‘ç»œäº‹ä»¶çš„å¥—æ¥å­—ã€‚`lParam`çš„ä½ä½å­—æŒ‡å®šå·²å‘ç”Ÿçš„ç½‘ç»œäº‹ä»¶ã€‚`lParam`çš„é«˜ä½å­—åŒ…å«ä»»ä½•é”™è¯¯ä»£ç ã€‚é”™è¯¯ä»£ç å¯ä»¥æ˜¯`Winsock2.h`ä¸­å®šä¹‰çš„ä»»ä½•é”™è¯¯ã€‚\nå› æ­¤ï¼Œæˆ‘ä»¬åœ¨ç”¨selectç›‘æ§åˆ°`FD_READ`äº‹ä»¶åï¼Œå®ƒå°±ä¼šè‡ªåŠ¨å‘wMainç¨‹åºçš„wParamå¡«å……`work_sock`ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨ç”¨åˆ°è¿™ä¸ªå¥—æ¥å­—æ—¶ï¼Œä»`wParam`å–å‡ºå³å¯ã€‚\n\nè¿˜è¦æ³¨æ„ï¼Œå¦‚æœæœåŠ¡ç«¯ç¨‹åºåˆ°ä¸€å®šé˜¶æ®µåï¼Œä¸éœ€è¦å†å…³æ³¨`FD_READ`äº‹ä»¶äº†ï¼Œé‚£éœ€è¦åšæ”¶å°¾å¤„ç†ï¼ˆå†æ¬¡è°ƒç”¨`select`ï¼Œç½®å…³æ³¨çš„äº‹ä»¶ä¸º0ï¼‰\n```cpp\n// ...\n    case MY_WMREAD:\n    {\n        SOCKET work_sock = wParam;\n        // recv\n        wchar_t buf[100] = { 0 };\n        int bytes_received = ::recv(work_sock, reinterpret_cast<char*>(buf), sizeof(wchar_t) * sizeof(buf), 0);\n        if (bytes_received > 0)\n        {\n            ::MessageBox(hWnd, buf, L\"recv\", MB_OK);\n        }\n        else\n        {\n            err = ::WSAGetLastError();\n        }\n        // clean Select\n        if (::WSAAsyncSelect(work_sock, hWnd, MY_WMREAD, 0) == SOCKET_ERROR)\n        {\n            err = ::WSAGetLastError();\n        }\n        // clean socket\n        ::closesocket(work_sock);\n        work_sock = INVALID_SOCKET;\n        return 0;\n    }\n// ...\n```\n# WSAEventSelect\nWSAAsyncSelect æ˜¯è½®è¯¢æ¨¡å¼ã€‚å¾®è½¯ç›®å‰å·²ç»ä¸å»ºè®®ä½¿ç”¨ã€‚\nWSAEventSelect æ˜¯äº‹ä»¶æ¨¡å¼ã€‚å¾®è½¯æ¯”è¾ƒæ¨èã€‚\nä¸¤è€…çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼ŒWSAAsyncSelectéœ€è¦ç»‘å®šä¸€ä¸ªæ¶ˆæ¯ï¼Œè€ŒWSAEventSelectéœ€è¦ç»‘å®šä¸€ä¸ªäº‹ä»¶ã€‚\n## åˆ›å»ºé¡¹ç›®\nWSAEventSelect ä¸éœ€è¦çª—å£ç¨‹åºï¼Œæ™®é€šçš„æ§åˆ¶å°ç¨‹åºå³å¯ã€‚\nå› æ­¤åˆ›å»ºä¸€ä¸ªæ–°Emptyé¡¹ç›®ï¼šWSAEventSelectModelã€‚åˆ›å»ºæºæ–‡ä»¶`wsa_event_select.cpp`\nå†…å®¹æš‚æ—¶æ‹·è´`basic_stream_server.cpp`çš„å†…å®¹ã€‚\n## WSACreateEvent åˆ›å»ºEvent\nåœ¨åŸå…ˆæœ‰acceptæ“ä½œçš„whileå¾ªç¯ä¹‹å‰ï¼Œè°ƒç”¨ WSACreateEvent åˆ›å»ºEventã€‚æ— å‚æ•°ï¼Œè¿”å›ç±»å‹ä¸º`HANDLE`ã€‚\n## WSAEventSelectå‡½æ•°\n![](../../images/Windows_ç½‘ç»œæ¨¡å‹/image-20241110043251046.png)\n[WSAEventSelect function (winsock2.h)](https://learn.microsoft.com/en-us/windows/win32/api/winsock2/nf-winsock2-wsaeventselect)\n1. å‚æ•°1ï¼Œå¡«å…¥è¦ä¸eventç»‘å®šçš„socketï¼Œæ¯”å¦‚ï¼šå¦‚æœæˆ‘ä»¬è¦è§‚å¯Ÿä¸€ä¸ªacceptäº‹ä»¶ï¼Œå°±éœ€è¦ç»‘å®š`listen_sock`\n2. å‚æ•°2ï¼Œå¡«å…¥è¦è§‚å¯Ÿçš„eventäº‹ä»¶ã€‚è¿™ä¸ªeventç”¨`WSACreateEvent`åˆ›å»ºã€‚\n3. å‚æ•°3ï¼Œäº‹ä»¶ç±»å‹ï¼Œæ¯”å¦‚ï¼š`FD_ACCEPT`ã€‚\n\n```cpp\n// ...\n    // åˆ›å»ºEvent\n    HANDLE accept_ev = ::WSACreateEvent();\n    // å°†listen_sockå’Œaccept_evç»‘å®š\n    if(SOCKET_ERROR == ::WSAEventSelect(listen_sock, accept_ev, FD_ACCEPT))\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n    while (true)\n    {\n        // accept ...\n    }\n```\n## WSAWaitForMultipleEvents\nåœ¨selectåï¼Œå°±å¯ä»¥ç”¨whileå¾ªç¯ä¸­è°ƒç”¨`WSAWaitForMultipleEvents`ç­‰å¾…Eventsäº†ã€‚ä»£æ›¿äº†åŸå…ˆä»£ç ç®€å•çš„acceptã€‚\nAPIï¼š[WSAWaitForMultipleEvents function (winsock2.h)](https://learn.microsoft.com/en-us/windows/win32/api/winsock2/nf-winsock2-wsawaitformultipleevents)\n![](../../images/Windows_ç½‘ç»œæ¨¡å‹/image-20241110044646204.png)\n1. å‚æ•°1ï¼š`lphEvents`æŒ‡å‘çš„æ•°ç»„ä¸­äº‹ä»¶å¯¹è±¡å¥æŸ„çš„æ•°é‡ã€‚äº‹ä»¶å¯¹è±¡å¥æŸ„çš„æœ€å¤§æ•°é‡ä¸º`WSA_MAXIMUM_WAIT_EVENTS`ã€‚å¿…é¡»æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªäº‹ä»¶ã€‚\n2. å‚æ•°2ï¼šæŒ‡å‘äº‹ä»¶å¯¹è±¡å¥æŸ„æ•°ç»„çš„æŒ‡é’ˆã€‚è¯¥æ•°ç»„å¯ä»¥åŒ…å«ä¸åŒç±»å‹çš„å¯¹è±¡çš„å¥æŸ„ã€‚å¦‚æœ`fWaitAll`å‚æ•°è®¾ç½®ä¸º`TRUE`ï¼Œåˆ™å®ƒå¯èƒ½ä¸åŒ…å«åŒä¸€å¥æŸ„çš„å¤šä¸ªå‰¯æœ¬ã€‚å¦‚æœåœ¨ç­‰å¾…ä»å¤„äºæŒ‚èµ·çŠ¶æ€æ—¶å…³é—­è¿™äº›å¥æŸ„ä¹‹ä¸€ï¼Œåˆ™`WSAWaitForMultipleEvents`çš„è¡Œä¸ºæœªå®šä¹‰ã€‚\n3. æŒ‡å®šç­‰å¾…ç±»å‹çš„å€¼ã€‚å¦‚æœä¸º`TRUE`ï¼Œåˆ™â€‹â€‹å½“`lphEvents`æ•°ç»„ä¸­æ‰€æœ‰å¯¹è±¡çš„çŠ¶æ€å‘å‡ºä¿¡å·æ—¶ï¼Œè¯¥å‡½æ•°è¿”å›ã€‚å¦‚æœä¸º`FALSE`ï¼Œåˆ™å½“ä»»ä½•äº‹ä»¶å¯¹è±¡å‘å‡ºä¿¡å·æ—¶è¯¥å‡½æ•°è¿”å›ã€‚åœ¨åä¸€ç§æƒ…å†µä¸‹ï¼Œè¿”å›å€¼å‡å»`WSA_WAIT_EVENT_0`è¡¨ç¤ºå…¶çŠ¶æ€å¯¼è‡´å‡½æ•°è¿”å›çš„äº‹ä»¶å¯¹è±¡çš„ç´¢å¼•ã€‚å¦‚æœåœ¨è°ƒç”¨æœŸé—´æœ‰å¤šä¸ªäº‹ä»¶å¯¹è±¡å‘å‡ºä¿¡å·ï¼Œåˆ™è¿™æ˜¯å‘å‡ºä¿¡å·çš„äº‹ä»¶å¯¹è±¡çš„æ•°ç»„ç´¢å¼•ï¼Œå…¶ä¸­ç´¢å¼•å€¼æ˜¯æ‰€æœ‰å‘å‡ºä¿¡å·çš„äº‹ä»¶å¯¹è±¡ä¸­æœ€å°çš„ã€‚\n4. è¶…æ—¶é—´éš”ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ã€‚å¦‚æœè¶…æ—¶é—´éš”åˆ°æœŸï¼Œå³ä½¿ä¸æ»¡è¶³`fWaitAll`å‚æ•°æŒ‡å®šçš„æ¡ä»¶ï¼Œ`WSAWaitForMultipleEvents`ä¹Ÿä¼šè¿”å›ã€‚å¦‚æœ`dwTimeout`å‚æ•°ä¸º`0`ï¼Œ`WSAWaitForMultipleEvents`æµ‹è¯•æŒ‡å®šäº‹ä»¶å¯¹è±¡çš„çŠ¶æ€å¹¶ç«‹å³è¿”å›ã€‚å¦‚æœ`dwTimeout`ä¸º`WSA_INFINITE`ï¼Œåˆ™å°†æ°¸è¿œç­‰å¾…ã€‚\n5. æŒ‡å®šçº¿ç¨‹æ˜¯å¦å¤„äºå¯è­¦æŠ¥ç­‰å¾…çŠ¶æ€ï¼Œä»¥ä¾¿ç³»ç»Ÿå¯ä»¥æ‰§è¡Œ I/O å®Œæˆä¾‹ç¨‹ã€‚å¦‚æœä¸º`TRUE \\`ï¼Œåˆ™çº¿ç¨‹å°†ç½®äºå¯è­¦æŠ¥ç­‰å¾…çŠ¶æ€ï¼Œå¹¶ä¸”å½“ç³»ç»Ÿæ‰§è¡Œ I/O å®Œæˆä¾‹ç¨‹æ—¶ï¼Œ`WSAWaitForMultipleEvents`å¯ä»¥è¿”å›ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†è¿”å›`WSA_WAIT_IO_COMPLETION`ï¼Œå¹¶ä¸”å°šæœªå‘å‡ºæ­£åœ¨ç­‰å¾…çš„äº‹ä»¶çš„ä¿¡å·ã€‚åº”ç”¨ç¨‹åºå¿…é¡»å†æ¬¡è°ƒç”¨`WSAWaitForMultipleEvents`å‡½æ•°ã€‚å¦‚æœä¸º`FALSE`ï¼Œåˆ™çº¿ç¨‹ä¸ä¼šç½®äºå¯è­¦æŠ¥ç­‰å¾…çŠ¶æ€ï¼Œå¹¶ä¸”ä¸ä¼šæ‰§è¡Œ I/O å®Œæˆä¾‹ç¨‹ã€‚\n6. è¿”å›å€¼ï¼šå¦‚æœå¤±è´¥ï¼Œåˆ™è¿”å›å€¼ä¸º`WSA_WAIT_FAILED`ã€‚å¦‚æœæˆåŠŸï¼Œåˆ™ä¸ºä»¥ä¸‹ä¹‹ä¸€ã€‚\n    1. `WSA_WAIT_EVENT_0` to `(WSA_WAIT_EVENT_0 + cEvents - 1)`\n    2. `WSA_WAIT_IO_COMPLETION`\n    3. `WSA_WAIT_TIMEOUT`\n\nç”±å‚æ•°2ï¼Œéœ€è¦æŠŠæ¯ä¸€ä¸ªåˆ›å»ºçš„eventæ”¾åˆ°ç»Ÿä¸€çš„æ•°ç»„ä¸­è¿›è¡Œç®¡ç†ã€‚éœ€è¦åœ¨å…¨å±€å®šä¹‰ä¸€ä¸ªvectorã€‚\nè¿˜éœ€è¦æ³¨æ„ï¼Œè™½ç„¶æˆ‘ä»¬å·²ç»ç”¨`WSAEventSelect`ç»‘å®šäº†socketå’Œeventï¼Œä½†æ˜¯`WSAWaitForMultipleEvents`åªèƒ½æ‰¾åˆ°eventå¯¹åº”çš„eventsä¸‹æ ‡å€¼ï¼Œä¸æä¾›socketçš„è¿½æº¯ã€‚\n\nå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦mapé¢å¤–è®°å½•eventå’Œå“ªä¸ªsocketç»‘å®šã€‚\n```cpp\n#include <vector>\nstd::vector<HANDLE> events;\nstd::map<HANDLE, SOCKET> ev_entries;\n```\n\n```cpp\n// ...\n    // WSAEventSelect ...\n    \n    // æŠŠeventæ·»åŠ åˆ°å®¹å™¨ä¸­\n    events.emplace_back(accept_ev);\n    ev_entries[accept_ev] = listen_sock;\n    \n    while (true)\n    {\n        // å‚æ•°3çš„falseè¡¨ç¤ºæœ‰1ä¸ªäº‹ä»¶å°±è¿”å›\n        // WSA_INFINITEè¡¨ç¤ºæ— é™ç­‰å¾…\n        auto res = ::WSAWaitForMultipleEvents(\n            events.size(),\n            events.data(),\n            false,\n            WSA_INFINITE,\n            false);\n        if (int n = res - WSA_WAIT_EVENT_0; n < events.size())\n        {\n            auto event = events[n];\n            auto sock = ev_entries[event];\n            // ...\n        }\n    }\n```\n## WSAEnumNetworkEvents\nåœ¨å¾—åˆ°Waitçš„è¿”å›å€¼åï¼ˆå¹¶ä¸”è®¡ç®—å‡ºäº†indexï¼‰ï¼Œè¿˜éœ€è¦ä½¿ç”¨[WSAEnumNetworkEvents](https://learn.microsoft.com/en-us/windows/desktop/api/winsock2/nf-winsock2-wsaenumnetworkevents)æ£€ç´¢å†…éƒ¨ç½‘ç»œäº‹ä»¶è®°å½•çš„å†…å®¹ï¼Œä»è€Œç¡®å®šå·²å‘ç”Ÿå“ªäº›æŒ‡å®šçš„ç½‘ç»œäº‹ä»¶ã€‚ï¼ˆè§[WSAEventSelect function (winsock2.h)](https://learn.microsoft.com/en-us/windows/win32/api/winsock2/nf-winsock2-wsaeventselect)ä¸­çš„Remarksï¼‰\nå…·ä½“ä»£ç ç¤ºä¾‹å¯è§ï¼š[Enumä»£ç ç¤ºä¾‹](https://learn.microsoft.com/en-us/windows/win32/api/winsock2/nf-winsock2-wsaenumnetworkevents#example-code)\néœ€è¦æ³¨æ„ï¼ŒWSAEnumNetworkEventsçš„å‚æ•°éœ€è¦ç»™å‡ºä¸€ä¸ª`WSANETWORKEVENTS`çš„ç»“æ„ä½“æŒ‡é’ˆï¼Œå‡½æ•°è¦å¡«å……å‘ç”Ÿäº†çš„äº‹ä»¶ã€‚å…·ä½“ç»“æ„å¯çœ‹ï¼š[WSANETWORKEVENTS structure (winsock2.h)](https://learn.microsoft.com/en-us/windows/win32/api/winsock2/ns-winsock2-wsanetworkevents)\n```cpp\n// ...\n    // WSAEventSelect ...\n    \n    // ...\n    \n    WSANETWORKEVENTS network_events{};\n    while (true)\n    {\n        // å‚æ•°3çš„falseè¡¨ç¤ºæœ‰1ä¸ªäº‹ä»¶å°±è¿”å›\n        // WSA_INFINITEè¡¨ç¤ºæ— é™ç­‰å¾…\n        auto res = ::WSAWaitForMultipleEvents(\n            events.size(),\n            events.data(),\n            false,\n            WSA_INFINITE,\n            false);\n        if (int n = res - WSA_WAIT_EVENT_0; n < events.size())\n        {\n            auto event = events[n];\n            auto sock = ev_entries[event];\n            if(SOCKET_ERROR == ::WSAEnumNetworkEvents(sock, event, &network_events))\n            {\n                continue;\n            }\n            if (network_events.lNetworkEvents & FD_ACCEPT)\n            {\n                // ...\n            }\n        }\n    }\n```\n## å¤„ç†äº‹ä»¶\n### acceptï¼šæ˜¾ç¤ºå®¢æˆ·ç«¯ä¿¡æ¯ã€å‘\n```cpp\n// ...\n    // WSAEventSelect ...\n    while (true)\n    {\n        {\n            // WSAEnumNetworkEvents ...\n            \n            // accept\n            if (network_events.lNetworkEvents & FD_ACCEPT)\n            {\n                sockaddr_in client_addr;\n                int addrlen{ sizeof(client_addr) };\n                SOCKET work_sock = accept(sock, reinterpret_cast<sockaddr*>(&client_addr), &addrlen);\n                if (INVALID_SOCKET == work_sock)\n                {\n                    err = ::WSAGetLastError();\n                    continue; // ç»§ç»­ä¸‹ä¸€æ¬¡\n                }\n\n                wchar_t addr_str[46] = L\"\";\n                InetNtopW(AF_INET, reinterpret_cast<void*>(&client_addr.sin_addr), addr_str, 46);\n                std::wstring info = std::format(L\"client address: {}, port: {}\\n\", addr_str, ntohs(client_addr.sin_port));\n                std::wcout << info << std::endl;\n\n                // send ...\n                std::wstring message{ L\"Welcome to server!\" };\n                ::send(\n                    work_sock,\n                    reinterpret_cast<const char*>(message.c_str()),\n                    sizeof(wchar_t) * message.size(),\n                    0);\n```\nåœ¨å®Œæˆæ˜¾ç¤ºå®¢æˆ·ç«¯åœ°å€ã€sendæ¶ˆæ¯çš„å¤„ç†åï¼Œæˆ‘ä»¬è¿˜è¦æƒ³æ–¹è®¾æ³•å®Œæˆæ¥æ”¶å®¢æˆ·ç«¯çš„æ¶ˆæ¯ã€‚\né‚£ä¹ˆå°±éœ€è¦å†åˆ›å»ºä¸€ä¸ªEventï¼ŒæŠ•é€’read eventï¼Œä»¥ä¾¿äºå…³æ³¨readäº‹ä»¶ã€‚\nç°åœ¨å°±éœ€è¦æŠŠ`work_sock`å’Œ`read_event`ç»‘å®šï¼Œå¹¶ä¸”æŠŠè¿™ä¸¤ä¸ªåˆ†åˆ«æ”¾åˆ°mapå’Œvectorå®¹å™¨ä¸­ã€‚\nç­‰ä¸‹ä¸€æ¬¡å¾ªç¯æ—¶ï¼Œå¦‚æœå‡ºç°äº†READäº‹ä»¶ï¼Œåˆ™ä¼šèµ°åˆ°READçš„åˆ†æ”¯ï¼Œè¿›è¡Œå¤„ç†ã€‚\n```cpp\n                // ...\n                \n                // æŠ•é€’ï¼ˆåˆ›å»ºï¼‰read eventï¼Œä»¥ä¾¿äºå…³æ³¨readäº‹ä»¶\n                auto read_event = ::WSACreateEvent();\n                if(SOCKET_ERROR == ::WSAEventSelect(work_sock, read_event, FD_READ))\n                {\n                    err = ::WSAGetLastError();\n                    continue;\n                }\n                events.emplace_back(read_event);\n                ev_entries[read_event] = work_sock;\n            }\n            else if (network_events.lNetworkEvents & FD_READ)\n            {\n                // ...\n            }\n        }\n    }\n```\n### readï¼šæ”¶\næ¥æ”¶å®Œæ¯•åï¼Œè®°å¾—è°ƒç”¨`WSAEventSelect`è¿›è¡Œè§£é™¤ç»‘å®šï¼ŒæŠŠå‚æ•°3ï¼ˆå³å…³æ³¨çš„äº‹ä»¶ï¼‰è®¾ä¸º0å³å¯ã€‚\n```cpp\n#include <algorithm>\n#include <ranges>\n// ...\n    // WSAEventSelect ...\n\n    // ...\n        {\n            // ...\n            else if (network_events.lNetworkEvents & FD_READ)\n            {\n                // recv ...\n                auto work_sock = sock;\n                wchar_t buf[100] = { 0 };\n                int bytes_received = ::recv(work_sock, reinterpret_cast<char*>(buf), sizeof(wchar_t) * sizeof(buf), 0);\n                \n                if (bytes_received > 0)\n                {\n                    std::wcout << buf << std::endl;\n                }\n                else\n                {\n                    err = ::WSAGetLastError();\n                }\n                // è§£é™¤ç»‘å®š\n                ::WSAEventSelect(work_sock, event, 0);\n\n                // clean select ï¼Œå³vectorå’Œmapä¸­åˆ å»event\n                // vectoréœ€è¦ä½¿ç”¨è¿­ä»£å™¨åˆ é™¤\n                auto it = std::ranges::remove_if(\n                    events,\n                    [event](auto&& v) -> bool\n                        { return v == event; });\n                events.erase(it.begin(), it.end());\n                // mapç›´æ¥åˆ é™¤key\n                ev_entries.erase(event);\n\n                ::closesocket(work_sock);\n                work_sock = INVALID_SOCKET;\n            }\n        }\n    }\n\n    ::closesocket(listen_sock);\n    listen_sock = INVALID_SOCKET;\n\n    ::WSACleanup();\n    return 0;\n}\n```\n## æµ‹è¯•\nå¼€å¯ä¸€ä¸ªæœåŠ¡ç«¯ï¼Œ3ä¸ªå®¢æˆ·ç«¯ï¼š\n![](../../images/Windows_ç½‘ç»œæ¨¡å‹/image-20241110162058202.png)\n\n![](../../images/Windows_ç½‘ç»œæ¨¡å‹/image-20241110162108210.png)\n\nå¯ä»¥â€œåŒæ—¶â€æŒ‰é¡ºåºå¤„ç†ã€‚selectçš„å¼‚æ­¥æ•ˆæœå³ä¸ºæ­¤ã€‚ä½†æ˜¯æ­¤ç¨‹åºç›®å‰å¹¶æ²¡æœ‰ç”¨å¤šçº¿ç¨‹ï¼Œè€Œæ˜¯åœ¨å•çº¿ç¨‹ä¸Šçš„æŒ‰é¡ºåºå¿«é€Ÿä¸€å¯¹å¤šå¤„ç†ï¼Œä»è€Œçœ‹èµ·æ¥åƒæ˜¯å¤šçº¿ç¨‹ã€‚\n# Overlapped I/O\nåƒselectä¸€æ ·ï¼Œè¿™ä¹Ÿæ˜¯å¼‚æ­¥çš„ã€‚ä½†æ˜¯ï¼Œselectåªä¼šé€šçŸ¥ä½ æœ‰ä»€ä¹ˆäº‹ä»¶ï¼Œä½ éœ€è¦è‡ªå·±å¤„ç†ã€‚è€Œé‡å çš„æ„æ€åœ¨äºï¼Œä¸ä»…åƒselectä¸€æ ·éé˜»å¡è½®è¯¢ï¼Œå®ƒè¿˜ä¼šå¸®ä½ å¤„ç†äº‹ä»¶ï¼Œæ‰€ä»¥å‡å¦‚æœ‰å¯è¯»äº‹ä»¶æ—¶ï¼Œåœ¨é€šçŸ¥ä½ çš„æ—¶å€™ï¼Œå®ƒå·²ç»å¸®ä½ è¯»å®Œäº†ï¼Œå†…å®¹å­˜åˆ°äº†ç¼“å†²åŒºä¸­ï¼Œåç»­è‡ªå·±å¤„ç†ç¼“å†²åŒºå³å¯ã€‚\n## åˆ›å»ºé¡¹ç›®\nOverlapped I/O ä¸éœ€è¦çª—å£ç¨‹åºï¼Œæ™®é€šçš„æ§åˆ¶å°ç¨‹åºå³å¯ã€‚\nå› æ­¤åˆ›å»ºä¸€ä¸ªæ–°Emptyé¡¹ç›®ï¼šOverlappedIOModelã€‚åˆ›å»ºæºæ–‡ä»¶`overlapped_io.cpp`\n## é¢„å¤‡å·¥ä½œ\nä»éœ€è¦å¯¹WSAè¿›è¡Œå¯åŠ¨ï¼ˆæ—§æ–¹æ³•ï¼‰ã€‚\nç„¶ååˆ›å»ºsocketï¼ˆä¸‹é¢å°†ç”¨æ–°çš„`WSASocket`ä»£æ›¿socketåˆ›å»ºï¼‰ã€‚\nç„¶åæ„å»º`sockaddr_in`åœ°å€ï¼Œå¡«å……ipåœ°å€ã€ç«¯å£å·ï¼ˆæ—§æ–¹æ³•ï¼‰ã€‚\nç„¶å`bind`ã€`listen`ï¼ˆæ—§æ–¹æ³•ï¼‰ã€‚\n```cpp\n#include<WinSock2.h>\n#include<mswsock.h>\n#include<WS2tcpip.h>\n#include<format>\n#include<iostream>\n#pragma comment(lib,\"Ws2_32.lib\")\n#pragma comment(lib, \"Mswsock.lib\")\nint main()\n{\n\tWSADATA wsaData;\n\tint err;\n\tauto wVersionRequested = MAKEWORD(2, 2);\n\terr = ::WSAStartup(wVersionRequested, &wsaData);\n\tif (err != 0) {\n\t\tstd::wcout << std::format(L\"WSAStartup failed with error : {}\\n\", err);\n\t\treturn 1;\n\t}\n\t\n\t// new function\n\tSOCKET listen_sock = ::WSASocket(AF_INET, SOCK_STREAM, IPPROTO_TCP, nullptr, 0, WSA_FLAG_OVERLAPPED);\n\tif (listen_sock == INVALID_SOCKET)\n\t{\n\t\terr = ::WSAGetLastError();\n\t\treturn 1;\n\t}\n\t// bind and listen, old funtion\n\tsockaddr_in server_addr;\n\tserver_addr.sin_family = AF_INET;\n\tif (1 != ::inet_pton(AF_INET, \"127.0.0.1\", &server_addr.sin_addr))\n\t{\n\t\terr = ::WSAGetLastError();\n\t\treturn 1;\n\t}\n\tserver_addr.sin_port = htons(9008);\n\n\tif (SOCKET_ERROR == ::bind(listen_sock,\n\t\treinterpret_cast<const sockaddr*>(&server_addr),\n\t\tsizeof(server_addr)))\n\t{\n\t\terr = ::WSAGetLastError();\n\t\treturn 1;\n\t}\n\n\tif (SOCKET_ERROR == ::listen(listen_sock, SOMAXCONN))\n\t{\n\t\terr = ::WSAGetLastError();\n\t\treturn 1;\n\t}\n\t// ...\n}\n```\n## socketçš„åˆ›å»ºï¼šWSASocket\nä¸å†ä½¿ç”¨ä¼¯å…‹åˆ©APIï¼Œè€Œæ˜¯ä½¿ç”¨å¾®è½¯å¼‚æ­¥æ¨¡å‹APIï¼šWSASocketã€‚\nåœ¨å¾®è½¯å®˜æ–¹æ‰‹å†Œä¸­ï¼Œæœ‰WSASocketAå’ŒWSASocketWã€‚åœ¨å®é™…ä»£ç ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸å¸¦åç¼€çš„WSASocketã€‚\n[WSASocketA function (winsock2.h)](https://learn.microsoft.com/en-us/windows/win32/api/winsock2/nf-winsock2-wsasocketa)\n![](../../images/Windows_ç½‘ç»œæ¨¡å‹/image-20241111115511444.png)\n1. `af`å³åœ°å€å®¶æ—ï¼Œå¡«`AF_INET`\n2. `type`ï¼Œå¡«`SOCK_STREAM`\n3. `protocol`ï¼Œå¡«`IPPROTO_TCP`\n4. `lpProtocolInfo`ï¼Œæš‚æ—¶ä¸ç”¨ï¼Œå¡«nullptr\n5. `g`ï¼Œæš‚æ—¶ä¸ç”¨ï¼Œå¡«0\n6. `dwFlags`ï¼Œå¯¹åº”è¦èµ‹äºˆsocketçš„ç‰¹æ€§ã€‚å¡«`WSA_FLAG_OVERLAPPED`\n7. è¿”å›ç±»å‹ï¼šsocketã€‚\n## AcceptEx\nOverlapped I/O ä¸ä¹‹å‰çš„acceptæµç¨‹ä¸åŒçš„æ˜¯ï¼Œä¸éœ€è¦å†æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªEventï¼Œä¹Ÿå°±ä¸éœ€è¦æ‰‹åŠ¨ç»‘å®ševentå’Œsocketï¼Œè€Œä½ åªéœ€è¦æä¾›å„ç§å‚æ•°ï¼Œç„¶åå…¨éƒ¨é›†ä¸­åˆ°AcceptExå¤„ç†ã€‚\n\nè¿™ä¸ªå‡½æ•°åœ¨`winsock.h`å’Œ`mswsock.h`å‡æœ‰å®šä¹‰ã€‚ä½†æ˜¯å®é™…ä½¿ç”¨æ—¶ï¼Œè‹¥å¼•ç”¨çš„æ˜¯`winsock.h`ç¼–è¯‘å™¨ä¸è®¤è¯†è¯¥å‡½æ•°åã€‚æ‰€ä»¥åº”è¯¥å¼•ç”¨`mswsock.h`ã€‚\næ³¨æ„ï¼Œåœ¨buildæ—¶ï¼Œéœ€è¦åŠ `#pragma comment(lib, \"Mswsock.lib\")`ï¼Œå¦åˆ™é“¾æ¥å™¨ä¸è®¤è¯†ã€‚\n![](../../images/Windows_ç½‘ç»œæ¨¡å‹/image-20241112032857824.png)\n![](../../images/Windows_ç½‘ç»œæ¨¡å‹/image-20241112033045279.png)\nè¿™ä¸ªå‡½æ•°ä¸ä»…ä¼šå¸®æœåŠ¡ç«¯æ¥æ”¶ä¸€ä¸ªæ–°è¿æ¥ï¼Œè¿˜ä¼šå‘å‚æ•°å¡«å……å®¢æˆ·ç«¯çš„åœ°å€ï¼Œä»¥åŠå¤„ç†è¯»å–å®¢æˆ·ç«¯å‘é€çš„ç¬¬ä¸€ä¸ªæ•°æ®å—ã€‚è¿™ç§ä¸€æ¬¡æ€§å°±å¤„ç†äº†å¾ˆå¤šå·¥ä½œçš„å‡½æ•°ï¼Œå°±æ˜¯é‡å I/Oæ¨¡å¼ã€‚\n![](../../images/Windows_ç½‘ç»œæ¨¡å‹/image-20241112033415192.png)\n1. sListenSocketï¼Œå³ç¬¬ä¸€æ­¥åˆ›å»ºå¥½çš„`listen_sock`\n2. sAcceptSocketï¼Œè¿˜éœ€è¦å•ç‹¬é¢„åˆ›å»ºä¸€ä¸ª`work_sock`ï¼Œä¸èƒ½æ˜¯ç»‘å®šäº†çš„ã€è¿æ¥äº†çš„ï¼Œè€Œæ˜¯ç”±æœ¬å‡½æ•°åœ¨è°ƒç”¨åå¸®ä½ å¡«å……å¥½ã€‚\n3. 3\n4. 4\n5. 5\n6. 6\n7. 7\n8. lpOverlappedï¼Œè¿™ä¸ªç»“æ„ä½“ä¸­åŒ…å«äº†eventã€‚\n### æœ€åä¸€ä¸ªå‚æ•°ï¼šå¦‚ä½•ä¸Eventç»“åˆ\næœ€åä¸€ä¸ªå‚æ•°æ¯”è¾ƒé‡è¦ï¼šlpOverlappedï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªOVERLAPPEDç»“æ„ï¼Œå†åœ¨é‡Œé¢çš„hEventæˆå‘˜æ„å»ºEventï¼Œä»è€Œè¿›è¡Œäº‹ä»¶çš„ç»‘å®šã€‚\n### è¿”å›å€¼\nå¦‚æœå¤±è´¥ï¼Œè¿”å›FALSE ã€‚ç„¶åå¯ä»¥è°ƒç”¨`WSAGetLastError`å‡½æ•°æ¥è¿”å›é”™è¯¯ä¿¡æ¯ã€‚å¦‚æœ`WSAGetLastError`è¿”å›`ERROR_IO_PENDING` ï¼Œåˆ™æ“ä½œå·²æˆåŠŸå¯åŠ¨å¹¶ä¸”ä»åœ¨è¿›è¡Œä¸­ã€‚å¦‚æœé”™è¯¯æ˜¯`WSAECONNRESET`ï¼Œåˆ™è¯´æ˜ä¼ å…¥äº†è¿æ¥ï¼Œä½†éšååœ¨æ¥å—å‘¼å«ä¹‹å‰è¢«è¿œç¨‹æ–¹ç»ˆæ­¢ã€‚\n### ç¨‹åº\n```cpp\n    // ...\n\n\t// create a socket to accept by AcceptEx\n\tSOCKET work_sock = ::WSASocket(AF_INET, SOCK_STREAM, IPPROTO_TCP, nullptr, 0, WSA_FLAG_OVERLAPPED);\n\n\tchar* address_buf = new char[sizeof(sockaddr_in) * 2 + 32];\n\t\n\tDWORD length_received{ 0 };\n\t\n\tOVERLAPPED ovl;\n\tovl.hEvent = ::WSACreateEvent();\n\t\n\tbool res = AcceptEx(\n\t\tlisten_sock,\n\t\twork_sock,\n\t\taddress_buf,\n\t\t0,\n\t\tsizeof(sockaddr_in) + 16,\n\t\tsizeof(sockaddr_in) + 16,\n\t\t&length_received,\n\t\t&ovl);\n\tif (!res)\n\t{\n\t\tif (ERROR_IO_PENDING != ::WSAGetLastError())\n\t\t{\n\t\t\treturn 1;\n\t\t}\n\t}\n\n\t::closesocket(listen_sock);\n\tlisten_sock = INVALID_SOCKET;\n\t::WSACleanup();\n\treturn 0;\n}\n```\nå¯ä»¥è¿›è¡Œæµ‹è¯•ï¼Œæ–­ç‚¹æ‰“åœ¨`if (!res)`ä½ç½®ã€‚\næ ¹æ®æ‰‹å†Œï¼š[è¿”å›å€¼](#è¿”å›å€¼)ï¼Œå¦‚æœAcceptExè¿”å›falseï¼Œä½†é”™è¯¯ä¿¡æ¯æ˜¯`ERROR_IO_PENDING`æ—¶ï¼Œä¹Ÿç®—æ˜¯å¯åŠ¨æˆåŠŸçš„ï¼Œåªæ˜¯ä»åœ¨è¿›è¡Œä¸­ã€‚\n## ç»“åˆevent\næ ¹æ®[æœ€åä¸€ä¸ªå‚æ•°ï¼šå¦‚ä½•ä¸Eventç»“åˆ](#æœ€åä¸€ä¸ªå‚æ•°ï¼šå¦‚ä½•ä¸Eventç»“åˆ)ã€‚\næ•ˆä»¿[WSAEventSelect](#WSAEventSelect)ï¼Œéœ€è¦æå‰æ„å»ºvectorå®¹å™¨æ¥ç®¡ç†eventã€‚\n```cpp\n#include <vector>\n#include <map>\nstd::vector<HANDLE>      events;\nstd::map<HANDLE, SOCKET> ev_entries;\n```\n\nä¹‹åï¼Œä¾¿å¯ä»¥åœ¨AcceptExæˆåŠŸä¹‹åçš„ä½ç½®ï¼Œå‘å®¹å™¨æŠ•å…¥eventã€‚\n```cpp\n// ...\n{\n    // ...\n    OVERLAPPED ovl;\n\tovl.hEvent = ::WSACreateEvent();\n\t\n\tbool res = AcceptEx(\n\t\tlisten_sock,\n\t\twork_sock,\n\t\taddress_buf,\n\t\t0,\n\t\tsizeof(sockaddr_in) + 16,\n\t\tsizeof(sockaddr_in) + 16,\n\t\t&length_received,\n\t\t&ovl);\n\tif (!res)\n\t{\n\t\tif (ERROR_IO_PENDING != ::WSAGetLastError())\n\t\t{\n\t\t\treturn 1;\n\t\t}\n\t}\n\n    events.emplace_back(ovl.hEvent);\n    ev_entries[ovl.hEvent] = listen_sock;\n}\n```\n## å°è£…Entryç»“æ„ç®¡ç† WSAGetOverlappedResult æ‰€éœ€å±æ€§\nä»¥å¾€çš„`ev_entries`æ˜¯ç®¡ç†`<HANDLE, SOCKET>`ï¼Œä¸ºäº†ä¾¿äºç®¡ç†åœ¨OverlappedIOä¸‹çš„äº‹ä»¶å¯¹åº”çš„æ¯ä¸€ä¸ªSOCKETçš„å…¶ä»–å±æ€§ï¼ŒæŠŠè¿™äº›å±æ€§éƒ½å°è£…åœ¨Entryä¸­ã€‚åˆ™æ”¹è¿›ä¸º`ev_entries`ç®¡ç†`<HANDLE, Entry>`ã€‚\n```cpp\nenum class EventType\n{\n    ET_ACCEPT = 0,\n    ET_READ\n};\nclass Entry\n{\npublic:\n    EventType       _event_type;\n    SOCKET          _listen_sock;\n    SOCKET          _work_sock;\n    char*           _buf{ nullptr };\n    WSAOVERLAPPED   _ovl;\n};\nstd::vector<HANDLE>     events;\nstd::map<HANDLE, Entry> ev_entries;\n```\nåˆ™åœ¨AcceptExåçš„å‘mapå®¹å™¨æ·»åŠ valueå°±è¦æ”¹ä¸º\n```cpp\n{\n    // ...\n\tOVERLAPPED ovl;\n\tovl.hEvent = ::WSACreateEvent();\n\tbool res = AcceptEx(\n\t\tlisten_sock,\n\t\twork_sock,\n\t\taddress_buf,\n\t\t0,\n\t\tsizeof(sockaddr_in) + 16,\n\t\tsizeof(sockaddr_in) + 16,\n\t\t&length_received,\n\t\t&ovl);\n\tif (!res)\n\t{\n\t\tif (ERROR_IO_PENDING != ::WSAGetLastError())\n\t\t{\n\t\t\treturn 1;\n\t\t}\n\t}\n\n\tevents.emplace_back(ovl.hEvent);\n    ev_entries[ovl.hEvent] = { EventType::ET_ACCEPT, listen_sock, work_sock, address_buf, ovl };\n\n    // ...\n}\n```\n\n>è¿™é‡Œçš„ç¨‹åºæœ‰é”™è¯¯ï¼Œä¼šå¯¼è‡´åç»­çš„WSAGetOverlappedResulté”™è¯¯ã€‚è§[ovlçš„å¼•ç”¨é”™è¯¯](#ovlçš„å¼•ç”¨é”™è¯¯)\n## whileå¾ªç¯ WSAWaitForMultipleEvents\nå‰æœŸå·¥ä½œå‡†å¤‡å¥½äº†ï¼Œåé¢è¿˜æ˜¯whileå¾ªç¯ä¸­è¿›è¡Œ`WSAWaitForMultipleEvents`ã€‚é€šè¿‡å…¶è¿”å›å€¼ï¼Œæ‰¾åˆ°eventsä¸‹æ ‡ï¼Œæ‰¾åˆ°eventã€‚ç„¶åé€šè¿‡mapæŸ¥è¯¢`ev_entries`ä¹‹å‰è®°å½•çš„å¯¹åº”eventçš„`listen_sock`ç­‰ä¿¡æ¯ã€‚\n## WSAGetOverlappedResult\n[WSAGetOverlappedResult function (winsock2.h)](https://learn.microsoft.com/en-us/windows/win32/api/winsock2/nf-winsock2-wsagetoverlappedresult)\n![](../../images/Windows_ç½‘ç»œæ¨¡å‹/image-20241114073646147.png)\n1. å‚æ•°1ï¼Œå¡«å…¥eventå¯¹åº”çš„socket\n2. å‚æ•°2ï¼Œå¡«å…¥eventå¯¹åº”çš„lpOverlappedã€‚è¿™ä¸ªå·²ç»åœ¨AcceptExä¹‹å‰å°±åˆ›å»ºå¥½äº†çš„ï¼ŒAcceptExç”¨è¿‡ã€‚è§ï¼š[æœ€åä¸€ä¸ªå‚æ•°ï¼šå¦‚ä½•ä¸Eventç»“åˆ](#æœ€åä¸€ä¸ªå‚æ•°ï¼šå¦‚ä½•ä¸Eventç»“åˆ)\n\nWSAWaitForMultipleEventsæ‰¾åˆ°eventåï¼Œå°±éœ€è¦è°ƒç”¨`WSAGetOverlappedResult`çœ‹æ˜¯å¦æˆåŠŸã€‚æˆåŠŸæ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚\n```cpp\n    // AcceptEx ...\n    while (true)\n    {\n        // å‚æ•°3çš„falseè¡¨ç¤ºæœ‰1ä¸ªäº‹ä»¶å°±è¿”å›\n        // WSA_INFINITEè¡¨ç¤ºæ— é™ç­‰å¾…\n        auto res = ::WSAWaitForMultipleEvents(\n            events.size(),\n            events.data(),\n            false,\n            WSA_INFINITE,\n            false);\n        if (int n = res - WSA_WAIT_EVENT_0; n < events.size())\n        {\n            auto event = events[n];\n            // structure bind\n            auto [event_type, listen_sock, work_sock, buf, ovl] = ev_entries[event];\n            DWORD bytes_received{ 0 };\n            DWORD flags{ 0 };\n            if (!::WSAGetOverlappedResult(\n                listen_sock,\n                &ovl,\n                &bytes_received,\n                false,\n                &flags))\n            {\n                err = ::WSAGetLastError();\n                continue;\n            }\n\n            // accept ...\n```\n### ovlçš„å¼•ç”¨é”™è¯¯\næˆ‘ä»¬åé¢å‘ç°ï¼Œ`WSAGetOverlappedResult(listen_sock, &ovl, ...)`ä¼šäº§ç”Ÿé”™è¯¯ã€‚\nè¿™å’Œ`ovl`çš„é”™è¯¯ä½¿ç”¨ç›¸å…³ã€‚å› ä¸ºè¿™é‡Œäº§ç”Ÿäº†ovlå¤åˆ¶ï¼Œè€Œåç»­ä½¿ç”¨çš„æ˜¯mapå®¹å™¨ä¸­valueçš„`_ovl`ï¼Œå› æ­¤ï¼Œåº”è¯¥ä¼ å®é™…çš„mapå®¹å™¨ä¸­`_ovl`çš„åœ°å€ã€‚\n>è°ƒç”¨ `AcceptEx` åï¼Œå¼‚æ­¥æ“ä½œçš„å®Œæˆä¼šå…³è”åˆ°ä½ ä¼ å…¥çš„ `OVERLAPPED` ç»“æ„ï¼ˆå³ `&ovl`ï¼‰ã€‚ä½†æ˜¯åœ¨ä¸»å¾ªç¯ä¸­ï¼Œä½ ä½¿ç”¨ `WSAGetOverlappedResult` è·å–ç»“æœæ—¶ï¼Œä½¿ç”¨çš„æ˜¯ `ev_entries[ovl.hEvent]._ovl` ä¸­çš„ `OVERLAPPED` ç»“æ„ã€‚è¿™ä¸ªä¸ä¸€è‡´ä¼šå¯¼è‡´ `WSAGetOverlappedResult` åœ¨ä¸€ä¸ªä¸åŒçš„ `OVERLAPPED` ç»“æ„ä¸Šæ“ä½œï¼Œä»è€Œå¼•å‘é”™è¯¯ã€‚\n>\n>**ä¼ å…¥çš„ `OVERLAPPED` ç»“æ„çš„ä½œç”¨**ï¼š`OVERLAPPED` ç»“æ„ç”¨äºå­˜å‚¨å¼‚æ­¥æ“ä½œçš„çŠ¶æ€ã€‚å®ƒä¸ä¼šç«‹å³åœ¨ `AcceptEx` è°ƒç”¨æ—¶è¢«ä¿®æ”¹ï¼Œä½†å½“æ“ä½œå®Œæˆæ—¶ï¼ŒWindows ä¼šåœ¨ `OVERLAPPED` ç»“æ„ä¸­å†™å…¥æ“ä½œçš„å®ŒæˆçŠ¶æ€ã€‚\n>\n\nåº”è¯¥è°ƒæ•´ä¸ºä»¥ä¸‹é¡ºåºï¼šå¹¶ä¸”è¦æ³¨æ„AcceptExæœ€åä¸€ä¸ªå‚æ•°åº”è¯¥é’ˆå¯¹çš„æ˜¯`&ev_entries[ovl.hEvent]._ovl`ã€‚\n```cpp\n// ...\n{\n    // ...\n    OVERLAPPED ovl;\n\tovl.hEvent = ::WSACreateEvent();\n    events.emplace_back(ovl.hEvent);\n    ev_entries[ovl.hEvent] = { EventType::ET_ACCEPT, listen_sock, work_sock, address_buf, ovl };\n\tbool res = AcceptEx(\n\t\tlisten_sock,\n\t\twork_sock,\n\t\taddress_buf,\n\t\t0,\n\t\tsizeof(sockaddr_in) + 16,\n        sizeof(sockaddr_in) + 16,\n\t\t&length_received,\n\t\t&ev_entries[ovl.hEvent]._ovl);\n\tif (!res)\n\t{\n\t\tif (ERROR_IO_PENDING != ::WSAGetLastError())\n\t\t{\n\t\t\treturn 1;\n\t\t}\n\t}\n}\n```\n## æˆåŠŸä¹‹åï¼Œå¯ä»¥åˆ†æ”¯å¤„ç†äº‹ä»¶\n```cpp\n    // ...\n    while (true)\n    {\n        // WSAWaitForMultipleEvents ...\n\n        if (...)\n        {\n            // ...\n            // WSAGetOverlappedResult ...\n\n            if (event_type == EventType::ET_ACCEPT)\n            {\n                // sock from above ev_entries[event]\n                sockaddr_in client_addr = *reinterpret_cast<sockaddr_in const*>(buf + sizeof(sockaddr_in) + 16);\n                \n                if (INVALID_SOCKET == work_sock)\n                {\n                    err = ::WSAGetLastError();\n                    continue; // ç»§ç»­ä¸‹ä¸€æ¬¡\n                }\n                \n                // display the info about client\n                wchar_t addr_str[46] = L\"\";\n                InetNtopW(AF_INET, reinterpret_cast<void*>(&client_addr.sin_addr), addr_str, 46);\n                std::wstring info = std::format(L\"client address: {}, port: {}\", addr_str, ntohs(client_addr.sin_port));\n                std::wcout << info << std::endl;\n                \n                // send ...\n                std::wstring message{ L\"Welcome to server!\" };\n                ::send(\n                    work_sock,\n                    reinterpret_cast<const char*>(message.c_str()),\n                    sizeof(wchar_t) * message.size(),\n                    0);\n\n                // è§£é™¤ç»‘å®š\n                ::WSAEventSelect(listen_sock, event, 0);\n                // clean select ï¼Œä½¿ç”¨è¿­ä»£å™¨åˆ é™¤event\n                auto it = std::ranges::remove_if(events, [event](auto&& v) -> bool { return v == event; });\n                events.erase(it.begin(), it.end());\n                ev_entries.erase(event);\n                \n                // ä¸ºæ¥æ”¶æ¶ˆæ¯åšå‡†å¤‡\n                auto read_event = ::WSACreateEvent();\n                if (SOCKET_ERROR == ::WSAEventSelect(work_sock, read_event, FD_READ))\n                {\n                    err = ::WSAGetLastError();\n                    continue;\n                }\n                events.emplace_back(read_event);\n                ev_entries[read_event] = { EventType::ET_READ, listen_sock, work_sock, address_buf, ovl };\n            }\n            else if (event_type == EventType::ET_READ)\n            {\n                // recv ...\n                wchar_t buf[100] = { 0 };\n                int bytes_received = ::recv(work_sock, reinterpret_cast<char*>(buf), sizeof(wchar_t) * sizeof(buf), 0);\n\n                if (bytes_received > 0)\n                {\n                    std::wcout << buf << std::endl;\n                }\n                else\n                {\n                    err = ::WSAGetLastError();\n                }\n                // è§£é™¤ç»‘å®š\n                ::WSAEventSelect(work_sock, event, 0);\n                // clean select ï¼Œä½¿ç”¨è¿­ä»£å™¨åˆ é™¤event\n                auto it = std::ranges::remove_if(events, [event](auto&& v) -> bool { return v == event; });\n                events.erase(it.begin(), it.end());\n                ev_entries.erase(event);\n\n                ::closesocket(work_sock);\n                work_sock = INVALID_SOCKET;\n            }\n        }\n    }\n\t::closesocket(listen_sock);\n\tlisten_sock = INVALID_SOCKET;\n\t::WSACleanup();\n\treturn 0;\n}\n```\n# IOCPï¼ˆIO Completion Portï¼‰\néé˜»å¡æ¨¡å‹ã€å¼‚æ­¥IOæ¨¡å‹ã€‚å¼‚æ­¥æŒ‡å¸®åŠ©ä½ ä¼ æ•°æ®ã€‚é™¤ä¸Šé¢å¤–çš„ç‰¹æ®Šç‚¹åœ¨äºï¼Œå®ƒå†…éƒ¨è¿˜å»ºç«‹äº†çº¿ç¨‹æ± ï¼Œè®©è¯»å†™æ•°æ®æ›´åŠ å¿«é€Ÿã€‚\nè€ŒIOCPéœ€è¦åŸºäºOverlapped I/Oä½¿ç”¨ï¼Œæ¯”å¦‚éœ€è¦ç”¨åˆ°AccpetExã€‚\n## åˆ›å»ºé¡¹ç›®\nEmptyé¡¹ç›®ï¼Œå–åIOCPModelã€‚\nåˆ›å»ºæºæ–‡ä»¶`iocp.cpp`ã€‚\n## CreateIoCompletionPort åˆ›å»ºæ–°çš„IOCP\n![](../../images/Windows_ç½‘ç»œæ¨¡å‹/image-20241113064337406.png)\n1. å‚æ•°1ï¼Œéœ€è¦ç»™å®ƒä¸€ä¸ªæ‰“å¼€äº†çš„æ–‡ä»¶Handleï¼Œæˆ–è€…`INVALID_HANDLE_VALUE`ã€‚åœ¨æˆ‘ä»¬æƒ³è¦é¢„åˆ›å»ºä¸€ä¸ªCPï¼ˆCompletion Portï¼‰æ—¶ï¼Œå¯ä»¥å…ˆç»™å‡º`INVALID_HANDLE_VALUE`ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ç©ºçš„ï¼Œéšåå†è¡¥ä¸Šå³å¯ã€‚å¦‚æœç»™å‡º`INVALID_HANDLE_VALUE`ï¼Œé‚£ä¹ˆå‚æ•°2å¿…é¡»ç»™`nullptr`ã€‚\n2. å‚æ•°2ï¼Œå¡«ä¸€ä¸ªåˆ›å»ºå¥½äº†çš„iocpçš„HANDLEï¼›å¦‚æœåŸå…ˆæ²¡æœ‰æœ‰æ•ˆçš„IOCPï¼Œåˆ™å¯ä»¥å¡«`nullptr`ã€‚\n3. å‚æ•°3ï¼ŒCompletion Keyï¼Œä¸­æ–‡å«ä½œå®Œæˆé”®ã€‚æ¯ä¸ªå¥æŸ„éƒ½å¯¹åº”ä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„å®Œæˆé”®ï¼ˆå®é™…ä¸Šå°±æ˜¯æ¯ä¸ªsocketç»™ä¸€ä¸ªåç§°ï¼‰ï¼Œç”¨æˆ·å®šä¹‰çš„å®Œæˆé”®å®é™…ä¸Šå°±æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„ç»“æ„ä½“ï¼Œå†…å®¹åŒ…å«ä½ éœ€è¦çš„ä¸œè¥¿ã€‚å¯ä»¥å…ˆå¡«`0`ã€‚\n4. å‚æ•°4ï¼Œ`NumberOfConcurrentThreads`ï¼ŒæŒ‡ç¤ºéœ€è¦å¼€è¾Ÿå¤šå°‘çº¿ç¨‹ã€‚å¦‚æœæ­¤å‚æ•°ä¸º0ï¼Œåˆ™ç³»ç»Ÿå…è®¸å¹¶å‘çº¿ç¨‹æ•°é‡ä¸ç³»ç»Ÿä¸­çš„å¤„ç†å™¨æ•°é‡ä¸€æ ·å¤šã€‚\n5. è¿”å›å€¼\n    1. å¦‚æœ`ExistingCompletionPort`å‚æ•°ä¸º`NULL`ï¼Œåˆ™è¿”å›å€¼æ˜¯æ–°å¥æŸ„ã€‚\n    2. å¦‚æœ`ExistingCompletionPort`å‚æ•°æ˜¯æœ‰æ•ˆçš„ IOCP å¥æŸ„ï¼Œåˆ™è¿”å›å€¼æ˜¯åŒä¸€å¥æŸ„ã€‚\n    3. å¦‚æœ`FileHandle`å‚æ•°æ˜¯æœ‰æ•ˆå¥æŸ„ï¼Œåˆ™è¯¥æ–‡ä»¶å¥æŸ„ç°åœ¨ä¸è¿”å›çš„ IOCP å…³è”ã€‚\n    4. å¦‚æœå¤±è´¥ï¼Œè¿”å›å€¼ä¸º`NULL`ã€‚è¦è·å–æ‰©å±•é”™è¯¯ä¿¡æ¯ï¼Œè°ƒç”¨`GetLastError`å‡½æ•°ï¼ˆä¸å¸¦WSAå‰ç¼€ï¼‰ã€‚\n\nåœ¨ç¨‹åºç»“æŸä¹‹å‰ï¼Œéœ€è¦`CloseHandle(iocp); iocp = nullptr;`ã€‚\n```cpp\nHANDLE iocp{ nullptr };\nint main()\n{\n    iocp = ::CreateIoCompletionPort(INVALID_HANDLE_VALUE, nullptr, 0, 0);\n\n    // ...\n    ::CloseHandle(iocp);\n    iocp = nullptr;\n    // ...\n}\n```\n## çº¿ç¨‹å‡½æ•°\niocpéœ€è¦é…åˆçº¿ç¨‹æ‰èƒ½è¿›è¡Œå·¥ä½œï¼Œé‚£ä¹ˆå°±éœ€è¦æŒ‡å®šä¸€ä¸ªçº¿ç¨‹å‡½æ•°ã€‚\n## GetQueuedCompletionStatus\n![](../../images/Windows_ç½‘ç»œæ¨¡å‹/image-20241113071012878.png)\n1. å‚æ•°1ï¼Œå¡«ä¸Šé¢å·²ç»åˆ›å»ºå¥½çš„iocpï¼Œæ¯ä¸ªiocpéƒ½æœ‰ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œè¿™ä¸ªå‚æ•°æŒ‡ç¤ºäº†çº¿ç¨‹ä»å“ªä¸ªç­‰å¾…é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚\n2. å‚æ•°2ï¼Œ`lpNumberOfBytesTransferred`ï¼Œæ„ä¸ºï¼šæœ‰å¤šå°‘ä¸ªæ•°æ®ä¼ é€’äº†ï¼Ÿ\n3. å‚æ•°3ï¼Œ`lpCompletionKey`ï¼Œå®Œæˆé”®çš„æŒ‡é’ˆç±»å‹ã€‚æœ¬å‚æ•°æ˜¯outç±»ï¼Œæ˜¯2çº§æŒ‡é’ˆã€‚æ˜¯å‡½æ•°è¦å›å†™çš„ï¼Œå› æ­¤éœ€è¦å¡«CompletionKeyçš„2çº§æŒ‡é’ˆã€‚è€ŒlpCompletionKeyåŸæœ¬æ˜¯1çº§æŒ‡é’ˆï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå‚æ•°ç±»å‹ç»™å‡ºäº†`PULONG_PTR`ï¼Œè¿™åˆæ˜¯ä¸€ä¸ªä¸€çº§æŒ‡é’ˆç±»å‹ï¼Œå› æ­¤æ•´ä½“å°±è¡¨ç¤º2çº§æŒ‡é’ˆã€‚\n4. å‚æ•°4ï¼Œ`lpOverlapped`ï¼Œæœ¬å‚æ•°ä¹Ÿæ˜¯outç±»ï¼Œä¹Ÿæ˜¯2çº§æŒ‡é’ˆï¼Œä½†ä¸ä¸Šé¢çš„è¡¨ç¤ºæ–¹æ³•ä¸åŒï¼Œåœ¨`LPOVERLAPPED`æ˜¯1çº§æŒ‡é’ˆçš„åŸºç¡€ä¸Šï¼ŒåˆåŠ äº†ä¸ª`*`åç¼€ï¼Œå› æ­¤æ•´ä½“è¡¨ç¤º2çº§æŒ‡é’ˆã€‚\n5. å‚æ•°5ï¼Œ`dwMilliseconds`ï¼Œç­‰å¾…å¤šå°‘ç§’ã€‚å¯ä»¥å¡«`INFINITE`ã€‚\n6. è¿”å›å€¼ï¼šæˆåŠŸåˆ™è¿”å›é0ï¼Œå¦åˆ™è¿”å›0ã€‚\n\n```cpp\nvoid worker(void)\n{\n\tDWORD bytes_transferred{ 0 };\n\tULONG_PTR completion_key;\n\tLPOVERLAPPED povl{ nullptr };\n\twhile (true)\n\t{\n\t\tbool succeed = ::GetQueuedCompletionStatus(iocp, &bytes_transferred, &completion_key, &povl, INFINITE);\n\t\tif (!succeed)\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t}\n}\n```\n## Entry å®Œæˆé”®\n>è¿™é‡Œä¸ºä»€ä¹ˆè¦è®¾è®¡æˆä¸€å®šè¦å¤šå‡ºä¸€ä¸ªsocketçš„ä½ç½®å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬å‘ç°åœ¨æ¯æ¬¡æœ€åæƒ³è¦å‘å‡ºä¸‹ä¸€ä¸ªAcceptExæ—¶ï¼Œéœ€è¦å†æ¬¡å¡«å…¥`listen_sock`ã€‚å¦‚æœæˆ‘ä»¬åªæœ‰`work_sock`ï¼Œåˆ™ä¼šå¾ˆéº»çƒ¦ã€‚\n\n```cpp\nenum class EventType\n{\n    ET_ACCEPT = 0,\n    ET_READ\n};\nclass Entry\n{\npublic:\n    EventType       _event_type;\n    SOCKET          _listen_sock;\n    SOCKET          _work_sock;\n    char*           _buf{ nullptr };\n    WSAOVERLAPPED   _ovl;\n};\n```\næˆ‘ä»¬éœ€è¦åœ¨AcceptExä¹‹å‰åˆ›å»ºå®Œæˆé”®\n```cpp\n// ...\n    // overlapped pattern\n    SOCKET work_sock = ::WSASocket(AF_INET, SOCK_STREAM, IPPROTO_TCP, nullptr, 0, WSA_FLAG_OVERLAPPED);\n\n    char* address_buf = new char[sizeof(sockaddr_in) * 2 + 32];\n    DWORD length_received{ 0 };\n    OVERLAPPED ovl;\n    ovl.hEvent = ::WSACreateEvent();\n\n    // åˆ›å»ºentry\n    Entry* entry = new Entry{ EventType::ET_ACCEPT, listen_sock, work_sock, address_buf, ovl };\n\n    bool res = AcceptEx(\n        listen_sock,\n        work_sock,\n        address_buf,\n        0,\n        sizeof(sockaddr_in) + 16,\n        sizeof(sockaddr_in) + 16,\n        &length_received,\n        &entry->_ovl);  // æœ€åä¸€ä¸ªå‚æ•°ç”¨çš„æ˜¯entryä¸­çš„_ovl\n\n    if (!res)\n    {\n        if (ERROR_IO_PENDING != ::WSAGetLastError())\n        {\n            return 1;\n        }\n    }\n    // ...\n```\néšåï¼Œåˆ›å»ºIOCP\n## CreateIoCompletionPort å…³è”å·²æœ‰çš„IOCP\nå‚æ•°1å¡«å†™`listen_sock`ï¼Œå‚æ•°2å¡«å†™ä¸€å¼€å§‹åˆ›å»ºçš„ç©ºçš„IOCPï¼Œå‚æ•°3å¡«å†™åˆšæ‰åˆ›å»ºå¥½çš„å®Œæˆé”®ï¼Œå‚æ•°4å¡«0ã€‚\nç”±äºå‚æ•°ç±»å‹é™åˆ¶ï¼Œéœ€è¦ç”¨`reinterpret_cast`è½¬æ¢ä¸ºå¯¹åº”çš„ç±»å‹ã€‚\n```cpp\n    // AcceptEx...\n    auto old_iocp = ::CreateIoCompletionPort(\n        reinterpret_cast<HANDLE>(listen_sock),\n        iocp,\n        reinterpret_cast<ULONG_PTR>(entry),\n        0);\n    if (nullptr == old_iocp)\n    {\n        err = ::GetLastError();\n    }\n    // ...\n```\n## æŠ•å…¥æ–¹å’Œå¤„ç†æ–¹çš„è”ç³»ï¼šé€šè¿‡Entry\n`GetQueuedCompletionStatus`å‡½æ•°ä¸­ç¬¬3ä¸ªå‚æ•°ï¼Œè¦ä¸æˆ‘ä»¬è‡ªå®šä¹‰çš„Entryç±»å‹ç»“åˆèµ·æ¥ã€‚\n```cpp\nvoid worker(void)\n{\n    DWORD bytes_transferred{ 0 };\n    //ULONG_PTR completion_key;\n    Entry* entry{ nullptr };\n    LPOVERLAPPED povl{ nullptr };\n    while (true)\n    {\n        // å°†ä¼šä»ä¹‹å‰æŠ•å…¥çš„IOCPä¸­è¯»å–entryå¡«å…¥åˆ°ç°åœ¨çš„ç©ºentry\n        bool succeed = ::GetQueuedCompletionStatus(\n            iocp,\n            &bytes_transferred,\n            //&completion_key,\n            reinterpret_cast<PULONG_PTR>(entry),//ç­‰äºULONG_PTR*, ULONGäºŒçº§æŒ‡é’ˆ\n            &povl,\n            INFINITE);\n        if (!succeed)\n        {\n            continue;\n        }\n        if (entry->_event_type == ...)\n        {\n            // ...\n        }\n    }\n}\n```\nç„¶åï¼Œå°±å¯ä»¥åœ¨æ¯æ¬¡å¾ªç¯æ—¶åˆ¤æ–­entryä¸­æºå¸¦çš„EventTypeä¿¡æ¯ï¼Œä»è€Œåšåˆ†æ”¯å¤„ç†ã€‚\nä½†ä¸å¹³æ—¶ä¸åŒï¼Œ`work_sock`æ˜¯æ¥è‡ªentryä¸­çš„ã€‚`client_addr`åŸå…ˆæ˜¯acceptå‡½æ•°åœ¨è¿æ¥æ—¶å¡«å……ç»™æœåŠ¡ç«¯çš„ï¼Œè€Œç°åœ¨æ˜¯æ¥è‡ª`buf`ä¸­çš„å†…å®¹ã€‚\n```cpp\n    // ...\n        // ä¹‹å‰çš„entryåœ¨åˆ›å»ºæ—¶ï¼Œæœ‰_event_typeçš„EventTypeä¿¡æ¯ï¼Œè¿˜æœ‰_ovlä¿¡æ¯\n        // ä¹Ÿæœ‰work_sockä¿¡æ¯ï¼Œæ˜¯åœ¨ä¹‹å‰AcceptExä¸­å¡«å……çš„ã€‚\n        // è¿˜æœ‰bufä¿¡æ¯ï¼Œå¯ä»¥ä»å…¶ä¸­æå–å®¢æˆ·ç«¯åœ°å€ã€‚\n        if (entry->_event_type == EventType::ET_ACCEPT)\n        {\n            SOCKET work_sock = entry->_work_sock;\n            if (INVALID_SOCKET == work_sock)\n            {\n                int err = ::WSAGetLastError();\n                continue; // ç»§ç»­ä¸‹ä¸€æ¬¡\n            }\n            // display the info of client\n            sockaddr_in client_addr = *reinterpret_cast<sockaddr_in const*>(entry->_buf + sizeof(sockaddr_in) + 16);\n            wchar_t addr_str[46] = L\"\";\n            InetNtopW(AF_INET, reinterpret_cast<void*>(&client_addr.sin_addr), addr_str, 46);\n            std::wstring info = std::format(L\"client address: {}, port: {}\", addr_str, ntohs(client_addr.sin_port));\n            std::wcout << info << std::endl;\n            // ...\n        }\n    // ...\n```\n## WSASend\næˆ‘ä»¬å¯ä»¥é€šè¿‡WSASendå¼‚æ­¥åœ°å‘`work_sock`å¯¹åº”çš„clientå‘é€æ¶ˆæ¯ã€‚\n```cpp\n            // display the info of client\n            \n            // ...\n            \n            // Send Hello to Client\n            WSABUF wsa_buf;\n            wsa_buf.buf = new char[100];\n            wcscpy_s(reinterpret_cast<wchar_t*>(wsa_buf.buf), 50, L\"Welcome to server!\");\n            ::WSASend(work_sock, &wsa_buf, 1, &bytes_transferred, 0, nullptr, nullptr);\n            // ...\n```\n## åç»­çš„æ“ä½œ\nå‘å¾€å¸¸ä¸€æ ·ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦æµ‹è¯•ï¼ˆ1ï¼‰æ‰“å°å®¢æˆ·ç«¯åœ°å€ï¼›ï¼ˆ2ï¼‰å‘å®¢æˆ·ç«¯å‘é€ä¿¡æ¯ï¼›ï¼ˆ3ï¼‰æ¥æ”¶å®¢æˆ·ç«¯ä¿¡æ¯ã€‚ç°åœ¨å°±å·®æ¥æ”¶äº†ã€‚\n\nä¸WSASendå¯¹åº”çš„åŠ¨ä½œæ˜¯WSARecvã€‚ä¹Ÿæ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥ä¸èƒ½ç›²ç›®åœ°è°ƒç”¨ï¼Œè€Œæ˜¯ç­‰å¯¹æ–¹å‘é€æ¶ˆæ¯æ—¶ï¼Œæˆ–è€…å‡ºç°å¯è¯»äº‹ä»¶æ—¶ï¼Œå†æ¥æ”¶ã€‚\n\nä½†æ˜¯ä¸çŸ¥é“å¯¹æ–¹ä»€ä¹ˆæ—¶å€™å‘é€æ¶ˆæ¯ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºæ–°çš„å®Œæˆé”®ï¼Œåœ¨å®Œæˆé”®ä¸­æŒ‡ç¤º`EventType`ä¸º`ET_READ`ã€‚\n\nç„¶åï¼ŒåƒIOCPä¹‹å‰çš„æ¨¡å¼ä¸€æ ·ï¼ŒæŠŠå¯¹åº”çš„`work_sock`å’Œè¿™ä¸ªæ–°çš„EntryæŠ•å…¥åˆ°å®Œæˆç«¯å£ã€‚\nç„¶åè®©ä¸‹ä¸ªçº¿ç¨‹`GetQueuedCompletionStatus`ï¼ŒæˆåŠŸåˆ™è¯´æ˜æœ‰äº†äº‹ä»¶ï¼Œæ­¤æ—¶å†å»è¯»å–ï¼Œå°±è¡Œäº†ã€‚\n\nè¯»å–å®Œäº†ä¹‹åï¼Œæˆ‘ä»¬æƒ³è¦æµ‹è¯•çš„ä¸œè¥¿å°±ç»“æŸäº†ï¼Œè¿™æ—¶è®°å¾—closeHandleï¼Œæ¸…é™¤è¿™ä¸ªå®Œæˆé”®ã€‚\n## æ€ä¹ˆè®©å®ƒè½¬èµ·æ¥ï¼Ÿ\nç›®å‰æœåŠ¡ç«¯èƒ½æ¥å—ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼Œå¹¶ä¸”å¯ä»¥æ”¶å‘æ¶ˆæ¯ï¼Œä½†æ˜¯åç»­çš„ç¬¬äºŒä¸ªå®¢æˆ·ç«¯ä¸è¡Œã€‚\nå› ä¸ºæˆ‘ä»¬åªåœ¨ä¸»çº¿ç¨‹æŠ•é€’äº†ä¸€æ¬¡IOCPï¼Œå¹¶ä¸”AccpetExåªè¿›è¡Œä¸€æ¬¡ã€‚\n\nå¯ä»¥åœ¨å¤„ç†å®Œacceptäº‹ä»¶åï¼Œ`WSASocket`åˆ›å»ºæ–°çš„ç©ºçš„`work_sock`èµ‹ç»™`entry`ï¼Œentryçš„å…¶ä»–å‚æ•°å¯ä»¥å¤ç”¨ä¹‹å‰çš„ã€‚éšåç»§ç»­AcceptExï¼Œä½†è¦æ³¨æ„ï¼Œå€’æ•°ç¬¬2ä¸ªå‚æ•°éœ€è¦è°ƒæ•´ä¸º`&bytes_transferred`ã€‚\n\nAcceptExå®Œæˆä¹‹åï¼Œå°±å¯ä»¥å†æ¬¡æŠ•å…¥IOCPäº†ã€‚\n\nä½†æ˜¯åœ¨å°è¯•çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‘ç°ï¼Œ`CreateIoCompletionPort`çš„ç¬¬1ä¸ªå‚æ•°ä¸å¯ä»¥æ˜¯`entry->_listen_sock`ï¼Œè¿™ä¼šå¯¼è‡´è¿”å›å€¼ä¸ºnullptrï¼Œå³é”™è¯¯ï¼Œé”™è¯¯ç æ˜¯87ï¼Œerror lookupåæŸ¥è¯¢åˆ°åŸå› æ˜¯â€œæ— æ•ˆçš„å‚æ•°â€ã€‚\nè‡³äºä¸ºä»€ä¹ˆä¼šå¤±è´¥ï¼Ÿ[æŸ¥è¯¢æ–‡æ¡£]([CreateIoCompletionPort function (ioapiset.h) - Win32 apps | Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/api/ioapiset/nf-ioapiset-createiocompletionport))å¯çŸ¥ï¼š\n>A handle can be associated with only one I/O completion port, and after the association is made, the handle remains associated with that I/O completion port until it is closed.\n>ä¸€ä¸ªå¥æŸ„åªèƒ½ä¸ä¸€ä¸ª I/O å®Œæˆç«¯å£å…³è”ï¼Œå…³è”å®Œæˆåï¼Œè¯¥å¥æŸ„å°†ä¿æŒä¸è¯¥ I/O å®Œæˆç«¯å£çš„å…³è”ï¼Œç›´è‡³å…¶å…³é—­ã€‚\n\nå› æ­¤ï¼Œä¸èƒ½åœ¨åŒä¸€ä¸ªsocketå¯¹åº”çš„HANDLEä¸Šé‡å¤CreateIOCPã€‚\n\n`CreateIoCompletionPort`çš„ç¬¬ä¸€ä¸ªå‚æ•°æ”¹ä¸º`(reinterpret_cast<HANDLE>(entry->_work_sock)`ä¹‹åå°±æ­£å¸¸å·¥ä½œäº†ã€‚\næˆ‘ä»¬åˆšå¼€å§‹ä½¿ç”¨`entry->_listen_sock`æ˜¯é”™ä»¥ä¸ºå®Œæˆç«¯å£æ¯ä¸€æ¬¡å·¥ä½œåä¼šæŠŠHANDLEé€€å‡ºã€‚ï¼ˆæ¯”å¦‚è¿™æ¬¡çš„HANDLEï¼Œæ˜¯ç”±äºä¸»çº¿ç¨‹ç¬¬ä¸€æ¬¡`CreateIoCompletionPort`æŠ•å…¥çš„`listen_sock`å¼•èµ·çš„ï¼‰ã€‚å®é™…ä¸Šå®Œæˆç«¯å£çš„æ¯ä¸€æ¬¡å·¥ä½œå®Œæˆåï¼Œä¸ä¼šæŠŠHANDLEé€€å‡ºï¼Œå› æ­¤æ— éœ€å†æ¬¡å¯¹ä¸Šé¢çš„`listen_sock`å¯¹åº”çš„HANDLEè¿›è¡Œ`CreateIoCompletionPort`ã€‚\næ‰€ä»¥æˆ‘ä»¬æ”¹ä¸ºäº†å¯¹æœ¬æ¬¡ç”Ÿæˆçš„`entry->_work_sock`å¯¹åº”çš„HANDLEè¿›è¡Œ`CreateIoCompletionPort`ï¼Œè¿™æ‰æ˜¯æ­£ç¡®çš„é€»è¾‘ã€‚\nè€Œå®Œæˆç«¯å£ä»€ä¹ˆæ—¶å€™ä¼šæŠŠHANDLEé€€å‡ºå‘¢ï¼Ÿåº”è¯¥æ˜¯åœ¨`CloseHandle(iocp);`çš„æ—¶å€™ã€‚\n```cpp\n    // ...\n            // make another AcceptEx for next client\n            // ä¸ºäº†é©¬ä¸Šè®©workerçº¿ç¨‹å»å¤„ç†åœ¨æœ¬æ¬¡listen_sockä¸Šæ–°çš„ç”¨æˆ·è¿æ¥\n            // work_sockéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºçš„\n            entry->_work_sock = ::WSASocket(AF_INET, SOCK_STREAM, IPPROTO_TCP, nullptr, 0, WSA_FLAG_OVERLAPPED);\n            // work_sockç”¨æ–°çš„ç©ºçš„\n            // listen sock å’Œ buf ä»¥åŠ ovl å¤ç”¨æ—§çš„\n            // å€’æ•°ç¬¬2ä¸ªå‚æ•°ç”± &length_received è°ƒæ•´ä¸º &bytes_transferred\n            bool res = AcceptEx(\n                entry->_listen_sock,\n                entry->_work_sock,\n                entry->_buf,\n                0,\n                sizeof(sockaddr_in) + 16,\n                sizeof(sockaddr_in) + 16,\n                &bytes_transferred,      // !\n                &entry->_ovl);\n            // å†æ¬¡æŠ•å…¥å®Œæˆç«¯å£ä¸­\n            auto old_iocp = ::CreateIoCompletionPort(\n                reinterpret_cast<HANDLE>(entry->_work_sock),\n                iocp,\n                reinterpret_cast<ULONG_PTR>(entry),\n                0);\n            if (nullptr == old_iocp)\n            {\n                int err = ::GetLastError();\n                break;\n            }\n    // ...\n```\n## å¦‚ä½•å¤„ç†å¤åˆçš„å¤šç§äº‹ä»¶çš„socketï¼Ÿ\næˆ‘ä»¬è®¾è®¡çš„EventTypeåªèƒ½æŒ‡ç¤ºç®€å•çš„ä¸€ç§äº‹ä»¶çš„socketã€‚æœ‰çš„socketæ—¢æœ‰å¯è¯»äº‹ä»¶åˆæœ‰å¯å†™äº‹ä»¶ï¼Œæ­¤æ—¶ï¼Œå°±éœ€è¦ä¾èµ–Entryä¸­çš„`_ovl`ä¿¡æ¯äº†ï¼Œå®ƒæ˜¯overlappedIOä¿¡æ¯ï¼Œå…¶ä¸­æœ‰hEventå˜é‡ã€‚`_ovl`æ˜¯AcceptExå‡½æ•°å¡«å…¥çš„ã€‚\nå¦‚æœéœ€è¦å¤„ç†å¤šç§äº‹ä»¶å¤åˆçš„socketï¼Œå°±éœ€è¦å»è¯»å–è¿™ä¸ªä¿¡æ¯ã€‚\n## æ€»ç»“\nIOCPçœ‹èµ·æ¥å¤æ‚ï¼Œå…¶å®æ— éå°±å‡ ä¸ªæ­¥éª¤ï¼š\n1. åˆ›å»ºå®Œæˆé”®ï¼Œéœ€è¦å¡«å……`listen_sock`ï¼Œ`work_sock`ï¼Œ`ovl`ç­‰å˜é‡\n2. åˆ›å»ºIOCPï¼Œéœ€è¦ä¸Šé¢åˆ›å»ºå¥½çš„å®Œæˆé”®\n3. å­çº¿ç¨‹ä»IOCPé˜Ÿåˆ—è·å–ä»»åŠ¡ã€‚åˆ†æentryå†…å®¹ã€‚\n4. å­çº¿ç¨‹å†æ¬¡æŒ‰éœ€åˆ›å»ºæ–°çš„IOCPï¼Œä»¥ä¾¿è®©ä»»åŠ¡é˜Ÿåˆ—å¾ªç¯è¿è½¬ã€‚","categories":["ç½‘ç»œ","Windows"]},{"title":"ç½‘ç»œ_æ–‡ä»¶ä¼ è¾“","url":"/ç½‘ç»œ/ç½‘ç»œ_æ–‡ä»¶ä¼ è¾“/","content":"# åˆ›å»ºé¡¹ç›®\næ–°å»ºé¡¹ç›®`FileServer`ã€‚\n# FileHeader\næ–°å»ºå¤´æ–‡ä»¶`file_header.h`ã€‚\n\néœ€è¦è®¾è®¡ä¸ºplain typeï¼Œå³ç®€å•ç»“æ„ï¼Œä¸èƒ½æœ‰è™šå‡½æ•°è¡¨ã€‚\néœ€è¦è®¾è®¡ï¼š\n1. åç§»é‡\n2. å¤§å°\n\nåå­—ã€æ ‡å·ã€æ–‡ä»¶ç±»å‹è¿™äº›å±æ€§æš‚ä¸è€ƒè™‘ã€‚\n```cpp\n// file_header.h\n#pragma once\nclass FileHeader\n{\npublic:\n\tunsigned long long offset;\n\tunsigned long long size;\n};\n```\nè¿˜éœ€è¦è€ƒè™‘ï¼Œé—®ç­”çš„æœºåˆ¶ã€‚\n1. ç¬¬ä¸€æ¬¡è¯·æ±‚æ–‡ä»¶æ—¶ï¼Œéœ€è¦å¾—çŸ¥æ–‡ä»¶æ€»å¤§å°ï¼Œ\n2. ä¹‹åä¼ è¾“æ—¶åˆ™è¯·æ±‚è‹¥å¹²ä¸ªä¸åŒçš„åç§»é‡èµ·å§‹çš„æ–‡ä»¶ç‰‡æ®µã€‚\n3. ä¼ è¾“å®Œæ¯•æ—¶ï¼Œéœ€è¦FINISHæ ‡å¿—æ¥æç¤ºç»“æŸã€‚\n\næ‰€ä»¥ï¼Œè¯·æ±‚çš„é˜¶æ®µã€å†…å®¹ä¸ä¸€æ ·æ—¶ï¼Œå°±éœ€è¦ç”¨ä¸åŒç±»å‹çš„æ–‡ä»¶å¤´æ¥åŒºåˆ†ã€‚\n```cpp\n#pragma once\nenum class HeaderType\n{\n    FILE_SIZE = 0,\n    SEGMENT,\n    FINISH\n};\nclass FileHeader\n{\npublic:\n    unsigned long long\t\toffset;\n    unsigned long long\t\tsize;\n    enum class HeaderType\ttype;\n};\n```\n# FileServer\næ–°å»ºæºæ–‡ä»¶`file_server.cpp`ï¼Œå†…å®¹æ‹·è´`stream_server_threadpool_coroutine.cpp`ã€‚\nä¸ºäº†ç®€æ´ï¼Œæš‚æ—¶ä¸ç”¨çº¿ç¨‹æ± ï¼ˆä»ä¿ç•™åç¨‹ï¼‰\n\n## æ‰“å¼€æ–‡ä»¶\næ­¤å¤„çš„ä»£ç ä½ç½®ä½äºæœåŠ¡ç«¯ç¨‹åºæ‰“å°å®¢æˆ·ç«¯ä¿¡æ¯å’Œå‘é€æ¶ˆæ¯ä¹‹é—´ï¼š\n\néœ€è¦ä½¿ç”¨fstreamï¼Œæ„é€ ä¸€ä¸ªfstreamå¯¹è±¡ã€‚éœ€è¦ä¼ å…¥æ–‡ä»¶è·¯å¾„ã€æ‰“å¼€æ–¹å¼ã€‚\næ‰“å¼€æ–¹å¼è§ï¼š[fstream::open](https://legacy.cplusplus.com/reference/fstream/fstream/open/)\nåœ¨æ­¤ä¾‹æˆ‘ä»¬ä½¿ç”¨è¯»å–+äºŒè¿›åˆ¶æ–¹å¼æ‰“å¼€æ–‡ä»¶ï¼š`std::fstream::in | std::fstream::binary`\næœ€ååˆ«å¿˜äº†å…³é—­fsã€‚\n```cpp\n// file_server.cpp\n#include <fstream>\nagave::IAsyncAction worker_async(sockaddr_in client_addr, SOCKET work_sock)\n{\n    co_await agave::resume_background();\n    // print client info ...\n    // ...\n\n    // open target file\n    std::fstream fs(L\"d:/test\", std::fstream::in | std::fstream::binary);\n\n    fs.close();\n    ::closesocket(work_sock);\n    work_sock = INVALID_SOCKET;\n}\n```\n## è¯»å–FileHeader\nè¿™ä¸ªFileHeaderæ˜¯å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡ç«¯çš„è¯·æ±‚ã€‚\næœåŠ¡ç«¯éœ€è¦æŸ¥çœ‹å®¢æˆ·ç«¯çš„è¯·æ±‚ç±»å‹ã€‚æ‰èƒ½åšå‡ºä¸‹ä¸€æ­¥çš„å“åº”ã€‚\nå†™æˆä¸€ä¸ªå‡½æ•°ã€‚\n1. éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªFileHeaderçš„å¼•ç”¨ï¼Œä¾›å†™å…¥æå‰å®šä¹‰å¥½çš„ç©ºå¯¹è±¡ã€‚ä¸€ä¸ª`work_sock`ï¼Œå°†ä»æ­¤sockä¸Šæ”¶å‘FileHeaderã€‚\n2. ç”±äºæ˜¯TCPçš„æµå¼ä¼ è¾“ï¼Œä¸€æ¬¡å¯èƒ½æ¥æ”¶ä¸å®Œã€‚æ‰€ä»¥æ¯æ¬¡æ¥æ”¶åéƒ½éœ€è¦è®¡ç®—å‰©ä½™çš„å¤§å°ï¼Œå³`remainder = å›ºå®šçš„FileHeaderå¤§å° - å·²æ¥æ”¶çš„å¤§å°`ï¼Œä»¥åŠè®°å½•ä¸‹ä¸€æ¬¡æ¥æ”¶çš„åç§»é‡`offset += å·²æ¥æ”¶çš„å¤§å°`ã€‚\n3. å¦‚æœrecvè¿”å›å€¼å°äºç­‰äº0åˆ™æ¥æ”¶ç»“æŸã€‚\n\n```cpp\nbool read_file_header(FileHeader& file_header, SOCKET work_sock)\n{\n    long long unsigned remainder = sizeof(file_header);\n    long long unsigned offset = 0;\n    while (remainder > 0)\n    {\n        auto bytes_received = ::recv(\n            work_sock,\n            reinterpret_cast<char*>(&file_header) + offset,\n            remainder,\n            0);\n        // è¿”å›å€¼ä¸º0æ—¶ï¼Œä»£è¡¨è¿æ¥å·²å…³é—­\n        if (bytes_received == SOCKET_ERROR || bytes_received == 0)\n        {\n            return false;\n        }\n        else\n        {\n            remainder -= bytes_received;\n            offset += bytes_received;\n        }\n    }\n}\n```\nåœ¨æ‰“å¼€æ–‡ä»¶åï¼Œæ‰§è¡Œè¯»å–FileHeaderã€‚æˆåŠŸæ¥å—FileHeaderåï¼Œä¾¿å¯ä»¥é€šè¿‡switch-caseåˆ¤æ–­HeaderTypeä»¥è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œï¼ˆå“åº”ç»™å®¢æˆ·ç«¯ï¼‰ã€‚éœ€è¦å¾ªç¯æ‰§è¡Œã€‚\n```cpp\n// file_server.cpp\n#include <fstream>\nagave::IAsyncAction worker_async(sockaddr_in client_addr, SOCKET work_sock)\n{\n    co_await agave::resume_background();\n    // print client info ...\n    // ...\n\n    // open target file\n    // ...\n\n    // check headerType\n    FileHeader file_header;\n    while (true)\n    {\n        if (!read_file_header(file_header, work_sock))\n        {\n            break;\n        }\n        switch (file_header.type)\n        {\n        case HeaderType::FILE_SIZE:\n        // ...\n            break;\n        case HeaderType::SEGMENT:\n        // ...\n            break;\n        case HeaderType::FINISH:\n        // ...\n            break;\n        default:\n        // ...\n            break;\n        }\n    }\n    fs.close();\n    ::closesocket(work_sock);\n    work_sock = INVALID_SOCKET;\n}\n```\n## è·å–æ–‡ä»¶å¤§å°åå“åº”\næ ¹æ®fstreamç»™å‡ºçš„æ–¹æ³•ï¼Œå¯ä»¥è·å–æ–‡ä»¶å¤§å°ã€‚\nå…·ä½“åœ°ï¼Œè¦ä½¿ç”¨çš„æ˜¯`istream`ä¸­çš„æ–¹æ³•ã€‚å› ä¸ºæ˜¯`è¯»å–`ï¼ˆistreamä¸­çš„iä»£è¡¨inï¼Œæ˜¯ä»¥å†…å­˜ä¸ºè§†è§’çš„ï¼Œå†™å…¥åˆ°å†…å­˜ä¸­ï¼Œå³ä¸ºè¯»å–ï¼‰ã€‚\nè€Œå¯¹äºè¯»å–ï¼Œåç¼€éƒ½ä»¥`g`æ¥åŒºåˆ†ã€‚æ¯”å¦‚`seek`å‡½æ•°æœ‰`seekg`å’Œ`seekp`ï¼ˆåˆæ¯”å¦‚`tellg`ã€`tellp`ï¼‰ï¼Œå‰è€…åˆ™æ˜¯istreamä¸­çš„ï¼Œåè€…æ˜¯ostreamä¸­çš„ï¼Œistreamå’Œostreamçš„ç¼“å†²åŒºæ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„ï¼Œæ‰€ä»¥è¦è¿›è¡ŒåŒºåˆ†ã€‚\nå‡½æ•°æ¯”è¾ƒç®€çŸ­ï¼Œå¯ä»¥è€ƒè™‘è®¾ç½®ä¸ºinlineã€‚\n```cpp\ninline long long unsigned get_file_size(std::fstream& fs)\n{\n    fs.seekg(0, std::fstream::end);\n    long long unsigned length = fs.tellg();\n    fs.seekg(0, std::fstream::beg);\n    return length;\n}\n```\nè·å–å®Œæ–‡ä»¶å¤§å°åï¼Œå¡«å…¥è¦å“åº”çš„FileHeaderçš„ä¿¡æ¯ï¼Œå‘é€ç»™å®¢æˆ·ç«¯ï¼Œéœ€è¦å°è£…ä¸€ä¸ª`send_file_header`å‡½æ•°ã€‚\n```cpp\n// file_server.cpp\n// ...\n        switch (file_header.type)\n        {\n        case HeaderType::FILE_SIZE:\n        {\n            file_header.type = HeaderType::FILE_SIZE;\n            file_header.offset = 0;\n            file_header.size = get_file_size(fs);\n            send_file_header(file_header, work_sock);\n        }\n            break;\n        case HeaderType::SEGMENT:\n        // ...\n            break;\n        case HeaderType::FINISH:\n        // ...\n            break;\n        default:\n        // ...\n            break;\n        }\n    }\n// ...\n}\n```\n### `send_file_header`\n```cpp\nbool send_file_header(FileHeader& file_header, SOCKET work_sock)\n{\n    long long unsigned remainder = sizeof(file_header);\n    long long unsigned offset = 0;\n    while (remainder > 0)\n    {\n        auto bytes_sent = ::send(\n            work_sock,\n            reinterpret_cast<const char*>(&file_header) + offset,\n            remainder,\n            0);\n        if (bytes_sent == SOCKET_ERROR)\n        {\n            return false;\n        }\n        else\n        {\n            remainder -= bytes_sent;\n            offset += bytes_sent;\n        }\n    }\n    return true;\n}\n```\n## å“åº”ç‰‡æ®µ\né¦–å…ˆéœ€è¦è¯»å–ç‰‡æ®µï¼Œå†å‘é€ã€‚\nåœ¨æ­¤ä¹‹å‰ï¼Œå®šä¹‰ä¸€ä¸ªå›ºå®šçš„æ–‡ä»¶ç‰‡æ®µå¤§å°ï¼Œåœ¨`file_header.h`ä¸­å®šä¹‰ä¸ºå¸¸é‡ï¼Œ512å­—èŠ‚ã€‚\n```cpp\n// file_header.h\n// fixed File Segment Size\nconstexpr unsigned SEGMENT_SIZE{ 512 };\n// ...\n```\nç„¶åï¼Œå¯ä»¥ä»¥æ­¤å¤§å°ä½œä¸ºç¼“å†²åŒºå¤§å°ã€‚æ¯æ¬¡è¯»å–ä¸€ä¸ªç‰‡æ®µéƒ½æŠŠå†…å®¹æ”¾åˆ°è¿™ä¸ªç¼“å†²åŒºä¸­ï¼Œå†å‘é€èµ°ã€‚æœ€åä¸è¦å¿˜è®°é‡Šæ”¾ç¼“å†²åŒºã€‚\n```cpp\n// file_server.cpp\n// ...\n    // open target file\n    // ...\n\n    // check headerType\n    FileHeader file_header;\n    char* buf = new char(SEGMENT_SIZE);\n    while (true)\n    {\n        // ...\n    }\n\n    delete[]buf;\n    buf = nullptr;\n    fs.close();\n    ::closesocket(work_sock);\n    work_sock = INVALID_SOCKET;\n}\n```\nå“åº”çš„ä»£ç ï¼š\n`read_segment_from_file`ç”¨äºè¯»å–ä¸€ä¸ªæ–‡ä»¶ç‰‡æ®µï¼Œç„¶åå†™å…¥åˆ°ä¸€ä¸ªbufç¼“å†²åŒºä¸­ã€‚\n`send_segment`ç”¨äºæŠŠbufç¼“å†²åŒºä»SOCKETå‘é€åˆ°ç½‘ç»œã€‚\n\n`read_segment`æˆ–`send_segment`é”™è¯¯æ—¶ï¼Œä¸èƒ½ç›´æ¥breakï¼Œè¿™å›ç›´æ¥é€€å‡ºwhileå¾ªç¯ï¼Œå¯ä»¥åŠ ä¸€ä¸ªæ ‡å¿—ä½`is_exit`ï¼Œåœ¨æ‰§è¡Œå®Œè¯¥caseåæ ¹æ®æ­¤æ ‡å¿—æ¥å†³å®šæ˜¯å¦é€€å‡ºå¾ªç¯ã€‚\n```cpp\n// ...\n    bool is_exit{ false };\n    while (true)\n    {\n        if (!read_file_header(file_header, work_sock))\n        {\n            break;\n        }\n        switch (file_header.type)\n        {\n        case HeaderType::FILE_SIZE:\n        {\n            // ...\n        }\n            break;\n        case HeaderType::SEGMENT:\n        {\n            if (!read_segment_from_file(fs, buf, file_header.offset, file_header.size))\n            {\n                is_exit = true;\n            }\n            if (!send_segment(work_sock, buf, file_header.size))\n            {\n                is_exit = true;\n            }\n        }\n            break;\n        case HeaderType::FINISH:\n            is_exit = true;\n            break;\n        default:\n            break;\n        }\n        if (is_exit)\n            break;\n    }\n// ...\n```\n### è¯»å–ç‰‡æ®µ\n```cpp\ninline bool read_segment_from_file(std::fstream& fs, char * buf, long long unsigned offset, long long unsigned length)\n{\n    fs.seekg(offset, std::fstream::beg);\n    fs.read(buf, length);\n    // readä¸ä¼šè¿”å›è¯»å–çš„é‡ï¼Œéœ€è¦ç”¨gcountæ¥çœ‹è¯»å–äº†å¤šå°‘\n    if (fs.gcount() != length)\n        return false;\n    return true;\n}\n```\n### å‘é€ç‰‡æ®µ\nå’Œ`send_file_header`éå¸¸ç›¸ä¼¼ï¼Œåªä¸è¿‡æŠŠFileHeaderæ¢æˆäº†bufï¼Œä¸”æœ‰ä¸€ä¸ªå®é™…çš„lengthå‚æ•°ã€‚\n```cpp\nbool send_segment(SOCKET work_sock, const char* buf, long long unsigned length)\n{\n    long long unsigned remainder = length;\n    long long offset = 0;\n    while (remainder > 0)\n    {\n        auto bytes_sent = ::send(\n            work_sock,\n            reinterpret_cast<const char*>(buf) + offset,\n            remainder,\n            0);\n        if (bytes_sent == SOCKET_ERROR)\n        {\n            return false;\n        }\n        else\n        {\n            remainder -= bytes_sent;\n            offset += bytes_sent;\n        }\n    }\n    return true;\n}\n```\n# FileClient\nåˆ›å»ºé¡¹ç›®`FileClient`ï¼Œæ–°å»ºæºæ–‡ä»¶`file_client.cpp`ï¼Œå†…å®¹æ‹·è´`basic_stream_client.cpp`ã€‚\næ·»åŠ å¤´æ–‡ä»¶ï¼ˆAdd Existing Itemï¼‰`file_header.h`ã€‚\nåœ¨åŸå…ˆæµ‹è¯•æ”¶å‘æ¶ˆæ¯çš„ä»£ç å¤„æ›´æ¢ä¸ºï¼šå‘é€FileHeaderã€‚\n```cpp\n#include <WinSock2.h>\n#include <iostream>\n#include <format>\n#include <ws2tcpip.h>\n#include \"../FileServer/file_header.h\"\n#pragma comment (lib, \"Ws2_32\")\nint main()\n{\n    WORD wVersionRequested;\n    WSADATA wsaData;\n    int err;\n    wVersionRequested = MAKEWORD(2, 2);\n\n    err = ::WSAStartup(wVersionRequested, &wsaData);\n    if (err != 0)\n    {\n        std::wcout << std::format(L\"WSAStartup failed with error : {}\\n\", err);\n        return 1;\n    }\n\n    SOCKET sock = ::socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);\n    if (sock == INVALID_SOCKET)\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n\n    sockaddr_in server_addr;\n    server_addr.sin_family = AF_INET;\n    if (1 != ::inet_pton(AF_INET, \"127.0.0.1\", &server_addr.sin_addr))\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n    server_addr.sin_port = htons(9008);\n\n    if (SOCKET_ERROR == ::connect(sock, reinterpret_cast<const sockaddr*>(&server_addr), sizeof(server_addr)))\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n    \n    // adjust as follow:\n    FileHeader file_header;\n    file_header.type = HeaderType::FILE_SIZE;\n    // send FileHeader\n    // ...\n\n    ::closesocket(sock);\n    sock = INVALID_SOCKET;\n\n    ::WSACleanup();\n    return 0;\n}\n```\n## `file_foundation`\næ­¤å¤„åˆä¼šç”¨åˆ°äº†FileServerä¸­å†™è¿‡çš„`send_file_header`å‡½æ•°ï¼Œå¯æƒ³è€ŒçŸ¥åé¢åŒæ ·ä¼šç”¨åˆ°å…¶ä»–å†™è¿‡çš„å‡½æ•°ã€‚\næ‰€ä»¥æˆ‘ä»¬å•ç‹¬åœ¨FileServeré¡¹ç›®ä¸­å†æ–°å»ºä¸€ä¸ªå•ç‹¬çš„å¤´æ–‡ä»¶`file_foundation.h`ï¼ŒæŠŠä¹‹å‰åœ¨`file_server.cpp`å•ç‹¬å£°æ˜çš„å‡½æ•°å‰ªåˆ‡åˆ°æ­¤å¤„ï¼Œä»¥ä¾¿ä¸¤ç«¯éƒ½å¯ä»¥å¼•ç”¨ã€‚\næ³¨æ„ä¹Ÿéœ€è¦å‰ªåˆ‡è¿™äº›å‡½æ•°éœ€è¦çš„å¤´æ–‡ä»¶ã€‚ç›¸åº”åœ°`file_server.cpp`å¯ä»¥åªå¼•ç”¨`file_foundation.h`ã€‚\n```cpp\n// file_foundation.h\n#pragma once\n#include <fstream>\n#include \"file_header.h\"\n#include <WinSock2.h>\nbool read_file_header(FileHeader& file_header, SOCKET work_sock);\nbool send_file_header(FileHeader& file_header, SOCKET work_sock);\nbool send_segment(SOCKET work_sock, const char* buf, long long unsigned length);\nlong long unsigned get_file_size(std::fstream& fs);\nbool read_segment_from_file(std::fstream& fs, char* buf, long long unsigned offset, long long unsigned length);\n```\nç›¸åº”åœ°ï¼Œéœ€è¦åœ¨FileServeré¡¹ç›®ä¸­æ–°å»º`file_foundation.cpp`ï¼Œå‰ªåˆ‡å®ç°éƒ¨åˆ†ã€‚\næ­¤æ—¶ç¼–è¯‘æµ‹è¯•ï¼Œå‘ç°ä¹‹å‰åœ¨`file_server.cpp`ä¸­å£°æ˜çš„inlineå‡½æ•°åœ¨åˆ†å¼€çš„`file_foundation`æ—¶å°±ä¸èƒ½é€šè¿‡ç¼–è¯‘äº†ï¼Œéœ€è¦å»æ‰inlineã€‚\n```cpp\n// file_foundation.cpp\n#include \"file_foundation.h\"\nbool read_file_header(FileHeader& file_header, SOCKET work_sock)\n{\n    long long unsigned remainder = sizeof(file_header);\n    long long unsigned offset = 0;\n    while (remainder > 0)\n    {\n        auto bytes_received = ::recv(\n            work_sock,\n            reinterpret_cast<char*>(&file_header) + offset,\n            remainder,\n            0);\n        // è¿”å›å€¼ä¸º0æ—¶ï¼Œä»£è¡¨è¿æ¥å·²å…³é—­\n        if (bytes_received == SOCKET_ERROR || bytes_received == 0)\n        {\n            return false;\n        }\n        else\n        {\n            remainder -= bytes_received;\n            offset += bytes_received;\n        }\n    }\n}\nbool send_file_header(FileHeader& file_header, SOCKET work_sock)\n{\n    long long unsigned remainder = sizeof(file_header);\n    long long unsigned offset = 0;\n    while (remainder > 0)\n    {\n        auto bytes_sent = ::send(\n            work_sock,\n            reinterpret_cast<const char*>(&file_header) + offset,\n            remainder,\n            0);\n        if (bytes_sent == SOCKET_ERROR)\n        {\n            return false;\n        }\n        else\n        {\n            remainder -= bytes_sent;\n            offset += bytes_sent;\n        }\n    }\n    return true;\n}\nbool send_segment(SOCKET work_sock, const char* buf, long long unsigned length)\n{\n    long long unsigned remainder = length;\n    long long offset = 0;\n    while (remainder > 0)\n    {\n        auto bytes_sent = ::send(\n            work_sock,\n            buf + offset,\n            remainder,\n            0);\n        if (bytes_sent == SOCKET_ERROR)\n        {\n            return false;\n        }\n        else\n        {\n            remainder -= bytes_sent;\n            offset += bytes_sent;\n        }\n    }\n    return true;\n}\nlong long unsigned get_file_size(std::fstream& fs)\n{\n    fs.seekg(0, std::fstream::end);\n    long long unsigned length = fs.tellg();\n    fs.seekg(0, std::fstream::beg);\n    return length;\n}\nbool read_segment_from_file(std::fstream& fs, char* buf, long long unsigned offset, long long unsigned length)\n{\n    fs.seekg(offset, std::fstream::beg);\n    fs.read(buf, length);\n    // readä¸ä¼šè¿”å›è¯»å–çš„é‡ï¼Œéœ€è¦ç”¨gcountæ¥çœ‹è¯»å–äº†å¤šå°‘\n    if (fs.gcount() != length)\n        return false;\n    return true;\n}\n```\n## ç»§ç»­ç¼–å†™`file_client`\nåœ¨FileClienté¡¹ç›®ä¸‹Add Existing Itemï¼š`file_foundation.h`å’Œ`file_foundation.cpp`ã€‚\næ­¤æ—¶ï¼Œ`file_client`å°±å¯ä»¥å¼•ç”¨`file_foundation.h`ï¼Œå¤ç”¨`send_file_header`ç­‰å‡½æ•°ï¼š\n\næ¥ä¸‹æ¥éœ€è¦å¤„ç†çš„å°±æ˜¯ï¼š\n1. å‘é€FileHeaderï¼Œè¯·æ±‚è·å–æ–‡ä»¶æ€»å¤§å°ï¼Œè¯»å–åˆ°FileHeaderä¸­\n2. `æ–‡ä»¶æ€»å¤§å° / ç¼“å†²åŒºå¤§å°`è®¡ç®—å°†è¦ä¸‹è½½çš„ç‰‡æ®µæ•°ï¼Œä»¥åŠè®¡ç®—æœ€åä¸€ä¸ªç‰‡æ®µå¤§å°\n3. fstreamæ‰“å¼€æ–‡ä»¶ï¼ˆéœ€è¦æŒ‡å®šæ¥æ”¶æ–‡ä»¶åˆ°å“ªä¸ªä½ç½®ï¼‰ï¼Œä»¥outã€binaryã€truncï¼ˆè¿½åŠ ï¼‰çš„æ–¹å¼æ‰“å¼€\n4. forå¾ªç¯\n    1. æ¯æ¬¡éƒ½å‘ä¸€ä¸ªFileHeaderï¼Œè¯·æ±‚è·å–ä¸€ä¸ªæ–‡ä»¶ç‰‡æ®µ\n    2. è¯»å–Segmentï¼Œå…ˆå†™å…¥åˆ°bufã€‚ï¼ˆæ­¤å¤„å¯¹åº”çš„å‡½æ•°ä¸º`read_segment`ï¼Œæ˜¯å®¢æˆ·ç«¯ä»ç½‘ç»œè¯»å–ä¸‹è½½ã€‚è€Œ`read_segment_from_file`æ˜¯æœåŠ¡ç«¯ä»æœ¬åœ°æ–‡ä»¶è¯»å–ç‰‡æ®µï¼‰\n    3. `fs.write`æ‹·è´bufå†…å®¹åˆ°fsè®¾ç½®å¥½çš„ç¡¬ç›˜ä½ç½®ä¸­ã€‚\n    4. å¾ªç¯å®Œæ¯•åæŒ‰ä»¥ä¸Šæ­¥éª¤ç‰¹æ®Šå¤„ç†ç»“å°¾ç‰‡æ®µã€‚\n5. å‘é€FileHeaderï¼Œè¡¨ç¤ºFINISHã€‚\n\n```cpp\n// ...\n    FileHeader file_header;\n    file_header.type = HeaderType::FILE_SIZE;\n    send_file_header(file_header, sock);\n    read_file_header(file_header, sock);\n    long long unsigned count = file_header.size / SEGMENT_SIZE;\n    long long unsigned last_size = file_header.size - count * SEGMENT_SIZE;\n    // open a file to write by downloading\n    char* buf = new char[SEGMENT_SIZE];\n    std::fstream fs(L\"./testRecv\", std::fstream::out | std::fstream::binary | std::fstream::trunc);\n\n    if (!fs)\n    {\n        goto __Target;\n    }\n    for (long long unsigned i = 0; i < count; ++i)\n    {\n        // request segment to server\n        file_header.type = HeaderType::SEGMENT;\n        file_header.offset = i * SEGMENT_SIZE;\n        file_header.size = SEGMENT_SIZE;\n        if (!send_file_header(file_header, sock))\n        {\n            break;\n        }\n        // download from server\n        if (!read_segment(sock, buf, SEGMENT_SIZE))\n        {\n            break;\n        }\n        // write to HardDisk\n        fs.write(buf, SEGMENT_SIZE);\n        if (!fs)\n        {\n            break;\n        }\n    }\n    if (last_size > 0)\n    {\n        // request segment to server\n        file_header.type = HeaderType::SEGMENT;\n        file_header.offset = count * SEGMENT_SIZE;\n        file_header.size = last_size;\n        if (send_file_header(file_header, sock))\n        {\n            // download from server\n            if (read_segment(sock, buf, last_size))\n            {\n                // write to HardDisk\n                fs.write(buf, last_size);\n            }\n        }\n    }\n    file_header.type = HeaderType::FINISH;\n    send_file_header(file_header, sock);\n\n__Target:\n    fs.close();\n    delete[]buf;\n    ::closesocket(sock);\n    sock = INVALID_SOCKET;\n\n    ::WSACleanup();\n    return 0;\n}\n```\n# æµ‹è¯•\nå¯åŠ¨é¡¹ç›®è®¾ç½®ä¸ºFileServerï¼Œç›´æ¥è¿è¡Œï¼ˆç‚¹å‡»Local Windows Debuggerï¼‰ã€‚\nå³é”®FileClientï¼Œé€‰æ‹©Debugï¼ŒStart New Instanceï¼Œå³å¯è¿è¡Œå®¢æˆ·ç«¯ã€‚\nå‘ç°ï¼Œåœ¨ç¼“å†²åŒºå¤§å°ä¸º512å­—èŠ‚æ—¶ï¼ˆ`file_header.h`ä¸­`SEGMENT_SIZE`ï¼‰ï¼Œä¼ è¾“æ—¶é—´ç¨é•¿ï¼Œå¯ä»¥è®¾ç½®ä¸º`512 * 1024`å³512KBï¼Œä¼ è¾“é€Ÿåº¦å³å¯ç¿»å€ã€‚","categories":["Linux","ç½‘ç»œ"]},{"title":"çº¿ç¨‹æ± _bubo","url":"/é¡¹ç›®/çº¿ç¨‹æ± _bubo/","content":"# åˆ›å»ºé¡¹ç›®\nåœ¨å·²æœ‰æˆ–æ–°å»ºçš„è§£å†³æ–¹æ¡ˆé‡Œï¼Œæ–°å»ºé¡¹ç›®ï¼Œå–åâ€œThreadPoolâ€ã€‚\né¡¹ç›®é…ç½®æ ‡å‡†ä¸º`C++20`æ ‡å‡†ã€‚\n# ITask\næ–°å»ºå¤´æ–‡ä»¶`ITask.h`ã€‚\n```cpp\nnamespace thpool\n{\n\tclass ITask\n\t{\n\tpublic:\n\t\tvirtual void run_task(void) = 0;\n\t};\n}\n```\n# åŸºäºä¿¡å·é‡çš„ThreadPool\næ–°å»ºå¤´æ–‡ä»¶â€œThreadPool.hâ€\n```cpp\n// ThreadPool.h\n#include <thread>\n#include <mutex>\n#include <semaphore>\n#include <list>\nnamespace thpool\n{\n\tclass ITask;\n\tclass ThreadPool\n\t{\n\tpublic:\n\t\tThreadPool(int max_num);\n\t\t~ThreadPool();\n\t\tvoid add_task(std::shared_ptr<ITask> task);\n\t\tvoid add_task(std::list<std::shared_ptr<ITask>> task_lst);\n\tprivate:\n\t\t// capacity\n\t\tint\t\t\t\t\t\t\t\t\t_max_num;\n\t\t// current running task threads\n\t\tint\t\t\t\t\t\t\t\t\t_alive_num;\n\t\tstd::counting_semaphore<100>\t\t_semaphore;\n\t\tstd::mutex\t\t\t\t\t\t\t_access_mx;\n\t\tbool\t\t\t\t\t\t\t\t_is_exit{ false };\n\t\tstd::list<std::shared_ptr<ITask>>\t_task_queue;\n\t};\n}\n```\n\nå®ç°ï¼š\n1. åˆå§‹åŒ–`_max_num`ï¼Œè§„å®šçº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°\n2. åˆå§‹åŒ–`_alive_num`ï¼Œçº¿ç¨‹æ± åˆšåˆ›å»ºæ—¶ï¼Œæ­£åœ¨æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ä¸º0ã€‚\n3. åˆå§‹åŒ–`_semaphore`ä¸º0ã€‚\n\nå…±åˆ›å»º`_max_num`ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹åŸºäºä¿¡å·é‡è·å–ä»»åŠ¡ï¼Œå¦‚æœæˆåŠŸåˆ™`_alive_num`åŠ 1ï¼Œå¦‚æœæ­¤æ—¶`_is_exit`æ ‡å¿—ä¸ºçœŸåˆ™æ„å‘³ç€çº¿ç¨‹æ± å³å°†ææ„ï¼Œ`_alive_num`å‡1ï¼Œå¹¶é€€å‡ºå¾ªç¯ã€‚\nå¦‚æœ`_is_exit`æ ‡å¿—ä¸ä¸ºçœŸï¼Œåˆ™å°è¯•ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­æå–ä»»åŠ¡ï¼Œéœ€è¦ç”¨äº’æ–¥é”åŒæ­¥ï¼Œåœ¨å¤–å±‚å…ˆç®€å•åˆ¤æ–­é˜Ÿåˆ—å¤§å°æ˜¯å¦å¤§äº0ï¼Œç„¶åå†ç”¨é”å»å†æ¬¡è·å–çœŸå®å€¼ï¼ˆè¿™æ ·å¤–å±‚å…ˆåˆ¤æ–­ï¼Œå†…å±‚å†åŠ é”åˆ¤æ–­ï¼Œå¯ä»¥åŠ å¤§æ¡ä»¶ä¸ºçœŸçš„æ¦‚ç‡ï¼Œé¿å…é”å¤ªæ€¥åˆ‡åœ°åŠ ï¼Œé™ä½æ€§èƒ½ï¼‰ï¼Œå†å»æ‰§è¡Œæå–å‡ºçš„ä»»åŠ¡ã€‚å¾ªç¯ï¼Œç›´åˆ°ä»»åŠ¡é˜Ÿåˆ—å¤§å°ä¸º0ï¼Œé€€å‡ºwhileå¾ªç¯å`_alive_num`å‡1ã€‚\né€€å‡ºå¤§çš„whileæ—¶ï¼ˆ`_is_exit`æ ‡å¿—ä¸ºçœŸæ—¶ï¼‰ï¼Œ`_max_num`å‡1ã€‚\n```cpp\n// ThreadPool.cpp\n#include \"ThreadPool.h\"\n#include \"ITask.h\"\n\nthpool::ThreadPool::ThreadPool(int max_num)\n\t: _max_num{ max_num }, _alive_num{ 0 }, _semaphore{ 0 }\n{\n\tfor (int i = 0; i < _max_num; ++i)\n\t{\n\t\tstd::jthread th([this](void)\n\t\t\t{\n\t\t\t\twhile (true)\n\t\t\t\t{\n\t\t\t\t\t_semaphore.acquire();\n\t\t\t\t\t++_alive_num;\n\t\t\t\t\tif (_is_exit)\n\t\t\t\t\t{\n\t\t\t\t\t\t--_alive_num;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\twhile (_task_queue.size() > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tstd::unique_lock lck{ _access_mx };\n\t\t\t\t\t\tif (_task_queue.size() > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tauto task = _task_queue.front();\n\t\t\t\t\t\t\t_task_queue.pop_front();\n\t\t\t\t\t\t\tlck.unlock();\n\t\t\t\t\t\t\ttask->run_task();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t--_alive_num;\n\t\t\t\t}\n\t\t\t\t--_max_num;\n\t\t\t});\n\t\tth.detach();\n\t}\n}\n\nvoid thpool::ThreadPool::add_task(std::shared_ptr<ITask> task)\n{\n\tif (!task)\n\t\treturn;\n\tstd::unique_lock lck{ _access_mx };\n\t_task_queue.push_back(task);\n\tlck.unlock();\n\t// åˆ¤æ–­æ˜¯å¦æœ‰ç©ºä½™çš„çº¿ç¨‹ï¼Œå¦‚æœæœ‰åˆ™å”¤é†’ä¸€ä¸ª\n\tif (_max_num - _alive_num > 0)\n\t{\n\t\t_semaphore.release(1);\n\t}\n}\n```\nä½†æ˜¯ä»¥ä¸Šç¨‹åºå­˜åœ¨ä¸€äº›é—®é¢˜ï¼š\n1. `_semaphore.acquire()`å’Œ`++_alive_num`ä¸æ˜¯åŒæ­¥çš„ã€‚\n2. `_is_exit`çš„åˆ¤æ–­å’Œ`--_alive_num`ä¹Ÿä¸æ˜¯åŒæ­¥çš„ã€‚\n3. åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­éƒ½è¿›è¡Œwhileå¾ªç¯åå¤åˆ¤æ–­ä»»åŠ¡é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸€ä¸ªçº¿ç¨‹ä¸€ç›´ç‹¬å `_access_mx`äº’æ–¥é‡ã€‚\n4. åœ¨æ‰§è¡Œå®Œä»»åŠ¡åçš„`--_alive_num`æ­¥éª¤ï¼Œæ˜¯å’Œæ‰§è¡Œç»“æŸæ˜¯ä¸åŒæ­¥çš„ï¼Œæœ‰å¯èƒ½`_max_num`ä¸ªçº¿ç¨‹åŒæ—¶å¡åœ¨è¿™ä¸€æ­¥ï¼Œå¯¼è‡´`add_task`å‡½æ•°ä¸­çš„`_max_num - _alive_num > 0`çš„æ¡ä»¶ä¸æˆç«‹ï¼Œå¯¼è‡´`_semaphore.release(1)`ä¸ä¼šæ‰§è¡Œã€‚è¿™å°†å¯¼è‡´ç³»ç»Ÿå®é™…å¢åŠ äº†ä»»åŠ¡ï¼Œå´æ²¡æœ‰å¢åŠ ä»»åŠ¡çš„ä¿¡å·é‡ã€‚æœ‰å°æ¦‚ç‡æ­»é”ï¼ˆæ­»é”åœ¨`_semaphore.acquire()`ï¼‰ã€‚\n5. ç»¼ä¸Šæ‰€è¿°ï¼Œæœ€å¥½æŠŠ`_semaphore`å’Œ`_alive_num`èä¸ºä¸€ä½“ï¼Œä¸è¦å‰²è£‚ä¸¤è€…ã€‚ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œèƒ½ä¸èƒ½è®©ä¿¡å·é‡çš„é‡å’Œ`_alive_num`æ— ç¼ä¿æŒä¸€è‡´ï¼‰\n    1. æ“ä½œç³»ç»Ÿçš„å…·ä½“å®ç°ï¼Œå¦‚Windowsã€Linuxæ˜¯å¯ä»¥éšæ—¶è·å–ä¿¡å·é‡çš„é‡çš„ï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨ä½¿ç”¨çš„æ˜¯è·¨å¹³å°`C++`ä¿¡å·é‡ï¼Œæ²¡æœ‰æä¾›è·å–é‡å¤§å°çš„æ–¹æ³•ï¼Œå› æ­¤å¿…é¡»æœ‰ä¸€ä¸ª`_alive_num`è®°å½•ã€‚\n    2. å¯ä»¥åœ¨`_semaphore.acquire()`å’Œ`++_alive_num`è¿™ä¸¤ä¸ªåŠ¨ä½œæ•´ä½“åŠ é”å—ï¼Ÿä¸å¯ä»¥ï¼Œå› ä¸º`_semaphore`æœ¬èº«å°±æ˜¯ä¼šé˜»å¡çš„ä¸œè¥¿ï¼Œå¦‚æœåŠ äº†é”åï¼Œ`_semaphore`ä¹Ÿé˜»å¡äº†ï¼Œé‚£ä¹ˆé”å°±ä¸èƒ½è§£å¼€äº†ã€‚\n    3. ä¸Šé¢æåˆ°çš„ï¼ŒåŠ äº†é”åï¼Œé‡Œé¢çš„ä¸œè¥¿é˜»å¡äº†ï¼Œæƒ³è¦æŠŠé”è§£å¼€ï¼Œæœ‰ä¸€æ ·ä¸œè¥¿å¯ä»¥å®ç°ï¼šæ¡ä»¶å˜é‡ã€‚ä½†æ˜¯ï¼Œæ¡ä»¶å˜é‡æ²¡æœ‰åƒä¿¡å·é‡è®°å½•æ•°ç›®çš„åŠŸèƒ½ï¼ˆè¦ä¹ˆæ˜¯`notify_one`ï¼Œè¦ä¹ˆæ˜¯`notify_all`ï¼‰ï¼Œå› æ­¤ä¸è¡Œã€‚\n6. æœ€ç®€å•çš„å½»åº•è§£å†³4æ­»é”çš„é—®é¢˜çš„æ–¹æ³•æ˜¯ï¼Œ`add_task`æ–¹æ³•ä¸­ä¸å†åˆ¤æ–­`_max_num - _alive_num > 0`çš„æ¡ä»¶ï¼Œå³æ— è®ºå¦‚ä½•ï¼Œåœ¨æ·»åŠ ä»»åŠ¡æ—¶ï¼Œéƒ½è¦`_semaphore.release(1)`ã€‚è¿™æ ·åšçš„å‰¯ä½œç”¨å°±æ˜¯è¦æŠŠ`std::counting_semaphore _semaphore`åœ¨å£°æ˜æ—¶ï¼Œå®šä¹‰å…¶ä¸ºä¸€ä¸ªæœ€å¤§å€¼ä¸ºæ— é™å¤§ï¼ˆæœ€å¤§æ•°ï¼‰çš„ä¿¡å·é‡ï¼Œå¯ä»¥ç”¨`std::counting_semaphore<> _semaphore`è¡¨ç¤ºã€‚\n# ä¿®æ”¹åçš„ç‰ˆæœ¬\n```cpp\n// ThreadPool.h\n#include <thread>\n#include <mutex>\n#include <semaphore>\n#include <list>\nnamespace thpool\n{\n\tclass ITask;\n\tclass ThreadPool\n\t{\n\tpublic:\n\t\tThreadPool(int max_num);\n\t\t~ThreadPool();\n\t\tvoid add_task(std::shared_ptr<ITask> task);\n\t\tvoid add_task(std::list<std::shared_ptr<ITask>> task_lst);\n\tprivate:\n\t\t// capacity\n\t\tint\t\t\t\t\t\t\t\t\t_max_num;\n\t\t// current running task threads\n\t\tint\t\t\t\t\t\t\t\t\t_alive_num;\n        std::counting_semaphore<>\t\t    _semaphore;\n\t\tstd::mutex\t\t\t\t\t\t\t_access_mx;\n\t\tbool\t\t\t\t\t\t\t\t_is_exit{ false };\n\t\tstd::list<std::shared_ptr<ITask>>\t_task_queue;\n\t};\n}\n```\n\n```cpp\n// ThreadPool.cpp\n#include \"ThreadPool.h\"\n#include \"ITask.h\"\n\nthpool::ThreadPool::ThreadPool(int max_num)\n\t: _max_num{ max_num }, _alive_num{ 0 }, _semaphore{ 0 }\n{\n\tfor (int i = 0; i < _max_num; ++i)\n\t{\n\t\tstd::jthread th([this](void)\n\t\t\t{\n\t\t\t\twhile (true)\n\t\t\t\t{\n\t\t\t\t\t_semaphore.acquire();\n\t\t\t\t\t++_alive_num;\n\t\t\t\t\tif (_is_exit)\n\t\t\t\t\t{\n\t\t\t\t\t\t--_alive_num;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n                    std::unique_lock lck{ _access_mx };\n                    if (_task_queue.size() > 0)\n                    {\n                        auto task = _task_queue.front();\n                        _task_queue.pop_front();\n                        lck.unlock();\n                        task->run_task();\n                    }\n\t\t\t\t\t--_alive_num;\n\t\t\t\t}\n\t\t\t\t--_max_num;\n\t\t\t});\n\t\tth.detach();\n\t}\n}\n\nvoid thpool::ThreadPool::add_task(std::shared_ptr<ITask> task)\n{\n\tif (!task)\n\t\treturn;\n\tstd::unique_lock lck{ _access_mx };\n\t_task_queue.push_back(task);\n\tlck.unlock();\n\t\n    _semaphore.release(1);\n}\n```\n# çº¿ç¨‹æ± çš„ææ„â€”â€”latchçš„è¿ç”¨\nlatchæ˜¯`C++20`å¼•å…¥çš„æ ‡å‡†ã€‚\nå®é™…ä¸Šæ˜¯å¯¹æ“ä½œç³»ç»ŸåŒæ­¥é‡çš„æ“ä½œçš„å°è£…ï¼Œæ¯”å¦‚åœ¨Windowsä¸‹ï¼Œlatchå°±æ˜¯å¯¹äº‹ä»¶çš„å°è£…ï¼Œæˆ–è€…æ˜¯å¯¹`WaitFor Single/Mutiple Object`çš„å°è£…ã€‚\n```cpp\n// ThreadPool.h\n#include <thread>\n#include <mutex>\n#include <semaphore>\n#include <list>\n#include <latch>\nnamespace thpool\n{\n\tclass ITask;\n\tclass ThreadPool\n\t{\n\tpublic:\n    \t// ...\n\tprivate:\n    \t// ...\n\t\tstd::latch                          _latch;\n        // ...\n};\n}\n```\nåœ¨ThreadPoolæ„é€ æ—¶åˆå§‹åŒ–`_latch`ä¸º`max_num`ï¼Œè¡¨ç¤ºéœ€è¦ç­‰å¾…`max_num`ä¸ªçº¿ç¨‹çš„ç»“æŸï¼Œlatchæ‰æ”¾è¡Œã€‚\nåŒæ—¶ï¼Œè¦åœ¨é€€å‡ºå¤§çš„whileå¾ªç¯æ—¶ï¼Œ`_max_num`å‡1ä¹‹åï¼Œè¿›è¡Œ`_latch.count_down()`ï¼Œå‚æ•°é»˜è®¤ä¸º1ï¼Œæ„ä¸ºå¯¹latchå€¼å‡1ã€‚\n```cpp\n// ThreadPool.cpp\n#include \"ThreadPool.h\"\n#include \"ITask.h\"\n\nthpool::ThreadPool::ThreadPool(int max_num)\n\t: _max_num{ max_num }, _alive_num{ 0 }, _semaphore{ 0 }, _latch{ max_num }\n{\n\tfor (int i = 0; i < _max_num; ++i)\n\t{\n\t\tstd::jthread th([this](void)\n\t\t\t{\n\t\t\t\twhile (true)\n\t\t\t\t{\n\t\t\t\t\t_semaphore.acquire();\n\t\t\t\t\t++_alive_num;\n\t\t\t\t\tif (_is_exit)\n\t\t\t\t\t{\n\t\t\t\t\t\t--_alive_num;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n                    // ...\n\t\t\t\t}\n\t\t\t\t--_max_num;\n\t\t\t\t_latch.count_down();\n\t\t\t});\n\t\tth.detach();\n\t}\n}\n```\nææ„å‡½æ•°ï¼Œåˆ™å¯ä»¥åˆ©ç”¨latchï¼Œè®©å…¶åœ¨ææ„å‡½æ•°è®¾ç½®`_is_exit`æ ‡å¿—ä¸ºtrueä¸”é‡Šæ”¾`_max_num`ä¿¡å·é‡åï¼Œwaitç›´åˆ°latchå€¼ä¸º0æ—¶ï¼Œä»£è¡¨æ‰€æœ‰çº¿ç¨‹éƒ½ç»“æŸäº†ï¼Œå°±å¯ä»¥è¿”å›äº†ã€‚\n```cpp\n// ThreadPool.cpp\nthpool::ThreadPool::~ThreadPool()\n{\n    _is_exit = true;\n    _semaphore.release(_max_num);\n    // ç­‰å¾…çº¿ç¨‹ç»“æŸï¼Œå¯¹åº”latchå…¶å€¼ä¸º0æ—¶\n    _latch.wait();\n}\n```\n# æµ‹è¯•\næ–°å»º`main_entry.cpp`\n```cpp\n// main_entry.cpp\n#include \"ThreadPool.h\"\n#include \"ITask.h\"\n#include <iostream>\nusing namespace std::chrono_literals;\nclass Task : public thpool::ITask\n{\npublic:\n    virtual void run_task(void) override\n    {\n        std::wcout << L\"task\" << std::endl;\n    }\n};\nint main(void)\n{\n    thpool::ThreadPool thread_pool{ 10 };\n    thread_pool.add_task(std::shared_ptr<thpool::ITask>(new Task));\n    thread_pool.add_task(std::shared_ptr<thpool::ITask>(new Task));\n    std::this_thread::sleep_for(10s);\n    return 0;\n}\n```\næµ‹è¯•ç»“æœï¼š\n![](../../images/çº¿ç¨‹æ± _bubo/image-20240925070123537.png)\nä¸¤ä¸ªtaské»åœ¨ä¸€èµ·ï¼Œè¯´æ˜å¤šçº¿ç¨‹è¾“å‡ºçš„ã€‚\n\nåœ¨Debug-Windows-Threadsä¸­ï¼Œå¯ä»¥çœ‹åˆ°ç›®å‰ç¨‹åºä¸­çš„çº¿ç¨‹çŠ¶å†µï¼š\n![](../../images/çº¿ç¨‹æ± _bubo/image-20240925070928536.png)\nå¯ä»¥çœ‹åˆ°æœ‰10ä¸ªå­çº¿ç¨‹åœ¨å…¶ä¸­ï¼š\n![](../../images/çº¿ç¨‹æ± _bubo/image-20240925071049814.png)\n","categories":["æ“ä½œç³»ç»Ÿ","å¤šçº¿ç¨‹","Cpp","é¡¹ç›®"]},{"title":"7z_å¸¸ç”¨å‘½ä»¤","url":"/ä¸€äº›å·¥å…·çš„ä½¿ç”¨/7z_å¸¸ç”¨å‘½ä»¤/","content":"# å‘½ä»¤æ ¼å¼\n```sh\nUsage: 7zz <command> [<switches>...] <archive_name> [<file_names>...] [@listfile]\n```\n# å®‰è£…\nå°†7zzæ–‡ä»¶ç§»åŠ¨åˆ°ç³»ç»Ÿçš„binç›®å½•\n`sudo cp 7zz /usr/local/bin/7zz`\nå¹¶ä¸”ç¡®ä¿`/usr/local/bin`åœ¨ç³»ç»ŸPATHä¸­\næ‰“å¼€æˆ–åˆ›å»º`.zshrc`ï¼ˆå¦‚æœä½ ä½¿ç”¨zshï¼‰æˆ–`.bash_profile`ï¼ˆå¦‚æœä½ ä½¿ç”¨bashï¼‰æ–‡ä»¶ï¼š\nç¡®è®¤æœ‰å¦‚ä¸‹å†…å®¹ï¼ˆå¦‚æœæ²¡æœ‰ï¼Œè¯·æ·»åŠ ï¼‰ï¼š\n`export PATH=\"/usr/local/bin:$PATH\"`\nä¿å­˜å¹¶å…³é—­æ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä½¿æ›´æ”¹ç”Ÿæ•ˆï¼š\n`source ~/.zshrc`æˆ–`~/.bash_profile`\n## commandï¼ˆå¿…é¡»ï¼‰\n\n| Command | Description                                                |\n| ------- | ---------------------------------------------------------- |\n| a       | Add files to archive                                       |\n| b       | Benchmark                                                  |\n| d       | Delete files from archive                                  |\n| e       | Extract files from archive (without using directory names) |\n| h       | Calculate hash values for files                            |\n| i       | Show information about supported formats                   |\n| l       | List contents of archive                                   |\n| rn      | Rename files in archive                                    |\n| t       | Test integrity of archive                                  |\n| u       | Update files to archive                                    |\n| x       | eXtract files with full paths                              |\n1. aæ˜¯ä»£è¡¨å‹ç¼©æ–‡ä»¶åˆ°å‹ç¼©åŒ…\n2. eä¸­çš„â€œwithout using directory namesâ€è¡¨ç¤ºçš„æ˜¯è§£å‹ç¼©åçš„æ–‡ä»¶å°†ä¸ä¼šæœ‰æ–‡ä»¶å¤¹ä¸€çº§çš„ç›®å½•ï¼Œè€Œæ˜¯å…¨éƒ¨ä¸ºé›¶æ•£çš„æ–‡ä»¶ã€‚\n3. xä»£è¡¨è§£å‹ç¼©æ–‡ä»¶ï¼Œè§£å‹ç¼©åæœ‰å‹ç¼©åŒ…ä¸­åŸæ¥çš„æ–‡ä»¶å¤¹ã€‚\n\n## switchesï¼ˆå¯é€‰ï¼‰\nä¸‹é¢åªåˆ—å‡ºäº†å¸¸ç”¨çš„ã€‚\n\n| Switches         | Description                                                    |\n| ---------------- | -------------------------------------------------------------- |\n| `-m{Parameters}` | set compression Method                                         |\n| `  -mmt[N]`      | set number of CPU threads                                      |\n| `  -mx[N]`       | set compression level: -mx1 (fastest) ... -mx9 (ultra)         |\n| `-o{Directory}`  | set Output directory                                           |\n| `-p{Password}`   | set Password                                                   |\n| `-slt`           | show technical information for l (List) command                |\n| `-snh`           | store hard links as links                                      |\n| `-snl`           | store symbolic links as links                                  |\n| `-ssp`           | do not change Last Access Time of source files while archiving |\n| `-stx{Type}`     | exclude archive type                                           |\n| `-t{Type}`       | Set type of archive                                            |\n| `-y`             | assume Yes on all queries                                      |\næ³¨æ„ï¼Œå®ƒç»™å‡ºçš„å½¢å¼æ˜¯å½¢å¦‚è¿™ç§çš„ï¼š`-o{Directory}`ï¼Œ`-o`å’Œåé¢çš„å‚æ•°åæ˜¯æ²¡æœ‰ç©ºæ ¼é—´éš™çš„ï¼Œå¦åˆ™æ— æ³•è¯†åˆ«ã€‚\n\nç°åœ¨æ¯”å¦‚è¯´ï¼Œæˆ‘æƒ³è¦è§£å‹ç¼©`QuickGeometryUI.zip`åˆ°å½“å‰ç›®å½•ä¸‹çš„`dir`æ–‡ä»¶å¤¹ï¼ˆæœªåˆ›å»ºï¼‰ï¼š\n```sh\n7zz x QuickGeometryUI.zip -odir\n```\n\næˆ‘æƒ³è¦å‹ç¼©å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ï¼ˆaã€bã€`.test`ï¼‰åˆ°`my7zip`ï¼š\n```sh\n7zz a my7zip *\n```\nç»“æœæ˜¯ï¼š\n1. åªå‹ç¼©äº†aã€bï¼Œéšè—æ–‡ä»¶æ²¡æœ‰ï¼Œå› ä¸º`*`ä¸ä¼šé€šé…éšè—æ–‡ä»¶ã€‚\n2. å‹ç¼©åŒ…åå­—è‡ªåŠ¨å¸¦ä¸Šäº†åç¼€`my7zip.7z`\næ‰€ä»¥ï¼Œå¦‚æœæƒ³è¦å‹ç¼©åŒ…å«éšè—æ–‡ä»¶ï¼Œå»ºè®®å°†å…¶ä½œä¸ºæ•´ä¸ªæ–‡ä»¶å¤¹ï¼ˆæ”¾åˆ°äº†Test7zipç›®å½•ä¸­ï¼‰å‹ç¼©ã€‚\n```\n7zz a my7zip Test7zip\n```","categories":["ä¸€äº›å·¥å…·çš„ä½¿ç”¨"]},{"title":"åç¨‹_Cppåç¨‹","url":"/å¤šçº¿ç¨‹/åç¨‹_Cppåç¨‹/","content":"# åç¨‹æ¡†æ¶çš„è§£é‡Š\næ€ä¹ˆä½¿ç”¨æ¡†æ¶ï¼Ÿ\nå†™äº†æ‘„åƒå¤´çš„é©±åŠ¨ï¼Œé©±åŠ¨æœ‰sdkï¼Œç”¨æˆ·å¯ä»¥è°ƒç”¨sdkï¼Œæ¥é©±åŠ¨æ‘„åƒå¤´ã€‚\næ‘„åƒå¤´æ˜¯ç”¨ä»€ä¹ˆå½¢å¼çš„APIå†™çš„ï¼Ÿå°±ä¸ä¸€å®šäº†ï¼Œå¯èƒ½æ˜¯Cè¯­è¨€ï¼Œå¯èƒ½æ˜¯`C++`ã€‚`C++`å¯ä»¥æŒ‰MFCæä¾›ï¼Œä¹Ÿå¯ä»¥æŒ‰é¢å‘å¯¹è±¡æä¾›ï¼Œä¹Ÿå¯ä»¥æŒ‰ç±»ä¼¼äºCOMç»„ä»¶ï¼ˆæ¥å£ï¼‰çš„å½¢å¼æä¾›ï¼Œä¹Ÿå¯ä»¥æŒ‰åç¨‹åº“çš„å½¢å¼æä¾›ã€‚\næ­¤åç¨‹åº“æ¡†æ¶ï¼Œæ˜¯ç»™APIå‚å•†ä½¿ç”¨çš„ã€‚ä¸æ˜¯ä¸€ä¸ªå·²ç»å®ç°äº†çš„åº“ï¼Œæ›´åƒæ˜¯ä¸€ä¸ªä¸­é—´ä»¶ã€‚\næ¯”å¦‚æˆ‘ä»¬æƒ³è¦æä¾›ä¸€ä¸ªè¯»æ–‡ä»¶çš„å‡½æ•°ç»™ç”¨æˆ·ä½¿ç”¨ï¼ŒreadFileï¼Œä»åå­—æ¥çœ‹å…¶ä¸€èˆ¬æ˜¯é˜»å¡çš„ï¼Œè¯»å®Œåæ‰èƒ½è¿”å›ã€‚å¦‚æœä¸æƒ³é˜»å¡ï¼Œåˆ™å¼€è¾Ÿä¸€ä¸ªçº¿ç¨‹ï¼Œåœ¨æ–°çº¿ç¨‹ä¸­è®©å…¶readFileã€‚\néé˜»å¡ç‰ˆæœ¬å¯ä»¥ç§°å…¶ä¸º`readFile_Async`ã€‚ç”¨æˆ·ä»åå­—ä¸Šå°±èƒ½çœ‹åˆ°ï¼Œè¿™æ˜¯éé˜»å¡çš„ï¼Œè°ƒç”¨åä¸»çº¿ç¨‹å¯ä»¥ç«‹å³æŠ½èº«å»å¤„ç†å…¶ä»–äº‹æƒ…ï¼Œåœ¨å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œä»¥å›è°ƒçš„å½¢å¼é€šçŸ¥ä¸»çº¿ç¨‹ã€‚\nè€Œåœ¨åç¨‹ç‰ˆæœ¬ä¸‹çš„å®ç°å½¢å¼åˆ™ä¸åƒä¼ ç»Ÿçº¿ç¨‹é—´çš„å›è°ƒå½¢å¼ï¼ˆè¢«å‰²è£‚åœ¨ä¸¤ç«¯ï¼‰ï¼Œè€Œæ˜¯ç›´æ¥åœ°å†™åœ¨äº†ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œç”¨`co_await`è¿æ¥ä¸Šä¸‹åŠ¨ä½œï¼Œæ­¤å¤„çš„`co_await`çš„æˆåŠŸåçš„è¿”å›â€œç›¸å½“äºâ€å›è°ƒå‡½æ•°ã€‚å›è°ƒä¹‹åï¼Œå°±ç»§ç»­åš`co_await`ä¹‹åçš„åŠ¨ä½œå³å¯ã€‚\nåç¨‹åº“æ¡†æ¶è¿˜å¯ä»¥çµæ´»åˆ‡æ¢åç¨‹æ‰€åœ¨çš„çº¿ç¨‹ï¼Œæ¯”å¦‚åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹ã€å·¥ä½œçº¿ç¨‹ç­‰ç­‰ã€‚ä¹Ÿå¯ä»¥é…ç½®çº¿ç¨‹æ± ã€‚\nå‡å¦‚æˆ‘ä»¬æ˜¯ä¸€ä¸ªå‚å•†ï¼Œç°åœ¨ä½¿ç”¨è¯¥åç¨‹åº“æ¡†æ¶å¼€å‘ä¸€ä¸ªreadFile APIï¼š\n```cpp\n#include \"Agave.hpp\"\n#include <iostream>\nagave::AsyncAction read_file_async(void)\n{\n\n}\nagave::AsyncOperation<int> compute_async(void)\n{\n\n}\n```\n# åç¨‹å·¥ä½œçš„æ€»ä½“æµç¨‹\nåç¨‹çš„å·¥ä½œæµï¼Œåœ¨å½¢å¼ä¸Šï¼Œæ˜¯åŒ…è£…åœ¨ä¸€ä¸ªå‡½æ•°ä¸­çš„ã€‚\nåœ¨å‡½æ•°ä¸­ï¼Œé—´æ–­åœ°è¿›è¡Œï¼šworkçŠ¶æ€å’Œ`co_await`çŠ¶æ€äº¤æ›¿ã€‚\nå‡å¦‚ï¼Œåç¨‹åœ¨t1çº¿ç¨‹ä¸Šè¿›è¡ŒworkçŠ¶æ€ã€‚æ­¤æ—¶ï¼Œéœ€è¦`co_await`ã€‚\n`co_await`è¡¨ç¤ºç­‰å¾…ç€æŸä¸€ä¸ªå…¶ä»–å·¥ä½œçš„ç»“æœã€‚æ¯”å¦‚ç­‰å¾…ç½‘ç»œä¸­ä¼ æ¥çš„æ–‡ä»¶ï¼Œç­‰å¾…ä¸‹è½½å®Œæ¯•ã€‚åœ¨`co_await`æ—¶ï¼Œæ­¤å‡½æ•°å°±ä¼šè¿”å›ï¼Œåç¨‹æš‚åœè¿è¡Œã€‚`co_await`æˆåŠŸåï¼Œæ‰èƒ½ç»§ç»­ä¸‹é¢çš„æ“ä½œã€‚\nä¸‹é¢çš„æ“ä½œï¼Œå¯èƒ½ä¼šåœ¨t2çº¿ç¨‹ä¸Šè¿›è¡Œworkï¼ˆä¹Ÿå¯èƒ½ç»§ç»­åœ¨t1ï¼Œåªæ˜¯ä¸¾ä¸ªä¾‹å­ï¼‰ã€‚\néšåï¼Œå¯èƒ½è¿˜ä¼šè¿›è¡Œ`co_await`ç­‰æ“ä½œã€‚\n\n>çœ‹æ ·å­`co_await`è¡¨ç¤ºçš„æ˜¯â€œç­‰å¾…â€çš„æ„æ€ï¼Œä½†åœ¨åç¨‹çš„å·¥ä½œç¯å¢ƒä¸­ï¼Œå…¶å®è¯­ä¹‰æ›´åƒæ˜¯\"ä¸ç­‰äº†\"ï¼Œâ€œæˆ‘å…ˆå»å¤„ç†åˆ«çš„äº‹äº†ï¼Œå…ˆèµ°äº†â€ã€‚æœ‰ç‚¹å„¿å¼‚æ­¥çš„æ„Ÿè§‰ã€‚å› ä¸º`co_await`è¯­å¥ä½¿ç”¨æ—¶ï¼Œä¼šé©¬ä¸Šé€€å‡ºæ—¢æœ‰æµç¨‹ï¼Œç›´åˆ°è¢«é€šçŸ¥ï¼Œæ‰è¿›è¡Œå›è°ƒï¼Œä»è€Œè¿”å›workçŠ¶æ€ã€‚\n\nä»t1çº¿ç¨‹åˆ°t2çº¿ç¨‹çš„è½¬å˜ï¼Œç›¸å½“äºè°ƒç”¨äº†ä¸€ä¸ªcallbackã€‚æ­¤callbackæ˜¯è¢«`co_await`é—´éš”çš„ã€‚\n\nç”±ä¸Šè¿°ä¾‹å­è¯´æ˜ï¼Œåç¨‹å’Œçº¿ç¨‹ä¸å†²çªï¼ˆæˆ–è€…è¯´æ²¡å…³ç³»ï¼‰ï¼Œå› ä¸ºæ¯æ¬¡`co_await`æˆåŠŸåä¸ä¸€å®šä¼šåˆ‡æ¢åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ã€‚\n# åˆ›å»ºé¡¹ç›®\nå…ˆåˆ›å»ºä¸€ä¸ªç©ºé¡¹ç›®ã€‚ï¼ˆAgaveæ˜¯æ ¹æ®`C++`æ ‡å‡†åç¨‹åº“ç¼–å†™çš„ï¼Œè®°å¾—è®¾ç½®ä¸º20æ ‡å‡†ï¼‰\nå†copyå·²æœ‰çš„4ä¸ªæ–‡ä»¶ï¼ˆ`Agave.cpp`ã€`B_Object.hpp`ã€`BJobScheduler.cpp`ã€`BJobScheduler.h`ï¼‰åˆ°è¯¥ç©ºé¡¹ç›®æ–‡ä»¶ç›®å½•ä¸‹ã€‚\nä¹‹åï¼Œå³é”®VSé¡¹ç›®ä¸­çš„`Header Files`ï¼ŒAddï¼ŒExisting Itemï¼Œé€‰æ‹©`.hpp`å’Œ`.h`æ–‡ä»¶ã€‚\nå³é”®`Source Files`ï¼ŒAddï¼ŒExisting Itemï¼Œé€‰æ‹©`.cpp`æ–‡ä»¶ã€‚\nåœ¨`Source Files`ä¸­æ–°å»ºä¸€ä¸ªæ–‡ä»¶`demo.cpp`ã€‚åœ¨å…¶ä¸­ç¼–å†™æµ‹è¯•ä»£ç ã€‚\n## åˆè¯•1\n1. demoå‡½æ•°è¿”å›å€¼æ˜¯`agave::IAsyncAction`ï¼Œåˆ™ä»£è¡¨æ­¤å‡½æ•°æ˜¯ä¸€ä¸ªåç¨‹ã€‚\n2. æˆ‘ä»¬åœ¨mainä¸»çº¿ç¨‹ä¸­è°ƒç”¨demoï¼Œå³åœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»ºæ­¤åç¨‹ã€‚\n3. demoåç¨‹åœ¨å…¶ä¸­`co_await`ï¼Œåé¢æ¥çš„`read_file_async`å¯ä»¥çœ‹ä½œæ˜¯å‚å®¶çš„APIã€‚è¿™ä¸ªAPIçš„åç§°å¸¦æœ‰`async`ï¼Œæ„å‘³ç€å®ƒæ˜¯ä¸€ä¸ªå¼‚æ­¥çš„æ“ä½œï¼Œåœ¨æ­¤`co_await XXX_async`è¯­å¥åï¼Œä¼šç«‹å³è¿”å›ã€‚ä½†æ˜¯ä¸ä¼šè¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œï¼ˆè¾“å‡ºè¯»å–å®Œæ¯•ï¼‰ï¼Œè€Œæ˜¯æš‚æ—¶ç»“æŸdemoâ€œå‡½æ•°â€ï¼Œç›´åˆ°`co_await`çš„æ“ä½œï¼ˆ`read_file_async`ï¼‰å®Œæˆåï¼Œæ‰ç»§ç»­demoä¹‹åçš„æ“ä½œï¼Œç›¸å½“äºè¢«callbackã€‚\n\n```cpp\n#include \"Agave.hpp\"\n#include <iostream>\n\nusing namespace std::chrono_literals;\n\nagave::AsyncAction read_file_async(void)\n{\n    std::cout << \"Read File Coroutine started on thread: \" << std::this_thread::get_id() << '\\n';\n    std::cout << \"Reading...\" << std::endl;\n    // æ³¨æ„æ­¤å¤„ä¸èƒ½ä½¿ç”¨this_thread::sleep_for\n    // std::this_thread::sleep_for(5s); // error\n    co_await 5s; // ç­‰å¾…5ç§’ï¼Œæ¨¡æ‹Ÿæ–‡ä»¶è¯»å–\n    co_return; // ç›¸å½“äºcallback\n}\nagave::AsyncAction demo()\n{\n    std::cout << \"demo() on thread: \" << std::this_thread::get_id() << '\\n';\n    co_await read_file_async();\n    std::cout << \"Reading finished on thread: \" << std::this_thread::get_id() << '\\n';\n}\nint main(void)\n{\n    std::cout << \"Main on thread: \" << std::this_thread::get_id() << '\\n';\n    auto action = demo();\n    // ä¸»çº¿ç¨‹ç­‰å¾…åç¨‹è¿è¡Œå®Œæ¯•\n    std::this_thread::sleep_for(8s);\n    return 0;\n}\n```\n### å…³äºä¸ºä»€ä¹ˆä¸èƒ½ç”¨`sleep_for`\nç»æµ‹è¯•ï¼Œå¦‚æœç”¨`sleep_for`\nè¾“å‡ºæ˜¯è¿™æ ·ï¼šå‘ç°æ²¡æœ‰æ‰§è¡Œè¾“å‡ºdemoçš„ç¬¬ä¸‰ä¸ªè¯­å¥ï¼ˆReading finishedï¼‰\n```\nMain on thread: 25912\ndemo() on thread: 25912\nRead File Coroutine started on thread: 25912\nReading...\n\n(Program End)\n```\nä¸ºä»€ä¹ˆå‘¢ï¼Ÿä¸”çœ‹ä¸‹é¢çš„æ­£å¸¸è¾“å‡ºç»“æœä¸­å¯¹çº¿ç¨‹è¿è¡Œçš„åˆ†æã€‚\n### è¾“å‡ºç»“æœ\n```\nMain on thread: 6260 \ndemo() on thread: 6260\nRead File Coroutine started on thread: 6260\nReading...\nReading finished on thread: 20516\n\n```\ndemoåç¨‹åœ¨ä¸»çº¿ç¨‹6260å¯åŠ¨ï¼Œå¦ä¸€ä¸ªreadåç¨‹ä¹Ÿåœ¨ä¸»çº¿ç¨‹6260å¯åŠ¨ã€‚è€Œè¯»å–å®Œæ¯•åï¼Œdemoåç¨‹æ­¤æ—¶å´å¤„äº20516çº¿ç¨‹ï¼ˆå†…å®¹æ˜¯é€šçŸ¥ä¿¡æ¯ï¼Œé€šçŸ¥readæ“ä½œå®Œæ¯•ï¼‰ã€‚\n>å› æ­¤ä¸Šé¢ä¸ºä»€ä¹ˆåœ¨readåç¨‹å‡½æ•°ä¸­ç”¨`sleep_for`å°±ä¸èƒ½æ­£å¸¸æ‰“å°æœ€åä¸€å¥è¯ï¼Œå¯èƒ½å’Œreadåç¨‹å‡½æ•°è°ƒç”¨`this_thread`ç¡çœ å¯¼è‡´ä¸»çº¿ç¨‹ç¡çœ æœ‰å…³ç³»ã€‚\n>\n>æ€»ä¹‹ï¼Œæµ‹è¯•çš„ç»“æœå°±æ˜¯readåç¨‹ç¡çœ åï¼Œå†ä¹Ÿæ²¡å›åˆ°demoä¸­å»ã€‚\n\nè¿™æ ·çš„çº¿ç¨‹æ¨¡å¼æ˜¯ä¸å¥½çš„ï¼š\n1. demoåç¨‹åœ¨ä¸»çº¿ç¨‹å¯åŠ¨æ— æ‰€è°“ï¼Œæ²¡äº‹ã€‚\n2. ä½†æ˜¯readåç¨‹ä»¥åŠreadæ“ä½œåœ¨ä¸»çº¿ç¨‹ä¸Šå°±ä¸å¦¥äº†ï¼Œåº”è¯¥å°†readæ“ä½œå¦èµ·ä¸€ä¸ªçº¿ç¨‹\n3. åœ¨readå®Œæ¯•callbackåï¼Œæ‰§è¡Œdemoä¸­çš„ç¬¬ä¸‰å¥ï¼Œåº”è¯¥ç»™ä¸»çº¿ç¨‹é€šçŸ¥æ‰å¯¹ï¼Œä¸åº”è¯¥é€šçŸ¥ç»™ä¸€ä¸ªæ— å…³çš„çº¿ç¨‹ã€‚æˆ‘ä»¬æ­¤ä¾‹é€šçŸ¥ç»™äº†ä¸€ä¸ªæ— å…³çš„çº¿ç¨‹ï¼Œæ˜¯å› ä¸ºreadåç¨‹å‡½æ•°ä¸­`co_await 5s`ä¼šå¯¼è‡´å®ƒå¦èµ·ä¸€ä¸ªæ—¶é—´çº¿ç¨‹ã€‚å¯¼è‡´è¿”å›åˆ°demoä¸­æ—¶ï¼Œè·‘åˆ°äº†è¿™ä¸ªæ—¶é—´çº¿ç¨‹ä¸­å»é€šçŸ¥äº†ã€‚\n## åˆè¯•2\næ›´æ”¹æ¨¡å¼ï¼Œåº”è¯¥åœ¨readåç¨‹å‡½æ•°ä¸­å¦èµ·çº¿ç¨‹ï¼Œè°ƒç”¨çš„æ˜¯`co_await agave::resume_background()`ã€‚æ„ä¸ºå”¤é†’ä¸€ä¸ªåå°çš„çº¿ç¨‹ã€‚é»˜è®¤æ˜¯å³åˆ»æ„é€ ä¸€ä¸ª`std::jthread`ã€‚æˆ‘ä»¬åæœŸä¹Ÿå¯ä»¥æ‹“å±•åŠŸèƒ½ï¼Œå°†è¿™ä¸ªæ¥å£è¿æ¥åˆ°ä¸€ä¸ªçº¿ç¨‹æ± ä¸­ï¼Œä»çº¿ç¨‹æ± ä¸­æ‹¿å–çº¿ç¨‹ã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°±å¯ä»¥ä½¿ç”¨`sleep_for`äº†ã€‚\n```cpp\n#include \"Agave.hpp\"\n#include <iostream>\n\nusing namespace std::chrono_literals;\n\nagave::AsyncAction read_file_async(void)\n{\n    co_await agave::resume_background(); // å¦èµ·çº¿ç¨‹\n    std::cout << \"Read File Coroutine started on thread: \" << std::this_thread::get_id() << '\\n';\n    std::cout << \"Reading...\" << std::endl;\n    \n    std::this_thread::sleep_for(5s);\n    \n    co_return; // ç›¸å½“äºcallback\n}\nagave::AsyncAction demo()\n{\n    std::cout << \"demo() on thread: \" << std::this_thread::get_id() << '\\n';\n    co_await read_file_async();\n    std::cout << \"Reading finished on thread: \" << std::this_thread::get_id() << '\\n';\n}\nint main(void)\n{\n    std::cout << \"Main on thread: \" << std::this_thread::get_id() << '\\n';\n    auto action = demo();\n    // ä¸»çº¿ç¨‹ç­‰å¾…åç¨‹è¿è¡Œå®Œæ¯•\n    std::this_thread::sleep_for(8s);\n    return 0;\n}\n```\nè¾“å‡ºç»“æœï¼š\n```\nMain on thread: 29580\ndemo() on thread: 29580\nRead File Coroutine started on thread: 15800\nReading...\nReading finished on thread: 15800\n\n```\nä½†æ˜¯æ­¤æ—¶demoçš„readæ“ä½œå®Œæ¯•æ¶ˆæ¯è¿˜æ˜¯æ²¡æœ‰å‘é€ç»™ä¸»çº¿ç¨‹ï¼Œè€Œæ˜¯å‘é€ç»™äº†readå¦èµ·çš„çº¿ç¨‹ä¸­ã€‚\nå¦‚ä½•å›åˆ°ä¸»çº¿ç¨‹å‘¢ï¼Ÿä¸åŒçš„æ“ä½œç³»ç»Ÿå…·ä½“å®ç°ä¸ä¸€æ ·ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥è‡ªå·±å†™ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£`resume_mainThread`ã€‚åœ¨demoä¸­çš„`co_await read_file_async`è¯­å¥çš„ä¸‹ä¸€æ¡å†™ä¸‹`co_await resume_mainThread()`ã€‚ä¹‹åçš„è¾“å‡ºæ“ä½œä¾¿çš„åœ¨ä¸»çº¿ç¨‹ä¸­æ“ä½œäº†ã€‚\n## è¿”å›å¸¦å€¼\nä¸è¿”å›ä¸œè¥¿æ—¶è¿”å›å€¼ç±»å‹å†™ä¸º`agave::IAsyncAction`ã€‚\nè¿”å›ä¸œè¥¿æ—¶ï¼Œè¿”å›å€¼ç±»å‹å†™ä¸º`agave::IAsyncOperation<T>`ã€‚æ¨¡æ¿å‚æ•°ç±»å‹æ˜¯è¦æºå¸¦çš„å€¼ç±»å‹ã€‚\nå¯¹åº”åœ°ï¼Œ`co_await`ä¸èƒ½è£¸ç€ç”¨äº†ï¼Œè¦ç”¨ä¸€ä¸ªå˜é‡æ¥æ”¶ã€‚\n```cpp\nagave::AsyncOperation<int> read_file_async(void)\n{\n    co_await agave::resume_background(); // å¦èµ·çº¿ç¨‹\n    std::cout << \"Read File Coroutine started on thread: \" << std::this_thread::get_id() << '\\n';\n    std::cout << \"Reading...\" << std::endl;\n    \n    std::this_thread::sleep_for(5s);\n    \n    co_return 50; // callback + æºå¸¦å€¼\n}\n\nagave::AsyncAction demo()\n{\n    std::cout << \"demo() on thread: \" << std::this_thread::get_id() << '\\n';\n    \n    auto result = co_await read_file_async();\n    \n    std::cout << \"Reading finished: \" << result << \", on thread: \" << std::this_thread::get_id() << '\\n';\n}\n```\n# åç¨‹å–æ¶ˆ\n1. è°ƒç”¨`co_await agave::get_cancellation_token()`è·å–ä¸€ä¸ªæ­¤åç¨‹çš„å–æ¶ˆå˜é‡ã€‚éšæ—¶å¯ä»¥æŸ¥çœ‹`can.is_canceled()`æ¥åˆ¤æ–­æ˜¯å¦æœ‰å–æ¶ˆä¿¡å·ã€‚\n2. åœ¨å…¶ä»–çº¿ç¨‹ä¸­ï¼Œé€šè¿‡`auto async_var = read_file_async()`æ‹¿åˆ°åç¨‹çš„æ ‡è¯†ï¼Œæä¾›è¿™ä¸ªæ ‡è¯†`async_var.cancel()`ï¼Œæ¥ç»™è¯¥åç¨‹å‘é€å–æ¶ˆä¿¡å·ã€‚\n\n```cpp\n#include \"Agave.hpp\"\n#include <iostream>\n\nusing namespace std::chrono_literals;\n\nagave::AsyncAction read_file_async(void)\n{\n    co_await agave::resume_background(); // å¦èµ·çº¿ç¨‹\n    auto can = co_await agave::get_cancellation_token();\n    std::cout << \"Read File Coroutine started on thread: \" << std::this_thread::get_id() << '\\n';\n    for (int i = 0; i < 5; ++i)\n    {\n        std::this_thread::sleep_for(1s);\n        if (can.is_canceled())\n        {\n            std::cout << \"Canceled on thread: \" << std::this_thread::get_id() << '\\n';\n            break;\n        }\n        else\n        {\n            std::cout << \"Reading... \" << i << std::endl;\n        }\n    }\n\n    co_return; // ç›¸å½“äºcallback\n}\nagave::AsyncAction demo()\n{\n    std::cout << \"demo() on thread: \" << std::this_thread::get_id() << '\\n';\n    auto async_var = read_file_async();\n    std::this_thread::sleep_for(3s);\n    async_var.cancel();\n    co_await async_var;\n\n    std::cout << \"Reading finished on thread: \" << std::this_thread::get_id() << '\\n';\n\n}\nint main(void)\n{\n    std::cout << \"Main on thread: \" << std::this_thread::get_id() << '\\n';\n    auto action = demo();\n    // ä¸»çº¿ç¨‹ç­‰å¾…åç¨‹è¿è¡Œå®Œæ¯•\n    std::this_thread::sleep_for(8s);\n    return 0;\n}\n```\nè¾“å‡ºï¼š\n```\nMain on thread: 18768\ndemo() on thread: 18768\nRead File Coroutine started on thread: 19036\nReading... 0\nReading... 1\nCanceled on thread: 19036\nReading finished on thread: 19036\n\n```\n# Asyncçš„æœºåˆ¶æ€ä¹ˆå®ç°\nAsyncæ¢å¥è¯æ¥è¯´æ˜¯è®©å‡½æ•°ï¼ˆæˆ–ä»»åŠ¡ï¼‰çš„ç»“æœåœ¨â€œæˆåŠŸä¹‹åâ€è¿”å›ï¼ˆä½†å®é™…ä¸Šå‡½æ•°è°ƒç”¨åå½“å³è¿”å›äº†ï¼‰ã€‚å¦‚æœæ˜¯åœ¨Cè¯­è¨€ä¸‹åšï¼Œæ˜¯å‡½æ•°è¿”å›ä¸€ä¸ªæ ‡å·ï¼Œæˆ‘ä»¬åœ¨å¤–éƒ¨è½®è¯¢ä¸€ä¸ªèŒƒå›´çš„æ ‡å·ï¼Œå¦‚æœæœ‰æŸä¸ªæ ‡å·ä¸Šæœ‰æ¶ˆæ¯ï¼Œå†å»è·å–å®ƒã€‚\n# åœºæ™¯\n```cpp\n#include <iostream>\n#include <thread>\n#include <chrono>\n#include <functional>\nusing namespace std::literals;\nvoid call_back();\nint main()\n{\n    std::wcout << L\"Main Thread Id: \" << std::this_thread::get_id() << std::endl;\n    std::jthread([](std::function<void(void)> cb) -> void\n        {\n            std::wcout << L\"Thread Id: \" << std::this_thread::get_id() << std::endl;\n            std::wcout << L\"doing on worker...\" << std::endl;\n            std::this_thread::sleep_for(5s);\n            cb();\n        }, call_back).join();\n    return 0;\n}\nvoid call_back()\n{\n    std::wcout << L\"update UI on Thread: \" << std::this_thread::get_id() << std::endl;\n    std::wcout << L\"updating...\" << std::endl;\n    std::this_thread::sleep_for(3s);\n    std::wcout << L\"finish update!\" << std::endl;\n}\n```\n\nè¾“å‡ºç»“æœï¼š\n```\nMain Thread Id: 39288           // Main Thread æ˜¯UIçº¿ç¨‹\nThread Id: 24632                // Worker çº¿ç¨‹\ndoing on worker...\nupdate UI on Thread: 24632      // æ›´æ–°ä¸åœ¨UIçº¿ç¨‹ä¸Šï¼Œè¿™ç§çš„è¡¨ç°ä¸å¥½\nupdating...\nfinish update!\n\n```\n\n## ä¼ ç»Ÿå›è°ƒæ¨¡å¼-å·¥ä½œçº¿ç¨‹è‡ªå·±æ‰§è¡Œcb\n```cpp\n// main.cpp\n#include <iostream>\n#include <thread>\n#include <chrono>\n#include <functional>\nusing namespace std::literals;\nvoid call_back();\nint main()\n{\n    std::wcout << L\"Main Thread Id: \" << std::this_thread::get_id() << std::endl;\n    std::jthread([](std::function<void(void)> cb) -> void\n    {\n        std::wcout << L\"Thread Id: \" << std::this_thread::get_id() << std::endl;\n        std::wcout << L\"doing on worker...\" << std::endl;\n        std::this_thread::sleep_for(5s);\n        cb();\n    }, call_back).join();\n    return 0;\n}\nvoid call_back()\n{\n    std::wcout << L\"update UI on Thread: \" << std::this_thread::get_id() << std::endl;\n    std::wcout << L\"updating...\" << std::endl;\n    std::this_thread::sleep_for(3s);\n    std::wcout << L\"finish update!\" << std::endl;\n}\n```\nè¿è¡Œç»“æœï¼š\n```\nMain Thread Id: 23092\nThread Id: 11032\ndoing on worker...\nupdate UI on Thread: 11032\nupdating...\nfinish update!\n```\nå‘ç°ï¼ŒUIçš„æ”¹å˜æ˜¯åœ¨å·¥ä½œè€…çº¿ç¨‹å®Œæˆçš„ï¼Œè€Œä¸æ˜¯UIçº¿ç¨‹ã€‚è¿™æ˜¯é”™è¯¯çš„ã€‚\n## ä¼ ç»Ÿå›è°ƒæ¨¡å¼æ”¹è¿›-æ¶ˆæ¯é˜Ÿåˆ—-å·¥ä½œè€…çº¿ç¨‹ä¼ é€cbå‡½æ•°å¯¹è±¡åˆ°main\nç°åœ¨ï¼ŒåŠ ä¸€ä¸ªæ¶ˆæ¯ä»»åŠ¡é˜Ÿåˆ—ï¼Œå·¥ä½œè€…çº¿ç¨‹å¯ä»¥æ·»åŠ cbå‡½æ•°å¯¹è±¡åˆ°æ­¤é˜Ÿåˆ—ã€‚\nç„¶åï¼Œä¸»çº¿ç¨‹ï¼ˆUIçº¿ç¨‹ï¼‰å¯ä»¥å¾ªç¯å»ä»»åŠ¡é˜Ÿåˆ—æ‹¿ã€‚æ‹¿å‡ºä¸€ä¸ªcbå‡½æ•°å¯¹è±¡ï¼Œç”±UIçº¿ç¨‹äº²è‡ªè°ƒç”¨ã€‚\nè¿™æ ·å°±å¯ä»¥è¾¾åˆ°åœ¨UIçº¿ç¨‹ä¸Šæ›´æ”¹å†…å®¹ã€‚\n```cpp\n// main.cpp\n#include <iostream>\n#include <thread>\n#include <chrono>\n#include <functional>\n#include \"TaskQueue.h\"\nusing namespace std::literals;\nvoid call_back();\nTaskQueue queue;\n\nvoid run_on_main(std::function<void(void)> fn);\nint main()\n{\n    std::wcout << L\"Main Thread Id: \" << std::this_thread::get_id() << std::endl;\n    std::jthread([](std::function<void(void)> cb) -> void\n        {\n            std::wcout << L\"Thread Id: \" << std::this_thread::get_id() << std::endl;\n            std::wcout << L\"doing on worker...\" << std::endl;\n            std::this_thread::sleep_for(5s);\n            run_on_main(cb);\n        }, call_back).detach();\n    queue.run();\n    return 0;\n}\nvoid call_back()\n{\n    std::wcout << L\"update UI on Thread: \" << std::this_thread::get_id() << std::endl;\n    std::wcout << L\"updating...\" << std::endl;\n    std::this_thread::sleep_for(3s);\n    std::wcout << L\"finish update!\" << std::endl;\n}\nvoid run_on_main(std::function<void(void)> fn)\n{\n    queue.add_task(fn);\n}\n\n```\n### TaskQueue\n```cpp\n// TaskQueue.h\n#pragma once\n#include <list>\n#include <functional>\n#include <condition_variable>\n#include <mutex>\nusing Task = std::function<void(void)>;\nclass TaskQueue\n{\npublic:\n    void add_task(Task task);\n    void run(void);\nprivate:\n    std::list<Task> _task_queue;\n    std::condition_variable _cv;\n    std::mutex _mx;\n};\n-----------------------------------\n// TaskQueue.cpp\n#include \"TaskQueue.h\"\nvoid TaskQueue::add_task(Task task)\n{\n    std::unique_lock lck{ _mx };\n    _task_queue.push_back(task);\n    _cv.notify_one();\n}\nvoid TaskQueue::run()\n{\n    std::list<Task> queue;\n    std::unique_lock lck{ _mx };\n    while (true)\n    {\n        _cv.wait(lck, [this]()->bool { return _task_queue.size() > 0; });\n        if (!_task_queue.empty())\n        {\n            _task_queue.swap(queue);\n        }\n        lck.unlock();\n        while (queue.size() > 0)\n        {\n            auto task = queue.front();\n            queue.pop_front();\n            task();\n        }\n        lck.lock();\n    }\n}\n```\n### ç»“æœ\n```\nMain Thread Id: 41388         // Main Thread æ˜¯UIçº¿ç¨‹\nThread Id: 45076              // Workerçº¿ç¨‹\ndoing on worker...\nupdate UI on Thread: 41388    // å‘ç°ï¼Œå·¥ä½œåœ¨UIçº¿ç¨‹ï¼ŒæˆåŠŸã€‚\nupdating...\nfinish update!\n```\n## ä½¿ç”¨åç¨‹-è‡ªåŠ¨å¯åŠ¨æ–°çº¿ç¨‹\n```cpp\nint main()\n{\n    std::wcout << L\"Main Thread Id: \" << std::this_thread::get_id() << std::endl;\n    DoWorkAsync().get();\n    return 0;\n}\nagave::AsyncAction DoWorkAsync()\n{\n    std::wcout << L\"DoWorkAsync started on thread: \" << std::this_thread::get_id() << std::endl;\n    \n    // åˆ‡æ¢åˆ°ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œåå°æ‰§è¡Œä¸‹é¢çš„è¯­å¥\n    co_await agave::resume_background();\n    \n    std::wcout << L\"doing on worker: \" << std::this_thread::get_id() << std::endl;\n    std::this_thread::sleep_for(5s);\n\n    std::wcout << L\"update UI on Thread: \" << std::this_thread::get_id() << std::endl;\n    std::wcout << L\"updating...\" << std::endl;\n    std::this_thread::sleep_for(3s);\n\n    std::wcout << L\"finish update!\" << std::endl;\n    \n}\n```\nç»“æœ\n```\nMain Thread Id: 1984\ndoing on worker: 12268\nupdate UI on Thread: 12268\nupdating...\nfinish update!\n```\nä»¥ä¸Šç¨‹åºç”±äºåœ¨åç¨‹å‡½æ•°ä¸­ï¼Œworkerçº¿ç¨‹æ“ä½œå®Œæˆåï¼Œæ²¡æœ‰åˆ‡æ¢åˆ°å‰å°UIçº¿ç¨‹ã€‚æ‰€ä»¥UIæ›´æ–°é”™è¯¯åœ°åœ¨workerçº¿ç¨‹ä¸­æ‰§è¡Œã€‚\nåº”è¯¥åŠ ä¸€ä¸ªåˆ‡æ¢åˆ°ä¸»çº¿ç¨‹ã€‚\n```cpp\nagave::AsyncAction DoWorkAsync()\n{\n    std::wcout << L\"DoWorkAsync started on thread: \" << std::this_thread::get_id() << std::endl;\n    \n    // åˆ‡æ¢åˆ°ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œåå°æ‰§è¡Œä¸‹é¢çš„è¯­å¥\n    co_await agave::resume_background();\n    \n    std::wcout << L\"doing on worker: \" << std::this_thread::get_id() << std::endl;\n    std::this_thread::sleep_for(5s);\n\n    co_await agave::resume_foreground();\n\n    std::wcout << L\"update UI on Thread: \" << std::this_thread::get_id() << std::endl;\n    std::wcout << L\"updating...\" << std::endl;\n    std::this_thread::sleep_for(3s);\n\n    std::wcout << L\"finish update!\" << std::endl; \n}\n```\nç»“æœï¼š\n```\nMain Thread Id: 8796\ndoing on worker: 25564\nupdate UI on Thread: 25564\nupdating...\nfinish update!\n```\nç°åœ¨ï¼ŒåŠ äº†ä¸€å¥åˆ‡æ¢åˆ°å‰å°ï¼Œä½†æ˜¯æœ€ç»ˆUIæ›´æ–°è¿˜æ˜¯åœ¨workerçº¿ç¨‹ä¸Šã€‚\nè¿™æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬æ˜¯ä»¥åŒæ­¥æ–¹å¼å®Œæˆåç¨‹çš„ï¼š`DoWorkAsync().get();`ã€‚æ‰€ä»¥æ— æ³•åˆ‡æ¢ã€‚\n### ç»“åˆæ¶ˆæ¯é˜Ÿåˆ—\nå»æ‰`DoWorkAsync()`åé¢çš„`get()`ã€‚å¼‚æ­¥å½¢å¼æ‰§è¡Œã€‚\n```cpp\nagave::AsyncAction DoWorkAsync();\nint main()\n{\n    agave::set_fg_entry([](std::function<void(void)> procedure)\n    {\n        queue.add_task(procedure);\n    });\n    std::wcout << L\"Main Thread Id: \" << std::this_thread::get_id() << std::endl;\n    \n    DoWorkAsync();\n    queue.run();\n}\nagave::AsyncAction DoWorkAsync()\n{\n    std::wcout << L\"DoWorkAsync started on thread: \" << std::this_thread::get_id() << std::endl;\n    \n    // åˆ‡æ¢åˆ°ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œåå°æ‰§è¡Œä¸‹é¢çš„è¯­å¥\n    co_await agave::resume_background();\n    \n    std::wcout << L\"doing on worker: \" << std::this_thread::get_id() << std::endl;\n    std::this_thread::sleep_for(5s);\n\n    // mainå‡½æ•°ä¸­ï¼Œè®¾ç½®äº†å‰å°fgå…¥å£ï¼Œä¸‹é¢çš„å†…å®¹å°±ä¼šæ‰“åŒ…æˆä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼Œä¼ ç»™å‰å°ã€‚\n    co_await agave::resume_foreground();\n\n    std::wcout << L\"update UI on Thread: \" << std::this_thread::get_id() << std::endl;\n    std::wcout << L\"updating...\" << std::endl;\n    std::this_thread::sleep_for(3s);\n\n    std::wcout << L\"finish update!\" << std::endl; \n}\n```\n\nç»“æœï¼š\n```\nMain Thread Id: 2936\ndoing on worker: 10572\nupdate UI on Thread: 2936\nupdating...\nfinish update!\n```\n\n# UIå’ŒworkerååŒå·¥ä½œç¤ºä¾‹\n```cpp\n#include <iostream>\n#include <thread>\n#include <chrono>\n#include <functional>\n#include \"TaskQueue.h\"\n#include \"../Agave/Agave.hpp\"\n\nusing namespace std::chrono_literals;\n\nvoid call_back(void);\nvoid run_on_main(std::function<void(void)> fn);\nTaskQueue queue;\nagave::AsyncAction DoWorkAsync(void);\n\nint main(void)\n{\n\tagave::set_fg_entry([](std::function<void(void)> procedure)\n\t\t{ queue.add_task(procedure); });\n\n\t/*agave::set_bg_entry([](std::function<void(void)> procedure)\n\t\t{ std::jthread{ procedure }.detach(); });*/\n\n\tstd::wcout << L\"Main Thread Id: \" << std::this_thread::get_id() << std::endl;\n\n\tstd::jthread{ []()\n    {\n        for (int i = 0; i < 20; ++i)\n        {\n            run_on_main([]()\n                {\n                    std::wcout << L\"doing on UI Thread: \" << std::this_thread::get_id() << std::endl;\n                });\n            std::this_thread::sleep_for(350ms);\n        }\n    } }.detach();\n\t\n\n\t/*std::jthread([](std::function<void(void)> cb) -> void\n    {\n        std::wcout << L\"doing on worker: \" << std::this_thread::get_id() << std::endl;\n        std::this_thread::sleep_for(5s);\n        run_on_main(cb);\n    }, call_back).detach();*/\n\tDoWorkAsync();\n\n\tqueue.run();\n\n\treturn 0;\n}\n\nvoid call_back(void)\n{\n\tstd::wcout << L\"update UI on Thread: \" << std::this_thread::get_id() << std::endl;\n\tstd::wcout << L\"updating...\" << std::endl;\n\tstd::this_thread::sleep_for(3s);\n\tstd::wcout << L\"finish update!\" << std::endl;\n}\n\nvoid run_on_main(std::function<void(void)> fn)\n{\n\tqueue.add_task(fn);\n}\n\nagave::AsyncAction DoWorkAsync(void)\n{\n\tco_await agave::resume_background();\n\tfor (int i = 0; i < 10; ++i)\n\t{\n\t\tstd::wcout << L\"doing on worker: \" << std::this_thread::get_id() << std::endl;\n\t\tstd::this_thread::sleep_for(500ms);\n\t}\n\t//co_await 5s;\n\t//std::wcout << L\"doing on worker2: \" << std::this_thread::get_id() << std::endl;\n\tco_await agave::resume_foreground();\n\tstd::wcout << L\"update UI on Thread: \" << std::this_thread::get_id() << std::endl;\n\tstd::wcout << L\"updating...\" << std::endl;\n\tstd::this_thread::sleep_for(3s);\n\tstd::wcout << L\"finish update!\" << std::endl;\n\n\tco_return;\n}\n\n```\n# å‚å•†æ¨¡æ‹Ÿå¼€å‘å¼‚æ­¥SDKç¤ºä¾‹\n```cpp\n#include <iostream>\n#include <thread>\n#include <chrono>\n#include <functional>\n#include \"TaskQueue.h\"\n#include \"../Agave/Agave.hpp\"\n#include \"manufacturer.h\"\n\nusing namespace std::chrono_literals;\n\nvoid run_on_main(std::function<void(void)> fn);\nTaskQueue queue;\nagave::AsyncAction DoWorkAsync(void);\nagave::AsyncAction DoWorkAsync2(void);\n\nint main(void)\n{\n\tagave::set_fg_entry([](std::function<void(void)> procedure)\n\t\t{ queue.add_task(procedure); });\n\n\tstd::wcout << L\"Main Thread Id: \" << std::this_thread::get_id() << std::endl;\n\n\tstd::jthread{ []()\n    {\n        for (int i = 0; i < 20; ++i)\n        {\n            run_on_main([]()\n                {\n                    std::wcout << L\"doing on UI Thread: \" << std::this_thread::get_id() << std::endl;\n                });\n            std::this_thread::sleep_for(350ms);\n        }\n    } }.detach();\n\t\n\tDoWorkAsync2();\n\n\tqueue.run();\n\n\treturn 0;\n}\n\nagave::AsyncAction DoWorkAsync2(void)\n{\n\tint result = co_await ReadFileAsync(L\"aa.txt\");\n\tco_await agave::resume_foreground();\n\tstd::wcout << L\"update UI on Thread: \" << std::this_thread::get_id() << std::endl;\n\tstd::wcout << L\"got a result: \" << result << std::endl;\n}\n\nvoid run_on_main(std::function<void(void)> fn)\n{\n\tqueue.add_task(fn);\n}\n\nagave::AsyncAction DoWorkAsync(void)\n{\n\tco_await agave::resume_background();\n\tfor (int i = 0; i < 10; ++i)\n\t{\n\t\tstd::wcout << L\"doing on worker: \" << std::this_thread::get_id() << std::endl;\n\t\tstd::this_thread::sleep_for(500ms);\n\t}\n\t//co_await 5s;\n\t//std::wcout << L\"doing on worker2: \" << std::this_thread::get_id() << std::endl;\n\tco_await agave::resume_foreground();\n\tstd::wcout << L\"update UI on Thread: \" << std::this_thread::get_id() << std::endl;\n\tstd::wcout << L\"updating...\" << std::endl;\n\tstd::this_thread::sleep_for(3s);\n\tstd::wcout << L\"finish update!\" << std::endl;\n\n\tco_return;\n}\n```","categories":["æ“ä½œç³»ç»Ÿ","å¤šçº¿ç¨‹","Cpp","Modern"]},{"title":"åŸºäºæ¶ˆæ¯å¾ªç¯çš„UIçº¿ç¨‹ä¸å·¥ä½œçº¿ç¨‹äº¤äº’æ¨¡å‹","url":"/å¤šçº¿ç¨‹/åŸºäºæ¶ˆæ¯å¾ªç¯çš„UIçº¿ç¨‹ä¸å·¥ä½œçº¿ç¨‹äº¤äº’æ¨¡å‹/","content":"# ä»¥UIçº¿ç¨‹å’Œå·¥ä½œçº¿ç¨‹ä¹‹é—´çš„äº¤äº’ä¸ºåˆ‡å…¥ç‚¹\næœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼ŒUIçº¿ç¨‹å’Œæ–‡ä»¶ä¸‹è½½çº¿ç¨‹ï¼ˆä¸‹é¢æˆä¸ºç§°ä¸ºå·¥ä½œè€…çº¿ç¨‹ï¼‰ã€‚UIçº¿ç¨‹ç‚¹â€œæ¥æ”¶æ–‡ä»¶â€æŒ‰é’®åå¯åŠ¨å·¥ä½œè€…çº¿ç¨‹ï¼Œä¹‹åä¸¤çº¿ç¨‹å¼‚æ­¥æ‰§è¡Œã€‚å‡è®¾å·¥ä½œè€…çº¿ç¨‹æ¯ä¸‹è½½ã€ä¼ è¾“æ–‡ä»¶çš„10%éƒ½è¦é€šçŸ¥UIçº¿ç¨‹ï¼Œä»¥åœ¨UIç•Œé¢è¿›åº¦æ¡æ˜¾ç¤ºè¿›åº¦ã€‚\nç”±äºä¸¤çº¿ç¨‹æ˜¯å¼‚æ­¥ã€æ— å…³è”çš„ï¼Œé‚£ä¹ˆå°±æ¶‰åŠåˆ°å·¥ä½œè€…çº¿ç¨‹æ€ä¹ˆä¸UIçº¿ç¨‹äº¤äº’çš„é—®é¢˜ã€‚å·¥ä½œè€…çº¿ç¨‹ä¸èƒ½ç›´æ¥æ“ä½œUIçº¿ç¨‹ï¼Œå¦åˆ™ä¼šæ‰°ä¹±UIçº¿ç¨‹ä¸­çš„éƒ¨ä»¶ã€å†…å®¹ç­‰ï¼Œè€Œæ˜¯è¦é€šè¿‡å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼ŒæŒ‡ç¤ºUIçº¿ç¨‹è‡ªå·±å»è°ƒæ•´ã€‚\nå¯ä»¥è€ƒè™‘è®¾ç½®ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚\n![](../../images/åŸºäºæ¶ˆæ¯å¾ªç¯çš„UIçº¿ç¨‹ä¸å·¥ä½œçº¿ç¨‹äº¤äº’æ¨¡å‹/image-20240726050511238.png)\n# ç®€å•ç¤ºä¾‹\n```cpp\n#include <iostream>\n#include <thread>\n#include <chrono>\n#include <functional>\nusing namespace std::chrono_literals;\nvoid worker(std::function<void(std::wstring const& str)> callback)\n{\n    std::wcout << L\"doing something in \" << std::this_thread::get_id() << std::endl;\n    std::this_thread::sleep_for(3s);\n    std::wcout << L\"call callback!\" << std::endl;\n    callback(L\"worker called\");\n    std::this_thread::sleep_for(3s);\n    std::wcout << L\"worker finished!\" << std::endl;\n}\nint main()\n{\n    std::wcout << L\"UI: \" << std::this_thread::get_id() << std::endl;\n    // å·¥ä½œè€…çº¿ç¨‹\n    std::jthread t(&worker, [](std::wstring const& str) -> void\n        {\n            std::wcout << str << L\" in \" << std::this_thread::get_id() << std::endl;\n        });\n}\n```\nè¾“å‡ºï¼š\n```\nUI: 1452\ndoing something in 8864\ncall callback!\nworker called in 8864\nworker finished!\n```\nUIçº¿ç¨‹IDå·ä¸º1452ï¼Œå·¥ä½œè€…çº¿ç¨‹IDå·ä¸º8864ã€‚\nè€Œå›è°ƒå‡½æ•°æ˜¯åœ¨å·¥ä½œè€…çº¿ç¨‹ä¸­è°ƒç”¨çš„ã€‚\nç°åœ¨æˆ‘ä»¬çš„éœ€æ±‚å°±æ˜¯å·¥ä½œè€…çº¿ç¨‹è¦å’ŒUIçº¿ç¨‹äº§ç”Ÿå…³è”ï¼Œæ‰€ä»¥è¦æƒ³åŠæ³•å¦‚ä½•è½¬ç§»çº¿ç¨‹ï¼Œè®©å›è°ƒå‡½æ•°è¢«UIçº¿ç¨‹è°ƒç”¨ã€‚\n\nä»¥ä¸Šç¨‹åºï¼š\n1. UIçº¿ç¨‹é€šè¿‡å‘çº¿ç¨‹æ„é€ å‡½æ•°ä¼ å‚ï¼Œä¸ºworkerå‡½æ•°ç»‘å®šä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°ä»¥lambdaè¡¨è¾¾å¼å®šä¹‰ã€‚\n2. workerå‡½æ•°å¾ˆå®¹æ˜“è°ƒç”¨å‚æ•°â€œcallbackâ€ã€‚\n3. é—®é¢˜æ˜¯ï¼Œworkerçº¿ç¨‹æ€ä¹ˆé€šè¿‡â€œcallbackâ€ä¸UIçº¿ç¨‹äº¤äº’ï¼Ÿ\n4. ç­”æ¡ˆå°±æ˜¯è®©å®ƒä»¬ä»¥æ¶ˆæ¯é˜Ÿåˆ—ä¸ºåª’ä»‹ã€‚workerçº¿ç¨‹æ‹©æœºï¼ˆæ¯”å¦‚æ¯ä¸‹è½½10%ï¼‰æŠŠcallbackå’Œä¸€äº›å®æ—¶æ•°æ®ä¿¡æ¯æ‰“åŒ…å‘åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼ŒUIçº¿ç¨‹ç›‘å¬æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆæ¯ï¼Œåªè¦æœ‰äº†ï¼Œå°±è‡ªå·±äº²è‡ªè°ƒç”¨ä¸€éworkerçº¿ç¨‹è¸¢å›æ¥çš„callbackå‡½æ•°ã€‚\n5. UIçº¿ç¨‹ä¸ºä»€ä¹ˆä¸è‡ªå·±æ—©æ—©åœ°äº²è‡ªè°ƒç”¨callbackï¼Œè¿˜è¦è¸¢çš®çƒï¼ŸåŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ˜¯å› ä¸ºworkerçº¿ç¨‹å¯ä»¥å¤¹å¸¦å®æ—¶æ•°æ®ä¿¡æ¯ã€‚\n# æ¶ˆæ¯å¾ªç¯é˜Ÿåˆ—\n## è‡ªæ—‹é”ç‰ˆæœ¬1\nä»¥ä¸‹æ˜¯ï¼Œå–ä¸€æ¬¡æ¶ˆæ¯åˆ™ä¸Šä¸€æ¬¡é”ã€å¼€ä¸€æ¬¡é”ã€‚\n```cpp\nstd::list<std::function<void(void)>> msg_queue;\nstd::mutex mx;\n\nint main()\n{\n    std::wcout << L\"UI: \" << std::this_thread::get_id() << std::endl;\n    std::jthread t(&worker, []() -> void\n        {\n            std::wcout << L\"callback\" << L\" in \" << std::this_thread::get_id() << std::endl;\n        });\n    \n    while (true)\n    {\n        if (mx.try_lock())\n        {\n            if (msg_queue.size() > 0)\n            {\n                auto cb = msg_queue.front();\n                msg_queue.pop_front();\n                cb();  // call back in UI\n            }\n            mx.unlock();\n        }\n    }\n}\n```\n## è‡ªæ—‹é”ç‰ˆæœ¬2\nè¿˜æœ‰ä¸€ç§æ•ˆç‡è¾ƒé«˜çš„æ–¹æ³•ï¼šæŠŠæ¶ˆæ¯é˜Ÿåˆ—å’Œä¸€ä¸ªç©ºé˜Ÿåˆ—äº¤æ¢ï¼Œå³ä¸€æ¬¡æ€§æŠ½ç©ºé˜Ÿåˆ—ä¸­æ‰€æœ‰çš„æ¶ˆæ¯ï¼Œä¹‹ååŠæ—¶åŠ é”ï¼Œç„¶åå°±å¯ä»¥æ”¾å¿ƒåœ°å»å¤„ç†æ¶ˆæ¯äº†ã€‚è¿™æ ·é¿å…äº†é¢‘ç¹åŠ é”ã€‚\n>ä»¥ä¸‹çš„æœºåˆ¶æ˜¯è‡ªæ—‹é”ã€‚\n```cpp\nint main()\n{\n    std::wcout << L\"UI: \" << std::this_thread::get_id() << std::endl;\n    std::jthread t(&worker, []() -> void\n        {\n            std::wcout << L\"callback\" << L\" in \" << std::this_thread::get_id() << std::endl;\n        });\n        \n    while (true)\n    {\n        if (mx.try_lock())\n        {\n            if (msg_queue.size() > 0)\n            {\n                std::list<std::function<void(void)>> tmp_msg_queue;\n                msg_queue.swap(tmp_msg_queue);\n                mx.unlock();\n                std::ranges::for_each(tmp_msg_queue, [](auto && cb) -> void\n                    {\n                        cb();\n                    });\n            }\n            else mx.unlock();\n        }\n        std::this_thread::sleep_for(10ms);\n    }\n}\n```\næ€ä¹ˆè®©workerè¸¢çš®çƒç»™UIçº¿ç¨‹å‘¢ï¼Ÿé‚£å°±æ˜¯workerçº¿ç¨‹æ‹¿åˆ°æ§åˆ¶æ¶ˆæ¯é˜Ÿåˆ—çš„é”ï¼Œç„¶åå‘é€æ¶ˆæ¯å’Œæ•°æ®åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚è¿™ä¸¤ä¸ªæ­¥éª¤å¯ä»¥é›†æˆä¸€ä¸ª`run_in_main(callback)`å‡½æ•°ã€‚\n```cpp\nvoid run_in_main(std::function<void(void)> cb);\nvoid worker(std::function<void(void)> callback)\n{\n    // ...\n    run_in_main(callback);\n    // ...\n}\nvoid run_in_main(std::function<void(void)> cb)\n{\n    std::unique_lock lck(mx);\n    msg_queue.push_back(cb);\n}\n```\nè¾“å‡ºï¼š\n```\nUI: 2060\ndoing something in 13436\ncall callback!\ncallback in 2060\nworker finished!\n```\nå‘ç°ï¼Œç°åœ¨çš„å›è°ƒå‡½æ•°è°ƒç”¨è€…æˆä¸ºäº†UIçº¿ç¨‹ã€‚\n## æ¡ä»¶å˜é‡ç‰ˆæœ¬\n>æ¡ä»¶å˜é‡æ§åˆ¶ç‰ˆæœ¬ï¼šæ¯”è‡ªæ—‹é”èŠ‚çœCPU\n\n```cpp\n// ...\nvoid run_in_main(std::function<void(void)> cb)\n{\n    {\n        std::unique_lock lck(mx);\n        msg_queue.push_back(cb);\n    }   \n    cv.notify_all();\n}\nint main()\n{\nÂ  Â  std::wcout << L\"UI: \" << std::this_thread::get_id() << std::endl;\nÂ  Â  std::jthread t(&worker, []() -> void\nÂ  Â  Â  Â  {\nÂ  Â  Â  Â  Â  Â  std::wcout << L\"callback\" << L\" in \" << std::this_thread::get_id() << std::endl;\nÂ  Â  Â  Â  });\n    while (true)\n    {\n        std::unique_lock lck{ mx };\n        if (msg_queue.size() > 0)\n        {\n            std::list<std::function<void(void)>> tmp_msg_queue;\n            msg_queue.swap(tmp_msg_queue);\n            lck.unlock();\n            std::ranges::for_each(tmp_msg_queue,\n                [](auto && cb) -> void\n                {\n                    cb();\n                });\n        }\n        else\n        {\n            cv.wait(lck);\n        }\n    }\n}\n```\næµ‹è¯•ï¼šä»¥ä¸‹workerçº¿ç¨‹æ¨¡æ‹Ÿå‘æ¶ˆæ¯é˜Ÿåˆ—æŠ•æ”¾äº†ä¸¤æ¬¡æ¶ˆæ¯ã€‚\n```cpp\nvoid worker(std::function<void(void)> callback)\n{\n    std::wcout << L\"doing something in \" << std::this_thread::get_id() << std::endl;\n    std::this_thread::sleep_for(3s);\n    std::wcout << L\"call callback!\" << std::endl;\n    run_in_main(callback);\n    std::this_thread::sleep_for(3s);\n    std::wcout << L\"call callback!\" << std::endl;\n    run_in_main(callback);\n    std::this_thread::sleep_for(3s);\n    std::wcout << L\"worker finished!\" << std::endl;\n}\n```\nè¾“å‡ºï¼š\n```\nUI: 5888\ndoing something in 18988\ncall callback!\ncallback in 5888\ncall callback!\ncallback in 5888\nworker finished!\n```\n# bindå‡½æ•°ç»‘å®š\næ€ä¹ˆæŠŠ`æœ‰å‚æ•°çš„å‡½æ•°`ä¼ ç»™`æ— å‚æ•°çš„å‡½æ•°å¯¹è±¡`ï¼Ÿ\n```cpp\nvoid bar(int v)\n{\n    std::cout << v << std::endl;\n}\nint main()\n{\n    std::function<void(void)> foo = &bar;  // error\n}\n```\næ­£ç¡®ï¼š\n```cpp\nvoid bar(int v)\n{\nÂ  Â  std::wcout << L\"bar(int): \" << v << std::endl;\n}\nint main()\n{\n    std::function<void(void)> foo = std::bind(&bar, 5); // ok\n    foo();\n}\n```\nè¾“å‡ºï¼š5\n## ç»“åˆcallback\n```cpp\nvoid run_in_main(std::function<void(void)> cb);\nvoid bar(int v);\n\nvoid worker(std::function<void(void)> callback)\n{\n    // ...\n    run_in_main(std::bind(&bar, 555));\n    // ...\n}\n```\nè¾“å‡ºï¼š\n```\nUI: 23520\ndoing something in 4556\ncall callback!\ncallback in 23520\nbar(int): 555\nworker finished!\n```\né‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥åœ¨mainçº¿ç¨‹åˆ›å»ºå­çº¿ç¨‹æ—¶ï¼Œç›´æ¥ç»™å­çº¿ç¨‹ä¼ å…¥ä¸€ä¸ªå‡½æ•°ç»‘å®šå™¨ï¼š\n```cpp\nint main()\n{\n    std::jthread t(&worker, std::bind(&bar, 555));\n}\n```\nè¿™æ ·ï¼Œå°±ä¸æ‹˜æ³¥äºworkerå‡½æ•°å‚æ•°callbackçš„`<void(void)>`å½¢å¼äº†ã€‚\n### å®Œæ•´æµ‹è¯•ä»£ç \n```cpp\n#include <functional>\n#include<list>\n#include<iostream>\n#include<mutex>\n#include<condition_variable>\n#include<thread>\n#include<chrono>\n#include<algorithm>\nusing namespace std::chrono_literals;\nstd::list<std::function<void(void)>> msg_queue;\nstd::mutex mx;\nstd::condition_variable cv;\nvoid bar(int v)\n{\n    std::wcout << L\"bar(int): \" << v << std::endl;\n}\nvoid run_in_main(std::function<void(void)> cb)\n{\n    {\n        std::unique_lock lck(mx);\n        msg_queue.push_back(cb);\n    }\n    cv.notify_all();\n}\nvoid worker(std::function<void(void)> callback)\n{\n    std::wcout << L\"doing something in \" << std::this_thread::get_id() << std::endl;\n    std::this_thread::sleep_for(3s);\n    std::wcout << L\"call callback!\" << std::endl;\n    run_in_main(callback);\n    std::this_thread::sleep_for(3s);\n    std::wcout << L\"call callback!\" << std::endl;\n    run_in_main(callback);\n    std::this_thread::sleep_for(3s);\n    std::wcout << L\"worker finished!\" << std::endl;\n}\nint main()\n{\n    std::wcout << L\"UI: \" << std::this_thread::get_id() << std::endl;\n    std::jthread t(&worker, std::bind(&bar, 555));\n    while (true)\n    {\n        std::unique_lock lck{ mx };\n        if (msg_queue.size() > 0)\n        {\n            std::list<std::function<void(void)>> tmp_msg_queue;\n            msg_queue.swap(tmp_msg_queue);\n            lck.unlock();\n            std::ranges::for_each(tmp_msg_queue,\n                [](auto&& cb) -> void\n                {\n                    cb();\n                });\n        }\n        else\n        {\n            cv.wait(lck);\n        }\n    }\n}\n```\nè¾“å‡ºï¼š\n```\nUI: 82576\ndoing something in 84588\ncall callback!\nbar(int): 555\ncall callback!\nbar(int): 555\nworker finished!\n```\n","categories":["æ“ä½œç³»ç»Ÿ","å¤šçº¿ç¨‹","è®¾è®¡æ¨¡å¼"]},{"title":"Hexoæ­å»ºåšå®¢","url":"/é¡¹ç›®/Hexoæ­å»ºåšå®¢/","content":"# å®‰è£…Hexo\n\nå‚è€ƒï¼š[æ–‡æ¡£ | Hexo](https://hexo.io/zh-cn/docs/)\n\n1. å®‰è£…[Node.js](https://nodejs.org/en)\n2. å‘½ä»¤è¡Œnpmå…¨å±€å®‰è£…hexo-cliï¼š`$ npm install -g hexo-cli`\n## Mac\n```sh\nnode@20 is keg-only, which means it was not symlinked into /opt/homebrew,\nbecause this is an alternate version of another formula.\n\nIf you need to have node@20 first in your PATH, run:\n  echo 'export PATH=\"/opt/homebrew/opt/node@20/bin:$PATH\"' >> ~/.zshrc\n\nFor compilers to find node@20 you may need to set:\n  export LDFLAGS=\"-L/opt/homebrew/opt/node@20/lib\"\n  export CPPFLAGS=\"-I/opt/homebrew/opt/node@20/include\"\n```\næ·»åŠ PATHåè®°å¾—é‡å¯ç»ˆç«¯æ‰èƒ½ç”Ÿæ•ˆã€‚\n# æµ‹è¯•hexo init\n\nåœ¨ç©ºæ–‡ä»¶å¤¹ä¸‹`$ hexo init`ã€‚\n\nç›¸å½“äºæ‰§è¡Œäº†ä»¥ä¸‹å‡ æ­¥ï¼š\n1. è¿œç¨‹æ‹·è´äº†ï¼šGit cloneÂ [hexo-starter](https://github.com/hexojs/hexo-starter)Â å’ŒÂ [hexo-theme-landscape](https://github.com/hexojs/hexo-theme-landscape)Â ä¸»é¢˜åˆ°å½“å‰ç›®å½•æˆ–æŒ‡å®šç›®å½•ã€‚\n2. ä½¿ç”¨äº†ï¼šÂ [Yarn 1](https://classic.yarnpkg.com/lang/en/)ã€[pnpm](https://pnpm.io/zh/)Â æˆ–Â [npm](https://docs.npmjs.com/cli/install)Â åŒ…ç®¡ç†å™¨ä¸‹è½½å±€éƒ¨hexoçš„ä¾èµ–ï¼ˆå¦‚æœ‰å·²å®‰è£…å¤šä¸ªï¼Œåˆ™åˆ—åœ¨å‰é¢çš„ä¼˜å…ˆï¼‰ã€‚npm é»˜è®¤éšÂ [Node.js](https://hexo.io/zh-cn/docs/index.html#%E5%AE%89%E8%A3%85-Node-js)Â å®‰è£…ã€‚\n\n# æµ‹è¯•hexo g\n\nç”Ÿæˆé™æ€æ–‡ä»¶ã€‚\n\n# æµ‹è¯•hexo s\n\nå¯åŠ¨æœåŠ¡å™¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè®¿é—®ç½‘å€ä¸ºï¼šÂ `http://localhost:4000/`ã€‚\n\n| é€‰é¡¹               | æè¿°              |\n| ---------------- | --------------- |\n| `-p`,Â `--port`   | é‡è®¾ç«¯å£            |\n| `-s`,Â `--static` | åªä½¿ç”¨é™æ€æ–‡ä»¶         |\n| `-l`,Â `--log`    | å¯åŠ¨æ—¥è®°è®°å½•ï¼Œä½¿ç”¨è¦†ç›–è®°å½•æ ¼å¼ |\n# æ¢å¤å·²æœ‰ç¯å¢ƒ\n\nä»¥ä¸‹æ˜¯ç²¾ç®€äº†çš„å»é™¤äº†å¯åæœŸç”Ÿæˆçš„å¿…è¦çš„rawæ–‡ä»¶ï¼š\n![](../../images/Hexoæ­å»ºåšå®¢/image-20240430192607218.png)\n\nç”±äºæ²¡æœ‰hexoå’Œå…¶ä»–ä¾èµ–ï¼Œåœ¨é‡æ–°ç”Ÿæˆæ•°æ®æ—¶ï¼Œéœ€è¦å…ˆè¿›è¡Œï¼š`npm install`æ ¹æ®`package.json`æŒ‡å®šçš„ä¿¡æ¯å®‰è£…ä¾èµ–åŒ…ã€‚\n\nç„¶åæ‰å¯ä»¥åœ¨æ­¤æ–‡ä»¶å¤¹ä¸‹`$ hexo g`ã€‚\n\næ³¨æ„ï¼Œdb.jsonæ˜¯æ¯”è¾ƒé‡è¦çš„æ•°æ®æ–‡ä»¶ï¼Œé‡Œé¢è®°å½•äº†hexoçš„æ“ä½œï¼Œç”Ÿæˆçš„æ•°æ®æ—¶é—´æˆ³ã€é€»è¾‘å…³ç³»éƒ½ä»¥æ­¤ä¸ºå‡†ã€‚","categories":["ä¸€äº›å·¥å…·çš„ä½¿ç”¨"]},{"title":"æ“ä½œç³»ç»Ÿå­—ç¬¦é›†ã€ä¹±ç é—®é¢˜","url":"/ä¸€äº›å·¥å…·çš„ä½¿ç”¨/æ“ä½œç³»ç»Ÿå­—ç¬¦é›†ã€ä¹±ç é—®é¢˜/","content":"[è§£å†³vscodeæ§åˆ¶å°ä¸­æ–‡ä¹±ç é—®é¢˜ - æ— é£å¬æµ· - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/wufengtinghai/p/17397829.html)\n# é—®é¢˜æ¦‚è¿°\n\næ“ä½œç³»ç»Ÿä½¿ç”¨çš„windows 11ï¼Œè¯­è¨€æ˜¯è‹±æ–‡ç‰ˆï¼›ä½¿ç”¨visual studio codeçš„terminalç¼–è¯‘ç¨‹åºï¼Œè¾“å‡ºçš„ä¸­æ–‡æ˜¯ä¹±ç ï¼›\n# visual studio codeçš„terminal\n\nvisual sutdio codeä¸­çš„terminalå¯ä»¥é›†æˆcmd.exeæˆ–è€…power shellç­‰ï¼›æˆ‘è¿™é‡Œé€‰æ‹©çš„æ˜¯cmd.exeï¼Œæ—¢ç„¶è¾“å‡ºä¸­æ–‡ä¹±ç ï¼Œé‚£ä¹ˆè‚¯å®šè·Ÿcmd.exeçš„ç¼–ç æœ‰å…³ç³»ï¼›\n\næŸ¥çœ‹å½“å‰æ§åˆ¶å°ç¨‹åºçš„ç¼–ç æ ¼å¼\n```dos\nD:\\learn\\.NET6\\WebAPI\\BookStoreApi>chcp\nActive code page: 437\n```\nä»¥ä¸‹æ˜¯å‡ ç§å¸¸ç”¨çš„ç¼–ç :  \n`936` GBK(ä¸€èˆ¬æƒ…å†µä¸‹ä¸ºé»˜è®¤ç¼–ç )  \n`437` ç¾å›½è‹±è¯­  \n`65001` utf-8\n\nè®¾ç½®CMDçª—å£ç¼–ç æ ¼å¼ä¸ºUTF-8:\n```dos\nD:\\learn\\.NET6\\WebAPI\\BookStoreApi>chcp 65001\nActive code page: 65001\n```\nè¿™ä¸ªä¿®æ”¹åªå¯¹å½“å‰çª—å£ä¼šè¯æœ‰æ•ˆï¼›\n\n# å…¨å±€ä¿®æ”¹æ–¹å¼\n\n`Win + R`è¾“å…¥`intl.cpl`å‘½ä»¤ï¼Œåœ¨å¼¹å‡ºçš„æ¡†ä½“ä¸­é€‰æ‹©`Administrative`æ ‡ç­¾ï¼Œç„¶åé€‰æ‹©`change system local`ï¼Œç„¶åé€‰ä¸­æœ€ä¸‹æ–¹çš„å¤é€‰æ¡† `Beta:Use Unicode UTF-8 for worldwide language support`,ç„¶åé‡å¯æ“ä½œç³»ç»Ÿå³å¯ã€‚","categories":["ä¸€äº›å·¥å…·çš„ä½¿ç”¨"]},{"title":"ç½‘ç»œ_SMBå…±äº«æ–‡ä»¶","url":"/ç½‘ç»œ/ç½‘ç»œ_SMBå…±äº«æ–‡ä»¶/","content":"æœ¬æ–‡æ˜¯åŸºäºOpenWRTä¸‹çš„SMB4å…±äº«ã€‚\n# Linuxç³»ç»Ÿæ·»åŠ SMBç”¨æˆ·ã€å¯†ç \nLinuxä¸ŠSMBçš„ç”¨æˆ·å’ŒLinuxç”¨æˆ·æ˜¯ä¸¤ç äº‹ã€‚SMBéœ€è¦å¦å¤–å•ç‹¬æ·»åŠ ç”¨æˆ·ã€‚\n```sh\nsmbpasswd -a root\n```\n# OpenWRTè®¾ç½®\n## ç£ç›˜æ–°å»ºåˆ†åŒºã€æ ¼å¼åŒ–ã€æŒ‚è½½\n\n1. åœ¨`ç³»ç»Ÿ -> ç£ç›˜ç®¡ç†`ä¸‹æŸ¥çœ‹ç£ç›˜ï¼Œç‚¹å‡»â€œå¼¹å‡ºâ€å³è¾¹çš„`ä¿®æ”¹`æŒ‰é’®ï¼Œå¯ä»¥çœ‹åˆ°åˆ†åŒºä¿¡æ¯ã€‚æ–°å»ºåˆ†åŒºï¼Œå¹¶æ ¼å¼åŒ–ä¸ºext4ã€‚\n2. ä¹‹åï¼Œå»`ç³»ç»Ÿ -> æŒ‚è½½ç‚¹`ä¸‹é…ç½®æ·»åŠ æŒ‚è½½ï¼ŒåŸºæœ¬è®¾ç½®ä¸­ï¼Œå¯ç”¨æ­¤æŒ‚è½½ç‚¹ï¼ŒUUIDé€‰æ‹©ç›¸åº”é€‰é¡¹ï¼ŒæŒ‚è½½ç‚¹è‡ªå®šä¹‰ï¼Œæ‰‹å†™ï¼šå¦‚`/mnt/shared`ã€‚é«˜çº§è®¾ç½®ï¼Œæ–‡ä»¶ç³»ç»Ÿé€‰æ‹©ext4ã€‚\n3. è®°å¾—ç‚¹`ä¿å­˜&åº”ç”¨`ã€‚\n## é…ç½®SMBæŒ‚è½½\n\nåœ¨openwrtçš„`ç½‘ç»œå­˜å‚¨ -> ç½‘ç»œå…±äº«`é¡µé¢è¿›è¡Œè®¾ç½®ï¼š\n\n| name   | ç›®å½•          | å®¹è®¸ç”¨æˆ· | åªè¯»   | å¯æµè§ˆ | åˆ›å»ºæƒé™æ©ç  | ç›®å½•æƒé™æ©ç  |\n| ------ | ----------- | ---- | ---- | --- | ------ | ------ |\n| shared | /mnt/shared | root | å–æ¶ˆå‹¾é€‰ | å‹¾é€‰  | é»˜è®¤0666 | é»˜è®¤0777 |\nä¸Šè¾¹çš„â€œå¯ç”¨macOSå…¼å®¹å…±äº«â€ç»æµ‹è¯•ï¼Œä¸ç”¨å‹¾é€‰ã€‚\n\nä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š\n```sh\nvim /etc/config/samba4\n```\n>ä½†æ˜¯åœ¨`/etc/samba/smb.conf`æ–‡ä»¶ä¸­ä¹Ÿæœ‰éå¸¸ç±»ä¼¼çš„è®¾ç½®ï¼Œè¿˜ä¸æ¸…æ¥šè¿™ä¸¤ä¸ªé…ç½®æ–‡ä»¶ä¹‹é—´çš„ä»å±å…³ç³»ã€‚\n## ç›¸å…³å‘½ä»¤\n```sh\n# å¯åŠ¨æœåŠ¡\nservice samba4 start\n# åœæ­¢æœåŠ¡\nservice samba4 stop\n# é‡å¯æœåŠ¡\nservice samba4 restart\n# æœåŠ¡çŠ¶æ€\nservice samba4 status\n\n# é…ç½®æ–‡ä»¶æ£€æŸ¥\ntestparm -v\n```\n# smbè¾“å…¥rootè´¦æˆ·å’Œå¯†ç åæ‹’ç»è®¿é—®\n\nç³»ç»Ÿé»˜è®¤ä¸å…è®¸rootè®¿é—®sambaï¼Œéœ€è¦é…ç½®`smb.conf.template`åœ¨`invalid users = root`å‰æ·»åŠ ä¸€ä¸ª#å·ï¼Œå°†æœ¬è¡Œæ³¨é‡Šæ‰å³å¯ï¼Œè¿™æ ·rootå°±ä¸ä¼šè¢«é™åˆ¶è®¿é—®sambaäº†ã€‚\næŸ¥æ‰¾`smb.conf.template`æ–‡ä»¶ï¼š\n```sh\nfind / -name smb.conf.template\n```\n# å¸è½½ç£ç›˜æ—¶device is busyçš„å¤„ç†\n\n`lsof` + æŒ‚è½½ç›®å½•ä½ç½®ï¼Œå¦‚ï¼š`lsof /mnt/shared`\nå‡ºæ¥åˆ—è¡¨ï¼Œkillæ‰ç›¸åº”çš„PIDå³å¯ã€‚\nå¦‚æœæ˜¯macOSè¿æ¥è¿‡æ­¤SMBï¼Œkillæ‰ä¼šè‡ªåŠ¨é‡è¿ï¼Œéœ€è¦åœ¨macOSä¸Šå¼¹å‡ºæ‰è¡Œã€‚\n# æŒ‚è½½ç›®å½•æ–‡ä»¶ç³»ç»Ÿé—®é¢˜\n\nå…±äº«ç›®å½•æœ€å¥½ä½¿ç”¨`Ext4`æ–‡ä»¶ç³»ç»Ÿï¼Œ å› ä¸ºNTFSæˆ–ExFATåœ¨macOSç³»ç»Ÿä¸‹ä¼šæç¤ºé”™è¯¯ç 100093ã€‚ä¸»è¦åŸå› å¯èƒ½ä¸ºsamba4å¯¹NTFSæˆ–ExFATæ–‡ä»¶ç³»ç»Ÿä½¿ç”¨Windowsæƒé™æ§åˆ¶æœºåˆ¶ï¼ˆopenwrtæ˜¯åŸºäºLinuxçš„ï¼Œä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿä¸€èˆ¬ä¸ºext4ï¼‰å¯¼è‡´æƒé™æ··ä¹±æ— æ³•æ­£å¸¸å†™å…¥æ–‡ä»¶ã€‚\n","categories":["ç½‘ç»œ"]},{"title":"Windows_å¤šçº¿ç¨‹","url":"/Windows/Windows_å¤šçº¿ç¨‹/","content":"# è¿›ç¨‹å’Œçº¿ç¨‹çš„å…³ç³»\n1. è¿›ç¨‹æ˜¯ç¨‹åºçš„è¿è¡Œå®ä¾‹ã€‚åŒ…å«å…¨å±€å˜é‡ã€‚\n2. ä¸€ä¸ªè¿›ç¨‹è‡³å°‘åŒ…å«ä¸€ä¸ªçº¿ç¨‹\n3. ç¨‹åºè¿è¡Œçš„æœ€å°å•ä½æ˜¯å‡½æ•°ï¼Œçº¿ç¨‹åˆ™æ˜¯å‡½æ•°çš„è¿è¡Œå®ä¾‹ã€‚\n4. çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿçš„æœ¯è¯­ï¼Œè€Œå¯¹äºå¤„ç†å™¨æ¥è¯´çº¿ç¨‹æ˜¯ä»»åŠ¡ï¼Œæ¯ä¸ªé€»è¾‘å¤„ç†å™¨ï¼ˆæˆ–æ˜¯å¤„ç†å™¨æ ¸å¿ƒï¼‰éƒ½å¯ä»¥å¯¹åº”ä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¸€ä¸ªå¤„ç†å™¨ä¸ŠåŒæ—¶è¿è¡Œä¸åŒè¿›ç¨‹çš„çº¿ç¨‹ã€‚\n5. çº¿ç¨‹ä¸­åŒ…å«çº¿ç¨‹æ ˆã€‚\n# å–ç¥¨ç¨‹åº\n```cpp\n#include <iostream>\nconstinit int tickets = 100;\nint main()\n{\n    while (true)\n    {\n        std::wcout << L\"Station main: \" << tickets-- << std::endl;\n        if (tickets == 0)\n        {\n            break;\n        }\n    }   \n}\n```\n## CreateThreadåˆ›å»ºçº¿ç¨‹\nå®˜æ–¹æ–‡æ¡£ï¼š[CreateThread function (processthreadsapi.h) - Win32 apps | Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread)\n\né€šå¸¸å¼•å…¥`<Windows.h>`å³å¯ä½¿ç”¨ã€‚\n![](../../images/Windows_å¤šçº¿ç¨‹/image-20240722053312495.png)\n\n1. å¯é€‰ï¼ŒLPå³long pointerï¼Œçœ‹ä½œpointerå°±è¡Œã€‚Security Attributesæ„ä¸ºå®‰å…¨æè¿°ç¬¦ã€‚\n    1. ç”¨äºACLsï¼ŒAccess Control Listsã€‚å¾®è½¯å¸¸ç”¨çš„æ‰‹æ®µï¼Œå“ªäº›ä¸œè¥¿å¯ä»¥è®¿é—®ï¼Œæœ‰ä»€ä¹ˆæƒé™ç­‰ç­‰ã€‚å¯ä»¥å¡«NULLå¾—åˆ°é»˜è®¤çš„å®‰å…¨æè¿°ç¬¦ã€‚\n2. çº¿ç¨‹æ ˆå¤§å°ï¼Œå¡« 0 æ„ä¸ºé»˜è®¤å€¼ï¼ŒWindowsä¸‹æ˜¯1Mï¼ŒLinuxæ˜¯4Mã€‚\n3. çº¿ç¨‹å‡½æ•°çš„åœ°å€ï¼Œå‘ŠçŸ¥çº¿ç¨‹å…·ä½“ä»å“ªé‡Œæ‰§è¡Œã€‚éœ€è¦éµå¾ªå‡½æ•°ç­¾åã€‚[ThreadProc callback function (Windows) | Microsoft Learn](https://learn.microsoft.com/en-us/previous-versions/windows/desktop/legacy/ms686736(v=vs.85))\n    1. `DWORD WINAPI ThreadProc(_In_Â LPVOID lpParameter);`\n        1. ä»¥ä¸Šæ˜¯çº¿ç¨‹å‡½æ•°çš„ç­¾åå½¢å¼ã€‚è¿”å›å€¼ä¸º0ä»£è¡¨çº¿ç¨‹å‡½æ•°æ‰§è¡ŒæˆåŠŸã€‚\n    2. LPVOIDæŒ‡çš„æ˜¯`void *`\n    3. `_In_`æ˜¯ä¸€ä¸ª SALï¼ˆSource Annotation Languageï¼‰å®ï¼Œ ç”¨äºæ³¨é‡Š Windows API å‡½æ•°å‚æ•°ã€‚å®ƒæä¾›æœ‰å…³å‡½æ•°å‚æ•°çš„é¢å¤–ä¿¡æ¯ï¼Œä»¥å¸®åŠ©ç¼–è¯‘å™¨è¿›è¡Œé™æ€åˆ†æå’Œä»£ç æ£€æŸ¥ã€‚æˆ‘ä»¬å¯ä»¥çœç•¥ã€‚\n    4. WINAPIæŒ‡`__stdcall`\n    5. å› æ­¤å¯ä»¥ç®€åŒ–ä¸ºï¼š`DWORD WINAPI ThreadProc(void * lpParameter);`\n    6. `C++`ä¸­ä¼ å…¥å‡½æ•°åœ°å€æ—¶ï¼Œéœ€è¦åœ¨å‡½æ•°åå­—ä¹‹å‰åŠ ä¸€ä¸ª`&`å–åœ°å€ã€‚\n4. å¯é€‰ï¼Œå‡½æ•°çš„å‚æ•°\n5. çº¿ç¨‹çš„æ§åˆ¶ç¬¦ã€‚\n    1. 0è¡¨ç¤ºåˆ›å»ºåç«‹å³æ‰§è¡Œ\n    2. `CREATE_SUSPENDED`è¡¨ç¤ºåˆ›å»ºåæŒ‚èµ·ï¼Œç›´åˆ°è°ƒç”¨ResumeThread\n6. å¯é€‰ï¼Œè¾“å‡ºå€¼ï¼Œç»™ä¸€ä¸ªæŒ‡é’ˆå¯ä»¥è·å¾—çº¿ç¨‹IDã€‚æ­¤çº¿ç¨‹IDä¸Handleä¸åŒã€‚å¯å¡«NULLã€‚\n7. è¿”å›å€¼ï¼šå¦‚æœåˆ›å»ºæˆåŠŸï¼Œè¿”å›æ­¤çº¿ç¨‹çš„å¥æŸ„ã€‚\n\nåˆ›å»ºå®Œçº¿ç¨‹å¹¶æ‰§è¡Œåï¼Œéœ€è¦å…³é—­Handleï¼Œä½†è¿™ä¸æ„å‘³ç€å…³é—­çº¿ç¨‹ï¼Œåªä¸è¿‡æ˜¯è¯´æ­¤å¥æŸ„ä¸å†ç»‘å®šè¿™ä¸ªçº¿ç¨‹ï¼Œä¸å¯¹çº¿ç¨‹è¿›è¡Œç®¡ç†äº†ï¼Œé‚£ä¹ˆçº¿ç¨‹è¿è¡Œç»“æŸä¹‹åå°±ä¼šè‡ªè¡Œåœæ­¢ã€‚\n```cpp\n#include <Windows.h>\n#include <iostream>\n#include <format>\n#include <print>\nconstinit int tickets = 10;\nDWORD WINAPI ThreadProc(void* lpParameter);\nint main()\n{\n    // start a new thread\n    HANDLE hThread = ::CreateThread(nullptr, 0, &ThreadProc, nullptr, 0, nullptr);\n    if (hThread) ::CloseHandle(hThread);\n    hThread = nullptr;\n\n    while (true)\n    {\n        if (tickets > 0)\n        {\n            std::wcout << L\"Station main: \" << tickets-- << std::endl;\n        }\n        else\n        {\n            break;\n        }\n    }\n}\nDWORD WINAPI ThreadProc(void* parameter)\n{\n    while (true)\n    {\n        if (tickets > 0)\n        {\n            std::wcout << L\"Station 1: \" << tickets-- << std::endl;\n        }\n        else\n        {\n            break;\n        }\n    }\n    return 0;\n}\n```\nå¯èƒ½åœ¨è¾“å‡ºç»“æœä¸­çœ‹åˆ°ä¸¤ä¸ªçº¿ç¨‹æŠ¢å å¼çš„è¾“å‡ºï¼Œå¯¼è‡´å†…å®¹æ‚ä¹±ã€‚\n```\nStation main: 10Station 1: 9\n\nStation main: 8\nStation main: 7\nStation main: 6\nStation 1: 5\nStation 1: 4\nStation 1: 3\nStation 1: 2\nStation main: 1\nStation 1: 0\n\n```\nä»¥ä¸Šè¾“å‡ºæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š\n1. è¿˜æœªæ¢è¡Œæ—¶ï¼Œçº¿ç¨‹è¢«æŠ¢å ã€‚å¯¼è‡´æ¢è¡Œå»¶åã€‚å¤šè¡Œå†…å®¹åœ¨ä¸€è¡Œæ˜¾ç¤º\n2. å­çº¿ç¨‹æŠŠ0å·ç¥¨å–æ‰äº†ï¼Œè¿™æ˜¯é”™è¯¯çš„ã€‚\n\nå…³äºè¾“å‡ºé—®é¢˜ï¼Œå¯ä»¥ç”¨`C++20<format>`çš„`std::format`æˆ–è€…`C++23<print>`çš„`std::print`è§£å†³ã€‚\n```cpp\nstd::wcout << std::format(L\"Station main: {}\\n\", tickets--);\n```\næˆ–\n```cpp\nstd::println(\"Station main: {}\", tickets--);\n```\n\n## SleepæŠŠæ—¶é—´ç‰‡æ”¾å¤§ï¼Œè§‚å¯Ÿé”™è¯¯\né€šè¿‡sleepæŠŠæ—¶é—´ç‰‡æ”¾å¤§ï¼Œå¯ä»¥è®©å¤šçº¿ç¨‹ä¸­éšæ‚£çš„å‡ ç‡å¢å¤§ã€‚\n>Windowsä¸‹çš„Sleepå®šä¹‰äº`Windows.h`ï¼Œå‚æ•°æ˜¯æ¯«ç§’ã€‚\n\n```cpp\n#include <Windows.h>\n#include <iostream>\n#include <format>\n#include <print>\nconstinit int tickets = 10;\nDWORD WINAPI ThreadProc(void* lpParameter);\nint main()\n{\n    // start a new thread\n    HANDLE hThread = ::CreateThread(nullptr, 0, &ThreadProc, nullptr, 0, nullptr);\n    if (hThread) ::CloseHandle(hThread);\n    hThread = nullptr;\n\n    while (true)\n    {\n        if (tickets > 0)\n        {\n            ::Sleep(5);\n            std::println(\"Station main: {}\", tickets--);\n        }\n        else\n        {\n            break;\n        }\n    }\n    ::Sleep(500);\n    std::println(\"Finally, tickets remain: {}\", tickets);\n    return 0;\n}\nDWORD WINAPI ThreadProc(void* parameter)\n{\n    while (true)\n    {\n        if (tickets > 0)\n        {\n            ::Sleep(5);\n            std::println(\"Station 1: {}\", tickets--);\n        }\n        else\n        {\n            break;\n        }\n    }\n    return 0;\n}\n```\n\næœ€åå¯èƒ½è¾“å‡ºçš„æƒ…å†µï¼šmainçº¿ç¨‹æŠŠ0å·ç¥¨å–äº†ï¼Œæœ€åå¯¼è‡´ç¥¨ä½™é‡ä¸º-1ã€‚\n```\nStation main: 9\nStation 1: 10\nStation 1: 8\nStation main: 7\nStation main: 6\nStation 1: 6\nStation main: 4\nStation 1: 5\nStation main: 3\nStation 1: 2\nStation 1: 1\nStation main: 0\nFinally, tickets remain: -1\n\n```\nå¯èƒ½çš„æƒ…å†µï¼šmainçº¿ç¨‹åˆ¤æ–­ticketsä¸º1åå‡†å¤‡å–ç¥¨ï¼Œç¡äº†5msæœŸé—´è¢«1çº¿ç¨‹å–æ‰äº†æœ€åä¸€å¼ ç¥¨ï¼Œä¹‹åmainçº¿ç¨‹å”¤é†’åæ˜¯ä¸çŸ¥é“çš„ï¼Œä¾æ—§å‡äº†ç¥¨é‡åˆ°-1ã€‚\n\n>æˆ‘ä»¬å‘ç°ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯`std::println`ï¼Œ0å·ç¥¨å–æ‰çš„æ¦‚ç‡å¤§å¤§ä¸‹é™ã€‚å¤§å¤šæ•°æƒ…å†µå‰©ä½™ç¥¨æ•°ä¸º0ï¼ˆæ­£ç¡®è¡Œä¸ºï¼‰ã€‚è¿™å¯èƒ½æ˜¯å› ä¸º`std::println`/æ§åˆ¶å°è¾“å‡ºå†…éƒ¨é€šå¸¸æœ‰é”ï¼Œè°ƒç”¨å¾ˆâ€œé‡â€ï¼Œä¼šè®©çº¿ç¨‹è½®æ¢å¾—æ›´æ…¢ï¼Œè¿›ä¸€æ­¥é™ä½äº†æç«¯äº¤é”™ï¼ˆæ¯”å¦‚åˆšå¥½é‡è¯»ä¸º 0 å†å‡ï¼‰çš„æ¦‚ç‡ã€‚ä½†è¿™æ ·å¯¹ `tickets` çš„è®¿é—®å¹¶ä¸ä¼šå˜å®‰å…¨ã€‚\n>æ€»ç»“ï¼šæ§åˆ¶å°è¾“å‡ºé‡Œè‡ªå¸¦é”ï¼Œåè€Œä¼šâ€œä¸²è¡ŒåŒ–â€ä¸€éƒ¨åˆ†æ—¶é—´ï¼Œ**ä¸åˆ©**äºåˆ¶é€ æç«¯äº¤é”™ã€‚\n## CreateMutexåˆ›å»ºäº’æ–¥é‡\n[CreateMutexW function (synchapi.h) - Win32 apps | Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/api/synchapi/nf-synchapi-createmutexw)\n\né€šå¸¸å¼•å…¥`<Windows.h>`å³å¯ä½¿ç”¨ã€‚\n![](../../images/Windows_å¤šçº¿ç¨‹/image-20240722060820211.png)\n1. å¯é€‰ï¼Œå®‰å…¨æè¿°ç¬¦ï¼Œå¯å¡«NULLè·å¾—é»˜è®¤çš„ã€‚\n2. æ˜¯å¦èµ·å§‹å°±å æœ‰äº’æ–¥é‡ï¼šæ­¤æ—¶çš„çº¿ç¨‹æ˜¯ä¸æ˜¯ç«‹é©¬æŒæœ‰äº’æ–¥é‡è€Œå…¶ä»–çº¿ç¨‹æ— æ³•è®¿é—®ã€‚\n3. å¯é€‰ï¼Œåå­—ã€‚\n4. è¿”å›å€¼æ˜¯å¥æŸ„ã€‚\n\nåœ¨æ­¤ä¾‹æˆ‘ä»¬è¦ç»™è¿™ä¸ªäº’æ–¥é‡ä¸€ä¸ªå…¨å±€å¯è®¿é—®çš„å¥æŸ„ã€‚\n## WaitForSingleObject - åŠ é”\nåœ¨ä¸´ç•ŒåŒºä¹‹å‰éœ€è¦`WaitForSingleObject`ç­‰å¾…äº’æ–¥é‡çš„ä¿¡å·ã€‚ç›¸å½“äºåŠ é”\n[WaitForSingleObject function (synchapi.h) - Win32 apps | Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/api/synchapi/nf-synchapi-waitforsingleobject)\né€šå¸¸å¼•å…¥`<Windows.h>`å³å¯ä½¿ç”¨ã€‚\n![](../../images/Windows_å¤šçº¿ç¨‹/image-20240722061633660.png)\n1. æŒ‡æ˜ç­‰å¾…çš„å¯¹è±¡çš„å¥æŸ„\n2. ç­‰å¾…çš„æ—¶é—´\n    1. å¯å¡«é0çš„å€¼\n    2. å¦‚æœå¡«0ï¼Œè€Œæ²¡æœ‰ä¿¡å·ï¼Œåˆ™ä¼šç«‹å³è¿”å›ï¼Œä¸€ç›´é‡å¤è¯•æ¢ã€ç©ºè½¬ã€‚\n    3. å¯ä»¥å¡«INFINITEï¼Œæ— é™æœŸç­‰ä¸‹å»ã€‚\n## ReleaseMutex - é‡Šæ”¾äº’æ–¥é‡\nä¸´ç•ŒåŒºåéœ€è¦`ReleaseMutex(hMutex)`é‡Šæ”¾äº’æ–¥é‡ã€‚è€Œä¸”è¦æ³¨æ„ï¼Œåœ¨ifè¯­å¥çš„æ¯ä¸ªæƒ…å†µä¸‹éƒ½éœ€è¦å†™é‡Šæ”¾é”è¯­å¥ã€‚\n### å–ç¥¨ä»£ç \n```cpp\n#include <Windows.h>\n#include <iostream>\n#include <print>\nconstinit int tickets = 10;\nconstinit HANDLE hMutex = nullptr;\nDWORD WINAPI ThreadProc(void* lpParameter);\nint main()\n{\n    hMutex = ::CreateMutex(nullptr, false, nullptr);\n    // start a new thread\n    HANDLE hThread = ::CreateThread(nullptr, 0, &ThreadProc, nullptr, 0, nullptr);\n    if (hThread) ::CloseHandle(hThread);\n    hThread = nullptr;\n\n    while (true)\n    {\n        ::WaitForSingleObject(hMutex, INFINITE);\n        if (tickets > 0)\n        {\n            ::Sleep(5);\n            std::println(\"Station main: {}\", tickets--);\n            ::ReleaseMutex(hMutex);\n        }\n        else\n        {\n            ::ReleaseMutex(hMutex);\n            break;\n        }\n    }\n    ::Sleep(500);\n    ::CloseHandle(hMutex);\n    hMutex = nullptr;\n    std::println(\"Finally, tickets remain: {}\", tickets);\n    return 0;\n}\nDWORD WINAPI ThreadProc(void* parameter)\n{\n    while (true)\n    {\n        ::WaitForSingleObject(hMutex, INFINITE);\n        if (tickets > 0)\n        {\n            ::Sleep(5);\n            std::println(\"Station 1: {}\", tickets--);\n            ::ReleaseMutex(hMutex);\n        }\n        else\n        {\n            ::ReleaseMutex(hMutex);\n            break;\n        }\n    }\n    return 0;\n}\n```\nç»“æœï¼š\n```\nStation main: 10\nStation 1: 9\nStation main: 8\nStation 1: 7\nStation main: 6\nStation 1: 5\nStation main: 4\nStation 1: 3\nStation main: 2\nStation 1: 1\nFinally, tickets remain: 0\n\n```\nä¸ä¼šå‡ºç°å–0å·ç¥¨çš„æƒ…å†µã€‚\n## ä½¿ç”¨æ ‡å‡†çº¿ç¨‹åº“åˆ›å»º2ä¸ªå­çº¿ç¨‹å–ç¥¨\n```cpp\n#include <Windows.h>\n#include <iostream>\n#include <print>\n#include <thread>\nconstinit int tickets = 10;\nconstinit HANDLE hMutex = nullptr;\nvoid seller(std::string const& name);\nint main()\n{\n    hMutex = ::CreateMutex(nullptr, false, nullptr);\n    // start a new thread\n    std::jthread th1(seller, \"seller 1:\");\n    std::jthread th2(seller, \"seller 2:\");\n    //::Sleep(500); // ä¸ç”¨Sleepäº†ï¼Œè€Œæ˜¯join\n    th1.join();\n    th2.join();\n    \n    ::CloseHandle(hMutex);\n    hMutex = nullptr;\n    std::println(\"Finally, tickets remain: {}\", tickets);\n    return 0;\n}\nvoid seller(std::string const& name)\n{\n    while (true)\n    {\n        ::WaitForSingleObject(hMutex, INFINITE);\n        if (tickets > 0)\n        {\n            ::Sleep(5);\n            std::println(\"{} {}\", name, tickets--);\n            ::ReleaseMutex(hMutex);\n        }\n        else\n        {\n            ::ReleaseMutex(hMutex);\n            break;\n        }\n    }\n}\n```\nç”±äºæˆ‘ä»¬åœ¨å­çº¿ç¨‹ç»“æŸåè¿˜æœ‰CloseHandleã€è¾“å‡ºæœ€åç¥¨æ•°çš„æ“ä½œï¼Œä½¿ç”¨éœ€è¦æ‰‹åŠ¨æ§åˆ¶`th.join()`çš„ä½ç½®ã€‚\n```cpp\n    th1.join();\n    th2.join();\n    //::Sleep(1000); // ä¸ç”¨Sleepäº†\n```\n\næˆ–è€…ä¹Ÿå¯ä»¥detachï¼Œä½†æ˜¯ä¸»çº¿ç¨‹è¦åœ¨æœ«å°¾ä¸»åŠ¨`Sleep`ä¸€æ®µæ—¶é—´ã€‚\n```cpp\n    th1.detach();\n    th2.detach();\n    ::Sleep(1000);\n```\n\nç»“æœï¼š\n```\nseller 1: 10\nseller 2: 9\nseller 1: 8\nseller 2: 7\nseller 1: 6\nseller 2: 5\nseller 1: 4\nseller 2: 3\nseller 1: 2\nseller 2: 1\nFinally, tickets remain: 0\n```\n## å‘½åé”\næ¯”å¦‚è¦æƒ³åšåº”ç”¨ç¨‹åºçš„å•ä¾‹æ¨¡å¼ã€‚\nå¯ä»¥ç”¨é”å’Œå†…æ ¸å¯¹è±¡è¿›è¡Œæ§åˆ¶ã€‚\nä¸ºä»€ä¹ˆè¦ç”¨åå­—å‘¢ï¼Ÿ\nå› ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ›å»ºå®Œä¹‹åå†…æ ¸è¿”å›çš„å¥æŸ„å€¼æ—¶éšæœºçš„ï¼Œçº¿ç¨‹åªçŸ¥é“è‡ªå·±çš„ï¼Œè€Œä¸çŸ¥é“å…¶ä»–äººçš„å¥æŸ„ã€‚ä½†å½“ç¨‹åºå‘˜ä¸»åŠ¨åœ¨åˆ›å»ºçº¿ç¨‹æ—¶ç»™äº†åå­—åï¼Œç³»ç»Ÿå°±æœ‰æ‰€æ„ŸçŸ¥ï¼Œä½ ä¹‹å‰å·²ç»åˆ›å»ºè¿‡è¿™ä¸ªä¸œè¥¿ï¼Œå°±ä¼šæŠŠä¹‹å‰çš„å¥æŸ„è¿”å›ç»™ä½ ï¼Œå°±å¯ä»¥è®¿é—®ç›¸åŒçš„å¯¹è±¡äº†ã€‚\n![](../../images/Windows_å¤šçº¿ç¨‹/image-20240722063708658.png)\n![](../../images/Windows_å¤šçº¿ç¨‹/image-20240722063754385.png)\n\n\n```cpp\nconstinit HANDLE hMutex = nullptr;\nconstinit HANDLE hSingletonMx = nullptr;\n\nint main()\n{\n    // èµ·å§‹ ä¸»çº¿ç¨‹ æ‹¥æœ‰é”\n    hSingletonMx = ::CreateMutex(nullptr, false, L\"AppSingleton\");\n    if (::GetLastError() == ERROR_ALREADY_EXISTS)\n    {\n        ::CloseHandle(hSingletonMx);\n        return 0;  // break point\n    }\n    hMutex = ::CreateMutex(nullptr, false, nullptr);\n    ::ReleaseMutex(hMutex);\n    \n    HANDLE hThread = ::CreateThread(nullptr, 0, &ThreadProc, nullptr, 0, nullptr);\n    ::CloseHandle(hThread);\n    hThread = ::CreateThread(nullptr, 0, &ThreadProc2, nullptr, 0, nullptr);\n    ::CloseHandle(hThread);\n    hThread = nullptr;\n\n    ::Sleep(10000);\n    ::CloseHandle(hSingletonMx);\n    return 0;\n}\n```\n### VSä¸‹å¤šçº¿ç¨‹è°ƒè¯•\n1. ä¸‹æ–­ç‚¹ã€‚\n2. å…ˆè¿è¡Œä¸€ä¸ªç¨‹åºã€‚\n3. åœ¨Sleep 10sç»“æŸä¹‹å‰ã€‚å³å‡»é¡¹ç›®åï¼ŒDebugï¼ŒStart New Instanceã€‚\n4. ä¼šå‘ç°ï¼Œç¬¬äºŒä¸ªç¨‹åºä¼šç›´æ¥åˆ°è¾¾`closeHandle(hSingletonMx)`ã€‚\n5. è¿™å°±æ˜¯è·¨åº”ç”¨ç¨‹åºçš„singleton\n# CreateEventåˆ›å»ºäº‹ä»¶ï¼ˆä¿¡å·ã€æ¡ä»¶å˜é‡ï¼‰ - Windowsä¸‹çš„ç‹¬ç‰¹é”\näº‹ä»¶æä¾›äº†æ¯”Mutexæ›´å¤šçš„åŠŸèƒ½ã€‚\nç”¨`CreateEvent`åˆ›å»ºã€‚\n[CreateEventW function (synchapi.h) - Win32 apps | Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/api/synchapi/nf-synchapi-createeventw)\n![](../../images/Windows_å¤šçº¿ç¨‹/image-20240722184421346.png)\n1. å¯é€‰ï¼Œå®‰å…¨æè¿°ç¬¦ï¼Œå¡«NULLè¡¨ç¤ºè·å–é»˜è®¤æè¿°ç¬¦ã€‚\n2. æ˜¯å¦æ‰‹åŠ¨é‡ç½®ï¼Œæ„æ€æ˜¯å¦‚æœæ˜¯æ‰‹åŠ¨é‡ç½®åˆ™éœ€è¦åœ¨`WaitForSingleObject`ä¹‹å`ResetEvent(hEvent)`æ‰‹åŠ¨ä¸Šé”ï¼Œåœ¨æ­¤æœŸé—´å¯èƒ½ä¼šè¢«å…¶ä»–äººæŠ¢å è¯¥ä¿¡å·ã€‚å¦‚æœæ˜¯è‡ªåŠ¨é‡ç½®åˆ™æ˜¯Waitåè‡ªåŠ¨ä¸Šé”ã€‚\n3. åˆå§‹çŠ¶æ€ï¼Œtrueä¸ºæœ‰ä¿¡å·ï¼ˆsignaledï¼‰ï¼Œfalseä¸ºæ— ä¿¡å·ï¼ˆnonsignaledï¼‰ã€‚æœ‰ä¿¡å·æ„ä¸ºæ²¡æœ‰ä¸Šé”ï¼Œæ— ä¿¡å·æ—¶éœ€è¦è‡ªå·±æŠŠé”æ‰“å¼€ã€‚\n4. å¯é€‰ï¼Œå‘½åæˆ–åŒ¿åã€‚\n## SetEventï¼šé‡Šæ”¾ä¿¡å·\nå¯¹äºEventæ¥è¯´ï¼Œé€€å‡ºä¸´ç•ŒåŒºçš„æ–¹æ³•ä¸º`SetEvent(hEvent)`\n## å–ç¥¨ä»£ç ä¿®æ”¹\nä½¿ç”¨Eventæ—¶éœ€è¦åšä»¥ä¸‹ä¿®æ”¹ï¼š\n1. mainå‡½æ•°ä¸­`CreateEvent`\n2. mainå‡½æ•°æœ€å`CloseHandle`å‚æ•°æ”¹ä¸ºhEvent\n3. çº¿ç¨‹å‡½æ•°ä¸­\n    1. WaitForSingleObjectå‚æ•°æ”¹ä¸ºhEvent\n    2. é€€å‡ºä¸´ç•ŒåŒºçš„å¼€é”å¯¹äºEventæ¥è¯´æ–¹æ³•ä¸º`SetEvent(hEvent)`\n\nä»¥ä¸‹ï¼Œåˆ›å»º2ä¸ªå­çº¿ç¨‹ã€‚\n```cpp\nconstinit HANDLE hEvent = nullptr;\nint main()\n{\n    hEvent = CreateEvent(nullptr, false, true, nullptr);\n    \n    HANDLE hThread = ::CreateThread(nullptr, 0, &ThreadProc, nullptr, 0, nullptr);\n    ::CloseHandle(hThread);\n    \n    hThread = ::CreateThread(nullptr, 0, &ThreadProc2, nullptr, 0, nullptr);\n    ::CloseHandle(hThread);\n    hThread = nullptr;\n\n    ::Sleep(10000);\n    ::CloseHandle(hEvent);\n    return 0;\n}\nDWORD WINAPI ThreadProc(void* parameter)\n{\n    while (true)\n    {\n        ::WaitForSingleObject(hEvent, INFINITE);\n        if (tickets > 0)\n        {\n            ::Sleep(5); // 5ms\n            std::wcout << L\"Station #main: \" << tickets-- << std::endl;\n            ::SetEvent(hEvent);\n        }\n        else\n        {\n            ::SetEvent(hEvent);\n            break;\n        }\n    }\n}\n```\n## ä¸åŒ\n1. Mutexä¸æ‹¥æœ‰è€…ç»‘å®šï¼Œåªèƒ½å¬ä»æ‹¥æœ‰è€…æ”¯é…ã€‚\n2. Eventæ²¡æœ‰ç»‘å®šæ‹¥æœ‰è€…ï¼Œä»»ä½•äººåªè¦æ‹¿åˆ°å®ƒçš„å¥æŸ„å°±å¯ä»¥æ”¯é…ã€‚\n3. Eventæ›´åƒæ˜¯ä¸€ä¸ªä¿¡å·çš„æ¦‚å¿µï¼Œç»™åˆ«äººé€šçŸ¥ã€‚Linuxä¸‹çš„å¯¹æ ‡ç‰©ï¼šæ¡ä»¶å˜é‡\n\n## WaitForMultipleObjects\nä½¿ç”¨`WaitForMultipleObjects`ã€‚å¸¸å¸¸ç”¨äºï¼šå½“ä½œä¸»çº¿ç¨‹çš„ä¿¡å·æ¥æ”¶å™¨ï¼Œå½“ä¸¤ä¸ªå­çº¿ç¨‹**å…¨éƒ¨**å‘å‡ºç»“å°¾çš„SetEventä¿¡å·æ—¶ï¼Œä¸»çº¿ç¨‹å°±å¯ä»¥åœæ­¢é˜»å¡ï¼Œç»§ç»­æ‰§è¡Œï¼Œä»è€Œå–ä»£äº†æ­»æ¿çš„Sleepã€‚\n[WaitForMultipleObjects function (synchapi.h) - Win32 apps | Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/api/synchapi/nf-synchapi-waitformultipleobjects)\n![](../../images/Windows_å¤šçº¿ç¨‹/image-20240722201812515.png)\n1. äº‹ä»¶å¯¹è±¡çš„ä¸ªæ•°\n2. äº‹ä»¶å¯¹è±¡å¥æŸ„æ•°ç»„çš„é¦–å…ƒç´ æŒ‡é’ˆ\n3. æ˜¯å¦ç­‰å¾…æ‰€æœ‰äº‹ä»¶å¯¹è±¡å…¨éƒ¨åˆ°ä½å†é€€å‡º\n4. 0æ˜¯ç©ºè½¬ï¼ŒINFINITEæ˜¯æ— é™æœŸï¼Œé0æ˜¯æœ€å¤šç­‰å¤šä¹…åé€€å‡ºã€‚\n\nä¸¤ä¸ªå­çº¿ç¨‹çš„å®Œæˆäº‹ä»¶ä¿¡å·ï¼Œåˆå§‹çŠ¶æ€å¿…é¡»æ˜¯æ— ä¿¡å·ï¼Œå³åœ¨åˆ›å»ºæ—¶ï¼Œ`CreateEvent`çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºfalseã€‚\nä¸¤ä¸ªå­çº¿ç¨‹åœ¨ç»“æŸæ—¶ï¼Œéœ€è¦`SetEvent(hEventExits[0 or 1]);`è¿›è¡Œå¼€é”ã€‚\n```cpp\nconstinit int tickets = 100;\nDWORD WINAPI ThreadProc(void * lpParameter);\nDWORD WINAPI ThreadProc2(void * lpParameter);\n\nconstinit HANDLE hEvent = nullptr;\nconstinit HANDLE hEventExits[2] = {nullptr, nullptr};\nint main()\n{\n    hEvent = CreateEvent(nullptr, false, true, nullptr);\n    hEventExits[0] = CreateEvent(nullptr, false, false, nullptr);\n    hEventExits[1] = CreateEvent(nullptr, false, false, nullptr);\n    HANDLE hThread = ::CreateThread(nullptr, 0, &ThreadProc, nullptr, 0, nullptr);\n    ::CloseHandle(hThread);\n    hThread = ::CreateThread(nullptr, 0, &ThreadProc2, nullptr, 0, nullptr);\n    ::CloseHandle(hThread);\n    hThread = nullptr;\n\n    ::WaitForMultipleObjects(2, hEventExits, true, INFINITE);\n    ::CloseHandle(hEvent);\n    ::CloseHandle(hEventExits[0]);\n    ::CloseHandle(hEventExits[1]);\n    ::DeleteCriticalSection(&cs);\n    return 0;\n}\nDWORD WINAPI ThreadProc(void* parameter)\n{\n    while (true)\n    {\n        ::WaitForSingleObject(hEvent, INFINITE);\n        if (tickets > 0)\n        {\n            ::Sleep(5); // 5ms\n            std::wcout << L\"Station #1: \" << tickets-- << std::endl;\n            ::SetEvent(hEvent);\n        }\n        else\n        {\n            ::SetEvent(hEvent);\n            break;\n        }\n    }\n    SetEvent(hEventExits[0]);\n    return 0;\n}\nDWORD WINAPI ThreadProc2(void* parameter)\n{\n    while (true)\n    {\n        ::WaitForSingleObject(hEvent, INFINITE);\n        if (tickets > 0)\n        {\n            ::Sleep(5); // 5ms\n            std::wcout << L\"Station #2: \" << tickets-- << std::endl;\n            ::SetEvent(hEvent);\n        }\n        else\n        {\n            ::SetEvent(hEvent);\n            break;\n        }\n    }\n    SetEvent(hEventExits[1]);\n    return 0;\n}\n```\nè¾“å‡ºï¼š\n```\n ...\nStation #1: 20\nStation #2: 19\nStation #1: 18\nStation #2: 17\nStation #1: 16\nStation #2: 15\nStation #1: 14\nStation #2: 13\nStation #1: 12\nStation #2: 11\nStation #1: 10\nStation #2: 9\nStation #1: 8\nStation #2: 7\nStation #1: 6\nStation #2: 5\nStation #1: 4\nStation #2: 3\nStation #1: 2\nStation #2: 1\n```\n# Windowsä¸´ç•ŒåŒº\n![](../../images/Windows_å¤šçº¿ç¨‹/image-20240722205124201.png)\n![](../../images/Windows_å¤šçº¿ç¨‹/image-20240722205149008.png)\n1. ä¸æ˜¯Windowså†…æ ¸å¯¹è±¡ï¼Œåªæ˜¯Cè¯­è¨€ä¸‹ç”¨æˆ·æ€çš„ç»“æ„ä½“ã€‚\n2. ç”¨`CRITICAL_SECTION`å£°æ˜ã€å®šä¹‰ã€‚\n3. ç”¨`InitializeCriticalSection`åˆå§‹åŒ–\n4. ç”¨ä¸´ç•ŒåŒºå°±ä¸ç”¨Mutexæˆ–Eventäº†\n5. ä¿æŠ¤ä¸´ç•ŒåŒºç”¨`EnterCriticalSection`\n6. ç¦»å¼€ä¸´ç•ŒåŒºç”¨`LeaveCriticalSection`\n7. è¿›ç¨‹çš„æœ€åè¦é”€æ¯ï¼Œ`DeleteCriticalSection`\n\n```cpp\nconstinit int tickets = 100;\nDWORD WINAPI ThreadProc(void * lpParameter);\nDWORD WINAPI ThreadProc2(void * lpParameter);\n\nconstinit HANDLE hEventExits[2] = {nullptr, nullptr};\n\nCRITICAL_SECTION cs;\nint main()\n{\n    hEventExits[0] = CreateEvent(nullptr, false, false, nullptr);\n    hEventExits[1] = CreateEvent(nullptr, false, false, nullptr);\n\n    ::InitializeCriticalSection(&cs);\n\n    HANDLE hThread = ::CreateThread(nullptr, 0, &ThreadProc, nullptr, 0, nullptr);\n    ::CloseHandle(hThread);\n    hThread = ::CreateThread(nullptr, 0, &ThreadProc2, nullptr, 0, nullptr);\n    ::CloseHandle(hThread);\n    hThread = nullptr;\n\n    ::WaitForMultipleObjects(2, hEventExits, true, INFINITE);\n    ::CloseHandle(hEventExits[0]);\n    ::CloseHandle(hEventExits[1]);\n    ::DeleteCriticalSection(&cs);\n    return 0;\n}\nDWORD WINAPI ThreadProc(void* parameter)\n{\n    while (true)\n    {\n        ::EnterCriticalSection(&cs);\n        if (tickets > 0)\n        {\n            // ::Sleep(5); // 5ms\n            std::wcout << L\"Station #1: \" << tickets-- << std::endl;\n            ::LeaveCriticalSection(&cs);\n        }\n        else\n        {\n            ::LeaveCriticalSection(&cs);\n            break;\n        }\n    }\n    SetEvent(hEventExits[0]);\n    return 0;\n}\nDWORD WINAPI ThreadProc2(void* parameter)\n{\n    while (true)\n    {\n        ::EnterCriticalSection(&cs);\n        if (tickets > 0)\n        {\n            // ::Sleep(5); // 5ms\n            std::wcout << L\"Station #2: \" << tickets-- << std::endl;\n            ::LeaveCriticalSection(&cs);\n        }\n        else\n        {\n            ::LeaveCriticalSection(&cs);\n            break;\n        }\n    }\n    SetEvent(hEventExits[1]);\n    return 0;\n}\n```\n## è¾“å‡º\n```\nStation #1: 1000\nStation #1: 999\n...\nStation #1: ...\n...\nStation #1: 704\nStation #1: 703\nStation #1: 702\nStation #2: 701\nStation #2: 700\n...\nStation #2: ...\n...\nStation #2: 260\nStation #2: 259\nStation #2: 258\nStation #1: 257\nStation #1: 256\n...\nStation #1: ...\n...\nStation #1: 229\nStation #1: 228\nStation #1: 227\nStation #2: 226\nStation #2: 225\n...\nStation #2: ...\n...\nStation #2: 213\nStation #2: 212\nStation #1: 211\nStation #1: 210\n...\nStation #1: ...\n...\nStation #1: 4\nStation #1: 3\nStation #1: 2\nStation #1: 1\n```\n## ç‰¹ç‚¹æ€»ç»“\n1. åœ¨ç”¨æˆ·æ€ä¸‹ï¼Œé€Ÿåº¦æ¯”å†…æ ¸æ€çš„Eventã€Mutexå¿«\n2. ä¹Ÿèƒ½å®ç°åŒæ­¥ä¿æŠ¤ï¼Œä½†æ˜¯è°ƒé…åº¦æ²¡æœ‰é‚£ä¹ˆç»†è‡´ï¼ŒæŸä¸€çº¿ç¨‹ä¸€ç›´ç‹¬å ä¸´ç•ŒåŒºçš„æ¦‚ç‡è¾ƒå¤§ã€‚\n# æ­»é”\n1. åŠ ä¸€ä¸ªä¸´ç•ŒåŒºå¯¹è±¡\n2. çº¿ç¨‹1å…ˆè¿›å…¥ä¸´ç•ŒåŒº1å†è¿›å…¥ä¸´ç•ŒåŒº2ï¼Œé€€å‡ºæ—¶å…ˆé€€å‡º2å†é€€å‡º1\n2. çº¿ç¨‹2å…ˆè¿›å…¥ä¸´ç•ŒåŒº2å†è¿›å…¥ä¸´ç•ŒåŒº1ï¼Œé€€å‡ºæ—¶å…ˆé€€å‡º1å†é€€å‡º2\n\n```cpp\nCRITICAL_SECTION cs;\nCRITICAL_SECTION cs2;\nint main()\n{\n    hEventExits[0] = CreateEvent(nullptr, false, false, nullptr);\n    hEventExits[1] = CreateEvent(nullptr, false, false, nullptr);\n\n    ::InitializeCriticalSection(&cs);\n    ::InitializeCriticalSection(&cs2);\n\n    HANDLE hThread = ::CreateThread(nullptr, 0, &ThreadProc, nullptr, 0, nullptr);\n    ::CloseHandle(hThread);\n    hThread = ::CreateThread(nullptr, 0, &ThreadProc2, nullptr, 0, nullptr);\n    ::CloseHandle(hThread);\n    hThread = nullptr;\n\n    ::WaitForMultipleObjects(2, hEventExits, true, INFINITE);\n    ::CloseHandle(hEventExits[0]);\n    ::CloseHandle(hEventExits[1]);\n    ::DeleteCriticalSection(&cs);\n    ::DeleteCriticalSection(&cs2);\n    return 0;\n}\nDWORD WINAPI ThreadProc(void* parameter)\n{\n    while (true)\n    {\n        ::EnterCriticalSection(&cs);\n        ::EnterCriticalSection(&cs2);\n        if (tickets > 0)\n        {\n            ::Sleep(5); // 5ms\n            std::wcout << L\"Station #1: \" << tickets-- << std::endl;\n            ::LeaveCriticalSection(&cs2);\n            ::LeaveCriticalSection(&cs);\n        }\n        else\n        {\n            ::LeaveCriticalSection(&cs2);\n            ::LeaveCriticalSection(&cs);\n            break;\n        }\n    }\n    SetEvent(hEventExits[0]);\n    return 0;\n}\nDWORD WINAPI ThreadProc2(void* parameter)\n{\n    while (true)\n    {\n        ::EnterCriticalSection(&cs2);\n        ::EnterCriticalSection(&cs);\n        if (tickets > 0)\n        {\n            ::Sleep(5); // 5ms\n            std::wcout << L\"Station #1: \" << tickets-- << std::endl;\n            ::LeaveCriticalSection(&cs);\n            ::LeaveCriticalSection(&cs2);\n        }\n        else\n        {\n            ::LeaveCriticalSection(&cs);\n            ::LeaveCriticalSection(&cs2);\n            break;\n        }\n    }\n    SetEvent(hEventExits[0]);\n    return 0;\n}\n```\n## è¾“å‡º\n```\nStation #1: 1000\nStation #1: 999\nStation #1: 998\nStation #1: 997\nStation #1: 996\nStation #1: 995\nStation #1: 994\nStation #1: 993\nStation #1: 992\nStation #1: 991\nStation #1: 990\nStation #1: 989\nStation #1: 988\nStation #1: 987\nStation #1: 986\nStation #1: 985\nStation #1: 984\nStation #1: 983\nStation #1: 982\nStation #1: 981\nStation #1: 980\nStation #1: 979\nStation #1: 978\nStation #1: 977\nStation #1: 976\nStation #1: 975\nStation #1: 974\nStation #1: 973\nStation #1: 972\nStation #1: 971\nStation #1: 970\nStation #1: 969\nStation #1: 968\nStation #1: 967\nStation #1: 966\nStation #1: 965\nStation #1: 964\nStation #1: 963\nStation #1: 962\nStation #1: 961\nStation #1: 960\nStation #1: 959\nStation #1: 958\nStation #1: 957\nStation #1: 956\nStation #1: 955\nStation #1: 954\nStation #1: 953\nStation #1: 952\nStation #1: 951\nStation #1: 950\nStation #1: 949\nStation #1: 948\nStation #1: 947\nStation #1: 946\nStation #1: 945\nStation #1: 944\n|               ---> block\n```\nè¿™ç§æƒ…å†µæ˜¯å› ä¸ºåŒæ–¹å„è‡ªéƒ½éœ€è¦ä¸¤ç§é”ï¼Œä½†æ˜¯å„è‡ªåªæŒæœ‰ä¸€ç§é”ï¼Œéƒ½åœ¨ç­‰å¾…å¦ä¸€ç§é”é‡Šæ”¾ã€‚\n# å¤šçº¿ç¨‹UI\nVSæ–°å»ºé¡¹ç›®ï¼ŒWindows Desktop Wizardï¼Œä¸‹ä¸€æ­¥ï¼Œæ”¹åä¸º`Multi-Threading-WithUI`ï¼ŒCreateã€‚å¼¹å‡ºWindows Desktop Projectï¼ŒApplication Typeé€‰æ‹©Desktop Application (.exe)ï¼ŒAdditional optionsé€‰æ‹©Empty projectï¼ŒOKã€‚\næ‰‹å†™åˆ›å»ºæ§ä»¶ã€‚æ‰‹å†ŒæŸ¥é˜…ï¼š\n[Progress Bar - Win32 apps | Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/controls/progress-bar-control-reference)\n[About Progress Bar Controls - Win32 apps | Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/controls/progress-bar-control)\n![](../../images/Windows_å¤šçº¿ç¨‹/image-20240725064818400.png)\nå¯ä»¥é€šè¿‡ä½¿ç”¨`CreateWindowEx`å‡½æ•°å¹¶æŒ‡å®š`PROGRESS_CLASS`çª—å£ç±»ï¼ˆå®šä¹‰äº`CommCtrl.h`ï¼‰æ¥åˆ›å»ºè¿›åº¦æ¡ã€‚è¿™ä¸ªçª—å£ç±»æ˜¯å…¬å…±æ§ä»¶DLLè¢«åŠ è½½åæ³¨å†Œçš„ã€‚\nå³éœ€è¦åœ¨ShowWindowæ˜¾ç¤ºä¸»çª—å£åå†`CreateWindowEx`åˆ›å»ºä¸€ä¸ªå­çª—å£ã€‚å‚æ•°å¦‚ä¸‹ï¼š\n1. dwExStyleä¸ºå æ”¾å¼\n2. ç±»åä¸ºPROGRESS_CLASS\n3. çª—å£å¯¹è±¡åå­—\n4. dwStyleä¸ºå­çª—å£WS_CHILDWINDOW\n5. Xã€Yï¼Œå®½åº¦ã€é«˜åº¦\n6. çˆ¶çª—å£hWndParent\n7. hMenu\n8. hInstance\n9. lpParam\n\n>Windowséµå¾ªâ€œä¸€åˆ‡çš†çª—å£â€åŸåˆ™ï¼Œè¿›åº¦æ¡ä¹Ÿæ˜¯ä¸€ä¸ªçª—å£ï¼Œå› æ­¤éœ€è¦é€šè¿‡åˆ›å»ºå­çª—å£æ¥åˆ›å»ºè¿›åº¦æ¡ã€‚\n\nåœ¨WndProcedureçš„`case WM_CREATE`ä¸­åˆ›å»ºã€‚\nè‡ªå®šä¹‰æ¶ˆæ¯ï¼Œåˆ›å»ºè¿›åº¦æ¡å®Œæˆï¼š\n```cpp\n#define CONTROL_FIN WM_USER + 1\n```\nåœ¨`case CONTROL_FIN`ä¸­ï¼Œå¯ä»¥å‘é€è¿›åº¦æ¡çš„æ¶ˆæ¯ï¼š\n![](../../images/Windows_å¤šçº¿ç¨‹/image-20240725070738779.png)\n1. [PBM_SETRANGE message](https://learn.microsoft.com/en-us/windows/win32/controls/pbm-setrange)ç”¨äºè®¾ç½®è¿›åº¦æ¡çš„æœ€å°å€¼å’Œæœ€å¤§å€¼ï¼Œå¹¶é‡ç»˜è¿›åº¦æ¡ä»¥åæ˜ æ–°çš„èŒƒå›´ã€‚\n2. [PBM_SETPOS message](https://learn.microsoft.com/en-us/windows/win32/controls/pbm-setpos)ç”¨äºè®¾ç½®è¿›åº¦æ¡çš„å½“å‰ä½ç½®å¹¶é‡ç»˜è¿›åº¦æ¡ä»¥åæ˜ æ–°ä½ç½®ã€‚\n\n```cpp\nHWND hProgressBar = nullptr;\nint __stdcall wWinMain(HINSTANCE hInstance, HINSTANCE hPreInstance, wchar_t* lpCmdLine, int )\n{\n    // wcex ...\n    if (!RegisterClassEx(&wcex))\n    {\n        return -1;\n    }\n    HWND hWnd = NULL;\n    hWnd = CreateWindowEx(WS_EX_OVERLAPPEDWINDOW, szAppName, L\"App\", WS_OVERLAPPEDWINDOW, CW_USEDEFAULT, 0, CW_USEDEFAULT, 0, NULL, NULL, hIntance, NULL);\n    ShowWindow(hWnd, iCmdShow);\n    UpdateWindow(hWnd);\n\n    // åˆ›å»ºæ§ä»¶ï¼š\n    hProgressBar = CreateWindowEx(WS_EX_OVERLAPPEDWINDOW, PROGRESS_CLASS, L\"Bar\",\n        WS_CHILDWINDOW, 100, 100, 200, 20,\n        hWnd, nullptr, hInstance, nullptr);\n    ::PostMessage(hWnd, CONTROL_FIN, 0, 0);\n    ShowWindow(hProgressBar, iCmdShow);\n    UpdateWindow(hProgressBar);\n\n    MSG msg;\n    while (GetMessage(&msg, NULL, 0, 0))\n    {\n        TranslateMessage(&msg);\n        DispatchMessage(&msg);\n    }\n    return msg.wParam;\n}\nLRESULT CALLBACK WndProcedure(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)\n{\n    HDC hDC = NULL;\n    PAINTSTRUCT ps;\n    switch (message)\n    {\n    case WM_CREATE:\n    {\n        return 0;\n    }\n    case CONTROL_FIN: // è‡ªå®šä¹‰æ¶ˆæ¯ï¼šåˆ›å»ºè¿›åº¦æ¡å®Œæˆ\n    {\n        // ç”¨äºè®¾ç½®è¿›åº¦æ¡çš„æœ€å°å€¼å’Œæœ€å¤§å€¼ï¼Œå¹¶é‡ç»˜è¿›åº¦æ¡ä»¥åæ˜ æ–°çš„èŒƒå›´\n        ::PostMessage(hProgressBar, PBM_SETRANGE, 0, MAKELPARAM(0, 100));\n        // ç”¨äºè®¾ç½®è¿›åº¦æ¡çš„å½“å‰ä½ç½®å¹¶é‡ç»˜è¿›åº¦æ¡ä»¥åæ˜ æ–°ä½ç½®ã€‚\n        ::PostMessage(hProgressBar, PBM_SETPOS, 50, 0);\n        return 0;\n    }\n    case WM_PAINT:\n    {\n        hDC = BeginPaint(hWnd, &ps);\n        EndPaint(hWnd, &ps);\n        return 0;\n    }\n    case WM_DESTROY:\n    {\n        PostQuitMessage(0);\n        return 0;\n    }\n    }\n    return DefWindowProc(hWnd, message, wParam, lParam);\n}\nint  __stdcall DlgProcedure(HWND hDlg, UINT message, WPARAM wParam, LPARAM lParam)\n{\n    switch (message)\n    {\n    case WM_INITDIALOG:\n    {\n        return false;\n    }\n    case WM_CLOSE:\n    {\n        EndDialog(hDlg, 0);\n        return true;\n    }\n    case WM_COMMAND:\n    {\n        switch (LOWORD(wParam))\n        {\n        case IDCANCEL:\n        {\n            return true;\n        }\n        case IDOK:\n        {\n            return true;\n        }\n        }\n        return false;\n    }\n    }\n    return false;\n}\n```\nä»¥ä¸ŠUIç¨‹åºçš„æ•ˆæœï¼š\n![](../../images/Windows_å¤šçº¿ç¨‹/image-20240725071216773.png)\nä¸€ä¸ªä¸»çª—å£ï¼ŒåŒ…å«ä¸€ä¸ªè¿›åº¦æ¡ï¼Œ50%ã€‚\n## å•çº¿ç¨‹æ¶ˆæ¯å¾ªç¯å®ç°è¿›åº¦æ¡åŠ¨ç”»\n1. æƒ³è¦é€šè¿‡æŒ‰æŸä¸ªé”®ï¼Œè§¦å‘ã€é€šçŸ¥è¿›åº¦æ¡ä¸Šæ¶¨è‡³100%ã€‚\n2. å¹¶èƒ½åŒæ—¶æ˜¾ç¤ºå¤šä¸ªè¿›åº¦æ¡ï¼Œæ¯ä¸ªè¿›åº¦æ¡æŒ‰ä¸åŒé€Ÿåº¦èµ°ã€‚\n3. åŒä¸€æ—¶åˆ»è¦è®©æœ€å¤šä¸¤ä¸ªè¿›åº¦æ¡èƒ½åŠ¨ã€‚\n\n[PBM_STEPIT message](https://learn.microsoft.com/en-us/windows/win32/controls/pbm-stepit)ç”¨äºå°†è¿›åº¦æ¡çš„å½“å‰ä½ç½®å‘å‰æ¨è¿›æ­¥é•¿å¢é‡ï¼Œå¹¶é‡ç»˜è¿›åº¦æ¡ä»¥åæ˜ æ–°ä½ç½®ã€‚åº”ç”¨ç¨‹åºé€šè¿‡å‘é€PBM_SETSTEPæ¶ˆæ¯æ¥è®¾ç½®æ­¥é•¿å¢é‡ã€‚\n```cpp\n    case CONTROL_FIN: // è‡ªå®šä¹‰æ¶ˆæ¯ï¼šåˆ›å»ºè¿›åº¦æ¡å®Œæˆ\n    {\n        // ç”¨äºè®¾ç½®è¿›åº¦æ¡çš„æœ€å°å€¼å’Œæœ€å¤§å€¼ï¼Œå¹¶é‡ç»˜è¿›åº¦æ¡ä»¥åæ˜ æ–°çš„èŒƒå›´\n        ::PostMessage(hProgressBar, PBM_SETRANGE, 0, MAKELPARAM(0, 100));\n        // ç”¨äºè®¾ç½®è¿›åº¦æ¡çš„å½“å‰ä½ç½®å¹¶é‡ç»˜è¿›åº¦æ¡ä»¥åæ˜ æ–°ä½ç½®ã€‚\n        ::PostMessage(hProgressBar, PBM_SETPOS, 0, 0);\n        // è®¾ç½®æ­¥é•¿ï¼Œæ¯æ¬¡èµ°1\n        ::PostMessage(hProgressBar, PBM_SETPOS, 1, 0);\n        return 0;\n    }\n    case WM_KEYDOWN:\n    {\n        if (wParam == 'A')\n        {\n            for (int i = 0; i < 100; ++i)\n            {\n                ::PostMessage(hProgressBar, PBM_STEPIT, 0, 0);\n                std::this_thread::sleep_for(100ms);\n            }\n        }\n        return 0\n    }\n```\nä»¥ä¸Šç¨‹åºçš„é—®é¢˜æ˜¯ï¼Œä¸€ç›´æ²¡æœ‰è¿›åº¦æ¡çš„åŠ¨ç”»ï¼Œå¿…é¡»å¾—ç­‰forå¾ªç¯å®Œæ¯•ï¼Œè¿›åº¦æ¡æ‰èƒ½åŠ¨ï¼Œä½†æ˜¯æ˜¯ä¸€ä¸‹å­åˆ°å¤´ã€‚\nå› ä¸ºï¼š\næˆ‘ä»¬ç°åœ¨æ˜¯PostMessageå‘é€è¿›åº¦æ¡æ¶ˆæ¯ï¼Œå¯¼è‡´å…¶ä»–æ¶ˆæ¯ä¸èƒ½åŒæ—¶å¤„ç†ã€‚\nå› æ­¤è¦ç”¨SendMessageï¼Œä¸è¿›æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç›´æ¥æ“ä½œæ§ä»¶ï¼Œæ§ä»¶å°±å¯ä»¥ç«‹å³å“åº”äº†ã€‚\nä½†æ˜¯ä»ç„¶å­˜åœ¨é—®é¢˜ï¼šè¿›åº¦æ¡ç»“æŸå‰ä¸èƒ½ç§»åŠ¨ä¸»çª—å£ï¼ˆç§»åŠ¨ä¸»çª—å£æ˜¯å‘é€MOVEæ¶ˆæ¯ï¼‰ã€‚\nUIæ¶ˆæ¯é©±åŠ¨å·¥ä½œçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ\nwWinMainå‡½æ•°ä¸­æœ‰ä¸€ä¸ªæ¶ˆæ¯å¾ªç¯ã€‚\n![](../../images/Windows_å¤šçº¿ç¨‹/image-20240725073122710.png)\næˆ‘ä»¬éœ€è¦åœ¨`case WM_KEYDOWN`ä¸­ä¹ŸåŠ å…¥è¿™æ ·ä¸€ä¸ªæ¶ˆæ¯å¾ªç¯ã€‚\n\nä½†æ˜¯ï¼ŒGetMessageæ˜¯ä»¥é˜»å¡æ–¹å¼è·å–æ¶ˆæ¯çš„ï¼Œéœ€è¦åˆ‡æ¢ä¸ºPeekMessageã€‚[PeekMessageW function (winuser.h) - Win32 apps | Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-peekmessagew)\n```cpp\n    case WM_KEYDOWN:\n    {\n        if (wParam == 'A')\n        {\n            for (int i = 0; i < 100; ++i)\n            {\n                ::SendMessage(hProgressBar, PBM_STEPIT, 0, 0);\n                std::this_thread::sleep_for(100ms);\n                                \n                MSG msg;\n                while (::PeekMessage(&msg, NULL, 0, 0, PM_REMOVE))\n                {\n                    TranslateMessage(&msg);\n                    DispatchMessage(&msg);\n                }\n            }\n        }\n        return 0;\n    }\n```\n## å¤šçº¿ç¨‹æ¶ˆæ¯å¤„ç†\næŒ‰ä¸‹Sé”®åï¼Œåˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹ï¼Œåœ¨å­çº¿ç¨‹ä¸­è¿›è¡Œå‘é€æ¶ˆæ¯ã€‚\nå­çº¿ç¨‹å‘é€æ¶ˆæ¯æ—¶ï¼Œå°±æ²¡å¿…è¦ä½¿ç”¨SendMessageäº†ï¼Œä½¿ç”¨PostMessageå°±å¯ä»¥ï¼ŒPostMessageæ˜¯å¾€ä¸»çº¿ç¨‹ä¸­çš„æ¶ˆæ¯é˜Ÿåˆ—é‡ŒæŠ•æ”¾æ¶ˆæ¯ã€‚\nä½†æ˜¯è¦æ³¨æ„ï¼Œç”±äºåˆ›å»ºçš„æ˜¯jthreadçº¿ç¨‹ï¼Œæœ€åä¼šè‡ªåŠ¨joinï¼Œå¯¼è‡´ä¸»çº¿ç¨‹ä¼šç­‰å¾…å…¶æ“ä½œå®Œæ¯•ï¼Œé‚£ä¹ˆä¸»çª—å£å°±ä¸èƒ½å¤„ç†å…¶ä»–æ¶ˆæ¯ï¼Œå› æ­¤å­çº¿ç¨‹éœ€è¦detachã€‚\n```cpp\n    case WM_KEYDOWN:\n    {\n        if (wParam == 'A')\n        {\n            // ...\n        }\n        else if (wParam == 'S')\n        {\n            std::jthread t([]() -> void\n                {\n                    for (int i = 0; i < 100; ++i)\n                    {\n                        ::PostMessage(hProgressBar, PBM_STEPIT, 0, 0);\n                        std::this_thread::sleep_for(100ms);\n                    }\n                });\n            t.detach();\n        }\n        else if (wParam == 'F')\n        {\n            \n        }\n        return 0;\n        \n    }\n```\n### é€šè¿‡æ¡ä»¶å˜é‡æ§åˆ¶å­çº¿ç¨‹\næˆ‘ä»¬æŠŠåŸæœ¬æŒ‰ä¸‹Sé”®çš„å†…å®¹ç›´æ¥è®©å…¶åœ¨`case CONTROL_FIN`ä¸­å®Œæˆï¼Œæ„å‘³ç€åˆ›å»ºè¿›åº¦æ¡å®Œæˆåï¼Œå¹¶ä¸”è®¾ç½®å¥½è¿›åº¦æ¡çš„å±æ€§åï¼Œç«‹å³åˆ›å»ºå­çº¿ç¨‹ï¼Œä½†æ˜¯è¦ç”¨æ¡ä»¶å˜é‡æ§åˆ¶ï¼š\n#### ç”¨Eventæ§åˆ¶\n1. åœ¨å…¨å±€å®šä¹‰ä¸€ä¸ª`h_start_event`\n2. åœ¨`case CONTROL_FIN`ä¸­CreateEventä¸`h_start_event`ç»‘å®š\n3. åœ¨jthread tå‡½æ•°ä½“ä¸­ï¼ŒWaitForSingleObjectç­‰å¾…`h_start_event`\n4. åœ¨`case WM_KEYDOWN`çš„Fé”®ä¸­ï¼ŒSetEvent\n\n```cpp\nHANDLE h_start_event{ nullptr };\n\nLRESULT CALLBACK WndProcedure(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)\n{\n    HDC hDC = NULL;\n    PAINTSTRUCT ps;\n    switch (message)\n    {\n    case WM_CREATE:\n    {\n        return 0;\n    }\n    case CONTROL_FIN: // è‡ªå®šä¹‰æ¶ˆæ¯ï¼šåˆ›å»ºè¿›åº¦æ¡å®Œæˆ\n    {\n        h_start_event = ::CreateEvent(nullptr, false, false, nullptr);\n        // ç”¨äºè®¾ç½®è¿›åº¦æ¡çš„æœ€å°å€¼å’Œæœ€å¤§å€¼ï¼Œå¹¶é‡ç»˜è¿›åº¦æ¡ä»¥åæ˜ æ–°çš„èŒƒå›´\n        ::PostMessage(hProgressBar, PBM_SETRANGE, 0, MAKELPARAM(0, 100));\n        // ç”¨äºè®¾ç½®è¿›åº¦æ¡çš„å½“å‰ä½ç½®å¹¶é‡ç»˜è¿›åº¦æ¡ä»¥åæ˜ æ–°ä½ç½®ã€‚\n        ::PostMessage(hProgressBar, PBM_SETPOS, 0, 0);\n        // è®¾ç½®æ­¥é•¿ï¼Œæ¯æ¬¡èµ°1\n        ::PostMessage(hProgressBar, PBM_SETPOS, 1, 0);\n\n        std::jthread t([]() -> void\n            {\n                ::WaitForSingleObject(h_start_event, INFINITE);\n                \n                for (int i = 0; i < 100; ++i)\n                {\n                    ::PostMessage(hProgressBar, PBM_STEPIT, 0, 0);\n                    std::this_thread::sleep_for(100ms);\n                }\n            });\n        t.detach();\n        return 0;\n    }\n    case WM_KEYDOWN:\n    {\n        // ...\n        else if (wParam == 'F')\n        {\n            ::SetEvent(h_start_event);\n        }\n        return 0;\n    }\n    // ...\n    \n}\n```\n#### è·¨å¹³å°æ¡ä»¶å˜é‡æ§åˆ¶\n1. åœ¨å…¨å±€å®šä¹‰ä¸€ä¸ª`std::mutex start_mx`å’Œ`std::condition_variable start_cv`ã€‚\n2. åœ¨jthread tå‡½æ•°ä½“ä¸­ï¼Œå®šä¹‰`unique_lock lck{start_mx}`è·å–é”ï¼Œä¹‹å`start_cv.wait(lck)`\n3. åœ¨`case WM_KEYDOWN`çš„Fé”®ä¸­ï¼Œ`start_cv.notify_one()`\n\n```cpp\nstd::mutex start_mx;\nstd::condition_variable start_cv;\n\nLRESULT CALLBACK WndProcedure(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)\n{\n    HDC hDC = NULL;\n    PAINTSTRUCT ps;\n    switch (message)\n    {\n    case WM_CREATE:\n    {\n        return 0;\n    }\n    case CONTROL_FIN: // è‡ªå®šä¹‰æ¶ˆæ¯ï¼šåˆ›å»ºè¿›åº¦æ¡å®Œæˆ\n    {\n        // ç”¨äºè®¾ç½®è¿›åº¦æ¡çš„æœ€å°å€¼å’Œæœ€å¤§å€¼ï¼Œå¹¶é‡ç»˜è¿›åº¦æ¡ä»¥åæ˜ æ–°çš„èŒƒå›´\n        ::PostMessage(hProgressBar, PBM_SETRANGE, 0, MAKELPARAM(0, 100));\n        // ç”¨äºè®¾ç½®è¿›åº¦æ¡çš„å½“å‰ä½ç½®å¹¶é‡ç»˜è¿›åº¦æ¡ä»¥åæ˜ æ–°ä½ç½®ã€‚\n        ::PostMessage(hProgressBar, PBM_SETPOS, 0, 0);\n        // è®¾ç½®æ­¥é•¿ï¼Œæ¯æ¬¡èµ°1\n        ::PostMessage(hProgressBar, PBM_SETPOS, 1, 0);\n\n        std::jthread t([]() -> void\n            {\n                std::unique_lock lck{ start_mx };\n                start_cv.wait(lck);\n                \n                for (int i = 0; i < 100; ++i)\n                {\n                    ::PostMessage(hProgressBar, PBM_STEPIT, 0, 0);\n                    std::this_thread::sleep_for(100ms);\n                }\n            });\n        t.detach();\n        return 0;\n    }\n    case WM_KEYDOWN:\n    {\n        // ...\n        else if (wParam == 'F')\n        {\n            start_cv.notify_one();\n        }\n        return 0;\n    }\n    // ...\n    \n}\n```\n### å¤šä¸ªè¿›åº¦æ¡\n1. å…¨å±€å®šä¹‰3ä¸ª`hProgressBar`ã€‚\n2. åœ¨wWinMainä¸­CreateWindowExåˆ›å»ºè¿™3ä¸ªè¿›åº¦æ¡ï¼Œå¯ä»¥èµ‹äºˆä¸åŒåˆå§‹å±æ€§ã€‚å¹¶ä¸”è¦ä¸‰ä¸ªå…¨éƒ¨showã€Update\n3. `case CONTROL_FIN`ä¸­PostMessageé…ç½®æ¯ä¸ªProgressBarçš„å±æ€§ã€‚\n\n```cpp\nHWND hProgressBar{ nullptr }, hProgressBar2{ nullptr }, hProgress3{ nullptr };\nint __stdcall wWinMain(HINSTANCE hInstance, HINSTANCE hPreInstance, wchar_t* lpCmdLine, )\n{\n    // ..,\n    hProgressBar = CreateWindowEx(WS_EX_OVERLAPPEDWINDOW, PROGRESS_CLASS, L\"Bar\",\n        WS_CHILDWINDOW, 100, 100, 300, 20,\n        hWnd, nullptr, hInstance, nullptr);\n    hProgressBar2 = CreateWindowEx(WS_EX_OVERLAPPEDWINDOW, PROGRESS_CLASS, L\"Bar2\",\n        WS_CHILDWINDOW, 100, 150, 300, 20,\n        hWnd, nullptr, hInstance, nullptr);\n    hProgressBar3 = CreateWindowEx(WS_EX_OVERLAPPEDWINDOW, PROGRESS_CLASS, L\"Bar3\",\n        WS_CHILDWINDOW, 100, 200, 300, 20,\n        hWnd, nullptr, hInstance, nullptr);\n    ::PostMessage(hWnd, CONTROL_FIN, 0, 0);\n\n    ShowWindow(hProgressBar, iCmdShow);\n    ShowWindow(hProgressBar2, iCmdShow);\n    ShowWindow(hProgressBar3, iCmdShow);\n    UpdateWindow(hProgressBar);\n    UpdateWindow(hProgressBar2);\n    UpdateWindow(hProgressBar3);\n    // ...\n}\n// ...\n{\n    case CONTROL_FIN:\n    {\n        ::PostMessage(hProgressBar, PBM_SETRANGE, 0, MAKELPARAM(0, 100));\n        ::PostMessage(hProgressBar, PBM_SETPOS, 0, 0);\n        ::PostMessage(hProgressBar, PBM_SETSTEP, 1, 0);\n\n        ::PostMessage(hProgressBar2, PBM_SETRANGE, 0, MAKELPARAM(0, 100));\n        ::PostMessage(hProgressBar2, PBM_SETPOS, 34, 0);\n        ::PostMessage(hProgressBar2, PBM_SETSTEP, 1, 0);\n\n        ::PostMessage(hProgressBar3, PBM_SETRANGE, 0, MAKELPARAM(0, 100));\n        ::PostMessage(hProgressBar3, PBM_SETPOS, 67, 0);\n        ::PostMessage(hProgressBar3, PBM_SETSTEP, 1, 0);\n        // ...\n    }\n}\n```\næ•ˆæœå¦‚ä¸‹ï¼š\n![](../../images/Windows_å¤šçº¿ç¨‹/image-20240725233919380.png)\n# Windowsä¿¡å·é‡\n## CreateSemaphoreåˆ›å»ºä¿¡å·é‡\nåˆ›å»ºçš„APIä¸º`CreateSemaphore`\n![](../../images/Windows_å¤šçº¿ç¨‹/image-20240725002045341.png)\n1. å¯é€‰ï¼Œå®‰å…¨æè¿°ç¬¦ï¼Œå¦‚æœæ˜¯NULLåˆ™è·å¾—é»˜è®¤çš„å®‰å…¨æè¿°ç¬¦ã€‚å¦‚æœæ˜¯NULLåˆ™è¯¥å¥æŸ„ä¸èƒ½è¢«å­è¿›ç¨‹ç»§æ‰¿ã€‚\n2. ä¿¡å·é‡çš„åˆå§‹å€¼ã€‚å¿…é¡»å¤§äºç­‰äº0ã€‚\n3. ä¿¡å·é‡çš„æœ€å¤§å€¼ã€‚å¿…é¡»å¤§äº0ã€‚\n4. å¯é€‰ï¼Œä¿¡å·é‡å†…æ ¸å¯¹è±¡çš„åå­—ã€‚å¦‚æœæ˜¯NULLåˆ™æ²¡æœ‰åç§°ã€‚\n## WaitForSingleObjectä¿¡å·é‡å‡\n```cpp\n::WaitForSingleObject(h_semaphore, INFINITE);\n```\n## ReleaseSemaphoreä¿¡å·é‡åŠ \n![](../../images/Windows_å¤šçº¿ç¨‹/image-20240725004021152.png)\n1. ä¿¡å·é‡å¯¹è±¡çš„å¥æŸ„\n2. è¦å¢åŠ çš„é‡ï¼Œå¿…é¡»å¤§äº0ã€‚ä½†æ˜¯å¦‚æœè¯¥å€¼å¤§äºä¿¡å·é‡çš„æœ€å¤§å€¼ï¼Œåˆ™æ— æ•ˆï¼Œä¸åšæ›´æ”¹ï¼Œè¿”å›FALSEã€‚\n3. ä¸€ä¸ªæŒ‡é’ˆï¼Œç”¨äºæ¥æ”¶ä¿¡å·é‡å…ˆå‰çš„æ•°å€¼ï¼Œå¯ä»¥ä¸ºNULLã€‚\n## ç¤ºä¾‹ï¼šå¤šä¸ªè¿›åº¦æ¡åŒæ—¶åŠ¨ç”»\n1. ä»¥ä¸‹ç¨‹åºçš„æ•ˆæœæ˜¯ï¼ŒæŒ‰ä¸‹Fé”®åï¼ŒåŒæ—¶å¯ä»¥æœ‰ä¸¤ä¸ªæ¡è¿›è¡ŒåŠ è½½ï¼Œä¸¤ä¸ªæ¡ä¸­å¦‚æœæœ‰ä¸€ä¸ªåŠ è½½å®Œåï¼Œç¬¬ä¸‰ä¸ªæ¡å¼€å§‹åŠ è½½ã€‚\n2. ä¸‰ä¸ªçº¿ç¨‹éœ€è¦æœ‰æ¡ä»¶å˜é‡æ¥ç­‰å¾…Fé”®æŒ‰ä¸‹ï¼Œè€Œæ¡ä»¶å˜é‡éœ€è¦é”ï¼Œè€Œåwaitã€‚\n3. case Féœ€è¦ç»™ä»–ä»¬notify_all\n4. waitæˆåŠŸåè¿›è¡Œè·å–ä¿¡å·é‡ï¼Œä¿¡å·é‡åˆå§‹å€¼ã€æœ€å¤§å€¼ä¸º2ã€‚\n5. ä½†æ˜¯è¦æ±‚è¦æœ‰ä¸¤ä¸ªåŒæ—¶åŠ è½½ï¼Œæ‰€ä»¥æŸä¸€ä¸ªçº¿ç¨‹ä¸èƒ½ä¸€ç›´æ‹¿ç€ä¸€æŠŠé”ï¼Œå› æ­¤éœ€è¦waitæˆåŠŸåunlockã€‚\n6. ç»“æŸforå¾ªç¯åé‡Šæ”¾ä¿¡å·é‡ï¼Œå³åŠ 1ã€‚\n\nåœ¨ä¸Šä¸€èŠ‚ã€Š[å¤šä¸ªè¿›åº¦æ¡](#å¤šä¸ªè¿›åº¦æ¡)ã€‹çš„åŸºç¡€ä¸Šï¼Œéœ€è¦åšçš„æ˜¯ï¼š\n1. åœ¨`case CONTROL_FIN`ä¸­åˆ›å»º3ä¸ªçº¿ç¨‹ï¼Œå¯¹åº”3ä¸ªè¿›åº¦æ¡ã€‚\n2. åœ¨`case CONTROL_FIN`ä¸­åˆ›å»ºä¿¡å·é‡`h_semaphore`ã€‚\n3. æ¯ä¸ªçº¿ç¨‹éœ€è¦waitæŒ‰ä¸‹Fé”®çš„é€šçŸ¥ï¼Œæ‰€ä»¥éœ€è¦å…ˆè·å–é”ã€‚\n4. waitæˆåŠŸåéœ€è¦unlockã€‚\n5. è·å–ä¿¡å·é‡ã€‚\n6. forå¾ªç¯ç»“æŸåï¼Œé‡Šæ”¾ä¿¡å·é‡ã€‚\n7. 3ä¸ªjthreadçº¿ç¨‹åœ¨æœ€ådetachã€‚\n\n```cpp\n{\n    case CONTROL_FIN:\n    {\n        h_semaphore = ::CreateSemaphore(nullptr, 2, 2, nullptr);\n        std::jthread t([]() -> void\n        {\n            std::unique_lock lck{ start_mx };\n            start_cv.wait(lck);\n            lck.unlock();\n            ::WaitForSingleObject(h_semaphore, INFINITE);\n            for (int i = 0; i < 33; ++i)\n            {\n                ::PostMessage(hProgress, PBM_SETPIT, 0, 0);\n                std::this_thread::sleep_for(100ms);\n            }\n            ::ReleaseSemaphore(h_semaphore, 1, nullptr);\n        });\n        std::jthread t2([]() -> void\n        {\n            std::unique_lock lck{ start_mx };\n            start_cv.wait(lck);\n            lck.unlock();\n            ::WaitForSingleObject(h_semaphore, INFINITE);\n            for (int i = 33; i < 66; ++i)\n            {\n                ::PostMessage(hProgress, PBM_SETPIT, 0, 0);\n                std::this_thread::sleep_for(100ms);\n            }\n            ::ReleaseSemaphore(h_semaphore, 1, nullptr);\n        });\n        std::jthread t3([]() -> void\n        {\n            std::unique_lock lck{ start_mx };\n            start_cv.wait(lck);\n            lck.unlock();\n            ::WaitForSingleObject(h_semaphore, INFINITE);\n            for (int i = 66; i < 100; ++i)\n            {\n                ::PostMessage(hProgress, PBM_SETPIT, 0, 0);\n                std::this_thread::sleep_for(100ms);\n            }\n            ::ReleaseSemaphore(h_semaphore, 1, nullptr);\n        });\n        t.detach();\n        t2.detach();\n        t3.detach();\n    }\n    case WM_KETDOWN:\n    {\n        // ...\n        else if (wParam == 'F')\n        {\n            start_cv.notify_all();\n        }\n        return 0;\n    }\n    // ...\n}\n```","categories":["æ“ä½œç³»ç»Ÿ","å¤šçº¿ç¨‹","Windows"]},{"title":"Windows_åŸºäºæ¨¡æ¿è®¾è®¡","url":"/Windows/Windows_åŸºäºæ¨¡æ¿è®¾è®¡/","content":"# å‡†å¤‡é¡¹ç›®\n\nç”¨VSå‘å¯¼åˆ›å»ºé¡¹ç›®ã€‚æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œé€‰æ‹©\"Windows Desktop Wizard\"ï¼Œå–åä¸º\"TemplatedFramework\"ã€‚ç‚¹å‡»åˆ›å»ºæŒ‰é’®åï¼Œå¼¹å‡ºé…ç½®çª—å£ï¼ŒApplication typeé€‰æ‹©ï¼š\"Desktop Application (.exe)\"ï¼ŒAdditional optionsä¸­å‹¾é€‰\"Empty project\"ã€‚\n\né…ç½®VSé¡¹ç›®çš„å±æ€§ï¼Œå³é”®é¡¹ç›®é€‰æ‹©Propertiesï¼Œå·¦è¾¹æ é€‰æ‹©Linkerï¼Œç„¶åé€‰æ‹©Systemã€‚å³è¾¹è¯¦ç»†æ¡ç›®\"SubSystem\"æš‚æ—¶ä¸‹æ‹‰é€‰æ‹©Consoleï¼Œåç»­éœ€è¦çª—å£ç¨‹åºæ—¶å†è°ƒæ•´ä¸ºWindowsã€‚\n\nç›®å‰çš„å·¥ä½œæ˜¯ç¼–å†™ä¸€ä¸ªæ¨¡æ¿æ–‡ä»¶ã€‚æ¨¡æ¿ä¸æ˜¯ç¼–è¯‘å•ä½ï¼Œå› æ­¤å–åç¼€åä¸º`.hpp`ï¼Œå¦‚æœå†™ä¸º`.cpp`åç¼€åˆ™æ— æ³•é€šè¿‡é»˜è®¤ä¸€é”®ç¼–è¯‘ã€‚å› æ­¤ï¼Œ`.hpp`çš„æ–‡ä»¶é€šå¸¸è¢«ç†è§£ä¸ºæ— éœ€å†å»å¯»æ‰¾ç›¸åº”çš„`.cpp`å®ç°æ–‡ä»¶ï¼Œè€Œæ˜¯åœ¨è‡ªèº«æ–‡ä»¶ä¸­å·²å®ç°ã€‚æ‰€ä»¥åŸºäºæ¨¡æ¿å¼€å‘çš„ä»£ç ï¼Œæœ€åŸºç¡€çš„æ¨¡æ¿ä»£ç æ–‡ä»¶æ˜¯å¿…é¡»æä¾›å¼€æºçš„ã€‚\n\nå› æ­¤ï¼Œæ–°å»ºä¸€ä¸ª`.hpp`å¤´æ–‡ä»¶ï¼Œåä¸º`TWindow.hpp`ã€‚\n```cpp\n// TWindow.hpp\n\n#pragma once\n\nnamespace tfk\n{\n    template <typename T>\n    class TWindow\n    {\n        // ...\n    };\n}\n```\n# TWindowç±»è®¾è®¡\n\nå’Œé¢å‘å¯¹è±¡è®¾è®¡çš„Windowç±»å¾ˆç›¸ä¼¼ã€‚\nä¹‹å‰çš„`Window.h`æ–‡ä»¶ï¼š\n```cpp\n// Window.h\nclass Window\n{\npublic:\n    friend int ::wWinMain(HINSTANCE, HINSTANCE, LPWSTR, int);\npublic:\n    Window(std::wstring const& app_name);\n    bool create_window(void);\n    void show_window(bool show = true);\n    int run(void);\n\n    static LRESULT CALLBACK window_procedure(\n        HWND wnd, UINT message, WPARAM wparam, LPARAM lparam);\nprotected:\n    virtual void pre_create(WNDCLASSEX& wcex);\n    virtual bool on_lbtndown(POINT& pt);\n    virtual bool on_lbtnup(POINT& pt);\n    virtual bool on_rbtndown(POINT& pt);\n    virtual bool on_paint(HDC dc, PAINTSTRUCT& ps);\nprotected:\n    HWND              _wnd{ nullptr };\n    static HINSTANCE  _instance;\n    static Window*    _window;\n    std::wstring      _app_name;\n};\n```\nç°åœ¨æˆ‘ä»¬æ˜¯æ¨¡æ¿ç±»ï¼ˆæ²¡æœ‰å…·ä½“ç±»ï¼Œå› æ­¤ä¸å­˜åœ¨é™æ€å˜é‡ï¼‰ï¼Œè€Œä¸”ä¸ä¾èµ–äºåŠ¨æ€å¤šæ€ï¼Œå› æ­¤ï¼Œä¸ä¼šç”¨åˆ°virtualå±æ€§å’Œstaticå±æ€§ã€‚\n1. æ”¹ç±»åä¸º`TWindow`\n2. æ”¹æˆå‘˜å˜é‡`_window`çš„ç±»å‹ä¸º`TWindow<T>*`\n3. åˆ å»`create_window`å‡½æ•°ã€‚\n   `pre_create`å¯ä»¥é›†æˆåœ¨æ„é€ å‡½æ•°ä¸­äº†ã€‚å½“æ—¶è®¾è®¡Windowç±»å°†åˆ›å»ºçª—å£çš„å·¥ä½œä»æ„é€ å‡½æ•°ä¸­å‰¥ç¦»çš„åŸå› æ˜¯`pre_create`æ— æ³•åœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨ï¼Œè€Œ`pre_create`åˆå¿…é¡»å’Œ`create_window`çš„å…¶ä»–åŠ¨ä½œç»‘å®šï¼ˆwcexçš„èµ‹åˆå€¼å·¥ä½œï¼‰ï¼Œå› æ­¤éœ€è¦å•ç‹¬æŠ½å‡ºæ¥ä½œä¸º`create_window`ã€‚ç°åœ¨ï¼Œæ²¡æœ‰è™šå‡½æ•°ç‰¹æ€§äº†ï¼Œå› æ­¤ï¼Œ`pre_create`å¯ä»¥ç›´æ¥å†™åœ¨æ„é€ å‡½æ•°ä¸­ã€‚å› æ­¤ï¼Œä¹Ÿæ— éœ€å†å‰¥ç¦»å‡º`create_window`å‡½æ•°ï¼Œå³åŸå…ˆ`create_window`å‡½æ•°çš„å·¥ä½œå…¨åœ¨æ„é€ å‡½æ•°ä¸­é“ºå¼€ã€‚\n2. åˆ å»æˆå‘˜å˜é‡`_app_name`ï¼Œå› ä¸ºå¯ä»¥ç›´æ¥é€šè¿‡å‚æ•°åœ¨æ„é€ å‡½æ•°ä¸­èµ‹äºˆwcexå±æ€§ã€‚\n3. `pre_create`åˆ å»virtualã€‚\n4. å››ä¸ª`on_...`æ¶ˆæ¯å¤„ç†å‡½æ•°åˆ å»virtualã€‚\n```cpp\ntemplate <typename T>\nclass TWindow\n{\npublic:\n    friend int ::wWinMain(HINSTANCE, HINSTANCE, LPWSTR, int);\npublic:\n    TWindow(std::wstring const& app_name);\n    bool create_window(void);\n    void show_window(bool show = true);\n    int run(void);\n\n    static LRESULT CALLBACK window_procedure(\n        HWND wnd, UINT message, WPARAM wparam, LPARAM lparam);\nprotected:\n    void pre_create(WNDCLASSEX& wcex);\n    bool on_lbtndown(POINT& pt);\n    bool on_lbtnup(POINT& pt);\n    bool on_rbtndown(POINT& pt);\n    bool on_paint(HDC dc, PAINTSTRUCT& ps);\nprotected:\n    HWND                 _wnd{ nullptr };\n    static HINSTANCE     _instance;\n    static TWindow<T>*   _window;\n};\n```\n# TWindowç±»æ¨¡æ¿çš„å‡½æ•°å®ç°\nç›´æ¥åœ¨`TWindow.hpp`æ–‡ä»¶ä¸­çš„ç±»æ¨¡æ¿å®šä¹‰çš„å°¾éƒ¨ç¼–å†™å‡½æ•°å®ç°ã€‚\n```cpp\n// TWindow.hpp\nnamespace tfk\n{\n    template <typename T>\n    class TWindow\n    {\n        // ...\n    };\n\n    // åœ¨è¿™é‡Œå†™ implementation\n}\n```\n\n```cpp\n\n// TWindow<T> implementation\n\n// TWindow.hpp\n\n// ...\n\n#include <string>\n#include <Windows.h>\n\ntemplate <typename T>\nTWindow<T>::TWindow(std::wstring const& app_name)\n{\n    _window = this;\n\n    WNDCLASSEX wcex = { 0 };\n    wcex.cbSize = sizeof(wcex);\n    wcex.style = CS_HREDRAW | CS_VREDRAW;\n    wcex.lpfnWndProc = &window_procedure;\n    wcex.cbClsExtra = 0;\n    wcex.cbWndExtra = 0;\n    wcex.hInstance = _instance;\n    wcex.hIcon = LoadIcon(nullptr, IDI_SHIELD);\n    wcex.hCursor = LoadCursor(nullptr, IDC_ARROW);\n    wcex.hbrBackground = (HBRUSH)(GetStockObject(LTGRAY_BRUSH));\n    wcex.lpszMenuName = NULL;\n    wcex.lpszClassName = app_name.c_str();\n    wcex.hIconSm = wcex.hIcon;\n    \n    pre_create(wcex);  // æ­¤å¤„æœ‰éšæ‚£ï¼šè§ä¸‹æ–‡CALLBACKå®ç°\n\n    if (!::RegisterClassEx(&wcex))\n        return;\n    // å®šä¹‰ä¸€ä¸ªçª—å£å¯¹è±¡çš„å¥æŸ„\n    // HWND: çª—å£ç±»å‹çš„å¥æŸ„ï¼Œä¹Ÿå«å†…æ ¸å¯¹è±¡\n    _wnd = ::CreateWindowEx(\n        WS_EX_OVERLAPPEDWINDOW,\n        app_name.c_str(),\n        L\"App\",\n        WS_OVERLAPPEDWINDOW,\n        CW_USEDEFAULT, 0, CW_USEDEFAULT, 0,\n        nullptr,\n        nullptr,\n        hInstance,\n        nullptr);\n    if (!_wnd)\n    {\n        int i = ::GetLastError();\n        return;\n    }\n}\n\ntemplate <typename T>\nvoid TWindow<T>::show_window(bool show)\n{\n    if(_wnd)\n    {\n        int nShowCmd = show ? SW_NORMAL : SW_HIDE;\n        // æ˜¾ç¤ºçª—å£ï¼ŒnShowCmdå¯ä»¥æŒ‡å®šçª—å£ä»¥æœ€å°/æœ€å¤§/æ­£å¸¸çŠ¶æ€æ˜¾ç¤º\n        ::ShowWindow(_wnd, nShowCmd);\n        // æ›´æ–°çª—å£ï¼Œç»˜åˆ¶çª—å£ã€‚åˆšæ˜¾ç¤ºå‡ºæ¥å¯èƒ½æ˜¯æ— æ•ˆçš„ï¼Œéœ€è¦åœ¨æ˜¾ç¤ºåç»˜åˆ¶ã€‚\n        ::UpdateWindow(_wnd);\n    }\n}\n\ntemplate <typename T>\nint TWindow<T>::run(void)\n{\n    MSG msg;\n    while (::GetMessage(&msg, nullptr, 0, 0))\n    {\n        // ç¿»è¯‘æ¶ˆæ¯ï¼Œæ¯”å¦‚è¾“å…¥æ³•é€šè¿‡â€˜woâ€™ç”Ÿæˆâ€˜æˆ‘â€™\n        ::TranslateMessage(&msg);\n        // å‘é€æ¶ˆæ¯ï¼Œè°ƒç”¨åˆšæ‰æ³¨å†Œçš„callbackçª—å£å¤„ç†å‡½æ•°\n        ::DispatchMessage(&msg);\n    }\n    return 0;\n}\n\ntemplate <typename T>\nvoid TWindow<T>::pre_create(WNDCLASSEX& wcex)\n{\n    // ç©ºæ“ä½œ\n}\n```\n## CALLBACKå®ç°\nä¸»è¦åˆ†æä¸€ä¸‹ç±»æ¨¡æ¿ä¸‹çš„CALLBACKå¦‚ä½•å®ç°ã€‚\nç”±äºæ­¤æ¨¡å¼çš„å¤šæ€æ˜¯é™æ€å¤šæ€ï¼Œæ‰€ä»¥éœ€è¦æŠŠ`_window`ï¼ˆå€¼ä¸ºthisæŒ‡é’ˆï¼‰ä»`TWindow<T>*`å¼ºè½¬ä¸º`T*`ï¼Œèµ‹ç»™windowå˜é‡ã€‚\næŠŠåŸå…ˆé¢å‘å¯¹è±¡æ¨¡å¼ä¸‹ç”¨`_window`è°ƒç”¨æ–¹æ³•å…¨éƒ¨æ›¿æ¢ä¸º`window`è°ƒç”¨ã€‚\n```cpp\ntemplate <typename T>\nLRESULT TWindow<T>::window_procedure(\n    HWND wnd, UINT message,\n    WPARAM wparam, LPARAM lparam)\n{\n\n    T* window = static_cast<T*>(_window);\n\n    if(!window)\n        return ::DefWindowProc(wnd, message, wparam, lparam);\n\n    PAINTSTRUCT ps;\n\n    switch (message)\n    {\n    case WM_CREATE:\n        break;\n    case WM_LBUTTONDOWN:\n    {\n        // GET_X/Y_LPARAM From <windowsx.h> \n        int x_coord = GET_X_LPARAM(lparam);\n        int y_coord = GET_Y_LPARAM(lparam);\n        POINT pt{ x_coord, y_coord };\n        // trueä»£è¡¨ç”¨æˆ·å¤„ç†å®Œæ¯•\n        if (window->on_lbtndown(pt))\n            return 1;\n    }\n        break;\n    case WM_LBUTTONUP:\n    {\n        // GET_X/Y_LPARAM From <windowsx.h> \n        int x_coord = GET_X_LPARAM(lparam);\n        int y_coord = GET_Y_LPARAM(lparam);\n        POINT pt{ x_coord, y_coord };\n        // trueä»£è¡¨ç”¨æˆ·å¤„ç†å®Œæ¯•\n        if (window->on_lbtnup(pt))\n            return 1;\n    }\n        break;\n    case WM_RBUTTONDOWN:\n    {\n        int x_coord = GET_X_LPARAM(lparam);\n        int y_coord = GET_Y_LPARAM(lparam);\n        POINT pt{ x_coord, y_coord };\n        if (window->on_rbtndown(pt))\n            return 1;\n    }\n        break;\n    case WM_PAINT:\n    {\n        HDC dc = ::BeginPaint(wnd, &ps);\n        bool result = window->on_paint(dc, ps);\n        ::EndPaint(wnd, &ps);\n        if (result)\n            return 1;\n    }\n        break;\n    case WM_DESTROY:\n        ::PostQuitMessage(0);\n        break;\n    //default:\n    //    ;\n    }\n    return ::DefWindowProc(wnd, message, wparam, lparam);\n}\n```\n>æ­¤æ—¶æœ‰ä¸€ä¸ªéšæ‚£ï¼Œç”±äºé™æ€å¤šæ€ï¼Œæ‰€ä»¥æ„é€ å‡½æ•°ä¸­çš„`pre_create`ä¸èƒ½ä½¿ç”¨é»˜è®¤ç±»å‹thisè°ƒç”¨ï¼Œéœ€è¦å¼ºè½¬ä¸º`T*`æ‰èƒ½æˆåŠŸè°ƒç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„æ–¹æ³•ã€‚\n```cpp\ntemplate <typename T>\nTWindow<T>::TWindow(std::wstring const& app_name)\n{\n    _window = this;\n\n    // ...\n    \n    static_cast<T*>(_window)->pre_create(wcex);  // æ­¤å¤„æœ‰éšæ‚£ï¼šè§ä¸‹æ–‡CALLBACKå®ç°\n\n    // ...\n}\n```\n# wWinMainæ”¾åˆ°å“ª\nå†™åˆ°`TWindow.cpp`é‡Œé¢ã€‚\n```cpp\n#include \"TWindow.hpp\"\n\nextern int main(std::wstring const& args);\n\nint wWinMain(\n    HINSTANCE hInstance,\n    HINSTANCE hPrevInstance,\n    LPWSTR lpCmdLine,\n    int nShowCmd)\n{\n    // error\n    tfk::TWindow<?>::_instance = hInstance;\n    return main(lpCmdLine);\n}\n```\nä½†æ˜¯ï¼Œåˆé‡åˆ°ä¸€ä¸ªæ¨¡æ¿ç¼–ç¨‹ä¸­çš„é—®é¢˜ï¼šæ­¤æ—¶`TWindow`ç¼ºå°‘ä¸€ä¸ªæ¨¡æ¿å‚æ•°ã€‚è€Œè¿™ä¸ªç±»æ¨¡æ¿çš„å…·ä½“å®šä¹‰å´åˆæ˜¯åœ¨mainå‡½æ•°åå®Œæˆå®šä¹‰çš„ã€‚æ‰€ä»¥è¿™ä¸ªæ¨¡æ¿å‚æ•°æ— æ³•å¡«å†™ã€‚\nå› æ­¤ï¼Œè¿™é‡Œçš„`_instance`å°±ä¸èƒ½ä½œä¸ºç±»çš„å±æ€§äº†ï¼Œè€Œæ˜¯ä½œä¸ºç±»ä¹‹å¤–çš„å…¨å±€å±æ€§ã€‚\n\næ”¹å†™ï¼šæŠŠ`_instance`å‰¥ç¦»ç±»å¤–ï¼Œå®šä¹‰ä¸ºexternã€‚\n```cpp\n// TWindow.hpp\nnamespace tfk\n{\n    extern HINSTANCE gInstance;\n\n    template <typename T>\n    class TWindow\n    {\n        // ...\n    }\n}\n```\nç„¶ååœ¨`TWindow.cpp`é‡Œé¢å®šä¹‰å®ƒã€‚åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ä¹Ÿå¼€ä¸€ä¸ªtfkåå­—ç©ºé—´ã€‚\n```cpp\n// TWindow.cpp\n\n#include \"TWindow.hpp\"\n\nnamespace tfk\n{\n    constinit HINSTANCE ginstance{ nullptr };\n}\n\n// ...\n```\nè‡³æ­¤ï¼Œå°±å¯ä»¥åœ¨wWinMainä¸­æŠŠhInstanceå€¼èµ‹ç»™`TWindow<T>`è¦ä½¿ç”¨çš„gInstaceå˜é‡äº†ã€‚å®Œæ•´ã€æ­£ç¡®çš„`TWindow.cpp`å†…å®¹ï¼š\n```cpp\n#include \"TWindow.hpp\"\n\nnamespace tfk\n{\n    constinit HINSTANCE ginstance{ nullptr };\n}\n\nextern int main(std::wstring const& args);\n\nint wWinMain(\n    HINSTANCE hInstance,\n    HINSTANCE hPrevInstance,\n    LPWSTR lpCmdLine,\n    int nShowCmd)\n{\n    tfk::gInstance = hInstance;\n    return main(lpCmdLine);\n}\n```\næœ€åï¼Œæ”¹å†™ä¸€ä¸‹TWindowæ„é€ å‡½æ•°ä¸­æ¶‰åŠåˆ°`_instance`çš„åœ°æ–¹ï¼Œæ›¿æ¢ä¸º`gInstance`ã€‚è¿˜æœ‰ï¼Œä¹‹å‰å› ä¸ºç±»å¤–çš„wWinMainè¦ç”¨åˆ°æˆå‘˜å˜é‡`_instance`ï¼Œæˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ªå‹å…ƒï¼Œç°åœ¨ä¹Ÿå¯ä»¥åˆ å»äº†ã€‚\n```cpp\n// TWindow.hpp\n\nclass TWindow\n{\n/* public:\n    friend int ::wWinMain(HINSTANCE, HINSTANCE, LPWSTR, int); */\n\n// ...\n};\n```\n\n```cpp\n// TWindow.hpp implementaion\n\nTWindow<T>::TWindow(std::wstring const& app_name)\n{\n    // ...\n\n    wcex.hInstance = gInstance;\n\n    // ...\n\n    _wnd = ::CreateWindowEx(\n        WS_EX_OVERLAPPEDWINDOW,\n        app_name.c_str(),\n        L\"App\",\n        WS_OVERLAPPEDWINDOW,\n        CW_USEDEFAULT, 0, CW_USEDEFAULT, 0,\n        nullptr, nullptr, gInstance, nullptr);\n}\n\n```\n# `_window`æ€ä¹ˆåˆå§‹åŒ–\n`_window`æ˜¯é™æ€å˜é‡ã€‚åœ¨ç±»æ¨¡ç‰ˆä¸‹çš„é™æ€å˜é‡ï¼Œåœ¨ç±»å¤–ä¸èƒ½ç›´æ¥å¡«å‚æ•°ã€‚å› æ­¤ç±»ä¼¼äºgInstaceçš„åˆå§‹åŒ–å†™æ³•ï¼Œå†™åœ¨`TWindow.cpp`ä¸­çš„å¦ä¸€ä¸ªtfkåå­—ç©ºé—´ä¸­ã€‚\nå…ˆç”¨æ³›åŒ–çš„æ–¹å¼å†™ä¸€ä¸‹è¯•è¯•ï¼š\n```cpp\n#include \"TWindow.hpp\"\n\nnamespace tfk\n{\n    // ...\n    \n    template<typename T> TWindow<T>* TWindow<T>::_window{ nullptr };\n}\n```\nå°å°æµ‹è¯•ä¸€ä¸‹ï¼š\n```cpp\n// MyTApp.h\n#pragma once\n#include \"TWindow.hpp\"\nclass MyTApp : public tfk::TWindow<MyTApp>\n{\npublic:\n    MyTApp(std::wstring const & name) : TWindow{name}\n    {\n        //\n    }\n};\n```\n\n```cpp\n// Source.app\n#include \"MyTApp.h\"\nint main(void)\n{\n    MyTApp my_app;\n    my_app.show_window();\n    return my_app.run();\n}\n```\næµ‹è¯•ï¼Œä»¥ä¸Šå†™æ³•ç¼–è¯‘ä¸é€šè¿‡ï¼š\n```\nerror: LNK2001: unresolved symbol \"protected: static class tfk::TWindow<class MyTApp> * tfk::TWindow<class MyTApp>::_window\" (?_window@?$TWindow@VMyTApp@@@tfk@@1PEAV12@EA)\n```\né“¾æ¥å™¨å¤±è´¥ï¼Œè¯æ˜ç±»æ¨¡æ¿ä¸‹é™æ€å˜é‡çš„åˆå§‹åŒ–ä¸èƒ½è¿™ä¹ˆå†™ã€‚\né‚£ä¹ˆï¼Œå°±éœ€è¦è®©ç”¨æˆ·åœ¨å…¶mainå‡½æ•°æ‰€åœ¨çš„æ–‡ä»¶å¤–éƒ¨è¿›è¡Œåˆå§‹åŒ–äº†ï¼š\n```cpp\n// main.cpp\n#include \"MyTApp.h\"\n\ntfk::TWindow<MyTApp>* tfk::TWindow<MyTApp>::_window{ nullptr };\n\nint main(void)\n{\n    // ...\n}\n```\nä¹Ÿæœ‰æ›´ç®€åŒ–çš„å†™æ³•ï¼Œåˆ©ç”¨å®å®šä¹‰ï¼š\n```cpp\n#define Tinit(app)   tfk::TWindow<app>* tfk::TWindow<app>::_window{ nullptr }\n\nTinit(MyTApp);\n```\nå¯ä»¥æŠŠå®å®šä¹‰å†™åœ¨`TWindow.hpp`å°¾éƒ¨ï¼š\n```cpp\n// TWindow.hpp\n//...\n\n#define Tinit(app)   tfk::TWindow<app>* tfk::TWindow<app>::_window{ nullptr }\n```\né™¤äº†æŠŠè¿™ä¸ªé—®é¢˜æŠ›ç»™ç”¨æˆ·å¤„ç†ï¼Œè¿˜æœ‰ä¸€ä¸ªæ–¹æ¡ˆï¼Œå³ç±»ä¼¼äº`gInstance`çš„å¤„ç†ï¼Œå°±æ˜¯æŠŠ`_window`æå‡ä¸ºæ¨¡æ¿ç±»å¤–çš„å…¨å±€å˜é‡ã€‚\n# åŸºäºæ¨¡æ¿æ¡†æ¶å¼€å‘\n\n```cpp\n// MyTApp.h\n#pragma once\n#include \"TWindow.hpp\"\nclass MyTApp : public tfk::TWindow<MyTApp>\n{\npublic:\n    MyTApp(std::wstring const & name) : TWindow{name}\n    {\n        //\n    }\n\n    void pre_create(WNDCLASSEX& wcex)\n    {\n        wcex.hbrBackground = reinterpret_cast<HBRUSH>(::GetStockObject(BLACK_BRUSH));\n    }\n};\n```\n\n```cpp\n// Source.app\n#include \"MyTApp.h\"\nint main(void)\n{\n    MyTApp my_app;\n    my_app.show_window();\n    return my_app.run();\n}\n```\n\n# åŸºäºGeometryUIå¼€å‘æ‰“å­—æ¸¸æˆ\n## æ•´ä½“å¸ƒå±€\nä¸€ä¸ªå¤§çª—å£åŒ…å«ä¸¤ä¸ªå­çª—å£ï¼Œå·¦å³åˆ†å¸ƒã€‚å·¦çª—å£è®°å½•å®æ—¶åˆ†æ•°Scoreï¼Œå³çª—å£ä¸ºæ¸¸æˆç”»é¢ï¼Œæ˜¾ç¤ºä¸€äº›ä»ä¸Šæ–¹è½ä¸‹çš„åœ†åœˆå­—æ¯ï¼Œç©å®¶æŒ‰ä¸‹çœ‹åˆ°çš„å­—æ¯å¯ä»¥å°†å…¶æ¶ˆé™¤ï¼Œå½“æœ‰å­—æ¯æ¥è§¦åˆ°åº•éƒ¨è¾¹æ¡†æ—¶ï¼Œæ¸¸æˆç»“æŸã€‚\n## é¡¹ç›®é…ç½®\næ–°å»ºé¡¹ç›®ï¼ŒåŒæ ·é€‰æ‹©Windows Desktop Wizardã€‚èµ·å`Typist`ï¼ŒApplication Typeé€‰æ‹©Desktop Applicationï¼ŒAddition optionsé€‰æ‹©Empty projectã€‚\næ–°å»ºSource Filesï¼Œ`main.cpp`ã€‚\n\næ‰“å¼€`Typist`çš„Open Containing Folderï¼Œå’ŒQuickGeometryUIçš„Open Containing Folderã€‚æŠŠæ‰€æœ‰ç›¸å…³çš„ä»£ç æ–‡ä»¶ï¼ˆ`.h`ã€`.hpp`ã€`.inl`ã€`.cpp`ï¼ˆé™¤äº†æµ‹è¯•æ–‡ä»¶ï¼‰ï¼‰æ‹·è´åˆ°Typistç›®å½•ã€‚\n\nå¼•å…¥å¤–éƒ¨æ–‡ä»¶åï¼Œå³é”®Header Filesï¼ŒAdd Existing Filesï¼Œé€‰æ‹©`.h`ã€`.hpp`ã€`.inl`æ–‡ä»¶ï¼ˆ`inl`è¡¨ç¤ºinlineï¼‰ï¼›å³é”®Source Filesï¼ŒAdd Existing Filesï¼Œé€‰æ‹©`.cpp`æ–‡ä»¶ã€‚\n\nä¸‹é¢æ–°å»ºå¹¶ç¼–å†™æ–‡ä»¶`TypistWindow.h`ï¼ˆå»ºåœ¨Filter `Typist Box`ä¸­ï¼‰ï¼š\nå³é”®é¡¹ç›®å`Typist`ï¼ŒAddï¼ŒNew Filterï¼Œå–åä¸º`Typist Box`ã€‚å†åœ¨è¿™ä¸ªå»ºå¥½çš„Filteråå­—ä¸Šå³é”®ï¼ŒAdd New Itemï¼Œå–å`TypistWindow.h`ã€‚\nè¯¥æ–‡ä»¶å£°æ˜3ä¸ªç±»ï¼š\n1. TypistFrame\n2. TypistLeftBox\n3. TypistCentralBox\néœ€è¦å¼•å…¥`QuickGeometryUI.hpp`\n```cpp\n// TypistWindow.h\n\n#pragma once\n\n#include \"QuickGeometryUI.hpp\"\nnamespace typist\n{\n    // Window Frame\n    class TypistFrame : public harbin::GeometryFrameBox<TypistFrame>\n    {\n        // ...\n    };\n\n    // Left window\n    // æ¨¡æ¿å‚æ•°1: ParentBox\n    // æ¨¡ç‰ˆå‚æ•°2: InheritedTï¼ˆå½“å‰çª—å£ï¼‰\n    class TypistLeftBox : public harbin::GeometryBox<TypistFrame, TypistLeftBox>\n    {\n        // ...\n    };\n\n    class TypistCentralBox : public harbin::GeometryBox<TypistFrame, TypistCentralBox>\n    {\n        // ...\n    };\n}\n```\n## æ„é€ \n```cpp\n// TypistWindow.h\n\n// ...\n#include <string>\n#include \"QuickGeometryUI.hpp\"\nnamespace typist\n{\nclass TypistFrame : public harbin::GeometryFrameBox<TypistFrame>\n{\npublic:\n    TypistFrame(std::wstring const& name);\n};\n\nclass TypistLeftBox : public harbin::GeometryBox<TypistFrame, TypistLeftBox>\n{\npublic:\n    TypistLeftBox(TypistFrame * frame, std::wstring const& name);\n};\n\nclass TypistCentralBox : public harbin::GeometryBox<TypistFrame, TypistCentralBox>\n{\npublic:\n    TypistCentralBox(TypistFrame * frame, std::wstring const& name);\n};\n}\n```\n### å®ç°\n`TypistWindow.cpp`å»ºåœ¨Filter `Typist Box`ä¸­ã€‚\n```cpp\n// TypistWindow.cpp\n#include \"TypistWindow.h\"\ntypist::TypistFrame::TypistFrame(std::wstring const& name) : \n    GeometryFrameBox{ name.c_str() }\n{\n\n}\n\ntypist::TypistLeftBox::TypistLeftBox(TypistFrame* frame, std::wstring const& name) : \n    GeometryFrameBox{ frame, name.c_str() }\n{\n\n}\n\ntypist::TypistCentralBox::TypistCentralBox(TypistFrame* frame, std::wstring const& name) : \n    GeometryFrameBox{ frame, name.c_str() }\n{\n\n}\n```\n## mainå‡½æ•°\n1. å…¥å£å‡½æ•°è§„å®šä¸ºGeometryMainï¼Œéœ€è¦æ”¹mainå‡½æ•°åå­—\n2. å®šä¹‰çª—å£Frameï¼Œå†å®šä¹‰ä¸­å¤®çª—å£ã€å·¦çª—å£ã€‚\n3. AddSubBoxï¼Œå‘çˆ¶çª—å£ä¸­æ·»åŠ ä¸¤ä¸ªå­çª—å£ã€‚\n    1. ç¬¬1ä¸ªå‚æ•°æŒ‡å®šå“ªä¸ªä½œä¸ºå­çª—å£\n    2. ç¬¬2ä¸ªå‚æ•°æŒ‡å®šä½ç½®å¸ƒå±€åˆ°å“ªé‡Œ\n    3. ç¬¬3ä¸ªå‚æ•°æ˜¯iDockModes\n        1. è¿™ä¸ªæ˜¯åšä»€ä¹ˆçš„å‘¢ï¼Ÿå‡è®¾åŒæ—¶æœ‰å·¦ç›’å­ã€ä¸‹ç›’å­ï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯æŒ‡å®šè°å ç”¨å·¦ä¸‹è§’çš„ä½ç½®ã€‚åˆ™å‚æ•°é€‰é¡¹ä¸­è°åå­—åœ¨å‰é¢è°å ï¼Œå¦‚`DM_LEFT_BOTTOM`æ˜¯å·¦ç›’å­å ç”¨ã€‚\n        2. æˆ‘ä»¬æ­¤ä¾‹æ²¡æœ‰ä¸‹ç›’å­ï¼Œå¯ä»¥çœç•¥ã€‚\n4. showï¼Œ3ä¸ªç›’å­\n5. runï¼Œæ¶ˆæ¯å¾ªç¯æ”¾åˆ°äº†frame_boxä¸­ã€‚\n`main.cpp`å»ºåœ¨Source Filesä¸­ã€‚\n```cpp\n// main.cpp\n\n#include \"TypistWindow.h\"\nint GeometryMain(void)\n{\n    typist::TypistFrame frame_box{ L\"frame\" };\n    typist::TypistCentralBox central_box{ &frame_box, L\"central\" };\n    typist::TypistLeftBox left_box{ &frame_box, L\"left\" };\n\n    frame_box.AddSubBox(&central_box, BP_CENTRAL);\n    frame_box.AddSubBox(&left_box, BP_LEFT);\n\n    frame_box.ShowBox();\n    central_box.ShowBox();\n    left_box.ShowBox();\n\n    frame_box.Run();\n    \n    return 0;\n}\n```\nè¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š\n![](../../images/Windows_åŸºäºæ¨¡æ¿è®¾è®¡/image-20240729013537130.png)\n## æ¢å­çª—å£èƒŒæ™¯é¢œè‰²\nå¯ä»¥é‡å†™`template<typename ParentBox, typename InheritedT> class GeometryBox`ä¸­çš„æ–¹æ³•`void PreCreateBox(WNDCLASSEX&)`ã€‚\næˆ‘ä»¬æ›´æ¢çš„æ˜¯CentralBoxçš„é¢œè‰²ã€‚\n```cpp\n// TypistWindow.h\n\n// ...\n\nclass TypistCentralBox : public harbin::GeometryBox<TypistFrame, TypistCentralBox>\n{\npublic:\n    // ...\n    void PreCreateBox(WNDCLASSEX&);\n}\n```\nå®ç°ï¼š\n```cpp\n// TypistWindow.cpp\nvoid typist::TypistCentralBox::PreCreateBox(WNDCLASSEX& wcex)\n{\n    wcex.hbrBackground = reinterpret_cast<HBRUSH>(::GetStockObject(WHITE_BRUSH));\n}\n```\nè¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š\n![](../../images/Windows_åŸºäºæ¨¡æ¿è®¾è®¡/image-20240729014226553.png)\n## OnPaintç»˜åˆ¶å›¾å½¢\nå¯ä»¥é‡å†™`template<typename ParentBox, typename InheritedT> class GeometryBox`ä¸­çš„æ–¹æ³•`void OnPaint(Graphics&, HDC, PAINTSTRUCT*, bool)`ã€‚\n```cpp\n// TypistWindow.h\n// ...\nclass TypistCentralBox : public harbin::GeometryBox<TypistFrame, TypistCentralBox>\n{\npublic:\n    // ...\n    void typist::TypistCentralBox::OnPaint(\n        Graphics& graphics,\n        HDC hDC,\n        PAINTSTRUCT* pPS,\n        bool bDragRepaint = false);\n}\n```\nå…¶ä¸­GraphicsæŒ‡å®šçš„æ˜¯ç»˜åˆ¶å›¾å½¢çš„æ¥å£ï¼Œæœ‰GDIå’ŒGDI+ã€‚\nå› ä¸ºæˆ‘ä»¬åœ¨`TypistWindow.h`ä¸­å¼•å…¥äº†`QuickGeometry.hpp`ï¼Œè€Œ`QuickGeometry.cpp`ä¸­å¼•å…¥äº†`<gdiplus.h>`ï¼Œå› æ­¤æ— éœ€å†æ¬¡å¼•å…¥ã€‚\n```cpp\n// TypistWindow.cpp\n// ...\nvoid typist::TypistCentralBox::OnPaint(\n    Graphics& graphics,\n    HDC hDC,\n    PAINTSTRUCT* pPS,\n    bool bDragRepaint /* = false */)\n{\n    Gdiplus::Color color(200, 255, 255, 0);\n    Gdiplus::Pen pen(color, 3.0f);\n    Gdiplus::PointF pt{ 100.0f, 100.0f };\n    Gdiplus::PointF pt2{ 300.0f, 300.0f };\n    graphics.DrawLine(&pen, pt, pt2);\n}\n```\næ•ˆæœå¦‚ä¸‹ï¼š\n![](../../images/Windows_åŸºäºæ¨¡æ¿è®¾è®¡/image-20240729054744344.png)\n### å…³äºGDI\nGDIï¼ˆGraphics Device Interfaceï¼‰æ˜¯Windowsçš„å­ç³»ç»Ÿï¼Œæ„ä¸ºå›¾å½¢è®¾å¤‡æ¥å£ï¼Œæ˜¯ç­–ç•¥æ¨¡å¼çš„ä¸€ç§ã€‚\nGDIç”¨äºåœ¨DCï¼ˆDevice Contextï¼‰ä¸Šç»˜ç”»ã€‚\n\nGDI ä¸»è¦ç”¨äºç»˜åˆ¶å›¾å½¢å’Œæ–‡æœ¬ï¼Œä»¥åŠç®¡ç†æ˜¾ç¤ºè®¾å¤‡ï¼ˆå¦‚æ˜¾ç¤ºå™¨å’Œæ‰“å°æœºï¼‰ã€‚å®ƒæä¾›äº†åŸºæœ¬çš„ç»˜å›¾åŠŸèƒ½ï¼ŒåŒ…æ‹¬çº¿æ¡ã€çŸ©å½¢ã€æ¤­åœ†ã€ä½å›¾ã€å­—ä½“ç­‰ã€‚\n\nGDI æ˜¯ä¸€ä¸ªæˆç†Ÿä½†ç›¸å¯¹ä½çº§çš„æ¥å£ï¼Œæä¾›çš„å›¾å½¢åŠŸèƒ½æ¯”è¾ƒåŸºç¡€ï¼Œæ€§èƒ½è¾ƒé«˜ï¼Œä½†ä¸æ”¯æŒå¤æ‚çš„å›¾å½¢æ•ˆæœå’ŒæŠ—é”¯é½¿ç­‰ç°ä»£å›¾å½¢æŠ€æœ¯ã€‚\n### GDI+\nGDI+ æ˜¯ GDI çš„å¢å¼ºç‰ˆï¼Œä»–ä»¬éƒ½æ˜¯Windowsæ“ä½œç³»ç»Ÿä¸­çš„å›¾å½¢ç¼–ç¨‹æ¥å£ã€‚GDI+æä¾›äº†æ›´ç°ä»£åŒ–å’Œä¸°å¯Œçš„å›¾å½¢åŠŸèƒ½ï¼Œæœ‰æ›´å¤šé«˜çº§åŠŸèƒ½å’Œæ›´é«˜çš„æŠ½è±¡å±‚æ¬¡ã€‚åŒ…æ‹¬çŸ¢é‡å›¾å½¢ã€æµ®ç‚¹åæ ‡ã€é¢œè‰²æ¸å˜ã€å¤æ‚åŒºåŸŸå¡«å……ã€é€æ˜åº¦å’ŒæŠ—é”¯é½¿ç­‰ã€‚å®ƒç®€åŒ–äº†è®¸å¤šå›¾å½¢ç¼–ç¨‹ä»»åŠ¡ï¼Œå¹¶ä¸”èƒ½æ›´å¥½åœ°å¤„ç†å¤æ‚çš„å›¾å½¢æ•ˆæœã€‚ä½†ç›¸å¯¹è€Œè¨€ï¼Œæ€§èƒ½å¯èƒ½ä¸å¦‚ GDI é«˜ã€‚\n## å·¦çª—å£ç”»æ–‡å­—\nTypistLeftBox ç±»é‡å†™`template<typename ParentBox, typename InheritedT> class GeometryBox`ä¸­çš„æ–¹æ³•`void OnPaint(Graphics&, HDC, PAINTSTRUCT*, bool)`ã€‚\n```cpp\n// TypistWindow.h\n// ...\nclass TypistLeftBox : public harbin::GeometryBox<TypistFrame, TypistCentralBox>\n{\npublic:\n    // ...\n    void typist::TypistLeftBox::OnPaint(\n        Graphics& graphics,\n        HDC hDC,\n        PAINTSTRUCT* pPS,\n        bool bDragRepaint = false);\n}\n```\nå®ç°\n```cpp\n// TypistWindow.cpp\n// ...\nvoid typist::TypistLeftBox::OnPaint(\n    Graphics& graphics,\n    HDC hDC,\n    PAINTSTRUCT* pPS,\n    bool bDragRepaint /* = false */)\n{\n    Gdiplus::FontFamily fontFamily(L\"Times New Roman\");\n    Gdiplus::Font font(&fontFamily, 24, Gdiplus::FontStyle::FontStyleBold, Gdiplus::UnitPoint);\n    Gdiplus::PointF pf(10.0f, 100.0f);\n    Gdiplus::SolidBrush br(Color(200, 255, 200, 255));\n    graphics.DrawString(L\"Hello\", -1, &font, pt, &br);\n}\n```\næ•ˆæœå¦‚ä¸‹ï¼š\n![](../../images/Windows_åŸºäºæ¨¡æ¿è®¾è®¡/image-20240729055923683.png)\n\n## ç±»è®¾è®¡\n\n1. ScoreManagerï¼šç§¯åˆ†ç®¡ç†\n2. SceneManagerï¼šæ¸¸æˆä¸»åœºæ™¯ç®¡ç†ï¼Œä¸»è¦ç®¡ç†ç”»é¢ä¸­çš„Character\n3. Characterï¼šå±å¹•ä¸Šæ˜¾ç¤ºçš„ä¸€ä¸ªä¸ªå­—ç¬¦\n4. InputManagerï¼šè¾“å…¥ç®¡ç†ï¼ŒåŒ…æ‹¬é”®ç›˜è¾“å…¥ã€æ‰‹æŸ„è¾“å…¥ã€ç½‘ç»œäº‹ä»¶\nnä¸ªCharacterå—1ä¸ªSceneManagerç®¡ç†ï¼Œè€ŒScoreManagerã€SceneManagerã€InputManagerä¸‰è€…å‡æœ‰å¯èƒ½ç›¸äº’é€šä¿¡ï¼Œå¦‚æœç›´æ¥é¢å‘å…·ä½“çš„å¯¹è±¡è¿›è¡Œç¼–ç¨‹ï¼Œæ˜¯ä¸ç¬¦åˆä¾èµ–å€’è½¬åŸåˆ™ã€è¿ªç±³ç‰¹åŸåˆ™çš„ã€‚åº”è¯¥è®¾è®¡æŠ½è±¡çš„æ¥å£ï¼Œä½¿è¿™ä¸‰è€…é€šè¿‡æ¥å£è¿›è¡Œè”ç³»ã€‚\n![](../../images/Windows_åŸºäºæ¨¡æ¿è®¾è®¡/image-20240713062352836.png)\n\næ€»ä½“çš„æµç¨‹ï¼š\n1. ScoreManagerã€SceneManageråœ¨Publisherå¤„è®¢é˜…æ¶ˆæ¯ã€‚publisherå°†å…¶åŠ å…¥è®°å½•ã€‚\n2. InputManageræ˜¯Publisherã€‚InputManagerä¾èµ–Characterï¼Œç®¡ç†ã€ç”Ÿæˆç€CharacterArgã€‚\n3. å½“Windowsç³»ç»Ÿç›‘å¬åˆ°æŒ‰é”®åï¼Œè°ƒç”¨InputManagerçš„`key_down`ï¼Œå³è¢«è§¦å‘æ¿€æ´»ï¼ŒInputManageråŒ…è£…æ¶ˆæ¯ã€å†…å®¹ï¼ˆé”®å­—æ¯ï¼‰æ‰“åŒ…ç»™å¯¹åº”çš„ç›‘å¬è€…å¹¶notifyï¼Œå³è°ƒç”¨å…¶updateã€‚\n4. å„è‡ªå¤„ç†æ¶ˆæ¯ã€‚\n\næ¶ˆæ¯ç±»å‹ï¼š\n1. æŒ‰ä¸‹å­—ç¬¦æ¶ˆæ¯\n2. åŠ åˆ†æ¶ˆæ¯\n3. å­—ç¬¦æ­»äº¡æ¶ˆæ¯ï¼ˆå­—ç¬¦è½åˆ°åº•çº¿ï¼‰\n4. æ›´æ–°ç”»é¢æ¶ˆæ¯\n5. æ–°çš„å­—ç¬¦ç”Ÿæˆæ¶ˆæ¯\n## è§‚å¯Ÿè€…æ¨¡å¼\n\nå³é”®é¡¹ç›®åç§°ï¼ŒAdd New Filterï¼Œå–å`Typist Game`ã€‚åœ¨æ­¤Filterä¸‹æ–°å»º`IListener.h`ç­‰æ–‡ä»¶ã€‚\n### IArgument\nIArgumentæ¥å£ç±»è§„èŒƒï¼šæ¯ä¸ªArgumentç±»éƒ½è¦å®ç°å¯¹å¤–å®ç°ä¸€ä¸ª`publisher`æ¥å£ï¼Œè¯¥æ¥å£ä¸»è¦ç”¨äºå¤–éƒ¨è·å–å½“å‰Argumentçš„æ¶ˆæ¯æ¥æºã€‚\n\nArgument ç±»çš„ä½œç”¨ï¼šç”¨äºIListenerä¸­updateæ¥å£ä¸­å‚æ•°2åŒ…è£…æ¶ˆæ¯ã€‚\n\nè¯¥æ–‡ä»¶è¿˜å®šä¹‰äº†æ¶ˆæ¯ç±»å‹ï¼Œä»¥æšä¸¾ç±»å®ç°ã€‚\n```cpp\n// IArgument.h\n// ...\nnamespace typist\n{\nclass IPublisher;\nclass IArgument\n{\npublic:\n    // æ¶ˆæ¯æ¥æº\n    virtual IPublisher* publisher(void) const = 0;\n};\n\nenum class TPMSG\n{\n    Character,\n    IncreaseScore,\n    Stop,\n    Update,\n    Generate\n};\n}\n```\n### IListener\næ€»è§ˆ\n```cpp\n// IListener.h\n#pragma once\nnamespace typist\n{\n    // Typist Messages\n    enum TPMSG\n    {\n        // ...\n    };\n\n    // incomplete type claim\n    class IPublisher;\n\n    class Argument\n    {\n        // ...\n    };\n    \n    class IListener\n    {\n        // ...\n    };\n}\n```\n#### updateæ¥å£\n```cpp\n// IListener.h\n// ...\n#include <memory>\n#include \"IArgument.h\"\nclass IListener\n{\npublic:\n    // å“åº”äº‹ä»¶\n    // å‚æ•°1: äº‹ä»¶ç±»å‹  å‚æ•°2: äº‹ä»¶æ‰€æºå¸¦çš„å†…å®¹\n    virtual bool update(TPMSG msg, std::shared_ptr<IArgument> arg) = 0;\n};\n```\n### IPublisher\nåœ¨Typist Gameä¸‹åˆ›å»º`IPubilisher.h`\næ€»è§ˆï¼š\n```cpp\n// IPublisher.h\n#pragma once\n\nnamespace typist\n{\n    class IPublisher\n    {\n        // ...\n    };\n}\n```\n#### æ¥å£\n```cpp\n// IPublisher.h\n// ...\n\n#include \"IListener.h\"\nclass IPublisher\n{\npublic:\n    // å‚æ•°1: å…³æ³¨å“ªä¸ªæ¶ˆæ¯\n    virtual void add_listener(TPMSG msg, std::shared_ptr<IListener> listener) = 0;\n    virtual void remove_listener(TPMSG msg, std::shared_ptr<IListener> listener) = 0;\n    virtual void notify(TPMSG msg) = 0;\n};\n```\n### InputManager\nInputManageræ˜¯ä¸€ä¸ªä¿¡æ¯å‘å¸ƒè€…ã€‚æ‰€ä»¥éœ€è¦å¼•å…¥`IPublisher.h`å¹¶ä¸”ç»§æ‰¿ï¼ˆå®ç°æ¥å£ï¼‰ã€‚\n```cpp\n// InputMgr.h\n#pragma once\n\n#include \"IPublisher.h\"\nnamespace typist\n{\n    class InputMgr : IPublisher\n    {\n        // ...\n    };\n}\n```\n#### å•ä¾‹æ¨¡å¼\nInputMgræ•´ä¸ªç³»ç»Ÿåªéœ€ä¸€ä¸ªï¼Œåº”ç”¨å•ä¾‹æ¨¡å¼ã€‚\n```cpp\n// InputMgr.h\n// ...\nclass InputMgr : IPublisher\n{\npublic:\n    static std::shared_ptr<InputMgr> instance_ptr(void);\n    static InputMgr& instance(void);\n    static void destroy_instance(void);\nprivate:\n    InputMgr();\n    InputMgr(InputMgr const&) = delete;\n    InputMgr(InputMgr&&) noexcept = delete;\n    ~InputMgr();\n    static void delete_self(InputMgr* p);\nprivate:\n    static std::shared_ptr<InputMgr> _input_mgr;\n};\n```\n#### å®ç°IPublisheræ¥å£\n\nè§£å†³å®Œå•ä¾‹çš„ç‰¹æ€§ï¼Œæ¥çœ‹InputMgrä½œä¸ºä¸€ä¸ªPublisherçš„æœ¬èŒå·¥ä½œï¼šé¦–å…ˆéœ€è¦å®ç°IPublisherçš„æŠ½è±¡æ–¹æ³•ã€‚\n```cpp\n// InputMgr.h\n// ...\nclass InputMgr : IPublisher\n{\npublic:\n    // ...\n\n    // implementation of IPublisher\n    void add_listener(TPMSG msg, std::shared_ptr<IListener> listener) override;\n    void remove_listener(TPMSG msg, std::shared_ptr<IListener> listener) override;\n    void notify(TPMSG msg) override;\nprivate:\n    // ...\n};\n```\n<span id=\"jump\"></span>\nå…¶æ¬¡ï¼Œä¸€ä¸ªPublisheréœ€è¦æä¾›è®©å…¶ä»–äººè®¢é˜…çš„åŠŸèƒ½ï¼Œå› æ­¤è¦æä¾›ä¸€ä¸ªå®¹å™¨ï¼Œä¿å­˜Listenerçš„ä¿¡æ¯ã€‚\nä»¥æ¶ˆæ¯ä¸ºKeyï¼Œå¯¹åº”å¤šä¸ªListenerã€‚\n##### ä¸ºä»€ä¹ˆéœ€è¦weak_ptr\n1. æ€»ä½“ç”¨mapæ¥å°è£…ï¼Œå…¶ä¸­é”®ç”¨TPMSGæšä¸¾ç±»ï¼Œå€¼ç”¨listå®¹å™¨è£…ï¼Œä¸è¦ä½¿ç”¨`shared_ptr`è€Œæ˜¯ä½¿ç”¨`weak_ptr`ï¼Œå› ä¸ºListenerçš„ç”Ÿå‘½ä¸èƒ½ç”±Publisheråšä¸»ï¼ŒPublisheråªæ˜¯ä¸€ä¸ªé€šçŸ¥æ–¹ã€‚è¿™ä¸ªlistå®¹å™¨æ˜¯å¯¹å†…éƒ¨æä¾›çš„ã€‚ \n2. å¯¹å¤–éƒ¨ï¼Œéœ€è¦æä¾›ä¸€ä¸ªæ¿€æ´»å‡½æ•°ã€‚æ¯”å¦‚å¤–éƒ¨æ„ŸçŸ¥åˆ°æŒ‰ä¸‹é”®ç›˜åï¼Œå¤–éƒ¨è°ƒç”¨`key_down`å‡½æ•°ï¼Œç­‰äºé€šçŸ¥InputMgrï¼Œç„¶åï¼ŒInputMgrå°±è°ƒç”¨è‡ªå·±çš„notifyé€šçŸ¥å¯¹åº”çš„Listenerã€‚\n3. `_current_key`ç”¨äºè®°å½•ç›‘å¬åˆ°`key_down`æ—¶çš„ä¿¡æ¯ï¼Œä¹‹åç”¨äº`notify`ã€‚[ä¸ºä»€ä¹ˆéœ€è¦_current_key](#notifyå®ç°)\n```cpp\n// InputMgr.h\n// ...\n#include <map>\nclass InputMgr : IPublisher\n{\npublic:\n    // ...\n    void key_down(unsigned int key);\nprivate:\n    // ...\n    std::map<TPMSG, std::list<std::weak_ptr<IListener>>> _listeners;\n    unsigned int   _current_key;\n}\n```\n### InputManagerå®ç°\n`InputMgr.cpp`å»ºåœ¨ Filter `Typist Game`ä¸­ã€‚\n\nå•ä¾‹æ¨¡å¼çš„åˆ›å»ºã€é”€æ¯çš„å®ç°ç•¥ã€‚\n#### addã€remove listener\n`add_listener`è™½ç„¶å‚æ•°2æ˜¯å¼ºå…±äº«æŒ‡é’ˆï¼Œä½†ç»è¿‡éšå¼è½¬æ¢åï¼Œåˆ°äº†Publisherçš„`_listeners[msg]`å®¹å™¨ä¸­ï¼Œå°±æˆäº†å¼±æŒ‡é’ˆã€‚[ä¸ºä»€ä¹ˆéœ€è¦weak_ptr](#ä¸ºä»€ä¹ˆéœ€è¦weak_ptr)\n```cpp\n// InputMgr.cpp\n\n#include <algorithm>. // remove_if\n\nvoid typist::InputMgr::add_listener(\n    TPMSG msg, std::shared_ptr<IListener> listener)\n{\n    _listeners[msg].emplace_back(listener);\n}\n\nvoid typist::InputMgr::remove_listener(\n    TPMSG msg, std::shared_ptr<IListener> listener)\n{\n    auto it = _listeners.find(msg);\n    if (it != _listeners.end())\n    {\n        auto it2 = std::remove_if(\n            it->second.begin(),\n            it->second.end(),\n            [&listener](auto&& v) -> bool\n            {\n                return v.lock() == listener;\n            });\n\n        while (it2 != it->second.end())\n        {\n            it2 = it->second.erase(it2);\n        }\n    }\n}\n// ç¬¬2ç§å†™æ³•ï¼š\n    if (it != _listeners.end())\n    {\n        auto it2 = std::remove_if(\n            it->second.begin(),\n            it->second.end(),\n            [&listener](auto&& v) -> bool\n            {\n                return v.lock() == listener;\n            });\n\n        it->second.erase(it2, it->second.end());\n    }\n// ç¬¬3ç§å†™æ³•ï¼šï¼ˆC++20æ ‡å‡†ï¼Œç”¨åˆ°äº†rangesï¼‰\n    if (it != _listeners.end())\n    {\n        auto it2 = std::ranges::remove_if(\n            it->second,\n            [&listener](auto&& v) -> bool\n            {\n                return v.lock() == listener;\n            });\n        // errorï¼Œä¸è¡Œï¼Œä¸‹å»å¾—çœ‹çœ‹ä¸ºå•¥\n        it->second.erase(it2, it->second.end());\n    }\n```\n#### notifyå®ç°\n```cpp\nvoid typist::InputMgr::notify(TPMSG msg)\n{\n    auto it = _listeners.find(msg);\n    if (it == _listeners.end())\n        return;\n\n    std::shared_ptr<IArgument> arg;\n    if (msg == TPMSG::Character)\n    {\n        // æ­¤å¤„çš„_current_keyåœ¨key_downåå­˜å‚¨åˆ°æˆå‘˜å˜é‡ä¸­\n        arg.reset(new CharacterArg{ this, _current_key });\n    }\n    std::ranges::for_each(\n        it->second,\n        [&msg, arg](auto&& v) -> void\n        {\n            if (auto&& listener = v.lock())\n            {\n                listener->update(msg, arg);\n            }\n        });\n}\n```\n#### key_down\næœ¬æ–¹æ³•ç”±å¤–éƒ¨çš„çª—å£ç±»è°ƒç”¨ã€‚å½“çª—å£ç›‘å¬åˆ°é”®ç›˜æŒ‰ä¸‹çš„ç³»ç»Ÿæ¶ˆæ¯(OnKeyDown)æ—¶ï¼Œé€šè¿‡InputMgrçš„å•ä¾‹å¯¹è±¡æ¥è°ƒç”¨`key_down`ï¼Œå…·ä½“æ“ä½œæ˜¯è®¾ç½®`_current_key`ã€‚\nç„¶åçª—å£ç±»å†è°ƒç”¨InputMgrçš„notifyã€‚\n```cpp\nvoid typist::InputMgr::key_down(unsigned int key)\n{\n    _current_key = key;\n}\n```\n#### update_time\næˆå‘˜æ–¹æ³•ã€‚å¤„ç†Updateæ¶ˆæ¯ã€‚Updateæ¶ˆæ¯å¯¹åº”äºï¼šæ¯éš”2ç§’é’Ÿï¼Œæ¸¸æˆä¸»åœºæ™¯ä¸­çš„å­—æ¯è¦ä¸‹è½ã€‚\n```cpp\n// InputMgr.h\n// ...\nclass InputMgr : IPublisher\n{\npublic:\n    // ...\n    void update_time(void);\nprivate:\n    // ...\n}\n```\nå®ç°\n```cpp\nvoid typist::InputMgr::update_time(void)\n{\n    notify(TPMSG::Update);\n}\n```\nå¢è®¾notifyä¸­æ¶ˆæ¯çš„ifåˆ¤æ–­æ¡ä»¶ï¼š\n```cpp\nvoid typist::InputMgr::notify(TPMSG msg)\n{\n    // ...\n    if (/* ... */)\n    {\n        // ...\n    }\n    else if (msg == TPMSG::Update)\n    {\n        arg.reset(new UpdateArg{ this });\n    }\n    // ...\n}\n```\n#### generate_time\næˆå‘˜æ–¹æ³•ã€‚ç”¨äºå¤„ç†Generateæ¶ˆæ¯ï¼Œå¯¹åº”äºæ¯éš”å‡ ç§’ï¼Œäº§ç”Ÿæ–°çš„å­—ç¬¦çš„éœ€æ±‚ã€‚\n```cpp\n// InputMgr.h\n// ...\nclass InputMgr : IPublisher\n{\npublic:\n    // ...\n    void generate_time(void);\nprivate:\n    // ...\n}\n```\nå®ç°\n```cpp\nvoid typist::InputMgr::generate_time(void)\n{\n    notify(TPMSG::Generate);\n}\n```\nå¢è®¾notifyä¸­æ¶ˆæ¯çš„ifåˆ¤æ–­æ¡ä»¶ï¼š\n```cpp\nvoid typist::InputMgr::notify(TPMSG msg)\n{\n    // ...\n    if (/* ... */)\n    {\n        // ...\n    }\n    // ...\n    else if (msg == TPMSG::Generate)\n    {\n        arg.reset(new GenerateArg{ this });\n    }\n    // ...\n}\n```\n### CharacterArg\n```cpp\n// CharacterArg.h\n#pragma once\n#include \"IArgument.h\"\nnamespace typist\n{\n    class CharacterArg : public IArgument\n    {\n        // ...\n    };\n}\n```\nè‡ªå·±çš„ä¸œè¥¿ï¼šä¸€ä¸ªpublisheræŒ‡é’ˆï¼Œä¸€ä¸ªkey\n```cpp\n// CharacterArg.h\n\n// ...\n\nclass CharacterArg : public IArgument\n{\npublic:\n    CharacterArg(IPublisher* publisher, unsigned int key)\n        : _publisher{ publisher }, _key{ key }\n    {\n        \n    }\n    unsigned int key(void) const\n    {\n        return _key;\n    }\nprivate:\n    IPublisher*  _publisher;\n    unsigned int _key;\n};\n```\n\nè¿˜éœ€å®ç°IArgumentçš„æ¥å£ï¼špublisherï¼Œç”¨äºå¤–éƒ¨è·å–Argçš„ç§æœ‰å˜é‡`_publisher`ï¼Œå³è¯¥æ¶ˆæ¯çš„å‘å¸ƒè€…ã€‚[ä¸ºä»€ä¹ˆï¼ŸIArgument](#IArgument)\n```cpp\n// CharacterArg.h\n\n// ...\n\nclass CharacterArg : public Argument\n{\npublic:\n    // ...\n    IPublisher* publisher(void) const\n    {\n        return _publisher;\n    }\nprivate:\n    // ...\n};\n```\nè‡³æ­¤ï¼ŒCharacterArgå¯ä»¥è¢«åŒ…å«åœ¨InputMgrä¸­äº†\n### UpdateArg\nå¯¹åº”Updateæ¶ˆæ¯ã€‚ä¸»è¦ä½œç”¨æ˜¯ç”Ÿæˆä¸€ä¸ªå½“å‰çš„æ—¶é—´æˆ³ã€‚\n```cpp\n#include \"IArgument.h\"\nnamespace typist\n{\nclass UpdateArg : public IArgument\n{\npublic:\n    UpdateArg(IPublisher* publisher)\n        : _publisher{ publisher },\n          _tp{ std::chrono::high_resolution_clock::now() }\n    {\n    }\n    virtual IPublisher* publisher(void) const\n    {\n        return _publisher;\n    }\n    std::chrono::time_point<std::chrono::high_resolution_clock> time(void) const\n    {\n        return _tp;\n    }\nprivate:\n    IPublisher*     _publisher;\n    std::chrono::time_point<std::chrono::high_resolution_clock> _tp;\n};\n}\n```\n#### Modern Cppè¡¨è¾¾æ—¶é—´çš„æ–¹å¼\nç”±`<chrono>`åº“æä¾›ã€‚\nä¸»è¦æœ‰3ä¸ªæ¦‚å¿µï¼š\n1. Durationsï¼ˆæŒç»­æ—¶é—´ï¼‰ï¼šæ—¶é—´æ®µ\n2. Time pointsï¼ˆæ—¶é—´ç‚¹ï¼‰ï¼šæ—¶åˆ»ï¼Œä¸¤ä¸ªæ—¶åˆ»ç›¸å‡æ˜¯æ—¶é—´æ®µ\n3. Clocksï¼ˆæ—¶é’Ÿï¼‰ï¼šç”¨äºæŠŠæ—¶é—´ç‚¹å’Œç‰©ç†æ„ä¹‰ä¸Šçš„æ—¶é—´ç›¸å…³è”çš„æ¡†æ¶ã€‚æä¾›äº†3ä¸ªæ—¶é’Ÿï¼Œå¯ä»¥å°†å½“å‰æ—¶é—´è¡¨ç¤ºä¸º`time_point`\n    1. system_clockï¼ˆä»¥ç³»ç»Ÿçš„æ—¶é—´ä¸ºå‡†ï¼Œä½†æ˜¯å¦‚æœç³»ç»Ÿæ—¶é’Ÿè¢«æ”¹äº†ä¼šå¯¼è‡´ç¨‹åºé”™ä¹±ï¼‰\n    2. steady_clockï¼ˆä»¥ç¨‹åºè‡ªèº«çš„æ—¶é—´ä¸ºå‡†ï¼Œä¸æ˜“æ··ä¹±ï¼‰\n    3. high_resolution_clockï¼ˆæ¨èç”¨ï¼‰\n\n### GenerateArg\nå¯¹åº” Generate æ¶ˆæ¯ã€‚ä¸»è¦ä½œç”¨æ˜¯ç”Ÿæˆä¸€ä¸ªå½“å‰çš„æ—¶é—´æˆ³ã€‚\n```cpp\n#include \"IArgument.h\"\nnamespace typist\n{\nclass GenerateArg : public IArgument\n{\npublic:\n    GenerateArg(IPublisher* publisher)\n        : _publisher{ publisher }\n    {\n    }\n    virtual IPublisher* publisher(void) const\n    {\n        return _publisher;\n    }\nprivate:\n    IPublisher*     _publisher;\n};\n}\n```\n### Character ç±»ã€ChPoint ç±»\nCharacteråšå­—ç¬¦çš„æ¸²æŸ“å·¥ä½œã€‚\nChPointæ˜¯å­—ç¬¦çš„åæ ‡çš„å°è£…ã€‚\n```cpp\n// Character.h\n#include <gdiplus.h>\nnamespace typist\n{\nclass ChPoint\nclass Character\n{\npublic:\n    Character(wchar_t ch, int x, int y);\n    ChPoint xy(void) const;\n    void xy(ChPoint pt);\n    void render(Gdiplus::Graphics& graphics) const;\nprivate:\n    wchar_t _ch;\n    int     _x, _y; // pos\n};\n}\n```\nå®ç°\n```cpp\n// Character.cpp\ntypist::Character::Character(wchar_t ch, int x, int y)\n    : _x{ x }, _y{ y }, _ch{ ch }\n{\n}\ntypist::ChPoint typist::Character::xy(void) const\n{\n    return { _x, _y };\n}\nvoid typist::Character::xy(ChPoint pt)\n{\n    _x = pt._x;\n    _y = pt._y;\n}\n```\næ¸²æŸ“å®ç°ï¼š\nDrawStringå‚æ•°ï¼š\n1. å†…å®¹\n2. ç”»å¤šå°‘å†…å®¹ï¼ˆ-1ä»£è¡¨ä¸€ç›´ç”»åˆ°å­—ç¬¦ä¸²çš„`\\0`ï¼‰\n3. å­—ä½“çš„æŒ‡é’ˆ\n4. åæ ‡\n5. ç”»åˆ·çš„æŒ‡é’ˆ\n```cpp\nvoid typist::Character::render(Gdiplus::Graphics& graphics) const\n{\n    Gdiplus::FontFamily fontFamily(L\"Times New Roman\");\n    Gdiplus::Font font(&fontFamily, 18, Gdiplus::FontStyle::FontStyleBold, Gdiplus::UnitPoint);\n    Gdiplus::PointF pf(static_cast<float>(_x), static_cast<float>(_y));\n    Gdiplus::SolidBrush br(Color(200, 55, 100, 255));\n    graphics.DrawString(&_ch, 1, &font, pt, &br);\n}\n```\n### SceneManager åœºæ™¯ç±»\nåœºæ™¯ç®¡ç†ç±»ç”¨äºé‡ç»˜çª—å£ã€ç›¸åº”äº‹ä»¶ã€ç”»å›¾å½¢ã€‚\n\n`SceneMgr.h`å»ºåœ¨Filter `Typist Game`ä¸­ã€‚\n```cpp\n#include<gdiplus.h>\n#include \"IListener.h\"\nnamespace typist\n{\nclass Character;\nclass UpdateArg;\nclass GenerateArg;\nclass SceneMgr : public IListener\n{\npublic:\n    SceneMgr();\n    ~SceneMgr();\n    void render(Graphics& graphics) const;\n    // implementation for IListener\n    bool update(TPMSG msg, std::shared_ptr<IArgument> arg) override;\n\nprivate:\n    void on_update(std::shared_ptr<UpdateArg> arg);\n    void on_generate(std::shared_ptr<UpdateArg> arg);\n\nprivate:\n    std::list<std::shared_ptr<Character>> _chs;\n};\n}\n```\nå®ç°\n`SceneMgr.cpp`å»ºåœ¨Filter `Typist Game`ä¸­ã€‚\n```cpp\n#include \"SceneMgr.h\"\n#include \"Character.h\"\n#include \"UpdateArg.h\"\n#include \"GenerateArg.h\"\n#include <algorithm>\n#include <ranges> \ntypist::SceneMgr::SceneMgr()\n{\n    srand(time(NULL));\n}\ntypist::SceneMgr::~SceneMgr()\n{\n}\nvoid typist::SceneMgr::render(Graphics& graphics) const\n{\n    std::ranges::for_each(_chs, [&graphics](auto&& ch) -> void\n        {\n            ch->render(graphics);\n        });\n}\n\nbool ypist::SceneMgr::update(TPMSG msg, std::shared_ptr<IArgument> arg)\n{\n    if (msg == TPMSG::Update)\n    {\n        on_update(std::dynamic_pointer_cast<UpdateArg>(arg));\n        return true;\n    }\n    else if (msg == TPMSG::Generate)\n    {\n        on_generate(std::dynamic_pointer_cast<GenerateArg>(arg));\n    }\n    return false;\n}\n// privateå†…éƒ¨è°ƒç”¨çš„æ–¹æ³•å¯ä»¥å†™ä¸ºinlineçš„\ninline void typist::SceneMgr::on_update(std::shared_ptr<UpdateArg> arg)\n{\n    std::ranges::for_each(_chs, [](auto&& ch) -> void\n        {\n            // structured binding\n            auto && [x, y] = ch->xy();\n            ch->xy({ x, y + 5 });\n        });\n}\n// ä½¿ç”¨åˆ°éšæœºæ•°ï¼Œéšæœºç§å­åœ¨æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–ã€‚\ninline void typist::SceneMgr::on_generate(std::shared_ptr<UpdateArg> arg)\n{\n    _chs.emplace_back(\n        std::shared_ptr<Character>(\n            new Character('A' + rand() % 26, rand() % 500, -20)));\n}\n```\n#### æŠ€æœ¯ç‚¹\n1. privateå†…éƒ¨è°ƒç”¨çš„æ–¹æ³•å¯ä»¥å†™ä¸ºinlineçš„\n2. ä¸€èˆ¬ç”¨`dynamic_cast`è½¬æ¢å¤šæ€æŒ‡é’ˆã€‚ä½†æ˜¯å¦‚æœæ¶‰åŠåˆ°äº†æ™ºèƒ½æŒ‡é’ˆï¼Œå¦‚ä¸Šè¿°ä»£ç ä¸­çš„`update`æ–¹æ³•ä¸­`shared_ptr<IArgument> arg`ï¼Œåˆ™æˆ‘ä»¬çš„ç›®çš„æ˜¯è½¬æ¢æ™ºèƒ½æŒ‡é’ˆåŒ…å«çš„å†…å®¹ã€‚æ­¤æ—¶æœ‰å¯¹åº”çš„`std::dynamic_pointer_cast<T>`ã€‚æ¨¡æ¿å‚æ•°å¡«å†™è¦è½¬æ¢çš„å­ç±»å‹ã€‚\n```cpp\nstd::dynamic_pointer_cast<UpdateArg>(arg)\n```\n3. ç»“æ„åŒ–ç»‘å®šï¼šèƒ½æŠŠkeyå’Œvalueåˆ†å¼€æå–ï¼šå«åšç»“æ„åŒ–ç»‘å®šï¼ˆstructured bindingï¼‰[Cpp_STL_å…³è”å®¹å™¨](../Cpp/Cpp_STL_å…³è”å®¹å™¨.md)\n### TypistWindowç¼–å†™\n#### å¯¹SceneMgrçš„å¤„ç†\n```cpp\n// TypistWindow.h\n\n#include <memory>\n#include <string>\n#include \"QuickGeometryUI.hpp\"\nnamespace typist\n{\nclass SceneMgr;\n\n// ...\n\nclass TypistCentralBox : public harbin::GeometryBox<TypistFrame, TypistCentralBox>\n{\npublic:\n    // ...\nprivate:\n    std::shared_ptr<SceneMgr> _scene_mgr;\n}\n}\n```\næ„é€ å‡½æ•°åˆå§‹åŒ–`_scene_mgr`ï¼š\n```cpp\n// TypistWindow.cpp\ntypist::TypistCentralBox::TypistCentralBox(TypistFrame* frame, std::wstring const& name)\n    : GeometryBox{ frame, name.c_str() }\n{\n    _scene_mgr = std::shared_ptr<SceneMgr>(new SceneMgr);\n}   \n```\nOnPaintå®ç°ï¼š\n```cpp\ntypist::TypistCentralBox::OnPaint(Graphics& graphics, HDC hDC, PAINTSTRUCT* pPS, bool bDragRepaint/* = false */)\n{\n    if (_scene_mgr)\n    {\n        _scene_mgr->render(graphics);\n    }\n}\n```\n#### å¯¹InputMgrçš„å¤„ç†\næ„é€ å‡½æ•°ä¸­è®¢é˜…InputMgrï¼š\n```cpp\n// TypistWindow.cpp\ntypist::TypistCentralBox::TypistCentralBox(TypistFrame* frame, std::wstring const& name)\n    : GeometryBox{ frame, name.c_str() }\n{\n    // ...\n        \n    InputMgr::instance_ptr()->add_listener(TPMSG::Generate, _scene_mgr);\n    InputMgr::instance_ptr()->add_listener(TPMSG::Update, _scene_mgr);\n    \n}   \n```\nææ„å‡½æ•°ä¸­æ³¨é”€è®¢é˜…InputMgrï¼š\n```cpp\ntypist::TypistCentralBox::~TypistCentralBox()\n{\n    if (_scene_mgr)\n    {\n        InputMgr::instance_ptr()->remove_listener(TPMSG::Generate, _scene_mgr);\n        InputMgr::instance_ptr()->remove_listener(TPMSG::Update, _scene_mgr);\n    }\n}\n```\n#### å®šæ—¶å™¨\nå®šæ—¶å™¨çš„åŠŸèƒ½ç»§æ‰¿äºåŸºç±»`GeometryBox`\n```cpp\n// TypistWindow.h\nclass TypistCentralBox : public harbin::GeometryBox<TypistFrame, TypistCentralBox>\n{\npublic:\n    // ...\n    void OnTimer(int iIdentifier);\nprivate:\n    // ...\n}\n```\næ„é€ å‡½æ•°ä¸­SetTimerï¼š\n1. å‚æ•°1æ˜¯IDå·ï¼Œå®å®šä¹‰ç»™å‡º\n2. å‚æ•°2æ˜¯intervalï¼Œé—´éš”å¤šä¹…æ›´æ–°ä¸€æ¬¡ï¼Œå•ä½ä¸ºms\n```cpp\n// TypistWindow.cpp\n\n#define UPDATE_TIMER_ID   10\n#define GENERATE_TIMER_ID 11\n\ntypist::TypistCentralBox::TypistCentralBox(TypistFrame* frame, std::wstring const& name)\n    : GeometryBox{ frame, name.c_str() }\n{\n    // ...\n        \n    SetTimer(UPDATE_TIMER_ID, 500);   // 500msåˆ·æ–°ä¸€æ¬¡\n    SetTimer(GENERATE_TIMER_ID, 3000);// 3s äº§ç”Ÿä¸€ä¸ªå­—ç¬¦\n    \n}   \n```\nææ„å‡½æ•°ä¸­ KillTimerï¼š\n```cpp\ntypist::TypistCentralBox::~TypistCentralBox()\n{\n    KillTimer(UPDATE_TIMER_ID);\n    KillTimer(GENERATE_TIMER_ID);\n    // ...\n}\n```\nå®ç°OnTimerï¼š\n1. å¤„ç†TIMERï¼Œè¿›è¡Œnotifyç›¸åº”çš„æ¶ˆæ¯\n2. ReDrawBoxé‡ç»˜ï¼Œæ˜¯åŸºç±»çš„æ–¹æ³•\n```cpp\nvoid typist::TypistCentralBox::OnTimer(int iIdentifier)\n{\n    switch (iIdentifier)\n    {\n    case UPDATE_TIMER_ID:\n        InputMgr::instance_ptr()->notify(TPMSG::Update);\n        ReDrawBox();\n        break;\n    case GENERATE_TIMER_ID:\n        InputMgr::instance_ptr()->notify(TPMSG::Generate);\n        ReDrawBox();\n        break;\n    default:\n        break;\n    }\n}\n```","categories":["è®¾è®¡æ¨¡å¼","Windows"]},{"title":"Cpp_æ‹¼æ¥å­—ç¬¦ä¸²çš„å‡ ç§æ–¹æ³•ï¼ˆformatï¼‰","url":"/Cpp/Cpp_æ‹¼æ¥å­—ç¬¦ä¸²çš„å‡ ç§æ–¹æ³•ï¼ˆformatï¼‰/","content":"\n```cpp\n{\n    case WM_LBUTTONDOWN:\n    {\n        int x_coord = lparam & 0xffff;\n        int y_coord = lparam >> 16;\n        // æ‹¼æ¥xã€yï¼Œæœ€åæ•ˆæœï¼š\"x, y\"\n    }\n}\n```\n# Cé£æ ¼ï¼šswprintf\nä½¿ç”¨Cè¯­è¨€çš„`wchar_t`å®½å­—ç¬¦æ•°ç»„ï¼ŒåŠ ä¸Šswprintf\n```cpp\n{\n    {\n        // ...\n        wchar_t text[50] = L\"\";\n        swprintf(text, 50, L\"%i, %i\", x_coord, y_coord);\n    }\n}\n```\n# stringé£æ ¼\nä½¿ç”¨`C++`çš„stringåº“\n```cpp\n{\n    {\n        // ...\n        std::wstring text;\n        text += std::to_wstring(x_coord);\n        text += L\", \";\n        text += std::to_wstring(y_coord);\n    }\n}\n```\n# æµå¼é£æ ¼\nä½¿ç”¨`C++`çš„æµå¼IO\n```cpp\n{\n    {\n        // ...\n        std::wstringstream wss;\n        wss << x_coord << L\", \" << y_coord;\n    }\n}\n```\n# formatåº“\nä½¿ç”¨`C++`çš„formatåº“ï¼Œformatæ˜¯`C++20`æ ‡å‡†åº“å¼•å…¥çš„ã€‚ç±»ä¼¼äºCè¯­è¨€çš„æ ‡å‡†æ ¼å¼åŒ–è¾“å‡ºã€‚[std::format - cppreference.com](https://en.cppreference.com/w/cpp/utility/format/format)ã€‚ç›¸åº”åœ°ï¼Œç»™å‡ºäº†æ ‡å‡†æ ¼å¼åŒ–è§„æ ¼ï¼š[Standard format specification - cppreference.com](https://en.cppreference.com/w/cpp/utility/format/spec)\n```cpp\n{\n    {\n        // ...\n        std::wstring text = std::format(L\"{0}, {1}\", x_coord, y_coord);\n    }\n}\n```\nç›¸å½“äºç”¨å¤§æ‹¬å·æ›¿ä»£äº†Cè¯­è¨€æ ¼å¼åŒ–è¾“å‡ºä¸­çš„`%?`ã€‚\n```cpp\n#include <format>\n#include <iostream>\nint main()\n{\n    std::cout << std::format(\"{} {}!\", \"Hello\", \"world\", \"something\");\n}\n```\nå¦‚æœéœ€è¦æ§åˆ¶æ ¼å¼åŒ–è¾“å‡ºï¼ˆå³åé¢æœ‰ä¸€äº›å¯å˜å‚æ•°ï¼‰ï¼Œå¤§æ‹¬å·æ˜¯å¿…é¡»è¦å†™ã€‚å®ƒæ˜¯å ä½çš„ï¼Œè€Œå¤§æ‹¬å·é‡Œé¢çš„å†…å®¹æœ‰å¯é€‰çš„å†…å®¹ï¼Œå…·ä½“å‚è€ƒ[std::format](https://en.cppreference.com/w/cpp/utility/format/format)ä¸­fmtå‚æ•°çš„replacement fieldsï¼š\n1. `{ arg-id (optional) }`\n    1. replacement field without a format specification\n2. `{ arg-id (optional) : format-specification }`\n    1. replacement field with a format specification\n\n`arg-id`: specifies the index of the argument inÂ `args`Â whose value is to be used for formatting; if it is omitted, the arguments are used in order. TheÂ arg-idâ€Šï»¿s in a format string must all be present or all be omitted. Mixing manual and automatic indexing is an error.\n\n`format-spec`: the format specification defined by theÂ `std::formatter`Â specialization for the corresponding argument. Cannot start withÂ `}`.\n\næœ‰å¾ˆå¤šformat specificationï¼š\n![](../../images/Cpp_æ‹¼æ¥å­—ç¬¦ä¸²çš„å‡ ç§æ–¹æ³•ï¼ˆformatï¼‰/image-20240827042103155.png)\nè¿™é‡Œé‡ç‚¹çœ‹ä¸€ä¸‹[standard format specification](https://en.cppreference.com/w/cpp/utility/format/spec \"cpp/utility/format/spec\")ï¼š\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œcppreferenceæ‰¿è®¤äº†Standard format specificationåŸºäºPythonä¸­çš„æ ¼å¼è§„èŒƒï¼Œä¾›åŸºæœ¬ç±»å‹å’Œå­—ç¬¦ä¸²ç±»å‹ä½¿ç”¨ã€‚\n## æ ¼å¼è§„èŒƒ\næ ¼å¼è§„èŒƒçš„è¯­æ³•æ˜¯ï¼šï¼ˆä¸åŒæ§åˆ¶é¡¹ä»¥ç©ºæ ¼ä¸ºé—´éš”ï¼›æ¯ä¸€é¡¹éƒ½æ˜¯optionalï¼‰\n```\nfill-and-alignâ€Šï»¿Â signÂ #Â 0Â widthÂ precisionÂ LÂ type\n```\nå…¶ä¸­`sign`ã€Â `#`å’ŒÂ `0`Â é€‰é¡¹ä»…åœ¨ä½¿ç”¨æ•´æ•°æˆ–æµ®ç‚¹è¡¨ç¤ºç±»å‹æ—¶æœ‰æ•ˆã€‚\n### fill-and-align\nå¡«å……å’Œå¯¹é½\n\nå¯ä»¥å¡«å¯é€‰çš„`fillï¼ˆå¡«å……ï¼‰å­—ç¬¦`ï¼ˆ`'{'`Â æˆ–Â `'}'`Â ä»¥å¤–çš„ä»»ä½•å­—ç¬¦ï¼‰ï¼Œåè·Ÿä¸€ä¸ª`alignï¼ˆå¯¹é½ï¼‰`é€‰é¡¹Â `<`Â ï¼ŒÂ `>`Â ï¼ŒÂ `^`Â ã€‚\n* å¡«å……å­—ç¬¦éœ€è¦æ³¨æ„ï¼š\n    1. å¦‚æœæœªæŒ‡å®šå¡«å……å­—ç¬¦ï¼Œåˆ™é»˜è®¤ä¸ºç©ºæ ¼å­—ç¬¦ã€‚\n    2. å¡«å……å­—ç¬¦å¿…é¡»å¯¹åº”äºå•ä¸ªUnicodeæ ‡é‡å€¼ã€‚\n* å¯¹é½é€‰é¡¹éœ€è¦æ³¨æ„ï¼š\n    1. `<`Â : é€šè¿‡åœ¨æ ¼å¼åŒ–å‚æ•°åæ’å…¥nä¸ªå¡«å……å­—ç¬¦ï¼Œå¼ºåˆ¶æ ¼å¼åŒ–å‚æ•°ä¸å¯ç”¨ç©ºé—´çš„å¼€å¤´å¯¹é½ã€‚å¦‚æœä½¿ç”¨éæ•´æ•°éæµ®ç‚¹è¡¨ç¤ºç±»å‹æ—¶ï¼Œæ­¤ä¸ºé»˜è®¤é€‰é¡¹ï¼ˆ`<`ï¼‰ã€‚\n        1. ä¸€å¥è¯è¯´ï¼šå¡«å……å­—ç¬¦å¡«å……åˆ°å³è¾¹\n    2. `>`Â : é€šè¿‡åœ¨æ ¼å¼åŒ–å‚æ•°ä¹‹å‰æ’å…¥nä¸ªå¡«å……å­—ç¬¦ï¼Œå¼ºåˆ¶æ ¼å¼åŒ–å‚æ•°ä¸å¯ç”¨ç©ºé—´çš„æœ«å°¾å¯¹é½ã€‚ä½¿ç”¨æ•´æ•°æˆ–æµ®ç‚¹è¡¨ç¤ºç±»å‹æ—¶ï¼Œæ­¤ä¸ºé»˜è®¤é€‰é¡¹ã€‚\n        1. ä¸€å¥è¯è¯´ï¼šå¡«å……å­—ç¬¦å¡«å……åˆ°å·¦è¾¹\n    3. `^`ï¼šé€šè¿‡åœ¨æ ¼å¼åŒ–å‚æ•°å‰é¢æ’å…¥`âŒŠ n/2 âŒ‹`ï¼ˆå‘ä¸‹å–æ•´ï¼‰ä¸ªå­—ç¬¦ï¼Œåœ¨æ ¼å¼åŒ–å‚æ•°åé¢æ’å…¥` âŒˆ n / 2 âŒ‰`ï¼ˆå‘ä¸Šå–æ•´ï¼‰ä¸ªå­—ç¬¦æ¥å¼ºåˆ¶æ ¼å¼åŒ–å‚æ•°åœ¨å¯ç”¨ç©ºé—´å†…å±…ä¸­ã€‚\n        1. ä¸€å¥è¯è¯´ï¼šå¡«å……å­—ç¬¦å¡«å……åˆ°ä¸¤è¾¹ï¼Œå¡«å……å¥‡æ•°ä»½æ—¶ï¼Œå·¦æ¯”å³å°‘1ä¸ªã€‚\n\nç¤ºä¾‹ï¼š\n```cpp\nchar c = 120;\nstd::format(\"{:6}\", 42);    // value of s0 is \"    42\"\nstd::format(\"{:>6}\", 42);   // value of s0 is \"    42\"\nstd::format(\"{:6}\", 'x');   // value of s1 is \"x     \"\nstd::format(\"{:<6}\", 'x');  // value of s1 is \"x     \"\nstd::format(\"{:*<6}\", 'x'); // value of s2 is \"x*****\"\nstd::format(\"{:*>6}\", 'x'); // value of s3 is \"*****x\"\nstd::format(\"{:*^6}\", 'x'); // value of s4 is \"**x***\"\nstd::format(\"{:6d}\", c);    // value of s5 is \"   120\"\nstd::format(\"{:6}\", true);  // value of s6 is \"true  \"\n```\n### `sign`, `#`, `0`\n\n`sign`é€‰é¡¹å¯ä»¥æ˜¯ä»¥ä¸‹é€‰é¡¹ä¹‹ä¸€ï¼š\n- `+`Â : è¡¨ç¤ºå¯¹äºéè´Ÿæ•°å’Œè´Ÿæ•°éƒ½æ˜¾ç¤ºç¬¦å·ã€‚å¯¹äºéè´Ÿæ•°ï¼Œåœ¨è¾“å‡ºå€¼ä¹‹å‰æ’å…¥Â `+`Â ç¬¦å·ã€‚\n- `-`Â : ä»…è´Ÿæ•°æ˜¾ç¤ºç¬¦å· (è¿™æ˜¯é»˜è®¤çš„signå€¼)ã€‚\n- `ç©ºæ ¼`: éè´Ÿæ•°å‰é¢æ˜¾ç¤ºå‰å¯¼ç©ºæ ¼ä½ï¼Œè´Ÿæ•°æ˜¾ç¤ºè´Ÿå·ã€‚\n\nè¦æ³¨æ„ï¼š\n1. è´Ÿé›¶è¢«è§†ä¸ºè´Ÿæ•°ã€‚\n2. signé€‰é¡¹ä¹Ÿé€‚ç”¨äºæµ®ç‚¹æ— ç©·å¤§å’ŒNaNã€‚\n\n`#`å’Œ`0`æš‚ç•¥ã€‚\n### width and precision\nå®½åº¦å’Œç²¾åº¦\n\nwidthæ˜¯æ­£åè¿›åˆ¶æ•°æˆ–åµŒå¥—æ›¿æ¢å­—æ®µ ( `{}` æˆ– `{ n }` )ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™å®ƒæŒ‡å®šæœ€å°å­—æ®µå®½åº¦ã€‚\n\nprecisionæ˜¯ä¸€ä¸ªç‚¹ ( `.` )åè·Ÿä¸€ä¸ªéè´Ÿçš„åè¿›åˆ¶æ•°æˆ–åµŒå¥—çš„æ›¿æ¢å­—æ®µã€‚æ­¤å­—æ®µæŒ‡ç¤ºç²¾åº¦æˆ–æœ€å¤§å­—æ®µå¤§å°ã€‚å®ƒåªèƒ½ç”¨äºæµ®ç‚¹å’Œå­—ç¬¦ä¸²ç±»å‹ã€‚\n* å¯¹äºæµ®ç‚¹ç±»å‹ï¼Œæ­¤å­—æ®µæŒ‡å®šæ ¼å¼ç²¾åº¦ã€‚\n* å¯¹äºå­—ç¬¦ä¸²ç±»å‹ï¼Œå®ƒä¸ºè¦å¤åˆ¶åˆ°è¾“å‡ºçš„å­—ç¬¦ä¸²çš„å‰ç¼€çš„ä¼°è®¡å®½åº¦ (è§ä¸‹æ–‡) æä¾›äº†ä¸Šé™ã€‚å¯¹äºUnicodeç¼–ç çš„å­—ç¬¦ä¸²ï¼Œè¦å¤åˆ¶åˆ°è¾“å‡ºçš„æ–‡æœ¬æ˜¯æ•´ä¸ªæ‰©å±•å­—å½¢ç°‡ï¼ˆextended grapheme clustersï¼‰çš„æœ€é•¿å‰ç¼€ï¼Œå…¶ä¼°è®¡å®½åº¦ä¸å¤§äºç²¾åº¦ã€‚\n\næ³¨æ„ï¼š\n1. å¦‚æœåµŒå¥—æ›¿æ¢å­—æ®µç”¨äºå®½åº¦æˆ–ç²¾åº¦ï¼Œè€Œç›¸åº”çš„å‚æ•°ä¸æ˜¯æ•´æ•°ç±»å‹ï¼ˆç›´åˆ°`C++23`ï¼‰ã€æ ‡å‡†æœ‰ç¬¦å·æˆ–æ— ç¬¦å·æ•´æ•°ç±»å‹ï¼ˆä»`C++23`å¼€å§‹ï¼‰ï¼Œæˆ–è€…å®ƒæ˜¯è´Ÿæ•°ï¼Œåˆ™ä¼šæŠ›å‡º`std::format_error`ç±»å‹çš„å¼‚å¸¸ã€‚\n2. å­—ç¬¦ä¸²çš„å®½åº¦è¢«å®šä¹‰ä¸ºé€‚äºåœ¨ç»ˆç«¯ä¸­æ˜¾ç¤ºå®ƒçš„åˆ—ä½ç½®çš„ä¼°è®¡æ•°é‡ã€‚\n![](../../images/Cpp_æ‹¼æ¥å­—ç¬¦ä¸²çš„å‡ ç§æ–¹æ³•ï¼ˆformatï¼‰/image-20240827053920009.png)\n\nç¤ºä¾‹ï¼š\n```cpp\nfloat pi = 3.14f;\ns1 = std::format(\"{:10f}\", pi);           // s1 = \"  3.140000\" (width = 10)\ns2 = std::format(\"{:{}f}\", pi, 10);       // s2 = \"  3.140000\" (width = 10)\ns3 = std::format(\"{:.5f}\", pi);           // s3 = \"3.14000\" (precision = 5)\ns4 = std::format(\"{:.{}f}\", pi, 5);       // s4 = \"3.14000\" (precision = 5)\ns5 = std::format(\"{:10.5f}\", pi);         // s5 = \"   3.14000\"\n                                               // (width = 10, precision = 5)\ns6 = std::format(\"{:{}.{}f}\", pi, 10, 5); // s6 = \"   3.14000\"\n                                               // (width = 10, precision = 5)\n \nb1 = std::format(\"{:{}f}\", pi, 10.0);     // throws: width is not of integral type \nb2 = std::format(\"{:{}f}\", pi, -10);      // throws: width is negative\nb3 = std::format(\"{:.{}f}\", pi, 5.0);     // throws: precision is not of integral type\n```\n# print println\nè¿™æ˜¯`C++23`å¼•å…¥çš„ã€‚\nä¸å¸¦æµå‚æ•°çš„ï¼Œåœ¨`<print>`åº“ä¸­å®šä¹‰ã€‚\nå¸¦æµå‚æ•°çš„ï¼Œåœ¨`<ostream>`åº“ä¸­å®šä¹‰ã€‚\n\n```cpp\nprint(\"Hello, {}!\\n\", \"world\");\n// ç­‰ä»·äº\nprintln(\"Hello, {}!\", \"world\");\nprint(stdout, \"Hello, {}!\\n\", \"world\");\nprintln(stdout, \"Hello, {}!\", \"world\");\n```\nä½†æ˜¯ï¼Œæˆªæ­¢2025å¹´8æœˆ27æ—¥ï¼Œprintè¿˜ä¸æ”¯æŒè¾“å‡ºå®½å­—ç¬¦ã€‚","categories":["Cpp","Modern"]},{"title":"Windows_Handle_è°ƒç”¨æ–¹å¼","url":"/Windows/Windows_Handle_è°ƒç”¨æ–¹å¼/","content":"# å¥æŸ„çš„å®ç°\n\nä»¥HWNDä¸ºä¾‹ã€‚\n\n```cpp\nDECLARE_HANDLE      (HWND);\n```\n\n```cpp\n#define DECLARE_HANDLE(name)\nstruct name##__{\n    int unused;\n};\ntypedef struct name##__ *name\n```\nä»¥ä¸Šæ˜¯å¸¦å‚æ•°çš„å®å®šä¹‰ï¼Œæ„å‘³ç€ï¼Œåé¢æ‰€æœ‰çš„â€œnameâ€å°†è¢«æ›¿æ¢ã€‚\n`##`æ˜¯ç²˜è¿ç¬¦å·ï¼Œä»¥åŒºåˆ†`\"name__\"`å’Œ`name + __`ï¼Œå³å¦‚æœä¸ç”¨ç²˜è¿ç¬¦å·ï¼Œå‡å¦‚åœ¨ç¨‹åºä¸­å†™`DECLARE_HANDLE(HWND)`æ—¶å°±æ— æ³•æ›¿æ¢nameäº†ï¼Œè€Œæ˜¯ç”Ÿæˆäº†`name__`ã€‚å¦‚æœæ­£ç¡®ç”¨ç²˜è¿ç¬¦å·ï¼Œé‚£ä¹ˆå°±ç”Ÿæˆ`HWND__`ã€‚\nå³ï¼š\n```cpp\nDECLARE_HANDLE(HWND);\n\n==ç­‰æ•ˆäº\n\nstruct HWND__{ int unused; };\ntypedef struct HWND__ * HWND;\n```\n\nå…¶ä¸­ï¼Œ`int unused;`ä»…ä½œä¸ºå ä½ç¬¦ï¼Œå³å«ç‰‡ã€‚å®é™…æ˜¯ä¸ä½¿ç”¨çš„ï¼Œå†…å®¹å€¼æ— æ„ä¹‰ã€‚ä¸»è¦æ¥å®šä¹‰ä¸€ä¸ªç±»å‹ï¼Œä½¿ç”¨å…¶ç±»å‹çš„æŒ‡é’ˆï¼Œä»¥é˜²æ­¢ä¸å…¶ä»–ç±»å‹çš„HANDLEæŒ‡é’ˆè¯¯äº’ç›¸èµ‹å€¼ã€‚\n\nç›¸ä¼¼åœ°ï¼ŒHDCï¼ˆHandle of Device Contextï¼‰ä¹Ÿæ˜¯ç”¨è¿™ä¸ªå®å®šä¹‰çš„ï¼Œåªæ˜¯ç±»å‹åä¸åŒã€‚\n\n# CALLBACK\n\n```cpp\n#define CALLBACK __stdcall\n```\n\nè°ƒç”¨æ–¹å¼æ˜¯åœ¨Cè¯­è¨€å±‚é¢ä¸Šçš„è¯é¢˜ï¼Œå’Œæ“ä½œç³»ç»Ÿæ˜¯æ— å…³çš„ï¼Œæ˜¯ç»™ç¼–è¯‘å™¨çš„æç¤ºã€‚\n\n`__stdcall`å’Œ`__cdecl`æ˜¯æœ‰ä¸»è¦åŒºåˆ«çš„ã€‚åœ¨å…¶ä»–ç¼–è¯‘å™¨ä¸‹ï¼Œå¯èƒ½æœ‰ä¸åŒçš„è®¾ç½®æ–¹æ³•ã€‚ä»`C++17`æ ‡å‡†åï¼Œå¯è®¾ç½®attributesï¼Œé€æ¸å˜ç»Ÿä¸€äº†ã€‚\nåœ¨MACç³»ç»Ÿä¸Šï¼Œå¸¸ç”¨çš„æ˜¯`__pascal`è°ƒç”¨æ–¹å¼ã€‚\n\n1. å‹æ ˆæ–¹å‘ä¸Šï¼Œ\n    1. CDECLæ˜¯ä»å³å‘å·¦å‹æ ˆ\n    2. PASCALæ˜¯ä»å·¦å‘å³å‹æ ˆ\n    3. STDCALLæ˜¯ä»å³å‘å·¦å‹æ ˆ\n2. CDECLçš„å«ä¹‰æ˜¯Cè¯­è¨€çš„è°ƒç”¨æ–¹å¼ï¼Œä¸ºäº†æ”¯æŒå¯å˜å‚æ•°ï¼Œç”±äºè¢«è°ƒç”¨è€…ä¸æ¸…æ¥šå‚æ•°æ•°ç›®ï¼Œå› æ­¤éœ€è¦è°ƒç”¨è€…æ¥æ¸…ç†æ ˆã€‚\n3. PASCALå’ŒSTDCALLä¹Ÿç§°ä¸ºå¿«é€Ÿè°ƒç”¨ã€‚å› ä¸ºåœ¨è¢«è°ƒç”¨è€…è¿”å›æ—¶ï¼Œé¡ºä¾¿ä¹Ÿä¼šæ¸…ç†æ ˆï¼Œæ•ˆç‡ç¨é«˜ã€‚\n    1. STDCALLä¸æ”¯æŒå¯å˜å‚æ•°ã€‚\n    2. CDECLæ”¯æŒå¯å˜å‚æ•°ï¼ˆå¦‚printfï¼‰ã€‚\n4. Windowsåˆšé¢ä¸–æ—¶ï¼Œåœ¨286çš„è®¡ç®—æœºå¹´ä»£ï¼Œä¸»é¢‘å¯èƒ½æ‰60ï½80 MHzï¼Œæ•ˆç‡å¾ˆå®è´µã€‚è€ŒCALLBACKæ¶‰åŠåˆ°å¤šæ¬¡è°ƒç”¨ï¼Œè€Œä¸”å‚æ•°æ•°ç›®æ˜¯å›ºå®šçš„4ä¸ªï¼ˆè§window_procedureï¼‰ï¼Œå› æ­¤STDCALLä½œä¸ºWindowsç‰¹æ„çš„é»˜è®¤è°ƒç”¨æ–¹å¼ã€‚\n5. æ•ˆæœæ˜¯ï¼šå®šä¹‰å‡½æ•°æ—¶ï¼Œä¸ä¸»åŠ¨å†™è°ƒç”¨æ–¹å¼æ—¶é»˜è®¤ä¸º`CDECL`ã€‚æ˜¾å¼å†™CALLBACKæ—¶å°±å˜æˆäº†STDCALLè°ƒç”¨æ–¹å¼ã€‚\n    1. cdecl æ˜¯ C è¯­è¨€çš„é»˜è®¤è°ƒç”¨çº¦å®šï¼Œå¹¿æ³›ç”¨äº C è¯­è¨€ç¼–å†™çš„ç¨‹åºä¸­ã€‚ç”±äºè°ƒç”¨è€…è´Ÿè´£æ¸…ç†å †æ ˆï¼Œè¿™ç§è°ƒç”¨çº¦å®šå…è®¸å¯å˜å‚æ•°å‡½æ•°ï¼ˆå¦‚ printfï¼‰ã€‚\n    2. stdcall ä¸»è¦ç”¨äº Windows API å‡½æ•°è°ƒç”¨ï¼Œæ˜¯ Windows å¹³å°ä¸Šçš„æ ‡å‡†è°ƒç”¨çº¦å®šä¹‹ä¸€ã€‚ç”±äºè¢«è°ƒç”¨è€…è´Ÿè´£æ¸…ç†å †æ ˆï¼Œè¿™ç§è°ƒç”¨çº¦å®šåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥æé«˜å‡½æ•°è°ƒç”¨çš„æ•ˆç‡ã€‚\n    3. pascal è°ƒç”¨çº¦å®šåˆ™æ˜¯å†å²ä¸Šåœ¨ Pascal è¯­è¨€ä¸­ä½¿ç”¨çš„è°ƒç”¨çº¦å®šï¼Œç°åœ¨ä½¿ç”¨è¾ƒå°‘ã€‚","categories":["æ“ä½œç³»ç»Ÿ","Windows"]},{"title":"Windows_é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡","url":"/Windows/Windows_é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡/","content":"# ç›®çš„\næŠŠåŸå…ˆé›†ä¸­åœ¨`wWinMain`å‡½æ•°çš„ç¹é‡æµç¨‹æ‹†åˆ†ä¸ºé¢å‘å¯¹è±¡æ¨¡å¼ã€‚\n`wWinMain`çš„ä»»åŠ¡ï¼š[Windows_wcharå’Œwmain](Windows_wcharå’Œwmain.md)\n1. åˆå§‹åŒ–çª—å£ç±»å¯¹è±¡`WNDCLASSEX wcex`çš„å„ç§æˆå‘˜å€¼ã€‚æœ€é‡è¦çš„ä¸€æ­¥æ˜¯lpfnWndProcç»‘å®šå›è°ƒå‡½æ•°ã€‚\n2. æ³¨å†Œè¯¥çª—å£ç±»å¯¹è±¡ã€‚\n3. åˆ›å»ºçª—å£ï¼Œè¿”å›HWNDã€‚\n4. æ˜¾ç¤ºçª—å£\n5. æ›´æ–°çª—å£\n6. æ¶ˆæ¯å¾ªç¯\n\nä»¥ä¸Šæ˜¯çª—å£ç±»çš„å¯åŠ¨èŒè´£ã€‚\né™¤æ­¤ä¹‹å¤–å°±æ˜¯æ¶ˆæ¯å¤„ç†èŒè´£äº†ã€‚\næ€»ä½“ä¸Šï¼Œ[ä½¿ç”¨æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼è¿›è¡Œç›¸åº”çš„æ¶ˆæ¯å¤„ç†çš„æ–¹æ³•å°è£…](#ä½¿ç”¨æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼è¿›è¡Œç›¸åº”çš„æ¶ˆæ¯å¤„ç†çš„æ–¹æ³•å°è£…)ã€‚\n# å‡†å¤‡é¡¹ç›®\n\nç¼–è¯‘ä¹‹å‰ï¼Œè¦é…ç½®å¥½VSé¡¹ç›®çš„å±æ€§ï¼Œå³é”®é¡¹ç›®é€‰æ‹©Propertiesï¼Œå·¦è¾¹æ é€‰æ‹©Linkerï¼Œç„¶åé€‰æ‹©Systemã€‚å³è¾¹è¯¦ç»†æ¡ç›®\"SubSystem\"éœ€ä¸‹æ‹‰é€‰æ‹©Windowsã€‚\n\nåœ¨Header Filesä¸­åˆ›å»ºWindow.hï¼Œä»£è¡¨ä¸€ä¸ªçª—å£ã€‚å› ä¸ºæœ¬æ–‡ç¼–å†™çš„åº”ç”¨ç¨‹åºæ˜¯ç®€åŒ–çš„é¡¹ç›®ï¼ŒåªåŒ…å«ä¸€ä¸ªè¿›ç¨‹ï¼Œä»£è¡¨æ•´ä¸ªåº”ç”¨ç¨‹åºï¼Œæ‰€ä»¥ç”Ÿå‘½å‘¨æœŸå’Œè¿™ä¸ªçª—å£æ˜¯ç»‘å®šçš„ã€‚ç›®çš„æ˜¯ä¸ºäº†å­¦ä¹ å¦‚ä½•å°è£…ä¸€ä¸ªçª—å£ç¨‹åºçš„æŠ€æœ¯ã€‚\n\n```cpp\n// Window.h\n\n#include <Windows.h>\n#include <string>\n\n#pragma once\n\nnamespace afk\n{\n    class Window\n    {\n        // ...\n    };\n}\n```\n# Windowç±»è®¾è®¡\n\néœ€è¦å°è£…ä»€ä¹ˆå±æ€§ï¼Ÿ\n1. `app_name`\n2. HWNDçª—å£å¯¹è±¡\n\néœ€è¦å°è£…ä»€ä¹ˆè¡Œä¸ºï¼Ÿ\n1. çª—å£çš„åˆ›å»ºï¼ˆæ„é€ å‡½æ•°ï¼‰\n2. æ˜¾ç¤ºçª—å£\n3. æ¶ˆæ¯å¾ªç¯\n\nWindowç±»åˆæ­¥å®šä¹‰\n```cpp\nclass Window\n{\npublic:\n    Window(std::wstring const & app_name);\n    void show_window(bool show = true);\n    int run(void);\nprotected:\n    HWND        _wnd{ nullptr };\n};\n```\nWindowç±»åˆæ­¥å®ç°ï¼š\n```cpp\n// Window.cpp\n#include \"Window.h\"\nafk::Window::Window(std::wstring const & app_name)\n{\n    WNDCLASSEX wcex = { 0 };\n    wcex.cbSize = sizeof(wcex);\n    wcex.style = CS_HREDRAW | CS_VREDRAW;\n    // ç»‘å®šCALLBACKï¼Œè§åé¢è§£é‡Š\n    wcex.lpfnWndProc = &window_procedure;\n    // wcex.... = ...;\n    wcex.lpszClassName = app_name.c_str();\n    // wcex.... = ...;\n\n    if (!::RegisterClassEx(&wcex))\n        return;\n    \n    // å®šä¹‰ä¸€ä¸ªçª—å£å¯¹è±¡çš„å¥æŸ„\n    // HWND: çª—å£ç±»å‹çš„å¥æŸ„ï¼Œä¹Ÿå«å†…æ ¸å¯¹è±¡\n    _wnd = ::CreateWindowEx(\n        WS_EX_OVERLAPPEDWINDOW,\n        app_name.c_str(),\n        L\"App\",\n        WS_OVERLAPPEDWINDOW,\n        CW_USEDEFAULT, 0, CW_USEDEFAULT, 0,\n        nullptr,\n        nullptr,\n        hInstance,\n        nullptr);\n    if (!_wnd)\n    {\n        int i = ::GetLastError();\n        return;\n    }\n}\n```\nshow_windowå®ç°\n```cpp\nvoid afk::Window::show_window(bool show /*= true*/)\n{\n    if(_wnd)\n    {\n        int nShowCmd = show ? SW_NORMAL : SW_HIDE;\n        // æ˜¾ç¤ºçª—å£ï¼ŒnShowCmdå¯ä»¥æŒ‡å®šçª—å£ä»¥æœ€å°/æœ€å¤§/æ­£å¸¸çŠ¶æ€æ˜¾ç¤º\n        ::ShowWindow(_wnd, nShowCmd);\n        // æ›´æ–°çª—å£ï¼Œç»˜åˆ¶çª—å£ã€‚åˆšæ˜¾ç¤ºå‡ºæ¥å¯èƒ½æ˜¯æ— æ•ˆçš„ï¼Œéœ€è¦åœ¨æ˜¾ç¤ºåç»˜åˆ¶ã€‚\n        ::UpdateWindow(_wnd);\n    }\n}\n```\nrunå®ç°\n```cpp\nint afk::Window::run(void)\n{\n    MSG msg;\n    while (::GetMessage(&msg, nullptr, 0, 0))\n    {\n        // ç¿»è¯‘æ¶ˆæ¯ï¼Œæ¯”å¦‚è¾“å…¥æ³•é€šè¿‡â€˜woâ€™ç”Ÿæˆâ€˜æˆ‘â€™\n        ::TranslateMessage(&msg);\n        // å‘é€æ¶ˆæ¯ï¼Œè°ƒç”¨åˆšæ‰æ³¨å†Œçš„callbackçª—å£å¤„ç†å‡½æ•°\n        ::DispatchMessage(&msg);\n    }\n    return 0;\n}\n```\nè¿˜æœ‰ä¸€äº›é—®é¢˜éœ€è¦è§£å†³ï¼š\nhInstanceæš‚æ— ï¼›å›è°ƒå‡½æ•°éœ€è¦è‡ªå®šä¹‰ï¼›æ³¨å†Œæ—¶ï¼Œéœ€è¦è¿›è¡Œå¼‚å¸¸å¤„ç†ã€‚\n## CALLBACKå†™åˆ°å“ªï¼Ÿ\nå¯ä»¥å†™åˆ°ç±»ä¸­ï¼Œä½†æ˜¯ï¼ŒCALLBACKå¿…é¡»ç¬¦åˆWindowsçš„èŒƒå¼ï¼Œå³å‡½æ•°ç­¾åä¸€è‡´ã€‚åˆ™ä¸èƒ½æœ‰thisæŒ‡é’ˆï¼Œå› æ­¤éœ€è¦è®¾ç½®ä¸ºstaticã€‚\n```cpp\nclass Window\n{\npublic:\n    // ...\n    static LRESULT CALLBACK window_procedure(HWND wnd, UINT message, WPARAM wparam, LPARAM lparam);\nprotected:\n    HWND        _wnd{ nullptr };\n};\n```\nå®ç°ï¼š\n```cpp\nLRESULT afk::Window::window_procedure(HWND wnd, UINT message, WPARAM wparam, LPARAM lparam)\n{\n    return LRESULT();\n}\n```\n## hInstanceæ€ä¹ˆå¤„ç†\nhInstanceéœ€è¦è¢«`window_procedure`è®¿é—®ï¼Œå› æ­¤ä¹Ÿéœ€è¦è®¾ç½®ä¸ºstaticçš„ã€‚\n```cpp\nclass Window\n{\npublic:\n    // ...\nprotected:\n    static HINSTANCE  _instance;\n};\n```\né™æ€å˜é‡ï¼Œéœ€è¦åœ¨`.cpp`æ–‡ä»¶ä¸­ï¼Œå…¨å±€åˆå§‹åŒ–ã€‚\næœ€å¥½æ ‡è®°ä¸ºconstinitï¼Œä»¥ä¿è¯å…¶åœ¨é™æ€ç¼–è¯‘æ—¶å°±åˆå§‹åŒ–ã€‚\n```cpp\n// Window.cpp\nconstinit HINSTANCE afk::Window::_instance{ nullptr };\n```\n# å¦‚ä½•å°è£…æ¶ˆæ¯å¤„ç†æ–¹æ³•ï¼Ÿå¦‚ä½•å®ç°CALLBACKå…·ä½“é€»è¾‘ï¼Ÿ\n## ä½¿ç”¨æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼è¿›è¡Œç›¸åº”çš„æ¶ˆæ¯å¤„ç†çš„æ–¹æ³•å°è£…\n\næ¯”å¦‚ï¼Œå¤„ç†`WM_LBUTTONDOWN`æ¶ˆæ¯ï¼Œå°±ä¸ºWindowç±»å¢åŠ ä¸€ä¸ª`on_lbtndown`çš„æˆå‘˜æ–¹æ³•ï¼Œåœ¨CALLBACKä¸­ç›¸åº”çš„caseä¸­è°ƒç”¨è¯¥æ–¹æ³•ã€‚  \næ³¨æ„ï¼Œè€ƒè™‘ç»§æ‰¿æ€§ï¼Œéœ€è¦è®¾ç½®å…¶ä¸ºvirtualã€‚  \nè¿˜éœ€è¦è€ƒè™‘ï¼Œè¦æ˜¾ç¤ºå‡ºæœ‰æ²¡æœ‰ç»è¿‡ç”¨æˆ·é‡å†™ï¼Ÿæ‰€ä»¥éœ€è¦è¿”å›boolï¼Œfalseä»£è¡¨é»˜è®¤çš„ç©ºæ“ä½œã€‚\n\næ­¤é¡¹ç›®æˆ‘ä»¬éœ€è¦å°è£…çš„æ¶ˆæ¯å¤„ç†æ–¹æ³•æœ‰ï¼š\n1. å·¦é”®æŒ‰ä¸‹\n2. å·¦é”®æŠ¬èµ·\n3. ç”»\n\n```cpp\nclass Window\n{\npublic:\n    // ...\nprotected:\n    virtual bool on_lbtndown(POINT& pt);\n    virtual bool on_lbtnup(POINT& pt);\n    // HDCæœ¬èº«å°±æ˜¯æŒ‡é’ˆï¼Œæ²¡å¿…è¦ä¼ é€’å¼•ç”¨\n    virtual bool on_paint(HDC dc, PAINTSTRUCT& ps);\nprotected:\n    // ...\n};\n```\næ­¤å¤„é»˜è®¤è¿”å›falseè¡¨ç¤ºç”¨æˆ·æ²¡æœ‰å¤„ç†æ­¤æ¶ˆæ¯ã€‚\n>on_paintçš„å‚æ•°ï¼š\n>1. HDCæ˜¯BeginPaintçš„è¿”å›å€¼ã€‚è§ï¼š[Windows_wcharå’Œwmain](Windows_wcharå’Œwmain.md)ä¸­çš„[BeginPaint](https://learn.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-beginpaint)ã€‚\n>2. PAINTSTRUCTæ˜¯BeginPaintçš„ç¬¬2ä¸ªå‚æ•°ï¼Œæœ¬é¡¹ç›®ä¸­å®é™…ä¸Šæš‚æœªä½¿ç”¨psã€‚\n```cpp\nbool afk::Window::on_lbtndown(POINT& pt)\n{\n    return false;\n}\n\nbool afk::Window::on_lbtnup(POINT& pt)\n{\n    return false;\n}\n\nbool afk::Window::on_paint(HDC dc, PAINTSTRUCT& ps)\n{\n    return false;\n}\n```\néœ€è¦è€ƒè™‘ï¼ŒCALLBACKæ˜¯é™æ€æ–¹æ³•ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨**éé™æ€çš„æˆå‘˜æ–¹æ³•**ï¼ˆå³å„ç§æ¶ˆæ¯å¤„ç†å‡½æ•°ï¼‰ã€‚å°±éœ€è¦å®šä¹‰ä¸€ä¸ªé™æ€æˆå‘˜å˜é‡`Window* _window`æ¥é—´æ¥è°ƒç”¨ï¼Œç›¸å½“äºè‡ªåˆ›thisæŒ‡é’ˆã€‚\n```cpp\nclass Window\n{\npublic:\n    // ...\nprotected:\n    // ...\n    static Window*    _window;\n};\n```\nç¼–è¯‘æ—¶çš„åˆå§‹åŒ–å…ˆå¡«ä¸€ä¸ªnullptrå€¼ã€‚\n```cpp\n// Window.cpp\nconstinit afk::Window* afk::Window::_window{ nullptr };\n```\nåœ¨Windowæ„é€ æ—¶ï¼Œåˆ›å»ºçª—å£å‰ï¼Œä½¿ç”¨thisæŒ‡é’ˆè¿›è¡ŒçœŸæ­£çš„åˆå§‹åŒ–ã€‚\n```cpp\nafk::Window::Window(std::wstring const & app_name)\n{\n    _window = this;\n    // ...\n}\n```\n## CALLBACKå…·ä½“å®ç°\n```cpp\nLRESULT afk::Window::window_procedure(HWND wnd, UINT message, WPARAM wparam, LPARAM lparam)\n{\n    if(!_window)\n        return ::DefWindowProc(wnd, message, wparam, lparam);\n\n    PAINTSTRUCT ps;\n\n    switch (message)\n    {\n    case WM_CREATE:\n        break;\n    case WM_LBUTTONDOWN:\n    {\n        // GET_X/Y_LPARAM From <windowsx.h> \n        int x_coord = GET_X_LPARAM(lparam);\n        int y_coord = GET_Y_LPARAM(lparam);\n        POINT pt{ x_coord, y_coord };\n        // trueä»£è¡¨ç”¨æˆ·å¤„ç†å®Œæ¯•\n        if (_window->on_lbtndown(pt))\n            return 1;\n    }\n        break;\n    case WM_LBUTTONUP:\n    {\n        // GET_X/Y_LPARAM From <windowsx.h> \n        int x_coord = GET_X_LPARAM(lparam);\n        int y_coord = GET_Y_LPARAM(lparam);\n        POINT pt{ x_coord, y_coord };\n        // trueä»£è¡¨ç”¨æˆ·å¤„ç†å®Œæ¯•\n        if (_window->on_lbtnup(pt))\n            return 1;\n    }\n        break;\n    case WM_PAINT:\n    {\n        HDC dc = ::BeginPaint(wnd, &ps);\n        bool result = _window->on_paint(dc, ps);\n        ::EndPaint(wnd, &ps);\n        if (result)\n            return 1;\n    }\n        break;\n    case WM_DESTROY:\n        ::PostQuitMessage(0);\n        break;\n    //default:\n    //    ;\n    }\n    return ::DefWindowProc(wnd, message, wparam, lparam);\n}\n```\n# wWinMainæ”¾åˆ°å“ªé‡Œï¼Ÿ\n\nç”¨æˆ·ä¸å¯è§ï¼Œæ‰€ä»¥å¯ä»¥æ”¾åˆ°`.cpp`æ–‡ä»¶ä¸­ã€‚\n\næ¶‰åŠåˆ°ä¸€ä¸ªé—®é¢˜ï¼š`_instance`å³ä½¿æ˜¯é™æ€çš„ï¼Œä½†å…¶æ˜¯épublicæˆå‘˜å˜é‡ï¼Œå¯ä»¥ç”¨å‹å…ƒæ¥è§£å†³ç±»å¤–éƒ¨å‡½æ•°çš„è®¿é—®é—®é¢˜ã€‚\n```cpp\nclass Window\n{\n    friend int ::wWinMain(HINSTANCE, HINSTANCE, LPWSTR, int);\npublic:\n    // ...\nprotected:\n    // ...\n};\n```\nå…¶æ¬¡ï¼ŒwWinMainå‡½æ•°æ¯”è¾ƒå¤æ‚ï¼Œä¸ºäº†ä¾¿äºç”¨æˆ·æ“ä½œï¼Œå†å°è£…ä¸€å±‚mainï¼Œæ˜¯ä¾›ç”¨æˆ·ä½¿ç”¨çš„æ¥å£ï¼Œå³è¿™ä¸ªå‡½æ•°ç›¸å¯¹äºWindowç±»æ¥è®²æ˜¯ç”¨æˆ·æä¾›çš„å¤–éƒ¨å‡½æ•°ï¼Œå› æ­¤æ ‡æ³¨externã€‚[ç”¨æˆ·main](#ç”¨æˆ·main)\n```cpp\n// Window.cpp\n\n// ...\n\nextern int main(std::wstring const & args);\n\n// ...\nint wWinMain(\n    HINSTANCE hInstance,\n    HINSTANCE hPrevInstance,\n    LPWSTR lpCmdLine,\n    int nShowCmd)\n{\n    afk::Window::_instance = hInstance;\n\n    return main(lpCmdLine);\n}\n```\n\nä»¥ä¸Šå³ä¸ºä¸€ä¸ªWindowç¨‹åºçš„æ¡†æ¶ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨æ­¤æ¡†æ¶å¼€å‘è‡ªå·±çš„ç¨‹åºã€‚\n# åŸºäºæ¡†æ¶å¼€å‘\nå®šä¹‰MyAppç±»ç»§æ‰¿Windowç±»ã€‚\n```cpp\n// MyApp.h\n#pragma once\n#include \"Window.h\"\nclass MyApp : public afk::Window\n{\npublic:\n    MyApp(std::wstring const & name) : Window{name}\n    {\n        //\n    }\n    bool on_paint(HDC dc, PAINTSTRUCT & ps)\n    {\n        // æµ‹è¯•ï¼šç”»ä¸€ä¸ªçŸ©å½¢\n        //Rectangle(dc, 100, 100, 200, 200);\n        return true;\n    }\n    bool on_lbtndown(POINT& pt)\n    {\n        _pt = pt;\n        return true;\n    }\n    bool on_lbtnup(POINT& pt)\n    {\n        HDC dc = ::GetDC(_wnd);\n        // ä»å·¦é”®æŒ‰ä¸‹é¼ æ ‡ç‚¹ ç”»ç›´çº¿åˆ° å·¦é”®å¼¹èµ·çš„ç‚¹\n        ::MoveToEx(dc, _pt.x, _pt.y, nullptr);\n        ::LineTo(dc, pt.x, pt.y);\n        \n        ::ReleaseDC(_wnd, dc);\n        return true;\n    }\nprivate:\n    POINT          _pt;\n};\n```\n## æŠ€æœ¯ç‚¹ï¼šGetDC\nç”±äºç»˜åˆ¶éœ€è¦å¾—åˆ°HDCæ‰å¯ä»¥ï¼Œè€Œdcåªä¼ ç»™äº†on_paintå‡½æ•°ï¼Œon_lbtnupä¸­æ²¡æœ‰dcã€‚\nå¯ä»¥é€šè¿‡`HWND`æ‰¾åˆ°å½“å‰çª—å£çš„HDCï¼Œéœ€è¦è°ƒç”¨`GetDC(HWND)`æ–¹æ³•ã€‚\nä½†æ˜¯è¦è®°å¾—ï¼Œç”¨å®Œä¹‹åè¦ReleaseDCï¼Œéœ€è¦2ä¸ªå‚æ•°ï¼Œ1æ˜¯çª—å£å¥æŸ„ï¼Œ2æ˜¯HDCã€‚\n## æµ‹è¯•\n```cpp\n// main.cpp\n#include \"MyApp.h\"\nint main(std::wstring const & args)\n{\n    MyApp app{L\"app\"};\n    app.show_window();\n    return app.run();\n}\n```\nè‡³æ­¤ï¼Œå¯ä»¥å®ç°å·¦é”®æŒ‰ä¸‹ã€æŠ¬èµ·ç”»ç›´çº¿äº†ã€‚ä½†æ˜¯ä¸€æ—¦æ”¹å˜çª—å£å°±å¯¼è‡´ç³»ç»Ÿ`WM_PAINT`æ¶ˆæ¯é‡ç»˜çª—å£ï¼Œå› ä¸ºæš‚æ—¶æ²¡æœ‰å¤„ç†`on_paint`å‡½æ•°ï¼Œæ‰€ä»¥å·²ç»ç”»ä¸Šçš„çº¿æ¡ä¼šæ¶ˆå¤±ã€‚éœ€è¦æŠŠçº¿æ¡é‡ç»˜æ“ä½œé›†æˆåœ¨`on_paint`æ–¹æ³•ä¸­ï¼Œè¿™äº›çº¿æ¡ä½¿ç”¨æ•°æ®ç»“æ„è¿›è¡Œå­˜å‚¨ã€‚\n## æ€»ç»“ï¼šæ¨¡æ¿æ–¹æ³•æ¨¡å¼\nä»¥ä¸Šæ–¹æ³•æ˜¯æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼ã€‚ä¸»è¦æ€æƒ³å°±æ˜¯å›´ç»•ä¸€ä¸ªFrameworkå¼•æ“ï¼Œæœ¬èº«æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨çš„ï¼Œè¡Œä¸ºæ˜¯é»˜è®¤çš„é…ç½®ã€‚å¯ä»¥ç»§æ‰¿ä»¥é‡å†™ä¸€äº›çš„æ–¹æ³•æ¥å®Œæˆç‰¹å®šçš„åŠŸèƒ½ã€‚å¤šç”¨äºæ¸¸æˆå¼•æ“ã€åº”ç”¨æ¡†æ¶ï¼Œåœ¨åº•å±‚éšè—äº†å¾ˆå¤šç»†èŠ‚ã€å¯é‡ç”¨çš„éƒ¨åˆ†ã€‚\n## å®Œå–„ç»†èŠ‚ï¼šåˆ›å»ºçª—å£å‰ç”¨æˆ·è‡ªå®šä¹‰é…ç½®\næˆ‘ä»¬æƒ³ç»™ç”¨æˆ·æä¾›ä¸€ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯æ”¹å˜çª—å£çš„å±æ€§ã€‚\néœ€è¦åœ¨wcexæ³¨å†Œå‰å¯¹wcexè¿›è¡Œæ›´æ”¹ã€‚\n\nåœ¨Windowç±»ä¸­å°è£…`pre_create`æ–¹æ³•ï¼šç”¨äºåœ¨`WNDCLASSEX`æ³¨å†Œä¹‹å‰ï¼Œç”¨æˆ·ä¿®æ”¹é…ç½®ã€‚\n```cpp\nclass Window\n{\n    // ...\npublic:\n    // ...\nprotected:\n    // ...\n    virtual void pre_create(WNDCLASSEX& wcex);\n}\n```\né»˜è®¤çš„pre_createå®ç°ï¼š\n```cpp\n// Window.cpp\n\n// ...\nvoid afk::Window::pre_create(WNDCLASSEX& wcex)\n{\n    // é»˜è®¤ä¸æ“ä½œ\n    return;\n}\n// ...\n```\nWindowæ„é€ å‡½æ•°åœ¨æ³¨å†Œwcexçª—å£å‰åŠ å…¥pre_create\n```cpp\nafk::Window::Window(std::wstring const & app_name)\n{\n    _window = this;\n\n    WNDCLASSEX wcex = { 0 };\n    wcex.cbSize = sizeof(wcex);\n    wcex.style = CS_HREDRAW | CS_VREDRAW;\n    wcex.lpfnWndProc = &window_procedure;\n    wcex.cbClsExtra = 0;\n    wcex.cbWndExtra = 0;\n    wcex.hInstance = _instance;\n    wcex.hIcon = LoadIcon(nullptr, IDI_SHIELD);\n    wcex.hCursor = LoadCursor(nullptr, IDC_ARROW);\n    wcex.hbrBackground = (HBRUSH)(GetStockObject(LTGRAY_BRUSH));\n    wcex.lpszMenuName = NULL;\n    wcex.lpszClassName = app_name.c_str();\n    wcex.hIconSm = wcex.hIcon;\n\n    pre_create(wcex);\n\n    if (!::RegisterClassEx(&wcex))\n        return;\n\n    // ...\n}\n```\nç”¨æˆ·è‡ªå®šä¹‰`pre_create`ï¼šæ­¤ä¾‹ä¸­æˆ‘ä»¬ä¿®æ”¹æµ…ç°è‰²èƒŒæ™¯ä¸ºé»‘è‰²èƒŒæ™¯ã€‚\n```cpp\nclass MyApp : public afk:Window\n{\npublic:\n    // ...\nprotected:\n    void pre_create(WNDCLASSEX& wcex)\n    {\n        // æ”¹å˜èƒŒæ™¯è‰²\n        wcex.hbrBackground = (HBRUSH)(GetStockObject(BLACK_BRUSH));\n    }\n\n    // ...\n}\n```\n## é—®é¢˜è§£å†³ï¼šä¸èƒ½åœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨è™šæ–¹æ³•\næ­¤æ—¶æµ‹è¯•ï¼Œå‘ç°å¹¶æ²¡æœ‰æ›´æ”¹æˆåŠŸã€‚å› ä¸ºæˆ‘ä»¬çš„è®¾è®¡å‡ºç°äº†ä¸€ä¸ªç»“æ„æ€§é—®é¢˜ï¼šæˆ‘ä»¬åœ¨æ„é€ Windowå‡½æ•°ä¸­è°ƒç”¨äº†è™šå‡½æ•°`pre_create`ï¼Œç”±äºè™šè¡¨æ˜¯åœ¨æ„é€ å¯¹è±¡çš„è¿‡ç¨‹ä¸­è¿˜æ²¡è¢«å®šä¹‰ï¼Œæ‰€ä»¥ä¼šå‡ºç°å¤±æ•ˆã€‚æ‰€ä»¥æˆ‘ä»¬è¦é•¿ä¸ªæ•™è®­ï¼Œä¸èƒ½åœ¨æ„é€ å‡½æ•°ä¸­èµ‹äºˆå¤ªå¤šä»»åŠ¡ï¼Œå°¤å…¶ä¸èƒ½è°ƒç”¨è™šå‡½æ•°ã€‚\nå› æ­¤éœ€è¦åˆ†è§£Windowæ„é€ å‡½æ•°çš„ä»»åŠ¡ã€‚æŠŠå…¶ä¸­çš„`åˆ›å»ºçª—å£`å’Œæ­¤å¤„è¦åšçš„`é¢„åˆ›å»º`å‰¥ç¦»å‡ºæ¥ã€‚å®é™…ä¸Šï¼Œå‡¡æ˜¯å’Œæˆå‘˜å˜é‡æ— å…³çš„ï¼Œéƒ½è¦å‰¥ç¦»ã€‚\n\nWindowæ„é€ å‡½æ•°å‰¥ç¦»å‡ºcreate_windowï¼š\n```cpp\n// Window.h\nclass Window\n{\n    // ...\npublic:\n    // ...\n    bool create_window(void);\n    // ...\nprotected:\n    // ...\n}\n```\nè¢«å‰¥ç¦»åçš„Windowæ„é€ å‡½æ•°ï¼š\n```cpp\n// Window.cpp\n\n// ...\nafk::Window::Window(std::wstring const & app_name)\n{\n    _window = this;\n    // app_name ??? è§ä¸‹æ–‡\n}\n```\ncreate_windowå®ç°ï¼Œåœ¨æ³¨å†Œçª—å£å‰è°ƒç”¨pre_createï¼Œæ­¤æ—¶thisæŒ‡é’ˆã€è™šè¡¨å·²ç»æ„é€ å®Œæ¯•ï¼Œè™šå‡½æ•°è¡Œä¸ºå¾—åˆ°çº æ­£ï¼š\n```cpp\nbool afk::Window::create_window(void)\n{\n    WNDCLASSEX wcex = { 0 };\n    wcex.cbSize = sizeof(wcex);\n    wcex.style = CS_HREDRAW | CS_VREDRAW;\n    wcex.lpfnWndProc = &window_procedure;\n    wcex.cbClsExtra = 0;\n    wcex.cbWndExtra = 0;\n    wcex.hInstance = _instance;\n    wcex.hIcon = LoadIcon(nullptr, IDI_SHIELD);\n    wcex.hCursor = LoadCursor(nullptr, IDC_ARROW);\n    wcex.hbrBackground = (HBRUSH)(GetStockObject(LTGRAY_BRUSH));\n    wcex.lpszMenuName = NULL;\n    wcex.lpszClassName = _app_name.c_str();\n    wcex.hIconSm = wcex.hIcon;\n\n    // ç”¨æˆ·è‡ªå®šä¹‰é…ç½®\n    pre_create(wcex);\n\n    // æ³¨å†Œ\n    if (!::RegisterClassEx(&wcex))\n        return false;\n\n    // åˆ›å»ºçª—å£\n    _wnd = ::CreateWindowEx(\n        WS_EX_OVERLAPPEDWINDOW,\n        _app_name.c_str(), L\"App\",\n        WS_OVERLAPPEDWINDOW,\n        CW_USEDEFAULT, 0, CW_USEDEFAULT, 0,\n        nullptr, nullptr, _instance, nullptr);\n    if (!_wnd)\n    {\n        int i = ::GetLastError();\n        return false;\n    }\n    return true;\n}\n\n// ...\n```\næ­¤æ—¶å‘ç°ï¼Œ`create_window`å‡½æ•°ä¸­ä¸è®¤è¯†`app_name`ã€‚è¿™ä¸ªå˜é‡æˆ‘ä»¬ç›®å‰åªåœ¨æ„é€ å‡½æ•°ä¸­ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œæ²¡æœ‰è®¾è®¡ä¸ºæˆå‘˜å˜é‡ï¼Œéœ€è¦å¢åŠ ã€‚\n```cpp\n// Window.h\nclass Window\n{\npublic:\n    // ...\nprotected:\n    // ...\n    std::wstring     _app_name;\n}\n```\næœ€ç»ˆçš„Windowæ„é€ å‡½æ•°\n```cpp\n// Window.cpp\n// ...\nafk::Window::Window(std::wstring const & app_name)\n{\n    _window = this;\n    _app_name = app_name;\n}\n// ...\n```\n## ç”¨æˆ·main\nç”¨æˆ·è‡ªå·±ç¼–å†™çš„mainå¦‚ä¸‹ï¼š[wWinMainæ”¾åˆ°å“ªé‡Œï¼Ÿ](#wWinMainæ”¾åˆ°å“ªé‡Œï¼Ÿ)\n```cpp\n// MyApp.cpp\n#include \"MyApp.h\"\nint main()\n{\n    MyApp app{ L\"app\" };\n    app.create_window(); // add\n    app.show_window();\n    return app.run();\n}\n```\n## å¤„ç†é‡ç»˜\n\nè‡³æ­¤ï¼Œå¯ä»¥å®ç°å·¦é”®æŒ‰ä¸‹ã€æŠ¬èµ·ç”»ç›´çº¿äº†ï¼Œå¹¶ä¸”å¯ä»¥åœ¨åˆ›å»ºçª—å£å‰è®©ç”¨æˆ·è‡ªå®šä¹‰é…ç½®ã€‚\n\nç°åœ¨æˆ‘ä»¬ç€çœ¼äºè§£å†³ï¼šæ”¹å˜çª—å£ï¼ˆå¦‚æ”¹å˜å¤§å°ï¼‰åå¯¼è‡´é‡ç»˜çª—å£ã€‚\n\nå› ä¸ºæ²¡æœ‰å¤„ç†é‡ç»˜ï¼Œæ‰€ä»¥å·²ç»ç”»ä¸Šçš„çº¿æ¡ä¼šæ¶ˆå¤±ã€‚ä¿—ç§°ï¼šè„çŸ©å½¢ï¼ŒæŒ‡çª—å£è¢«æ±¡æŸ“æˆ–è¢«å…¶ä»–çª—å£è¦†ç›–ã€‚\n\nWindowsæ“ä½œç³»ç»Ÿå…¶å®ä¹Ÿæ˜¯ä¿ç•™äº†ä¸€äº›ä¸œè¥¿çš„ï¼šé¼ æ ‡ç®­å¤´æ ·å¼ã€èœå•æ¡åŒºåŸŸã€‚å…¶ä»–çš„å›¾å½¢ä¸äºˆä¿ç•™ï¼Œéœ€è¦ç¨‹åºå‘˜è‡ªè¡Œå¤„ç†ã€‚\n\næ¯å½“æ”¹å˜çª—å£æ—¶ï¼Œç›¸å½“äºå‘é€äº†`PAINT`æ¶ˆæ¯ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ“ä½œé›†æˆåœ¨`on_paint`æ–¹æ³•ä¸­ï¼Œå¹¶ä½¿ç”¨æ•°æ®ç»“æ„å¯¹å›¾å½¢è¿›è¡Œæš‚å­˜ã€‚\n### LineManagerï¼šå•ä¾‹æ¨¡å¼\nLineManagerç±»è®¾è®¡ï¼šï¼ˆé™¤äº†å’Œå•ä¾‹æœ‰å…³çš„ï¼‰\n1. æˆå‘˜ï¼šlistå®¹å™¨ï¼Œå­˜æ”¾Line\n2. add_lineï¼šå­˜å‚¨Line\n3. renderï¼šæ¸²æŸ“Line\n4. clear_allï¼šææ„æ‰€æœ‰Line\n```cpp\n// LineManager.h\n#include <list>\n#include <Windows.h>\n\n// ä¸å®Œå…¨ç±»å‹å®šä¹‰\nclass Line;\n\nclass LineManager\n{\npublic:\n    static LineManager* instance_ptr(void);\n    static LineManager& instance(void);\n    static void destroy_instance(void);\n\n    void add_line(Line* line);\n    void clear_all(void);\n    // æ¸²æŸ“\n    void render(HDC dc);\nprivate:\n    LineManager(void) = delete;\n    LineManager(LineManager const&) = delete;\n    LineManager(LineManager&&) noexcept = delete;\n    ~LineManager();\nprivate:\n    static LineManager*       _manager;\n    std::list<Line*>          _line_container;\n}\n```\n#### LineManagerå•ä¾‹å®ç°\nä»¥ä¸‹æ˜¯æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼Œå³å¯¹è±¡çš„æŒ‡é’ˆä¸€å¼€å§‹æ˜¯ç©ºçš„ï¼Œåªæœ‰åœ¨ç¬¬ä¸€æ¬¡è·å–å•ä¾‹å¯¹è±¡æ—¶ï¼Œæ‰å¼€å§‹æ„é€ å•ä¾‹å¯¹è±¡ã€‚ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼Œå› ä¸ºnewæ˜¯åˆ†3ä¸ªæ­¥éª¤çš„ï¼Œå¯èƒ½å¯¼è‡´`_manager`æ˜¯å¦ä¸ºç©ºåˆ¤æ–­æœ‰è¯¯ï¼‰\n```cpp\n// LineManager.cpp\n#include \"LineManager.cpp\"\n#include <algorithm>\n#include <ranges>\n#include \"Line.h\"\n\nconstinit LineManager* LineManager::_manager{ nullptr };\n\nLineManager::LineManager(void)\n{\n}\nLineManager::~LineManager()\n{\n    clear_all();\n}\n\n/* inline */ LineManager* LineManager::instance_ptr(void)\n{\n    if(!_manager)\n        _manager = new LineManager;\n    return _manager;\n}\n\nLineManager& LineManager::instance(void)\n{\n    if(!_manager)\n        _manager = new LineManager;\n    return *_manager;\n}\n\nvoid LineManager::destroy_instance(void)\n{\n    if(_manager)\n    {\n        delete _manager;\n        _manager = nullptr;\n    }\n}\n```\né—®é¢˜ï¼šå†…è”å‡½æ•°ä¸èƒ½è®¿é—®privateæˆå‘˜ã€‚æŠŠ`LineManager::instance_ptr`å‰çš„inlineæ ‡è®°å»æ‰å³å¯ç¼–è¯‘æˆåŠŸã€‚\n#### LineManagerçš„add_lineã€clear_allå®ç°\n```cpp\nvoid LineManager::add_line(Line* line)\n{\n    if(!line)\n        return;\n    _line_container.emplace_back(line);\n}\n\nvoid LineManager::clear_all(void)\n{\n    std::for_each(\n        _line_container.begin(),\n        _line_container.end(),\n        [](auto&& line) -> void\n        {\n            delete line;\n        });\n    _line_container.clear();\n}\n```\n#### LineManagerçš„renderå®ç°\néœ€è¦HDCå‚æ•°ï¼Œå³Device Contextçš„å¥æŸ„ã€‚\nç„¶åä¼ ç»™æ¯ä¸€ä¸ªlineï¼Œè®©ä»–ä»¬åœ¨è¯¥DCä¸Šå„è‡ªrenderã€‚\n```cpp\nvoid LineManager::render(HDC dc)\n{\n    if(!dc)\n        return;\n    std::ranges::for_each(\n        _line_container,\n        [&dc](auto&& line) -> void /* dcæ˜¯ä¸´æ—¶å˜é‡ï¼Œéœ€è¦åœ¨[]ä¸­æ•è· */\n        {\n            line->render(dc);\n        });\n}\n```\n### Line\nLineç±»è®¾è®¡ï¼š\n1. 2ä¸ªPOINTæˆå‘˜ï¼Œå³ä¸¤ä¸ªç‚¹çš„åæ ‡\n2. renderæ¸²æŸ“\n```cpp\n// Line.h\n#pragma once\n#include <Windows.h>\nclass Line\n{\npublic:\n    Line(POINT const& pt1, POINT const& pt2);\n    ~Line();\n    void render(HDC dc);\nprivate:\n    POINT         _pt1, _pt2;\n}\n```\nLineå®ç°ï¼š\n```cpp\n// Line.cpp\n#include \"Line.h\"\nLine::Line(POINT const& pt1, POINT const& pt2) :\n    _pt1{ pt1 }, _pt2{ pt2 }\n{\n\n}\nLine::~Line()\n{\n\n}\n```\n#### Lineçš„renderå®ç°\néœ€è¦HDCå‚æ•°ï¼Œå³Device Contextçš„å¥æŸ„ã€‚\næ˜¯ç”±LineManagerä¼ å…¥çš„ï¼Œè°ƒç”¨MoveToExï¼ŒLineToï¼Œåœ¨è¯¥DCä¸Šè¿›è¡Œç»˜åˆ¶ç›´çº¿ã€‚\n```Cpp\nvoid Line::render(HDC dc)\n{\n    ::MoveToEx(dc, _pt1.x, _pt1.y, nullptr);\n    ::LineTo(dc, _pt2.x, _pt2.y);\n}\n```\n### MyAppæ”¯æŒé‡ç»˜çš„ç‰ˆæœ¬\n1. åœ¨`on_paint`ä½¿ç”¨LineManagerè¿›è¡Œrenderã€‚\n2. æ¯æ¬¡æŠ¬èµ·å·¦é”®ï¼Œå°±å­˜ä¸€ä¸ªLineå¯¹è±¡ã€‚\n3. \n```cpp\n// MyApp.h\n\n#include \"Window.h\"\n#include \"LineManager.h\"\n#include \"Line.h\"\n\nclass MyApp\n{\npublic:\n    // ...\n    \n    bool on_paint(HDC dc, PAINTSTRUCT& ps)\n    {\n        LineManager::instance().render(dc);\n        return true;\n    }\n    \n    // ...\n\n    bool on_lbtnup(POINT& pt)\n    {\n        HDC dc = ::GetDC(_wnd);\n        LineManager::instance_ptr()->add_line(new Line{ _pt, pt });\n        ::ReleaseDC(_wnd, dc);\n        ::InvalidateRect(_wnd, nullptr, true);\n        return true;\n    }\nprivate:\n    // ...\n}\n```\n>[æŠ€æœ¯ç‚¹ï¼šGetDC](#æŠ€æœ¯ç‚¹ï¼šGetDC)\n#### æŠ€æœ¯ç‚¹ï¼šInvalidateRect\n[InvalidateRectå‡½æ•° - InvalidateRect function](https://learn.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-invalidaterect)\nå‡½æ•°çš„ä½œç”¨ï¼šåœ¨æŒ‡å®šçª—å£çš„æ›´æ–°åŒºåŸŸä¸­æ·»åŠ ä¸€ä¸ªçŸ©å½¢ã€‚æ›´æ–°åŒºåŸŸä»£è¡¨çª—å£çš„å·¥ä½œåŒºä¸­å¿…é¡»é‡ç»˜çš„éƒ¨åˆ†ã€‚\n![](../../images/Windows_é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡/image-20240731023701088.png)\n1. å‚æ•°1ï¼šå·²æ›´æ”¹çš„çª—å£çš„å¥æŸ„ã€‚å¦‚æœæ­¤å‚æ•°ä¸º**NULL**ï¼Œåˆ™ç³»ç»Ÿå°†ä½¿æ‰€æœ‰çª—å£æ— æ•ˆå¹¶é‡æ–°ç»˜åˆ¶ï¼Œè€Œä¸ä»…ä»…æ˜¯æ­¤åº”ç”¨ç¨‹åºçš„çª—å£ã€‚\n2. å‚æ•°2ï¼šæŒ‡å‘[RECT](https://learn.microsoft.com/en-us/windows/desktop/api/windef/ns-windef-rect)ç»“æ„çš„æŒ‡é’ˆï¼Œè¯¥ç»“æ„åŒ…å«è¦æ·»åŠ åˆ°æ›´æ–°åŒºåŸŸçš„çŸ©å½¢çš„å·¥ä½œåŒºåæ ‡ã€‚å¦‚æœæ­¤å‚æ•°ä¸º**NULL**ï¼Œåˆ™å°†æ•´ä¸ªå®¢æˆ·åŒºæ·»åŠ åˆ°æ›´æ–°åŒºåŸŸã€‚\n3. å‚æ•°3ï¼šæŒ‡å®šåœ¨å¤„ç†æ›´æ–°åŒºåŸŸæ—¶æ˜¯å¦è¦æ“¦é™¤æ›´æ–°åŒºåŸŸå†…çš„èƒŒæ™¯ã€‚å¦‚æœæ­¤å‚æ•°ä¸º**TRUE**ï¼Œåˆ™åœ¨è°ƒç”¨[BeginPaint](https://learn.microsoft.com/en-us/windows/desktop/api/winuser/nf-winuser-beginpaint)å‡½æ•°æ—¶æ“¦é™¤èƒŒæ™¯ã€‚å¦‚æœæ­¤å‚æ•°ä¸º**FALSE**ï¼Œåˆ™èƒŒæ™¯ä¿æŒä¸å˜ã€‚\n\nè¿™ä¸ªæ˜¯ä¸»åŠ¨è®©çª—å£å¤±æ•ˆçš„å‡½æ•°ï¼Œä»è€Œåˆºæ¿€ç³»ç»Ÿå‘å‡º`WM_PAINT`çš„æ¶ˆæ¯ï¼Œç„¶åå°±è°ƒç”¨`on_paint`ï¼Œè®©çª—å£é‡ç»˜ã€‚å¦‚æœä¸åŠ è¿™ä¸€å¥çš„è¯ï¼Œæˆ‘ä»¬åªæ˜¯ç”»å®Œçº¿åï¼Œçª—å£ä¸Šä¸ä¼šå‡ºç°ä¸œè¥¿ï¼Œå› ä¸ºæˆ‘ä»¬ç°åœ¨ç”»çº¿çš„é€»è¾‘åªæ˜¯å¾€å®¹å™¨ä¸­å‚¨å­˜äº†Lineï¼ŒçœŸæ­£ç”»å‡ºæ¥æ˜¯on_paintå¯¼è‡´LineManagerè°ƒç”¨renderï¼Œä»è€Œæ¯ä¸ªLineæœ€årenderã€‚\n# ç²¾ç»†åŒ–ç®¡ç†ï¼šæ™ºèƒ½æŒ‡é’ˆ\n## å®¹å™¨å†…å®¹å¯¹è±¡çš„æ™ºèƒ½æŒ‡é’ˆç®¡ç†\n\nç›®å‰çš„ç¨‹åºåªèƒ½åšæˆå›¾å½¢çš„`clear_all`ï¼Œä½†å¦‚æœå½“æˆ‘ä»¬æœ‰ç²¾ç¡®åˆ é™¤æŸä¸ªã€æŸäº›å›¾å½¢çš„éœ€æ±‚æ—¶ï¼Œç”šè‡³æœ‰æ’¤é”€åˆ é™¤çš„éœ€æ±‚ï¼Œå°±å®¹æ˜“å¿˜è®°ã€é—æ¼deleteï¼Œå› æ­¤éœ€è¦æ™ºèƒ½æŒ‡é’ˆæ¥åšç®¡ç†ã€‚\n\nä¿®æ”¹ LineManager ä¸­çš„ list æˆå‘˜çš„æ¨¡æ¿å‚æ•°ï¼Œä»¥åŠadd_lineä¸­å‚æ•°ç”±è£¸æŒ‡é’ˆæ”¹ä¸ºæ™ºèƒ½æŒ‡é’ˆã€‚\n>è§æ—§å®ç°ï¼š[LineManagerçš„add_lineã€clear_allå®ç°](#LineManagerçš„add_lineã€clear_allå®ç°)\n```cpp\n// LineManager.h\n\n#pragma once\n\n// ...\n\n#include <memory>\n\nclass LineManager\n{\npublic:\n    // ...\n\n    void add_line(std::shared_ptr<Line> line);\n\n    // ...\nprivate:\n    // ...\n    std::list<std::shared_ptr<Line>> _line_container;\n}\n```\nä¿®æ”¹ LineManager ä¸­çš„`add_line`çš„å‚æ•°ç±»å‹ä¸ºæ™ºèƒ½æŒ‡é’ˆï¼Œå‡½æ•°ä½“å†…å®¹ä¸å˜ã€‚\n```cpp\n// LineManager.cpp\nvoid LineManager::add_line(std::shared_ptr<Line> line)\n{\n    if(!line)\n        return;\n    _line_container.emplace_back(line);\n}\n```\nä¿®æ”¹ LineManager ä¸­çš„`clear_all`çš„å‡½æ•°ä½“ï¼Œä¸ç”¨è¿›è¡Œéå†deleteäº†ï¼Œä¸€é”® clear å³å¯ä»¥å®Œæˆ Line çš„è‡ªåŠ¨ææ„ã€‚\n```cpp\n// LineManager.cpp\nvoid LineManager::clear_all(void)\n{\n    _line_container.clear();\n}\n```\nä¿®æ”¹ MyApp ä¸­çš„`on_lbtnup`ï¼Œä¼ å…¥æ™ºèƒ½æŒ‡é’ˆã€‚\n```cpp\n// MyApp.h\n\n// ...\n\nclass MyApp\n{\npublic:\n    \n    // ...\n\n    bool on_lbtnup(POINT& pt)\n    {\n        // ...\n        LineManager::instance_ptr()->add_line(std::shared_ptr<Line>(new Line{ _pt, pt }));\n        // ...\n    }\nprivate:\n    // ...\n}\n```\n## å•ä¾‹å¯¹è±¡çš„æ™ºèƒ½æŒ‡é’ˆç®¡ç†ï¼šè‡ªå®šä¹‰deleter\n\n```cpp\n// LineManager.h\n// ...\nclass LineManager\n{\npublic:\n    static std::shared_ptr<LineManager> instance_ptr(void);\n    // ...\nprivate:\n    // ...\nprivate:\n    static std::shared_ptr<LineManager>  _manager;\n    std::list<std::shared_ptr<Line>>     _line_container;\n};\n```\nå› ä¸ºæ”¹ç”¨æ™ºèƒ½æŒ‡é’ˆæ¥ç®¡ç†æ­¤å•ä¾‹å¯¹è±¡äº†ï¼Œæ‰€ä»¥ä¹‹å‰å…¶æ¶‰åŠåˆ°å•ä¾‹å¯¹è±¡çš„newã€deleteçš„å‡½æ•°éƒ½éœ€è¦ä¿®æ”¹ã€‚\n```cpp\n// LineManager.cpp\nconstinit std::shared_ptr<LineManager> LineManager::_manager{ nullptr };\n\nstd::shared_ptr<LineManager> LineManager::instance_ptr(void)\n{\n    if(!_manager)\n        // error\n        _manager = std::shared_ptr<LineManager>(new LineManager /* éœ€è¦ä¸€ä¸ªdeleter */);\n    return _manager;\n}\nLineManager& LineManager::instance(void)\n{\n    if(!_manager)\n        // error\n        _manager = std::shared_ptr<LineManager>(new LineManager /* éœ€è¦ä¸€ä¸ªdeleter */);\n    return *_manager;\n}\nvoid LineManager::destroy_instance(void)\n{\n    if(_manager)\n    {\n        // æ— éœ€delete\n        _manager = nullptr;\n    }\n}\n```\nç”±äº`shared_ptr`åœ¨é”€æ¯æ—¶ï¼Œé»˜è®¤ç»‘å®šçš„deleteréœ€è¦è®¿é—®`LineManager`çš„ææ„å‡½æ•°ï¼Œè€Œå•ä¾‹çš„ææ„å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œå› æ­¤éœ€è¦åŠ ä¸€ä¸ªè‡ªå®šä¹‰deleterã€‚\n```cpp\n// LineManager.cpp\nstd::shared_ptr<LineManager> LineManager::instance_ptr(void)\n{\n    if(!_manager)\n        _manager = std::shared_ptr<LineManager>(new LineManager, [](LineManager* p) { delete p; });\n    return _manager;\n}\nLineManager& LineManager::instance(void)\n{\n    if(!_manager)\n        _manager = std::shared_ptr<LineManager>(new LineManager, [](LineManager* p) { delete p; });\n    return *_manager;\n}\n```\n### æ›´ç®€æ´çš„deleter\nå•ç‹¬å®šä¹‰ä¸€ä¸ªç±»ä¸­privateçš„deleterå‡½æ•°ã€‚\n>å¦‚æœä¸å†™æˆé™æ€çš„ï¼Œä¼ deleteræ—¶è¿˜éœ€è¦binderæ­¤å¯¹è±¡çš„thisæŒ‡é’ˆï¼Œå¤±å»äº†ç®€æ´æ€§ã€‚\n```cpp\n// LineManager.h\n// ...\nclass LineManager\n{\npublic:\n    // ...\nprivate:\n    // ...\n    static void manager_deleter(LineManager* p);\nprivate:\n    // ...\n};\n```\nå®ç°\n```cpp\n// LineManager.cpp\nvoid LineManager::manager_deleter(LineManager* p)\n{\n    if (p)\n    {\n        delete p;\n    }\n}\nstd::shared_ptr<LineManager> LineManager::instance_ptr(void)\n{\n    if(!_manager)\n        _manager = std::shared_ptr<LineManager>(new LineManager, &LineManager::manager_deleter);\n    return _manager;\n}\nLineManager& LineManager::instance(void)\n{\n    if(!_manager)\n        _manager = std::shared_ptr<LineManager>(new LineManager, &LineManager::manager_deleter);\n    return *_manager;\n}\n```\n### destroy_instance å’Œ deleter çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ\næˆ‘ä»¬å‘ç°ï¼Œå•ä¾‹ç±»è‡ªå·±ä¹Ÿæœ‰ä¸€ä¸ª destroy_instance ï¼Œè¿™ä¸ªæ˜¯ç”¨æˆ·è‡ªå·±è°ƒç”¨çš„ã€‚\n\ndeleteræ˜¯æ™ºèƒ½æŒ‡é’ˆç®¡ç†çš„ï¼Œåœ¨newçš„æ—¶å€™ï¼Œå°±è¦åŒæ—¶ç»‘å®šæ­¤deleterï¼Œå½“æ—¶deleterå·²ç»è®°å½•ä¸‹æ¥newè¿”å›çš„è£¸æŒ‡é’ˆpäº†ï¼Œåœ¨æ²¡æœ‰ä»»ä½•ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆå¼•ç”¨æ­¤å¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œå°±ä¼šé€šè¿‡delete pæ¥è¿›è¡Œå¯¹è±¡çš„ææ„ã€‚\nåœ¨æ™ºèƒ½æŒ‡é’ˆæ¥ç®¡ä¹‹å‰ï¼Œ`delete _manager`çš„æ“ä½œæ˜¯æˆ‘ä»¬ç”¨æˆ·è‡ªå·±åœ¨destroy_instanceä¸­è¿›è¡Œçš„ï¼Œè€Œåè¿˜è¦ç½®ç©º`_manager = nullptr`ã€‚\n\nç°åœ¨æ™ºèƒ½æŒ‡é’ˆæ¥ç®¡ä¹‹åï¼Œæ˜¯å¦å¯ä»¥æŠŠdestroy_instance æ–¹æ³•åˆ é™¤å‘¢ï¼Ÿ\nä¸å¯ä»¥ã€‚\nè™½ç„¶æˆ‘ä»¬æ— éœ€è‡ªå·±`delete _manager`ï¼Œä½†ä»éœ€è¦`_manager = nullptr`ï¼Œå› æ­¤ destroy_instance è¿˜æ˜¯æœ‰ç”¨çš„ï¼Œå³æŒ‡é’ˆç½®ç©ºæ“ä½œã€‚","categories":["è®¾è®¡æ¨¡å¼","Windows"]},{"title":"Windows_wcharå’Œwmain","url":"/Windows/Windows_wcharå’Œwmain/","content":"# å­—ç¬¦é›†\nCharacter Set\n\nchar - 1 Byte - 8 bit - ASCII\n\nå‚è€ƒï¼šASCIIå’ŒANSI [Ascii Codes - C++ Tutorials (cplusplus.com)](https://legacy.cplusplus.com/doc/ascii/)\n## ANSIç \n\nANSIç ä»…åœ¨å‰128ï¼ˆ0-127ï¼‰ä¸ªä¸ASCIIç ç›¸åŒï¼Œä¹‹åçš„å­—ç¬¦å…¨æ˜¯æŸä¸ªå›½å®¶è¯­è¨€çš„æ‰€æœ‰å­—ç¬¦ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸¤ä¸ªå­—èŠ‚æœ€å¤šå¯ä»¥å­˜å‚¨çš„å­—ç¬¦æ•°ç›®æ˜¯2çš„16æ¬¡æ–¹ï¼Œå³65536ä¸ªå­—ç¬¦ï¼Œè¿™å¯¹äºä¸€ä¸ªè¯­è¨€çš„å­—ç¬¦æ¥è¯´ï¼Œç»å¯¹å¤Ÿäº†ã€‚è¿˜æœ‰ANSIç¼–ç å…¶å®åŒ…æ‹¬å¾ˆå¤šç¼–ç ï¼šä¸­å›½åˆ¶å®šäº†GB2312ç¼–ç ï¼Œç”¨æ¥æŠŠä¸­æ–‡ç¼–è¿›å»å¦å¤–ï¼Œæ—¥æœ¬æŠŠæ—¥æ–‡ç¼–åˆ°Shift_JISé‡Œï¼ŒéŸ©å›½æŠŠéŸ©æ–‡ç¼–åˆ°Euc-kré‡Œï¼Œå„å›½æœ‰å„å›½çš„æ ‡å‡†ã€‚å—åˆ¶äºå½“æ—¶çš„æ¡ä»¶ï¼Œä¸åŒè¯­è¨€ä¹‹é—´çš„ANSIç ä¹‹é—´ä¸èƒ½äº’ç›¸è½¬æ¢ï¼Œè¿™å°±ä¼šå¯¼è‡´åœ¨å¤šè¯­è¨€æ··åˆçš„æ–‡æœ¬ä¸­ä¼šæœ‰ä¹±ç ã€‚\n## Unicodeç¼–ç \n\nä¸ºäº†è§£å†³ä¸åŒå›½å®¶ANSIç¼–ç çš„å†²çªé—®é¢˜ï¼ŒUnicodeåº”è¿è€Œç”Ÿï¼šå¦‚æœå…¨ä¸–ç•Œæ¯ä¸€ä¸ªç¬¦å·éƒ½ç»™äºˆä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ç¼–ç ï¼Œé‚£ä¹ˆä¹±ç é—®é¢˜å°±ä¼šæ¶ˆå¤±ã€‚è¿™å°±æ˜¯Unicodeï¼Œå°±åƒå®ƒçš„åå­—éƒ½è¡¨ç¤ºçš„ï¼Œè¿™æ˜¯ä¸€ç§æ‰€æœ‰ç¬¦å·çš„ç¼–ç ã€‚\n\nUnicodeæ ‡å‡†ä¹Ÿåœ¨ä¸æ–­å‘å±•ï¼Œä½†æœ€å¸¸ç”¨çš„æ˜¯ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼ˆå¦‚æœè¦ç”¨åˆ°éå¸¸ååƒ»çš„å­—ç¬¦ï¼Œå°±éœ€è¦4ä¸ªå­—èŠ‚ï¼‰ã€‚ç°ä»£æ“ä½œç³»ç»Ÿå’Œå¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€éƒ½ç›´æ¥æ”¯æŒUnicodeã€‚\n\nä½†æ˜¯é—®é¢˜åœ¨äºï¼ŒåŸæœ¬å¯ä»¥ç”¨ä¸€ä¸ªå­—èŠ‚å­˜å‚¨çš„è‹±æ–‡å­—æ¯åœ¨Unicodeé‡Œé¢å¿…é¡»å­˜ä¸¤ä¸ªå­—èŠ‚ï¼ˆè§„åˆ™å°±æ˜¯åœ¨åŸæ¥è‹±æ–‡å­—æ¯å¯¹åº”ASCIIç å‰é¢è¡¥0ï¼‰ï¼Œè¿™å°±äº§ç”Ÿäº†æµªè´¹ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§æ—¢èƒ½æ¶ˆé™¤ä¹±ç ï¼Œåˆèƒ½é¿å…æµªè´¹çš„ç¼–ç æ–¹å¼å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯UTF-8ï¼\n## UTF-8ç¼–ç \n\nè¿™æ˜¯ä¸€ç§å˜é•¿çš„ç¼–ç æ–¹å¼ï¼šå®ƒå¯ä»¥ä½¿ç”¨1~4ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªç¬¦å·ï¼Œæ ¹æ®ä¸åŒçš„ç¬¦å·è€Œå˜åŒ–å­—èŠ‚é•¿åº¦ï¼Œå½“å­—ç¬¦åœ¨ASCIIç çš„èŒƒå›´æ—¶ï¼Œå°±ç”¨ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œä¿ç•™äº†ASCIIå­—ç¬¦ä¸€ä¸ªå­—èŠ‚çš„ç¼–ç åšä¸ºå®ƒçš„ä¸€éƒ¨åˆ†ï¼Œå¦‚æ­¤ä¸€æ¥UTF-8ç¼–ç ä¹Ÿå¯ä»¥æ˜¯ä¸ºè§†ä¸ºä¸€ç§å¯¹ASCIIç çš„æ‹“å±•ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯unicodeç¼–ç ä¸­ä¸€ä¸ªä¸­æ–‡å­—ç¬¦å 2ä¸ªå­—èŠ‚ï¼Œè€ŒUTF-8ä¸€ä¸ªä¸­æ–‡å­—ç¬¦å 3ä¸ªå­—èŠ‚ã€‚ä»unicodeåˆ°uft-8å¹¶ä¸æ˜¯ç›´æ¥çš„å¯¹åº”ï¼Œè€Œæ˜¯è¦è¿‡ä¸€äº›ç®—æ³•å’Œè§„åˆ™æ¥è½¬æ¢ã€‚\n\nåœ¨è®¡ç®—æœºå†…å­˜ä¸­ï¼Œç»Ÿä¸€ä½¿ç”¨Unicodeç¼–ç ï¼Œå½“éœ€è¦ä¿å­˜åˆ°ç¡¬ç›˜æˆ–è€…éœ€è¦ä¼ è¾“çš„æ—¶å€™ï¼Œå°±è½¬æ¢ä¸ºUTF-8ç¼–ç ã€‚\n\nç”¨è®°äº‹æœ¬ç¼–è¾‘çš„æ—¶å€™ï¼Œä»æ–‡ä»¶è¯»å–çš„UTF-8å­—ç¬¦è¢«è½¬æ¢ä¸ºUnicodeå­—ç¬¦åˆ°å†…å­˜é‡Œï¼Œç¼–è¾‘å®Œæˆåï¼Œä¿å­˜çš„æ—¶å€™å†æŠŠUnicodeè½¬æ¢ä¸ºUTF-8ä¿å­˜åˆ°æ–‡ä»¶ã€‚\n# Unicodeå¯¹åº”çš„å­—ç¬¦ç±»å‹ - wchar\n\nUnicodeå¯¹åº”çš„å­—ç¬¦ç±»å‹ä¸º`wchar_t`ã€‚æ‰“å°sizeofä¸º2ï¼Œå³å å¤§å°ä¸º2å­—èŠ‚ã€16ä½ã€‚\n```cpp\n#include<iostream>\nint main()\n{\nÂ Â Â  std::cout << sizeof(wchar_t);\nÂ Â Â  return 0;\n}\n```\n1. åˆå§‹åŒ–ä¸€ä¸ªUnicodeå­—ç¬¦ä¸²ã€‚éœ€è¦åœ¨\"åŒå¼•å·\"å‰åŠ `L`ï¼Œè¡¨ç¤ºä½¿ç”¨Unicodeå­—ç¬¦é›†ä¸²ã€‚\n2. å¦‚æœè¦æ­£å¸¸æ‰“å°Unicodeå­—ç¬¦ä¸²ï¼Œéœ€è¦ä½¿ç”¨`std::wcout`ã€‚\n3. Cppä¸­ä¹Ÿæœ‰Unicodeå­—ç¬¦ä¸²å¯¹åº”çš„ç±»ï¼Œæ˜¯`std::wstring`ã€‚\n```cpp\n#include<iostream>\nint main()\n{\nÂ Â Â  // wchar_t str[] = \"Hello\";  // é”™è¯¯ï¼Œ\"Hello\"é»˜è®¤ä¸ºANSIå­—ç¬¦é›†ä¸²\nÂ Â Â  wchar_t str[] = L\"Hello\";\nÂ Â Â  std::cout  << sizeof str << std::endl; // è¾“å‡º 12. Hello 5ä¸ª åŠ  1ä¸ªå“¨å…µä½ï¼Œä¹˜ä»¥2\nÂ Â Â  std::wcout << str;                     // è¾“å‡º Hello\nÂ Â Â  \nÂ Â Â  // Cppä¸­çš„Unicodeå­—ç¬¦ä¸²\nÂ Â Â  std::wstring test = str;\nÂ Â Â  std::wcout << test;\n}\n```\n## Cä¸­çš„wcharåº“\næ–°æ ‡å‡†å†™æ³•ä¸ºcwchar\n[cwchar (wchar.h) - C++ Reference (cplusplus.com)](https://legacy.cplusplus.com/reference/cwchar/)\n\nCè¯­è¨€æ ‡å‡†åº“ä¸­ä¹Ÿæä¾›äº†å¯¹wcharçš„æ”¯æŒï¼Œè¾“å‡ºç”¨`wprintf`ã€‚åŒºåˆ«ä¸º\"åŒå¼•å·\"å‰è¦åŠ `L`ã€‚\nç›¸åº”äºæ™®é€šçš„strcatã€strcmpã€strcpyã€strlenç­‰ï¼Œéƒ½å¯ç”¨wcså¼€å¤´çš„wcscatç­‰ä»£æ›¿ã€‚\n>Cppä¸­çš„å®½å­—ç¬¦è¾“å‡ºæµä¸ºï¼š`std::wcout`\n```c\n#include<cwchar>\nint main()\n{\n    wchar_t str[] = L\"Hello\";\n    wprintf(L\"%s\\n\", str);      // è®°å¾—åŠ L.  è¾“å‡ºHello\n}\n```\n# wmain\n\n```cpp\nint main(int ac, char * av[]) // mainå…¥å£ + æ™®é€šçš„char * []\n{\n    for(int i = 0; i < ac; ++i)\n    {\n        std::cout << av[i] << std::endl; // cout\n    }\n}\n```\n\n```cpp\nint wmain(int ac, wchar_t * av[]) // wmainå…¥å£ + wchar_t * []\n{\n    for(int i = 0; i < ac; ++i)\n    {\n        std::wcout << av[i] << std::endl;// wcout\n    }\n}\n```\n# ç¬¬ä¸€ä¸ªWindowsç¨‹åº\n\nä¸éµå¾ªANSIã€ISOæ ‡å‡†ï¼Œæ˜¯Windowså¹³å°ä¸‹ç¨‹åºçš„å…¥å£ã€‚\nä½¿ç”¨Windows.håº“ï¼Œæ˜¯Windowsç³»ç»Ÿè‡ªå¸¦çš„SDKã€‚\n\n```cpp\n#include <iostream>\n#include <Windows.h>\n\nint wWinMain(\n        HINSTANCE hInstance,\n        HINSTANCE hPrevInstance,\n        LPWSTR lpCmdLine,\n        int nShowCmd)\n{\n    return 0;\n}\n```\n\n>ç¼–è¯‘ä¹‹å‰ï¼Œè¦é…ç½®å¥½VSé¡¹ç›®çš„å±æ€§ï¼Œå³é”®é¡¹ç›®é€‰æ‹©Propertiesï¼Œå·¦è¾¹æ é€‰æ‹©Linkerï¼Œç„¶åé€‰æ‹©Systemã€‚å³è¾¹è¯¦ç»†æ¡ç›®\"SubSystem\"éœ€ä¸‹æ‹‰é€‰æ‹©Windowsã€‚\n\nå¦‚æœç›´æ¥return 0ï¼Œä¸ä¼šå‡ºç°çª—å£ï¼Œç¨‹åºç›´æ¥é€€å‡ºã€‚\nå¦‚æœæƒ³è¦å‡ºç°çª—å£ï¼Œåˆ™éœ€è¦åŠ è¯­å¥ï¼š\n```cpp\n{\n    ::MessageBox(nullptr, L\"First App\", L\"cap\", MB_OK);\n}\n```\n>MessageBox API: \n>`int MessageBoxW(HWND hWnd, LPCWSTR lpText, LPCWSTR lpCaption, UINT uType)`\n>hWndè¡¨ç¤ºçª—å£å¥æŸ„ã€‚\n>lpTextè¡¨ç¤ºæ˜¾ç¤ºæ–‡æœ¬ã€‚\n>lpCaptionè¡¨ç¤ºçª—å£æ ‡é¢˜ã€‚\n>uTypeè¡¨ç¤ºæ˜¾ç¤ºçš„æŒ‰é’®æ˜¯ä»€ä¹ˆç±»å‹ã€‚æˆ‘ä»¬åœ¨æ­¤ä¾‹ä¸­ä½¿ç”¨`MB_OK`è¿™ä¸ªå€¼ã€‚æœ‰å…³äºæ­¤çš„å‚è€ƒæ–‡æ¡£ï¼Œå¯ä»¥è¿›å…¥[learn.microsoft.com](https://learn.microsoft.com)ï¼Œåœ¨è¾“å…¥æ¡†æœç´¢\"messagebox\"ã€‚æœç´¢ç»“æœæŸ¥çœ‹`MessageBox function (winuser.h) - Win32 apps`\n>\n>LPCWSTRè¡¨ç¤ºLong Pointer Const Wide Stringã€‚\n>å…³äºLPï¼šWindows 3.2ç‰ˆæœ¬ä»¥å‰ç”±äºå†…å­˜åˆ†æ®µçš„åŸå› ï¼Œè¦åŒºåˆ†é•¿çŸ­æŒ‡é’ˆã€‚ä½†æ˜¯ç°åœ¨å†…å­˜ä¸åˆ†æ®µäº†ï¼Œæ˜¯å¹³å¦æ¨¡å¼ï¼Œå› æ­¤é•¿çŸ­æŒ‡é’ˆä¸åŒºåˆ†äº†ã€‚\n>å› æ­¤åªéœ€è¦å…³æ³¨CWSTRï¼šæ¯”å¦‚`L\"Hello First Windows Program\"`\n\nè¿è¡Œæ•ˆæœï¼šå‡ºç°ä¸€ä¸ªå¦‚ä¸‹çš„çª—å£ï¼Œç¨‹åºä¼šé˜»å¡äºæ­¤ï¼Œå½“ç‚¹å‡»OKæŒ‰é’®æ—¶ï¼Œç¨‹åºæ‰ä¼šç»§ç»­æ‰§è¡Œã€‚\n![](../../images/Windows_wcharå’Œwmain/image-20240623234329264.png)\n# çª—å£ç¨‹åº\n\nå¤šä¸ªç¨‹åºå…±äº«ä¸€ä¸ªçª—å£ã€‚\n\n## å¼±åŒ–æµç¨‹â€”â€”åŸºäºæ¶ˆæ¯é©±åŠ¨\n\nè§£å†³æŠ¢èµ„æºçš„é—®é¢˜ï¼Œä»¥å‰æ˜¯é”ï¼Œæ˜¯èµ„æºæŠ¢å å½¢å¼ï¼Œä¸å¤ªå¥½ã€‚ç°åœ¨ï¼Œè®©å¤šä¸ªäººå…±äº«åŒä¸€ç§èµ„æºï¼Œæœ€å¥½çš„åŠæ³•è¯´ç™½äº†å°±æ˜¯æ’é˜Ÿã€‚æ’é˜Ÿéœ€è¦ä¼˜å…ˆçº§ï¼Œæ¯”å¦‚æ—¶é—´å…ˆåé¡ºåºã€‚é‚£å°±éœ€è¦ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆæ¶ˆæ¯å¾ªç¯ï¼‰ã€‚\nè¿™äº›æ¶ˆæ¯å¯èƒ½æ˜¯å¹¶è¡Œçš„ï¼Œéœ€è¦ä¸²è¡ŒåŒ–åè¿›å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä»é˜Ÿåˆ—ä¸­ä¸æ–­å–æ¶ˆæ¯ï¼ŒæŠŠæ¶ˆæ¯ä¸€ä¸ªä¸€ä¸ªåœ°æŠ•æ”¾åˆ°ç›®æ ‡çª—å£ã€‚\n## Windowsä¸‹çš„é¢å‘å¯¹è±¡\n\nWindowsç¼–ç¨‹ï¼ŒWindows SDKæˆ–Win32ï¼Œæ˜¯ä¸€ä¸ªé¢å‘å¯¹è±¡çš„ç¨‹åºè®¾è®¡æ–¹æ³•ã€‚è™½ç„¶1985å¹´`C++`é¢å‘å¯¹è±¡è¯­è¨€æ‰å‡ºæ¥ï¼Œåœ¨è¿™ä¹‹å‰å¤§å¤šæ•°æ˜¯ç”¨Cè¯­è¨€å¼€å‘ï¼Œä½†è¿™ä¸æ˜¯è¯´ç”¨ä¸äº†é¢å‘å¯¹è±¡çš„æ€æƒ³ã€‚\n\nå‡è®¾æ•´ä¸ªåº”ç”¨ç¨‹åºæŠ½è±¡ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½æœ‰å¤šä¸ªçª—å£ï¼Œæ¯ä¸ªçª—å£æ˜¯ä¸€ä¸ªçª—å£å¯¹è±¡ï¼Œæ­¤çª—å£å¯¹è±¡çš„æ•°æ®ç»“æ„å­˜åœ¨äºæ“ä½œç³»ç»Ÿçš„å†…éƒ¨ï¼ˆå› æ­¤ä¹Ÿå«å†…æ ¸å¯¹è±¡ (Kernel Object)ï¼‰ï¼Œæ¯ä¸ªçª—å£å¯¹è±¡æœ‰ä¸€ä¸ªå¯¹åº”çš„Handleï¼Œå³å¥æŸ„ï¼Œå­—é¢æ„ä¹‰ä¸Šæ˜¯æŠŠæ‰‹ï¼Œå½¢å®¹å¯ä»¥ç”¨æ­¤æŠŠæ‰‹æèµ·ä¸€ä¸ªç®±å­ã€‚\n\nä¸Linuxæ€æƒ³ä¸åŒï¼ŒLinuxæ˜¯ä¸€åˆ‡çš†æ–‡ä»¶ï¼Œè€ŒWindowsæ˜¯ä¸€åˆ‡çš†çª—å£ï¼Œåœ¨å…¶ä¸­ï¼Œçª—å£ä¹Ÿè§†ä¸ºä¸€ç§å†…æ ¸å¯¹è±¡ã€‚\n\næƒå¨æ•™ææè¿°ï¼š\n1. Programming Windows - Charles Petzold\n2. Windowsæ ¸å¿ƒç¼–ç¨‹ï¼ˆWindows via `C/C++`ï¼‰\n## wWinMainè§£æ\n\n1. HINSTANCEï¼šåº”ç”¨ç¨‹åºçš„å¥æŸ„ç±»å‹ï¼ŒHä»£è¡¨å¥æŸ„ã€‚\n2. nShowCmdï¼šé¢„è®¾çš„å€¼ä»¥åŠå«ä¹‰è§[ShowWindow function (winuser.h) - Win32 apps | Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-showwindow)ä¸­çš„Parametersã€‚å¯ä»¥ç”¨äºæ§åˆ¶çª—å£çš„æ˜¾ç¤ºã€éšè—ç­‰ã€‚\n\nåº”ç”¨ç¨‹åºåˆ›å»ºçª—å£é¦–å…ˆéœ€è¦ä¸€ä¸ªå¯¹è±¡ã€‚\n\nWNDCLASSEXæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œç”¨äºå®šä¹‰çª—å£ç±»ã€‚å› ä¸ºå½“æ—¶æ²¡æœ‰é¢å‘å¯¹è±¡è¯­è¨€ï¼Œéœ€è¦æŠŠè¯¥ç±»æ³¨å†Œç»™æ“ä½œç³»ç»Ÿï¼Œè®©æ“ä½œç³»ç»Ÿåœ¨å†…éƒ¨ç”Ÿæˆå†…æ ¸å¯¹è±¡ã€‚\n[About Window Classes - Win32 apps | Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/winmsg/about-window-classes)\n\n[WNDCLASSEXA (winuser.h) - Win32 apps | Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/api/winuser/ns-winuser-wndclassexa)\n\n1. ç¬¬ä¸€æ­¥å…ˆåˆå§‹åŒ–çª—å£ç±»å¯¹è±¡çš„æˆå‘˜å€¼ã€‚\n    1. lpfnWndProcï¼šæ˜¯WNDPROCç±»å‹ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªå‡½æ•°æŒ‡é’ˆã€‚[WNDPROC - Win32 apps | Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/api/winuser/nc-winuser-wndproc)ã€‚\n2. æ³¨å†Œè¯¥çª—å£ç±»å¯¹è±¡ã€‚ä¹‹åæ“ä½œç³»ç»Ÿå°±çŸ¥é“äº†è¯¥çª—å£ç±»çš„å­˜åœ¨ã€‚\n    1. [RegisterClassExW function (winuser.h) - Win32 apps | Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-registerclassexw)\n    2. å¦‚æœæ³¨å†ŒæˆåŠŸï¼Œè¿”å›ä¸€ä¸ªéé›¶çš„ç±»åŸå­å€¼ï¼Œå”¯ä¸€æ ‡è¯†è¯¥ç±»ã€‚If the function succeeds, the return value is a class atom that uniquely identifies the class being registered. This atom can only be used by theÂ [CreateWindow](https://learn.microsoft.com/en-us/windows/desktop/api/winuser/nf-winuser-createwindowa),Â [CreateWindowEx](https://learn.microsoft.com/en-us/windows/desktop/api/winuser/nf-winuser-createwindowexa),Â [GetClassInfo](https://learn.microsoft.com/en-us/windows/desktop/api/winuser/nf-winuser-getclassinfoa),Â [GetClassInfoEx](https://learn.microsoft.com/en-us/windows/desktop/api/winuser/nf-winuser-getclassinfoexa),Â [FindWindow](https://learn.microsoft.com/en-us/windows/desktop/api/winuser/nf-winuser-findwindowa),Â [FindWindowEx](https://learn.microsoft.com/en-us/windows/desktop/api/winuser/nf-winuser-findwindowexa), andÂ [UnregisterClass](https://learn.microsoft.com/en-us/windows/desktop/api/winuser/nf-winuser-unregisterclassa)Â functions and theÂ `IActiveIMMap::FilterClientWindows`Â method.\n    3. If the function fails, the return value is zero. To get extended error information, callÂ [GetLastError](https://learn.microsoft.com/en-us/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror).\n3. æ“ä½œç³»ç»Ÿä»¥åå­—â€”â€”`lpszClassName`è®¿é—®ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰è¯¥å˜é‡ï¼Œå°±ä¸è®¤è¯†äº†ã€‚\n4. ç”¨æ³¨å†ŒæˆåŠŸçš„ç±»æ¥åˆ›å»ºçª—å£ï¼Œè°ƒç”¨CreateWindowExï¼Œè¿”å›çª—å£å¥æŸ„ã€‚\n    1. CreateWindowExçš„å‚æ•°æ¥å®šä¹‰åˆ›å»ºçš„çª—å£çš„å±æ€§ã€‚\n        1. [CreateWindowExW function (winuser.h) - Win32 apps | Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-createwindowexw)\n        2. ç¬¬ä¸€ä¸ªå‚æ•°dwExStyleï¼š[Extended Window Styles (Winuser.h) - Win32 apps | Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/winmsg/extended-window-styles)ã€‚è¡¨ç¤ºæ ·å¼ã€‚æˆ‘ä»¬æš‚ç”¨`WS_EX_OVERLAPPEDWINDOW`ã€‚\n        3. ç¬¬äºŒä¸ªå‚æ•°lpClassNameï¼šçª—å£ç±»åã€‚æŒ‡å®šç”¨å“ªä¸ªçª—å£ç±»æ¥åˆ›å»ºçª—å£çš„å®ä¾‹ï¼Œç”¨çª—å£ç±»æ³¨å†Œçš„åå­—ç´¢å¼•ã€‚\n        4. ç¬¬ä¸‰ä¸ªå‚æ•°lpWindowNameï¼šçª—å£çš„æ ‡é¢˜ã€‚\n        5. ç¬¬å››ä¸ªå‚æ•°dwStyleï¼šå’Œç¬¬ä¸€ä¸ªå‚æ•°dwExStyleç›¸æ¯”æ˜¯åŸºç¡€çš„ï¼ŒExè¡¨ç¤ºæ‹“å±•ã€‚æˆ‘ä»¬æš‚ç”¨`WS_OVERLAPPEDWINDOW`ã€‚å…·ä½“å€¼ä¸ºï¼š`WS_OVERLAPPED | WS_CAPTIONï¼ˆæ ‡é¢˜æ ï¼‰ | WS_SYSMENUï¼ˆèœå•ï¼‰ | WS_THICKFRAME | WS_MINIMIZEBOXï¼ˆæœ€å°åŒ–æŒ‰é’®ï¼‰ | WS_MAXIMIZEBOXï¼ˆæœ€å¤§åŒ–æŒ‰é’®ï¼‰`ã€‚\n        6. ç¬¬5ã€6ä¸ªå‚æ•°Xã€Yï¼šè¡¨ç¤ºçª—å£çš„èµ·å§‹åæ ‡ã€‚\n        7. ç¬¬7ã€8ä¸ªå‚æ•°nWidthã€nHeightï¼šåˆ†åˆ«è¡¨ç¤ºå®½åº¦ã€é«˜åº¦ã€‚\n        8. ç¬¬9ä¸ªå‚æ•°hWndParentï¼šè¡¨ç¤ºçˆ¶çª—å£å¥æŸ„ï¼Œè‹¥æ— åˆ™å¡«NULLæˆ–nullptrã€‚\n        9. ç¬¬10ä¸ªå‚æ•°hMenuï¼šMenuæ å¥æŸ„ï¼Œè‹¥æ— åˆ™å¡«NULLæˆ–nullptrã€‚\n        10. ç¬¬11ä¸ªå‚æ•°hInstanceï¼šæ•´ä¸ªåº”ç”¨ç¨‹åºçš„å¥æŸ„ã€‚\n        11. ç¬¬12ä¸ªå‚æ•°lpParamï¼šç‰¹æ®Šã€é¢å¤–çš„å‚æ•°ã€‚è‹¥æ— åˆ™å¡«NULLæˆ–nullptrã€‚\n5. æ˜¾ç¤ºçª—å£ã€æ›´æ–°çª—å£ã€‚åˆ›å»ºå®Œçª—å£åï¼Œå°±äº¤ç”±Windowsç³»ç»Ÿç®¡ç†äº†ã€‚\n6. å¼€å§‹æ¶ˆæ¯å¾ªç¯ã€‚è°ƒç”¨GetMessageä»å½“å‰çš„åº”ç”¨ç¨‹åºé˜Ÿåˆ—ä¸­è·å¾—æ¶ˆæ¯ï¼Œé˜Ÿåˆ—æ˜¯æ“ä½œç³»ç»Ÿå†…éƒ¨æä¾›çš„ã€‚[GetMessage function (winuser.h) - Win32 apps | Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-getmessage)\n    1. ç¬¬ä¸€ä¸ªå‚æ•°lpMsgï¼Œæ”¾å…¥ä¸€ä¸ªMSGç±»å‹çš„æŒ‡é’ˆï¼Œç”¨äºè·å–æ¶ˆæ¯åå¡«å……ç»™å®ƒã€‚MSGæ˜¯ä¸ªç»“æ„ä½“ã€‚\n        1. MSGç»“æ„ä½“æˆå‘˜ï¼šhwndã€messageã€wParamã€lParamã€timeã€pt\n    2. ç¬¬äºŒä¸ªå‚æ•°hWndï¼ŒæŒ‡å®šåº”ç”¨ç¨‹åºçš„æŸä¸ªçª—å£ã€‚å¦‚æœå¡«nullptrè¡¨ç¤ºæŒ‡å®šæ‰€æœ‰çª—å£ã€‚\n    3. ç¬¬ä¸‰ã€å››å‚æ•°wMsgFilterMinã€wMsgFilterMaxï¼ŒæŒ‡å®šå…³æ³¨æ¶ˆæ¯çš„å·æ®µã€‚å¦‚æœå…¨å¡«0ï¼Œè¡¨ç¤ºå…³æ³¨æ‰€æœ‰æ¶ˆæ¯ã€‚\n    4. è¿”å›BOOLã€‚æ­£å¸¸åˆ™è¿”å›éé›¶ï¼Œç»§ç»­å¾ªç¯ï¼›å¦‚æœæ”¶åˆ°çš„æ¶ˆæ¯æ˜¯`WM_QUITï¼ˆ0x0012ï¼‰`ï¼Œåˆ™è¿”å›0é€€å‡ºå¾ªç¯ã€‚\n7. å¾ªç¯é€€å‡ºåˆ™ç¨‹åºç»“æŸã€‚\n```cpp\nint wWinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPWSTR lpCmdLine, int nShowCmd)\n{\n    std::wstring app_name{ L\"First App\" };\n\n    WNDCLASSEX wcex = { 0 };\n    wcex.cbSize = sizeof(wcex);\n    wcex.style = CS_HREDRAW | CS_VREDRAW;\n    // ç»‘å®šCALLBACKï¼Œè§åé¢è§£é‡Š\n    wcex.lpfnWndProc = &window_procedure;\n    // wcex.... = ...;\n    wcex.lpszClassName = app_name.c_str();\n    // wcex.... = ...;\n    \n\n    if (!::RegisterClassEx(&wcex))\n    {\n        return -1;\n    }\n    // å®šä¹‰ä¸€ä¸ªçª—å£å¯¹è±¡çš„å¥æŸ„\n    // HWND: çª—å£ç±»å‹çš„å¥æŸ„ï¼Œä¹Ÿå«å†…æ ¸å¯¹è±¡\n    HWND hWnd = ::CreateWindowEx(\n        WS_EX_OVERLAPPEDWINDOW,\n        app_name.c_str(),\n        L\"App\",\n        WS_OVERLAPPEDWINDOW,\n        CW_USEDEFAULT, 0, CW_USEDEFAULT, 0,\n        nullptr,\n        nullptr,\n        hInstance,\n        nullptr);\n    if (!hWnd)\n    {\n        int i = ::GetLastError();\n        return -1;\n    }\n    // æ˜¾ç¤ºçª—å£ï¼ŒnShowCmdå¯ä»¥æŒ‡å®šçª—å£ä»¥æœ€å°/æœ€å¤§/æ­£å¸¸çŠ¶æ€æ˜¾ç¤º\n    ShowWindow(hWnd, nShowCmd);\n    // æ›´æ–°çª—å£ï¼Œç»˜åˆ¶çª—å£ã€‚åˆšæ˜¾ç¤ºå‡ºæ¥å¯èƒ½æ˜¯æ— æ•ˆçš„ï¼Œéœ€è¦åœ¨æ˜¾ç¤ºåç»˜åˆ¶ã€‚\n    UpdateWindow(hWnd);\n\n    MSG msg;\n    while (::GetMessage(&msg, nullptr, 0, 0))\n    {\n        // ç¿»è¯‘æ¶ˆæ¯ï¼Œæ¯”å¦‚è¾“å…¥æ³•é€šè¿‡â€˜woâ€™ç”Ÿæˆâ€˜æˆ‘â€™\n        ::TranslateMessage(&msg);\n        // å‘é€æ¶ˆæ¯ï¼Œè°ƒç”¨åˆšæ‰æ³¨å†Œçš„callbackçª—å£å¤„ç†å‡½æ•°\n        ::DispatchMessage(&msg);\n    }\n\n    return 0;\n}\n```\nå…¶ä¸­ï¼ŒCALLBACKå‡½æ•°å¦‚ä¸‹ï¼šmessageæ˜¯æ¶ˆæ¯ç±»å‹ï¼Œä¸ºunsigned \n```cpp\n// æŒ‰ç…§WNDPROCçš„åŸå‹å®šä¹‰ï¼Œè¿”å›é»˜è®¤çš„DefWindowProc\nLRESULT CALLBACK window_procedure(HWND wnd, UINT message, WPARAM wparam, LPARAM lparam)\n{\n    return ::DefWindowProc(wnd, message, wparam, lparam);\n}\n```\nä»¥ä¸Šè¿™ä¸ªæ˜¯ä»€ä¹ˆä¹Ÿä¸å¤„ç†ï¼Œç›´æ¥è¿”å›ä¸€ä¸ªé»˜è®¤çš„æ“ä½œã€‚\nä»¥ä¸‹ä½¿ç”¨switchè¿›è¡Œå¤„ç†ï¼š\n```cpp\nLRESULT CALLBACK window_procedure(HWND wnd, UINT message, WPARAM wparam, LPARAM lparam)\n{\n    PAINTSTRUCT ps;\n    switch (message)\n    {\n    case WM_CREATE:           // ç›¸å½“äºconstructorï¼Œå¾€å¾€å…ˆäºæ¶ˆæ¯å¾ªç¯ã€‚\n        break;\n    case WM_PAINT:\n        // Handle of Device Context\n        // caseè¯­å¥ä¸­ä¸èƒ½ç›´æ¥å£°æ˜ã€å®šä¹‰å˜é‡ï¼Œå› ä¸ºcaseä¸­çš„è¯­å¥ä¼šå½±å“ç¨‹åºç¼–è¯‘çš„è¡Œä¸ºï¼Œè€Œç¨‹åºä¸ç¡®å®šä¼šè¿è¡Œåˆ°å®šä¹‰å˜é‡è¯­å¥ï¼Œcaseæ˜¯æ²¡æœ‰å¯¹åº”çš„æ ˆçš„ï¼Œæ²¡æœ‰äº†ç¡®å®šæ€§ï¼Œå› æ­¤éœ€è¦åœ¨æ­¤æ®µè¯­å¥å¤–åŠ å¤§æ‹¬å·ï¼Œå½¢æˆå±€éƒ¨çš„æ ˆï¼Œå°±å¯ä»¥å­˜æ”¾ä¸´æ—¶å˜é‡äº†ã€‚ç›¸å½“äºæŠŠè¿™å‡ æ¡è¯­å¥ç”¨å‡½æ•°åŒ…è£…äº†ã€‚\n    {    \n        HDC hdc = ::BeginPaint(wnd, &ps);\n        ::Rectangle(hdc, 100, 100, 200, 200);  // å››ä¸ªæ•°å­—æ˜¯åæ ‡å‚æ•°\n        ::EndPaint(wnd, &ps);\n    }\n        break;\n    case WM_CLOSE:\n        ::DestroyWindow(wnd);\n        return 0;  // è¿”å›çš„LRESULTï¼Œè¡¨ç¤ºWM_CLOSEæ¶ˆæ¯å·²å¤„ç†\n        break;\n    case WM_DESTORY:          // ç›¸å½“äºdestructor\n        ::PostQuitMessage(0); // æ‰§è¡Œåä¼šå‘æ¶ˆæ¯é˜Ÿåˆ—æŠ•å…¥WM_QUITæ¶ˆæ¯ï¼Œä¸‹æ¬¡GetMessageå¾—åˆ°WM_QUITå°†è¿”å›0ï¼Œwhileå¾ªç¯é€€å‡ºã€‚\n        break;\n    default:\n        break;\n    }\n    return ::DefWindowProc(wnd, message, wparam, lparam);\n}\n```\n### BeginPaint\nBeginPaint å‡½æ•°å‡†å¤‡æŒ‡å®šçš„çª—å£è¿›è¡Œç»˜ç”»ï¼Œå¹¶ä½¿ç”¨æœ‰å…³ç»˜ç”»çš„ä¿¡æ¯å¡«å……[PAINTSTRUCT](https://learn.microsoft.com/en-us/windows/desktop/api/winuser/ns-winuser-paintstruct)ç»“æ„ã€‚\n![](../../images/Windows_wcharå’Œwmain/image-20240731013725180.png)\nå‚æ•°ï¼š\n1. hWndï¼Œ`HWND`ç±»ï¼Œè¦é‡ç»˜çš„çª—å£çš„å¥æŸ„ã€‚\n2. lpPaintï¼Œ`LPPAINTSTRUCT`ç±»ï¼ŒæŒ‡å‘å°†æ¥æ”¶ç»˜ç”»ä¿¡æ¯çš„`PAINTSTRUCT`ç»“æ„çš„LongæŒ‡é’ˆã€‚\n\nè¿”å›å€¼ï¼š\n1. å¦‚æœæˆåŠŸï¼Œè¿”å›å€¼æ˜¯æŒ‡å®šçª—å£çš„DCçš„å¥æŸ„ã€‚\n2. å¦‚æœå¤±è´¥ï¼Œè¿”å›NULLï¼Œè¡¨ç¤ºæ²¡æœ‰å¯ç”¨çš„æ˜¾ç¤ºè®¾å¤‡ä¸Šä¸‹æ–‡ï¼ˆDisplay Device Contextï¼‰ã€‚\n# æ€»ç»“\n\nä»¥ä¸Šè™½ç„¶æ˜¯å¯¹Windowsç³»ç»Ÿä¸­çš„çª—å£ç¨‹åºè¿›è¡Œäº†è§£æï¼Œä½†æ˜¯å…¶å®å…¶ä»–çš„æ“ä½œç³»ç»Ÿä¸­çš„çª—å£UIç¨‹åºä¹Ÿæ˜¯åŒæ ·çš„æµç¨‹å’Œé“ç†ã€‚\n\næ€»ä¹‹ï¼Œä¸åŒçš„åº”ç”¨ç¨‹åºæŠ¢ç›¸åŒçš„èµ„æºæ—¶ï¼Œç¨‹åºèŒƒå¼æœ‰ä¸¤ç§ï¼š\n1. çº¢ç»¿ç¯ï¼Œç­‰åˆ«äººåšå®Œå†åšã€‚é”æœºåˆ¶ï¼Œåœ¨å¤šä»»åŠ¡ç³»ç»Ÿï¼Œå°¤å…¶æ˜¯å¸¦UIçš„ç³»ç»Ÿä¼šæœ‰å¡é¡¿æ„Ÿã€‚\n2. åŸºäºæ¶ˆæ¯å¾ªç¯ï¼Œä»æ¶ˆæ¯å‘é€åˆ°æ¶ˆæ¯å¤„ç†ä¹Ÿå°±æ˜¯100msä¹‹å†…ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§åŒæ­¥ï¼Œä½†ç²’åº¦æ›´å°ï¼Œå°±å¯ä»¥ç­‰æ•ˆäºä¸€æ®µæ—¶é—´å†…å¤§å®¶éƒ½åœ¨åŒæ—¶åšã€‚\n# å†è®°å‡ ä¸ªæ¶ˆæ¯ç±»å‹\n\n```cpp\n{\n    // ...\n    case WM_LBUTTONDOWN:\n    {\n        int x_coord = lparam & 0xffff;\n        int y_coord = lparam >> 16;\n        wchar_t text[50] = L\"\";\n        // æ‰“å°åˆ°textå­—ç¬¦æ•°ç»„ä¸­\n        swprintf(text, 50, L\"%i, %i\", x_coord, y_coord);\n        ::MessageBox(nullptr, text, L\"BtnTest\", MB_OK);\n    }\n        break;\n    // ...\n}\n```\n\n1. WM_LBUTTONDOWNï¼šé¼ æ ‡å·¦é”®æŒ‰é’®æŒ‰ä¸‹åŠ¨ä½œã€‚[WM_LBUTTONDOWN message (Winuser.h) - Win32 apps | Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/inputdev/wm-lbuttondown)\n    1. æ¶ˆæ¯é‡Œçš„å±æ€§æœ‰ï¼šwparamï¼Œlparamã€‚wä»£è¡¨å­—ï¼Œlä»£è¡¨longï¼Œç°ä»£å·²ç»å…¨éƒ¨å‡çº§ä¸º32ä½çš„longäº†ã€‚lparamä¸­ï¼Œä½16ä½æ˜¯Xåæ ‡ï¼Œé«˜16ä½æ˜¯Yåæ ‡ã€‚å¦‚æœè¦ä»32ä½æ•°ä¸­å–å‡º16ä½ï¼Œéœ€è¦åšä¸æ©ç çš„æŒ‰ä½ä¸è¿ç®—ã€‚æ¯”å¦‚å–Xï¼š`int x_coord = lparam & 0xffff;`ï¼Œå–Yï¼š`int y_coord = lparam >> 16;`\n\n# è‡ªå®šä¹‰æ¶ˆæ¯ç±»å‹\n\nWindowsä¸­é»˜è®¤çš„messageéƒ½æ˜¯æœ‰ç›¸åº”é¢„å®šä¹‰å¥½çš„å€¼çš„ã€‚æ¯”å¦‚åœ¨`WinUser.h`ä¸­ï¼š\n```cpp\n#define WM_MOUSEMOVE      0x0200\n#define WM_LBUTTONDOWN    0x0201\n#define WM_LBUTTONUP      0x0202\n```\n\næˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªæ¶ˆæ¯ç±»å‹ï¼Œåœ¨`WinUser.h`ä¸­ï¼Œåˆä¸€ä¸ªç»™å‡ºçš„`WM_USER`å€¼ï¼Œå®ƒçš„æ³¨é‡Šè¯´æ˜äº†ï¼Œå°äº`0x0400`çš„å€¼å·²è¢«ç³»ç»Ÿå ç”¨ï¼Œè‡ªå®šä¹‰ç±»å‹å€¼éœ€è¦ä»`0x0400`å¼€å§‹ï¼š\n```cpp\n/* \n * NOTE: All Message Numbers below 0x0400 are RESERVED.\n * Private Window Messages Start Here:\n */\n#define WM_USER          0x0400 \n```\næ‰€ä»¥ï¼Œæ¯”è¾ƒç®€ä¾¿çš„è‡ªå®šä¹‰æ¶ˆæ¯ç±»å‹çš„é¢„å®šä¹‰è¯­å¥å¯ä»¥è¿™ä¹ˆå†™ï¼š\n```cpp\n#define MYMSG            WM_USER + 10\n```\n\nä½¿ç”¨ï¼šé€šè¿‡å·¦å‡»é¼ æ ‡ï¼Œç”¨PostMessageæ¥å‘é€MYMSGåˆ°wndçš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚ä¸‹æ¬¡å–å‡ºMYMSGæ¶ˆæ¯ååšç›¸åº”çš„åŠ¨ä½œã€‚\n```cpp\n{\n    // ...\n    case WM_LBUTTONDOWN:\n        ::PostMessage(wnd, MYMSG, wparam, lparam);\n        break;\n    case MYMSG:\n        ::MessageBox(nullptr, L\"My Message\", L\"MyMsg\", MB_OK);\n        break;\n    // ...\n}\n```\nä¹Ÿå¯ä»¥ç”¨SendMessageï¼ŒåŒºåˆ«æ˜¯ä¸ç»è¿‡æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç›´æ¥å‘é€æ¶ˆæ¯ã€‚æ•ˆæœæ˜¯åœ¨SendMessageåï¼Œç«‹å³è°ƒç”¨å›è°ƒå‡½æ•°ï¼Œå¤„ç†å®Œæ¯•åï¼Œå†å›åˆ°åŸå…ˆçš„SendMessageä¸‹ä¸€æ¡ä½ç½®ç»§ç»­ã€‚\n```cpp\n{\n    // ...\n    case WM_LBUTTONDOWN:\n        ::SendMessage(wnd, MYMSG, wparam, lparam);\n        break;\n    case MYMSG:\n        ::MessageBox(nullptr, L\"My Message\", L\"MyMsg\", MB_OK);\n        break;\n    // ...\n}\n```\n\n# å¸¦å‚æ•°\n\nåˆ©ç”¨SendMessageã€PostMessageä¸­å¯ä»¥å¸¦wparamã€lparamï¼Œå›è°ƒå‡½æ•°å¯ä»¥ä½¿ç”¨è¿™äº›å‚æ•°ã€‚\n\nå‘é€æ¶ˆæ¯æ—¶æºå¸¦å‚æ•°ï¼š\n```cpp\nstruct MyParam\n{\n    int x_coord;\n    int y_coord;\n}\n// ...\n{\n    // ...\n    case WM_LBUTTONDOWN:\n    {\n        int x_coord = lparam & 0xffff;\n        int y_coord = lparam >> 16;\n        MyParam* param = new MyParam{ x_coord, y_coord };\n        ::SendMessage(wnd, MYMSG, reinterpret_cast<WPARAM>(param), lparam);\n    }\n        break;\n    // ...\n}\n```\n\nå¤„ç†æ¶ˆæ¯æ—¶è§£æå‚æ•°ï¼š\n```cpp\n{\n    // ...\n    case MYMSG:\n    {\n        MyParam* param = reinterpret_cast<MyParam*>(wparam);\n        std::wstring text = std::format(L\"{0}, {1}\", x_coord, y_coord);\n        ::MessageBox(nullptr, text.c_str(), L\"Param Test\", MB_OK);\n        delete param;\n    }\n        break;\n    // ...\n}\n```\n\n# æ€»ç»“\n\nWindows SDKçš„å¼€å‘ï¼Œèšç„¦çš„ç‚¹ä¸»è¦å°±åœ¨äºwindow_procedureé‡Œçš„ä»£ç é€»è¾‘å’Œæ¶ˆæ¯çš„å¤„ç†ã€‚","categories":["æ“ä½œç³»ç»Ÿ","Windows"]},{"title":"Cpp_æ–‡ä»¶åº“","url":"/Cpp/Cpp_æ–‡ä»¶åº“/","content":"`C++17`ä¹‹åï¼Œæœ‰æ–°å¼•å…¥çš„æ–‡ä»¶åº“ã€‚å±è”½äº†æ“ä½œç³»ç»Ÿçš„å·®å¼‚æ€§ï¼Œæœ‰ç»Ÿä¸€çš„æ ‡å‡†ã€‚\n`<filesystem>`\nç¤ºä¾‹ï¼šè¯»å–å½“å‰ç›®å½•ä¸‹ï¼ˆåŒ…æ‹¬æ‰€æœ‰å­ç›®å½•ï¼‰çš„Cppã€Cç›¸å…³çš„æ–‡ä»¶åï¼Œå¹¶ç»Ÿè®¡å…¶è¡Œæ•°ã€‚\n\néå†æœç´¢ï¼š\n```cpp\n#include <filesystem>\nstd::vector<std::string>\nfile_directories()\n{\n    std::vector<std::filesystem::directory_entry> entries;\n    std::copy_if(std::filesystem::recursive_directory_iterator(\"./\"),\n    std::filesystem::recursive_directory_iterator(),\n    std::back_inserter(entries),\n    [](std::filesystem::directory_entry const& p) -> boll\n    {\n        if (p.is_regular_file())\n            if (p.path().extension().c_str() == L\".cpp\" ||\n                p.path().extension().c_str() == L\".h\" ||\n                p.path().extension().c_str() == L\".c\")\n                return true;\n        return false;\n    });\n    std::vector<std::string> file_names(entries.size());\n    // entry -> string name\n    std::transform(\n        entries.cbegin(),\n        entries.cend(),\n        file_names.begin(),\n        [](std::filesystem::directory_entry const& p) -> std::string\n        {\n            return p.path().generic_string();\n        });\n    return file_names;\n}\n```\nåœ¨VSç¯å¢ƒä¸‹ï¼Œé»˜è®¤çš„å½“å‰æ–‡ä»¶ç›®å½•æ˜¯`ProjectName.vcxproj`æ‰€åœ¨çš„ä½ç½®ã€‚\n\nç»Ÿè®¡è¡Œæ•°ï¼šé€šè¿‡`<fstream>`ä¸­çš„`std::ifstream`æ„é€ å‡½æ•°å¡«å…¥æ–‡ä»¶åæ‰“å¼€æ–‡ä»¶ï¼Œå·²ç»å¤„ç†å¥½äº†RAIIï¼Œæ— éœ€è€ƒè™‘å…³é—­ã€‚\n```cpp\nstd::vector<int>\ncount_lines_in_files(std::vector<string::string> & file_names)\n{\n    std::vector<int> line_counts;\n    char ch = 0;\n    int line_count{ 0 };\n\n    for (auto const & file_name : file_names)\n    {\n        std::ifstream in{ file_name };\n        line_count = 0;\n        while (in.get(ch))\n        {\n            if (ch == '\\n')\n            {\n                if (ch == '\\n')\n                    ++line_count;\n            }\n        }\n        line_counts.emplace_back(line_count);\n        // in.close();  // RAII\n    }\n    return line_counts;\n}\n```\næµ‹è¯•\n```cpp\nint main()\n{\n    auto file_names = file_directories();\n    auto file_counts = count_lines_in_files(file_names);\n    std::for_each(\n        file_names.cbegin(),\n        file_names.cend(),\n        [](auto&& file_name) -> void\n        {\n            std::cout << file_name << std::endl;\n        });\n    std::for_each(\n        file_counts.cbegin(),\n        file_counts.cend(),\n        [](auto&& file_count) -> void\n        {\n            std::cout << file_count << std::endl;\n        });\n    std::cout << \"Files Count: \" << file_names.size() << std::endl;\n}\n```\n# ç»“åˆç®—æ³•åº“\nç»“åˆç®—æ³•åº“ï¼Œå¯ä»¥å¤§å¤§ç®€åŒ–æˆ‘ä»¬è‡ªå·±å†™çš„ä»£ç ã€‚å°¤å…¶æ˜¯ç¹æ‚çš„forå¾ªç¯ã€‚\n\n`istream`è™½ç„¶ä¸æ˜¯å®¹å™¨ï¼Œä½†ä¹Ÿæœ‰ç›¸åº”çš„è¿­ä»£å™¨ï¼Œåœ¨`<iterator>`ä¸­æœ‰`Predefined iterators`å…¶ä¸­çš„`istream_iterator`ã€‚\nå¦‚æœè¯»å†™æ¯”è¾ƒé¢‘ç¹ï¼Œæœ‰æ•ˆç‡æ›´é«˜çš„`istreambuf_iterator`ã€‚\n```cpp\nint count_lines(std::string const& file_name)\n{\n    std::ifstream in{ file_name };\n    return std::count(\n        std::istreambuf_iterator<char>(in),\n        std::istreambuf_iterator<char>(),/* ä¸å†™é»˜è®¤æ˜¯end */\n        '\\n');\n}\n```\nä¹‹å‰çš„å‡½æ•°å¯ä»¥ç®€åŒ–ä¸ºï¼š\n```cpp\nstd::vector<int>\ncount_lines_in_files(std::vector<string::string> & file_names)\n{\n    std::vector<int> line_counts;\n    for (auto const& file_name : file_names)\n    {\n        line_counts.emplace_back(count_lines(file_name));\n    }\n    return line_counts;\n}\n```\nè¿˜èƒ½å†æ¬¡æ”¹è¿›ï¼š\n```cpp\nstd::vector<int>\ncount_lines_in_files(std::vector<string::string> & file_names)\n{\n    std::vector<int> line_counts(file_names.size());\n\n    std::transform(\n        std::execution::par,\n        file_names.cbegin(),\n        file_names.cend(),\n        line_counts.begin(),\n        count_lines);\n    return line_counts;\n}\n```\nä¹Ÿå¯ä»¥ç»“åˆrangesï¼šä¸€è¡Œä»£ç è§£å†³ï¼\n>`C++23`ä¸­å¯ä»¥é€šè¿‡`std::ranges::to<Container>`æ¥è¾“å‡ºåˆ°å°±åœ°ç”Ÿæˆçš„å®¹å™¨ä¸­\n```cpp\nstd::vector<int>\ncount_lines_in_files(std::vector<string::string> & file_names)\n{\n    return file_names | std::views::transform(count_lines) |\n        std::ranges::to<std::vector>();\n}\n```","categories":["Cpp","Modern"]},{"title":"Cpp_ä»¿å‡½æ•°_lambdaè¡¨è¾¾å¼","url":"/Cpp/Cpp_ä»¿å‡½æ•°_lambdaè¡¨è¾¾å¼/","content":"# ä»¿å‡½æ•°\nFunctor\n\nä»¿å‡½æ•°æ˜¯ç±»ã€‚\nç›¸æ¯”äºæ™®é€šå‡½æ•°ï¼Œä»¿å‡½æ•°ä½œä¸ºç±»å¯¹è±¡ï¼Œæœ‰æ›´å¤šåŠŸèƒ½å¯ä»¥é›†æˆã€‚\n\n```cpp\nclass IsOdd\n{\npublic:\n    bool operator () (int const& v)\n    {\n        return v % 2 != 0;\n    }\n};\n```\nä½¿ç”¨å¦‚ä¸‹ï¼šéœ€è¦å…ˆå®ä¾‹åŒ–å‡ºä¸€ä¸ªå¯¹è±¡ã€‚\n```cpp\nint main()\n{\n    std::vector<int> vec{ 0, 1, 2, 3, 4, 5, 6, 7, 8 };\n    \n    IsOdd is_odd_functor;\n\n    auto it != std::find_if(vec.begin(), vec.end(), is_odd_functor);\n}\n```\n## å‰–æfind_if\n1. firstå’Œlastæ˜¯è¿­ä»£å™¨ï¼Œéœ€è¦å…ˆè§£å¼•ç”¨æ‰èƒ½ä½¿ç”¨predå»åˆ¤æ–­å€¼ã€‚\n2. firståˆ°lastå·¦é—­å³å¼€ï¼Œfirstç­‰äºlastæ—¶ç»“æŸã€‚\n3. å†…éƒ¨å°è£…äº†predçš„å®é™…è°ƒç”¨å½¢å¼`pred(...)`ã€‚æ‰€ä»¥ä¸ç®¡æ˜¯å‡½æ•°ã€ä»¿å‡½æ•°ï¼Œåªè¦æ”¯æŒ`(...)`çš„è°ƒç”¨å½¢å¼å°±èƒ½ä½¿ç”¨ã€‚\n```cpp\ntemplate <class InputIterator, class UnaryPredicate>\nInputIterator find_if(InputIterator first, InputIterator last, UnaryPredicate pred)\n{\n    while (first != last)\n    {\n        if (pred(*first))\n            return first;\n        else\n            ++first;\n    }\n    return last;\n}\n```\n# lambdaè¡¨è¾¾å¼\n\nä¹Ÿå«lambda-calculusï¼ˆæ¼”ç®—ï¼‰ã€lexical closureï¼ˆè¯æ³•é—­åŒ…ï¼Œé—­åŒ…æŒ‡ç©·ä¸¾æ‰€æœ‰çš„çŠ¶æ€ï¼‰\n\n>åœ¨`C++`ä¸­ï¼Œæœ¬è´¨ä¸Šæ˜¯ç”Ÿæˆäº†ä¸€ä¸ªç±»ï¼Œæ‹¥æœ‰ä¸€ä¸ªstaticæ–¹æ³•ã€‚\n\nä¸ºä»€ä¹ˆå«åšè¯æ³•é—­åŒ…å‘¢ï¼Ÿ\n\nå‡è®¾ï¼Œfnåœ¨å†…éƒ¨å®šä¹‰äº†fn2ã€fn4ï¼Œfn2å†…éƒ¨å®šä¹‰äº†fn3ã€‚å¤–ç•Œè°ƒç”¨fnæ—¶æ˜¯çœ‹ä¸åˆ°å®ƒçš„å†…éƒ¨çš„ã€‚ä½†fnçš„ç»“æœä¾èµ–äºfn2ã€fn4ï¼Œfn2ä¾èµ–äºfn3ã€‚\næ€»ä¹‹ï¼Œå®šä¹‰åœ¨å†…éƒ¨ï¼Œå¤–ç•Œçœ‹ä¸åˆ°ï¼Œç±»ä¼¼äºé»‘ç›’ï¼Œè€Œä¸”å„éƒ¨åˆ†çš„ä¾èµ–å…³ç³»ä¸èƒ½æ–­ï¼Œéœ€è¦ç©·å°½è·¯çº¿ï¼Œæ‰€ä»¥å«é—­åŒ…ã€‚\n1. åŠŸèƒ½ä¸åœ¨å…¨å±€å®šä¹‰ï¼Œè€Œæ˜¯åœ¨å†…éƒ¨å®šä¹‰ã€‚ç©ºé—´ä¸æ˜“æ··ä¹±\n2. fnå¯ä»¥ç›´æ¥ä½¿ç”¨fn2ä½œä¸ºéƒ¨åˆ†åŠŸèƒ½\n![](../../images/Cpp_20240515_ä»¿å‡½æ•°/image-20240719052258968.png)\næœ‰äº†lambdaè¡¨è¾¾å¼ï¼Œå°±å¯ä»¥å½¢å¼ä¸Šåœ¨å‡½æ•°ä¸­åµŒå¥—å®šä¹‰å‡½æ•°äº†ã€‚\nä½†æœ‰ä¸ªé—®é¢˜ï¼Œfnä¸­å®šä¹‰çš„å˜é‡ï¼Œfn2å¯ä»¥è®¿é—®å—ï¼Ÿ\n```cpp\n#include <iostrean>\nvoid bar(void)\n{\n    \n}\nint main()\n{\n    return 0;\n}\n```\n## å†™æ³•å½¢å¼\n```cpp\n[Capture List](Parameters) -> ReturnType {};\n    ^              ^       ^       ^      ^\n æ•è·åˆ—è¡¨          å‚æ•°   goes to  è¿”å›ç±»å‹  å‡½æ•°ä½“\n```\nç±»ä¼¼äºå‡½æ•°ï¼Œå¯ä»¥äº’ç›¸ä¼ é€’ï¼Œè¿˜å¯ä»¥åœ¨ä¸­é—´æ•è·ã€‚\n```cpp\n#include <iostrean>\nint bar(void)\n{\n    int a = 10;\n    // ä»¥ä¸‹ç”Ÿæˆäº†å‡½æ•°å¯¹è±¡ï¼Œå¯ä»¥å°±åœ°è°ƒç”¨ï¼š\n    int b = [a]() -> void \n        {\n            return a + 20;\n        }()/* ç†Ÿæ‚‰çš„å‡½æ•°è°ƒç”¨æ ‡å¿—ï¼šåœ†æ‹¬å· */;\n    int c = [a](int v) -> void \n        {\n            return a + v + 20;\n        }(5);\n    return b;\n}\nint main(void)\n{\n    int r = bar();\n    return 0;\n}\n```\n## æŒ‰å€¼æ•è·\n```cpp\nint bar()\n{\n    int a = 10, b = 11;\n    int c = [a, b](int v) -> int\n        {\n            return a + b + v + 20;\n        }(5);\n    // ä¹Ÿå¯ä»¥åœ¨ä¸­æ‹¬å·åªå¡«ä¸€ä¸ª\"=\"ï¼Œä»£è¡¨æŒ‰å€¼æ•è·å…¨éƒ¨\n    int d = [=](int v) -> int\n        {\n            return a + b + v + 20;\n        }(5);\n    return c;\n}\n```\næŒ‰å€¼æ•è·æ—¶ï¼Œå†…éƒ¨lambdaå‡½æ•°å¯¹æ•è·çš„å˜é‡ä¿®æ”¹æ—¶ï¼Œå¤–éƒ¨å€¼ä¸å˜ï¼Œç›¸å½“äºæˆä¸ºäº†è‡ªå·±çš„å±€éƒ¨å˜é‡ã€‚\nè¿™ä¸ªæ•è·çš„å±€éƒ¨å˜é‡åœ¨å†…éƒ¨ä¹Ÿæ˜¯é»˜è®¤ä¸èƒ½æ”¹å€¼çš„ï¼Œä½†å¯ä»¥åŠ mutableã€‚æ˜ç¡®å‘Šè¯‰ç¼–è¯‘å™¨è‡ªå·±è¦ä¿®æ”¹ï¼Œå¹¶ä¸æ˜¯è¯¯ä¼šã€‚ä½†åŠ äº†mutableä¾ç„¶ä¸ä¼šå½±å“å¤–éƒ¨ã€‚\n```cpp\nint bar()\n{\n    int a = 10, b = 11;\n    int c = [=](int v) -> int\n        {\n            return a + b++ + v + 20; // error, b can't be modified.\n        }(5);\n    int d = [=](int v) mutable -> int\n        {\n            return a + b++ + v + 20; // ok. , b = 12\n        }(5);\n    return b;  // b = 11\n}\n```\n## æŒ‰å¼•ç”¨æ•è·\n\n```cpp\nint bar()\n{\n    int a = 10, b = 11;\n    // å¦‚æœæƒ³è¦æŒ‰å¼•ç”¨æ•è·å…¨éƒ¨å˜é‡ï¼Œå¯ä»¥åœ¨[]ä¸­åªå†™ä¸€ä¸ª\"&\"\n    int c = [=, &b](int v) -> int\n        {\n            return a + b++ + v + 20;\n        }(5);\n    return b;  // b = 12\n}\n```\n1. å¦‚æœæƒ³è¦æŒ‰å¼•ç”¨æ•è·å…¨éƒ¨å˜é‡ï¼Œå¯ä»¥åœ¨`[]`ä¸­åªå†™ä¸€ä¸ª\"&\"\n2. ä¹Ÿå¯ä»¥åœ¨ä¸­æ‹¬å·åªå¡«ä¸€ä¸ª\"=\"ï¼Œä»£è¡¨æŒ‰å€¼æ•è·å…¨éƒ¨\n3. ä½†æ˜¯ä¸èƒ½`[=, &]`æ—¢å…¨éƒ¨æŒ‰å€¼åˆå…¨éƒ¨æŒ‰å¼•ç”¨ã€‚åŒæ—¶å­˜åœ¨æ—¶å¿…é¡»æœ‰ä¸€ä¸ªæ˜¯éƒ¨åˆ†å˜é‡å¦‚`[=, &b]`\n4. å¼•ç”¨å¯ä»¥æŠŠå¤–éƒ¨å€¼è”åŠ¨æ”¹å˜ã€‚\n## å‡½æ•°å¯¹è±¡\n1. å¯ä»¥ç”¨å‡½æ•°å¯¹è±¡æ¥å­˜å‚¨å®šä¹‰çš„lambdaå‡½æ•°ã€‚\n2. ä¸èƒ½ç”¨å‡½æ•°æŒ‡é’ˆç›´æ¥å¼•ç”¨ã€‚\n```cpp\nint bar()\n{\n    int a = 10, b = 11;\n    \n    auto lambda = [=, &b](int v) -> int\n        {\n            return a + b++ + v + 20;\n        };\n    return lambda(5);\n}\n```\nä»¥ä¸Šæ˜¯ä½¿ç”¨autoæ¥è‡ªåŠ¨æ¨æ–­ã€æ¥æ”¶ã€‚\nä¹Ÿå¯ä»¥ä½¿ç”¨`std::function`å‡†ç¡®å®šä¹‰ç›¸åº”çš„å‡½æ•°å¯¹è±¡ç±»å‹æ¥æ¥æ”¶lambdaå‡½æ•°ã€‚ï¼ˆä¹Ÿå¯ä»¥æ¥æ”¶æ™®é€šå‡½æ•°ï¼Œåªè¦è¿”å›å€¼ç±»å‹ã€å‚æ•°ç±»å‹ç¬¦åˆå³å¯ï¼‰\n```cpp\n#include <functional>\nint bar()\n{\n    int a = 10, b = 11;\n    \n    std::function<int(int)> lambda = [=, &b](int v) -> int\n        {\n            return a + b++ + v + 20;\n        };\n    return lambda(5);\n}\n```\n## lambdaå‡½æ•°å¯¹è±¡çš„ç”Ÿå­˜å‘¨æœŸ\n```cpp\nstd::function<int(int)> bar()\n{\n    int a = 10, b = 11;\n    std::function<int(int)> lambda = [=, &b](int v) -> int\n        {\n            return a + b++ + v + 20;\n        }\n}\nint main()\n{\n    auto lam = bar();\n    int r = lam(5);\n    r = lam(5);\n}\n```\nä»¥ä¸Šmainå‡½æ•°è°ƒç”¨äº†ä¸¤æ¬¡`bar()`å‡½æ•°å†…éƒ¨ç”Ÿæˆçš„lambdaå‡½æ•°ï¼Œå…¶ä¸­lambdaå‡½æ•°è‡ªå·±å†…éƒ¨çš„bæ˜¯æŒ‰å¼•ç”¨æ•è·çš„ã€‚\nå¦‚æœæ˜¯æ™®é€šå‡½æ•°çš„æ ˆå¸§ï¼Œåˆ™barå‡½æ•°æŒ‰ç†æ¥è¯´åœ¨ç¬¬ä¸€è¡Œä»£ç ç»“æŸåå°±ä¼šå¡Œé™·ï¼Œå¯¼è‡´å¼•ç”¨çš„bç©ºé—´è¢«æ±¡æŸ“ã€‚\nåœ¨ä¹‹å‰çš„`C++11`ç‰ˆæœ¬ç¡®å®ä¼šå­˜åœ¨è¿™ç±»é—®é¢˜ï¼Œå› ä¸º`C++`æ˜¯é™æ€ç¼–è¯‘æœŸè®¡ç®—çš„ï¼Œè€ŒJavaã€C#ã€Pythonæ˜¯æœ‰åƒåœ¾å›æ”¶æœºåˆ¶çš„ï¼Œæœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°ï¼Œå¦‚æœä»æœ‰äººå¼•ç”¨bï¼Œåˆ™ä¸ä¼šå¯¹å…¶ææ„ï¼Œå› æ­¤å¾€å¾€è®©è¿™äº›å±€éƒ¨å˜é‡åœ¨å †ä¸Šåˆ›å»ºã€‚ä½†`C++`æ—©æœŸæ˜¯å»ºç«‹åœ¨æ ˆä¸Šï¼Œå› æ­¤ä¼šå‘ç”Ÿé—®é¢˜ã€‚\nåç»­ç‰ˆæœ¬`C++17`ä¹‹åå…‹æœäº†æ­¤é—®é¢˜ï¼Œæ¯ä¸ªå‚å•†å…·ä½“ç»†èŠ‚ä¸åŒï¼Œå¾®è½¯å…¬å¸ä¹Ÿæ˜¯æŠŠå±€éƒ¨å˜é‡å»ºç«‹åœ¨å †ä¸Šäº†ï¼Œå¹¶ç”¨æ™ºèƒ½æŒ‡é’ˆç®¡ç†ï¼Œå³ä½¿barå‡½æ•°æ ˆå¸§å¡Œé™·äº†ï¼Œä¹Ÿä¼šå¸®ä½ æŠŠç±»ä¼¼aã€bçš„å±€éƒ¨å˜é‡å­˜å‚¨åˆ°å…¶ä»–åœ°æ–¹ã€‚\n## lambdaå‡½æ•°ä¸é¢å‘å¯¹è±¡ç»“åˆï¼ˆæ•è·thisï¼‰\næ¯”å¦‚è®©lambdaå‡½æ•°è°ƒç”¨æŸä¸ªå¯¹è±¡çš„æˆå‘˜æ–¹æ³•ã€æˆå‘˜å˜é‡ï¼Œå¯ä»¥åœ¨lambdaè¡¨è¾¾å¼ä¸­çš„æ•è·åˆ—è¡¨é‡Œå†™thisæŒ‡é’ˆã€‚\n# é¢å‘å‡½æ•°ç¼–ç¨‹\næ¯”è¾ƒå…³å¿ƒé€»è¾‘ï¼Œä¸å¤ªå…³å¿ƒç»†èŠ‚ã€‚ç»†èŠ‚ç”¨é«˜é˜¶å‡½æ•°æ¥å®Œæˆã€‚\nå°±åƒæ˜¯ï¼šå¦‚æœä¸ä½¿ç”¨`copy_if`æ¥åšfilterï¼Œé‚£ä¹ˆå°±éœ€è¦å¦å†™ç¹ççš„forå¾ªç¯ã€‚\n\n","categories":["Cpp"]},{"title":"Cpp_STL_ç®—æ³•_ranges","url":"/Cpp/Cpp_STL_ç®—æ³•_ranges/","content":"# æ¨¡æ¿åº“æ˜¯ä»€ä¹ˆ\nç”±ä¸‰éƒ¨åˆ†ç»„æˆã€‚\n1. å®¹å™¨Containerï¼šè£…æ•°æ®çš„\n2. è¿­ä»£å™¨Iteratorï¼šä¸åŒå®¹å™¨çš„ç»“æ„ã€ç®—æ³•è¡Œä¸ºä¸ä¸€æ ·ï¼Œç”¨è¿­ä»£å™¨æ¥å±è”½å·®å¼‚ã€‚Iteratoræœ‰å¥½å¤šç§ï¼Œä½†æ˜¯æœ‰é€šç”¨çš„æ¥å£ï¼Œåœ¨å®¹å™¨å’Œç®—æ³•ä¸­é—´ï¼Œé€šè¿‡è¿­ä»£å™¨ä¸å¦ä¸€è€…ç›¸äº’é€šä¿¡ã€‚\n3. ç®—æ³•Algorithmï¼šæ’å…¥ã€ä¿®æ”¹ã€åˆ é™¤ç­‰\n\n>æœ‰çš„è¯´æ³•æ˜¯å…­å¤§ç»„ä»¶ç»„æˆï¼šå®¹å™¨ã€è¿­ä»£å™¨ã€ç®—æ³•ã€ä»¿å‡½æ•°ã€é€‚é…å™¨ã€åˆ†é…å™¨\n\n![](../../images/Cpp_20240512_STL/image-20240717000140107.png)\n\n# ä»¥vectorä¸ºä¾‹\n```cpp\ntemplate<class T, class Alloc = allocator<T> >\nclass vector;\n```\nç¬¬ä¸€ä¸ªæ¨¡æ¿å‚æ•°æ˜¯å®¹å™¨ä¸­å…ƒç´ çš„ç±»å‹ã€‚\nç¬¬äºŒä¸ªæ¨¡æ¿å‚æ•°æ˜¯ç©ºé—´é…ç½®å™¨ã€‚\n## åˆå§‹åŒ–ã€éå†\néå†ç¤ºä¾‹ï¼š\n```cpp\nint main()\n{\n    std::vector<int> vec{ 1, 2, 3, 4, 5, 6, 7, 8 };\n    std::vector<int>::iterator it = vec.begin();\n    for (; it != vec.end(); ++it)\n    {\n        std::cout << *it << std::endl;\n    }\n    // ä»¥ä¸‹æ˜¯ranged forçš„éå†å†™æ³•\n    // å–å‡ºçš„æ˜¯å€¼ï¼Œä¸æ˜¯è¿­ä»£å™¨ã€‚æ•ˆç‡è¾ƒä½\n    for (auto v : vec)\n    {\n        std::cout << v << std::endl;\n    }\n    // å–å‡ºçš„æ˜¯å¼•ç”¨ï¼Œæ•ˆç‡é«˜ã€‚å®é™…vçš„ç±»å‹æ˜¯int &\n    for (auto&& v : vec)\n    {\n        std::cout << v << std::endl;\n    }\n}\n```\n## sizeå’Œcapacity\n1. sizeæ˜¯å½“å‰å®¹å™¨å†…æœ‰æ•ˆå…ƒç´ æ•°\n2. capacityæ˜¯å½“å‰å®¹å™¨çš„å®¹é‡\n3. capacityå¤§äºç­‰äºsize\n4. å½“æ»¡å®¹æ—¶ï¼Œvectorä¼šæ‰©å®¹åˆ°åŸæ¥çš„1.5å€ã€‚ä¹‹å‰çš„æ•°æ®æ‹·è´åˆ°æ–°åŒºåé”€æ¯ã€‚\n## `push_back`å’Œ`emplace_back`\n1. `push_back`çš„è¯­ä¹‰æ˜¯æŠŠæ„é€ å¥½çš„å¯¹è±¡ï¼Œæˆ–ç”¨å°è£…çš„æ•°æ®ä¸´æ—¶æ„é€ ä¸€ä¸ªå¯¹è±¡ï¼Œå†æ’å…¥åˆ°å®¹å™¨çš„å°¾éƒ¨ã€‚å‘ç”Ÿäº†æ‹·è´æ„é€ ã€å³å€¼å¼•ç”¨æ‹·è´æ„é€ ã€‚\n2. `emplace_back`æ˜¯æŠŠæ•°æ®ä¸€ä¸ªä¸€ä¸ªç›´æ¥å¡«å……åˆ°å®¹å™¨å°¾éƒ¨çš„ç©ºé—´ä¸Šã€‚\n    1. ç”¨åˆ°äº†å®Œç¾è½¬å‘\n\n```cpp\nclass Test\n{\npublic:\n    Test(int a, int b)\n    {\n        std::cout << \"Test(a, b)\" << std::endl;\n    }\n};\nint main()\n{\n    std::vector<Test> vec{ {10, 20}, {30, 40}, {50, 60}, {70, 80} };\n    vec.push_back({ 90, 100 });\n    Test test{ 110, 120 };\n    vec.push_back(test);\n    vec.emplace_back(130, 140);\n    std::cout << vec.size() << std::endl;\n    std::cout << vec.capacity() << std::endl;\n}\n```\n\n# è¿­ä»£å™¨çš„åˆ†ç±»\n\n1. æ‰€æœ‰éƒ½ï¼š\n    1. æ”¯æŒææ„ã€æ‹·è´æ„é€ ã€æ‹·è´èµ‹å€¼ã€‚\n    2. Can be incremented `++a or a++`\n2. Input/Outputï¼šè¿­ä»£å™¨çš„è¾“å…¥ã€è¾“å‡ºæ˜¯ç›¸å¯¹äºç®—æ³•æ¥è¯´çš„ã€‚\n    1. Inputï¼šç¨‹åºé€šè¿‡è¿­ä»£å™¨å‘ç®—æ³•ä¼ å‚ï¼Œå¯ä»¥ç†è§£ä¸ºåªè¯»\n        1. æ”¯æŒç›¸ç­‰æ¯”è¾ƒ\n        2. æ”¯æŒè§£å¼•ç”¨ä¸ºå³å€¼\n    2. Outputï¼šç®—æ³•é€šè¿‡è¿­ä»£å™¨å‘å¤–è¾“å‡º\n        1. æ”¯æŒè§£å¼•ç”¨ä¸ºå·¦å€¼\n3. Forward\n    1. æ”¯æŒé»˜è®¤çš„æ„é€ \n4. Bidirectional\n    1. Can be decremented `--a or a--`\n5. Random Access\n    1. æ”¯æŒéšæ„åŠ å‡ `a + n, n + a, a - n, a - b`\n    2. æ”¯æŒå’Œå¦ä¸€è¿­ä»£å™¨ä¹‹é—´çš„ä¸ç­‰æ¯”è¾ƒ `a < b, a > b`\n    3. æ”¯æŒå¤åˆèµ‹å€¼è¿ç®— `a += n, a -= n`\n    4. æ”¯æŒåç§»é‡ï¼ˆoffsetï¼‰è§£å¼•ç”¨ `a[n]`\n\n![](../../images/Cpp_20240512_STL/image-20240717010603321.png)\n\n## é€šè¿‡conceptsçº¦æŸè¿­ä»£å™¨ç±»å‹\n\nåœ¨æ²¡æœ‰conceptä¹‹å‰ï¼Œç¼–ç¨‹æ—¶ä¹±ç”¨ä¸åŒ¹é…çš„è¿­ä»£å™¨ç¼–è¯‘æ—¶æ˜¯ä¸çŸ¥é“å¯¹é”™çš„ï¼Œè¿è¡Œçš„æ—¶å€™æ‰æŠ¥é”™ã€‚\nè€ŒModern `C++`ä¹‹åéšç€æ¨¡æ¿å’Œconceptçš„å‘å±•ï¼Œå¯ä»¥çº¦æŸè¿­ä»£å™¨çš„è¡Œä¸ºã€‚æ¯”å¦‚è§„å®šæ­¤è¿­ä»£å™¨ç±»å¿…é¡»æ”¯æŒ`++`ã€`--`æ“ä½œï¼Œä»è€Œæ­¤è¿­ä»£å™¨æ˜¯Bidirectionalã€‚\næœ‰äº†conceptsï¼Œåœ¨ç¼–è¯‘æœŸå°±èƒ½çŸ¥é“ç¨‹åºçš„å¯¹é”™äº†ã€‚\n\nå…·ä½“è§ã€ŠCpp_conceptã€‹\n## back_inserter\n```cpp\ntemplate <class Container>\nback_insert_iterator<Container> back_inserter (Container& x);\n```\næ„å»ºåæ’å…¥è¿­ä»£å™¨\næ„å»ºä¸€ä¸ªå°¾æ’å…¥è¿­ä»£å™¨ï¼Œè¯¥è¿­ä»£å™¨åœ¨Xçš„æœ«å°¾æ’å…¥æ–°å…ƒç´ ã€‚\nå°¾æ’è¿­ä»£å™¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¾“å‡ºè¿­ä»£å™¨ï¼Œæ—¨åœ¨å…è®¸é¢‘ç¹è¦†ç›–å…ƒç´ çš„ç®—æ³•ï¼ˆä¾‹å¦‚copyï¼‰åœ¨å®¹å™¨æœ«ç«¯è‡ªåŠ¨æ’å…¥æ–°å…ƒç´ ã€‚\nXçš„ç±»å‹éœ€è¦å…·æœ‰`push_back`æˆå‘˜å‡½æ•°ï¼ˆä¾‹å¦‚vectorã€Dequeå’ŒListï¼‰ã€‚\nåœ¨è¿”å›çš„è¿­ä»£å™¨ä¸Šä½¿ç”¨èµ‹å€¼è¿ç®—ç¬¦ï¼ˆæ˜¯å¦è§£å¼•ç”¨ï¼‰ï¼Œä½¿å®¹å™¨é€šè¿‡ä¸€ä¸ªå…ƒç´ æ‰©å±•ï¼Œè¯¥å…ƒç´ è¢«åˆå§‹åŒ–ä¸ºåˆ†é…çš„å€¼ã€‚\næ•ˆæœå°±æ˜¯ä¸ç”¨æ“å¿ƒç»™å®¹å™¨æ‰©å®¹äº†ï¼Œæ¥ä¸€ä¸ªå»ºä¸€ä¸ªã€‚\nè¿”å›çš„è¿­ä»£å™¨æ”¯æŒè¾“å‡ºè¿­ä»£å™¨çš„æ‰€æœ‰å…¶ä»–å…¸å‹æ“ä½œï¼Œä½†å¤±æ•ˆäº†ï¼šåˆ†é…çš„æ‰€æœ‰å€¼å‡åœ¨å®¹å™¨çš„æœ«å°¾æ’å…¥ã€‚\n\nä½“ç°äº†é€‚é…å™¨æ¨¡å¼ã€‚\n\nä¸ä¹‹ç›¸ç±»ä¼¼çš„ï¼Œè¿˜æœ‰`front_inserter`ï¼Œå¤´æ’è¿­ä»£å™¨ã€‚\n\nç¤ºä¾‹è§`ranges`ä¸­`copy_if`çš„ç”¨æ³•\n# åˆ é™¤æ—¶è¿­ä»£å™¨çš„å¤„ç†\n1. eraseåï¼Œæ­¤itå¤±æ•ˆã€‚`++`æ“ä½œä¹Ÿä¼šå¤±æ•ˆ\n2. eraseè¿”å›ä¸‹ä¸€ä¸ªæœ‰æ•ˆçš„itï¼Œæ‰€ä»¥ï¼Œåˆ é™¤åç”¨æ­¤è¿”å›å€¼èµ‹ç»™itã€‚\n3. å…¶ä»–æƒ…å†µæ­£å¸¸`++`\n4. å¦‚æœåªéœ€è¦åˆ 1ä¸ªï¼Œå°±åœ¨eraseå`break`ï¼Œå¦åˆ™åé¢æ¡ä»¶åŒ¹é…çš„å…¨éƒ¨ä¼šåˆ é™¤\n\n```cpp\n#include<iostream>\n#include<vector>\nint main()\n{\n    std::vector<int> vec{ 10, 20, 30, 40, 50, 60, 70, 80 };\n    for (auto it = vec.begin(); it != vec.end(); /* ä¸++ */)\n    {\n        if (*it == 40)\n        {\n            // eraseåï¼Œæ­¤itå¤±æ•ˆã€‚++ä¹Ÿä¼šå¤±æ•ˆ\n            // eraseè¿”å›ä¸‹ä¸€ä¸ªæœ‰æ•ˆçš„it\n            it = vec.erase(it);\n            // break;  // å¦‚æœåªéœ€è¦åˆ 1ä¸ªï¼Œå°±breakï¼Œå¦åˆ™å…¨éƒ¨40åˆ é™¤\n        }\n        else\n        {\n            ++it;\n        }\n    }\n    for (auto&& v : vec)\n    {\n        std::cout << v << std::endl;\n    }\n}\n```\n# ç®—æ³•\n`<algorithm>`\n## find\n```\nconstexpr _InIt find<_InIt, _Ty>(_InIt _First, const _InIt _Last, const _Ty &_Val);\n```\n1. InItè¡¨ç¤ºInput Iteratorï¼ŒæŒ‡è¢«è¾“å…¥ï¼Œæ˜¯ç”¨äºæ¥æ”¶çš„è¿­ä»£å™¨ï¼Œæˆ–è€…ç†è§£ä¸ºåªè¯»ä¸ä¿®æ”¹ã€‚\n2. Firstè¡¨ç¤ºæœç´¢èŒƒå›´çš„ä¸Šé™ï¼ŒLastè¡¨ç¤ºæœç´¢èŒƒå›´çš„ä¸‹é™ã€‚\n3. åŒºé—´æ˜¯å·¦é—­å³å¼€ã€‚`[First, Last)`\n4. Valæ˜¯è¦æŸ¥æ‰¾çš„å€¼\n5. è¿”å›æŒ‡å‘Valå€¼å…¶ä½ç½®çš„è¿­ä»£å™¨ã€‚å¦‚æœæ²¡æ‰¾åˆ°ï¼Œåˆ™è¿”å›`xxx.end()`\n```cpp\n#include <algorithm>\nint main()\n{\n    std::vector<int> vec{ 1, 2, 3, 4, 5, 6, 7, 8 };\n    auto it = std::find(vec.begin(), vec.end(), 6);\n    if (it != vec.end())\n        std::cout << *it << std::endl;\n}\n```\n## find_ifã€è°“è¯ã€ä»¿å‡½æ•°\nfindæ˜¯é»˜è®¤å¯»æ‰¾ç›¸ç­‰çš„valã€‚è€Œfind_ifå¯ä»¥è‡ªå®šä¹‰æ¡ä»¶ã€‚\n```cpp\ntemplate <class InputIterator, class UnaryPredicate>\nInputIterator find_if(InputIterator first, InputIterator last, UnaryPredicate pred);\n```\næ¨¡æ¿å‚æ•°1æ˜¯åªè¯»è¿­ä»£å™¨ã€‚\næ¨¡æ¿å‚æ•°2æ˜¯ä¸€å…ƒè°“è¯ã€‚\n\néå†è¾“å‡ºå®¹å™¨ä¸­æ‰€æœ‰çš„å¥‡æ•°ï¼š\n1. å®šä¹‰è°“è¯ä¸ºè¿”å›boolçš„å‡½æ•°\n2. å…ˆæ‰¾ä¸€æ¬¡ï¼Œè¿”å›it\n3. è‹¥ä¸ä¸ºendï¼Œæ‰“å°åï¼Œç»§ç»­å¾ªç¯æ‰¾ã€æ‰“å°\n4. ç›´åˆ°itè¿”å›endã€‚\n\n```cpp\n// åˆ¤æ–­æ˜¯å¦ä¸ºå¥‡æ•°\nbool is_odd(int const& v)\n{\n    return v % 2 != 0;\n}\nint main()\n{\n    std::vector<int> vec{ 0, 1, 2, 3, 4, 5, 6, 7, 8 };\n    auto it = std::find_if(vec.begin(), vec.end(), is_odd);\n    while (it != vec.end())\n    {\n        std::cout << *it << std::endl;\n        it = std::find_if(it + 1, vec.end(), is_odd);\n    }\n    return 0;\n}\n```\nä¹Ÿå¯ä»¥æ‹¿ä»¿å‡½æ•°ä½œä¸ºè°“è¯ã€‚\n```cpp\nclass IsOdd\n{\npublic:\n    bool operator () (int const& v)\n    {\n        return v % 2 != 0;\n    }\n};\n```\nä½¿ç”¨å¦‚ä¸‹ï¼šéœ€è¦å…ˆå®ä¾‹åŒ–å‡ºä¸€ä¸ªå¯¹è±¡ã€‚\n```cpp\nint main()\n{\n    std::vector<int> vec{ 0, 1, 2, 3, 4, 5, 6, 7, 8 };\n    \n    IsOdd is_odd_functor;\n\n    auto it = std::find_if(vec.begin(), vec.end(), is_odd_functor);\n    // ...\n}\n```\nä¹Ÿå¯ä»¥ä½¿ç”¨lambdaè¡¨è¾¾å¼\n```cpp\nint main()\n{\n    std::vector<int> vec{ 0, 1, 2, 3, 4, 5, 6, 7, 8 };\n    \n    auto it = std::find_if(\n        vec.begin(),\n        vec.end(),\n        [](int const& v) -> bool\n        {\n            return v % 2 != 0;\n        });\n    // ...\n}\n```\n### å‰–æ\n1. firstå’Œlastæ˜¯è¿­ä»£å™¨ï¼Œéœ€è¦å…ˆè§£å¼•ç”¨æ‰èƒ½ä½¿ç”¨predå»åˆ¤æ–­å€¼ã€‚\n2. firståˆ°lastå·¦é—­å³å¼€ï¼Œfirstç­‰äºlastæ—¶ç»“æŸã€‚\n3. å†…éƒ¨å°è£…äº†predçš„å®é™…è°ƒç”¨å½¢å¼`pred(...)`ã€‚æ‰€ä»¥ä¸ç®¡æ˜¯å‡½æ•°ã€ä»¿å‡½æ•°ï¼Œåªè¦æ”¯æŒ`(...)`çš„è°ƒç”¨å½¢å¼å°±èƒ½ä½¿ç”¨ã€‚\n\n```cpp\ntemplate <class InputIterator, class UnaryPredicate>\nInputIterator find_if(InputIterator first, InputIterator last, UnaryPredicate pred)\n{\n    while (first != last)\n    {\n        if (pred(*first))\n            return first;\n        else\n            ++first;\n    }\n    return last;\n}\nint main()\n{\n    std::vector<int> vec{ 0, 1, 2, 3, 4, 5, 6, 7, 8 };\n    \n    IsOdd is_odd_functor;\n    // ä¸æ˜¯stdçš„find_if æ˜¯æˆ‘ä»¬è‡ªå·±å†™çš„\n    auto it = ::find_if(vec.begin(), vec.end(), is_odd_functor);\n\n    while (it != vec.end())\n    {\n        std::cout << *it << std::endl;\n        it = ::find_if(it + 1, vec.end(), is_odd_functor);\n    }\n}\n```\n## `remove_if`\n```cpp\ntemplate <class ForwardIterator, class UnaryPredicate>\nForwardIterator remove_if (ForwardIterator first, ForwardIterator last, UnaryPredicate pred);\n```\néœ€è¦Iteratorå¯ä»¥Forwardå•å‘ç§»åŠ¨ã€‚\n```cpp\ntemplate <class ForwardIterator, class UnaryPredicate>\nForwardIterator remove_if (ForwardIterator first, ForwardIterator last, UnaryPredicate pred)\n{\n    ForwardIterator result = first;\n    while (first != last) {\n        if (!pred(*first)) {\n            if (result != first)\n                *result = std::move(*first);\n            ++result;\n        }\n        ++first;\n    }\n    return result;\n}\n```\nä»å®ç°å¯ä»¥çœ‹å‡ºï¼š\n1. éå†æ—¶é‡åˆ°è¦åˆ çš„ï¼Œfirstå…ˆå¾€åé¢ç»§ç»­éå†ï¼Œresultä¸åŠ¨ï¼›\n2. é‡åˆ°ä¸åŒ¹é…æ¡ä»¶çš„ï¼ˆä¸åˆ çš„ï¼‰ï¼Œfirstçš„å€¼å°±å¾€å‰é¢ä¸resultçš„å€¼äº¤æ¢ï¼Œresultåç§»ã€‚\n3. æœ€åï¼Œresultçš„ä½ç½®ä»¥åŠä¹‹åå°±æ˜¯è¦åˆ çš„æ‰€æœ‰æ•°æ®ã€‚\n\nè¿™æ ·æ˜¯ä¸ºäº†é˜²æ­¢æ‰¹é‡åˆ é™¤æ—¶ï¼Œæ•°æ®é¢‘ç¹çš„å‰ç§»ã€‚å¦‚æ­¤ï¼Œå¯ä»¥åªè¿›è¡Œäº¤æ¢ï¼Œåé¢ä¸€å¹¶åˆ é™¤ã€‚\nå› æ­¤ï¼Œ`remove_if`ä¸ä¼šå¸®æˆ‘ä»¬åˆ é™¤æ•°æ®ï¼Œè€Œæ˜¯å¸®æˆ‘ä»¬æ•´ç†å¥½å®¹å™¨å†…æ•°æ®çš„æ’å¸ƒåï¼Œå†è¿”å›ä¸€ä¸ªitè¿­ä»£å™¨ï¼ŒæŒ‡ç¤ºè¦åˆ é™¤çš„å¼€å§‹ä½ç½®ã€‚\n```\nè°ƒç”¨å‰ï¼š\n{ 0, 1, 2, 3, 4, 5, 6, 7, 8 }\nè°ƒç”¨åï¼š\n{ 0, 2, 4, 6, 8, 1, 3, 5, 7 }\n                 ^\n                 it -> è¦åˆ é™¤çš„æ•°æ®çš„å¼€å§‹ä½ç½®\n```\n\n```cpp\nint main()\n{\n    std::vector<int> vec{ 0, 1, 2, 3, 4, 5, 6, 7, 8 };\n    auto it = std::remove_if(\n        vec.begin(),\n        vec.end(),\n        [](int const& v) -> bool {return v % 2 != 0;});\n    while (it != vec.end())\n    {\n        it = vec.erase(it);\n    }\n    // ä¹Ÿå¯ä»¥è¿™ä¹ˆå†™ï¼šè¡¨ç¤ºä»itåˆ°endå…¨åˆ å®Œï¼Œå°±ä¸ç”¨whileäº†ã€‚\n    // vec.erase(it, vec.end());\n}\n```\n## for_each\næŒ‡å®šèŒƒå›´ï¼Œæ¯ä¸€ä¸ªå…ƒç´ åšæŸäº‹ã€‚\n\nä»¥ä¸‹è¡¨ç¤ºï¼šä»beginåˆ°endï¼Œæ¯ä¸ªå…ƒç´ è¾“å‡ºè‡ªå·±çš„å€¼+10çš„ç»“æœã€‚\n```cpp\nint main()\n{\n    std::vector<int> vec{ 0, 1, 2, 3, 4, 5, 6, 7, 8 };\n\n    std::for_each(\n        vec.begin(),\n        vec.end(),\n        [](auto const & v)\n        {\n            std::cout << v + 10 << std::endl;\n        });\n}\n```\n### å¹¶è¡ŒPolicy\nå¯ä»¥åœ¨`for_each`ä¸­ç¬¬ä¸€ä¸ªå‚æ•°åŠ ä¸Š`std::execution::par`è¡¨ç¤ºå¹¶è¡Œå¤„ç†ã€‚\n```cpp\nint main()\n{\n    std::vector<int> vec{ 0, 1, 2, 3, 4, 5, 6, 7, 8 };\n\n    std::for_each(\n        std::execution::par,\n        vec.begin(),\n        vec.end(),\n        [](auto const & v)\n        {\n            std::cout << v + 10 << std::endl;\n        });\n}\n```\nä½†æ˜¯è¾“å‡ºå¯èƒ½ä¼šä¹±ä¸ƒå…«ç³Ÿçš„ï¼š\n![](../../images/Cpp_20240512_STL/image-20240717062532492.png)\nè¿™æ˜¯å› ä¸ºæ²¡æœ‰åŠ é”ã€åŒæ­¥æœºåˆ¶ã€‚\n>é™¤äº†`std::execution::par`è¿˜æœ‰`std::execution::seq`ï¼Œè¡¨ç¤ºé¡ºåºæ‰§è¡Œã€‚\n## adjacent_find\nè¿”å›æœ‰é‡å¤å€¼çš„å¼€å§‹ä½ç½®ã€‚\n\n|           |                                                                                                                                                                   |\n| --------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| equality  | `template <class ForwardIterator>`<br>`ForwardIterator adjacent_find (ForwardIterator first, ForwardIterator last);`                                              |\n| predicate | `template <class ForwardIterator, class BinaryPredicate>`<br>`ForwardIterator adjacent_find (ForwardIterator first, ForwardIterator last, BinaryPredicate pred);` |\nå®ç°ï¼š\n```cpp\ntemplate <class ForwardIterator>\nForwardIterator adjacent_find (ForwardIterator first, ForwardIterator last)\n{\n    if (first != last)\n    {\n        ForwardIterator next=first; ++next;\n        while (next != last) {\n            if (*first == *next)     // or: if (pred(*first,*next)), for version (2)\n                return first;\n            ++first; ++next;\n        }\n    }\n    return last;\n}\n```\nè¦æ±‚è¿­ä»£å™¨æ˜¯constçš„ã€‚\n```cpp\nint main()\n{\n    std::vector<int> vec{ 0, 1, 2, 2, 4, 5, 6, 7, 8 };\n    //                          ^\n    //                          it\n    auto it = std::adjacent_find(vec.cbegin(), vec.cend());\n    while (it != vec.end())\n        std::cout << *it++ << std::endl;\n}\n/* è¾“å‡ºï¼š\n * 2\n * 2\n * 4\n * 5\n * 6\n * 7\n * 8\n */\n```\n### é€šè¿‡äºŒå…ƒè°“è¯é™å®š\nè¿”å›é‡å¤å€¼å¼€å§‹ä½ç½®åªæ˜¯`adjacent_find`çš„é»˜è®¤è¡Œä¸ºï¼Œå®é™…ä¸Šæ˜¯å®¹å™¨å†…ä¸¤ä¸ªç›¸é‚»å…ƒç´ çš„ä¸€ç§`==`å¯¹æ¯”ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰å¯¹æ¯”ç›¸é‚»å…ƒç´ çš„è¡Œä¸ºã€‚\n```cpp\nint main()\n{\n    std::vector<int> vec{ 0, 1, 2, 3, 4, 5, 6, 7, 8 };\n    //                             ^\n    //                             it\n    auto it = std::adjacent_find(\n        vec.cbegin(),\n        vec.cend(),\n        [](auto const& v, auto const& v2) -> bool)\n        {\n            return v == 3;\n        };\n    while (it != vec.end())\n        std::cout << *it++ << std::endl;\n}\n/* è¾“å‡ºï¼š\n * 3\n * 4\n * 5\n * 6\n * 7\n * 8\n */\n```\n## countã€count_if\n```cpp\ntemplate <class InputIterator, class T>\ntypename iterator_traits<InputIterator>::difference_type count (InputIterator first, InputIterator last, const T& val);\n```\nåˆè®¡ä»firståˆ°lastçš„valå€¼æœ‰å¤šå°‘ã€‚\n### ä¸executionç»“åˆ\nå¯ä»¥åœ¨ç¬¬ä¸€ä¸ªå‚æ•°ä¸­è®¾å®š`std::execution::par`ä»¥åˆ†è§£ä»»åŠ¡çš„å¹¶è¡Œæ–¹å¼æ‰§è¡Œã€‚\n```cpp\nint main()\n{\n    std::vector<int> vec{ 0, 1, 2, 3, 4, 5, 6, 7, 8, 3};\n    auto n = std::count(std::execution::par, vec.cbegin(), vec.cend(), 3);\n    // n = 2\n}\n```\n### lambda\nå¦‚ä¸‹ï¼Œç»Ÿè®¡å¥‡æ•°ã€‚\n```cpp\nint main()\n{\n    std::vector<int> vec{ 0, 1, 2, 3, 4, 5, 6, 7, 8, 3};\n    auto n = std::count_if(\n        std::execution::par,\n        vec.cbegin(),\n        vec.cend(),\n        [](auto const& v) -> bool\n        {\n            return v % 2 != 0;\n        });\n    // n = 5\n}\n\n```\n## copyã€shuffleã€is_permutation\n### copy\n```cpp\ntemplate <class InputIterator, class OutputIterator>\nOutputIterator copy (InputIterator first, InputIterator last, OutputIterator result);\n```\n1. firståˆ°lastæ˜¯è¦è¢«æ‹·è´çš„æ•°æ®ä½ç½®\n2. resultæ˜¯è¦å†™å…¥çš„ä½ç½®\n3. resultä¸èƒ½æŒ‡å‘firståˆ°lastä¸­çš„ä»»æ„ä¸€ä¸ªã€‚\n4. è¿”å›å†™å…¥çš„æœ€åä¸€ä¸ªæ•°æ®çš„ä¸‹ä¸€ä¸ªä½ç½®ã€‚\nå®ç°ï¼š\n```cpp\ntemplate<class InputIterator, class OutputIterator>\nOutputIterator copy (InputIterator first, InputIterator last, OutputIterator result)\n{\n    while (first != last) {\n        *result = *first;\n        ++result;\n        ++first;\n    }\n    return result;\n}\n```\n### shuffle\nshuffleæ„ä¸ºéšæœºæ´—ç‰Œçš„æ„æ€ã€‚\n```cpp\ntemplate <class RandomAccessIterator, class URNG>\nvoid shuffle (RandomAccessIterator first, RandomAccessIterator last, URNG&& g);\n```\n1. å‚æ•°1ã€2ä¸ºå¯éšæœºè®¿é—®çš„è¿­ä»£å™¨\n2. å‚æ•°3æ˜¯URNGï¼ŒæŒ‡åŸºäºçš„å¼•æ“ï¼Œå¸¸å¸¸ä½¿ç”¨`<random>`ä¸­çš„ã€‚\n3. å¦‚æœéœ€è¦æ¯æ¬¡è¿è¡Œæ—¶çš„ç»“æœä¸ä¸€æ ·ï¼Œéœ€è¦ä¼ å…¥ç§å­ã€‚\n### is_permutation\npermutationè¡¨ç¤ºä¸€ç»„æ•°æ®å¯èƒ½çš„ä¸€ç§åºåˆ—ã€æ’åˆ—ã€‚æ­¤å‡½æ•°ç”¨äºæ£€æŸ¥ä¸¤ä¸ªåºåˆ—æ˜¯å¦æ˜¯å½¼æ­¤çš„æ’åˆ—ï¼ˆå³ï¼Œä¸¤ä¸ªåºåˆ—ä¸­çš„å…ƒç´ ç›¸åŒï¼Œé¡ºåºå¯èƒ½ä¸åŒï¼‰\n\n>permutation and combinationÂ   n. æ’åˆ—ç»„åˆ\n\n|           |                                                                                                                                                                                                               |\n| --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| equality  | `template <class ForwardIterator1, class ForwardIterator2>`<br>`bool is_permutation (ForwardIterator1 first1, ForwardIterator1 last1, ForwardIterator2 first2);`                                              |\n| predicate | `template <class ForwardIterator1, class ForwardIterator2, class BinaryPredicate>`<br>`bool is_permutation (ForwardIterator1 first1, ForwardIterator1 last1, ForwardIterator2 first2, BinaryPredicate pred);` |\n1. å¯¹æ¯”first1åˆ°last2æ˜¯ä¸æ˜¯first2å¼€å§‹çš„ç›¸åŒæ•°ç›®çš„å…ƒç´ çš„ä¸€ç§æ’åˆ—ã€‚\n2. å¯ä»¥åŠ äºŒå…ƒè°“è¯ï¼Œå¦‚æœä¸åŠ åˆ™é»˜è®¤æ˜¯ç”¨`==`ä½œè°“è¯ã€‚\n3. éœ€è¦æ³¨æ„ï¼š\n    1. L1å…ƒç´ æ•°ç›®åº”å½“å°äºç­‰äºL2çš„å…ƒç´ æ•°ç›®ï¼Œ\n    2. å¦‚æœL1å…ƒç´ æ•°ç›®å¤§äºL2ï¼Œåˆ™ç¨‹åºå´©æºƒã€‚\n    3. L1é•¿åº¦å¦‚æœå°äºL2ï¼Œåªå’ŒL2çš„å‰L1é•¿åº¦ä¸ªå…ƒç´ è¿›è¡Œå¯¹æ¯”ã€‚\n    4. æ‰€ä»¥å¦‚æœè¦å¾—åˆ°æ­£ç¡®çš„ç»“æœï¼Œåº”è¯¥å‰æçŸ¥é“L1é•¿åº¦ç­‰äºL2é•¿åº¦ã€‚\n\nä»¥ä¸‹ä¸ºå®ç°ï¼š\n```cpp\n// å…¨ç¨‹ä¸­ï¼Œfirst1 å’Œ first2ã€last2ä¸€æ—¦ç¡®å®šå°±å›ºå®šäº†ã€‚\n// it1æ˜¯L1çš„æœ«å°¾è¾¹ç•Œï¼ˆå¼€åŒºé—´ï¼‰ï¼Œæ˜¯å‰è¿›æŒ‡é’ˆã€‚\ntemplate <class InputIterator1, class InputIterator2>\nbool is_permutation (InputIterator1 first1, InputIterator1 last1, InputIterator2 first2)\n{\n    // å¯»æ‰¾L1å’ŒL2ä¸åŒ¹é…çš„åœ°æ–¹\n    // std::mismatch å‡½æ•°è¿”å›ä¸€ä¸ª std::pairï¼Œå…¶ä¸­åŒ…å«ä¸¤ä¸ªè¿­ä»£å™¨ï¼Œåˆ†åˆ«æŒ‡å‘ä¸¤ä¸ªåºåˆ—ä¸­ç¬¬ä¸€ä¸ªä¸åŒ¹é…çš„å…ƒç´ ã€‚\n    std::tie(first1, first2) = std::mismatch(first1, last1, first2);\n    // å…¨åŒ¹é…ï¼Œç›´æ¥true\n    if (first1 == last1)\n        return true;\n    // last2ç§»åŠ¨last1åˆ°first1çš„å·®å€¼ï¼Œç¡®å®šL2çš„èŒƒå›´\n    InputIterator2 last2 = first2;\n    std::advance(last2,std::distance(first1, last1));\n    // æ€»ä½“æ˜¯è®¡ç®—L1æ¯ä¸ªå‡ºç°è¿‡çš„å…ƒç´ åœ¨L2ä¸­æœ‰å¤šå°‘ä¸ª\n    // é‡Œé¢åœ¨first1åˆ°it1ä¹‹é—´find it1æ˜¯ä¸ºäº†é¿å…é‡å¤æŸ¥è¯¢\n    for (InputIterator1 it1 = first1; it1 != last1; ++it1) \n    {\n        if (std::find(first1, it1, *it1) == it1)\n        {\n            // å¼€å§‹è®¡ç®—L1ä¸­è¿™ä¸ª*it1åœ¨L2ä¸­å‡ºç°å¤šå°‘æ¬¡\n            auto n = std::count(first2, last2, *it1);\n            // å¦‚æœåœ¨L2ä¸­æ²¡å‡ºç°è¿‡ï¼Œè‚¯å®šfalseã€‚\n            // è®¡ç®—åœ¨L1ä¸­çš„æ¬¡æ•°ã€‚çœ‹çœ‹å’Œnæ˜¯å¦åŒ¹é…ã€‚\n                // å³ä½¿åœ¨L2å‡ºç°è¿‡ï¼Œä½†æ˜¯L2ä¸­çš„æ¬¡æ•°ä¸L1çš„æ¬¡æ•°ä¸å¯¹åº” åˆ™ è¿˜æ˜¯ä¸åŒ¹é…ç›¸åŒæ¬¡æ•°ã€‚\n                // ä¸ºä½•ä¸ç›´æ¥è®¡ç®—ã€å¯¹æ¯”ä¸¤ä¸ªç»„ä¸­çš„æ¬¡æ•°ï¼Ÿå› ä¸ºä¸€æ—¦nä¸º0å°±ä¸ç”¨è®¡ç®—L1ä¸­æ¬¡æ•°äº†ï¼Œç¨ç¨æå‡ä¸€ä¸‹æ•ˆç‡ã€‚\n            if (n == 0 || std::count(it1, last1, *it1) != n)\n                return false;\n        }\n    }\n    return true;\n}\n```\n### ç¤ºä¾‹\næŠŠvecå¤åˆ¶åˆ°vec2ï¼ŒvecéšæœºåŒ–ï¼Œç„¶åå†åˆ¤æ–­\n```cpp\nint main()\n{\n    std::vector<int> vec{ 0, 1, 2, 3, 4, 5, 6, 7, 8 };\n    std::vector<int> vec2(vec.size());\n\n    std::copy(vec.cbegin(), vec.cend(), vec2.begin());\n    std::shuffle(vec.begin(), vec.end(), std::default_random_engine());\n    bool res = std::is_permutation(vec.cbegin(), vec.cend(), vec2.cbegin());\n    if (res) \n        std::cout << \"vecç»è¿‡æ‰“ä¹±åï¼Œä¾ç„¶æ˜¯vec2çš„é‡æ–°æ’åˆ—\" << std::endl;\n    else std::cout << \"vecä¸æ˜¯vec2çš„é‡æ–°æ’åˆ—\" << std::endl;\n    \n    for (auto const& v : vec)\n        std::cout << v << std::endl;\n}\n/* è¾“å‡ºï¼š\n * vecç»è¿‡æ‰“ä¹±åï¼Œä¾ç„¶æ˜¯vec2çš„é‡æ–°æ’åˆ—\n * 4\n * 0\n * 3\n * 1\n * 5\n * 7\n * 6\n * 2\n * 8\n */\n```\n## transform\ntransform range. ç»è¿‡ä¸€ä¸ªè®¡ç®—æ“ä½œï¼Œå˜æ¢ä¸ºå¦ä¸€ç§å•ä½ã€‚\næ“ä½œå¯ä»¥æ˜¯ä¸€å…ƒï¼Œä¹Ÿå¯ä»¥æ˜¯äºŒå…ƒã€‚\n### ä¸€å…ƒ\nä»¥ä¸‹æ“ä½œè¡¨ç¤ºï¼šæŠŠvecä¸­çš„æ•°æ®æ¯ä¸ªéƒ½å¹³æ–¹ã€è½¬ä¸ºlong longåå­˜åˆ°vec2ã€‚\n```cpp\nint main()\n{\n    std::vector<int> vec{ 0, 1, 2, 3, 4, 5, 6, 7, 8 };\n    std::vector<long long> vec2(vec.size());\n    std::transform(\n        std::execution::par, //ä¾ç„¶å¯ä»¥ç”¨paræ‰§è¡Œ\n        vec.cbegin(),\n        vec.cend(),\n        vec2.begin(),\n        [](auto const& v) -> long long\n        {\n            return v * v;\n        });\n}\n```\n\n>è¿™é‡Œå‘ç°ä¸€ä¸ªé—®é¢˜ï¼šå½“`(auto const& v)`ä¸­`&`æ”¹ä¸º`&&`æ—¶å°±è¿è¡Œæ—¶æŠ¥é”™ã€‚\n>è€Œå»æ‰`const`åï¼Œ`(auto && v)`ä¸­`&&`å°±åˆæ²¡é—®é¢˜äº†ã€‚\n>çœ‹æ¥å¦‚æœä»¥åæƒ³ç”¨è½¬å‘å¼•ç”¨`&&`ï¼Œå°±ä¸èƒ½å’Œconstå…±å­˜ã€‚\n>ç»è¿‡åˆ†æï¼Œå‘ç°`(auto && v)`æ˜¯å¯ä»¥æ¨æ–­å‡ºvæ˜¯`const int &`çš„ï¼Œå› æ­¤ä¸è¦å†è‡ªå·±åŠ constäº†ã€‚\n\n### äºŒå…ƒ\n```cpp\nint main()\n{\n    std::vector<int> vec{ 0, 1, 2, 3, 4, 5, 6, 7, 8 };\n    std::vector<int> vec2{ 10, 11, 12, 13, 14, 15, 16, 17, 18 };\n    std::vector<long long> vec3(vec.size());\n    std::transform(\n        std::execution::par, //ä¾ç„¶å¯ä»¥ç”¨paræ‰§è¡Œ\n        vec.cbegin(),\n        vec.cend(),\n        vec2.cbegin(),\n        vec3.begin(),\n        [](auto && v, auto && v2) -> long long\n        {\n            return v + v2;\n        });\n}\n```\n### ä¸`<funcational>`ç»“åˆ\nè¯¥åº“ä¸­æä¾›äº†ä¸€äº›è¿ç®—ç±»ã€‚å¦‚minusã€plusã€multiplies\nåŸå‹ï¼š\n```cpp\ntemplate <class T>\nstruct plus\n{\n    T operator() (const T& x, const T& y) const\n    {\n        return x + y;\n    }\n    typedef T first_argument_type;\n    typedef T second_argument_type;\n    typedef T result_type;\n};\n```\nä½¿ç”¨ï¼šç›´æ¥æ”¾åœ¨functorçš„ä½ç½®ï¼Œä¸ç”¨å£°æ˜å‚æ•°ï¼Œç›´æ¥å°±ç»™ä½ æå–äº†ã€‚ç”šè‡³å¯ä»¥ä¸å¡«æ¨¡æ¿å‚æ•°ï¼å¤ªå¼ºæ‚äº†ã€‚\n```cpp\n#include <functional>\nint main()\n{\n    std::vector<int> vec{ 0, 1, 2, 3, 4, 5, 6, 7, 8 };\n    std::vector<int> vec2{ 10, 11, 12, 13, 14, 15, 16, 17, 18 };\n    std::vector<long long> vec3(vec.size());\n    std::transform(\n        std::execution::par, //ä¾ç„¶å¯ä»¥ç”¨paræ‰§è¡Œ\n        vec.cbegin(),\n        vec.cend(),\n        vec2.cbegin(),\n        vec3.begin(),\n        std::plus<int>()/* ç”šè‡³å¯ä»¥çœç•¥ä¸º std::plus() */);\n}\n// è¿è¡Œåvec3ä¸­ç»“æœï¼š10 12 14 16 18 20 22 24 26\n```\n## accumulateã€reduce\næ¥è‡ª`<numeric>`\næŠŠæ‰€æœ‰éƒ¨åˆ†ç´¯ç§¯èµ·æ¥ã€‚`C++17`ä¹‹åæ¼”åŒ–æˆäº†reduceã€‚\nreduceå¯ä»¥ç”¨parï¼Œè€Œaccumulateä¸èƒ½ã€‚\n \n|        |                                                                                                                                                                  |\n| ------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| sum    | `template <class InputIterator, class T>`<br>`T accumulate (InputIterator first, InputIterator last, T init);`                                                   |\n| custom | `template <class InputIterator, class T, class BinaryOperation>`<br>`T accumulate (InputIterator first, InputIterator last, T init, BinaryOperation binary_op);` |\nå…¶ä¸­initå¯ä»¥æŒ‡å®šä¸€ä¸ªèµ·å§‹å€¼ã€åŸºå‡†å€¼ã€‚\n\nå®ç°\n```cpp\ntemplate <class InputIterator, class T>\nT accumulate (InputIterator first, InputIterator last, T init)\n{\n    while (first!=last) {\n        init = init + *first;  // or: init=binary_op(init,*first) for the binary_op version\n        ++first;\n    }\n    return init;\n}\n```\nä½¿ç”¨\n```cpp\n#include <numeric>\nint main()\n{\n    std::vector<int> vec{ 1, 2, 3, 4, 5, 6, 7, 8 };\n    \n    // sum = 36\n    auto sum = std::reduce(std::execution::par, vec.cbegin(), vec.cend());\n    // sum = 100 + 36\n    auto sum = std::reduce(std::execution::par, vec.cbegin(), vec.cend(), 100);\n}\n```\n### åˆ¶å®šreduceè§„åˆ™\nä½¿ç”¨lambdaè¡¨è¾¾å¼ï¼ŒæŒ‡å®šreduceçš„è®¡ç®—è§„åˆ™ã€‚æ¯”å¦‚å¯ä»¥è®©å®ƒä»ç´¯åŠ å˜ä¸ºç´¯ä¹˜ã€‚\nå¦‚æœæ˜¯äºŒå…ƒè¿ç®—ï¼Œå¿…é¡»æä¾›initå€¼ï¼Œä½œä¸ºç¬¬ä¸€æ¬¡è¿ç®—æ—¶v1çš„å ä½å€¼ï¼Œï¼ˆç¬¬ä¸€æ¬¡è¿ç®—ï¼Œv2å æ®`vec[0]`ï¼Œå¿…é¡»æä¾›ä¸€ä¸ªv1æ­é…ï¼Œå°±ç”±initå……å½“ï¼‰\nä½†æ˜¯è¦æ³¨æ„ï¼Œå¦‚æœæ˜¯ä¹˜æ³•ï¼Œåˆ™initä¸å¯ä»¥ä¸º0ï¼Œå¦åˆ™æ— è®ºå¦‚ä½•è®¡ç®—ç»“æœéƒ½ä¸º0ï¼Œæ­£ç¡®çš„åº”è®¾ç½®ä¸º1ã€‚\n```cpp\n#include <numeric>\nint main()\n{\n    std::vector<int> vec{ 1, 2, 3, 4, 5, 6, 7, 8 };\n    \n    auto sum = std::reduce(\n        std::execution::par,\n        vec.cbegin(),\n        vec.cend(),\n        100,          // èµ·å§‹å€¼\n        [](auto&& v, auto&& v2) -> int\n        {\n            return v + v2 + 15;\n        });\n}\n```\nåŒç†ï¼Œä¹Ÿå¯ä»¥ç”¨`<functional>`ä¸­çš„functorä½œä¸ºè°“è¯ã€‚\n```cpp\nint main()\n{\n    std::vector<int> vec{ 1, 2, 3, 4, 5, 6, 7, 8 };\n    \n    auto sum = std::reduce(\n        std::execution::par,\n        vec.cbegin(),\n        vec.cend(),\n        0,          // èµ·å§‹å€¼\n        std::plus());\n    // sum = 36\n}\n```\n# rangesã€æµæ°´çº¿ï¼ˆpipelineï¼‰ã€é¢å‘è¿‡ç¨‹ï¼ˆå‡½æ•°ï¼‰ç¼–ç¨‹\n`C++20`\nrangeså¯ä»¥è®©è®¡ç®—è¿›è¡Œæµæ°´çº¿åŒ–ã€‚ä»¥ä¸‹æ˜¯æ¡ˆä¾‹ï¼š\n\næŠŠå¥‡æ•°æŒ‘å‡ºæ¥ã€‚å¹¶ä¸”æŠŠæ¯ä¸ªæ•°åšä¸€æ¬¡å˜æ¢ã€‚\n```cpp\nclass IsOdd\n{\npublic:\n    bool operator () (int const& v)\n    {\n        return v % 2 != 0;\n    }\n};\nint main()\n{\n    std::vector<int> vec{ 1, 2, 3, 4, 5, 6, 7, 8 };\n    std::vector<int> vec2(vec.size());\n\n    auto it = std::copy_if(\n        vec.cbegin(),\n        vec.cend(),\n        vec2.begin(),\n        [](auto&& v) -> bool\n        {\n            return v % 2 != 0;\n        });\n}\n```\n## ä¸å°¾æ’è¿­ä»£å™¨ç»“åˆ\n`std::back_inserter(vec2)`åªç”¨æ‰§è¡Œä¸€æ¬¡ï¼Œä¸vec2äº§ç”Ÿå…³è”ï¼Œç”Ÿæˆä¸€ä¸ªè¾“å‡ºè¿­ä»£å™¨ã€‚åœ¨ç®—æ³•å‘ç”Ÿè¾“å‡ºæ—¶ï¼Œå°±åœ¨å°¾éƒ¨è‡ªåŠ¨æ‰©å®¹å¹¶æ’å…¥æ•°æ®ã€‚\n\n>ä½†`back_inserter`ä¸é€‚åˆä¸vectoræ­é…ï¼Œå› ä¸ºå°¾æ’ä¼šé€ æˆå®¹é‡é¢‘ç¹æ”¹å˜ã€‚æ›´é€‚åˆä¸listæ­é…ã€‚\n\n```cpp\n#include <iterator>\nint main()\n{\n    std::vector<int> vec{ 1, 2, 3, 4, 5, 6, 7, 8 };\n    // æ— éœ€ç»™vec2å¼€è¾Ÿç©ºé—´äº†ï¼Œä¸‹é¢çš„back_inserterå¸®æˆ‘ä»¬å¤„ç†\n    std::vector<int> vec2;\n    // filter\n    auto it = std::copy_if(\n        vec.cbegin(),\n        vec.cend(),\n        std::back_inserter(vec2),\n        [](auto&& v) -> bool\n        {\n            return v % 2 != 0;\n        });\n    // transform \n    std::transform(\n        std::execution::par,\n        vec2.cbegin(),\n        vec2.cend(),\n        vec2.begin(),\n        [](auto && v) -> auto\n        {\n            return v * v;\n        });\n}\n```\n1. å…ˆç”Ÿæˆæºæ•°æ®ï¼ˆå¯ä»¥ç”¨generatoræˆ–fillæ¥å¡«å……ï¼‰\n2. é€‰æ‹©æ€§æ‹·è´ï¼Œå³filter\n    1. ç”¨é«˜é˜¶å‡½æ•°ï¼ˆlambdaå‡½æ•°å¯¹è±¡ï¼‰é™å®šfilterè¡Œä¸º\n    2. ç”¨`back_inserter`åšè¾“å‡º\n3. transformã€‚\n\nè¿™ç§æ•°æ®æµå¼ï¼ˆdata flowï¼‰ã€æµæ°´çº¿å¼çš„æ“ä½œï¼Œæ˜¯ä¸€ç§å¸¸è§äºå¤§å‹è½¯ä»¶çš„è®¾è®¡æ¨¡å¼ã€‚è¿™ç§å°±å¾ˆé€‚åˆç”¨`C++20`ä¸­çš„rangesåº“æ¥å¤„ç†ã€ç®€åŒ–ã€‚\n## ç¤ºä¾‹\nä¸€èˆ¬çš„filterå¦‚`copy_if`çš„å‚æ•°éœ€è¦ä¸¤ä¸ªè¾“å…¥è¿­ä»£å™¨ã€ä¸€ä¸ªè¾“å‡ºè¿­ä»£å™¨å’Œä¸€ä¸ªè°“è¯ï¼Œç°åœ¨rangesæ­é…ç®¡é“ç¬¦å·ï¼Œå‚æ•°åªéœ€è¦å¡«å†™è°“è¯å³å¯ã€‚\nfilterã€transforméƒ½æ˜¯ä¸€ä¸ªviewï¼Œæ¯ä¸€ä¸ªviewåœ¨å†…éƒ¨éƒ½æœ‰è‡ªå·±çš„è¿­ä»£ç³»ç»Ÿã€‚\n```cpp\nvoid example()\n{\n    std::vector<int> vec{ 1, 2, 3, 4, 5, 6, 7, 8 };\n    auto trans_view = vec | std::ranges::views::filter(\n        [](auto&& v) -> bool\n        {\n            return v % 2 != 0;\n        }) | std::ranges::views::transform(\n            [](auto && v) -> auto\n            {\n                return v * v;\n            });\n    for (auto && v : trans_view)\n    {\n        std::cout << v << std::endl;\n    }\n}\nint main()\n{\n    example();\n    // è¾“å‡º 1 9 25 49\n}\n```\nè°ƒè¯•æ—¶ï¼Œå‘ç°é¦–å…ˆç•¥è¿‡äº†viewï¼Œè€Œæ˜¯åˆ°äº†forå¾ªç¯å–ç»“æœæ—¶æ‰å›å»æ±‚å€¼ã€‚è¿™ç§æ±‚å€¼æ–¹å¼ç§°ä¹‹ä¸ºï¼šæƒ°æ€§æ±‚å€¼ã€‚\nè¢«è¿‡æ»¤æ‰çš„å€¼ï¼Œåœ¨åŸä½ç½®ä¸Šç”¨`ranges::dangling`ä½œå ä½ç¬¦ã€‚\nè¿™ç§ç¼–ç¨‹èŒƒå¼ç§°ä¹‹ä¸ºï¼šfunctional programming\n\næ›´ç®€æ´çš„å†™æ³•ï¼šï¼ˆrangeså¯ä»¥çœç•¥ï¼Œç›´æ¥å†™`std::views`ï¼‰\n```cpp\n// æ›´ç®€æ´çš„å†™æ³•ï¼š\nvoid example()\n{\n    auto is_odd = [](auto& v) -> bool\n        {\n            return v % 2 != 0;\n        };\n    auto square = [](auto&& v) -> auto\n        {\n            return v * v;\n        };\n     for(auto&& v : vec | std::views::filter(is_odd) | std::views::transform(square))\n     {\n         std::cout << v << std::endl;\n     }\n}\n```\n## viewsã€æƒ°æ€§è®¡ç®—\n![](../../images/Cpp_20240512_STL/image-20240720064453824.png)\n1. viewæ˜¯ä¾èµ–vectorçš„ï¼Œå†…å®¹æ¥è‡ªvectorï¼Œå®é™…ä¸Šviewå¯¹å®¹å™¨çš„æ¯ä¸ªå…ƒç´ è¿›è¡Œäº†ä¸€äº›è¿æ¥\n2. viewç»è¿‡å„ç§å˜æ¢ï¼Œå¦‚`filter`ã€`transform`ï¼Œä¹Ÿå°†å˜ä¸ºä¸€ä¸ªview\n3. viewå¯ä»¥é€šè¿‡ç®¡é“+`std::ranges::to`å˜ä¸ºä¸€ä¸ªå®¹å™¨ã€‚\n\næƒ°æ€§è®¡ç®—ï¼š\n1. viewä¸­æ²¡æœ‰ä»»ä½•å®ä½“å…ƒç´ ï¼Œåªæ˜¯é€»è¾‘ä¸Šçš„æ˜ å°„ã€‚\n2. å¦‚æœæ­¤æ—¶viewè¦è®©å…ƒç´ 6åŠ 2ï¼Œåˆ™viewæ˜¯æŠŠå…ƒç´ 6+2çš„è¿™ä¸ªæ“ä½œå†…å®¹ã€æŠ½è±¡é€»è¾‘ä¼ ç»™ä¸‹ä¸€æ­¥ã€‚åœ¨å®é™…æ“ä½œä¹‹å‰ï¼Œä¸€ç³»åˆ—çš„æ“ä½œå†…å®¹å¯ä»¥ç§¯ç´¯åˆ°ä¸€èµ·ï¼Œåˆ°æœ€åå†ä¸€æ¬¡æ€§è®¡ç®—ã€‚å®é™…çš„æ“ä½œåªæœ‰æœ€åvectorè¢«è¯»å–ã€è°ƒç”¨çš„æ—¶å€™æ‰å»ä»vectorå–å…ƒç´ ã€‚\n3. ä¸­é—´çš„viewåªæ˜¯æŠŠæ“ä½œè¿æ¥ä¸Šï¼Œç›¸å½“äºå‡½æ•°å¥—å†…éƒ¨å‡½æ•°ï¼Œé€»è¾‘è¡Œä¸ºå¥—å†…éƒ¨è¡Œä¸ºã€‚å°±ç±»ä¼¼äºlambdaå‡½æ•°ã€‚è¿™ç§éƒ½å«åšæƒ°æ€§è®¡ç®—ï¼Œæ˜¯é¢å‘å‡½æ•°ç¼–ç¨‹èŒƒå¼çš„ç‰¹ç‚¹ï¼Œæ›´å…³æ³¨äºé«˜é˜¶çš„æŠ½è±¡ã€å¹²ä»€ä¹ˆé€»è¾‘ï¼Œä¸å…³æ³¨å…·ä½“æ“ä½œã€‚","categories":["Cpp","Modern","STL"]},{"title":"Source Insightä½¿ç”¨","url":"/ä¸€äº›å·¥å…·çš„ä½¿ç”¨/Source Insightä½¿ç”¨/","content":"# å¿«é€Ÿä¸Šæ‰‹\n\n1. å·¦ä¸Šè§’ï¼ŒProjectï¼ŒNew Projectï¼Œæ–°å»ºä¸€ä¸ªå·¥ç¨‹ã€‚å‡ºç°ä»¥ä¸‹ç•Œé¢ï¼š\n   ![](../../images/Source%20Insightä½¿ç”¨/image-20240506213527152.png)\n2. Source Insightçš„å·¥ç¨‹æ–‡ä»¶å¤¹å’Œæºç æ ¹æ–‡ä»¶å¤¹éœ€è¦å¹¶åˆ—åœ¨ä¸€èµ·ã€‚å¯ä»¥åœ¨æºç æ ¹æ–‡ä»¶å¤¹ä¹‹å¤–åˆ›å»ºä¸€ä¸ª\"Insight\"ï¼ˆåå­—è‡ªå®šï¼‰çš„æ–‡ä»¶å¤¹ã€‚\n   ![](../../images/Source%20Insightä½¿ç”¨/image-20240506213827928.png)\n3. å°†Insightçš„ç›®å½•åœ°å€æ‹·è´åˆ°ç¬¬1æ­¥çš„ç¬¬2ä¸ªç©ºå†…ã€‚ç‚¹å‡»OKã€‚\n   ![](../../images/Source%20Insightä½¿ç”¨/image-20240506214358083.png)\n4. å‡ºç°New Project Settingsçª—å£ï¼Œé»˜è®¤ä¸æ”¹å˜è®¾ç½®ã€‚ç»§ç»­OKã€‚\n   ![](../../images/Source%20Insightä½¿ç”¨/image-20240506214516331.png)\n5. å‡ºç°Add and Remove Project Filesçª—å£ï¼Œç‚¹å‡»æºç æ ¹æ–‡ä»¶å¤¹ï¼Œå†ç‚¹å‡»å³ä¾§è¾¹çš„Add TreeæŒ‰é’®ã€‚æ·»åŠ å®Œæˆåï¼ŒCloseæ­¤çª—å£å³å¯ã€‚\n   ![](../../images/Source%20Insightä½¿ç”¨/image-20240506214715147.png)\n6. æ·»åŠ å®Œå·¥ç¨‹æ–‡ä»¶åã€‚æ¥ç€ï¼Œå·¦ä¸Šè§’ï¼ŒProjectï¼ŒSynchronize Filesã€‚åŒæ­¥ä»¥åï¼Œåœ¨Source Insightä¸­ç¼–è¾‘æ—¶å¯ä»¥åŒæ—¶åŒæ­¥ç£ç›˜ä¸Šçš„æ–‡ä»¶ã€‚ï¼ˆä¸åŒæ­¥å…¶å®ä¹Ÿå¯ä»¥ï¼Œéº»çƒ¦ä¹‹å¤„å°±æ˜¯å¦‚æœç¨å¾®æ”¹åŠ¨ä¸€ä¸‹ä»£ç å®ƒå°±æ€»ä¼šæç¤ºæ˜¯å¦ä¿å­˜ï¼‰\n   ![](../../images/Source%20Insightä½¿ç”¨/image-20240506215047348.png)\n7. åŒæ­¥å®Œåï¼Œå³å¯ç‚¹å‡»å·¥å…·æ ä¸­çš„åœ†åœˆå¸¦Pçš„æŒ‰é’®ï¼Œæ‰“å¼€èœå•ï¼ŒæŸ¥çœ‹æ–‡ä»¶ã€‚\n   ![](../../images/Source%20Insightä½¿ç”¨/image-20240506215346027.png)\n# é…ç½®\n\nå¦‚æœæ–‡ä»¶åç¼€åä¸æ˜¯å¸¸è§„çš„ï¼Œæ¯”å¦‚Cppçš„`.cpp`æ‰©å±•åå†™ä½œäº†`.cc`ï¼Œé‚£ä¹ˆå°±éœ€è¦äººä¸ºé…ç½®ã€‚\n1. å·¦ä¸Šæ–¹ï¼ŒOptionsï¼ŒFile Type Options\n   ![](../../images/Source%20Insightä½¿ç”¨/image-20240506215618397.png)\n2. å·¦ä¾§æ é€‰æ‹©æŸä¸€è¯­è¨€çš„æ–‡ä»¶ç±»å‹ï¼Œåœ¨å³ä¾§æœ€ä¸Šæ–¹çš„File Filterä¸­è¯¦ç»†åŠ è§„åˆ™ï¼Œå¦‚å›¾ï¼š\n   ![](../../images/Source%20Insightä½¿ç”¨/image-20240506215938879.png)\n3. é…ç½®å®Œåï¼Œéœ€è¦å†æ¬¡Add Treeï¼Œéœ€è¦ç‚¹å‡»Projectï¼ŒAdd and Remove Project Files\n   ![](../../images/Source%20Insightä½¿ç”¨/image-20240506220109756.png)\n# å¿«æ·é”®é…ç½®\n\nOptionsï¼ŒKey Assignmentsã€‚å¯ä»¥é…ç½®ä»£ç é«˜äº®çš„å¿«æ·é”®ã€‚\n![](../../images/Source%20Insightä½¿ç”¨/image-20240506224734346.png)\n\n","categories":["ä¸€äº›å·¥å…·çš„ä½¿ç”¨"]},{"title":"Cpp_Concepts","url":"/Cpp/Cpp_Concepts/","content":"# Concepts\næ„ä¸ºæ¦‚å¿µï¼Œç”¨äºé™å®šç±»å‹æ˜¯å“ªäº›å­ç±»å‹ã€‚\n# Conceptsä¸­çš„requiresçº¦æŸ\n\n```cpp\n#include<iostream>\n#include<concepts>\ntemplate <typename T>\nT add<T a, T b>\n{\n    return a + b;\n}\n\nint main()\n{\n    auto c = add(1, 2);\n    return 0;\n}\n```\nä»¥ä¸Šï¼Œä¼šè‡ªåŠ¨æ¨æ–­å‡º1ã€2ä¸ºintï¼Œè¿”å›å€¼3äº¦ä¸ºintã€‚\nç›®å‰æœ‰éœ€æ±‚ï¼Œä»…ä»…æƒ³è¦addè¿›è¡Œintçš„è®¡ç®—ï¼Œæ¯”å¦‚ç¦æ­¢æµ®ç‚¹å‹çš„è®¡ç®—ã€‚åˆ™å¯ç”¨requiresçº¦æŸ\n```cpp\n#include<iostream>\n#include<concepts>\ntemplate <typename T> requires(std::integral<T>)\nT add(T a, T b)\n{\n    return a + b;\n}\n\nint main()\n{\n    auto c = add(1, 2);\n    return 0;\n}\n```\nå¦‚æœmainå‡½æ•°è°ƒç”¨addæ—¶ä¼ å…¥æµ®ç‚¹å‹ï¼šåˆ™ç¼–è¯‘ä¸é€šè¿‡\n> æŠ¥é”™ï¼š\n> no instance of function template \"add\" matches the argument list\n> argument types are: (double, double)\n\n```cpp\nint main()\n{\n    auto c = add(1.0, 2.0);   // error\n    return 0;\n}\n```\nå¦‚æœæƒ³è¦æ¥å—æµ®ç‚¹å‹æ•°æ®ï¼Œå¯ä»¥åœ¨requiresä¸­åŠ å…¥`||`\n```cpp\ntemplate <typename T> requires(std::integral<T> || std::floating_point<T>)\nT add(T a, T b)\n{\n    return a + b;\n}\n\nint main()\n{\n    auto c = add(1.0, 2.0);     // ok\n    return 0;\n}\n```\n# `type_traits`\n\nType Traitså°±æ˜¯åœ¨ç¼–è¯‘æœŸæŠŠå„ç§æƒ…å†µåˆ—ä¸¾å‡ºæ¥ï¼Œæ ¹æ®ä¸åŒçš„ç§ç±»å»åˆ¤æ–­Tæ˜¯ä¸æ˜¯å±äºæŸç§æƒ…å†µã€‚ç„¶åå°±å¯ä»¥ç”¨åœ¨conceptä¸­ã€‚\n\n`std::is_integral`\n\nMember types:\n\n| member type  | definition                         |\n| ------------ | ---------------------------------- |\n| `value_type` | bool                               |\n| type         | either `true_type` or `false_type` |\n\nMember constants:\n\n| member constant | definition               |\n| --------------- | ------------------------ |\n| value           | either `true` or `false` |\n\n`std::is_integral`åé¢å¾€å¾€è¦åŠ `<T>::value`ä»¥å–å‡ºçœŸå‡å€¼ï¼Œæˆ–è€…å¯ä»¥ç”¨`std::is_integral_v<T>`ä»£æ›¿ã€‚\n```cpp\n// concepts æ–‡ä»¶ ä¸­ std::integral<T>çš„åŸå‹\n_EXPORT_STD template <class _Ty>\nconcept integral = is_integral_v<_Ty>;\n```\næœ‰å¥½å¤šç§å†™æ³•ï¼š\n1. `std::integral<T>`\n2. `std::is_integral<T>::value`\n3. `std::is_integral_v<T>`\n# è‡ªå®šä¹‰concept\n\né’ˆå¯¹æŸç§ç±»å‹è¿›è¡Œçº¦æŸï¼š\n```cpp\ntemplate<typename T>\nconcept my_concept = std::integral<T> || std::floating_point<T>;\n```\nå¦‚æ­¤ï¼Œrequiresåé¢ä½¿ç”¨çº¦æŸæ¡ä»¶å°±æ›´åŠ æ–¹ä¾¿äº†ï¼š\n```cpp\ntemplate<typename T> requires(my_concept<T>)\nT add(T a, T b)\n{\n    return a + b;\n}\n```\n\n# æ›´å¤æ‚çš„concept\n\nrequiresä¸ä»…å¯ä»¥ç›´æ¥ä½¿ç”¨conceptï¼Œä¹Ÿå¯ä»¥ç”¨äºå®šä¹‰æ–°çš„conceptã€‚\nå¦‚ï¼š`template<typename T> concept my_concept = requires(T t) { // ... }`\næˆ–`template<typename T> concept my_concept = requires(boolå‚æ•°)`\nç¬¬ä¸€ç§æ˜¯ä½¿ç”¨ä¸€äº›ç±»å‹å‚æ•°ï¼Œå¤§æ‹¬å·å†…ä¼šå»åŒ¹é…ä½ è§„å®šçš„å½¢å¼ï¼Œè¿™äº›å½¢å¼éœ€è¦éµå¾ªå®˜æ–¹è§„å®šçš„å†™æ³•ã€‚\n## é™åˆ¶ ç±»å¿…é¡»æœ‰ æŸä¸ªé™å®šå‡½æ•°\n\nå¦‚ä¸‹å®šä¹‰ï¼Œè¡¨è¾¾çš„æ˜¯ï¼štæ˜¯å¦æœ‰åä¸º`get_v`ã€æ— å‚æ•°çš„æ–¹æ³•ï¼Œå¹¶ä¸”è¿”å›çš„æ˜¯ä¸æ˜¯`bool`ç±»å‹ã€‚\n```cpp\ntemplate<typename T>\nconcept my_concept = requires(T t)\n{\n    { t.get_v() } -> std::same_as<bool>;\n}; // è®°å¾—åŠ ;\n```\nä½¿ç”¨å¦‚ä¸‹ï¼š\n```cpp\nclass Test\n{\npublic:\n    bool get_v(void)\n    {\n        return true;\n    }\n};\ntemplate<typename T> requires(my_concept<T>)\nvoid show(T t)\n{\n    auto r = t.get_v();\n    std::cout << r << std::endl;\n}\nint main()\n{\n    Test test;\n    show(test);\n}\n```\nå¦‚æœæŠŠTestç±»ä¸­çš„`get_v`æ–¹æ³•æ”¹åä¸º`get_v2`ï¼Œè®©showå‡½æ•°è°ƒç”¨`t.get_v2`ã€‚æœ€åç¼–è¯‘ä¸é€šè¿‡ã€‚å› ä¸ºæ¨¡æ¿å‚æ•°Tå¯¹åº”çš„Testç±»ä¸­æ²¡æœ‰åä¸º`get_v`ã€æ— å‚æ•°ä¸”è¿”å›å€¼ä¸ºboolçš„æ–¹æ³•ã€‚\n> æŠ¥é”™ï¼š\n> no instance of function template \"show\" matches the argument list\n> argument types are: (Test)\n\n```cpp\ntemplate<typename T>\nconcept my_concept = requires(T t)\n{\n    { t.get_v() } -> std::same_as<bool>;\n};\nclass Test\n{\npublic:\n    bool get_v2(void)\n    {\n        return true;\n    }\n};\ntemplate<typename T> requires(my_concept<T>)\nvoid show(T t)\n{\n    auto r = t.get_v2();  // ä¸æŠ¥é”™ï¼Œä½†mainå‡½æ•°ä¸­çš„show(test)æŠ¥é”™\n    std::cout << r << std::endl;\n}\nint main()\n{\n    Test test;\n    show(test);    // error\n}\n```\n### å¯¹æˆå‘˜æ–¹æ³•çš„constä¿®é¥°ç¬¦å¿½ç•¥\n`bool get_v(void) const`è™½ç„¶åŠ äº†constï¼Œä½†å¯ä»¥é€šè¿‡\n```cpp\ntemplate<typename T>\nconcept my_concept = requires(T t)\n{\n    { t.get_v() } -> std::same_as<bool>;\n};\nclass Test\n{\npublic:\n    bool get_v(void) const // è™½ç„¶åŠ äº†const ä½†å¯ä»¥é€šè¿‡\n    {\n        return true;\n    }\n};\ntemplate<typename T> requires(my_concept<T>)\nvoid show(T t)\n{\n    auto r = t.get_v();\n    std::cout << r << std::endl;\n}\nint main()\n{\n    Test test;\n    show(test);   // ok\n}\n```\n## å¤åˆ\n1. Tç±»å‹æœ‰åä¸º`get_v`ã€æ— å‚æ•°çš„æ–¹æ³•ï¼Œå¹¶ä¸”è¿”å›`bool`ç±»å‹ã€‚\n    1. å¿…é¡»æœ‰`{ } -> type`çš„å½¢å¼\n2. Tç±»å‹æœ‰åä¸ºreadçš„æ–¹æ³•ï¼Œä¸”å‚æ•°å¿…é¡»æ˜¯uçš„ç±»å‹`std::string const &`ã€‚æ²¡æœ‰è§„å®šè¿”å›å€¼ç±»å‹\n3. Tç±»å‹å¿…é¡»æœ‰åä¸ºvalçš„æˆå‘˜å˜é‡\n    1. å‘ç°å¦‚æœå®šä¹‰valä¸ºprivateï¼ˆç”šè‡³static privateï¼‰æ˜¯ä¸å¯ä»¥é€šè¿‡çš„ï¼Œå¿…é¡»æ˜¯å¯ä»¥ä»å¤–éƒ¨è®¿é—®çš„ã€‚\n\n```cpp\ntemplate <typename T>\nconcept my_concept = requires(T t, std::string const& u)\n{\n    { t.get_v() } -> std::same_as<bool>;\n    t.read(u);\n    T::val;  // æˆ–è€…å†™æˆt.val;\n};\n\nclass Test\n{\npublic:\n    bool get_v(void) const // è™½ç„¶åŠ äº†const ä½†å¯ä»¥é€šè¿‡\n    {\n        return true;\n    }\n    void read(std::string const& str) const\n    {\n    }\npublic:\n    int val{ 5 }; // ok\n/*\nprivate:\n    static int val;  //error\n*/\n};\n```\n## åµŒå¥—requires\nå¯ä»¥ç”¨æ¥é™å®šæŸä¸€ä¸ªæˆå‘˜å˜é‡çš„ç±»å‹\n\nrequiresçš„å†…å®¹æ˜¯ï¼šTç±»å‹ä¸­è¦æœ‰valï¼Œè€Œä¸”valçš„ç±»å‹è¦å’Œfloatä¸€æ ·ã€‚\n```cpp\ntemplate <typename T>\nconcept my_concept = requires(T t)\n{\n    requires std::same_as<decltype(t.val), float>;\n};\n```\n# åº”ç”¨\n## é€šè¿‡conceptsçº¦æŸè¿­ä»£å™¨ç±»å‹\n\nåœ¨æ²¡æœ‰conceptä¹‹å‰ï¼Œç¼–ç¨‹æ—¶ä¹±ç”¨ä¸åŒ¹é…çš„è¿­ä»£å™¨ç¼–è¯‘æ—¶æ˜¯ä¸çŸ¥é“å¯¹é”™çš„ï¼Œè¿è¡Œçš„æ—¶å€™æ‰æŠ¥é”™ã€‚\nè€ŒModern `C++`ä¹‹åéšç€æ¨¡æ¿å’Œconceptçš„å‘å±•ï¼Œå¯ä»¥çº¦æŸè¿­ä»£å™¨çš„è¡Œä¸ºã€‚æ¯”å¦‚è§„å®šæ­¤è¿­ä»£å™¨ç±»å¿…é¡»æ”¯æŒ`++`ã€`--`æ“ä½œï¼Œä»è€Œæ­¤è¿­ä»£å™¨æ˜¯Bidirectionalã€‚\næœ‰äº†conceptsï¼Œåœ¨ç¼–è¯‘æœŸå°±èƒ½çŸ¥é“ç¨‹åºçš„å¯¹é”™äº†ã€‚\n## é€šè¿‡conceptsçº¦æŸè°“è¯ç±»\n1. é¦–å…ˆç¼–å†™é’ˆå¯¹Unary Predicateçš„concept\n2. å†åŠ åˆ°`find_if`è¿™ä¸ªæ¨¡æ¿å‡½æ•°åé™å®šï¼š\n    1. â€œæ¨¡æ¿å‚æ•°1 UnaryPredicateâ€ç¬¦åˆ`UnaryPredicateConcept`ä¸­Tçš„è¦æ±‚ã€‚ï¼ˆTæœ‰`t(*u)`ä¸”è¿”å›boolçš„æ–¹æ³•ï¼‰\n3. æ³¨æ„ï¼Œ`t(*u)`ä¸­uå‰å¿…é¡»æœ‰`*`ï¼Œä¸ç„¶`t()`çš„å‚æ•°å°†è¢«é™å®šä¸ºInputIteratorã€‚é‚£ä¹ˆ`bool operator () (int const& v)`ç”±äºå‚æ•°æ˜¯intå°†æ— æ³•é€šè¿‡ã€‚\n\n```cpp\ntemplate <typename T, typename U>\nconcept UnaryPredicateConcept = requires(T t, U u)\n{\n    { t(*u) } -> std::same_as<bool>;\n};\n\ntemplate <class InputIterator, class UnaryPredicate>\n    requires(UnaryPredicateConcept\n        <UnaryPredicate, InputIterator>)\nInputIterator find_if(InputIterator first, InputIterator last, UnaryPredicate pred)\n{\n    while (first != last)\n    {\n        if (pred(*first))\n            return first;\n        else\n            ++first;\n    }\n    return last;\n}\n\nclass IsOdd\n{\npublic:\n    bool operator () (int const& v)\n    {\n        return v % 2 != 0;\n    }\n};\n\nint main()\n{\nÂ  Â  std::vector<int> vec{ 0, 1, 2, 3, 4, 5, 6, 7, 8 };\nÂ  Â  IsOdd is_odd_functor;\nÂ  Â  // æ­¤find_ifç›®å‰å—UnaryPredicateConceptçš„åˆ¶çº¦ã€‚\nÂ  Â  auto it = ::find_if(vec.begin(), vec.end(), is_odd_functor);\nÂ  Â  while (it != vec.end())\nÂ  Â  {\nÂ  Â  Â  Â  std::cout << *it << std::endl;\nÂ  Â  Â  Â  it = ::find_if(it + 1, vec.end(), is_odd_functor);\nÂ  Â  }\n}\n```\næ­¤`find_if`ç›®å‰å—UnaryPredicateConceptçš„åˆ¶çº¦ã€‚\nç°åœ¨ï¼Œ`find_if`çš„å‚æ•°3å¿…é¡»æ˜¯ï¼šâ€œåŒ…å«`t(*u)`ä¸”è¿”å›boolçš„å‡½æ•°â€çš„ç±»å‹ã€‚\n## å‡çº§æ¨¡æ¿åº“\n\næŠŠä¸€ä¸ªç®—æ³•å‡çº§ä¸ºé€šç”¨ç®—æ³•ï¼Œæ”¾åˆ°åº“ä¸­æ”¯æŒæ‰€æœ‰ç±»å‹ã€‚\né¦–å…ˆå‡çº§ä¸ºæ¨¡æ¿å‡½æ•°ã€‚å†ç”¨conceptå¯¹æ¨¡æ¿ç±»å‹åšé™åˆ¶ï¼Œä»è€Œåœ¨ç¼–è¯‘æœŸå°±å¯ä»¥åšç›¸å…³æ£€æŸ¥ã€‚","categories":["Cpp","Modern","æ¨¡æ¿"]},{"title":"Cpp_constå®¶æ—_ä¸æ¨¡æ¿çš„å…³ç³»","url":"/Cpp/Cpp_constå®¶æ—_ä¸æ¨¡æ¿çš„å…³ç³»/","content":"# å†…å®¹\n\n1. constï¼šè¿è¡ŒæœŸï¼›åªèƒ½ä¿®é¥°å˜é‡ï¼ˆå³ä½¿èƒ½ä¿®é¥°æˆå‘˜å‡½æ•°ï¼Œä½†æ˜¯æœ¬è´¨ä¸Šä¿®é¥°çš„æ˜¯thiså˜é‡ï¼‰ï¼›å¸¸æ€§\n2. constexprï¼šå¯èƒ½è¿è¡ŒæœŸã€å¯èƒ½ç¼–è¯‘æœŸï¼›å¯ä¿®é¥°å˜é‡ã€å¯ä¿®é¥°å‡½æ•°ï¼›å¸¸æ€§\n    * if constexpr\n3. constevalï¼šç¼–è¯‘æœŸï¼›åªèƒ½ä¿®é¥°å‡½æ•°ï¼›å‡½æ•°æ˜¯ä¸€æ®µä»£ç ï¼Œæ²¡æœ‰å¸¸æ€§ä¸€è¯´ã€‚æ¯”constexpræ›´ä¸¥æ ¼\n4. æ¨¡æ¿å‚æ•°å¯ä»¥ä¼ å…¥å¸¸é‡\n    1. ä¼ å…¥æŸä¸€ç±»å‹çš„å¸¸é‡\n    2. ä¼ å…¥autoå¸¸é‡\n5. constinitï¼šç¼–è¯‘æœŸï¼›ä¿®é¥°å…¨å±€å˜é‡ï¼ˆåŒ…æ‹¬é™æ€å˜é‡ï¼‰ï¼›æ— å¸¸æ€§\n# å¸¸é‡\n\nä¸èƒ½ä»¥å˜é‡ç»™æ•°ç»„çš„å¤§å°åšå®šä¹‰ã€‚å› ä¸ºæ•°ç»„è¦ç¡®å®šå®¹é‡ï¼Œåœ¨ç¼–è¯‘æ—¶å°±ç¡®å®šäº†å®ƒçš„å†…å­˜çš„æ˜ åƒã€ç»“æ„ï¼ˆå³å¿…é¡»åœ¨è¿è¡Œå‰å°±éœ€è¦æ¸…æ¥šå¤§å°ï¼‰ï¼Œæ‰§è¡Œæ—¶ä¸èƒ½æ”¹å˜ã€‚\n> ç±»ä¼¼æ•°ç»„çš„å¤§å°è¦ç¡®å®šçš„ä¾‹å­ï¼Œè¿˜æœ‰switch caseä¸­çš„å€¼ï¼Œå¿…é¡»ç”¨å­—é¢å¸¸é‡æˆ–å¸¸é‡æ¥æè¿°ã€‚\n\n```cpp\nint main()\n{\n    int a = 5;\n    int arr[a] = { 0 };  // error\n}\n```\næ™®é€šintè‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚ä½†æ˜¯const intå´å¯ä»¥ï¼š\n```cpp\nint main()\n{\n    const int N = 5;\n    int arr[N] = { 0 };  // ok\n}\n```\nä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæ­¤å¤„çš„constå°±ä»£è¡¨ï¼šç¼–è¯‘æœŸæ—¶ï¼ŒNå¯ä»¥å¾—åˆ°ç¡®å®šä¸º5ã€‚æ‰€ä»¥ï¼Œæ»¡è¶³äº†æ•°ç»„çš„å®šä¹‰çš„æ¡ä»¶å³ç¼–è¯‘æœŸæ—¶ç¡®å®šå¤§å°ï¼Œäºæ˜¯å¯ä»¥é€šè¿‡ã€‚\n> ä½†constä¿®é¥°å˜é‡ä¸æ˜¯ä¸€å®šèƒ½åœ¨ç¼–è¯‘æœŸç¡®å®šçš„ã€‚æ¯”å¦‚ï¼š\n\n```cpp\nint get_size(int);\nint main()\n{\n    const int N = get_size(5);  // ok\n    int arr[N] = { 0 };        // error\n}\nint get_size(int a)\n{\n    return a;\n}\n```\né€šè¿‡å‡½æ•°è¿”å›å€¼å»åˆå§‹åŒ–constå˜é‡æ—¶ï¼Œè™½ç„¶å¯ä»¥å®šä¹‰ã€åˆå§‹åŒ–constå˜é‡ï¼Œä½†æ˜¯ç”¨åœ¨`arr[N]`ä¸­åˆä¼šæŠ¥é”™ã€‚è¿™è¯´æ˜ï¼Œconst int Nåœ¨å®šä¹‰æ—¶ï¼Œæ˜¯å¯ä»¥æ„ŸçŸ¥åˆ°åé¢çš„å€¼æ˜¯ä¸€ä¸ªå­—é¢å¸¸é‡è¿˜æ˜¯ä¸€ä¸ªå‡½æ•°è¿”å›å€¼ï¼ˆæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå˜é‡ï¼‰çš„ã€‚å¦‚æœæ˜¯é€šè¿‡å‡½æ•°è¿”å›å€¼ï¼ˆå˜é‡ï¼‰åˆå§‹åŒ–çš„ï¼Œè™½ç„¶å¯ä»¥å¾—åˆ°åˆå§‹åŒ–ï¼Œä½†æ˜¯å´ä¸èƒ½ç”¨äºå®šä¹‰æ•°ç»„ã€‚è¿™æ˜¯å› ä¸ºï¼Œå‡½æ•°æœ¬è´¨ä¸Šæ˜¯åœ¨æ‰§è¡Œä»£ç æ—¶ï¼Œé€šè¿‡æ ˆå¸§åŠ¨æ€è¿›è¡Œçš„ï¼Œè¿™åˆé™·å…¥äº†æ‰§è¡ŒæœŸæ‰èƒ½ç¡®å®šå…·ä½“ç»“æœï¼Œæ‰€ä»¥ä¸èƒ½ç»™æ•°ç»„å®šä¹‰ã€‚\n\næ‰€ä»¥ï¼šconstä¿®é¥°çš„å˜é‡ï¼Œä¸ä¸€å®šèƒ½åœ¨ç¼–è¯‘æœŸå†³å®šï¼Œå³ä¹Ÿæ˜¯æœ‰å¯èƒ½åœ¨æ‰§è¡ŒæœŸç¡®å®šçš„ã€‚ä½†æ˜¯ç¼–è¯‘æœŸæ˜¯å¯ä»¥æ¸…æ¥šåœ°åˆ†æ˜ä½ è¿™ä¸ªNçš„æ¥å†çš„ï¼Œå³ä½¿Nè¢«å£°æ˜constä¹Ÿæ— æ‰€è°“ã€‚å› æ­¤constè¿™ä¸ªå…³é”®å­—æ˜¯æ¨¡æ£±ä¸¤å¯çš„ã€‚\näºæ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è¦é™åˆ¶ä¸€ä¸ªå˜é‡å¿…é¡»åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šå¸¸æ€§ï¼Œå°±å¾—ç”¨constexpræ¥ä¿®é¥°ã€‚è€Œä¸æ˜¯ç”¨constï¼›constä»¥ååˆ™å¯ä»¥ç”¨äºä¿®é¥°è¿è¡ŒæœŸçš„è¡Œä¸ºï¼Œä»¥åæœ€å¥½ä¸è¦å†ä¹±ç”¨constæ¥ä¿®é¥°ç¼–è¯‘æœŸå¸¸é‡ã€‚\n# constexpr\n\nModern Cppæä¾›çš„å…³é”®å­—ã€‚\n1. å¦‚æœç”¨æ¥ä¿®é¥°å˜é‡ï¼šå°±å¯ä»¥ç”¨äºé™åˆ¶ç­‰å¼å³è¾¹çš„å€¼æ˜¯ä¸€ä¸ªå¸¸é‡ã€‚è¿™ä¸ªå¸¸é‡ä¸€å®šæ˜¯åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†çš„ã€‚\n2. å¦‚æœç”¨æ¥ä¿®é¥°å‡½æ•°ï¼šå‡½æ•°è¢«constexprä¿®é¥°åï¼Œçœ‹è°ƒç”¨ç‚¹æ¥æ”¶è¿”å›å€¼çš„å˜é‡æ˜¯å¦ä¹Ÿä¸ºconstexprã€‚\n    1. å¦‚æœæ˜¯ï¼Œåˆ™ç¼–è¯‘æœŸå°±ä¼šç¡®å®šæ­»è¿”å›å€¼ï¼Œç›´æ¥åœ¨è°ƒç”¨ç‚¹æ›¿æ¢ï¼Œè€Œä¸ç”Ÿæˆä»£ç ã€‚\n    2. å¦‚æœä¸æ˜¯ï¼Œåˆ™æ”¹å‡½æ•°æ­£å¸¸ç”Ÿæˆå¯ç¼–è¯‘ä»£ç ï¼Œå˜ä¸ºæ™®é€šçš„å‡½æ•°åœ¨è¿è¡ŒæœŸæµè½¬ã€‚\n\nå¦‚ä¸‹ï¼Œå¦‚æœå‘ŠçŸ¥äº†Næ˜¯ä¸€ä¸ªconstexprå˜é‡ï¼Œä½†å‘ç°`get_size`ä¸æ˜¯ä¸€ä¸ªconstexprï¼Œåˆ™ç¼–è¯‘ä¸é€šè¿‡ã€‚\n```cpp\nint main()\n{\n    constexpr int N = get_size(5);  // error\n    int arr[N] = { 0 };             // error\n}\nint get_size(int a)\n{\n    return a;\n}\n```\nå¦‚æœæ”¹ä¸º5ï¼Œåˆ™é€šè¿‡ã€‚\n```cpp\nint main()\n{\n    constexpr int N = 5;  // ok\n    int arr[N] = { 0 };   // ok\n}\n```\né‚£ä¹ˆï¼Œå¦‚ä½•é€šè¿‡å‡½æ•°è¿”å›å€¼åˆå§‹åŒ–constexprå˜é‡å‘¢ï¼Ÿå°±éœ€è¦ç»™å‡½æ•°ä¹Ÿç”¨constexprä¿®é¥°ã€‚ä½†æ˜¯æ³¨æ„ï¼Œä¸å†æ”¯æŒå‰ç½®å£°æ˜ï¼Œåç½®å®šä¹‰å‡½æ•°çš„å½¢å¼ï¼Œè€Œåªèƒ½ç›´æ¥å†™åœ¨å‰ç½®ï¼š\n```cpp\nconstexpr int get_size();\n// é”™è¯¯ï¼Œget_size() å¿…é¡»åœ¨è°ƒç”¨ç‚¹ä¹‹å‰å®Œæ•´å®šä¹‰\nint main(void)\n{\n    constexpr int N = get_size();\n    int arr[N] = { 0 };          \n}\nconstexpr int get_size()\n{\n    return 5;\n}\n```\næ­£ç¡®å†™æ³•ï¼š\n```cpp\nconstexpr int get_size(void)\n{\n    return 5;\n}\nint main(void)\n{\n    constexpr int N = get_size();//ok\n    int arr[N] = { 0 };          //ok\n}\n```\nå› ä¸ºconstexprçš„å‡½æ•°å®é™…ä¸ä¼šç”Ÿæˆå‡½æ•°ä½“ï¼Œå› æ­¤ä¸æ”¯æŒå‰ç½®å£°æ˜ã€åç½®å®šä¹‰çš„å½¢å¼ã€‚æ‰€ä»¥ï¼Œconstexprçš„å‡½æ•°å»ºè®®å†™ä¸ºinlineç±»å‹æˆ–è€…å†™åœ¨å¤´æ–‡ä»¶ä¸­åŒ…å«åˆ°å‰ç½®ã€‚\n# consteval\n\nä¸èƒ½ä¿®é¥°å˜é‡ï¼Œåªèƒ½ç”¨äºä¿®é¥°å‡½æ•°ï¼Œç›®çš„æ˜¯æ¯”constexpræ›´ä¸¥æ ¼åœ°é™åˆ¶ä¿®é¥°çš„å†…å®¹è¦åœ¨ç¼–è¯‘æœŸç¡®å®šã€‚\n\nå¦‚æœå‘ç°å‡½æ•°ä¸­è¿”å›å€¼è¡¨è¾¾å¼ä¸­æœ‰éå¸¸é‡ï¼ˆä¸‹ä¾‹åˆ™æ˜¯valæ˜¯å˜é‡ï¼‰ï¼Œåˆ™ä¸èƒ½ç¼–è¯‘é€šè¿‡ã€‚\n```cpp\nconsteval int get_size(int val)\n{\n    return 5 + val;\n}\nint get_value(void)\n{\n    return 3;\n}\nint main()\n{\n    const int b = get_value();    // ok\n    const int a = get_zize(b);    // error\n}\n```\nè‹¥æ”¹ä¸ºï¼š\n```cpp\nconsteval int get_size(int val)\n{\n    return 5 + val;\n}\nint get_value(void)\n{\n    return 3;\n}\nint main()\n{\n    const int b = 3;\n    const int a = get_zize(b);    // ok\n}\n```\n> å…¶å®aç”¨constã€constexprä¿®é¥°éƒ½å·²æ— æ‰€è°“äº†ï¼Œå› ä¸ºconstevalå·²ç»å¯ä»¥ä¸¥æ ¼é™åˆ¶`get_size(b)`çš„è¿”å›å€¼æ˜¯ç¼–è¯‘æœŸç¡®å®šçš„äº†ï¼Œæ— éœ€é constexpræ¥çº¦æŸï¼Œç”¨constä¹Ÿè¡Œã€‚\n# æ€»ç»“constexprå’Œconsteval\n1. constexprä¿®é¥°å‡½æ•°æ—¶ï¼Œå¹¶ä¸ä¸¥æ ¼é™åˆ¶å‡½æ•°ä¸­çš„å†…å®¹å¿…é¡»æ˜¯ç¼–è¯‘æœŸå°±ç¡®å®šçš„ï¼Œåˆ†ä¸¤ç§æƒ…å†µï¼š\n    1. æ»¡è¶³ç¼–è¯‘æœŸå°±ç¡®å®šæ—¶ï¼Œå‡½æ•°å˜ä¸ºå¸¸é‡è¡¨è¾¾å¼ï¼Œåœ¨è°ƒç”¨ç‚¹å¤„æ›¿æ¢\n    2. ä¸æ»¡è¶³æ—¶ï¼Œå¦‚ä¼ å…¥ä¸€ä¸ªå˜é‡å‚æ•°ï¼Œåˆ™å¿…é¡»åœ¨è¿è¡ŒæœŸæ‰èƒ½ç¡®å®šçš„ï¼Œå°±é€€åŒ–ä¸ºä¸€ä¸ªæ™®é€šå‡½æ•°ã€‚\n2. constevalæ˜¯åŠ å¼ºç‰ˆçš„constexprï¼Œä¸èƒ½ä¿®é¥°å˜é‡ï¼Œå› ä¸ºä¿®é¥°å˜é‡æ²¡æ„ä¹‰ã€‚ä¸»è¦æ˜¯ç”¨äºä¿®é¥°å‡½æ•°ã€‚ä¸»è¦æ˜¯çœ‹å‡½æ•°å‚æ•°æ˜¯å¦å…¨æ”¯æŒç¼–è¯‘æœŸç¡®å®šã€‚\n3. è¢«constexprã€constevalä¿®é¥°çš„å‡½æ•°ä½“å†…å¯ä»¥æ˜¯é€’å½’ã€‚æ¯”å¦‚é€’å½’æ±‚å’Œï¼šï¼ˆæ­¤æ—¶æŠŠé¼ æ ‡æŒªåœ¨aä¸Šé¢ï¼Œå‘ç°ç›´æ¥è®¡ç®—å‡ºäº†ç»“æœï¼Œ55ï¼‰\n\n```cpp\nconsteval int sum(int n)\n{\n    if(n == 0)\n        return n;\n    return n + sum(n - 1);\n}\nint main()\n{\n    constexpr int a = sum(10);\n}\n```\nä½†æ˜¯ï¼Œé€’å½’çš„å±‚æ•°é»˜è®¤æœ€å¤šä¸º512å±‚ã€‚è¿™ä¸ªå€¼ï¼Œä¸åŒç¼–è¯‘å™¨å¯ä»¥é€šè¿‡ä¸åŒå‘½ä»¤ä¿®æ”¹ã€‚\n# æ¨¡æ¿å‚æ•°ä¼ å…¥å¸¸é‡\n## æ¨¡æ¿å‚æ•°ä¼ å…¥æŸä¸€ç±»å‹çš„å¸¸é‡\n\n```cpp\ntemplate <int N>\nconstexpr int get_number(void)\n{\n    return N;\n}\nint main()\n{\n    constexpr int a = get_number<15>();\n}\n```\nå®é™…ç¼–è¯‘å®Œåï¼Œç›¸å½“äºäº§ç”Ÿä»¥ä¸‹ä»£ç ï¼š\n```cpp\nint get_number(void)\n{\n    return 15;\n}\nint main()\n{\n    constexpr int a = get_number();\n}\n```\n> æ­¤ä¾‹ä¸­çš„æ¨¡æ¿å‚æ•°Nå¿…é¡»æ˜¯å¸¸é‡ï¼Œæœ€å¥½ç”¨constexprä¿®é¥°ã€‚æ€»ä¹‹ï¼šå˜é‡ä¸è¡Œï¼›constå¯èƒ½ä¸è¡Œï¼ˆè‹¥ç­‰å·å³è¾¹çš„å€¼ä¸æ˜¯å­—é¢å¸¸é‡ã€å¸¸é‡ï¼‰\n> åŒç†ï¼Œå› ä¸ºæ¨¡æ¿å‡½æ•°ä¹Ÿæ˜¯ç¼–è¯‘æœŸç¡®å®šçš„ï¼Œæ‰€ä»¥Nè¿™ç§ç‰¹å®šå€¼å‚æ•°å¿…é¡»ä¹Ÿåƒä¸Šé¢è°ˆçš„å¸¸é‡çš„ç”¨æ³•ä¸€æ ·ï¼Œç¼–è¯‘æœŸå¿…é¡»ç¡®å®šã€‚\n\n```cpp\ntemplate <int N>\nconstexpr int get_number(void)\n{\n    return N;\n}\nint main()\n{\n    //int b = 15;\n    //constexpr int a = get_number<b>(); // error\n    \n    constexpr int b = 15;\n    constexpr int a = get_number<b>();   // ok\n}\n```\n\n### `get_element`\n\nç¼–è¯‘æœŸåˆ¤æ–­ã€‚ç”¨constexprä¿®é¥°ifè¯­å¥\n\n```cpp\nstruct Obj\n{\n    int a;\n    std::string b;\n}\n\ntemplate<int N>\nauto get_element(Obj & obj)\n{\n    if constexpr (N == 0)\n        return obj.a;\n    else if constexpr (N == 1)\n        return obj.b;\n}\n```\nå¦‚æœç¼–è¯‘æ—¶ç¡®å®š`N == 1`ï¼Œåˆ™ä¼šç”Ÿæˆç›¸åº”çš„å‡½æ•°ã€‚autoå°†åˆ‡æ¢æˆå¯¹åº”ç±»å‹ã€‚\n```cpp\nstd::string get_element(Obj & obj)\n{\n    return obj.b;\n}\n```\n\n```cpp\nint main()\n{\n    Obj obj { 5, \"Hello\" };\n    int a = get_element<0>(obj);           // 5\n    std::string b = get_element<1>(obj);   // Hello\n}\n```\n\n## æ¨¡æ¿å‚æ•°ä¼ å…¥autoå¸¸é‡\n\n`template<int N>`æ˜¯intç±»å‹çš„ç‰¹å®šå€¼ï¼Œè€Œ`template<auto V>`æ˜¯ä»»æ„ç±»å‹çš„ç‰¹å®šå€¼ã€‚\n\nstaticçš„ç‰¹ç‚¹æ˜¯ï¼Œç”Ÿå‘½å‘¨æœŸå’Œå…¨å±€å˜é‡ä¸€æ ·ï¼Œä½†æ˜¯å¯è§èŒƒå›´ä»…é™äºä¸€éƒ¨åˆ†ï¼Œä¸‹é¢çš„valueå°±ä»…é™äºç±»ä¸­å¯è§ã€‚\n```cpp\ntemplate <auto V>\nclass Constant\n{\npublic:\n    static constexpr auto value = V;\n}\n```\n\n```cpp\nint main()\n{\n    auto a = Constant<19>::value;\n}\n```\n### constexpré…åˆautoï¼Œé…åˆæ¨¡æ¿autoå¸¸é‡ä½¿ç”¨\n\nå¦‚æœæŠŠaä¿®é¥°ä¸ºconstexprï¼Œåˆ™å°±ä¼šå˜ä¸ºç¼–è¯‘æœŸè®¡ç®—ã€‚\n```cpp\nint main()\n{\n    constexpr auto a = Constant<19>::value;\n}\n```\nè¿™ä¹ˆåšçš„æ„ä¹‰åœ¨äºï¼Œå¯ä»¥è®©ä¸€ä¸ªåŒåçš„å˜é‡å…·æœ‰ä¸åŒçš„ç±»å‹ã€ä¸åŒçš„å€¼ï¼Œå³å¤ç”¨äº†åå­—ã€‚æ¨¡æ¿åŸå…ˆåªèƒ½ç”¨äºç±»æ¨¡æ¿ã€å‡½æ•°æ¨¡æ¿ï¼Œè¿™æ ·ï¼Œå¥—äº†ä¸€ä¸ªç±»æ¨¡æ¿çš„å¤–å£³ï¼Œè®©å˜é‡ä¹Ÿå…·æœ‰äº†æ¨¡æ¿çš„èƒ½åŠ›ã€‚\n# ä¼˜åŒ–å…¨å±€å˜é‡çš„åˆå§‹åŒ–ï¼šconstinit\n1. ä¸ä½œç”¨åŸŸæ— å…³\n2. ä¸å¸¸æ€§æ— å…³\n3. ä¿®é¥°å…¨å±€å˜é‡ï¼ˆåŒ…å«é™æ€å˜é‡ï¼‰\n\n```cpp\nvoid bar(void)\n{\n    static int val = 8;\n    std::cout << val << std::endl;\n}\nint main()\n{\n    bar();\n}\n```\nä»¥ä¸Šç¨‹åºï¼Œvalçš„åˆå§‹åŒ–ä¸åœ¨barå‡½æ•°ä¸­ï¼Œè€Œæ˜¯åœ¨mainå‡½æ•°æ‰§è¡Œä¹‹å‰ã€‚æ‰€ä»¥è°ƒè¯•çš„æ–­ç‚¹ä¼šæ‰ä¸‹æ¥ã€‚\nä½†æ˜¯è¿™ä¸ä»£è¡¨valæ˜¯ç¼–è¯‘æœŸæ‰§è¡Œçš„ã€‚\n```cpp\nint get_int(void)\n{\n    return 7;\n}\nvoid bar(void)\n{\n    static int val = get_int();\n    std::cout << val << std::endl;\n}\nint main()\n{\n    bar();\n    bar();\n}\n```\nä»¥ä¸Šä»£ç ï¼Œé€šè¿‡å‡½æ•°ç¡®å®švalå€¼æ—¶ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨barï¼Œstaticè¯­å¥æ˜¯åœ¨barå‡½æ•°æ‰§è¡Œæ—¶æ‰æ‰§è¡Œçš„ã€‚è€Œç¬¬äºŒæ¬¡è°ƒç”¨barï¼Œstaticè¯­å¥ä¸æ‰§è¡Œä»»ä½•åŠ¨ä½œã€‚\n\nå…¨å±€å˜é‡ï¼Œå¯èƒ½æœ‰ä¸¤ç§è¡Œä¸ºï¼š\n1. åœ¨staticè¯­å¥å‰å°±æ‰§è¡Œå®Œäº†\n2. åœ¨staticè¯­å¥æ‰§è¡Œ\n\nèƒ½ä¸èƒ½ä¼˜åŒ–ï¼Œè®©staticè¯­å¥åœ¨staticè¯­å¥å‰å°±æ‰§è¡Œå®Œï¼Ÿæˆ–è€…è¯´ï¼Œè®©å®ƒåœ¨ç¼–è¯‘æœŸå°±å®Œæˆè¡Œä¸ºï¼Ÿ\nç”¨constinitä¿®é¥°å°±èƒ½èµ·åˆ°è¿™ä¸ªä½œç”¨ã€‚\n```cpp\nint get_int(void)\n{\n    return 7;\n}\nvoid bar(void)\n{\n    // constinit static int val = get_int();  // error, get_int() is not const value\n    constinit static int val = 8;             // ok\n    std::cout << val << std::endl;\n}\nint main()\n{\n    bar();\n    bar();\n}\n```\nä¸constevalæœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼Œè¢«constinitä¿®é¥°çš„å˜é‡ï¼Œå¿…é¡»ä¿è¯ç­‰å·å³è¾¹æ˜¯ä¸€ä¸ªå¸¸é‡ï¼ˆå³ç¼–è¯‘æœŸç¡®å®šä¸‹æ¥ï¼‰ï¼Œå¦åˆ™ç¼–è¯‘ä¸é€šè¿‡ã€‚è¿™æ ·ï¼Œå°±èƒ½ä¿è¯staticè¯­å¥åœ¨ç¼–è¯‘æœŸåˆå§‹åŒ–å®Œæ¯•ã€‚\næ‰€ä»¥ï¼Œvalä¸èƒ½ç›´æ¥æ¥å—æ™®é€šçš„`get_int()`å‡½æ•°è¿”å›å€¼ï¼Œå¦‚æœè¦ç¼–è¯‘é€šè¿‡ï¼Œéœ€è¦ä¿®é¥°å‡½æ•°ä¸º`consteval`ã€‚\n\nè™½ç„¶å…³é”®å­—å¸¦æœ‰constï¼Œä½†æ˜¯ä¸ä»£è¡¨è¢«ä¿®é¥°çš„å˜é‡æ˜¯å¸¸æ€§çš„ï¼ŒåæœŸè¯¥å€¼ä¼šä¸ä¼šè¢«ä¿®æ”¹ï¼Œæ˜¯æœªå®šä¹‰çš„ã€‚å¦‚æœè¦ä¿è¯è¿™ä¸ªå…¨å±€å˜é‡æ˜¯å¸¸æ€§ï¼Œéœ€è¦å¦å¤–ä¿®é¥°constã€‚\n\n> å…¶å®ç”¨constexprç›´æ¥ä¿®é¥°å…¨å±€å˜é‡ï¼Œä¹Ÿå¯ä»¥èµ·åˆ°è®©å…¨å±€å˜é‡åœ¨ç¼–è¯‘æœŸæ‰§è¡Œçš„æ•ˆæœï¼Œä½†æ˜¯constinitçš„ç‰¹ç‚¹åœ¨äºï¼Œå®ƒä¿®é¥°åï¼Œå˜é‡ä¸å¸¦æœ‰å¸¸æ€§ï¼Œå¯ä»¥åæœŸæ›´æ”¹ï¼Œè€Œconstexprä¿®é¥°å˜é‡åï¼Œåé¢å°±æ²¡æ³•æ›´æ”¹äº†ã€‚\n\n# æ€»ç»“\n\næ¨¡æ¿éƒ½æ˜¯å’Œç±»å‹æ‰“äº¤é“ã€‚å„ç§çš„ç­–ç•¥æœ€åæœ¬è´¨ä¸Šéƒ½æ˜¯ä»¥ä¸åŒç±»å‹å†³å®šçš„ã€‚æœ¬è´¨ä¸Šåšçš„å·¥ä½œå°±æ˜¯å¸®åŠ©ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸåˆ†è¾¨å„ç§ç±»å‹ï¼Œç»„è£…ç±»ã€å‡½æ•°ã€å®ä¾‹ï¼Œä¾›å¼€å‘äººå‘˜ä½¿ç”¨ã€‚\n\nåˆ¤æ–­ç±»å‹çš„ç‰¹æ€§ï¼Œæ¯”å¦‚çœ‹æ˜¯å¦æ˜¯æŒ‡é’ˆï¼Ÿéœ€è¦ç”¨åˆ°`if constexpr`\n\n```cpp\ntemplate<typename T>\nauto get_val(T t)\n{\n    if constexpr (std::is_pointer_v<T>)\n        return *t;\n    else\n        return t;\n}\n\nint main()\n{\n    int a = 9;\n    auto v = get_val(&a); // &a è¯†åˆ«ä¸º int *  è¿”å›å€¼å¾—åˆ°çš„æ˜¯intå‹ï¼Œå€¼ä¸º9\n    auto v2 = get_val(a); // a è¯†åˆ«ä¸º  int    è¿”å›å€¼å¾—åˆ°çš„æ˜¯intå‹ï¼Œå€¼ä¸º9\n}\n```","categories":["Cpp","Modern","æ¨¡æ¿"]},{"title":"Cpp_æ¨¡æ¿_Traits_Policy","url":"/Cpp/Cpp_æ¨¡æ¿_Traits_Policy/","content":"# æ¨¡æ¿æ˜¯ä¸ºäº†ä»€ä¹ˆï¼Ÿ\n\n> åˆ©ç”¨äº†æ¨¡æ¿çš„å…ƒç¼–ç¨‹ï¼Œå¯ä»¥åƒé¢å‘å¯¹è±¡é‚£æ ·å¤ç”¨ã€ç»„åˆå¯ç”¨çš„ä»£ç ï¼ˆå³ä¹Ÿå¯ä»¥æŠŠä¸€æ®µä»£ç ä½œä¸ºç»„ä»¶ä½¿ç”¨ï¼‰ï¼Œä½†æ˜¯è¿™ä¸æ˜¯Cppçš„æœ¬æ„ï¼Œå®é™…ä¸Šæ˜¯Cppçš„â€œå‰¯ä½œç”¨â€ï¼Œåªæ˜¯è²Œä¼¼æ˜¯ä¸€ç§ä¼˜åŠ¿ã€‚\n> åˆ©ç”¨äº†æ¨¡æ¿çš„å…ƒç¼–ç¨‹çš„æ›´æœ‰ä»·å€¼çš„ä½œç”¨åœ¨äºï¼šå¯ä»¥ç¼–è¯‘æœŸæ‰§è¡Œã€è®¡ç®—ã€‚\n\næ¨¡æ¿æ˜¯ä¸ºäº†ç¼–è¯‘æœŸè¿ç®—ï¼Œç¼–è¯‘æœŸè¿ç®—å°±å¯ä»¥è¾¾åˆ°é›¶å¼€é”€çš„æ•ˆæœã€‚\n\nä¼ ç»Ÿçš„è¿è¡Œæ—¶è¿ç®—çš„ç¨‹åºçš„æ€§èƒ½ä¸»è¦ä¾èµ–äºå®¢æˆ·ç«¯çš„è®¡ç®—æœºæ€§èƒ½ã€‚è€Œç¼–è¯‘æœŸè¿ç®—çš„æ€§èƒ½åˆ™ä¸»è¦ä¾èµ–å¼€å‘ä¾§çš„è®¡ç®—æœºæ€§èƒ½ã€‚`C++`çš„è®¾è®¡ç›®æ ‡å°±åœ¨äº`Zero Overhead`ï¼Œå³é›¶å¼€é”€ï¼Œæ„æ€æ˜¯å°½é‡æŠŠå·¥ä½œéƒ½åœ¨ç¼–è¯‘æœŸé—´å®Œæˆã€‚\n\nä¸»è¦ä½“ç°åœ¨æ¨¡æ¿ã€å…ƒç¼–ç¨‹ä¸Šï¼ŒæŒ‡å¯¼ç¼–è¯‘å™¨ç”Ÿæˆä»£ç \n\næ¯”å¦‚ï¼Œç°åœ¨æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œæ˜¯ç¼–å†™addå‡½æ•°ï¼Œè¿”å›ä¸¤ä¸ªæ“ä½œæ•°çš„åŠ å’Œå€¼ã€‚\n\nåˆšå¼€å§‹å¯èƒ½åªæƒ³åˆ°äº†ä¸¤ä¸ªæ•´å‹ã€‚\n```cpp\n#include<iostream>\nint add(int a, int b)\n{\n    return a + b;\n}\nint main()\n{\n    int c = add(1, 2);\n}\n```\nä½†æ˜¯é—®é¢˜åœ¨äºï¼ŒåæœŸå¯èƒ½è¦åŠ ä¸Šfloatå‹çš„æƒ…å†µã€‚é‚£æˆ‘ä»¬å¯ä»¥é€šè¿‡Cppçš„å‡½æ•°é‡è½½åŠŸèƒ½è¿›è¡Œè§£å†³ã€‚\n```cpp\nfloat add(float a, float b)\n{\n    return a + b;\n}\n```\nç”±æ­¤å¯ä»¥çœ‹å‡ºï¼Œéœ€è¦æ¨¡æ¿çš„åœ°æ–¹åœ¨äºï¼š\n1. éœ€è¦å‡½æ•°é‡è½½\n2. è™½ç„¶æ˜¯å‡½æ•°é‡è½½ï¼Œä½†æ˜¯è¿™äº›å‡½æ•°çš„ç»“æ„ç›¸ä¼¼ï¼Œå…·ä½“çš„æ“ä½œã€è¡Œä¸ºéƒ½ä¸€æ ·ã€‚\n3. åŒºåˆ«ä»…åœ¨äºæ“ä½œçš„å¯¹è±¡çš„æ•°æ®ç±»å‹ä¸åŒã€‚\n\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä¸ç”¨åå¤é‡è½½ï¼Œè€Œæ˜¯åˆ©ç”¨æ¨¡æ¿ï¼Œè®©ç¼–è¯‘å™¨ä¸ºæˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆã€‚å½“ç„¶ï¼Œç¼–è¯‘å™¨ä¸ä¼šä¸€ä¸‹å­å…¨éƒ¨æŠŠæ‰€æœ‰æƒ…å†µéƒ½ç”Ÿæˆï¼Œè€Œæ˜¯æˆ‘ä»¬å½“æ—¶çš„ä»£ç å…·ä½“ç”¨å“ªä¸ªï¼Œå°±åœ¨ç¼–è¯‘æœŸç‰¹åˆ«åœ°ç”Ÿæˆå“ªä¸ªã€‚è¿™å°±å«åšæ¨¡æ¿ç¼–ç¨‹ã€‚\n# æ¨¡æ¿ç¼–ç¨‹\n\nä»¥ä¸‹å«åšå‡½æ•°æ¨¡æ¿ã€‚ä¸èƒ½å«åšå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°æ¨¡æ¿ä¹Ÿä¸æ˜¯ç¼–è¯‘å•å…ƒï¼Œå³ä¸æ˜¯å¯ç¼–è¯‘çš„ä»£ç ã€‚\n```cpp\ntemplate<typename T>\nT add(T a, T b)\n{\n    return a + b;\n}\n```\nè€Œæ˜¯ä»`add<float>`å¼€å§‹åˆ°ä¹‹åæ‰æ˜¯ç¼–è¯‘å•å…ƒã€‚æ€»ä¹‹ï¼šæ¨¡æ¿ä¸ä¼šç”Ÿæˆä»£ç ï¼Œæ¨¡æ¿ä¸èƒ½ç¼–è¯‘ï¼Œè€Œæ˜¯åœ¨ä½¿ç”¨æ¨¡æ¿çš„æ—¶å€™ï¼ŒæŒ‡å¯¼ç¼–è¯‘å™¨ç”Ÿæˆç›¸åº”çš„å‡½æ•°ä»£ç ï¼Œæ‰æœ‰äº†å¯ç¼–è¯‘çš„ä»£ç ã€‚\n```cpp\nint main()\n{\n    float c = add<float>(1.0f, 2.0f);\n}\n```\n\n# æ¨¡æ¿ç‰¹åŒ–\nSpecialization\n## å…¨ç‰¹åŒ–\nFull Specialization\n\nå¦‚æœæ¨¡æ¿ä¸­çš„æ‰€æœ‰ç±»å‹Téƒ½è¢«å…·ä½“ç±»å‹æ›¿ä»£äº†ï¼Œé‚£ä¹ˆ`< >`ä¸­å°±ä¸ç”¨å†™`typename T`äº†ï¼Œç©ºç€ã€‚å«åšå…¨ç‰¹åŒ–ã€‚\n\n```cpp\ntemplate < >\nint add(int a, int b)\n{\n    return a + b;\n}\n```\n### çµæ´»åˆ©ç”¨ç‰¹åŒ–\n\n```cpp\ntemplate<typename T, typename R>\nR add(T a, T b)\n{\n    return static_cast<R>(a + b);\n}\n```\nä»¥ä¸‹è¯­å¥æ˜¯æ— æ³•ç¼–è¯‘é€šè¿‡çš„ï¼Œå› ä¸ºè°ƒç”¨è¯­å¥åªè¯´æ˜äº†å‡½æ•°å‚æ•°çš„ç±»å‹ï¼Œè€Œå‡½æ•°è¿”å›ç±»å‹ç³»ç»Ÿæ˜¯æ— æ³•æ¨æ–­çš„ã€‚\n```cpp\nint main()\n{\n    float f = add(1, 2);\n}\n```\nå¦‚æœä»¥ä¸‹è¿™æ ·å†™å‘¢ï¼Ÿä¹Ÿä¸è¡Œï¼Œå› ä¸ºæ¨¡æ¿ä¸­ç±»å‹çš„é¡ºåºé—®é¢˜ï¼Œå¯¼è‡´floatå¯¹åº”çš„æ˜¯ç¬¬ä¸€ä¸ªç±»å‹Tï¼Œå› æ­¤ç³»ç»Ÿè¿˜æ˜¯æœªçŸ¥å‡½æ•°è¿”å›ç±»å‹ã€‚\n```cpp\nint main()\n{\n    float f = add<float>(1, 2);\n}\n```\nåªèƒ½å…¨éƒ¨å†™å‡ºï¼š`add<int, float>(1, 2);`\n\næˆ–è€…ï¼šä½¿ç”¨ç±»ä¼¼äºåä½ç¼ºçœçš„å†™æ³•ä¹ æƒ¯ï¼Œæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å³æŠŠTã€Ræ¢ä¸ªé¡ºåºï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨addæ—¶ï¼Œå°±å¯ä»¥ç•¥å»Täº†ã€‚\n```cpp\ntemplate<typename R, typename T>\nR add(T a, T b)\n{\n    return static_cast<R>(a + b);\n}\n```\nä»¥ä¸‹è°ƒç”¨ï¼Œèµ°çš„æ˜¯`template<typename R, typename T>`çš„addã€‚ä¼šç”Ÿæˆï¼š`float add(int, int)`ã€‚\n```cpp\nint main()\n{\n    float f = add<float>(1, 2);\n}\n```\nå¦‚æœï¼šé…åˆä¸Šå…¨ç‰¹åŒ–æ¨¡æ¿å‡½æ•°ã€‚å¦‚ä»¥ä¸‹mainå‡½æ•°è°ƒç”¨`add<int>`ï¼Œåˆ™ç³»ç»Ÿå°±åˆ¤æ–­å‡ºæˆ‘ä»¬è°ƒç”¨çš„æ˜¯`int add(int, int)`äº†ã€‚æ€»ä¹‹ï¼Œåªè¦Rå’ŒTå…¨éƒ½å¯¹åº”ä¸Šäº†ç‰¹åŒ–çš„æ¨¡æ¿å‡½æ•°çš„æ‰€æœ‰ç±»å‹ï¼Œå°±ä¼šèµ°æ¨¡æ¿ç‰¹åŒ–å‡½æ•°ã€‚\n```cpp\ntemplate<typename R, typename T>\nR add(T a, T b)\n{\n    return static_cast<R>(a + b);\n}\ntemplate < >\nint add(int a, int b)\n{\n    return a + b;\n}\nint main()\n{\n    int c = add<int>(1, 2); //int add(int a, int b)\n}\n```\n### ç®€ä¾¿çš„å†™æ³•\n\næ¨¡æ¿ç±»å‹çš„åé¢çš„å‚æ•°æ˜¯å¯ä»¥æœ‰é»˜è®¤ç±»å‹çš„ã€‚\nå¦‚æœè¿˜æ˜¯Tã€Rçš„é¡ºåºï¼Œå¦‚ä¸‹å†™ï¼šå°±æ˜¯åœ¨è¯´ï¼šå¦‚æœä¸æŒ‡å®šæ¨¡æ¿ç¬¬äºŒä¸ªç±»å‹å‚æ•°ï¼Œå°±ä¼šé»˜è®¤è¿”å›ç±»å‹ä¸ºintã€‚\n```cpp\ntemplate<typename T, typename R = int>\nR add(T a, T b)\n{\n    return static_cast<R>(a + b);\n}\ntemplate < >\nint add(int a, int b)\n{\n    return a + b;\n}\n```\nè€Œæˆ‘ä»¬æ¨¡æ¿ç¬¬ä¸€ä¸ªç±»å‹å‚æ•°Tåˆæ˜¯å¯ä»¥é€šè¿‡å‡½æ•°å‚æ•°æ¨æ–­çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥å…¨éƒ¨çœç•¥ï¼š\n```cpp\nint main()\n{\n    int c = add(1, 2); //int add(int a, int b)\n}\n```\n\næ¥çœ‹çœ‹ä»¥ä¸‹çš„æƒ…å†µï¼šæ­¤æ—¶èµ°çš„æ˜¯`R add(T a, T b)`ï¼Œæ˜¯`int add(double, double)`\n```cpp\nint main()\n{\n    int c = add(1.0, 2.0);\n}\n```\nè€Œå¦‚æœè¿™æ ·ï¼šå°±ä¼šç¼–è¯‘ä¸é€šè¿‡ï¼Œå› ä¸ºæ— æ³•æ¨æ–­Tçš„ç±»å‹ã€‚\n```cpp\nint main()\n{\n    int c = add(1.0, 2.0f);\n}\n```\né‚£ä¹ˆå°±éœ€è¦æ˜ç¡®åœ¨addååŠ `< >`æŒ‡å‡ºï¼ŒTæ˜¯ä»€ä¹ˆã€‚å¦‚æœåŠ çš„æ˜¯doubleï¼Œé‚£ä¹ˆ`2.0f`ä¼šè½¬ä¸ºdoubleå‹è¿›è¡Œè®¡ç®—ã€‚\n```cpp\nint main()\n{\n    int c = add<double>(1.0, 2.0f);\n}\n```\n## éƒ¨åˆ†ç‰¹åŒ–ï¼ˆå®é™…ä¸Šæ˜¯å‡½æ•°æ¨¡æ¿çš„é‡è½½ï¼‰\n\n```cpp\ntemplate<typename T, typename R = int>\nR add(T a, T b)\n{\n    return static_cast<R>(a + b);\n}\ntemplate<typename R = float>\nR add(long long a, long long b)\n{\n    return a + b;\n}\ntemplate < >\nint add(int a, int b)\n{\n    return a + b;\n}\nint main()\n{\n    auto c = add(1ll, 2ll);\n}\n```\nä»¥ä¸Šï¼Œaddå‡½æ•°ä¼˜å…ˆå’Œç‰¹åŒ–çš„æ¨¡æ¿å‡½æ•°åŒ¹é…ï¼Œè€Œä¸æ˜¯å’Œ`R add(T a, T b)`åŒ¹é…ï¼Œå› ä¸ºï¼Œå‚æ•°`1ll`å’Œ`2ll`ä¸ç‰¹åŒ–æ¨¡æ¿å‡½æ•°ä¸­çš„long longå¯¹åº”ä¸Šäº†ï¼Œå³`R add(long long a, long long b)`ï¼Œæ‰€ä»¥æœ€åç”Ÿæˆçš„å‡½æ•°æ˜¯`float add(long long a, long long b)`ã€‚\n\nå®é™…ä¸Šï¼Œ`template<typename R = float>`ï¼Œè¿™ä¸ªå½¢å¼ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ç§å‡½æ•°æ¨¡æ¿çš„é‡è½½ã€‚å› ä¸ºï¼Œç»™å‡ºäº†å‚æ•°åœ¨æŸäº›ç‰¹åˆ«ç±»å‹ä¸‹ï¼Œå‡½æ•°çš„é‡å®šä¹‰ï¼Œä½“ç°äº†å¤šæ€ã€‚æ€»ä¹‹ï¼šåŒä¸€ä¸ªåå­—ï¼Œä¸åŒçš„å½¢å¼ï¼Œéƒ½å«overloadã€‚\n### å†ä¸¾ä¸€ä¸ªä¾‹å­_1\n\n```cpp\ntemplate<typename R = float>\nR add(long long a, long long* pb)\n{\n    return a + *pb;\n}\n```\n\n```cpp\nint main()\n{\n    auto b = 2ll;\n    auto c = add(1ll, &b);\n}\n```\nèµ°çš„æ˜¯`R add(long long a, long long* pb)`ã€‚è¿™ä¹Ÿæ˜¯ä¸€ä¸ªfunction template overloadã€‚\n### å†ä¸¾ä¸€ä¸ªä¾‹å­_2\n\n```cpp\ntemplate<typename R = float>\nR add(long long a, long long b)\n{\n    return a + b;\n}\n\ntemplate<typename R = float>\nR add(long long a, long long& b)\n{\n    return a + b;\n}\n```\n\n```cpp\nint main()\n{\n    auto b = 2ll;\n    auto c = add(1ll, &b);\n}\n```\næ­¤æ—¶ï¼Œå¦‚æœæ²¡æœ‰ç”¨åˆ°`add(long long, long long&)`ï¼Œæ˜¯å¯ä»¥æ­£å¸¸ç¼–è¯‘çš„ã€‚\nä½†æ˜¯ï¼Œå¦‚æœä¸€æ—¦ç”¨åˆ°äº†ï¼š\n```cpp\nint main()\n{\n    auto b = 2ll;\n    auto c = add(1ll, b);\n}\n```\nå°±ä¼šæŠ¥é”™ï¼š\n```\n'add': ambiguous call to overloaded function\n\nmore than one instance of overloaded function \"add\" matches the argument list:\n    function template \"R add(long long a, long long b)\"\n    function template \"R add(long long a, long long &b)\"\n```\n# ç±»æ¨¡æ¿\n\n```cpp\ntemplate <typename R, typename T>\nclass Addition\n{\npublic:\n    R add(T a, T b) const noexcept\n    {\n        return a + b;\n    }\n}\n```\n\n```cpp\nint main()\n{\n    Addition<int, int> addition;\n    auto c = addition.add(1, 2);\n}\n```\n1. `Addition<int, int>`æ˜¯å¯¹ç±»æ¨¡æ¿çš„å®ä¾‹åŒ–ï¼Œäº§ç”Ÿäº†ç±»ã€‚\n2. `Addition<int, int> addition;`æ˜¯å¯¹ç±»çš„å®ä¾‹åŒ–ï¼Œäº§ç”Ÿäº†å¯¹è±¡ã€‚\n3. `addition.add(1, 2);`è°ƒç”¨ç±»æ¨¡æ¿å‡½æ•°ã€‚ç”Ÿæˆäº†ä»£ç ã€‚\n## ç®€ä¾¿çš„å†™æ³•\n\nèƒ½ä¸èƒ½çœä¸€ä¸ªæ¨¡æ¿å‚æ•°ï¼Œå†™å‡ºæ„é€ å‡½æ•°ï¼Ÿ\n```cpp\ntemplate<typename R, typename T = int>\nclass Addition\n{\npublic:\n    Addition(void)\n    {\n    }\n    Addition(T a, T b) : _a{ a }, _b{ b }\n    {\n        \n    }\n    R add(T a, T b) const noexcept\n    {\n        return a + b;\n    }\n    R add(void) const noexcept\n    {\n        return _a + _b;\n    }\nprivate:\n    T _a;\n    T _b;\n};\n```\n\n```cpp\nint main()\n{\n    Addition addition(1, 2);     // C++14æ ‡å‡†æ— æ³•ç¼–è¯‘é€šè¿‡\n    auto c = addition.add(1, 2); \n}\n```\n\n## ç±»çš„éƒ¨åˆ†ç‰¹åŒ–ï¼ˆåç‰¹åŒ–ï¼‰\nClass Template Partial Specialization\n\n```cpp\ntemplate<typename R, typename T>\nclass Addition\n{\npublic:\n    R add(T a, T b) const noexcept\n    {\n        return a + b;\n    }\n};\n```\nç±»çš„éƒ¨åˆ†ç‰¹åŒ–ï¼Œå®šä¹‰æ—¶ï¼Œè¦åœ¨ç±»ååå†™å°–æ‹¬å·ï¼Œå†™å…¥æ¨¡æ¿å‚æ•°ã€‚\n```cpp\ntemplate <typename T>\nclass Addition<T, int>\n{\npublic:\n    int add(T a, T b) const noexcept\n    {\n        return a + b;\n    }\n};\n```\n\n```cpp\nint main()\n{\n    Addition<int, int> addition;\n    auto c = addition.add(1, 2); \n}\n```\nç±»çš„å®ä¾‹åŒ–èµ°çš„æ˜¯`class Addition<T, int>`ã€‚\n## ç±»çš„å…¨ç‰¹åŒ–\nClass Template Full Specialization\n\n```cpp\ntemplate < >\nclass Addition<int, int>\n{\npublic:\n    int add(int a, int b) const noexcept\n    {\n        return a + b;\n    }\n};\n```\n\n```cpp\nint main()\n{\n    Addition<int, int> addition;\n    auto c = addition.add(1, 2); \n}\n```\nç±»çš„å®ä¾‹åŒ–èµ°çš„æ˜¯`class Addition<int, int>`ã€‚\n### å†æ¥ä¸ªä¾‹å­\n\n```cpp\ntemplate < >\nclass Addition<int, int*>\n{\npublic:\n    int add(int a, int* b) const noexcept\n    {\n        return a + *b;\n    }\n};\n```\n\n```cpp\nint main()\n{\n    auto b = 2;\n    Addition<int, int*> addition;\n    auto c = addition.add(1, &b);\n}\n```\nç±»çš„å®ä¾‹åŒ–èµ°çš„æ˜¯`class Addition<int, int*>`ã€‚\n# Traits\n\nTraitsæ˜¯ç‰¹è´¨ã€ç‰¹æ€§çš„æ„æ€ï¼Œä¸»è¦ç”¨æ¥åŒºåˆ†ä¸åŒç±»å‹ã€‚åœ¨Modern Cppä¸­ï¼Œæœ‰`<traits>`åº“ï¼Œå¯ä»¥ç”¨æ¥åˆ†æå„ç§ç±»å‹ã€‚\nå¦‚æœè¦å¯¹æŸç§ç±»å‹å•ç‹¬åšç‰¹åˆ«çš„å¤„ç†æ—¶ï¼Œå°±ä¼šç”¨åˆ°Traitsï¼Œè¿™åœ¨meta progrmmingä¸­æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ã€‚\n## AddTraits\n\næ¯”å¦‚æ‹¿AdditionåŠ å’Œå‡½æ•°ä¸¾ä¾‹ï¼šæ•´å‹æœ‰æ•´å‹çš„ç­–ç•¥ï¼Œæµ®ç‚¹å‹æœ‰æµ®ç‚¹å‹çš„ç­–ç•¥ã€‚æ›´å…·ä½“åœ°ï¼Œæ•´å‹ä¸­ä¹Ÿæœ‰ä¸åŒçš„æ•´å‹ï¼šintæœ‰intçš„ç­–ç•¥ï¼Œlongæœ‰longçš„ç­–ç•¥â€¦â€¦\n1. intæ•°å’Œå¦ä¸€ä¸ªintæ•°ç›¸åŠ ï¼Œå¯èƒ½ä¼šæº¢å‡ºï¼Œè¿™æ—¶å°±éœ€è¦è½¬ä¸ºlongæ•°åŠ å’Œå¹¶è¿”å›ã€‚\n2. longæ•°å’Œå¦ä¸€ä¸ªlongæ•°ç›¸åŠ ï¼Œå¯èƒ½ä¼šæº¢å‡ºï¼Œè¿™æ—¶å°±éœ€è¦è½¬ä¸ºlong longæ•°åŠ å’Œå¹¶è¿”å›ã€‚\n## åœ¨æ²¡æœ‰ç”¨åˆ°Traitsæ—¶çš„è§£å†³æ–¹æ¡ˆ\nå¦‚æœåªæ˜¯é€šè¿‡ä¸¤ä¸ªæ¨¡æ¿å‚æ•°æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨å¦‚ä¸‹æ–¹æ¡ˆï¼š\n```cpp\ntemplate<typename R, typename T>\nR add(T a, T b)\n{\n    return a + b;\n}\n```\nä½†æ˜¯ï¼Œè¿™ä¸ªæ–¹æ¡ˆä¸å¤Ÿè‡ªåŠ¨åŒ–ã€‚æ¯å½“å¤„ç†ä¸åŒçš„ç±»å‹ï¼Œéƒ½éœ€è¦æ—¶åˆ»è°ƒæ•´æ¨¡æ¿å‚æ•°ï¼š\n```cpp\nint main()\n{\n    int a = 10, b = 20;\n    long c = add<long, int>(a, b);\n    long d = 2000;\n    long long e = add<long long, long>(c, d);\n}\n```\n## ç”¨åˆ°Traitsï¼Œè®©è°ƒç”¨æ›´çˆ½\nTraitså°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚é€šè¿‡æå‰çº¦æŸä¸åŒç±»å‹çš„è¡Œä¸ºï¼Œä»è€Œè®©è°ƒç”¨æ›´ç®€ä¾¿ã€‚è¿™è®©æ¨¡æ¿å‡½æ•°åœ¨ä½¿ç”¨ä¸Šæ›´è‡ªåŠ¨åŒ–äº†ã€‚\n\nè¦å†™è¿™æ ·çš„Additionæ¨¡æ¿ç¾¤ï¼Œå°±è¦å…ˆå£°æ˜ä¸€ä¸ªä¸»æ¨¡æ¿ï¼š\nTä»£è¡¨æ“ä½œæ•°ç±»å‹ã€‚è€Œæ“ä½œæ•°çš„è¿”å›å€¼ç±»å‹é€šè¿‡Tå¯¹åº”çš„å…·ä½“çš„classå¾—å‡ºï¼ˆæœ¬ä¾‹ä¸­ä¸ºRï¼‰ã€‚\nè¿™ä¸ªä¸»æ¨¡æ¿å¯ä»¥ä¸å®ç°ï¼Œå› ä¸ºè¿™ä¸ªä¸»æ¨¡æ¿æ˜¯ä¸€ä¸ªæŠ½è±¡çš„å®šä¹‰ã€‚åæœŸæ‰ä¼šå®šä¹‰å…·ä½“çš„ã€ç‰¹åŒ–çš„ç±»æ¨¡æ¿ã€‚\n```cpp\ntemplate <typename T>\nclass AddTraits;\n```\n## é€šè¿‡ç±»æ¨¡æ¿çš„ç‰¹åŒ–å®ç°AddTraits\n\nTraitsæ˜¯åˆ©ç”¨ç‰¹åŒ–æ¥å®ç°çš„ã€‚é€šè¿‡ç±»æ¨¡æ¿çš„ç‰¹åŒ–ï¼Œæ¥åŒºåˆ†ä¸åŒç±»å‹çš„åŠ å’Œã€‚\n\næ‹¿unsigned shortçš„\"åŠ å’Œ\"ç±»æ¨¡æ¿ä¸¾ä¾‹ï¼š\n```cpp\ntemplate < >\nclass AddTraits<unsigned short>\n{\npublic:\n    typedef unsigned int R;\n};\n```\nä»¥ä¸Šï¼Œåœ¨unsigned shortç±»å‹çš„åŠ å’Œä¸‹ï¼Œè§„å®šäº†ç›®æ ‡ç±»å‹Rï¼ˆå³åŠ å’Œçš„è¿”å›ç±»å‹ï¼‰ä¸ºunsigned intã€‚\nè¿™ä¸ªRï¼Œè¦åœ¨æ¨¡æ¿ç±»å¤–éƒ¨å¾—åˆ°å…¶å®ä¾‹å¯ä»¥å¦‚ä¸‹æ“ä½œï¼š\n```cpp\nint main()\n{\n    // AddTraits<unsigned short>::R å‰é¢éœ€è¦åŠ ä¸€ä¸ªtypenameï¼Œä¸ç„¶Rå¯èƒ½ä¼šè¢«è®¤ä½œæ˜¯é™æ€å˜é‡åå­—ã€‚\n    typename AddTraits<unsigned short>::R r = 9;\n}\n```\næ›´å¤šåœ°ï¼š\n**unsigned int**çš„åŠ å’Œç±»æ¨¡æ¿ï¼Œè§„å®šäº†ç›®æ ‡ç±»å‹Rï¼ˆå³åŠ å’Œçš„è¿”å›ç±»å‹ï¼‰ä¸ºunsigned long longã€‚\n```cpp\ntemplate < >\nclass AddTraits<unsigned int>\n{\npublic:\n    typedef unsigned long long R;\n};\n```\næ›´å¤šåœ°ï¼š\n**unsigned long**çš„åŠ å’Œç±»æ¨¡æ¿ï¼Œè§„å®šäº†ç›®æ ‡ç±»å‹Rï¼ˆå³åŠ å’Œçš„è¿”å›ç±»å‹ï¼‰ä¸ºunsigned long longã€‚\n```cpp\ntemplate < >\nclass AddTraits<unsigned long>\n{\npublic:\n    typedef unsigned long long R;\n};\n```\n## ç”¨AddTraitsç±»æ¨¡æ¿ç¼–å†™Addå‡½æ•°æ¨¡æ¿\n\næˆ‘ä»¬çš„éœ€æ±‚ã€ç›®æ ‡å°±æ˜¯ï¼Œå·²çŸ¥ä¸¤ä¸ªTç±»å‹çš„æ•°ï¼ŒåŠ å’Œï¼Œè¿”å›TåŠ å’Œåç‰¹å®šã€è‡ªå®šã€è§„å®šçš„æ›´å¤§åŒ…å®¹çš„ç±»å‹ã€‚é‚£ä¹ˆè¿™ä¸ªæ›´å¤§åŒ…å®¹çš„ç±»å‹å°±æ˜¯æ¯ä¸€ä¸ªç‰¹åŒ–ç±»æ¨¡æ¿ä¸­çš„Rï¼Œç°åœ¨å¯ä»¥ç»Ÿä¸€å†™ä¸ºï¼š`typename AddTraits<T>::R`ã€‚\n\n>ä¸ºäº†ä¾¿äºä¹¦å†™ï¼Œå¯ä»¥é‡å‘½å`AddTraits<T>::R`ä¸ºRã€‚\n\n```cpp\ntemplate<typename T>\ntypename AddTraits<T>::R add(T a, T b)\n{\n    typedef AddTraits<T>::R R;\n    return static_cast<R>(a) + static_cast<R>(b);\n}\n ```\n\n> ä»¥ä¸Šå‡½æ•°å½¢å¼ä¹Ÿå¯ä»¥å¦‚ä¸‹å†™ã€‚å³åœ¨æ¨¡æ¿å‚æ•°ä¸­å°±é€šè¿‡ç¼ºçœå€¼çš„å½¢å¼æŒ‡æ˜Ræ˜¯ä»€ä¹ˆçš„åˆ«åï¼Œå°±å¯ä»¥ç”¨åœ¨è¿”å›å€¼ç±»å‹çš„ç®€åŒ–äº†ã€‚\n\n```cpp\ntemplate <typename T, typename R = AddTraits<T>::R>\nR add(T a, T b)\n{\n    return static_cast<R>(a) + static_cast<R>(b);\n}\n```\næµ‹è¯•ï¼š\n```cpp\nint main()\n{\n    unsigned short a = 1u;\n    unsigned short b = 2u;\n    // è°ƒç”¨çš„æ˜¯unsigned int add<unsigned short>(unsigned short a, unsigned short b)\n    auto c1 = add(a, b);\n    // è°ƒç”¨çš„æ˜¯unsigned long long add<unsigned int>(unsigned int a, unsigned int b)\n    auto c2 = add(1u, 2u);\n    // è°ƒç”¨çš„æ˜¯unsigned long long add<unsigned long>(unsigned long a, unsigned long b)\n    auto c3 = add(1ul, 2ul);\n}\n```\n# Policy\n\nä¸Šé¢è°ˆåˆ°çš„Traitsæ˜¯å…³äºç±»å‹çš„å°è£…ã€‚\n\nè€ŒPolicyâ€”â€”ç­–ç•¥ï¼Œæ˜¯å…³äºè¡Œä¸ºçš„å°è£…ã€‚æ¯”å¦‚æŠŠåŠ æ³•ã€å‡æ³•ã€ä¹˜æ³•ã€é™¤æ³•éƒ½å°è£…æˆä¸€æ ·çš„è¡Œä¸ºï¼Œå°±æ˜¯Policyã€‚å†å¦‚ï¼Œæ—¥å¿—ç³»ç»Ÿï¼Œæœ‰çš„è¦å†™åˆ°æ–‡ä»¶ä¸­ï¼Œæœ‰çš„åˆ™è¦å†™åˆ°æœåŠ¡å™¨ä¸­ï¼Œæˆ–è€…ç›´æ¥æ§åˆ¶å°è¾“å‡ºã€‚\n## å°è£…AddPolicy\n\næ¯”å¦‚è¦æŠŠåŠ æ³•å°è£…ä¸ºPolicyï¼Œå°±æ˜¯è¦å°è£…ä¸Šé¢çš„`R add(T a, T b)`ï¼š\n> AddPolicyå³æ˜¯ä¸€ä¸ªå…·ä½“çš„OperatePolicyï¼Œé‚£ä¹ˆï¼ŒOperatePolicyéƒ½å°†æœ‰ä¸€ä¸ªcalculateæ–¹æ³•ã€‚\n\nä»¥åŠ æ³•Policyæ¥è¯´ï¼Œå®ƒçš„ç‰¹å¾å°±æ˜¯ï¼š\n1. æœ‰ä¸¤ä¸ªæ“ä½œæ•°aã€bï¼Œç±»å‹ä¸ºTã€‚\n2. æœ‰ä¸€ä¸ªè®¡ç®—çš„æŒ‡ä»¤ï¼ŒæŒ‡ä»¤åå¯ä»¥éƒ½å«åšcalculateï¼Œä½œä¸ºå‡½æ•°åã€‚å‡½æ•°åä¸­åˆ™æ˜¯å…·ä½“çš„è®¡ç®—è¡Œä¸ºï¼ŒåŠ æ³•Policyä¸­åˆ™æ˜¯`a + b`ã€‚\n3. ä¼šè¿”å›ä¸€ä¸ªå€¼ï¼Œç±»å‹ä¸ºRã€‚\n\n> æˆ‘ä»¬åªæ˜¯åˆ©ç”¨ç±»çš„å¤–å£³ï¼Œå®é™…æœ‰ç”¨çš„æ˜¯é™æ€æ–¹æ³•ã€‚\n> å†åˆ©ç”¨Traitsï¼Œé€šè¿‡å…·ä½“TæŒ‡æ˜Rå°†è¿”å›ä»€ä¹ˆã€‚`R = AddTraits<T>::R`\n\n```cpp\n// Tæ˜¯æ“ä½œæ•°ç±»å‹ï¼ŒRæ˜¯è¿”å›ç±»å‹\ntemplate <typename T, typename R = AddTraits<T>::R>\nclass AddPolicy\n{\npublic:\n    static R calculate(T a, T b)\n    {\n        return static_cast<R>(a) + static_cast<R>(b);\n    }\n};\n```\n## å°è£…MultiplyPolicy\n\nç°åœ¨æˆ‘ä»¬è¦ç¼–å†™ç¬¬äºŒä¸ªå…·ä½“çš„Policyï¼Œå³ä¹˜æ³•Policyã€‚å› ä¸ºåŠ æ³•å’Œä¹˜æ³•æœ€åéƒ½è¡¨ç°å‡ºåŒæ ·çš„ç‰¹è´¨ï¼Œæ‰€ä»¥ä¹˜æ³•Traitså¯ä»¥å¤ç”¨AddTraitsã€‚\n```cpp\ntemplate <typename T, typename R = AddTraits<T>::R>\nclass MultiplyPolicy\n{\npublic:\n    static R calculate(T a, T b)\n    {\n        return static_cast<R>(a) * static_cast<R>(b);\n    }\n};\n```\n# å°è£… Traits å’Œ Policy ä¸º Operate å‡½æ•°æ¨¡æ¿\n\nè®¾è®¡ä¸€ä¸ªå‡½æ•°æ¨¡æ¿ï¼ŒæŠŠæ•°æ®ç‰¹æ€§ Traits å’Œè¡Œä¸ºæŠ½è±¡ Policy å°è£…ã€‚\n\nå…¶ä¸­ï¼ŒT æ˜¯åŸå§‹æ•°æ®ç±»å‹ï¼ŒU æ˜¯ä¸€ä¸ª Policyï¼Œå¦‚ AddPolicyã€‚\n## å°è£…AddOperate\n\né¦–å…ˆå¯ä»¥å°è¯•å°è£…ä¸€ä¸ªå…·ä½“çš„ Policy å¦‚ AddPolicy ã€‚\nè¿™ä¸ªå‡½æ•°è¿”å› AddPolicy çš„ calculate çš„è®¡ç®—ç»“æœï¼Œå³è¿”å›æ•°æ®ç±»å‹æ˜¯`AddTraits<T>::R`ã€‚\n```cpp\n// Tæ˜¯æ“ä½œæ•°ç±»å‹ï¼ŒUæ˜¯Policy\ntemplate<typename T, typename U = AddPolicy<T> >\ntypename AddTraits<T>::R AddOperate(T a, T b)\n{\n    return U::calculate(a, b);\n}\n```\n\n```cpp\nint main()\n{\n    std::cout << AddOperate(1, 2) << std::endl; // 3\n}\n```\n### ä¼˜åŒ–\n\nAddOperate å‡½æ•°çš„è¿”å›ç±»å‹ä¹¦å†™å¤ªå†—é•¿ï¼Œè€ƒè™‘å¯ä»¥ç”¨ä¸ªç®€åŒ–çš„åˆ«åã€‚å¯ä»¥åˆ©ç”¨`AddTraits<T>::R`åœ¨ AddPolicy ä¸­å­˜åœ¨ã€ä½¿ç”¨è¿™ä¸ªç‰¹ç‚¹ï¼Œåˆ™å¯ä»¥åœ¨ AddPolicy ä¸­å¦èµ·æ¨¡æ¿å‚æ•°Rçš„åˆ«åä¸ºRTNTYPEï¼ˆé™¤äº†Rï¼Œå…¶ä»–åå­—éƒ½è¡Œï¼‰ã€‚\nå¥½å¤„åœ¨äºï¼šç±»ä¸­å¦èµ·çš„ RTNTYPE å’Œæ¨¡æ¿å‚æ•°çš„ R ç›¸æ¯”ï¼Œå‰è€…å¯ä»¥åœ¨ç±»å¤–éƒ¨ç›´æ¥ä½¿ç”¨ï¼Œè€Œåè€…ä¸å¯ä»¥ã€‚\n```cpp\n// Tæ˜¯æ“ä½œæ•°ç±»å‹ï¼ŒRæ˜¯è¿”å›ç±»å‹\ntemplate <typename T, typename R = AddTraits<T>::R>\nclass AddPolicy\n{\npublic:\n    using RTNTYPE = R;\n    static R calculate(T a, T b)\n    {\n        return static_cast<R>(a) + static_cast<R>(b);\n    }\n};\n```\n\n> Tä¸ºæ“ä½œæ•°ç±»å‹ï¼›Uä¸ºPolicyï¼›Rä¸ºè¿”å›å€¼ç±»å‹ã€‚\n\n```cpp\ntemplate <typename T, U = AddPolicy<T> >\nU::RTNTYPE AddOperate(T a, T b)\n{\n    return U::calculate(a, b);\n}\n```\n\n```cpp\nint main()\n{\n    unsigned short a = 7u;\n    unsigned short b = 3u;\n    auto c = AddOperate(a, b);\n    std::cout << c << std::endl;\n}\n```\n## å°è£…æŠ½è±¡Operate\n\næŠ½è±¡çš„Operateæ˜¯çœŸæ­£çš„å¯ä»¥ä¼ å…¥ä»»æ„çš„Policyå‚æ•°çš„ã€‚\n\n```cpp\ntemplate <typename U, typename T>\nU::RTNTYPE Operate(T a, T b)\n{\n    return U::calculate(a, b);\n}\n```\nä½†æ˜¯ï¼Œå¦‚æœè¿™æ ·å†™çš„è¯ï¼Œå¾—ç»™AddPolicyåé¢åŠ å…·ä½“çš„æ“ä½œæ•°ç±»å‹æ‰èƒ½ç¼–è¯‘é€šè¿‡ã€‚\n```cpp\nint main()\n{\n    unsigned short a = 3u;\n    unsigned short b = 7u;\n    auto c = Operate<AddPolicy<decltype(a)> >(a, b);\n    std::cout << c << std::endl;\n}\n```\næœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•èƒ½ä¸ä¼ å…¥`decltype(a)`å°±èƒ½è¿›è¡Œçš„å‘¢ï¼Ÿé‚£æ ·çš„è¯ï¼Œå°±å¯ä»¥éå¸¸åœ°ç®€æ´ï¼š`Operate<AddPolicy>(a, b)`ã€‚\næ–¹æ³•å°±æ˜¯æŠŠOperateä¸­çš„Uå‚æ•°æŒ‡æ˜ä¸ºç±»æ¨¡æ¿ã€‚\n```cpp\ntemplate <typename T, template<typename, typename> class Policy>\nPolicy<T, Policy::RTNTYPE>::RTNTYPE Operate(T a, T b)\n{\n    return Policy<T, Policy::RTNTYPE>::calculate(a, b);\n}\n```\nä½†æ˜¯ä»¥ä¸Šä»£ç è‚¯å®šç¼–è¯‘ä¸è¿‡ï¼Œå› ä¸ºå‡ºç°äº†æ— é™é€’å½’è§£æï¼šPolicyä¸æ˜¯ä¸€ä¸ªå…·ä½“ç±»ï¼Œå› æ­¤æ— æ³•é€šè¿‡PolicyæŒ‡æ˜å…·ä½“RTNTYPEï¼Œäºæ˜¯å°±å¾—åŠ ç¬¬ä¸‰ä¸ªæ¨¡æ¿å‚æ•°Traitsã€‚\n\n> æ³¨æ„ï¼Œ`Policy<T, typename Traits::R>`ä¸­çš„`Traits::R`å‰é¢åº”è¯¥åŠ typenameã€‚ä»¥æ˜ç¡®åŒºåˆ†ä¼ å…¥çš„æ˜¯ç±»å‹è€Œä¸æ˜¯å¸¸é‡å€¼ï¼ˆå› ä¸ºæ¨¡æ¿å‚æ•°å¯ä»¥ä¼ å…¥å¸¸é‡å€¼ï¼‰\n\n```cpp\ntemplate <template<typename, typename> class Policy, typename Traits, typename T>\nTraits::R Operate(T a, T b)\n{\n    return Policy<T, typename Traits::R>::calculate(a, b);\n}\n```\n\n```cpp\nint main()\n{\n    unsigned short a = 3u;\n    unsigned short b = 7u;\n    auto c = Operate<AddPolicy, AddTraits<decltype(a)>>(a, b);\n    std::cout << c << std::endl;\n}\n```\n\nè¿™æ ·çš„è¯ï¼Œè¿˜æ˜¯å¾—åœ¨AddTraitsååŠ ä¸€ä¸ª`decltype(a)`æ‰è¡Œï¼Œèƒ½ä¸èƒ½å½»åº•æ¶ˆç­å‘¢ï¼Ÿç±»æ¯”æŒ‡æ˜Policyæ˜¯ä¸ªç±»æ¨¡æ¿çš„ç»éªŒï¼ŒæŠŠTraitsä¹ŸæŒ‡æ˜ä¸ºä¸€ä¸ªç±»æ¨¡æ¿ï¼Œå³å¯ï¼š\n```cpp\ntemplate <template<typename, typename> class Policy,\n            template<typename> class Traits,\n            typename T>\nTraits<T>::R Operate(T a, T b)\n{\n    return Policy<T, typename Traits<T>::R>::calculate(a, b);\n}\n```\n\n```cpp\nint main()\n{\n    unsigned short a = 3u;\n    unsigned short b = 7u;\n    auto c = Operate<AddPolicy, AddTraits>(a, b);\n    std::cout << c << std::endl;                  // 10\n    c = Operate<MultiplyPolicy, AddTraits>(a, b);\n    std::cout << c << std::endl;                  // 21\n}\n```\nå¦‚æ­¤ï¼Œç»ˆäºæŠŠOperateçš„è°ƒç”¨å˜å¾—ç®€æ´ã€ç¾è§‚äº†ï¼è¿™ä¸ªè°ƒç”¨å½¢å¼ä¹Ÿä½“ç°äº†Policyå’ŒTraitsåˆäºŒä¸ºä¸€ã€ç›¸è¾…ç›¸æˆçš„ç¾æ„Ÿã€‚\n# æœ€ç»ˆä»£ç \n\n```cpp\n#include<iostream>\n\ntemplate <typename T>\nclass AddTraits;\n\ntemplate < >\nclass AddTraits<unsigned short>\n{\npublic:\n    typedef unsigned int R;\n};\n\ntemplate < >\nclass AddTraits<unsigned int>\n{\npublic:\n    typedef unsigned long long R;\n};\n\ntemplate < >\nclass AddTraits<unsigned long>\n{\npublic:\n    typedef unsigned long long R;\n};\n\ntemplate <typename T, typename R = typename AddTraits<T>::R>\nclass AddPolicy\n{\npublic:\n    using RTNTYPE = R;\n    static R calculate(T a, T b)\n    {\n        return static_cast<R>(a) + static_cast<R>(b);\n    }\n};\n\ntemplate <typename T, typename R = typename AddTraits<T>::R>\nclass MultiplyPolicy\n{\npublic:\n    using RTNTYPE = R;\n    static R calculate(T a, T b)\n    {\n        return static_cast<R>(a) * static_cast<R>(b);\n    }\n};\n\ntemplate <template<typename, typename> class Policy, template<typename> class Traits, typename T>\ntypename Traits<T>::R Operate(T a, T b)\n{\n    return Policy<T, typename Traits<T>::R>::calculate(a, b);\n}\n\nint main()\n{\n    unsigned short a = 3u;\n    unsigned short b = 7u;\n    auto c = Operate<AddPolicy, AddTraits>(a, b);\n    std::cout << c << std::endl;\n    c = Operate<MultiplyPolicy, AddTraits>(a, b);\n    std::cout << c << std::endl;\n}\n```\n# æ›´åŠ ç®€åŒ–\nå‡çº§AddTraitsä¸º`OperationTraits`\n```cpp\n#include<iostream>\n\ntemplate <typename T>\nclass OperationTraits;\n\ntemplate < >\nclass OperationTraits<unsigned short>\n{\npublic:\n    using R = unsigned int;\n};\n\ntemplate < >\nclass OperationTraits<unsigned int>\n{\npublic:\n    using R = unsigned long;\n};\n\ntemplate < >\nclass OperationTraits<unsigned long>\n{\npublic:\n    using R = unsigned long long;\n};\n\ntemplate <typename T>\nclass AddPolicy\n{\npublic:\n    using RTNTYPE = typename OperationTraits<T>::R;\n    static RTNTYPE calculate(T a, T b)\n    {\n        return static_cast<RTNTYPE>(a) + static_cast<RTNTYPE>(b);\n    }\n};\n\ntemplate <typename T>\nclass MultiplyPolicy\n{\npublic:\n    using RTNTYPE = typename OperationTraits<T>::R;\n    static RTNTYPE calculate(T a, T b)\n    {\n        return static_cast<RTNTYPE>(a) * static_cast<RTNTYPE>(b);\n    }\n};\n\ntemplate <template<typename> class Policy, typename T>\ntypename Policy<T>::RTNTYPE Operate(T a, T b)\n{\n    return Policy<T>::calculate(a, b);\n}\n\nint main()\n{\n    unsigned short a = 3u;\n    unsigned short b = 7u;\n    auto c = Operate<AddPolicy>(a, b);\n    std::cout << c << std::endl;\n    c = Operate<MultiplyPolicy>(a, b);\n    std::cout << c << std::endl;\n}\n```","categories":["Cpp","æ¨¡æ¿"]},{"title":"Cpp_stringä»¿å†™","url":"/Cpp/Cpp_stringä»¿å†™/","content":"# å†…å®¹\n\n1. åˆ†æstringçš„è®¾è®¡ã€å®ç°\n2. ç”±atæ–¹æ³•å¼•å‡ºçš„`C++`å¼‚å¸¸æœºåˆ¶ï¼ˆæœ‰å•ç‹¬è¯¦ç»†çš„æ–‡ç« ï¼‰\n3. ç”±å­—ç¬¦ä¸²å¯¹è±¡çš„æ¯”è¾ƒå¼•å‡ºçš„`<compare>`åº“ã€**æ¯”è¾ƒæœºåˆ¶ï¼ˆä¸‰è·¯æ¯”è¾ƒï¼‰**\n4. `cout`è¾“å‡ºæµæœºåˆ¶ï¼Œä»¥åŠå¼•å‡ºçš„å‹å…ƒ\n5. `cin`è¾“å…¥æµæœºåˆ¶\n6. å¼•å…¥**å³å€¼å¼•ç”¨**æ‹·è´ã€èµ‹å€¼\n# Stringçš„å†å²\nåœ¨`C++`æ‰‹å†Œä¸­çš„`<string>`headerä¸­ï¼ŒClass instantiationsï¼ˆç±»å®ä¾‹ï¼‰æœ‰ï¼šstringã€u16stringã€u32stringã€wstringï¼ˆå®½å­—ç¬¦ï¼‰ã€‚\nstring æ˜¯ ANSI è§„èŒƒçš„æ™®é€šå­—ç¬¦ã€‚\nwstringï¼ˆå®½å­—ç¬¦ï¼‰æ˜¯ Unicode å­—ç¬¦é›†ï¼Œå¼€å‘ä¸­æ¨èä½¿ç”¨ã€‚\n# Stringæ–¹æ³•\n1. `length()`ï¼šè¿”å›å­—ç¬¦ä¸²æœ‰æ•ˆå­—ç¬¦é•¿åº¦ï¼Œå³ä¸åŒ…æ‹¬`\\0`ã€‚\n2. `size()`ï¼šä¹Ÿæ˜¯è¿”å›æœ‰æ•ˆå­—ç¬¦é•¿åº¦ã€‚ä¸`length()`ç­‰ä»·ã€‚\n    1. ä½†åœ¨ vector ä¸­ï¼ŒäºŒè€…æœ‰åŒºåˆ«ã€‚\n    2. Cppå­—ç¬¦ä¸²çš„é•¿åº¦å‡½æ•°æ˜¯ä»¥ä¸Šä¸¤ä¸ªï¼Œè°ƒç”¨å½¢å¼æ˜¯ï¼š`str.size() str.length()`ã€‚è€ŒCè¯­è¨€çš„`<cstring>`ä¸­çš„è°ƒç”¨å½¢å¼æ˜¯`strlen(str)`\n# ä»¿å†™æˆå‘˜æ–¹æ³•\n\n## åŸºæœ¬æ€æƒ³1ï¼šä½“ç°é¢å‘å¯¹è±¡ä¸­å°è£…çš„ç‰¹æ€§ï¼šæ„é€ \n## åŸºæœ¬æ€æƒ³2ï¼šRAII\nRAII å…¨ç§° Resource Acquisition is Initialization. è¿™æ˜¯`C++`çš„è®¾è®¡å“²å­¦ã€‚\næ„ä¸ºï¼š`C++`çš„å¯¹è±¡åœ¨åˆ›å»ºæˆ–æ„é€ æ—¶æ„å‘³ç€åˆå§‹åŒ–çš„å¼€å§‹ï¼Œæ¯”å¦‚`char * _str`æˆå‘˜åœ¨stringæ„é€ æ—¶è‡ªåŠ¨åœ°æŒ‡å‘ä¸€å—æ–°ç”³è¯·çš„åŒºåŸŸã€‚é‚£ä¹ˆï¼Œç›¸å¯¹åº”çš„è¿‡ç¨‹æ˜¯ææ„å°±æ„å‘³ç€è¦é‡Šæ”¾èµ„æºã€‚è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯æ¨èçš„`C++`å¯¹è±¡çš„è‡ªç„¶è®¾è®¡ã€è‡ªç„¶è¡Œä¸ºã€‚\nè€ŒJavaçš„è®¾è®¡ç†å¿µæ˜¯ç±»å¯åŠ¨æ—¶å¹¶æ²¡æœ‰è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿˜è¦è¿›è¡Œ`init()`ã€‚\n### å¸¸é‡å­—ç¬¦ä¸²æ„é€ \n`std::string str(\"Hello\")`\n```cpp\nclass MyString\n{\npublic:\n    MyString(const char * str)\n    {\n        if(!str) return;\n        size_t len = strlen(str);\n        _str = new char[len + 1];\n        strcpy(_str, str);\n    }\n\n    const char * c_str(void) const\n    {\n        return _str;\n    }\nprivate:\n    char * _str{ nullptr };\n}\n```\n### æ‹·è´æ„é€ \n```cpp\nclass MyString\n{\npublic:\n    MyString(MyString const & str)\n    {\n        if(!str._str) return;\n        size_t len = strlen(str._str);\n        _str = new char[len + 1];\n        strcpy(_str, str._str);\n    }\n}\n```\n## èµ‹å€¼é‡è½½\n\næŠŠæ—§çš„å†…å®¹æ¸…ç©ºï¼Œèµ‹äºˆæ–°çš„å†…å®¹ã€‚\n```cpp\nclass MyString\n{\npublic:\n    MyString& operator = (const char * str)\n    {\n        if(_str)\n        {\n            delete[] _str;\n            _str = nullptr;\n        }\n        if(str != nullptr)\n        {\n            size_t len = strlen(str);\n            _str = new char[len + 1];\n            strcpy(_str, str);\n        }\n        return *this;\n    }\n    MyString& operator = (MyString const & str)\n    {\n        if(&str == this) return *this;\n        if(_str)\n        {\n            delete[] _str;\n            _str = nullptr;\n        }\n        if(str._str != nullptr)\n        {\n            size_t len = strlen(str._str);\n            _str = new char[len + 1];\n            strcpy(_str, str._str);\n        }\n        return *this;\n    }\n}\n```\n## `+=`\nä¸¤ç§æƒ…å†µï¼š\n1. ç±»æœ¬èº«æ˜¯ç©ºçš„ï¼Œåˆ™ç›´æ¥newï¼Œå¤åˆ¶\n2. ç±»æœ‰ä¸œè¥¿ï¼Œåˆ™æƒ³åŠæ³•æåˆé€‚çš„ç©ºé—´ï¼Œè¿½åŠ \n    1. å¯èƒ½è¦æ‰©å®¹åŸç©ºé—´\n\n```cpp\nclass MyString\n{\npublic:\n    MyString& operator += (const char * str)\n    {\n        // è¦è¿½åŠ çš„strä¸ºç©º é€€å‡º\n        if(!str) return *this;\n        \n        size_t oldlen = strlen(_str);\n        size_t newlen = strlen(str);\n        // è¦è¿½åŠ çš„strå†…å®¹ä¸ºç©ºä¸² é€€å‡º\n        if(newlen == 0) return *this;\n\n        // é‡æ–°åˆ†é…æ›´å¤§çš„ç©ºé—´\n        // éœ€è¦å…ˆå¤‡ä»½åˆ°newsträ¸´æ—¶ç©ºé—´\n        char * newstr = new char[oldlen + newlen + 1];\n        strcpy(newstr, _str);\n        strcat(newstr, str);\n        //å¦‚æœæœ¬èº«ä¸²ä¸ä¸ºç©º åˆ™éœ€è¦é”€æ¯æ—§ç©ºé—´\n        if(_str != nullptr)\n        {\n            delete[] _str;\n            _str = nullptr;\n        }\n        _str = newstr;\n        return *this;\n    }\n    MyString& operator += (MyString const & str)\n    {\n        //\n    }\n}\n```\n## ææ„\n\n```cpp\n~MyString()\n{\n    if (_str)\n    {\n        delete[] _str;\n        _str = nullptr;\n    }\n}\n```\n## Boolean Operator\n\nä¸ºäº†ä¾¿äºè¿ç®—`if(str)`è¿™ç±»è¯­å¥ã€‚`C++11`ç‰ˆæœ¬å…è®¸æœ‰boolè¿ç®—ç¬¦çš„é‡è½½ã€‚\n\nboolè¿ç®—ç¬¦çš„é‡è½½çš„ç‰¹ç‚¹ï¼š\n1. å› ä¸ºå¸ƒå°”è¿ç®—ç¬¦çš„è¿”å›å€¼å¿…é¡»ä¸ºBooleanï¼Œé”å®šäº†è¿”å›å€¼ç±»å‹ï¼Œæ‰€ä»¥å¯ä»¥çœç•¥ä¸å†™ã€‚\n2. å’Œå°æ‹¬å·è¿ç®—ç¬¦ä¸ä¸€æ ·ï¼Œå°æ‹¬å·è¿ç®—ç¬¦å¯ä»¥è¿”å›ä»»ä½•å€¼ç±»å‹ï¼Œä½†boolè¿ç®—ç¬¦å¿…é¡»è¿”å›booleanç±»å‹ã€‚\n```cpp\nclass MyString\n{\npublic:\n    // ä¸ç”¨å†™è¿”å›å€¼ï¼Œé»˜è®¤å°±ä¸€å®šæ˜¯boolç±»å‹\n    operator bool() const\n    {\n        return _str;\n    }\n}\n```\n## atï¼ˆæŠ›å¼‚å¸¸ï¼Œæ£€æŸ¥è¾¹ç•Œï¼‰\n\næœ‰ä¸¤ç§ï¼š\n1. atä½ç½®çš„å­—ç¬¦ä¸èƒ½ä¿®æ”¹\n2. atä½ç½®çš„å­—ç¬¦å¯ä»¥ä¿®æ”¹\n\n1. å¯èƒ½ä¼šout of rangeã€‚\n2. è¿”å›çš„éƒ½æ˜¯å¼•ç”¨ç±»å‹ï¼Œå¼•ç”¨ä¸èƒ½ä¸ºç©ºï¼Œæ‰€ä»¥ä¸èƒ½é€šè¿‡è¿”å›å€¼æ˜¯å¦ä¸ºç©ºæ¥åˆ¤æ–­æ˜¯å¦é”™è¯¯äº†ï¼Œæ‰€ä»¥å¾—ç”¨å¼‚å¸¸æœºåˆ¶ã€‚\n```cpp\n#include<exception>\nclass OutOfRange : public std::exception\n{\npublic:\n    OutOfRange() : std::exception{\"MyString: out of range!\"}\n    {\n    }\n}\nclass MyString\n{\npublic:\n    char & at(const size_t off)\n    {\n        size_t len = strlen(_str);\n        if(off > strlen - 1)\n            throw OutOfRange{};\n        return _str[off];\n    }\n    char const & at(const size_t off) const\n    {\n        size_t len = strlen(_str);\n        if(off > strlen - 1)\n            throw OutOfRange{};\n        return _str[off];\n    }\n}\nint main()\n{\n    if(str)\n    {\n        try\n        {\n            std::cout << str.at(11) << std::endl;\n        }\n        catch (const std::exception &e)\n        {\n            std::cout << e.what() << std::endl;\n        }\n    }\n}\n```\n## `[]`ï¼ˆä¸æŠ›å¼‚å¸¸ï¼Œä¸æ£€æŸ¥è¾¹ç•Œï¼‰\n\nä¸atå‡½æ•°çš„ä¸åŒåœ¨äºï¼Œ`[]`æ˜¯ä¸æŠ›å‡ºå¼‚å¸¸çš„ï¼Œå› æ­¤ä¸æ£€æŸ¥è¾¹ç•Œã€‚å¦‚æœè¶Šç•Œï¼Œåˆ™è¡Œä¸ºæœªå®šä¹‰ã€‚\n```cpp\nclass MyString\n{\npublic:\n    char& operator[](const size_t off) noexcept\n    {\n        return _str[off];\n    }\n    char const & operator[](const size_t off) const noexcept\n    {\n        return _str[off];\n    }\n}\n```\n## `<=>`ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦\n\n`C++20`æ ‡å‡†ä¸­ï¼Œæœ‰`<compare>`åº“ã€‚\n1. `strong_ordering`\n    1. less\n    2. greater\n    3. equalï¼šç›¸ç­‰\n    4. equivalentï¼šç­‰ä»·\n2. `weak_ordering`\n    1. less\n    2. greater\n    3. equivalentï¼šç­‰ä»·ï¼Œæˆ–è€…è¯´æ¨¡ç³Šçš„ç›¸ç­‰\n3. `partial_ordering`\n    1. less\n    2. greater\n    3. equivalent\n    4. unordered\n\n`strong_ordering`æµ‹è¯•å¦‚ä¸‹\n```cpp\n#include<compare>\nint main()\n{\n    int a = 3;\n    int b = 4;\n    auto c = a <=> b;//cçš„ç±»å‹ï¼šstd::strong_ordering\n    if(c < 0)\n        std::cout << \"less\" << std::endl;\n    else if(c > 0)\n        std::cout << \"greater\" << std::endl;\n    else if(c == 0)\n        std::cout << \"equal\" << std::endl;\n    return 0;\n}\n```\n\n`partial_ordering`æµ‹è¯•å¦‚ä¸‹ï¼Œä¸»è¦æµ‹è¯•`unordered`çš„æƒ…å†µã€‚ç”¨ä¸€ä¸ªNaNæµ®ç‚¹æ•°æ¯”è¾ƒæ—¶ï¼Œå°±ä¼šå‡ºç°ã€‚\n>NaNå®šä¹‰äºlimitsåº“\n\n```cpp\n#include<limits>\nint main()\n{\n    double a = 4.0;\n    double b = std::numeric_limits<double>::quiet_NaN(); //å¾—å‡ºdoubleç±»å‹çš„NaN\n    auto c = a <=> b; //cçš„ç±»å‹ï¼šstd::partial_ordering\n    if(c < 0)\n        std::cout << \"less\" << std::endl;\n    else if(c > 0)\n        std::cout << \"greater\" << std::endl;\n    else if(c == 0)\n        std::cout << \"equivalent\" << std::endl;\n    else\n        std::cout << \"unordered\" << std::endl;\n    return 0;\n}\n```\n\nå¯¹äºå­—ç¬¦ä¸²æ¥è¯´ï¼Œæˆ‘ä»¬è¿”å›ä¸€ä¸ªstrongæˆ–weakéƒ½å¯ä»¥ã€‚strongè¦æ±‚è‚¯å®šæ›´ä¸¥æ ¼ä¸€äº›ï¼Œæ¯”å¦‚åŒºåˆ†å­—æ¯å¤§å°å†™ç­‰ç­‰ï¼Œè€Œweakè¦æ±‚åˆ™æ¾ä¸€äº›ï¼Œæ¯”å¦‚ä¸ç®¡å¤§å°å†™ï¼Œéƒ½ç®—ç›¸ç­‰ã€‚\n\nç±»ä¸­æ€ä¹ˆä½¿ç”¨`<=>`\n1. defaultçš„`<=>`æ˜¯æŒ‰ç…§ç±»ä¸­çš„æˆå‘˜é¡ºåºä¾æ¬¡æ¯”è¾ƒã€‚\n2. å¦‚æœä¸æ˜¯æŒ‰ç…§é»˜è®¤é¡ºåºä¾æ¬¡æ¯”è¾ƒï¼Œåˆ™éœ€è¦è‡ªå®šä¹‰å‡½æ•°é€»è¾‘\n\nä»¥ä¸‹æ˜¯é»˜è®¤çš„ä¾‹å­\n```cpp\nclass Point\n{\npublic:\n    Point(int x, int y) : _x{ x }, _y{ y }\n    {\n    }\n    std::strong_ordering operator <=> (Point const & pt) const = default;\n    \nprivate:\n    int _x;\n    int _y;\n};\nint main()\n{\n    Point pt{1, 2}, pt2{1, 2};\n    if(pt == pt2)\n    {\n        std::cout << \"equal\" << std::endl;\n    }\n}\n```\n### stringä¸­çš„å®ç°\nä»¥ä¸‹å›åˆ°MyStringä¸­çš„`<=>`æ¯”è¾ƒè¿ç®—ç¬¦ã€‚æˆ‘ä»¬å®šä¹‰å…¶è¿”å›`weak_ordering`ã€‚å³ä¸ç®¡å¤§å°å†™æ··åˆä¸å¦ï¼Œéƒ½æ˜¯ç­‰ä»·å…³ç³»ã€‚æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æƒ…å†µä¸‹è¿”å›`weak_ordering`ã€‚\n\n1. ç»Ÿä¸€å¤§å°å†™ï¼Œå†æ¯”å¯¹ï¼Œä¸€æ ·åˆ™è¿”å›ç­‰ä»·ï¼Œä¸ä¸€æ ·åˆ™è¿”å›å¤§ã€å°\n\n```cpp\n#include<compare>\nclass MyString\n{\npublic:\n    std::weak_ordering operator <=> (MyString const & other) const noexcept\n    {\n        // å…¨éƒ¨è½¬æ¢ä¸ºå¤§å†™æˆ–å°å†™ã€‚å¯ä»¥ä½¿ç”¨cctypeä¸­çš„toupperã€tolowerå¤„ç†\n        /*for\n        if(!islower())\n        {\n            tolower()\n        }*/\n        int c = strcmp(_str, other.c_str());\n        if(c == 0)\n            return std::weak_ordering::equivalent;\n        else if(c > 0)\n            return std::weak_ordering::greater;\n        else\n            return std::weak_ordering::less;\n    }\n}\n```\nç±»ä¸­åªè¦å®šä¹‰äº†`<=>`è¿™ä¸ªè¿ç®—ç¬¦ï¼ˆå‚æ•°æ˜¯ä¸€ä¸ªconst åŒç±»å¼•ç”¨ï¼‰ï¼Œé‚£ä¹ˆï¼Œå¤–éƒ¨çš„æ¯”è¾ƒè¿ç®—ç¬¦å°±è½¬å‘è¿è¡Œè¯¥å‡½æ•°è¿›è¡Œæ¯”è¾ƒã€‚\n```cpp\nint main()\n{\n    MyString str{ \"Hello\" };\n    MyString str2{ \"Hello\" };\n    if(str == str2)\n        std::cout << \"equal\" << std::endl;\n    else if(str < str2)\n        std::cout << \"less\" << std::endl;\n    else\n        std::cout << \"greater\" << std::endl;\n}\n```\n## coutè¯†åˆ«æœ¬ç±»ï¼ˆå…¨å±€é‡è½½ï¼‰\n\ncout æ˜¯ ostream çš„å®ä¾‹ã€‚å¦‚æœæˆ‘ä»¬è¦åšåˆ°è®© cout è®¤è¯†è‡ªå®šä¹‰ç±» MyString çš„è¯ï¼Œå°±éœ€è¦é‡è½½ cout çš„`<<`è¿ç®—ç¬¦ã€‚æ³¨æ„ï¼Œä¸ MyString çš„æˆå‘˜æ–¹æ³•æ²¡å…³ç³»ï¼Œå› ä¸ºcoutçš„å½¢å¼æ˜¯ï¼š`std::cout << str`ã€‚\n```cpp\nstd::ostream& operator <<(std::ostream &os, MyString const & str)\n{\n    os << str.c_str();\n    return os;\n}\n```\n## å‹å…ƒ\n\nå‡å¦‚ç±»å¤–éƒ¨éœ€è¦è®¿é—®ç±»å†…ç§æœ‰æˆå‘˜ï¼Œåˆ™éœ€è¦å†ç±»å†…ä»»æ„ä½ç½®æˆæƒè¯¥ç±»å¤–å‡½æ•°ã€‚å³åœ¨å‡½æ•°å£°æ˜å½¢å¼çš„è¯­å¥ä¹‹å‰ï¼ŒåŠ friendã€‚\nè¿™æ˜¯éµå¾ªå°è£…æ€§çš„ç¨‹åºè®¾è®¡ä¸‹çš„ä¸€ç§å¦¥åçš„é€šè·¯ã€‚åœ¨ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå¯ä»¥ç ´åå°è£…æ€§ã€‚\n```cpp\nclass MyString\n{\n    friend std::ostream& operator << (std::ostream& os, MyString const& str);\n}\nstd::ostream& operator <<(std::ostream &os, MyString const & str)\n{\n    // private\n    os << str._str;\n    return os;\n}\n```\n## cin\ncin çš„ä½ç½®åœ¨`<istream>`ä¸­ã€‚å†…éƒ¨æœ‰è¾“å…¥ç¼“å†²åŒºã€‚ä»¥å›è½¦æ ‡å¿—ç€è¾“å…¥å®Œæ¯•ï¼Œç©ºæ ¼æ ‡å¿—ç€æ•°æ®çš„é—´éš”ã€‚\n```cpp\n#include <iostream>\nint main()\n{\n    std::string str;\n    std::string str2;\n    std::cin >> str;\n    std::cin >> str2;\n}\n// è¾“å…¥ï¼š12 23 34 å›è½¦\n// str: 12\n// str2:23\n```\n### cinçš„æ–¹æ³•\n![](../../images/Cpp_20240410_stringä»¿å†™_compareåº“_å¼•å…¥å³å€¼å¼•ç”¨/image-20240716053343096.png)\n`cin.get()`æ–¹æ³•ä¸å¸¦å‚æ•°è¡¨ç¤ºä»ç¼“å†²åŒºæå‡ºä¸€ä¸ªå­—ç¬¦ï¼Œå¹¶ä¸”ä¸å†è¿”å›ç¼“å†²åŒºã€‚\nå¦‚æœæ”¾åœ¨`cin >> x`çš„åé¢ï¼Œå‰é¢`>>`å·²ç»æŠŠæœ‰æ•ˆæ•°æ®æ‹¿èµ°ï¼Œåˆ™æ­¤æ—¶æ°å¥½å¯ä»¥åœ¨é—´éš”ç¬¦ï¼ˆç©ºæ ¼æˆ–å›è½¦ï¼‰çš„ä½ç½®ä¸Šgetï¼Œå› æ­¤ä¸ä¼šå½±å“æ­£å¸¸æ•°æ®ã€‚\n```cpp\n#include <iostream>\nint nums[100];\n// å‘numsè¾“å…¥æ•°æ®ï¼Œä»¥ç©ºæ ¼ä¸ºé—´éš”ï¼Œä»¥å›è½¦ä¸ºç»“æŸæ ‡å¿—\nint main()\n{\n    int i = 0;\n    while (std::cin >> nums[i++])\n    {\n        if (std::cin.get() == '\\n')\n            break;    \n    }\n    for (int j = 0; j < i; ++j)\n        std::cout << nums[j] << std::endl;\n}\n// è¾“å…¥ï¼š1 2 3 4 5 6 7 å›è½¦\n// è¾“å‡ºï¼š1 2 3 4 5 6 7\n```\n### ciné‡è½½ï¼ˆå…¨å±€ï¼‰\né¦–å…ˆè°ƒç”¨cinçš„`>>`åç”¨æˆ·è¦å…ˆè¾“å…¥ä¸€äº›ä¸œè¥¿ï¼Œä¿å­˜åˆ°äº†ç¼“å†²åŒºã€‚\néœ€è¦ç”¨åˆ°`cin.get(char* s, streamsize n)`è¡¨ç¤ºä»ç¼“å†²åŒºæå‡º n ä¸ªå­—ç¬¦å¤§å°ï¼Œå†™å…¥ s æŒ‡å‘çš„åŒºåŸŸä¸­ã€‚\n```cpp\nstd::istream& operator >>(std::istream& is, MyString const& str)\n{\n    char * in_c_str = new char[1024];\n    memset(in_c_str, 0, 1024); // <cstring>\n    \n    is.get(in_c_str, 1024);    // 1. ä»ç¼“å†²åŒºæå‡º1024ä¸ªå­—ç¬¦ï¼Œå†™å…¥åˆ°in_c_strä¸­\n    \n    // è¦è¿½åŠ çš„strä¸ºç©º é€€å‡º\n    if(!&str) return *this;\n    \n    size_t inlen = strlen(in_c_str);\n    // è¦è¿½åŠ çš„strå†…å®¹ä¸ºç©ºä¸² é€€å‡º\n    if(inlen == 0) return *this;\n    \n    size_t oldlen = strlen(_str);\n    // é‡æ–°åˆ†é…æ›´å¤§çš„ç©ºé—´\n    // éœ€è¦å…ˆå¤‡ä»½åˆ°newsträ¸´æ—¶ç©ºé—´\n    char * newstr = new char[oldlen + newlen + 1];\n    strcpy(newstr, _str);\n    strcat(newstr, in_c_str);\n    //å¦‚æœæœ¬èº«ä¸²ä¸ä¸ºç©º åˆ™éœ€è¦é”€æ¯æ—§ç©ºé—´\n    if(_str != nullptr)\n    {\n        delete[] _str;\n        _str = nullptr;\n    }\n    _str = newstr;\n\n    return is;               // 2. è¿”å›is\n}\n```\n## æµ‹è¯•\n```cpp\nint main()\n{\n    MyString str{\"Hello\"};\n    std::cout << str.c_str() << std::endl;\n    MyString str2{str};\n    // MyString str2 = str; ç­‰æ•ˆäºMyString str2{str}; éƒ½æ˜¯èµ°æ‹·è´æ„é€ \n    std::cout << str2.c_str() << std::endl;\n    str = \"Test =\";\n    std::cout << str.c_str() << std::endl;\n    if(str)\n    {\n        std::cout << str.c_str() << std::endl;\n    }\n    str += \"Test +=\";\n    std::cout << str.c_str() << std::endl;\n\n    std::cout << str.at(5) << std::endl;\n}\n```\n# é—®é¢˜ä»£ç \n\n![../../image-20211121150816082](../../images/String%E4%BB%BF%E5%86%99/image-20211121150816082.png)\n\né—®é¢˜ï¼š\n1. åœ¨`return String(newch)`åï¼Œä¸èƒ½deleteè¯¥å‡½æ•°ä½“ä¸­çš„ç¼“å†²åŒºnewchï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚\n2. ç³»ç»Ÿå´©æºƒã€‚å› ä¸ºè¿”å›çš„å°†äº¡å€¼`String(newch)`åœ¨`s3 = s1 + s2`è¯­å¥ç»“æŸå‰æµ…æ‹·è´ï¼ŒæŠŠæœ‰å€¼çš„strç»™äº†s3çš„strã€‚è¯­å¥ç»“æŸåè‡ªåŠ¨ææ„ï¼Œé‡Šæ”¾äº†å †åŒºç©ºé—´`(String(newch)).str`ï¼Œè™½ç„¶strç½®ç©ºäº†ï¼Œä½†s3çš„stræ˜¯è„å€¼ã€‚\n    1. é¦–å…ˆï¼Œç”±äºå †åŒºé‡Šæ”¾äº†ï¼Œs3ç”¨ä¸äº†äº†\n    2. å…¶æ¬¡æ›´ä¸¥é‡çš„æ˜¯ï¼Œmainå‡½æ•°ç»“æŸæ—¶ç”±äºs3çš„strä¸ºè„å€¼ï¼Œä¸ä¸ºç©ºï¼Œå› æ­¤ä¼šå†æ¬¡`delete[]str`ï¼Œå¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚\n# å¼•å…¥å³å€¼èµ‹å€¼å‡½æ•°\n\n![../../image-20211121153216410](../../images/String%E4%BB%BF%E5%86%99/image-20211121153216410.png)\n\næ­¤æ—¶ï¼Œç­‰å·èµ‹å€¼è°ƒç”¨å³å€¼ç§»åŠ¨å‡½æ•°ï¼Œå°†ä¸´æ—¶æ„é€ çš„s1+s2å¯¹è±¡çš„strçš„æ‹¥æœ‰æƒè½¬ç§»ç»™äº†s3ã€‚\n# å°†äº¡å€¼\n\næŸä¸€å¥è¡¨è¾¾å¼äº§ç”Ÿäº†ä¸€ä¸ªä¸å…·æœ‰åå­—çš„å®ä½“ã€‚\nç”Ÿå­˜æœŸåªå­˜åœ¨æŸä¸€å¥è¡¨è¾¾å¼ä¸­ã€‚\næ­¤å®ä½“å³ä¸ºå°†äº¡å€¼ã€‚\n# å³å€¼å¼•ç”¨\n\n## 1\n```c\nString fun()\n{\n    String s2 = (\"yhping\");\n    return s2;\n}\nint main()\n{\n    String s1;\n    s1 = fun();\n    return 0;\n}\n/*\næ­¤ç¨‹åºäº§ç”Ÿ3ä¸ªå¯¹è±¡ã€‚\né¦–å…ˆmainå‡½æ•°äº§ç”Ÿs1ï¼›\t\t\t\t\t1\nå…¶æ¬¡ï¼Œfunå‡½æ•°æ ˆå¸§äº§ç”Ÿs2å¯¹è±¡ã€‚\t\t\t2\nç„¶åï¼Œæ‹·è´s2æ„é€ ä¸€ä¸ªæ— åå¯¹è±¡åˆ°mainå‡½æ•°æ ˆå¸§ã€‚ 3\t\ns1å†è°ƒç”¨ç­‰å·èµ‹å€¼ï¼Œå³æ— åå¯¹è±¡çš„å€¼èµ‹ç»™s1ã€‚\n*/\n```\n## 2\n```c\nString & fun()\n{\n    String s2 = (\"yhping\");\n    return s2;\n}\nint main()\n{\n    String s1;\n    s1 = fun();\n    cout << s1 << endl;\n    return 0;\n}\n/*\nä¸èƒ½è¿™æ ·åšã€‚\nå› ä¸ºå¦‚æœè¦ä»¥å¼•ç”¨è¿”å›ï¼Œåˆ™s1ä¼šä»ææ„åçš„s2ä¸Šå–å€¼ï¼Œåˆ™ä¼šäº§ç”Ÿéšæœºå€¼\n*/\n```\n## 3\nå³å€¼å¼•ç”¨åªèƒ½å¼•ç”¨å­—é¢å¸¸é‡æˆ–**æ— å**é‡ã€‚å·¦å€¼å¼•ç”¨ä¸èƒ½å¼•ç”¨æ— åé‡ã€‚\n```c\nint main()\n{\n    String s1;\n    \n    String & sx = s1;\n    String && sy = sx;//error\n    String && sz = String(\"hello\");//ok\n}\n```\n\n```c\nString && fun()//errorï¼Œå› ä¸ºs2æœ‰åå­—ï¼Œä¸èƒ½ä»¥å³å€¼å¼•ç”¨æ–¹å¼è¿”å›ã€‚\n{\n\tString s2(\"yhping\");\n\treturn s2;\n}\n```\n\n```c\nint main()\n{\n    int && a = 10;\n    int && b = a;//ä¾ç„¶ä¸å¯ä»¥ï¼Œè™½ç„¶aæ˜¯ä¸€ä¸ªå³å€¼å¼•ç”¨ï¼Œä½†æ˜¯aæœ‰äº†åå­—ï¼Œæ‰€ä»¥bä¸èƒ½å³å€¼å¼•ç”¨aã€‚\n}\n```\n## 4\n```c++\nclass String\n{\n\npublic:\n    String(String && s)\n    {\n        cout << \"move copy construct :\" << this << endl;\n        str = s.str;\n        s.str = NULL;\n    }\n    String& operator=(String && s)\n    {\n        \n    }\n};\n```\n\n# å†™æ—¶æ‹·è´çš„String\n```c\nint main()\n{\n    String s1(\"xcgong\");\n    String s2(s1);\n    String s3(s2);\n    String s4(s3);\n}\n/*\næœ‰ä¸¤ç§æƒ…å†µï¼š\nå¦‚æœæ˜¯æµ…æ‹·è´ï¼Œåˆ™ä¼šå‡ºç°é‡å¤ææ„ï¼›\nå¦‚æœæ˜¯æ·±æ‹·è´ï¼Œåˆ™ä¼šå‡ºç°å¤šæ¬¡é‡å¤çš„å †ç©ºé—´ã€‚\n*/\n```\nå†™æ—¶æ‹·è´çš„Stringæ˜¯GCCé‡ŒStringçš„æ–¹æ¡ˆã€‚","categories":["Cpp","å³å€¼å¼•ç”¨"]},{"title":"Cpp_ä¸‰è·¯æ¯”è¾ƒ_compareåº“","url":"/Cpp/Cpp_ä¸‰è·¯æ¯”è¾ƒ_compareåº“/","content":"# `<=>`ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦\n\n`C++20`æ ‡å‡†ä¸­ï¼Œæœ‰`<compare>`åº“ã€‚\n1. `strong_ordering`\n    1. less\n    2. greater\n    3. equalï¼šç›¸ç­‰\n    4. equivalentï¼šç­‰ä»·\n2. `weak_ordering`\n    1. less\n    2. greater\n    3. equivalentï¼šç­‰ä»·ï¼Œæˆ–è€…è¯´æ¨¡ç³Šçš„ç›¸ç­‰\n3. `partial_ordering`\n    1. less\n    2. greater\n    3. equivalent\n    4. unordered\n# strong_ordering\n```cpp\n#include<compare>\nint main()\n{\n    int a = 3;\n    int b = 4;\n    auto c = a <=> b; //cçš„ç±»å‹ï¼šstd::strong_ordering\n    if(c < 0)\n        std::cout << \"less\" << std::endl;\n    else if(c > 0)\n        std::cout << \"greater\" << std::endl;\n    else if(c == 0)\n        std::cout << \"equal\" << std::endl;\n    return 0;\n}\n```\n# partial_ordering\n`partial_ordering`æµ‹è¯•å¦‚ä¸‹ï¼Œä¸»è¦æµ‹è¯•`unordered`çš„æƒ…å†µã€‚ç”¨ä¸€ä¸ªNaNæµ®ç‚¹æ•°æ¯”è¾ƒæ—¶ï¼Œå°±ä¼šå‡ºç°ã€‚\n>NaNå®šä¹‰äºlimitsåº“\n\n```cpp\n#include<limits>\nint main()\n{\n    double a = 4.0;\n    double b = std::numeric_limits<double>::quiet_NaN(); //å¾—å‡ºdoubleç±»å‹çš„NaN\n    auto c = a <=> b; //cçš„ç±»å‹ï¼šstd::partial_ordering\n    if(c < 0)\n        std::cout << \"less\" << std::endl;\n    else if(c > 0)\n        std::cout << \"greater\" << std::endl;\n    else if(c == 0)\n        std::cout << \"equivalent\" << std::endl;\n    else\n        std::cout << \"unordered\" << std::endl;\n    return 0;\n}\n```\n# ç±»ä¸­æ€ä¹ˆä½¿ç”¨`<=>`\n\nå¯¹äºå­—ç¬¦ä¸²æ¥è¯´ï¼Œæˆ‘ä»¬è¿”å›ä¸€ä¸ªstrongæˆ–weakéƒ½å¯ä»¥ã€‚\nstrongè¦æ±‚æ›´ä¸¥æ ¼ä¸€äº›ï¼Œæ¯”å¦‚åŒºåˆ†å­—æ¯å¤§å°å†™ç­‰ç­‰ï¼Œ\nè€Œweakè¦æ±‚åˆ™æ¾ä¸€äº›ï¼Œæ¯”å¦‚ä¸ç®¡å¤§å°å†™ï¼Œéƒ½ç®—ç›¸ç­‰ã€‚\n\n1. `<=>`çš„é»˜è®¤è¡Œä¸ºæ˜¯**æŒ‰ç…§ç±»ä¸­çš„æˆå‘˜é¡ºåºä¾æ¬¡æ¯”è¾ƒ**ã€‚\n2. å¦‚æœä¸æ˜¯æŒ‰ç…§é»˜è®¤é¡ºåºä¾æ¬¡æ¯”è¾ƒï¼Œåˆ™éœ€è¦è‡ªå®šä¹‰å‡½æ•°é€»è¾‘\n\nä»¥ä¸‹æ˜¯é»˜è®¤çš„ä¾‹å­\n```cpp\nclass Point\n{\npublic:\n    Point(int x, int y) : _x{ x }, _y{ y }\n    {\n    }\n    std::strong_ordering operator <=> (Point const & pt) const = default;\n    \nprivate:\n    int _x;\n    int _y;\n};\nint main()\n{\n    Point pt{1, 2}, pt2{1, 2};\n    if(pt == pt2)\n    {\n        std::cout << \"equal\" << std::endl;\n    }\n}\n```\n## å®é™…çš„ä¾‹å­ï¼šè§ã€ŠCpp_stringä»¿å†™ã€‹","categories":["Cpp"]},{"title":"Cpp_å¼‚å¸¸æœºåˆ¶","url":"/Cpp/Cpp_å¼‚å¸¸æœºåˆ¶/","content":"# `C++`å¼‚å¸¸å¤„ç†æœºåˆ¶\n\n```cpp\nint bar(int a, int b)\n{\n    return a / b;\n}\nint main()\n{\n    int result = 0;\n    result = bar(10, 0);\n    return 0;\n}\n```\nä»¥ä¸Šä¼šäº§ç”Ÿé™¤0å¼‚å¸¸ï¼š\n![](../../images/Cpp_20240410_å¼‚å¸¸æœºåˆ¶/image-20240716044013847.png)\n\nå¦‚æœæ˜¯Releaseçš„ç¨‹åºï¼Œä¸å¤„ç†å¼‚å¸¸ï¼Œå°±ä¼šé€ æˆé—ªé€€ã€‚\n## throw\nthrowå¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ï¼Œä¸€ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªå€¼ã€‚\nåªè¦throwäº†ï¼Œé‚£ä¹ˆç¨‹åºå°±ä¼šä¸­æ–­ã€è·³è½¬ï¼Œå¦‚æœæœ‰try-catchå°±èµ°catchï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿›è¡Œä¸‹ä¸€æ¡è¯­å¥ã€‚\n```cpp\nint bar(int a, int b)\n{\n    if(b == 0)\n    {\n        throw e;\n    }\n}\n```\n## try-catch\nç±»ä¼¼äºswitch-caseï¼Œä½†æ˜¯caseå€¼ä¸é™åˆ¶ç±»å‹ã€‚å¯ä»¥é€šè¿‡`catch(...)`ä»£è¡¨defaultã€‚\n```cpp\nint main()\n{\n    int result = 0;\n    try\n    {\n        result = bar(10, 0);\n    }\n    catch (const double& e)\n    {\n        std::cout << e << std::endl;\n    }\n    catch (const int& e)\n    {\n        std::cout << e << std::endl;\n    }\n    catch (...)\n    {\n        std::cout << \"Unhandled Exception!\" << std::endl;\n    }\n    std::cout << result << std::endl;\n    return 0;\n}\n```\n# noexceptå…³é”®å­—\n\nå£°æ˜è¯¥å‡½æ•°ä¸æŠ›å‡ºå¼‚å¸¸ã€‚\n```cpp\nint bar(int a, int b) noexcept;\n```\nä½†æ˜¯ä¸€æ—¦å®é™…è¿è¡Œæ—¶æŠ›å‡ºäº†å¼‚å¸¸ï¼Œç¨‹åºå°±ä¼šç›´æ¥æŒ‚æ‰ã€‚\n![](../../images/Cpp_20240410_å¼‚å¸¸æœºåˆ¶/image-20240716045247884.png)\n# å¼‚å¸¸åº“`<stdexcept>`\n\nè¯¥åº“ä¸‹ï¼Œæœ‰ä¸¤ç±»errorsï¼š\n1. Logic Errors\n2. Runtime Errors\n![](../../images/Cpp_20240410_å¼‚å¸¸æœºåˆ¶/image-20240716045704242.png)\n## `std::exception`\nåŸºæœ¬ä¸Šæ‰€æœ‰çš„exceptionç±»éƒ½ç»§æ‰¿äº`std::exception`ã€‚å¦‚`out_of_range`ï¼š\n![](../../images/Cpp_20240410_å¼‚å¸¸æœºåˆ¶/image-20240716045815882.png)\n`std::exception`å¯ä»¥æ‹¿å­—ç¬¦ä¸²æ„é€ ï¼Œç„¶åç”¨`what()`æ–¹æ³•æ‰“å°è¿™ä¸ªå¼‚å¸¸ä¿¡æ¯ã€‚\n```cpp\n#include <exception>\nstd::exception bar_exception{ \"bar exception!\" };\n\nint bar(int a, int b)\n{\n    if(b == 0)\n        throw bar_exception;\n    return a / b;\n}\n```\n\n```cpp\n#include <exception>\nint main()\n{\n    int result = 0;\n    try\n    {\n        result = bar(10, 0);\n    }\n    catch (std::exception const& e)\n    {\n        std::cout << e.what() << std::endl;\n    }\n    catch (...)\n    {\n        std::cout << \"Unhandled Exception!\" << std::endl;\n    }\n    std::cout << result << std::endl;\n    return 0;\n}\n```\n## è‡ªå®šä¹‰exception\n```cpp\nclass BarException : public std::exception\n{\npublic:\n    char const* what() const override\n    {\n        return \"bar exception!\";\n    }\n};\n```\n\n```cpp\n#include <exception>\nint bar(int a, int b)\n{\n    if(b == 0)\n        throw BarException{};\n    return a / b;\n}\nint main()\n{\n    int result = 0;\n    try\n    {\n        result = bar(10, 0);\n    }\n    catch (std::exception const& e) // å¯ä»¥æ¥å—bar_exception\n    {\n        std::cout << e.what() << std::endl;\n    }\n    catch (...)\n    {\n        std::cout << \"Unhandled Exception!\" << std::endl;\n    }\n    std::cout << result << std::endl;\n    return 0;\n}\n```\n# å®ä¾‹\nå¼‚å¸¸ç”¨åœ¨ä»€ä¹ˆåœ°æ–¹å‘¢ï¼Ÿä¸èƒ½é€šè¿‡å‡½æ•°çš„è¿”å›å€¼æ¥åˆ¤æ–­æ­£ç¡®ä¸å¦çš„æ—¶å€™ã€‚å¦‚ä¸‹ï¼š\n## stringçš„atï¼ˆæŠ›å¼‚å¸¸ï¼Œæ£€æŸ¥è¾¹ç•Œï¼‰\n\næœ‰ä¸¤ç§ï¼š\n1. atä½ç½®çš„å­—ç¬¦ä¸èƒ½ä¿®æ”¹\n2. atä½ç½®çš„å­—ç¬¦å¯ä»¥ä¿®æ”¹\n\n1. å¯èƒ½ä¼šout of rangeã€‚\n2. è¿”å›çš„éƒ½æ˜¯å¼•ç”¨ç±»å‹ï¼Œå¼•ç”¨ä¸èƒ½ä¸ºç©ºï¼Œæ‰€ä»¥ä¸èƒ½é€šè¿‡è¿”å›å€¼æ˜¯å¦ä¸ºç©ºæ¥åˆ¤æ–­æ˜¯å¦é”™è¯¯äº†ï¼Œæ‰€ä»¥å¾—ç”¨å¼‚å¸¸æœºåˆ¶ã€‚\n```cpp\n#include<exception>\nclass OutOfRange : public std::exception\n{\npublic:\n    OutOfRange() : std::exception{\"MyString: out of range!\"}\n    {\n    }\n}\nclass MyString\n{\npublic:\n    char & at(const size_t off)\n    {\n        size_t len = strlen(_str);\n        if(off > strlen - 1)\n            throw OutOfRange{};\n        return _str[off];\n    }\n    char const & at(const size_t off) const\n    {\n        size_t len = strlen(_str);\n        if(off > strlen - 1)\n            throw OutOfRange{};\n        return _str[off];\n    }\n}\nint main()\n{\n    if(str)\n    {\n        try\n        {\n            std::cout << str.at(11) << std::endl;\n        }\n        catch (const std::exception &e)\n        {\n            std::cout << e.what() << std::endl;\n        }\n    }\n}\n```\n## stringçš„`[]`ï¼ˆä¸æŠ›å¼‚å¸¸ï¼Œä¸æ£€æŸ¥è¾¹ç•Œï¼‰\n\nä¸atå‡½æ•°çš„ä¸åŒåœ¨äºï¼Œ`[]`æ˜¯ä¸æŠ›å‡ºå¼‚å¸¸çš„ï¼Œå› æ­¤ä¸æ£€æŸ¥è¾¹ç•Œã€‚å¦‚æœè¶Šç•Œï¼Œåˆ™è¡Œä¸ºæœªå®šä¹‰ã€‚\n```cpp\nclass MyString\n{\npublic:\n    char& operator[](const size_t off) noexcept\n    {\n        return _str[off];\n    }\n    char const & operator[](const size_t off) const noexcept\n    {\n        return _str[off];\n    }\n}\n```\n# æ€»ç»“\n\n1. å¼‚å¸¸ç”¨åœ¨ä»€ä¹ˆåœ°æ–¹å‘¢ï¼Ÿä¸èƒ½é€šè¿‡å‡½æ•°çš„è¿”å›å€¼æ¥åˆ¤æ–­æ­£ç¡®ä¸å¦çš„æ—¶å€™ã€‚æ¯”å¦‚è¿”å›å€¼æ˜¯å¼•ç”¨ï¼Œå¼•ç”¨æ²¡æœ‰ç©ºå€¼ã€‚\n2. å¦‚æœå‡½æ•°åœ¨å†…éƒ¨è‡ªå·±å¤„ç†äº†å¼‚å¸¸ï¼Œå³ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆæœ€å¥½å£°æ˜ä¸ºnoexceptã€‚ä»£è¡¨åˆ«äººè°ƒç”¨æ­¤å‡½æ•°æ—¶ï¼Œåˆ«äººå°±ä¸ç”¨try-catchäº†ã€‚","categories":["Cpp"]},{"title":"åˆ·é¢˜_æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²","url":"/ç®—æ³•/åˆ·é¢˜_æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²/","content":"# å†…å®¹\n\nåŸé¢˜åå«åšï¼š[æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²](https://leetcode.cn/problems/longest-substring-without-repeating-characters/description/ \"https://leetcode.cn/problems/longest-substring-without-repeating-characters/description/\")ã€‚ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ‰¾å‡ºå…¶ä¸­ä¸å«æœ‰é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²çš„é•¿åº¦ã€‚\n```\nç¤ºä¾‹ 1:\nè¾“å…¥: s = \"abcabcbb\"\nè¾“å‡º: 3 \nè§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ \"abc\"ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚\n\nç¤ºä¾‹ 2:\nè¾“å…¥: s = \"bbbbb\"\nè¾“å‡º: 1\nè§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ \"b\"ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 1ã€‚\n\nç¤ºä¾‹ 3:\nè¾“å…¥: s = \"pwwkew\"\nè¾“å‡º: 3\nè§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ \"wke\"ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚\n     è¯·æ³¨æ„ï¼Œä½ çš„ç­”æ¡ˆå¿…é¡»æ˜¯ å­ä¸² çš„é•¿åº¦ï¼Œ\"pwke\" æ˜¯ä¸€ä¸ªå­åºåˆ—ï¼Œä¸æ˜¯å­ä¸²ã€‚\n\næç¤ºï¼š\n0 <= s.length <= 5 * 10^4\ns ç”±è‹±æ–‡å­—æ¯ã€æ•°å­—ã€ç¬¦å·å’Œç©ºæ ¼ç»„æˆ\n```\n# åˆ†æ\n\nè¦åˆ¤æ–­\n# ä»£ç \n## è§£1_æš´åŠ›+å“ˆå¸Œ\n\n```cpp\nclass Solution {\npublic:\n    int lengthOfLongestSubstring(std::string s) {\n        typedef std::unordered_map<char, int> CharIntMap;\n        CharIntMap charIntMap;\n        int s_len = s.length();\n        int longestLen = 0;\n        for (int i = 0; i < s_len; ++i)\n        {\n            for (int j = i; j < s_len; ++j)\n            {\n                if (charIntMap[s[j]] == 1)\n                {\n                    if (j - i > longestLen)\n                    {\n                        longestLen = j - i;\n                    }\n                    charIntMap.clear();\n                    break;\n                }\n                else\n                {\n                    charIntMap[s[j]] = 1;\n                    if (j - i > longestLen)\n                    {\n                        longestLen = j - i;\n                        // this is wrong. should update longest\n                    }\n                }\n            }\n        }\n        return longestLen;\n    }\n};\n```\n### å‘\n\nå¦‚æœå­—ç¬¦ä¸²æœ¬æ¥å°±æ²¡æœ‰é‡å¤çš„ï¼Œæˆ‘ä»¬åº”è¯¥ä¹Ÿåœ¨elseä¸­ç»™longestè®¡æ•°ï¼Œä½†è¦æ³¨æ„ï¼Œåº”è¯¥æ˜¯`j - i + 1`ä¸longestæ¯”è¾ƒã€‚\n```cpp\n                else\n                {\n                    charIntMap[s[j]] = 1;\n                    if (j - i + 1 > longestLen)\n                    {\n                        ++longestLen;\n                    }\n                }\n```\n\n### æ•ˆæœ\n\nè™½ç„¶æ­£ç¡®ã€‚ä½†æ˜¯æ•ˆç‡ä¸æ˜¯ç‰¹åˆ«é«˜ï¼Œç»“æœå¦‚ä¸‹ï¼š\n```\n987/987 cases passed (654 ms)\nYour runtime beats 5 % of cpp submissions\nYour memory usage beats 5.02 % of cpp submissions (148.9 MB)\n```\n\n### ä¼˜åŒ–_åˆ©ç”¨å“ˆå¸Œè®°å½•çš„å·²å‡ºç°è¿‡çš„å­—ç¬¦ä½ç½®ï¼ŒåŠ é€Ÿæ»‘åŠ¨\n\n```cpp\nclass Solution {\npublic:\n    int lengthOfLongestSubstring(std::string s) {\n        typedef std::unordered_map<char, int> CharIntMap;\n        CharIntMap charIntMap;\n        int s_len = s.length();\n        int longestLen = 0;\n        for (int i = 0; i < s_len; ++i)\n        {\n            int j = i;\n            if (charIntMap[s[j]] == 1)\n            {\n                if (j - i > longestLen)\n                {\n                    longestLen = j - i;\n                }\n                charIntMap.clear();\n                break;\n            }\n            else\n            {\n                charIntMap[s[j]] = 1;\n                if (j - i > longestLen)\n                {\n                    longestLen = j - i;\n                    // this is wrong. should update longest\n                }\n            }\n        }\n        return longestLen;\n    }\n};\n```\n\n## è§£2_å“ˆå¸Œè®°å½•å·²å‡ºç°è¿‡çš„å­—ç¬¦ä½ç½®ï¼ŒåŠ é€Ÿæ»‘åŠ¨\n\nMapè¡¨ä¸­çš„valueåº”è¯¥å­˜charçš„æ ‡è®°\n```cpp\nclass Solution {\npublic:\n    int lengthOfLongestSubstring(std::string s) {\n        typedef std::unordered_map<char, int> CharIntMap;\n        CharIntMap charIntMap;\n        int s_len = s.length();\n        int longestLen = 0;\n        for (int i = 0; i < s_len; ++i)\n        {\n            for (int j = i; j < s_len; ++j)\n            {\n                if (charIntMap[s[j]] == 1)\n                {\n                    if (j - i > longestLen)\n                    {\n                        longestLen = j - i;\n                    }\n                    charIntMap.clear();\n                    break;\n                }\n                else\n                {\n                    charIntMap[s[j]] = 1;\n                    if (j - i > longestLen)\n                    {\n                        longestLen = j - i;\n                        // this is wrong. should update longest\n                    }\n                }\n            }\n        }\n        return longestLen;\n    }\n};\n```\n# å¿ƒå¾—\n\nè¿™ä¸ªé¢˜ç›®å±äº\n\n# æ€»ç»“\n\n1. ","categories":["ç®—æ³•","åˆ·é¢˜"]},{"title":"åˆ·é¢˜_åè½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯","url":"/ç®—æ³•/åˆ·é¢˜_åè½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯/","content":"# å†…å®¹\n\nåŸé¢˜åå«åšï¼š[åè½¬å­—ç¬¦ä¸²ä¸­çš„å•è¯](https://leetcode.cn/problems/reverse-words-in-a-string/description/ \"https://leetcode.cn/problems/reverse-words-in-a-string/description/\")ã€‚ä¸æ˜¯æŠŠæ¯ä¸ªå­—ç¬¦å…¨éƒ¨åè½¬ï¼Œè€Œæ˜¯æŒ‰è¯ä¸ºæ•´ä½“åè½¬ã€‚\n```\nè¾“å…¥ï¼šs = \"the sky is blue\"\nè¾“å‡ºï¼š\"blue is sky the\"\n\nè¾“å…¥ï¼šs = \"  hello world  \"\nè¾“å‡ºï¼š\"world hello\"\nè§£é‡Šï¼šåè½¬åçš„å­—ç¬¦ä¸²ä¸­ä¸èƒ½å­˜åœ¨å‰å¯¼ç©ºæ ¼å’Œå°¾éšç©ºæ ¼ã€‚\n\nè¾“å…¥ï¼šs = \"a good   example\"\nè¾“å‡ºï¼š\"example good a\"\nè§£é‡Šï¼šå¦‚æœä¸¤ä¸ªå•è¯é—´æœ‰å¤šä½™çš„ç©ºæ ¼ï¼Œåè½¬åçš„å­—ç¬¦ä¸²éœ€è¦å°†å•è¯é—´çš„ç©ºæ ¼å‡å°‘åˆ°ä»…æœ‰ä¸€ä¸ªã€‚\n\næç¤ºï¼š\n1. 1 <= s.length <= 104\n2. s åŒ…å«è‹±æ–‡å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç©ºæ ¼ ' '\n3. s ä¸­ è‡³å°‘å­˜åœ¨ä¸€ä¸ª å•è¯\n\nè¿›é˜¶ï¼šå¦‚æœå­—ç¬¦ä¸²åœ¨ä½ ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€ä¸­æ˜¯ä¸€ç§å¯å˜æ•°æ®ç±»å‹ï¼Œè¯·å°è¯•ä½¿ç”¨ O(1) é¢å¤–ç©ºé—´å¤æ‚åº¦çš„ åŸåœ° è§£æ³•ã€‚\n```\n# åˆ†æ\n\n1. é¦–å…ˆæŠŠå¤šä½™çš„ç©ºæ ¼åˆ é™¤\n2. æŠŠæ•´ä½“è¿›è¡Œé€†åº\n3. æŒ‰ç©ºæ ¼åˆ’åˆ†ï¼Œé€†åºæ¯ä¸ªå•è¯\n# ä»£ç \n\n## è§£1_\n\n```cpp\n#include<iostream>\nclass Solution {\npublic:\n    // è¿”å›ç»“å°¾ä¸‹æ ‡\n    int moveLeft(std::string& s, int idx, int wordLen, int step)\n    {\n        // if(s == nullptr || idx < 0) return;\n        if (step != 0)\n        {\n            int i = 0;\n            while (i < wordLen)\n            {\n                s[idx - step + i] = s[idx + i];\n                ++i;\n            }\n        }\n        return idx - step + wordLen - 1;\n    }\n    std::string removeExtraSpace(std::string& s)\n    {\n        int cur = s.length() - 1;\n        while (s[cur] != '\\0' && s[cur] == ' ')\n        {\n            --cur;\n        }\n        int lastSpace = cur;\n        int validEndIdx = cur;\n        while (cur >= 0)\n        {\n            while (cur >= 0 && s[cur] != '\\0' && s[cur] != ' ')\n            {\n                --cur;\n            }\n            lastSpace = cur;\n            ++cur;\n            while (lastSpace >= 0 && s[lastSpace] != '\\0' && s[lastSpace] == ' ')\n            {\n                --lastSpace;\n            }\n            if (lastSpace != -1)\n                ++lastSpace;\n            validEndIdx = moveLeft(s, cur, validEndIdx - cur + 1, cur - lastSpace - 1);\n            cur = lastSpace - 1;\n        }\n        s.resize(validEndIdx + 1);\n        return s;\n    }\n    void reverseWord(char* cp, int len)\n    {\n        for (int i = 0; i < len / 2; ++i)\n        {\n            char tmp = cp[i];\n            cp[i] = cp[len - 1 - i];\n            cp[len - 1 - i] = tmp;\n        }\n\n    }\n    std::string reverseWords(std::string s)\n    {\n        removeExtraSpace(s);\n        reverseWord((char *)s.c_str(), s.length());\n        const char* ccp = s.c_str();\n        char* cp = (char *)ccp;\n        int len = 0;\n        // è¿™é‡Œå¦‚æœç›´æ¥ç»™ccp+1ä¼šè¶Šè¿‡\\0å¯¼è‡´è¶Šç•Œï¼ŒleetcodeæŠ¥é”™heap-buffer-overflowé€šä¸è¿‡\n        while (*ccp != '\\0')\n        {\n            while (*ccp != '\\0' && *ccp != ' ')\n            {\n                ++len;\n                ++ccp;\n            }\n            reverseWord(cp, len);\n            len = 0;\n            if(*ccp != '\\0')\n            {\n                ++ccp;\n                cp = (char*)ccp;\n            }\n        }\n        return s;\n    }\n};\nint main()\n{\n    Solution sol = Solution();\n    std::string str(\"  345  1 2 89    \");\n    std::string res = sol.reverseWords(str);\n    std::cout << res << std::endl;\n}\n```\næµ‹è¯•ç»“æœï¼š`345 1 2 89`\nCè¯­è¨€ç‰ˆ\n```c\nint moveLeft(char* s, int idx, int wordLen, int step)\n{\n    if (step != 0)\n    {\n        int i = 0;\n        while (i < wordLen)\n        {\n            s[idx - step + i] = s[idx + i];\n            ++i;\n        }\n    }\n    return idx - step + wordLen - 1;\n}\nint removeExtraSpace(char* s, int len)\n{\n    if (len <= 0) return 0;\n    int cur = len - 1;\n    while (cur >= 0 && s[cur] != '\\0' && s[cur] == ' ')\n    {\n        --cur;\n    }\n    int lastSpace = cur;\n    int validEndIdx = cur;\n    while (cur >= 0)\n    {\n        while (cur >= 0 && s[cur] != '\\0' && s[cur] != ' ')\n        {\n            --cur;\n        }\n        lastSpace = cur;\n        ++cur;\n        while (lastSpace >= 0 && s[lastSpace] != '\\0' && s[lastSpace] == ' ')\n        {\n            --lastSpace;\n        }\n        if (lastSpace != -1)\n            ++lastSpace;\n        validEndIdx = moveLeft(s, cur, validEndIdx - cur + 1, cur - lastSpace - 1);\n        cur = lastSpace - 1;\n    }\n    s[validEndIdx + 1] = '\\0';\n    return validEndIdx + 1;\n}\nvoid reverseWord(char* cp, int len)\n{\n    for (int i = 0; i < len / 2; ++i)\n    {\n        char tmp = cp[i];\n        cp[i] = cp[len - 1 - i];\n        cp[len - 1 - i] = tmp;\n    }\n}\nchar* reverseWords(char* s)\n{\n    const char* ccp = s;\n    int slen = 0;\n    while (*ccp++ != '\\0')\n    {\n        ++slen;\n    }\n    int newlen = removeExtraSpace(s, slen);\n    reverseWord(s, newlen);\n    ccp = s;\n    char* cp = s;\n    int len = 0;\n    while (*ccp != '\\0')\n    {\n\n        while (*ccp != '\\0' && *ccp != ' ')\n        {\n            ++len;\n            ++ccp;\n        }\n        reverseWord(cp, len);\n        len = 0;\n        // è¿™é‡Œå¦‚æœç›´æ¥ç»™ccp+1ä¼šè¶Šè¿‡\\0å¯¼è‡´è¶Šç•Œï¼ŒleetcodeæŠ¥é”™heap-buffer-overflowé€šä¸è¿‡\n        if (*ccp != '\\0')\n        {\n            ++ccp;   // æœ€åä¸€æ¬¡ä¼šè¶Šç•Œ\n            cp = (char*)ccp;\n        }\n    }\n    return s;\n}\n```\n### ä¼˜åŒ–æ¶ˆé™¤ç©ºæ ¼å‡½æ•°\n\n```c\n// è¿”å›æ–°ä¸²é•¿åº¦\nint removeExtraSpace(char* s, int len)\n{\n    int i = 0;\n    int cur = 0;\n    while (i < len)\n    {\n        while (i < len && s[i] == ' ')\n        {\n            ++i;\n        }\n        // s[i] != ' ', = char\n        while (i < len && s[i] != ' ')\n        {\n            s[cur++] = s[i++];\n        }\n        if (i >= len)\n        {\n            if (i > cur)\n            {\n                s[cur] = '\\0';\n            }\n            // ä¸€å®šè¦break\n            break;\n        }\n        // s[i] == ' ' || s[i] == '\\0'\n        s[cur++] = s[i++];\n    }\n    // å‘\n    if (s[cur - 1] == ' ')\n    {\n        --cur;\n        s[cur] = '\\0';\n    }\n    return cur;\n}\n```\n### å‘\n\n# å¿ƒå¾—\n\nè¿™ä¸ªé¢˜ç›®å±äº\n\n# æ€»ç»“\n\n1. ","categories":["ç®—æ³•","åˆ·é¢˜"]},{"title":"åˆ·é¢˜_å¦ä¸€ä¸ªæ ‘çš„å­æ ‘","url":"/ç®—æ³•/åˆ·é¢˜_å¦ä¸€ä¸ªæ ‘çš„å­æ ‘/","content":"# å†…å®¹\n\nåŸé¢˜åå«åšï¼š[å¦ä¸€ä¸ªæ ‘çš„å­æ ‘](https://leetcode.cn/problems/subtree-of-another-tree/description/)ã€‚æ€»çš„æ¥è¯´å°±æ˜¯æ‰¾ä¸€ä¸ªæ ‘T1ä¸­æœ‰æ²¡æœ‰å’ŒT2å®Œå…¨ç»“æ„ä¸€æ ·çš„å­æ ‘ã€‚\n# åˆ†æ\n\nè¦åˆ¤æ–­æ ‘ä¸­æ˜¯å¦åŒ…å«æŸä¸ªå…·ä½“çš„ç»“æ„ï¼Œå¯ä»¥ä½¿ç”¨éå†åºåˆ—æ¥åˆ¤æ–­ã€‚\nä½†æ˜¯è¦æ³¨æ„ï¼šç¤ºä¾‹2å°±æ˜¯ä¸€ç§å®¹æ˜“å¿½ç•¥çš„æƒ…å†µã€‚å¦‚æœä»…ä»…ä¾é éç©ºèŠ‚ç‚¹çš„éå†åºåˆ—å»åˆ¤æ–­ï¼Œåˆ™å°±ä¼šå¿½ç•¥æ‰T1ä¸­çš„æ¯”T2å¤šä½™çš„éƒ¨åˆ†ï¼Œæ¯”å¦‚ï¼šT1çš„å‰åºéå†ä¸º`341205`ï¼ŒT2çš„å‰åºéå†ä¸º`412`ã€‚è™½ç„¶T1åŒ…å«T2çš„åºåˆ—`412`ï¼Œä½†æ˜¯T1çš„`2`èŠ‚ç‚¹ä¸‹é¢è¿˜æŒ‚ç€å·¦å­©å­`0`ã€‚è¿™å°±å¯¼è‡´å®é™…ä¸ŠT1ä¸­è¿™ä¸ªå­æ ‘å’ŒT2ç»“æ„ä¸å®Œå…¨ä¸€æ ·ï¼\næ‰€ä»¥ï¼Œè¿˜è¦ç»™å¶å­èŠ‚ç‚¹çš„ç©ºå­©å­åŠ æ ‡è®°ç¬¦ï¼Œæ¯”å¦‚`#`ä»£è¡¨ç©ºã€‚\nå¦‚æ­¤ï¼ŒT1çš„å‰åºéå†ä¸º`341##20#5##`ï¼ŒT2çš„å‰åºéå†ä¸º`41##2##`ï¼Œè¿™æ ·å°±èƒ½åŒºåˆ†äº†ã€‚\né™¤æ­¤ä¹‹å¤–ï¼šè¿˜è¦åœ¨æ¯æ¬¡å†™valå€¼ï¼ˆåŒ…æ‹¬ç©ºï¼‰ä¹‹åé™„åŠ ä¸ª`!`æ ‡è®°ï¼Œå› ä¸º`122334`æœ‰å¯èƒ½æ˜¯`12,23,34`ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯`1,223,34`ã€‚è¿™å°±é€ æˆäº†æ­§ä¹‰ã€‚\nè¡¥å……ä¸€å¥ï¼Œå‰åºã€ä¸­åºã€ååºé€‰æ‹©å“ªä¸€ä¸ªéƒ½å¯ä»¥ï¼Œåªè¦ç»™å‡ºæœ‰æ•ˆèŠ‚ç‚¹å€¼ã€ç©ºèŠ‚ç‚¹ä»¥åŠè®¿é—®èŠ‚ç‚¹ç»“æŸæ ‡å¿—ï¼Œå°±èƒ½å®Œå…¨ç¡®å®šä¸€ä¸ªæ ‘çš„ç»“æ„ã€‚\n![](../../images/åˆ·é¢˜_å¦ä¸€ä¸ªæ ‘çš„å­æ ‘/image-20240331050434535.png)\n![](../../images/åˆ·é¢˜_å¦ä¸€ä¸ªæ ‘çš„å­æ ‘/image-20240331050449419.png)\n# ä»£ç \n\n## è§£1_ä¸¤æ ‘åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œåˆ¤æ–­æ˜¯å¦åŒ…å«å­ä¸²\n\nJavaä¸­å­—ç¬¦ä¸²ä¸æ–­çš„æ‹¼æ¥ä¸€å®šè¦ç”¨StringBuilderã€‚å¯ä»¥æé«˜æ•ˆç‡ã€‚\n```java\npackage å­—ç¬¦ä¸²;\nimport common.TreeNode;\npublic class _572_å¦ä¸€ä¸ªæ ‘çš„å­æ ‘ {\n    public boolean isSubtree(TreeNode root, TreeNode subRoot) {\n         \n    }\n    // æ­¤å¤„ç”¨ååºéå†åºåˆ—æ¥è¡¨è¾¾æ ‘çš„ç»“æ„ã€‚æ¢æˆå‰åºã€ä¸­åºä¹Ÿå¯ä»¥ã€‚\n    private String postSerialize(TreeNode root)\n    {\n        StringBuilder sb = postSerialize(root, sb);\n        return sb.toString();\n    }\n    private void postSerialize(TreeNode root, StringBuilder sb)\n    {\n        if(root != null)\n        {\n            postSerialize(root.left, sb);\n            postSerialize(root.right, sb);\n            sb.append(root.val);\n        }\n        else\n        {\n            sb.append(\"#\");\n        }\n        sb.append(\"!\");\n        return;\n    }\n}\n\n```\næµ‹è¯•\n```java\nimport common.TreeNode;\nimport common.printer.BinaryTreeInfo;\nimport common.printer.BinaryTrees;\n\n    public static void main(String[] args)\n    {\n        TreeNode root = new TreeNode(3);\n        root.right = new TreeNode(5);\n        root.left = new TreeNode(4);\n        TreeNode curRoot = root.left;\n        curRoot.left = new TreeNode(1);\n        curRoot.right = new TreeNode(2);\n        BinaryTrees.println(new BinaryTreeInfo() {\n            @Override\n            public Object root() {\n                return root;\n            }\n            @Override\n            public Object left(Object node) {\n                return ((TreeNode)node).left;\n            }\n            @Override\n            public Object right(Object node) {\n                return ((TreeNode)node).right;\n            }\n            public Object string(Object node) {\n                return ((TreeNode)node).val;\n            }\n        });\n        System.out.println(postSerialize(root));\n    }\n```\nç»“æœï¼š\n```\n  â”Œâ”€3â”€â”\n  â”‚   â”‚\nâ”Œâ”€4â”€â” 5\nâ”‚   â”‚\n1   2\n#!#!1!#!#!2!4!#!#!5!3!\n```\nisSubtreeå‡½æ•°ï¼šå¯¹æ¯”ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ¤æ–­T1å­—ç¬¦ä¸²æ˜¯å¦åŒ…å«T2å­—ç¬¦ä¸²ã€‚å¯ä»¥è°ƒç”¨javaçš„åº“å‡½æ•°containsã€‚ä½†æ®è¯´containsç”¨çš„ä¸æ˜¯KMPï¼Œå› æ­¤æ•ˆç‡å¯èƒ½è¾ƒä½ï¼Œæœ€å¥½è°ƒç”¨KMPç®—æ³•ã€‚\n```java\n    public boolean isSubtree(TreeNode root, TreeNode subRoot) {\n        if(root == null || subRoot == null) return false;\n        return postSerialize(root).contains(postSerialize(subRoot));\n    }\n```\n### å‘\n\nè™½ç„¶å‰åºã€ä¸­åºã€ååºéƒ½å¯ä»¥ï¼Œä½†æ˜¯ä»¥ä¸Šå…ˆåºéå†è½¬åŒ–çš„å­—ç¬¦ä¸²æœ‰ç¼ºé™·ï¼Œä»ä¸èƒ½é€šè¿‡T1å…ˆåºå­—ç¬¦ä¸²åŒ…å«T2å…ˆåºå­—ç¬¦ä¸²å°±æ–­å®šT2ä¸€å®šæ˜¯T1çš„å­æ ‘ã€‚æ¯”å¦‚ï¼šT1æ˜¯33å•èŠ‚ç‚¹ï¼Œé‚£ä¹ˆT1çš„å­—ç¬¦ä¸²ä¸º`33!#!#!`ï¼ŒT2ä¸º3å•èŠ‚ç‚¹ï¼Œé‚£ä¹ˆT2çš„å­—ç¬¦ä¸²ä¸º`3!#!#!`ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶T1å­—ç¬¦ä¸²åŒ…å«T2å­—ç¬¦ä¸²ï¼Œä½†æ˜¯T2çš„3èŠ‚ç‚¹å‹æ ¹å°±è·ŸT1çš„33èŠ‚ç‚¹æ²¡å…³ç³»ï¼\näºæ˜¯ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå‰åºéå†æ˜¯å­˜åœ¨ç¼ºé™·çš„ï¼Œè¿™ä¸ªç¼ºé™·åªå‡ºç°åœ¨é¡¶ç‚¹æ‰“å°çš„æ­§ä¹‰ã€‚\nä¸­åºã€ååºéƒ½æ²¡æœ‰è¿™æ ·çš„é—®é¢˜ã€‚æ‰€ä»¥ï¼Œå¦‚æœæ˜¯ç”¨å‰åºéå†æ¥åºåˆ—åŒ–æ ‘ï¼Œé‚£ä¹ˆè¦åœ¨æ‰“å°çš„æœ€å¼€å§‹å†å¦åŠ ä¸€ä¸ªæ ‡å¿—å¦‚`?`ï¼Œå¦‚æ­¤ï¼šT1å­—ç¬¦ä¸²å˜ä¸º`?33!#!#!`ï¼ŒT2å­—ç¬¦ä¸²å˜ä¸º`?3!#!#!`ï¼Œç”±æ­¤å°±å¯ä»¥åˆ¤åˆ«å‡ºï¼ŒT1å­—ç¬¦ä¸²ä¸åŒ…å«T2å­—ç¬¦ä¸²äº†ï¼Œå› æ­¤å¯ä»¥æ­£ç¡®åˆ¤æ–­å‡ºï¼ŒT2ä¸æ˜¯T1çš„å­æ ‘ã€‚\n# å¿ƒå¾—\n\nè¿™ä¸ªé¢˜ç›®å±äºäºŒå‰æ ‘çš„ç»“æ„æ–¹é¢çš„é—®é¢˜ï¼Œç±»ä¼¼è¿™ç±»é¢˜å‹ï¼Œè€ƒè™‘åˆ©ç”¨äºŒå‰æ ‘åºåˆ—çš„ç‰¹ç‚¹å’Œæ„ä¹‰ï¼Œè½¬åŒ–ä¸ºå­—ç¬¦ä¸²åºåˆ—ï¼Œç›¸å½“äºæŠŠä¸å¥½è§£å†³çš„æ ‘å½¢ç»“æ„é™ç»´æ‰“å‡»æˆäº†ä¸€ç»´ç»“æ„ã€‚æ‰€ä»¥ï¼Œæœ¬è´¨ä¸Šï¼Œè¿™ä¸ªé¢˜ç›®è€ƒå¯Ÿçš„æ˜¯äºŒå‰æ ‘çš„åºåˆ—åŒ–ã€ååºåˆ—åŒ–ã€‚\n\n# æ€»ç»“\n\n1. éç©ºèŠ‚ç‚¹ï¼š`å€¼!`ï¼Œç©ºèŠ‚ç‚¹ï¼š`#!`\n2. ç©ºèŠ‚ç‚¹ä¹Ÿå¿…é¡»åºåˆ—åŒ–ï¼Œæ‰èƒ½å®Œæ•´åœ°è¡¨è¾¾å”¯ä¸€çš„ä¸€æ£µæ ‘ï¼Œè€Œä¸”å‰åºã€ä¸­åºã€ååºéå†éƒ½å¯ä»¥ç¡®å®šä¸€æ£µæ ‘ï¼Œä½†æ˜¯å±‚åºéå†ä¸å¯ä»¥ã€‚","categories":["ç®—æ³•","åˆ·é¢˜"]},{"title":"åˆ·é¢˜_æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯","url":"/ç®—æ³•/åˆ·é¢˜_æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯/","content":"# å†…å®¹\n\nåŸé¢˜åå«åšï¼š[æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯](https://leetcode.cn/problems/valid-anagram/description/ \"https://leetcode.cn/problems/valid-anagram/description/\")ã€‚ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸²Â `s`Â å’ŒÂ `t`Â ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥åˆ¤æ–­Â `t`Â æ˜¯å¦æ˜¯Â `s`Â çš„å­—æ¯å¼‚ä½è¯ã€‚ï¼ˆåªåŒ…å«å°å†™å­—æ¯ï¼‰\n\nä¸¾ä¾‹ï¼š\n```\nè¾“å…¥: s = \"anagram\", t = \"nagaram\"\nè¾“å‡º: true\n\nè¾“å…¥: s = \"rat\", t = \"car\"\nè¾“å‡º: false\n\næç¤º:\n\n1. 1 <= s.length, t.length <= 5 * 104\n2. s å’Œ t ä»…åŒ…å«å°å†™å­—æ¯\n \n\nè¿›é˜¶: å¦‚æœè¾“å…¥å­—ç¬¦ä¸²åŒ…å« unicode å­—ç¬¦æ€ä¹ˆåŠï¼Ÿä½ èƒ½å¦è°ƒæ•´ä½ çš„è§£æ³•æ¥åº”å¯¹è¿™ç§æƒ…å†µï¼Ÿ\n```\nå³æ¯ç§å­—æ¯çš„æ•°ç›®ä¸€æ ·ï¼Œä½†æ˜¯é¡ºåºä¸ä¸€å®šã€‚\n# åˆ†æ\n\nè‹¥æ˜¯æœ‰é™ä¸ªå­—æ¯æ¯”å¦‚26ä¸ªè‹±æ–‡å­—æ¯ï¼Œåˆ™å¯ä»¥å»ºç«‹ä¸€ä¸ªä¸€ç»´æ•°ç»„Sï¼Œéå†sï¼Œè®¡æ¯ç§ç¥–æ¯æ•°ã€‚ç„¶åå†å»ºç«‹ä¸€ä¸ªä¸€ç»´æ•°ç»„Tï¼Œéå†tï¼Œè®¡æ•°ã€‚æœ€ååˆ¤æ–­Så’ŒTçš„å†…å®¹æ˜¯å¦ä¸€æ ·ã€‚\n# ä»£ç \n\n## è§£1_\n\n```cpp\nclass Solution {\npublic:\n    bool isAnagram(string s, string t) {\n        std::vector<int> vis = std::vector<int>(26);\n        std::vector<int> vit = std::vector<int>(26);\n        const char * cp = s.c_str();\n        while(*cp != '\\0')\n        {\n            ++vis[*cp++ - 'a'];\n        }\n        cp = t.c_str();\n        while(*cp != '\\0')\n        {\n            ++vit[*cp++ - 'a'];\n        }\n        int i = 0;\n        while(i < 26)\n        {\n            if(vis[i] != vit[i++])\n            {\n                return false;\n            }\n        }\n        return true;\n    }\n};\n```\n### ä¼˜åŒ–\n\nå¯ä»¥ä¸ç”¨å»åˆ›å»ºå¦å¤–ä¸€ä¸ªæ•°ç»„ï¼Œè€Œæ˜¯åœ¨éå†tçš„è¿‡ç¨‹ä¸­å»å‡ç¬¬ä¸€ä¸ªæ•°ç»„ä¸­çš„valueï¼Œé‡åˆ°å°äºé›¶çš„æƒ…å†µåˆ™falseã€‚ï¼ˆè¿™å·²ç»è¶³å¤Ÿäº†ï¼Œä¸éœ€è¦å»åˆ¤æ–­ç¬¬ä¸€ä¸ªæ•°ç»„ä¸­æ˜¯å¦å…¨éƒ¨ä¸º0äº†ã€‚å› ä¸ºå‰ç½®æ¡ä»¶å·²ç»é™åˆ¶ä¸¤ä¸²é•¿åº¦ä¸€è‡´ï¼Œå‡å¦‚2å·ä¸²ä¸­å‡ºç°1ä¸²ä¸­ä¸ä¸€æ ·çš„å­—ç¬¦ï¼Œè‚¯å®šä¼šå‡ºç°è´Ÿå€¼ã€‚å¦‚æœ2å·ä¸²çš„å­—ç¬¦ç§ç±»æ²¡æœ‰å¤šå‡ºæ¥çš„ï¼Œè€Œæ•°ç›®å¤šï¼Œæ¯”å¦‚1å·ä¸²carï¼Œ2å·ä¸²raaï¼Œåˆ™açš„å€¼ä¹Ÿä¼šå‡ºç°è´Ÿå€¼ï¼‰\n```cpp\nclass Solution {\npublic:\n    bool isAnagram(string s, string t) {\n        if(s.length() != t.length()) return false;\n        if(s.length() == 0) return false;\n        std::vector<int> vis = std::vector<int>(26);\n        const char * cp = s.c_str();\n        while(*cp != '\\0')\n        {\n            ++vis[*cp++ - 'a'];\n        }\n        cp = t.c_str();\n        while(*cp != '\\0')\n        {\n            if(--vis[*cp++ - 'a'] < 0)\n            {\n                return false;\n            }\n        }\n        return true;\n    }\n};\n```\n### å‘\n\n## è§£2_hashmap\n\n```cpp\n#include<unordered_map>\nclass Solution {\npublic:\n    bool isAnagram(string s, string t) {\n        //using std::hash_map<char, int> = CharIntMap;\n        if(s.length() != t.length()) return false;\n        if(s.length() == 0) return false;\n        typedef std::unordered_map<char, int> CharIntMap;\n        CharIntMap charIntMap_s;\n        const char * cp = s.c_str();\n        while(*cp != '\\0')\n        {\n            ++charIntMap_s[*cp++];\n        }\n        CharIntMap charIntMap_t;\n        cp = t.c_str();\n        while(*cp != '\\0')\n        {\n            ++charIntMap_t[*cp++];\n        }\n        for(auto it = charIntMap_s.begin(); it != charIntMap_s.end(); ++it)\n        {\n            if(charIntMap_t[it->first] != it->second)\n            {\n                return false;\n            }\n        }\n        return true;\n    }\n};\n```\n# å¿ƒå¾—\n\nè¿™ä¸ªé¢˜ç›®å±äº\n\n# æ€»ç»“\n\n1. ","categories":["ç®—æ³•","åˆ·é¢˜"]},{"title":"åˆ·é¢˜_åˆ¤æ–­æ—‹è½¬è¯","url":"/ç®—æ³•/åˆ·é¢˜_åˆ¤æ–­æ—‹è½¬è¯/","content":"# å†…å®¹\n\nåŸé¢˜åå«åšï¼š[å­—ç¬¦ä¸²è½®è½¬](https://leetcode.cn/problems/string-rotation-lcci/description/)ã€‚ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸²`s1`å’Œ`s2`ï¼Œè¯·ç¼–å†™ä»£ç æ£€æŸ¥`s2`æ˜¯å¦ä¸º`s1`æ—‹è½¬è€Œæˆã€‚æ¯”å¦‚ï¼Œwaterbottleæ˜¯erbottlewatæ—‹è½¬åçš„å­—ç¬¦ä¸²ï¼‰\n\nç¤ºä¾‹ï¼šè¾“å…¥`s1 = \"back\", s2 = \"ackb\"`ï¼Œåˆ™è¾“å‡º`True`ï¼›\nè¾“å…¥`s1 = \"aa\", s2 = \"aba\"`ï¼Œåˆ™è¾“å‡º`False`ã€‚\n\n# åˆ†æ\n\næ‹¿wakeä¸¾ä¾‹ï¼Œå®ƒçš„æ—‹è½¬è¯æœ‰4ç§æƒ…å†µï¼š\n```\nSa:wake\nSb:akew\nSc:kewa\nSd:ewak\n```\nå‘ç°ï¼Œå¯ä»¥è®©åŸä¸²é‡å¤ä¸€æ¬¡ï¼Œæˆä¸º`wakewake`ã€‚å‘ç°ï¼Œwakeçš„æ—‹è½¬è¯éƒ½èƒ½åœ¨è¿™ä¸ªé‡å¤ä¸²ä¸­æ‰¾åˆ°å­ä¸²ã€‚\né‚£ä¹ˆï¼Œé—®é¢˜å°±è½¬åŒ–ä¸ºä»åŸä¸²ä¸­åŒ¹é…s2ï¼Œå³åŒ¹é…å­—ç¬¦ä¸²ã€‚\n\n![](../../images/åˆ·é¢˜_åˆ¤æ–­æ—‹è½¬è¯/image-20240328032130071.png)\n![](../../images/åˆ·é¢˜_åˆ¤æ–­æ—‹è½¬è¯/image-20240328032559844.png)\n![](../../images/åˆ·é¢˜_åˆ¤æ–­æ—‹è½¬è¯/image-20240328032621207.png)\n# ä»£ç \n\n## è§£1_è°ƒåº“_è°ƒç”¨Javaåº“å‡½æ•°contains\n\n```java\npackage å­—ç¬¦ä¸²;\n/**\n * https://leetcode.cn/problems/string-rotation-lcci/\n * \n */\npublic class é¢è¯•é¢˜01_09_å­—ç¬¦ä¸²è½®è½¬ {\n    public static boolean isRevolving(String s1, String s2)\n    {\n        if(s1 == null || s2 == null) return false;\n        if(s1.length() != s2.length()) return false;\n        return (s1 + s1).contains(s2);\n    }\n    public static void main(String[] args)\n    {\n        System.out.println(isRevolving(\"wake\", \"ewak\"));\n    }\n}\n```\n\n## è§£2_ç¼–å†™KMP\n\nä¸€èˆ¬æ¥è¯´ï¼Œé¢è¯•æ‰‹æ’•KMPçš„å¯èƒ½æ€§è¿˜æ˜¯æ¯”è¾ƒä½çš„ï¼Œé™¤éé¢è¯•å®˜æ—¶é—´å¾ˆå……è¶³ã€‚\nå¦‚æœæ˜¯ç”¨çš„æä¾›åº“è°ƒç”¨çš„åœ¨çº¿ç¼–è¯‘å¹³å°ï¼Œåˆ™ä¼˜å…ˆè°ƒç”¨åº“å‡½æ•°ï¼šå› ä¸ºæ˜¯javaä»£ç ï¼Œè€Œä¸”containsæœ‰å¯èƒ½æ˜¯æš´åŠ›åŒ¹é…ï¼Œå¯èƒ½æ€§èƒ½æ¯”è¾ƒåº•ä¸‹ï¼Œå…ˆå°è¯•èƒ½ä¸èƒ½ç¬¦åˆç¼–è¯‘å™¨æœ€å°æ—¶é—´éœ€æ±‚ã€‚\nå¦‚æœä¸è®©ç”¨åº“å‡½æ•°ï¼Œæˆ–è€…javaåº“å‡½æ•°ä»£ç æ€§èƒ½ä½ä¸‹ï¼Œåˆ™åªèƒ½æ‰‹æ’•KMPäº†ã€‚\nå¦‚æœå®åœ¨æ²¡æ—¶é—´äº†ï¼Œæˆ–è€…æ‰‹æ’•ä¸å‡ºæ¥ï¼Œåˆ™å¯ä»¥ä¸é¢è¯•å®˜è®²è‡ªå·±éå¸¸ç†è§£KMPçš„æ€è·¯ï¼Œæ¯•ç«Ÿæ€è·¯æ˜¯æœ€é‡è¦çš„ï¼Œä»£ç æ˜¯ç¬¬äºŒä½ã€‚\n\n# å¿ƒå¾—\n\nè¿™ä¸ªé¢˜ç›®ç»™äº†å­—ç¬¦ä¸²ç±»é—®é¢˜ä¸€ä¸ªè§£å†³æ€è·¯ï¼š**åŸä¸²é‡å¤ä¸¤æ¬¡â€”â€”å³åŸä¸²å†æ¬¡æ‹¼æ¥ä¸€ä¸ªåŸä¸²**ï¼Œæœ‰äº›é—®é¢˜å¯èƒ½å°±è¿åˆƒè€Œè§£äº†ã€‚å¤šå»æƒ³æƒ³ï¼Œå°±èƒ½è½¬åŒ–æˆä¸¤ä¸ªæ‹¼æ¥çš„ä¸²ä¸­åŒ¹é…ä¸€ä¸ªå­ä¸²çš„é—®é¢˜ã€‚","categories":["ç®—æ³•","åˆ·é¢˜"]},{"title":"Java_String","url":"/Java/Java_String/","content":"# å­—ç¬¦ä¸²\n\n1. Javaçš„å­—ç¬¦ä¸²æ˜¯åœ¨`java.lang`åŒ…ä¸­ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€å¼•åŒ…ã€‚\n2. Java 8ä¹‹å‰çš„Stringæ˜¯ç”¨charæ•°ç»„å®ç°çš„ã€‚å³`\"abc\"`çš„åº•å±‚å®ç°ä¸º`{'a', 'b', 'c'}`ã€‚\n3. ä»Java 9å¼€å§‹ï¼Œæ”¹ä¸ºä½¿ç”¨byteæ•°ç»„å®ç°ã€‚\n4. å­—ç¬¦ä¸²å­—é¢é‡å®é™…æ˜¯Stringç±»çš„å®ä¾‹ï¼ˆç›¸å½“äºè‡ªåŠ¨ç»™ä½ newäº†ä¸€ä¸ªStringï¼Œå‡è®¾ä¸ºs1ï¼Œä½†æ˜¯å¦‚æœç¬¬äºŒæ¬¡ç”¨è¿™ä¸ªå­—é¢é‡åˆå§‹åŒ–s2çš„è¯ï¼Œå°±ä¸ä¼šé‡æ–°newäº†ï¼Œè€Œæ˜¯ç›´æ¥æŠŠs1çš„å¯¹è±¡å¼•ç”¨ç»™s2ï¼Œè¯¦è§[`==`](#`==`)ï¼‰ã€‚\n5. Stringå¯¹è±¡ä¸€æ—¦åˆ›å»ºå®Œæ¯•ï¼Œè¯¥å¯¹è±¡å†…éƒ¨å…¶ä¸­çš„å­—ç¬¦å†…å®¹ä¸å¯ä»¥ä¿®æ”¹ã€‚\n    1. ä½†æ˜¯Stringå¯¹è±¡æŒ‡é’ˆçš„æŒ‡å‘å¯ä»¥æ›´æ”¹ã€‚\n\n# å†…å­˜ä½ç½®\n```java\npublic class Main\n{\n    public static void main(String[] args)\n    {\n        String s = \"555\";\n        s += \"555\";\n        s = \"666\";\n        test(s);\n        System.out.println(s);\n    }\n    static void test(String str)\n    {\n        //str += \"555\";\n        str = str + \"555\";\n    }\n}\n```\n\nStringå­—ç¬¦ä¸²éƒ½æ˜¯newå‡ºæ¥çš„ï¼Œå› æ­¤éƒ½æ˜¯åœ¨å †ç©ºé—´ä¸­ã€‚\n\n![](../../images/Java_20240328_String/image-20240328165008942.png)\n\n![](../../images/Java_20240328_String/image-20240328165046122.png)\n\n![](../../images/Java_20240328_String/image-20240328165117159.png)\n\n![](../../images/Java_20240328_String/image-20240328165138608.png)\n\n![](../../images/Java_20240328_String/image-20240328165149688.png)\n\n# å­—ç¬¦ä¸²å¸¸é‡æ±  (String Constant Pool, SCP)\n\n1. å­—ç¬¦ä¸²å¸¸é‡æ± ã€‚æ˜¯æŒ‡ï¼šä»Java 7å¼€å§‹ï¼Œå±äºå †ç©ºé—´çš„ä¸€éƒ¨åˆ†ã€‚ï¼ˆä»¥å‰æ˜¯æ”¾åœ¨æ–¹æ³•åŒºä¸­çš„ï¼‰\n2. é‡åˆ°å­—ç¬¦ä¸²å­—é¢é‡æ—¶ï¼Œä¼šå»æŸ¥SCPã€‚\n    1. å¦‚æœSCPä¸­åŒ¹é…åˆ°ä¸è¯¥å­—é¢é‡å†…å®¹ä¸€è‡´çš„å­—ç¬¦ä¸²å¯¹è±¡Aæ—¶ï¼Œåˆ™è¿”å›Aã€‚\n    2. å¦åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡Dï¼ŒåŠ å…¥åˆ°SCPä¸­ï¼Œè¿”å›Dã€‚\n```java\nString s1 = \"xcg\";\nString s2 = \"xcg\";\nSystem.out.println(s1 == s2);\n```\n\n```java\nString s1 = \"xcg\";\nString s2 = new String(\"xcg\");\nString s3 = new String(s1);\nString s4 = new String(s2);\nchar[] cs = {'x', 'c', 'g'};\nString s5 = new String(cs); //ç”¨charæ•°ç»„new String\nString s6 = new String(s5); \nSystem.out.println(s1 == s2);\n```\n\nä¼ å…¥å¸¸é‡å­—ç¬¦ä¸²çš„newåº•å±‚ï¼š\n```java\nnew String(\"xcg\");\n----------------------\npublic String(String original)\n{\n    this.value = original.value;\n    this.hash = original.hash;\n}\n```\n`\"xcg\"`çš„åº•å±‚ç©ºé—´æ˜¯åªæœ‰ä¸€ä»½çš„ï¼Œåœ¨SCPä¸­ã€‚è€Œ`new String(\"xcg\")`æœ¬è´¨ä¸Šåªæ˜¯æ–°åˆ›å»ºäº†ä¸€ä¸ªStringå¯¹è±¡ï¼Œvalueçš„æ‹·è´åªæ˜¯æŠŠæ—§åœ°å€ç»™äº†æ–°Stringä¸­çš„valueæŒ‡é’ˆã€‚å³ä¸¤ä¸ªvalueæ•°ç»„æ˜¯åŒä¸€ä¸ªåœ°å€çš„æ•°ç»„ã€‚è¿™å±äºæµ…æ‹·è´ã€‚\n![](../../images/Java_20240328_String/image-20240328170910662.png)\nå› æ­¤ï¼Œ`s1`åˆ°`s4`åªæ˜¯Stringå¯¹è±¡åœ°å€ä¸åŒï¼Œä½†æ˜¯ï¼Œå†…éƒ¨çš„valueæ•°ç»„æ˜¯åŒä¸€ä¸ªã€‚\n![](../../images/Java_20240328_String/image-20240328171911687.png)\n\nä¼ å…¥å­—ç¬¦æ•°ç»„çš„newåº•å±‚ï¼š\n```java\nchar[] cs = {'x', 'c', 'g'};\nnew String(cs);\n---------------------------------\npublic String(char value[])\n{\n    this.value = Arrays.copyOf(value, value.length);\n}\n---------------------------------\npublic static char[] copyOf(char[] original, int newLength)\n{\n    char[] copy = new char[newLength];\n    System.arraycopy(original, 0, copy, 0,\n                    Math.min(original.length, newLength));\n    return copy;\n}\n```\nå¯ä»¥çœ‹åˆ°ï¼Œç”¨å­—ç¬¦æ•°ç»„å»newä¸€ä¸ªStringçš„è¯ï¼Œåº•å±‚è¦æ·±æ‹·è´ä¸€ä¸ªæ•°ç»„ï¼Œå³äº§ç”Ÿä¸€ä¸ªæ–°æ•°ç»„çš„åœ°å€èµ‹ç»™Stringå¯¹è±¡å†…éƒ¨çš„valueæŒ‡é’ˆã€‚\n![](../../images/Java_20240328_String/image-20240328172027084.png)\n# internæ–¹æ³•\n\n```java\npublic native String intern();\n```\nè¢«nativeå…³é”®å­—ä¿®é¥°ï¼Œä»£è¡¨ä¸æ˜¯ç”¨Javaç¼–å†™çš„ï¼Œå¯èƒ½æ˜¯Cè¯­è¨€ã€‚è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚\n\nä½œç”¨æ˜¯ï¼šå¦‚æœSCPä¸­å­˜åœ¨ä¸€ä¸ªä¸Bå†…å®¹ä¸€æ ·çš„å­—ç¬¦ä¸²å¯¹è±¡Aï¼Œåˆ™è¿”å›Aï¼›**å¦åˆ™ï¼Œå°†BåŠ å…¥åˆ°SCPä¸­**ï¼Œè¿”å›Bã€‚\n\nçœ‹ä¸‹é¢çš„ä»£ç ï¼š\n```java\npublic class static void main(String[] args)\n{\n    int a = 1, b = 2, c = 3;\n    String s1 = String.format(\"%d%d%d\", a, b, c);\n    String s2 = String.format(\"%d%d%d\", a, b, c);\n    System.out.println(s1 == s2);  // false\n    \n    String s3 = s1.intern();\n    String s4 = s2.intern();\n    System.out.println(s1 == s3);  // true     - intern ç¬¬ä¸€æ¬¡è°ƒç”¨\n    System.out.println(s1 == s4);  // true ??? - intern ç¬¬äºŒæ¬¡è°ƒç”¨\n    \n    String s5 = \"123\";\n    System.out.println(s1 == s5);  // true\n    \n}\n```\ns1ä¸ç­‰äºs2ï¼Œå› ä¸ºé€šè¿‡formatç”Ÿæˆçš„å­—ç¬¦ä¸²ä¸æ˜¯å­—ç¬¦ä¸²å¸¸é‡ï¼å› æ­¤ï¼Œs1å’Œs2æŒ‡å‘çš„å­—ç¬¦æ•°ç»„ä¸æ˜¯å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å˜é‡ã€‚\n\nå»SCPè§‚å¯Ÿæœ‰æ²¡æœ‰é‡å¤ä¸²çš„æƒ…å†µ**ä»…é™äº**æ¶‰åŠåˆ°å­—ç¬¦ä¸²å­—é¢é‡çš„æƒ…å†µï¼Œæˆ–è€…ç”¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ç›´æ¥æ„é€ æ–°çš„ã€‚æˆ–è€…ï¼šç›´æ¥è°ƒç”¨Stringç±»çš„internæ–¹æ³•ï¼Œè¿™æ˜¯æ‰‹åŠ¨å»è§‚å¯ŸSCPæœ‰æ— é‡å¤ä¸²ã€‚ä½†æ˜¯è¦è®°ä½äº†ï¼Œinternæœ‰ä¸€ä¸ªéšå½¢æ“ä½œï¼šâ€**å¦åˆ™ï¼Œå°†BåŠ å…¥åˆ°SCPä¸­**â€œï¼\nå› æ­¤ï¼Œåœ¨s1è°ƒç”¨äº†internä¹‹åï¼Œs1çš„å†…å®¹`\"123\"`å°±æ”¾å…¥äº†å¸¸é‡æ± ä¸­ã€‚ä¸€æ—¦internè¢«è°ƒç”¨è¿‡ä¸€æ¬¡ï¼Œé‚£ä¹ˆä¹‹ås2çš„internè¿”å›çš„å°±æ˜¯å¸¸é‡æ± ä¸­çš„åœ°å€äº†ã€‚\nå› æ­¤ï¼Œ`s3==s4`ã€‚\nè‡³äºs5ï¼Œå› ä¸ºæ˜¯ç”¨å­—ç¬¦ä¸²å­—é¢é‡åˆå§‹åŒ–çš„ï¼Œæ‰€ä»¥éšå½¢è°ƒç”¨äº†internï¼Œæ‰€ä»¥å®é™…æŒ‡å‘çš„ä¹Ÿæ˜¯s1çš„valueåœ°å€ã€‚\næˆ‘ä»¬å¯ä»¥æ¨æµ‹å‡ºï¼Œä¸¤ä¸ªå­—ç¬¦ä¸²ç›´æ¥`==`åˆ¤æ–­æ˜¯å»åˆ¤æ–­å†…éƒ¨æˆå‘˜çš„valueåœ°å€æ˜¯å¦ä¸€æ ·ã€‚å³åˆ¤æ–­æ˜¯å¦æ˜¯æµ…æ‹·è´ã€‚\n# å­—ç¬¦ä¸²å¸¸ç”¨æ–¹æ³•\n\n## å»é™¤å·¦å³ç©ºæ ¼ - trim\n\nå»é™¤é¦–å·¦ã€å°¾å³çš„ç©ºæ ¼\n```java\n\" 123  456  \".trim() // -> 123  456\n```\n## contains\n\næ˜¯å¦åŒ…å«ç›®æ ‡ä¸²ï¼ˆå­—ç¬¦ä¸²åŒ¹é…ï¼‰\n```java\n\"123456\".contains(\"34\")\n```\n## split\n\nå°†å­—ç¬¦ä¸²æŒ‰ç…§åˆ†éš”ç¬¦åˆ†å‰²ä¸ºæ•°ç»„\n```java\n\"1_2_3_4\".split(\"_\") // -> [1, 2, 3, 4]\n```\n\n## compareTo\n\næŒ¨ä¸ªæ¯”è¾ƒå¤§å°\n```java\n\"abc\".compareTo(\"adc\")\n```\n\n## equals\n\næŸ¥çœ‹å†…å®¹æ˜¯å¦ç›¸ç­‰\n```java\nString s1 = \"abc\";\nString s2 = new String(\"abc\");\ns1.equals(s2);\n```\n## `==`\n\nå¦‚æœç›´æ¥ç”¨`s1 == s2`å»æ¯”è¾ƒå­—ç¬¦ä¸²ï¼Œåˆ™å˜æˆäº†å¼•ç”¨ä¹‹é—´çš„æ¯”è¾ƒã€‚åˆ™æ˜¯å»æ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚\n```java\npublic class Test\n{\n    public static void main(String[] args)\n    {\n        String s1 = \"123\";\n        String s2 = \"123\";\n        String s3 = new String(\"123\");\n        System.out.println(s1 == s2); // true\n        System.out.println(s1 == s3); // false\n    }\n}\n```\n\n## æˆªå–å­ä¸² - subString\n\næˆªå–`beginIndex`åŠä¹‹åçš„ï¼Œ`endIndex`ä¹‹å‰çš„ä¸²ã€‚å·¦é—­å³å¼€ã€‚\n```java\nint beginIndex = 2;\nint endIndex = 5;\n\"xcg123go\".subString(beginIndex);           // g123go\n\"xcg123go\".subString(beginIndex, endIndex); // g12\n```\n## æ›¿æ¢ç›®æ ‡ä¸² - replace\n\n```java\n\"xcg123go\".replace(\"123\", \"Never\"); // xcgNervergo\n```\n# StringBuilder\n\nä¸Stringç›¸æ¯”ï¼Œå…±åŒç‚¹æ˜¯éƒ½å®ç°äº†CharSequenceæ¥å£ã€‚\n\nåœ¨è¿›è¡Œå­—ç¬¦ä¸²é¢‘ç¹çš„æ”¹åŠ¨æ—¶ï¼ˆæ‹¼æ¥ã€æ›¿æ¢ç­‰ï¼‰ï¼Œä½¿ç”¨StringBuilderã€‚\n\n```java\nStringBuilder sb = new StringBuilder();\nsb.append(\"123\");\nsb.append(\"456\");\n```\n## å¸¸ç”¨æ–¹æ³•\n\nappend, insert, delete, replace, reverse\n\n## appendåŸç†\n\nStringBuilderçš„åº•å±‚æ˜¯ä¹Ÿæ˜¯ä¸€ä¸ª`value = new char[n];`çš„å­—ç¬¦æ•°ç»„ã€‚\nä¸Stringçš„ä¸åŒæ˜¯ï¼Œè¿™ä¸ªå­—ç¬¦æ•°ç»„æœ‰é¢„ç•™ç©ºé—´ï¼Œè®°å½•lengthæ¥æ ‡è®°æ•°ç»„ä¸­æœ‰æ•ˆç»“å°¾ã€‚\nå½“ç©ºé—´æ»¡æ—¶ï¼ŒåŠ¨æ€æ‰©å®¹ã€‚","categories":["Java"]},{"title":"åˆ·é¢˜_åè½¬é“¾è¡¨","url":"/ç®—æ³•/åˆ·é¢˜_åè½¬é“¾è¡¨/","content":"# å†…å®¹\n\nåè½¬é“¾è¡¨ã€‚\n\né’ˆå¯¹çš„æ˜¯ä¸å¸¦å¤´èŠ‚ç‚¹çš„å•é“¾è¡¨ã€‚\n# ä¸‰æŒ‡é’ˆæ³•\n\nç»™ä½ å•é“¾è¡¨çš„å¤´èŠ‚ç‚¹ `head` ï¼Œè¯·ä½ åè½¬é“¾è¡¨ï¼Œå¹¶è¿”å›åè½¬åçš„é“¾è¡¨ã€‚\n\n```cpp\n/**\n * Definition for singly-linked list.\n * struct ListNode {\n *     int val;\n *     ListNode *next;\n *     ListNode() : val(0), next(nullptr) {}\n *     ListNode(int x) : val(x), next(nullptr) {}\n *     ListNode(int x, ListNode *next) : val(x), next(next) {}\n * };\n */\nclass Solution {\npublic:\n    ListNode* reverseList(ListNode* head) {\n        if (head == nullptr || head->next == nullptr) return head;\n        ListNode * cur = head;\n        ListNode * prev = nullptr;\n        while (cur != nullptr)\n        {\n            ListNode * tmp = cur->next;\n            cur->next = prev;\n            prev = cur;\n            cur = tmp;\n        }\n        return prev;\n    }\n};\n```\n\n# å¤´æ’æ³•ï¼ˆåŒæŒ‡é’ˆæ³•ï¼‰\néœ€è¦æ„å»ºä¸€ä¸ªè™šæ‹Ÿå¤´èŠ‚ç‚¹ã€‚\n```cpp\nclass Solution {\npublic:\n    ListNode* reverseList(ListNode* head) {\n        if (head == nullptr || head->next == nullptr) return head;\n        ListNode * headNode = new ListNode(0, head);\n        ListNode * cur = head;\n        ListNode * tmp = nullptr;\n        headNode->next = nullptr;\n        while (cur != nullptr)\n        {\n            tmp = cur;\n            cur = cur->next;\n            tmp->next = headNode->next;\n            headNode->next = tmp;\n        }\n        head = headNode->next;\n        delete headNode;\n        return head;\n    }\n};\n```\n\n","categories":["ç®—æ³•","åˆ·é¢˜"]},{"title":"Cpp_å¼•ç”¨","url":"/Cpp/Cpp_å¼•ç”¨/","content":"# å¼•ç”¨\n\nå¼•ç”¨çš„ä½œç”¨æ˜¯ç»™å˜é‡èµ·ä¸€ä¸ªåˆ«åã€‚\n# å¼•ç”¨çš„åœ°å€å¸¸æ€§\n\n```cpp\nint main()\n{\n    int a2 = 9;\n    int a = 10;\n    int& b = a;\n    b = a2;     // a\n}\n```\n\nåœ¨å®šä¹‰å¼•ç”¨æ—¶ï¼Œå¿…é¡»æŒ‡å®šä¸€ä¸ªè¢«å¼•ç”¨è€…ï¼ˆåœ°å€ï¼‰ã€‚ä¸€æ—¦å®šä¹‰æˆåŠŸï¼Œåœ¨å…¶ç”Ÿå‘½æœŸä¸­ï¼Œå°±ä¸å¯æ›´æ¢åœ°å€äº†ã€‚è¿™æ˜¯å¼•ç”¨çš„åœ°å€å¸¸æ€§ã€‚\n\nç›¸å½“äº`int & b = a`åœ¨æœ¬è´¨ä¸Šæ˜¯`int * const b = &a`ã€‚\n\nä½†æ˜¯è¿™ä¸å¼•ç”¨çš„è¯¥åœ°å€ä¸Šçš„å†…å­˜æ•°æ®çš„å¸¸æ€§ä¸å†²çªã€‚å¦‚æœéœ€è¦èµ‹äºˆæ•°æ®å¸¸æ€§ï¼Œåˆ™ä»éœ€ä¿®é¥°constï¼š`int const & b = a`ã€‚æ­¤æ—¶ï¼Œå°±æ— æ³•é€šè¿‡å¼•ç”¨bå»ä¿®æ”¹å†…å­˜ä¸Šçš„æ•°æ®å€¼äº†ã€‚","categories":["Cpp"]},{"title":"Cpp_é¢å‘å¯¹è±¡","url":"/Cpp/Cpp_é¢å‘å¯¹è±¡/","content":"# å¯¹è±¡æ˜¯ä»€ä¹ˆ\n\nå¯¹ç°å®äº‹ç‰©çš„æŠ½è±¡ã€‚\n\né¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹å¾ï¼šå°è£…ã€ç»§æ‰¿ã€å¤šæ€ã€‚ï¼ˆæœ‰çš„è¿˜ä¼šåŠ ä¸€ä¸ªâ€œæŠ½è±¡â€ï¼‰\n\né¢å‘å¯¹è±¡ç¼–ç¨‹ï¼šOriented Object Programming\n# å°è£…\n\nå…·ä½“åœ°ï¼ŒCppçš„å¯¹è±¡æ˜¯åŸºäºCç»“æ„ä½“å®ç°çš„ã€‚\n\næŠŠå‡½æ•°å’Œå˜é‡å°è£…åˆ°ä¸€èµ·ï¼Œè¿™å°±å«é¢å‘å¯¹è±¡ç¼–ç¨‹ã€‚\n\nå› æ­¤ï¼Œé¢å‘å¯¹è±¡çš„ç¬¬ä¸€ä¸ªç‰¹æ€§å°±æ˜¯å°è£…æ€§ã€‚\n\nå°è£…æ€§å°±åœ¨äºï¼Œä¸èƒ½ç›´æ¥è®¿é—®å¯¹è±¡çš„å˜é‡ã€‚è¿™æ ·çš„å¥½å¤„å°±æ˜¯ï¼Œè§£è€¦åˆã€‚å³ä½¿æ¢äº†å¯¹è±¡ï¼Œè™½ç„¶å†…å®¹çš„ç»†èŠ‚å˜äº†ï¼Œä½†æ˜¯å¯¹å¤–çš„æ–¹æ³•éƒ½æ˜¯ç»Ÿä¸€çš„ã€‚\n## æ§åˆ¶è®¿é—®æƒé™\né‚£ä¹ˆï¼Œå¦‚ä½•æ§åˆ¶è®¿é—®æƒé™ï¼Ÿå°±å¼•å…¥äº†è®¿é—®åŸŸæ§åˆ¶ç¬¦privateã€public\n```cpp\nstruct Person\n{\nprivate:\n    int m_age;\npublic:\n    int get_age(void) const\n    {\n        return m_age;\n    }\n    void set_age(int age)\n    {\n        m_age = age;\n    }\n};\nint main()\n{\n    Person person;\n    person.set_age(90);\n    std::cout << person.get_age() << std::endl;\n}\n```\nç›®å‰ï¼Œç»™å˜é‡åŠ äº†privateæ§åˆ¶ï¼Œé€ æˆæ— æ³•åœ¨ç±»å¤–è¿›è¡Œåˆå§‹åŒ–ï¼Œé‚£ä¹ˆå°±éœ€è¦å¼•å…¥å…¬æœ‰çš„æ„é€ å‡½æ•°ã€‚\n```cpp\nstruct Test\n{\npublic:\n    Person(int age)\n    {\n        m_age = age;\n    }\n};\n```\n## classå’Œstructçš„åŒºåˆ«\n1. structé»˜è®¤æ˜¯public\n2. classé»˜è®¤æ˜¯private\n# å¤šæ€\n\nåªæœ‰æŒ‡é’ˆå’Œå¼•ç”¨æ‰èƒ½äº§ç”Ÿå¤šæ€ã€‚\n## overload - é‡è½½ - é™æ€å¤šæ€\noverloadï¼ˆé‡è½½ï¼‰æ˜¯é™æ€å¤šæ€æ€§ã€‚\n\næŒ‰ç…§**åå­—ç›¸åŒ**ï¼Œ**å‚æ•°ç±»å‹**æˆ–**å‚æ•°ä¸ªæ•°**çš„ä¸åŒæ¥å†³å®šèƒ½å¦é‡è½½ã€‚è¿”å›å€¼ç±»å‹ä¸å‚ä¸å†³ç­–ã€‚ï¼ˆä¸»è¦æ˜¯åå­—è¦ç›¸åŒï¼Œä¸€åå¤šç”¨ï¼Œå› æ­¤å«åšé‡zhongè½½ï¼Œå³è¶…è´Ÿè·ï¼‰\n```cpp\n{\n    int val(void) const\n    {\n        return _val;\n    }\n    void val(int val)\n    {\n        _val = val;\n    }\n    void val(double val)\n    {\n        _val = val - 1;\n    }\n}\n```\n### åˆ©ç”¨é™å¤šæ€å†™ç°ä»£é£æ ¼çš„getã€set\n```cpp\nclass Person\n{\nprivate:\n    int m_age;\npublic:\n    int age(void) const\n    {\n        return m_age;\n    }\n    void age(int age)\n    {\n        m_age = age;\n    }\n};\n```\n### æ„é€ å‡½æ•°çš„é‡è½½\nå¦‚æœä¸æä¾›è‡ªå®šä¹‰æ„é€ å‡½æ•°ï¼Œç³»ç»Ÿä¼šæä¾›é»˜è®¤çš„æ— å‚æ•°ã€ç©ºå®šä¹‰çš„æ„é€ å‡½æ•°ã€‚\n\nææ„å‡½æ•°ä¸æ”¯æŒé‡è½½ã€‚\n```cpp\nclass Test\n{\npublic:\n    Test(void) : _val{7}\n    {\n        std::cout << \"Test()\" << std::endl;\n    }\n    Test(int val) : _val{ val }\n    {\n        std::cout << \"Test(int val)\" << std::endl;\n    }\n};\n```\n#### PODç±»å‹çš„æ„é€ \nå¦‚æœç±»å‹ä¸­æ‰€æœ‰çš„æˆå‘˜éƒ½æ˜¯publicçš„ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å‹å°±å«åšPODç±»å‹ï¼Œå…¨ç§°Plain Old Dataã€‚\n>åœ¨C++ä¸­ï¼ŒPODï¼ˆPlain Old Dataï¼‰ç±»å‹æŒ‡çš„æ˜¯ä¸€ç§ä¼ ç»Ÿçš„æ•°æ®ç»“æ„ï¼Œå®ƒçš„è¡Œä¸ºå’Œå¸ƒå±€ç±»ä¼¼äºCè¯­è¨€ä¸­çš„ç»“æ„ä½“æˆ–åŸºæœ¬æ•°æ®ç±»å‹ã€‚PODç±»å‹è¢«è®¤ä¸ºæ˜¯â€œoldâ€çš„ä¸»è¦åŸå› æ˜¯å®ƒä»¬ä»£è¡¨äº†æ—©æœŸCå’ŒC++ç¼–ç¨‹ä¸­å¸¸è§çš„ç®€å•æ•°æ®ç»“æ„ï¼Œè€Œç°ä»£C++å¼•å…¥äº†æ›´å¤šå¤æ‚å’Œå¼ºå¤§çš„ç‰¹æ€§ï¼Œä½¿PODç±»å‹æ˜¾å¾—ç›¸å¯¹åŸå§‹å’Œè¿‡æ—¶ã€‚\n\nè¿™ç§ç±»å‹åœ¨æ²¡æœ‰å®šä¹‰æ„é€ å‡½æ•°æ—¶ï¼Œå¯ä»¥ç›´æ¥ç”¨`{ 1, 2, 3 }`è¿™ç§å½¢å¼è¿›è¡Œåˆå§‹åŒ–ã€‚\n```cpp\nclass Test\n{\npublic:\n    int _val;\n    int _val2;\n    int _val3;\n};\nint main()\n{\n    Test test{ 1, 2, 3 };\n    \n}\n```\n### é»˜è®¤å€¼\né»˜è®¤å€¼çš„é‡è½½è¦æ³¨æ„ä¸èƒ½å‡ºç°äºŒä¹‰æ€§ã€‚\næ¯”å¦‚å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°çš„é»˜è®¤å€¼å…¨ç»™äº†ï¼Œä½†æ˜¯å’Œæ— å‚æ•°çš„å‡½æ•°è°ƒç”¨å†²çªäº†ã€‚\né»˜è®¤å€¼åªèƒ½ä»å³å¾€å·¦è¿ç»­ä¾æ¬¡è®¾ç½®ã€‚\n```cpp\nclass Test\n{\npublic:\n    Test(void) : _val{7}\n    {\n        std::cout << \"Test()\" << std::endl;\n    }\n    Test(int val, int val2 = 12) : _val{ val2 }\n    {\n        std::cout << \"Test(int val, int val2)\" << std::endl;\n    }\n};\nint main()\n{\n    // (10, 12)\n    Test test{ 10 };\n    // (10, 11)\n    Test test{ 10, 11};\n}\n```\n### NULLå’Œnullptrç”¨äºé‡è½½\n```cpp\nclass Test\n{\npublic:\n    void show(int val)\n    {\n        std::cout << \"show(int)\" << std::endl;\n    }\n    void show(int * val)\n    {\n        std::cout << \"show(int*)\" << std::endl;\n    }\n};\nint main()\n{\n    int * c_ptr      = NULL;\n    int * cpp_ptr    = nullptr;\n    Test test;\n    test.show(c_ptr);// èµ°int*\n    test.show(NULL); // èµ°int\n}\n```\nå‘ç°ï¼Œå¦‚æœå‡½æ•°å‚æ•°ä¼ å…¥NULLï¼Œåˆ™cppè®¤ä¸ºæ˜¯æ•´å‹ã€‚\nå› ä¸ºCppä¸‹NULLæ˜¯æ•´æ•°0çš„å®å®šä¹‰ï¼š\n```cpp\n#ifndef NULL\n    #ifdef __cplusplus\n        #define NULL 0\n    #else\n        #define NULL ((void *)0)\n    #endif\n#endif\n```\nCppä¸­nullptræ˜¯C++11å¼•å…¥çš„å…³é”®å­—ï¼Œä¸“é—¨ç”¨äºè¡¨ç¤ºç©ºæŒ‡é’ˆã€‚ç±»å‹æ˜¯`std::nullptr_t`ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸“é—¨çš„ç±»å‹ï¼Œå¯ä»¥éšå¼è½¬æ¢ä¸ºä»»ä½•æŒ‡é’ˆç±»å‹ã€‚\nnullptrè§£å†³äº†NULLçš„ç±»å‹é—®é¢˜ï¼Œæ›´åŠ æ˜ç¡®å’Œå®‰å…¨ã€‚\n## override - é‡å†™\n\n1. è¦é‡å†™ï¼ŒåŸºç±»æˆå‘˜æ–¹æ³•å°±è¦åŠ virtualå…³é”®å­—ã€‚\n2. æ­¤åå­ç±»çš„virtualå¯ä»¥çœç•¥ã€‚\n3. é‡å†™å‡½æ•°å¿…é¡»**å‡½æ•°ç­¾åå®Œå…¨ä¸€è‡´**ã€‚åŒ…æ‹¬è¿”å›å€¼ç±»å‹ã€‚\n4. å­ç±»å¦‚æœè¦é‡å†™æ–¹æ³•ï¼Œåœ¨`C++11`ä¹‹åæœ€å¥½åŠ ä¸Šoverrideå…³é”®å­—ï¼Œè¿™æ ·å¯ä»¥å¸®åŠ©æ£€æŸ¥æ–¹æ³•åã€å‚æ•°åˆ—è¡¨æ˜¯å¦ä¸€è‡´ã€‚\n### æ¥å£\n\næ¥å£å°±æ˜¯å®šä¹‰äº†ä¸€å¥—è§„èŒƒï¼Œä½†æ˜¯æ²¡æœ‰å…·ä½“å®ç°ã€‚\n```cpp\nclass IVal\n{\npublic:\n    virtual int val(void) = 0;\n};\n```\nå¦‚ä¸Šï¼Œçº¯è™šå‡½æ•°ï¼Œå³æ˜¯ä¸€ä¸ª`C++`çš„æ¥å£ã€‚åªæœ‰è™šå‡½æ•°æ‰æœ‰è¿™ç§`= 0`çš„å†™æ³•ï¼Œæ™®é€šæˆå‘˜å‡½æ•°æ²¡æœ‰ã€‚\nå¦‚æœä¸€ä¸ªç±»ä¸­æœ‰ä¸€ä¸ªçº¯è™šå‡½æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å°±æ˜¯æŠ½è±¡ç±»ã€‚\n### è™šå‡½æ•°è¡¨\n\nvfptrè™šå‡½æ•°è¡¨æŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€ä¸ªè™šå‡½æ•°è¡¨ï¼Œè¿™ä¸ªè¡¨æ˜¯ä¸€ç»´å‡½æ•°æŒ‡é’ˆæ•°ç»„ã€‚è™šå‡½æ•°è¡¨æŒ‡é’ˆä½äºåŸºç±»å¯¹è±¡çš„å‰4æˆ–8ä¸ªå­—èŠ‚ã€‚\nè™šå‡½æ•°è¡¨å­˜æ”¾äºå¸¸é‡åŒºæˆ–é™æ€å­˜å‚¨åŒºï¼ŒC++å§”å‘˜ä¼šæœªè§„å®šï¼Œç¼–è¯‘å™¨å‚å•†è‡ªè¡Œå†³å®šã€‚\n#### åŠ¨æ€è”ç¼–\nè™šå‡½æ•°è¡¨çš„å†…å®¹ç”±newçš„å®é™…å¯¹è±¡ç±»å‹å†³å®šï¼Œå’Œå£°æ˜çš„ç±»å‹æ— å…³ã€‚\nè¿™å°±å«åš**åŠ¨æ€è”ç¼–**ã€‚\n### è™šçš„ææ„å‡½æ•°\n\nå¦‚æœä¸ç»™ææ„å‡½æ•°åŠ è™šçš„è¯ï¼š\n```cpp\nclass A\n{\npublic:\nÂ  Â  void func() { std::cout << \"call A::func\" << std::endl; }\nÂ  Â  ~A() { std::cout << \"~A()\" << std::endl; }\nprivate:\nÂ  Â  int ma;\n};\nclass B : public A\n{\npublic:\nÂ  Â  void func() { std::cout << \"call B::func\" << std::endl; }\nÂ  Â  ~B() { std::cout << \"~B()\" << std::endl; }\nprivate:\nÂ  Â  int mb;\n};\n\nint main()\n{\nÂ  Â  A* a = new B();\nÂ  Â  delete a;\n}\n```\nè¾“å‡ºï¼š`~A()`ï¼Œå­ç±»éƒ¨åˆ†å†…å­˜æ³„æ¼ã€‚\n\nè€Œå¦‚æœæˆ‘ä»¬åœ¨åŸºç±»çš„ææ„å‡½æ•°åŠ è™šäº†çš„è¯ï¼ŒAè°ƒç”¨ææ„å‡½æ•°æ—¶ï¼ŒæŸ¥è¡¨ï¼Œåˆ™é¦–å…ˆææ„çš„æ˜¯Bï¼Œè€Œåå†æ¥ææ„Aè‡ªå·±ã€‚è¿™æ ·å°±å®Œç¾åœ°å½¢æˆäº†Aæ´¾ç”ŸBï¼Œè€ŒBè¿”å›Açš„è½®å›ã€å¾ªç¯ã€‚æœ‰ç§é€’å½’çš„ç¾æ„Ÿã€‚\n# ç»§æ‰¿\n\n## hidden - è¦†ç›–ï¼ˆéšè—ï¼‰\néšè—å’Œé‡è½½éƒ½æ˜¯åå­—ç›¸åŒï¼Œä½†éšè—å¼ºè°ƒçš„æ˜¯çˆ¶å­ç±»ä¹‹é—´çš„å…³ç³»ã€‚é‡è½½å¼ºè°ƒçš„æ˜¯åŒä¸€ä½œç”¨åŸŸçš„å…³ç³»ï¼ˆåœ¨ä¸€ä¸ªç±»ä¸­ï¼Œæˆ–åœ¨åŒä¸€ä¸ªå…¨å±€åŒºå®šä¹‰çš„å‡½æ•°ï¼‰ã€‚\n### æˆå‘˜æ–¹æ³•çš„è¦†ç›–\nçˆ¶å­ç±»çš„æˆå‘˜æ–¹æ³•åå­—ç›¸åŒï¼ˆæ— è®ºå‚æ•°åˆ—è¡¨ï¼‰ï¼Œåˆ™çˆ¶ç±»æ–¹æ³•è¢«éšè—ï¼ˆè¦†ç›–ï¼‰ã€‚å½“è°ƒç”¨å­—ç±»å¯¹è±¡çš„è¯¥åå­—æ–¹æ³•æ—¶ï¼Œæ˜¯æ— æ³•æ˜¾å¼è°ƒç”¨çˆ¶ç±»ä¸­è¢«éšè—çš„æ–¹æ³•çš„ã€‚ä½†æ˜¯ä¹Ÿå¯ä»¥åˆ©ç”¨**å®Œå…¨é™å®šç¬¦**è¿›è¡Œæ˜¾å¼è°ƒç”¨ï¼š`child.Test::val()`\n\n```cpp\nclass Test\n{\npublic:\n    Test(void) : _val{ 5 }\n    {\n    \n    }\n    ~Test(void)\n    {\n    \n    }\n    void val(int val)\n    {\n        _val = val;\n    }\nprotected:\n    int _val;\n}\nclass Child : public Test\n{\npublic:\n    Child(void)\n    {\n    }\n    ~Child(void)\n    {\n    }\n    int val(int a, int b) const\n    {\n        return _val;\n    }\n}\nvoid foo(void)\n{\n    Child child;\n    std::out << child.Test::val() << std::endl;\n}\nint main()\n{\n    foo();\n    return 0;\n}\n```\n### æˆå‘˜å˜é‡çš„è¦†ç›–\nå˜é‡ä¹Ÿå¯ä»¥è¦†ç›–ã€‚ç»™Childä¹Ÿå®šä¹‰ä¸€ä¸ª`_val`æˆå‘˜å˜é‡ï¼Œè°ƒç”¨çˆ¶ç±»çš„`val()`æ–¹æ³•å»è§‚å¯Ÿï¼š\n```cpp\nclass Test\n{\npublic:\n    Test(void) : _val{ 5 }\n    {\n    \n    }\n    ~Test(void)\n    {\n    \n    }\n    void val(int val)\n    {\n        _val = val;\n    }\nprotected:\n    int _val;\n}\nclass Child : public Test\n{\npublic:\n    Child(void) : _val{ 22 }\n    {\n    }\n    ~Child(void)\n    {\n    }\n    //int val(int a, int b) const\n    //{\n    //    return _val;\n    //}\nprivate:\n    // hidden\n    int _val;\n}\nvoid foo(void)\n{\n    Child child;\n    std::out << child.val() << std::endl;\n}\nint main()\n{\n    foo();\n    return 0;\n}\n// ç»“æœä¸ºï¼š5  -- è¯´æ˜è°ƒç”¨çˆ¶ç±»çš„val()æ–¹æ³•åï¼Œè¿”å›çš„_valå˜é‡ä¸ºçˆ¶ç±»ä¸­çš„_valè€Œä¸æ˜¯å­ç±»çš„ã€‚\n```\nç°åœ¨è®©å­ç±»è¦†ç›–çˆ¶ç±»çš„`val()`æ–¹æ³•ï¼š\n```cpp\nclass Child : public Test\n{\npublic:\n    Child(void) : _val{ 22 }\n    {\n    }\n    ~Child(void)\n    {\n    }\n    int val(void) const\n    {\n        return _val;\n    }\nprivate:\n    // hidden\n    int _val;\n}\nvoid foo(void)\n{\n    Child child;\n    std::out << child.val() << std::endl;\n}\nint main()\n{\n    foo();\n    return 0;\n}\n// ç»“æœä¸ºï¼š22  -- è¯´æ˜è°ƒç”¨å­ç±»çš„val()æ–¹æ³•åï¼Œè¿”å›çš„_valå˜é‡ä¸ºå­ç±»ä¸­çš„_val\n```\nå¦‚æœæˆ‘ä»¬åˆ é™¤æ‰å­ç±»ä¸­`_val`å˜é‡çš„å®šä¹‰ï¼š\n```cpp\nclass Child : public Test\n{\npublic:\n    Child(void) : // _val{ 22 }\n    {\n    }\n    ~Child(void)\n    {\n    }\n    int val(void) const\n    {\n        return _val;\n    }\nprivate:\n    // int _val;\n}\nvoid foo(void)\n{\n    Child child;\n    std::out << child.val() << std::endl;\n}\nint main()\n{\n    foo();\n    return 0;\n}\n// ç»“æœä¸ºï¼š5  -- è°ƒç”¨å­ç±»çš„val()æ–¹æ³•åï¼Œæ²¡æ‰¾åˆ°å­ç±»ä¸­å­˜åœ¨_valå˜é‡ï¼Œå› æ­¤è¿”å›çš„_valå˜é‡ä¸ºçˆ¶ç±»ä¸­çš„_val\n```\nå› æ­¤ï¼Œæ€»ç»“ä¸‹æ¥å°±æ˜¯ï¼š\n1. å¦‚æœå­ç±»ä¸­å®šä¹‰äº†çˆ¶ç±»ä¸­çš„åŒåå˜é‡ï¼Œè€Œæ²¡æœ‰æ–¹æ³•è¦†ç›–ï¼Œåˆ™åªèƒ½è°ƒç”¨çˆ¶ç±»æ–¹æ³•ï¼Œæ˜¯ä½¿ç”¨çˆ¶ç±»çš„å˜é‡ã€‚\n2. å¦‚æœå­ç±»ä¸­å®šä¹‰äº†çˆ¶ç±»ä¸­çš„åŒåå˜é‡ï¼Œå¹¶ä¸”å®šä¹‰äº†å­ç±»è¦†ç›–æ–¹æ³•ï¼ˆçˆ¶ç±»åŒåæ–¹æ³•ï¼‰ï¼Œåˆ™ä½¿ç”¨å­ç±»çš„å˜é‡ã€‚\n3. å¦‚æœå­ç±»æ²¡æœ‰å®šä¹‰çˆ¶ç±»ä¸­çš„åŒåå˜é‡ï¼Œå¹¶ä¸”æ²¡æœ‰æ–¹æ³•è¦†ç›–ï¼Œåˆ™åªèƒ½è°ƒç”¨çˆ¶ç±»æ–¹æ³•ï¼Œæ˜¯ä½¿ç”¨çˆ¶ç±»çš„å˜é‡ã€‚\n4. å¦‚æœå­ç±»æ²¡æœ‰å®šä¹‰çˆ¶ç±»ä¸­çš„åŒåå˜é‡ï¼Œè€Œå®šä¹‰äº†å­ç±»è¦†ç›–æ–¹æ³•ï¼ˆçˆ¶ç±»åŒåæ–¹æ³•ï¼‰ï¼Œåˆ™ä½¿ç”¨çˆ¶ç±»çš„å˜é‡ã€‚\næ‰€ä»¥ï¼šè¦è®©å­ç±»åŒåæ–¹æ³•ä½¿ç”¨å­ç±»çš„å˜é‡è€Œä¸æ˜¯ä½¿ç”¨çˆ¶ç±»çš„åŒåå˜é‡ï¼Œå¿…é¡»ï¼šæ—¢è¦†ç›–æ–¹æ³•ã€åˆè¦†ç›–å˜é‡ã€‚\n## å¤šé‡ç»§æ‰¿\n\nå¦‚æœChildç»§æ‰¿Baseã€Base2ï¼Œå¦‚ä¸‹ï¼š\n```cpp\n\nclass Base\n{\npublic:\n    Base(void)\n    {\n        std::cout << \"Base(void)\" << std::endl;\n    }\n    virtual ~Base()\n    {\n        std::cout << \"~Base()\" << std::endl;\n    }\n    virtual void show(void) const\n    {\n        std::cout << \"Base::show(void) const\" << std::endl;\n    }\n};\nclass Base2\n{\npublic:\n    Base2(void)\n    {\n        std::cout << \"Base2(void)\" << std::endl;\n    }\n    virtual ~Base2()\n    {\n        std::cout << \"~Base2()\" << std::endl;\n    }\n    virtual void show(void) const\n    {\n        std::cout << \"Base2::show(void) const\" << std::endl;\n    }\n};\nclass Child : public Base, public Base2\n{\npublic:\n    Child(void)\n    {\n        std::cout << \"Child(void)\" << std::endl;\n    }\n    ~Child()\n    {\n        std::cout << \"~Child()\" << std::endl;\n    }\n    void show(void) const\n    {\n        std::cout << \"Child::show(void) const\" << std::endl;\n    }\n    // æ–°è™šæ–¹æ³•\n    virtual void newFunc()\n    {\n    Â  Â  std::cout << \"Child::newFunc()\" << std::endl;\n    }\n}\n};\n// å¯¹åº”ä¸‹è¾¹çš„ç¬¬4æ¡ä¸­çš„å‰åŠå¥ã€‚\nint main()\n{\n    Child * child = new Child;\n    child->show();\n    delete child;\n    child = nullptr;\n}\n// å¯¹åº”ä¸‹è¾¹çš„ç¬¬4æ¡ä¸­çš„ååŠå¥ï¼Œè®¨è®ºå¦å¤–çš„åŸºç±»æ˜¯å¦ä¹Ÿä¼šæ›´æ–°è™šæ–¹æ³•ã€‚\nint main()\n{\n    Base2 * base2 = new Child;\n    base2->show();\n    delete base2;\n    base2 = nullptr;\n}\n// å¯¹åº”ä¸‹è¾¹çš„ç¬¬5æ¡ï¼Œç¼–è¯‘ä¸é€šè¿‡ï¼ŒéªŒè¯äº†ä¸ä¼šåœ¨ç¬¬äºŒä¸ªåŸºç±»çš„è™šè¡¨å¢åŠ è¿™ä¸ªæ´¾ç”Ÿç±»çš„æ–°çš„è™šå‡½æ•°ã€‚æŠ¥é”™ä¿¡æ¯ï¼šnewFunc is not a member of 'Base2'\nint main()\n{\nÂ  Â  Base2* base2 = new Child;\nÂ  Â  base2->newFunc();  // error\nÂ  Â  delete base2;\nÂ  Â  base2 = nullptr;\n}\n```\né‚£ä¹ˆï¼ŒChildå°±æœ‰ä¸¤ä¸ªåŒçº§åŸºç±»ã€‚é€»è¾‘ä¸Šï¼Œç»§æ‰¿å…³ç³»é“¾å˜æˆäº†å¤šç»´çš„ï¼Œä½†æ˜¯ï¼Œç¨‹åºç¼–è¯‘è‚¯å®šæ˜¯è¦é™ç»´ä¸ºä¸€ç»´é¡ºåºæ‰§è¡Œçš„ã€‚å› æ­¤å¿…ç„¶è§„å®šä¸€ä¸ªå…ˆåæ¬¡åºæ‰è¡Œã€‚\n1. æ¯ä¸€æ¡æ”¯é“¾éƒ½å¯ä»¥æœ‰ä¸€ä¸ªè™šè¡¨æŒ‡é’ˆï¼Œå¦‚æœæ”¯é“¾ä¸Šæœ‰ä¸€ä¸ªç±»æœ‰è™šå‡½æ•°çš„è¯ï¼Œé‚£ä¹ˆè™šè¡¨æŒ‡é’ˆå°±åœ¨èµ·å§‹æœ‰è™šå‡½æ•°çš„åŸºç±»å¯¹è±¡çš„å‰4æˆ–8ä¸ªå­—èŠ‚ã€‚\n2. æ„é€ åŸºç±»å¯¹è±¡çš„é¡ºåºæŒ‰ç…§å†’å·`:`åçš„ç±»åé¡ºåºæ¥å®šã€‚\n3. å­ç±»é‡å†™å“ªä¸ªåŸºç±»çš„æ–¹æ³•ï¼Œå°±ç›¸åº”åœ°åœ¨å“ªä¸ªåŸºç±»çš„è™šè¡¨ä¸­æ›´æ–°ã€‚\n4. å¦‚æœå­ç±»é‡å†™çš„æ–¹æ³•å’Œå¤šä¸ªåŸºç±»ä¸­çš„æ–¹æ³•ç›¸åŒï¼Œé»˜è®¤åœ¨ç¬¬ä¸€ä¸ªåŸºç±»ä¸­æ­£å¸¸æ›´æ–°è™šè¡¨ï¼Œè™šè¡¨ä¸­çš„å†…å®¹ç›´æ¥æŒ‡å‘é‡å†™çš„æ–¹æ³•ï¼›åœ¨è¿è¡Œæ•ˆæœä¸Šæ¥çœ‹ï¼Œå¦å¤–çš„åŸºç±»ä¹Ÿä¼šæ›´æ–°è™šæ–¹æ³•è¡¨ï¼Œè¡¨ä¸­è®°å½•çš„å‡½æ•°æŒ‡é’ˆä½¿ç”¨äº†adjustor thunkæŠ€æœ¯ï¼Œé—´æ¥åœ°æŒ‡å‘æ´¾ç”Ÿç±»çš„é‡å†™çš„æ–¹æ³•ã€‚\n    1. å¦‚æœå¤šä¸ªåŸºç±»æœ‰ç›¸åŒçš„è™šå‡½æ•°ï¼Œè€Œå­ç±»æ²¡æœ‰é‡å†™è¯¥æ–¹æ³•ï¼Œé‚£ä¹ˆChildæŒ‡é’ˆæŒ‡å‘Childå¯¹è±¡åœ¨è°ƒç”¨æ­¤æ–¹æ³•åå­—æ—¶ï¼Œå¿…é¡»æŒ‡å‡ºè°ƒç”¨çš„æ˜¯å“ªä¸ªåŸºç±»ã€‚\n5. å¦‚æœåœ¨å­ç±»æ–°å¢ä¸€ä¸ªè™šå‡½æ•°ï¼Œé‚£ä¹ˆï¼Œåªåœ¨ç¬¬ä¸€ä¸ªåŸºç±»çš„è™šè¡¨æ›´æ–°ï¼ˆå³åœ¨å°¾éƒ¨å†™ä¸‹è¿™ä¸ªæ´¾ç”Ÿç±»çš„æ–°å‡½æ•°ï¼‰ã€‚ä¸ä¼šåœ¨ç¬¬äºŒä¸ªåŸºç±»çš„è™šè¡¨å¢åŠ è¿™ä¸ªæ´¾ç”Ÿç±»çš„æ–°çš„è™šå‡½æ•°ã€‚\n### è±å½¢ç»§æ‰¿çš„é—®é¢˜\nDiamond\n\nè±å½¢ç»§æ‰¿çš„æœ€å¤§é—®é¢˜æ˜¯æ•°æ®å†—ä½™ã€äºŒä¹‰æ€§é—®é¢˜ã€‚\næ¯”å¦‚ï¼Œå­¦ç”Ÿã€èŒå·¥ç»§æ‰¿äºäººï¼Œåœ¨èŒå­¦ç”Ÿç»§æ‰¿äºå­¦ç”Ÿã€èŒå·¥ã€‚åœ¨é»˜è®¤çš„æ¨¡å‹ä¸­ï¼Œå­¦ç”Ÿã€èŒå·¥å¯¹è±¡å†…éƒ¨éƒ½ä¼šå­˜åœ¨äººï¼Œé‚£ä¹ˆå¯¹äºåœ¨èŒå­¦ç”Ÿè¿™ä¸ªè§’åº¦ï¼Œä¼šçœ‹åˆ°ä¸¤ä¸ªäººã€‚\n\nè§£å†³æ–¹æ¡ˆä¸€æ˜¯åœ¨ä»Šåçš„è°ƒç”¨ä¸­å‡æ˜¾å¼åŠ ä¸Šå…·ä½“ç±»æ¥æºã€‚\nè§£å†³æ–¹æ¡ˆäºŒæ˜¯ä½¿ç”¨virtualç»§æ‰¿ã€‚è¿™ä¼šä½¿ç»§æ‰¿äººä¸­çš„åŸºç±»å¯¹è±¡â€œæ¶ˆå¤±â€ï¼Œå½’å±äºç¬¬ä¸‰å±‚å­ç±»ï¼ŒåŸæ¥çš„ä½ç½®å˜ä¸ºä¸€ä¸ªè™šåŸºè¡¨æŒ‡é’ˆï¼ˆvbptrï¼Œvirtual base table pointerï¼‰ï¼Œè¯¥è¡¨è®°å½•äº†æœ¬ç±»å¯¹è±¡ä¸è™šåŸºç±»å¯¹è±¡çš„åç§»åœ°å€ã€‚\n\nè¦æ¸…æ¥šåœ°çŸ¥é“ï¼Œä¸ä»…æ˜¯æˆå‘˜å˜é‡çš„å†—ä½™é—®é¢˜ï¼Œä¸¤ä¸ªä¸åŒçš„æ–¹æ¡ˆä¼šå¯¼è‡´å¯¹è±¡çš„è™šè¡¨è¡Œä¸ºæ”¹å˜ã€‚\n\næ–¹æ¡ˆä¸€ï¼Œå­˜åœ¨ä¸¤ä¸ªè™šè¡¨ã€‚åˆ†åˆ«åœ¨å­¦ç”Ÿä¸­çš„äººã€èŒå·¥ä¸­çš„äººã€‚è¦æƒ³è°ƒç”¨è™šå‡½æ•°ï¼Œéœ€è¦æ˜¾å¼æŒ‡å‡ºè°ƒç”¨å­¦ç”Ÿè¿˜æ˜¯èŒå·¥ã€‚\næ–¹æ¡ˆäºŒï¼Œåªå­˜åœ¨å•ä¸ªè™šè¡¨ã€å…±æœ‰çš„ä¸€ä¸ªåŸºç±»å¯¹è±¡ã€‚è¿™æ ·çš„åæœæ˜¯ï¼Œå¦‚æœå­¦ç”Ÿå’ŒèŒå·¥éƒ½é‡å†™äº†äººçš„æ–¹æ³•ï¼Œé‚£ä¹ˆå•ä¸ªè™šè¡¨åˆä¼šä¸å¤Ÿç”¨äº†ï¼Œå³å‡ºç°äº†äºŒä¹‰æ€§ã€‚\n\nä¸¤ä¸ªæ–¹æ¡ˆéƒ½ä¸å®Œç¾ï¼Œæ–¹æ¡ˆä¸€çš„ç¼ºç‚¹åœ¨äºæ•°æ®å†—ä½™ï¼Œæ–¹æ¡ˆäºŒçš„ç¼ºç‚¹åœ¨äºé™åˆ¶äº†å¤šæ€æ€§ï¼Œå³ä¼šå‡ºç°äºŒä¹‰æ€§ã€‚\n\næ€»ä¹‹ï¼š\n1. è¦ä¹ˆé€‰æ‹©ï¼šæœ‰ä¸¤ä¸ªåŸºç±»æˆå‘˜ï¼Œæœ‰ä¸¤ä¸ªè™šå‡½æ•°è¡¨ã€‚å­¦ç”Ÿã€èŒå·¥å¯ä»¥åŒæ—¶é‡å†™ï¼Œåªä¸è¿‡éœ€è¦æ˜¾å¼è°ƒç”¨ã€‚ä½†æ˜¯æœ‰çŸ›ç›¾çš„åŒä»½åŸºç±»æ•°æ®ã€‚\n2. è¦ä¹ˆï¼šåªæœ‰ä¸€ä¸ªåŸºç±»æˆå‘˜ï¼Œåªæœ‰ä¸€ä¸ªè™šå‡½æ•°è¡¨ã€‚å­¦ç”Ÿã€èŒå·¥ä¸èƒ½åŒæ—¶é‡å†™åŸºç±»çš„æ–¹æ³•ã€‚ä½†ä¸éœ€è¦æ˜¾å¼è°ƒç”¨ã€‚\n### è™šç»§æ‰¿\nè™šç»§æ‰¿ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªvbptrï¼ŒæŒ‡å‘ä¸€ä¸ªè™šåŸºè¡¨ã€‚è¡¨ä¸­ä¿å­˜äº†è™šåŸºç±»åœ¨å†…å­˜ä¸­çš„åç§»ä¿¡æ¯ï¼Œç”¨äºåœ¨å¯¹è±¡å†…æ­£ç¡®å®šä½è™šåŸºç±»å­å¯¹è±¡ã€‚å¦‚æœä½¿ç”¨è™šç»§æ‰¿å¼•å…¥äº†ä¸€ä¸ªåŸºç±»ï¼Œåˆ™å¯ä»¥ç¡®ä¿è¯¥è™šåŸºç±»åªè¢«æ„é€ ä¸€æ¬¡ã€‚vbptr å¹¶é C++ æ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯ä¸€äº›ç¼–è¯‘å™¨ï¼ˆå¦‚ Microsoft Visual C++ï¼‰åœ¨å®ç°è™šæ‹Ÿç»§æ‰¿æ—¶é‡‡ç”¨çš„å†…éƒ¨æœºåˆ¶ã€‚\n```cpp\n#include<iostream>\nclass A\n{\npublic:\n    virtual void func() { std::cout << \"call A::func\" << std::endl; }\nprivate:\n    int ma;\n};\nclass B : virtual public A\n{\npublic:\n    void func() { std::cout << \"call B::func\" << std::endl; }\nprivate:\n    int mb;\n};\nint main()\n{\n    A * p = new B();\n    p->func();\n    delete p;\n    return 0;\n}\n```\nè°ƒç”¨funcæ²¡é—®é¢˜ï¼Œè¾“å‡º`call B::func`ï¼Œä½†æœ€ç»ˆä¼šå´©æºƒæŠ¥é”™ï¼šï¼ˆæ³¨æ„ï¼Œä»¥ä¸‹è®¨è®ºå‡åŸºäºWindows VSç¼–è¯‘å™¨ç¯å¢ƒï¼Œæ®è¯´Linux `g++`ç¯å¢ƒä¸‹delete pæ—¶pä¼šè‡ªåŠ¨åç§»å›Bçš„ä½ç½®å¯¼è‡´ä¸å´©æºƒï¼Œå¾…æµ‹è¯•ï¼‰\n![](../../images/Cpp_20240324_é¢å‘å¯¹è±¡/image-20240715041734762.png)\nè¿™æ˜¯å› ä¸ºpæŒ‡å‘çš„æ˜¯Açš„èµ·å§‹åœ°å€ï¼ˆvfptrï¼‰ï¼Œè€Œæ•´ä¸ªBå¯¹è±¡åœ¨å†…å­˜ä¸­çš„èµ·å§‹ä½ç½®æ˜¯å…ˆäºAçš„ï¼Œè€Œdeleteã€freeçš„æ—¶å€™è¦çœ‹é‚£ä¸ªä½ç½®çš„ä¸Šæ–‡è®°å½•ä¿¡æ¯ã€‚ç”±äºpçš„ä½ç½®æ²¡æœ‰ä¿¡æ¯ï¼Œé‚£ä¹ˆå°±ä¼šé‡Šæ”¾ä¸€ä¸ªä¸è¯¥é‡Šæ”¾çš„ä½ç½®ã€‚\n\nå¦‚ä½•éªŒè¯å‘¢ï¼Ÿå‘ç°64ä½ä¸‹`sizeof(B)`æ˜¯32ï¼Œ`sizeof(*p)`æ˜¯16ã€‚å¦‚æœæœ€å`delete (p - 1);`å³ä¸å´©æºƒã€‚\n\n>æ´¾ç”Ÿç±»å¯¹è±¡å–åœ°å€ï¼Œæ˜¯åŸºç±»å¯¹è±¡çš„èµ·å§‹åœ°å€ã€‚è¿™æ˜¯å®šå¾‹ã€‚ \n\n```\n+-----\n+vbptr\n+-----   ------> æ­£ç¡®çš„deleteçš„ä½ç½®\n+ mb\n+-----   ------> pæŒ‡å‘çš„ä½ç½®\n+vfptr\n+-----\n+ ma\n+-----\n```\nç„¶è€Œï¼Œæ›´æ˜æ™ºçš„åšæ³•æ˜¯ï¼šåªè¦æŠŠAçš„ææ„å‡½æ•°å†™ä¸ºè™šçš„ï¼Œå°±èƒ½æ­£å¸¸äº†ï¼šè¿™æ ·ï¼Œdelete pçš„æ—¶å€™ï¼Œåœ¨è°ƒç”¨ææ„æ—¶ï¼Œå°±ä¼šå»æŸ¥åŸºç±»ï¼ˆAï¼‰ä¸­çš„è™šæ–¹æ³•è¡¨æŒ‡é’ˆï¼Œä»è€Œå…ˆå»ææ„Bï¼Œç„¶åï¼Œå†å»ææ„Aã€‚\n>å¯¹æ¯”å•ç»§æ‰¿ä¸‹çš„è™šææ„æ—¶deleteé¡ºåºé“¾ï¼šæ´¾ç”Ÿé¡ºåºA-B-Cï¼Œè™šææ„æ—¶ï¼Œdeleteçš„æ˜¯Aåœ°å€ï¼Œä½†æŸ¥è¡¨åå…ˆå»ææ„Cï¼Œå†ææ„Bï¼Œå†ææ„Aã€‚\n\n```cpp\nclass A\n{\npublic:\nÂ  Â  virtual void func() { std::cout << \"call A::func\" << std::endl; }\nÂ  Â  virtual ~A() { std::cout << \"~A()\" << std::endl; }\nprivate:\nÂ  Â  int ma;\n};\n\nclass B : virtual public A\n{\npublic:\nÂ  Â  void func() { std::cout << \"call B::func\" << std::endl; }\nÂ  Â  ~B() { std::cout << \"~B()\" << std::endl; }\nprivate:\nÂ  Â  int mb;\n};\n```\nè¾“å‡ºï¼š\n```\ncall B::func\n~B()\n~A()\n```\n# å¯¹è±¡çš„æœ¬è´¨\n\nå®é™…ä¸Šï¼Œå¯¹è±¡åªèƒ½å­˜å‚¨å˜é‡ã€‚æ–¹æ³•æ˜¯é€šè¿‡è½¬åŒ–è½¬ç§»åˆ°äº†ä»£ç åŒºã€‚\n\nè¦åŒºåˆ†ä¸åŒå¯¹è±¡ï¼Œéœ€è¦ç”¨åˆ°thisæŒ‡é’ˆï¼Œå› æ­¤æ¯ä¸€ä¸ªæ™®é€šæˆå‘˜æ–¹æ³•éƒ½æœ‰éšå«çš„thisæŒ‡é’ˆå‚æ•°ã€‚\næ¯”å¦‚Childç±»çš„`val()`æ–¹æ³•å®é™…çš„å®Œæ•´å½¢å¼å¦‚ä¸‹ï¼š\n```cpp\nclass Child\n{\n//...\n    int val(Child * const this) const\n    {\n        return this->_val;\n    }\n//...\n}\n```\nä¸‹é¢æ˜¯å®é™…è°ƒç”¨çš„è¿‡ç¨‹ï¼š\n```cpp\nå½¢å¼è°ƒç”¨è¿‡ç¨‹ï¼š\n----------------\nChild child;\nchild.val();\n----------------\nå®é™…è°ƒç”¨è¿‡ç¨‹ï¼š\n----------------------\nChild child;\nChild::val(&child);\n----------------------\n```\n## åŸºç±»æŒ‡é’ˆæŒ‡å‘å­ç±»å¯¹è±¡\n\n### é™æ€è”ç¼–ï¼šåœ¨ç¼–è¯‘æœŸå°±ç¡®å®šæ­»äº†\n```cpp\nvoid foo(void)\n{\n    Test * base = new Child;\n    std::cout << base->val() << std::endl;\n}\n```\n\n### åŠ¨æ€è”ç¼–ï¼šåœ¨è¿è¡Œæ—¶æ‰èƒ½ç¡®å®š\néœ€è¦æŠŠå‡½æ•°æ”¾åˆ°æ•°æ®ä¸­ã€‚åªæœ‰æ•°æ®æ˜¯åŠ¨æ€çš„ï¼Œå› æ­¤è¦æƒ³åŠ¨æ€è”ç¼–åªèƒ½é€šè¿‡æ•°æ®çš„è½¬åŒ–ã€‚å‡½æ•°ä¹Ÿæœ‰æŒ‡é’ˆå’Œåœ°å€ï¼Œæ‰€ä»¥ï¼Œå¯ä»¥é€šè¿‡æ”¹å˜å‡½æ•°æŒ‡é’ˆçš„åœ°å€æ¥è¿›è¡ŒåŠ¨æ€è½¬æ¢ã€‚\n```cpp\n\n```\n# ç±»å‹è½¬æ¢\n## dynamic_cast\nåŠ¨æ€ç±»å‹è½¬æ¢ç”¨äºçˆ¶å­ç±»ä¹‹é—´åˆ‡æ¢æŒ‡é’ˆç±»å‹ã€‚è½¬æ¢æˆåŠŸåˆ™è¿”å›ç›®æ ‡æŒ‡é’ˆç±»å‹ï¼Œä¸æˆåŠŸåˆ™è¿”å›ç©ºã€‚\n```c++\ndynamic_cast<Target Type*>(Origin Pointer)\n```\n1. ä»å­ç±»è½¬åˆ°åŸºç±»ï¼Œæ˜¯ä¸Šè¡Œè½¬æ¢ï¼ˆupcastï¼‰\n2. ä»åŸºç±»è½¬åˆ°å­ç±»ï¼Œæ˜¯ä¸‹è¡Œè½¬æ¢ï¼ˆdowncastï¼‰\n3. å¦‚æœæœ‰çˆ¶å­ç±»å…³ç³»ï¼Œä¸Šè¡Œè½¬æ¢è‚¯å®šä¼šæˆåŠŸï¼Œéš¾ç‚¹åœ¨äºä¸‹è¡Œè½¬æ¢ã€‚\n4. ä¸‹è¡Œè½¬æ¢ï¼Œå°æ‹¬å·ä¸­çš„æŒ‡é’ˆæˆ–å¼•ç”¨å¯¹åº”çš„çˆ¶ç±»å¿…é¡»è¦æœ‰è™šå‡½æ•°ã€‚å¦åˆ™ç¼–è¯‘ä¸é€šè¿‡ã€‚ç¼–è¯‘ä¸é€šè¿‡è¯´æ˜å°æ‹¬å·ä¸­çš„ç±»æ²¡æœ‰è™šå‡½æ•°ã€‚\n5. ä¸‹è¡Œè½¬æ¢ï¼Œç¼–è¯‘é€šè¿‡ï¼Œä½†è¿è¡Œå¤±è´¥äº†ï¼Œåˆ™è¯´æ˜äºŒè€…æ²¡æœ‰çˆ¶å­å…³ç³»ï¼Œå¤±è´¥çš„æƒ…å†µï¼š\n    1. å¦‚æœä¸‹è¡Œè½¬æ¢æŒ‡é’ˆï¼Œå¤±è´¥åˆ™è¿”å›ç©ºæŒ‡é’ˆï¼Œéœ€è¦é€šè¿‡åˆ¤æ–­æ˜¯å¦ä¸ºç©ºæ¥åˆ¤æ–­æ˜¯å¦è½¬æ¢æˆåŠŸã€‚\n    2. å¦‚æœä¸‹è¡Œè½¬æ¢å¼•ç”¨ï¼Œå¤±è´¥æ— æ³•è¿”å›ç©ºå¼•ç”¨ï¼Œåªèƒ½æŠ›å‡ºå¼‚å¸¸ï¼Œå¼‚å¸¸ä¿¡æ¯æ˜¯ï¼šbad dynamic castï¼Œéœ€è¦é€šè¿‡å¼‚å¸¸å¤„ç†æ¥åˆ¤æ–­æ˜¯å¦æˆåŠŸã€‚\n\n```cpp\nclass Base\n{\npublic:\n    Base()\n    {\n        std::cout << \"Base()\" << std::endl;\n    }\n    virtual ~Base()\n    {\n        std::cout << \"~Base()\" << std::endl;\n    }\n    virtual void show() const\n    {\n        std::cout << \"Base::show()\" << std::endl;\n    }\n};\nclass Child : public Base\n{\npublic:\n    Child()\n    {\n        std::cout << \"Child()\" << std::endl;\n    }\n    ~Child()\n    {\n        std::cout << \"~Child()\" << std::endl;\n    }\n    void show() const\n    {\n        std::cout << \"Child::show()\" << std::endl;\n    }\n};\nclass Other\n{\npublic:\n    void show() const\n    {\n        std::cout << \"Other::show()\" << std::endl;\n    }\n};\n// Upcast\n// output: Child::show()\nint main()\n{\n    Child* child = new Child;\n    Base* base = dynamic_cast<Base*>(child);\n    if (base)\n    {\n        base->show();\n        delete base;\n        base = nullptr;\n    }\n    child = nullptr;\n}\n// Downcast - success\n// output: Child::show()\nint main()\n{\n    Base* base = new Child;\n    Child* child = dynamic_cast<Child*>(base);\n    if (child)\n    {\n        child->show();\n        delete child;\n        child = nullptr;\n    }\n    base = nullptr;\n}\n// Downcast - error_pointer\n// output: Downcast error\nint main()\n{\n    Base* base = new Child;\n    Other* other = dynamic_cast<Other*>(base);\n    if (other)\n    {\n        other->show();\n        delete other;\n        other = nullptr;\n    }\n    else\n    {\n        std::cout << \"Downcast error\" << std::endl;\n        delete base;\n        base = nullptr;\n    }\n}\n// Downcast - error_reference\n// output: Bad dynamic_cast!\nint main()\n{\n    Child child;\n    Base& base = child;\n    try\n    {\n        Other& other = dynamic_cast<Other&>(base);\n    }\n    catch (const std::exception& e)\n    {\n        std::cout << e.what() << std::endl;\n    }\n}\n```\n## static_cast\né€šä¿—æ¥è¯´ï¼Œæ˜¯å¤åˆ¶ä¸€ä¸ªè€çš„å€¼ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„å€¼ã€‚\n1. æ”¯æŒåŸºç¡€æ™®é€šç±»å‹çš„è½¬æ¢ã€‚ä¹Ÿå¯ä»¥ç±»å®ä½“ä¹‹é—´çš„ã€çˆ¶å­ç±»æŒ‡é’ˆï¼ˆå¼•ç”¨ï¼‰ä¹‹é—´çš„è½¬æ¢ã€‚\n2. å®ä½“ä¹‹é—´çš„è½¬æ¢ï¼Œå®é™…ä¸Šæ˜¯æŒ‰å°æ‹¬å·é‡Œçš„å®ä½“å¤åˆ¶äº†ä¸€ä»½æ–°çš„å®ä½“ã€‚\n3. çˆ¶å­ç±»æŒ‡é’ˆï¼ˆå¼•ç”¨ï¼‰ä¹‹é—´çš„ä¸Šä¸‹è½¬æ¢ï¼Œåªè¦æœ‰çˆ¶å­å…³ç³»ï¼Œéƒ½èƒ½è½¬æ¢æˆåŠŸã€‚ä¸ä¾èµ–è™šå‡½æ•°è¡¨ã€‚\n    1. ä½†æ˜¯ï¼Œä¸‹è¡Œè½¬æ¢æ˜¯å¼ºè¡Œè§£é‡Šçš„ï¼Œå› ä¸ºå­æŒ‡é’ˆæŒ‡å‘äº†çˆ¶å¯¹è±¡ã€‚\n4. ä¸æ”¯æŒæŒ‡é’ˆå’Œå®ä½“ä¹‹é—´çš„è½¬æ¢ã€‚æ”¯æŒå®ä½“è½¬åˆ°å¼•ç”¨ã€‚\n```c++\nstatic_cast<Target Type*>(Origin Pointer)\nstatic_cast<Basic Type>(Basic Type)\n```\n\n```cpp\nint main()\n{\n    double d = 15.2;\n    auto f = static_cast<float>(d);\n}\n```\n\n```cpp\nclass Base\n{\npublic:\n    Base()\n    {\n        std::cout << \"Child()\" << std::endl;\n    }\n    virtual ~Base()\n    {\n        std::cout << \"~Base()\" << std::endl;\n    }\n    virtual void show() const\n    {\n        std::cout << \"Base::show()\" << std::endl;\n    }\n};\nclass Child : public Base\n{\npublic:\n    Child()\n    {\n        std::cout << \"Child()\" << std::endl;\n    }\n    ~Child()\n    {\n        std::cout << \"~Child()\" << std::endl;\n    }\n    void show() const\n    {\n        std::cout << \"Child::show()\" << std::endl;\n    }\n};\nint main()\n{\n    Base  * base  = new Child;\n    Child * child = static_cast<Child*>(base);\n    if (child)\n    {\n        child->show();\n    }\n    delete child;\n    child = nullptr;\n    base = nullptr;\n}\n```\n## reinterpret_cast\nç”¨äºæŒ‡é’ˆé‡æ–°è§£é‡Šä¸€ä¸ªå€¼æˆ–å¯¹è±¡ã€‚\n1. å¯ä»¥ä¸¤ä¸ªæŒ‡é’ˆï¼ˆå¼•ç”¨ï¼‰ä¹‹é—´ï¼Œæˆ–å€¼å’ŒæŒ‡é’ˆï¼ˆå¼•ç”¨ï¼‰ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚\n    1. å€¼å’ŒæŒ‡é’ˆï¼ˆå¼•ç”¨ï¼‰ä¹‹é—´è¿›è¡Œè½¬æ¢ç›®çš„æ˜¯ä¸ºäº†æŠŠå€¼å½“ä½œåœ°å€ç”¨ã€‚\n2. åŸºç¡€ç±»å‹ä¹‹é—´ä¸èƒ½è½¬æ¢\n3. ç¼–è¯‘å™¨æ²¡æœ‰å®‰å…¨æ£€æŸ¥ï¼Œæ­£ç¡®æ€§ç”±ç¨‹åºå‘˜æŠŠæ¡ã€‚\n\n```cpp\nreinterpret_cast<Target Type*>(Origin Pointer)\nreinterpret_cast<Target Type*>(Origin Value)\nreinterpret_cast<Target Type>(Origin Pointer)\n```\n## const_cast\n1. ä¸»è¦ç”¨äºæŒ‡é’ˆå¼•ç”¨ä¸€ä¸ªå»æ‰å¸¸æ€§çš„å˜é‡ï¼Œå¼ºè°ƒå¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚\n    1. ä¹Ÿå¯ä»¥ç”¨äºæŒ‡é’ˆå¼•ç”¨ä¸€ä¸ªåŠ ä¸Šå¸¸æ€§çš„å˜é‡ï¼Œå¼ºè°ƒä¸å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚ä½†æ˜¯å…¶å®æ²¡å¿…è¦ï¼Œç›´æ¥åœ¨å‰é¢æŒ‡é’ˆå£°æ˜çš„æ—¶å€™åŠ constå°±è¡Œã€‚\n2. åªèƒ½è¿›è¡ŒæŒ‡é’ˆï¼ˆå¼•ç”¨ï¼‰ä¹‹é—´çš„è½¬æ¢ã€‚\n\n```cpp\nconst_cast<Target Type*>(Origin Pointer)\n```\n\n```cpp\nint main()\n{\n    int         a = 123;\n    int const * p = &a;\n\n    *p                   = 222;  // error\n    *const_cast<int*>(p) = 222;\n}\n```\næ—¢ç„¶è§„å®šäº†constï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç»™`const_cast`æœºåˆ¶ï¼Ÿè¿™æ˜¯ä¸ºäº†è®©ç¨‹åºå‘˜æœ‰ä¿®æ”¹constå˜é‡çš„æƒé™ã€‚è¿™ä¸ªæ˜¾å¼çš„æœºåˆ¶æ˜¯ä¸ºäº†è®©ç¨‹åºå‘˜ä¿è¯ä»–ä»¬ä¸æ˜¯åœ¨è¯¯æ“ä½œä¿®æ”¹ã€‚\n```cpp\nclass Base\n{\npublic:\n    Base()\n    {\n        std::cout << \"Child()\" << std::endl;\n    }\n    virtual ~Base()\n    {\n        std::cout << \"~Base()\" << std::endl;\n    }\n    virtual void show() /* const */\n    {\n        std::cout << \"Base::show()\" << std::endl;\n    }\n};\nclass Child : public Base\n{\npublic:\n    Child()\n    {\n        std::cout << \"Child()\" << std::endl;\n    }\n    ~Child()\n    {\n        std::cout << \"~Child()\" << std::endl;\n    }\n    void show() /* const */\n    {\n        std::cout << \"Child::show()\" << std::endl;\n    }\n};\nint main()\n{\n    Base const * base = new base;\n    base->show();  // error\n    const_cast<Base*>(base)->show();\n    delete base;\n    base = nullptr;\n}\n```\nå¦‚ä¸Šï¼Œå¸¸å¯¹è±¡ä¸èƒ½è°ƒç”¨éå¸¸æ–¹æ³•ã€‚\nè§£å†³åŠæ³•ï¼š\n1. ä¿®æ”¹éå¸¸æ–¹æ³•ä¸ºå¸¸æ–¹æ³•\n2. ç”¨`const_cast`ä¸´æ—¶è½¬æ¢baseçš„ç±»å‹ä¸ºéå¸¸ç±»å‹ã€‚è™½ç„¶å¯èƒ½è¿èƒŒäº†åŸæœ¬çš„è®¾è®¡ï¼Œä½†æ˜¯è¿™æ˜¯ä¸€ç§ç‰¹æ®Šæƒ…å†µä¸‹çš„æƒé™ã€‚\n## æ€»ç»“\n1. dynamicæ˜¯å”¯ä¸€å¿…é¡»æœ‰è™šå‡½æ•°è¡¨çš„\n2. staticæ˜¯å”¯ä¸€æ”¯æŒä¸¤ä¸ªåŸºç¡€ç±»å‹è½¬æ¢çš„\n3. reinterpretå¯ä»¥è½¬æ¢å„ç§æŒ‡é’ˆï¼ŒåŒ…æ‹¬å¯ä»¥æŠŠå€¼å’ŒæŒ‡é’ˆäº’è½¬ï¼Œä½†æ˜¯å¿…é¡»è¦æœ‰ä¸€ä¸ªæŒ‡é’ˆå‚ä¸ã€‚\n4. conståªèƒ½è½¬æ¢æŒ‡é’ˆï¼ˆå¼•ç”¨ï¼‰ã€‚","categories":["Cpp"]},{"title":"ç½‘ç»œ_åŸºç¡€æ¦‚å¿µ","url":"/ç½‘ç»œ/ç½‘ç»œ_åŸºç¡€æ¦‚å¿µ/","content":"# ç½‘æ®µ\n\nä¸¤å°ä¸»æœº`192.168.1.10`å’Œ`192.168.2.11`ï¼Œé€šè¿‡ç½‘çº¿ç›´è¿ï¼Œæ˜¯ä¸èƒ½ç›´æ¥pingé€šçš„ã€‚\nå› ä¸ºä¸åœ¨åŒä¸€ç½‘æ®µä¸‹ã€‚éœ€è¦è·¯ç”±å™¨è¿›è¡Œè¿æ¥ã€‚\n\nç½‘çº¿ç›´è¿ã€åŒè½´ç”µç¼†ã€é›†çº¿å™¨ã€ç½‘æ¡¥ã€äº¤æ¢æœºï¼Œæ‰€è¿æ¥çš„è®¾å¤‡å¿…é¡»åœ¨åŒä¸€ç½‘æ®µï¼Œè¿æ¥çš„è®¾å¤‡å¤„åœ¨åŒä¸€å¹¿æ’­åŸŸã€‚\n\nç½‘æ¡¥ã€äº¤æ¢æœºå¯ä»¥éš”ç»å†²çªåŸŸã€‚\n1. ç½‘æ¡¥æœ‰ä¸¤ä¸ªæ¥å£ï¼Œå¯ä»¥è®°å½•è®¡ç®—æœºåœ¨ç½‘æ¡¥å“ªä¸€ä¾§ã€IPå’Œå¯¹åº”çš„MACåœ°å€ï¼Œä»è€Œå¯ä»¥é˜»æŒ¡éè·¨ä¾§çš„æ— æ•ˆé€šä¿¡ï¼Œå‡å°‘çº¿è·¯å‹åŠ›ã€‚\n2. äº¤æ¢æœºæœ‰å¾ˆå¤šæ¥å£ï¼Œå¯ä»¥è®©è®¡ç®—æœºä¹‹é—´è¿›è¡Œå…¨åŒå·¥é€šä¿¡ã€‚å®Œå…¨éš”ç»äº†å†²çªã€‚\n3. å¦‚æœä¸¤ä¸ªè®¡ç®—æœºçš„IPåœ°å€è®¾ç½®åœ¨ä¸åŒç½‘æ®µï¼Œæ¯”å¦‚ä¸€ä¸ªæ˜¯`192.168.1.10/24`ï¼Œå¦ä¸€ä¸ªæ˜¯`192.168.2.10/24`ã€‚è€Œå¦‚æœä»–ä»¬ç”¨äº¤æ¢æœºè¿æ¥ï¼Œé‚£ä»–ä»¬æ˜¯æ— æ³•é€šä¿¡çš„ï¼Œç”šè‡³ç›´è¿ç½‘çº¿ä¹Ÿä¸è¡Œã€‚\n4. å¦‚æœå…¨ä¸–ç•Œè®¾å¤‡éƒ½ç”¨äº¤æ¢æœºè¿æ¥ï¼Œå…ˆä¸è¯´å¹¿æ’­é£æš´çš„é—®é¢˜ï¼ŒIPåœ°å€ä¹Ÿé¢ä¸´ä¸å¤Ÿç”¨çš„é—®é¢˜ï¼\nè·¯ç”±å™¨å¯ä»¥åœ¨ä¸åŒç½‘æ®µä¹‹é—´è½¬å‘æ•°æ®ï¼Œå¯ä»¥éš”ç»å¹¿æ’­åŸŸã€‚\n1. è™½ç„¶ç½‘æ¡¥ã€äº¤æ¢æœºå¯ä»¥éš”ç»å†²çªåŸŸï¼Œä½†æ˜¯æŸä¸ªè®¡ç®—æœºåœ¨é¦–æ¬¡å‘èµ·é€šä¿¡æ—¶éœ€è¦å¹¿æ’­ARPåŒ…ç»™è¿™ä¸€ç½‘æ®µä¸­çš„æ‰€æœ‰æœºå™¨ï¼Œå³äº¤æ¢æœºè¿æ¥ç€çš„æ‰€æœ‰è®¾å¤‡ï¼Œè¿™ç§°ä¹‹ä¸ºä¸€ä¸ªå¹¿æ’­åŸŸã€‚\n2. \n# MAC\n\n`arp -a`å¯ä»¥çœ‹æœ¬æœºç¼“å­˜çš„IPåœ°å€å’Œå¯¹åº”çš„MACåœ°å€\n# çº¿æ\n\nç›¸åŒè®¾å¤‡ä¹‹é—´ä¸­äº¤å‰çº¿ï¼Œä¸åŒè®¾å¤‡ä¹‹é—´ç”¨ç›´é€šçº¿ã€‚æ¯”å¦‚è®¡ç®—æœºè¿æ¥Hubç”¨ç›´é€šçº¿ï¼Œè€ŒHubè¿æ¥Hubç”¨äº¤å‰çº¿ã€‚\n\nä½†æ˜¯ï¼Œå¦‚æœä¸¤ä¸ªé›†çº¿å™¨ä¹‹é—´éš”äº†ä¸€ä¸ªç½‘æ¡¥ï¼Œé‚£ä¹ˆHub-ç½‘æ¡¥-Hubçš„ä¸¤æ ¹çº¿ä¾ç„¶æ˜¯äº¤å‰çº¿ã€‚\n\n# IP\n\n1. æŒ‰å­—èŠ‚åˆ’åˆ†ä¸º4éƒ¨åˆ†\n2. æŒ‰åŠŸèƒ½åˆ’åˆ†ä¸º2éƒ¨åˆ†ï¼šç½‘ç»œæ ‡è¯†ï¼ˆç½‘ç»œå·ï¼‰ã€ä¸»æœºæ ‡è¯†ï¼ˆä¸»æœºå·ï¼‰\n    1. åŒä¸€ç½‘æ®µçš„ç½‘ç»œå·ç›¸åŒ\n        1. é€šè¿‡å­ç½‘æ©ç å¯ä»¥è®¡ç®—å‡ºç½‘ç»œå·ï¼š`å­ç½‘æ©ç  &(æŒ‰ä½ä¸) IPåœ°å€`\n           ```\n             192.168.  1.10\n           & 255.255.255. 0\n           ------------------\n             192.168.  1. 0\n           ```\n        2. å­ç½‘æ©ç çš„**åé¢çš„è¿ç»­çš„**é1ä½ç½®ï¼ˆè‹¥å¹²ä¸ª0ä½ï¼‰æ˜¯ç»™ä¸»æœºå·å‡†å¤‡çš„ã€‚\n# æ•°æ®åŒ…ä¼ è¾“è¿‡ç¨‹\n\n1. å¦‚æœæ˜¯è·¨è·¯ç”±å™¨ä¼ è¾“ï¼Œåˆ™æºIPå’Œç›®æ ‡IPä¸å˜ï¼Œä¸€ç›´å˜åŒ–çš„æ˜¯æºMACå’Œç›®æ ‡MAC\n\n# æ¥å£\n\n1. Fast Ethernet: äº¤æ¢æœºå’Œè·¯ç”±å™¨ä¹‹é—´é€šè¿‡ä»¥å¤ªç½‘å£è¿æ¥\n2. Serial: è·¯ç”±å™¨å’Œè·¯ç”±å™¨ä¹‹é—´é€šè¿‡ä¸²å£è¿æ¥\n\n# VPN\n\nVirtual Private Network: è™šæ‹Ÿç§äººç½‘ç»œã€‚åœ¨å…¬å…±ç½‘ç»œä¸Šå»ºç«‹ä¸“ç”¨ç½‘ç»œï¼Œè¿›è¡ŒåŠ å¯†é€šè®¯ã€‚","categories":["ç½‘ç»œ"]},{"title":"Cpp_auto","url":"/Cpp/Cpp_auto/","content":"# å†…å®¹\n1. åˆè¯†auto\n# auto\n\nå¦‚æœä¸åœ¨è¿”å›autoçš„å‡½æ•°çš„è¿”å›å€¼ç±»å‹æœ‰å†²çªçš„åé¢åŠ ` -> int`ï¼Œåˆ™ä¼šç¼–è¯‘ä¸é€šè¿‡ï¼Œå› ä¸ºautoæ— æ³•æ¨æ–­åˆ°åº•è¿”å›æµ®ç‚¹å‹è¿˜æ˜¯æ•´å‹ï¼Œåˆ™å¯ä»¥åŠ ` -> int`è¿›è¡Œå£°æ˜ï¼šè¿”å›å€¼ç»Ÿä¸€å¼ºè½¬ä¸ºintã€‚\n\nè¿™ç§autoåœ¨å‰ï¼Œè¿”å›å€¼ç±»å‹åœ¨åçš„ç”¨å¤„è¿˜æœ‰ä¸€ä¸ªå¥½å¤„å°±æ˜¯ï¼šå¦‚æœè¿”å›å€¼ç±»å‹ç‰¹åˆ«å¤æ‚ã€ç‰¹åˆ«é•¿ï¼Œåˆ™å¯ä»¥å…ˆå†™autoä»£æ›¿ï¼ŒæŠŠåˆè‡­åˆé•¿çš„åå­—æ”¾åœ¨åç¼€ï¼Œèµ·åˆ°äº†ä½¿ä»£ç ç¾è§‚çš„ä½œç”¨ï¼ˆé¿å…å¤´é‡è„šè½»ï¼‰ã€‚\n\n```cpp\nauto show(int v)\n{\n    if(v < 10)\n        return 30.0;\n    else\n        return 30;\n}\n```\n\n```cpp\nauto show(int v) -> int\n{\n    if(v < 10)\n        return 30.0;\n    else\n        return 30;\n}\n```\n","categories":["Cpp"]},{"title":"Cpp_åˆå§‹åŒ–åˆ—è¡¨","url":"/Cpp/Cpp_åˆå§‹åŒ–åˆ—è¡¨/","content":"# å†…å®¹\n1. ä¸‰ç§å½¢å¼çš„initialization\n2. æ„é€ å‡½æ•°çš„åˆå§‹åŒ–åˆ—è¡¨å†™æ³•\n# Cppçš„initialization\næœ‰ä¸‰ç§å½¢å¼ï¼š\n1. èµ‹å€¼ï¼ˆassignmentå½¢å¼ï¼‰\n2. å·æ‹¬å·ï¼ˆå¤§æ‹¬å·ï¼Œcurly bracesï¼‰\n3. å‡½æ•°å¼ï¼ˆåœ†æ‹¬å·ï¼‰\n\n```cpp\nint main()\n{\n    // assignment initialization\n    double a = 17.5;\n    // braces initialization\n    double b{ 17.5 };\n    // functional initialization\n    double c(17.5);\n}\n```\n\nå§”å‘˜ä¼šæ¨èæ–°å‡ºçš„å¤§æ‹¬å·å½¢å¼çš„åˆå§‹åŒ–ï¼Œæœ€é€šç”¨ï¼Œç›¸æ¯”äºåœ†æ‹¬å·æ¥è¯´æ›´å°‘æœ‰æ­§ä¹‰ã€‚\n# æ„é€ å‡½æ•°ä¸­çš„åˆå§‹åŒ–åˆ—è¡¨\n\nå†’å·åé¢çš„åˆå§‹åŒ–åˆ—è¡¨ï¼Œé™¤äº†assignmentå½¢å¼ï¼Œå°æ‹¬å·ã€å¤§æ‹¬å·éƒ½å¯ä»¥ã€‚ç°ä»£C++æ›´æ¨èå¤§æ‹¬å·ã€‚\n\n```cpp\nclass Test\n{\npublic:\n    Test(void) : _val{ 7 }\n    {\n        //_val = 7;\n    }\nprivate:\n    int _val;\n}\n```\n\nåˆå§‹åŒ–åˆ—è¡¨çš„åˆå§‹åŒ–æ˜¯å…ˆäºæ„é€ å‡½æ•°çš„ï¼Œå³ç»™å¯¹è±¡åˆ›å»ºç©ºé—´åç«‹é©¬å¡«æˆå‘˜çš„å€¼ã€‚\nè€Œæ„é€ å‡½æ•°ä¸­èµ‹å€¼ï¼Œæ˜¯å¯¹è±¡åˆ›å»ºå®Œæ¯•åæ‰å»æ‰§è¡Œã€‚\n## åˆå§‹åŒ–åˆ—è¡¨çš„è¯­æ³•ç³–\n\nå¦‚æœè¦åˆå§‹åŒ–çš„ä¸œè¥¿æ˜¯å¸¸é‡ï¼Œåˆ™`C++11`æœ‰è¯­æ³•ç³–ï¼šç›´æ¥åœ¨æˆå‘˜å˜é‡ååŠ åˆå§‹åŒ–æ‹¬å·ã€‚\n```cpp\nclass Test\n{\npublic:\n    Test(void)\n    {\n        //_val = 7;\n    }\nprivate:\n    int _val{ 7 };\n};\n```\n","categories":["Cpp"]},{"title":"Cpp_æ¦‚è¿°","url":"/Cpp/Cpp_æ¦‚è¿°/","content":"# å†…å®¹\n1. Cppæ˜¯ä¸ªä»€ä¹ˆè¯­è¨€ï¼Œç»„æˆéƒ¨åˆ†ã€‚\n# Cppç»„æˆéƒ¨åˆ†\næ ¹æ®`legacy.cplusplus.com`æ‰‹å†Œä¸­Referenceä¸€æ ã€‚æ ‡å‡†C++åº“åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼ˆæ­¤ç½‘ç«™2017å¹´åœæ­¢æ›´æ–°ï¼‰ï¼š\n1. Cåº“\n2. å®¹å™¨\n3. è¾“å…¥è¾“å‡ºæµ\n4. åŸå­å’Œçº¿ç¨‹åº“ï¼ˆC++11ä¹‹åï¼‰\n5. æ‚é¡¹ï¼ˆMiscellaneous headersï¼‰\n    1. ç®—æ³•åº“ï¼ˆalgorithmï¼‰\n    2. æ—¶é—´åº“ï¼ˆchronoï¼‰\n    3. å¼‚å¸¸åº“ï¼ˆexceptionï¼‰\n    4. å‡½æ•°å¯¹è±¡ï¼ˆfunctionalï¼‰\n    5. è¿­ä»£å™¨ï¼ˆiteratorï¼‰\n    6. å†…å­˜ç®¡ç†ï¼ˆmemoryï¼‰ï¼šå°¤å…¶æ˜¯æ™ºèƒ½æŒ‡é’ˆ\n    7. éšæœºï¼ˆRandomï¼‰\n        1. æ¢…æ£®æ—‹è½¬ç®—æ³•ï¼Œä½¿ç”¨çš„æ˜¯åˆ†å¸ƒå¾‹ã€‚éšæœºæ€§èƒ½å¾ˆå¥½ã€‚\n    8. å·¥å…·ï¼ˆutilityï¼‰ï¼šç”¨çš„æœ€å¤šçš„æ˜¯pair\n# åå­—ç©ºé—´\nè¿™ä¸ªä¸æ˜¯C++çš„ä¸“åˆ©ï¼Œæ‰€æœ‰çš„é¢å‘å¯¹è±¡è¯­è¨€ï¼Œéƒ½æœ‰åå­—ç©ºé—´çš„æ¦‚å¿µã€‚\n\nä»¥å‰åœ¨Cè¯­è¨€ä¸­ï¼Œéšæ„å®šä¹‰å…¨å±€å˜é‡å¯èƒ½ä¼šäº§ç”Ÿæ±¡æŸ“ã€‚æ­¤æ—¶åªæœ‰â€œå…¨å±€ç©ºé—´â€ä¸€è¯´ã€‚\n\nç°åœ¨åœ¨C++ä¸­ï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªåå­—ç©ºé—´ï¼Œåœ¨å…¶ä¸­å®šä¹‰è‡ªå·±çš„ä¸œè¥¿ã€‚é˜²æ­¢ä¸ä»–äººå†²çªã€‚\n```cpp\nnamespace xcg\n{\nclass Person\n{\nprivate:\n    int m_age;\npublic:\n    int age(void) const\n    {\n        return m_age;\n    }\n    void age(int age)\n    {\n        m_age = age;\n    }\n};\n}\nnamespace other\n{\nclass Person\n{\nprivate:\n    int m_age;\npublic:\n    int age(void) const\n    {\n        return m_age;\n    }\n    void age(int age)\n    {\n        m_age = age;\n    }\n};\n}\nint main()\n{\n    xcg::Person person;\n}\n```\n## åå­—ç©ºé—´å¯ä»¥åµŒå¥—\nç¬¬ä¸€ç§å†™æ³•ï¼š\n```cpp\nnamespace xcg::alpha\n{\n    // ...\n}\n```\nç¬¬äºŒç§å†™æ³•ï¼š\n```cpp\nnamespace xcg\n{\n    namespace beta\n    {\n        // ...\n    }\n}\n```","categories":["Cpp"]},{"title":"Cpp_æµå¼IOå¤„ç†_å­—ç¬¦æ§åˆ¶_pfæ“ä½œç¬¦","url":"/Cpp/Cpp_æµå¼IOå¤„ç†_å­—ç¬¦æ§åˆ¶_pfæ“ä½œç¬¦/","content":"# å†…å®¹\n\nCppçš„åŸºäºæµçš„IOç³»ç»Ÿ\n1. ostreamä¸­`<<`è¿ç®—ç¬¦æ–¹æ³•ä¸­çš„å‚æ•°ï¼špfæ§åˆ¶ç¬¦\n# `<<`\n`<<`å«åš**æµæ’å…¥**è¿ç®—ç¬¦ï¼ˆinsertion operatorï¼‰ã€‚æŠŠåé¢è·Ÿéšçš„å†…å®¹æ’å…¥åˆ°æµä¸­ã€‚\n```cpp\nint main()\n{\n    std::cout << \"Hello\" << \"\\n\";\n    return 0;\n}\n```\n## `<<`åé¢æ”¯æŒè·Ÿç€å“ªäº›ä¸œè¥¿\n1. æ•°å­—ç±»å‹ï¼ˆarithmetic typesï¼‰\n2. æµç¼“å†²ï¼ˆstream buffersï¼‰\n3. æ§åˆ¶ç¬¦ï¼ˆmanipulatorsï¼‰\n# `>>`\n`>>`ç§°ä½œæµæå‡ºè¿ç®—ç¬¦ï¼ˆextraction operatorï¼‰ã€‚\n# æ§åˆ¶ç¬¦å·\n## `std::endl`\nend of line\n\n`std::endl`æ˜¯å®šä¹‰åœ¨`ostream`ä¸­çš„**å‡½æ•°**ã€‚\n![](../../images/Cpp_æµå¼IOå¤„ç†/image-20250308103912962.png)\nå®é™…ä¸Šå°±æ˜¯è¾“å‡ºäº†ä¸€ä¸ª`\\n`ï¼Œå¹¶ä¸”åˆ·æ–°ç¼“å†²åŒºã€‚\n# coutå“ªæ¥çš„ï¼Ÿostream\nåœ¨`<iostream>`ä¸­ï¼Œcoutæ˜¯è¿™ä¹ˆå®šä¹‰çš„ï¼š\n```cpp\nextern ostream cout;\n```\n![](../../images/Cpp_æµå¼IOå¤„ç†/image-20250308133737867.png)\n`iostream`æ˜¯ç»§æ‰¿äºostreamã€iostreamçš„ã€‚\n\nåœ¨`<ostream>`ä¸­ï¼Œostreamæ˜¯`basic_ostream<char>`çš„åˆ«åã€‚\n```cpp\ntypedef basic_ostream<char> ostream;\n```\ncoutã€cerrã€clogæ˜¯å®šä¹‰äº`basic_ostream<char>`ï¼Œå³ostreamçš„å¯¹è±¡ã€‚\nå…³äºè¯¦ç»†çš„ï¼š[ostream](https://legacy.cplusplus.com/reference/ostream/ostream/)\n# ostreamçš„æ–¹æ³•\n## widthæ–¹æ³•æ§åˆ¶æ•°å­—å®½åº¦\n\ncoutæœ¬èº«æœ‰ä¸€äº›æ–¹æ³•ï¼Œæ¯”å¦‚widthå°±æ˜¯ã€‚é€šè¿‡`std::cout.width(n)`è¿›è¡Œè°ƒç”¨ã€‚\nè¿™ä¸ªå˜é‡æ˜¯ç»§æ‰¿äº`std::ios_base`å¾—æ¥çš„ã€‚[std::ios_base::width - cppreference.com](https://en.cppreference.com/w/cpp/io/ios_base/width)\n\n```cpp\nint main()\n{\n    int val = 90;\n    std::cout.width(10);\n    std::cout << val << std::endl;\n    return 0;\n}\n```\nè¾“å‡ºï¼š\n```\n12345678\n        90\n```\nå¯ä»¥çœ‹åˆ°ï¼Œwidthä¸º10æ—¶ï¼Œå¦‚æœä¸è¶³10ä¸ªå­—ç¬¦ï¼Œåˆ™å‰é¢ç©ºå‡ºè¡¥ä½ã€‚\n## precisionæ–¹æ³•æ§åˆ¶æµ®ç‚¹æ•°çš„ç²¾åº¦\n[precision](https://legacy.cplusplus.com/ios_base::precision)\nå’Œwidthä¸€æ ·ï¼Œæ˜¯coutçš„æ–¹æ³•ã€‚\n```cpp\n#include<iostream>\nint main()\n{\n    double f = 3.14159;\n    std::cout.precision(5);\n    std::cout << f << std::endl;\n}\n```\noutput:\n```\n3.1416\n```\n# åŸºäºæµæ’å…¥çš„å½¢å¼è¿›è¡Œçš„å­—ç¬¦æ§åˆ¶\n## ostreamä¸­çš„pf\nhttps://legacy.cplusplus.com/reference/ostream/ostream/operator%3C%3C/\npfæ˜¯`<<`æ–¹æ³•ä¸­å€¼å¾—æ³¨æ„çš„å‚æ•°ã€‚pfæ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆã€‚å¯ä»¥å¡«å…¥ä¸åŒçš„æ“ä½œç¬¦ï¼ˆmanipulatorï¼‰ã€‚\n![](../../images/Cpp_æµå¼IOå¤„ç†/image-20250308142525262.png)\n## æ“ä½œç¬¦ï¼ˆmanipulatorï¼‰\n### endl\nå…¶å®æˆ‘ä»¬æœ€å¸¸è§çš„`std::endl`å°±æ˜¯ä¸€ä¸ªã€‚\n```cpp\n// Defined in header <ostream>\nostream& endl (ostream& os);\n```\nå¯ä»¥çœ‹åˆ°ï¼Œendlå®é™…ä¸Šæ˜¯ä¸€ä¸ªå‡½æ•°ã€‚ä½œç”¨æ˜¯å¾€coutå†™å…¥ä¸€ä¸ª`\\n`ï¼Œç„¶åflushä¸€ä¸‹coutï¼Œæœ€åå†è¿”å›coutã€‚\n### boolalphaæ§åˆ¶boolè¾“å‡ºå½¢å¼\n\né™¤äº†endlè¿™ä¸ªmanipulatorï¼Œè¿˜æœ‰å…¶ä»–æ›´ä¸“ç”¨çš„ã€‚å¦‚`boolalpha / noboolalpha`ã€‚ï¼ˆå®šä¹‰äºæ ‡å‡†åº“æ ‡å¤´`<ios>`ï¼‰\né»˜è®¤ä¸‹çš„boolç±»å‹ï¼šfalseè¾“å‡º0ï¼Œtrueè¾“å‡º1ã€‚æ’å…¥boolalphaåï¼Œå°±ä¼šfalseè¾“å‡ºfalseã€trueè¾“å‡ºtrueã€‚è€Œä¸”ä¸€æ—¦æ’å…¥äº†boolalphaï¼Œå°±ä¼šæŒç»­ä¿æŒçŠ¶æ€ï¼Œå› ä¸ºcoutæ˜¯ä¸€ä¸ªå…¨å±€å¯¹è±¡ã€‚å¦‚æœè¦æ¢å¤åŸæ€éœ€è¦å†æ¬¡æ’å…¥noboolalphaã€‚\n```cpp\nint main()\n{\n    bool d{ false };\n    // é»˜è®¤ä¸‹çš„boolç±»å‹ï¼šfalseè¾“å‡º0ï¼Œtrueè¾“å‡º1\n    std::cout << d << std::endl;\n    // æ’å…¥boolalphaåï¼Œå°±ä¼šfalseè¾“å‡ºfalseã€trueè¾“å‡ºtrueã€‚\n    std::cout << std::boolalpha << d << std::endl;\n    // æ’å…¥noboolalphaåï¼Œå°±ä¼šfalseè¾“å‡º0ã€trueè¾“å‡º1ã€‚\n    std::cout << std::noboolalpha << d << std::endl;\n}\n```\n### setw\nåœ¨`<iomanip>`å®šä¹‰çš„`std::setw`ä¹Ÿå¯ä»¥æ§åˆ¶widthï¼š\n[std::setw - cppreference.com](https://en.cppreference.com/w/cpp/io/manip/setw)\n\n>setwæ˜¯ä¸€ä¸ªæ‰©å±•çš„manipulatorã€‚éœ€è¦å¦å¤–å¼•å…¥`<iomanip>`\n\nå®ƒä¹Ÿå¯ä»¥æ§åˆ¶å®½åº¦ï¼Œä½†è¾ƒäºwidthï¼Œå®ƒæ˜¯åŸºäºæµæ’å…¥çš„å½¢å¼è¿›è¡Œçš„ã€‚é€šè¿‡`std::setw(n)`è¿›è¡Œã€‚\n```cpp\n#include<iostream>\n#include<iomanip>\nint main()\n{\n    std::cout << std::setw(6) << std::right << -77 << '\\n';\n}\n```\noutput:\n```cpp\n   -77\n```\n### leftã€rightã€internal\nå¯ä»¥é…åˆinternalã€leftã€rightè¿›è¡Œå¯¹é½ã€‚ï¼ˆfrom `<ios>`ï¼‰\n[std::left, std::right, std::internal - cppreference.com](https://en.cppreference.com/w/cpp/io/manip/left)\n1. internalæ˜¯ç¬¦å·å·¦ã€æ•°å­—å³ï¼›\n2. leftæ˜¯ç¬¦å·å’Œæ•°å­—æ•´ä½“å·¦ï¼›\n3. rightæ˜¯ç¬¦å·å’Œæ•°å­—æ•´ä½“å³ã€‚\n### ç¤ºä¾‹\nç»è¿‡æµ‹è¯•ï¼Œå¿…é¡»æ¯æ¬¡éƒ½äº‹å…ˆè®¾ç½®widthï¼Œæ‰èƒ½æœ‰æ•ˆæœã€‚\n```cpp\nint main()\n{\n    int n = -77;\n    std::cout.width(6);\n    std::cout << std::internal << n << '\\n';\n    std::cout.width(6);\n    std::cout << std::left << n << '\\n';\n    std::cout.width(6);\n    std::cout << std::right << n << '\\n';\n}\n```\noutput:\n```cpp\n-   77\n-77   \n   -77\n```\n### setprecision\n[std::setprecision - cppreference.com](https://en.cppreference.com/w/cpp/io/manip/setprecision)\nsetprecisionä¹Ÿæ˜¯ä¸€ä¸ªæ‰©å±•çš„manipulatorã€‚ï¼ˆfrom `<iomanip>`ï¼‰\nå’Œprecisionæ–¹æ³•ä¸€æ ·ï¼Œå¯ä»¥ç”¨äºæ§åˆ¶æ•°å­—çš„ç²¾åº¦ï¼Œä½†setprecisionæ˜¯åŸºäºæ’å…¥å½¢å¼çš„ã€‚\n```cpp\n#include<iostream>\n#include<iomanip>\nint main()\n{\n    double f = 3.14159;\n    std::cout << std::setprecision(5) << f << '\\n';\n    std::cout << std::setprecision(9) << f << '\\n';\n    std::cout << std::fixed;\n    std::cout << std::setprecision(5) << f << '\\n';\n    std::cout << std::setprecision(9) << f << '\\n';\n}\n```\noutput:\n```cpp\n3.1416\n3.14159\n// fixed\n3.14159\n3.141590000\n```\n### æ§åˆ¶æ•°å­—ç±»å‹çš„è¾“å‡º\n\nè¿˜æœ‰showbaseã€showpointã€showposã€uppercaseã€`dec / hex / oct`ç­‰ç­‰ï¼ˆfrom `<ios>`ï¼‰\n\n`dec / hex / oct`çš„ä½œç”¨åœ¨äºæ§åˆ¶è¾“å‡ºæ•°å­—ç±»å‹çš„è¿›åˆ¶ã€‚æ¯”å¦‚\n```cpp\nint main()\n{\n    std::cout << std::hex << 10 << '\\n';   // a\n}\n```\n\nshowbaseçš„ä½œç”¨åœ¨äºè¾“å‡ºæ—¶ä¸åŒè¿›åˆ¶æ•°åŠ å‰ç¼€ï¼Œæ¯”å¦‚å¼€å¯äº†showbaseåï¼Œè¾“å‡º16è¿›åˆ¶æ•°ï¼š\n```cpp\nint main()\n{\n    int n = 20;\n    std::cout << std::hex << std::showbase << n << '\\n';   //0x14\n    std::cout << std::hex << std::noshowbase << n << '\\n'; //14\n}\n```\n\nuppercaseçš„ä½œç”¨æ˜¯è¾“å‡º**æ•°å­—ç±»å‹**æ—¶ï¼ŒåŒºåˆ†å¤§å°å†™æ ¼å¼ã€‚æ¯”å¦‚å¼€å¯uppercaseå16è¿›åˆ¶æ•°`0x4d`å°±ä¼šå˜ä¸º`0X4D`ã€‚\n```cpp\nint main()\n{\n    std::cout << std::showbase << std::hex;\n    std::cout << std::uppercase << 77 << '\\n';   //0X4D\n    std::cout << std::nouppercase << 77 << '\\n'; //0x4d\n}\n```\n### fixed\nå½“Â floatfieldÂ è®¾ç½®ä¸ºÂ fixedÂ æ—¶ï¼Œæµ®ç‚¹å€¼å°†ä½¿ç”¨**å®šç‚¹è¡¨ç¤ºæ³•**å†™å…¥ï¼šè¯¥å€¼çš„å°æ•°éƒ¨åˆ†ä½æ•°ä¸ç²¾åº¦å­—æ®µ(Â [precision](https://legacy.cplusplus.com/ios_base::precision)Â ) æŒ‡å®šçš„ä½æ•°å®Œå…¨ç›¸åŒï¼Œå¹¶ä¸”æ²¡æœ‰æŒ‡æ•°éƒ¨åˆ†ã€‚\n### é»˜è®¤æµ®ç‚¹è¡¨ç¤ºæ³•ã€å®šç‚¹è¡¨ç¤ºæ³•ã€ç§‘å­¦è®¡æ•°æ³•\né»˜è®¤æµ®ç‚¹è¡¨ç¤ºæ³•å’Œå®šç‚¹è¡¨ç¤ºæ³•ä»¥åŠç§‘å­¦è®¡æ•°æ³•ä¹‹é—´æœ‰æ‰€ä¸åŒï¼ˆè¯·å‚é˜… [precision](https://legacy.cplusplus.com/ios_base::precision) ï¼‰ã€‚åœ¨é»˜è®¤æµ®ç‚¹è¡¨ç¤ºæ³•ä¸­ï¼Œç²¾åº¦å­—æ®µæŒ‡å®šå°æ•°ç‚¹å‰åæ˜¾ç¤ºçš„æ˜¯æœ€å¤§æœ‰æ„ä¹‰ä½æ•°ï¼Œè€Œåœ¨å®šç‚¹è¡¨ç¤ºæ³•å’Œç§‘å­¦è®¡æ•°æ³•ä¸­ï¼Œç²¾åº¦å­—æ®µç²¾ç¡®æŒ‡å®šå°æ•°ç‚¹åæ˜¾ç¤ºå¤šå°‘ä½æ•°å­—ï¼Œå³ä½¿è¿™äº›æ•°å­—æ˜¯å°æ•°ç‚¹åçš„é›¶ã€‚\n```cpp\n// modify floatfield\n#include <iostream>     // std::cout, std::fixed, std::scientific\n\nint main () {\n  double a = 3.1415926534;\n  double b = 2006.0;\n  double c = 1.0e-10;\n\n  std::cout.precision(5);\n\n  std::cout << \"default:\\n\";\n  std::cout << a << '\\n' << b << '\\n' << c << '\\n';\n\n  std::cout << '\\n';\n\n  std::cout << \"fixed:\\n\" << std::fixed;\n  std::cout << a << '\\n' << b << '\\n' << c << '\\n';\n\n  std::cout << '\\n';\n\n  std::cout << \"scientific:\\n\" << std::scientific;\n  std::cout << a << '\\n' << b << '\\n' << c << '\\n';\n  return 0;\n}\n```\noutput:\n```\ndefault:\n3.1416\n2006\n1e-010\n\nfixed:\n3.14159\n2006.00000\n0.00000\n\nscientific:\n3.14159e+000\n2.00600e+003\n1.00000e-010\n```\n# åŸºäºæµæå‡ºçš„å½¢å¼\n`>>`ç§°ä½œæµæå‡ºè¿ç®—ç¬¦ï¼ˆextraction operatorï¼‰ã€‚\n## istreamä¸­çš„pf\n![](../../images/Cpp_æµå¼IOå¤„ç†/image-20250308193423855.png)\nå¯ä»¥çœ‹åˆ°ï¼Œç›¸æ¯”äºostreamçš„pfï¼Œistreamä¸­çš„å¯é€‰é¡¹å°‘äº†ä¸€äº›ã€‚\n1. boolalphaï¼Œå¯ä»¥é€šè¿‡è¾“å…¥falseã€trueå­—ç¬¦ä¸²ä»è€Œç»™boolå˜é‡å†™å€¼çš„æ“ä½œã€‚\n2. `dec/hex/oct`ï¼Œå¯ä»¥é€šè¿‡è¾“å…¥åè¿›åˆ¶ã€åå…­è¿›åˆ¶ã€å…«è¿›åˆ¶æ•°å­—è¿›è€Œç»™æ•´å‹å˜é‡å†™å€¼ã€‚","categories":["Cpp"]},{"title":"ç½‘ç»œ_é…ç½®ç½‘å¡","url":"/ç½‘ç»œ/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/","content":"# åŒæ—¶å¯ç”¨ä¸¤ä¸ªç½‘å¡æ—¶å¦‚ä½•åˆ†æµ\n```\nEthernet adapter K20 Pro:\n\n   Connection-specific DNS Suffix  . :\n   IPv6 Address. . . . . . . . . . . : 240e:404:b731:3135:295c:a44f:73e8:7ab8\n   Temporary IPv6 Address. . . . . . : 240e:404:b731:3135:d4b7:5350:f5c7:bc25\n   Link-local IPv6 Address . . . . . : fe80::687:6:df5d:ea58%28\n   IPv4 Address. . . . . . . . . . . : 192.168.173.153\n   Subnet Mask . . . . . . . . . . . : 255.255.255.0\n   Default Gateway . . . . . . . . . : fe80::18c8:bfff:fe13:c1c2%28\n                                       192.168.173.248\nEthernet adapter School Net:\n\n   Connection-specific DNS Suffix  . : proxy.bjut.edu.cn\n   IPv6 Address. . . . . . . . . . . : 2001:da8:216:210f:954a:ccee:b328:8b0f\n   Temporary IPv6 Address. . . . . . : 2001:da8:216:210f:2989:37b0:8612:84fd\n   Link-local IPv6 Address . . . . . : fe80::46e4:b62a:f433:24cf%13\n   IPv4 Address. . . . . . . . . . . : 172.21.15.227\n   Subnet Mask . . . . . . . . . . . : 255.255.255.0\n   Default Gateway . . . . . . . . . : fe80::21b:53ff:fe4a:997f%13\n                                       172.21.15.254\n   DNS: 172.21.0.21 (Unencrypted) 172.21.201.22 (Unencrypted)\n```\nè‡ªå·±çš„ç½‘å¡Açš„ç½‘å…³ä¸º192.168.175.219ï¼Œæ ¡å›­ç½‘ç½‘å¡Bçš„ç½‘å…³ä¸º172.21.15.254\n\n1. è¾“å…¥`route print`æˆ‘ä»¬èƒ½çœ‹åˆ°æœ¬æœºç›®å‰çš„è·¯ç”±è¡¨\n2. ä½¿ç”¨`route delete`åˆ é™¤æ‰€æœ‰0.0.0.0çš„è·¯ç”±,ä¹Ÿå°±æ˜¯é»˜è®¤è®¾ç½®ï¼Œåˆ é™¤é»˜è®¤è·¯ç”±åæ— æ³•ä¸Šç½‘ã€‚\n   ```\n   route delete 0.0.0.0\n   route delete ::/0\n   ```\n3. æ·»åŠ è·¯ç”±è¡¨ï¼ŒæŒ‡å®šä½¿ç”¨ç½‘å¡Bè®¿é—®ç‰¹å®šçš„IPã€‚è®¾ç½®å®Œåå› ä¸ºæˆ‘ä»¬æŠŠé»˜è®¤è·¯ç”±åˆ äº†ï¼Œæ‰€æœ‰å°±åªèƒ½è®¿é—®è¯¥åœ°å€ã€‚\n   ```\n   route -p add 172.30.201.2 mask 255.255.255.0 172.21.15.254 METRIC 1\n   ```\n    1. -p æ˜¯ä¸ºäº†è®¾ç½®ä¸ºé™æ€æ°¸ä¹…è·¯ç”±ï¼Œé˜²æ­¢é‡å¯æ—¶é…ç½®æ¶ˆå¤±\n    2. add æ·»åŠ è·¯ç”±\n    3. 1.1.1.1 æŒ‡å®šç½‘å¡è®¿é—®çš„IP\n    4. 255.255.255.0æ˜¯ç½‘å…³æ©ç \n    5. 172.21.15.254æŒ‡å®šä½¿ç”¨ç½‘å¡Bçš„ç½‘å…³è®¿é—®è¯¥åœ°å€\n    6. METRIC è·ƒç‚¹æ•°ï¼Œè·ƒç‚¹æ•°è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼ŒèŒƒå›´1~9999ï¼Œé»˜è®¤å°±æ˜¯1\n4. è®¾ç½®é»˜è®¤è·¯ç”±ï¼Œæ¢å¤ä¸Šç½‘\n    1. è®¾ç½®æ ¡å›­ç½‘å¡Bçš„é»˜è®¤è·¯ç”±ï¼Œè·ƒç‚¹æ•°ä¸º200ï¼ŒæŒ‡å®šIPèµ°é»˜è®¤è·¯ç”±ï¼Œæ‰èƒ½ä¸Šæ ¡å›­ç½‘\n       ```\n       route -p add 0.0.0.0 mask 0.0.0.0 172.21.15.254 METRIC 200\n       route -p add ::/0 mask ::/0 fe80::21b:53ff:fe4a:997f METRIC 200\n       ```\n    2. ç°åœ¨ç½‘å¡Bä¸Šä¸äº†éæ ¡å›­ç½‘ï¼Œæ‰€ä»¥è¦è®¾ç½®ç½‘å¡Bçš„é»˜è®¤è·¯ç”±ï¼Œè·ƒç‚¹æ•°ä¸º100ï¼Œè¦æ¯”200å°ã€‚å› æ­¤é»˜è®¤ä½¿ç”¨ç½‘å¡Aä¸Šç½‘ï¼Œè€Œä¸æ˜¯ç½‘å¡Bã€‚\n       ```\n       route -p add 0.0.0.0 mask 0.0.0.0 192.168.173.248 METRIC 100\n       route -p add ::/0 mask ::/0 fe80::f435:31ff:fe10:28af METRIC 100\n       ```\n    3. æ­¤æ—¶ç½‘å¡Aå’ŒBåŒæ—¶ä½¿ç”¨æ—¶ä¼˜å…ˆä½¿ç”¨ç½‘å¡Aã€‚\n5. å¦‚æœè®¾ç½®å‡ºé—®é¢˜äº†è¯·ç”¨ä¸‹é¢å‘½ä»¤è¿›è¡Œè§£å†³ã€‚\n   ```\n   NETSH INT IP RESET  ï¼ˆé‡ç½®IPè®¾ç½®ï¼‰\n   NETSH WINSOCK RESET ï¼ˆé‡ç½®ç½‘ç»œè®¾ç½®ï¼‰\n   NETSH WINHTTP RESET PROXY  ï¼ˆé‡ç½®ä»£ç†è®¾ç½®ï¼‰\n   IPCONFIG /FLUSHDNS  ï¼ˆåˆ·æ–°DNSç¼“å­˜ï¼‰\n   ```\n\n# æ ¡å›­ç½‘ç½‘å€\n\n| ç½‘å€               | IP                     |\n| ---------------- | ---------------------- |\n| lgn.bjut.edu.cn  | 172.30.201.2           |\n| lgn6.bjut.edu.cn | [2001:da8:216:30c9::a] |\n| my.bjut.edu.cn   | 172.21.94.12           |\n# OpenWrtçš„é…ç½®\nä¸ºäº†æ­£ç¡®ä½¿ç”¨IPV6ã€‚\n\nå‚è€ƒæ–‡ç« ï¼š[OpenWRT è·¯ç”±å™¨IPv6å®æˆ˜é…ç½®é•¿ç¯‡æ•™ç¨‹](https://post.smzdm.com/p/awzodmpp/)\n\né¦–å…ˆç»™è¿·ä½ ä¸»æœºåˆ·æœºï¼Œå®‰è£…OpenWrtç³»ç»Ÿã€‚\nå‚è€ƒ[å¤§æ²³ææ–¯ç‰¹è§†é¢‘å·¥ä½œå®¤](https://space.bilibili.com/12562485/)\n\næ³¨æ„æ‰‹è¾¹éœ€è¦æœ‰ä¸€ä¸ªæ˜¾ç¤ºå™¨ã€æœ‰çº¿é”®ç›˜ï¼Œç”¨äºè¿›PEåˆ·æœºã€æ˜¾æ“ä½œç»ˆç«¯ç•Œé¢ã€‚\n\nå¯ä»¥åœ¨åˆ·æœºåè¿›OpenWrtç³»ç»Ÿåï¼š\n1. è®¾ç½®rootç®¡ç†å‘˜å¯†ç \n\n```sh\npasswd\n```\n2. ä¿®æ”¹wanã€lanæ¥å£å·ã€‚å»ºè®®æŠŠwanã€wan6è®¾ç½®ä¸ºeth0ï¼Œlanè®¾ç½®ä¸ºeth1ã€‚\n\n```sh\nvim /etc/config/network\n```\n3. è®¾ç½®å®Œårebootã€‚lanå£ç½‘çº¿æ’å…¥ä¸»PCç»ˆç«¯æˆ–è€…APè·¯ç”±å™¨å³å¯åœ¨ç»ˆç«¯è®¿é—®`192.168.5.1`ä»¥è¿œç¨‹æ“ä½œOpenWrtäº†ã€‚\n\n```sh\nreboot\n```\n## ç½‘ç»œ-æ¥å£é…ç½®\nWANå£é…ç½®å¦‚ä¸‹ï¼š\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823020934427.png)\n\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823020949117.png)\n\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823021000464.png)\n\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823021007455.png)\n\nWAN6å£é…ç½®å¦‚ä¸‹ï¼š\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823021025883.png)\n\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823021032265.png)\n\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823021037823.png)\n\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823021043740.png)\n\nLANå£è®¾ç½®å¦‚ä¸‹ï¼š\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823021109711.png)\n\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823021129468.png)\n\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823021136612.png)\n\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823021144590.png)\n\nLANå£é¡µé¢ä¸‹é¢çš„DHCPæœåŠ¡é…ç½®ï¼š\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823021206064.png)\n\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823021210784.png)\n\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823021217626.png)\n\n## ç½‘ç»œ-DHCP/DNSé…ç½®\né‡ç‚¹æ³¨æ„ï¼šç”±äºæ ¡å›­ç½‘ç¯å¢ƒéœ€è¦å…ˆåœ¨lgnç½‘å…³è¿›è¡Œç”¨æˆ·ç™»å½•ï¼Œæ¯”å¦‚åœ¨ä¸€ä¸ª172å¼€å¤´çš„å†…ç½‘è¿›è¡Œï¼Œè€Œè¦ç”¨çš„æ˜¯lgn.bjut.edu.cnæ¥è®¿é—®ï¼Œéœ€è¦ç”¨åˆ°è‡ªåŠ¨è·å–çš„æ ¡å›­ç½‘DNSæ¥è§£æã€‚\n\nåœ¨`DHCP/DNS`é…ç½®é¡µé¢ä¸­ï¼ˆæœåŠ¡å™¨è®¾ç½®-åŸºæœ¬è®¾ç½®ï¼‰ï¼Œæœ‰ä¸€é¡¹â€œé‡ç»‘å®šä¿æŠ¤â€éœ€è¦å–æ¶ˆå‹¾é€‰ï¼ä¸ç„¶æ— æ³•ä½¿ç”¨å†…ç½‘çš„DNSï¼Œæ— æ³•è®¿é—®å†…ç½‘åœ°å€ã€‚\n\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823021743551.png)\n\nè¿˜æœ‰ä¸€é¡¹ï¼Œå¦‚æœè¦ä½¿ç”¨IPV6ç¯å¢ƒï¼ŒåŠ¡å¿…æŠŠ`é«˜çº§è®¾ç½®`ä¸­çš„â€œç¦æ­¢è§£æ IPV6 DNS è®°å½•â€å–æ¶ˆå‹¾é€‰ã€‚å¦åˆ™æ— æ³•è®¿é—®IPV6ç½‘å€ï¼ˆå¦‚lgn6.bjut.edu.cnï¼‰ã€‚\nå…¶ä»–é»˜è®¤å³å¯ã€‚\n\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823021948491.png)\n\n## ç½‘ç»œ-é˜²ç«å¢™é…ç½®\nç›®å‰ä¸ç¡®å®šæ ¡å›­ç½‘ç¯å¢ƒä¸‹ä½¿ç”¨OpenWrtæ—¶é˜²ç«å¢™çš„é»˜è®¤é…ç½®æ˜¯å¦æœ‰å½±å“ã€‚\n\né»˜è®¤ä¸‹æ˜¯è¿™æ ·çš„ï¼š\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823022413512.png)\n\nä¿®æ”¹åæ˜¯è¿™æ ·çš„ï¼Œå³æŠŠåŸºæœ¬è®¾ç½®çš„â€œè½¬å‘â€æ”¹ä¸ºæ¥å—ã€‚wanå£çš„â€œå…¥ç«™â€ã€â€œè½¬å‘â€ä¹Ÿæ”¹ä¸ºæ¥å—ã€‚\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823022447143.png)\né™¤äº†åŸºæœ¬è®¾ç½®ä»¥å¤–ï¼Œå…¶ä»–çš„éƒ½é»˜è®¤ã€‚\n# APè·¯ç”±å™¨é…ç½®\nåœ¨å¼€å¯æœ‰çº¿ä¸­ç»§æ—¶ï¼Œæ€»æ˜¯ä¼šå‡ºç°è«åå…¶å¦™çš„Bugã€‚æ¯”å¦‚åªæœ‰æŸä¸€ä¸ªç”µè„‘èƒ½æ­£å¸¸è®¿é—®lgn6.bjut.edu.cnä»¥åŠlgn.bjut.edu.cnï¼Œå…¶ä»–ç”µè„‘åˆ™åªèƒ½è®¿é—®lgn.bjut.edu.cnã€‚æ›´æœ‰ä¸€ç§å¥‡è‘©çš„ç°è±¡æ˜¯é‚£ä¸ªèƒ½æ­£å¸¸è®¿é—®IPV6çš„ç”µè„‘æœ‰æ—¶ä¼šæ— æ³•è®¿é—®lgn.bjut.edu.cnï¼Ÿ\n\næ‰€ä»¥å¹²è„†å°±å¼€å¯æ­£å¸¸çš„è·¯ç”±å™¨æ¨¡å¼å§ï¼å®æµ‹åœ¨BJUTçš„æ ¡å›­ç½‘ç¯å¢ƒä¸‹ï¼Œä¸ä¼šé€ æˆå¤šè®¾å¤‡è¯†åˆ«ã€‚ç½‘å…³åå°çš„åœ¨ç½‘è®¾å¤‡åªæ˜¾ç¤ºäº†ä¸€æ¡è®¾å¤‡è®°å½•ã€‚\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823023037664.png)\nè·¯ç”±å™¨å‹å·ï¼šRedmiè·¯ç”±å™¨ AX6000\nç³»ç»ŸROMç‰ˆæœ¬ï¼šMiWiFi ç¨³å®šç‰ˆ 1.0.67\n## è®¾ç½®\nå¸¸ç”¨è®¾ç½®-ä¸Šç½‘è®¾ç½®ä¸­ï¼š\nä¸Šç½‘è®¾ç½®ï¼Œé»˜è®¤æ˜¯DHCPã€‚ä¿æŒä¸åŠ¨ã€‚\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823023212834.png)\nIPV6ç½‘ç»œè®¾ç½®ï¼Œéœ€è¦æ‰“å¼€ï¼Œä¿®æ”¹ä¸Šç½‘æ–¹å¼ä¸ºNAT6ã€‚\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823023226433.png)\nå…¶ä»–ä¿æŒä¸å˜ã€‚\n\næ­£å¸¸çŠ¶æ€ä¸‹ï¼Œä¸Šç½‘ä¿¡æ¯å¦‚ä¸‹æ˜¾ç¤ºï¼š\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823023329342.png)\nè‡³æ­¤ï¼Œåªè¦ä¸€ä¸ªè®¾å¤‡è¿æ¥äº†æ­¤è·¯ç”±å™¨ï¼Œåœ¨lgn6.bjut.edu.cnè¿›è¡ŒIPV6ã€IPV4ç»Ÿä¸€è®¤è¯åï¼Œå…¶ä»–è®¾å¤‡ç›´æ¥è¿æ¥æ­¤è·¯ç”±å™¨å³å¯åŒæ ·åœ°æŒ‰ç…§ç»Ÿä¸€çš„æ–¹å¼ä¸Šç½‘ï¼Œå¹¶ä¸”æ— éœ€å†è¿›è¡Œè®¤è¯ã€‚\n# OpenClashé…ç½®\né€šè¿‡ä»¥ä¸Šçš„é…ç½®ï¼Œè¾¾åˆ°äº†è½¯è·¯ç”±+APè·¯ç”±å™¨å¯ä»¥å¤šè®¾å¤‡ä¾èµ–APè·¯ç”±å™¨çš„IPV4ã€IPV6åŒæ—¶ä¸Šç½‘ã€‚\nä»¥ä¸‹ï¼Œæ¥é…ç½®OpenClashï¼Œè¾¾åˆ°ä¸æ»‘çš„ä»£ç†ä¸Šç½‘æ•ˆæœã€‚\n## ä¸‹è½½å†…æ ¸æ–‡ä»¶\nåœ¨â€œæœåŠ¡-OpenClashâ€ä¸­ï¼Œè¿›å…¥OpenClashé¡µé¢ã€‚\né¦–å…ˆè¦ä¸‹è½½å†…æ ¸ã€‚\nå…¶è‡ªå¸¦çš„ä¸‹è½½ä¸å¥½ç”¨ï¼Œç½‘ç»œå·®æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨ä¸‹è½½ã€‚\nåœ¨â€œæ’ä»¶è®¾ç½®-ç‰ˆæœ¬æ›´æ–°â€é¡µé¢ï¼Œä¾æ¬¡ç‚¹å‡»3ä¸ªClashå†…æ ¸å¯¹åº”çš„â€œä¸‹è½½åˆ°æœ¬åœ°â€ã€‚ä¼šä»Githubä¸Šä¸‹è½½3ä¸ªtar.gzå‹ç¼©åŒ…åˆ°ä½ ç°åœ¨çš„ç»ˆç«¯æœºã€‚æ¯”å¦‚Windowsç”µè„‘ã€‚\næˆ‘ä»¬å¯ä»¥æŠŠå®ƒè§£å‹åï¼Œé€šè¿‡OpenWrtä¸­çš„â€œç³»ç»Ÿ-æ–‡ä»¶ä¼ è¾“â€ä¾æ¬¡ä¸Šä¼ åˆ°`/tmp/upload`ã€‚\nä¸Šä¼ åï¼Œåœ¨Windowsç»ˆç«¯è¿›è¡Œsshè¿œç¨‹è¿æ¥OpenWrtã€‚\n```sh\nssh root@192.168.5.1\n```\nå¦‚æœå¼¹å‡ºäº†ç§é’¥ç›¸å…³çš„ä¿¡æ¯ï¼Œåˆæ¬¡è®¿é—®çš„è¯ï¼Œæ‰“ä¸€ä¸ªyeså³å¯ã€‚\nï¼ˆä¹Ÿå¯ä»¥åœ¨â€œç³»ç»Ÿ-TTYD ç»ˆç«¯â€æ“æ§OpenWrtç»ˆç«¯ï¼‰\nè¿›å…¥ç»ˆç«¯åï¼ŒæŠŠåˆšæ‰ä¸Šä¼ çš„æ–‡ä»¶ç§»åŠ¨åˆ°3ä¸ªå†…æ ¸åˆ†åˆ«å¯¹åº”çš„ä½ç½®ã€‚\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823024534391.png)\n\n```sh\nmv /tmp/upload/clash /etc/openclash/core/clash\nmv /tmp/upload/clash_tun /etc/openclash/core/clash_tun\nmv /tmp/upload/clash_meta /etc/openclash/core/clash_meta\n```\nç§»åŠ¨å®Œåï¼Œå‘ç°OpenClashä¸èƒ½è¯†åˆ«ã€æ‰§è¡Œæ­¤æ–‡ä»¶ï¼Œéœ€è¦æ”¹å˜æƒé™ã€‚\n```\nchmod 777 clash\nchmod 777 clash_tun\nchmod 777 clash_meta\n```\n## é…ç½®è®¢é˜…\nç³»ç»Ÿ-OpenClash-é…ç½®è®¢é˜…\næ·»åŠ ã€‚é…ç½®æ–‡ä»¶åå†™ä¸€ä¸ªå¥½è¾¨è¯†çš„ï¼Œè®¢é˜…åœ°å€æŒ‰å®é™…çš„å†™ã€‚ä¸€èˆ¬Clashèƒ½ç”¨çš„ï¼Œéƒ½å¯ä»¥ã€‚\nå¡«å®Œåï¼Œä¿å­˜é…ç½®ã€‚\nä¸Šé¢çš„è‡ªåŠ¨æ›´æ–°ï¼Œå‹¾é€‰ï¼Œæ›´æ–°æ¨¡å¼é€‰æ‹©â€œå¾ªç¯â€ï¼Œé—´éš”1440åˆ†é’Ÿã€‚\nå¡«å®Œåï¼Œä¿å­˜é…ç½®ã€‚æœ€åç‚¹æ›´æ–°é…ç½®ã€‚\n## é…ç½®ä¸Šç½‘æ¨¡å¼\nFake-IPåœ¨æŸäº›é™åˆ¶æ¯”è¾ƒå¼ºçš„ç½‘ç«™ï¼ˆå¦‚ChatGPTï¼‰ï¼Œå¯èƒ½è¡¨ç°å¾—æ›´å¥½ã€‚\n\nç‚¹é¡µé¢ä¸‹é¢çš„â€œåˆ‡æ¢é¡µé¢åˆ°Fake-IPæ¨¡å¼â€ã€‚\n\nMetaå†…æ ¸ç›¸æ¯”å…¶ä»–å†…æ ¸æ¯”è¾ƒæ´»è·ƒï¼Œå¹¶ä¸”æ”¯æŒæ›´å¤šçš„ç‰¹æ€§ã€‚åœ¨æ¨¡å¼è®¾ç½®ä¸­ï¼Œå‹¾é€‰â€œä½¿ç”¨Metaå†…æ ¸â€ã€‚\n\nè¿è¡Œæ¨¡å¼ï¼Œé€‰æ‹©Fake-IPï¼ˆTUNï¼‰æ¨¡å¼ã€‚ï¼ˆå› ä¸ºæ®è¯´TUNè®¿é—®ç½‘é¡µçš„å“åº”é€Ÿåº¦æ›´å¿«ï¼‰\n\nç½‘ç»œæ ˆç±»å‹ï¼Œä¸‹é¢çš„å°å­—è¯´â€œè¯·è‡ªè¡Œæ ¹æ®è¿è¡Œé€Ÿåº¦ä¸º TUN æ¨¡å¼é€‰æ‹©åˆé€‚çš„ç½‘ç»œæ ˆâ€ï¼Œå½“å‰è½¯è·¯ç”±ä¸»æœºçš„èŠ¯ç‰‡é…ç½®è¿˜ç®—å¯ä»¥ï¼Œx86ä½“ç³»çš„ï¼Œå› æ­¤å¯ä»¥é€‰æ‹©\"Mixed\"å…ˆè¯•è¯•ã€‚\n\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823025746861.png)\n\næ¨¡å¼è®¾ç½®æ”¹å®Œäº†ã€‚å…ˆç‚¹ä¸‹é¢çš„ä¿å­˜é…ç½®ï¼Œåˆ«å¤ªå¿«åœ°ç‚¹åº”ç”¨é…ç½®ã€‚\n## æµé‡æ§åˆ¶\n\nå–æ¶ˆå‹¾é€‰â€œç¦ç”¨QUICâ€ï¼Œå› ä¸ºå®æµ‹å‹¾é€‰æ­¤é€‰é¡¹æ—¶æ— æ³•è®¿é—®Macç«¯çš„ChatGPT Appã€‚\n\nWANæ¥å£åç§°ã€LANæ¥å£åç§°åº”æ­£ç¡®é€‰æ‹©ï¼Œç›®å‰ç³»ç»Ÿçš„WANæ¥å£æ˜¯eth0ï¼ŒLANæ¥å£æ˜¯eth1ã€‚\n\nè‡³äºâ€œç»•è¿‡æœåŠ¡å™¨åœ°å€â€ã€â€œç»•è¿‡å¤§é™†IPâ€ï¼Œä¸ºäº†é¿å…é…ç½®è¿‡äºå¤æ‚ï¼Œå…ˆä¸å‹¾é€‰ã€‚\n\nå…¶ä»–çš„é»˜è®¤ä¸åŠ¨ã€‚ç‚¹å‡»ä¿å­˜é…ç½®ã€‚\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823030118691.png)\n## DNSè®¾ç½®\nç”±äºåœ¨æ ¡å›­ç½‘ç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œéœ€è¦é…ç½®å†…ç½‘DNSã€‚\nåœ¨DNSè®¾ç½®é¡µé¢ä¸­ï¼Œå‹¾é€‰â€œå¯ç”¨ç¬¬äºŒDNSæœåŠ¡å™¨â€ï¼ŒæŒ‡å®šæœåŠ¡å™¨ä¸º172.21.201.21ã€‚ï¼ˆBJUTçš„DNSæœ‰ä¸¤ä¸ªï¼Œ172.21.201.21å’Œ172.21.201.20ï¼‰\nä¸‹é¢çš„åŸŸååˆ—è¡¨å¡«å…¥ä¸€è¡Œï¼š`*.bjut.edu.cn`ã€‚\nç‚¹å‡»ä¿å­˜é…ç½®ã€‚\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823030355957.png)\nOpenClashæ¨èä½¿ç”¨Dnsmasqè½¬å‘ï¼Œä½†æ˜¯æ˜“ç”¨æ€§å®åœ¨éš¾ä»¥æ­ç»´ï¼Œåœ¨æ ¡å›­ç½‘ç¯å¢ƒä¸‹ï¼Œå…ˆè¿™æ ·å‡‘åˆç”¨å§ï¼\n## IPV6è®¾ç½®\nä¸ºäº†å¯ä»¥åœ¨ä»£ç†ä¸Šç½‘çš„åŒæ—¶æ”¯æŒIPV6ï¼Œéœ€è¦å‹¾é€‰â€œIPv6æµé‡ä»£ç†â€ã€â€œå…è®¸IPv6ç±»å‹DNSè§£æâ€ã€‚\né™¤æ­¤ä¹‹å¤–ï¼Œä¸ºäº†æ”¯æŒæ›´å¤šç½‘ç«™ï¼Œå‹¾é€‰â€œUDPæµé‡è½¬å‘â€ã€‚\nIPv6ä»£ç†æ¨¡å¼é€‰æ‹©â€œRedirectæ¨¡å¼â€ï¼Œå…·ä½“åŸå› å¿˜è®°äº†ã€‚\nå…¶ä»–é»˜è®¤ä¸å˜ï¼Œä¿å­˜é…ç½®ã€‚\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823030727179.png)\n## æœ€å\nåˆ«å¿˜äº†ç‚¹åº”ç”¨é…ç½®ï¼Œçœ‹çœ‹å¯åŠ¨æ•ˆæœã€ä¸Šç½‘æ•ˆæœã€‚\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823030832728.png)\n\nå¯ä»¥è¿›3ç§æ§åˆ¶é¢æ¿é€‰æ‹©èŠ‚ç‚¹ã€‚\n\n## å†æ¬¡DNSé…ç½®\nä¸å¹¸çš„æ˜¯ï¼Œæ ¹æ®æµ‹è¯•ï¼Œå³ä½¿å¯ç”¨äº†ç¬¬äºŒDNSï¼Œä¹Ÿæ— æ³•æ­£å¸¸è®¿é—®å†…ç½‘ï¼Œæ¯”å¦‚lgn.bjut.edu.cnã€my.bjut.edu.cnã€‚è€Œå¦‚æœè¾“å…¥IPåœ°å€å´èƒ½è®¿é—®ï¼Œæ˜¾ç„¶è¿˜æ˜¯DNSçš„é—®é¢˜ã€‚\n\né‚£ä¹ˆåªèƒ½åœç”¨â€œæ’ä»¶è®¾ç½®-DNSè®¾ç½®â€ä¸­çš„â€œæœ¬åœ°DNSåŠ«æŒâ€äº†ã€‚\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823032504633.png)\n\nä¹‹åï¼Œåœ¨â€œè¦†å†™è®¾ç½®-DNSè®¾ç½®â€ä¸­\n\nå‹¾é€‰â€œè‡ªå®šä¹‰ä¸Šæ¸¸DNSæœåŠ¡å™¨â€ã€â€œè¿½åŠ ä¸Šæ¸¸DNSâ€ã€‚\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823032555109.png)\n\nå¹¶åœ¨ä¸‹é¢â€œè®¾ç½®è‡ªå®šä¹‰ä¸Šæ¸¸ DNS æœåŠ¡å™¨â€æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰DNSã€‚\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823032622741.png)\n\n![](../../images/ç½‘ç»œ_æ ¡å›­ç½‘ç¯å¢ƒä¸‹çš„é…ç½®/image-20240823032631949.png)\n\nè‡³æ­¤ï¼Œä¿å­˜é…ç½®ã€åº”ç”¨é…ç½®ã€‚\nå°±å¯ä»¥è®¿é—®å†…ç½‘äº†ã€‚\n# æˆæœ\nå¯ä»¥å¤šè®¾å¤‡è¿æ¥APè·¯ç”±å™¨æ„‰å¿«åœ°ç½‘ä¸Šå†²æµªäº†ï¼\nå¹¶ä¸”å®æµ‹ï¼ŒæŒ‰ä»¥ä¸Šé…ç½®ï¼Œå¯ä»¥ä¸å…³é—­OpenClashçš„æƒ…å†µä¸‹ï¼Œç›´æ¥æ­é…â€œä¸‹è½½CDNé‡å®šå‘IPV6å·¥å…·åŒ…â€æ­£å¸¸ä½¿ç”¨ï¼","categories":["ç½‘ç»œ"]},{"title":"Floydå›¾ç®—æ³•ä¸­çš„åŠ¨æ€è§„åˆ’_Cè¯­è¨€å®ç°","url":"/ç®—æ³•/Floydå›¾ç®—æ³•ä¸­çš„åŠ¨æ€è§„åˆ’_Cè¯­è¨€å®ç°/","content":"# Floyd\n\nFloydæ˜¯å›¾çš„ç»å…¸ç®—æ³•ï¼Œå¯ä»¥ä½¿ç”¨åŠ¨æ€è§„åˆ’æ–¹æ³•è§£å†³ã€‚ä½†æ˜¯çœŸæ­£å†™å›¾æœç´¢ç®—æ³•æ—¶ä¸è¦ç”¨Floydç®—æ³•ï¼Œå› ä¸ºå®ƒæ¯”Dijkstraè¾ƒæ…¢ã€‚ä½†æ˜¯Floydå¯¹äºç®—æ³•æ€æƒ³çš„å¯å‘å¾ˆæœ‰ç ”ç©¶ä»·å€¼ã€‚å®ç”¨ä»·å€¼ã€ç ”ç©¶ä»·å€¼è¦è¾©è¯çœ‹ã€‚\n# å›¾\n\nå’Œæ ‘ä¸€æ ·ï¼Œæœ‰å¥½å¤šèŠ‚ç‚¹ï¼Œä½†æ²¡æœ‰æ ‘çš„è§„å¾‹ã€‚æ ‘æ˜¯å›¾çš„å­é›†ã€‚\n\n1. èŠ‚ç‚¹å’ŒèŠ‚ç‚¹ä¹‹é—´å¯ä»¥æ˜¯è¿é€šçš„ä¹Ÿå¯ä»¥æ˜¯ä¸è¿é€šçš„ã€‚\n2. è¿é€šçš„çº¿å¦‚æœæ²¡æœ‰æ–¹å‘åˆ™ç§°ä¹‹ä¸ºæ— å‘å›¾ï¼Œå¦‚æœæœ‰æ–¹å‘åˆ™ä¸ºæœ‰å‘å›¾ã€‚\n3. å¦‚æœæœ‰å¾ªç¯ï¼Œåˆ™æ˜¯æœ‰ç¯å›¾ï¼›å¦‚æœæ²¡æœ‰å¾ªç¯åˆ™æ˜¯æ— ç¯å›¾ã€‚\n\n1. èŠ‚ç‚¹çš„å‡ºåº¦ï¼šç¦»å¼€è¿™ä¸ªèŠ‚ç‚¹çš„çº¿çš„ä¸ªæ•°ï¼›\n2. èŠ‚ç‚¹çš„å…¥åº¦ï¼šè¿›å…¥è¿™ä¸ªèŠ‚ç‚¹çš„çº¿çš„ä¸ªæ•°ã€‚\n\nåº”ç”¨ï¼šåœ°å›¾ç®—æ³•ï¼Œæœç´¢ã€å¯»è·¯ï¼›è½¯ä»¶å·¥ç¨‹ä¸­Element Blockåˆ©ç”¨æœ‰å‘æ— ç¯å›¾è¿›è¡Œæ‹“æ‰‘æ’åºï¼Œæ ¹æ®ä¾èµ–å…³ç³»ã€å‰ç½®å…³ç³»è¿›è¡Œæ’åºã€‚ä½†æ˜¯è¿˜æ˜¯æ²¡æœ‰æ ‘çš„åº”ç”¨èŒƒå›´å¹¿ã€‚\n\nç½‘ç»œè·¯ç”±é€‰æ‹©ï¼šOSPFï¼ˆå¼€æ”¾å¼æœ€çŸ­è·¯å¾„ä¼˜å…ˆï¼‰ä¸­å°±ç”¨åˆ°äº†Dijkstraç®—æ³•ã€‚é…ç½®è·¯ç”±è¡¨ã€‚\n\n## æœ¯è¯­\n\n1. é€†æ—¶é’ˆï¼šCCW (Counter Clock Wise)\n2. é¡ºæ—¶é’ˆï¼šCW (Clock Wise)\n\n## è®¡ç®—æœºå¤„ç†å›¾å®é™…çš„æ•°æ®ç»“æ„\n\n![image-20240314012545833](../../images/Cè¯­è¨€_20240313_/image-20240314012545833.png)\n\n# Floyd - åŠ¨æ€è§„åˆ’æ€æƒ³\n\nä»æŸä¸€ç‚¹åˆ°æŸä¸€ç‚¹ï¼Œé€‰æ‹©é€šè·¯ï¼Œæ±‚æœ€çŸ­çš„è·¯å¾„é•¿åº¦ã€‚\n\nç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å§‹å‘èŠ‚ç‚¹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç›®çš„èŠ‚ç‚¹ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å¯ä»¥å‚ä¸çš„èŠ‚ç‚¹èŒƒå›´ï¼ˆå¦‚æœæ˜¯4ï¼Œåˆ™è¡¨ç¤º1ã€2ã€3ã€4èŠ‚ç‚¹å…¨éƒ½å¯ä»¥å‚ä¸ï¼‰ï¼Œå¦‚æœæ˜¯0çš„è¯ï¼Œè¡¨ç¤ºæ²¡æœ‰ä¸­é—´èŠ‚ç‚¹å‚ä¸ã€‚\n\næ¯”å¦‚è¯´ï¼š`floyd(from, to, n)`è¡¨ç¤ºï¼šä»èŠ‚ç‚¹fromèµ°åˆ°èŠ‚ç‚¹toï¼ŒèŠ‚ç‚¹1åˆ°nå¯ä»¥å‚ä¸ã€‚æ±‚æœ€çŸ­è·¯å¾„é•¿åº¦ã€‚\n\nè¿ç”¨èƒŒåŒ…é—®é¢˜çš„æ€æƒ³ã€‚\n\n```c\nfloyd(from, to, n)\n    ä¸é€‰æ‹©ç¬¬nèŠ‚ç‚¹ï¼šfloyd(from, to, n - 1)\n    é€‰æ‹©ç¬¬nèŠ‚ç‚¹ï¼š  floyd(from, n, n - 1) + floyd(n, to, n - 1)\n    æœ€ç»ˆç»“æœï¼šmin {ä¸é€‰æ‹©, é€‰æ‹©}\nç»ˆæ­¢æ¡ä»¶ï¼š\n    ï¼ˆ1ï¼‰æ²¡æœ‰èŠ‚ç‚¹å‚ä¸æ—¶ï¼Œå³n == 0 - ç»“æœå€¼ä¸ºæƒé‡è¡¨å¯¹åº”æ•°å€¼(æŸç‚¹ç›´æ¥åˆ°æŸç‚¹çš„è·ç¦»)\n    ï¼ˆ2ï¼‰from == toï¼Œåˆ°è¾¾è‡ªèº«ã€‚  - ç»“æœå€¼ä¸º0\né€’å½’æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦ï¼š3^n\n```\n\n## é€’å½’æ³•\n\nå¦‚æœä¸é€‰æ‹©èŠ‚ç‚¹nï¼Œåˆ™`from`åˆ°`to`è¿˜éœ€åœ¨å‰©ä¸‹çš„`n-1`èŠ‚ç‚¹ä¸­èµ°ã€‚\nå¦‚æœé€‰æ‹©èŠ‚ç‚¹nï¼Œåˆ™é—®é¢˜åˆ†è§£æˆäº†`from`åˆ°èŠ‚ç‚¹`n`ï¼ˆç¡®å®šèµ°`n`ï¼Œæ‰€ä»¥å¯ä»¥å°‘èµ°æœ€åçš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå› æ­¤æ˜¯`n-1`ï¼‰ï¼ŒåŠ ä¸Šå‰©ä¸‹çš„`n`åˆ°`to`ï¼Œéœ€è¦åœ¨`n-1`ä¸ªèŠ‚ç‚¹ä¸­èµ°ï¼ˆå› ä¸ºå·²ç»åˆ°è¾¾äº†èŠ‚ç‚¹`n`ï¼Œå› æ­¤å¯ä»¥å°‘èµ°1ä¸ªï¼‰ï¼ˆè‡³äºååŠæ®µçš„èŠ‚ç‚¹æ•°ä¸ºä»€ä¹ˆä¸æ˜¯1ï¼Ÿè¦æ­£ç¡®ç†è§£å‚æ•°3çš„æ„æ€ï¼ŒæŒ‡çš„æ˜¯å¯å‚ä¸çš„èŠ‚ç‚¹ï¼Œå¹¶ä¸æ˜¯è¯´å¿…é¡»èµ°nä¸ªï¼ˆå¤šäºã€å°‘äºnéƒ½å¯ä»¥ï¼‰ï¼‰ã€‚\n\n\n```c\nint path[5][5] = {\n    { 0,   0,   0,   0,   0 },\n    { 0,   0, 100, 100,   1 },\n    { 0,   3,   0,  10,   5 },\n    { 0, 100,   9,   0, 100 },\n    { 0, 100, 100,   4,   0 }\n};\nint floyd_recur(int from, int to, int n)\n{\n    if (from == to)return 0;\n    if (n == 0)\n    {\n        return path[from][to];\n    }\n    int no = floyd_recur(from, to, n - 1);\n    int yes = floyd_recur(from, n, n - 1) + floyd_recur(n, to, n - 1);\n    return no <= yes ? no : yes;\n}\n```\n\n### æµ‹è¯•\n```c\nint floyd_recur(int from, int to, int n);\nint main()\n{\n    int shortest = floyd_recur(2, 3, 4); // 8\n    return 0;\n}\n```\n### å¤æ‚åº¦åˆ†æ\né€’å½’æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦ï¼š$3^n$\n## è¿­ä»£æ³•\n\n![image-20240314024640598](../../images/Cè¯­è¨€_20240313_/image-20240314024640598.png)\n\nå› ä¸ºæœ‰ä¸‰ä¸ªå‚æ•°ï¼Œæ‰€ä»¥éœ€è¦ä¸‰ç»´æ•°ç»„æ¥è¿›è¡Œè¿­ä»£ã€‚$n$çš„æœ‰æ•ˆå–å€¼èŒƒå›´ä¸º$[0,4]$ï¼Œ0ä»£è¡¨æ²¡æœ‰èŠ‚ç‚¹å‚ä¸ã€‚è€Œ$from$å’Œ$to$çš„æœ‰æ•ˆå–å€¼èŒƒå›´ä¸º$[1,4]$ï¼Œå³0æ˜¯å¤šä½™çš„ï¼Œæ•°ç»„ç»™å‡ºå¤šä½™çš„1è¡Œ1åˆ—åªæ˜¯ä¸ºäº†æ–¹ä¾¿ç¼–ç¨‹ã€‚\n\n```c\nint shortpath[5][5][5];\nint floyd(int from, int to, int n)\n{\n    // n == 0 æ—¶\n    // æŠŠpathè¡¨æ ¼å¤åˆ¶åˆ°ç¬¬0é¢\n    // è¡Œ\n    for(int i = 0; i <= n; ++i)\n    {\n        // åˆ—\n        for(int j = 0; j <= n; ++j)\n        {\n            shortpath[0][i][j] = path[i][j];\n        }\n    }\n    // æ¯ä¸€é¢çš„from == to æ—¶ï¼Œç­‰äº0\n    for(int k = 1; k <= n; ++k)\n    {\n        for(int i = 0; i <= n; ++i)\n        {\n            shortpath[k][i][i] = 0;\n        }\n    }\n    //æ ¹æ®ç¬¬0é¢è¿­ä»£\n    // kä¸ºå¯¹åº”nçš„é¢  iä¸ºå¯¹åº”fromçš„è¡Œ jä¸ºå¯¹åº”toçš„åˆ—\n    // shortpath ç¬¬ä¸€ä¸ªæ•°ä¸ºé¢ ç¬¬äºŒä¸ªæ•°ä¸ºfrom ç¬¬ä¸‰ä¸ªæ•°ä¸ºto\n    for(int k = 1; k <= n; ++k)\n    {\n        for(int i = 1; i <= n; ++i)\n        {\n            for(int j = 1; j <= n; ++j)\n            {\n                int no = shortpath[k - 1][i][j];\n                int yes = shortpath[k - 1][i][k] + shortpath[k - 1][k][j];\n                \n                shortpath[k][i][j] = no <= yes ? no : yes;\n            }\n        }\n    }\n    return shortpath[n][from][to];\n}\nint main()\n{\n    int shortest = floyd(2, 3, 4); // 8\n    return 0;\n}\n```\n### å¤æ‚åº¦åˆ†æ\n\n$O(n^3)$\n\n# å„ç§å›¾ç®—æ³•\nBFSã€DFSã€Dijkstraã€Bellman-Fordï¼ˆBFï¼‰ã€Floydã€Primå’ŒKruskal ç­‰ç®—æ³•æ˜¯å›¾è®ºå’Œæœç´¢é¢†åŸŸä¸­çš„æ ¸å¿ƒç®—æ³•ï¼Œå®ƒä»¬å„æœ‰ç”¨é€”ã€é€‚ç”¨åœºæ™¯å’Œç‰¹æ€§ã€‚åœ¨é¢è¯•ä¸­ï¼Œé€šå¸¸ä¼šä»ç®—æ³•çš„**åŸç†**ã€**é€‚ç”¨åœºæ™¯**ã€**æ—¶é—´å¤æ‚åº¦**ã€**ç©ºé—´å¤æ‚åº¦**ã€ä»¥åŠä¸€äº›**ä¼˜åŒ–ç»†èŠ‚**æ¥è€ƒæŸ¥ã€‚å› æ­¤ï¼Œäº†è§£å®ƒä»¬çš„å…³è”ä¸åŒºåˆ«æ˜¯éå¸¸é‡è¦çš„ã€‚\n\n1. éå†ç®—æ³•\n    1. DFS\n    2. BFS\n2. æœ€çŸ­è·¯å¾„ç®—æ³•\n    1. Dijkstraï¼ˆå¥½ï¼‰\n    2. Bellman-Fordï¼ˆå¥½ã€ä½¿ç”¨é¢†åŸŸå¹¿æ³›ï¼Œä½†æ˜¯æœ€åæ€§èƒ½å·®ï¼‰\n    3. Floydï¼ˆæ€§èƒ½ä¸å¥½ï¼‰\n    4. æ‹“æ‰‘æ’åº\n3. æœ€å°ç”Ÿæˆæ ‘ç®—æ³•ï¼ˆè¿é€šå›¾çš„å­å›¾ï¼‰\n    1. Primï¼ˆä¸å¥½ï¼‰\n    2. Kruskalï¼ˆå¥½ï¼‰\n## 1. å¹¿åº¦ï¼ˆBFSï¼‰å’Œæ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰\n\n### å…³è”\n- BFSå’ŒDFSéƒ½æ˜¯**å›¾æœç´¢ç®—æ³•**ï¼Œç”¨äºéå†æˆ–æœç´¢å›¾çš„èŠ‚ç‚¹ã€‚\n- ä¸¤è€…éƒ½å¯ä»¥ç”¨äºæ— å‘å›¾å’Œæœ‰å‘å›¾ï¼Œèƒ½å¤Ÿæ‰¾åˆ°**å¯è¾¾æ€§**ï¼Œå³ä»ä¸€ä¸ªèŠ‚ç‚¹åˆ°å…¶ä»–èŠ‚ç‚¹çš„è·¯å¾„ã€‚\n### åŒºåˆ«\n- **BFS**ï¼šé€å±‚æ‰©å±•èŠ‚ç‚¹ï¼Œé€‚åˆå¯»æ‰¾**æœ€çŸ­è·¯å¾„ï¼ˆæ— æƒå›¾ï¼‰**ã€‚\n- **DFS**ï¼šæ²¿è·¯å¾„æ·±å…¥æœç´¢ï¼Œé€‚åˆæ‰¾åˆ°**æ‰€æœ‰è·¯å¾„**æˆ–ç”¨äº**å›¾çš„æ‹“æ‰‘æ’åº**å’Œ**å¼ºè¿é€šåˆ†é‡**ç­‰åº”ç”¨ã€‚\n### å…³é”®ç‚¹\n- **æ—¶é—´å¤æ‚åº¦**ï¼šO(V + E)ï¼Œå…¶ä¸­Væ˜¯èŠ‚ç‚¹æ•°ï¼ŒEæ˜¯è¾¹æ•°ã€‚\n- **åº”ç”¨åœºæ™¯**ï¼šBFSå¸¸ç”¨äºæ— æƒæœ€çŸ­è·¯å¾„ã€è¿·å®«ç­‰é—®é¢˜ï¼›DFSå¸¸ç”¨äºè·¯å¾„æœç´¢ã€è¿é€šåˆ†é‡æ£€æµ‹ç­‰ã€‚\n## 2. Dijkstraç®—æ³•\n### å…³è”\n- **Dijkstra**æ˜¯å•æºæœ€çŸ­è·¯å¾„ç®—æ³•ï¼Œä¸BFSç±»ä¼¼ï¼Œéƒ½ç”¨äºè·¯å¾„æœç´¢ï¼Œä½†**é€‚ç”¨äºå¸¦æƒå›¾**ã€‚\n- ä¸Bellman-Fordçš„åŒºåˆ«åœ¨äºå®ƒ**ä¸èƒ½å¤„ç†è´Ÿæƒè¾¹**ã€‚\n### å…³é”®ç‚¹\n- **æ—¶é—´å¤æ‚åº¦**ï¼š$O((V + E) * log V)$ï¼ˆä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—ï¼‰ã€‚\n- **é€‚ç”¨åœºæ™¯**ï¼šåœ°å›¾å¯¼èˆªã€ç½‘ç»œè·¯ç”±ï¼ˆOSPFï¼‰ã€å¸¦æƒè·¯å¾„é—®é¢˜ã€‚\n- **é™åˆ¶**ï¼šä¸èƒ½å¤„ç†è´Ÿæƒè¾¹ã€‚é¢è¯•ä¸­å¯èƒ½ä¼šè¯¢é—®åŸå› ï¼Œé‡ç‚¹åœ¨äºç®—æ³•çš„è´ªå¿ƒæ€§è´¨ã€‚\n### ä¸Floydç®—æ³•ç›¸æ¯”\nå½“æˆ‘ä»¬ä¸»è¦ç”¨äºæœç´¢å›¾æ—¶ï¼ˆæœç´¢å•æºè·¯å¾„ï¼‰ï¼Œå°½é‡ç”¨Dijkstraç®—æ³•ï¼Œå› ä¸ºFloydå¤ªè€—æ—¶äº†ã€‚\n## 3. Bellman-Fordç®—æ³•\n\n### å…³è”\n- ä¸Dijkstraä¸€æ ·ï¼ŒBellman-Fordä¹Ÿç”¨äºå•æºæœ€çŸ­è·¯å¾„ã€‚\n- Bellman-Fordä¸Dijkstraçš„ä¸åŒä¹‹å¤„åœ¨äºå®ƒ**å¯ä»¥å¤„ç†è´Ÿæƒè¾¹**ï¼Œä¸”å¯ä»¥æ£€æµ‹**è´Ÿæƒç¯**ã€‚\n### å…³é”®ç‚¹\n- **æ—¶é—´å¤æ‚åº¦**ï¼šO(V * E)ã€‚\n- **é€‚ç”¨åœºæ™¯**ï¼šå¤„ç†è´Ÿæƒè¾¹çš„è·¯å¾„é—®é¢˜ï¼Œå¦‚é‡‘èå›¾è¡¨ä¸­çš„ç›ˆäºè¾¹ã€‚\n- **ç‰¹ç‚¹**ï¼šå¯ä»¥æ£€æµ‹è´Ÿæƒç¯ã€‚é¢è¯•ä¸­å¯èƒ½ä¼šé—®åˆ°ä¸Dijkstraçš„åŒºåˆ«ä»¥åŠè´Ÿæƒç¯æ£€æµ‹æ–¹æ³•ã€‚\n## 4. Floydç®—æ³•\n\n### å…³è”\n\n- **Floyd**ç”¨äº**å¤šæºæœ€çŸ­è·¯å¾„**é—®é¢˜ï¼Œä¸Bellman-Fordå’ŒDijkstraä¸åŒï¼Œå®ƒç›´æ¥æ±‚è§£å›¾ä¸­**ä»»æ„ä¸¤ç‚¹é—´çš„æœ€çŸ­è·¯å¾„**ã€‚\n- ä¸Primå’ŒKruskalä¸åŒï¼Œå®ƒä¸ç”¨äºç”Ÿæˆæ ‘ï¼Œè€Œæ˜¯ç›´æ¥åœ¨**é‚»æ¥çŸ©é˜µ**ä¸Šå¤„ç†æ‰€æœ‰å¯¹è·¯å¾„çš„æƒ…å†µã€‚\n### å…³é”®ç‚¹\n\n- **æ—¶é—´å¤æ‚åº¦**ï¼šO(V^3)ã€‚\n- **é€‚ç”¨åœºæ™¯**ï¼šè®¡ç®—ç¨ å¯†å›¾ä¸­æ‰€æœ‰èŠ‚ç‚¹å¯¹çš„æœ€çŸ­è·¯å¾„ï¼Œå°¤å…¶æ˜¯å¯¹å°è§„æ¨¡å›¾çš„å¤„ç†ã€‚\n- **ä¼˜ç¼ºç‚¹**ï¼šç®—æ³•ç®€å•ä½†å¤æ‚åº¦è¾ƒé«˜ï¼›é€‚ç”¨äºå°å›¾ã€‚é¢è¯•ä¸­å¯èƒ½ä¼šé—®åˆ°Floydçš„å®ç°åŠå…¶é€‚ç”¨èŒƒå›´ã€‚\n\n## 5. Primç®—æ³•å’ŒKruskalç®—æ³•\n\n### å…³è”\n\n- Primå’ŒKruskaléƒ½æ˜¯æœ€å°ç”Ÿæˆæ ‘ï¼ˆMSTï¼‰ç®—æ³•ï¼Œé€šå¸¸ç”¨äºæ— å‘å›¾ã€‚\n- å®ƒä»¬éƒ½æ˜¯è´ªå¿ƒç®—æ³•ï¼Œé€šè¿‡ä¸åŒçš„æ–¹æ³•æ¥æ„é€ æœ€å°ç”Ÿæˆæ ‘ã€‚\n### åŒºåˆ«\n\n- **Prim**ï¼šé€æ­¥æ‰©å±•ç”Ÿæˆæ ‘çš„èŠ‚ç‚¹ï¼Œé€‚åˆç¨ å¯†å›¾ã€‚\n- **Kruskal**ï¼šé€šè¿‡é€‰æ‹©æœ€å°çš„è¾¹é€æ­¥åˆå¹¶ç”Ÿæˆæ ‘ï¼Œé€‚åˆç¨€ç–å›¾ã€‚\n### å…³é”®ç‚¹\n\n- **æ—¶é—´å¤æ‚åº¦**ï¼šPrimä¸ºO(E log V)ï¼ˆå †ä¼˜åŒ–ï¼‰ï¼ŒKruskalä¸ºO(E log E)ã€‚\n- **é€‚ç”¨åœºæ™¯**ï¼šç½‘ç»œè®¾è®¡ã€æœ€å°ä»£ä»·è¿æ¥ç­‰ã€‚\n- **ä¼˜ç¼ºç‚¹**ï¼šPrimå¯¹ç¨ å¯†å›¾è¾ƒå¥½ï¼ŒKruskalå¯¹ç¨€ç–å›¾è¾ƒå¥½ã€‚é¢è¯•ä¸­å¸¸é—®åˆ°å¦‚ä½•å®ç°Union-Findï¼ˆç”¨äºKruskalä¸­çš„è¿é€šæ€§æ£€æµ‹ï¼‰ã€‚\n## æ€»ç»“ä¸é¢è¯•ä¸­çš„å…³é”®è€ƒæŸ¥ç‚¹\n\n1. **ç®—æ³•é€‚ç”¨åœºæ™¯**ï¼šæ¯ç§ç®—æ³•éƒ½æœ‰ç‰¹å®šçš„åº”ç”¨åœºæ™¯ï¼Œé¢è¯•ä¸­å¯èƒ½ä¼šè€ƒæŸ¥å€™é€‰äººèƒ½å¦è¯†åˆ«ä½•æ—¶ä½¿ç”¨BFSã€DFSã€Dijkstraã€Floydæˆ–MSTç®—æ³•ã€‚\n2. **ç®—æ³•çš„ä¼˜åŒ–å’Œå¤æ‚åº¦**ï¼šäº†è§£æ—¶é—´å’Œç©ºé—´å¤æ‚åº¦ï¼Œå°¤å…¶æ˜¯å¦‚ä½•ä¼˜åŒ–ï¼ˆå¦‚Dijkstraçš„ä¼˜å…ˆé˜Ÿåˆ—ä¼˜åŒ–ï¼ŒKruskalçš„Union-Findç­‰ï¼‰ï¼Œå¯ä»¥å¸®åŠ©åœ¨é¢è¯•ä¸­å±•ç¤ºä¼˜åŒ–æ€ç»´ã€‚\n3. **å·®å¼‚ç‚¹**ï¼š\n    - Dijkstraä¸Bellman-Fordçš„å·®å¼‚ï¼šç‰¹åˆ«åœ¨å¤„ç†è´Ÿæƒè¾¹çš„èƒ½åŠ›ä¸Šã€‚\n    - Primä¸Kruskalï¼šé€‚ç”¨å›¾å¯†åº¦çš„ä¸åŒï¼Œè€ƒæŸ¥å¯¹å›¾ç»“æ„çš„ç†è§£ã€‚\n    - å¤šæºæœ€çŸ­è·¯å¾„ï¼ˆFloydï¼‰ä¸å•æºæœ€çŸ­è·¯å¾„ï¼ˆDijkstraã€Bellman-Fordï¼‰çš„åŒºåˆ«ï¼Œè€ƒæŸ¥å¯¹è·¯å¾„æœç´¢çš„ç†è§£ã€‚\n4. **ç»†èŠ‚å®ç°å’Œè¾¹ç•Œæƒ…å†µ**ï¼šé¢è¯•ä¸­å¯èƒ½ä¼šé—®åˆ°å®ç°ç»†èŠ‚å’Œä¸€äº›è¾¹ç•Œæƒ…å†µï¼Œæ¯”å¦‚ï¼š\n    - Dijkstraçš„è´ªå¿ƒé™åˆ¶ï¼Œæ— æ³•å¤„ç†è´Ÿæƒè¾¹ã€‚\n    - Bellman-Fordå¦‚ä½•æ£€æµ‹è´Ÿæƒç¯ã€‚\n    - Union-Findåœ¨Kruskalä¸­çš„åº”ç”¨åŠä¼˜åŒ–ã€‚\n# Union-Find å¹¶æŸ¥é›†\n**Union-Find**ï¼ˆè”åˆ-æŸ¥æ‰¾ï¼‰æ˜¯ä¸€ç§ç”¨äºå¤„ç†**åŠ¨æ€è¿é€šæ€§**é—®é¢˜çš„æ•°æ®ç»“æ„ï¼Œé€šå¸¸ç”¨äºå›¾çš„è¿é€šæ€§æ£€æµ‹ã€æœ€å°ç”Ÿæˆæ ‘ï¼ˆå¦‚Kruskalç®—æ³•ä¸­çš„ä½¿ç”¨ï¼‰ã€ç½‘ç»œè¿æ¥é—®é¢˜ç­‰ã€‚\n## ä¸»è¦åŠŸèƒ½\n\nUnion-Find æ•°æ®ç»“æ„ä¸»è¦æä¾›ä¸¤ä¸ªæ“ä½œï¼š\n\n1. **Find**ï¼ˆæŸ¥æ‰¾ï¼‰ï¼šç”¨äºæŸ¥æ‰¾æŸä¸ªå…ƒç´ æ‰€åœ¨çš„é›†åˆï¼ˆä¹Ÿå¯ä»¥ç†è§£ä¸ºæŸ¥æ‰¾æŸä¸ªå…ƒç´ çš„ä»£è¡¨å…ƒç´ æˆ–æ ¹èŠ‚ç‚¹ï¼‰ã€‚\n2. **Union**ï¼ˆåˆå¹¶ï¼‰ï¼šå°†ä¸¤ä¸ªå…ƒç´ æ‰€å±çš„é›†åˆåˆå¹¶æˆä¸€ä¸ªé›†åˆã€‚\n\nè¿™ä¸¤ä¸ªæ“ä½œæ”¯æŒ**é«˜æ•ˆçš„åŠ¨æ€è¿æ¥æ“ä½œ**ï¼Œé€‚ç”¨äºå¤„ç†å›¾çš„è¿é€šæ€§é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œåˆ¤æ–­å›¾ä¸­ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¦åœ¨åŒä¸€è¿é€šåˆ†é‡ä¸­ï¼Œæˆ–åˆå¹¶ä¸¤ä¸ªèŠ‚ç‚¹æ‰€å±çš„è¿é€šåˆ†é‡ã€‚\n\n## æ•°æ®ç»“æ„å®ç°\n\nUnion-Find ä½¿ç”¨ä¸€æ£µ**æ ‘**æ¥è¡¨ç¤ºæ¯ä¸ªé›†åˆçš„ç»“æ„ã€‚æ¯ä¸ªèŠ‚ç‚¹æŒ‡å‘ä¸€ä¸ªçˆ¶èŠ‚ç‚¹ï¼Œæ ¹èŠ‚ç‚¹ä»£è¡¨æ•´ä¸ªé›†åˆã€‚é€šè¿‡è·¯å¾„å‹ç¼©å’ŒæŒ‰ç§©åˆå¹¶ï¼ˆæŒ‰å¤§å°åˆå¹¶ï¼‰è¿™ä¸¤ç§æŠ€æœ¯ï¼Œå¯ä»¥ä½¿æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ¥è¿‘å¸¸æ•°æ—¶é—´ï¼ˆ$O(Î±(n))$ï¼Œå…¶ä¸­Î±æ˜¯åé˜¿å…‹æ›¼å‡½æ•°ï¼Œæ˜¯éå¸¸æ…¢å¢é•¿çš„ï¼‰ã€‚\n### Find æ“ä½œ\n- **ç›®æ ‡**ï¼šæŸ¥æ‰¾ä¸€ä¸ªå…ƒç´ å±äºå“ªä¸ªé›†åˆã€‚å³æ‰¾åˆ°è¯¥å…ƒç´ çš„æ ¹èŠ‚ç‚¹ã€‚\n- **è·¯å¾„å‹ç¼©**ï¼šä¸ºäº†ä¼˜åŒ–åç»­æŸ¥è¯¢ï¼Œæˆ‘ä»¬å°†è·¯å¾„ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½ç›´æ¥è¿æ¥åˆ°æ ¹èŠ‚ç‚¹ä¸Šï¼Œä½¿å¾—æ ‘æ›´å¹³è¡¡ï¼Œä»è€Œæé«˜æ•ˆç‡ã€‚\n\n```cpp\nint find(int x)\n{\n    if (parent[x] != x)\n    {\n        parent[x] = find(parent[x]);\n        // é€’å½’æŸ¥æ‰¾å¹¶å‹ç¼©è·¯å¾„\n    }\n    return parent[x];\n}\n```\n### Unionæ“ä½œ\n\n- **ç›®æ ‡**ï¼šå°†ä¸¤ä¸ªå…ƒç´ åˆå¹¶åˆ°åŒä¸€ä¸ªé›†åˆä¸­ã€‚\n    \n- **æŒ‰ç§©åˆå¹¶ï¼ˆUnion by Rank/Sizeï¼‰**ï¼šå°†æ ‘å°çš„æ ¹èŠ‚ç‚¹è¿æ¥åˆ°å¤§çš„æ ¹èŠ‚ç‚¹ï¼Œä¿æŒæ ‘çš„å¹³è¡¡ï¼Œé¿å…æ ‘å˜å¾—è¿‡é«˜ã€‚\n\n```cpp\nvoid union(int x, int y)\n{\n    int rootX = find(x);\n    int rootY = find(y);\n    if (rootX != rootY)\n    {  // å¦‚æœ x å’Œ y ä¸åœ¨åŒä¸€é›†åˆ\n        if (rank[rootX] > rank[rootY])\n        {\n            parent[rootY] = rootX;\n        }\n        else if(rank[rootX] < rank[rootY])\n        {\n            parent[rootX] = rootY;\n        }\n        else\n        {    \n            parent[rootY] = rootX;\n            rank[rootX]++;\n            // å¢åŠ ç§©\n        }\n    }\n}\n```\n## æ—¶é—´å¤æ‚åº¦\n\n- **Find** å’Œ **Union** çš„æ—¶é—´å¤æ‚åº¦æ˜¯æ¥è¿‘ O(Î±(n))ï¼Œå…¶ä¸­ **Î±(n)** æ˜¯åé˜¿å…‹æ›¼å‡½æ•°ï¼Œå®ƒå¢é•¿éå¸¸æ…¢ï¼Œå®é™…ä¸Šå‡ ä¹å¯ä»¥è®¤ä¸ºæ˜¯å¸¸æ•°æ—¶é—´ï¼ˆå¯¹äºå®é™…åº”ç”¨ï¼ŒÎ±(n) å°äº 5 å³å¯ï¼‰ã€‚\n- å› æ­¤ï¼ŒUnion-Find æ•°æ®ç»“æ„éå¸¸é«˜æ•ˆï¼Œé€‚ç”¨äºå¤„ç†å¤§è§„æ¨¡çš„è¿é€šæ€§é—®é¢˜ã€‚\n## åº”ç”¨åœºæ™¯\n\n1. **åˆ¤æ–­ä¸¤ä¸ªå…ƒç´ æ˜¯å¦åœ¨åŒä¸€ä¸ªé›†åˆä¸­**ï¼šæ¯”å¦‚åˆ¤æ–­å›¾ä¸­çš„ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¦è¿é€šã€‚\n2. **æœ€å°ç”Ÿæˆæ ‘**ï¼šKruskal ç®—æ³•ä¸­ç”¨äºåˆ¤æ–­ä¸¤æ¡è¾¹æ˜¯å¦è¿æ¥åœ¨åŒä¸€ä¸ªè¿é€šåˆ†é‡ä¸­ï¼Œè‹¥æ˜¯ï¼Œåˆ™è·³è¿‡ï¼›è‹¥ä¸æ˜¯ï¼Œåˆ™åˆå¹¶ä¸¤ä¸ªåˆ†é‡ã€‚\n3. **ç½‘ç»œè¿æ¥é—®é¢˜**ï¼šå¦‚ç¤¾äº¤ç½‘ç»œä¸­çš„æœ‹å‹å…³ç³»ï¼Œæˆ–è€…è®¡ç®—æœºç½‘ç»œä¸­è®¾å¤‡çš„è¿é€šæ€§ã€‚\n4. **åŠ¨æ€è¿é€šæ€§**ï¼šä¾‹å¦‚å®æ—¶åœ°åœ¨ç½‘ç»œä¸­æŸ¥è¯¢ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¦è¿é€šï¼Œå¹¶åˆå¹¶å®ƒä»¬çš„è¿æ¥ã€‚\n\n## ä¾‹å­\n\nå‡è®¾æœ‰ä¸€ä¸ªå›¾ï¼ŒèŠ‚ç‚¹ä¸º 0, 1, 2, 3ï¼Œè¾¹ä¸º (0,1), (1,2), (2,3)ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ Union-Find æ¥æ£€æµ‹è¿™äº›èŠ‚ç‚¹æ˜¯å¦åœ¨åŒä¸€ä¸ªè¿é€šåˆ†é‡å†…ï¼Œå¹¶ä¸”åˆå¹¶è¿™äº›è¿é€šåˆ†é‡ã€‚\n\n```cpp\n#include <iostream>\n#include <vector>\n\nclass UnionFind {\nprivate:\n    std::vector<int> parent;\n    std::vector<int> rank;\n\npublic:\n    UnionFind(int n) {\n        parent.resize(n);\n        rank.resize(n, 0);\n        for (int i = 0; i < n; ++i) {\n            parent[i] = i;  // åˆå§‹åŒ–æ¯ä¸ªå…ƒç´ çš„çˆ¶èŠ‚ç‚¹ä¸ºè‡ªèº«\n        }\n    }\n\n    int find(int x) {\n        if (parent[x] != x) {\n            parent[x] = find(parent[x]);  // è·¯å¾„å‹ç¼©\n        }\n        return parent[x];\n    }\n\n    void unionSets(int x, int y) {\n        int rootX = find(x);\n        int rootY = find(y);\n\n        if (rootX != rootY) {\n            if (rank[rootX] > rank[rootY]) {\n                parent[rootY] = rootX;\n            } else if (rank[rootX] < rank[rootY]) {\n                parent[rootX] = rootY;\n            } else {\n                parent[rootY] = rootX;\n                rank[rootX]++;\n            }\n        }\n    }\n};\n\nint main() {\n    UnionFind uf(4);\n\n    // åˆå¹¶ (0, 1), (1, 2), (2, 3)\n    uf.unionSets(0, 1);\n    uf.unionSets(1, 2);\n    uf.unionSets(2, 3);\n\n    // åˆ¤æ–­æ˜¯å¦è¿é€š\n    std::cout << \"Is 0 and 3 connected? \" << (uf.find(0) == uf.find(3)) << std::endl;  // è¾“å‡º 1ï¼Œè¡¨ç¤ºè¿é€š\n    std::cout << \"Is 0 and 2 connected? \" << (uf.find(0) == uf.find(2)) << std::endl;  // è¾“å‡º 1ï¼Œè¡¨ç¤ºè¿é€š\n    std::cout << \"Is 0 and 4 connected? \" << (uf.find(0) == uf.find(4)) << std::endl;  // è¾“å‡º 0ï¼Œè¡¨ç¤ºä¸è¿é€š\n\n    return 0;\n}\n\n```\n\n## å…³é”®ç‰¹æ€§\n\n- **è·¯å¾„å‹ç¼©**ï¼šä½¿å¾—æ ‘æ›´åŠ æ‰å¹³åŒ–ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚\n- **æŒ‰ç§©åˆå¹¶**ï¼šåˆå¹¶ä¸¤ä¸ªé›†åˆæ—¶ï¼Œä¿æŒæ ‘çš„å¹³è¡¡ï¼Œå‡å°‘æ ‘çš„é«˜åº¦ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–æ€§èƒ½ã€‚\n\n## é¢è¯•ä¸­å¯èƒ½çš„è€ƒç‚¹\n\n1. Union-Findçš„åŸºæœ¬åŸç†ï¼Œå°¤å…¶æ˜¯å¦‚ä½•å®ç°`Find`å’Œ`Union`æ“ä½œã€‚\n2. **è·¯å¾„å‹ç¼©**å’Œ**æŒ‰ç§©åˆå¹¶**çš„ä¼˜åŒ–æ€è·¯åŠå…¶æ—¶é—´å¤æ‚åº¦ã€‚\n3. åœ¨å›¾ç®—æ³•ä¸­ï¼ˆç‰¹åˆ«æ˜¯Kruskalç®—æ³•ï¼‰å¦‚ä½•åˆ©ç”¨Union-Findæ¥è§£å†³è¿é€šæ€§é—®é¢˜ã€‚\n4. å¤„ç†**åŠ¨æ€è¿é€šæ€§**æ—¶çš„å¸¸è§é—®é¢˜ï¼Œå¦‚å¦‚ä½•åŠ¨æ€æ·»åŠ è¾¹ã€åˆå¹¶ä¸åŒçš„å­å›¾ç­‰ã€‚\n\næ€»ä¹‹ï¼ŒUnion-Find æ˜¯ä¸€ç§éå¸¸é«˜æ•ˆçš„è§£å†³åŠ¨æ€è¿é€šæ€§é—®é¢˜çš„æ•°æ®ç»“æ„ï¼Œæ˜¯å›¾è®ºé—®é¢˜ä¸­ä¸å¯æˆ–ç¼ºçš„å·¥å…·ä¹‹ä¸€ï¼Œç‰¹åˆ«åœ¨å¤„ç†å¤§è§„æ¨¡å›¾çš„åœºæ™¯ä¸­è¡¨ç°å°¤ä¸ºçªå‡ºã€‚","categories":["C","ç®—æ³•","åŠ¨æ€è§„åˆ’","å›¾"]},{"title":"åŠ¨æ€è§„åˆ’_Cè¯­è¨€å®ç°","url":"/ç®—æ³•/åŠ¨æ€è§„åˆ’_Cè¯­è¨€å®ç°/","content":"# åŠ¨æ€è§„åˆ’\n\né«˜é˜¶é©¬å°”ç§‘å¤«æ¨¡å‹ã€‚\n\nä¸€ä¸ªé—®é¢˜æ˜¯å¦æ˜¯åŠ¨æ€è§„åˆ’ï¼Œå†³å®šå› ç´ åœ¨äºæŸä¸€çŠ¶æ€æ˜¯å¦ä¾èµ–äºå‰é¢çš„ä¸€äº›çŠ¶æ€ï¼Œè‡³å°‘è¦ä¾èµ–å¤šäºä¸€ç§çš„çŠ¶æ€æ‰è¡Œã€‚è´ªå¿ƒç®—æ³•å…¶å®ä¹Ÿæ˜¯åŠ¨æ€è§„åˆ’çš„ä¸€ç§ï¼Œå¯ä»¥è½¬åŒ–ä¸ºç®€å•çš„åŠ¨æ€è§„åˆ’ã€‚è€ŒåŠ¨æ€è§„åˆ’ä¸è´ªå¿ƒçš„åŒºåˆ«å°±åœ¨äºåŠ¨æ€è§„åˆ’çš„çœ¼å…‰æ¯”è¾ƒé•¿è¿œï¼Œè€Œè´ªå¿ƒåªé¡¾åŠçœ¼å‰çš„åˆ©ç›Šã€‚\n\nåŠ¨æ€è§„åˆ’å¸¸èƒ½è§£å†³çš„æœ‰ï¼š01èƒŒåŒ…é—®é¢˜ã€‚\n\nç®€å•æ¥è¯´åŠ¨æ€è§„åˆ’å°±æ˜¯æŠŠéš¾ä»¥è§£å†³çš„é—®é¢˜åˆ†å‰²ä¸ºå¾ˆå¤šç»“æ„ç›¸ä¼¼çš„å°é—®é¢˜ã€‚\n\n# Fibonacci\n\næ–æ³¢é‚£å¥‘æ•°åˆ—ã€‚\n\n```\n1 1 2 3 5 8 13 21 34 55 89\n\n```\n\n## é€’å½’æ³•\n\n```c\nint fibo(int n)\n{\n    if(n == 1 || n == 2)\n    {\n        return 1;\n    }\n    return fibo(n - 1) + fibo(n - 2);\n}\n```\n\næµ‹è¯•\n\n```c\nint main(void)\n{\n    int i = fibo(8);\n    return 0;\n}\n```\n\n## è¿­ä»£æ³•\n\nå³å¾ªç¯ï¼Œæ— éœ€ç¡¬ä»¶æ ˆï¼Œé€Ÿåº¦æ›´å¿«ï¼ŒçŠ¶æ€ä¸é‡å¤ï¼Œä½†æ˜¯éœ€è¦ä¾èµ–è¡¨æ ¼ã€‚\n\n```c\nint fibo2(int n)\n{\n    int dp[50] = {0};\n    dp[1] = 1;\n    dp[2] = 1;\n    for(int i = 3; i <= n; ++i)\n    {\n        dp[i] = dp[i - 1] + dp[i - 2];\n    }\n}\n```\n\n# èƒŒåŒ…\n\nèµ·å§‹äºä¸€ç§çŠ¶æ€ï¼šæœ‰ä¸€ä¸ªåŒ…ï¼Œå°å·å·ä¸œè¥¿ï¼Œæœ‰å¤§æœ‰å°ï¼Œæœ‰è´µæœ‰è´±ã€‚é‚£ä¹ˆå°å·å°±è¦è€ƒè™‘å¦‚ä½•åœ¨æœ‰é™çš„å®¹é‡ä¸‹æ‹¿å°½å¤šä»·å€¼çš„ä¸œè¥¿ã€‚\n\n| item | Value | Weight |\n| ---- | ----- | ------ |\n| 0    | 5     | 9      |\n| 1    | 9     | 11     |\n| 2    | 7     | 6      |\n| 3    | 11    | 15     |\n| 4    | 16    | 18     |\n| 5    | 13    | 14     |\n\n## é€’å½’æ³•\n\n```c\nint vals[] = {5, 9, 7, 11, 16, 13};\nint weights[] = {9, 11, 6, 15, 18, 14};\nint ks(int n, int cap)\n{\n    if(n == 0)\n    {\n        return cap >= weights[n] ? vals[n] : 0;\n    }\n    // å¦‚æœä¸é€‰ï¼Œåˆ™ä»·å€¼ä¸ºï¼š\n    int no = ks(n - 1, cap);\n    // å¦‚æœé€‰æ‹©çš„ä»·å€¼ï¼šï¼ˆå…ˆåˆå§‹åŒ–ä¸ºä¸é€‰ï¼‰\n    int yes = no;\n    if(cap >= weights[n])\n    {\n        yes = ks(n - 1, cap - weights[n]) + vals[n];\n    }\n    return no >= yes ? no : yes;\n}\n```\n\næµ‹è¯•ï¼Œç»“æœåº”ä¸º45\n\n```c\nint main()\n{\n    int i = ks(5, 50);\n}\n```\n\n## è¿­ä»£æ³•\n\n```c\nint vals[] = {5, 9, 7, 11, 16, 13};\nint weights[] = {9, 11, 6, 15, 18, 14};\nint ks2(int n, int cap)\n{\n    // 6è¡Œ 51åˆ—\n    int res[6][51] = {0};\n    // åˆå§‹åŒ–è¡¨æ ¼\n    // iæŒ‡çš„æ˜¯èƒŒåŒ…ç›®å‰çš„å®¹é‡\n    for(int i = 0; i <= 50; ++i)\n    {\n        if(i < weights[0])// weights[0]å¯¹åº”äº ç¬¬0å·ç‰©å“çš„é‡é‡\n        {\n            res[0][i] = 0;\n        }\n        else\n        {\n            res[0][i] = vals[0];\n        }\n    }\n    // éå†è®¡ç®—æ¯ä¸€ä¸ªçŠ¶æ€\n    // è¡Œ å¯¹åº”äºn\n    for(int i = 1; i <= n; ++i)\n    {\n        // åˆ— å¯¹åº”äºcap\n        for(int j = 0; j <= cap; ++j)\n        {\n            int no = res[i - 1][j];\n            int yes = no;\n            if(j >= weights[i])\n            {\n                yes = vals[i] + res[i - 1][j - weights[i]];\n            }\n            res[i][j] = no >= yes ? no : yes;\n        }\n    }\n    return res[n][c];\n}\n```\n\næµ‹è¯•ï¼Œç»“æœåº”ä¸º45\n\n```c\nint main()\n{\n    int i = ks2(5, 50);\n}\n```\n\n# èƒŒåŒ…å˜å‹ - å‡‘æ•°\n\n```c\nnums[] = 5 8 1 3 9 2 4 7 6 -> èƒ½ä¸èƒ½å‡‘å‡º25\nbool mk_sum(n, target_val)\nä¸å–ï¼šmk_sum(n - 1, target_val)           ->èƒ½ä¸èƒ½ä»å‰©ä¸‹çš„n-1ä¸ªä¸­å‡‘å‡ºtar\nå–ï¼š mk_sum(n - 1, target_val - nums[n])  ->èƒ½ä¸èƒ½ä»å‰©ä¸‹çš„n-1ä¸­å‡‘å‡ºtar-nums[n]\n    \nä¸¤ä¸ªçŠ¶æ€ä¹‹é—´åº”è¯¥å–ORï¼ˆæˆ–ï¼‰çš„å…³ç³»ï¼Œåªè¦æœ‰ä¸€è¾¹å¯ä»¥è¾¾åˆ°ï¼Œåˆ™å°±å¯ä»¥å‡‘å‡º25\n    \nç»ˆæ­¢æ¡ä»¶ï¼š\n    ï¼ˆ1ï¼‰n = 0ï¼Œæ­¤æ—¶çœ‹target_getå’Œç¬¬0ä¸ªæ•°æ˜¯å¦ç›¸ç­‰ã€‚\n    ï¼ˆ2ï¼‰æˆ–è€…target_valä¸º0ï¼ˆå…¨ä¸é€‰å³å¯å‡‘ä¸º0ï¼‰\n```\n\n```c\nint sums[] = {5, 8, 1, 3, 9, 2, 4, 7, 6};//9ä¸ªæ•°\nint mk_sum(int n, int target_val)\n{   \n    // ç»ˆæ­¢æ¡ä»¶\n    if(target_val == 0)return 1; //true\n    if(n == 0)return target_val == nums[0];\n    int no = mk_sum(n - 1, target_val);\n    int yes = no;\n    if(target_val >= nums[n])\n    {\n        yes = mk_sum(n - 1, target_val - nums[n]);\n    }\n    return no || yes;\n}\n```\n\n## è¿­ä»£æ³•\n\n```\nn âˆˆ [0, 8]\ntarget âˆˆ [0, 99] //å…¶å®targetåº”è¯¥æ— ä¸Šé™æ‰å¯¹ï¼Œæœ¬ä¾‹åªçœ‹99ä»¥ä¸‹çš„å‡‘æ•°æƒ…å†µ\næ‰€ä»¥éœ€è¦ 9 Ã— 100 çš„æ•°ç»„\n```\n\n\n\n```c\nint sums[] = {5, 8, 1, 3, 9, 2, 4, 7, 6};\nint mk_sum2(int n, int target_val)\n{\n    char res[9][100] = {0};//å› ä¸ºè¡¨ä¸­çš„å€¼åªèƒ½æœ‰0ã€1ï¼Œä¸ºäº†èŠ‚çœç©ºé—´ï¼Œç”¨char\n    for(int i = 0; i <= n; ++i)\n    {\n        res[i][0] = 1;// ç¬¬0åˆ—ï¼Œä»£è¡¨target_valä¸º0ï¼Œæ­¤æ—¶ä¸ºå‡‘0ï¼Œå³å…¨ä¸é€‰å³å¯\n    }\n    // ä»¥ä¸‹forå…¶å®å¯ä»¥æ›¿æ¢ä¸ºä¸€å¥è¯ï¼šres[0][nums[0]] = 1\n    for(int j = 1; j <= target_val; ++j)\n    {\n        // åœ¨ç¬¬0ä¸ªæ•°æ—¶ï¼Œä¸ºä¸€ä¸ªç»ˆæ­¢æ¡ä»¶ï¼Œçœ‹jæ­£å¥½ä¸è‡ªèº«nums[0]ç›¸ç­‰æ—¶æ­£å¥½èƒ½å‡‘\n        res[0][j] = j == nums[0];\n    }\n    // è®¡ç®—è¡¨æ ¼ä¸­æ¯ä¸€ä¸ªçŠ¶æ€\n    for(int i = 1; i <= n; ++i)\n    {\n        for(int j = 1; j <= target_val; ++j)\n        {\n            char no = res[i - 1][j];\n            char yes = no;\n            if(nums[i] <= j)\n            {\n                yes = res[i - 1][j - nums[i]];\n            }\n            res[i][j] = yes || no;\n        }\n    }\n    return res[n][target_val];\n}\n```\n\næµ‹è¯•ï¼Œç»“æœåº”ä¸º1\n\n```c\nint main()\n{\n    char i = mk_sum2(8, 45);//ä»å…«ä¸ªæ•°ä¸­å‡‘45\n}\n```\n\n# æ¯æ¬¡ä¸¤è¾¹äºŒé€‰ä¸€æœ€åæ€»æ•°æœ€å¤§\nè‹¥å¹²ä¸ªå°çƒæ’åˆ—æˆä¸€æ’ï¼Œæ¯ä¸ªå°çƒä¸Šé¢å†™æœ‰ä¸€ä¸ªæ•´æ•°ã€‚\nç©å®¶aå’Œç©å®¶bä¾æ¬¡æ‹¿èµ°å°çƒï¼Œä¸€åç©å®¶ä¸€æ¬¡åªèƒ½æ‹¿ä¸€ä¸ªçƒï¼Œè§„å®šç©å®¶aå…ˆæ‹¿ï¼Œç©å®¶båæ‹¿ï¼Œä½†æ˜¯æ¯ä¸ªç©å®¶æ¯æ¬¡åªèƒ½æ‹¿èµ°æœ€å·¦æˆ–æœ€å³çš„çƒã€‚\næ¸¸æˆç»“æŸæ—¶ï¼Œæ¯ä¸ªç©å®¶å·²ç»æ‹¿èµ°çš„çƒä¸Šé¢çš„æ•°å­—ä¹‹å’Œå°±æ˜¯ä»–å¾—åˆ°çš„åˆ†æ•°ã€‚\nç©å®¶aå’Œç©å®¶béƒ½ç»é¡¶èªæ˜ï¼Œä»–ä»¬æ€»ä¼šé‡‡ç”¨æœ€ä¼˜ç­–ç•¥ã€‚\nè¯·è¿”å›æœ€åè·èƒœè€…çš„åˆ†æ•°ã€‚\n\nç¤ºä¾‹ï¼š\nå°çƒåºåˆ—ç”¨ä¸€ä¸ªæ•´å‹æ•°ç»„ A è¡¨ç¤ºã€‚\nå¦‚ï¼š`arr = [1,2,100,3]`\nå¼€å§‹æ—¶ç©å®¶Aåªèƒ½æ‹¿èµ°`1`æˆ–`3`ã€‚å¦‚æœç©å®¶Aæ‹¿èµ°1ï¼Œåˆ™æ’åˆ—å˜ä¸º`[2,100,3]`ï¼Œæ¥ä¸‹æ¥ç©å®¶Bå¯ä»¥æ‹¿èµ°`2`æˆ–`3`ï¼Œç„¶åç»§ç»­è½®åˆ°ç©å®¶Aã€‚å¦‚æœå¼€å§‹æ—¶ç©å®¶Aæ‹¿èµ°`3`ï¼Œåˆ™æ’åˆ—å˜ä¸º`[1,2,100]`ï¼Œæ¥ä¸‹æ¥ç©å®¶Bå¯ä»¥æ‹¿èµ°`1`æˆ–`100`ï¼Œç„¶åç»§ç»­è½®åˆ°ç©å®¶Aã€‚ç©å®¶Aä½œä¸ºç»é¡¶èªæ˜çš„äººä¸ä¼šå…ˆæ‹¿`3`ï¼Œå› ä¸ºæ‹¿äº†`3`ä¹‹åç©å®¶Bå°†æ‹¿èµ°`100`ã€‚æ‰€ä»¥ç©å®¶Aä¼šå…ˆæ‹¿`1`ï¼Œè®©æ’åˆ—å˜ä¸º`[2,100,3]`ï¼Œæ¥ä¸‹æ¥ç©å®¶Bä¸ç®¡æ€ä¹ˆé€‰ï¼Œ`100`éƒ½ä¼šè¢«ç©å®¶Aæ‹¿èµ°ã€ç©å®¶Aä¼šè·èƒœï¼Œåˆ†æ•°ä¸º`101`ã€‚æ‰€ä»¥è¿”å›`101`ã€‚\nå¦‚ï¼š`arr = [1,100,2]`\nå¼€å§‹æ—¶ç©å®¶Aä¸ç®¡æ‹¿`1`è¿˜æ˜¯`2`ï¼Œç©å®¶Bä½œä¸ºç»é¡¶èªæ˜çš„äººï¼Œéƒ½ä¼šæŠŠ`100`æ‹¿èµ°ã€‚ç©å®¶Bä¼šè·èƒœï¼Œåˆ†æ•°ä¸º`100`ï¼Œæ‰€ä»¥è¿”å›`100`ã€‚\n## ç»“æ„ä½“\nå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªç»“æ„ä½“ï¼Œæœ€åè¿”å›è¿™ä¸ªç»“æ„ä½“ï¼Œä»è€Œå¯ä»¥åˆ†æä¸¤ä¸ªè®°å½•å€¼ã€‚\n```cpp\ntypedef struct _Score\n{\n    int current;\n    int other;\n}Score;\n```\ncurrentä»£è¡¨å½“å‰äººçš„æ€»åˆ†æ•°ï¼Œotherä»£è¡¨å¦ä¸€ä¸ªäººçš„æ€»åˆ†æ•°ã€‚\nç¬¬ä¸€æ¬¡é€‰æ—¶ï¼Œå‡è®¾currentæ˜¯Aï¼Œotheræ˜¯Bã€‚\nåˆ™ç¬¬äºŒæ¬¡é€‰æ—¶ï¼ˆé—®é¢˜æ·±åº¦åŠ 1ï¼‰ï¼Œcurrentæ˜¯Bï¼Œotheræ˜¯Aã€‚\nå¯ä»¥ç”¨kingä»£è¡¨å‡½æ•°åï¼Œå‡½æ•°ä¸­æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œ`left`ä»£è¡¨æœ€å·¦æ•°çš„ä¸‹æ ‡ï¼Œ`right`ä»£è¡¨æœ€å³æ•°çš„ä¸‹æ ‡ã€‚\n`king(left, right)`è¡¨ç¤ºAå…ˆé€‰ï¼Œè¿”å›å€¼`current`è¡¨ç¤ºAåœ¨`left`åˆ°`right`ä¹‹é—´ï¼Œå’ŒBä¸€èµ·è½®æµé€‰åçš„æ€»åˆ†ï¼Œotherè¡¨ç¤ºBçš„æ€»åˆ†ã€‚\né€šè¿‡åˆ†æï¼Œå¯ä»¥æ¸…æ™°åœ°çŸ¥é“ï¼Œåªæœ‰`left`å’Œ`right`ä¸¤ä¸ªé€šè·¯ï¼Œä»¥æ­¤å¯ä»¥é€’æ¨å‡ºä¸¤ä¸ªè¿­ä»£å‡½æ•°ã€‚\n```\n1 2 100 3\n\nking(left, right) = ?\n\næœ€åæœ€é«˜å¾—åˆ†ï¼š\nç¬¬1äººï¼ˆAï¼‰é€‰æ‹©left:  king(left + 1, right)  -- æ­¤æ—¶Currentå˜ä¸ºB\nç¬¬1äººï¼ˆAï¼‰é€‰æ‹©right: king(left, right - 1)  -- æ­¤æ—¶Currentå˜ä¸ºB\n```\n## é€’å½’æ³•\n```c\n#include<iostream>\ntypedef struct _Score\n{\n    int current;\n    int other;\n}Score;\nint arr[] = { 1, 2, 100, 3 };\n\nScore king_recur(int left, int right)\n{\n    Score score;\n    if (left == right)\n    {\n        score.current = arr[left]; // left == right, åªæœ‰ä¸€ä¸ªæ•°\n        score.other = 0;\n        return score;\n    }\n    Score left_score  = king_recur(left + 1, right);\n    Score right_score = king_recur(left, right - 1);\n    // left_score.other + arr[left]   è¡¨ç¤º ä¸Šæ¬¡é€‰çš„äºº é€‰æ‹©å·¦ä¹‹å çš„åˆ†æ•°\n    // left_score.other + arr[right]  è¡¨ç¤º ä¸Šæ¬¡é€‰çš„äºº é€‰æ‹©å³ä¹‹å çš„åˆ†æ•°\n    // left_score.current             è¡¨ç¤º  è¿™æ¬¡è¦é€‰çš„äºº        çš„åˆ†æ•°\n    // å¦‚æœ ä¸Šæ¬¡çš„äººé€‰ å·¦è¾¹ ä¹‹å çš„ åˆ†æ•° å‡å» è¿™æ¬¡è¦é€‰çš„äºº çš„åˆ†æ•°ï¼Œ\n    // æ¯”  ä¸Šæ¬¡çš„äººé€‰ å³è¾¹ ä¹‹å çš„ åˆ†æ•° å‡å» è¿™æ¬¡è¦é€‰çš„äºº çš„åˆ†æ•°å¤§ï¼Œåˆ™ ä¸Šæ¬¡çš„äººï¼ˆcurrentï¼‰é€‰å·¦è¾¹ï¼š\n    if (left_score.other + arr[left] - left_score.current >= right_score.other + arr[right] - right_score.current)\n    {\n        // ä¸Šæ¬¡çš„otheræˆä¸ºäº†è¿™æ¬¡çš„currentï¼Œé€‰äº†å·¦è¾¹ï¼Œå› æ­¤current = other+arr[left]\n        score.current = left_score.other + arr[left];\n        // ä¸Šæ¬¡çš„currentæˆä¸ºäº†è¿™æ¬¡çš„other\n        score.other   = left_score.current;\n    }\n    else // å¦åˆ™ï¼Œä¸Šæ¬¡çš„äººï¼ˆcurrentï¼‰å°±é€‰å³è¾¹ã€‚\n    {\n        score.current = right_score.other + arr[right];\n        score.other   = right_score.current;\n    }\n    return score;\n}\nint main()\n{\n    Score score = king_recur(0, 3);\n    std::cout << \"A: \" << score.current << \", B: \" << score.other << std::endl;\n}\n```\n\næµ‹è¯•ï¼šA: 101, B: 5\n### å¤æ‚åº¦åˆ†æ\næ¯ä¸€æ¬¡è¿­ä»£æœ‰2ä¸ªåˆ†æ”¯ï¼Œå› æ­¤é€’å½’æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º$O(2^n)$ã€‚\n## è¿­ä»£æ³•\n\nç»ˆæ­¢æ¡ä»¶æ˜¯ï¼š`left == right`ã€‚è¿™æ—¶åªå‰©ä¸‹ä¸€ä¸ªçƒï¼Œåªèƒ½é€‰æ‹©è¿™ä¸ªçƒï¼Œæ­¤æ—¶å€¼ä¸ºè¿™ä¸ªçƒçš„æ•°å­—ã€‚\nå› æ­¤ï¼Œåœ¨è¿­ä»£æ³•ä¸­ï¼Œå°±å¯ä»¥å…ˆä»¥å¯¹è§’çº¿æ–œè¡Œè¿›è¡Œåˆå§‹åŒ–ã€‚\nè¿˜æœ‰ä¸€äº›å¯ä»¥è½»æ¾æ’é™¤çš„ï¼šleftä¸å¯èƒ½å¤§äºrightï¼Œè¿™äº›ä½ç½®çš„å€¼éƒ½æ— æ•ˆï¼Œå·¦ä¸‹åŠè§’æ•°å€¼æ— æ„ä¹‰ã€‚\n\n![](../../images/Cè¯­è¨€_20240223_0310_åŠ¨æ€è§„åˆ’/image-20241115035830301.png)\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥åˆ†æ`left = 0, right = 1`çš„æƒ…å†µï¼š\n1. å¦‚æœä¸Šä¸€æ¬¡çš„äººé€‰èµ°äº†0å·ï¼ˆ1ï¼‰ï¼Œé‚£ä¹ˆ`king(0, 1) => current = 2, other = 1`\n2. å¦‚æœä¸Šä¸€æ¬¡çš„äººé€‰èµ°äº†1å·ï¼ˆ2ï¼‰ï¼Œé‚£ä¹ˆ`king(0, 1) => current = 1, other = 2`\n3. å³æ¯ä¸€ä¸ªæ ¼å­çš„å€¼éƒ½ä¾èµ–äºå·¦è¾¹çš„æ ¼æˆ–ä¸‹è¾¹çš„æ ¼ã€‚\n    1. å¦‚æœé€‰äº†å·¦è¾¹ï¼Œåˆ™å’Œä¸‹æ–¹æ ¼çš„otheråŠ å’Œï¼Œä½œä¸ºå½“å‰currentï¼Œä¸ä¸‹æ–¹æ ¼çš„currentå¯¹æ¯”ï¼Œæ±‚å·®å€¼=`å·¦other+ä¸‹æ•°å­—ä»·å€¼-å·¦current`\n    2. å¦‚æœé€‰äº†ä¸‹è¾¹ï¼Œåˆ™å’Œå·¦æ–¹æ ¼çš„otheråŠ å’Œï¼Œä½œä¸ºå½“å‰currentï¼Œä¸å·¦æ–¹æ ¼çš„currentå¯¹æ¯”ï¼Œæ±‚å·®å€¼=`ä¸‹other+å·¦æ•°å­—ä»·å€¼-ä¸‹current`\n    3. å¦‚æœå·®å€¼1å¤§äºå·®å€¼2ï¼Œåˆ™é€‰å·¦è¾¹ï¼›å¦‚æœå·®å€¼2å¤§äºå·®å€¼1ï¼Œåˆ™é€‰å³è¾¹ã€‚\n\nè¿™ç§éœ€è¦ä¾èµ–å·¦1å’Œä¸‹1çš„ï¼Œéœ€è¦æ–œç€è¿­ä»£ï¼Œè€Œä¸æ˜¯ç®€å•åœ°ä¸€è¡Œä¸€è¡Œã€ä¸€åˆ—ä¸€åˆ—åœ°ã€‚\n```c\nint arr[] = { 1, 2, 100, 3 };\nScore scores[4][4];\nScore king_interation(int left, int right)\n{\n    for (int i = left; i <= right; ++i)\n    {\n        scores[i][i].current = arr[i];\n        scores[i][i].other   = 0;\n    }\n    std::cout << \"Matrix:\" << std::endl;\n    for (int i = 0; i < 4; ++i)\n    {\n        for (int j = 0; j < 4; ++j)\n        {\n            std::cout << scores[i][j].current << \",\" << scores[i][j].other << \" \";\n        }\n        std::cout << std::endl;\n    }\n    for (int j = left + 1; j <= right; )\n    {\n        int i;\n        for (i = left; i <= right - (j - i); ++i, ++j)\n        {\n            // iå°ï¼Œjå¤§\n            // é€‰å³è¾¹çš„æƒ…å†µ ä¼˜äº é€‰å·¦è¾¹çš„æƒ…å†µ\n            if (scores[i][j - 1].other + arr[j] - scores[i][j - 1].current >= scores[i + 1][j].other + arr[i] - scores[i + 1][j].current)\n            {\n                // å·¦è¾¹çš„otherï¼ˆä»¥å‰é€‰çš„ï¼‰+ è¿™æ¬¡é€‰çš„å³è¾¹\n                scores[i][j].current = scores[i][j - 1].other + arr[j];\n                scores[i][j].other = scores[i][j - 1].current;\n            }\n            else// é€‰å³è¾¹çš„æƒ…å†µ å·®äº é€‰å·¦è¾¹çš„æƒ…å†µ\n            {\n                // å³è¾¹çš„otherï¼ˆä»¥å‰é€‰çš„ï¼‰+ è¿™æ¬¡é€‰çš„å·¦è¾¹\n                scores[i][j].current = scores[i + 1][j].other + arr[i];\n                scores[i][j].other = scores[i + 1][j].current;\n            }\n        }\n        j = j - i + 1;\n    }\n    return scores[left][right];\n}\nint main()\n{\n    score = king_interation(0, 3);\n    std::cout << \"Matrix:\" << std::endl;\n    for (int i = 0; i < 4; ++i)\n    {\n        for (int j = 0; j < 4; ++j)\n        {\n            std::cout << scores[i][j].current << \",\" << scores[i][j].other << \" \";\n        }\n        std::cout << std::endl;\n    }\n    std::cout << \"A: \" << score.current << \", B: \" << score.other << std::endl;\n}\n```\n### ä¼˜åŒ–é€»è¾‘\nå…¶å®å¯ä»¥ç›´æ¥æ¯”è¾ƒå¾—åˆ†è€Œæ— éœ€è®¡ç®—å·®å€¼ã€‚\næˆ‘ä»¬ä¹‹æ‰€ä»¥ä¸ä½¿ç”¨â€œå·®å€¼â€è¿›è¡Œæ¯”è¾ƒï¼Œæ˜¯å› ä¸ºè¿™é‡Œçš„ç›®æ ‡å¹¶ä¸æ˜¯ä»…ä»…**æœ€å¤§åŒ–ä¸å¯¹æ‰‹çš„å¾—åˆ†å·®**ï¼Œè€Œæ˜¯**è·å¾—å°½å¯èƒ½å¤šçš„åˆ†æ•°**ã€‚åœ¨è¿™ä¸ªæ¸¸æˆçš„è§„åˆ™ä¸‹ï¼š\n- æ¯ä¸ªå›åˆçš„ç›®æ ‡æ˜¯ä¸ºå½“å‰ç©å®¶ï¼ˆæ— è®ºæ˜¯Aè¿˜æ˜¯Bï¼‰å–å¾—å½“å‰å›åˆçš„æœ€é«˜å¾—åˆ†ï¼›\n- åŒæ—¶ï¼Œä¸‹ä¸€è½®å†ä»¥é€’å½’çš„æ–¹å¼è®¡ç®—å¯¹æ‰‹å¾—åˆ†çš„æœ€å¤§åŒ–ç­–ç•¥ã€‚\n\nå› æ­¤ï¼Œ**å·®å€¼å¹¶ä¸èƒ½å‡†ç¡®åæ˜ æœ€ä½³é€‰æ‹©**ï¼Œå› ä¸ºå·®å€¼åªè€ƒè™‘åˆ°æŸä¸€è½®æ¬¡çš„å¾—å¤±ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå±€é¢çš„æœ€ä¼˜è§£ã€‚è€Œåœ¨åŠ¨æ€è§„åˆ’ä¸­ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰å¯èƒ½çš„å¾—åˆ†ç»„åˆè®°å½•ä¸‹æ¥ï¼Œä»è€Œé¿å…é”™è¿‡ä»»ä½•æ½œåœ¨çš„æœ€ä¼˜ç­–ç•¥ã€‚\n```cpp\nScore king_interation(int left, int right)\n{\n    for (int i = left; i <= right; ++i)\n    {\n        scores[i][i].current = arr[i];\n        scores[i][i].other   = 0;\n    }\n    std::cout << \"Matrix:\" << std::endl;\n    for (int i = 0; i < 4; ++i)\n    {\n        for (int j = 0; j < 4; ++j)\n        {\n            std::cout << scores[i][j].current << \",\" << scores[i][j].other << \" \";\n        }\n        std::cout << std::endl;\n    }\n    for (int j = left + 1; j <= right; )\n    {\n        int i;\n        for (i = left; i <= right - (j - i); ++i, ++j)\n        {\n            // é€‰æ‹©å·¦è¾¹æˆ–å³è¾¹çƒ\n            int pickLeft = arr[i] + scores[i + 1][j].other;\n            int pickRight = arr[j] + scores[i][j - 1].other;\n        \n            // é€‰æ‹©æ›´ä¼˜ç­–ç•¥\n            if (pickLeft > pickRight) {\n                scores[i][j].current = pickLeft;\n                scores[i][j].other = scores[i + 1][j].current;\n            }\n            else {\n                scores[i][j].current = pickRight;\n                scores[i][j].other = scores[i][j - 1].current;\n            }\n        }\n        j = j - i + 1;\n    }\n    return scores[left][right];\n}\n```\n### åŠ¨æ€è§„åˆ’ä¸è´ªå¿ƒçš„åŒºåˆ«\n\nåœ¨è¿™ä¸ªåŠ¨æ€è§„åˆ’çš„æ–¹æ¡ˆä¸­ï¼š\n1. **å®Œæ•´æ€§**ï¼šåŠ¨æ€è§„åˆ’è¡¨è®°å½•äº†ä»æ¯ä¸€ä¸ªå­é—®é¢˜çš„è§£å¼€å§‹ï¼Œæ„å»ºæ•´ä¸ªé—®é¢˜çš„è§£ã€‚è¿™æ ·å°±ä¿è¯äº†å³ä½¿åœ¨æ›´æ—©çš„æ­¥éª¤ä¸­æ²¡æœ‰è·å¾—â€œå±€éƒ¨æœ€é«˜å¾—åˆ†â€ï¼Œä¹Ÿèƒ½é€šè¿‡ç´¯è®¡å¾—åˆ°æœ€ç»ˆçš„æœ€ä¼˜è§£ã€‚\n2. **éè´ªå¿ƒæ€§**ï¼šå¦‚æœé‡‡ç”¨è´ªå¿ƒç­–ç•¥ï¼Œæ¯ä¸€æ­¥éƒ½ä¼šé€‰æ‹©å½“å‰â€œæœ€æ˜¾çœ¼â€çš„å¾—åˆ†é€‰é¡¹ï¼ˆä¾‹å¦‚ï¼Œé€‰æ‹©æœ€å¤§å€¼æˆ–æœ€å°å€¼ï¼‰ï¼Œå¿½è§†ä¹‹åçš„å¯èƒ½å¾—åˆ†ã€‚ç„¶è€ŒåŠ¨æ€è§„åˆ’åœ¨ `scores[i][j]` ä¸­è®°å½•äº†æ‰€æœ‰å¯èƒ½é€‰é¡¹å¸¦æ¥çš„å¾—åˆ†æƒ…å†µï¼Œä½¿å¾—æ¯ä¸€æ­¥éƒ½æ˜¯åŸºäºæ•´ä½“æœ€ä¼˜ï¼Œè€Œéå±€éƒ¨æœ€ä¼˜ã€‚å¯¹äº `[0, 3]` çš„åºåˆ—ï¼Œä¸ç›´æ¥ä¾èµ–äºå±€éƒ¨å·®å€¼ï¼Œè€Œæ˜¯é€’å½’åœ°ä» `scores[0][1], scores[1][3]` ç­‰å­é—®é¢˜çš„æœ€ä¼˜è§£æ„å»ºæ•´ä¸ªåŒºé—´çš„æœ€ä¼˜è§£ã€‚\n## æ€»ç»“\nè¿™é“é¢˜çš„éš¾ç‚¹åœ¨äºï¼šcurrentã€otherè¿™ä¸¤ä¸ªå˜é‡åæˆ‘ä»¬æ˜¯å›ºå®šå¥½çš„ï¼Œä½†æ˜¯æ¯ä¸€æ¬¡é€‰å®Œä¹‹åï¼Œcurrentå’Œotherçš„å®é™…èº«ä»½äº’æ¢ã€‚è¦åœ¨é”™ç»¼å¤æ‚çš„åˆ†æä¸­æ˜ç¡®è¿­ä»£æ–¹ç¨‹åœ¨æœ¬å±‚ä¸ä¸Šä¸€å±‚ä¹‹é—´çš„è”ç³»ã€åŒºåˆ«ã€‚åŒæ—¶ï¼Œifæ¡ä»¶è¡¨è¾¾å¼æ¯”è¾ƒé•¿ï¼Œéœ€è¦ä¿æŒæ¸…æ¥šçš„é€»è¾‘åˆ†æå‡ºï¼Œç©¶ç«Ÿéœ€è¦çœ‹ä»€ä¹ˆæ¡ä»¶ï¼Œæ­¤é¢˜ä¸åªæ˜¯ç®€å•çš„çœ‹è°æœ€ç»ˆå–å¾—æœ€å¤§å€¼ï¼Œè€Œæ˜¯åœ¨è¿‡ç¨‹ä¸­ï¼Œçœ‹Aé€‰å·¦è¾¹æˆ–å³è¾¹ä¹‹åï¼Œä¸Bçš„å·®å€¼ï¼Œå“ªä¸ªå¤§ã€‚\n# Playing with Beads\nThere are `N` people in a group labeled from `1` to `N`. People are connected to each other via threads in the following manner.\nThe person with label number `K` is connected to all the persons with label `J` such that `J` exactly divides `K`. Beads can be passed through the threads. If a person `P` has a bead, in how many ways can the bead be passed in the network of threads so that it returns to the same person within `X` moves or less?\n\nMOVE: Passing the bead from one person to the other.\n\nInput specification:\ninput1: `N`, denoting the number of people.\ninput2: `P`, label of the person having the bead\ninput3: `X`, maximum number of moves that can be made\n\nOutput specification:\nYour function should return the total number of ways in which the bead will return to its initial position within `X` moves.\n\nExample 1:\n```\ninput1: 3\ninput2: 2\ninput3: 2\n\nOutput: 1\n\nExplanation:\nOnly 1 way:\n2->1->2\n```\nExample 2:\n```\ninput1: 3\ninput2: 2\ninput3: 4\n\nOutput: 3\n\nExplanation:\n3 ways:\n2->1->2\n2->1->3->1->2\n2->1->2->1->2\n```\n## åˆ†æ\nå‡å¦‚Kå¯ä»¥è¢«Jæ•´é™¤ï¼Œåˆ™Kå’ŒJç›¸è¿ã€‚ç›¸è¿è€…å¯ä»¥äº’ä¼ çƒã€‚\n1. è¾“å…¥1ï¼šå…±æœ‰Nä¸ªäººã€‚æ ‡è®°ä¸º1åˆ°Nã€‚\n2. è¾“å…¥2ï¼šä»På¼€å§‹ä¼ çƒ\n3. è¾“å…¥3ï¼šåœ¨Xæ­¥å†…ï¼Œæœ‰å¤šå°‘ç§æ–¹æ³•å¯ä»¥ä¼ å›åŒä¸€äººï¼Ÿ\n\n## é€’å½’æ³•\n```cpp\n#include<iostream>\nint n;\nint begin;\nint playbeads_recur(int p, int x)\n{\n    int sum = 0;\n    if (x == 0)\n    {\n        std::cout << \"End\" << std::endl;\n    }\n    else\n    {\n        for (int i = 1; i <= n; ++i)\n        {\n            if ((i % p == 0 || p % i == 0) && (i != p))\n            {\n                std::cout << p << \"->\" << i << \", \" << std::endl;\n                if (i == begin)\n                {\n                    sum += 1;\n                    std::cout << \"This is a Way\" << std::endl;\n                }\n                sum += playbeads_recur(i, x - 1);\n            }\n        }\n    }\n    return sum;\n}\nint main()\n{\n    n = 3;\n    begin = 2;\n    int x = 4;\n    int sum = playbeads_recur(begin, x);\n\n    std::cout << \"Total Ways: \" << sum << std::endl;\n}\n```\nç»“æœï¼š\n```\n2->1,\n1->2,\nThis is a Way\n2->1,\n1->2,\nThis is a Way\nEnd\n1->3,\nEnd\n1->3,\n3->1,\n1->2,\nThis is a Way\nEnd\n1->3,\nEnd\nTotal Ways: 3\n```\n## è¿­ä»£æ³•\n```cpp\n#include<iostream>\nint n;\nint begin;\nint arr[4][5];\nint playbeads(int p, int x)\n{\n    for (int i = 0; i <= n; ++i)\n    {\n        for (int j = 0; j <= x; ++j)\n        {\n            arr[i][j] = 0;\n        }\n    }\n    for (int i = 1; i <= n; ++i)\n    {\n        if (begin == i)\n        {\n            arr[i][0] = 1;\n        }\n    }\n    std::cout << \"Matrix\" << std::endl;\n\n    for (int i = 0; i <= n; ++i)\n    {\n        for (int j = 0; j <= x; ++j)\n        {\n            std::cout << arr[i][j] << \" \";\n        }\n        std::cout << std::endl;\n    }\n    // i æ˜¯ ç¬¬å‡ äºº\n    // j æ˜¯ å‰©ä¸‹å‡ æ­¥\n    for (int j = 1; j <= x; ++j)\n    {\n        for (int i = 1; i <= n; ++i)\n        {\n            // æ³¨æ„ï¼Œi==begin ä¸” j==xæ—¶è¡¨ç¤ºç¬¬ä¸€æ­¥çƒåœ¨pæ‰‹ä¸­ï¼Œä¸èƒ½ç®—\n            if (i == begin && j != x)\n            {\n                arr[i][j] += 1;\n            }\n            for (int k = 1; k <= n; ++k)\n            {\n                if ((i != k) && (i % k == 0 || k % i == 0))\n                {\n                    arr[i][j] += arr[k][j-1];\n                }\n            }\n        }\n    }\n    std::cout << \"Matrix\" << std::endl;\n    for (int i = 0; i <= n; ++i)\n    {\n        for (int j = 0; j <= x; ++j)\n        {\n            std::cout << arr[i][j] << \" \";\n        }\n        std::cout << std::endl;\n    }\n    return arr[p][x];\n}\nint main()\n{\n    n = 3;\n    begin = 2;\n    int x = 4;\n    //int sum = playbeads_recur(begin, x);\n    int sum = playbeads(begin, x);\n    std::cout << \"Total Ways: \" << sum << std::endl;\n}\n```\nè¾“å‡ºï¼š\n```\nMatrix\n0 0 0 0 0\n0 0 0 0 0\n1 0 0 0 0\n0 0 0 0 0\nMatrix\n0 0 0 0 0\n0 1 1 3 3\n1 1 2 2 3\n0 0 1 1 3\nTotal Ways: 3\n```\n# ","categories":["C","ç®—æ³•","åŠ¨æ€è§„åˆ’"]},{"title":"Cè¯­è¨€_ä¸²åŒ¹é…ç®—æ³•","url":"/C/Cè¯­è¨€_ä¸²åŒ¹é…ç®—æ³•/","content":"# ä¸²çš„åŒ¹é…\n\nä¸²çš„åŒ¹é…å°±æ˜¯ä»å¤§çš„å­—ç¬¦ä¸²ä¸­æ‰¾åˆ°å­—ä¸²ï¼Œå¹¶ä¸”è¿”å›ç¬¬ä¸€ä¸ªå­—ä¸²çš„ä½ç½®ã€‚\n\nCè¯­è¨€åº“å‡½æ•°æœ‰ä¸€ä¸ª`strstr`ï¼Œæ˜¯æœ´ç´ çš„ä¸²åŒ¹é…ç®—æ³•ï¼Œä¹Ÿå«BFç®—æ³•ã€‚\n```c\nint BF(string source, string pattern)\n{\n    int i = 0;\n    int j = 0;\n    while(i < source.size() && j < pattern.size())\n    {\n        if(source[i] == pattern[j])\n        {\n            ++i;\n            ++j;\n        }\n        else\n        {\n            i = i - j + 1;//åé€€jä¸ªå­—ç¬¦ï¼Œå†è¿›1\n            j = 0;\n        }\n    }\n    if(j == pattern.size())//å¦‚æœpatternçš„jèµ°åˆ°äº†æœ€åï¼Œåˆ™è¯´æ˜å·²ç»å…¨éƒ¨åŒ¹é…\n    {\n        return i - j;\n    }\n    return -1;\n}\n```\n\n# KMPç®—æ³•\n\næ˜¯ä¸€ä¸ªå‡çº§ç‰ˆçš„ä¸²åŒ¹é…ç®—æ³•ï¼Œåå­—å–è‡ªä¸‰ä¸ªäººåï¼ˆKnuth-Morris-Prattï¼‰ã€‚\n\næ€»åœ°æ¥è¯´ï¼ŒKMPçš„æ ¸å¿ƒæ•ˆæœå°±æ˜¯è®©åŸä¸²çš„æŒ‡ç¤ºå™¨ä¸ç”¨é€€å›ã€‚å¦‚ä½•è¾¾åˆ°è¿™ä¸ªæ•ˆæœï¼Ÿå°±æ˜¯è€ƒè™‘å’Œæ¨¡å¼ä¸²å·²ç»åŒ¹é…çš„éƒ¨åˆ†ã€‚è¿™ä¸€éƒ¨åˆ†æ¨¡å¼ä¸²çš„**å­ä¸²**ï¼Œå¦‚æœåç¼€æœ‰å’Œå‰ç¼€ç›¸é‡å¤çš„éƒ¨åˆ†ï¼Œåˆ™å°±å¯ä»¥è·³è¿‡è¿™äº›éƒ¨åˆ†ï¼Œå³è·³è¿‡å‰ç¼€ï¼Œåœ¨å‰ç¼€çš„åä¸€ä¸ªå­—ç¬¦å¼€å§‹å†æ¬¡æ¯”å¯¹ï¼ˆå®é™…æ“ä½œä¸­ï¼ŒåŸä¸²æŒ‡ç¤ºå™¨ä¸åŠ¨ï¼Œè€Œæ˜¯æ¨¡å¼ä¸²çš„æŒ‡ç¤ºå™¨å›é€€åˆ°å½“æ—¶**å­ä¸²**å‰ç¼€çš„åä¸€ä¸ªå­—ç¬¦ä½ç½®ï¼‰ã€‚\n\näºæ˜¯ï¼Œæ•´ä¸ªé—®é¢˜çš„æ ¸å¿ƒï¼Œå°±ä»å…³æ³¨åŸä¸²å˜åˆ°å…³æ³¨æ¨¡å¼ä¸²æœ¬èº«äº†ã€‚éœ€è¦æ‰¾åˆ°æ¨¡å¼ä¸²çš„ä¸åŒé•¿åº¦ï¼ˆèµ·ç‚¹ä¸€è‡´ï¼Œä¸èƒ½ä»ä¸­é—´åˆ†å‰²ï¼‰ä¸‹å­ä¸²çš„å‰ç¼€åç¼€ç›¸ç­‰çš„å‰ç¼€ï¼ˆåç¼€ï¼‰æœ€å¤§é•¿åº¦ï¼Œä»è€Œå»ºç«‹ä¸€ä¸ªæ‰€è°“çš„nextæ•°ç»„ã€‚\n\nè¿™ä¸ªnextæ•°ç»„ï¼Œæ•™ç§‘ä¹¦çš„æ±‚æ³•æ˜¯ï¼š\n```c\nint * getNext(string str)\n{\n    int * next = new int[str.size()];\n    \n    int j = 0;   // j ç”¨æ¥éå†å­ä¸²\n    int k = -1;   // k ç”¨æ¥è¡¨ç¤ºå…¬å…±å‰åç¼€çš„é•¿åº¦\n    next[0] = -1; // è¡¨ç¤ºï¼Œå½“ç¬¬0ä¸ªå­—ç¬¦éƒ½å·²ç»åŒ¹é…å¤±è´¥äº†ï¼Œåˆ™åŸä¸²å‰è¿›1ï¼Œæ¨¡å¼ä¸²ä½ç½®ç»™-1ï¼Œå‰è¿›1åè‡ªç„¶åœ°ï¼ˆå·§å¦™å¤„ç†ï¼‰åˆ°0ä½ç½®ã€‚\n    while(j < str.size() - 1)//sizeä¸åŒ…æ‹¬\\0ï¼Œå³ä¸å¤„ç†æœ€åä¸€ä½å­—ç¬¦ä½ç½®\n    {\n        if(-1 == k || str[j] == str[k])\n        {\n            ++j;\n            ++k;\n            next[j] = k;\n        }\n        else\n        {\n            k = next[k];     //å¦‚æœåœ¨æ‰¾ç›¸åŒçš„åç¼€å¤±é…ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥ä½¿ç”¨KMPçš„æ€æƒ³ï¼Œåœ¨å·²åŒ¹é…çš„è¿™éƒ¨åˆ†å­—ç¬¦ä¸²ä¸­æ‰¾ç›¸åŒçš„å‰åç¼€éƒ¨åˆ†ï¼Œä»è€Œå»å›æº¯kï¼æ¯”å¦‚ï¼šå¦‚æœæ²¡æœ‰ç›¸åŒå‰åç¼€ï¼Œåˆ™kä¸º0\n            // è¿™é‡Œå·§å¦™åœ°å¤ç”¨äº†nextæ•°ç»„ï¼Œå› ä¸ºåœ¨æ¨è¿›kçš„è¿‡ç¨‹ä¸­ï¼Œè§‚å¯Ÿçš„ä¹Ÿæ˜¯è¿™ä¸ªæ¨¡å¼ä¸²çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨æ­¤nextä½œä¸ºå‰ç¼€çš„nextï¼\n        }\n    }\n}\nint KMP(string source, string pattern)\n{\n    int i = 0;\n    int j = 0;\n    int * next = getNext(pattern);//add\n    while(i < source.size() && j < pattern.size())\n    {\n        if(source[i] == pattern[j])\n        {\n            ++i;\n            ++j;\n        }\n        else// modify\n        {\n            j = next[j];   \n        }\n    }\n    if(j == pattern.size())//å¦‚æœpatternçš„jèµ°åˆ°äº†æœ€åï¼Œåˆ™è¯´æ˜å·²ç»å…¨éƒ¨åŒ¹é…\n    {\n        return i - j;\n    }\n    return -1;\n}\n```\nä¸Šé¢è¿™ä¸ªæ±‚nextæ•°ç»„çš„ä»£ç è™½ç„¶çœ‹èµ·æ¥å¾ˆç®€æ´ï¼Œä½†è¦å½»åº•ç†è§£ï¼Œè¿˜æ˜¯æ¯”è¾ƒéš¾çš„ï¼Œå› ä¸ºä»£ç çš„ç»†èŠ‚å¤„ç†å¾—å¾ˆå·§å¦™ï¼Œå…¶ä¸­`k = next[k]`æ›´æ˜¯å¤ç”¨äº†KMPçš„nextæ•°ç»„æ€æƒ³ã€‚\nè¿™ä¸ªæ±‚`getNext`çš„å‡½æ•°å¯ä»¥ä¼˜åŒ–ï¼Œé¿å…æ¨¡å¼ä¸²ä¸­é‡å¤çš„å­—æ®µï¼šè§ShiLeiç®—æ³•180èŠ‚\næ¯”å¦‚ï¼š`abcabc`çš„nextæ•°ç»„å¦‚æœæ²¡æœ‰ä¼˜åŒ–ï¼Œåˆ™ä¼šæˆä¸º`-1 0 0 0 1 2`ï¼Œè€Œç»è¿‡ä¼˜åŒ–ä»¥åï¼š`-1 0 0 -1 0 0`\n```c\nint * getNext(string str)\n{\n    int * next = new int[str.size()];\n    \n    int j = 0;   // j ç”¨æ¥éå†å­ä¸²\n    int k = -1;   // k ç”¨æ¥è¡¨ç¤ºå…¬å…±å‰åç¼€çš„é•¿åº¦\n    next[0] = -1; // è¡¨ç¤ºï¼Œå½“ç¬¬0ä¸ªå­—ç¬¦éƒ½å·²ç»åŒ¹é…å¤±è´¥äº†ï¼Œåˆ™åŸä¸²å‰è¿›1ï¼Œæ¨¡å¼ä¸²ä½ç½®ç»™-1ï¼Œå‰è¿›1åè‡ªç„¶åœ°ï¼ˆå·§å¦™å¤„ç†ï¼‰åˆ°0ä½ç½®ã€‚\n    while(j < str.size() - 1)//sizeä¸åŒ…æ‹¬\\0ï¼Œå³ä¸å¤„ç†æœ€åä¸€ä½å­—ç¬¦ä½ç½®\n    {\n        if(-1 == k || str[j] == str[k])\n        {\n            ++j;\n            ++k;\n            // ä¼˜åŒ–ï¼šå¦‚æœå‘ç°æ­¤æ—¶kçš„ä½ç½®å­—ç¬¦å’Œjçš„å­—ç¬¦ä¸€æ ·ï¼Œåˆ™è¯´æ˜é‡åˆ°äº†é‡å¤çš„å­—æ®µï¼Œåˆ™ç»§ç»­è¿›è¡Œå›é€€ï¼Œå°±çœå»äº†åœ¨kmpå¤„ç†ä¸­å¤šä½™çš„å›é€€ã€‚\n            if(str[k] == str[j])\n            {\n                next[j] = next[k];\n            }\n            else\n            {\n                next[j] = k;\n            }\n        }\n        else\n        {\n            k = next[k];     //å¦‚æœåœ¨æ‰¾ç›¸åŒçš„åç¼€å¤±é…ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥ä½¿ç”¨KMPçš„æ€æƒ³ï¼Œåœ¨å·²åŒ¹é…çš„è¿™éƒ¨åˆ†å­—ç¬¦ä¸²ä¸­æ‰¾ç›¸åŒçš„å‰åç¼€éƒ¨åˆ†ï¼Œä»è€Œå»å›æº¯kï¼æ¯”å¦‚ï¼šå¦‚æœæ²¡æœ‰ç›¸åŒå‰åç¼€ï¼Œåˆ™kä¸º0\n            // è¿™é‡Œå·§å¦™åœ°å¤ç”¨äº†nextæ•°ç»„ï¼Œå› ä¸ºåœ¨æ¨è¿›kçš„è¿‡ç¨‹ä¸­ï¼Œè§‚å¯Ÿçš„ä¹Ÿæ˜¯è¿™ä¸ªæ¨¡å¼ä¸²çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨æ­¤nextä½œä¸ºå‰ç¼€çš„nextï¼\n        }\n    }\n}\n```\nè¿˜æœ‰ä¸€ä¸ªæ›´ç›´ç™½çš„æ‰¾æ¨¡å¼ä¸²å­ä¸²çš„å‰åç¼€æœ€å¤§é•¿åº¦çš„æ–¹æ³•å¦‚ä¸‹ï¼š\n```c\nint PMT[50] = {0};\nvoid init_pmt(char const * pattern)\n{\n    int len = strlen(pattern);\n    char sub[50] = {'\\0'};\n    for(int i = 1; i <= len; ++i)\n    {\n        strncpy(sub, pattern, i);\n        sub[i] = '\\0';\n        char prefix[50] = {'\\0'};\n        char suffix[50] = {'\\0'}\n        for(int j = 1; j <= i - 1; ++j)\n        {\n            strncpy(prefix, sub, j);\n            prefix[j] = '\\0';\n            strcpy(suffix, sub + i - j);\n            if(strcmp(prefix, suffix) == 0)\n            {\n                PMT[i - 1] = j;\n            }\n        }\n    }\n}\nint kmp(char const * source, char const * pattern)\n{\n    //i æŒ‡ç¤º åŸä¸²ï¼ŒjæŒ‡ç¤ºæ¨¡å¼ä¸²\n    int i = 0, j = 0;\n    while(source[i] && pattern[j])\n    {\n        if(source[i] == pattern[j])\n        {\n            ++i;\n            ++j;\n        }\n        else //ä»…ä»…æ˜¯è¿™é‡Œä¸BFä¸ä¸€æ ·ã€‚\n        {\n            // é¦–ä½ä¸ç›¸ç­‰ï¼Œiè¿›1\n            if(j == 0)\n            {\n                ++i;\n            }\n            else// é™¤äº†é¦–ä½ä¸ç›¸ç­‰jå½’0å¤–ï¼Œå…¶ä»–æƒ…å†µä¸ºå›é€€jï¼Œå›é€€å¤šå°‘ï¼ŸæŸ¥è¡¨\n            {\n                j = PMT[j - 1];// j - 1æ˜¯å·²åŒ¹é…äº†çš„æœ€åä½ç½®\n            }\n        }\n    }\n    if(pattern[j] == '\\0')//å¦‚æœjç§»åˆ°äº†æœ€åï¼Œè¯´æ˜å·²ç»åŒ¹é…åˆ°\n    {\n        return i - j;//è¿”å›çš„æ˜¯åŸä¸²ä¸­ åŒ¹é…åˆ°çš„æ¨¡å¼ä¸²çš„èµ·å§‹ä½ç½®\n    }\n    return -1;\n}\n```\n![image-20240320015452152](../../images/Cè¯­è¨€_20240214_20240219_ä¸²åŒ¹é…ç®—æ³•/image-20240320015452152.png)\n\n# Bayer Moore\n\n## åå­—ç¬¦\n\næ¯æ¬¡æŠŠç›®æ ‡å­—ç¬¦ä¸²å’ŒåŸå­—ç¬¦ä¸²ä»åå¾€å‰æ¯”è¾ƒï¼Œå¦‚æœæŸä½ç½®å¯¹åº”ä¸ä¸Šï¼Œåˆ™åŸå­—ç¬¦ä¸²çš„è¿™ä¸ªå­—ç¬¦ç§°ä¸ºâ€œåï¼ˆbadï¼‰â€å­—ç¬¦ã€‚éœ€è¦åœ¨ç›®æ ‡å­—ç¬¦ä¸²ä»åå¾€å‰**ç»§ç»­å¯»æ‰¾**ï¼ˆå·²ç»åœ¨ä¹‹å‰åŒ¹é…ä¸Šçš„å­—ç¬¦è·³è¿‡ï¼‰ä¸è¿™ä¸ªbadå­—ç¬¦ç›¸ç­‰çš„å­—ç¬¦ï¼Œç„¶åæŒ‰ç…§è¿™ä¸ªç›¸ç­‰å­—ç¬¦çš„ä½ç½®ä¸åŸå­—ç¬¦ä¸²çš„åå­—ç¬¦ä½ç½®å¯¹é½ï¼ˆåç§»ç›®æ ‡å­—ç¬¦ä¸²ï¼‰ï¼›å¦‚æœåœ¨ç›®æ ‡å­—ç¬¦ä¸²ä¸­æ²¡æ‰¾åˆ°åå­—ç¬¦ï¼Œåˆ™æŠŠç›®æ ‡å­—ç¬¦ä¸²æ•´ä½“åç§»åˆ°åå­—ç¬¦ä½ç½®çš„ä¸‹ä¸€ä¸ªä½ç½®ã€‚å¯¹é½ä¹‹åï¼Œé‡æ–°æŠŠç›®æ ‡å­—ç¬¦ä¸²å’ŒåŸå­—ç¬¦ä¸²ä»åå¾€å‰æ¯”è¾ƒã€‚\n\næ‰¾åŒ¹é…ä¸²ä¸­ä¸‹ä¸€ä¸ªåå­—ç¬¦ï¼Œéœ€è¦å‘Šè¯‰ï¼šå½“å‰åå­—ç¬¦æ˜¯ä»€ä¹ˆï¼ˆåŸä¸²ä¸­çš„å­—ç¬¦ï¼‰ï¼Œå½“å‰åå­—ç¬¦ä½ç½®åœ¨å“ªï¼ˆæ¨¡å¼ä¸²ä¸­çš„ä¸‹æ ‡å€¼ï¼‰ï¼Œä»¥åŠç›®æ ‡ä¸²æŒ‡é’ˆã€‚å³ä»åŒ¹é…ä¸²ä¸­çš„åå­—ç¬¦çš„ä½ç½®çš„å‰ä¸€ä¸ªä½ç½®å¼€å§‹æ‰¾ä¸‹ä¸€ä¸ªç›¸åŒçš„å­—ç¬¦ã€‚\n\n```c\nint next_bad(char bad, char const * pattern, int wherebad)\n{\n    // patternä¸²ä¸­ä»åå¾€å‰æ‰¾ä¸åŸä¸²çš„åå­—ç¬¦ç›¸åŒçš„å­—ç¬¦ï¼Œä»å“ªé‡Œåçš„ä½ç½®çš„å‰ä¸€ä¸ªå¼€å§‹\n    // è‹¥æœªæ‰¾åˆ°å­—ç¬¦åˆ™i = -1è‡ªç„¶é€€å‡º\n    int i = -1;\n    for (i = wherebad - 1; i >= 0; --i)\n    {\n        if (pattern[i] == bad)\n        {\n            break;\n        }\n    }\n    return i;\n}\n```\n\n## å¥½åç¼€\n\nåœ¨æ¨¡å¼å­—ç¬¦ä¸²ä»åå¾€å‰ä¸åŸä¸²ä¸€ä¸€åŒ¹é…çš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°äº†åå­—ç¬¦ï¼Œé‚£ä¹ˆåå­—ç¬¦ä¹‹åçš„ï¼Œå³å·²ç»åŒ¹é…ä¸Šäº†çš„åœ¨åé¢çš„éƒ¨åˆ†ä¸²ç§°ä¹‹ä¸ºå¥½åç¼€ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥å»å¯»æ‰¾æ¨¡å¼å­—ç¬¦ä¸²ä¸­è¿˜æ˜¯å¦å­˜åœ¨å¥½åç¼€ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™å¯ä»¥è®©æ¨¡å¼å­—ç¬¦ä¸²çš„ä¸‹ä¸€ä¸ªå¥½åç¼€ä¸åŸä¸²çš„å½“å‰ä½ç½®çš„å¥½åç¼€å¯¹é½ï¼Œä»è€Œè¾¾åˆ°è®©æ¨¡å¼ä¸²å¿«é€Ÿå‰è¿›ã€‚\n\n**å¥½åç¼€çš„æ€æƒ³å¾ˆç±»ä¼¼äºKMPç®—æ³•ï¼Œå³æ‰¾å…¬å…±å‰åç¼€ï¼Œè®©é‡å¤çš„å‰ç¼€å¯¹é½åŸä¸²çš„åç¼€ä½ç½®ã€‚ä½†æ˜¯åŒºåˆ«å°±åœ¨äºï¼ŒBMç®—æ³•æ˜¯ä»åå¾€å‰å»åŒ¹é…çš„ï¼Œæ‰¾åˆ°å¥½åç¼€çš„åŒæ—¶ï¼Œé¡ºå¸¦ç€ä¹Ÿæ‰¾åˆ°äº†åå­—ç¬¦çš„ä½ç½®ã€‚**\n\nä¸‹ä¸€ä¸ªåå­—ç¬¦ä¸åŸä¸²å½“å‰åå­—ç¬¦å¯¹é½ï¼Œæˆ–è€…ä¸‹ä¸€ä¸ªå¥½åç¼€ä¸åŸä¸²å½“å‰å¥½åç¼€å¯¹é½ï¼Œæ¨¡å¼å­—ç¬¦ä¸²å‰è¿›çš„æ­¥æ•°ä¼šä¸ä¸€æ ·ï¼Œé‚£ä¹ˆï¼Œå°±å¯ä»¥å»å¯¹æ¯”å“ªä¸ªå¯ä»¥å‰è¿›å¾—æ›´å¤šã€‚\n\né‚£ä¹ˆï¼Œç±»ä¼¼äºKMPåœ°ï¼Œå»èšç„¦äºæ¨¡å¼å­—ç¬¦ä¸²æœ¬èº«ï¼Œä¸åŒç‚¹åœ¨äºï¼Œæ¯æ¬¡å¯»æ‰¾åç¼€éƒ½æ˜¯ä»å³å‘å·¦å¯»æ‰¾æœ€è¿‘çš„ä¸‹ä¸€ä¸ªå¥½åç¼€ã€‚ï¼ˆå¦‚æœæ‰¾çš„ä¸æ˜¯æœ€è¿‘çš„è€Œæ˜¯é å·¦çš„ä¸‹ä¸‹ä¸ªå¥½åç¼€çš„è¯ï¼Œé‚£ä¹ˆæ¨¡å¼å­—ç¬¦ä¸²åœ¨BMç®—æ³•å‰è¿›è¿‡ç¨‹ä¸­å°±ä¼šæ­¥å­è¿ˆå¤§äº†ï¼Œè·³è¿‡äº†å¯èƒ½å®Œå…¨æˆåŠŸåŒ¹é…çš„æœºä¼šï¼‰\n\nå»å»ºç«‹ä¸€ä¸ª`SUFFIX_TB`è¡¨æ ¼ï¼Œä¸‹æ ‡å€¼`i`ä»£è¡¨**æ­¤ä½ç½®**å¼€å§‹çš„åç¼€å­—ç¬¦ä¸²ï¼Œå†…å®¹å€¼`SUFFIX_TB[i]`ä»£è¡¨**å·¦è¾¹ä¸‹ä¸€ä¸ªæœ€è¿‘çš„å¥½åç¼€çš„ä¸‹æ ‡ä½ç½®**ã€‚\n`SUFFIX_TB`è¡¨æ ¼èµ·åˆæŠŠå…¨éƒ¨å€¼åˆå§‹åŒ–ä¸º`-1`ã€‚è¡¨ç¤ºå½“å‰`i`ä½ç½®æ—¶æ²¡æ‰¾åˆ°ä¸‹ä¸€ä¸ªå¥½åç¼€ã€‚\n```c\nint SUFFIX_TB[50] = {0};\nvoid init_suffix(char const * const pattern)\n{\n    int pattern_len = strlen(pattern);\n    char sub[50] = {'\\0'};\n    \n    for(int i = 0; i < 50; ++i)\n    {\n        SUFFIX_TB[i] = -1;\n    }\n    // iæŒ‡ç¤ºçš„æ˜¯åç¼€çš„èµ·å§‹ä½ç½®ï¼Œä»ç¬¬1ä¸ªä¸‹æ ‡ä½ç½®å¼€å§‹æ‰¾\n    for(int i = 1; i < pattern_len; ++i)\n    {\n        // å½“å‰è¦æ‰¾çš„å¥½åç¼€ä¸º iä¸‹æ ‡ä½ç½®å¼€å§‹åˆ°æœ€å \n        strcpy(sub, pattern + i);\n        // ä»å¥½åç¼€å¼€å§‹çš„ä½ç½®ï¼ˆiä¸‹æ ‡ï¼‰çš„ä¸Šä¸€ä¸ªå¼€å§‹ï¼Œä»å³å‘å·¦æ¯”è¾ƒï¼Œå› ä¸ºè¦æ‰¾æœ€è¿‘çš„\n        for(int j = i - 1; j >= 0; --j)\n        {\n            // subæ˜¯è¦æ‰¾çš„å¥½åç¼€ã€‚pattern + jæ˜¯è¦å¯¹æ¯”çš„å­—ç¬¦ä¸²çš„èµ·å§‹ä½ç½®ï¼Œä»–ä»¬çš„é•¿åº¦éƒ½åº”ä¸ºpattern_len - i\n            if(strncmp(sub, pattern + j, pattern_len - i) == 0)\n            {\n                // æ‰¾åˆ°ä»å³å¾€å·¦çš„æœ€è¿‘çš„ä¸‹ä¸€ä¸ªå¥½åç¼€ï¼Œæ›´æ–°è¡¨æ ¼ã€‚iä»£è¡¨æ­¤ä½ç½®å¼€å§‹çš„åç¼€å­—ç¬¦ä¸²ã€‚jä»£è¡¨ä¸‹ä¸€ä¸ªå¥½åç¼€çš„èµ·å§‹ä½ç½®ã€‚\n                SUFFIX_TB[i] = j;\n                // ä¸è¦å¿˜è®°breakï¼å¦‚æœä¸breakç»§ç»­æ‰¾çš„è¯ï¼Œå·¦è¾¹å¯èƒ½æœ‰å¦ä¸€ä¸ªå®Œå…¨åŒ¹é…çš„å¥½åç¼€ï¼Œä¼šè¦†ç›–æ‰\n                break;\n            }\n        }\n    }\n}\n```\nå°è£…åˆ°`next_good`å‡½æ•°ï¼Œå‚æ•°åªéœ€è¦ä¸€ä¸ªwherebadï¼Œå³åå­—ç¬¦çš„ä½ç½®ï¼ˆæ¨¡å¼ä¸²ä¸­çš„ä¸‹æ ‡å€¼ï¼‰ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç¡®å®šå¥½åç¼€çš„ä½ç½®äº†ï¼ˆå³åå­—ç¬¦çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼‰ã€‚\n```c\nint next_good(int wherebad)\n{\n    return SUFFIX_TB[wherebad+1];\n}\n```\n## å®ç°BMç®—æ³•\n\næ¯æ¬¡æ¯”è¾ƒé€‰æ‹©åå­—ç¬¦å’Œå¥½åç¼€å“ªä¸ªå¯ä»¥è®©æ¨¡å¼å­—ç¬¦ä¸²èµ°çš„æ›´è¿œã€‚å‚æ•°ä¸€ä¸ªåŸä¸²æŒ‡é’ˆï¼Œä¸€ä¸ªæ¨¡å¼ä¸²æŒ‡é’ˆã€‚è¿”å›å€¼ä¸ºåŒ¹é…æˆåŠŸåï¼ŒåŸä¸²ä¸­ç›®æ ‡å­ä¸²çš„èµ·å§‹ä¸‹æ ‡å€¼ã€‚å¦‚æœæ²¡æ‰¾åˆ°åˆ™è¿”å›`-1`ã€‚\n\n```c\nint boyer_moore(char const* const source, char const* const pattern)\n{\n    init_suffix(pattern);\n    int src_len = strlen(source), pattern_len = strlen(pattern);\n    // å› ä¸ºBMæ˜¯ä»åå¾€å‰æ¯”å¯¹çš„ï¼Œå› æ­¤ï¼Œåˆå§‹å€¼éƒ½æ˜¯ æ¨¡å¼ä¸² æœ€åä½ç½®çš„ä¸‹æ ‡å€¼-1\n    int i = pattern_len - 1, j = pattern_len - 1;\n    // å¾ªç¯å¯»æ‰¾ç›®æ ‡ä¸²çš„æ¡ä»¶æ˜¯ åŸä¸²i æ²¡åˆ°ç»“å°¾\n    // è¿™ä¸ªå¾ªç¯å¤„ç†çš„æ˜¯iï¼Œå³åªè¦é‡åˆ°å¤±é…çš„æƒ…å†µï¼Œåˆ™iå‰è¿›ï¼Œjé‡æ–°å¯¹é½ä¸‹ä¸€ä¸ªä½ç½®è¿›è¡Œå†æ¬¡ä¸€ä¸€åŒ¹é…ã€‚\n    while (i < src_len)\n    {\n        // è¿™ä¸ªå¾ªç¯å¤„ç†çš„æ˜¯jã€‚åªè¦æ¨¡å¼ä¸²jå’ŒåŸä¸²iä½ç½®çš„å­—ç¬¦ç›¸ç­‰ï¼Œåˆ™jå’ŒiåŒæ—¶å·¦ç§»1ã€‚åŒæ—¶jçš„å€¼éœ€è¦å¤§äºç­‰äº0ã€‚\n        while (source[i] == pattern[j] && j >= 0)\n        {\n            --i;\n            --j;\n        }\n        // å¦‚æœé€€å‡ºäº†å°whileå¾ªç¯ï¼Œåˆ™æœ‰ä¸¤ç§æƒ…å†µ\n        //æƒ…å†µ1ï¼š j < 0, è¯´æ˜æ¨¡å¼ä¸²jèµ°åˆ°æœ€å·¦ï¼Œåˆ™å®Œå…¨åŒ¹é…ã€‚æ­¤æ—¶iä½ç½®å¤„åœ¨ç›®æ ‡å­ä¸²å¼€å§‹çš„å‰ä¸€ä¸ªä½ç½®ã€‚åˆ™ç»“æœåº”è¿”å›i+1\n        if (j < 0)\n        {\n            return ++i;\n        }\n        //æƒ…å†µ2ï¼š æ­¤æ—¶å‡ºç°å¤±é…ï¼Œå³åŸä¸²çš„iä½ç½®å­—ç¬¦å¤±é…ã€‚\n            // å‚æ•°ï¼šå½“å‰åå­—ç¬¦æ˜¯ä»€ä¹ˆï¼ˆåŸä¸²ä¸­çš„å­—ç¬¦ï¼‰ï¼›ç›®æ ‡ä¸²æŒ‡é’ˆï¼›å½“å‰åå­—ç¬¦ä½ç½®åœ¨å“ªï¼ˆæ¨¡å¼ä¸²ä¸­çš„ä¸‹æ ‡å€¼ï¼‰\n        int next_bad_index = next_bad(source[i], pattern, j);\n        int next_good_index = next_good(j);\n        // å¯¹æ¯”è¿™ä¸¤ä¸ªå€¼ã€‚é€‰æ‹©å“ªä¸ªï¼Ÿ\n\n        // å¦‚æœåå­—ç¬¦ã€å¥½åç¼€éƒ½æ²¡æ‰¾åˆ°      0  0 æ¨¡å¼ä¸²èµ·å§‹ç‚¹é‡æ–°å¯¹é½åˆ°içš„ä¸‹ä¸€ä¸ªä½ç½®ï¼Œiå†æŒªåˆ°æœ€å\n        // å¦‚æœæ²¡æ‰¾åˆ°åå­—ç¬¦ï¼Œæ‰¾åˆ°äº†å¥½åç¼€  0  1 ç”±äºæ²¡æ‰¾åˆ°åå­—ç¬¦ï¼Œåˆ™æœ‰å¥½åç¼€ä¹Ÿæ²¡æ„ä¹‰äº†ï¼Œæ‰€ä»¥ä¸0 0ä¸€æ ·ï¼šæ¨¡å¼ä¸²èµ·å§‹ç‚¹é‡æ–°å¯¹é½åˆ°içš„ä¸‹ä¸€ä¸ªä½ç½®ï¼Œiå†æŒªåˆ°æœ€å\n        // å¦‚æœæ‰¾åˆ°äº†åå­—ç¬¦ï¼Œæ²¡æ‰¾åˆ°å¥½åç¼€  1  0 è™½ç„¶å¥½åç¼€æ˜¯-1ï¼Œçœ‹èµ·æ¥å¯ä»¥è·³è¿‡å¾ˆå¤šï¼Œä½†æ˜¯ï¼ç”±äºå­˜åœ¨åå­—ç¬¦ï¼Œä¸èƒ½ä¸€ä¸‹ç•¥è¿‡å»ï¼Œæ‰€ä»¥ä¸èƒ½é€‰æ‹©å¥½åç¼€ã€‚è¦é€‰æ‹©åå­—ç¬¦ä½ç½®å€¼\n        // \n        // æ€»ç»“ï¼šåªè¦æœ‰ä¸€ä¸ªæ²¡æ‰¾åˆ°ï¼Œåˆ™äºŒè€…æœ€å°å€¼ä¸º -1ã€‚æ¨¡å¼ä¸²èµ·å§‹ç‚¹éƒ½æ˜¯é‡æ–°å¯¹é½åˆ°içš„ä¸‹ä¸€ä¸ªä½ç½®\n\n        // å¦‚æœæ‰¾åˆ°äº†åå­—ç¬¦ï¼Œæ‰¾åˆ°äº†å¥½åç¼€   1  1\n            // å†æ¬¡åˆ†æƒ…å†µï¼šçœ‹next_goodå’Œnext_badè°å€¼å°ï¼Œé€‰è°ã€‚\n        //æ€»ç»“ï¼šå–äºŒè€…æœ€å°å€¼ã€‚\n            //å¦‚æœæ˜¯å¥½åç¼€åˆ™å°†ç›¸å½“äºå¯ä»¥æŠŠæ¨¡å¼ä¸²åç§»j - next_good + 1ã€‚\n            //å¦‚æœæ˜¯åå­—ç¬¦åˆ™å°†ç›¸å½“äºå¯ä»¥æŠŠæ¨¡å¼ä¸²åç§»j -  next_badã€‚\n                //å¦‚æœä¸¤ä¸ªéƒ½æ˜¯æœ€å°å€¼ã€‚å³ç›¸ç­‰ï¼Œåˆ™ä¼˜å…ˆé€‰æ‹©å¥½åç¼€ï¼Œå› ä¸ºå¯¹é½æ—¶ï¼Œå¥½åç¼€æ¯”åå­—ç¬¦æ›´èƒ½å¤šè¿›1ä½ã€‚\n                //å¦‚æœæœ€å°å€¼ä¸º-1ï¼Œåˆ™æ¨¡å¼ä¸²èµ·å§‹ç‚¹é‡æ–°å¯¹é½åˆ°içš„ä¸‹ä¸€ä¸ªä½ç½®\n        if (next_bad_index == -1 || next_good_index == -1)\n        {\n            if (next_bad_index == -1)\n            {\n                i += j + 1;\n            }\n            else if(next_good_index == -1)\n            {\n                i += pattern_len - 1 - next_bad_index;\n            }\n        }\n        else if (next_bad_index < next_good_index)\n        {\n            //i += pattern_len - 1 - j + j - next_bad_index;\n            i += pattern_len - 1 - next_bad_index;\n        }\n        else if (next_good_index <= next_bad_index)\n        {\n            i += pattern_len - 1 - next_good_index + 1;\n        }\n        j = pattern_len - 1;\n    }\n    return -1;\n}\n```\næµ‹è¯•\n```c\nint main()\n{\n    int res = boyer_moore(\"GATTGCTAGATTAACTATACTAA\", \"CTATACTA\");\n    return 0;\n}\n// ç»“æœï¼š14\n```\næ€»ç»“æ¥è¯´ï¼Œ\n1. å¦‚æœåå­—ç¬¦ã€å¥½åç¼€éƒ½æ‰¾åˆ°äº†ã€‚é‚£ä¹ˆå–æœ€å°å€¼ä½œä¸ºä¸‹ä¸€ä¸ªçš„å¯¹é½ç‚¹ã€‚\n    1. å¦‚æœäºŒè€…ç›¸ç­‰ï¼Œåˆ™ä¼˜å…ˆå–å¥½åç¼€ã€‚å› ä¸ºæ¨¡å¼å­—ç¬¦ä¸²é‡æ–°å¯¹é½æ—¶ï¼Œå¥½åç¼€æ¯”åå­—ç¬¦æ›´èƒ½å¤šè¿›1ä½ã€‚\n2. å¦‚æœè‡³å°‘æœ‰ä¸€ä¸ªæ²¡æ‰¾åˆ°ï¼š\n    1. BMç®—æ³•æœ€å¤§çš„æ˜“é”™ç‚¹ï¼š**å¦‚æœæ‰¾åˆ°äº†åå­—ç¬¦è€Œæ²¡æ‰¾åˆ°å¥½åç¼€ï¼Œåˆ™å¿…é¡»å»å¯¹é½åå­—ç¬¦ã€‚å› ä¸ºå¥½åç¼€æœ‰æ—¶å€™æ‰¾ä¸åˆ°æ˜¯å¾ˆæ­£å¸¸çš„ã€‚å¦‚æœè·³è¿‡äº†è¿™ä¸ªåå­—ç¬¦ï¼Œé‚£ä¹ˆå°±ä¼šå¿½ç•¥ä¸­é—´çš„æƒ…å†µï¼**\n    2. å¦‚æœæ‰¾åˆ°äº†å¥½åç¼€è€Œæ²¡æ‰¾åˆ°åå­—ç¬¦ï¼Œåˆ™å¿½ç•¥è¿™ä¸ªå¥½åç¼€ã€‚å› ä¸ºæ¨¡å¼ä¸²ä¸­æ ¹æœ¬å°±æ²¡æœ‰ä¸‹ä¸€ä¸ªåå­—ç¬¦ï¼Œä½ å»å¯¹é½å¥½åç¼€æ˜¯æ²¡æ„ä¹‰çš„ï¼æ‰€ä»¥ï¼Œæ²¡æ‰¾åˆ°åå­—ç¬¦å°±ç›¸å½“äºäºŒè€…éƒ½æ²¡æ‰¾åˆ°ï¼è§2.3ã€‚\n    3. å¦‚æœéƒ½æ²¡æ‰¾åˆ°ï¼Œåˆ™æ¨¡å¼ä¸²èµ·å§‹ç‚¹é‡æ–°å¯¹é½åˆ°å½“å‰åŸä¸²æŒ‡ç¤ºä½ç½®`i`çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼ˆå®é™…ä¸Šæ˜¯è°ƒæ•´`i`çš„å€¼æ¥åšåˆ°å¯¹é½ï¼‰ï¼Œjå†æŒªåˆ°æ¨¡å¼ä¸²çš„æœ€åï¼Œé‡æ–°ä»åå‘å‰ä¸€ä¸€åŒ¹é…ï¼\n# å®é™…çš„åœºæ™¯\n\nçº¿ä¸Šé¡¹ç›®æ¶‰åŠåˆ°æ•°æ®æœç´¢ã€å­—ç¬¦ä¸²åŒ¹é…ï¼Œå¦‚æœæ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œåº”ç”¨æœ€å¤šçš„å…¶å®æ˜¯å­—å…¸æ ‘ã€å€’æ’ç´¢å¼•çš„æ•°æ®ç»“æ„ã€‚ä¾‹å­ï¼šç™¾åº¦æœç´¢ã€å¼€æºçš„Luceneã€ElasticSearchï¼ˆElasticSearchæ˜¯ä¸€ä¸ªåŸºäºLuceneæ„å»ºçš„å¼€æºé¡¹ç›®ï¼‰\n\n```\nLucene å’Œ Elasticsearchï¼ˆESï¼‰éƒ½ä¸»è¦åŸºäºå€’æ’ç´¢å¼•ï¼ˆInverted Indexï¼‰è¿›è¡Œé«˜æ•ˆç‡æœç´¢ã€‚\n\nå€’æ’ç´¢å¼•æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œç”¨äºå¿«é€ŸæŸ¥æ‰¾åŒ…å«ç‰¹å®šè¯æ¡ï¼ˆtermï¼‰çš„æ–‡æ¡£ã€‚å®ƒå°†æ–‡æ¡£ä¸­çš„æ¯ä¸ªè¯æ¡æ˜ å°„åˆ°åŒ…å«è¯¥è¯æ¡çš„æ–‡æ¡£åˆ—è¡¨ï¼Œè¿™æ ·çš„ç´¢å¼•ç»“æ„ä½¿å¾—æœç´¢è¿‡ç¨‹èƒ½å¤Ÿå¿«é€Ÿå®šä½åˆ°åŒ…å«ç‰¹å®šè¯æ¡çš„æ–‡æ¡£ï¼Œè€Œæ— éœ€æ‰«ææ•´ä¸ªæ–‡æ¡£é›†åˆã€‚\n\nåœ¨å€’æ’ç´¢å¼•ä¸­ï¼Œæ¯ä¸ªè¯æ¡éƒ½å…³è”ç€ä¸€ä¸ªåŒ…å«è¯¥è¯æ¡çš„æ–‡æ¡£åˆ—è¡¨ï¼ˆç§°ä¸ºå€’æ’åˆ—è¡¨ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥é™„åŠ ä¸€äº›é¢å¤–çš„ä¿¡æ¯ï¼Œå¦‚è¯é¢‘ã€ä½ç½®ç­‰ã€‚è¿™ä½¿å¾—æœç´¢å¼•æ“å¯ä»¥å¿«é€Ÿå®šä½åˆ°æ»¡è¶³æŸ¥è¯¢æ¡ä»¶çš„æ–‡æ¡£ï¼Œå¹¶æ ¹æ®ç›¸å…³åº¦è¿›è¡Œæ’åºã€‚\n\nLucene æ˜¯åŸºäº Java ç¼–å†™çš„æœç´¢å¼•æ“åº“ï¼Œæä¾›äº†å€’æ’ç´¢å¼•çš„å®ç°å’Œç®¡ç†åŠŸèƒ½ï¼Œå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨ Lucene æ¥æ„å»ºè‡ªå·±çš„æœç´¢å¼•æ“æˆ–æœç´¢åŠŸèƒ½ã€‚è€Œ Elasticsearch æ˜¯ä¸€ä¸ªåŸºäº Lucene æ„å»ºçš„åˆ†å¸ƒå¼æœç´¢å’Œåˆ†æå¼•æ“ï¼Œå®ƒä½¿ç”¨ Lucene çš„å€’æ’ç´¢å¼•ä½œä¸ºæ ¸å¿ƒæ•°æ®ç»“æ„ï¼ŒåŒæ—¶æä¾›äº†åˆ†å¸ƒå¼å­˜å‚¨ã€æŸ¥è¯¢å’Œåˆ†æç­‰åŠŸèƒ½ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥è½»æ¾åœ°æ„å»ºå’Œç®¡ç†å¤§è§„æ¨¡çš„æœç´¢åº”ç”¨ã€‚\n\nå› æ­¤ï¼Œå€’æ’ç´¢å¼•æ˜¯ Lucene å’Œ Elasticsearch å®ç°é«˜æ•ˆç‡æœç´¢çš„å…³é”®æ•°æ®ç»“æ„ä¹‹ä¸€ã€‚\n```\n\n## å­—å…¸æ ‘\n\nå­—å…¸æ ‘æ˜¯æŒ‡åŸºäºæ ‘çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œç”¨äºä»¥ä¸€ç§èƒ½å¤Ÿé«˜æ•ˆæœç´¢ã€æ’å…¥å’Œåˆ é™¤æ“ä½œçš„æ–¹å¼å­˜å‚¨ä¸€ç»„é”®ï¼ˆé€šå¸¸æ˜¯å­—ç¬¦ä¸²ï¼‰ã€‚Trieæ ‘ï¼ˆåˆç§°prefix treeï¼‰å’Œä¸‰å‰æœç´¢æ ‘ï¼ˆTernary Search Treeï¼Œåˆç§°T-treeã€Tæ ‘ï¼‰æ˜¯å­—å…¸æ ‘çš„å…·ä½“å®ç°ï¼Œå„è‡ªå…·æœ‰å…¶ç‰¹ç‚¹å’Œä¼˜åŠ¿ã€‚\n\n1. Trieæ ‘ï¼ˆå‰ç¼€æ ‘ï¼‰ç‰¹åˆ«é€‚ç”¨äºéœ€è¦è¿›è¡Œå‰ç¼€åŒ¹é…å’Œæ£€ç´¢çš„ä»»åŠ¡ï¼Œä¾‹å¦‚å­—å…¸å®ç°å’Œè‡ªåŠ¨å®Œæˆç³»ç»Ÿã€‚\n2. Tæ ‘ï¼ˆä¸‰å‰æœç´¢æ ‘ï¼‰åœ¨ç©ºé—´æ•ˆç‡å’Œå¿«é€Ÿå­—ç¬¦ä¸²æœç´¢æ“ä½œä¹‹é—´æä¾›äº†å¹³è¡¡ã€‚å®ƒä»¬ä¹Ÿé€‚ç”¨äºå­—å…¸å®ç°ä»¥åŠæ‹¼å†™æ£€æŸ¥å’Œè¿‘ä¼¼å­—ç¬¦ä¸²åŒ¹é…ç­‰ä»»åŠ¡ã€‚\n\næ€»ä¹‹ï¼Œè™½ç„¶Trieæ ‘å’Œä¸‰å‰æœç´¢æ ‘æ˜¯ä¸åŒçš„å®ç°ï¼Œä½†å®ƒä»¬éƒ½å±äºå­—å…¸æ ‘ç±»åˆ«ï¼Œç”¨äºé«˜æ•ˆå­˜å‚¨å’Œæ£€ç´¢é”®-å€¼å¯¹ï¼Œå°¤å…¶æ˜¯å­—ç¬¦ä¸²ã€‚\n\n## å…¶ä»–æ ‘\n### Bæ ‘\n\nBæ ‘çš„å…¨åæ˜¯â€œBayerâ€“McCreight Bæ ‘â€ã€‚è¿™æ˜¯ä¸€ç§ç”±Rudolf Bayerå’ŒEdward M. McCreightäº1972å¹´å¼•å…¥çš„æ•°æ®ç»“æ„ã€‚Bæ ‘çš„åç§°æ¥è‡ªäºè¿™ä¸¤ä½ä½œè€…å§“æ°çš„é¦–å­—æ¯ã€‚Bæ ‘è¢«å¹¿æ³›åº”ç”¨äºæ•°æ®åº“å’Œæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œç”¨äºé«˜æ•ˆåœ°å­˜å‚¨å’Œæ£€ç´¢æ•°æ®ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤§å‹æ•°æ®é›†å’ŒåŸºäºç£ç›˜çš„å­˜å‚¨æ—¶ã€‚\n### `T*`æ ‘\n  \n`T*`æ ‘æ˜¯Bæ ‘æ•°æ®ç»“æ„çš„ä¸€ç§å˜ä½“ï¼Œæ—¨åœ¨æé«˜èŒƒå›´æŸ¥è¯¢çš„æ€§èƒ½ï¼Œä¾‹å¦‚æŸ¥æ‰¾åœ¨ç»™å®šèŒƒå›´å†…çš„æ‰€æœ‰å€¼ï¼Œä¸ä¼ ç»Ÿçš„Bæ ‘ç›¸æ¯”ã€‚\n\nåœ¨`T*`æ ‘ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯ä»¥æœ‰ä¸åŒæ•°é‡çš„å­èŠ‚ç‚¹ï¼Œé€šå¸¸èŒƒå›´åœ¨$\\sqrt dâ€‹åˆ°2d$ä¹‹é—´ï¼Œå…¶ä¸­$d$æ˜¯æ ‘çš„æœ€å¤§åº¦æ•°ã€‚è¿™å…è®¸æ›´çµæ´»åœ°å¹³è¡¡æ ‘ï¼Œå¹¶ä¸”å¯ä»¥ä½¿å¾—æ ‘çš„é«˜åº¦ç›¸æ¯”ä¼ ç»Ÿçš„Bæ ‘æ›´æµ…ï¼Œå°¤å…¶æ˜¯å¯¹äºå¤§å‹æ•°æ®é›†è€Œè¨€ã€‚\n\n`T*æ ‘`é€šè¿‡åœ¨å…¶å†…éƒ¨èŠ‚ç‚¹ä¸­å­˜å‚¨é¢å¤–çš„æ‘˜è¦ä¿¡æ¯æ¥å®ç°é«˜æ•ˆçš„èŒƒå›´æŸ¥è¯¢æ€§èƒ½ï¼Œä¾‹å¦‚å­˜å‚¨åœ¨å…¶å­æ ‘ä¸­çš„é”®çš„èšåˆå€¼æˆ–èŒƒå›´ã€‚è¿™æ ·åœ¨èŒƒå›´æŸ¥è¯¢æœŸé—´å¯ä»¥æ›´å¿«åœ°éå†å’Œä¿®å‰ªä¸å¿…è¦çš„å­æ ‘ã€‚\n\næ€»çš„æ¥è¯´ï¼Œ`T*`æ ‘æ—¨åœ¨åœ¨ä¿æŒBæ ‘çš„ä¼˜ç‚¹ï¼Œå¦‚é«˜æ•ˆçš„æ’å…¥ã€åˆ é™¤å’Œæœç´¢æ“ä½œçš„åŒæ—¶ï¼Œæä¾›æ”¹è¿›çš„èŒƒå›´æŸ¥è¯¢æ€§èƒ½ã€‚å®ƒä»¬åœ¨æ•°æ®åº“ç³»ç»Ÿå’Œå…¶ä»–éœ€è¦é«˜æ•ˆèŒƒå›´æŸ¥è¯¢çš„åº”ç”¨ä¸­è¢«å¹¿æ³›ä½¿ç”¨ã€‚\n\n### `B*`æ ‘\n\n`B*`æ ‘æ˜¯Bæ ‘çš„ä¸€ç§æ”¹è¿›ç‰ˆæœ¬ï¼Œæ—¨åœ¨å‡å°‘èŠ‚ç‚¹çš„åˆ†è£‚å’Œåˆå¹¶æ“ä½œï¼Œä»è€Œå‡å°‘æ ‘çš„é«˜åº¦ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½ã€‚\nä¸æ™®é€šçš„Bæ ‘ä¸åŒï¼Œ`B*`æ ‘åœ¨èŠ‚ç‚¹å¡«æ»¡æ—¶ä¸ä¼šç«‹å³è¿›è¡Œåˆ†è£‚ï¼Œè€Œæ˜¯ç­‰åˆ°è¾¾åˆ°é˜ˆå€¼æ—¶æ‰åˆ†è£‚ï¼Œè¿™æ ·å¯ä»¥å‡å°‘åˆ†è£‚çš„é¢‘ç‡ï¼Œå‡å°æ ‘çš„é«˜åº¦ã€‚\n\n`B*`æ ‘è¿˜é€šè¿‡åœ¨éå¶èŠ‚ç‚¹ä¸­ä¿ç•™æ›´å¤šçš„é”®æ¥å‡å°‘åˆå¹¶æ“ä½œçš„é¢‘ç‡ï¼Œä»è€Œè¿›ä¸€æ­¥å‡å°æ ‘çš„é«˜åº¦ã€‚\n\nè™½ç„¶`B*`æ ‘å’Œ`T*`æ ‘éƒ½æ˜¯Bæ ‘çš„å˜ä½“ï¼Œä½†å®ƒä»¬çš„è®¾è®¡ç›®æ ‡å’Œå®ç°æ–¹å¼ç•¥æœ‰ä¸åŒã€‚`B*`æ ‘çš„é‡ç‚¹æ˜¯å‡å°‘æ ‘çš„é«˜åº¦ï¼Œè€Œ`T*`æ ‘çš„é‡ç‚¹æ˜¯æé«˜èŒƒå›´æŸ¥è¯¢çš„æ€§èƒ½ã€‚","categories":["C","ç®—æ³•","ä¸²åŒ¹é…"]},{"title":"Cè¯­è¨€_æ ‘","url":"/C/Cè¯­è¨€_æ ‘/","content":"# BSTï¼ˆBinary Search Treeï¼ŒäºŒå‰æœç´¢æ ‘ï¼‰\n\nBinary Search Treeï¼ŒäºŒå‰æœç´¢æ ‘ï¼Œä¹Ÿç§°ä¸ºäºŒå‰æ’åºæ ‘ã€‚\nBSTï¼ˆäºŒå‰æœç´¢æ ‘ï¼‰å…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼š\n1. **æœ‰åºæ€§**ï¼šå¯¹äºä»»æ„èŠ‚ç‚¹ï¼Œå…¶å·¦å­æ ‘ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å°äºè¯¥èŠ‚ç‚¹çš„å€¼ï¼Œå³å­æ ‘ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å¤§äºè¯¥èŠ‚ç‚¹çš„å€¼ã€‚\n2. **é€’å½’ç»“æ„**ï¼šå·¦å­æ ‘å’Œå³å­æ ‘æœ¬èº«ä¹Ÿæ˜¯BSTã€‚\n\n```c\nstruct _TreeNode{\n    unsigned key;\n    char val;\n    struct _TreeNode * left;\n    struct _TreeNode * right;\n}\n```\nä¾‹å¦‚ä¸‹å›¾çš„æ ‘å°±æ˜¯ä¸€ä¸ªBSTï¼š\n![](../../images/Cè¯­è¨€_æ ‘/image-20250224214548495.png)\n## æ€§è´¨\n1. å¯ä»¥å‘ç°ï¼ŒBSTæ ‘ä¸ä¸€å®šæ˜¯å®Œå…¨äºŒå‰æ ‘ã€‚\n2. å…³äºå‰ã€ä¸­ã€ååºéå†çš„æœ‰åºæ€§ï¼š\n    - **ä¸­åºéå†**ï¼ˆå·¦ â†’ æ ¹ â†’ å³ï¼‰çš„ç»“æœæ˜¯**å‡åºæœ‰åºåºåˆ—**ã€‚è¿™æ˜¯ç”±BSTçš„æ€§è´¨ç›´æ¥ä¿è¯çš„ã€‚\n    - **å‰åºéå†**ï¼ˆæ ¹ â†’ å·¦ â†’ å³ï¼‰å’Œ**ååºéå†**ï¼ˆå·¦ â†’ å³ â†’ æ ¹ï¼‰çš„ç»“æœ**é€šå¸¸ä¸æ˜¯æœ‰åºåºåˆ—**ã€‚ä»…åœ¨æŸäº›ç‰¹æ®Šç»“æ„æœ‰åºï¼ˆå¦‚é€€åŒ–ä¸ºå•é“¾è¡¨å½¢æ€çš„å·¦æ–œæ ‘æˆ–å³æ–œæ ‘ï¼‰ã€‚\n## æ’å…¥\n\nåœ¨å½“å‰èŠ‚ç‚¹ä¸‹æ’å…¥å…ƒç´ ï¼Œè¿”å›æ–°çš„rootã€‚\n\n>ä¸ºä»€ä¹ˆè¦æ±‚è¿”å›ä¸€ä¸ªæ–°çš„rootå‘¢ï¼Ÿ\n>\n>1. ä¾¿äºè¿”å›æ–°çš„rootã€‚æ ¹èŠ‚ç‚¹ä¸ä¸€å®šä¸å˜ï¼Œæ¯”å¦‚ä¹‹åå¦‚æœæœ‰å¹³è¡¡åŒ–çš„æ“ä½œã€‚\n>2. ä¾¿äºè¿›è¡Œé€’å½’ï¼Œå› ä¸ºæ ‘æœ¬èº«å°±æ˜¯é€’å½’ç»“æ„ï¼Œå®Œæˆinsertä¹Ÿå¯ä»¥ä¾èµ–é€’å½’è¿›è¡Œï¼Œåœ¨é€’å½’è¿‡ç¨‹ä¸­ï¼Œrootæ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œå±‚å±‚é€’è¿›ã€‚\n\nå¦‚æœé‡åˆ°æ’å…¥keyç›¸åŒçš„æƒ…å†µï¼Œå°†valueå†…å®¹æ›¿ä»£ã€‚\n\nä»¥ä¸‹æ˜¯è‡ªå·±å†™çš„ç‰ˆæœ¬ï¼šleftã€rightæŒ‡é’ˆæ²¡æœ‰æ¥ä¸Šæ–°èŠ‚ç‚¹ï¼\n\n```c\nPTreeNode insert(PTreeNode root, PTreeNode node)\n{\n    if(root == NULL) return node;//ç»ˆæ­¢æ¡ä»¶ï¼Œrootä¸ºç©ºæ—¶ï¼Œç›´æ¥å°†nodeä½œä¸ºæ ¹\n    if(node->key == root->key)\n    {\n        root->val = node->val;\n        return root;\n    }\n    if(node->key < root->key)\n    {\n        root = root->left;\n    }\n    else\n    {\n        root = root->right;\n    }\n    insert(root, node);\n}\n```\n\nç®€æ´æ˜äº†çš„æ­£ç¡®ç‰ˆæœ¬ï¼š\n\n```c\nPTreeNode insert(PTreeNode root, PTreeNode node)\n{\n    if(!root) return node;//ç»ˆæ­¢æ¡ä»¶ï¼Œæ’å…¥çš„åœ°æ–¹ä¸ºç©ºæ—¶ï¼Œè¿”å›nodeæœ¬èº«ä½œä¸ºæ ¹\n    if(node->key < root->key) // keyå°äºrootæ—¶ï¼Œæ’å…¥åˆ°å·¦ä¾§\n    {\n        root->left = insert(root->left, node);\n    }\n    else if(node->key > root->key)\n    {\n        root->right = insert(root->right, node);\n    }\n    else\n    {\n        root->val = node->val;\n        free(node);//å®é™…ä¸Šä¸è¯¥ç”±æ­¤å‡½æ•°å¤„ç†ï¼Œåº”è¯¥ç”±å¤–éƒ¨å¤„ç†\n    }\n    return root;\n}\n```\n\n## åˆ›å»ºèŠ‚ç‚¹\n\n```c\nPTreeNode make_tree_node(unsigned key, char val)\n{\n    PTreeNode node = (PTreeNode)malloc(sizeof(TreeNode));\n    node->key = key;\n    node->val = val;\n    node->left = NULL;\n    node->right = NULL;\n    return node;\n}\n```\n\næµ‹è¯•\n\n```c\nint main(void)\n{\n    PTreeNode root = NULL;\n    root = insert(root, make_tree_node(3, 'c'));\n    root = insert(root, make_tree_node(2, 'b'));\n    root = insert(root, make_tree_node(4, 'd'));\n    root = insert(root, make_tree_node(1, 'a'));\n}\n```\n\n## æŸ¥æ‰¾\n\nå»ºç«‹æ ‘å°±æ˜¯ä¸ºäº†æŸ¥æ‰¾ï¼Œè™½ç„¶æ’å…¥å›°éš¾äº†äº›ï¼Œä½†æ˜¯ä¸€æ—¦æœ‰å»ºç«‹å¥½çš„æ ‘ï¼Œåˆ™æœç´¢è¦ç®€å•å¾—å¤šã€‚\n\n```c\nPTreeNode search(PTreeNode root, unsigned key)\n{\n    if(!root) return NULL;\n    if(key < root->key)\n    {\n        return search(root->left, key);\n    }\n    else if(key > root->key)\n    {\n        return search(root->right, key);\n    }\n    return root;\n}\n```\n\næµ‹è¯•\n\n```c\nint main(void)\n{\n    PTreeNode root = NULL;\n    root = insert(root, make_tree_node(3, 'c'));\n    root = insert(root, make_tree_node(2, 'b'));\n    root = insert(root, make_tree_node(4, 'd'));\n    root = insert(root, make_tree_node(1, 'a'));\n    PTreeNode node = search(root, 2);\n    PTreeNode node2 = search(root, 20);\n}\n```\n\n## åˆ é™¤\n\nç»™å®šä¸€ä¸ªrootï¼ŒæŸ¥æ‰¾ç‰¹å®šçš„keyï¼Œåˆ é™¤åï¼Œè¿”å›0æˆ–1ï¼ˆCè¯­è¨€ä¸­æ²¡æœ‰boolç±»å‹ï¼Œç”¨intä»£æ›¿ï¼‰\n\n>éœ€è¦è€ƒè™‘ï¼š\n>\n>1. åˆ é™¤çš„èŠ‚ç‚¹å¦‚æœæœ‰å­æ ‘æ€ä¹ˆåŠï¼Ÿ\n\né¦–å…ˆé€’å½’æŸ¥æ‰¾keyï¼Œå¦‚æœæ‰¾åˆ°äº†æŒ‡å®škeyï¼Œåˆ™æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š\n\n1. è¦åˆ é™¤çš„èŠ‚ç‚¹ä¸ºå¶å­èŠ‚ç‚¹ï¼šç›´æ¥åˆ é™¤\n2. è¦åˆ é™¤çš„èŠ‚ç‚¹åªæœ‰ä¸€æ”¯å­æ ‘ï¼ˆå·¦å­æ ‘æˆ–å³å­æ ‘ï¼‰ï¼šå­æ ‘èŠ‚ç‚¹ä»£æ›¿ä¸Šæ¥å³å¯\n3. è¦åˆ é™¤çš„èŠ‚ç‚¹æœ‰ä¸¤æ”¯å­æ ‘ï¼šåœ¨ä¸¤æ£µå­æ ‘ä¸­æ‰¾åˆ°ä¸€ä¸ªå€¼å¤§å°é‚»è¿‘çš„èŠ‚ç‚¹ï¼Œäº¤æ¢ä½ç½®åï¼Œå°±å¯ä»¥è½¬åŒ–ä¸ºä¸Šè¿°1ã€2çš„æƒ…å†µï¼Œå°±å¯ä»¥ç®€åŒ–åˆ é™¤è¿‡ç¨‹ã€‚\n    1. å¯ä»¥é€‰æ‹©å·¦å­æ ‘çš„æœ€å³ä¾§èŠ‚ç‚¹ï¼šå·¦å­æ ‘ä¸­æœ€å¤§å€¼ï¼Œä½†å…¶æœ‰å¯èƒ½æœ‰å·¦å­æ ‘ï¼ˆä¸€å®šä¸ä¼šå­˜åœ¨å³å­æ ‘çš„ï¼‰ï¼Œå› æ­¤è½¬åŒ–ä¸º2ã€‚å¦‚æœæ²¡æœ‰å­æ ‘ï¼Œåˆ™è½¬åŒ–ä¸º1ï¼Œç›´æ¥åˆ é™¤ã€‚\n    2. ä¹Ÿå¯ä»¥é€‰æ‹©å³å­æ ‘çš„æœ€å·¦ä¾§èŠ‚ç‚¹ï¼šå³å­æ ‘ä¸­æœ€å°å€¼ï¼Œä½†å…¶æœ‰å¯èƒ½æœ‰å³å­æ ‘ï¼ˆä¸€å®šä¸ä¼šå­˜åœ¨å·¦å­æ ‘çš„ï¼‰ï¼Œå› æ­¤è½¬åŒ–ä¸º2ã€‚å¦‚æœæ²¡æœ‰å­—æ ‘ï¼Œåˆ™è½¬åŒ–ä¸º1ï¼Œç›´æ¥åˆ é™¤ã€‚\n\n![](../../images/Cè¯­è¨€_æ ‘/image-20250225005338833.png)\n\nremoveä¹Ÿæ˜¯ä¸€ç§é€’å½’ï¼Œç»ˆæ­¢æ¡ä»¶ä¸ºå½“å‰rootä¸ºç©ºã€‚\n\n> 1. æ‰¾åˆ°èŠ‚ç‚¹ä¸ºå¶å­èŠ‚ç‚¹æ—¶ï¼Œå‘ç°è¿”å›å€¼åº”å½“ä¸ºPTreeNodeï¼Œå› ä¸ºä½ é€’å½’åˆ é™¤å­æ ‘æ—¶ï¼Œéœ€è¦åé¦ˆç»™ä¸Šå±‚ä¸€ä¸ªèŠ‚ç‚¹åœ°å€ä¿¡æ¯ï¼Œä»¥æ›´æ–°ä¸Šå±‚rootçš„å­©å­é“¾æ¥ã€‚\n> 2. å½“ç›®æ ‡èŠ‚ç‚¹æœ‰ä¸¤æ”¯å­æ ‘æ—¶ï¼Œä»å·¦å³ä¾§æ‰¾ç›¸é‚»å€¼å‡å¯ã€‚æˆ‘ä»¬é€‰æ‹©ä»å³å­æ ‘æ‰¾æœ€å°å€¼ã€‚\n> 3. removeå’Œç³»ç»Ÿåº“å‡½æ•°åå­—å†²çªï¼Œéœ€è¦æ”¹åä¸º`remove_node`\n\n```c\nint remove_node(PTreeNode root, unsigned key)\n{\n    if(!root) return NULL;\n    if(key < root->key)\n    {\n        root->left = remove_node(root->left, key);\n    }\n    else if(key > root->key)\n    {\n        root->right = remove_node(root->right, key);\n    }\n    else // æ‰¾åˆ°key\n    {\n        // æƒ…å†µ1ï¼šå¶å­èŠ‚ç‚¹\n        if(root->left == NULL && root->right == NULL)\n        {\n            free(root);\n            root = NULL;\n        }\n        // æƒ…å†µ3ï¼šåŒæ—¶æœ‰ä¸¤æ”¯å­æ ‘\n        // å½“ç›®æ ‡èŠ‚ç‚¹æœ‰ä¸¤æ”¯å­æ ‘æ—¶ï¼Œä»å·¦å³ä¾§æ‰¾ç›¸é‚»å€¼å‡å¯ã€‚æˆ‘ä»¬é€‰æ‹©ä»å³å­æ ‘æ‰¾æœ€å°å€¼ã€‚\n        else if(root->left != NULL && root->right != NULL)\n        {\n            PTreeNode right_min = find_right_min(root);\n            exchange(right_min, root);\n            // rootå·²ç»äº¤æ¢åˆ°æ·±å±‚ï¼Œå…¶å¯èƒ½æˆä¸ºäº†å¶å­èŠ‚ç‚¹ï¼Œä¹Ÿå¯èƒ½å­˜åœ¨ä¸€æ”¯å³å­æ ‘ã€‚å†æ¬¡é€’å½’èµ°æƒ…å†µ1ã€2åˆ é™¤ã€‚\n            root->right = remove_node(root->right, key);\n        }\n        else// æƒ…å†µ2ï¼šæœ‰ä¸”ä»…æœ‰ä¸€æ”¯å­æ ‘\n        {\n            PTreeNode newroot = NULL;\n            if(root->left != NULL)\n            {\n                newroot = root->left;\n            }\n            else\n            {\n                newroot = root->right;\n            }\n            free(root);\n            root = newroot;\n        }\n    }\n    return root;\n}\n```\n\n```c\n//é™¤äº†äº¤æ¢valå€¼ï¼Œä¸è¦å¿˜è®°äº¤æ¢keyå€¼\nvoid exchange(PTreeNode n1, PTreeNode n2)\n{\n    unsigned key = n1->key;\n    n1->key = n2->key;\n    n2->key = key;\n    \n    char val = n1->val;\n    n1->val = n2->val;\n    n2->val = val;\n}\n```\n\n```c\nPTreeNode find_right_min(PTreeNode root)\n{\n    //å½¢å‚ä¼ å…¥çš„æ˜¯æ ¹èŠ‚ç‚¹ï¼Œä¸æ˜¯æ ¹èŠ‚ç‚¹çš„å³å­æ ‘ï¼Œæ‰€ä»¥åˆå§‹åŒ–ä¸€å®šæ³¨æ„åº”å½“ä¼ å…¥root->right\n    PTreeNode right_min = root->right;\n    while(right_min->left)\n    {\n        right_min = right_min->left;\n    }\n    return right_min;\n}\n```\n\n# æ ‘çš„éå†æ–¹å¼\n\næ ‘æ˜¯ä¸€ç§éçº¿æ€§ç»“æ„ï¼Œæ—¢ç„¶è¦éå†å°±å¾—æŒ‰ç…§ä¸€å®šé¡ºåºã€‚\n\n1. è‹¥æŒ‰æ·±åº¦ä¼˜å…ˆï¼ˆDFSï¼‰ï¼Œä»è®¿é—®æ ¹èŠ‚ç‚¹çš„æ—¶æœºæ¥çœ‹ï¼Œæœ‰å‰åºã€ä¸­åºã€ååºã€‚\n    1. é¦–å…ˆè®¿é—®æ ¹èŠ‚ç‚¹ï¼Œç¬¬äºŒéå†å·¦å­æ ‘ï¼Œç¬¬ä¸‰éå†å³å­æ ‘ï¼šæ˜¯å‰åº\n    2. é¦–å…ˆéå†å·¦å­æ ‘ï¼Œç¬¬äºŒè®¿é—®æ ¹èŠ‚ç‚¹ï¼Œç¬¬ä¸‰éå†å³å­æ ‘ï¼šæ˜¯ä¸­åº\n    3. é¦–å…ˆéå†å·¦å­æ ‘ï¼Œç¬¬äºŒéå†å³å­æ ‘ï¼Œç¬¬ä¸‰è®¿é—®æ ¹èŠ‚ç‚¹ï¼šæ˜¯ååº\n2. è‹¥æŒ‰å¹¿åº¦ä¼˜å…ˆï¼ˆBFSï¼‰ï¼Œåˆ™æŒ‰å±‚æ¬¡éå†ã€‚\n\n## å‰åºï¼ˆPreOrderï¼‰\n\nå‰åºæ˜¯å…ˆè®¿é—®æ ¹èŠ‚ç‚¹ï¼Œå†è®¿é—®å·¦å­æ ‘ã€å³å­æ ‘ã€‚\n\n```c\nvoid visit(void PTreeNode root)\n{\n    printf(\"key: %u, val: %c\\n\", root->key, root->val);\n}\nvoid preorder(PTreeNode root)\n{\n    //ç»ˆæ­¢æ¡ä»¶ï¼Œæ ¹èŠ‚ç‚¹ä¸ºç©º\n    if(!root){\n        return;\n    }\n    //è®¿é—®æ ¹èŠ‚ç‚¹\n    visit(root);\n    //éå†å·¦å­æ ‘\n    preorder(root->left);\n    //éå†å³å­æ ‘\n    preorder(root->right);\n}\n```\n\nå‰åºéå†æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼Œç»“æœåº”ä¸ºï¼š3 2 1 4\n\n```c\nint main(void)\n{\n    PTreeNode root = NULL;\n    root = insert(root, make_tree_node(3, 'c'));\n    root = insert(root, make_tree_node(2, 'b'));\n    root = insert(root, make_tree_node(4, 'd'));\n    root = insert(root, make_tree_node(1, 'a'));\n    preorder(root);\n}\n```\n\n## ä¸­åºï¼ˆInOrderï¼‰\n\n```c\nvoid inorder(PTreeNode root)\n{\n    //ç»ˆæ­¢æ¡ä»¶ï¼Œæ ¹èŠ‚ç‚¹ä¸ºç©º\n    if(!root){\n        return;\n    }\n    //éå†å·¦å­æ ‘\n    inorder(root->left);\n    //è®¿é—®æ ¹èŠ‚ç‚¹\n    visit(root);\n    //éå†å³å­æ ‘\n    inorder(root->right);\n}\n```\n\nä¸­åºéå†æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼Œç»“æœåº”ä¸ºï¼š1 2 3 4\n\n```c\nint main(void)\n{\n    PTreeNode root = NULL;\n    root = insert(root, make_tree_node(3, 'c'));\n    root = insert(root, make_tree_node(2, 'b'));\n    root = insert(root, make_tree_node(4, 'd'));\n    root = insert(root, make_tree_node(1, 'a'));\n    inorder(root);\n}\n```\n\n## ååºï¼ˆPostOrderï¼‰\n\n```c\nvoid postorder(PTreeNode root)\n{\n    //ç»ˆæ­¢æ¡ä»¶ï¼Œæ ¹èŠ‚ç‚¹ä¸ºç©º\n    if(!root){\n        return;\n    }\n    //éå†å·¦å­æ ‘\n    postorder(root->left);\n    //éå†å³å­æ ‘\n    postorder(root->right);\n    //è®¿é—®æ ¹èŠ‚ç‚¹\n    visit(root);\n}\n```\n\nååºéå†æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼Œç»“æœåº”ä¸ºï¼š1 2 4 3\n\n```c\nint main(void)\n{\n    PTreeNode root = NULL;\n    root = insert(root, make_tree_node(3, 'c'));\n    root = insert(root, make_tree_node(2, 'b'));\n    root = insert(root, make_tree_node(4, 'd'));\n    root = insert(root, make_tree_node(1, 'a'));\n    postorder(root);\n}\n```\n\n## å±‚åºï¼ˆBFSï¼‰\n\né€’å½’æ€æƒ³ã€æ ˆç»“æ„å¯¹äºå±‚åºéå†ä¸å¤ªå¥½ä½¿ï¼Œéœ€è¦æ¢ä¸€ç§æ€è·¯ï¼Œé˜Ÿåˆ—ã€å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰ã€‚\n\n```c\nvoid bfs(PTreeNode root)\n{\n    push_node(root);\n    while(queue_size() > 0)\n    {\n        PTreeNode top = pop();\n        visit(top);\n        if(top->left != NULL)\n        {\n            push_node(top->left);\n        }\n        if(top->right != NULL)\n        {\n            push_node(top->right);\n        }\n    }\n}\n```\n\n### é˜Ÿåˆ—è®¾è®¡\n\nä½¿ç”¨é“¾è¡¨å……å½“é˜Ÿåˆ—ã€‚\n\n```c\ntypedef struct _QueueNode\n{\n    PTreeNode val;\n    struct _QueueNode * next;\n}QueueNode, * PQueueNode;\n\nPQueueNode queue_top = NULL;\n\nPQueueNode make_queue_node(PTreeNode treeNode)\n{\n    PQueueNode queue_node = (PQueueNode)malloc(sizeof(QueueNode));\n    queue_node->val = treeNode;\n    queue_node->next = NULL;\n    return queue_node;\n}\n\nvoid push_node(PTreeNode treeNode)\n{\n    PQueueNode queue_node = make_queue_node(treeNode);\n    //åˆ¤æ–­ç›®å‰æ˜¯å¦æœ‰é¦–èŠ‚ç‚¹ï¼Œæ²¡æœ‰å°±å½“ä½œé¦–èŠ‚ç‚¹\n    if(queue_top == NULL)\n    {\n        queue_top = queue_node;\n    }\n    else\n    {\n        PQueueNode cur_node = queue_top;\n        while(cur_node->next)\n        {\n            cur_node = cur_node->next;\n        }\n        cur_node->next = queue_node;\n    }\n}\nunsigned queue_size()\n{\n    unsigned cnt = 0u;\n    PQueueNode node = queue_top;\n    while(node)\n    {\n        ++cnt;\n        node = node->next;\n    }\n}\nPTreeNode pop()\n{\n    if(queue_top == NULL)return NULL;\n    PTreeNode treeNode = queue_top->val;\n    PQueueNode oldNode = queue_top;\n    queue_top = queue_top->next;\n    free(oldNode);\n    oldNode = NULL;\n}\n```\n\nå±‚åºéå†æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼Œç»“æœåº”ä¸ºï¼š3 2 4 1\n\n```c\nint main(void)\n{\n    PTreeNode root = NULL;\n    root = insert(root, make_tree_node(3, 'c'));\n    root = insert(root, make_tree_node(2, 'b'));\n    root = insert(root, make_tree_node(4, 'd'));\n    root = insert(root, make_tree_node(1, 'a'));\n    bfs(root);\n    return 0;\n}\n```\n\n# Bæ ‘ï¼ˆ2-3-(4)æ ‘ï¼‰\n\nBä»£è¡¨Balancedï¼Œæ®è¯´ä¹Ÿä»£è¡¨æ³¢éŸ³å…¬å¸ï¼Œå› ä¸ºå®ƒæ˜¯ç”±Rudolf Bayerå’ŒEdward M. McCreightåœ¨æ³¢éŸ³ç ”ç©¶å®éªŒå®¤å·¥ä½œæ—¶å‘æ˜çš„ã€‚\nå…¶æ€§è´¨æ˜¯ä¸ºäº†è§£å†³BSTæ ‘çš„é€€åŒ–é—®é¢˜çš„ï¼Œæ¯”å¦‚è¯´ä¸€ç›´å‘å·¦å­æ ‘æ’å…¥ä¸€ä¸ªè¾¹ç¼˜å€¼ï¼Œå°±ä¼šå¯¼è‡´æ ‘é€€åŒ–ä¸ºé“¾è¡¨ï¼Œè¿™ç§ä¸å¹³è¡¡å¯¼è‡´æ•ˆç‡é™ä½ã€‚\n\nBæ ‘æ´¾ç”Ÿå‡ºå¥½å¤šç§å½¢æ€çš„æ ‘ï¼Œ2-3-(4)æ ‘å°±æ˜¯Bæ ‘çš„4é˜¶å½¢å¼ã€‚çº¢é»‘æ ‘åˆæ˜¯2-3-(4)æ ‘çš„ä¸€ç§å½¢å¼ï¼Œæ˜¯ä¸€ç§å¤šå‰æ ‘çš„äºŒå‰æ ‘å®ç°ã€‚\n## Bæ ‘ã€AVLæ ‘ã€çº¢é»‘æ ‘çš„å¯¹æ¯”\nAVLæ ‘ã€Bæ ‘ã€çº¢é»‘æ ‘ï¼Œéƒ½æ˜¯è§£å†³BSTæ ‘é€€åŒ–é—®é¢˜çš„è‡ªå¹³è¡¡ç»“æ„ã€‚\n1. ç»“æ„ä¸Šï¼š\n    1. AVLæ ‘å’Œçº¢é»‘æ ‘éƒ½æ˜¯äºŒå‰æ ‘ã€‚èŠ‚ç‚¹ä¸­éƒ½è®°å½•äº†å¹³è¡¡çŠ¶æ€ã€‚\n        1. AVLå­˜å‚¨å¹³è¡¡å› å­ã€‚\n        2. çº¢é»‘æ ‘å­˜å‚¨é¢œè‰²æ ‡è®°ã€‚\n    2. Bæ ‘ä¸ºå¤šè·¯æ ‘ï¼ŒèŠ‚ç‚¹æœ‰å¤šä¸ªé”®ã€å­èŠ‚ç‚¹æŒ‡é’ˆã€‚\n2. æ€§èƒ½ä¸Šï¼š\n    1. AVLæ ‘ï¼Œä¸¥æ ¼å¹³è¡¡ã€‚æŸ¥è¯¢æ•ˆç‡æœ€é«˜ã€‚\n    2. çº¢é»‘æ ‘ï¼Œä¸ä¸¥æ ¼å¹³è¡¡ã€‚æŸ¥è¯¢æ•ˆç‡ç•¥æ…¢äºAVLæ ‘ã€‚\n        1. ä½†åœ¨æ•°å­¦ä¸Šï¼ŒAVLå’Œçº¢é»‘æ ‘çš„å¢åˆ æŸ¥æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯å¤§O(log n)ã€‚\n        2. å¯¹äºæ’å…¥æ“ä½œï¼ŒAVLå’Œçº¢é»‘æ ‘éƒ½æ˜¯æœ€å¤šæ—‹è½¬2æ¬¡ã€‚\n        3. å¯¹äºåˆ é™¤æ“ä½œï¼ŒAVLæ ‘ç”±äºéœ€è¦ä¸¥æ ¼å¹³è¡¡ï¼Œæ—‹è½¬æ¬¡æ•°å¯èƒ½éœ€è¦O(log n)æ¬¡ï¼Œè€Œçº¢é»‘æ ‘å¯ä»¥é€šè¿‡ç¿»è½¬é¢œè‰²ï¼Œè®©æ—‹è½¬æ¬¡æ•°æœ€å¤š3æ¬¡ã€‚\n            1. ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥è¯´â€œlognÂ æ¬¡â€ï¼Ÿ\n                1. å¹³è¡¡å› å­ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„å·¦å³å­æ ‘é«˜åº¦å·®ï¼ˆBalance Factor, BFï¼‰çš„ç»å¯¹å€¼ä¸è¶…è¿‡1ã€‚\n                2. é«˜åº¦çº¦æŸï¼šå¯¹äºåŒ…å«Â nÂ ä¸ªèŠ‚ç‚¹çš„AVLæ ‘ï¼Œå…¶é«˜åº¦Â hâ‰¤1.44log2â€‹nï¼ˆåŸºäºæ–æ³¢é‚£å¥‘æ•°åˆ—çš„é»„é‡‘åˆ†å‰²æ¯”ä¾‹ï¼‰ã€‚\n                3. æ ‘é«˜ä¸è·¯å¾„é•¿åº¦ï¼šè‹¥æ ‘é«˜ä¸ºÂ hï¼Œåˆ é™¤èŠ‚ç‚¹çš„è·¯å¾„é•¿åº¦æœ€å¤šä¸ºÂ hã€‚\n                4. æ¯å±‚æœ€å¤šä¸€æ¬¡æ—‹è½¬ï¼šæ¯å±‚å¤±è¡¡èŠ‚ç‚¹éœ€ä¸€æ¬¡æˆ–ä¸¤æ¬¡æ—‹è½¬ï¼ˆå¦‚åŒæ—‹ï¼‰ï¼Œä½†æ—‹è½¬æ¬¡æ•°çš„å¢é•¿è¶‹åŠ¿ä»ä¸ºÂ O(h)ã€‚\n                5. æœ€ç»ˆç»“æœï¼šæœ€åæ—‹è½¬æ¬¡æ•°=O(h)=O(logn)\n    3. Bæ ‘ä¹Ÿæ˜¯å¹³è¡¡çš„ï¼Œä½†å…¶åªé€‚ç”¨äºå¤–å­˜ï¼ˆç£ç›˜ï¼‰IOæ“ä½œã€‚\n        1. è§â€œé«˜çº§æ•°æ®ç»“æ„_Bæ ‘â€\n        2. Bæ ‘ä¸éœ€è¦æ—‹è½¬èŠ‚ç‚¹ã€‚æ˜¯é€šè¿‡åˆ†è£‚ã€åˆå¹¶èŠ‚ç‚¹è¾¾åˆ°å¹³è¡¡çš„ã€‚\n        3. ä¸ºä»€ä¹ˆBæ ‘ä¸åƒAVLã€çº¢é»‘æ ‘é‚£æ ·é€‚ç”¨äºå†…å­˜æ“ä½œï¼š\n            1. **æŒ‡é’ˆæ“ä½œå¼€é”€**ï¼šBæ ‘çš„æ’å…¥/åˆ é™¤æ¶‰åŠå¤šæ¬¡æŒ‡é’ˆè°ƒæ•´ï¼ˆåˆ†è£‚æˆ–åˆå¹¶èŠ‚ç‚¹ï¼‰ï¼Œè€ŒAVL/çº¢é»‘æ ‘çš„æ—‹è½¬æ“ä½œä»…éœ€ä¿®æ”¹å°‘é‡æŒ‡é’ˆã€‚\n            2. Bæ ‘èŠ‚ç‚¹çš„æ•°æ®é‡é€šå¸¸è¾ƒå¤§ï¼ˆä¾‹å¦‚ä¸€ä¸ªèŠ‚ç‚¹å 4KBï¼‰ï¼Œå¯èƒ½è¶…å‡ºCPUç¼“å­˜è¡Œï¼ˆé€šå¸¸64B-256Bï¼‰ï¼Œå¯¼è‡´ç¼“å­˜æœªå‘½ä¸­ç‡å¢åŠ ã€‚\n            3. æ€»ä¹‹ï¼Œ**å±€éƒ¨æ€§å·®**ï¼šäºŒå‰æ ‘çš„èŠ‚ç‚¹è¾ƒå°ï¼Œæ›´å®¹æ˜“è¢«ç¼“å­˜å‘½ä¸­ï¼›è€ŒBæ ‘çš„èŠ‚ç‚¹éå†éœ€è¦è®¿é—®æ›´å¤šå†…å­˜å—ï¼Œé™ä½ç¼“å­˜åˆ©ç”¨ç‡ã€‚\n    4. å› æ­¤ã€‚AVLæ ‘é€‚åˆè¯»å¤šå†™å°‘ï¼›çº¢é»‘æ ‘é€‚åˆå†™å¤šè¯»å°‘ã€‚\n\nä¸Bæ ‘ä¸åŒçš„æ˜¯ï¼ŒAVLæ˜¯ä¸€ç§BSTï¼Œæ˜¯äºŒå‰æ ‘ï¼Œå³æ¯”å¹³è¡¡äºŒå‰æœç´¢æ ‘å¤šäº†å¹³è¡¡çš„æ¦‚å¿µï¼Œå…·ä½“æ¥è¯´å¤šäº†æ—‹è½¬çš„æ“ä½œã€èŠ‚ç‚¹çš„çŠ¶æ€ã€‚\nBæ ‘åœ¨åŸå‹ä¸Šï¼Œæ˜¯å¤šå‰æ ‘ï¼Œä¸”èŠ‚ç‚¹å¯æœ‰å¤šä¸ªå€¼ã€‚ç”±äºBæ ‘ä¸æ˜¯äºŒå‰æ ‘ï¼Œå› æ­¤Bæ ‘ä¸å±äºBSTã€‚\n\nå¯¹äºAVLå’Œçº¢é»‘æ ‘ï¼šç”±äºAVLæ˜¯ä¸¥æ ¼å¹³è¡¡çš„ï¼Œåœ¨æŸ¥è¯¢æ•ˆç‡ä¸Šç•¥ä¼˜äºçº¢é»‘æ ‘è¿™ç§ä¸ä¸¥æ ¼å¹³è¡¡çš„æ ‘ï¼Œä½†å®ƒä»¬çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯$O(\\log n)$;\nä½†æ˜¯ï¼Œå¯¹äºAVLå’ŒBæ ‘è€Œè¨€ï¼Œæœç´¢ç®—æ³•æ²¡ä»€ä¹ˆå·®å¼‚ï¼ŒAVLæ ‘å’ŒBæ ‘åŒæ ·éƒ½æ˜¯äºŒåˆ†æŸ¥æ‰¾çš„åˆ†æ²»ç­–ç•¥, æ—¶é—´å¤æ‚åº¦éƒ½ä¸º$O(\\log n)$;\n## èŠ‚ç‚¹å½¢æ€\n\næœ‰2å‹èŠ‚ç‚¹ã€3å‹èŠ‚ç‚¹ã€‚\n\n2å‹èŠ‚ç‚¹æ˜¯èŠ‚ç‚¹å†…éƒ¨æœ‰1ä¸ªkeyï¼Œå¯ä»¥æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼›3å‹èŠ‚ç‚¹æ˜¯å†…éƒ¨æœ‰2ä¸ªkeyï¼Œå¯ä»¥æœ‰ä¸‰ä¸ªå­èŠ‚ç‚¹ã€‚2-3æ ‘çš„æ„æ€æ˜¯ï¼Œæ ‘ä¸­å¯èƒ½åŒ…å«2å‹èŠ‚ç‚¹å’Œ3å‹èŠ‚ç‚¹ã€‚\n\næ’å…¥èŠ‚ç‚¹ä½ç½®çš„è§„åˆ™éµå¾ªBSTreeçš„è§„åˆ™ï¼Œå³ä»å·¦å¾€å³æŒ‰ä»å°åˆ°å¤§çš„é¡ºåºï¼Œå·¦ä¾§æœ€å°ã€å³ä¾§æœ€å¤§ã€‚å¦‚æœæ˜¯3å‹èŠ‚ç‚¹ï¼Œåˆ™éœ€è¦æ»¡è¶³ï¼šå·¦ä¾§æœ€å°ï¼Œkey1æ¬¡å°ï¼Œä¸­å­æ ‘æ˜¯ä¸­å€¼ï¼Œkey2æ¬¡å¤§ï¼Œå³ä¾§æœ€å¤§ã€‚\n![](../../images/Cè¯­è¨€_æ ‘/image-20250225014448845.png)\n\né™¤äº†ä»¥ä¸Šè§„åˆ™ä»¥å¤–ï¼Œä¸ºäº†èƒ½æ›´å¥½åœ°æ§åˆ¶2-3-(4)æ ‘ï¼Œå¤šäº†ä¸€ä¸ªç‰¹æ®Šçš„é™„åŠ è§„åˆ™ï¼š**2ã€3ã€4å‹èŠ‚ç‚¹è¦ä¹ˆæ˜¯å¶å­èŠ‚ç‚¹ï¼ˆæ²¡æœ‰å­èŠ‚ç‚¹ï¼‰ï¼Œè¦ä¹ˆå­èŠ‚ç‚¹å…¨éƒ½å æ»¡ï¼Œæ²¡æœ‰ä¸­é—´çŠ¶æ€**ã€‚\n![](../../images/Cè¯­è¨€_æ ‘/image-20250225034030105.png)\n1. å‡è®¾ç›®å‰æœ‰ä¸€ä¸ªå†…å«6çš„2å‹èŠ‚ç‚¹\n   ![](../../images/Cè¯­è¨€_æ ‘/image-20250225034704385.png)\n2. è¦æ’å…¥9ï¼Œç”±äºå­æ ‘è¦ä¹ˆç©ºè¦ä¹ˆæ»¡ï¼Œæ‰€ä»¥åªèƒ½å°†å…¶ä¸6å¹¶åˆ—æ”¾å…¥2å‹èŠ‚ç‚¹ä¸­ï¼Œå˜ä¸ºä¸€ä¸ªå†…å«6ã€9çš„3å‹èŠ‚ç‚¹ã€‚\n   ![](../../images/Cè¯­è¨€_æ ‘/image-20250225040509456.png)\n3. ç»§ç»­æ’å…¥7ï¼Œä¼šè¿›å…¥ä¸€ä¸ªä¸´æ—¶çŠ¶æ€ï¼Œå³å°†å…¶ä¸6ã€9å¹¶åˆ—ï¼Œå˜ä¸ºä¸€ä¸ªå†…å«6ã€7ã€9çš„4å‹èŠ‚ç‚¹ã€‚ä½†æ˜¯ç´§æ¥ç€ï¼Œä¼šåˆ†è£‚ä¸º3ä¸ª2å‹èŠ‚ç‚¹ï¼š7ä½œä¸ºæ ¹èŠ‚ç‚¹ï¼Œå·¦å­æ ‘ä¸º6ï¼Œå³å­æ ‘ä¸º9ã€‚\n   ![](../../images/Cè¯­è¨€_æ ‘/image-20250225040736460.png)\n4. ç»§ç»­æ’å…¥5ï¼Œç»è¿‡å¯¹æ¯”ï¼Œå‘7çš„å·¦å­æ ‘6æ’å…¥ï¼Œä¸6å¹¶åˆ—ï¼Œå˜ä¸ºä¸€ä¸ªå†…å«5ã€6çš„3å‹èŠ‚ç‚¹ã€‚\n   ![](../../images/Cè¯­è¨€_æ ‘/image-20250225041013571.png)\n5. ç»§ç»­æ’å…¥4ï¼Œç»è¿‡å¯¹æ¯”ï¼Œå‘7çš„å·¦å­æ ‘ï¼ˆ5ã€6ï¼‰æ’å…¥ï¼Œä¸5ã€6å¹¶åˆ—ï¼Œå˜ä¸ºä¸€ä¸ªå†…å«4ã€5ã€6çš„4å‹èŠ‚ç‚¹ã€‚\n6. ç´§æ¥ç€ï¼Œå·¦å­æ ‘åˆè¦é¢ä¸´åˆ†è£‚ä¸º3ä¸ª2å‹èŠ‚ç‚¹ï¼Œä½†å¦‚æœå•çº¯åœ°åˆ†åˆ«æŠŠ4ã€6ä¸‹è£‚åï¼Œåªæœ‰å·¦æ”¯çš„æ·±åº¦å•ç‹¬åŠ 1ï¼Œä¼šå¯¼è‡´æ•´ä¸ªæ ‘çš„ä¸å¹³è¡¡ï¼ˆå·¦åï¼‰ã€‚\n7. ä½†å¦‚æœæ¢ä¸ªæ–¹å‘ï¼Œå‘çˆ¶èŠ‚ç‚¹æ¨5ï¼Œä¼šå·§å¦™åœ°ä¿æŒæ•´ä¸ªæ ‘æ·±åº¦åŒæ­¥ã€‚\n8. è€Œ5ä¸Šæ¨ä¸7å¹¶åˆ—åï¼Œæ ¹èŠ‚ç‚¹å˜ä¸º3å‹èŠ‚ç‚¹ï¼Œéœ€è¦æœ‰ä¸‰ä¸ªå­æ ‘ï¼Œé‚£ä¹ˆ9ä¿ç•™åŸä½ï¼Œè€Œ4ã€6æ­£å¥½å¯ä»¥å„å ä¸€ä¸ªå­æ ‘çš„ä½ç½®ã€‚æ‰€ä»¥ï¼Œæœ€ç»ˆç»“æœä¸ºï¼šæ•´æ ¹ä¸ºï¼ˆ5ã€7ï¼‰ï¼Œå­æ ‘1ä¸º4ï¼Œå­æ ‘2ä¸º6ï¼Œå­æ ‘3ä¸º9ã€‚\n   ![](../../images/Cè¯­è¨€_æ ‘/image-20250225041636018.png)\n## å®ç°\n1. å…¶ä¸­ä¸€ä¸ªæ¯”è¾ƒæ£˜æ‰‹çš„é—®é¢˜æ˜¯ï¼Œå‡¡æ˜¯ä¸¤ä¸ªæ•°ä»¥ä¸Šçš„æ¯”è¾ƒï¼Œéƒ½éœ€è¦ä¸€ä¸ªæœºåˆ¶æ¥å¯¹æ¯”ï¼Œå“ªæ€•æ˜¯ä¸‰ä¸ªæ•°çš„å¯¹æ¯”ã€‚\n2. 2-3-4æ ‘çš„æ•°æ®ç»“æ„ä¸ç¡®å®šï¼Œæœ‰ä¸­é—´ä¸ç¨³å®šçš„4å‹èŠ‚ç‚¹ï¼Œæ‰€ä»¥ä¸èƒ½ç®€å•åœ°ç”¨leftã€middleã€rightå¯¹æ¯”ã€‚\n3. å¦‚æœBæ ‘å•ä¸ªèŠ‚ç‚¹ä¸­æœ‰ä¸Šåƒä¸ªæ•°æ®ï¼Œé‚£ä¹ˆå°±ç”¨æ•°ç»„æ¥å­˜æ”¾ã€‚ä½†æ˜¯å¦‚æœæ­¤Bæ ‘æ˜¯2-3-4æ ‘ï¼Œåˆ™æ•°ç»„å°±æ˜¾å¾—æ¯”è¾ƒå¤§åŠ¨å¹²æˆˆäº†ã€‚\n4. ç»¼ä¸ŠåŸå› ï¼Œæˆ‘ä»¬æƒ³åˆ°ä¸€ä¸ªå·§å¦™çš„æ–¹æ³•ï¼Œå°±æ˜¯ç”¨é¢œè‰²æ¥ä»£æ›¿æŸäº›æ”¯ã€‚ç”±æ­¤äº§ç”Ÿäº†ï¼šçº¢é»‘æ ‘\n\n# çº¢é»‘æ ‘ï¼ˆäºŒå‰æœç´¢çº¢é»‘æ ‘ï¼‰\n\nçº¢é»‘æ ‘å…¶å®æ˜¯2-3æ ‘çš„ä¸€ä¸ªå˜å½¢ï¼ˆä¸å­˜åœ¨4å‹èŠ‚ç‚¹ï¼‰ã€‚\n\næˆ‘ä»¬åŠ ä»¥äººä¸ºè§„å®šï¼šæŠŠåŸå…ˆ2-3æ ‘ï¼ŒåŒä¸€èŠ‚ç‚¹ä¸­çš„è¾ƒå°æ•°è£‚åœ¨æ ¹èŠ‚ç‚¹çš„å·¦ä¾§å­æ ‘ã€‚è¿™æ ·çš„è¯ï¼Œ3å‹èŠ‚ç‚¹å°±è½¬åŒ–æˆäº†äºŒå‰æ ‘ã€‚\n\n>å½“ç„¶ä¹Ÿå¯ä»¥äººä¸ºè§„å®šæŠŠè¾ƒå¤§æ•°æ”¾åœ¨å³ä¾§å­æ ‘ï¼Œç”šè‡³è¯´åŒæ—¶å­˜åœ¨è¾ƒå°æ•°æ”¾å·¦ã€è¾ƒå¤§æ•°æ”¾å³çš„æƒ…å†µã€‚è¿™æ ·å¾’ä½¿ç¨‹åºå˜å¾—å¾ˆå¤æ‚ï¼Œå¤±å»äº†ç®€åŒ–2-3æ ‘çš„æ„ä¹‰ã€‚æ‰€ä»¥ä¸ºäº†ç¼–å†™ç¨‹åºç®€å•ï¼Œç»Ÿä¸€è§„å®šéƒ½æŒ‰å·¦ä¾§ï¼ˆå·¦æ–œï¼‰å¤„ç†ã€‚\n\n![](../../images/Cè¯­è¨€_æ ‘/image-20250225072634225.png)\nä¸Šå›¾çš„ c ç”¨çº¢çº¿ç›¸è¿ï¼ŒæŒ‡å‘ aï¼Œç§° a ä¸ºçº¢è‰²èŠ‚ç‚¹ï¼Œä»£è¡¨ aã€c åŸå…ˆåœ¨2-3æ ‘ä¸­æ›¾ä¸ºåŒä¸€èŠ‚ç‚¹ã€‚çº¢è‰²ä»£è¡¨é²œæ˜ï¼Œå¯ä»¥ç†è§£ä¸ºï¼šæœ‰è¡€è‚‰è”ç³»ã€‚c æ˜¯é»‘è‰²èŠ‚ç‚¹ã€‚\n## çº¢é»‘æ ‘å¯¹åº”2-3æ ‘çš„æœ‰æ•ˆå½¢å¼\n1. æˆ‘ä»¬å°†æ ‘ä¸­çš„é“¾æ¥åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼š\n    1. çº¢é“¾æ¥å°†ä¸¤ä¸ª2- ç»“ç‚¹è¿æ¥èµ·æ¥æ„æˆä¸€ä¸ª3- ç»“ç‚¹\n    2. é»‘é“¾æ¥åˆ™æ˜¯2-3 æ ‘ä¸­çš„æ™®é€šé“¾æ¥ã€‚\n    3. ç¡®åˆ‡åœ°è¯´ï¼Œæˆ‘ä»¬å°†3- ç»“ç‚¹è¡¨ç¤ºä¸ºç”±ä¸€æ¡å·¦æ–œçš„çº¢è‰²é“¾æ¥ï¼ˆä¸¤ä¸ª2-ç»“ç‚¹å…¶ä¸­ä¹‹ä¸€æ˜¯å¦ä¸€ä¸ªçš„å·¦å­ç»“ç‚¹ï¼‰ç›¸è¿çš„ä¸¤ä¸ª2- ç»“ç‚¹ã€‚\n    4. è§„å®šåªèƒ½å·¦çº¢ï¼Œä¸èƒ½å‡ºç°å³çº¢ã€‚\n2. è§„å®šåªèƒ½è¿ç»­ä¸€æ”¯çº¢çº¿ï¼Œå³ä¸€ä¸ªèŠ‚ç‚¹æœ€å¤šåªèƒ½ç”±ä¸€ä¸ªçº¢çº¿è¿æ¥ï¼Œå³è¡¨ç¤ºåœ¨2-3æ ‘ä¸­çš„3å‹èŠ‚ç‚¹ã€‚ä¸èƒ½å‡ºç°è¿ç»­ä¸¤æ”¯çº¢çº¿ã€‚\n3. åœ¨å®é™…ç¨‹åºä¸­ï¼Œå› ä¸ºæ¯ä¸ªç»“ç‚¹éƒ½åªä¼šæœ‰ä¸€æ¡æŒ‡å‘è‡ªå·±çš„é“¾æ¥ï¼ˆä»å®ƒçš„çˆ¶ç»“ç‚¹æŒ‡å‘å®ƒï¼‰ï¼Œæˆ‘ä»¬æŠŠé¢œè‰²å­˜å‚¨åœ¨å·¦å­æ ‘èŠ‚ç‚¹ã€‚\n4. å¦‚æœæŒ‡å‘å®ƒçš„é“¾æ¥æ˜¯çº¢è‰²çš„ï¼Œé‚£ä¹ˆä¸ºçº¢è‰²ã€‚æˆ‘ä»¬çº¦å®šç©ºé“¾æ¥ä¸ºé»‘è‰²ï¼ˆå› æ­¤æ ¹èŠ‚ç‚¹å­˜å‚¨çš„åº”å½“æ€»æ˜¯é»‘è‰²ã€‚æˆ‘ä»¬åœ¨æ¯æ¬¡æ’å…¥åéƒ½è¦å°†æ ¹ç»“ç‚¹è®¾ä¸ºé»‘è‰²ã€‚æ³¨æ„ï¼Œæ¯å½“æ ¹ç»“ç‚¹ç”±çº¢å˜é»‘æ—¶æ ‘çš„é»‘é“¾æ¥é«˜åº¦å°±ä¼šåŠ 1ï¼‰ã€‚\n5. æœ‰è¿™æ ·çš„æ€§è´¨ï¼Œçº¢é»‘æ ‘æœ€é•¿æ”¯çš„é•¿åº¦ ä¸è¶…è¿‡ æœ€çŸ­æ”¯çš„é•¿åº¦çš„2å€ã€‚è™½ç„¶AVLæ ‘æœ€å¤§å·®1ï¼Œä½†AVLæ ‘æ’å…¥æ€§èƒ½å¤ªæ…¢ã€‚çº¢é»‘æ ‘å°±å¾ˆå¥½åœ°å¹³è¡¡äº†å±‚æ•°å·®å¼‚å’Œæ€§èƒ½ã€‚\n\n## æç«¯å½¢å¼\n\näºŒå‰æ ‘çš„æç«¯å½¢å¼å°±æ˜¯ï¼šä¸€æ”¯æœ€é•¿ã€ä¸€æ”¯æœ€çŸ­ï¼šå·¦å­æ ‘æœ€é•¿æƒ…å†µä¸‹æ˜¯ä¸€çº¢çº¿ä¸€é»‘çº¿äº¤æ›¿ç©¿æ’ã€‚å³å­æ ‘æœ€çŸ­æƒ…å†µä¸‹æ˜¯å…¨é»‘ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå·¦æ”¯å’Œå³æ”¯çš„é«˜åº¦å·®æœ€å¤§æ˜¯2å€ã€‚è¿™ä¸ªé«˜åº¦å·®æ˜¯å¯ä»¥æ¥å—çš„ï¼Œå› ä¸ºçº¢é»‘æ ‘ç›¸æ¯”äºå…¶ä»–æ ‘æ¥è¯´æ’å…¥è¾ƒç®€å•ï¼Œæ¯”å¦‚ä¸¤è¾¹æœ€å¤šå·®1çš„AVLæ ‘æ’å…¥æ˜¯å¾ˆè´¹åŠ²çš„ï¼Œæ—¶é—´å¤æ‚åº¦å¤ªé«˜ã€‚è€Œåˆèƒ½å…¼é¡¾åˆ°æŸ¥æ‰¾çš„é€Ÿåº¦ã€‚\n\n## åº”ç”¨\n\nSTLä¸­çš„mapï¼ˆdictionaryï¼‰ã€setï¼›\n\nLinuxä¸­ç½‘ç»œç¼–ç¨‹ä¸­epollç”¨åˆ°çš„æ•°æ®ç»“æ„\n\n## èŠ‚ç‚¹å®šä¹‰\n\n> ç”¨ç›´è§‚çš„ç¬¦å·ä»£æ›¿ä¸ç›´è§‚çš„å†…å®¹ï¼ˆæ•´æ•°ï¼Œä¸èƒ½æ˜¯å°æ•°ï¼‰ã€‚é€šå¸¸éœ€è¦typedefï¼Œå¦åˆ™åœ¨å£°æ˜ã€åˆå§‹åŒ–æšä¸¾ç±»æ—¶ï¼Œéœ€è¦å†™å‡ºå…¨ç§°`enum Color`ã€‚\n```c\ntypedef enum _Color\n{\n    Black = 0,\n    Red\n}Color;\n```\n\n```c\ntypedef struct _RBNode\n{\n    unsigned key;\n    char val;\n    Color color;\n    struct _RBNode * left;\n    struct _RBNode * right;\n}RBNode, *PRBNode;\n```\n\n## æ’å…¥\n\næˆ‘ä»¬å¯ä»¥é»˜è®¤åˆ›é€ å‡ºçš„æ–°èŠ‚ç‚¹éƒ½æ˜¯çº¢è‰²çš„ï¼Œå› ä¸º2-3æ ‘åœ¨æ’å…¥èŠ‚ç‚¹æ—¶ï¼ŒèŠ‚ç‚¹æ€»æ˜¯è¯•å›¾ä¸ä¸Šå±‚èŠ‚ç‚¹ç»“åˆæˆä¸ºåŒä¸€èŠ‚ç‚¹ã€‚\n### åˆ›å»ºèŠ‚ç‚¹ï¼ˆé»˜è®¤çº¢è‰²ï¼‰\n```c\nPRBNode make_rb_node(unsigned key, char val)\n{\n    PRBNode node = (PRBNode)malloc(sizeof(RBNode));\n    node->val = val;\n    node->key = key;\n    node->color = Red;\n    node->left = NULL;\n    node->right = NULL;\n}\n```\n### æ ¹èŠ‚ç‚¹çš„é¢œè‰²é—®é¢˜ï¼ˆæ’å…¥ç©ºæ ‘ï¼‰\nåœ¨ä¸‹é¢æ’å…¥çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šæœ‰é¢œè‰²è½¬æ¢æ“ä½œï¼Œä¼šä½¿æ ¹ç»“ç‚¹å˜ä¸ºçº¢è‰²ã€‚è¿™ä¹Ÿå¯èƒ½å‡ºç°åœ¨å¾ˆå¤§çš„çº¢é»‘æ ‘ä¸­ã€‚ä¸¥æ ¼åœ°è¯´ï¼Œçº¢è‰²çš„æ ¹ç»“ç‚¹è¯´æ˜æ ¹ç»“ç‚¹æ˜¯ä¸€ä¸ª3- ç»“ç‚¹çš„ä¸€éƒ¨åˆ†ï¼Œä½†å®é™…æƒ…å†µå¹¶ä¸æ˜¯è¿™æ ·ã€‚å› æ­¤æˆ‘ä»¬åœ¨æ¯æ¬¡æ’å…¥åéƒ½ä¼šå°†æ ¹ç»“ç‚¹è®¾ä¸ºé»‘è‰²ã€‚æ³¨æ„ï¼Œæ¯å½“æ ¹ç»“ç‚¹ç”±çº¢å˜é»‘æ—¶æ ‘çš„é»‘é“¾æ¥é«˜åº¦å°±ä¼šåŠ 1ã€‚\n```cpp\n// æ ‘ç©ºæ—¶æ’æ ¹èŠ‚ç‚¹çš„æƒ…å†µã€‚\nPRBNode insert_rb_node(PRBNode root, PRBNode node)\n{\n    if(root == NULL)return node;\n    //...\n}\nPRBNode insert_node(PRBNode root, PRBNode node)\n{\n    root = insert_rb_node(root, node);\n    //åœ¨æ’å…¥è¿‡ç¨‹ä¸­ï¼Œæ ¹èŠ‚ç‚¹æœ‰å¯èƒ½å˜çº¢ï¼Œæ’å…¥åè¦æŠŠæ ¹è®¾ä¸ºé»‘è‰²ã€‚\n    if(is_red(root))\n    {\n        root->color = Black;\n    }\n    return root;\n}\n```\n### æ’å…¥åˆ°2-å‹èŠ‚ç‚¹\n1. æ¯”å¦‚å‘ä¸€ä¸ªå†…å« c çš„ 2-å‹èŠ‚ç‚¹æ’å…¥ aï¼Œå·²çŸ¥ 2-å‹èŠ‚ç‚¹æ²¡æœ‰å­æ ‘ï¼Œåˆ™å°† a æ’å…¥åˆ° c å·¦å­æ ‘ï¼Œåˆ™ç›¸å½“äºåœ¨ 2-3 æ ‘ä¸­åˆå¹¶èŠ‚ç‚¹çš„æƒ…å†µï¼Œåœ¨çº¢é»‘æ ‘ä¸­åˆ™ç›¸å½“äº c çš„é¢œè‰²è®¾ä¸ºçº¢è‰²å³å¯ã€‚c é»˜è®¤å°±æ˜¯çº¢è‰²ï¼Œä¸ç”¨æ“ä½œã€‚æœ€åï¼šc çº¢ï¼Œa é»‘ã€‚\n2. æ¯”å¦‚å‘ä¸€ä¸ªå†…å« c çš„ 2-å‹èŠ‚ç‚¹æ’å…¥ dï¼Œ2-å‹èŠ‚ç‚¹æ²¡æœ‰å­æ ‘ï¼Œåˆ™å°†ä¹‹æ’å…¥åˆ°å³å­æ ‘ï¼Œå› ä¸º c æ²¡æœ‰å­æ ‘ï¼Œåˆ™ç›¸å½“äºåœ¨ 2-3æ ‘ä¸­åˆå¹¶èŠ‚ç‚¹çš„æƒ…å†µã€‚ç”±äºé»˜è®¤åˆ›å»ºå‡ºæ¥çš„èŠ‚ç‚¹æ˜¯çº¢çš„ï¼Œé€ æˆ**å³çº¢**ï¼Œé‚£ä¹ˆå°±éœ€è¦**å·¦æ—‹æ“ä½œ**ï¼šå³è®© d ä¸Šä½ï¼Œc ä¸‹ä½è‡³ d çš„å·¦å­æ ‘ï¼Œä¸” c å³æ”¯æ¥ç®¡ d åŸå…ˆçš„å·¦å­æ ‘ã€‚æ’å…¥ä¹‹å‰ï¼Œb æ˜¯é»‘è‰²ï¼Œc æ˜¯çº¢è‰²ï¼Œæ’å…¥ä¹‹åï¼Œè¿˜éœ€å°† bã€c çš„é¢œè‰²äº¤æ¢ã€‚\n\n```c\nPRBNode left_rotate(PRBNode root)\n{\n    PRBNode newroot = root->right;\n    root->right = newroot->left;\n    newroot->left = root;\n    return newroot; //new root\n}\n```\n\n```c\nvoid exchange_color(PRBNode n1, PRBNode n2)\n{\n    Color color = n1->color;\n    n1->color = n2->color;\n    n2->color = color;\n}\n```\n\n### æ’å…¥åˆ°3-å‹èŠ‚ç‚¹\nè¯¥3-å‹èŠ‚ç‚¹æ­¤æ—¶ä¸€å®šæœ‰å·¦å­æ ‘ï¼Œä¸”å·¦å­æ ‘ä¸€å®šä¸ºçº¢è‰²ï¼Œå³å­æ ‘ä¸å¯èƒ½æ˜¯çº¢çš„ã€‚\n1. **å·¦çº¢å³çº¢**ï¼šå‘ï¼ˆcã€fï¼‰èŠ‚ç‚¹ï¼ˆæ²¡æœ‰å³å­æ ‘ï¼‰æ’å…¥ h ï¼š h å°†è¦æ’åˆ° f çš„å³å­æ ‘ï¼Œä½† h é»˜è®¤ä¸ºçº¢è‰²ï¼Œ**å‡ºç°äº†å·¦çº¢å³çº¢**ï¼Œéœ€è¦è°ƒæ•´ã€‚æ­¤æ—¶ç›¸å½“äºåœ¨2-3-4æ ‘ä¸­åˆå¹¶ä¸ºè¿‡æ¸¡4-å‹èŠ‚ç‚¹çš„æƒ…å†µï¼Œä¹‹åå³å°†åˆ†è£‚ä¸º3ä¸ª2-å‹èŠ‚ç‚¹ã€‚è€Œåœ¨çº¢é»‘æ ‘ä¸­ï¼Œè‡ªç„¶åœ°çœå»äº†åˆ†è£‚çš„æ­¥éª¤ï¼Œæ­¤æ—¶éœ€è¦æŠŠ cã€h èŠ‚ç‚¹çš„çº¢è‰²åè½¬ä¸ºé»‘è‰²ï¼ˆflip colorï¼‰ã€‚æ³¨æ„ï¼è¿˜éœ€è¦æŠŠ f çš„é¢œè‰²åè½¬ä¸ºçº¢è‰²ï¼Œå› ä¸ºåœ¨2-3-4æ ‘ä¸­çš„åˆ†è£‚æ“ä½œä¸­ï¼Œè¢«ä¸Šæ¨çš„èŠ‚ç‚¹ä¼å›¾ä¸ä¸Šå±‚è¿›è¡Œç»“åˆï¼Œä¸€æ—¦ç»“åˆï¼Œå°±æˆçº¢è‰²äº†ã€‚æ€»ä¹‹ï¼Œ**3 èŠ‚ç‚¹ç¿»è½¬é¢œè‰²**ã€‚\n\n```c\nint flip_color(PRBNode root)\n{\n    if(root == NULL)return 0;\n    if(root->color == Red)\n    {\n        root->color = Black;\n    }\n    else\n    {\n        root->color = Red;\n    }\n    return 1;\n}\nvoid flip_colors(PRBNode root)\n{\n    //å¦‚æœæ ¹èŠ‚ç‚¹é¢œè‰²åè½¬æˆåŠŸï¼Œåˆ™æ‰èƒ½ç»§ç»­åè½¬å­èŠ‚ç‚¹\n    if(flip_color(root))\n    {\n        flip_color(root->left);\n        flip_color(root->right);\n    }\n}\n```\n2. **å·¦è¿ç»­çº¢**ï¼šå‘ï¼ˆcã€fï¼‰èŠ‚ç‚¹ï¼ˆæ²¡æœ‰å³å­æ ‘ï¼‰æ’å…¥ a ï¼ša å°†è¦æ’åˆ° c çš„å·¦å­æ ‘ï¼Œä½† a é»˜è®¤ä¸ºçº¢è‰²ï¼Œ **å‡ºç°äº†å·¦æ”¯è¿ç»­çº¢è‰²**ï¼Œéœ€è¦è°ƒæ•´ã€‚æ­¤æ—¶ç›¸å½“äºåœ¨2-3-4æ ‘ä¸­åˆå¹¶ä¸ºè¿‡æ¸¡4-å‹èŠ‚ç‚¹çš„æƒ…å†µï¼Œä¹‹åå³å°†åˆ†è£‚ä¸º3ä¸ª2-å‹èŠ‚ç‚¹ï¼ŒæŠŠ c ä¸Šæ¨ï¼ŒæŠŠ aã€f ä¸‹è£‚ã€‚åœ¨çº¢é»‘æ ‘ä¸­ï¼Œåˆ™éœ€è¦**å³æ—‹**æ“ä½œï¼š f ä¸‹ä½è‡³ c çš„å³å­æ ‘ï¼Œä¸” f çš„å·¦æ”¯æ¥ç®¡ c åŸå…ˆçš„å³å­æ ‘ã€‚æ­¤æ—¶åˆå‡ºç°äº†**å·¦çº¢å³çº¢**ï¼Œæ•ˆä»¿æƒ…å†µ1ï¼ŒæŠŠ3ä¸ªèŠ‚ç‚¹é¢œè‰²å…¨éƒ¨åè½¬å³å¯ã€‚åˆ™æœ€åï¼ša é»‘ã€c çº¢ã€f é»‘ã€‚\n    1. é¢œè‰²é—®é¢˜ï¼šå³æ—‹å‰çš„é¢œè‰²ä¸ºï¼ša çº¢ã€c çº¢ã€f é»‘ï¼Œå³æ—‹åçš„é¢œè‰²ä¸ºï¼ša çº¢ã€c é»‘ã€f çº¢ã€‚ä¸ºä»€ä¹ˆä¸Šç§»çš„ c å˜é»‘äº†ï¼Ÿå› ä¸º cï¼ˆnewRootï¼‰ç›¸å½“äºæ›¿ä»£äº† fï¼ˆoldRootï¼‰çš„ä½ç½®ï¼Œæ—§æ ¹æœ¬æ¥å°±æ˜¯é»‘çš„ï¼Œæ‰€ä»¥ c è¦å˜é»‘ã€‚\n\n```c\nPRBNode right_rotate(PRBNode root)\n{\n    PRBNode x = root->left;\n    root->left = x->right;\n    x->right = root;\n    exchange_color(x, root);\n    return x;// new root\n}\n```\n3. **å·¦ç©ºå³çº¢**ï¼šå‘ï¼ˆcã€fï¼‰èŠ‚ç‚¹ï¼ˆæ²¡æœ‰å³å­æ ‘ï¼‰æ’å…¥ d ï¼šd å°†è¦æ’åˆ° c çš„å³å­æ ‘ï¼ˆæ³¨æ„ï¼Œä¸æ˜¯æ ¹èŠ‚ç‚¹ f çš„å³å­æ ‘ï¼Œè€Œæ˜¯å…¶å·¦å­æ ‘ c çš„å³å­æ ‘ï¼‰ï¼Œä½† d é»˜è®¤ä¸ºçº¢è‰²ï¼Œ**å‡ºç°äº†å³æ”¯çº¢è‰²**ï¼Œéœ€è¦è°ƒæ•´ã€‚éœ€è¦ä»¥ c ä¸ºæ ¹**å·¦æ—‹**ï¼Œä¹‹å c æˆäº† d çš„å·¦æ”¯ï¼Œd æˆäº† f çš„å·¦æ”¯ï¼Œ**å‡ºç°äº†å·¦æ”¯è¿ç»­çº¢è‰²**ã€‚æ­¤æ—¶å’Œåœ¨æƒ…å†µ2ä¸­ä¸€æ ·ï¼Œéœ€è¦ä»¥ f ä¸ºæ ¹**å³æ—‹**ï¼Œå³æŠŠ d ä¸Šæ¨ï¼ŒæŠŠ cã€f ä¸‹è£‚ã€‚f ä¸‹ä½è‡³ d çš„å³å­æ ‘ï¼Œä¸” f çš„å·¦æ”¯æ¥ç®¡ d åŸå…ˆçš„å³å­æ ‘ã€‚æ•´ä½“æ¥è¯´ï¼šå…ˆå·¦æ—‹ï¼Œåå³æ—‹ã€‚\n    1. åƒæƒ…å†µ2ä¸€æ ·ï¼Œå³æ—‹åï¼Œåˆå‡ºç°äº†**å·¦çº¢å³çº¢**ï¼Œåˆ™éœ€è¦æŠŠ3ä¸ªèŠ‚ç‚¹é¢œè‰²å…¨éƒ¨åè½¬ã€‚æœ€åï¼šc é»‘ã€d çº¢ã€f é»‘ã€‚\n### æ•´ä½“è¿‡ç¨‹\n![](../../images/Cè¯­è¨€_æ ‘/image-20250228100027670.png)\nç›¸æ¯”äºBSTreeçš„æ’å…¥ï¼Œå‰é¢çš„æµç¨‹ä¸€è‡´ï¼Œåªæ˜¯å¤šäº†æ’å…¥åçš„è°ƒå¹³çš„æ“ä½œã€‚\n1. ç»ˆæ­¢æ¡ä»¶æ˜¯å½“æ—¶çš„rootä¸ºç©º\n2. è¦æ’å…¥çš„nodeçš„keyä¸å·²å­˜åœ¨çš„èŠ‚ç‚¹çš„keyç›¸ç­‰æ—¶ï¼Œè®¤ä¸ºæ˜¯æ›´æ–°èŠ‚ç‚¹å€¼çš„æ“ä½œ\n3. è°ƒæ•´â€”â€”æˆ‘ä»¬éœ€è¦ç²¾å¿ƒå®‰æ’ if çš„é¡ºåºï¼Œç»è¿‡3ç§æƒ…å†µåˆ†æï¼š\n    1. å·¦é»‘å³çº¢ï¼šåœ¨å·¦æ—‹åä¼šå‡ºç°å·¦è¿ç»­çº¢ï¼Œåˆ™éœ€è¦å³æ—‹ï¼Œä¹‹åä¼šå‡ºç°å·¦çº¢å³çº¢ã€‚\n    2. å·¦è¿ç»­çº¢ï¼šå³æ—‹åä¼šå‡ºç°å·¦çº¢å³çº¢ã€‚\n    3. å·¦çº¢å³çº¢ï¼šç¿»è½¬é¢œè‰²å³å¯ã€‚\n    4. æ€»ä½“æ¥è¯´ï¼š\n        1. 1å’Œ2æ˜¯äº’æ–¥å…³ç³»ï¼šä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œcä¸ºæ ¹æ—¶ï¼Œåªèƒ½çœ‹åˆ°cã€dä¸¤å±‚ï¼Œçœ‹ä¸åˆ°æƒ…å†µ 2 ä» f å±‚å¼€å§‹çš„å·¦è¿ç»­çº¢ã€‚\n        2. 1å’Œ3ä¹Ÿæ˜¯äº’æ–¥å…³ç³»ï¼šç”±äº1å’Œ2æ˜¯äº’æ–¥å…³ç³»ï¼Œä¸ä¼šåœ¨é‚£ä¸€å±‚é€’å½’è¿›è¡Œå¯¹ f çš„å³æ—‹ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°å·¦çº¢å³çº¢ï¼Œå› æ­¤1å’Œ3ä¹Ÿæ˜¯äº’æ–¥å…³ç³»ã€‚\n        3. 2å’Œ3æ˜¯å¹¶åˆ—å…ˆåé¡ºåºå…³ç³»ã€‚åœ¨ æƒ…å†µ2 å¯¹ f è¿›è¡Œå³æ—‹åï¼Œèƒ½åœ¨åŒä¸€å±‚é€’å½’å…³ç³»ä¸­ç»§ç»­çœ‹åˆ° cã€dã€f çš„é¢œè‰²å…³ç³»ï¼Œå‡ºç°å·¦çº¢å³çº¢ï¼Œå› æ­¤2å¿…é¡»åœ¨3å‰é¢ã€‚\n        4. æƒ…å†µ3ï¼Œå¯¹ä¸‰ä¸ªèŠ‚ç‚¹å…¨éƒ¨ç¿»è½¬é¢œè‰²ã€‚\n4. æœ€åçº¢é»‘æ ‘è¿˜è¦æ³¨æ„ä¸€æ¡è§„åˆ™æ˜¯æ€»æ ¹ä¸€å®šæ˜¯é»‘è‰²çš„ã€‚\n\n```c\nPRBNode insert_rb_node(PRBNode root, PRBNode node)\n{\n    if(root == NULL)return node;//æ­¤å¤„ä¸ç”¨è°ƒæ•´äº†ï¼Œä¼šç”±ä¸Šä¸€å±‚è°ƒæ•´\n    if(root->key == node->key)\n    {\n        root->val = node->val;\n        return root;\n    }\n    //é€’å½’å‘ä¸‹\n    //å·¦æ”¯é€’å½’æ’å…¥\n    if(node->key < root->key)\n    {\n        root->left = insert_rb_node(root->left, node);\n    }\n    else//å³æ”¯é€’å½’æ’å…¥\n    {\n        root->right = insert_rb_node(root->right, node);\n    }\n    //é€’å½’å‘ä¸Š\n    //è°ƒæ•´\n    //å·¦ç©ºå³çº¢ã€‚\n    // å·¦ç©ºå³çº¢æ—¶å±€éƒ¨å·¦æ—‹åä¼šå‡ºç°å·¦ä¾§è¿ç»­çº¢ï¼Œ\n    // ä½†ä¸èƒ½åœ¨åŒä¸€å±‚é€’å½’å¤„ç†åç»­æƒ…å†µï¼Œå› æ­¤æ˜¯if-elseå…³ç³»\n    if(!is_red(root->left) && is_red(root->right))\n    {\n        root = left_rotate(root);//å¯èƒ½ä¼šæ›´æ–°root\n    }\n    else\n    {\n        //å·¦ä¾§è¿ç»­çº¢\n        // å¿…é¡»æ’åˆ°å·¦çº¢å³çº¢å‰é¢ï¼Œå› ä¸ºå³æ—‹åå‡ºç°å·¦çº¢å³çº¢ï¼Œéœ€è¦åœ¨åŒä¸€å±‚é€’å½’å¤„ç†ã€‚å› æ­¤æ˜¯if-ifå…ˆåé¡ºåºå…³ç³»ã€‚\n        if(is_red(root->left) && is_red(root->left->left))\n        {\n            root = right_rotate(root);\n        }\n        //å·¦çº¢å³çº¢ï¼šåè½¬é¢œè‰²\n        if(is_red(root->left) && is_red(root->right))\n        {\n            flip_colors(root);\n        }\n    }\n    return root;\n}\nint is_red(PRBNode root)\n{\n    if(root)\n    {\n        return root->color == Red;\n    }\n    return Black;// è‹¥rootä¸ºç©ºåˆ™è¿”å›é»‘\n}\nPRBNode insert_node(PRBNode root, PRBNode node)\n{\n    root = insert_rb_node(root, node);\n    //åœ¨æ’å…¥è¿‡ç¨‹ä¸­ï¼Œæ ¹èŠ‚ç‚¹æœ‰å¯èƒ½å˜çº¢ï¼Œæ’å…¥åè¦æŠŠæ ¹è®¾ä¸ºé»‘è‰²ã€‚\n    if(is_red(root))\n    {\n        root->color = Black;\n    }\n    return root;\n}\n```\n\næµ‹è¯•\n\n```c\nint main()\n{\n    PRBNode root = NULL;\n    root = insert_node(root, make_rb_node(3, 'c'));\n    root = insert_node(root, make_rb_node(2, 'b'));\n    root = insert_node(root, make_rb_node(4, 'd'));\n    root = insert_node(root, make_rb_node(1, 'a'));\n    return 0;\n}\n```\n\n## æ”¯æŒ4-å‹èŠ‚ç‚¹çš„çº¢é»‘æ ‘ï¼ˆå­˜åœ¨å·¦çº¢å³çº¢ï¼‰\nCppçš„STLæ¨¡æ¿åº“ä»¥åŠå…¶ä»–è¯­è¨€çš„åº“ï¼ŒDictionaryå’ŒMapä¸­ç”¨çš„éƒ½æ˜¯æ”¯æŒ4-å‹èŠ‚ç‚¹çš„çº¢é»‘æ ‘ã€‚\n\né¦–å…ˆæˆ‘ä»¬è¦æ˜ç¡®ï¼Œæˆ‘ä»¬åœ¨2-3æ ‘ä¸‹çš„çº¢é»‘æ ‘è§„å®šäº†çº¢é“¾æ¥åªèƒ½å‡ºç°åœ¨å·¦ä¾§ã€‚\nåŸå…ˆ2-3æ ‘ä¸‹çš„çº¢é»‘æ ‘ï¼Œæ’å…¥è¿‡ç¨‹ä¸­**ä¸´æ—¶å­˜åœ¨**çš„4-å‹èŠ‚ç‚¹ï¼Œåªæ˜¯ä¸€ä¸ªä¸´æ—¶ã€ä¸ç¨³å®šçš„ä¸­é—´çŠ¶æ€ï¼Œæ’å…¥åè¦ç«‹å³æ£€æŸ¥å·¦è¿ç»­ä¸¤çº¢ã€å·¦çº¢å³çº¢ã€å·¦ç©ºå³çº¢ï¼Œè¿™å‡ ç§éæ³•çš„4-å‹èŠ‚ç‚¹æƒ…å†µï¼Œè°ƒæ•´ã€‚\nç°åœ¨å¦‚æœæ”¯æŒ4-å‹èŠ‚ç‚¹ï¼Œé‚£ä¹ˆçº¢é“¾æ¥æ”¯æŒå‡ºç°åœ¨å³ä¾§ã€‚é‚£ä¹ˆå°±ä¼šå…è®¸å·¦è¿ç»­ä¸¤çº¢ã€å·¦çº¢å³çº¢ã€å·¦ç©ºå³çº¢çš„å­˜åœ¨å—ï¼Ÿä¸ï¼ä»ç„¶ä¸å…è®¸ï¼Œå› ä¸ºè¿™ä»æ˜¯åŸºäºå·¦å€¾çš„çº¢é»‘æ ‘ï¼Œå®é™…ä»…èƒ½å­˜åœ¨èŠ‚ç‚¹ä¸ºé»‘è‰²ã€å·¦å³å­—èŠ‚ç‚¹ä¸ºçº¢è‰²çš„è¿™æ ·çš„æƒ…å†µï¼ˆå³å·¦çº¢å³çº¢ï¼‰ã€‚\n\nä½†æ˜¯ï¼Œå¾®å¦™çš„æ˜¯ï¼Œè™½ç„¶å…è®¸äº†4-å‹èŠ‚ç‚¹çš„åˆæ³•å­˜åœ¨ï¼Œä½†åœ¨æ’å…¥è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†æ“ä½œç®€ä¾¿ï¼ŒæŠŠ4-å‹èŠ‚ç‚¹åˆæ‹†è§£ä¸ºé4-å‹èŠ‚ç‚¹äº†ï¼Œ**æ‹†è§£ä¸­ç”¨åˆ°çš„æ—‹è½¬æ“ä½œæ˜¯æˆ‘ä»¬ä¸Šæ–‡å†™è¿‡çš„2-3æ ‘ä¸‹çš„å·¦å€¾çº¢é»‘æ ‘ä¸‹çš„æ“ä½œã€‚äºæ˜¯æ ‘ç»è¿‡æ‹†è§£åï¼Œåˆå˜æˆäº†2-3æ ‘ä¸‹çš„å·¦å€¾çº¢é»‘æ ‘**ï¼Œå°±åˆå¯ä»¥ç”¨åˆ°ä¹‹å‰çš„æ“ä½œäº†ã€‚\n\næ€»ä¹‹ï¼ŒåŸºäºå·¦å€¾æ—‹è½¬æ“ä½œçš„æ”¯æŒ4-å‹èŠ‚ç‚¹çš„çº¢é»‘æ ‘ï¼Œæœ‰ä»¥ä¸‹æ€§è´¨ï¼š\nä¸€æ£µçº¢é»‘æ ‘æ˜¯æ»¡è¶³ä¸‹é¢çº¢é»‘æ€§è´¨çš„äºŒå‰æœç´¢æ ‘ï¼š\n1. æ¯ä¸ªç»“ç‚¹æˆ–æ˜¯çº¢è‰²çš„ï¼Œæˆ–æ˜¯é»‘è‰²çš„ã€‚\n2. æ ¹ç»“ç‚¹æ˜¯é»‘è‰²çš„ã€‚\n3. æ¯ä¸ªå¶ç»“ç‚¹ (NIL) æ˜¯é»‘è‰²çš„ã€‚\n4. å¦‚æœä¸€ä¸ªç»“ç‚¹æ˜¯çº¢è‰²çš„ï¼Œåˆ™å®ƒçš„ä¸¤ä¸ªå­ç»“ç‚¹éƒ½æ˜¯é»‘è‰²çš„ã€‚\n5. å¯¹æ¯ä¸ªç»“ç‚¹ï¼Œä»è¯¥ç»“ç‚¹åˆ°å…¶æ‰€æœ‰åä»£å¶ç»“ç‚¹çš„ç®€å•è·¯å¾„ä¸Šï¼Œå‡åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²ç»“ç‚¹ã€‚\n\nå¦‚æœæ”¯æŒ4-å‹èŠ‚ç‚¹ç¨³å®šå­˜åœ¨ï¼Œåœ¨ç»“æ„ä¸Šï¼Œç›¸æ¯”åªæœ‰2-3å‹çš„ç»“æ„ï¼Œ2-3-4æ ‘çš„å±‚æ•°ä¼šæ›´å°‘ä¸€äº›ã€‚è™½ç„¶å®é™…åœ¨çº¢é»‘æ ‘çš„å½¢å¼ä¸‹å±‚æ•°æ²¡æœ‰æ˜æ˜¾å‡å°‘ï¼Œç„¶è€Œï¼Œæ“ä½œæ•ˆç‡ä¸Šä¼šå¾—åˆ°æ”¹å–„ã€‚\nä½†æ˜¯ï¼Œå°±è¦è§£å†³ä¸€ä¸ªé—®é¢˜ï¼Œå³4-å‹èŠ‚ç‚¹å†æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ€ä¹ˆå¤„ç†ï¼Ÿæ˜¯å…è®¸ä¸´æ—¶5-å‹èŠ‚ç‚¹å­˜åœ¨å—ï¼Ÿè¿™æ ·å°±ä½¿ç¨‹åºå¤æ‚åŒ–äº†ã€‚\n![](../../images/Cè¯­è¨€_æ ‘/image-20250228103056554.png)\né«˜æ•ˆã€å·§å¦™çš„å¤„ç†æ–¹å¼ï¼š\n1. åœ¨é€’å½’å‘ä¸‹ã€æ’å…¥ä¹‹å‰ï¼Œäº‹å…ˆåˆ†è§£æ‰çº¢é»‘æ ‘ä¸­æ‰€æœ‰çš„4-å‹èŠ‚ç‚¹ï¼ˆä½†å¿…é¡»æ˜¯ç­‰ä»·è½¬åŒ–ï¼Œä¸èƒ½è®©2-3-4æ ‘å½¢å¼ä¸Šçš„å±‚æ•°å˜å¤šï¼Œå¯¹äºçº¢é»‘æ ‘å½¢å¼æ¥è¯´ï¼Œå¯èƒ½ä¼šå¤š1å±‚ï¼Œä½†è¿˜æ˜¯ç¬¦åˆå¹³è¡¡çš„è¦æ±‚èŒƒå›´å†…çš„ï¼Œå¯ä»¥çœ‹ä¸Šå›¾ï¼‰ã€‚è¿™æ ·ï¼Œåç»­æ’å…¥æ—¶å°±ä¸ä¼šå­˜åœ¨4-å‹èŠ‚ç‚¹ï¼Œè¦ä¹ˆæ˜¯2-å‹ã€è¦ä¹ˆæ˜¯3-å‹ã€‚\n    1. æˆ‘ä»¬å‘ç°ï¼Œåˆ†è§£4-å‹èŠ‚ç‚¹ï¼Œå…¶å®ä»…éœ€ç¿»è½¬é¢œè‰²è€Œå·²ã€‚\n2. æ’å…¥\n3. æ’å…¥ä¹‹åï¼Œé€’å½’å‘ä¸Šè°ƒå¹³ã€‚\n    1. åªéœ€è¦å¤„ç†ï¼šå·¦é»‘å³çº¢ã€å·¦è¿ç»­çº¢çš„æƒ…å†µã€‚\n    2. å·¦é»‘å³çº¢å’Œå·¦è¿ç»­çº¢ä¸åœ¨åŒä¸€é€’å½’å±‚æ¬¡ä¸­å¤„ç†ï¼Œäº’æ–¥ã€‚\n\n```c\nPRBNode insert_rb_node(PRBNode root, PRBNode node)\n{\n    if(root == NULL)return node;//æ­¤å¤„ä¸ç”¨è°ƒæ•´äº†ï¼Œä¼šç”±ä¸Šä¸€å±‚è°ƒæ•´\n    if(root->key == node->key)\n    {\n        root->val = node->val;\n        return root;\n    }\n    //é€’å½’å‘ä¸‹ä¹‹å‰ï¼Œå…ˆåˆ†è§£æ‰€æœ‰é‡åˆ°çš„4-å‹èŠ‚ç‚¹ã€‚\n    if(is_red(root->left) && is_red(root->right))\n    {\n        flip_colors(root);\n    }\n    //é€’å½’å‘ä¸‹\n    //å·¦æ”¯é€’å½’æ’å…¥\n    if(node->key < root->key)\n    {\n        root->left = insert_rb_node(root->left, node);\n    }\n    else//å³æ”¯é€’å½’æ’å…¥\n    {\n        root->right = insert_rb_node(root->right, node);\n    }\n    //é€’å½’å‘ä¸Š\n    //è°ƒæ•´\n    //å·¦ç©ºå³çº¢ã€‚\n    // å·¦ç©ºå³çº¢æ—¶å±€éƒ¨å·¦æ—‹åä¼šå‡ºç°å·¦ä¾§è¿ç»­çº¢ï¼Œ\n    // ä½†ä¸èƒ½åœ¨åŒä¸€å±‚é€’å½’å¤„ç†åç»­æƒ…å†µï¼Œå› æ­¤æ˜¯if-elseå…³ç³»\n    if(!is_red(root->left) && is_red(root->right))\n    {\n        root = left_rotate(root);//å¯èƒ½ä¼šæ›´æ–°root\n    }\n    else\n    {\n        //å·¦ä¾§è¿ç»­çº¢\n        if(is_red(root->left) && is_red(root->left->left))\n        {\n            root = right_rotate(root);\n        }\n        // åœ¨å…è®¸4-å‹çš„çº¢é»‘æ ‘ä¸­ï¼Œå·¦çº¢å³çº¢åˆæ³•ã€‚ä¸ç”¨å¤„ç†ã€‚\n        //if(is_red(root->left) && is_red(root->right))\n        //{ }\n    }\n    return root;\n}\nint is_red(PRBNode root)\n{\n    if(root)\n    {\n        return root->color == Red;\n    }\n    return Black;// è‹¥rootä¸ºç©ºåˆ™è¿”å›é»‘\n}\nPRBNode insert_node(PRBNode root, PRBNode node)\n{\n    root = insert_rb_node(root, node);\n    if(is_red(root))\n    {\n        root->color = Black;\n    }\n    return root;\n}\n```\n\næµ‹è¯•\n\n```c\nint main()\n{\n    PRBNode root = NULL;\n    root = insert_node(root, make_rb_node(3, 'c'));\n    root = insert_node(root, make_rb_node(2, 'b'));\n    root = insert_node(root, make_rb_node(4, 'd'));\n    root = insert_node(root, make_rb_node(1, 'a'));\n    return 0;\n}\n```\n\n## åˆ é™¤\n\nçº¢é»‘æ ‘çš„åˆ é™¤å¯ä»¥å‚è€ƒBSTçš„è¿‡ç¨‹ã€‚\n\nçº¢é»‘æ ‘å½¢å¼çš„åˆ†æâ€”â€”ç±»æ¯”BSTæ ‘\nBSTä¸­ï¼Œå¦‚æœèŠ‚ç‚¹æ˜¯\n1. å¶å­èŠ‚ç‚¹ï¼Œç›´æ¥åˆ é™¤\n2. åªæœ‰ä¸€æ”¯å­æ ‘ï¼Œåˆ™ç›´æ¥åˆ é™¤ï¼Œåˆ é™¤åè®©è¯¥æ”¯å­æ ‘æ›¿ä»£rootè‡ªèº«å³å¯ï¼ˆå¶å­èŠ‚ç‚¹çš„å­æ ‘ä¸ºNULLï¼‰ï¼‰\n3. å¦‚æœæœ‰ä¸¤ä¸ªå­æ ‘ï¼Œåˆ™é€‰å–ä¸€ä¸ªå¶å­èŠ‚ç‚¹äº¤æ¢ï¼ˆé€‰æ‹©ä¸¤æ”¯å­æ ‘ä¸­ç›¸è¿‘å¤§å°çš„èŠ‚ç‚¹æ›¿ä»£è‡ªèº«ï¼‰ï¼Œå³æŠŠå°†è¦åˆ é™¤çš„èŠ‚ç‚¹ä¸‹ç§»è‡³å¶å­èŠ‚ç‚¹æˆ–è€…ä¸‹ç§»è‡³åªæœ‰ä¸€æ”¯å­æ ‘çš„çŠ¶æ€ï¼Œå°±å¯ä»¥è½¬åŒ–ä¸ºæƒ…å†µ1ã€2äº†ã€‚\n4. é€’å½’è¿”å›åéœ€è¦è°ƒå¹³\n\n2-3-4æ ‘å½¢å¼çš„åˆ†æâ€”â€”ç±»æ¯”æ’å…¥çš„æ€æƒ³\né™¤æ­¤ä¹‹å¤–ï¼Œçº¢é»‘æ ‘æ˜¯2-3-4æ ‘ï¼Œæ‹¿2-3-4æ ‘çš„å½¢å¼æ¥åˆ†æï¼Œå¦‚æœè¦åˆ é™¤çš„èŠ‚ç‚¹åœ¨å¶å­èŠ‚ç‚¹ä¸­ï¼Œå¯èƒ½åœ¨ä¸€ä¸ª4-å‹èŠ‚ç‚¹ã€3-å‹èŠ‚ç‚¹ã€2-å‹èŠ‚ç‚¹ä¸­ï¼Œ4-å‹ã€3-å‹å¯ä»¥ç›´æ¥åˆ é™¤ï¼Œå› ä¸ºä¸å½±å“è¯¥è·¯å¾„å±‚æ•°çš„å¹³è¡¡ã€‚\næ€»ä¹‹ï¼Œå¦‚æœæ˜¯2-å‹èŠ‚ç‚¹ï¼Œå°±ä¸èƒ½ç›´æ¥åˆ é™¤ã€‚\n\nç±»æ¯”äºçº¢é»‘æ ‘é¿å…æ’å…¥4-å‹èŠ‚ç‚¹è€Œåˆ†è§£æ‰€æœ‰çš„4-å‹èŠ‚ç‚¹çš„é“ç†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é¿å…åˆ é™¤2-å‹èŠ‚ç‚¹è€Œè®©æ‰€æœ‰çš„2-å‹èŠ‚ç‚¹æ‰©å¼ ä¸º3-å‹æˆ–4-å‹èŠ‚ç‚¹ã€‚\n\nå› æ­¤ï¼Œ4-å‹èŠ‚ç‚¹åœ¨çº¢é»‘æ ‘ä¸­ï¼Œæ—¢å¯ä»¥å­˜åœ¨ï¼Œä¹Ÿå¯ä»¥ä¸å­˜åœ¨ã€‚\nå¦‚æœå…è®¸å­˜åœ¨4-å‹èŠ‚ç‚¹ï¼Œåˆ™åˆ é™¤åä¸ç”¨å‘ä¸Šé€’å½’åˆ†è§£4-å‹èŠ‚ç‚¹ã€‚å¦‚æœä¸å…è®¸å­˜åœ¨4-å‹èŠ‚ç‚¹ï¼Œåˆ™åˆ é™¤åéœ€è¦å‘ä¸Šé€’å½’åˆ†è§£4-å‹èŠ‚ç‚¹ã€‚\n\nä»£ç å¯ä»¥å‚ç…§ç®—æ³•ï¼ˆ4thï¼‰291é¡µ3.3.41\n# çº¢é»‘æ ‘éé€’å½’ç‰ˆæœ¬\nè§ç®—æ³•ï¼ˆ4thï¼‰265é¡µ3.2.13ã€‚\n## æ¨¡å‹\næˆ‘ä»¬åˆ†æçš„æ¨¡å‹ï¼ŒåŸºäºçš„çº¢é»‘æ ‘å½¢å¼æ˜¯ï¼šå®é™…4-å‹èŠ‚ç‚¹ä»…èƒ½å­˜åœ¨ä¸ºæ ¹é»‘è‰²ã€å·¦å³å­—èŠ‚ç‚¹ä¸ºçº¢è‰²çš„è¿™æ ·çš„æƒ…å†µï¼ˆå³å·¦çº¢å³çº¢ï¼‰ã€‚è¯¦è§[æ”¯æŒ4-å‹èŠ‚ç‚¹çš„çº¢é»‘æ ‘ï¼ˆå­˜åœ¨å·¦çº¢å³çº¢ï¼‰](#æ”¯æŒ4-å‹èŠ‚ç‚¹çš„çº¢é»‘æ ‘ï¼ˆå­˜åœ¨å·¦çº¢å³çº¢ï¼‰)ã€‚\nå¦‚æœä»…åˆ†ææ–°èŠ‚ç‚¹æ’åˆ°å·¦å­æ ‘çš„æƒ…å†µï¼š\n1. çˆ·é»‘ï¼Œå·¦çº¢å³çº¢ã€‚\n    1. çˆ·çˆ·ã€çˆ¶ã€å”å…¨éƒ¨ç¿»è½¬é¢œè‰²ã€‚çˆ·çˆ·çš„çˆ¶èŠ‚ç‚¹å¯èƒ½è¿˜æ˜¯çº¢è‰²ï¼Œéœ€è¦ä¸æ–­å‘ä¸Šè°ƒæ•´ï¼Œç›´åˆ°è¾¾åˆ°æ ¹ï¼Œæ ¹è®°å¾—è®¾ä¸ºé»‘è‰²ã€‚\n2. çˆ·é»‘ï¼Œå·¦è¿ç»­ä¸¤çº¢ã€‚\n    1. æ’åˆ°äº†çˆ¶èŠ‚ç‚¹ï¼ˆçº¢è‰²ï¼‰çš„å·¦å­æ ‘\n        1. ç¿»è½¬çˆ¶èŠ‚ç‚¹ã€çˆ·çˆ·èŠ‚ç‚¹é¢œè‰²ï¼Œä¹‹åä»¥çˆ·çˆ·èŠ‚ç‚¹å³æ—‹ã€‚\n    2. æ’åˆ°äº†çˆ¶èŠ‚ç‚¹ï¼ˆçº¢è‰²ï¼‰çš„å³å­æ ‘\n        1. å…ˆä»¥çˆ¶èŠ‚ç‚¹å·¦æ—‹ï¼Œå°±ä¼šè½¬åŒ–ä¸ºä¸Šé¢çš„æƒ…å†µã€‚\n3. çˆ·é»‘ï¼Œå·¦é»‘ã€å³æ— æ‰€è°“ã€‚ç›´æ¥æ’\n\nå®é™…ä¸Šï¼Œæ–°èŠ‚ç‚¹æ’åˆ°å³å­æ ‘åªæ˜¯ä¸Šè¿°è¿‡ç¨‹çš„é•œåƒã€‚æ‰€ä»¥æˆ‘ä»¬æ— éœ€å†åˆ†æã€‚\n\né»˜è®¤æ’å…¥çš„æ–°èŠ‚ç‚¹ä¸ºçº¢è‰²ã€‚\nè‹¥æ ‘ä¸ºç©ºæ ‘ï¼Œåˆ™ç›´æ¥æ’å…¥èŠ‚ç‚¹ï¼Œæœ€åè®°å¾—æ ¹è¦è®¾ä¸ºé»‘è‰²ï¼›\nè‹¥æ ‘ä¸ä¸ºç©ºï¼Œä¸”æ’å…¥ä½ç½®çš„çˆ¶èŠ‚ç‚¹ä¸ºé»‘è‰²ï¼Œåˆ™ç›´æ¥æ’å…¥ã€‚\nè‹¥æ’å…¥ä½ç½®çš„çˆ¶èŠ‚ç‚¹ä¸ºçº¢è‰²ï¼š\nåªåˆ†æèŠ‚ç‚¹æ’å…¥åˆ°å·¦æ”¯çš„æƒ…å†µã€‚\n1. å”å”èŠ‚ç‚¹ä¸ºçº¢è‰²ï¼Œæ’å…¥çš„ä½ç½®**ä¸ç®¡æ˜¯çˆ¶èŠ‚ç‚¹çš„å·¦ä¾§è¿˜æ˜¯å³ä¾§**ã€‚éƒ½ç›¸å½“äºçˆ·çˆ·é»‘ã€çˆ·çˆ·çš„å·¦çº¢å³çº¢ã€‚ç¿»è½¬ä¸Šé¢3ä¸ªèŠ‚ç‚¹é¢œè‰²å³å¯ã€‚ä½†æ˜¯ï¼Œçˆ·çˆ·å˜çº¢ä¹‹åï¼Œå¯èƒ½è¿˜å’Œçˆ·çˆ·çš„çˆ¶èŠ‚ç‚¹å†²çªï¼Œéœ€è¦ä¸æ–­å‘ä¸Šè°ƒæ•´ï¼Œç›´åˆ°æ‰¾åˆ°æ•´ä¸ªæ ‘çš„æ ¹ï¼Œè®¾ä¸ºé»‘è‰²ã€‚\n2. å”å”èŠ‚ç‚¹ä¸ºé»‘è‰²ï¼Œæ’å…¥çš„ä½ç½®æ˜¯**çˆ¶èŠ‚ç‚¹çš„å·¦ä¾§**ã€‚åˆ™ç›¸å½“äºçˆ·çˆ·é»‘ã€å·¦è¿ç»­ä¸¤çº¢ã€‚éœ€è¦å…ˆæŠŠçˆ¶èŠ‚ç‚¹å’Œçˆ·çˆ·çš„èŠ‚ç‚¹é¢œè‰²ç¿»è½¬ï¼ˆçˆ¶è®¾ä¸ºé»‘ï¼Œçˆ·çˆ·è®¾ä¸ºçº¢ï¼‰ã€‚å†ä»¥çˆ·çˆ·ä¸ºè½´å³æ—‹ã€‚åˆ™çˆ¶èŠ‚ç‚¹ä¸Šä½ï¼Œä¸ºé»‘è‰²ï¼Œç»“æŸã€‚\n3. å”å”èŠ‚ç‚¹ä¸ºé»‘è‰²ï¼Œæ’å…¥çš„ä½ç½®æ˜¯**çˆ¶èŠ‚ç‚¹çš„å³ä¾§**ã€‚åˆ™ç›¸å½“äºçˆ·çˆ·é»‘ã€å·¦è¿ç»­ä¸¤çº¢ã€‚ä»¥çˆ¶èŠ‚ç‚¹å·¦æ—‹ï¼Œä¹‹åå˜æˆäº†æƒ…å†µ2ã€‚\n\n![](../../images/Cè¯­è¨€_æ ‘/image-20250303142622944.png)\n\n![](../../images/Cè¯­è¨€_æ ‘/image-20250303142653323.png)\n\n![](../../images/Cè¯­è¨€_æ ‘/image-20250303142726649.png)\n\nä¸ºäº†èƒ½å®ç°å›æº¯ä¹‹å‰èŠ‚ç‚¹ï¼Œéœ€è¦åœ¨èŠ‚ç‚¹ä¸­åŒ…å«ä¸€ä¸ªçˆ¶èŠ‚ç‚¹æŒ‡é’ˆã€‚\n```cpp\ntemplate <typename T>\nclass RBTree\n{\n    // èŠ‚ç‚¹çš„é¢œè‰²\n    enum Color\n    {\n        BLACK,\n        RED\n    };\n    // èŠ‚ç‚¹ç±»å‹\n    struct Node\n    {\n        Node(T data = T(), Node *parent = nullptr,\n             Node *left = nullptr, Node *right = nullptr,\n             Color color = BLACK)\n            : data_(data), left_(left), right_(right), parent_(parent), color_(color)\n        {\n        }\n        T data_;\n        Node *left_;\n        Node *right_;\n        Node *parent_; // æŒ‡å‘å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹\n        Color color_;  // èŠ‚ç‚¹çš„é¢œè‰²\n    };\n    // æŒ‡å‘çº¢é»‘æ ‘çš„æ ¹èŠ‚ç‚¹\n    Node *root_;\n};\n```\n## æ’å…¥\n```cpp\nvoid insert(const T &val)\n{\n    if (root_ == nullptr)\n    {\n        root_ = new Node(val);\n        return;\n    }\n\n    Node *parent = nullptr;\n    Node *cur = root_;\n    // BST æ’å…¥æµç¨‹\n    while (cur != nullptr)\n    {\n        if (cur->data_ > val)\n        {\n            parent = cur;\n            cur = cur->left_;\n        }\n        else if (cur->data_ < val)\n        {\n            parent = cur;\n            cur = cur->right_;\n        }\n        else\n        {\n            return;\n        }\n    }\n    // parentç°åœ¨æ˜¯nodeçš„çˆ¶èŠ‚ç‚¹\n    Node *node = new Node(val, parent, nullptr, nullptr, RED);\n    // åˆ¤æ–­nodeæ’åˆ°äº†parentå·¦è¿˜æ˜¯å³ï¼Œç„¶åè®©å…¶leftæˆ–rightæŒ‡å‘node\n    if (parent->data_ > val)\n    {\n        parent->left_ = node;\n    }\n    else\n    {\n        parent->right_ = node;\n    }\n\n    // å¦‚æœæ–°æ’å…¥çš„çº¢è‰²èŠ‚ç‚¹ï¼Œçˆ¶èŠ‚ç‚¹ä¹Ÿæ˜¯çº¢è‰²ï¼Œä¸æ»¡è¶³çº¢é»‘æ ‘æ€§è´¨ï¼Œè¿›è¡Œæ’å…¥è°ƒæ•´æ“ä½œ\n    if (RED == color(parent))\n    {\n        fixAfterInsert(node);\n    }\n}\n// è°ƒå¹³å‡½æ•°\nvoid fixAfterInsert(Node *node)\n{\n    // å¦‚æœå½“å‰çº¢è‰²èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ˜¯çº¢è‰²ï¼Œä¸æ–­å‘ä¸Šè°ƒæ•´\n    while (color(parent(node)) == RED)\n    {\n        // å·¦é•œåƒçš„3ç§æƒ…å†µï¼Œå³æ’å…¥çš„èŠ‚ç‚¹åœ¨å·¦å­æ ‘å½“ä¸­\n        if (left(parent(parent(node))) == parent(node))\n        {\n            Node *uncle = right(parent(parent(node)));\n            if (RED == color(uncle)) // æƒ…å†µä¸€\n            {\n                setColor(parent(node), BLACK);\n                setColor(uncle, BLACK);\n                setColor(parent(parent(node)), RED);\n                node = parent(parent(node)); // ç»§ç»­è°ƒæ•´\n            }\n            else\n            {\n                // å…ˆå¤„ç†æƒ…å†µä¸‰\n                if (right(parent(node)) == node)\n                {\n                    node = parent(node);\n                    leftRotate(node);\n                }\n                // ç»Ÿä¸€å¤„ç†æƒ…å†µäºŒ\n                rightRotate(parent(parent(node)));\n                break; // è°ƒæ•´å·²ç»å®Œæˆ\n            }\n        }\n        else // å³é•œåƒçš„3ç§æƒ…å†µï¼Œå³æ’å…¥çš„èŠ‚ç‚¹åœ¨å³å­æ ‘å½“ä¸­\n        {\n            Node *uncle = left(parent(parent(node)));\n            if (RED == color(uncle)) // æƒ…å†µä¸€\n            {\n                setColor(parent(node), BLACK);\n                setColor(uncle, BLACK);\n                setColor(parent(parent(node)), RED);\n                node = parent(parent(node)); // ç»§ç»­è°ƒæ•´\n            }\n            else\n            {\n                // å…ˆå¤„ç†æƒ…å†µä¸‰\n                if (left(parent(node)) == node)\n                {\n                    node = parent(node);\n                    rightRotate(node);\n                }\n                // ç»Ÿä¸€å¤„ç†æƒ…å†µäºŒ\n                leftRotate(parent(parent(node)));\n                break; // è°ƒæ•´å·²ç»å®Œæˆ\n            }\n        }\n    }\n    // æ­¤å¤„å¼ºåˆ¶rootä¸ºé»‘è‰²èŠ‚ç‚¹\n    setColor(root_, BLACK);\n}\n```\nåˆ†æå‡ºï¼Œçº¢é»‘æ ‘çš„æ’å…¥ï¼Œæœ€å¤šæ—‹è½¬2æ¬¡ï¼šå…ˆå·¦æ—‹ã€å†å³æ—‹ï¼›æˆ–è€…å…ˆå³æ—‹ã€å†å·¦æ—‹ã€‚\n## åˆ é™¤\næ€»ä½“æ€è·¯ï¼š\n1. å¶å­èŠ‚ç‚¹çš„åˆ é™¤ï¼š\n    1. æ ¹ã€‚å…ˆæŠŠæ ¹æ¸…ç†ï¼Œå†åˆ é™¤ã€‚\n    2. çº¢è‰²å¶å­ï¼Œç›´æ¥ç”¨BSTæ–¹å¼åˆ é™¤ã€‚\n    3. é»‘è‰²å¶å­ï¼Œ**ä»å…„å¼Ÿå€Ÿé»‘è‰²èŠ‚ç‚¹**ã€‚\n2. æœ‰ä¸¤ä¸ªå­æ ‘çš„èŠ‚ç‚¹åˆ é™¤ï¼š\n    1. åˆ é™¤æœ‰ä¸¤ä¸ªå­æ ‘çš„èŠ‚ç‚¹ï¼Œå¯ä»¥æŠŠèŠ‚ç‚¹ä¸å…¶å·¦å­æ ‘çš„æœ€å³èŠ‚ç‚¹ï¼ˆæ­¤æ—¶æœ€å¤šæœ‰ä¸€ä¸ªå­æ ‘ï¼Œæˆ–è€…ä¸ºå¶å­èŠ‚ç‚¹ï¼‰æ›¿æ¢ï¼Œç„¶åè½¬åŒ–ä¸ºåˆ é™¤åªæœ‰ä¸€ä¸ªå­æ ‘çš„èŠ‚ç‚¹æˆ–åˆ é™¤å¶å­èŠ‚ç‚¹ã€‚\n3. æœ‰ä¸€ä¸ªå­æ ‘çš„èŠ‚ç‚¹åˆ é™¤ï¼š\n    1. ä¸»è¦æ€æƒ³æ˜¯æŠŠå­©å­æ›¿è¡¥ä¸Šæ¥ã€‚\n        1. è¡¥ä¸Šæ¥çš„å­©å­æ˜¯çº¢è‰²ï¼Œç›´æ¥æŠŠå­©å­æ¶‚æˆé»‘è‰²ã€‚\n        2. è¡¥ä¸Šæ¥çš„å­©å­æ˜¯é»‘è‰²ï¼Œæ— æ³•å†ä»è‡ªå·±å­©å­è¿™é‡Œè¡¥å……é»‘è‰²äº†ï¼Œéœ€è¦**ä»å…„å¼Ÿå€Ÿé»‘è‰²èŠ‚ç‚¹**ã€‚\n\n```cpp\nvoid remove(const T &val)\n{\n    // æŸ¥æ‰¾\n    if(root_ == nullptr)\n    {\n        return;\n    }\n    Node* cur = root_;\n    while(cur != nullptr)\n    {\n        if (cur->data_ > val)\n        {\n            cur = cur->left_;\n        }\n        else if(cur->data_ < val)\n        {\n            cur = cur->right_;\n        }\n        else\n        {\n            break;\n        }\n    }\n    if(cur == nullptr)\n    {\n        return;\n    }\n    // åˆ é™¤\n    // å·¦å³éƒ½ä¸ä¸ºç©ºï¼Œåˆ™æ‰¾å·¦å­æ ‘ä¸­çš„æœ€å³å€¼ï¼ˆå‰é©±ï¼‰æˆ–è€…å³å­æ ‘ä¸­çš„æœ€å·¦å€¼ï¼ˆåç»§ï¼‰ï¼Œæ›¿æ¢\n        // æ­¤å¤„æ‰¾çš„æ˜¯å·¦å­æ ‘ä¸­çš„æœ€å³å€¼ï¼ˆå‰é©±ï¼‰\n    if (cur->left_ != nullptr && cur->right_ != nullptr)\n    {\n        Node * pre = cur->left_;\n        while (pre->right_ != nullptr)\n        {\n            pre = pre->right_;\n        }\n        // æ›¿æ¢å€¼\n        cur->data_ = pre->data_;\n        cur = pre; // è½¬åŒ–ä¸ºåˆ é™¤pre\n    }\n    // åˆ é™¤curæŒ‡å‘çš„èŠ‚ç‚¹ï¼Œç›®å‰å¯ä»¥ç¡®å®šå…¶æœ€å¤šæœ‰ä¸€æ£µå­æ ‘ï¼Œæˆ–è€…å…¨ç©º\n    Node * child = cur->left;\n    if (child == nullptr)\n    {\n        child = cur->right_;\n    }\n    \n    // å¦‚æœcuræœ‰å­æ ‘ï¼Œéœ€è¦æ›´æ–°curå­æ ‘çš„parentæŒ‡å‘curçš„parent\n    if (child != nullptr)\n    {\n        child->parent_ = cur->parent_;\n        // å¦‚æœcurçš„parentä¸ºç©ºï¼Œåˆ™è¯´æ˜åˆ é™¤curåï¼Œchildå˜æˆäº†æ ¹\n        if (cur->parent_ == nullptr)\n        {\n            root_ = child;\n        }\n        else\n        {\n            // å› ä¸ºcuræ˜¯æœ€å³èŠ‚ç‚¹ï¼Œä¸å¯èƒ½æœ‰å³å­æ ‘ã€‚\n            // curåœ¨å·¦æ”¯ï¼Œåˆ é™¤å éœ€è¦æŠŠå­©å­ç»§æ‰¿ç»™curçš„parentçš„å·¦æ”¯\n            if (cur->parent_->left_ == cur)\n            {\n                cur->parent_->left_ = child;\n            }\n            else\n            {\n                // å› ä¸ºcuræ˜¯æœ€å³èŠ‚ç‚¹ï¼Œä¸å¯èƒ½æœ‰å³å­æ ‘ã€‚\n                // curåœ¨å³æ”¯ï¼Œåˆ é™¤å éœ€è¦æŠŠå­©å­ç»§æ‰¿ç»™curçš„parentçš„å³æ”¯\n                cur->parent_->right_ = child;\n            }\n        }\n        Color color = color(cur);\n        delete cur;\n        // è‹¥åˆ é™¤çš„èŠ‚ç‚¹æ˜¯çº¢è‰²ï¼Œå®Œæ¯•ã€‚\n        // è‹¥åˆ é™¤çš„èŠ‚ç‚¹æ˜¯é»‘è‰²ï¼Œéœ€è¦è°ƒæ•´\n            // å¦‚æœè¡¥ä¸Šæ¥çš„å­©å­æ˜¯çº¢è‰²ï¼Œç›´æ¥æ¶‚æˆé»‘è‰²\n            // å¦‚æœè¡¥ä¸Šæ¥çš„å­©å­æ˜¯é»‘è‰²ï¼Œæ— æ³•å†å€Ÿå­©å­é»‘è‰²ï¼Œéœ€è¦å€Ÿå…„å¼Ÿçš„ã€‚\n        if (c == Black)\n        {\n            fixAfterRemove(child);\n        }\n    }\n    else // curæ²¡æœ‰å­æ ‘ã€‚\n    {\n        // çœ‹parentæ˜¯å¦ä¸ºç©ºï¼Œè‹¥æ˜¯ï¼Œè¯´æ˜å…¶ä¸ºæ ¹èŠ‚ç‚¹\n        if (cur->parent_ == nullptr)\n        {\n            delete cur;\n            root_ = nullptr;\n            return;\n        }\n        else // æ­¤æ—¶åˆ é™¤çš„èŠ‚ç‚¹curæ˜¯æ­£å¸¸çš„å¶å­èŠ‚ç‚¹\n        {\n            // åˆ é™¤é»‘è‰²å¶å­ï¼Œè¦å€Ÿå…„å¼Ÿä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹\n            if (color(cur) == Black)\n            {\n                fixAfterRemove(cur);\n            }\n            // ä¸ç®¡å¶å­æ˜¯é»‘è¿˜æ˜¯çº¢ï¼Œéƒ½è¦èµ°ä»¥ä¸‹æ­¥éª¤\n            if (left(parent(cur)) == cur)\n            {\n                left(parent(cur)) == nullptr;\n            }\n            else\n            {            {\n                right(parent(cur)) == nullptr;\n            }\n            delete cur;\n        }\n    }\n}\n```\n1. æ ¹é»‘æˆ–è€…çº¢ã€‚å…„å¼Ÿé»‘\n    1. å…„å¼Ÿçš„å³å­©å­æ˜¯çº¢è‰²ï¼Œå·¦æ— æ‰€è°“\n        1. **æŠŠå…„å¼Ÿçš„å³å­©å­è®¾ä¸ºé»‘è‰²**ã€‚ä»¥æ ¹èŠ‚ç‚¹ä¸ºè½´ï¼Œå·¦æ—‹ã€‚å®Œæ¯•ã€‚\n        2. æ€»ä¹‹ï¼Œå€Ÿäº†å³æ”¯çš„é»‘èŠ‚ç‚¹ã€‚å³æ”¯éœ€è¦æ”¹ä¸€ä¸ªçº¢è‰²ä¸ºé»‘è‰²ã€‚\n    2. å…„å¼Ÿçš„å·¦å­©å­æ˜¯çº¢è‰²ï¼Œå³æ˜¯é»‘è‰²\n        1. ä»¥å…„å¼Ÿä¸ºè½´å³æ—‹ï¼Œäºæ˜¯è½¬åŒ–ä¸ºäº†æƒ…å†µ1ã€‚\n        2. æ³¨æ„å…„å¼Ÿæ¢äº†ï¼Œéœ€è¦æ›´æ–°ï¼ˆ`brother=parent->right`ï¼‰ã€‚\n    3. å…„å¼Ÿçš„ä¸¤ä¸ªå­©å­å…¨é»‘ã€‚\n        1. æ€»ä½“æ€æƒ³ï¼šç”±äºå·¦è¾¹å³å°†å¤±å»ä¸€ä¸ªé»‘è‰²ï¼Œå¯ä»¥æŠŠ**é»‘è‰²çš„å…„å¼Ÿæ¶‚çº¢**ä»¥å¹³è¡¡ã€‚\n            1. å³æ”¯æ–°æ·»äº†çº¢è‰²èŠ‚ç‚¹ï¼Œå›å¤´éœ€çœ‹è‹¥æ ¹èŠ‚ç‚¹ä¸ºçº¢è‰²ï¼Œåˆ™**æ”¹ä¸ºé»‘è‰²**ã€‚ç»“æŸã€‚\n            2. è‹¥æ ¹èŠ‚ç‚¹ä¸ºé»‘è‰²ï¼Œåˆ™å‘ä¸Šè¿½æº¯ä¸€ä¸ªçº¢è‰²èŠ‚ç‚¹ï¼Œ**æ”¹ä¸ºé»‘è‰²**ã€‚\n2. ï¼ˆæƒ…å†µ4ï¼‰æ ¹é»‘æˆ–è€…çº¢ã€‚å…„å¼Ÿçº¢\n    1. å…„å¼Ÿçš„ä¸¤ä¸ªå­©å­å…¨é»‘ï¼ˆå› ä¸ºå…„å¼ŸèŠ‚ç‚¹æ˜¯çº¢ï¼Œå…¶å­©å­ä¸èƒ½å‡ºç°çº¢ï¼‰ã€‚æ„å‘³ç€æ ¹çš„å³æ”¯å·²ç»æ²¡æœ‰å­©å­å¯å€Ÿã€‚\n        1. ä»¥æ ¹ä¸ºè½´ï¼Œå·¦æ—‹ã€‚è¿™æ ·ï¼Œè¦åˆ é™¤çš„èŠ‚ç‚¹å°±æœ‰äº†é»‘è‰²å…„å¼Ÿã€‚\n        2. ä½†æ˜¯è¦æ³¨æ„ï¼Œè¦åˆ é™¤çš„èŠ‚ç‚¹çš„å…„å¼Ÿæ¢äº†ï¼Œéœ€è¦æ›´æ–°ï¼ˆ`brother=parent->right`ï¼‰ã€‚\n        3. å¯ä»¥å½’ç»“åˆ°ä¸Šè¿°å…„å¼Ÿé»‘çš„ä¸‰ç§æƒ…å†µäº†ã€‚\n\n![](../../images/Cè¯­è¨€_æ ‘/image-20250304021224853.png)\n\n![](../../images/Cè¯­è¨€_æ ‘/image-20250304021232069.png)\n\n![](../../images/Cè¯­è¨€_æ ‘/image-20250304021240983.png)\n\n![](../../images/Cè¯­è¨€_æ ‘/image-20250304021248122.png)\n\n```cpp\n// æ—‹è½¬æ—¶äº§ç”Ÿçš„é¢œè‰²äº¤æ¢åº”é›†æˆåœ¨æ—‹è½¬å‡½æ•°ä¸­\nvoid fixAfterRemove(Node * node)\n{\n    while (node != root_ && color(node) == Black)\n    {\n        // å·¦é•œåƒï¼Œå³åˆ é™¤çš„èŠ‚ç‚¹åœ¨æ ¹çš„å·¦æ”¯ã€‚\n        if (left(parent(node)) == node)\n        {\n            Node * brother = right(parent(node));\n            // æƒ…å†µ4ï¼Œå…„å¼Ÿçº¢ã€‚è½¬åŒ–ä¸ºå…„å¼Ÿé»‘çš„æƒ…å†µ\n            if (color(brother) == RED)\n            {\n                leftRotate(parent(node));\n                brother = right(parent(node));\n            }\n            // æƒ…å†µ3ï¼Œå…„å¼Ÿçš„ä¸¤ä¸ªå­©å­ä¸ºé»‘ã€‚\n            if (color(left(brother)) == Black && color(right(brother)) == Black)\n            {\n                setColor(brother, Red);\n                node = parent(node);\n                // è¿›å…¥ä¸‹ä¸€æ¬¡whileå¾ªç¯çœ‹çˆ¶èŠ‚ç‚¹æ˜¯é»‘è¿˜æ˜¯çº¢ã€‚é‡åˆ°çº¢åˆ™é€€å‡ºã€‚\n            }\n            else //æƒ…å†µ2 å…„å¼Ÿçš„å·¦å­©å­æ˜¯çº¢è‰²ï¼Œå³æ˜¯é»‘è‰²\n            {\n                if (color(right(brother)) == Black)\n                {\n                    rightRotate(brother);\n                    brother = right(parent(node));\n                }\n                // æƒ…å†µ1 å…„å¼Ÿçš„å³å­©å­æ˜¯çº¢è‰²ï¼Œå·¦å­©å­æ— æ‰€è°“ã€‚\n                setColor(right(brother), Black);\n                leftRotate(parent(node));\n                break;\n            }\n        }\n        else // å³é•œåƒï¼Œå³åˆ é™¤çš„èŠ‚ç‚¹åœ¨æ ¹çš„å³æ”¯ã€‚\n        {\n            Node * brother = left(parent(node));\n            // æƒ…å†µ8ï¼Œå…„å¼Ÿçº¢ã€‚è½¬åŒ–ä¸ºå…„å¼Ÿé»‘çš„æƒ…å†µ\n            if (color(brother) == RED)\n            {\n                rightRotate(parent(node));\n                brother = left(parent(node));\n            }\n            // æƒ…å†µ7ï¼Œå…„å¼Ÿçš„ä¸¤ä¸ªå­©å­ä¸ºé»‘ã€‚\n            if (color(left(brother)) == Black && color(right(brother)) == Black)\n            {\n                setColor(brother, Red);\n                node = parent(node);\n                // è¿›å…¥ä¸‹ä¸€æ¬¡whileå¾ªç¯çœ‹çˆ¶èŠ‚ç‚¹æ˜¯é»‘è¿˜æ˜¯çº¢ã€‚é‡åˆ°çº¢åˆ™é€€å‡ºã€‚\n            }\n            else //æƒ…å†µ6 å…„å¼Ÿçš„å³å­©å­æ˜¯çº¢è‰²ï¼Œå·¦æ˜¯é»‘è‰²\n            {\n                if (color(left(brother)) == Black)\n                {\n                    leftRotate(brother);\n                    brother = left(parent(node));\n                }\n                // æƒ…å†µ5 å…„å¼Ÿçš„å·¦å­©å­æ˜¯çº¢è‰²ï¼Œå³å­©å­æ— æ‰€è°“ã€‚\n                setColor(left(brother), Black);\n                rightRotate(parent(node));\n                break;\n            }\n        }\n    }\n    // ç›´åˆ°nodeæŒ‡å‘çš„èŠ‚ç‚¹æ˜¯çº¢è‰²ï¼Œåˆ™ç›´æ¥æ¶‚æˆé»‘è‰²ï¼Œç»“æŸã€‚\n    setColor(node, Black);\n}\n```\nåˆ†æå‡ºï¼Œçº¢é»‘æ ‘çš„åˆ é™¤ï¼Œæœ€å¤šæ—‹è½¬3æ¬¡ï¼šå…ˆå·¦æ—‹ã€å†å³æ—‹ã€å†å·¦æ—‹ï¼›æˆ–è€…å…ˆå³æ—‹ã€å†å·¦æ—‹ã€å†å³æ—‹ã€‚","categories":["C","é«˜çº§æ•°æ®ç»“æ„","æ ‘"]},{"title":"å¿«é€Ÿå¹‚_Cè¯­è¨€å®ç°","url":"/ç®—æ³•/å¿«é€Ÿå¹‚_Cè¯­è¨€å®ç°/","content":"# FastPower - å¿«é€Ÿå¹‚\n\nåœ¨ACMä¸­æˆ–æœ‰çš„é¢è¯•ä¸­ä¼šè€ƒåˆ°ã€‚æ ¸å¿ƒé—®é¢˜æ˜¯å¦‚ä½•åŠ é€Ÿç®—æ³•ã€‚\n\n$a^n$å³nä¸ªaç›¸ä¹˜ã€‚å¦‚ä½•è½¬åŒ–ï¼Ÿ\n\nä¾‹ï¼š$a^{13_{(10)}}$çš„è®¡ç®—ã€‚\n\næˆ‘ä»¬å¯ä»¥å‘ç°ï¼š$a^{4_{(10)}}\\cdot a^{4_{(10)}} = (a^{4_{(10)}})^{2_{(10)}} = a^{8_{(10)}}$\n\næ›´ä¸€èˆ¬åœ°ï¼Œï¼ˆä»¥ä¸‹ä¸º10è¿›åˆ¶ï¼‰\n$$\na^1\\\\\n(a^{1})^2 = a^{2}\\\\\n(a^{2})^2 = a^{4}\\\\\n(a^{4})^2 = a^{8}\\\\\n(a^{8})^2 = a^{16}\\\\\n...\n$$\nåˆ™$a^{13_{(10)}}$å¯ä»¥è½¬åŒ–ä¸º$a^{1101_{(2)}} = a^{8_{(10)}}\\cdot a^{4_{(10)}}\\cdot a^{1_{(10)}}$ï¼Œå¦‚æ­¤ï¼Œ$a^{13_{(10)}}$çš„è®¡ç®—ä¸ç”¨æŠŠaå‚»å‚»åœ°è¿ä¹˜13æ¬¡ï¼Œè€Œæ˜¯è½¬åŒ–ä¸ºéœ€è¦è®¡ç®—3ä¸ªå°çš„æ•°å³å¯ã€‚\n\næ‰€ä»¥ï¼Œæ•´ä¸ªè®¡ç®—è¿‡ç¨‹å¯ä»¥åˆ©ç”¨å‰é¢è®¡ç®—è¿‡ç¨‹ä¸­çš„ä¸­é—´å€¼è¿›è¡Œè®¡ç®—ï¼Œæé«˜æ•ˆç‡ã€‚\n\n## å…·ä½“ç®—æ³•\n\næŠŠæŒ‡æ•°çœ‹ä½œäºŒè¿›åˆ¶ï¼Œå¯¹æŒ‡æ•°æœ€åä¸€ä½åˆ¤æ–­æ˜¯å¦ä¸º1ï¼ˆä¸1æŒ‰ä½ä¸ï¼‰ï¼Œä¸º1åˆ™è®°å½•ä¸‹æ¥å¤„ç†ï¼Œä¹‹åå³ç§»1ä½ï¼Œæ¥ç€åˆ¤æ–­ä¸‹ä¸€ä½ï¼Œå¦‚æ­¤å¾ªç¯ã€‚\n\n```c\nlong long fast_pow(long a, unsigned n)\n{\n    long long product = 1;\n    while(n)\n    {\n        if(n & 1)\n        {\n            product *= a;\n        }\n        a *= a;  // æ¯æ¬¡å¯¹åº” a^2  a^4  a^8 ...\n        n >>= 1;\n    }\n    return product;\n}\n```\n\n","categories":["C","ç®—æ³•"]},{"title":"Cè¯­è¨€_æ–‡ä»¶","url":"/C/Cè¯­è¨€_æ–‡ä»¶/","content":"# æ–‡ä»¶\n\n## FILE\n\n```c\ntypedef struct _iobuf\n{\n    void * _Placeholder;\n}FILE;\n_ACRTIMP _ALT FILE* __cdecl __acrt_iob_func(unsigned _Ix);\n```\n\nå®é™…å°±æ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´å‹IDå€¼ï¼Œå½“åšäº†å½¢å¼ä¸ºæŒ‡é’ˆæ¥ç”¨äº†ã€‚\n\nä¸ºä»€ä¹ˆè¦ç”¨æŒ‡é’ˆï¼Œæ˜¯ä¸ºäº†é˜²æ­¢å•çº¯çš„æ•´å‹éšæ„è¢«èµ‹å€¼ï¼Œè€Œä¸åŒç±»å‹çš„æŒ‡é’ˆä¸å¯ä»¥éšæ„èµ‹å€¼ï¼Œå› æ­¤å¯ä»¥ç”¨æŒ‡é’ˆæ¥é˜»æŒ¡ä¸€ä¸‹ï¼Œå‡ºé”™æ¦‚ç‡å°±å°äº†ã€‚\n\n### mode\n\nmodeæ˜¯ä»¥å†…å­˜è§†è§’æ¥è¯´çš„ï¼š\n\n1. ä»è®¾å¤‡å†™å…¥åˆ°å†…å­˜ä¸­æ˜¯inputï¼Œæ˜¯`\"r\"`ï¼›\n2. ä»å†…å­˜ä¸­å†™å‡ºåˆ°ç£ç›˜æ˜¯outputï¼Œæ˜¯`\"w\"`ã€‚å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œåˆ™åˆ æ‰å†…å®¹ï¼Œä»0å¼€å§‹å†™ã€‚\n\n### fopen\n\n```c\nint main()\n{\n    FILE * file = fopen(\"e:\\\\aa.txt\", \"w\");  //ç»å¯¹è·¯å¾„\n    fclose(file);\n}\n```\n\n`\\`æ˜¯è½¬ä¹‰å­—ç¬¦ï¼Œæ‰€ä»¥ï¼Œ`\\\\`è¡¨ç¤º`\\`ã€‚å¦‚æœä¸æƒ³å†™`\\\\`ï¼Œä¹Ÿå¯ä»¥åªå†™ä¸€ä¸ª`/`\n\n### å†™ä¸œè¥¿\n\næ–‡ä»¶ä¸­æœ‰ä¸¤ä¸ªæµï¼Œè¾“å‡ºæµå’Œè¾“å…¥æµï¼Œä¸¤ä¸ªæµçš„æŒ‡é’ˆä½ç½®äº’ç›¸ç‹¬ç«‹ã€äº’ä¸å¹²æ‰°ã€‚æŒ‡é’ˆä½ç½®å¯ä»¥ç”¨`fseek`ã€`fsetpos`ç­‰æ”¹å˜ã€‚\n\nåœ¨è¿™é‡Œç”¨fwriteå†™å…¥æ–‡ä»¶ï¼šWrite block of data to stream.\n\n```c\nsize_t fwrite(const void * ptr, size_t size, size_t count, FILE * stream);\n// ptræŒ‡ç¤ºç¼“å†²åŒºçš„èµ·å§‹ä½ç½®ï¼›Pointer to the array of elements to be written, converted to a const void *\n// sizeæ˜¯è¦å†™å…¥çš„å…ƒç´ ç±»å‹çš„å¤§å°\n// countæ˜¯æœ‰å¤šå°‘ä¸ªå…ƒç´ \n// streamæ˜¯å“ªä¸ªæ–‡ä»¶\n// è¿”å›å€¼æ˜¯æŒ‡å†™å…¥äº†å¤šå°‘ä¸ªå…ƒç´ ï¼Œè€Œä¸æ˜¯å­—èŠ‚æ•°ã€‚\n```\n\n```c\nint main()\n{\n    int val = 24;\n    FILE * file = fopen(\"e:\\\\aa.txt\", \"w\");  //ç»å¯¹è·¯å¾„\n    if(NULL == file) return 0;\n    // å†™å…¥ä¸€ä¸ªintã€‚\n    size_t byte_written = fwrite(&val, sizeof val, 1, file);\n    fclose(file);\n    file = NULL;\n}\n```\n\n### ç¨‹åºä¸­è¯»æ–‡ä»¶\n\nå¦‚æœå·²ç»æœ‰å­˜åœ¨çš„æ–‡ä»¶ï¼Œåˆ™å°±ä¸è¦å†æ‰§è¡Œå†™å…¥çš„éƒ¨åˆ†ã€‚éœ€è¦ç”¨å®æ¡ä»¶è¯­å¥æ¥æ§åˆ¶ç¨‹åºã€‚\n\nfreadæ˜¯Read block of data from stream.\n\n```c\nsize_t fread(void * ptr, size_t size, size_t count, FILE * stream);\n```\n\n```c\nint main()\n{\n    FILE * file = NULL;\n#ifdef _CREATE_FILE__\n    int val = 24;\n    file = fopen(\"e:\\\\aa.txt\", \"w\");\n    if(!file)\n        return 0;\n    size_t num_written = fwrite(&val, sizeof val, 1, file);\n#else\n    int val = 0;\n    file = fopen(\"e:\\\\aa.txt\", \"r\");\n    size_t size_to_read = sizeof val;\n    if(!file)\n        return 0;\n    // è¿”å›çš„æ˜¯å…ƒç´ ä¸ªæ•°ï¼Œä¸º1ä¸ª\n    size_t num_read = fread(&val, sizeof val, 1, file);\n    if(num_read == size_to_read)\n        printf(\"%i\\n\", val);\n#endif // _CREATE_FILE__\n    fclose(file);\n    file = NULL;\n    return 0;\n}// 24\n```\n\n### å®é™…ä¸Š\n\né»˜è®¤æš‚æ—¶åœ¨ç¼“å­˜åŒºä¸­å­˜æ”¾å†…å®¹ï¼Œæ¯”å¦‚å‘ç£ç›˜ä¸­å†™å…¥ä¸œè¥¿ï¼Œç›´åˆ°ç¼“å†²åŒºæ»¡æ—¶ï¼Œæ‰ä¼šçœŸæ­£å¼€å§‹å†™å…¥ç£ç›˜ã€‚ä¹Ÿå¯ä»¥ä¸­é€”è°ƒç”¨`fflush`è¿›è¡Œç«‹å³åˆ·æ–°ç¼“å­˜åŒºã€‚\n","categories":["C"]},{"title":"Cè¯­è¨€_é“¾è¡¨","url":"/C/Cè¯­è¨€_é“¾è¡¨/","content":"# é“¾è¡¨\n\n1. ä¸è¦æ±‚åœ°å€è¿ç»­ï¼Œå› æ­¤å¯ä»¥å»ºç«‹åœ¨å †ä¸Šã€‚\n2. æ’å…¥çš„æ—¶é—´å¤æ‚åº¦ä½ã€‚\n\n## èŠ‚ç‚¹å®šä¹‰\n\nä»¥ä¸‹ä¸ºæ— å¤´èŠ‚ç‚¹çš„å•é“¾è¡¨ã€‚\n\n```c\ntypedef struct _Node\n{\n    unsigned id;\n    char val;\n    struct _Node * next;\n}Node, *PNode;\n// æŒ‡å‘é“¾è¡¨ä¸­ç¬¬1ä¸ªæœ‰æ•ˆå…ƒç´ çš„æŒ‡é’ˆï¼Œä¸æ˜¯æ•™ç§‘ä¹¦ä¸Šçš„å¤´èŠ‚ç‚¹ï¼ˆå¤´èŠ‚ç‚¹æ˜¯æ— æ•ˆå€¼ï¼Œä»…ä»£è¡¨æ ‡è¯†ï¼‰\nPNode header = NULL;\n```\n\n## push_back\n\n```c\nvoid push_back(PNode node)\n{\n    PNode current = header;\n    if(current == NULL)\n    {\n        header = node;\n        return;\n    }\n    while(current->next != NULL)\n    {\n        current = current->next;\n    }\n    current->next = node;\n    return;\n}\n```\n\n## make_node\n\n```c\nPNode make_node(unsigned id, char val)\n{\n    PNode node = (PNode)malloc(sizeof(Node));\n    if (node != NULL)\n    {\n        node->id = id;\n        node->val = val;\n        node->next = NULL;\n    }\n    return node;\n}\n```\n\næµ‹è¯•\n\n```c\nint main()\n{\n    PNode node = make_node(1, 'a');\n    push_back(node);\n    node = make_node(2, 'b');\n    push_back(node);\n    node = make_node(3, 'c');\n    push_back(node);\n}\n```\n\n## traversal\n\n```c\nvoid traversal()\n{\n    PNode current = header;\n    while(current != NULL)\n    {\n        printf(\"id: %u, val: %c\\n\", current->id, current->val);\n        current = current->next;\n    }\n}\n```\n\n## `insert_after_id`\n\n```c\nvoid insert_after_id(unsigned id, PNode node)\n{\n    PNode current = header;\n    while(current != NULL)\n    {\n        if(id == current->id) break;\n        current = current->next;\n    }\n    if(current != NULL)\n    {\n        node->next = current->next;\n        current->next = node;\n    }\n    else\n    {\n        push_back(node);\n    }\n}\n```\n\næµ‹è¯•\n\n```c\nint main()\n{\n    PNode node = make_node(1, 'a');\n    push_back(node);\n    node = make_node(2, 'b');\n    push_back(node);\n    node = make_node(3, 'c');\n    push_back(node);\n    traversal();\n    node = make_node(4, 'd');\n    insert_after_id(2, node);\n    traversal();\n}\n//ç¬¬ä¸€æ¬¡éå†ï¼š1 2 3\n//ç¬¬äºŒæ¬¡éå†ï¼š1 2 4 3\n```\n\n## `insert_before_id`\n\nè‡ªå·±å†™çš„ç‰ˆæœ¬\n\n```c\nvoid insert_before_id(unsigned id, PNode node)\n{\n    PNode current = header;\n    if(current == NULL)\n    {\n        push_back(node);\n        return;\n    }\n    if(current->id == id)\n    {\n        header = node;\n        node->next = current;\n        return;\n    }\n    while(current->next != NULL)\n    {\n        if(id == current->next->id) break;\n        current = current->next;\n    }\n    if(current->next != NULL)\n    {\n        node->next = current->next;\n        current->next = node;\n    }\n    else\n    {\n        push_back(node);\n    }\n}\n```\n\næµ‹è¯•\n\n```c\nint main()\n{\n    PNode node = make_node(1, 'a');\n    push_back(node);\n    node = make_node(2, 'b');\n    push_back(node);\n    node = make_node(3, 'c');\n    push_back(node);\n    traversal();\n    node = make_node(4, 'd');\n    insert_before_id(1, node);\n    traversal();\n}\n//ç¬¬ä¸€æ¬¡éå†ï¼š1 2 3\n//ç¬¬äºŒæ¬¡éå†ï¼š4 1 2 3\n```\n\nåŒæŒ‡é’ˆæ³•\n\n```c\nvoid insert_before(unsigned id, PNode node)\n{\n    PNode p = header, pp = NULL;\n    while(p)\n    {\n        if(p->id == id)\n        {\n            break;\n        }\n        pp = p;\n        p = p->next;\n    }\n    if(!p)//æ’å…¥çš„ä½ç½®ä¸ºç©º\n    {\n        push_back(node);\n        return;\n    }\n    // æ‰¾åˆ°idï¼Œä¸”pä¸ä¸ºç©º\n    if(p != NULL && pp == NULL)//ç¬¬ä¸€æ¬¡whileå¾ªç¯å³æ‰¾åˆ°äº†idï¼Œå³idåœ¨é¦–å…ƒç´ ï¼Œéœ€è¦æ’åˆ°é¦–ä½ç½®ï¼Œè¦æ¢å¤´ã€‚\n    {\n        header = node;\n        node->next = p;\n        return;\n    }\n    // å‰©ä¸‹å°±æ˜¯åœ¨ä¸­é—´æ’å…¥çš„æƒ…å†µäº†ã€‚\n    pp->next = node;\n    node->next = p;\n}\n```\n\n## remove_node\n\nåˆ é™¤æŒ‡å®šid\n\n```c\nvoid remove_node(unsigned id)\n{\n    PNode current = header;\n    if(header != NULL && header->id == id)\n    {\n        free(header);\n        header = NULL;\n        return;\n    }\n    PNode prev = NULL;\n    while(current != NULL)\n    {\n        if(id == current->id) break;\n        prev = current;\n        current = current->next;\n    }\n    if(current != NULL)\n    {\n        prev->next = current->next;\n        free(current);\n        current = NULL;\n    }\n}\n```\n\næµ‹è¯•\n\n```c\nint main()\n{\n    PNode node = make_node(1, 'a');\n    push_back(node);\n    node = make_node(2, 'b');\n    push_back(node);\n    node = make_node(3, 'c');\n    push_back(node);\n    traversal();\n    node = make_node(4, 'd');\n    insert_before_id(1, node);\n    traversal();\n    remove_node(1);\n    traversal();\n    remove_node(2);\n    traversal();\n    remove_node(3);\n    traversal();\n    remove_node(4);\n    traversal();\n    remove_node(5);\n    traversal();\n}\n/* ç»“æœï¼š\nid: 1, val: a\nid: 2, val: b\nid: 3, val: c\n\nid: 4, val: d\nid: 1, val: a\nid: 2, val: b\nid: 3, val: c\n\nid: 4, val: d\nid: 2, val: b\nid: 3, val: c\n\nid: 4, val: d\nid: 3, val: c\n\nid: 4, val: d\n\nç©º\n*/\n```\n\n## ç¯\n\n### åˆ¶é€ ç¯\n\næ ‡è®°ä¸€ä¸ªidï¼Œä¹‹åè®©å°¾èŠ‚ç‚¹nextæŒ‡å‘è¯¥id\n\n```c\nPNode find_id(unsigned id)\n{\n    PNode current = header;\n    while(current != NULL)\n    {\n        if(current->id == id) break;\n        current = current->next;\n    }\n    return current;\n}\nvoid make_cycle(unsigned id)\n{\n    // ç¡®ä¿æœ‰ä¸¤ä¸ªèŠ‚ç‚¹\n    if(header == NULL || header->next == NULL) return;\n    PNode cycle_begin = find_id(id);\n    // ç¡®ä¿æœ‰è¿™ä¸ªid  å¹¶ä¸”  ç¡®ä¿cycle_beginä¸æ˜¯å°¾èŠ‚ç‚¹\n    if(cycle_begin == NULL || cycle_begin->next == NULL) return;\n    PNode current = header;\n    while(current->next != NULL)\n    {\n        current = current->next;\n    }\n    current->next = cycle_begin;\n}\n```\n\n### å¦‚ä½•åˆ¤æ–­æ˜¯å¦æœ‰ç¯ï¼Ÿå¿«æ…¢æŒ‡é’ˆ\n\nä¸€ä¸ªæŒ‡é’ˆèµ°ä¸€æ­¥ï¼Œä¸€ä¸ªæŒ‡é’ˆèµ°ä¸¤æ­¥ã€‚\n\nå¦‚æœä¸¤ä¸ªæŒ‡é’ˆé‡åˆåˆ™æœ‰ç¯ï¼Œå¦‚æœæ— ç¯çš„è¯ï¼Œå¿«æŒ‡é’ˆè‚¯å®šèƒ½åˆ°ç»ˆç‚¹NULLã€‚\n\n```c\nint has_cycle()\n{\n    if (header == NULL || header->next == NULL) return 0;\n    PNode fast = header;\n    PNode slow = header;\n    while (fast != NULL)\n    {\n        fast = fast->next;\n        if(fast != NULL)\n            printf(\"fast1: -> %i\\n\", fast->id);\n        if (fast != NULL)\n        {\n            fast = fast->next;\n            if (fast != NULL)\n                printf(\"fast2: -> %i\\n\", fast->id);\n            slow = slow->next;\n            printf(\"slow: -> %i\\n\\n\", slow->id);\n            if (fast == slow && fast != NULL)\n            {\n                fast = header;\n                while (fast != slow)\n                {\n                    fast = fast->next;\n                    slow = slow->next;\n                }\n                printf(\"æœ‰ç¯: %i\\n\", slow->id);\n                return 1;\n            }\n        }\n        else\n        {\n            printf(\"æ— ç¯\");\n            return 0;\n        }\n    }\n}\nint main()\n{\n    PNode node = make_node(7, '7');\n    push_back(node);\n    node = make_node(5, '5');\n    push_back(node);\n    node = make_node(6, '6');\n    push_back(node);\n    node = make_node(8, '8');\n    push_back(node);\n    node = make_node(2, '2');\n    push_back(node);\n    node = make_node(0, '0');\n    push_back(node);\n    node = make_node(4, '4');\n    push_back(node);\n    traversal();\n    make_cycle(6);\n    has_cycle();\n}\n// æœ‰ç¯ï¼š6\n```\n\nè®©ä¸€ä¸ªå¿«æŒ‡é’ˆå’Œä¸€ä¸ªæ…¢æŒ‡é’ˆå†æ¬¡ç›¸é‡å½“ç„¶å¯ä»¥è¯´æ˜æ­¤é“¾è¡¨æœ‰ç¯ã€‚ä½†ï¼Œéš¾ç‚¹åœ¨äºå¦‚ä½•æ‰¾åˆ°ç¯çš„å…¥å£ï¼Ÿ\n\nè®¾$x$ä¸ºå¤´èŠ‚ç‚¹åˆ°å¾ªç¯å…¥å£å¤„çš„è·ç¦»ï¼Œ$y$ä¸ºå¾ªç¯å…¥å£å¤„åˆ°ç›¸é‡ç‚¹çš„è·ç¦»ï¼Œ$z$ä¸ºç›¸é‡ç‚¹åˆ°å°¾èŠ‚ç‚¹çš„è·ç¦»ï¼ˆå³è¯¥èŠ‚ç‚¹ä¸‹ä¸€ä¸ªæ˜¯å¾ªç¯å£ï¼‰ã€‚å¹¶ç»“åˆ$fast$æŒ‡é’ˆå’Œ$slow$æŒ‡é’ˆçš„æ­¥æ•°å…³ç³»$fast=2slow$ï¼Œå¾—å‡ºåœ¨ç›¸é‡ç‚¹ï¼š$fast=x+n(y+z)+y$ï¼Œ$slow=x+y$ï¼ˆæ…¢æŒ‡é’ˆè‚¯å®šä¸ä¼šåœ¨åœˆå†…è½¬å®Œä¸€åœˆï¼Œå¯ä»¥æƒ³æƒ³ï¼Œæ˜¯åˆç†çš„ï¼Œå› ä¸ºå¿«æŒ‡é’ˆæ€»æ¯”æ…¢æŒ‡é’ˆå¿«$n$åœˆï¼Œè‚¯å®šåœ¨æ…¢æŒ‡é’ˆèµ°å®Œä¸€åœˆå‰å’Œå®ƒç›¸é‡ï¼ï¼‰ï¼Œåˆ™\n$$\n\\begin{align}\nx+n(y+z)+y&=2(x+y)\\\\\nx&=n(y+z)-y\\\\\nx&=n(y+z)-(y+z)+z\\\\\nx&=(n-1)(y+z)+z\\\\\nx&=z\n\\end{align}\n$$\n$y+z$æ˜¯åœˆé•¿ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³åˆ°ï¼Œå¦‚æœå¿«æŒ‡é’ˆè¦å’Œæ…¢æŒ‡é’ˆç›¸é‡ï¼Œ$n$å¿…é¡»è¦å¤§äºç­‰äº$1$ã€‚è‡³äº$n$ï¼Œå³åœˆæ•°å…·ä½“ä¸ºå‡ ï¼Œå®é™…ä¸Šæ— æ‰€è°“ï¼Œå› ä¸ºå¿«æŒ‡é’ˆåœ¨é‡Œé¢è½¬äº†$n$åœˆå’Œ$1$åœˆï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ï¼æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼Œ$x=z$ï¼äºæ˜¯ï¼Œå·²çŸ¥$z$ä¸ºç›¸é‡ç‚¹åˆ°å°¾èŠ‚ç‚¹çš„è·ç¦»ï¼ˆå°¾èŠ‚ç‚¹ä¸‹ä¸€ä¸ªæ˜¯å¾ªç¯å£ï¼‰ï¼Œå¹¶ä¸”å·²çŸ¥$z=x$ï¼ˆ$x$ä¸ºå¤´èŠ‚ç‚¹åˆ°å¾ªç¯å…¥å£å¤„çš„è·ç¦»ï¼‰ã€‚é‚£ä¹ˆï¼Œè®©ä¸€ä¸ªæŒ‡é’ˆåœ¨ç›¸é‡ç‚¹ï¼Œå¦ä¸€ä¸ªæŒ‡é’ˆåœ¨å¤´èŠ‚ç‚¹ï¼ŒåŒæ—¶æ­¥è¿›ï¼Œç›´åˆ°ç›¸é‡ï¼Œå°±æ˜¯å¾ªç¯å…¥å£å¤„ï¼\n\nå‚è€ƒï¼šhttps://www.bilibili.com/video/BV1if4y1d7ob\n\n## ä¿å­˜åˆ°æ–‡ä»¶\n\nä¿å­˜æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯åˆ°æ–‡ä»¶ä¸­ã€‚æˆåŠŸè¿”å›1ï¼Œå¤±è´¥è¿”å›0ã€‚\n\nä¸åº”å½“æŠŠç»“æ„ä½“ä½œä¸ºæ•´ä½“å®Œå…¨ä¿å­˜åˆ°ä¸€è¡Œã€‚\n\nè€Œæ˜¯æ¯ä¸ªå±æ€§ä¸€è¡Œä¸€è¡Œåœ°ä¿å­˜ã€‚å› ä¸ºnextæŒ‡é’ˆåœ¨ä¸‹æ¬¡è¿è¡Œå¤±æ•ˆçš„ã€‚éœ€è¦æŒ‰ç…§æ¯ä¸ªå±æ€§é‡æ–°æ„å»ºæ¯ä¸ªèŠ‚ç‚¹ã€‚\n\n```c\nint save(char const * const filename)\n{\n    return 0;\n}\n```\n\nåŠ è½½çš„æ—¶å€™ï¼ŒnextæŒ‡é’ˆçš„ä¿¡æ¯å·²ç»æ˜¯å¤±æ•ˆçš„ï¼Œéœ€è¦é‡æ–°`make_node`ã€‚\n\n```c\nint load(char const * const filename)\n{\n    return 0;\n}\n```\n\n","categories":["C","åŸºç¡€æ•°æ®ç»“æ„"]},{"title":"Cè¯­è¨€_ç»“æ„ä½“_sizeof_åˆ†æ®µ","url":"/C/Cè¯­è¨€_ç»“æ„ä½“_sizeof_åˆ†æ®µ/","content":"# ç»“æ„ä½“\n\n>å…³äº`;`çš„é—®é¢˜ï¼š\n>\n>1. ä¸€èˆ¬æ¥è¯´ï¼Œå¤§æ‹¬å·`{}`ç»“å°¾åä¸ç”¨å†åŠ `;`ã€‚ä½†æ˜¯ç»“æ„ä½“çš„å®šä¹‰ä¸­çš„å¤§æ‹¬å·`{}`åé¢è¦åŠ `;`ã€‚å› ä¸ºç»“æ„ä½“çš„å®šä¹‰å±äºæ•°æ®çš„å®šä¹‰ï¼Œåªæ˜¯æœ‰äº†å¤§æ‹¬å·çš„å½¢å¼è€Œå·²ï¼Œè€Œæ•°æ®çš„å®šä¹‰åé¢éƒ½è¦åŠ `;`ï¼Œå› æ­¤ç»“æ„ä½“çš„å®šä¹‰ä¸­çš„å¤§æ‹¬å·`{}`åé¢è¦åŠ `;`ã€‚\n>2. å‡½æ•°ã€ifè¯­å¥ã€forè¯­å¥ä¸­çš„`{}`æ˜¯è¯­å¥çš„å®šä¹‰ï¼Œåˆ™ä¸ç”¨åŠ `;`ã€‚\n\n```c\nstruct Stu\n{\n    unsigned id;\n    unsigned char age;\n    char name[10];\n};\n```\n\nCè¯­è¨€ä¸­ï¼Œ`struct`å’Œ`ç»“æ„ä½“åå­—`æ˜¯ä¸€ä½“çš„ï¼Œå…±åŒæ‰èƒ½åˆæˆä¸€ä¸ªç±»å‹ï¼Œä¸èƒ½åªå†™`Stu`ã€‚\n\n# ç»“æ„ä½“çš„å®šä¹‰\n\n```c\nint main()\n{\n    struct Stu stu;\n    stu.age = 17;\n    stu.id = 123456;\n    strcpy(stu.name, \"xcg\");\n    printf(\"Age: %u, ID: %u, Name: %s\\n\", stu.age, stu.id, stu.name);\n}\n```\n\n# ç»“æ„ä½“çš„å¤§å°\n\n```c\nstruct Test\n{\n    int a;          // 4\n    char b;         // 1  --> å®é™…: 4\n};\nint main()\n{\n    printf(\"%u\\n\", sizeof(struct Test));\n}// 8\n```\n\n## å­—èŠ‚å¯¹é½\n\nä¸ºäº†æ•ˆç‡ï¼Œå³ä½¿charåªå ç”¨ä¸€ä¸ªå­—èŠ‚ï¼Œä¹Ÿä¼šä»¥ç»“æ„ä½“ä¸­å¤§çš„æ•°æ®ç±»å‹ä¸ºå‚è€ƒå¤šå ä¸€äº›ç©ºé—´ã€‚å¦‚æ­¤åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å°±æ— éœ€å†å»ä¸€ä¸ªä¸€ä¸ªæ‰¾åˆ†é‡ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥æŒ‰ç…§æ•´ä½“å¤„ç†ã€‚ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸï¼Œ64ä½æ•°æ®éƒ½ä¼šä¸€æ¬¡æ€§ä¼ è¾“å®Œæˆï¼Œæ‰€ä»¥è¯´è™½ç„¶æµªè´¹äº†ä¸€äº›ç©ºé—´ï¼Œä½†æ¢æ¥äº†æé«˜æ•ˆç‡ã€‚\n\n1. æ¯ä¸€ä¸ªå…ƒç´ çš„åç§»é‡ï¼ˆç›¸å¯¹0ï¼‰ï¼Œéƒ½æ˜¯è‡ªèº«ç±»å‹å¤§å°çš„æ•´æ•°å€ï¼ˆ0ä¹Ÿç®—ï¼‰ã€‚\n2. ç»“æ„ä½“çš„æ•´ä½“å¤§å°ï¼Œæ˜¯å†…éƒ¨æœ€å¤§çš„åŸºç¡€æ•°æ®ç±»å‹å¤§å°çš„æ•´æ•°å€ã€‚\n3. æˆ‘ä»¬æ§åˆ¶ä¸äº†çš„ï¼š**ç»“æ„ä½“çš„é¦–åœ°å€ï¼Œæ˜¯ä½“å†…æœ€å¤§åŸºæœ¬æ•°æ®ç±»å‹å¤§å°çš„æ•´æ•°å€ã€‚**\n\n```c\nstruct Test\n{\n    int a;          // 4\n    char b;         // 1  --> å®é™…: 2\n    short c;        // 2\n};//8\nstruct Test\n{\n    int a;          // 4\n    char b;         // 1  --> å®é™…: 2\n    short c;        // 2\n    char d;         // 1  --> å®é™…: 4\n};//12\nstruct Test\n{\n    int a;          // 4\n    char b;         // 1\n    char d;         // 1\n    short c;        // 2\n    short e[10];    // 10 --> 12\n};//20\n```\n\n> æœ‰åŠæ³•å…³é—­å­—èŠ‚å¯¹é½ç‰¹æ€§ï¼š`#pragma comment package 1`\n\n# typedef\n\n```c\ntypedef struct _Stu\n{\n    unsigned id;\n    unsigned char age;\n    char name[11];\n}Stu;\n```\n\n## ç»“æ„ä½“æŒ‡é’ˆç±»å‹\n\n```c\ntypedef struct _Stu\n{\n    unsigned id;\n    unsigned char age;\n    char name[11];\n}*PStu;\n```\n\nå¦‚æ­¤å®šä¹‰ï¼Œåˆ™æ•ˆæœä¸ºï¼š`PStu`ç›¸å½“äº`Stu*`\n\n`Stu* stu = (Stu*)malloc(sizeof(Stu));`å°±å¯ä»¥å†™ä¸º\n\n`PStu stu = (PStu)malloc(sizeof(Stu));`\n\n## æ˜Ÿå·çš„ç»“åˆé—®é¢˜\n\n```c\ntypedef int * PMyInt;\n```\n\nå¦‚æ­¤å®šä¹‰ï¼Œ`PMyInt`ç›¸å½“äº`int*`ï¼Œå³æ˜¯ä¸€ä¸ªintæŒ‡é’ˆç±»å‹ã€‚ä½†æ˜¯ï¼Œå®é™…ä¸Šï¼Œ`*`æ˜Ÿå·æ˜¯è·Ÿç€åå­—`PMyInt`ç»“åˆçš„ã€‚`int*`è¿™ç§å†™æ³•åªæ˜¯å¤§å¤šæ•°äººçš„ä¹ æƒ¯è€Œå·²ã€‚\n\nå› æ­¤ï¼Œ`typedef int MyInt, *PMyInt;`æ‰è§£é‡Šå¾—é€šã€‚å¦‚æœ`typedef int * MyInt, PMyInt`ï¼Œåˆ™å°±å˜æˆäº†`MyInt`æ˜¯æŒ‡é’ˆç±»å‹ï¼Œè€Œ`PMyInt`å˜æˆäº†intç±»å‹ï¼\n\n# å †åˆ›å»ºç»“æ„ä½“\n\n## stdlib\n\nC Standard General Utilities Library\n\n### malloc\n\nåˆ†é…æŒ‡å®šå­—èŠ‚æ•°çš„å†…å­˜å—ï¼Œè¿”å›ä¸€ä¸ªæ— ç±»å‹æŒ‡é’ˆï¼Œéœ€è¦å¼ºåˆ¶è½¬æ¢ç±»å‹ã€‚æ­¤ç©ºé—´çš„ä¼¸ç¼©ä¸å—é™åˆ¶ï¼Œå› æ­¤éœ€è¦æ˜¾å¼åˆ†é…ã€é‡Šæ”¾ã€‚\n\nåœ¨å°å‹è®¾å¤‡ä¸Šå¦‚æœå†…å­˜ä¸å¤Ÿï¼Œåˆ™æœ‰å¯èƒ½ä¼šè¿”å›NULLã€‚\n\n```c\n#include<stdlib.h>\nint main()\n{\n    Stu* stu = (Stu*)malloc(sizeof(Stu));\n}\n```\n\n### free\n\n```c\n#include<stdlib.h>\nint main()\n{\n    Stu* stu = (Stu*)malloc(sizeof(Stu));\n    free(stu);\n    stu = NULL;\n}\n```\n\nä¸ºä»€ä¹ˆè¦ç½®ç©ºï¼Ÿä¸æˆæ–‡çš„è§„å®šï¼šæŒ‡é’ˆæ˜¯å¦æœ‰æ•ˆï¼Ÿç”±æŒ‡é’ˆæ˜¯å¦ä¸ºç©ºå†³å®šã€‚å¦‚æœæŒ‡é’ˆä¸ç©ºåˆ™è®¤ä¸ºæ˜¯æŒ‡å‘çš„å†…å®¹æœ‰æ•ˆã€‚\n\nå¦‚æœä¸ç½®ç©ºï¼Œå³åœ¨é‡Šæ”¾æŒ‡å‘çš„å†…å®¹åä¾æ—§ä¿ç•™æ­¤æŒ‡é’ˆï¼Œå°±æˆä¸ºäº†æ— æ„ä¹‰çš„ä¹±æŒ‡ã€‚ç§°ä¸ºâ€œé‡æŒ‡é’ˆâ€æˆ–â€œè¿·é€”æŒ‡é’ˆâ€ã€‚\n\n> å¦‚æœåè¿‡æ¥ï¼šç©ºé—´å†…å®¹æœ‰æ•ˆï¼Œä½†æŒ‡é’ˆå€¼ä¸¢å¤±ï¼Œåˆ™å«åšå†…å­˜æ³„æ¼ã€‚\n>\n> æ€ä¹ˆè§£å†³ï¼Ÿ\n>\n> 1. å°å¿ƒç¼–ç¨‹\n> 2. å…³é—­è¿›ç¨‹ï¼Œè®©æ“ä½œç³»ç»Ÿæ”¶å›æ‰€æœ‰å†…å­˜\n\n## ç»“æ„ä½“æŒ‡é’ˆè®¿é—®æˆå‘˜\n\n1. `(*stu).age` - `*`ä¼˜å…ˆçº§æ˜¯2ï¼Œ`.`ä¼˜å…ˆçº§æ˜¯1\n2. `stu->age` - `arrow`è¿ç®—ç¬¦ã€‚\n\n# åˆ†æ®µ\n\nç»“æ„ä½“ä¸ä»…å¯ä»¥æŠŠå°ç±»å‹ç»„åˆæˆå¤§ç±»å‹ï¼Œè¿˜èƒ½æŠŠåŸºæœ¬æ•°æ®ç±»å‹æ‹†æˆå°å—ã€‚\n\nä½¿ç”¨â€œä½åŸŸâ€è¿ç®—ç¬¦ï¼ˆbit field operatorï¼‰ã€‚\n\n```c\nstruct Test\n{\n    int a : 2;\n};\nint main()\n{\n    struct Test test;\n    test.a = 1;\n    printf(\"%i\\n\", test.a);\n}// 1\n```\n\nç»™`test.a`èµ‹å€¼1æ˜¯å¯ä»¥çš„ã€‚ä½†ç»™`test.a`èµ‹å€¼2åˆ™ä¼šæ‰“å°æˆ`-2`\n\n```c\nint main()\n{\n    struct Test test;\n    test.a = 2;\n    printf(\"%i\\n\", test.a);\n}// -2\n```\n\nå› ä¸ºï¼šaæ˜¯æœ‰ç¬¦å·intå‹ï¼Œä½†åªæœ‰2ä½çš„ç©ºé—´ã€‚é™¤å»ç¬¦å·ä½ï¼Œåˆ™åªæœ‰1ä½ç©ºé—´ã€‚é‚£ä¹ˆï¼ŒæŠŠ2è¿™ä¸ªintå­—é¢å¸¸é‡ç»™äº†aï¼Œå°±ç›¸å½“äºï¼š`(10)2`ç»™äº†aã€‚é‚£ä¹ˆï¼Œaå®é™…ç©ºé—´å­˜çš„æ˜¯(10)2ï¼Œå› ä¸ºå®ƒæ˜¯æœ‰ç¬¦å·intï¼Œè€Œåˆå› ä¸ºå½“å‰ç¬¦å·ä½æ˜¯1ï¼Œæ‰€ä»¥å®é™…è¡¨è¾¾çš„å€¼ä¸ºï¼š`(10)2`çš„è¡¥ç ï¼Œç®—å‡ºæ— ç¬¦å·å€¼åï¼Œå†åŠ ä¸ªè´Ÿå·ï¼Œå³$(01)_2+1=(10)_2$â€‹å¾—å‡º2ï¼Œå†åŠ ä¸ªè´Ÿå·ï¼Œå³`-2`ã€‚\n\næ­¤æ—¶çš„sizeofå¤§å°ä¸ºå¤šå°‘å‘¢ï¼Ÿ\n\n```c\nstruct Test\n{\n    int a : 2;\n};// 4  -->  æ•´ä¸ªintçš„å¤§å°\n```\n\n```c\n//aã€bä¸€èµ·åˆ†äº†12ä¸ªå­—èŠ‚ï¼Œè¿˜æœ‰20ä¸ªæ²¡åˆ†é…ã€‚å› æ­¤è¿˜æ˜¯1ä¸ªintçš„å¤§å°\nstruct Test\n{\n    int a : 2;\n    int b : 10;\n};// 4  -->  1ä¸ªintçš„å¤§å°\n```\n\n## åˆ†éš”ç¬¦\n\n```c\n//aå…ˆåˆ†äº†2ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯aå‰©ä¸‹çš„ç©ºé—´ä¸æƒ³å†ç”¨ï¼ŒåŠ ä¸ªseparatoråˆ†éš”ç¬¦ã€‚\n//åœ¨åˆ†éš”ç¬¦åå®šä¹‰bã€‚æ­¤æ—¶æ˜¯ç¬¬2ä¸ªintç©ºé—´ã€‚\nstruct Test\n{\n    int a : 2;\n    int : 0;     // separator  //æ— å\n    int b : 10;\n};// 8  -->  2ä¸ªintçš„å¤§å°\n```\n\nä¸‹é¢è¿™ä¸ªåˆ†éš”ç¬¦çš„æ„ä¹‰åœ¨äºï¼Œè™½ç„¶å®é™…æœ‰æ•ˆçš„æ˜¯intç±»å‹ï¼Œä½†æ˜¯long longåˆ†éš”ç¬¦çš„ä½œç”¨åœ¨äºåœ¨ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªintä¹‹é—´åˆ’åˆ†äº†8å­—èŠ‚çš„ä½ç½®ï¼Œå³aå®é™…è¢«æå‡ä¸º8å­—èŠ‚å¤§å°ï¼Œbä¹Ÿè¢«æå‡ä¸º8å­—èŠ‚å¤§å°ã€‚\n\n```c\n//aå…ˆåˆ†äº†2ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯aå‰©ä¸‹çš„ç©ºé—´ä¸æƒ³å†ç”¨ï¼ŒåŠ ä¸ªseparatoråˆ†éš”ç¬¦ã€‚\n//åœ¨åˆ†éš”ç¬¦åå®šä¹‰bã€‚æ­¤æ—¶æ˜¯ç¬¬2ä¸ªintç©ºé—´ã€‚\nstruct Test\n{\n    int a : 2;\n    long long : 0;     // separator  //æ— å\n    int b : 10;\n};// 16  -->  2ä¸ªlong longçš„å¤§å°\n```\n\n## å®é™…ç”¨å¤„\n\n1. å¦‚æœå°äº8 bitsï¼Œåˆ™ç”¨ä½åŸŸè¿ç®—ç¬¦ã€‚å¦‚æœæ˜¯8 bitsï¼Œåˆ™ç›´æ¥ç”¨charã€‚\n2. separatorä¸€èˆ¬ä¸ç”¨ï¼Œç›´æ¥å æ»¡ä¸Šé¢çš„ç©ºä½å³å¯ï¼Œç„¶åç´§æ¥ç€å®šä¹‰ä¸‹ä¸€ä¸ªç±»å‹ã€‚\n","categories":["C"]},{"title":"Cè¯­è¨€_å‡½æ•°_æ ˆå¸§_å‚æ•°_é€’å½’","url":"/C/Cè¯­è¨€_å‡½æ•°_æ ˆå¸§_å‚æ•°_é€’å½’/","content":"# å‡½æ•°\n\n1. æ¯ä¸ªç¼–ç¨‹è¯­è¨€éƒ½æœ‰å‡½æ•°ã€‚\n2. å‡½æ•°æ˜¯ä»£ç çš„æ¨¡å—/å®¹å™¨/è½½ä½“ï¼Œä»£ç å¦‚æœè¦æ‰§è¡Œï¼Œå¿…é¡»åœ¨å‡½æ•°å†…æ‰èƒ½æ‰§è¡Œã€‚\n\n# å†…å­˜ç»“æ„ã€åœ°å€ç©ºé—´\n\n1. å¯¹äºå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆWindowsä¸‹æ˜¯exeæ–‡ä»¶ï¼›Linuxä¸‹æ˜¯outæ–‡ä»¶ï¼‰ï¼Œå¯æ‰§è¡Œæ–‡ä»¶æœ‰å›ºå®šæ ¼å¼ï¼Œä»ç£ç›˜ä¸­åŠ è½½åˆ°å†…å­˜åï¼Œæ–‡ä»¶ä¸­ç›¸åº”éƒ¨åˆ†çš„ä»£ç ã€æ•°æ®ç­‰ä¼šæ˜ å°„åˆ°å†…å­˜çš„äº”ä¸ªä¸åŒçš„æ¨¡å—ä¸­ã€‚\n2. æ¯ä¸ªç¨‹åºéƒ½è®¤ä¸ºè‡ªå·±ç‹¬å äº†æ•´ä¸ªçš„åœ°å€ç©ºé—´ã€‚å¦‚æœæ˜¯32ä½ç³»ç»Ÿï¼Œåˆ™ç¨‹åºè®¤ä¸ºç‹¬å äº†32ä½çš„å†…å­˜ç©ºé—´ï¼ˆ0åˆ°4Gï¼‰ã€‚è¿™å°±æ˜¯è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œè‡ªä»386å°±å¼€å§‹æœ‰è¿™ä¸ªæ¦‚å¿µï¼Œä¾¿äºå¤šè·¯ç¨‹è¿è¡Œã€‚\n\n# æ ˆå¸§\n\n1. må’Œnæ˜¯actual parameters.ï¼ˆå®å‚ï¼‰\n2. aå’Œbæ˜¯formal parameters.ï¼ˆå½¢å‚ï¼‰\n3. æ‰€æœ‰çš„å‚æ•°éƒ½æ˜¯æŒ‰å€¼ä¼ é€’çš„ã€‚\n\n```c\n#include<stdio.h>\nvoid bar(int a, int b);\n\nint main()\n{\n    int m = 5, n = 6;\n    bar(m, n);\n    return 0;\n}\nvoid bar(int a, int b)\n{\n    int c = a + b;\n    printf(\"%i\\n\", c);\n}\n```\n\nåäº†ï¼Ÿ\n\n![image-20240316220318599](../../images/Cè¯­è¨€_20240115_å‡½æ•°/image-20240316220318599.png)\n\næ ˆæ˜¯ä»é«˜åœ°å€å‘ä½åœ°å€æ‰©å±•çš„ã€‚è¶Šåå®šä¹‰çš„å˜é‡åœ°å€è¶Šä½ã€‚\n\n`int m = 5, n = 6;`è¿™æ¡è¯­å¥ï¼šå…ˆå®šä¹‰nï¼Œå†å®šä¹‰mï¼Œå› æ­¤nåœ¨é«˜åœ°å€ã€måœ¨ä½åœ°å€ã€‚\n\n# printfçš„å‚æ•°\n\nvariable parameters\n\n```c\nint printf(char const * const _Format, ...);\n```\n\nå¯ç¤ºï¼šå¯¹å¤–å¼€æ”¾çš„å‡½æ•°ï¼Œå¦‚æœè¦é˜²æ­¢è¯¯æ”¹å†…å®¹ï¼Œåˆ™åŠ constè¡¨æ˜åªè¯»ï¼Œå¦åˆ™åˆ«äººä¸æ•¢ä¼ å‚æ•°ã€‚\n\n## constæ˜¯ä»€ä¹ˆ\n\nconstæœ‰ä¸‰ä¸ªä½ç½®å¯ä»¥æ”¾ã€‚\n\nçœ‹è¡¨è¾¾å¼ï¼š\n1. æ— è®ºå³ä¾§æ˜¯ä»€ä¹ˆï¼Œå·¦ä¾§æ˜¯intï¼Œåˆ™å³ä¾§ä¹Ÿæ˜¯ä¸€ä¸ªint\n   1. å·¦ä¾§ä¸€ä¸ªintï¼Œå³ä¾§ä¸€ä¸ªaã€‚\n\n```c\nint a;\n```\n\n   2. å·¦ä¾§ä¸€ä¸ªintï¼Œå³ä¾§æ˜¯`*a`ã€‚`*a`æ˜¯ä¸€ä¸ªintï¼šè¡¨ç¤ºaè¿™ä¸ªå˜é‡è§£å¼•ç”¨ä¹‹ååˆ™æ˜¯ä¸€ä¸ªintï¼Œåˆ™aæ˜¯ä¸€ä¸ªæŒ‡å‘intçš„æŒ‡é’ˆã€‚\n```c\nint *a;\n```\n\n2. constæ˜¯ä¿®é¥°å³ä¾§ä¸œè¥¿çš„ã€‚\n   1. å¦‚æœåœ¨`int`åå†™constï¼š`*a`æ˜¯ä¸€ä¸ªä¸èƒ½ä¿®æ”¹çš„intå€¼ã€‚åŒç†constå†™åˆ°intå‰é¢ä¹Ÿä¸€æ ·ï¼š`const int * a;`ã€‚\n\n```c\nint const * a;\n```\n\n   2. å¦‚æœåœ¨`*`åå†™constï¼šaæ˜¯ä¸€ä¸ªä¸èƒ½ä¿®æ”¹çš„å€¼ã€‚`*a`æ˜¯ä¸€ä¸ªèƒ½ä¿®æ”¹çš„intå€¼ï¼Œaè¿™ä¸ªå˜é‡è§£å¼•ç”¨ä¹‹ååˆ™æ˜¯ä¸€ä¸ªintï¼Œåˆ™aæ˜¯ä¸€ä¸ªæŒ‡å‘intçš„æŒ‡é’ˆï¼Œä½†aæ˜¯ä¸€ä¸ªä¸èƒ½ä¿®æ”¹çš„å€¼ã€‚\n\n### åç¼€ä¸º`.c`æµ‹è¯•\n\n```c\nint main()\n{\n    char * p = \"xxx\"; //å¯ä»¥ç¼–è¯‘é€šè¿‡\n    p[1] = 'M';       //å¯ä»¥ç¼–è¯‘é€šè¿‡\n}\n```\n\nä½†åœ¨è¿è¡Œé˜¶æ®µï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼šwrite access violation\n\nä¸è¦ä¼å›¾æ”¹å˜å¸¸é‡åŒºã€‚\n\n### åç¼€ä¸º`.cpp`æµ‹è¯•\n\n```c\nint main()\n{\n    char str[] = \"Hello\";\n    char * p = str;\n    p[2] = 'x';\n}// æ˜¯å¯ä»¥é€šè¿‡pé—´æ¥ä¿®æ”¹str[]ä¸­çš„å€¼çš„ã€‚\n//æœ€åstr[]å˜ä¸º\"Hexlo\"\n```\n\n```c\nint main()\n{\n    char str[] = \"Hello\";\n    char * p = str; \n    p = \"xxx\";// error      //char * pè™½ç„¶å¯ä»¥æ”¹å˜æŒ‡é’ˆå€¼ï¼Œä½†æ˜¯ä¸èƒ½æŒ‡å‘å¸¸é‡å­—ç¬¦ä¸²\n}\n```\n\n```c\nint main()\n{\n    char str[] = \"Hello\";\n    const char * p = str; \n    p = \"aaa\";      //char * pæ—¢å¯ä»¥æ”¹å˜æŒ‡é’ˆå€¼ï¼Œä¹Ÿå¯ä»¥æŒ‡å‘å¸¸é‡å­—ç¬¦ä¸²\n    p[2] = 'x';     //error è™½ç„¶på¯ä»¥æŒ‡å‘å¸¸é‡å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä¸èƒ½é—´æ¥ä¿®æ”¹å€¼\n}\n```\n\n```c\nint main()\n{\n    char str[] = \"Hello\";\n    const char * const p = str; \n    p = \"aaa\";//error  //char * pä¸å¯ä»¥æ”¹å˜æŒ‡é’ˆå€¼ï¼Œä¹Ÿä¸èƒ½é€šè¿‡pé—´æ¥ä¿®æ”¹å€¼\n    p[2] = 'x';//error\n}\n```\n\n## å¯å˜å‚æ•°\n\næ¬²ç”¨showæ‰“å°å¯å˜å‚æ•°ä¸­ç¬¬nä¸ªå€¼ï¼š\n\néœ€è¦å–å‡½æ•°æ ˆå¸§ä¸­nå˜é‡çš„åœ°å€ï¼Œç„¶åå‘ä¸Šå¯»æ‰¾nä¸ªintå¤§å°ï¼ˆå› ä¸ºå‚æ•°æ˜¯ä»é«˜åœ°å€åˆ°ä½åœ°å€æ‰©å±•çš„ï¼‰ï¼Œå³å¾—åˆ°å¯å˜å‚æ•°ä¸­ç¬¬nä¸ªå‚æ•°çš„åœ°å€ã€‚\n\næ ˆå¸§ç¤ºæ„å›¾ï¼š\n\n![image-20240316231327944](../../images/Cè¯­è¨€_20240115_å‡½æ•°/image-20240316231327944.png)\n\n```c\nvoid show(int n, ...);\nint main()\n{\n    show(2, 10, 20, 30, 40, 50);  // æ¬²æ‰“å°ç¬¬2ä¸ªå€¼ï¼Œ20\n}\nvoid show(int n, ...)\n{\n    // æŒ‡é’ˆè¿›è¡Œæ•´æ•°åŠ è¿ç®—ã€‚\n    printf(\"%i\\n\", *(&n + n));\n}\n//64ä½ä¸‹ï¼šæ‰“å°10\n//32ä½ä¸‹ï¼šæ­£ç¡®ï¼Œæ‰“å°20\n```\n\nå¥‡æ€ªçš„æ˜¯ï¼Œ64ä½ä¸‹ï¼šæ‰“å°10ï¼›32ä½ä¸‹ï¼šæ‰“å°20ã€‚å› ä¸ºï¼šintå›ºç„¶æ˜¯4å­—èŠ‚å¤§å°ï¼Œè€Œä¸”`int`çš„æŒ‡é’ˆåŠ å‡`1`çš„å¤§å°ä¹Ÿåº”è¯¥æ˜¯4å­—èŠ‚ï¼ˆ`p + n = pçš„å€¼ + sizeof(int)* n`ï¼‰ã€‚ä½†æ˜¯ï¼Œ**åœ¨64ä½ä¸‹çš„å­—é•¿æ˜¯8å­—èŠ‚çš„ï¼Œå› ä¸ºåœ°å€æ€»çº¿æ¯ä¸€æ¬¡è‡³å°‘ä¼šä¼ 64ä½ï¼ˆ8å­—èŠ‚ï¼‰çš„å†…å®¹ã€‚å› æ­¤ï¼Œæ¯ä¸ªintå®é™…å ç”¨äº†8ä¸ªå­—èŠ‚ã€‚**æ‰€ä»¥æˆ‘ä»¬`p+n`ä»…ä»…ç§»åŠ¨äº†8ä¸ªå­—èŠ‚ï¼Œåªèƒ½æ‰“åˆ°10ã€‚\n\nç»è¿‡è°ƒè¯•ï¼Œå¯ä»¥çœ‹åˆ°å®é™…çš„å†…å­˜å†…å®¹ï¼ˆ16è¿›åˆ¶ï¼‰ï¼š\n\n![image-20240316234542234](../../images/Cè¯­è¨€_20240115_å‡½æ•°/image-20240316234542234.png)\n\nå¯ä»¥çœ‹åˆ°ï¼Œ`02` `0a` `14` `1e` `28` `32`ä¾æ¬¡æ˜¯6ä¸ªintå‚æ•°ï¼Œå®é™…éƒ½å ç”¨äº†8ä¸ªå­—èŠ‚ã€‚å¤§ç«¯åœ°å€å­˜æ”¾é«˜å­—èŠ‚ã€‚åˆ™å¦‚æœè¦æ‰“å°å¯å˜å‚æ•°ä¸­çš„ç¬¬nä¸ªintï¼Œéœ€è¦`*(&n + 2 * n)`æˆ–è€…æŠŠ`&n`å¼ºåˆ¶è½¬æ¢ä¸º64ä½å¤§å°çš„`long long*`ï¼š`*((long long*)&n + n)`ã€‚\n\n```c\nvoid show(int n, ...);\nint main()\n{\n    show(2, 10, 20, 30, 40, 50);  // æ¬²æ‰“å°ç¬¬2ä¸ªå€¼ï¼Œ20\n}\nvoid show(int n, ...)\n{\n    // æŒ‡é’ˆè¿›è¡Œæ•´æ•°åŠ è¿ç®—ã€‚\n    printf(\"%i\\n\", *((long long*)&n + n));\n}\n//64ä½ä¸‹ï¼šæ­£ç¡®ï¼Œæ‰“å°20\n//32ä½ä¸‹ï¼šé”™è¯¯ï¼Œæ‰“å°286331153\n```\n\nä½†æ˜¯ï¼Œè¿™æ ·çš„è¯ï¼Œè™½ç„¶64ä½ä¸‹æ‰“å°æ­£ç¡®äº†ï¼Œä½†æ˜¯32ä½ä¸‹åˆé”™äº†ï¼å› ä¸ºç§»åŠ¨äº†nä¸ª8å­—èŠ‚ï¼Œæ‰“åˆ°äº†å‡½æ•°æ ˆå¸§ä¹‹å¤–ï¼æ‰€ä»¥ï¼Œå¿…é¡»æƒ³ä¸€ä¸ªèƒ½åˆ¤æ–­32ä½ã€64ä½çš„é€šç”¨æ–¹æ³•ï¼Œå»æ§åˆ¶intæŒ‡é’ˆçš„å¤§å°ï¼ˆå³64ä½ä¸‹8å­—èŠ‚ã€32ä½ä¸‹4å­—èŠ‚ï¼‰ã€‚\n\n`Ctrl + å·¦é”®`ç‚¹å…¥`size_t`ï¼Œä¼šå‡ºæ¥ä¸€äº›å®å®šä¹‰ï¼š\n\n```c\n#ifdef _WIN64\n    typedef unsigned __int64 size_t;\n    typedef __int64          ptrdiff_t;\n    typedef __int64 intptr_t;\n#else\n    typedef unsigned int     size_t;\n    typedef int              ptrdiff_t;\n    typedef int              intptr_t;\n```\n\nåœ¨ç¨‹åºä¸º64ä½ç¼–è¯‘æ—¶ï¼Œä¸Šé¢ä¸‰ä¸ªä¼šç”Ÿæ•ˆã€ä¸‹é¢ä¼šå¤±æ•ˆï¼›32ä½ç¼–è¯‘æ—¶åä¹‹ã€‚\n\né€šè¿‡è¿™ä¸ªï¼Œå¯ä»¥æ§åˆ¶intæŒ‡é’ˆçš„å¤§å°ã€‚\n\n```c\nvoid show(int n, ...);\nint main()\n{\n    show(2, 10, 20, 30, 40, 50);  // æ¬²æ‰“å°ç¬¬2ä¸ªå€¼ï¼Œ20\n}\nvoid show(int n, ...)\n{\n    // æŒ‡é’ˆè¿›è¡Œæ•´æ•°åŠ è¿ç®—ã€‚\n    printf(\"%i\\n\", *((intptr_t*)&n + n));\n}\n//64ä½ä¸‹ï¼šæ­£ç¡®ï¼Œæ‰“å°20\n//32ä½ä¸‹ï¼šæ­£ç¡®ï¼Œæ‰“å°20\n```\n\n# æ•°ç»„å’Œå‡½æ•°\n\n```c\n#include<stdio.h>\nvoid bar(int a[8]);\nint main()\n{\n    int arr[] = { 1, 2, 3, 4, 5, 6, 7, 8 };\n    bar(arr);\n    return 0;\n}\n// è™½ç„¶ä¼ çš„æ˜¯æ•°ç»„ç±»å‹ï¼Œä½†å®é™…é€€åŒ–ä¸ºæŒ‡é’ˆäº†\nvoid bar(int a[8])\n{\n    printf(\"%i\\n\", sizeof a);\n}\n// 64ä½ï¼š8\n// 32ä½ï¼š4\n```\n\nè™½ç„¶å½¢å‚å†™çš„æ˜¯å¸¦å…ƒç´ ä¸ªæ•°çš„æ•°ç»„ç±»å‹ï¼Œä½†æ˜¯å› ä¸ºå®é™…é€€åŒ–ä¸ºæŒ‡é’ˆäº†ï¼Œæ‰€ä»¥å†™ä¸å†™å…·ä½“æ•°ç›®æ— æ‰€è°“ï¼š`int a[]`ï¼Œç”šè‡³ç›´æ¥å†™ä¸ª`int * a`ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚å¦‚æœè¦å‘ŠçŸ¥æ•°ç»„å…·ä½“ä¸ªæ•°ï¼Œéœ€è¦å¦ä¼ ä¸€ä¸ªintå‚æ•°nã€‚\n\n```c\n#include<stdio.h>\nvoid bar(int * a, int n);\nint main()\n{\n    int arr[] = { 1, 2, 3, 4, 5, 6, 7, 8 };\n    bar(arr, sizeof arr / sizeof arr[0]);\n    return 0;\n}\nvoid bar(int * a, int n)\n{\n    for(int i = 0; i < n; ++i)\n    {\n        printf(\"%i\\n\", a[i]);\n    }\n}// 1 2 3 4 5 6 7 8 \n```\n\n## äºŒç»´æ•°ç»„\n\nè¡Œä¿¡æ¯ä¸¢å¤±ï¼Œéœ€è¦ç”¨int nä»£æ›¿ï¼Œè€Œæˆ‘ä»¬è¦ä¿ç•™åˆ—ä¿¡æ¯ï¼Œæ‰èƒ½ä¿è¯äºŒç»´æ•°ç»„çš„æœ‰æ•ˆã€‚\n\nå³ä¼ ä¸€ä¸ªåŒ…å«4åˆ—å…ƒç´ çš„è¡ŒæŒ‡é’ˆã€‚\n\n```c\nvoid bar(int(*a)[4], int n);\nint main()\n{\n    int arr[2][4] = {{1, 2, 3, 4}, {5, 6, 7, 8}};\n    bar(arr, sizeof arr / sizeof arr[0]);\n    return 0;\n}\nvoid bar(int(*a)[4], int n)\n{\n    for(int i = 0; i < n; ++i, printf(\"\\n\");)\n    {\n        for(int j = 0; j < 4; ++j)\n        {\n            printf(\"%i\\n\", a[i][j]);\n        }\n    }\n}\n// 1 2 3 4\n// 5 6 7 8 \n```\n\n# mainå‚æ•°\n\n```c\nint main(int ac, char * av[])\n{\n    return 0;\n}\n```\n\nacæŒ‡argument countï¼›avæŒ‡argument valueã€‚\n\n```c\nint main(int ac, char * av[])\n{\n    for(int i = 0; i < ac; ++i)\n    {\n        printf(\"%s\\n\", av[i]);\n    }\n    return 0;\n}\n```\n\nç¼–è¯‘ç¨‹åºåï¼Œåœ¨ç”Ÿæˆç›®å½•ä¸‹å‘½ä»¤è¡Œï¼ˆcmdï¼‰æµ‹è¯•\n\n```sh\nC:\\Users\\xcg\\Project1.exe #è¾“å…¥çš„\n\nC:\\Users\\xcg\\Project1.exe #è¾“å‡ºçš„\n\nC:\\Users\\xcg\\Project1.exe -h -m #è¾“å…¥çš„\n\n#è¾“å‡ºçš„\nC:\\Users\\xcg\\Project1.exe\n-h\n-m\n\n```\n\n## å®è´¨ä¸Š\n\nå®è´¨ä¸Šï¼Œavçš„ç±»å‹è¢«é€€åŒ–ä¸ºäº†äºŒçº§æŒ‡é’ˆã€‚\n\n```c\nint main(int ac, char ** av)\n{\n    for(int i = 0; i < ac; ++i)\n    {\n        printf(\"%s\\n\", *(av + i));\n    }\n    return 0;\n}\n```\n\næ›´å®‰å…¨åœ°ï¼ŒåŠ constï¼Œè®©avæŒ‡å‘çš„å†…å®¹ã€avçš„è¡Œæ•°ç»„ã€avæœ¬èº«ä¸å¯å˜\n\n```c\nint main(int ac, char const * const * const av)\n{\n    for(int i = 0; i < ac; ++i)\n    {\n        printf(\"%s\\n\", *(av + i));\n    }\n    return 0;\n}\n```\n\n# é€’å½’\n\né€’å½’è¡¨ç°åœ¨ï¼šè¡Œä¸ºä¸€è‡´ï¼Œåªæ˜¯æ¯æ¬¡æ•°æ®ä¸ä¸€æ ·ã€‚\n\né€’å½’çš„ä¸¤å¤§è¦ç´ ï¼šé€’æ¨å…¬å¼ï¼ˆçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼‰ï¼›ç»ˆæ­¢æ¡ä»¶ã€‚\n\n> 1. ä¸‹é™çš„æ—¶å€™æ‰§è¡Œè¡Œä¸ºï¼Œå³è¡Œä¸ºåœ¨è°ƒç”¨é€’å½’ä¹‹å‰ï¼Œå«é¦–é€’å½’\n> 2. ä¸Šå‡çš„æ—¶å€™æ‰§è¡Œè¡Œä¸ºï¼Œå³è¡Œä¸ºåœ¨è°ƒç”¨é€’å½’ä¹‹åï¼Œå«å°¾é€’å½’\n> 3. å¦‚æœé€’å½’å‰åéƒ½æœ‰è¡Œä¸ºï¼Œå«ä¸­é—´é€’å½’\n\n```c\nvoid show(int n); // show(10) -> 10 9 8 ... 1\nint main()\n{\n    show(10);\n}\nvoid show(int n)\n{\n    if(n < 1) return;\n    printf(\"%i\\n\", n);\n    show(n - 1);\n}\n```\n\n```c\nvoid show(int n); // show(10) -> 1 2 3 ... 10\nint main()\n{\n    show(10);\n}\nvoid show(int n)\n{\n    if(n < 1) return;\n    show(n - 1);\n    printf(\"%i\\n\", n);\n}\n```\n\n## æ±‚åŠ å’Œ\n\n```c\nint sum(int n); // 1 + 2 + 3 + ... + 10\nint main()\n{\n    int r = sum(10);\n}\nint sum(int n)\n{\n    if(n == 1) return 1;\n    return n + sum(n - 1);\n}// r = 55\n```\n\n## Hanoi\n\næŠŠ`1 ~ n`çš„ç›˜å­é€šè¿‡Aã€Bã€Cä¸‰ä¸ªæŸ±å­æŒªåˆ°å…¨éƒ¨Cã€‚å°çš„åœ¨ä¸Šé¢ï¼Œå¤§çš„åœ¨ä¸‹é¢ã€‚\n\n```c\nvoid hanoi(int n, char from, char via, char to)\n{\n    if(n == 0) return;\n    hanoi(n - 1, from, to, via);\n    printf(\"%d: %c --> %c\\n\", n, from, to);\n    hanoi(n - 1, via, from, to);\n}\n```\n\næµ‹è¯•\n\n```c\nint main()\n{\n    hanoi(3, 'A', 'B', 'C');\n}\n```\n\n```\n1: A --> C\n2: A --> B\n1: C --> B\n3: A --> C\n1: B --> A\n2: B --> C\n1: A --> C\n```\n","categories":["C"]},{"title":"Cè¯­è¨€__æŒ‡é’ˆ_è¿›é˜¶_å¤šç»´æ•°ç»„","url":"/C/Cè¯­è¨€_æŒ‡é’ˆ_è¿›é˜¶_å¤šç»´æ•°ç»„/","content":"# æŒ‡é’ˆ\næŒ‡é’ˆæ˜¯ä¸€ç§ç‰¹æ®Šçš„å˜é‡ï¼Œå­˜çš„æ˜¯åˆ«çš„å˜é‡çš„å†…å­˜çš„åœ°å€ã€‚æä¾›äº†ä¸€ç§é—´æ¥è®¿é—®æ–¹æ³•ã€‚\n## æŒ‡é’ˆçš„ä¸¤å¤§è¦ç´ \næœ‰ä¸¤å¤§è¦ç´ ï¼š1ã€å­˜æ”¾çš„å†…å®¹ï¼šå˜é‡çš„èµ·å§‹åœ°å€ï¼›2ã€æŒ‡é’ˆçš„ç±»å‹ï¼šæŒ‡æ˜é•¿åº¦\n## å¼•ç”¨ï¼ˆtake referenceï¼‰ã€è§£å¼•ç”¨ï¼ˆdereferenceï¼‰\ntake reference è¡¨ç¤ºå–å˜é‡çš„åœ°å€ã€‚è¿™æ˜¯ä¸€ç§é—´æ¥å¼•ç”¨ã€‚\n>æ­¤å¤„çš„å¼•ç”¨æ˜¯Cè¯­è¨€ä¸­çš„ï¼Œè¦å’ŒCppä¸­çš„å¼•ç”¨åŒºåˆ†å¼€ã€‚\n\n```c\nint main()\n{\n    int a = 12;\n    // take reference - å¼•ç”¨ï¼Œå–åœ°å€\n    int * p = &a;\n    // derefernce - è§£å¼•ç”¨\n    printf(\"%i\\n\", *p);\n    return 0;\n}//12\n```\n\n## æŒ‡é’ˆçš„å¤§å°\n\næŒ‡é’ˆçš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œåªå’Œå†…å­˜åœ°å€ç›¸å…³ã€‚32ä½çš„ç³»ç»Ÿç”¨çš„æ˜¯32ä½çš„åœ°å€æ€»çº¿ï¼Œé‚£ä¹ˆæŒ‡é’ˆåˆ™æ˜¯32ä½å¤§å°ï¼›64ä½çš„ç³»ç»Ÿï¼Œé‚£ä¹ˆæŒ‡é’ˆåˆ™æ˜¯64ä½å¤§å°ï¼Œä½†æ˜¯å®é™…ä¸Šçš„ç¡¬ä»¶å¹¶ä¸æ˜¯64æ ¹åœ°å€æ€»çº¿ï¼Œè€Œæ˜¯48æ ¹ï¼Œå› ä¸ºç›®å‰åŸºæœ¬ç”¨ä¸åˆ°é‚£ä¹ˆå¤šã€‚\n\n```c\nint main()\n{\n    int a = 12;\n    // take reference - å–åœ°å€\n    int * p = &a;\n    printf(\"%i\\n\", sizeof p);\n    return 0;\n}\n//64ä½ï¼š8\n//32ä½ï¼š4\n```\n\n## äºŒçº§æŒ‡é’ˆ\n\n```c\nint main()\n{\n    int a = 12;\n    // take reference - å–åœ°å€\n    int * p = &a;\n    int * pp = &p;\n    // derefernce - è§£å¼•ç”¨\n    printf(\"%i\\n\", **pp);\n    return 0;\n}\n//12\n```\n\næœ‰`**`è¿™ç§è¿è§£å¼•ç”¨ï¼Œä½†æ˜¯æ²¡æœ‰`&&`è¿™ç§è¿å–åœ°å€ï¼å› ä¸ºç¬¬ä¸€æ¬¡å–å®Œåœ°å€ä¹‹åå¾—å‡ºçš„æ˜¯ä¸€ä¸ªå€¼ï¼ˆä¸´æ—¶å€¼ï¼‰ï¼Œä¸å…·åä¸”æ²¡æœ‰å›ºå®šçš„å†…å­˜åœ°å€ï¼Œå› æ­¤æ— æ³•è¿å–åœ°å€ã€‚\n\n> åœ¨Cppä¸­ï¼Œå³å€¼å¼•ç”¨æ˜¯å¯ä»¥å¯¹ä¸´æ—¶å˜é‡â€œå–åœ°å€â€çš„ï¼Œä½†ä¸æ˜¯è¿™ç§è¿å–åœ°å€çš„æ–¹å¼ã€‚\n\n## ä¸‡èƒ½æŒ‡é’ˆ`void *`ï¼ˆmaster/universal pointerï¼‰\nmaster/universal pointerã€‚åªä¿ç•™äº†æŒ‡é’ˆçš„é¦–åœ°å€ï¼Œåªåœ¨ä¸­é—´ä¼ è¾“åœ°å€æœ‰ç”¨ï¼Œæ— æ³•ç›´æ¥è§£å¼•ç”¨ã€‚è®°ä½œ`void *`ã€‚\n\nè¦è§£å¼•ç”¨ï¼Œå¿…é¡»ä»¥å¼ºåˆ¶ç±»å‹è½¬æ¢å‘ŠçŸ¥æŒ‡é’ˆçš„å…·ä½“çš„ç»“å°¾ä½ç½®åœ¨å“ªæ‰è¡Œã€‚\n\n```c\nint main()\n{\n    int a = 12;\n    void * p = &a;\n    printf(\"%i\\n\", *p);//error, æŠ¥é”™ï¼šincomplete type is not allowed\n    printf(\"%i\\n\", *(int*)p);\n}\n```\n\n## æ¡ˆä¾‹\nå®šä¹‰ä¸€ä¸ªæ•´å‹æ•°\n```cpp\nint a;\n```\nå®šä¹‰ä¸€ä¸ªæŒ‡å‘æ•´å‹æ•°çš„æŒ‡é’ˆ\n```cpp\nint * a;\n```\nå®šä¹‰ä¸€ä¸ªæŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘çš„æŒ‡é’ˆæ˜¯ä¸€ä¸ªæŒ‡å‘æ•´å‹æ•°æŒ‡é’ˆ\n```cpp\nint ** a;\n```\nå®šä¹‰ä¸€ä¸ªæœ‰10ä¸ªæ•´å‹æ•°çš„æ•°ç»„\n```cpp\nint a[10];\n```\n### æŒ‡é’ˆæ•°ç»„\nå®šä¹‰ä¸€ä¸ªæœ‰10ä¸ªæŒ‡é’ˆçš„æ•°ç»„ï¼Œè¯¥æŒ‡é’ˆæ˜¯ä¸€ä¸ªæŒ‡å‘æ•´å‹æ•°çš„æŒ‡é’ˆ\n\næ­¤æ—¶éœ€è¦è€ƒè™‘`*`å’Œ`[]`çš„ä¼˜å…ˆçº§å…³ç³»ï¼Œè°ä¸aå…ˆç»“åˆï¼Ÿ\n`[]`æ˜¯æœ€é«˜ä¼˜å…ˆçº§ï¼Œ`*`æ¬¡ä¹‹ã€‚å¦‚é¢˜æ„ï¼Œæˆ‘ä»¬è¦å®šä¹‰aä¸ºæ•°ç»„ï¼Œæ‰€ä»¥ä¸ç”¨ç»™`*`åŠ `()`ã€‚\n```cpp\nint* a[10];\n```\n### æ•°ç»„æŒ‡é’ˆ\nå®šä¹‰ä¸€ä¸ªæŒ‡å‘æœ‰10ä¸ªæ•´å‹æ•°æ•°ç»„çš„æŒ‡é’ˆ\n\nå¦‚é¢˜æ„ï¼Œæˆ‘ä»¬è¦å®šä¹‰aä¸ºæŒ‡é’ˆï¼Œæ‰€ä»¥éœ€è¦ç»™`*`åŠ `()`ã€‚\nä½†æ˜¯å¦‚ä¸‹å†™æ˜¯é”™è¯¯çš„ï¼š\n```cpp\nint (*) a[10];\n```\nè¿™æ‰æ˜¯æ­£ç¡®çš„ï¼Œéœ€è¦è®©`*`å’ŒaåŒ…åœ¨ä¸€èµ·ã€‚\n```cpp\nint (*a) [10];\n```\n### å‡½æ•°æŒ‡é’ˆ\nå®šä¹‰ä¸€ä¸ªæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆï¼Œè¯¥å‡½æ•°æœ‰ä¸€ä¸ªæ•´å‹å‚æ•°å¹¶è¿”å›æ•´å‹æ•°\n\naæ˜¯ä¸ªæŒ‡é’ˆï¼Œè€Œaå³è¾¹åˆéœ€è¦å°æ‹¬å·è¡¨ç¤ºå‡½æ•°çš„å‚æ•°ç±»å‹ï¼Œæ‰€ä»¥éœ€è¦è®©`*a`åŠ æ‹¬å·ã€‚å†åœ¨æœ€å·¦è¾¹æ ‡å¿—å‡½æ•°çš„è¿”å›ç±»å‹ã€‚\n```cpp\nint (*a)(int);\n```\n#### å‡½æ•°åçš„éšå¼è½¬æ¢ï¼ŒCppä¸­åˆ°åº•è¦ä¸è¦åŠ `&`\nåœ¨Cè¯­è¨€ä¸­ï¼Œå‡½æ•°åbarå’Œ`&å‡½æ•°åbar`çš„æ•ˆæœä¸€æ ·ï¼Œéƒ½æ˜¯å–å‡½æ•°åœ°å€ã€‚\n>å‡½æ•°åä¼šè¢«éšå¼è½¬æ¢ä¸ºå‡½æ•°æŒ‡é’ˆï¼Œå› æ­¤`pfun = bar`å’Œ`pfun = &bar`ç­‰ä»·ã€‚\n\nåœ¨Cppä¸­ï¼Œå¯¹äºæ™®é€šå‡½æ•°ï¼Œéšå¼è½¬æ¢åŒæ ·é€‚ç”¨ï¼Œä½†å¯¹äºç±»æˆå‘˜å‡½æ•°åˆ™ä¸æ˜¯äº†ï¼Œå¦‚æœè¦å–æˆå‘˜å‡½æ•°åœ°å€ï¼Œå¿…é¡»æ˜¾å¼åŠ `&`ï¼Œå³`&ç±»å::å‡½æ•°`ã€‚ä¸”è°ƒç”¨æ—¶å¿…é¡»ç”¨`(obj.*p)()`çš„å½¢å¼ï¼Œæ¥è¡¨ç¤ºå“ªä¸€ä¸ªå¯¹è±¡å®ä¾‹çš„è°ƒç”¨ã€‚\n```cpp\nclass MyClass {\npublic:\n    void func() {}\n};\nint main() {\n    void (MyClass::*p)() = &MyClass::func;\n    MyClass obj;\n    (obj.*p)(); // æˆå‘˜å‡½æ•°æŒ‡é’ˆè°ƒç”¨\n    //p();      // éæ³•!!!\n}\n```\nå¦‚æœæ˜¯é™æ€æˆå‘˜å‡½æ•°ï¼Œå–åœ°å€æ—¶å¯ä»¥çœç•¥Â `&`ã€‚ç›¸åº”åœ°ï¼Œé€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨æ—¶ï¼Œå¯ä»¥ç›´æ¥åŠ å°æ‹¬å·ï¼Œä¸ç”¨è§£å¼•ç”¨ã€‚\n\n>ä¸ºä»€ä¹ˆæ™®é€šæˆå‘˜å‡½æ•°ï¼ˆä¸åŒ…æ‹¬é™æ€æˆå‘˜å‡½æ•°ï¼‰å–åœ°å€æ—¶å¿…é¡»æ˜¾å¼ä½¿ç”¨Â `&`ï¼Ÿ\n>\n>å½“æˆ‘ä»¬å–ä¸€ä¸ªæˆå‘˜å‡½æ•°çš„åœ°å€æ—¶ï¼Œæˆ‘ä»¬è·å–åˆ°çš„æ˜¯ä¸€ä¸ªâ€œæˆå‘˜å‡½æ•°æŒ‡é’ˆâ€ï¼Œè¿™ä¸ªæŒ‡é’ˆå¹¶ä¸æŒ‡å‘ä¸€ä¸ªæ™®é€šçš„å‡½æ•°åœ°å€ï¼Œè€Œæ˜¯æŒ‡å‘ä¸€ä¸ªå¸¦æœ‰é¢å¤– `this` æŒ‡é’ˆçš„ç‰¹æ®Šå‡½æ•°ã€‚ç”±äºæˆå‘˜å‡½æ•°å¹¶ä¸æ˜¯æ™®é€šçš„å…¨å±€å‡½æ•°æˆ–é™æ€å‡½æ•°ï¼Œç¼–è¯‘å™¨éœ€è¦æ˜ç¡®çŸ¥é“ä½ æƒ³è¦çš„æ˜¯ä¸€ä¸ªå¸¦ `this` æŒ‡é’ˆçš„æˆå‘˜å‡½æ•°åœ°å€ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„å‡½æ•°æŒ‡é’ˆã€‚\n#### ä¸¤ç§ç­‰æ•ˆçš„è°ƒç”¨å½¢å¼ï¼ˆCã€Cppå‡å¯ï¼‰\n1. **ç›´æ¥è°ƒç”¨**ï¼š`pfun();`\n2. **è§£å¼•ç”¨åè°ƒç”¨**ï¼š`(*pfun)();`\n\n```c\npfun();      // ç›´æ¥è°ƒç”¨\n(*pfun)();   // è§£å¼•ç”¨åè°ƒç”¨\n```\n\n```cpp\n#include<stdio.h>\nvoid bar(void);\nint main()\n{\n    void (*pfun)(void) = &bar; // Cè¯­è¨€ä¸­ä¹Ÿå¯ä»¥ç”¨ = bar\n    bar();\n    (*pfun)();\n    return 0;\n}\nvoid bar(void)\n{\n    printf(\"Hello\\n\");\n}\n```\nCè¯­è¨€å’ŒCppä¸­ï¼Œéƒ½å¯ä»¥ç›´æ¥æ‹¿å‡½æ•°æŒ‡é’ˆåå­—æ¥è°ƒç”¨å®ƒæŒ‡å‘çš„å‡½æ•°ã€‚å³**æ²¡å¿…è¦è§£å¼•ç”¨å†è°ƒç”¨**ã€‚\nå› ä¸ºæœ¬è´¨ä¸Šå‡½æ•°è°ƒç”¨å°±æ˜¯åœ¨åœ°å€ååŠ `()`ï¼Œå³ä½¿æ˜¯é—´æ¥åœ°å€ï¼Œä¹Ÿç”Ÿæ•ˆã€‚\n```cpp\n#include<stdio.h>\nvoid bar(void);\nint main()\n{\n    void (*pfun)(void) = &bar; // Cè¯­è¨€ä¸­ä¹Ÿå¯ä»¥ç”¨ = bar\n    bar();\n    (*pfun)();\n    pfun(); // ç­‰åŒäº(*pfun)(); ç­‰åŒäºbar();\n    return 0;\n}\nvoid bar(void)\n{\n    printf(\"Hello\\n\");\n}\n```\n#### Cå’ŒCppå¯¹äºå‡½æ•°æŒ‡é’ˆçš„æ³¨æ„äº‹é¡¹\nå¯¹äºæ™®é€šå…¨å±€å‡½æ•°ï¼Œå‡½æ•°åéƒ½ä¼šè¢«éšå¼è½¬æ¢ä¸ºå‡½æ•°æŒ‡é’ˆï¼Œå› æ­¤`pfun = bar`å’Œ`pfun = &bar`ç­‰ä»·ã€‚\n```cpp\nvoid (*pfun)(void) = bar;  // Cå’ŒC++å‡å¯\nvoid (*pfun)(void) = &bar; // æ›´æ˜¾å¼çš„å†™æ³•\n```\nä»¥ä¸Šæ˜¯å‡½æ•°ç­¾åå®Œå…¨ä¸€è‡´çš„ã€‚Cè¯­è¨€ã€Cppéƒ½å…è®¸ä¸”æ­£ç¡®ã€‚\nä½†ï¼Œå¦‚æœæƒ³è¦æŠŠå¦å¤–ä¸€ä¸ªä¸åŒç­¾åçš„å‡½æ•°èµ‹ç»™pfunï¼Œåˆ™Cä¼šè­¦å‘Šï¼ŒCppåˆ™ä¸å…è®¸ï¼š\nå¿…é¡»æŠŠfooå¼ºåˆ¶è½¬æ¢ä¸ºbarå‡½æ•°å¯¹åº”ç­¾å`(void(*)(void))`çš„å‡½æ•°æŒ‡é’ˆç±»å‹æ‰è¡Œã€‚\n```cpp\nvoid foo(int);\nvoid (*pfun)(void) = foo; // Cä¸­å…è®¸ï¼ˆæœ‰è­¦å‘Šï¼‰ï¼ŒC++æŠ¥é”™\nvoid (*pfun)(void) = (void(*)(void))foo;\n```\n#### æ€»ç»“\n1. ç±»å‹æ£€æŸ¥\n    1. Cä¸­ï¼Œå‡½æ•°æŒ‡é’ˆå¯ä»¥ä¸ç®¡å‡½æ•°ç­¾åç±»å‹ï¼Œéšæ„äº’ä¼ ï¼Œå¯ä»¥ç¼–è¯‘é€šè¿‡ï¼Œä½†æ˜¯ä¼šæœ‰è­¦å‘Šã€‚\n    2. Cppä¸­ï¼Œå‡½æ•°æŒ‡é’ˆäº’ä¼ æ—¶å¿…é¡»ç±»å‹ä¸€è‡´ã€‚ä¸åŒç±»å‹çš„éœ€è¦å¼ºè½¬ã€‚\n2. å–å‡½æ•°åœ°å€\n    1. Cppä¸­ï¼Œæ™®é€šå‡½æ•°åå­—æˆ–è€…é™æ€æˆå‘˜å‡½æ•°ï¼Œä¸Cä¸€æ ·ï¼Œå¯ä»¥éšå¼è½¬æ¢ä¸ºå‡½æ•°åœ°å€ã€‚ä¸ç”¨åŠ `&`ã€‚\n    2. Cppä¸­ï¼Œæ™®é€šæˆå‘˜å‡½æ•°ï¼Œå–å…¶åœ°å€ï¼Œå¿…é¡»ç”¨`&ç±»å::å‡½æ•°`çš„å½¢å¼ã€‚\n3. è°ƒç”¨\n    1. æ™®é€šå‡½æ•°ã€é™æ€æˆå‘˜å‡½æ•°å¯ä»¥ç›´æ¥ç”¨å‡½æ•°æŒ‡é’ˆåŠ å°æ‹¬å·è°ƒç”¨ã€‚\n    2. æ™®é€šæˆå‘˜å‡½æ•°ï¼Œå¿…é¡»ç»‘å®šå¯¹è±¡å®ä¾‹ï¼Œæ— æ³•ç›´æ¥è°ƒç”¨ã€‚å› æ­¤å¿…é¡»å…ˆè§£å¼•ç”¨ã€‚å¦‚`(obj.*p)`ã€‚\n#### å‡½æ•°æŒ‡é’ˆç±»å‹çš„typedef\n```cpp\nvoid bar(void);\nvoid (*pfun)(void) = bar;   // pfunæ˜¯å˜é‡\ntypdef void(*PFun)(void);   // PFunæ˜¯ç±»å‹\nPFun pfun = bar;            // ç­‰æ•ˆäºä¸Šé¢çš„pfun\n```\n#### ç»ƒä¹ ï¼šå®šä¹‰å‡½æ•°æŒ‡é’ˆæ•°ç»„\nå®šä¹‰ä¸€ä¸ªæœ‰10ä¸ªæŒ‡é’ˆçš„æ•°ç»„ï¼Œè¯¥æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æœ‰ä¸€ä¸ªæ•´å‹å‚æ•°å¹¶è¿”å›æ•´å‹æ•°ã€‚\n```cpp\nint (*a[10])(int);\n```\n1. é¦–å…ˆæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåˆ™`p[10]`ã€‚\n2. å…¶æ¬¡ï¼Œå†…å®¹æ˜¯æŒ‡é’ˆï¼Œ`*p[10]`ï¼Œå› ä¸º`[]`ä¼˜å…ˆçº§æ¯”`*`é«˜ï¼Œåˆ™ä¸ç”¨åŠ å°æ‹¬å·å¤„ç†ã€‚\n3. æŒ‡é’ˆæ˜¯æŒ‡å‘å‡½æ•°çš„ï¼Œå¾—åœ¨åé¢åŠ å°æ‹¬å·è¡¨ç¤ºå‚æ•°ç±»å‹ï¼š`*p[10](int)`ï¼Œä½†æ˜¯`()`ä¼˜å…ˆçº§æ¯”`*`é«˜ï¼Œåˆ™ç³»ç»Ÿä¼šè¯¯ä»¥ä¸ºè¿™æ˜¯å‡½æ•°è°ƒç”¨ï¼ˆæ¯”å¦‚`fun(123);`ï¼‰å¦‚æ­¤ä¸€æ¥ï¼Œå°±å¾—åœ¨å‰é¢æ•´ä½“åŠ å°æ‹¬å·ï¼Œè®©`*p[10]`å…ˆå¤„ç†ï¼š`(*p[10])(int)`ã€‚\n4. å†åŠ ä¸Šè¿”å›ç±»å‹ï¼Œåˆ™ï¼š`int(*p[10])(int)`ã€‚\n#### å‡½æ•°æŒ‡é’ˆï¼šå‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªæ•°ç»„\naæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„å‚æ•°ä¸ºintå‹ï¼Œ**å‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªæ•°ç»„**ï¼Œè¿™ä¸ªæ•°ç»„æœ‰10ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ª`void *`å‹æŒ‡é’ˆã€‚\n```c\nvoid*(*(*a)(int))[10];\n```\n\nå¯ä»¥é€šè¿‡Â `typedef`Â åˆ†æ­¥å®šä¹‰ç±»å‹ï¼Œè®©å£°æ˜æ›´æ¸…æ™°ï¼š\n```cpp\ntypedef void* ElementType;         // æ•°ç»„å…ƒç´ ç±»å‹æ˜¯ void*\ntypedef ElementType ArrayType[10]; // æ•°ç»„ç±»å‹ï¼š10ä¸ªvoid*å…ƒç´ çš„æ•°ç»„\ntypedef ArrayType* ArrayPtr;       // æŒ‡é’ˆï¼ŒæŒ‡å‘ä¸Šè¿°æ•°ç»„\ntypedef ArrayPtr (*FuncPtr)(int);  // å‡½æ•°æŒ‡é’ˆï¼Œæ¥å—intå‚æ•°ï¼Œè¿”å›ArrayPtr\n\nFuncPtr a;  // ç­‰ä»·äº void*(*(*a)(int))[10]\n```\n\nåœ¨Cè¯­è¨€ä¸­ï¼Œç†è§£å¤æ‚å£°æ˜éœ€è¦ä»å˜é‡åå¼€å§‹ï¼Œé€æ­¥å‘å¤–è§£æã€‚å¯¹äºå£°æ˜Â `void*(*(*a)(int))[10];`ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æ­¥æ‹†è§£ï¼š\n1. **å˜é‡åÂ `a`**\n    `a`Â æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ˆç”±Â `*a`Â å¯çŸ¥ï¼‰ã€‚\n2. **`a`Â æŒ‡å‘ä¸€ä¸ªå‡½æ•°**\n    `(*a)(int)`Â è¡¨ç¤ºÂ `a`Â æŒ‡å‘ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—Â `int`Â ç±»å‹çš„å‚æ•°ã€‚\n3. **å‡½æ•°çš„è¿”å›å€¼ç±»å‹**\n    å‡½æ•°çš„è¿”å›å€¼æ˜¯Â `*(...)`ï¼Œå³ä¸€ä¸ªæŒ‡é’ˆã€‚\n    è¿›ä¸€æ­¥åˆ†æÂ `*(*a)(int)`ï¼Œè¯´æ˜è¿”å›å€¼æ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚\n4. **æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªæ•°ç»„**\n    `(*(*a)(int))[10]`Â è¡¨ç¤ºè¿”å›å€¼æŒ‡å‘ä¸€ä¸ªåŒ…å«10ä¸ªå…ƒç´ çš„æ•°ç»„ã€‚\n5. **æ•°ç»„å…ƒç´ çš„ç±»å‹**\n    æ•°ç»„çš„æ¯ä¸ªå…ƒç´ æ˜¯Â `void*`Â ç±»å‹ï¼ˆå³Â `void*`Â æŒ‡é’ˆï¼‰ã€‚\n\nä¸ºä»€ä¹ˆ`[10]`è¦æ”¾åœ¨åé¢ï¼Ÿ\nå¦‚æœè¦å£°æ˜ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€ä¸ªåŒ…å«10ä¸ªintå…ƒç´ çš„æ•°ç»„ï¼š\n```cpp\nint (*ptr)[10];  // ptræ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘int[10]çš„æ•°ç»„\n```\n- `ptr`Â çš„ç±»å‹æ˜¯Â `int(*)[10]`ã€‚\n- **è¯­æ³•è§„åˆ™**ï¼š`[10]`Â å¿…é¡»æ”¾åœ¨æŒ‡é’ˆæ ‡è¯†ç¬¦Â `ptr`Â åé¢ï¼Œè¡¨ç¤ºæŒ‡é’ˆæŒ‡å‘çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè€Œä¸æ˜¯æ•°ç»„ä¸­çš„å•ä¸ªå…ƒç´ ã€‚\n\nå¦‚æœå‡½æ•°è¿”å›ä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼Œå£°æ˜å¦‚ä¸‹ï¼š\n```cpp\nint (*func(int))[10];  // funcæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥å—intå‚æ•°ï¼Œè¿”å›æŒ‡å‘int[10]çš„æŒ‡é’ˆ\n```\n- `func(int)`Â æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›ç±»å‹æ˜¯Â `int(*)[10]`ã€‚\n- **è¯­æ³•è§„åˆ™**ï¼š`[10]`Â å¿…é¡»æ”¾åœ¨å‡½æ•°è¿”å›ç±»å‹çš„åé¢ï¼Œè¡¨ç¤ºè¿”å›å€¼æ˜¯ä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆã€‚\n\næ­¤å‡½æ•°çš„å£°æ˜å’Œå®šä¹‰ä¸ºä»¥ä¸‹å½¢å¼ï¼š\n```cpp\nint (*func(int))[10];\nint main()\n{\n    func(1);\n}\nint (*func(int))[10]\n{\n    int (*arr)[10];\n    return arr;\n}\n```\nä»¥ä¸‹è¿™ä¹ˆå†™æ˜¯é”™è¯¯çš„ï¼š\n```cpp\nint(*)[10] func(int); // error\n```\n#### å‡½æ•°æŒ‡é’ˆï¼šæŒ‡å‘çš„å‡½æ•°è¿”å›å€¼æ˜¯å¦ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆ\naæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„å‚æ•°ä¸º3ä¸ªintå‹ï¼Œå‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„å‚æ•°ä¸ºintå‹ï¼Œå‡½æ•°çš„è¿”å›å€¼æ˜¯floatå‹ã€‚\n```c\nfloat (*(*a)(int, int, int)) (int);\n```\n#### å‡½æ•°æŒ‡é’ˆï¼šæŒ‡å‘çš„å‡½æ•°è¿”å›å€¼æ˜¯å‡½æ•°æŒ‡é’ˆæ•°ç»„\naæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„å‚æ•°ä¸ºç©ºï¼Œå‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªæ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„æœ‰10ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„å‚æ•°ä¸ºç©ºï¼Œå‡½æ•°çš„è¿”å›å€¼æ˜¯intå‹\n\n```c\nint(*(*(*a)(void)) [10])(void);\n```\n# æŒ‡é’ˆä¸æ•°ç»„çš„å…³ç³»\n\n```c\nint main()\n{\n    int arr[8] = { 1, 2, 3, 4, 5, 6, 7, 8 };\n    int * p = arr; //æ­¤æ—¶arrå½“åšæ•°ç»„çš„é¦–ä½intå…ƒç´ çš„intæŒ‡é’ˆèµ‹ç»™äº†p\n    printf(\"%i\\n\", *p);//1\n}\n```\n\n## æŒ‡é’ˆçš„è¿ç®—\n\næŒ‡é’ˆæœ‰åŠ å‡è¿ç®—ã€‚æ²¡æœ‰ä¹˜é™¤è¿ç®—ã€‚ä½†æ˜¯åªèƒ½æ•´æ•°è®¡ç®—ï¼Œä¸èƒ½å°æ•°è®¡ç®—ã€‚\n\n```c\nint main()\n{\n    int arr[8] = { 1, 2, 3, 4, 5, 6, 7, 8 };\n    int * p = arr; //æ­¤æ—¶arrå½“åšæ•°ç»„çš„é¦–ä½intå…ƒç´ (ç¬¬0ä½ç½®)çš„intæŒ‡é’ˆèµ‹ç»™äº†p\n    p += 2;        //ç§»åŠ¨2ä¸ªinté•¿åº¦ã€‚å³ä»0ä½ç½®åˆ°2ä½ç½®äº†ã€‚\n    printf(\"%i\\n\", *p);         //3\n    printf(\"%i\\n\", *(p + 1));   //4\n    printf(\"%i\\n\", *(arr + 1)); //2   (arr + 1)å³ ç§»åŠ¨åˆ°ç¬¬1ä½ç½®\n}\n```\n\n### æŒ‡é’ˆå‡æ³•çš„åº”ç”¨\n\n```c\nint main()\n{\n    int arr[8] = { 1, 2, 3, 4, 5, 6, 7, 8 };\n    int * p = arr; //æ­¤æ—¶arrå½“åšæ•°ç»„çš„é¦–ä½intå…ƒç´ (ç¬¬0ä½ç½®)çš„intæŒ‡é’ˆèµ‹ç»™äº†p\n    p += 2;        //ç§»åŠ¨2ä¸ªinté•¿åº¦ã€‚å³ä»0ä½ç½®åˆ°2ä½ç½®äº†ã€‚\n    printf(\"%i\\n\", p - arr); //2  æ˜¯ä¸¤ä¸ªæŒ‡é’ˆçš„å·®å€¼ï¼Œå·®å‡ºæ¥2ä¸ªå…ƒç´ \n    \n    int * p2 = p + 3;\n    printf(\"%i\\n\", p2 - p); //3  æ˜¯ä¸¤ä¸ªæŒ‡é’ˆçš„å·®å€¼ï¼Œå·®å‡ºæ¥3ä¸ªå…ƒç´ \n}\n```\n\nä½†æ˜¯è¦æ³¨æ„ï¼ŒæŒ‡é’ˆç±»å‹è¦ä¸€è‡´ï¼Œå¦‚æœç±»å‹ä¸ä¸€è‡´ï¼š\n\n```c\nint main()\n{\n    int arr[8] = { 1, 2, 3, 4, 5, 6, 7, 8 };\n    int * p = arr; //æ­¤æ—¶arrå½“åšæ•°ç»„çš„é¦–ä½intå…ƒç´ (ç¬¬0ä½ç½®)çš„intæŒ‡é’ˆèµ‹ç»™äº†p\n    p += 2;        //ç§»åŠ¨2ä¸ªinté•¿åº¦ã€‚å³ä»0ä½ç½®åˆ°2ä½ç½®äº†ã€‚\n    printf(\"%i\\n\", p - arr); //2  æ˜¯ä¸¤ä¸ªæŒ‡é’ˆçš„å·®å€¼ï¼Œå·®å‡ºæ¥2ä¸ªintã€‚\n    \n    char * p2 = p + 3;//æ³¨æ„æ­¤å¤„çš„æŒ‡é’ˆç±»å‹æ˜¯char*\n    printf(\"%i\\n\", p2 - p); //12  pçš„ç±»å‹è¢«è½¬æ¢ä¸ºp2çš„ç±»å‹äº†ï¼Œå·®äº†12ä¸ªcharå¤§å°\n}\n```\n\n## è¯­æ³•ç³–\n\n1. å¯ä»¥æŠŠä¸Šé¢çš„`*(p + 1)`ç›´æ¥ç”¨`p[1]`è¡¨ç¤ºï¼Œé‚£ä¹ˆ`arr[1]`ä¹Ÿå°±æ˜¯`*(arr + 1)`ï¼ŒåŒç†`arr[0]`ä¹Ÿå°±æ˜¯`*arr`ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°ç»„çš„åå­—å¯ä»¥å½“åšæŒ‡å‘**é¦–å…ƒç´ **çš„æŒ‡é’ˆã€‚å¯ä»¥ä½œ`arr + n`è¿™ç§è®¡ç®—è·å¾—æ•°ç»„ä¸­å`n`çš„å…ƒç´ æŒ‡é’ˆã€‚\n2. ä½†æ˜¯ï¼Œä¸èƒ½å¯¹`arr`æœ¬èº«è¿›è¡Œ`+=`ã€`++`ã€‚å› ä¸ºè¿™ä¿®æ”¹äº†`arr`æœ¬èº«çš„å€¼ï¼Œè€Œæ•°ç»„ä¸€æ—¦å®šä¹‰å®Œæˆæ˜¯ä¸å¯åˆ é™¤ã€ç§»åŠ¨çš„ã€‚æœ¬è´¨ä¸Šï¼Œæ•°ç»„åå­—æ˜¯ä¸€ä¸ªconstç±»å‹çš„ã€‚\n3. sizeofï¼šå¯¹äºæ•°ç»„åå­—ï¼Œsizeofè®¡ç®—å‡ºæ¥çš„æ˜¯æ•´ä¸ªæ•°ç»„çš„å¤§å°ã€‚è€Œå¯¹äºsizeof pï¼Œ(`int * p = arr`)ï¼Œè®¡ç®—å‡ºæ¥çš„æ˜¯ä¸€ä¸ªå…ƒç´ çš„å¤§å°ã€‚\n4. é™¤äº†ä¸Šé¢ä¸¤ç§ç‰¹æ®Šæƒ…å†µï¼Œæ•°ç»„åå­—arrå’ŒæŒ‡é’ˆå®Œå…¨ä¸€æ ·ï¼Œå¯ä»¥æ›¿æ¢ä½¿ç”¨ã€‚\n5. å¯¹æ•°ç»„åè¿›è¡Œå–åœ°å€ï¼š`&arr`ä¼šæ˜¯ä»€ä¹ˆï¼Ÿæ˜¯æŒ‡å‘ä¸€ç»´æ•°ç»„çš„æŒ‡é’ˆã€‚`int(*p)[8] = &arr`ã€‚ç”¨på¦‚ä½•æ‰“å°æ•°ç»„æŸä¸€å…ƒç´ ï¼Ÿé¦–å…ˆå¾—å¯¹æ•°ç»„æŒ‡é’ˆè§£å¼•ç”¨`*p`ï¼Œå†å¯¹è§£å¼•ç”¨åçš„å€¼è¿›è¡ŒåŠ å‡`*p + 1`ï¼ˆ`*`è§£å¼•ç”¨ä¼˜å…ˆçº§å¤§äº`+`ï¼Œæ‰€ä»¥ä¸ç”¨ç»™`*p`åŠ æ‹¬å·ï¼‰ï¼Œç„¶åå¯¹åŠ å‡åçš„å€¼ç¬¬äºŒæ¬¡è§£å¼•ç”¨`*(*p + 1)`ã€‚**æˆ–è€…ï¼šç¬¬ä¸€æ¬¡è§£å¼•ç”¨ä¹‹åï¼Œç›´æ¥`(*p)[1]`ã€‚**\n\n```c\nint main()\n{\n    int arr[8] = { 1, 2, 3, 4, 5, 6, 7, 8 };\n    int(*p)[8] = &arr;\n    printf(\"%i\\n\", *(*p + 1)); //2\n}\n```\n\nä½†æ˜¯è¦æ³¨æ„ï¼šè™½ç„¶`int(*p)[8] = &arr`æŠŠæ•°ç»„åœ°å€ï¼ˆä¸æ˜¯é¦–å…ƒç´ åœ°å€ï¼Œè™½ç„¶å€¼ä¸€æ ·ï¼‰å–å‡ºæ¥äº†ï¼Œå³ä½¿å€¼å’Œé¦–å…ƒç´ åœ°å€ä¸€æ ·ï¼Œä½†æ˜¯å®ƒå’Œæ•°ç»„é¦–å…ƒç´ æŒ‡é’ˆæ˜¯æœ‰åŒºåˆ«çš„ï¼Œ`&arr`çš„å…¨éƒ¨å®é™…æ„ä¹‰æŒ‡çš„æ˜¯ä»0åˆ°7çš„æ•´ä¸ªèŒƒå›´ã€‚å¦‚ä½•è¯æ˜å‘¢ï¼Ÿå¯ä»¥ç”¨`p + 1`æ¥è¯´æ˜ï¼šp+1åpæŒ‡å‘äº†æ•´ä¸ªæ•°ç»„çš„æœ«å°¾ã€‚\n```c\nint main()\n{\n    int arr[8] = { 1, 2, 3, 4, 5, 6, 7, 8 };\n    int(*p)[8] = &arr;\n    printf(\"%i\\n\", *(p + 1)); //-85893460  - æ‰“å°å‡ºæ¥ä¸€ä¸ªæœªå®šä¹‰å€¼ï¼Œå› ä¸ºp+1åæŒ‡å‘äº†æ•´ä¸ªæ•°ç»„çš„æœ«å°¾ã€‚\n}\n```\n\nå¦‚æœp+1åï¼Œè¦æ‰“å°æ•°ç»„ä¸­çš„å†…å®¹6ï¼Œåˆ™å¾—ç”¨`(*(p + 1))[-3]`æ¥æ‰“å°ã€‚\n```c\nint main()\n{\n    int arr[8] = { 1, 2, 3, 4, 5, 6, 7, 8 };\n    int(*p)[8] = &arr;\n    printf(\"%i\\n\", (*(p + 1))[-3]); //6 \n}\n```\n\nåè¿‡æ¥è®²ï¼Œå¦‚æœå¯¹pè§£å¼•ç”¨ï¼š`*p`ï¼ˆ`int(*p)[8] = &arr`ï¼‰ï¼Œè™½ç„¶å€¼æ²¡å˜ï¼Œéƒ½æ˜¯é¦–åœ°å€ã€‚ä½†æ˜¯è§£å¼•ç”¨åçš„`*p`å¯¹åº”çš„æ˜¯å•ä¸ªå…ƒç´ çš„æŒ‡é’ˆï¼Œå°±å¤±å»äº†æ•°ç»„å¤§å°çš„å±æ€§ã€‚\n\n**ç»“è®ºï¼šä¸€ç»´æ•°ç»„arråå­—ç›¸å½“äºå…ƒç´ æŒ‡é’ˆï¼Œå¯¹æ•°ç»„åå­—å–åœ°å€ï¼Œåˆ™å–åˆ°æ•´ä¸ªæ•°ç»„çš„æŒ‡é’ˆï¼Œæ˜¯è¡ŒæŒ‡é’ˆã€‚å¦‚æœå¯¹è¡ŒæŒ‡é’ˆè§£å¼•ç”¨ï¼Œåˆ™å¾—åˆ°äº†å…ƒç´ æŒ‡é’ˆã€‚é’ˆå¯¹å…ƒç´ æŒ‡é’ˆï¼Œå¯ä»¥ç§»åŠ¨ï¼Œå†æ¬¡è§£å¼•ç”¨ï¼Œå»å–ä»»æ„ä½ç½®çš„å…ƒç´ ã€‚**\n\n# äºŒç»´æ•°ç»„\n\nä¸Šé¢5è®¨è®ºçš„æ˜¯æŒ‡é’ˆ`*`å½¢å¼çš„è§£å¼•ç”¨ã€‚å¦‚æœè¦ç”¨ä¸­æ‹¬å·æ¥å–å…ƒç´ å‘¢ï¼Ÿ\n\n```c\nint main()\n{\n    int arr[8] = { 1, 2, 3, 4, 5, 6, 7, 8 };\n    int(*p)[8] = &arr;\n    //printf(\"%i\\n\", *(*p + 1)); //2\n    printf(\"%i\\n\", p[0][1]);     //2\n}\n```\n\n`*(*p + 1)`ç­‰åŒäº`p[0][1]`æ‰€ä»¥ï¼Œå®è´¨ä¸Šï¼ŒæŒ‡å‘ä¸€ç»´æ•°ç»„çš„æŒ‡é’ˆï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„äºŒç»´æ•°ç»„ï¼Œå³åªæœ‰ä¸€è¡Œçš„äºŒç»´æ•°ç»„ã€‚\n\n## åˆå§‹åŒ–\n\n```c\nint main()\n{\n    int a[2][4] = { { 1, 2, 3, 4 }, { 5, 6, 7, 8 } };\n    for(int i = 0; i < 2; ++i)\n        for(int j = 0; j < 4; ++j)\n            printf(\"%i\\n\", a[i][j]);\n}// 1 2 3 4 5 6 7 8\n```\n\n```c\nint main()\n{\n    int a[2][4] = { { 1, 2, 3, 4 }, { 5, 6, 7, 8 } };\n    // æ¬²æ‰“å°æ•°ç»„ä¸­å€¼ä¸º6çš„å…ƒç´ ï¼Œåˆ™éœ€è¦å–å‡ºï¼ˆä»0å¼€å§‹ï¼‰ç¬¬1è¡Œã€ç¬¬1åˆ—çš„å…ƒç´ \n    printf(\"%i\\n\", a[1][1]);\n}\n// 6\n```\n\n## å–äºŒç»´æ•°ç»„çš„åœ°å€\n\næ‰“å°6æ—¶ï¼Œ`[]`æ¯”`*`ä¼˜å…ˆçº§é«˜ï¼Œå› æ­¤`*p`éœ€è¦åŠ æ‹¬å·ã€‚å¦‚æœä¸åŠ æ‹¬å·ï¼Œåˆ™å…ˆè¿ç®—`p[1][1]`ï¼Œå†è§£å¼•ç”¨ï¼Œå°±å®Œå…¨ä¸å¯¹äº†ï¼Œ`p[1]`æŒ‡çš„æ˜¯ï¼ˆä»0å¼€å§‹ï¼‰ç¬¬1ä¸ªäºŒç»´æ•°ç»„ï¼Œç›´æ¥è·¨è¿‡äº†æœ¬èº«å…¨éƒ¨çš„æ•°æ®ã€‚\n\n```c\nint main()\n{\n    int a[2][4] = { { 1, 2, 3, 4 }, { 5, 6, 7, 8 } };\n    int(*p)[2][4] = &a;\n    // æ¬²æ‰“å°æ•°ç»„ä¸­å€¼ä¸º6çš„å…ƒç´ ï¼Œåˆ™éœ€è¦å–å‡ºï¼ˆä»0å¼€å§‹ï¼‰ç¬¬1è¡Œã€ç¬¬1åˆ—çš„å…ƒç´ \n    printf(\"%i\\n\", (*p)[1][1]); // []æ¯”*ä¼˜å…ˆçº§é«˜ï¼Œå› æ­¤*péœ€è¦åŠ æ‹¬å·ã€‚\n}\n// 6\n```\n\nå¦‚ä½•ç”¨çº¯æŒ‡é’ˆæ–¹å¼æ‰“å°6ã€‚\n\n```c\nint main()\n{\n    int a[2][4] = { { 1, 2, 3, 4 }, { 5, 6, 7, 8 } };\n    int(*p)[2][4] = &a;\n    printf(\"%i\\n\", *(*(*p + 1) + 1));\n}\n```\n\n## äºŒç»´æ•°ç»„çš„æœ¬è´¨å†…å­˜ç»“æ„\n\nå†…å­˜åªæœ‰1ç»´ç»“æ„ã€‚\n\nè®¾arræ˜¯ä¸€ç»´æ•°ç»„`arr[8]`ï¼Œaæ˜¯äºŒç»´æ•°ç»„`a[2][4]`ã€‚åˆ™`a[1][1] => arr[4 * 1 + 1] => arr[5]`\n\n### ç”¨ä¸€ç»´æ•°ç»„æŒ‡é’ˆæŒ‡å‘äºŒç»´æ•°ç»„\n\n```c\nint main()\n{\n    int a[2][4] = { { 1, 2, 3, 4 }, { 5, 6, 7, 8 } };\n    int(*p)[8] = (int(*)[8])&a;\n    printf(\"%i\\n\", (*p)[5]);\n}// 6\n```\n\n# ä¸‰ç»´æ•°ç»„\n\nç”¨ä¸Šé¢çš„äºŒç»´æ•°ç»„æŒ‡é’ˆpï¼Œåªç”¨ä¸­æ‹¬å·ï¼Œæ‰“å°6ã€‚\n\n```c\nint main()\n{\n    int a[2][4] = { { 1, 2, 3, 4 }, { 5, 6, 7, 8 } };\n    int(*p)[2][4] = &a;\n    printf(\"%i\\n\", p[0][1][1]);\n}\n```\n\n`*(*(*p + 1) + 1)`ç­‰åŒäº`p[0][1][1]`æ‰€ä»¥ï¼Œå®è´¨ä¸Šï¼ŒæŒ‡å‘äºŒç»´æ•°ç»„çš„æŒ‡é’ˆï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„ä¸‰ç»´æ•°ç»„ï¼Œå³åªæœ‰ä¸€ä¸ªé¢çš„ä¸‰ç»´æ•°ç»„ã€‚\n\n## åˆå§‹åŒ–\n\n```c\nint main()\n{\n    int a[2][2][2] = { \n        { { 1, 2 }, { 3, 4 } },   // é¢0\n        { { 5, 6 }, { 7, 8 } }    // é¢1 \n    };\n}\n```\n\n## å–ä¸‰ç»´æ•°ç»„çš„åœ°å€\n\n```c\nint main()\n{\n    int a[2][2][2] = { \n        { { 1, 2 }, { 3, 4 } },   // é¢0\n        { { 5, 6 }, { 7, 8 } }    // é¢1 \n    };\n    int(*p)[2][2][2] = &a;\n    printf(\"%i\\n\", (*p)[1][0][1]);     //      ç¬¬1é¢ï¼Œç¬¬0è¡Œï¼Œç¬¬1åˆ—\n    printf(\"%i\\n\", *(**(*p + 1) + 1)); // ç¬¬0ä½“ï¼Œç¬¬1é¢ï¼Œç¬¬0è¡Œï¼Œç¬¬1åˆ—\n    printf(\"%i\\n\", p[0][1][0][1]);     // ç¬¬0ä½“ï¼Œç¬¬1é¢ï¼Œç¬¬0è¡Œï¼Œç¬¬1åˆ—\n}\n// 6\n// 6\n// 6\n```\n\n`*(**(*p + 1) + 1)`ç­‰åŒäº`p[0][1][0][1]`æ‰€ä»¥ï¼Œå®è´¨ä¸Šï¼ŒæŒ‡å‘3ç»´æ•°ç»„çš„æŒ‡é’ˆï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„4ç»´æ•°ç»„ï¼Œå³åªæœ‰ä¸€ä¸ªä½“çš„3ç»´æ•°ç»„ã€‚\n\n## ä¸‰ç»´æ•°ç»„çš„åº”ç”¨\n\n1. ä¸‰ç»´å»ºæ¨¡ã€‚é¢ã€åœ°å½¢ã€æ¢æµ‹ã€ä½“å…ƒç´ ã€åŒ»ç–—ã€‚\n\n# å…³è”æ€§\n\n## é™ç»´\n\n`int a[2][4] = { { 1, 2, 3, 4 }, { 5, 6, 7, 8 } };`\n\nå¦‚ä½• è®©p æ˜¯ä¸€ä¸ª ç›¸å½“äº äºŒç»´æ•°ç»„açš„åå­—ï¼Ÿ\n\né¦–å…ˆåˆ†æï¼ŒäºŒç»´æ•°ç»„åå­— ç›¸å½“äº è¡ŒæŒ‡é’ˆã€‚ä¸€è¡Œæœ‰4ä¸ªå…ƒç´ ï¼Œå› æ­¤æ˜¯æŒ‡å‘4ä¸ªå…ƒç´ çš„æ•°ç»„æŒ‡é’ˆ\n\n> 1. ä¸€ç»´æ•°ç»„çš„åå­—ç›¸å½“äºåˆ—æŒ‡é’ˆï¼ˆå…ƒç´ æŒ‡é’ˆï¼‰\n> 2. äºŒç»´æ•°ç»„çš„åå­—ç›¸å½“äºè¡ŒæŒ‡é’ˆï¼ˆåˆ—æ•°ä¸ªå…ƒç´ çš„ä¸€ç»´æ•°ç»„æŒ‡é’ˆï¼‰\n> 3. ä¸‰ç»´æ•°ç»„çš„åå­—ç›¸å½“äºé¢æŒ‡é’ˆï¼ˆè¡Œæ•°ä¸ªå…ƒç´ $\\times$åˆ—æ•°ä¸ªå…ƒç´ çš„äºŒç»´æ•°ç»„æŒ‡é’ˆï¼‰\n\n```c\nint main()\n{\n    int a[2][4] = { { 1, 2, 3, 4 }, { 5, 6, 7, 8 } };\n    // æ•°ç»„aé™ç»´è‡³0ç»´ï¼ŒæŸå¤±äº†è¡Œæ•°ã€åˆ—æ•°\n    int * p = a;\n    // æ•°ç»„aå˜æ¢ç»´è‡³1ç»´\n    int(*p)[8] = (int(*)[8])&a;\n    // æ•°ç»„a\n    int(*p)[2][4] = &a;\n    \n    // å¦‚ä½• è®©p æ˜¯ä¸€ä¸ª ç›¸å½“äº äºŒç»´æ•°ç»„åå­—ï¼Ÿ\n    // é¦–å…ˆåˆ†æï¼ŒäºŒç»´æ•°ç»„åå­— ç›¸å½“äº è¡ŒæŒ‡é’ˆã€‚ä¸€è¡Œæœ‰4ä¸ªå…ƒç´ ï¼Œå› æ­¤æ˜¯æŒ‡å‘4ä¸ªå…ƒç´ çš„æ•°ç»„æŒ‡é’ˆ\n    // æ•°ç»„aé™ç»´è‡³1ç»´ï¼ŒæŸå¤±äº†è¡Œæ•°ã€‚\n    int(*p)[4] = a;\n    printf(\"%i\\n\", p[1][1]);\n    \n    // å¦‚ä½• è®©p æ˜¯ä¸€ä¸ª ç›¸å½“äº 3ç»´æ•°ç»„åå­—ï¼Ÿ\n    // é¦–å…ˆåˆ†æï¼Œ3ç»´æ•°ç»„åå­— ç›¸å½“äº é¢æŒ‡é’ˆã€‚ä¸€é¢æœ‰2Ã—2ä¸ªå…ƒç´ ï¼Œå› æ­¤æ˜¯æŒ‡å‘2Ã—2ä¸ªå…ƒç´ çš„æ•°ç»„æŒ‡é’ˆ\n    // æ•°ç»„aé™ç»´è‡³2ç»´ï¼ŒæŸå¤±äº†é¢æ•°ã€‚\n    int(*p)[2][2] = a;\n    printf(\"%i\\n\", p[1][0][1]);\n}\n```\n\n## è®¡ç®—æ•°ç»„è¡Œæ•°ã€åˆ—æ•°å¤§å°\n\néå†ä¸‰ç»´æ•°ç»„æ‰“å°\n\n```c\nint main()\n{\n    int a[2][2][2] = { \n        { { 1, 2 }, { 3, 4 } },   // é¢0\n        { { 5, 6 }, { 7, 8 } }    // é¢1 \n    };\n    for(int i = 0; i < sizeof a / sizeof a[0]; ++i)\n        for(int j = 0; j < sizeof a[0] / sizeof a[0][0]; ++j)\n            for(int k = 0; k < sizeof a[0][0] / sizeof a[0][0][0]; ++k)\n                printf(\"%i\\n\", a[i][j][k]);\n}// 1 2 3 4 5 6 7 8\n```\n\n","categories":["C"]},{"title":"Cè¯­è¨€_æ•°ç»„_å­—ç¬¦ä¸²","url":"/C/Cè¯­è¨€_æ•°ç»„_å­—ç¬¦ä¸²/","content":"# æ•°ç»„\n\n## åˆå§‹åŒ–\n\n```c\nint main()\n{\n    int a[8] = { 1, 2, 3, 4, 5, 6, 7, 8 };\n    for(int i = 0; i < 8; ++i)\n    {\n        printf(\"%i\\n\", a[i]);\n    }\n}// 1 2 3 4 5 6 7 8\n```\n\nåˆå§‹åŒ–æ—¶ï¼Œæ–¹æ‹¬å·å†…çš„æ•°å­—å¯ä»¥çœç•¥\n\n```c\nint main()\n{\n    int a[] = { 1, 2, 3, 4, 5, 6, 7, 8 };\n    for(int i = 0; i < 8; ++i)\n    {\n        printf(\"%i\\n\", a[i]);\n    }\n}// 1 2 3 4 5 6 7 8\n```\n\nä¸ç»™å…·ä½“å€¼ï¼Œåˆ™é‡Œé¢è£…çš„æ˜¯æœªå®šä¹‰å€¼ã€‚\n\n```c\nint main()\n{\n    int a[8];\n    for(int i = 0; i < 8; ++i)\n    {\n        printf(\"%i\\n\", a[i]);\n    }\n}// -858993460 -858993460 -858993460 -858993460 -858993460 -858993460 -858993460 -858993460\n```\n\nåªç»™ä¸€ä¸ª1ï¼Œåˆ™é‡Œé¢è£…æœ‰1ä¸ª1å’Œ7ä¸ª0\n\n```c\nint main()\n{\n    int a[] = { 1 };\n    for(int i = 0; i < 8; ++i)\n    {\n        printf(\"%i\\n\", a[i]);\n    }\n}// 1 0 0 0 0 0 0 0\n```\n\nåªç»™ä¸€ä¸ª1å’Œ2ï¼Œåˆ™é‡Œé¢è£…æœ‰1ä¸ª1ã€1ä¸ª2å’Œ6ä¸ª0ã€‚è€Œä¸”ä¸ç¼–è¯‘ç‰ˆæœ¬æ— å…³ï¼ŒDebugå’ŒReleaseç‰ˆæœ¬çš„è¡Œä¸ºä¸€è‡´ã€‚\n\n```c\nint main()\n{\n    int a[] = { 1, 2 };\n    for(int i = 0; i < 8; ++i)\n    {\n        printf(\"%i\\n\", a[i]);\n    }\n}// 1 2 0 0 0 0 0 0\n```\n\næ‰€ä»¥ä¸è¦è¯¯ä¼šï¼Œåˆå§‹åŒ–æ—¶åªç»™ä¸€ä¸ª0ï¼Œåªæ˜¯æ°å·§å…¨æ˜¯0ï¼Œå¦‚æœåªç»™ä¸€ä¸ª1ï¼Œé‚£ä¹ˆä¸ä¼šå…¨æ˜¯1ã€‚\n\n## é€šç”¨åŒ–éå†è¾“å‡º\n\n1. `sizeof`+`æ•°ç»„å`=`æ•´ä¸ªæ•°ç»„æ‰€å çš„å­—èŠ‚å¤§å°`\n2. `sizeof`+`æ•°ç»„å[0]`=`æ•°ç»„ä¸€ä¸ªå•ç‹¬å…ƒç´ çš„å¤§å°`ã€‚æ—¢ç„¶æœ‰ä¸€ä¸ªæ•°ç»„è¢«å®šä¹‰å‡ºæ¥ï¼Œé‡Œé¢ä¸€å®šæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™`æ•°ç»„å[0]`ä¸€å®šå­˜åœ¨ã€‚\n3. åˆ™`æ•´ä¸ªæ•°ç»„æ‰€å çš„å­—èŠ‚å¤§å°`/`æ•°ç»„ä¸€ä¸ªå•ç‹¬å…ƒç´ çš„å¤§å°`=`æ•°ç»„å…ƒç´ ä¸ªæ•°`\n\n```c\nint main()\n{\n    int a[8] = { 1, 2, 3, 4, 5, 6, 7, 8 };\n    for(int i = 0; i < sizeof a / sizeof a[0]; ++i)\n    {\n        printf(\"%i\\n\", a[i]);\n    }\n}// 1 2 3 4 5 6 7 8\n```\n\n## ç‰¹è´¨\n\næ•°ç»„ä¸€æ—¦å»ºç«‹ä¹‹åï¼Œå°±ä¸èƒ½å†æ”¹åŠ¨å®ƒçš„å±æ€§äº†ï¼Œæ¯”å¦‚å®¹é‡ã€‚\n\n# å­—ç¬¦ä¸²\n\nå¦‚æœæ•°ç»„ä¸­æ”¾çš„æ˜¯å¦‚ASCIIçš„å­—ç¬¦ï¼Œåˆ™å¯ä»¥è¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ä½†æ˜¯å¦‚æœå…¨éƒ¨éå†çš„è¯ä¼šå‡ºç°æ— æ•ˆä¿¡æ¯ã€‚\n\n```c\nint main()\n{\n    char a[8] = { 'H', 'e', 'l', 'l', 'o' };\n    for(int i = 0; i < sizeof a / sizeof a[0]; ++i)\n        printf(\"%c\\n\", a[i]);\n}\n//H\n//e\n//l\n//l\n//o\n//ç©ºè¡Œ  //å®é™…ä¸º'\\0'+'\\n'\n//ç©ºè¡Œ  //å®é™…ä¸º'\\0'+'\\n'\n//ç©ºè¡Œ  //å®é™…ä¸º'\\0'+'\\n'\n//å…‰æ ‡æœ€ç»ˆä½ç½®\n```\n\n## æ™®é€šcharæ•°ç»„åŠ å“¨å…µæ¨¡å¼è¿›è¡Œéå†è¾“å‡º\n\nASCIIç æ ‡å‡†ä¸­è§„å®šï¼Œcharå€¼ä¸º0è¡¨ç¤ºNULLï¼Œå› æ­¤åœ¨å­—ç¬¦æ•°ç»„ä¸­å¯ä»¥ä»£è¡¨å“¨å…µä½ï¼Œæ„å‘³ç€æ­¤ä½ä¹‹åçš„å€¼æ— æ•ˆã€‚å­—ç¬¦æ•°ç»„åœ¨å®é™…ä¸­å¾€å¾€ä¸çŸ¥é“æœ‰æ•ˆä½æ•°ï¼Œå› ä¸ºå®ƒæ˜¯ç”±å“¨å…µä½åŠ¨æ€ç¡®å®šçš„ï¼Œå› æ­¤åº”è¯¥ç”¨while+breakè¿›è¡Œéå†è¾“å‡ºå­—ç¬¦ã€‚\n\n```c\nint main()\n{\n    char a[8] = { 'H', 'e', 'l', 'l', 'o', '\\0' };\n    int i = 0;\n    while(a[i] != '\\0')\n        printf(\"%c\", a[i++]);\n}\n//Hello\n```\n\n## Cè¯­è¨€æä¾›çš„å­—ç¬¦æ•°ç»„ç®€æ´åŒ–æ“ä½œ\n\n### åˆå§‹åŒ–\n\nå¦‚ä¸‹ï¼Œå…¶å®`\"Hello\"`çš„æœ¬è´¨å°±æ˜¯`{ 'H', 'e', 'l', 'l', 'o', '\\0' }`ã€‚æ˜¯ä¸€ç§è¯­æ³•ç³–\n\n```c\nint main()\n{\n    char a[8] = \"Hello\"; // \"Hello\"çš„æœ¬è´¨æ˜¯{ 'H', 'e', 'l', 'l', 'o', '\\0' }\n    int i = 0;\n    while(a[i] != '\\0')\n        printf(\"%c\", a[i++]);\n}\n//Hello\n```\n\n### è¾“å‡º\n\nprintfä¸­`%s`å¯ä»¥ç›´æ¥è¾“å‡ºä¸€ä¸ªå­—ç¬¦æ•°ç»„ã€‚\n\n```c\nint main()\n{\n    char a[8] = \"Hello\"; // \"Hello\"çš„æœ¬è´¨æ˜¯{ 'H', 'e', 'l', 'l', 'o', '\\0' }\n    printf(\"%s\", a);\n}\n//Hello\n```\n\nä½†æ˜¯æ³¨æ„ï¼Œ`{ 'H', 'e', 'l', 'l', 'o', '\\0' }`å’Œ`\"Hello\"`ä¸èƒ½å®Œå…¨ç­‰åŒã€‚`\"Hello\"`çš„åŠŸèƒ½å¤§äº`{ 'H', 'e', 'l', 'l', 'o', '\\0' }`ï¼Œ`\"Hello\"`å¯ä»¥ç›´æ¥è¢«`%s`è¾“å‡ºï¼Œè€Œ`{ 'H', 'e', 'l', 'l', 'o', '\\0' }`ä¸èƒ½ã€‚\n\n```c\nint main()\n{\n    printf(\"%s\", \"Hello\");                             //ok\n    //printf(\"%s\", { 'H', 'e', 'l', 'l', 'o', '\\0' }); //error\n}\n//Hello\n```\n\n## æ“ä½œå­—ç¬¦ä¸²çš„Cç³»ç»Ÿåº“å‡½æ•°\n\nå¾®è½¯ä¸‹è°ƒç”¨æœ‰å†™å…¥æ“ä½œçš„å­—ç¬¦ä¸²åº“å‡½æ•°æ—¶ï¼Œé»˜è®¤ä¸å…è®¸ä½¿ç”¨ä¸å¸¦`_s`çš„å‡½æ•°ã€‚å¯ä»¥åœ¨VSå¦‚ä¸‹è®¾ç½®å³å¯ä½¿ç”¨ä¸å¸¦`_s`çš„æ™®é€šå‡½æ•°ï¼šå³é”®é¡¹ç›®-å±æ€§ï¼ˆConfiguration Propertiesï¼‰-`C/C++`-Preprocessor-Preprocessor Definitionsä¸‹æ‹‰-Edit-åœ¨å·²æœ‰å†…å®¹åæ¢è¡Œå†™å…¥`_CRT_SECURE_NO_WARNINGS`-OK\n\n1. strlen\n\n2. strcpy\n\n3. strcat\n   ```c\n   void str_cat(char des[], char src[])\n   {\n       int i = 0, j = 0;\n       while(des[i++]);//æ‰¾åˆ°desçš„æœ«å°¾\n       --j;//ä¸Šé¢æ‰¾åˆ°æœ«å°¾åå¤šç§»äº†ä¸€ä½ï¼Œéœ€è¦å‰ç§»åˆ°ç¬¬ä¸€ä¸ª\\0ä½ç½®\n       while(des[i++] = src[j++]);\n   }\n   ```\n\n   ä»¥ä¸Šè™½ç„¶å¯ä»¥è¾¾åˆ°ç›®çš„ï¼Œä½†æ˜¯æˆ‘ä»¬åº”è¯¥å°½é‡åˆ©ç”¨`i`å’Œ`j`ä¹‹é—´çš„ç›¸å¯¹ä½ç½®å…³ç³»ï¼Œå¯ä»¥æ›´è¿›ä¸€æ­¥åœ°ä¼˜åŒ–æ€§èƒ½ï¼š\n\n   ```c\n   void str_cat(char des[], char src[])\n   {\n       int i = 0, j = 0;\n       while(des[i++]);//æ‰¾åˆ°desçš„æœ«å°¾\n       --j;//ä¸Šé¢æ‰¾åˆ°æœ«å°¾åå¤šç§»äº†ä¸€ä½ï¼Œéœ€è¦å‰ç§»aåˆ°ç¬¬ä¸€ä¸ª\\0ä½ç½®\n       while(des[i + j] = src[j++]);\n   }\n   ```\n\n   ä»¥ä¸Šï¼Œçœç•¥äº†ä¸€ä¸ª`i++`çš„æ­¥éª¤ï¼Œè¾¾åˆ°äº†æ€§èƒ½çš„æè‡´ä¼˜åŒ–ï¼Œè€Œä¸æ˜¯æ»¥ç”¨åç½®`++`ã€‚\n\n4. strcmp\n   ä¾æ¬¡æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ï¼Œä¸€æ—¦ä¸ç›¸ç­‰åˆ™è¿”å›ï¼Œå¦‚æœåœ¨ä¸€ç›´ç›¸ç­‰çš„å‰æä¸‹ï¼Œä¸€æ—¦é‡åˆ°`\\0`åˆ™è¿”å›ã€‚\n\n   ```c\n   int str_cmp(char str1[], char str2[])\n   {\n       int i = 0;\n       while(str1[i] == str2[i] && str1[i] != '\\0')\n           ++i;\n       return str1[i] - str2[i];\n   }\n   ```\n\n5. strstr - locate sub string - æ­¤å¤„ä¸ºæœ´ç´ ç®—æ³•ï¼Œæé«˜ç‰ˆçš„æœ‰KMPã€BMç®—æ³•ã€‚\n   åº“å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªcharæŒ‡é’ˆï¼Œæˆ‘ä»¬æ­¤å¤„è¿”å›å­ä¸²å…·ä½“å¼€å§‹çš„ä¸‹æ ‡å€¼ã€‚\n\n   ```c\n   int str_str(char str[], char substr[])\n   {\n       int i = 0, j = 0;\n       while(str[i] != '\\0')\n       {\n           while(str[i + j] == str[j] && str[j] != '\\0')\n               ++j;\n           if(str[j] == '\\0')\n           {\n               return i;\n           }\n           else//str[i + j] != str[j]\n           {\n               j = 0;\n               ++i;\n           }\n       }\n       return -1;\n   }\n   ```\n\n### æ€»ç»“\n\nå­—ç¬¦ä¸²çš„ç®—æ³•æ€æƒ³ï¼Œå½’çº³å‡ºæ¥å¯ä»¥æ€»ç»“ä¸ºï¼šå¾ˆå¤šæ—¶å€™éœ€è¦æ‰¾åˆ°æœ€é•¿çš„è·¯çº¿ï¼Œå³ä¸ºä¸´ç•Œç‚¹ï¼Œä»è¿™ä¸ªä¸´ç•Œç‚¹é€€å‡ºå¾ªç¯åˆ™å¼€å§‹è¿›è¡Œå„ç§æƒ…å†µçš„åˆ†æ”¯ï¼Œå†ä¸€ä¸€å»è§£å†³ã€å¤„ç†ã€‚\n","categories":["C"]},{"title":"Cè¯­è¨€_è¿ç®—ç¬¦_è¯­å¥","url":"/C/Cè¯­è¨€_è¿ç®—ç¬¦_è¯­å¥/","content":"# ä¼˜å…ˆçº§è¡¨æ ¼\n\nå·¦ç»“åˆçš„æ„æ€ï¼šå…ˆè®¡ç®—è¿ç®—ç¬¦å·¦ä¾§çš„å†…å®¹ï¼›å³ç»“åˆå°±æ˜¯å…ˆè®¡ç®—è¿ç®—ç¬¦å³ä¾§çš„å†…å®¹ã€‚\n\n![Priority & Binding Property in C](../../images/Cè¯­è¨€_20240109/Priority&BindingPropertyinC.png)\n\n## ä¸¾å‡ ä¸ªä¾‹å­\n\n```c\n- 5 + 3 % 2    -> -4\n  3 * 7 % 3    -> 0\n- i++   (i=5)  -> è¡¨è¾¾å¼å€¼æ˜¯-5, iå€¼ä¸º6\n-i+++i++\næ­£ç¡®ï¼š - i ++ + i ++  -> è¡¨è¾¾å¼å€¼æ˜¯0 , iå€¼ä¸º7\né”™è¯¯ï¼š - i + ++i++    -> é”™è¯¯ï¼Œå› ä¸ºæ— è®ºå“ªä¸ª++å…ˆæ“ä½œï¼Œè¿”å›çš„éƒ½æ˜¯ä¸€ä¸ªä¸å…·åçš„ä¸´æ—¶å˜é‡ï¼Œåä¸€ä¸ª++æ— æ³•æ“ä½œäºä¸´æ—¶æ— åå˜é‡ã€‚\n```\n\n1. åç½®`++`æ˜¯ç­‰æ•´ä¸ªè¡¨è¾¾å¼è®¡ç®—å®Œä¹‹åï¼Œå†è¿›è¡Œ`++`ï¼›å‰ç½®`++`æ˜¯å…ˆ`++`å†å‚ä¸åˆ°è¡¨è¾¾å¼ä¸­ã€‚\n\n2. è‡ªå¢è‡ªå‡ç¬¦ï¼ˆ`++`ã€`--`ï¼‰åªèƒ½ç”¨äºæ›´æ”¹å…·åçš„å˜é‡ï¼Œä¸èƒ½æ›´æ”¹æ²¡æœ‰å›ºå®šå†…å­˜åœ°å€çš„æ“ä½œæ•°ã€‚\n\n3. è€ŒåŠ å‡ä¹˜é™¤ï¼ˆ`+` `-` `*` `/`ï¼‰ä¸èƒ½ä¿®æ”¹æ“ä½œæ•°ï¼Œåªèƒ½æŠŠæ¯ä¸ªæ“ä½œæ•°ä¸²è”èµ·æ¥ï¼Œç»„æˆè¡¨è¾¾å¼ï¼Œæœ€åè®¡ç®—å€¼ã€‚\n4. èƒ½æ”¹å˜å˜é‡æœ¬èº«çš„è¿ç®—ç¬¦åªæœ‰`++`ã€`--`å’Œèµ‹å€¼è¿ç®—ç¬¦ï¼ˆ`=` `+=` `&=` `>>=`ç­‰ç­‰ï¼‰\n\n## èµ‹å€¼è¿ç®—ç¬¦\n\n```c\nx = 3 * 4    ->  xä¸º12, è¡¨è¾¾å¼ä¹Ÿä¸º12\nx = y = 3    ->  è¿ç»­èµ‹å€¼ï¼Œå³ç»“åˆï¼Œå…ˆè®¡ç®—y=3å­è¡¨è¾¾å¼ï¼Œè¡¨è¾¾å¼å€¼ä¸º3ï¼Œåˆ™ -> x=3\nx += p       ->  x = x + p\nx *= y - 3   ->  - å‡å·ä¼˜å…ˆçº§å¤§äº *= -> x = x * (y - 3)\n```\n\n## å…³ç³»è¿ç®—ç¬¦\n\n```c\n//a = 100, b = 99, c = 101, ch = 98\na > b == c      ->  1 == 101  -> 0\nch > 'a' + 1    ->  98 > 98   -> 0\nd = a + b > c   ->  d = 199 > 101 -> d = 1 -> 1\nb - 1 == a != c ->  ==å’Œ!=åŒä¼˜å…ˆçº§ï¼Œå·¦ç»“åˆ -> 98 == 99 != 101 -> 0 != 101 -> 1\n```\n\næ¯”è¾ƒå¤§å°çš„å…³ç³»è¿ç®—ç¬¦ä¼šè¿”å›booleanï¼ˆçœŸã€å‡ï¼‰ï¼Œå…¶ä¸­0ä»£è¡¨å‡ï¼Œéé›¶ä»£è¡¨çœŸã€‚ç³»ç»Ÿè¿”å›çš„çœŸå€¼é»˜è®¤ä¸º1ã€‚\n\n## é€»è¾‘è¿ç®—ç¬¦`&&` `||`\n\n`&&`æ¯”`||`ä¼˜å…ˆçº§é«˜ã€‚\n\n```c\n//a = 100, b = 99, c = 101, x = 4, y = 6\na || b && c       -> å…ˆè®¡ç®— b&&c -> a || 1      -> 1\n!a && b           -> ! æ¯”&&ä¼˜å…ˆçº§é«˜, 0 && b      -> 0\nx >= 3 && x <= 5  -> >=æ¯”&&ä¼˜å…ˆçº§é«˜, 1 && 1      -> 1\n!x == 2           -> ! æ¯”==ä¼˜å…ˆçº§é«˜, 0 == 2      -> 0\na || 3 + 10 && 2  -> + ä¼˜å…ˆçº§æœ€é«˜,  a || 13 && 2 -> a || 1 -> 1\n```\n\n## é€—å·ï¼ˆå‘ï¼‰\n\n1. é€—å·ç”¨åœ¨3ä¸ªåœ°æ–¹ã€‚ä¸€ä¸ªæ˜¯å®šä¹‰å’Œåˆå§‹åŒ–ï¼Œä¸€ä¸ªæ˜¯é€—å·è¡¨è¾¾å¼ï¼Œè¿˜æœ‰ä¼ å‚çš„åˆ†éš”ã€‚\n2. é€—å·è¿ç®—ç¬¦æ˜¯ä¼˜å…ˆçº§åˆ«æœ€ä½çš„ï¼ˆä¸€å®šè¦è®°ä½ï¼Œæ¯”`=`è¿˜ä½ï¼‰ã€‚\n3. é€—å·è¿ç®—ç¬¦éµå¾ªå·¦ç»“åˆï¼Œå³ä»å·¦åˆ°å³ä¾æ¬¡è®¡ç®—ï¼Œæœ€åé€—å·è¡¨è¾¾å¼çš„å€¼ä¸ºæœ€å³è¾¹çš„å€¼ã€‚\n\n```c\nint main(void)\n{\n    int x = 5, y = 7;\n    x + y, 6 - y, 9;   //è¡¨è¾¾å¼å€¼ä¸º9\n}\n```\n\n### å®šä¹‰å’Œåˆå§‹åŒ–\n\n```c\nint x = 5, y = 7;\nint z = x + y, 6 - y, 9; //errorï¼Œå‰é¢å¦‚æœæœ‰å£°æ˜ç±»å‹ï¼Œä¸èƒ½åœ¨åé¢å†™é€—å·è¡¨è¾¾å¼\n```\n\n```c\nint x = 5, y = 7, z = 0; \nz = x + y, 6 - y, 9;     //zè¢«èµ‹ä¸º12ï¼Œä½†æ˜¯å› ä¸ºé€—å·çš„ä¼˜å…ˆçº§æ¯”=ä½ï¼Œæ‰€ä»¥æœ€åè¿™ä¸ªè¡¨è¾¾å¼å€¼ä¸º9\n```\n\n### å‡½æ•°ä¼ å‚ä¸­çš„é€—å·\n\nè¿™é‡Œä¼šæœ‰å‘å‡ºç°ã€‚ï¼ˆ ç±»ä¼¼äºé‡å­æµ‹ä¸å‡†ç°è±¡ doge\n\n```c\nprintf(\"%i\\n\",  x + y, 6 - y, 9 );   //æ‰“å°å‡ºæ¥ä¸º x+y -> 12\nprintf(\"%i\\n\", (x + y, 6 - y, 9));   //åŠ äº†æ‹¬å·ä¹‹å, æ‰“å°9\n```\n\nè¿™æ˜¯å› ä¸ºï¼Œprintfå‡½æ•°ä¸­æœ‰å¯å˜å‚ï¼Œå¦‚æœä¸åŠ æ‹¬å·ï¼Œåˆ™ä¼šæŠŠé€—å·è§†ä¸ºå‚æ•°çš„åˆ†éš”ç¬¦ã€‚\n\n```c\nprintf(const char * const format, ...)\n```\n\n### åç½®`++`å’Œé€—å·çš„çˆ±æ¨æƒ…ä»‡\n\n```c\nint x = 5, y = 7, z = 0;\nz = (x + y++, 6 - y++, 9, y);  //zæœ€åçš„å€¼ä¸º9\n```\n\nåœ¨æœ¬æ¬¡æµ‹è¯•ä¸­ï¼Œé€—å·è¡¨è¾¾å¼çš„å€¼ä¸º9ï¼Œå³yåœ¨é€—å·è¡¨è¾¾å¼ç»“æŸå‰å°±è‡ªå¢äº†ï¼Œä¹Ÿå°±æ˜¯è¯´åç½®`++`è¿™ä¸ªå¹³æ—¶åŠ¨ä½œæœ€æ…¢çš„è€å®¶ä¼™ä¹Ÿç©¿è¶Šä¸äº†é€—å·ã€‚çœ‹æ¥é€—å·å¯ä»¥è¢«å°ä¸ºæ— æ•Œæ‡’ç¥ã€‚\n\nç„¶è€Œï¼Œè¿™åªæ˜¯æœ¬æ¬¡æµ‹è¯•çš„æƒ…å†µï¼Œåç½®`++`æœ‰æ—¶å€™æ¯”è¾ƒè®¨åŒï¼Œè¡Œä¸ºæœ‰æ—¶ä¸ä¸€è‡´ï¼Œè¿™å’Œä¸åŒç¼–è¯‘å™¨ä¸åŒçš„å®ç°æœ‰å…³ã€‚\n\n```c\nint x = 5, y = 7, z = 0;\nz = x + y++, 6 - y++, 9, y;  //zæœ€åçš„å€¼ä¸º12\n```\n\næ‹¬å·æ˜¯`++`å’Œé€—å·çš„ä»–ä¿©çš„å®šå¿ƒä¸¸ï¼ˆå…¶å®ä¹Ÿç§°å¾—ä¸Šæ…å±æ£ï¼‰ï¼Œå¦‚æœæ‹¬å·å»æ‰ï¼Œåˆ™zæœ€åå°±ç­‰äº12ï¼Œå³åœ¨yè‡ªå¢å‰æŠŠx+7èµ‹ç»™zã€‚\n\n## æŒ‰ä½è¿ç®—ç¬¦\n\nä½è¿ç®—ç¬¦ç›´æ¥æ“ä½œå˜é‡çš„æœºå™¨ç ï¼ˆäºŒè¿›åˆ¶ï¼‰ã€‚\n\n### åº”ç”¨\n\n1. ç½‘ç»œç¨‹åºä¸­æœ‰æ—¶è¦ä¸“é—¨å¤„ç†æŸäº›ä½\n2. å·¥ä¸šæ§åˆ¶ä¸­æ§åˆ¶æ ‡è¯†ä½\n3. å¼‚æˆ–ç”¨äºåŠ å¯†\n\n```c\n#define A 0b0001\n#define B 0b0010\n#define C 0b0100\n#define D 0b1000\n```\n\nè¦æ±‚ï¼Œåœ¨ä¸å¹²æ‰°å…¶ä»–ç¯çš„æƒ…å†µä¸‹ï¼Œè®©Bç¯äº®ï¼ŒæŒ‰ä½æˆ–ï¼š\n\n```c\n1000  ->  1010\nP |= B:\n    1000\n  | 0010\n  -------\n    1010\n```\n\næ£€æŸ¥Bç¯çš„äº®ç­ï¼ŒæŒ‰ä½ä¸ï¼š\n\n```c\n1000  ->  è¿”å›ä¸€ä¸ª0å€¼æˆ–é0å€¼\nP & B:\n    1000\n  & 0010\n  -------\n    0000\n```\n\nç­æ‰Bï¼Œå…ˆæŒ‰ä½éåæŒ‰ä½ä¸ï¼š\n\n```c\n1010  ->  0000\n~B:\n  ~ 0010\n  -------\n    1101\nP &= ~B:\n    1010\n  & 1101\n  -------\n    1000\n\n```\n\nå¼‚æˆ–ç”¨äºåŠ å¯†ï¼š\n\n```c\ntext     ->   1101\npassword ->   0011\n            ^\n            -------\nlocked        1110\npassword      0011\n            ^\n            -------\ntext          1101\n```\n\n## ç§»ä½è¿ç®—ç¬¦\n\n```c\nint main(void)\n{\n    unsigned char a = 14u;     //0000 1110  \n    unsigned char b = a >> 1;  //0000 0111  -> 7\n}\n```\n\n```c\nint main(void)\n{\n    unsigned char a = 128u;     //1000 0000  \n    unsigned char b = a >> 1;   //0100 0000  -> 64\n}\n```\n\n```c\nint main(void)\n{\n    char a = 128u;              //1000 0000  -> æ— ç¬¦å·è½¬ä¸ºæœ‰ç¬¦å· a ä¸º-128\n    unsigned char b = a >> 1;   //1100 0000  -> æœ‰ç¬¦å·è½¬ä¸ºæ— ç¬¦å· b ä¸º 192\n}\n```\n\nå¯å¾—ï¼Œå¯¹äºæœ‰ç¬¦å·æ•°ï¼Œç§»ä½è¿ç®—ç¬¦ä¿ç•™äº†ç¬¦å·å±æ€§ã€‚å¦‚æœä¸æƒ³ä¿ç•™ç¬¦å·ç‰¹æ€§ï¼Œå¯ä»¥è®©æ“ä½œæ•°å¼ºåˆ¶è½¬ä¸ºunsignedï¼Œå¦‚ä¸‹ï¼š\n\n```c\nint main(void)\n{\n    char a = 128u;         //1000 0000  -> æ— ç¬¦å·è½¬ä¸ºæœ‰ç¬¦å· a ä¸º-128\n    unsigned char b = (unsigned char)a >> 1; //0100 0000 -> bä¸º64\n}\n```\n\n## æ€»ç»“\n\nï¼ˆç¬ƒå®šåœ°è®²ï¼‰æ‰€æœ‰è¡¨è¾¾å¼æœ€åè‚¯å®šä¼šäº§ç”Ÿä¸€ä¸ªä¸´æ—¶å€¼ï¼Œå¦‚æœæ²¡æœ‰å€¼äº§ç”Ÿï¼Œå°±ä¸æ˜¯è¡¨è¾¾å¼ï¼Œè€Œæ˜¯ä¸€ä¸ªè¯­å¥ã€‚\n\n# è¯­å¥\n\n1. é¡ºåºè¯­å¥\n2. åˆ†æ”¯è¯­å¥\n\n   1. if\n   2. \n3. å¾ªç¯\n\n   1. while\n   2. do-while\n   3. for\n   \n\n## åˆ†æ”¯è¯­å¥\n\n```c\nint main(void)\n{\n    if (0)\n        printf(\"true\\n\");\n    else\n        printf(\"false\\n\");\n    return 0;\n}\n```\n\n```c\nint main(void)\n{\n    int x = 2;\n    if (x == 1)\n        printf(\"true\\n\");\n    else if (x == 2)\n        printf(\"true2\\n\");\n    else\n        printf(\"false\\n\");\n    return 0;\n}\n```\n\n### switch-case\n\n```c\nint main()\n{\n    if(a == 1)\n        printf(\"1\\n\");\n    else if(a == 2)\n        printf(\"2\\n\");\n    else if(a == 3)\n        printf(\"3\\n\");\n    else if(a == 4)\n        printf(\"4\\n\");\n    else\n        printf(\"else\\n\");\n    \n    switch(a)\n    {\n        case 1:\n            printf(\"1\\n\");\n            break;\n        case 2:\n            printf(\"2\\n\");\n            break;\n        case 3:\n            printf(\"3\\n\");\n            break;\n        case 4:\n            printf(\"4\\n\");\n            break;\n        default:\n            printf(\"else\\n\");\n            break;\n    }\n}\n```\n\nä¸Šé¢è¿™ä¸ªç¨‹åºçš„æ‰€è¾¾åˆ°çš„æ•ˆæœï¼Œåœ¨é€»è¾‘ä¸Šï¼Œif-elseå’Œswitch-caseæ˜¯ä¸€æ ·çš„ã€‚\n\nswitchåé¢æ‹¬å·å†…çš„å˜é‡åªæ”¯æŒæ•´å‹æˆ–æšä¸¾ç±»å‹ï¼Œæšä¸¾ç±»å‹ä¹Ÿæ˜¯æ•´å‹çš„ä¸€ç§ã€‚\n\nå¦‚æœåˆ†æ”¯å¾ˆå¤šä¸”åˆ¤åˆ«è¡¨è¾¾å¼å€¼ä¸ºæ•´å‹ï¼Œåˆ™ä½¿ç”¨switch-caseæ›´åˆé€‚ã€‚\n\nå¦‚æœæŠ›å»è¿™ä¸¤ä¸ªé™åˆ¶ï¼ˆåˆ†æ”¯çš„å¤šå°‘å’Œåˆ¤åˆ«è¡¨è¾¾å¼å€¼çš„ç±»å‹ï¼‰ï¼Œåˆ™æ€§èƒ½ä¸Šswitch-caseæ›´æœ‰ä¼˜åŠ¿ï¼š\n\n1. ç¼–è¯‘å™¨ç›´æ¥æŠŠcaseä¸­çš„ç¼–å·å½“åšåç§»é‡ï¼Œå¯¹åº”åˆ°ç›¸åº”çš„å†…å­˜åœ°å€ä¸Šäº†ã€‚\n2. äºæ˜¯ç›´æ¥ç•¥è¿‡äº†åˆ¤æ–­å‰é¢çš„è¿‡ç¨‹ï¼Œç›´æ¥å»æ‰¾ç›¸åº”çš„åˆ†æ”¯ã€‚\n\n## å¾ªç¯\n\n### while\n\n```c\nint main(void)\n{\n    while (1)\n        printf(\"Hello\");\n}\n```\n\n```c\nint main(void)\n{\n    while (1)\n    {\n        printf(\"Hello\");\n        break;\n    }\n}\n```\n\ncontinue\n\n```c\nint main(void)\n{\n    while (1)\n    {\n        printf(\"Hello\");\n        continue;\n        printf(\"end\"); //ä¸èµ°\n    }\n}\n```\n\næ±‚1åˆ°100åŠ å’Œï¼šè‡ªç„¶ç»ˆæ­¢\n\n```c\nint main(void)\n{\n    //sum: 1 ~ 100\n    int i = 1, sum = 0;\n    while (i <= 100)\n        sum += i++;\n    printf(\"sum: %i\\n\", sum); // 5050\n}\n```\n\næ±‚1åˆ°100åŠ å’Œï¼šæ¡ä»¶breakç»ˆæ­¢\n\n```c\nint main(void)\n{\n    //sum: 1 ~ 100\n    int i = 1, sum = 0;\n    while (1)\n    {\n        sum += i++;\n        if (i > 100)\n            break;\n    }\n    printf(\"sum: %i\\n\", sum); // 5050\n}\n```\n\n### do-while\n\nä¸ç®¡whileæ‹¬å·å†…æ¡ä»¶æ˜¯å¦ç¬¦åˆï¼Œè‡³å°‘æ‰§è¡Œä¸€æ¬¡å¾ªç¯ä½“ã€‚\n\n```c\nint main()\n{\n    int i = 10;\n    do\n    {\n        printf(\"Hello\\n\");\n    }while(i < 10);  // å› ä¸ºæœ€åä¸æ˜¯å¤§æ‹¬å·ç»“å°¾çš„ï¼Œæ‰€ä»¥è¦åŠ ä¸Š;\n}\n```\n\n### for\n\nforåçš„æ‹¬å·å†…æ˜¯ä¸‰æ¡è¯­å¥ã€‚ç¬¬ä¸€æ¡åªè¿è¡Œä¸€æ¬¡ï¼Œç¬¬äºŒæ¡æ˜¯æ¯æ¬¡è¿›å…¥å¾ªç¯æ—¶éƒ½è¦åˆ¤æ–­ï¼Œç¬¬ä¸‰æ¡æ˜¯æ¯æ¬¡å¾ªç¯ä½“è¿è¡Œå®Œåæ‰§è¡Œã€‚\n\n```c\nint main(void)\n{\n    //sum: 1 ~ 100\n    int sum = 0;\n    for (int i = 1; i <= 100; ++i)\n    {\n        sum += i;\n    }\n    printf(\"sum: %i\\n\", sum); // 5050\n}\n```\n\n### ä¹ä¹ä¹˜æ³•è¡¨\n\n```c\nint main(void)\n{\n    for(int i = 1; i <= 9; ++i, printf(\"\\n\"))\n    {\n        for(int j = 1; j <= i; ++j)\n        {\n            printf(\"%i*%i=%-2i \", j, i, i * j);\n        }\n    }\n}\n```\n\n1. `printf`ä¸­çš„`%-2i`ä»£è¡¨æœ‰ç¬¦å·æ•´æ•°ï¼Œé™„åŠ çš„æ•ˆæœæ˜¯å ä¸¤ä½ï¼Œ**å·¦å¯¹é½**ï¼ˆè´Ÿå·çš„ä½œç”¨ï¼‰ã€‚\n2. `for`è¡¨è¾¾å¼ä¸­çš„ç¬¬ä¸‰ä¸ªè¡¨è¾¾å¼æ˜¯æœ€ååšçš„å¤„ç†ï¼Œå¾€å¾€ä¸éœ€è¦è¿”å›å€¼ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œç¬¬ä¸€å±‚forå¾ªç¯ä»£è¡¨è¡Œçš„å¤„ç†ï¼Œç¬¬äºŒå±‚forå¾ªç¯ä»£è¡¨åˆ—çš„å¤„ç†ï¼Œæ¯å½“ç¬¬äºŒå±‚forå¾ªç¯å®Œæ¯•åï¼Œéœ€è¦æ¢è¡Œï¼Œå³æ¯å½“ç¬¬ä¸€å±‚forå¾ªç¯ä½“å†…å®¹ç»“æŸåï¼Œéœ€è¦åšä¸¤ä¸ªäº‹æƒ…ï¼š1ã€iåŠ 1ï¼›2ã€æ¢è¡Œï¼Œå¯ä»¥åˆå¹¶ä¸ºé€—å·è¡¨è¾¾å¼æ”¾åœ¨forè¡¨è¾¾å¼ç¬¬ä¸‰ä¸ªç©ºä¸­ã€‚å› ä¸ºforæ‹¬å·ä¸­çš„ç¬¬ä¸‰ä¸ªè¯­å¥æ²¡æœ‰äººæ¥æ¥å—å®ƒçš„è¿”å›å€¼ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å†™printfè¿™ç§æ— è¿”å›å€¼çš„å‡½æ•°ã€‚\n\n![image-20240120173829903](../../images/Cè¯­è¨€_20240109/image-20240120173829903.png)\n\n### æ€»ç»“\n\n1. whileå¾ªç¯å¾€å¾€é€‚ç”¨äºä¸æ¸…æ¥šè¿è¡Œæ¬¡æ•°çš„ï¼Œä¸èƒ½ç²¾å‡†æ§åˆ¶æ­¥é•¿çš„æƒ…å†µã€‚\n2. forå¾ªç¯é€‚ç”¨äºçŸ¥é“è¿è¡Œæ¬¡æ•°çš„æƒ…å†µï¼šéœ€è¦æ˜ç™½içš„èŒƒå›´ã€æ­¥é•¿ã€‚\n","categories":["C"]},{"title":"Cè¯­è¨€_å˜é‡_å¸¸å˜é‡_ä½œç”¨åŸŸ_static","url":"/C/Cè¯­è¨€_å˜é‡_å¸¸å˜é‡_ä½œç”¨åŸŸ_static/","content":"# ä½œç”¨åŸŸ\n\n## å±€éƒ¨å˜é‡\n\n```c\n#include<stdio.h>\nvoid bar();\nint main()\n{\n    bar();\n    bar();\n    return 0;\n}\nvoid bar()\n{\n    int val = 10;\n    printf(\"%i\\n\", val++);\n}\n```\n\nä»¥ä¸Šç¨‹åºä¸¤æ¬¡éƒ½æ‰“å°10ã€‚å› ä¸ºvalçš„ä½œç”¨åŸŸåªç”Ÿå­˜åœ¨å‡½æ•°å½“æ—¶æ‰€åˆ†é…çš„æ ˆå¸§ä¸­ï¼Œæ­¤å˜é‡ä¸ºè‡ªåŠ¨/å±€éƒ¨å˜é‡ï¼ˆauto/local variableï¼‰ï¼Œå‡½æ•°è°ƒç”¨ç»“æŸåå˜é‡è‡ªåŠ¨é”€æ¯ã€‚\n\n## å…¨å±€å˜é‡\n\nå…¨å±€å˜é‡ï¼ˆglobal variableï¼‰ã€‚\n\n```c\n#include<stdio.h>\nvoid var();\nint val = 10;\nint main()\n{\n    bar();\n    bar();\n    return 0;\n}\nvoid bar()\n{\n    printf(\"%i\\n\", val++);\n}\n```\n\nç¬¬ä¸€æ¬¡æ‰“å°10ï¼Œç¬¬äºŒæ¬¡æ‰“å°11ã€‚\n\n### å¤šæ–‡ä»¶ä¸‹ä½¿ç”¨å…¨å±€å˜é‡ - extern\n\n```c\n//æ–‡ä»¶A\n#include<stdio.h>\nvoid var();\n//int val = 10;\nextern int val;\nint main()\n{\n    bar();\n    bar();\n    return 0;\n}\nvoid bar()\n{\n    printf(\"%i\\n\", val++);\n}\n//æ–‡ä»¶B\nint val = 10;\n```\n\n1. åªéœ€è¦å£°æ˜ï¼Œä¸ç”¨èµ‹å€¼ã€‚\n2. externå£°æ˜ä¹‹åä¸ä¼šå†æ¬¡åˆ†é…é¢å¤–çš„ç©ºé—´\n3. externåœ¨ç¼–è¯‘æ—¶ä¸æ£€æŸ¥ã€‚\n4. externåœ¨é“¾æ¥æ—¶ä¼šæ£€æŸ¥å…¶ä»–æ–‡ä»¶ä¸­å®é™…æœ‰æ²¡æœ‰è¿™ä¸ªå˜é‡ã€‚\n\n## æ›´ä¼˜é›…çš„å…¨å±€å˜é‡ - é™æ€å˜é‡\n\n### staticä¿®é¥°å˜é‡å’Œå‡½æ•°çš„ä½œç”¨\n\n- **staticä¿®é¥°å˜é‡ï¼š** åœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨staticä¿®é¥°å˜é‡æ—¶ï¼Œè¯¥å˜é‡ç§°ä¸ºé™æ€å±€éƒ¨å˜é‡ã€‚å®ƒçš„ç”Ÿå‘½å‘¨æœŸå»¶é•¿åˆ°æ•´ä¸ªç¨‹åºè¿è¡ŒæœŸé—´ï¼Œä½†ä½œç”¨åŸŸä»…é™äºå®šä¹‰å®ƒçš„å‡½æ•°å†…éƒ¨ã€‚é™æ€å±€éƒ¨å˜é‡åœ¨æ¯æ¬¡å‡½æ•°è°ƒç”¨æ—¶ä¸ä¼šè¢«é‡æ–°åˆå§‹åŒ–ï¼Œè€Œæ˜¯ä¿ç•™ä¸Šä¸€æ¬¡è°ƒç”¨ç»“æŸæ—¶çš„å€¼ã€‚\n\n```c\n#include <stdio.h>\n\nvoid exampleFunction()\n{\n    // é™æ€å±€éƒ¨å˜é‡\n    static int counter = 0;\n    counter++;\n    printf(\"Counter: %d\\n\", counter);\n}\n\nint main()\n{\n    exampleFunction();  // è¾“å‡ºï¼šCounter: 1\n    exampleFunction();  // è¾“å‡ºï¼šCounter: 2\n    exampleFunction();  // è¾“å‡ºï¼šCounter: 3\n    \n    return 0;\n}\n```\n\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé™æ€å±€éƒ¨å˜é‡`counter`åœ¨æ¯æ¬¡å‡½æ•°è°ƒç”¨ä¹‹é—´ä¿ç•™å…¶å€¼ï¼Œè€Œä¸ä¼šè¢«é‡æ–°åˆå§‹åŒ–ã€‚\n\n- **staticä¿®é¥°å‡½æ•°ï¼š** åœ¨å‡½æ•°å£°æ˜æˆ–å®šä¹‰æ—¶ä½¿ç”¨staticä¿®é¥°ï¼Œå°†å‡½æ•°çš„é“¾æ¥å±æ€§å˜ä¸ºå†…éƒ¨é“¾æ¥ï¼Œé™åˆ¶å…¶ä½œç”¨åŸŸåœ¨å½“å‰æºæ–‡ä»¶å†…ã€‚è¿™æ ·ï¼Œå…¶ä»–æºæ–‡ä»¶æ— æ³•è°ƒç”¨è¿™ä¸ªé™æ€å‡½æ•°ã€‚\n\n```c\n#include <stdio.h>\n\n// é™æ€å‡½æ•°å£°æ˜ï¼Œé™åˆ¶å…¶ä½œç”¨åŸŸåœ¨å½“å‰æºæ–‡ä»¶å†…\nstatic void staticFunction()\n{\n    printf(\"This is a static function.\\n\");\n}\nint main()\n{\n    staticFunction();  // å¯ä»¥è°ƒç”¨é™æ€å‡½æ•°\n    return 0;\n}\n```\n\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½¿ç”¨staticä¿®é¥°çš„å‡½æ•°`staticFunction`åªèƒ½åœ¨å½“å‰æºæ–‡ä»¶å†…è¢«è°ƒç”¨ã€‚\n\n### staticå£°æ˜è¯­å¥ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ\n\n```c\n#include<stdio.h>\nvoid var();\n\nint main()\n{\n    bar();\n    bar();\n    return 0;\n}\nvoid bar()\n{\n    static int val = 10;\n    printf(\"%i\\n\", val++);\n}\n```\n\nä¹‹å‰æˆ‘ä¸€ç›´ä»¥ä¸ºstaticåœ¨å‡½æ•°ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ä¼šè¢«æ‰§è¡Œï¼Œå…¶ä»–æ—¶å€™å‡½æ•°è°ƒç”¨åˆ™è·³è¿‡ã€‚ç»è¿‡è°ƒè¯•ï¼Œå‘ç°ï¼Œstaticè¯­å¥åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨å‡½æ•°æ—¶ä¹Ÿä¼šç›´æ¥è·³è¿‡è¿™æ¡è¯­å¥ã€‚è¿™è¯´æ˜staticå˜é‡åœ¨mainå‡½æ•°æ‰§è¡Œå‰å°±è¢«åˆå§‹åŒ–äº†ã€‚\n\n### staticçš„æœ¬è´¨\n\n1. æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡\n2. åœ¨åº”ç”¨ç¨‹åºå»ºç«‹çš„æ—¶å€™ï¼Œé™æ€å˜é‡å°±åˆ›å»ºå¥½äº†ã€‚\n3. åœ¨ç¨‹åºä¸­å†™çš„æ„ä¹‰åªæ˜¯è¯´æ˜å˜é‡åå­—çš„å¯è§èŒƒå›´ã€‚**å¦‚æœå†™åœ¨å¤§æ‹¬å·ï¼ˆä¸ä»…æ˜¯å‡½æ•°ä½“å¤§æ‹¬å·ï¼Œæ‰€æœ‰å¤§æ‹¬å·éƒ½ç®—ï¼‰é‡Œï¼Œåˆ™å‡ºäº†å¤§æ‹¬å·åå°±ä¸è®¤è¯†è¯¥æ ‡è¯†ç¬¦**ï¼›å¦‚æœå†™åœ¨mainå‡½æ•°å¤–ï¼Œåˆ™å¯è§èŒƒå›´ä»…é™äºæ­¤æ–‡ä»¶ï¼Œæ‰€æœ‰å‡½æ•°éƒ½å¯è§ã€‚\n   1. å¦‚æœå‡½æ•°é‡Œã€å‡½æ•°å¤–å®šä¹‰äº†åŒåstaticå˜é‡åˆ™ï¼šå°±è¿‘åŸåˆ™ï¼Œä¼˜å…ˆé€‰æ‹©æœ¬å‡½æ•°é‡Œçš„ï¼\n\n```c\n#include<stdio.h>\nvoid fun()\n{\n\tstatic int val = 1;\n}\nint main()\n{\n\tprintf(\"val: %i\\n\", val);  // error, can't find val\n}\n```\n\n```c\n#include<stdio.h>\nstatic int val = 34;\nvoid fun()\n{\n\tstatic int val = 1;\n}\nint main()\n{\n\tfun();\n\tprintf(\"val: %i\\n\", val);  // å‡½æ•°å¤–çš„valï¼Œä¸è®¤è¯†funå‡½æ•°é‡Œçš„val\n}\n```\n\n```c\n#include<stdio.h>\nstatic int val = 34;\nvoid fun()\n{\n\tstatic int val = 1;\n\tval = 2;  // ä¼˜å…ˆé€‰æ‹©æœ¬å‡½æ•°é‡Œçš„val\n}\nint main()\n{\n\tfun();\n\tprintf(\"val: %i\\n\", val); // æ‰“å°34ã€‚è¯»å–çš„æ˜¯å‡½æ•°å¤–çš„valï¼Œä¸è®¤è¯†funå‡½æ•°é‡Œçš„val\n}\n\n```\n\n```c\n#include<stdio.h>\nstatic int val = 34;\nvoid fun()\n{\n\t{\n\t\tstatic int val = 1;\n\t}\n\tval = 2;  // åªè®¤è¯†å‡½æ•°å¤–çš„valï¼Œå‡½æ•°é‡Œçš„ä¸Šé¢è¿™ä¸ªå¤§æ‹¬å·é‡Œçš„valä¸è®¤è¯†\n}\nint main()\n{\n\tfun();\n\tprintf(\"val: %i\\n\", val); // å‡½æ•°å¤–çš„valï¼Œä¸è®¤è¯†funå‡½æ•°é‡Œçš„val\n}\n\n```\n\n```c\n#include<stdio.h>\nstatic int val = 34;\nvoid fun()\n{\n\tstatic int val = 1;\n\tval = 2;  // å‡½æ•°å¤–çš„val\n}\nint main()\n{\n\tstatic int val = 33;\n\tfun();\n\tprintf(\"val: %i\\n\", val); // æ‰“å°33ï¼Œä¼˜å…ˆé€‰æ‹©æœ¬å‡½æ•°é‡Œçš„val\n}\n\n```\n\n# å®\n\n```c\n#include<stdio.h>\n#define PI 3.14\nint main()\n{\n    int i = PI;\n    return 0;\n}\n```\n\n# å¸¸å˜é‡\n\nå¦‚æœPIèµ‹äºˆäº†æ™®é€šçš„intå‹å˜é‡`i`ï¼Œé‚£ä¹ˆ`i`å¯èƒ½ä¼šè¢«ç¯¡æ”¹ã€‚è¿™æ—¶å¯ä»¥ç”¨å¸¸å˜é‡ä¿®é¥°`i`ã€‚\n\n```c\n#include<stdio.h>\n#define PI 3.14\nint main()\n{\n    //int i = PI;\n    //i = 9.78;\n    const int i = PI; // or: int const i = PI;\n    return 0;\n}\n```\n\nä½†æ˜¯å¸¸å˜é‡ä¸å»ºè®®è¿™ä¹ˆä½¿ç”¨ã€‚è€Œæ˜¯å¦‚ä¸‹ä½¿ç”¨ï¼š\n\n```c\n#include<stdio.h>\nconst float PI = 3.14f;\nint main()\n{\n    float i = PI;\n    return 0;\n}\n```\n\nå¥½å¤„ï¼š\n\n1. å®èƒ½åšçš„ï¼Œå¸¸å˜é‡éƒ½å¯ä»¥åšåˆ°ã€‚\n2. å®ä¸èƒ½åšåˆ°çš„ï¼šå˜é‡ç±»å‹æ£€æŸ¥ï¼Œå¸¸å˜é‡å¯ä»¥åšã€‚\n   1. è™½ç„¶`3.14f`å¯ä»¥æ­£ç¡®åœ°è¡¨è¾¾floatå­—é¢å¸¸é‡\n   2. ä½†æ˜¯`90`å´ä¸èƒ½æ­£ç¡®åœ°è¡¨è¾¾shortå­—é¢å¸¸é‡ï¼Œcharã€shortè¯¸å¦‚æ­¤ç±»éƒ½æ˜¯æ•´å‹å…¼å®¹çš„ï¼Œå½¢å¼ä¸æ•´å‹æ— åŒºåˆ«ï¼Œæ‰€ä»¥æ— æ³•åœ¨å®å®šä¹‰æ—¶æŠŠç±»å‹ä¿¡æ¯é™„åŠ ä¸Šï¼Œå› æ­¤ä¸¢å¤±äº†ç±»å‹ä¿¡æ¯ã€‚\n\n# å…¶ä»–æ€»ç»“\n\n1. **#defineå®å®šä¹‰å’Œconstçš„åŒºåˆ«ï¼š**\n    - **#defineå®å®šä¹‰ï¼š** ä½¿ç”¨#defineåˆ›å»ºçš„å®æ˜¯ä¸€ç§ç®€å•çš„æ–‡æœ¬æ›¿æ¢æœºåˆ¶ã€‚åœ¨é¢„å¤„ç†é˜¶æ®µï¼Œæ‰€æœ‰çš„å®åç§°éƒ½ä¼šè¢«å¯¹åº”çš„æ–‡æœ¬æ›¿æ¢ï¼Œæ²¡æœ‰ç±»å‹ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š`#define PI 3.14`ã€‚\n    - **constå…³é”®å­—ï¼š** constç”¨äºåˆ›å»ºå¸¸é‡ï¼Œå…·æœ‰ç±»å‹ä¿¡æ¯ï¼Œå¹¶ä¸”åœ¨ç¼–è¯‘æ—¶è¿›è¡Œç±»å‹æ£€æŸ¥ã€‚ä¾‹å¦‚ï¼š`const double PI = 3.14;`ã€‚conståˆ›å»ºçš„å¸¸é‡åœ¨å†…å­˜ä¸­æœ‰åˆ†é…ç©ºé—´ï¼Œè€Œå®å®šä¹‰åªæ˜¯ç®€å•çš„æ–‡æœ¬æ›¿æ¢ã€‚\n2. **å®šä¹‰å’Œå£°æ˜çš„å…³ç³»ï¼š**\n    - **å®šä¹‰ï¼š** å®šä¹‰æ˜¯åˆ›å»ºä¸€ä¸ªå˜é‡ã€å‡½æ•°ã€æˆ–å…¶ä»–å®ä½“ï¼Œå¹¶åˆ†é…ç›¸åº”çš„å­˜å‚¨ç©ºé—´ã€‚ä¾‹å¦‚ï¼š`int x = 5;`ã€‚\n    - **å£°æ˜ï¼š** å£°æ˜æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨æŸä¸ªå®ä½“çš„å­˜åœ¨è€Œä¸è¿›è¡Œå®é™…çš„åˆ›å»ºã€‚ä¾‹å¦‚ï¼š`extern int x;`ã€‚\n    - **å…³ç³»ï¼š** å®šä¹‰åŒ…å«å£°æ˜ï¼Œä½†å£°æ˜ä¸ä¸€å®šåŒ…å«å®šä¹‰ã€‚å¦‚æœåœ¨æŸä¸ªæ–‡ä»¶ä¸­å£°æ˜äº†ä¸€ä¸ªå˜é‡ï¼Œè€Œåœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­å®šä¹‰äº†è¯¥å˜é‡ï¼Œé‚£ä¹ˆç¼–è¯‘æ—¶éœ€è¦é“¾æ¥è¿™ä¸¤ä¸ªæ–‡ä»¶ã€‚\n","categories":["C"]},{"title":"Cè¯­è¨€_Cç¨‹åº","url":"/C/Cè¯­è¨€_Cç¨‹åº/","content":"# è¯­è¨€çš„å‘å±•\n1. Procedure\n2. Function\n3. Object\n4. Meta (template)\n5. Component\n\n# Visual Studioä½¿ç”¨\n\nSolutionï¼ˆè§£å†³æ–¹æ¡ˆï¼‰æŒ‡çš„æ˜¯è§£å†³æŸä¸€é—®é¢˜æ•´ä¸ªçš„æ–¹æ¡ˆï¼Œéœ€è¦1ä¸ªæˆ–å¤šä¸ªProjectï¼ˆé¡¹ç›®ï¼‰æ¥ååŒå®Œæˆã€‚ä¸åŒçš„é¡¹ç›®å¯ä»¥æ˜¯ä¸åŒçš„è¯­è¨€å¦‚`C++`ã€`C#`ç­‰ï¼Œå¯ä»¥æŠŠè¿™äº›é¡¹ç›®æ”¾åœ¨ä¸€ä¸ªè§£å†³æ–¹æ¡ˆä¸­è”åˆç¼–è¯‘ã€‚\n\n## é¡¹ç›®ç›®å½•ç»“æ„\n\né¡¹ç›®ç¼–è¯‘æˆåŠŸåï¼Œå¯æ‰§è¡Œexeæ–‡ä»¶ä¼šç”Ÿæˆåœ¨é¡¹ç›®ç›®å½•ä¸‹çš„`x64/Debug`ä¸­ï¼Œåå­—ä¸ºé¡¹ç›®åç§°\n\n# ç¬¬ä¸€ä¸ªCç¨‹åº\n\n```c\n#include <stdio.h> /* standard input output. */\n\n// forward declarations.\nvoid bar(void);\n\nint main(void)\n{\n    bar();\n    return 0;\n}\n\nvoid bar(void)\n{\n    printf(\"Hello\\n\");\n}\n```\n\nå‰ç½®**å£°æ˜**çš„ä¸»è¦ä½œç”¨ä½“ç°åœ¨ï¼š\n\n1. ç¼–è¯‘å™¨å¯ä»¥åœ¨ä»£ç ä¸­æ£€æµ‹å‡½æ•°æ˜¯å¦æ­£ç¡®è°ƒç”¨ï¼Œå¦‚æ£€æŸ¥å‡½æ•°åã€è¿”å›ç±»å‹ã€å‚æ•°ç±»å‹ã€‚\n2. å¦‚æœä»£ç ä¸­å‡½æ•°è°ƒç”¨ä¹¦å†™æ­£ç¡®ï¼Œåˆ™é€šè¿‡ç¼–è¯‘æ£€æµ‹ã€‚æˆ‘ä»¬å¯ä»¥å†™å’Œå‰ç½®å£°æ˜ä¸­ä¸€æ ·çš„è°ƒç”¨ä¹¦å†™æ¥æ¬ºéª—ç¼–è¯‘å™¨ï¼Œä½†æ˜¯åé¢é“¾æ¥å™¨ä¼šè¿›ä¸€æ­¥æ£€æŸ¥æ˜¯å¦åœ¨ä¸‹é¢æœ‰å‡½æ•°çš„æ­£ç¡®**å®šä¹‰**ã€‚\n\nå¦‚æœæˆ‘ä»¬åˆ é™¤barå‡½æ•°å®šä¹‰\n\n```c\n#include <stdio.h> /* standard input output. */\n\n// forward declarations.\nvoid bar(void);\n\nint main(void)\n{\n    bar();\n    return 0;\n}\n```\n\nåˆ™é“¾æ¥å™¨æŠ¥é”™ï¼š\n\n```\n1>------ å·²å¯åŠ¨ç”Ÿæˆ: é¡¹ç›®: Project1, é…ç½®: Debug x64 ------\n1>Source.c\n1>Source.obj : error LNK2019: æ— æ³•è§£æçš„å¤–éƒ¨ç¬¦å· barï¼Œå‡½æ•° main ä¸­å¼•ç”¨äº†è¯¥ç¬¦å·\n1>C:\\Users\\xcg\\source\\repos\\Solution1\\x64\\Debug\\Project1.exe : fatal error LNK1120: 1 ä¸ªæ— æ³•è§£æçš„å¤–éƒ¨å‘½ä»¤\n1>å·²å®Œæˆç”Ÿæˆé¡¹ç›®â€œProject1.vcxprojâ€çš„æ“ä½œ - å¤±è´¥ã€‚\n```\n\n# ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦å‰ç½®å£°æ˜\n\n1. å¦‚æœæŠŠå‡½æ•°å®ç°æ”¾åœ¨è°ƒç”¨å¤„çš„åé¢ï¼Œåˆ™éœ€è¦åœ¨è°ƒç”¨å¤„å‰é¢å‰ç½®å£°æ˜ï¼›\n2. å¦‚æœå‡½æ•°åœ¨æ­¤æ–‡ä»¶å¤–ï¼Œåˆ™éœ€è¦åœ¨è°ƒç”¨å¤„å‰é¢å‰ç½®å£°æ˜ï¼›\n3. å¦‚æœå‡½æ•°åœ¨ç³»ç»Ÿåº“ä¸­ï¼Œä¹Ÿéœ€è¦åœ¨è°ƒç”¨å¤„å‰é¢å‰ç½®å£°æ˜ï¼Œåªä¸è¿‡å†™åˆ°äº†`#include<XXX>`ä¸­å»äº†ï¼Œæ¯”å¦‚printfå‡½æ•°åŒ…å«åœ¨`stdio.h`ä¸­ï¼›\n\n# å°–æ‹¬å·å’ŒåŒå¼•å·çš„åŒºåˆ«\n\n1. å°–æ‹¬å·æœç´¢èŒƒå›´å°ï¼Œç¼–è¯‘é€Ÿåº¦å¿«ã€‚\n2. åŒå¼•å·ä¼šä¼˜å…ˆåˆ°å½“å‰å·¥ç¨‹è·¯å¾„ä¸‹å»æ‰«æï¼Œæ²¡æœ‰æ‰«æåˆ°åˆ™å»ç³»ç»Ÿåº“ä¸­æœç´¢ã€‚\n\n# ç¼–è¯‘é“¾æ¥æ­¥éª¤\n\n1. é¢„å¤„ç†ï¼Œå¦‚`#include`\n2. ç¼–è¯‘ï¼ŒæŠŠæ¯ä¸€ä¸ª`.c`æ–‡ä»¶ç”Ÿæˆä¸€ä¸ª`.obj`æ–‡ä»¶ï¼Œå³ç›®æ ‡æ–‡ä»¶ï¼Œæ˜¯CPUå¯è¯†åˆ«çš„æœºå™¨ç ï¼Œä½†æ— æ³•ç›´æ¥æ‰§è¡Œã€‚\n3. æ±‡ç¼–\n4. é“¾æ¥ï¼ŒæŠŠæ‰€æœ‰çš„`.obj`æ–‡ä»¶ç»„åˆä¸º`.exe`æ–‡ä»¶ï¼ˆLinuxä¸‹ä¸º`.out`ï¼‰\n\n## `.exe`æ–‡ä»¶ç”±ä»€ä¹ˆç»„æˆ\n\n1. æ‰€æœ‰`.obj`æ–‡ä»¶ï¼ˆè‡ªå·±ç¼–å†™çš„å†…å®¹ï¼Œç”¨æˆ·åº“ï¼‰\n2. ç³»ç»Ÿåº“å†…å®¹ï¼Œå¦‚`printf`å‡½æ•°\n3. Cå¯åŠ¨ä»£ç \n   1. é¦–å…ˆéœ€è¦ä¸€ä¸ªè°ƒç”¨è€…æ¥è°ƒç”¨mainå‡½æ•°ï¼Œç¨‹åºæ‰èƒ½ä»å…¥å£å¯åŠ¨\n   2. å…¶æ¬¡ï¼Œæœ‰ä¸€äº›å…¨å±€å˜é‡ï¼Œéœ€è¦å¯åŠ¨ä»£ç åœ¨mainå‡½æ•°æ‰§è¡Œå‰åŠ è½½\n\n# Cè¯­è¨€ç¨‹åºé¡¶å±‚è§’åº¦\n\nç¨‹åºç”±æ¨¡å—ç»„æˆï¼Œå³ä¸€ä¸ªä¸ªåŠŸèƒ½å•å…ƒã€‚å¯ä»¥è¯´ï¼šå¤§çš„å·¥å‚åˆ†äº†å¥½å¤šè½¦é—´ï¼Œå„ä¸ªè½¦é—´æœ‰å„è‡ªçš„åŸæ–™ã€‚é‚£ä¹ˆï¼Œåœ¨ç¨‹åºé‡Œï¼Œè¯­å¥æŠŠè¿™äº›åŸæ–™ï¼ˆæ•°æ®ï¼‰ï¼ŒæŒ‰å¤šç§æ–¹æ³•ï¼ˆé¡ºåºã€åˆ†æ”¯ã€å¾ªç¯ï¼‰é€åˆ°æŸä¸€ä¸ªä½ç½®ã€‚è€Œè¡¨è¾¾å¼åˆ™æ˜¯è¿™äº›åŸæ–™ï¼ˆæ•°æ®ï¼‰çš„è½½ä½“ã€‚è¡¨è¾¾å¼ç”±è¿ç®—ç¬¦ã€æ•°æ®ç»„æˆã€‚\n\n```\nC Program\n         functions\n                   statements\n                              expressions __\n                                   |        \\\n                                   |         \\\n                                  operators   \\\n                                              elementary data type\n```\n\n","categories":["C"]},{"title":"è‹±è¯­ç¬”è®°_æ¦‚ç‡å¯¼è®º","url":"/è¯¾å ‚ç¬”è®°/è‹±è¯­ç¬”è®°_æ¦‚ç‡å¯¼è®º/","content":"\n# è¯æ±‡\n\n1. devoted to ...\n   1. è‡´åŠ›äº...çš„\n2. right away\n   1. ç«‹åˆ»ã€é©¬ä¸Š\n3. accomplish\n   1. å®Œæˆ\n4. mutually exclusive\n   1. äº’æ–¥çš„\n5. specify\n   1. åˆ—ä¸¾ï¼›æŒ‡å®šï¼›ç‰¹å®š\n   2. specifiedï¼šè§„å®šçš„ã€é¢å®šçš„ã€ç‰¹å®šçš„\n   3. spe'cificï¼šç‰¹æ®Šçš„ï¼›ç‰¹å®šçš„ï¼›æ˜ç¡®çš„ï¼›ç‰¹æ•ˆè¯\n6. axiom\n   1. å…¬ç†ï¼›æ ¼è¨€ï¼›è‡ªæ˜ä¹‹ç†\n   2. è¿‘ä¹‰è¯ï¼štheory - ç†è®ºï¼Œtheorem - å®šç†ï¼Œprinciple - åŸç†\n7. consequence\n   1. ç»“æœï¼›åæœ\n8. im'ply\n   1. éšå«ï¼›æš—ç¤ºï¼›æ„å‘³\n   2. **hint**æŒ‡é€šè¿‡æ—¶é—´æ¥è€Œæœ‰æç¤ºæ€§çš„è¯è¯­æˆ–è¡¨æƒ…æ¥æš—ç¤ºæŸäº‹ã€‚\n      **imply**ä¾§é‡æŒ‡è¯è¯­ã€è¡Œä¸ºæˆ–æƒ…æ™¯ä¸­çš„ä¸€ç§æš—ç¤ºï¼Œå¬è€…æˆ–è¯»è€…å¿…é¡»åŠ ä»¥é€»è¾‘æ¨æ–­æ‰èƒ½é¢†ä¼šã€‚\n      **suggest**æŒ‡æœ‰æ„æˆ–æ— æ„çš„ï¼Œç›´æ¥æˆ–é—´æ¥æš—ç¤ºï¼Œå¼ºè°ƒäº‹ç‰©çš„è¡¨å¾ç­‰ä½¿äººå¼•èµ·è”æƒ³ã€‚\n9. discrete\n   1. ç¦»æ•£çš„ï¼›\n   2. discrete mathematics - ç¦»æ•£æ•°å­¦\n   3. continuous - è¿ç»­çš„\n10. sophisticated`/sÉ™ËˆfÉªstÉªkeÉªtÉªd/`\n    1. è€ç»ƒçš„ã€è€äºä¸–æ•…çš„ï¼›\n    2. ç²¾å¯†çš„ã€å°–ç«¯çš„ï¼›\n    3. é«˜é›…çš„ã€æœ‰æ•™å…»çš„ã€‚\n    4. complex ä¾§é‡å†…åœ¨å…³ç³»çš„å¤æ‚ï¼Œéœ€é€šè¿‡ä»”ç»†ç ”ç©¶ä¸äº†è§£æ‰èƒ½æŒæ¡å’Œè¿ç”¨ã€‚\n       complicated ä¸complexçš„å«ä¹‰æ¥è¿‘ï¼Œä½†è¯­æ°”æ›´å¼ºï¼Œç€é‡æå…¶å¤æ‚ï¼Œå¾ˆéš¾åˆ†æã€åˆ†è¾¨æˆ–è§£é‡Šã€‚\n       sophisticated ä¾§é‡æŒ‡äº‹ç‰©å‘å±•åˆ°æˆ–è¾¾åˆ°é«˜çº§çš„ç¨‹åº¦æ‰€ä½“ç°å‡ºçš„å¤æ‚ã€‚\n       intricate ç€é‡æŒ‡é”™ç»¼å¤æ‚ï¼Œä»¤äººè¿·æƒ‘ç†è§£ã€‚\n11. subtle\n    1. å¾®å¦™çš„ã€éš¾ä»¥æ‰æ‘¸çš„ã€ç»†å¾®çš„ï¼›\n    2. I want a girl who's sexy, but in a subtle wayâ€”that's what gets me going.\n       æˆ‘éœ€è¦ä¸€ä¸ªæ€§æ„Ÿå¥³å­©ï¼Œä¸è¿‡è¦**éšéšçº¦çº¦**åœ°æ€§æ„Ÿçš„é‚£ä¸€ç§æ€§æ„Ÿâ€”â€”å°±æ˜¯èƒ½è®©æˆ‘å…´å¥‹çš„é‚£ç§ç±»å‹ã€‚\n    3. æ•æ„Ÿçš„ã€æ•é”çš„ã€æœ‰è¾¨åˆ«åŠ›çš„\n    4. Roy. I'm more subtle and discreet(è°¨æ…) than you.\n       ç½—ä¼Šï¼Œæˆ‘æ¯”ä½ æ›´**ä½è°ƒ**è°¨æ…ã€‚\n    5. delicate ä¾§é‡æŒ‡éœ€è¦è°¨æ…å¤„ç†å’Œå¯¹å¾…ã€‚\n       fine éšå«â€œä¸æ˜“å¯Ÿè§‰çš„â€æ„å‘³ã€‚\n       subtle ä¾§é‡æœ‰æ´å¯Ÿã€é¢†æ‚Ÿäº‹ç‰©ç»†å¾®å·®åˆ«ä»¥åŠå¾®å¦™å…³ç³»çš„èƒ½åŠ›ã€‚\n\n# å¥å­\n\n1. A probabilistic model is a quantitative description of a situation, a phenomenon, or an experiment whose outcome is uncertain.\n   1. æ¦‚ç‡æ¨¡å‹æ˜¯å¯¹ç»“æœä¸ç¡®å®šçš„æƒ…å†µã€ç°è±¡æˆ–å®éªŒçš„å®šé‡æè¿°ã€‚\n2. we specify a probability law, which assigns probabilities to outcomes or to collections of outcomes. The probability law tells us, for example, whether one outcome is much more likely than some other outcome.\n   1. æˆ‘ä»¬æŒ‡å®šä¸€ä¸ªæ¦‚ç‡å®šå¾‹ï¼Œè¯¥å®šå¾‹å°†æ¦‚ç‡åˆ†é…ç»™ç»“æœæˆ–ç»“æœé›†åˆã€‚æ¦‚ç‡å®šå¾‹è®©æˆ‘ä»¬çŸ¥é“ï¼Œæ¯”å¦‚ï¼Œä¸€ä¸ªç»“æœæ˜¯å¦æ¯”å…¶ä»–ç»“æœæ›´æœ‰å¯èƒ½ã€‚\n3. Probabilities have to satisfy certain basic properties in order to be meaningful.\n","categories":["è‹±è¯­","è¯¾å ‚ç¬”è®°"]},{"title":"é›†ç¾¤æœåŠ¡å™¨æ¶æ„_ç»­ç¯‡_åç¨‹æœåŠ¡å™¨","url":"/é¡¹ç›®/é›†ç¾¤æœåŠ¡å™¨æ¶æ„_ç»­ç¯‡_åç¨‹æœåŠ¡å™¨/","content":" å†…å®¹\n\n1. é¡¹ç›®éœ€æ±‚åŠç›®æ ‡\n2. å¼€å‘ç¯å¢ƒ\n3. `Json`ä»‹ç»\n4. `muduo`ç½‘ç»œåº“ç¼–ç¨‹\n5. æœåŠ¡å™¨é›†ç¾¤\n6. åŸºäº`å‘å¸ƒ-è®¢é˜…`çš„`Redis`â€”â€”æœåŠ¡å™¨ä¸­é—´ä»¶\n7. æ•°æ®åº“è®¾è®¡\n\næœ¬é¡¹ç›®è¦ç”¨åˆ°çš„æŠ€æœ¯æ ˆï¼š\n\n1. `Json`åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼›\n2. `muduo`ç½‘ç»œåº“å¼€å‘ï¼›\n3. `nginx`æºç ç¼–è¯‘å®‰è£…å’Œç¯å¢ƒéƒ¨ç½²ï¼›\n4. `nginx`çš„`tcp`è´Ÿè½½å‡è¡¡å™¨é…ç½®ï¼›\n5. `redis`ç¼“å­˜æœåŠ¡å™¨ç¼–ç¨‹å®è·µï¼›\n6. åŸºäº`å‘å¸ƒ-è®¢é˜…`çš„æœåŠ¡å™¨ä¸­é—´ä»¶`redis`æ¶ˆæ¯é˜Ÿåˆ—ç¼–ç¨‹å®è·µï¼›\n7. `MySQL`æ•°æ®åº“ç¼–ç¨‹ï¼›\n8. `CMake`æ„å»ºç¼–è¯‘ç¯å¢ƒï¼›\n9. `Github`æ‰˜ç®¡é¡¹ç›®\n\næœ¬é¡¹ç›®çš„å†…å®¹åŒ…å«äº†ï¼šé€šå¸¸å¼€å‘çš„æœåŠ¡å™¨ï¼Œç½‘ç»œã€ä¸šåŠ¡ã€æ•°æ®æ¨¡å—ï¼ˆæ•°æ®åº“ã€æ•°æ®çš„æ“ä½œï¼‰ï¼Œé¡¹ç›®ä¸­è¦æŠŠä¸‰å¤§æ¨¡å—åŒºåˆ†å¼€ï¼Œé¡¹ç›®åˆæœŸæ—¶ä»¥ç™»å½•æ¨¡å—ä¸ºä¸»çº¿ï¼Œåˆ†ä¸‰å¤§å—æ¨è¿›ã€‚\n\n# é¡¹ç›®éœ€æ±‚åŠç›®æ ‡\n\n* é¡¹ç›®éœ€æ±‚\n  1. å®¢æˆ·ç«¯æ–°ç”¨æˆ·æ³¨å†Œ\n  2. å®¢æˆ·ç«¯ç”¨æˆ·ç™»å½•\n  3. æ·»åŠ å¥½å‹å’Œæ·»åŠ ç¾¤ç»„\n  4. å¥½å‹èŠå¤©å’Œç¾¤ç»„èŠå¤©\n  5. `nginx`é…ç½®`tcp`è´Ÿè½½å‡è¡¡\n  6. é›†ç¾¤èŠå¤©ç³»ç»Ÿæ”¯æŒå®¢æˆ·ç«¯è·¨æœåŠ¡å™¨é€šä¿¡\n\n* é¡¹ç›®ç›®æ ‡\n  1. æŒæ¡æœåŠ¡å™¨çš„ç½‘ç»œ`I/O`æ¨¡å—ï¼Œä¸šåŠ¡æ¨¡å—ï¼Œæ•°æ®æ¨¡å—åˆ†å±‚çš„è®¾è®¡æ€æƒ³\n  2. æŒæ¡`C++` `muduo`ç½‘ç»œåº“çš„ç¼–ç¨‹ä»¥åŠå®ç°åŸç†\n  3. æŒæ¡`Json`çš„ç¼–ç¨‹åº”ç”¨\n  4. æŒæ¡`nginx`é…ç½®éƒ¨ç½²`tcp`è´Ÿè½½å‡è¡¡å™¨çš„åŸç†åŠåº”ç”¨\n  5. æŒæ¡æœåŠ¡å™¨ä¸­é—´ä»¶çš„åº”ç”¨åœºæ™¯å’ŒåŸºäº`å‘å¸ƒ-è®¢é˜…`çš„`redis`ç¼–ç¨‹å®è·µä»¥åŠåº”ç”¨åŸç†\n  6. æŒæ¡`CMake`æ„å»ºè‡ªåŠ¨åŒ–ç¼–ç¨‹ç¯å¢ƒ\n\n# å¼€å‘ç¯å¢ƒ\n\nå…·ä½“é…ç½®ç•¥ï¼Œç¿»é˜…å…¶ä»–æ–‡ç« ã€‚\n\n## å·¥ç¨‹ç›®å½•\n\n```\nincludeç›®å½•æ˜¯å¤´æ–‡ä»¶æ”¾çš„ä½ç½®ã€‚\nserverå’Œclientçš„ä»£ç åœ¨åŒä¸€å·¥ç¨‹ä¸­ï¼Œæœ€åç”Ÿæˆæ—¶å¯ä»¥æŠŠC/Såˆ†å¼€ç”Ÿæˆåˆ°binç›®å½•ä¸‹ã€‚\nå¯æŒ‰serverå’Œclientåˆ†ç±»ï¼Œæ¯”å¦‚ç”Ÿæˆä»£ç æ‰€éœ€ç”¨åˆ°çš„å¤´æ–‡ä»¶å¯ä»¥åˆ†åˆ«æ”¾åœ¨/include/serverå’Œ/include/clientï¼Œè€Œserverå’Œclientå…±éœ€çš„å¤´æ–‡ä»¶ç›´æ¥æ”¾åˆ°/includeä¸‹ã€‚æ¯”å¦‚æ¶ˆæ¯çš„idã€‚\nsrcæ”¾æºç ã€‚\nthirdpartyæ˜¯ç¬¬ä¸‰æ–¹åº“æ–‡ä»¶å¤¹ï¼Œæ¯”å¦‚æ”¾json.hppã€‚\næœ¬é¡¹ç›®æ²¡æœ‰ç”Ÿæˆlibåº“(.a/.so)ï¼Œæ‰€ä»¥æ²¡æœ‰libæ–‡ä»¶å¤¹ã€‚\n```\n\n## CMakeLists.txtç¼–å†™\n\n* æ ¹ç›®å½•\n\n  ```cmake\n  cmake_minimum_required(VERSION 3.0.0)\n  project(chat)\n  # é…ç½®ç¼–è¯‘é€‰é¡¹\n  set(CMAKE_CXX_FLAGS ${CMAKE_CXX_FLAGS} -g)\n  # é…ç½®æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶è¾“å‡ºçš„è·¯å¾„\n  set(EXECUTABLE_OUTPUT_PATH ${PROJECT_SOURCE_DIR}/bin)\n  # é…ç½®å¤´æ–‡ä»¶çš„æœç´¢è·¯å¾„\n  include_directories(${PROJECT_SOURCE_DIR}/include)\n  include_directories(${PROJECT_SOURCE_DIR}/include/server)\n  # åŠ è½½å­ç›®å½•\n  add_subdirectory(src)\n  ```\n\n* `/src`\n\n  ```cmake\n  add_subdirectory(server)\n  ```\n\n* `/src/server`\n\n  ```cmake\n  # å®šä¹‰äº†ä¸€ä¸ªSRC_LISTå˜é‡ï¼ŒåŒ…å«äº†è¯¥ç›®å½•ä¸‹æ‰€æœ‰çš„æºæ–‡ä»¶\n  aux_source_directory(. SRC_LIST)\n  # æŒ‡å®šç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶\n  add_executable(ChatServer ${SRC_LIST})\n  # æŒ‡å®šå¯æ‰§è¡Œæ–‡ä»¶é“¾æ¥æ—¶ éœ€è¦ä¾èµ–çš„åº“æ–‡ä»¶\n  target_link_libraries(CharServer muduo_net muduo_base pthread)\n  ```\n\n  \n\n# Jsonä»‹ç»\n\nJsonæ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ï¼ˆä¹Ÿå«æ•°æ®åºåˆ—åŒ–æ–¹å¼ï¼‰ã€‚Jsoné‡‡ç”¨å®Œå…¨**ç‹¬ç«‹äºç¼–ç¨‹è¯­è¨€**çš„æ–‡æœ¬æ ¼å¼\næ¥å­˜å‚¨å’Œè¡¨ç¤ºæ•°æ®ã€‚ç®€æ´å’Œæ¸…æ™°çš„å±‚æ¬¡ç»“æ„ä½¿å¾— Jsonæˆä¸ºç†æƒ³çš„æ•°æ®äº¤æ¢è¯­è¨€ã€‚ æ˜“äºäººé˜…è¯»å’Œç¼–å†™ï¼ŒåŒæ—¶ä¹Ÿæ˜“äºæœºå™¨è§£æå’Œç”Ÿæˆï¼Œå¹¶æœ‰æ•ˆåœ°æå‡ç½‘ç»œä¼ è¾“æ•ˆç‡ã€‚\n\nJsonçš„ç”¨å¤„å°±æ˜¯ä¸‹å›¾ï¼š\n\n![image-20220413164124873](../../images/é›†ç¾¤æœåŠ¡å™¨/image-20220413164124873.png)\n\n* Jsonç¬¬ä¸‰æ–¹åº“\n\næœ¬é¡¹ç›®é€‰ç”¨çš„æ˜¯`JSON for Modern C++`ï¼Œç”±å¾·å›½äºº`nlohmann`ç¼–å†™çš„åœ¨`C++`ä¸‹ä½¿ç”¨çš„`JSON`åº“ã€‚ç‰¹ç‚¹å¦‚ä¸‹:\n\n1. æ•´ä¸ªä»£ç ç”±ä¸€ä¸ªå¤´æ–‡ä»¶`json.hpp`åŒ…å«ï¼Œæ²¡æœ‰ä¾èµ–å…³ç³»ï¼Œä½¿ç”¨æ–¹ä¾¿ï¼›\n2. ä½¿ç”¨C++11æ ‡å‡†ç¼–å†™ï¼›\n3. ä½¿å¾—jsonåƒSTLå®¹å™¨ä¸€æ ·ï¼Œè€Œä¸”STLå’Œjsonå®¹å™¨ä¹‹é—´å¯ä»¥ç›¸äº’è½¬æ¢ï¼›\n4. æ‰€æœ‰ç±»éƒ½ç»è¿‡ä¸¥æ ¼çš„å•å…ƒæµ‹è¯•ï¼Œè¦†ç›–100ï¼…çš„ä»£ç ï¼ŒåŒ…æ‹¬æ‰€æœ‰ç‰¹æ®Šçš„è¡Œä¸ºã€‚æ­¤å¤–ï¼Œè¿˜æ£€æŸ¥äº†Valgrindæ˜¯å¦æœ‰å†…å­˜æ³„æ¼ã€‚ä¸ºäº†ä¿æŒé«˜è´¨é‡ï¼Œè¯¥é¡¹ç›®éµå¾ªâ€œæ ¸å¿ƒåŸºç¡€è®¾æ–½â€å€¡è®®çš„æœ€ä½³å®è·µã€‚\n\n* æµ‹è¯•json\n\n```cpp\n#include\"json.hpp\"\nusing json = nlohmann::json;\n#include<iostream>\n#include<vector>\n#include<map>\nusing namespace std;\n/* jsonåºåˆ—åŒ– ç¤ºä¾‹1 */\nvoid func1()\n{\n    json js;\n    js[\"msg_type\"] = 2;\n    js[\"from\"] = \"zhang san\";\n    js[\"to\"] = \"li si\";\n    js[\"msg\"] = \"hello, i'm zhang san\";\n    cout << js << endl;\n}\nint main()\n{\n    func1();\n    return 0;\n}\n/* è¾“å‡ºç»“æœ\n * {\"from\":\"zhang san\",\"msg\":\"hello, i'm zhang san\",\"msg_type\":2,\"to\":\"li si\"}\n */\n```\n\n```cpp\n/* jsonåºåˆ—åŒ– å®ä¾‹2 */\nvoid func2()\n{\n\tjson js;\n    js[\"id\"] = {1, 2, 3, 4, 5};\n    js[\"name\"] = \"zhang san\";\n    js[\"msg\"][\"zhang san\"] = \"i'm zhang san\";\n    js[\"msg\"][\"li si\"] = \"i'm li si\";\n    /* ä¸Šé¢ä¸¤å¥ç­‰åŒäºä¸‹é¢è¿™å¥ä¸€æ¬¡æ€§æ·»åŠ æ•°ç»„å¯¹è±¡ */\n/*  js[\"msg\"] = {{\"zhang san\", \"i'm zhang san\"}, {\"li si\", \"i'm li si\"}}; */\n\tcout << js << endl;\n}\nint main()\n{\n    func2();\n    return 0;\n}\n/* è¾“å‡ºç»“æœ\n * {\"id\":[1,2,3,4,5],\"msg\":{\"li si\":\"i'm li si\",\"zhang san\":\"i'm zhang san\"},\"name\":\"zhang san\"}\n */\n```\n\nè¿™ä¸ªjsonåº“å¼ºå¤§åˆ°ç›´æ¥æŠŠ`C++` `STL`ä¸­çš„å®¹å™¨å†…å®¹å¯ä»¥ç›´æ¥åºåˆ—åŒ–æˆJsonå­—ç¬¦ä¸²ï¼Œä»£ç å¦‚ä¸‹ï¼š\n\n```cpp\n/* jsonåºåˆ—åŒ– å®ä¾‹3 */\nvoid func3()\n{\n    json js;\n    vector<int> vec;\n    vec.push_back(1);\n    vec.push_back(2);\n    vec.push_back(5);\n    // ç›´æ¥åºåˆ—åŒ–ä¸€ä¸ªvectorå®¹å™¨\n    js[\"list\"] = vec;\n    map<int, string> m;\n    m.insert({1, \"é»„å±±\"});\n    m.insert({2, \"åå±±\"});\n    m.insert({3, \"æ³°å±±\"});\n    // ç›´æ¥åºåˆ—åŒ–ä¸€ä¸ªmapå®¹å™¨\n    js[\"path\"] = m;\n    cout<<js<<endl;\n}\n/* è¾“å‡ºç»“æœ\n * {\"list\":[1,2,5],\"path\":[[1,\"é»„å±±\"],[2,\"åå±±\"],[3,\"æ³°å±±\"]]}\n */\n```\n\n* API\n\n  * `dump`: `cout <<`èƒ½è¾“å‡ºjsonå¯¹è±¡æ˜¯å› ä¸ºé‡è½½äº†`<<`è¿ç®—ç¬¦ï¼›è€Œè¦å®é™…ç”Ÿæˆ`string`å¯ç”¨`dump()`ï¼Œç”Ÿæˆçš„å­—ç¬¦ä¸²å†…å®¹å’Œ`<< json`çš„ä¸€æ ·ã€‚ä¼ è¾“æ•°æ®æ—¶ï¼Œä¸è¦ä¼ `string`å¯¹è±¡ï¼Œè€Œæ˜¯è¦ä¼ `string`å®é™…æŒ‡å‘çš„å­—ç¬¦ä¸²é¦–æŒ‡é’ˆï¼Œ`c\\_str`ã€‚\n\n    ```cpp\n    void func1()\n    {\n        json js;\n        js[\"msg_type\"] = 2;\n        js[\"from\"] = \"zhang san\";\n        js[\"to\"] = \"li si\";\n        js[\"msg\"] = \"hello, i'm zhang san\";\n        string sendBuf = js.dump();\n        cout << sendBuf.c_str() << endl;\n    }\n    ```\n\n    \n\n# ç½‘ç»œIOæ¨¡å—\n\n## ChatServer\n\n### æˆå‘˜å±æ€§\n\n1. `TcpServer m_server` - **åŸºäºäº‹ä»¶é©±åŠ¨çš„ã€IOå¤ç”¨+epoll+çº¿ç¨‹æ± **çš„æœåŠ¡å™¨ç±»ï¼Œå®Œå…¨**åŸºäºReactoræ¨¡å‹**\n2. `EventLoop *m_loop` - mainLoopçš„æŒ‡é’ˆ, ä¿å­˜äº‹ä»¶å¾ªç¯. æœ‰äº†äº‹ä»¶å¾ªç¯çš„æŒ‡é’ˆï¼Œå¯ä»¥åœ¨åˆé€‚çš„æ—¶å€™è°ƒç”¨quité€€å‡ºäº‹ä»¶å¾ªç¯ï¼›\n\n```cpp\nprivate:\n    /* ç»„åˆçš„muduoåº“ï¼Œå®ç°æœåŠ¡å™¨åŠŸèƒ½çš„ç±»å¯¹è±¡ */\n    TcpServer _server;\n    /* æŒ‡å‘äº‹ä»¶å¾ªç¯å¯¹è±¡çš„æŒ‡é’ˆ */\n    EventLoop *_loop;\n```\n\n### æˆå‘˜å‡½æ•°\n\n1. æ„é€  - å‚æ•°ä¸º`loop`æŒ‡é’ˆ, `listenAddr`, `name`, ç”¨äºåˆå§‹åŒ–TcpServer\n   ```cpp\n   public:\n       /* åˆå§‹åŒ–èŠå¤©æœåŠ¡å™¨å¯¹è±¡ */\n       ChatServer(EventLoop* loop,\n                  const InetAddress& listenAddr,\n                  const string& nameArg);\n   ```\n\n2. `start` - å¯åŠ¨æœåŠ¡çš„æ¥å£\n\n   ```cpp\n   public:\n       void start();\n   ```\n\n3. `onConnection`/`onMessage` -  è¿æ¥åˆ›å»º/æ–­å¼€, è¯»å†™äº‹ä»¶å‘ç”Ÿçš„å›è°ƒå‡½æ•°\n   \n   ```cpp\n   private:\n       /* ä¸ŠæŠ¥é“¾æ¥ç›¸å…³ä¿¡æ¯çš„å›è°ƒå‡½æ•°ï¼ˆè¿æ¥åˆ›å»ºï¼Œè¿æ¥æ–­å¼€ï¼‰*/\n       void onConnection(const TcpConnectionPtr&);\n       /* ä¸ŠæŠ¥è¯»å†™äº‹ä»¶ç›¸å…³ä¿¡æ¯çš„å›è°ƒå‡½æ•° */\n       void onMessage(const TcpConnectionPtr&, Buffer*, Timestamp);\n   ```\n\n### ä»£ç å®ç°\n\n```cpp\n#ifndef CHATSERVER_H\n#define CHATSERVER_H\n#include <muduo/net/TcpServer.h>\n#include <muduo/net/EventLoop.h>\nusing namespace muduo;\nusing namespace muduo::net;\n/**\n * èŠå¤©æœåŠ¡å™¨çš„ä¸»ç±»;\n *\n * è¦æ³¨å†Œä¸¤ä¸ªæ–¹æ³•:\n * ç»™TcpServeræ³¨å†Œæ–°ç”¨æˆ·çš„è¿æ¥ã€è¿æ¥æ–­å¼€çš„ã€å·²è¿æ¥ç”¨æˆ·çš„å¯è¯»å†™äº‹ä»¶;\n */\nclass ChatServer\n{\npublic:\n    /* åˆå§‹åŒ–èŠå¤©æœåŠ¡å™¨å¯¹è±¡ */\n    ChatServer(EventLoop* loop,\n               const InetAddress& listenAddr,\n               const string& nameArg);\npublic:\n    /* å¯åŠ¨æœåŠ¡ */\n    void start();\n\nprivate:\n    /* ä¸ŠæŠ¥é“¾æ¥ç›¸å…³ä¿¡æ¯çš„å›è°ƒå‡½æ•°ï¼ˆè¿æ¥åˆ›å»ºï¼Œè¿æ¥æ–­å¼€ï¼‰*/\n    void onConnection(const TcpConnectionPtr&);\n    /* ä¸ŠæŠ¥è¯»å†™äº‹ä»¶ç›¸å…³ä¿¡æ¯çš„å›è°ƒå‡½æ•° */\n    void onMessage(const TcpConnectionPtr&, Buffer*, Timestamp);\n\n\nprivate:\n    /* ç»„åˆçš„muduoåº“ï¼Œå®ç°æœåŠ¡å™¨åŠŸèƒ½çš„ç±»å¯¹è±¡ */\n    TcpServer _server;\n    /* æŒ‡å‘äº‹ä»¶å¾ªç¯å¯¹è±¡çš„æŒ‡é’ˆ */\n    EventLoop *_loop;\n};\n#endif\n```\n\n## Reactoræ¨¡å‹\n\næœ¬é¡¹ç›®åŸºäºmuduoåº“ï¼Œæ¨¡å‹æ˜¯**åŸºäºäº‹ä»¶é©±åŠ¨çš„ã€IOå¤ç”¨+epoll+çº¿ç¨‹æ± **çš„ç½‘ç»œï¼Œå®Œå…¨**åŸºäºReactoræ¨¡å‹**ï¼Œçº¿ç¨‹æš‚æ—¶è®¾ç½®ä¸º4ä¸ªï¼Œæœ‰ä¸€ä¸ªä¸»Reactoræ˜¯IOçº¿ç¨‹ï¼Œä¸»è¦è´Ÿè´£æ–°ç”¨æˆ·çš„è¿æ¥ï¼Œ3ä¸ªsub-Reactoræ˜¯å·¥ä½œçº¿ç¨‹ï¼Œä¸»è¦è´Ÿè´£å·²è¿æ¥ç”¨æˆ·çš„è¯»å†™äº‹ä»¶çš„å¤„ç†ã€‚\n\n# ä¸šåŠ¡æ¨¡å—\n\n## ä¸šåŠ¡æ¨¡å—ä¸ç½‘ç»œæ¨¡å—è§£è€¦ - å›è°ƒ\n\nè€ƒè™‘é—®é¢˜ï¼šç½‘ç»œæ¨¡å—æ”¶åˆ°çš„æ¶ˆæ¯å¦‚ä½•æ´¾å‘åˆ°ä¸šåŠ¡æ¨¡å—ï¼Ÿè®©ç½‘ç»œæ¨¡å—çš„ä»£ç å’Œä¸šåŠ¡æ¨¡å—çš„ä»£ç è§£è€¦ã€‚\n\nå‡è®¾æœ‰ä¸€ä¸ªç”¨æˆ·åœ¨åšç™»å½•ä¸šåŠ¡ï¼Œç™»å½•ä¸šåŠ¡åŒ…å«messageIDï¼Œnameï¼Œpasswordï¼Œè¦éªŒè¯ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®ã€‚\n\nè§£è€¦çš„æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š\n\n1. ä½¿ç”¨åŸºäºé¢å‘æ¥å£çš„ç¼–ç¨‹ã€‚ï¼ˆæŠ½è±¡åŸºç±»ï¼‰\n2. **åŸºäºå›è°ƒå‡½æ•°**çš„æ“ä½œã€‚\n\n## ä¸šåŠ¡ç±»å‹\n\n1. ç™»å½• - `LOGIN_MSG/ACK`\n2. æ³¨å†Œ - `REG_MSG/ACK`\n3. åŠ å¥½å‹ - `ADD_FRIEND_MSG`\n4. ä¸€å¯¹ä¸€èŠå¤© - `ONE_CHAT_MSG`\n5. åˆ›å»ºç¾¤ç»„ - `CREATE_GROUP_MSG`\n6. åŠ å…¥ç¾¤ç»„ - `ADD_GROUP_MSG`\n7. ç¾¤èŠ - `GROUP_CHAT_MSG`\n\n```cpp\n#ifndef PUBLIC_H\n#define PUBLIC_H\n/* serverå’Œclientçš„å…¬å…±æ–‡ä»¶ */\n\nenum EnMsgType  //Enè¡¨ç¤ºEnumæšä¸¾\n{\n    LOGIN_MSG = 1,      //ç™»å½• æ¶ˆæ¯id, ä¸chatserviceä¸­çš„loginæ–¹æ³•ç»‘å®š\n    LOGIN_MSG_ACK,      //ç™»å½•å“åº”\n\n    REG_MSG,            //æ³¨å†Œ æ¶ˆæ¯id, ä¸chatserviceä¸­çš„regæ–¹æ³•ç»‘å®š\n    REG_MSG_ACK,        //æ³¨å†Œå“åº”\n\n    ADD_FRIEND_MSG,     //æ·»åŠ å¥½å‹\n    ONE_CHAT_MSG,       //ä¸€å¯¹ä¸€èŠå¤©\n\n    CREATE_GROUP_MSG,   //åˆ›å»ºç¾¤ç»„\n    ADD_GROUP_MSG,      //åŠ å…¥ç¾¤ç»„\n    GROUP_CHAT_MSG      //ç¾¤èŠ\n};\n\nenum EnLoginErrType\n{\n    LOGIN_SUCCEESS = 0,\n    LOGIN_REPEAT = 1,\n    LOGIN_NOTFOUND = 2,\n    LOGIN_WRONGPWD = 3\n};\n#endif\n```\n\n## ChatService\n\n### å‰ç½®å¤„ç†\n\n```cpp\n#include\"json.hpp\"\nusing json = nlohmann::json;\n```\n\n```cpp\n/* è¡¨ç¤ºå¤„ç†æ¶ˆæ¯çš„äº‹ä»¶å›è°ƒæ–¹æ³•ç±»å‹ */\nusing MsgHandler = std::function<void(const TcpConnectionPtr&, json&, Timestamp)>;\n```\n\n### æˆå‘˜å±æ€§\n\n1. `unordered_map<int, MsgHandler> m_msgHandlerMap` - æ˜ å°„æ¶ˆæ¯ç±»å‹id å’Œ äº‹ä»¶å›è°ƒå‡½æ•°\n\n   ```cpp\n   private:\n       /* å­˜å‚¨æ¶ˆæ¯idå’Œå…¶å¯¹åº”çš„ä¸šåŠ¡å¤„ç†æ–¹æ³• */\n       unordered_map<int, MsgHandler> m_msgHandlerMap;\n   ```\n\n2. `unordered_map<int, TcpConnectionPtr> m_userConnectionMap` - å­˜å‚¨åœ¨çº¿ç”¨æˆ·çš„é€šä¿¡è¿æ¥\n\n   ```cpp\n   private:\n       /* å­˜å‚¨åœ¨çº¿ç”¨æˆ·çš„é€šä¿¡è¿æ¥ */\n       unordered_map<int, TcpConnectionPtr> m_userConnectionMap;\n   ```\n\n3. `mutex m_connMutex` - å®šä¹‰äº’æ–¥é”ï¼Œä¿è¯`m_userConnectionMap`çš„çº¿ç¨‹å®‰å…¨\n\n   ```cpp\n   private:\n       /* å®šä¹‰äº’æ–¥é”ï¼Œä¿è¯m_userConnectionMapçš„çº¿ç¨‹å®‰å…¨ */\n       mutex _connMutex;\n   ```\n\n4. æ•°æ®æ“ä½œç±»å¯¹è±¡\n\n   1. UserModel - `m_userModel`\n   2. OfflineMsgModel - `m_offlineMsgModel`\n   3. FriendModel - `friendModel`\n   4. GroupModel - `groupModel`\n\n   ```cpp\n   private:\n       UserModel       _userModel;         /* æ•°æ®æ“ä½œç±»å¯¹è±¡ */\n       OfflineMsgModel _offlineMsgModel;   /* æ•°æ®æ“ä½œç±»å¯¹è±¡ */\n       FriendModel     _friendModel;       /* æ•°æ®æ“ä½œç±»å¯¹è±¡ */\n       GroupModel      _groupModel;        /* æ•°æ®æ“ä½œç±»å¯¹è±¡ */\n   ```\n\n### æˆå‘˜å‡½æ•°\n\n1. æ„é€ å‡½æ•° - ç§æœ‰åŒ–, å•ä¾‹å¤„ç†\n   ```cpp\n   public:\n       static ChatService * instance();\n   private:\n       ChatService();\n   ```\n\n2. ä¸šåŠ¡æ¥å£\n\n   1. login - ç™»é™†ä¸šåŠ¡\n   2. reg - æ³¨å†Œä¸šåŠ¡\n   3. addFriend - æ·»åŠ å¥½å‹ä¸šåŠ¡\n   4. oneChat - ä¸€å¯¹ä¸€èŠå¤©ä¸šåŠ¡\n   5. createGroup - åˆ›å»ºç¾¤ç»„ä¸šåŠ¡\n   6. addGroup - åŠ å…¥ç¾¤ç»„ä¸šåŠ¡\n   7. groupChat - ç¾¤ç»„èŠå¤©ä¸šåŠ¡\n\n   ```cpp\n   public:\n       /* å¤„ç†ç™»å½•ä¸šåŠ¡ */\n       void login(const TcpConnectionPtr &conn, json &js, Timestamp time);\n       /* å¤„ç†æ³¨å†Œä¸šåŠ¡ */\n       void reg(const TcpConnectionPtr &conn, json &js, Timestamp time);\n   \n       /* æ·»åŠ å¥½å‹ä¸šåŠ¡ */\n       void addFriend(const TcpConnectionPtr &conn, json &js, Timestamp time);\n       /* ä¸€å¯¹ä¸€èŠå¤©ä¸šåŠ¡ */\n       void oneChat(const TcpConnectionPtr &conn, json &js, Timestamp time);\n   \n       /* åˆ›å»ºç¾¤ç»„ä¸šåŠ¡ */\n       void createGroup(const TcpConnectionPtr &conn, json &js, Timestamp time);\n       /* åŠ å…¥ç¾¤ç»„ä¸šåŠ¡ */\n       void addGroup(const TcpConnectionPtr &conn, json &js, Timestamp time);\n       /* ç¾¤ç»„èŠå¤©ä¸šåŠ¡ */\n       void groupChat(const TcpConnectionPtr &conn, json &js, Timestamp time);\n   ```\n\n3. getHandler - è·å–æ¶ˆæ¯å¯¹åº”çš„å¤„ç†å™¨\n   ```cpp\n   public:\n       /* è·å–æ¶ˆæ¯å¯¹åº”çš„å¤„ç†å™¨ */\n       MsgHandler getHandler(int msgid);\n   ```\n\n4. clientCloseException - å¤„ç†å®¢æˆ·ç«¯å¼‚å¸¸é€€å‡º\n   ```cpp\n   public:\n       /* å¤„ç†å®¢æˆ·ç«¯å¼‚å¸¸é€€å‡º */\n       void clientCloseException(const TcpConnectionPtr & conn);\n   ```\n\n5. reset - ä¸šåŠ¡é‡ç½®æ–¹æ³•ï¼Œé€šå¸¸åœ¨æœåŠ¡å™¨å¼‚å¸¸é€€å‡ºæ—¶è°ƒç”¨\n   ```cpp\n   public:\n       /* ä¸šåŠ¡é‡ç½®æ–¹æ³•ï¼Œé€šå¸¸åœ¨æœåŠ¡å™¨å¼‚å¸¸é€€å‡ºæ—¶è°ƒç”¨ */\n       void reset();\n   ```\n\n### ä»£ç å®ç°\n\n```cpp\n#ifndef CHATSERVICE_H\n#define CHATSERVICE_H\n#include<muduo/net/TcpConnection.h>\n#include<unordered_map>\n#include<functional>\n\n#include\"usermodel.hpp\"\n#include\"offlinemsgmodel.hpp\"\n#include\"friendmodel.hpp\"\n#include\"groupmodel.hpp\"\n\nusing namespace std;\nusing namespace muduo;\nusing namespace muduo::net;\n#include\"json.hpp\"\nusing json = nlohmann::json;\n\n#include<mutex>\n\n/* è¡¨ç¤ºå¤„ç†æ¶ˆæ¯çš„äº‹ä»¶å›è°ƒæ–¹æ³•ç±»å‹ */\nusing MsgHandler = std::function<void(const TcpConnectionPtr&, json&, Timestamp)>;\n/**\n * èŠå¤©æœåŠ¡å™¨ä¸šåŠ¡ç±». \n * ç”¨æ˜ å°„å…³ç³»æ¥å­˜å‚¨æ¶ˆæ¯idå’Œå…·ä½“å¤„ç†å‡½æ•°. \n * æ­¤ç±»æœ‰ä¸€ä¸ªå®ä¾‹å°±å¤Ÿäº†ï¼Œæ‰€ä»¥é‡‡ç”¨å•ä¾‹æ¨¡å¼. \n */\nclass ChatService\n{\npublic:\n    /* è·å–å•ä¾‹å¯¹è±¡çš„æ¥å£å‡½æ•° */\n    static ChatService* instance();\npublic:\n    /* å¤„ç†ç™»å½•ä¸šåŠ¡ */\n    void login(const TcpConnectionPtr &conn, json &js, Timestamp time);\n    /* å¤„ç†æ³¨å†Œä¸šåŠ¡ */\n    void reg(const TcpConnectionPtr &conn, json &js, Timestamp time);\n\n    /* æ·»åŠ å¥½å‹ä¸šåŠ¡ */\n    void addFriend(const TcpConnectionPtr &conn, json &js, Timestamp time);\n    /* ä¸€å¯¹ä¸€èŠå¤©ä¸šåŠ¡ */\n    void oneChat(const TcpConnectionPtr &conn, json &js, Timestamp time);\n\n    /* åˆ›å»ºç¾¤ç»„ä¸šåŠ¡ */\n    void createGroup(const TcpConnectionPtr &conn, json &js, Timestamp time);\n    /* åŠ å…¥ç¾¤ç»„ä¸šåŠ¡ */\n    void addGroup(const TcpConnectionPtr &conn, json &js, Timestamp time);\n    /* ç¾¤ç»„èŠå¤©ä¸šåŠ¡ */\n    void groupChat(const TcpConnectionPtr &conn, json &js, Timestamp time);\npublic:\n    /* è·å–æ¶ˆæ¯å¯¹åº”çš„å¤„ç†å™¨ */\n    MsgHandler getHandler(int msgid);\npublic:\n    /* å¤„ç†å®¢æˆ·ç«¯å¼‚å¸¸é€€å‡º */\n    void clientCloseException(const TcpConnectionPtr & conn);\npublic:\n    /* ä¸šåŠ¡é‡ç½®æ–¹æ³•ï¼Œé€šå¸¸åœ¨æœåŠ¡å™¨å¼‚å¸¸é€€å‡ºæ—¶è°ƒç”¨ */\n    void reset();\n\nprivate:\n    ChatService();\nprivate:\n    UserModel       _userModel;         /* æ•°æ®æ“ä½œç±»å¯¹è±¡ */\n    OfflineMsgModel _offlineMsgModel;   /* æ•°æ®æ“ä½œç±»å¯¹è±¡ */\n    FriendModel     _friendModel;       /* æ•°æ®æ“ä½œç±»å¯¹è±¡ */\n    GroupModel      _groupModel;        /* æ•°æ®æ“ä½œç±»å¯¹è±¡ */\nprivate:\n    /* å®šä¹‰äº’æ–¥é”ï¼Œä¿è¯m_userConnectionMapçš„çº¿ç¨‹å®‰å…¨ */\n    mutex _connMutex;\nprivate:\n    /* å­˜å‚¨æ¶ˆæ¯idå’Œå…¶å¯¹åº”çš„ä¸šåŠ¡å¤„ç†æ–¹æ³• */\n    unordered_map<int, MsgHandler> _msgHandlerMap;\n    /* å­˜å‚¨åœ¨çº¿ç”¨æˆ·çš„é€šä¿¡è¿æ¥ */\n    unordered_map<int, TcpConnectionPtr> _userConnectionMap;\n};\n#endif\n```\n\n# æ•°æ®æ¨¡å—\n\n## ä¸šåŠ¡æ¨¡å—ä¸æ•°æ®æ¨¡å—è§£è€¦ - ORMæ¡†æ¶\n\n> Object Relation Map - å¯¹è±¡å…³ç³»æ˜ å°„ã€‚\n\nåœ¨è¿™ä¸ªæ¡†æ¶ä¸­ï¼Œä¸šåŠ¡å±‚æ“ä½œçš„éƒ½æ˜¯å¯¹è±¡ï¼Œçœ‹ä¸åˆ°å…·ä½“çš„SQLæ“ä½œã€‚\n\nåœ¨DAOå±‚ï¼ˆæ•°æ®å±‚ï¼‰ï¼Œæ‰æœ‰å…·ä½“çš„æ•°æ®åº“æ“ä½œã€‚\n\nè§£å†³äº†ç—›ç‚¹ï¼šä¸šåŠ¡æ¨¡å—ã€æ•°æ®æ¨¡å—ä¹‹é—´çš„è§£è€¦ã€‚\n\n## æ­å»ºMySQLæ•°æ®åº“ç¯å¢ƒ\n\n(ä»¥ä¸‹å‘½ä»¤åŸºäºubuntuç¯å¢ƒ)\n\n1. å®‰è£…mysql-serverå’Œmysqlå¼€å‘åŒ…, åŒ…æ‹¬mysqlå¤´æ–‡ä»¶å’ŒåŠ¨æ€åº“æ–‡ä»¶\n   ```bash\n   \n   sudo apt-get install mysql-server\t\t#å®‰è£…æœ€æ–°ç‰ˆMySQLæœåŠ¡å™¨\n   sudo apt-get install libmysqlclient-dev #å®‰è£…å¼€å‘åŒ…\n   ```\n\n2. åˆå§‹çš„ç”¨æˆ·åå’Œå¯†ç æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼ŒæŒ‰ä¸‹é¢æ­¥éª¤ä¿®æ”¹mysqlçš„rootç”¨æˆ·å¯†ç ä¸º123456\n   ```bash\n   ~$ sudo cat /etc/mysql/debian.cnf\n   \n   [client]\n   host = localhost\n   user = debian-sys-maint \t\t\t#åˆå§‹çš„ç”¨æˆ·å\n   password = Kk3TbShbFNvjvhpM\t\t\t#åˆå§‹çš„å¯†ç \n   socket = /var/run/mysqld/mysqld.sock\n   ```\n\n   ```bash\n   # ç”¨ä¸Šé¢åˆå§‹çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œç™»å½•mysql serverï¼Œä¿®æ”¹rootç”¨æˆ·çš„å¯†ç ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š\n   ~$ mysql -u debian-sys-maint -pKk3TbShbFNvjvhpM\n   #-uåé¢æ˜¯ä¸Šé¢æŸ¥çœ‹çš„ç”¨æˆ·å; -påé¢ç´§è·Ÿä¸Šé¢æŸ¥çœ‹çš„å¯†ç \n   ```\n\n   ```mysql\n   mysql> update mysql.user set authentication_string=password('123456') where user='root' and host='localhost';\n   mysql> update mysql.user set plugin=\"mysql_native_password\";\n   mysql> flush privileges;\n   Query OK, 0 rows affected (0.01 sec)\n   mysql> exit\n   Bye\n   ```\n\n3. è®¾ç½®MySQLå­—ç¬¦ç¼–ç utf-8ï¼Œä»¥æ”¯æŒä¸­æ–‡æ“ä½œ\n   ```mysql\n   mysql> show variables like \"char%\"; # å…ˆæŸ¥çœ‹MySQLé»˜è®¤çš„å­—ç¬¦ç¼–ç \n   +--------------------------+----------------------------+\n   | Variable_name\t\t\t   | Value\t\t\t   \t\t\t|\n   +--------------------------+----------------------------+\n   | character_set_client     | utf8                       |\n   | character_set_connection | utf8                       |\n   | character_set_database   | latin1                     |\n   | character_set_filesystem | binary                     |\n   | character_set_results    | utf8                       |\n   | character_set_server     | latin1                     |#ä¸æ”¯æŒä¸­æ–‡ï¼ï¼ï¼\n   | character_set_system     | utf8                       |\n   | character_sets_dir       | /usr/share/mysql/charsets/ |\n   +--------------------------+----------------------------+\n   8 rows in set (0.06 sec)\n   \n   mysql> set character_set_server=utf8;\n   Query OK, 0 rows affected (0.00 sec)\n   ```\n\n4. ä¿®æ”¹è¡¨çš„å­—ç¬¦ç¼–ç ï¼š`alter table user default character set utf8;`\n   ä¿®æ”¹å±æ€§çš„å­—ç¬¦ç¼–ç ï¼š`alter table user modify column name varchar(50) character set utf8;`\n\n## MySQLç±» - å°è£…MySQLæ“ä½œ\n\néœ€è¦å¼•å…¥`mysql/mysql.h`å¤´æ–‡ä»¶\n```cpp\n#include<mysql/mysql.h>\n```\n\n### æˆå‘˜å˜é‡\n\n`MYSQL *m_conn` - è®°å½•MYSQLç±»å‹çš„æŒ‡é’ˆ, ä»¥è·å–è¿™ä¸ªmysqlè¿æ¥\n\n```cpp\nprivate:\n    MYSQL *m_conn;\n```\n\n### æˆå‘˜å‡½æ•°\n\n1. æ„é€ /ææ„ - åˆå§‹åŒ–/é‡Šæ”¾æ•°æ®åº“è¿æ¥\n   ```cpp\n   public:\n       /* åˆå§‹åŒ–æ•°æ®åº“è¿æ¥ */\n       MySQL();\n       /* é‡Šæ”¾æ•°æ®åº“è¿æ¥èµ„æº */\n       ~MySQL();\n   ```\n\n2. getConnection - è·å–è¿æ¥, å³è·å–æˆå‘˜`m_conn`\n   ```cpp\n   public:\n       /* è·å–è¿æ¥ */\n       MYSQL * getConnection();\n   ```\n\n3. connect - è¿æ¥æ•°æ®åº“, è¿”å›å€¼ä¸ºbool, è¯´æ˜è¿æ¥æˆåŠŸä¸å¦\n   ```cpp\n   public:\n       /* è¿æ¥æ•°æ®åº“ */\n       bool connect();\n   ```\n\n4. query - æŸ¥è¯¢æ“ä½œ, å‚æ•°æ˜¯stringç±»å‹çš„sqlè¯­å¥, è¿”å›å€¼ä¸º`MYSQL_RES`, å³MySQLç»“æœé›†ç±»å‹\n   ```cpp\n   public:\n       /* æŸ¥è¯¢æ“ä½œ */\n       MYSQL_RES * query(string sql);\n   ```\n\n5. update - æ›´æ–°æ“ä½œ, å‚æ•°æ˜¯stringç±»å‹çš„sqlè¯­å¥, è¿”å›å€¼ä¸ºbool, è¯´æ˜æ›´æ–°æˆåŠŸä¸å¦\n   ```cpp\n   public:\n       /* æ›´æ–°æ“ä½œ */\n       bool update(string sql);\n   ```\n\n### ä»£ç å®ç°\n\nå‰ç½®å…¨å±€å£°æ˜\n```cpp\n#include <muduo/base/Logging.h>\t//æ—¥å¿—å·¥å…·\n/* æ•°æ®åº“é…ç½®ä¿¡æ¯ */\nstatic string server = \"127.0.0.1\";\nstatic string user = \"root\";\nstatic string password = \"123\";\nstatic string dbname = \"chat\";\n```\n\n1. æ„é€  - è°ƒç”¨`mysql_init`, å®é™…ä¸Šåªæ˜¯å¯¹mysqlè¿æ¥è¿›è¡Œç©ºé—´èµ„æºçš„å¼€è¾Ÿ, è¿”å›ä¸€ä¸ªæŒ‡é’ˆèµ‹ç»™`m_conn`æˆå‘˜, æ²¡æœ‰çœŸæ­£è¿æ¥, å› æ­¤ä¼ å…¥nullptr\n   ```cpp\n   /* åˆå§‹åŒ–æ•°æ®åº“è¿æ¥ */\n   MySQL::MySQL()\n   {\n       m_conn = mysql_init(nullptr);\n   }\n   ```\n\n2. ææ„ - è°ƒç”¨`mysql_close(m_conn)`, å¯¹MySQLè¿æ¥èµ„æºè¿›è¡Œé‡Šæ”¾\n   ```cpp\n   /* é‡Šæ”¾æ•°æ®åº“è¿æ¥èµ„æº */\n   MySQL::~MySQL()\n   {\n       if(m_conn != nullptr)\n       {\n           mysql_close(m_conn);\n       }\n   }\n   ```\n\n3. getConnection - è·å–è¿æ¥, å³è¿”å›`m_conn`æˆå‘˜\n   ```cpp\n   /* è·å–è¿æ¥ */\n   MYSQL * MySQL::getConnection()\n   {\n       return m_conn;\n   }\n   ```\n\n4. connect - è¿æ¥æ•°æ®åº“, å†…éƒ¨è°ƒç”¨`mysql_real_connect`, ä¼ å…¥`m_conn`, ä»¥åŠserveråœ°å€, userå·, å¯†ç , è¦è¿æ¥çš„æ•°æ®åº“name, æœåŠ¡å™¨ç«¯å£;\n   ```cpp\n   /* è¿æ¥æ•°æ®åº“ */\n   bool MySQL::connect()\n   {\n       MYSQL *p = mysql_real_connect(m_conn, server.c_str(), user.c_str(),\n                                     password.c_str(), dbname.c_str(), 3306, nullptr, 0);\n       if(p != nullptr)\n       {\n           /* C/C++ä»£ç é»˜è®¤çš„ç¼–ç å­—ç¬¦æ˜¯ASCIIï¼Œå¦‚æœä¸è®¾ç½®ï¼Œåˆ™ä»MySQLä¸Šæ‹‰ä¸‹æ¥çš„ä¸­æ–‡æ— æ³•æ­£å¸¸æ˜¾ç¤º */\n           mysql_query(m_conn, \"set name gbk\");\n           LOG_INFO << \"connect mysql success!\";\n       }\n       else\n       {\n           LOG_INFO << \"connect mysql failed!\";\n       }\n       return p;\n   }\n   ```\n\n5. query - æŸ¥è¯¢æ“ä½œ\n\n   1. å†…éƒ¨è°ƒç”¨`mysql_query`, ä¼ å…¥`m_conn`, `sql-string`çš„cé£æ ¼å­—ç¬¦ä¸²é¦–å€;\n\n      > `mysql_query`çš„è¿”å›å€¼: \n      >\n      > 1. å¦‚æœæŸ¥è¯¢æˆåŠŸï¼Œè¿”å›0;\n      > 2. å¦‚æœå‡ºç°é”™è¯¯ï¼Œè¿”å›é0å€¼ã€‚\n\n   2. è¿”å›å€¼éœ€è¦è°ƒç”¨`mysql_use_result(m_conn)`è·å–ç»“æœé›†, å†return;\n\n   ```cpp\n   /* æŸ¥è¯¢æ“ä½œ */\n   MYSQL_RES * MySQL::query(string sql)\n   {\n       if(mysql_query(m_conn, sql.c_str()))\n       {\n           LOG_INFO << __FILE__ << \":\" << __LINE__ << \":\" << sql << \"æŸ¥è¯¢å¤±è´¥!\";\n           return nullptr;\n       }\n       return mysql_use_result(m_conn);\n   }\n   ```\n\n6. update - æ›´æ–°æ“ä½œ\n\n   1. å†…éƒ¨è°ƒç”¨`mysql_query`, ä¼ å…¥`m_conn`, `sql-string`çš„cé£æ ¼å­—ç¬¦ä¸²é¦–å€;\n   2. åˆ¤æ–­`mysql_query`çš„è¿”å›å€¼, è‹¥ä¸ºé0åˆ™æ›´æ–°å¤±è´¥; è‹¥ä¸º0åˆ™æ›´æ–°æˆåŠŸ;\n\n   ```cpp\n   /* æ›´æ–°æ“ä½œ */\n   bool MySQL::update(string sql)\n   {\n       if(mysql_query(m_conn, sql.c_str()))\n       {\n           LOG_INFO << __FILE__ << \":\" << __LINE__ << \":\" << sql << \"æ›´æ–°å¤±è´¥!\";\n           return false;\n       }\n       return true;\n   }\n   ```\n\n## Modelå±‚ - å¯¹ä¸šåŠ¡å±‚å°è£…åº•å±‚æ•°æ®åº“çš„æ“ä½œ\n\nä»¥Userç±»çš„æ“ä½œä¸ºä¾‹\n\n### Userç±»\n\n```cpp\n#ifndef USER_H\n#define USER_H\n#include<string>\nusing namespace std;\n/**\n * å±äºæ˜ å°„ç±»;\n * åŒ¹é…Userè¡¨çš„ORMç±»;\n */\nclass User\n{\npublic:\n    User(int id = -1, string name=\"\", string password=\"\", string state=\"offline\")\n        : id_(id), name_(name), password_(password), state_(state)\n    {   \n    }\npublic:\n    void setId(int id){id_ = id;}\n    void setName(string name){name_ = name;}\n    void setPassword(string password){password_ = password;}\n    void setState(string state){state_ = state;}\npublic:\n    int getId() const{return id_;}\n    string getName() const{return name_;}\n    string getPassword() const{return password_;}\n    string getState() const{return state_;}\nprivate:\n    int id_;\n    string name_;\n    string password_;\n    string state_;\n};\n#endif\n```\n\n### UserModelç±»\n\n1. insert - å‚æ•°ä¸ºUserçš„å¼•ç”¨, è¿”å›å€¼ä¸ºbool\n2. query - å‚æ•°ä¸ºid, è¿”å›å€¼ä¸ºUser\n3. updateState - æ›´æ–°ç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯, å‚æ•°ä¸ºUserçš„ä¸€ä¸ªä¸´æ—¶å‰¯æœ¬, è¿”å›bool\n4. resetAllState - é‡ç½®æ‰€æœ‰ç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯\n\n```cpp\n#ifndef USERMODEL_H\n#define USERMODEL_H\n#include\"user.hpp\"\n/* Userè¡¨çš„æ•°æ®æ“ä½œç±» */\nclass UserModel\n{\npublic:\n    /* Userè¡¨çš„å¢åŠ æ–¹æ³• */\n    bool insert(User &user);\npublic:\n    /* æ ¹æ®ç”¨æˆ·å·ç æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ */\n    User query(int id);\npublic:\n    /* æ›´æ–°ç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯ */\n    bool updateState(User user);\n    /* é‡ç½®æ‰€æœ‰ç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯ */\n    void resetAllState();\n};\n#endif\n```\n\n#### ä»£ç å®ç°\n\n```cpp\n#include\"usermodel.hpp\"\n#include\"db.h\"\n#include<iostream>\nusing namespace std;\n/* Userè¡¨çš„å¢åŠ æ–¹æ³• */\nbool UserModel::insert(User &user)\n{\n    /* 1.ç»„è£…SQLè¯­å¥ */\n    char sql[1024] = {0};\n    sprintf(sql, \"insert into user(name, password, state) values('%s', '%s', '%s')\",\n        user.getName().c_str(), user.getPassword().c_str(), user.getState().c_str());\n    MySQL mysql;\n    if(mysql.connect())\n    {\n        if(mysql.update(sql))\n        {\n            /* è·å–æ’å…¥æˆåŠŸçš„ç”¨æˆ·æ•°æ®ç”Ÿæˆçš„ä¸»é”®id */\n            /* ä»¥ä¸‹çš„mysql_insert_idæ˜¯ç”Ÿæˆidçš„æ–¹æ³•ä¹‹ä¸€ */\n            user.setId(mysql_insert_id(mysql.getConnection()));\n            return true;\n        }\n    }\n    /* æ³¨å†Œå¤±è´¥ */\n    return false;\n}\n/* æ ¹æ®ç”¨æˆ·å·ç æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ */\nUser UserModel::query(int id)\n{\n    /* 1.ç»„è£…SQLè¯­å¥ */\n    char sql[1024] = {0};\n    sprintf(sql, \"select * from user where id = %d\", id);\n    MySQL mysql;\n    if(mysql.connect())\n    {\n        /* mysql.queryå†…éƒ¨ç”³è¯·äº†èµ„æºï¼Œå¤„ç†å®ŒæˆUserçš„æ„é€ åï¼Œéœ€è¦free */\n        MYSQL_RES *res = mysql.query(sql);  // æ­¤queryä¸ºMySQLçš„queryï¼Œå’ŒupdateåŒçº§ã€‚\n        if(res != nullptr)\n        {\n            MYSQL_ROW row = mysql_fetch_row(res);\n            if(row != nullptr)\n            {\n                User user;\n                user.setId(atoi(row[0]));\n                user.setName(row[1]);\n                user.setPassword(row[2]);\n                user.setState(row[3]);\n                mysql_free_result(res);\n                return user;\n            }\n        }\n    }\n    /* å¦‚æœæ²¡æœ‰æœ‰æ•ˆçš„æŸ¥è¯¢ç»“æœï¼Œè¿”å›ä¸€ä¸ªé»˜è®¤Userï¼Œidä¸º-1ï¼Œè¡¨ç¤ºå‡ºé”™ */\n    return User();\n}\n/* æ›´æ–°ç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯ */\nbool UserModel::updateState(User user)\n{\n    /* 1.ç»„è£…SQLè¯­å¥ */\n    char sql[1024] = {0};\n    sprintf(sql, \"update user set state = '%s' where id = %d\", user.getState().c_str(), user.getId());\n    MySQL mysql;\n    if(mysql.connect())\n    {\n        if(mysql.update(sql))\n        {\n            return true;\n        }\n    }\n    return false;\n}\n/* é‡ç½®æ‰€æœ‰ç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯ */\nvoid UserModel::resetAllState()\n{\n    char sql[1024] = \"update user set state = 'offline' where state = 'online'\";\n    MySQL mysql;\n    if(mysql.connect())\n    {\n        mysql.update(sql);\n    }\n}\n```\n\n# æµ‹è¯•\n\nç‚¹å¯¹ç‚¹èŠå¤©\n\n```bash\n./ChatServer\n```\n\nç‚¹å¯¹ç‚¹èŠå¤©çš„jsonæ ¼å¼ï¼š`{\"msgid\":5,\"from\":\"from_name\",\"to\":to_id,\"msg\":\"......\"}`\n\n```bash\n# xcg\ntelnet 127.0.0.1 6000\n{\"msgid\":1,\"id\":22,\"password\":\"123\"}\t#ç™»å½•\n{\"msgid\":5,\"from\":\"xcg\",\"to\":13,\"msg\":\"hello zhang san, i'm xcg!\"}\t#å‘é€æ¶ˆæ¯\n# å‘é€ç¦»çº¿æ¶ˆæ¯\n{\"msgid\":5,\"from\":\"xcg\",\"to\":13,\"msg\":\"hello - 1\"}\n{\"msgid\":5,\"from\":\"xcg\",\"to\":13,\"msg\":\"hello - 2\"}\n{\"msgid\":5,\"from\":\"xcg\",\"to\":13,\"msg\":\"hello - 3\"}\n\n```\n\n```bash\n# zhang san\ntelnet 127.0.0.1 6000\n{\"msgid\":1,\"id\":13,\"password\":\"123456\"}\t#ç™»å½•\n{\"msgid\":5,\"from\":\"zhang san\",\"to\":22,\"msg\":\"hello xcg, i'm zhang san!\"}#å‘é€æ¶ˆæ¯\n\n```\n\n# å¥½å‹ä¸šåŠ¡\n\n1. æ˜¾ç¤ºæœ‰å“ªäº›å·²æ·»åŠ çš„å¥½å‹ï¼Œid\n2. æ·»åŠ å¥½å‹\n\nä½†æ˜¯ä¸šåŠ¡å¹¶ä¸ä¸¥æ ¼ï¼Œåªè¦çŸ¥é“å…¶idå³å¯èŠå¤©ã€‚\n\næ€»ä½“ä¸šåŠ¡æµç¨‹ï¼šå‘æœåŠ¡å™¨å‘èµ·æ·»åŠ å¥½å‹çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨å°±æŠŠå…³ç³»æ·»åŠ åˆ°friendè¡¨ä¸­ï¼Œåˆç‰ˆæœ¬ä¸ç”¨å¾è¯¢å¯¹æ–¹çš„åŒæ„ã€‚\n\nfriendè¡¨å°±ä¸¤ä¸ªå­—æ®µï¼šuseridã€friendidæ˜¯è”åˆä¸»é”®ã€‚\n\n## æµ‹è¯•\n\næ·»åŠ å¥½å‹ã€ç™»é™†æˆåŠŸåæ˜¾ç¤ºå¥½å‹åˆ—è¡¨\n\n```bash\n./ChatServer\n```\n\næ·»åŠ å¥½å‹çš„jsonæ ¼å¼ï¼š`{\"msgid\":6,\"id\":22,\"friendid\":13}`ã€‚æ­¤è¯­å¥æ„ä¸ºï¼šidä¸º22çš„ç”¨æˆ·ä¸»åŠ¨æ·»åŠ idä¸º13çš„ç”¨æˆ·ä¸ºå¥½å‹ï¼Œå»ºç«‹åŒå‘å…³ç³»ã€‚\n\næ·»åŠ åï¼ŒæŸ¥çœ‹friendè¡¨ä¸­æ˜¯å¦æœ‰ä¿¡æ¯ï¼Œåº”æœ‰ä¸€ä¸ªid:22 - friendid:13ã€‚\n\n```mysql\nselect * from friend;\n```\n\n\n\n```bash\n# xcg\ntelnet 127.0.0.1 6000\n{\"msgid\":1,\"id\":22,\"password\":\"123\"}\t# ç™»å½•\n{\"msgid\":6,\"id\":22,\"friendid\":13}\t# æ·»åŠ id:13ä¸ºå¥½å‹\n\n# Ctrl + ] -> quit é€€å‡º\n# é‡æ–°ç™»é™†\ntelnet 127.0.0.1 6000\n{\"msgid\":1,\"id\":22,\"password\":\"123\"}\t# ç™»å½•\n# çœ‹çœ‹æ˜¯å¦è¿”å›å¥½å‹åˆ—è¡¨\n```\n\n# ç¾¤ç»„ä¸šåŠ¡\n\n1. ç®¡ç†å‘˜åˆ›å»ºç¾¤\n2. ç”¨æˆ·åŠ å…¥ç¾¤\n3. ç¾¤èŠ\n\n## è¡¨\n\nä¸ç¾¤ç»„ä¸šåŠ¡ç›¸å…³çš„æœ‰ä¸¤å¼ è¡¨ï¼šä¸€ä¸ªæ˜¯AllGroupè¡¨ï¼Œä¸€ä¸ªæ˜¯GroupUserè¡¨ã€‚\n\nAllGroupè¡¨æœ‰ä¸‰ä¸ªå­—æ®µï¼šidã€groupnameã€groupdesc(ç¾¤ç»„æè¿°)\n\nGroupUserè¡¨ï¼Œå› ä¸ºç¾¤å’Œæˆå‘˜ä¹‹é—´æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼Œæ‰€ä»¥éœ€è¦æ­¤ä¸­é—´è¡¨æ¥æè¿°è¿™ä¸ªå…³ç³»ã€‚æœ‰ä¸‰ä¸ªå­—æ®µï¼šgroupidã€useridã€grouprole(æˆå‘˜åœ¨ç¾¤ä¸­çš„æƒé™)ã€‚groupidå’Œuseridæ˜¯è”åˆä¸»é”®ã€‚\n\nè¿™ä¸¤å¼ è¡¨éƒ½æ˜¯å¤„ç†ç¾¤ç»„ä¸šåŠ¡çš„ï¼Œæ‰€ä»¥å¯¹åº”çš„modelåªåˆ›å»ºäº†ä¸€ä¸ªã€‚\n\n## model\n\ngroupmodel.hpp\n\n# è´Ÿè½½å‡è¡¡\n\nè´Ÿè½½å‡è¡¡å™¨, äº¦å«åšåå‘ä»£ç†æœåŠ¡å™¨, åœ¨é›†ç¾¤æœåŠ¡å™¨æ¶æ„ä¸­, ä½œä¸ºç»Ÿä¸€æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚çš„ç«¯å£, å…¶æ ¹æ®é…ç½®æ‰€ç•Œå®šçš„è´Ÿè½½ç®—æ³•, æŠŠå®¢æˆ·ç«¯çš„è¯·æ±‚åˆ†å‘åˆ°ä¸šåŠ¡æœåŠ¡å™¨ä¸Š, è¦åšçš„ä¸‰ä»¶äº‹æƒ…ï¼š\n\n1. æŠŠclientçš„è¯·æ±‚æŒ‰ç…§è´Ÿè½½å‡è¡¡ç®—æ³•åˆ†å‘åˆ°å…·ä½“çš„ä¸šåŠ¡æœåŠ¡å™¨ChatServerä¸Šé¢ï¼›ç›¸åº”åœ°, æœåŠ¡å™¨çš„å“åº”ä¹Ÿè¦ç»è¿‡è´Ÿè½½å‡è¡¡å™¨, å‡†ç¡®åœ°è¿”å›ç»™è¿™ä¸ªclient; \n\n   > æœåŠ¡å™¨çš„å“åº”æ¶ˆæ¯æ“ä½œ, ä¹Ÿå¯ä»¥é€šè¿‡æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å»ºç«‹ä¸€ä¸ªipéš§é“å®ç°, è¾¾åˆ°ç›´æ¥è¿æ¥, è¿™æ ·çš„æ•ˆç‡æ›´å¥½; \n2. èƒ½å¤Ÿå’ŒChatServerä¿æŒå¿ƒè·³æœºåˆ¶ï¼Œç›‘æµ‹ChatServeræ•…éšœï¼›\n3. èƒ½å¤Ÿå‘ç°æ–°æ·»åŠ çš„ChatServerè®¾å¤‡ï¼Œæ–¹ä¾¿æ‰©å±•æœåŠ¡å™¨æ•°é‡, æœ€å¥½æ˜¯èƒ½å¤Ÿå¹³æ»‘åœ°å®Œæˆè¿™ä¸ªè¿‡ç¨‹, è€Œä¸æ˜¯éœ€è¦é‡å¯è´Ÿè½½å‡è¡¡æœåŠ¡å™¨å¯¼è‡´æœåŠ¡åœæ­¢ã€‚\n\n## nginxè´Ÿè½½å‡è¡¡æ¨¡å—\n\næœ¬é¡¹ç›®é€‰æ‹©nginxçš„tcpè´Ÿè½½å‡è¡¡æ¨¡å—ï¼Œè¦è§£å†³çš„é—®é¢˜\n\n1. å¦‚ä½•è¿›è¡Œnginxæºç ç¼–è¯‘ï¼ŒåŒ…å«tcpè´Ÿè½½å‡è¡¡æ¨¡å—\n2. nginx.confé…ç½®æ–‡ä»¶ä¸­å¦‚ä½•é…ç½®è´Ÿè½½å‡è¡¡\n3. nginxçš„å¹³æ»‘åŠ è½½é…ç½®æ–‡ä»¶å¯åŠ¨\n\nnginxåœ¨1.9ç‰ˆæœ¬ä¹‹å‰ï¼Œåªæ”¯æŒhttpåè®®webæœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡ï¼Œä»1.9ç‰ˆæœ¬å¼€å§‹ä»¥åï¼Œnginxå¼€å§‹æ”¯æŒtcpçš„é•¿è¿æ¥è´Ÿè½½å‡è¡¡ï¼Œä½†æ˜¯nginxé»˜è®¤ä¸ç¼–è¯‘tcpè´Ÿè½½å‡è¡¡æ¨¡å—ï¼Œç¼–å†™å®ƒæ—¶ï¼Œéœ€è¦åŠ å…¥`--with-stream`å‚æ•°æ¥æ¿€æ´»è¿™ä¸ªæ¨¡å—ã€‚\n\n### ç¼–è¯‘å®‰è£…æ“ä½œæµç¨‹\n\nä»¥`nginx-1.12.2.tar.gz`ä¸ºä¾‹;\n\nnginxç¼–è¯‘å®‰è£…éœ€è¦å…ˆå®‰è£…pcreã€opensslã€zlibç­‰åº“ã€‚\n\n>å¯¹å¼€æºäº§å“å‘è¡Œæºä»£ç çš„ç¼–è¯‘å®‰è£…, ä¸€èˆ¬éƒ½æ˜¯: \n>\n>1. å…ˆæ‰§è¡Œ`./configure`, ç”Ÿäº§ç›¸åº”çš„makefileæ–‡ä»¶;\n>2. `make`, è¿›è¡Œç¼–è¯‘\n>3. `make install`, è¿›è¡Œå®‰è£…\n\nè§£å‹`nginx-1.12.2.tar.gz`åï¼Œè¿›å…¥`nginx-1.12.2`ç›®å½•ï¼Œå…ˆè¿è¡Œ`./configure --with-stream`ç”Ÿæˆ`Makefile`åï¼Œè¿è¡Œ`make`ï¼Œæœ€å`make install`ã€‚make installå‘½ä»¤ä¼šå‘ç³»ç»Ÿè·¯å¾„æ‹·è´æ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦åœ¨rootç”¨æˆ·ä¸‹æ‰§è¡Œã€‚\n\nç¼–è¯‘å®Œæˆåï¼Œé»˜è®¤å®‰è£…åœ¨äº†`/usr/local/nginx`ç›®å½•ã€‚\n\n`nginx`ç›®å½•ä¸‹ï¼Œå¯æ‰§è¡Œæ–‡ä»¶åœ¨`sbin`ç›®å½•é‡Œï¼Œé…ç½®æ–‡ä»¶åœ¨`conf`ç›®å½•é‡Œã€‚\n\n### é…ç½®\n\nå¦‚ä½•é…ç½®è´Ÿè½½å‡è¡¡?\n\n`/usr/local/nginx/conf/nginx.conf`ä¸­, å¯ä»¥çœ‹åˆ°httpå­—æ®µ, è¿™æ˜¯åŸºäºhttpçš„è´Ÿè½½å‡è¡¡é…ç½®; \n\n```nginx\n#user  nobody;\nworker_processes  1;\n\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n    sendfile        on;\n    keepalive_timeout  65;\n    server {\n        listen       80;\n        server_name  localhost;\n        location / {\n            root /var/www/hexo;\n            index  index.html index.htm;\n        }\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n    }\n}\n```\n\nè€Œæœ¬é¡¹ç›®æ˜¯tcpæœåŠ¡å™¨, éœ€è¦å†™åˆ°`stream`ä¸‹, è¡¨ç¤ºåŸºäºtcpçš„è´Ÿè½½å‡è¡¡é…ç½®; \n\n1. serverå­—æ®µ\n   1. listen - nginxè´Ÿè½½å‡è¡¡å™¨å°†è¦ç›‘å¬çš„ç«¯å£å·\n   2. `proxy_pass` - æ‰€æœ‰åœ¨listenå­—æ®µç«¯å£å·ä¸Šçš„è¯·æ±‚éƒ½å°†åˆ†å‘åˆ°è¿™ä¸ªæ ‡è®°å­—æ®µæ‰€å¡«å……åˆ°ä¿¡æ¯ä¸­\n2. upstreamå­—æ®µ - å¯ç”¨äºè´Ÿè½½å‡è¡¡çš„æœåŠ¡å™¨ä¿¡æ¯\n   1. server - IP:port - weightæƒé‡ - `max_fail`æœ€å¤šå¤±è´¥æ¬¡æ•° - `fail_timeout`æœ€é•¿ç­‰å¾…å“åº”æ—¶é—´\n\n```nginx\n# nginx tcp loadbalance config\nstream {\n    upstream MyServer {\n        server 127.0.0.1:6000 weight=1 max_fails=3 fail_timeout=30s;\n        server 127.0.0.1:6002 weight=1 max_fails=3 fail_timeout=30s;\n    }\n    server {\n        # proxy connect timeout 1s;\n        listen     8000;\n        proxy_pass MyServer;\n    }\n}\n```\n\n### å¸¸ç”¨æ“ä½œ\n\n```bash\nnginx -s reload\t\t# é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼Œå¹³æ»‘å¯åŠ¨\nnginx -s stop\t\t# åœæ­¢nginxæœåŠ¡\n```\n\n### æ¨¡å‹è®¾è®¡\n\n> reactors in process - one loop per process\n\nnginxæœåŠ¡å™¨çš„ç½‘ç»œæ¨¡å—è®¾è®¡æ˜¯åŸºäºè¿›ç¨‹çš„, é‡‡ç”¨å¤šä¸ªReactorå……å½“I/Oè¿›ç¨‹å’Œå·¥ä½œè¿›ç¨‹, é€šè¿‡accepté”å®Œç¾è§£å†³å¤šä¸ªReactorsçš„æƒŠç¾¤ç°è±¡;\n\n## æ›´åŠ é«˜å¹¶å‘?\n\nè´Ÿè½½å‡è¡¡ä¹Ÿåˆ†ä¸ºå¾ˆå¤šç§, å¯åˆ†ä¸ºä¸šåŠ¡å±‚è´Ÿè½½å‡è¡¡å™¨, é€šè¿‡ä¸šåŠ¡åˆ†å‘; ä¹Ÿå¯åˆ†ä¸ºä¼ è¾“å±‚çš„è´Ÿè½½å‡è¡¡å™¨, é€šè¿‡udp/tcpåˆ†å‘; ç½‘ç»œå±‚, é€šè¿‡ipåˆ†å‘; æ•°æ®é“¾è·¯å±‚é€šè¿‡æ•°æ®å¸§åˆ†å‘; \n\nå¦‚ä½•æ›´è¿›ä¸€æ­¥æé«˜å¹¶å‘é‡?\n\nå¯ä»¥æŠŠè´Ÿè½½å‡è¡¡å™¨ä¹Ÿè¿›è¡Œé›†ç¾¤å¤„ç†, å‰ç«¯ä½¿ç”¨ä¸€ä¸ªååº•å±‚çš„LVSè´Ÿè½½å‡è¡¡å™¨, å³, ä¸€å°LVSåŠ å¤šå°nginxæœåŠ¡å™¨çš„æ¨¡å‹; LVSçš„å¹¶å‘é‡å¾ˆå®¹æ˜“æ‰©å±•åˆ°åå‡ ä¸‡; \n\n# è·¨æœåŠ¡å™¨é€šä¿¡\n\næœ¬é¡¹ç›®ä¸­, ç”¨æˆ·é—´çš„é€šä¿¡æ¨¡å‹æ— éæœ‰ä¸¤ç§ï¼šä¸€å¯¹ä¸€èŠå¤©ã€ç¾¤èŠã€‚\n\né›†ç¾¤ç¯å¢ƒä¸­ï¼Œå³ç”¨æˆ·å¯èƒ½åˆ†å¸ƒåœ¨ä¸åŒæœåŠ¡å™¨ä¸»æœºä¸Šã€‚å¦‚æœæŒ‰ç…§ä¹‹å‰çš„ä»£ç é€»è¾‘ï¼Œæ¯å°æœåŠ¡å™¨ä¸Šçš„ä¸€ä¸ªServeréƒ½åªæœ‰ä¸€ä¸ª`m_userConnectionMap`ï¼ˆå› ä¸ºè¿™ä¸ªæ˜¯ChatServiceä¸­çš„æˆå‘˜ï¼Œè€ŒChatServiceæ˜¯å•ä¾‹æ¨¡å¼ï¼‰ã€‚æ‰€ä»¥ç”¨æˆ·ç»™å¯¹æ–¹å‘æ¶ˆæ¯åï¼Œå¦‚æœæ¥æ”¶æ–¹ç”¨æˆ·ä¸åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œé‚£ä¹ˆè¯¥æ¶ˆæ¯å°±ä¼šè¢«å½“ä½œç¦»çº¿æ¶ˆæ¯ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å¯¹çš„ã€‚\n\né‚£ä¹ˆæ€ä¹ˆè§£å†³è·¨æœåŠ¡å™¨é€šä¿¡å‘¢ï¼Ÿ\n\næœ€ç›´è§‚çš„æƒ³æ³•æ˜¯è®©å„ä¸ªChatServeræœåŠ¡å™¨äº’ç›¸ä¹‹é—´ç›´æ¥å»ºç«‹TCPè¿æ¥è¿›è¡Œé€šä¿¡ï¼Œç›¸å½“äºåœ¨æœåŠ¡å™¨ç½‘ç»œä¹‹é—´è¿›è¡Œå¹¿æ’­ã€‚è¿™æ ·çš„è®¾è®¡ä½¿å¾—å„ä¸ªæœåŠ¡å™¨ä¹‹é—´è€¦åˆåº¦å¤ªé«˜ï¼Œä¸åˆ©äºç³»ç»Ÿæ‰©å±•ï¼Œå¹¶ä¸”ä¼šå ç”¨ç³»ç»Ÿå¤§é‡çš„socketèµ„æºï¼Œå„æœåŠ¡å™¨ä¹‹é—´çš„å¸¦å®½å‹åŠ›å¾ˆå¤§ï¼Œä¸èƒ½å¤ŸèŠ‚çœèµ„æºç»™æ›´å¤šçš„å®¢æˆ·ç«¯æä¾›æœåŠ¡ï¼Œå› æ­¤ä¸æ˜¯ä¸€ä¸ªå¥½çš„è®¾è®¡ã€‚\n\né›†ç¾¤éƒ¨ç½²çš„æœåŠ¡å™¨ä¹‹é—´è¿›è¡Œé€šä¿¡ï¼Œæœ€å¥½çš„æ–¹å¼å°±æ˜¯å¼•å…¥ä¸­é—´ä»¶æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè§£è€¦å„ä¸ªæœåŠ¡å™¨ï¼Œä½¿æ•´ä¸ªç³»ç»Ÿæ¾è€¦åˆï¼Œæé«˜æœåŠ¡å™¨çš„å“åº”èƒ½åŠ›ï¼ŒèŠ‚çœæœåŠ¡å™¨çš„å¸¦å®½èµ„æº; æ‰€ä»¥ç­”æ¡ˆæ˜¯å¼•å…¥æœåŠ¡å™¨ä¸­é—´ä»¶å¦‚æ¶ˆæ¯é˜Ÿåˆ—; å¦‚æ­¤ä¸€æ¥, æœåŠ¡å™¨ä»…éœ€åšçš„å·¥ä½œæ˜¯ï¼šå‘ä¸­é—´ä»¶å‘å¸ƒè®¢é˜…æ¶ˆæ¯ï¼Œä¹‹åç­‰å¾…ä¸­é—´ä»¶é€šçŸ¥å»å–æ¶ˆæ¯ã€‚\n\nåœ¨é›†ç¾¤åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œç»å¸¸ä½¿ç”¨çš„ä¸­é—´ä»¶æ¶ˆæ¯é˜Ÿåˆ—æœ‰ActiveMQã€RabbitMQã€Kafkaç­‰ï¼Œéƒ½æ˜¯åº”ç”¨åœºæ™¯å¹¿æ³›å¹¶ä¸”æ€§èƒ½å¾ˆå¥½çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¾›é›†ç¾¤æœåŠ¡å™¨ä¹‹é—´ï¼Œåˆ†å¸ƒå¼æœåŠ¡ä¹‹é—´è¿›è¡Œæ¶ˆæ¯é€šä¿¡ã€‚é™äºæœ¬é¡¹ç›®ä¸šåŠ¡ç±»å‹å¹¶ä¸æ˜¯éå¸¸å¤æ‚ï¼Œå¯¹å¹¶å‘è¯·æ±‚é‡ä¹Ÿæ²¡æœ‰å¤ªé«˜çš„è¦æ±‚ï¼Œå› æ­¤æœ¬é¡¹ç›®ä¸­é—´ä»¶æ¶ˆæ¯é˜Ÿåˆ—é€‰å‹çš„æ˜¯-åŸºäºå‘å¸ƒ-è®¢é˜…æ¨¡å¼çš„redisã€‚\n\n## Redisç¯å¢ƒå®‰è£…å’Œé…ç½®\n\n1. Ubuntuå®‰è£…redisæœåŠ¡å‘½ä»¤\n   ```bash\n   sudo apt-get install redis-server\n   ```\n\n2. å®‰è£…å®Œæˆåä¼šè‡ªåŠ¨å¯åŠ¨redisæœåŠ¡ï¼Œé€šè¿‡pså‘½ä»¤ç¡®è®¤; redisé»˜è®¤ç«¯å£ä¸º6379\n   ```bash\n   ps -ef | grep redis\n   ```\n\n## redis-cliæµ‹è¯•redis-server\n\nå¯åŠ¨redis-cliå®¢æˆ·ç«¯ï¼Œè¿æ¥redis serverä½“éªŒä¸€ä¸‹æ•°æ®ç¼“å­˜åŠŸèƒ½\n\n```bash\nredis-cli\n```\n\n```redis\n127.0.0.1:6379> set \"abc\" \"hello world\" #è®¾ç½®key-value\nOK\n127.0.0.1:6379> get \"abc\"\n\"hello world\"\n```\n\n## Redisè®¢é˜…/å‘å¸ƒ\n\nredisçš„å‘å¸ƒ-è®¢é˜…æœºåˆ¶ï¼šå‘å¸ƒ-è®¢é˜…æ¨¡å¼åŒ…å«äº†ä¸¤ç§è§’è‰²ï¼Œåˆ†åˆ«æ˜¯æ¶ˆæ¯çš„å‘å¸ƒè€…å’Œæ¶ˆæ¯çš„è®¢é˜…è€…ã€‚è®¢é˜…è€…å¯ä»¥è®¢é˜…ä¸€ä¸ªæˆ–è€…å¤šä¸ªé¢‘é“channelï¼Œå‘å¸ƒè€…å¯ä»¥å‘æŒ‡å®šçš„é¢‘é“channelå‘é€æ¶ˆæ¯ï¼Œæ‰€æœ‰è®¢é˜…æ­¤é¢‘é“çš„è®¢é˜…è€…éƒ½ä¼šæ”¶åˆ°æ­¤æ¶ˆæ¯ã€‚\n\nè®¢é˜…é¢‘é“çš„å‘½ä»¤æ˜¯ subscribeï¼Œå¯ä»¥åŒæ—¶è®¢é˜…å¤šä¸ªé¢‘é“ï¼Œç”¨æ³•æ˜¯`subscribe channel1 [channel2] ...`;\n\n```redis\n127.0.0.1:6379> subscribe 13\nReading messages... (press Ctrl-C to quit)\n1) \"subscribe\"\n2) \"13\"\n3) (integer) 1\n```\n\n```redis\n127.0.0.1:6379> publish 13 \"hello, 13\" #å¦ä¸€ç«¯æ¨é€æ¶ˆæ¯ç»™13\n```\n\nè®¢é˜…äº†`13`é¢‘é“ çš„ç”¨æˆ·æ”¶åˆ°çš„æ¶ˆæ¯: \n\n```redis\n1) \"message\"\n2) \"13\"\n3) \"hello, 13\"\n```\n\n### å¯¹åº”äºæœ¬é¡¹ç›®\n\nç”±äºæœåŠ¡å™¨æ˜¯é›†ç¾¤åŒ–çš„, æ‰€ä»¥ç™»å½•åˆ°æœ¬ç³»ç»Ÿçš„ç”¨æˆ·å¯èƒ½ä¸åœ¨åŒä¸€èŠå¤©æœåŠ¡å™¨ä¸Š, éœ€è¦è§‚å¯ŸRedisä¸­é—´ä»¶æ¥è·å–æ¶ˆæ¯;\n\nå³, ç”¨æˆ·æ˜¯è§‚å¯Ÿè€…, æ¶ˆæ¯é˜Ÿåˆ—æ˜¯è¢«è§‚å¯Ÿè€…;\n\næŸä¸€ç”¨æˆ·ç™»é™†åˆ°èŠå¤©ç³»ç»Ÿå, \n\n1. æœåŠ¡å™¨éœ€è¦å‘Redisè®¢é˜…æŸä¸€é¢‘é“çš„æ¶ˆæ¯, è¿™ä¸ªé¢‘é“çš„idå·å³ä¸ºè¯¥ç”¨æˆ·çš„idå·;\n2. å½“è¯¥ç”¨æˆ·ç»™å¦ä¸€ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶, å‘ç°å…¶ä¸åœ¨æœ¬æœåŠ¡å™¨ä¸­, éœ€è¦å‘è¯¥é¢‘é“å‘å¸ƒæ¶ˆæ¯;\n\n## rediså‘å¸ƒ-è®¢é˜…çš„å®¢æˆ·ç«¯ç¼–ç¨‹ - å°è£…ä¸ºRedisç±»\n\nredisæ”¯æŒå¤šç§ä¸åŒçš„å®¢æˆ·ç«¯ç¼–ç¨‹è¯­è¨€ï¼Œä¾‹å¦‚Javaå¯¹åº”Jedisï¼ŒPHPå¯¹åº”phpredisï¼ŒC++å¯¹åº”çš„æ˜¯hiredisã€‚\n\n### hirediså®‰è£…æ­¥éª¤\n\n1. `git clone https://github.com/redis/hiredis`\n\n2. make && make install\n   ```bash\n   cd hiredis\n   make\n   ...\n   sudo make install #æ‹·è´ç”Ÿæˆçš„åŠ¨æ€åº“åˆ°/usr/local/libç›®å½•ä¸‹\n   # å¦‚æœæç¤ºæ²¡æœ‰æ‰¾åˆ°hiredisåŠ¨æ€åº“ï¼Œåˆ™æ‰§è¡Œä¸‹é¢\n   # sudo ldconfig /usr/local/lib\n   ```\n\n### æˆå‘˜å˜é‡\n\n1. hiredisåŒæ­¥ä¸Šä¸‹æ–‡å¯¹è±¡\n\n   1. ä¸€ä¸ªä¸“é—¨è´Ÿè´£publishæ¶ˆæ¯\n   2. ä¸€ä¸ªä¸“é—¨è´Ÿè´£subscribeæ¶ˆæ¯\n\n   ```cpp\n   private:\n       /* hiredisåŒæ­¥ä¸Šä¸‹æ–‡å¯¹è±¡, è´Ÿè´£publishæ¶ˆæ¯ */\n       redisContext * m_publish_context;\n       /* hiredisåŒæ­¥ä¸Šä¸‹æ–‡å¯¹è±¡, è´Ÿè´£subscribeæ¶ˆæ¯ */\n       redisContext * m_subscribe_context;\n   ```\n\n2. å›è°ƒæ“ä½œ, æ”¶åˆ°è®¢é˜…çš„æ¶ˆæ¯, ç»™serviceå±‚ä¸ŠæŠ¥\n   ```cpp\n   private:\n       /* å›è°ƒæ“ä½œ, æ”¶åˆ°è®¢é˜…çš„æ¶ˆæ¯, ç»™serviceå±‚ä¸ŠæŠ¥ */\n       MessageCallback m_notify_handler;\n   ```\n\n>1. å¯¹äº\"hiredisä¸Šä¸‹æ–‡å¯¹è±¡\"çš„ç†è§£:\n>   - ç›¸å½“äºä¸€ä¸ªredis-cli, å­˜å‚¨äº†è¿æ¥ç›¸å…³çš„ä¿¡æ¯;\n>2. ä¸ºä»€ä¹ˆè¦å†™ä¸¤ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡?\n>   * å¦‚æœä¸Šä¸‹æ–‡å¯¹è±¡æ­£åœ¨subscribeé‚£ä¹ˆå…¶å°†ä¼šé˜»å¡, æ‰€ä»¥subscribeå’Œpublishéœ€è¦åˆ†å¼€æ“ä½œ;\n\n### æˆå‘˜å‡½æ•°\n\n1. æ„é€ /ææ„\n   ```cpp\n   public:\n       Redis();\n       ~Redis();\n   ```\n\n2. connect - è¿æ¥RedisæœåŠ¡å™¨\n   ```cpp\n   public:\n       /* è¿æ¥RedisæœåŠ¡å™¨ */\n       bool connect();\n   ```\n\n3. å‘å¸ƒ/è®¢é˜…æ¶ˆæ¯\n   ```cpp\n   public:\n       /* å‘æŒ‡å®šçš„redisé¢‘é“å‘å¸ƒæ¶ˆæ¯ */\n       bool publish(int channel, string message);\n       /* å‘æŒ‡å®šçš„redisé¢‘é“è®¢é˜…æ¶ˆæ¯ */\n       bool subscribe(int channel);\n       /* å‘æŒ‡å®šçš„redisé¢‘é“å–æ¶ˆè®¢é˜…æ¶ˆæ¯ */\n       bool unsubscribe(int channel);\n   ```\n\n4. `observer_channel_message` - åœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­æ¥æ”¶è®¢é˜…é¢‘é“ä¸­çš„æ¶ˆæ¯\n\n   ```cpp\n   public:\n       /* åœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­æ¥æ”¶è®¢é˜…é¢‘é“ä¸­çš„æ¶ˆæ¯ */\n       void observer_channel_message();\n   ```\n\n5. `init_notify_handler` - åˆå§‹åŒ–å‘ä¸šåŠ¡å±‚ä¸ŠæŠ¥é¢‘é“æ¶ˆæ¯ çš„å›è°ƒå‡½æ•°, éœ€è¦ç”¨åˆ°ä¸€ä¸ªint(é¢‘é“å·), ä¸€ä¸ªæ¶ˆæ¯å†…å®¹å­—ç¬¦ä¸²\n\n   ```cpp\n   public:\n       using MessageCallback = function<void(int, string)>;\n       /* åˆå§‹åŒ–å‘ä¸šåŠ¡å±‚ä¸ŠæŠ¥é¢‘é“æ¶ˆæ¯ çš„å›è°ƒå‡½æ•°, éœ€è¦ç”¨åˆ°int(é¢‘é“å·), æ¶ˆæ¯å†…å®¹å­—ç¬¦ä¸² */\n       void init_notify_handler(MessageCallback cb);\n   ```\n\n### ä»£ç å®ç°\n\n1. æ„é€  - åªæ˜¯å¯¹ä¸¤ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡æŒ‡é’ˆèµ‹nullptr, æ²¡æœ‰å®é™…æ„é€ \n   ```cpp\n   Redis::Redis()\n       : m_publish_context(nullptr), m_subscribe_context(nullptr)\n   {\n   }\n   ```\n\n2. ææ„ - è°ƒç”¨`redisFree`é‡Šæ”¾ä¸Šä¸‹æ–‡å¯¹è±¡èµ„æº\n   ```cpp\n   Redis::~Redis()\n   {\n       if(m_publish_context != nullptr)\n       {\n           redisFree(m_publish_context);\n       }\n       if(m_subscribe_context != nullptr)\n       {\n           redisFree(m_subscribe_context);\n       }\n   }\n   ```\n\n3. connect\n\n   1. å¯¹contextè¿›è¡Œå®é™…çš„ç”³è¯·èµ„æº/æ„é€ , è¿”å›æŒ‡é’ˆèµ‹ç»™æˆå‘˜, åº•å±‚è°ƒç”¨`redisConnect`\n   2. åˆ›å»ºçº¿ç¨‹, æ‰§è¡Œ`observer_channel_message`, å³å¾ªç¯ç­‰å¾…Redisé¢‘é“çš„reply\n\n   ```cpp\n   bool Redis::connect()\n   {\n       m_publish_context = redisConnect(\"127.0.0.1\", 6379);\n       if(nullptr == m_publish_context)\n       {\n           cerr << \"connect redis failed!\" << endl;\n           return false;\n       }\n   \n       m_subscribe_context = redisConnect(\"127.0.0.1\", 6379);\n       if(nullptr == m_subscribe_context)\n       {\n           cerr << \"connect redis failed!\" << endl;\n           return false;\n       }\n   \n       /**\n        * ç”±äºsubscribeæ“ä½œæ˜¯é˜»å¡çš„, \n        * åœ¨å®é™…çš„ä½¿ç”¨ç¯å¢ƒä¸‹, ä¸å¯èƒ½å› ä¸ºä¸€ä¸ªè®¢é˜…æ“ä½œå»é˜»å¡ä¸€ä¸ªæœåŠ¡å™¨, \n        * æ‰€ä»¥è¦ç”¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ¥å®Œæˆç›‘å¬é¢‘é“ä¸Šçš„äº‹ä»¶,\n        * æœ‰æ¶ˆæ¯åˆ™ç»™ä¸šåŠ¡å±‚è¿›è¡Œä¸ŠæŠ¥; \n        */\n       thread t(\n           [&]() { observer_channel_message();} );\n       t.detach();\n   \n       cout << \"connect redis-server success!\" << endl;\n       return true;\n   }\n   ```\n\n4. publish - ç›¸å½“äºå‘redis-serverå‘é€å‘½ä»¤, replyæ¥æ”¶å‘½ä»¤æ‰§è¡Œç»“æœ\n   ```cpp\n   bool Redis::publish(int channel, string message)\n   {\n       /* ç›¸å½“äºå‘redis-serverå‘é€å‘½ä»¤, replyæ¥æ”¶å‘½ä»¤æ‰§è¡Œç»“æœ */\n       redisReply * reply = (redisReply*)redisCommand(\n           m_publish_context, \"PUBLISH %d %s\", channel, message.c_str());\n       if(nullptr == reply)\n       {\n           cerr << \"publish command failed!\" << endl;\n           return false;\n       }\n       freeReplyObject(reply);\n       return true;\n   }\n   ```\n\n5. subscribe - ç›¸å½“äºæŠŠredisCommandç»†åŒ–äº†, åªæ“ä½œäº†å‘å‘½ä»¤, æ¥æ”¶ç»“æœäº¤ç»™å•ç‹¬çš„çº¿ç¨‹åšäº†, è¯¦è§`observer_channel_message`\n   ```cpp\n   bool Redis::subscribe(int channel)\n   {\n       if(REDIS_ERR == redisAppendCommand(\n           m_subscribe_context, \"SUBSCRIBE %d\", channel))\n       {\n           cerr << \"subscribe command failed!\" << endl;\n           return false;\n       }\n       /* å¾ªç¯å‘é€ç¼“å†²åŒºå†…å®¹, ç›´åˆ°å‘é€å®Œæ¯• */\n       int done = 0;\n       while(!done)\n       {\n           if(REDIS_ERR == redisBufferWrite(m_subscribe_context, &done))\n           {\n               cerr << \"subscribe command failed!\" << endl;\n               return false;\n           }\n       }\n       /**\n        * è¿™é‡Œä¸åšredisReplyçš„æ“ä½œ,\n        * è¿™æ˜¯ä¸ªé˜»å¡çš„æ“ä½œ, æ”¾åœ¨observer_channel_messageä¸­åš;\n        */\n       return true;\n   }\n   ```\n\n6. unsubscribe\n   ```cpp\n   bool Redis::unsubscribe(int channel)\n   {\n       if(REDIS_ERR == redisAppendCommand(\n           m_subscribe_context, \"UNSUBSCRIBE %d\", channel))\n       {\n           cerr << \"unsubscribe command failed!\" << endl;\n           return false;\n       }\n       /* å¾ªç¯å‘é€ç¼“å†²åŒºå†…å®¹, ç›´åˆ°å‘é€å®Œæ¯• */\n       int done = 0;\n       while(!done)\n       {\n           if(REDIS_ERR == redisBufferWrite(m_subscribe_context, &done))\n           {\n               cerr << \"unsubscribe command failed!\" << endl;\n               return false;\n           }\n       }\n       /**\n        * è¿™é‡Œä¸åšredisReplyçš„æ“ä½œ,\n        * è¿™æ˜¯ä¸ªé˜»å¡çš„æ“ä½œ, æ”¾åœ¨observer_channel_messageä¸­åš;\n        */\n       return true;\n   }\n   ```\n\n7. `observer_channel_message`\n\n   * Redisé¢‘é“å¦‚æœæœ‰æ¶ˆæ¯, åˆ™æœ‰ä¸‰ä¸ªå­—æ®µ, \n     1. å¯¹åº”çš„æ˜¯redisGetReplyè¿”å›çš„`reply->element[0],[1],[2]`;\n     2. æœ¬é¡¹ç›®çš„`element[1]`å¯¹åº”çš„æ˜¯é¢‘é“å·;\n     3. æœ¬é¡¹ç›®çš„`element[2]`å¯¹åº”çš„æ˜¯æ¶ˆæ¯ä½“;\n\n   ```cpp\n   void Redis::observer_channel_message()\n   {\n       redisReply *reply = nullptr;\n       int res = REDIS_ERR;\n       while(REDIS_OK==(res = redisGetReply(\n                                   m_subscribe_context, (void**)&reply)))\n       {\n           if(reply != nullptr &&\n              reply->element[2] != nullptr &&\n              reply->element[2]->str != nullptr)\n           {\n               /* ç»™ä¸šåŠ¡å±‚ä¸ŠæŠ¥é¢‘é“ä¸Šå‘ç”Ÿçš„æ¶ˆæ¯, å³é¢‘é“å·+æ¶ˆæ¯ä½“ */\n               m_notify_handler(atoi(reply->element[1]->str),\n                                reply->element[2]->str );\n           }\n           freeReplyObject(reply);\n       }\n       if(res == REDIS_ERR)\n       {\n           cerr << \"redisGetReply err\" << endl;\n           return;\n       }\n       cerr << \"observer_channel_message quit\" << endl;\n   }\n   ```\n\n8. `init_notify_handler` - è®¾ç½®`m_notify_handler`å›è°ƒ\n\n   ```cpp\n   void Redis::init_notify_handler(MessageCallback cb)\n   {\n       m_notify_handler = cb;\n   }\n   ```\n\n> redisCommandå’ŒredisAppendCommandçš„åŒºåˆ«:\n>\n> 1. redisAppendCommandåªæ˜¯æŠŠå‘½ä»¤å…ˆå†™åˆ°æœ¬åœ°ç¼“å­˜ä¸­;\n> 2. å†™åˆ°ç¼“å­˜ä¹‹åè¿˜éœ€è¦è°ƒç”¨redisBufferWriteæŠŠç¼“å­˜ä¸­çš„å‘½ä»¤å‘é€åˆ°RedisæœåŠ¡å™¨;\n> 3. æœ€å, å¦‚æœè¦è·å¾—reply, è¿˜éœ€è¦è°ƒç”¨redisGetReplyè·å–ç»“æœ, è¿™ä¸ªæ“ä½œå¯¹äºsubscribeæ˜¯é˜»å¡çš„;\n> 4. ç”±äºpublishæ“ä½œä¸€èˆ¬ä¸ä¼šé˜»å¡, æ‰€ä»¥ç›´æ¥è°ƒç”¨redisCommand;\n> 5. ç”±äºsubscribeæ“ä½œæœ€åçš„redisGetReplyå°†ä¼šé˜»å¡, æ‰€ä»¥æˆ‘ä»¬æŠŠè¿™å‡ ä¸ªæ­¥éª¤å•ç‹¬å†™å‡ºæ¥, ç²’åº¦å‡å°, è¿½æ±‚æ•ˆç‡;\n\n# ChatServiceåŠ å…¥Redisç»„ä»¶\n\n1. é¦–å…ˆ, éœ€è¦åœ¨`chatservice.hpp`ä¸­, å¼•å…¥å¤´æ–‡ä»¶`\"redis.hpp\"`; ç„¶ååœ¨`ChatService`çš„ç±»æˆå‘˜å˜é‡ä¸­å£°æ˜ä¸€ä¸ª`Redis m_redis`redisæ“ä½œå¯¹è±¡;\n   ```cpp\n   private:\n       Redis m_redis;\n   ```\n\n2. åœ¨ChatServiceç±»ä¸­, æ·»åŠ ä¸€ä¸ªå¤„ç†redisä¸šåŠ¡çš„æˆå‘˜å‡½æ•°`handleRedisSubscribeMessage`\n   ```cpp\n   public:\n       void handleRedisSubscribeMessage(int channel, string message);\n   ```\n\n3. åœ¨`chatservice.cpp`ä¸­, ChatServiceçš„æ„é€ å‡½æ•°ä¸­, éœ€è¦æ·»åŠ è¿æ¥redisæœåŠ¡å™¨çš„æ“ä½œ; å¦‚æœè¿æ¥æˆåŠŸ, ç»™redisè®¾ç½®å›è°ƒå‡½æ•°ä¸º`handleRedisSubscribeMessage`, å‚æ•°ä¸ºchatserviceå¯¹è±¡æŒ‡é’ˆ, channel, message;\n   ```cpp\n   ChatService::ChatService()\n   {\n       // ...\n       if(m_redis.connect())\n       {\n           m_redis.init_notify_handler(std::bind(\n               &ChatService::handleRedisSubscribeMessage, this, _1, _2));\n       }\n   }\n   ```\n\n   \n\n","categories":["Cpp","é¡¹ç›®","é›†ç¾¤"]},{"title":"åç¨‹_Cppåç¨‹ç®€å•å®ç°","url":"/å¤šçº¿ç¨‹/åç¨‹_Cppåç¨‹ç®€å•å®ç°/","content":"\nåœ¨`C++`ä¸­å®ç°åç¨‹åº“å¯èƒ½æ˜¯ä¸€é¡¹å…·æœ‰æŒ‘æˆ˜æ€§çš„ä»»åŠ¡ï¼Œä½†å®ƒæ˜¯æ·±å…¥äº†è§£åç¨‹å·¥ä½œåŸç†çš„å¥½æ–¹æ³•ã€‚ \n\n# åç¨‹å·¥ä½œåŸç†\n\nåœ¨é«˜å±‚æ¬¡ä¸Šï¼Œåç¨‹å…è®¸ç¼–å†™çœ‹ä¼¼åŒæ­¥çš„ä»£ç ï¼Œä½†å¯ä»¥å¼‚æ­¥æŒ‚èµ·å’Œæ¢å¤ã€‚ \n\nåŸºæœ¬æ€æƒ³æ˜¯åç¨‹æ˜¯ä¸€ä¸ªå¯ä»¥åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ç‰¹å®šç‚¹æš‚åœå’Œæ¢å¤çš„å‡½æ•°ï¼Œå…è®¸å…¶ä»–ä»£ç åŒæ—¶è¿è¡Œã€‚\n\n# çŠ¶æ€æœºå®ç°åç¨‹\n\nè¦åœ¨`C++`ä¸­å®ç°åç¨‹ï¼Œéœ€è¦ç®¡ç†åç¨‹çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬å…¶å½“å‰å †æ ˆå¸§ã€æŒ‡ä»¤æŒ‡é’ˆå’Œä»»ä½•å±€éƒ¨å˜é‡ã€‚è¿˜éœ€è¦èƒ½å¤Ÿåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ç‰¹å®šç‚¹æš‚åœå’Œæ¢å¤åç¨‹ã€‚\n\nåœ¨`C++`ä¸­å®ç°åç¨‹çš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨çŠ¶æ€æœºã€‚çŠ¶æ€æœºè·Ÿè¸ªåç¨‹çš„çŠ¶æ€å¹¶æä¾›æŒ‚èµ·å’Œæ¢å¤åç¨‹çš„æ–¹æ³•ã€‚å½“åç¨‹ç¬¬ä¸€æ¬¡è¢«è°ƒç”¨æ—¶ï¼Œå®ƒè¿›å…¥åˆå§‹çŠ¶æ€å¹¶å¼€å§‹æ‰§è¡Œã€‚å½“é‡åˆ°æŒ‚èµ·ç‚¹æ—¶ï¼ŒçŠ¶æ€æœºä¿å­˜åç¨‹çš„çŠ¶æ€å¹¶å°†æ§åˆ¶æƒè¿”å›ç»™è°ƒç”¨ä»£ç ã€‚å½“åç¨‹æ¢å¤æ—¶ï¼ŒçŠ¶æ€æœºæ¢å¤åç¨‹çš„çŠ¶æ€å¹¶ä»å®ƒåœæ­¢çš„åœ°æ–¹ç»§ç»­æ‰§è¡Œã€‚\n\nä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œè¯´æ˜å¦‚ä½•ä½¿ç”¨çŠ¶æ€æœºå®ç°ä¸€ä¸ªç®€å•çš„åç¨‹åº“ï¼š\n\n```cpp\n#include <iostream>\n#include <functional>\n#include <vector>\n\nclass Coroutine {\npublic:\n    Coroutine(std::function<void()> f)\n        : m_function(f), m_state(0)\n    {}\n\n    void resume() {\n        switch (m_state) {\n        case 0: // Start\n            m_state++;\n            m_function();\n            break;\n        case 1: // Suspend\n            return;\n        }\n    }\n\n    bool is_complete() const {\n        return m_state == 2;\n    }\n\nprivate:\n    std::function<void()> m_function;\n    int m_state;\n};\n\nclass Scheduler {\npublic:\n    void add_coroutine(Coroutine coroutine) {\n        m_coroutines.push_back(coroutine);\n    }\n\n    void run() {\n        while (!m_coroutines.empty()) {\n            auto coroutine = m_coroutines.front();\n            m_coroutines.pop_front();\n\n            coroutine.resume();\n\n            if (!coroutine.is_complete()) {\n                m_coroutines.push_back(coroutine);\n            }\n        }\n    }\n\nprivate:\n    std::deque<Coroutine> m_coroutines;\n};\n\n// Example usage\nvoid foo(Coroutine& coroutine) {\n    for (int i = 0; i < 5; i++) {\n        std::cout << \"foo \" << i << std::endl;\n        coroutine.resume();\n    }\n}\n\nvoid bar(Coroutine& coroutine) {\n    for (int i = 0; i < 3; i++) {\n        std::cout << \"bar \" << i << std::endl;\n        coroutine.resume();\n    }\n}\n\nint main() {\n    Scheduler scheduler;\n    Coroutine coroutine1(std::bind(foo, std::placeholders::_1));\n    Coroutine coroutine2(std::bind(bar, std::placeholders::_1));\n\n    scheduler.add_coroutine(coroutine1);\n    scheduler.add_coroutine(coroutine2);\n\n    scheduler.run();\n\n    return 0;\n}\n```\n\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª Coroutine ç±»ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‡½æ•°å¯¹è±¡ä½œä¸ºå®ƒçš„æ„é€ å‡½æ•°å‚æ•°ã€‚ resume() æ–¹æ³•å°†åç¨‹æ¨è¿›åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Œis_complete() æ–¹æ³•æ£€æŸ¥åç¨‹æ˜¯å¦å·²æ‰§è¡Œå®Œæ¯•ã€‚\n\næˆ‘ä»¬è¿˜å®šä¹‰äº†ä¸€ä¸ª Scheduler ç±»ï¼Œå®ƒç»´æŠ¤ä¸€ä¸ªåç¨‹åˆ—è¡¨å¹¶ä¸€æ¬¡è¿è¡Œä¸€ä¸ªï¼Œç›´åˆ°å®ƒä»¬å…¨éƒ¨å®Œæˆã€‚ åœ¨ç¤ºä¾‹ç”¨æ³•ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªç®€å•çš„å‡½æ•° foo å’Œ barï¼Œå®ƒä»¬æ‰“å°å‡ºä¸€äº›æ–‡æœ¬å¹¶è°ƒç”¨`coroutine.resume()`æ¥æš‚åœåç¨‹å¹¶å°†æ§åˆ¶æƒäº¤è¿˜ç»™è°ƒåº¦ç¨‹åºã€‚æˆ‘ä»¬åˆ›å»ºä¸¤ä¸ª`Coroutine`å¯¹è±¡ï¼Œæ¯ä¸ªå‡½æ•°ä¸€ä¸ªï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°`Scheduler`ä¸­ã€‚ æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨`scheduler.run()`å¼€å§‹è¿è¡Œåç¨‹ã€‚\n\nè¿è¡Œè¯¥ç¨‹åºæ—¶ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä»¥ä¸‹è¾“å‡ºï¼š\n\n```\nfoo 0\nbar 0\nfoo 1\nbar 1\nfoo 2\nbar 2\nfoo 3\nfoo 4\n```\n\nè¿™æ¼”ç¤ºäº†åç¨‹å¦‚ä½•å·¥ä½œçš„åŸºæœ¬æ€æƒ³ã€‚ foo å’Œ bar å‡½æ•°ä»¥æ¥å›çš„æ–¹å¼æ‰§è¡Œï¼Œå› ä¸ºè°ƒåº¦ç¨‹åºæš‚åœå’Œæ¢å¤åç¨‹ã€‚\n\nå½“ç„¶ï¼Œè¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå®ç°ä¸€ä¸ªåŠŸèƒ½å®Œå¤‡çš„åç¨‹åº“è¿˜æœ‰å¾ˆå¤šç»†èŠ‚ã€‚ ä½†æ˜¯ï¼Œæˆ‘å¸Œæœ›è¿™èƒ½è®©æ‚¨å¤§è‡´äº†è§£å¦‚ä½•åœ¨ C++ ä¸­å®ç°åç¨‹ã€‚\n\n# å®ç°\n\nè¦åœ¨`C++`ä¸­å®ç°åç¨‹åº“ï¼Œæ‚¨éœ€è¦ä½¿ç”¨`C++20`ä¸­å¼•å…¥çš„è¯­è¨€å¯¹åç¨‹çš„å†…ç½®æ”¯æŒã€‚å…·ä½“æ¥è¯´ï¼Œæ‚¨éœ€è¦ä½¿ç”¨`std::coroutine_traits`æ¨¡æ¿æ¥å®šä¹‰åç¨‹ç±»å‹ï¼Œå¹¶ä½¿ç”¨`std::suspend_always`å’Œ`std::suspend_never`ç±»æ¥æŒ‡ç¤ºåç¨‹ä½•æ—¶åº”è¯¥æŒ‚èµ·å’Œæ¢å¤ã€‚\n","categories":["æ“ä½œç³»ç»Ÿ","å¤šçº¿ç¨‹","Cpp","Modern"]},{"title":"Go_åŸºç¡€è¯­æ³•","url":"/Go/Go_åŸºç¡€è¯­æ³•/","content":"\n# Work before Hello World\n\n1. Open a command prompt and cd to home directory.\n\n2. Create a hello directory for the first Go source code.\n\n   ```bash\n   mkdir hello\n   cd hello\n   ```\n\n3. Enable dependency tracking for your code.\n\n   When your code imports packages contained in other modules, you manage those dependencies through your code's own module. **That module is defined by a `go.mod` file that tracks the modules that provide those packages**. That go.mod file stays with your code, including in your source code repository.\n\n   To enable dependency tracking for your code by creating a go.mod file, run the [`go mod init` command](https://go.dev/ref/mod#go-mod-init), giving it the name of the module your code will be in. The name is the module's module path.\n   In actual development, the module path will typically be the repository location where your source code will be kept. For example, the module path might be `github.com/mymodule`. If you plan to publish your module for others to use, the module path *must* be a location from which Go tools can download your module. For more about naming a module with a module path, see [Managing dependencies](https://go.dev/doc/modules/managing-dependencies#naming_module).\n   But for the purposes of just a tutorial, just use `example/hello`.\n\n   ```bash\n   $ go mod init example/hello\n   go: creating new go.mod: module example/hello\n   ```\n\n4. In your text editor, create a file hello.go in which to write your code.\n\n5. Paste the following code into your hello.go file and save the file.\n   ```go\n   package main\n   \n   import \"fmt\"\n   \n   func main(){\n       fmt.Println(\"Hello, World!\")\n   }\n   ```\n\n   This is your Go code. In this code, you:\n\n   * Declare a `main` **package (a package is a way to group functions, and it's made up of all the files in the same directory)**.\n   * Import the popular [`fmt` package](https://pkg.go.dev/fmt/), which contains functions for formatting text, including printing to the console. This package is one of the [standard library](https://pkg.go.dev/std) packages you got when you installed Go.\n   * Implement a `main` function to print a message to the console. A `main` function executes by default when you run the `main` package.\n\n6. Run the code to see the greeting.\n\n   ```bash\n   $ go run .\n   Hello, World!\n   ```\n\n## Key Points\n\n1. When your code imports packages contained in other modules, you manage those dependencies through your code's own module. **That module is defined by a `go.mod` file that tracks the modules that provide those packages**. That go.mod file stays with your code, including in your source code repository.\n2. To enable dependency tracking for your code by creating a go.mod file, run the [`go mod init` command](https://go.dev/ref/mod#go-mod-init), giving it the name of the module your code will be in. The name is the module's module path.\n3. In actual development, the module path will typically be the repository location where your source code will be kept. For example, the module path might be `github.com/mymodule`. If you plan to publish your module for others to use, the module path *must* be a location from which Go tools can download your module. For more about naming a module with a module path, see [Managing dependencies](https://go.dev/doc/modules/managing-dependencies#naming_module).\n4. Package is a way to group functions, and it's made up of all the files in the same directory.\n5. A `main` function executes by default when you run the `main` package.\n6. go mod init command: `go mod init example/hello `\n7. go run command: `go run example/hello`\n8. go build command and run: `go build example/hello/main.go` `./example/hello/main`\n\n# variable type\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\n\t\"math\"\n)\n\nfunc main() {\n\tvar a = \"initial\"\n\tvar b, c int = 1, 2\n\tvar d = true\n\tvar e float64\n\tf := float32(e)\n\tg := a + \"foo\"\n\tfmt.Println(a, b, c, d, e, f)\n\tfmt.Println(g)\n\n\tconst s string = \"constant\"\n\tconst h = 500000000\n\tconst i = 3e20 / h\n\tfmt.Println(s, h, i, math.Sin(h), math.Sin(i))\n}\n```\n\n## Key Points\n\n1. goè¯­è¨€æ˜¯ä¸€é—¨å¼ºç±»å‹è¯­è¨€ï¼Œæ¯ä¸€ä¸ªå˜é‡éƒ½æœ‰å®ƒè‡ªå·±çš„å˜é‡ç±»å‹\n2. goè¯­è¨€çš„å­—ç¬¦ä¸²æ˜¯å†…ç½®ç±»å‹ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡åŠ å·æ‹¼æ¥ï¼Œä¹Ÿèƒ½å¤Ÿç›´æ¥ç”¨ç­‰äºå·å»æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²ã€‚\n3. goè¯­è¨€å˜é‡çš„å£°æ˜æœ‰ä¸¤ç§æ–¹å¼\n   1. ä¸€ç§æ˜¯é€šè¿‡`var name string = \"\"`è¿™ç§æ–¹å¼æ¥å£°æ˜å˜é‡ï¼Œå£°æ˜å˜é‡çš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šè‡ªåŠ¨å»æ¨å¯¼å˜é‡çš„ç±»å‹ã€‚\n   2. å¦‚æœæœ‰éœ€è¦ï¼Œä¹Ÿå¯ä»¥æ˜¾å¼å†™å‡ºå˜é‡ç±»å‹ã€‚å¦ä¸€ç§å£°æ˜å˜é‡çš„æ–¹å¼æ˜¯ï¼š`ä½¿ç”¨å˜é‡ å†’å· := å€¼`ã€‚\n4. å¸¸é‡å°±æ˜¯æŠŠvaræ”¹æˆconstï¼Œå€¼å¾—ä¸€æçš„æ˜¯goè¯­è¨€é‡Œé¢çš„å¸¸é‡æ²¡æœ‰ç¡®å®šçš„ç±»å‹ï¼Œä¼šæ ¹æ®ä½¿ç”¨çš„ä¸Šä¸‹æ–‡æ¥è‡ªåŠ¨ç¡®å®šç±»å‹ã€‚\n\n# if else\n\n```go\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n\tif 7%2 == 0 {\n\t\tfmt.Println(\"7 is even\")\n\t} else {\n\t\tfmt.Println(\"7 is odd\")\n\t}\n\tif 8%4 == 0 {\n\t\tfmt.Println(\"8 is divisible by 4\")\n\t}\n\tif num := 9; num < 0 {\n\t\tfmt.Println(num, \"is negative\")\n\t} else if num < 10 {\n\t\tfmt.Println(num, \"has 1 digit\")\n\t} else {\n\t\tfmt.Println(num, \"has multiple digits\")\n\t}\n}\n```\n\n```\n7 is odd\n8 is divisible by 4\n9 has 1 digit\n```\n\n## Key Points\n\n1. ifåé¢æ²¡æœ‰æ‹¬å·ã€‚\n2. ifæ‰§è¡Œè¯­å¥å—å¿…é¡»æ¥å¤§æ‹¬å·ã€‚ä¸èƒ½åƒCæˆ–è€…Cppä¸€æ ·ï¼Œç›´æ¥æŠŠifé‡Œé¢çš„è¯­å¥åŒä¸€è¡Œã€‚\n\n# for\n\n```go\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n\ti := 1\n\tfor {\n\t\tfmt.Println(\"loop\")\n\t\tbreak\n\t}\n\tfor j := 7; j < 9; j++ {\n\t\tfmt.Println(j)\n\t}\n\tfor n := 0; n < 5; n++ {\n\t\tif n%2 == 0 {\n\t\t\tcontinue\n\t\t}\n\t\tfmt.Println(n)\n\t}\n\tfor i <= 3 {\n\t\tfmt.Println(i)\n\t\ti = i + 1\n\t}\n}\n```\n\n```\nloop\n7\n8\n1\n3\n1\n2\n3\n```\n\n## Key Points\n\n1. goè¯­è¨€åªæœ‰forå¾ªç¯\n2. æœ€ç®€å•çš„foråé¢ä»€ä¹ˆä¹Ÿä¸å†™ï¼Œæ˜¯æ­»å¾ªç¯\n3. for iç­‰äº0ï¼Œiå°äºnï¼ŒiåŠ åŠ ã€‚è¿™ä¸­é—´ä¸‰æ®µï¼Œä»»ä½•ä¸€æ®µéƒ½å¯ä»¥çœç•¥ã€‚\n\n# switch\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"time\"\n)\n\nfunc main() {\n\ta := 2\n\tswitch a {\n\tcase 1:\n\t\tfmt.Println(\"one\")\n\tcase 2:\n\t\tfmt.Println(\"two\")\n\tcase 3:\n\t\tfmt.Println(\"Three\")\n\tcase 4, 5:\n\t\tfmt.Println(\"four or five\")\n\tdefault:\n\t\tfmt.Println(\"Other\")\n\t}\n\n\tt := time.Now()\n\tswitch {\n\tcase t.Hour() < 12:\n\t\tfmt.Println(\"It's before noon\")\n\tdefault:\n\t\tfmt.Println(\"It's after noon\")\n\t}\n}\n```\n\n```\ntwo\nIt's after noon\n```\n\n## Key Points\n\n1. goè¯­è¨€çš„switchåé¢çš„é‚£ä¸ªå˜é‡åï¼Œä¸è¦æ‹¬å·ã€‚\n2. å¾ˆå¤§çš„ä¸€ç‚¹ä¸åŒçš„æ˜¯ï¼Œåœ¨cppé‡Œé¢ï¼Œswitch caseå¦‚æœä¸åŠ breakçš„è¯ä¼šç„¶åä¼šç»§ç»­å¾€ä¸‹è·‘å®Œæ‰€æœ‰çš„caseï¼Œåœ¨goè¯­è¨€é‡Œé¢çš„è¯ä¸åŠ breakä¹Ÿä¼šè·³å‡ºæ¥ã€‚\n3. ç›¸æ¯”Cæˆ–è€…Cppï¼Œgoè¯­è¨€é‡Œé¢çš„switchåŠŸèƒ½æ›´å¼ºå¤§ã€‚å¯ä»¥ä½¿ç”¨ä»»æ„çš„å˜é‡ç±»å‹ï¼Œç”šè‡³å¯ä»¥ç”¨æ¥å–ä»£ä»»æ„çš„if elseè¯­å¥ã€‚ä½ å¯ä»¥åœ¨switchåé¢ä¸åŠ ä»»ä½•çš„å˜é‡ï¼Œç„¶ååœ¨caseé‡Œé¢å†™æ¡ä»¶åˆ†æ”¯ã€‚è¿™æ ·ä»£ç ç›¸æ¯”ä½ ç”¨å¤šä¸ªif elseä»£ç é€»è¾‘ä¼šæ›´ä¸ºæ¸…æ™°ã€‚\n\n# array\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n)\n\nfunc main() {\n\tvar a [5]int\n\ta[4] = 100\n\tfmt.Println(a[4], len(a))\n\n\tb := [5]int{1, 2, 3, 4, 5}\n\tfmt.Println(b)\n\n\tvar twoD [2][3]int\n\tfor i := 0; i < 2; i++ {\n\t\tfor j := 0; j < 3; j++ {\n\t\t\ttwoD[i][j] = i + j\n\t\t}\n\t}\n\tfmt.Println(\"2d: \", twoD)\n}\n```\n\n```\n100 5\n[1 2 3 4 5]\n2d:  [[0 1 2] [1 2 3]]\n```\n\n## Key Points\n\n1. æ•°ç»„å°±æ˜¯ä¸€ä¸ªå…·æœ‰ç¼–å·ä¸”é•¿åº¦å›ºå®šçš„å…ƒç´ åºåˆ—ã€‚\n2. å¯¹äºä¸€ä¸ªæ•°ç»„ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å–ç‰¹å®šç´¢å¼•çš„å€¼æˆ–è€…å¾€ç‰¹å®šç´¢å¼•å–å­˜å‚¨å€¼ï¼Œç„¶åä¹Ÿèƒ½å¤Ÿç›´æ¥å»æ‰“å°ä¸€ä¸ªæ•°ç»„ã€‚ä¸è¿‡ï¼Œåœ¨çœŸå®ä¸šåŠ¡ä»£ç é‡Œé¢ï¼Œå¾ˆå°‘ç›´æ¥ä½¿ç”¨æ•°ç»„ï¼Œå› ä¸ºé•¿åº¦æ˜¯å›ºå®šçš„ï¼Œç”¨çš„æ›´å¤šçš„æ˜¯åˆ‡ç‰‡ã€‚\n\n# Slice\n\nåœ¨Goè¯­è¨€ä¸­ï¼Œ\"slice\"æ˜¯å¯¹æ•°ç»„çš„ä¸€ç§æŠ½è±¡è¡¨ç¤ºã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä»æ•°ç»„ä¸­\"åˆ‡ä¸‹\"æ¥çš„ä¸€ç‰‡ï¼Œæ‰€ä»¥è¢«ç§°ä¸º\"slice\"ï¼ˆåˆ‡ç‰‡ï¼‰ã€‚åˆ‡ç‰‡æ˜¯åŠ¨æ€çš„ï¼Œå®ƒä»¬å¯ä»¥æ ¹æ®éœ€è¦è‡ªåŠ¨å¢é•¿å’Œç¼©å°ï¼Œè¿™ä¸æ•°ç»„çš„å›ºå®šå¤§å°å½¢æˆå¯¹æ¯”ã€‚åˆ‡ç‰‡æä¾›äº†ä¸€ä¸ªæ›´çµæ´»ï¼Œæ›´å¼ºå¤§çš„æ¥å£æ¥å¤„ç†åºåˆ—ç±»å‹çš„æ•°æ®ã€‚\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n)\n\nfunc main() {\n\ts := make([]string, 3)\n\ts[0] = \"a\"\n\ts[1] = \"b\"\n\ts[2] = \"c\"\n\tfmt.Println(\"get:\", s[2])   //c\n\tfmt.Println(\"len:\", len(s)) //3\n\n\ts = append(s, \"d\")\n\ts = append(s, \"e\", \"f\")\n\tfmt.Println(s) // [a b c d e f]\n\tc := make([]string, len(s))\n\tcopy(c, s)\n\tfmt.Println(c)\n\n\tfmt.Println(s[2:5]) // [c d e]\n\tfmt.Println(s[:5])  // [a b c d e]\n\tfmt.Println(s[2:])  // [c d e f]\n\n\tgood := []string{\"g\", \"o\", \"o\", \"d\"}\n\tfmt.Println(good) // [g o o d]\n}\n```\n\n## Key Points\n\n1. å¯ä»¥ç”¨makeæ¥åˆ›å»ºä¸€ä¸ªåˆ‡ç‰‡ï¼Œå¯ä»¥åƒæ•°ç»„ä¸€æ ·å»å–å€¼\n2. ä½¿ç”¨appendæ¥è¿½åŠ å…ƒç´ ã€‚æ³¨æ„appendçš„ç”¨æ³•ï¼Œå¿…é¡»æŠŠappendçš„ç»“æœè¿”å›ç»™åŸæ•°ç»„ã€‚å› ä¸ºsliceçš„åŸç†å®é™…ä¸Šæ˜¯å®ƒæœ‰ä¸€ä¸ªå®ƒå­˜å‚¨äº†ä¸€ä¸ªé•¿åº¦å’Œä¸€ä¸ªå®¹é‡ï¼ŒåŠ ä¸€ä¸ªæŒ‡å‘ä¸€ä¸ªæ•°ç»„çš„æŒ‡é’ˆï¼Œåœ¨æ‰§è¡Œappendæ“ä½œçš„æ—¶å€™ï¼Œå¦‚æœå®¹é‡ä¸å¤Ÿçš„è¯ï¼Œä¼šæ‰©å®¹å¹¶ä¸”è¿”å›æ–°çš„ sliceã€‚\n3. sliceåˆå§‹åŒ–çš„æ—¶å€™ä¹Ÿå¯ä»¥æŒ‡å®šé•¿åº¦ã€‚\n4. sliceæ‹¥æœ‰åƒpythonä¸€æ ·çš„åˆ‡ç‰‡æ“ä½œï¼Œæ¯”å¦‚å–å‡ºç¬¬äºŒä¸ªåˆ°ç¬¬äº”ä¸ªä½ç½®çš„å…ƒç´ ï¼Œä¸åŒ…æ‹¬ç¬¬äº”ä¸ªå…ƒç´ ã€‚ä¸è¿‡ä¸åŒäºpythonçš„æ˜¯ä¸æ”¯æŒè´Ÿæ•°ç´¢å¼•ã€‚\n\n# map\n\n1. å¯ä»¥ç”¨makeåˆ›å»ºä¸€ä¸ªç©ºmap\n\n   ```go\n   m := make(map[string]int)\n   ```\n\n   \n","categories":["Go"]},{"title":"åç¨‹_Cppåç¨‹æ¡†æ¶ç®€å•å®ç°","url":"/å¤šçº¿ç¨‹/åç¨‹_Cppåç¨‹æ¡†æ¶ç®€å•å®ç°/","content":"\n# è¿›ç¨‹ã€çº¿ç¨‹ã€åç¨‹çš„å¯¹æ¯”\n\n|                | è¿›ç¨‹                                    | çº¿ç¨‹                               | åç¨‹                              |\n| -------------- | --------------------------------------- | ---------------------------------- | --------------------------------- |\n| åˆ‡æ¢è€…         | æ“ä½œç³»ç»Ÿ                                | æ“ä½œç³»ç»Ÿ                           | ç”¨æˆ·                              |\n| åˆ‡æ¢æ—¶æœº       | æ ¹æ®æ“ä½œç³»ç»Ÿçš„è°ƒåº¦ç­–ç•¥ï¼Œå¯¹ç”¨æˆ·é€æ˜      | æ ¹æ®æ“ä½œç³»ç»Ÿçš„è°ƒåº¦ç­–ç•¥ï¼Œå¯¹ç”¨æˆ·é€æ˜ | ç”¨æˆ·è‡ªå·±å†³å®š                      |\n| åˆ‡æ¢å†…å®¹       | 1ã€é¡µå…¨å±€ç›®å½•ï¼›2ã€å†…æ ¸æ ˆï¼›3ã€ç¡¬ä»¶ä¸Šä¸‹æ–‡ | 1ã€å†…æ ¸æ ˆï¼›2ã€ç¡¬ä»¶ä¸Šä¸‹æ–‡           | ç¡¬ä»¶ä¸Šä¸‹æ–‡                        |\n| åˆ‡æ¢å†…å®¹çš„ä¿å­˜ | ä¿å­˜äºå†…æ ¸æ ˆä¸­                          | ä¿å­˜äºå†…æ ¸æ ˆä¸­                     | ä¿å­˜äºç”¨æˆ·è‡ªå·±çš„å˜é‡ï¼ˆç”¨æˆ·æ ˆ/å †ï¼‰ |\n| åˆ‡æ¢è¿‡ç¨‹       | ç”¨æˆ·æ€->å†…æ ¸æ€->ç”¨æˆ·æ€                  | ç”¨æˆ·æ€->å†…æ ¸æ€->ç”¨æˆ·æ€             | ç”¨æˆ·æ€                            |\n\nç¡¬ä»¶ä¸Šä¸‹æ–‡å¯ä»¥åœ¨ç½‘ä¸ŠæŸ¥é˜…èµ„æ–™ã€‚\n\n## åç¨‹çš„ä¼˜ç¼ºç‚¹\n\n1. IOé˜»å¡æ—¶ï¼Œåç¨‹çš„åˆ‡æ¢æ•ˆç‡æ¯”è¾ƒé«˜\n2. ä¸éœ€è¦é”æœºåˆ¶ã€‚å®é™…ä¸Šï¼Œåˆ›å»ºäº†å¤§é‡çš„åç¨‹ä¹‹åï¼Œå®ƒä»¬æ˜¯æŒ‰é¡ºåºæ‰§è¡Œçš„ï¼Œä¸å­˜åœ¨ç«äº‰å…³ç³»ã€‚\n\nä½†æ˜¯ä¸èƒ½åˆ©ç”¨å¤šæ ¸CPUã€‚\n\n# å¦‚ä½•å®ç°åç¨‹\n\nåˆ©ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„æ¥å£æ¥å®ç°åç¨‹ã€‚\n\n1. Linuxçš„ucontext\n2. Windowsçš„Fiber\n\n## `ucontext_t`ç»“æ„\n\næ ¹æ®UNIXç¯å¢ƒé«˜çº§ç¼–ç¨‹ç¬¬ä¸‰ç‰ˆ280é¡µã€‚`ucontext_t`è¢«ç”¨ä½œæ ‡è¯†è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚è¯¥ç»“æ„è‡³å°‘åŒ…å«ä¸‹åˆ—å­—æ®µï¼š\n\n```cpp\nstruct ucontext_t\n{\n    ucontext_t * uc_link; //pointer to context resumed when this context returns\n    stack_t uc_stack;     //stack used by this context\n    mcontext_t uc_mcontext;//machine-specific representation of saved context\n}\n```\n\n`uc_stack`å­—æ®µæè¿°äº†å½“å‰ä¸Šä¸‹æ–‡ä½¿ç”¨çš„æ ˆï¼Œè‡³å°‘åŒ…æ‹¬ä¸‹åˆ—æˆå‘˜ï¼š\n\n```cpp\nstruct uc_stack\n{\n    void * ss_sp;   //stack base or pointer\n    size_t ss_size; //stack size\n    int ss_flags;   //flags\n}\n```\n\n## ucontextæä¾›çš„å››ä¸ªæ¥å£\n\n```cpp\nint getcontext(ucontext_t *ucp);\nint setcontext(const ucontext_t *ucp);\nvoid makecontext(ucontext_t *ucp, (void *func)(), int argc, ...);\nint swapcontext(ucontext_t *oucp, const ucontext_t *ucp);//ä¿å­˜oucp, æ¢åˆ°ucp\n```\n\n1. getcontext: ä¿å­˜ä¸Šä¸‹æ–‡ï¼Œå°†å½“å‰è¿è¡Œåˆ°çš„å¯„å­˜å™¨çš„ä¿¡æ¯ä¿å­˜åˆ°`ucontext_t`ç»“æ„ä½“ä¸­ã€‚\n2. setcontext: æ¢å¤ä¸Šä¸‹æ–‡ï¼Œå°†`ucontext_t`ç»“æ„ä½“å˜é‡ä¸­çš„ä¸Šä¸‹æ–‡ä¿¡æ¯é‡æ–°æ¢å¤åˆ°CPUä¸­å¹¶æ‰§è¡Œã€‚\n3. makecontext: ä¿®æ”¹ä¸Šä¸‹æ–‡ï¼Œç»™`ucontext_t`ä¸Šä¸‹æ–‡æŒ‡å®šä¸€ä¸ªç¨‹åºå…¥å£å‡½æ•°ï¼Œè®©ç¨‹åºä»è¯¥å…¥å£å‡½æ•°ä¸­å¼€å§‹æ‰§è¡Œã€‚\n4. swapcontext: åˆ‡æ¢ä¸Šä¸‹æ–‡ï¼Œä¿å­˜å½“å‰ä¸Šä¸‹æ–‡ï¼Œå¹¶å°†ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸Šä¸‹æ–‡æ¢å¤åˆ°CPUä¸­ã€‚\n\n## ucontextç®€å•çš„ä½¿ç”¨ç¤ºä¾‹\n\n```cpp\n#include<stdio.h>\n#include<stdlib.h>\n#include<unistd.h>\n#include<ucontext.h>\n\nint main()\n{\n    int i = 0;\n    ucontext_t ctx;\n    \n    getcontext(&ctx);        //è·å–å½“å‰ä¸Šä¸‹æ–‡\n    printf(\"i = %d\\n\", i++);\n    sleep(1);\n    \n    setcontext(&ctx);        //æ¢å¤ä¸Šä¸‹æ–‡\n    return 0;\n}\n```\n\n# åç¨‹æ¡†æ¶è®¾è®¡\n\n## åç¨‹ç±»\n\nä¸‰ä¸ªçŠ¶æ€ï¼šå°±ç»ªæ€ã€è¿è¡Œæ€ã€æŒ‚èµ·æ€ã€‚\n\næˆå‘˜ï¼š\n\n1. ä¸Šä¸‹æ–‡`m_ctx`\n2. çŠ¶æ€`m_status`\n3. æ ˆç©ºé—´æŒ‡é’ˆ`m_stack`ï¼ŒåŠæ ˆç©ºé—´å¤§å°`m_stack_size`\n\næˆå‘˜æ–¹æ³•ï¼š\n\n1. runï¼šçº¯è™šå‡½æ•°ï¼Œéœ€è¦å­ç±»æ¥å®ç°åç¨‹çš„å…·ä½“ä¸šåŠ¡é€»è¾‘\n2. resumeï¼šç»§ç»­æ‰§è¡Œå·²ç»æŒ‚èµ·çš„çº¿ç¨‹ã€‚\n3. yieldï¼šå½“å‰åç¨‹â€œæ”¾å¼ƒâ€æ‰§è¡Œï¼Œè®©è°ƒåº¦å™¨è°ƒåº¦å¦ä¸€åç¨‹ç»§ç»­æ‰§è¡Œã€‚\n\n```cpp\nclass Routine\n{\npublic:\n    enum Status { RT_READY = 0, RT_RUNNING, RT_SUSPEND };\n    Routine();\n    virtual ~Routine();\n    \n    virtual void run() = 0;\n    void resume();\n    void yield();\n    int status();\nprotected:\n    static void func(void * ptr);\nprivate:\n    ucontext_t m_ctx;\n    int m_status;\n    char * m_stack;\n    int m_stack_size;\n};\n```\n\né»˜è®¤æ— å‚æ„é€ å‡½æ•°ä¸åˆ†é…æ ˆç©ºé—´ï¼Œåªæœ‰yieldæ—¶æ‰åˆ†é…ã€‚\n\n```cpp\nRoutine::Routine() : m_status(RT_READY), m_stack(nullptr), m_stack_size(0)\n{}\n```\n\n### yieldå®ç°\n\n```\næ³¨æ„ï¼šyieldä¸€èˆ¬æ˜¯åœ¨runæ–¹æ³•ä¸­æœ€åä¸€å¥è¯ä¸­ä¸»åŠ¨è°ƒç”¨çš„ã€‚è€Œrunæ–¹æ³•æ˜¯åœ¨ç”¨æˆ·æŒ‡å®šçš„m_ctxä¸­æ‰§è¡Œçš„ï¼Œæ‰€ä»¥ï¼Œyieldä¸­å®šä¹‰çš„å˜é‡åœ°å€ä¹Ÿæ˜¯å¤„äºm_ctxæŒ‡å®šçš„æ ˆç©ºé—´ä¸­åˆ†é…çš„ã€‚\n```\n\nä¸»è¦çš„å·¥ä½œæ˜¯ï¼š\n\n1. æŠŠåç¨‹æ ˆä¸­çš„å†…å®¹å¤åˆ¶ä¿å­˜åˆ°`m_stack`ä¸­å­˜å‚¨ã€‚**åˆ©ç”¨äº†ä¸€ä¸ªdummyå˜é‡ï¼Œæ¢æµ‹åç¨‹æ ˆå®é™…ä½¿ç”¨äº†çš„è¾¹ç•Œåœ°å€ï¼ˆæœ€ä½åœ°å€ï¼Œæ ˆçš„å¢é•¿æ–¹å‘æ˜¯ä»é«˜åˆ°ä½ï¼‰ã€‚**\n\nå…¶ä»–çš„å·¥ä½œï¼š\n\n2. æŠŠè‡ªèº«æ”¾å…¥åˆ°è°ƒåº¦å™¨ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼›\n3. è°ƒç”¨swapcontextã€‚ä¿å­˜`m_ctx`ä¸Šä¸‹æ–‡ï¼Œåˆ‡æ¢åˆ°`s->m_main`ä¸Šä¸‹æ–‡ã€‚\n\n```cpp\nvoid Routine::yield()\n{\n    auto s = Singleton<Schedule>::instance();\n    char dummy = 0;\n    assert(s->m_stack + s->m_stack_size - &dummy <= s->m_stack_size);\n    if(m_stack_size < s->m_stack + s->m_stack_size - &dummy)\n    {\n        delete [] m_stack;\n        m_stack_size = s->m_stack + s->m_stack_size - &dummy;\n        m_stack = new char[m_stack_size];\n    }\n    std::memcpy(m_stack, &dummy, m_stack_size);\n    m_status = RT_SUSPEND;\n    s->append(this);\n    swapcontext(&m_ctx, &s->m_main);\n}\n```\n\n\n\n### resumeå®ç°\n\né€šå¸¸æ˜¯Scheduleå•ä¾‹å¯¹è±¡æ¥ä»å…¶ä»»åŠ¡é˜Ÿåˆ—ä¸­å‡ºé˜Ÿä¸€ä¸ªRoutineï¼Œå¹¶è°ƒç”¨è¯¥routineçš„resumeæ–¹æ³•ã€‚\n\næŒ‚èµ·çŠ¶æ€ï¼š\n\n1. æŠŠ`m_stack`ä¸­ä¿å­˜çš„å†…å®¹å¤åˆ¶åˆ°`s->m_stack + s->m_stack_size - m_stack_size`çš„ä½ç½®ï¼Œå³ä»`s->m_stack`ä½ç½®å¼€å§‹æ­£å¥½å­˜å‚¨`m_stack_size`ã€‚\n2. è°ƒç”¨`swapcontext`ï¼Œä¿å­˜`s->m_main`ä¸Šä¸‹æ–‡ï¼Œåˆ‡æ¢åˆ°`m_ctx`ä¸Šä¸‹æ–‡ã€‚\n\n```cpp\ncase RT_SUSPEND:\n    std::memcpy(s->m_stack + s->m_stack_size - m_stack_size, m_stack, m_stack_size);// dest src size\n    m_status = RT_RUNNING;\n    swapcontext(&s->m_main, &m_ctx);\n```\n\nå‡†å¤‡çŠ¶æ€ï¼š\n\n1. getcontextå°†å½“å‰è¿è¡Œåˆ°çš„å¯„å­˜å™¨çš„ä¿¡æ¯ä¿å­˜åˆ°`ucontext_t`ç»“æ„ä½“ä¸­ã€‚\n2. è®¾ç½®`m_ctx`çš„æ ˆç©ºé—´ï¼Œç”¨`m_ctx.uc_stack.ss_sp`æŒ‡å®šï¼Œæ­¤æ—¶æˆ‘ä»¬ä½¿ç”¨è°ƒåº¦å™¨sçš„å…±äº«æ ˆç©ºé—´ã€‚\n3. `m_ctx.uc_link`ï¼Œè¡¨ç¤ºpointer to context resumed when this context returnsã€‚æŒ‡å‘`s->m_main`ã€‚\n4. è°ƒç”¨makecontextï¼ŒæŒ‡å®šå…¶è¿è¡Œfuncå‡½æ•°ï¼Œå‚æ•°ä¸º1ä¸ªï¼Œå³thisæŒ‡é’ˆï¼Œå¹¶ä¸”æŒ‡å®šå…¶åœ¨`m_ctx`ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œã€‚\n5. è°ƒç”¨swapcontextï¼Œä¿å­˜`s->main`ä¸Šä¸‹æ–‡ï¼Œåˆ‡æ¢åˆ°`m_ctx`ä¸Šä¸‹æ–‡ã€‚\n\n```cpp\ncase RT_READY:\n    getcontext(&m_ctx);\n    m_ctx.uc_stack.ss_sp = s->m_stack;\n    m_ctx.uc_stack.ss_size = s->m_stack_size;\n    m_ctx.uc_link = &s->m_main;\n    m_status = RT_RUNNING;\n    makecontext(&m_ctx, (void (*)(void))Routine::func, 1, this);\n    swapcontext(&s->m_main, &m_ctx);\n```\n\nä»¥ä¸Šä»£ç çš„ç›®çš„ï¼šæŒ‡å®šåç¨‹ä½¿ç”¨sçš„å…¬å…±æ ˆã€‚å¹¶ä¸”æŒ‡å®šåç¨‹æ‰§è¡Œå®Œæ¯•å›åˆ°è°ƒåº¦å™¨ã€‚\n\n### å®ä¾‹\n\n```cpp\n#include<iostream>\n#include<routine/routine.h> \nusing namespace xcg::routine;\n\nclass ARouine : public Routine\n{\npublic:\n    ARoutine(int * num) : Routine(), m_num(num) {}\n    ~ARoutine()\n    {\n        if(m_num != nullptr)\n        {\n            delete m_num;\n            m_num = nullptr;\n        }\n    }\n    void run() overide\n    {\n        for(int i = 0; i < *m_num; ++i)\n        {\n            std::cout << \"a run: num=\" << i << std::endl;\n            yield();\n        }\n    }\nprivate:\n    int * m_num;\n}\n```\n\nmain\n\n```cpp\n#include<iostream>\n\n#include<routine/schedule.h>\nusing namespace xcg::routine;\n\n#include<test/a_routine.h>\n#include<test/b_routine.h>\n\nint main()\n{\n    Logger::instance()->open(\"./main.log\");\n    Logger::instance()->console(false);\n    \n    auto s = Singleton<Schedule>::instance();\n    s->create();\n    \n    int * num1 = new int;\n    *num1 = 5;\n    Routine * a = new ARoutine(num1);\n    s->append(a);\n    \n    int * num2 = new int;\n    *num2 = 10;\n    Routine * b = new BRoutine(num2);\n    s->append(b);\n    \n    while(!s->empty())\n    {\n        std::cout << \"main run\" << std::endl;\n        s->resume();\n    }\n    return 0;\n}\n```\n\n## æ€»ç»“\n\næ€»è€Œè¨€ä¹‹ï¼Œåç¨‹åœ¨ä¸æ–­åœ°è¿›è¡Œyieldã€resumeã€‚åœ¨å‡†å¤‡/æŒ‚èµ·ã€è¿è¡Œæ€ä¸­ä¸æ–­åˆ‡æ¢ã€‚æ›´è¿›ä¸€æ­¥è¯´ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯`swapcontext(&s->m_main, &m_ctx);`å’Œ`swapcontext(&m_ctx, &s->m_main);`çš„ä¸æ–­è°ƒç”¨ã€‚\n\n## è°ƒåº¦å™¨Schedule\n\næˆå‘˜ï¼š\n\n1. è®°å½•ä¸Šä¸‹æ–‡çš„å˜é‡`m_main`\n2. æ ˆæŒ‡é’ˆ`m_stack`ï¼ŒåŠæ ˆå¤§å°`m_stack_size`\n3. ä»»åŠ¡é˜Ÿåˆ—`m_queue`ï¼Œç”¨listå­˜æ”¾åç¨‹æŒ‡é’ˆ\n\næˆå‘˜æ–¹æ³•ï¼š\n\n1. createï¼šåˆå§‹åŒ–åç¨‹è°ƒåº¦å™¨\n2. appendï¼šæ·»åŠ ä¸€ä¸ªæ–°åç¨‹åˆ°é˜Ÿåˆ—\n3. resumeï¼šå”¤é†’é˜Ÿåˆ—é‡ŒæŸä¸ªåç¨‹æ‰§è¡Œ\n\n```cpp\nclass Schedule\n{\n    friend class Routine;\npublic:\n    Schedule();\n    ~Schedule();\n    \n    void create(int stack_size = 1024 * 1024);\n    void append(Routine * c);\n    bool empty() const;\n    int size() const;\n    \n    void resume();\nprivate:\n    ucontext_t m_main;\n    char * m_stack;\n    int m_stack_size;\n    std::list<Routine *> m_queue;\n}\n```\n\n### åˆ›å»ºå®ç°\n\nä½¿ç”¨`new char[]`åˆ›å»ºä¸€ä¸ªæ ˆï¼Œå¹¶åˆå§‹åŒ–ä¸º0ã€‚\n\n```cpp\nvoid Schedule::create(int stack_size)//é»˜è®¤1024*1024\n{\n    m_stack_size = stack_size;\n    m_stack = new char[stack_size];\n    std::memset(m_stack, 0, stack_size);\n}\n```\n\n### ææ„å®ç°\n\n```cpp\nSchedule::~Schedule()\n{\n    for (auto it : m_queue)\n    {\n        delete it;\n    }\n    m_queue.clear();\n    if (m_stack != nullptr)\n    {\n        delete [] m_stack;\n        m_stack_size = 0;\n    }\n}\n```\n\n### å…¥é˜Ÿå®ç°\n\n```cpp\nvoid Schedule::append(Routine * c)\n{\n    m_queue.push_back(c);\n}\n```\n\n### resumeå®ç°\n\n```cpp\nvoid Schedule::resume()\n{\n    if (m_queue.empty())\n    {\n        return;\n    }\n    auto c = queue.front();\n    m_queue.pop_front();\n    c->resume();\n}\n```\n\n# åŸºäºåç¨‹çš„C++å¼‚æ­¥ç½‘ç»œæ¡†æ¶\n\n## Server\n\n```cpp\n#pragma once\n#include<string>\nusing std::string;\n\n#include <utility/system.h>\n#include <utility/logger.h>\n#include <utility/ini_file.h>\n#include <utility/singleton.h>\nusing namespace xcg::utility;\n\nnamespace xcg{\nnamespace frame{\n\nclass Server\n{\npublic:\n    Server();\n    ~Server();\n    \n    void listen(const string & ip, int port);\n    void start();\n    void set_connects(int connects);\nprivate:\n    string m_ip;\n    int m_port;\n    int m_connects;\n};\n}\n}\n```\n\n### æ„é€ å‡½æ•°\n\n1. æŒ‰ç…§é…ç½®æ–‡ä»¶åˆå§‹åŒ–Serverç±»æˆå‘˜çš„ipå’Œç«¯å£ä¿¡æ¯ï¼›\n2. åˆå§‹åŒ–æ—¥å¿—æ¨¡å—\n\n```cpp\nServer::Server() : m_connects(1024)\n{\n    System * sys = Singleton<System>::instance();\n    sys->init();\n    \n    // init inifile\n    Inifile * ini = Singleton<IniFile>::instance();\n    ini->load(sys->get_root_path() + \"/config/server.ini\");\n    \n    m_ip = (string)(*ini)[\"server\"][\"ip\"];\n    m_port = (*ini)[\"Server\"][\"port\"];\n    m_connects = (*ini)[\"server\"][\"max_conn\"];\n    \n    int level = (*ini)[\"server\"][\"log_level\"];\n    bool console = (*ini)[\"server\"][\"log_console\"];\n    \n    // init logger\n    Logger::instance()->open(sys->get_root_path() + \"/log/server.log\");\n    Logger::instance()->level(level);\n    Logger::instance()->console(console);\n}\n```\n\n### å¯åŠ¨å‡½æ•°\n\n1. å¯åŠ¨ã€åˆå§‹åŒ–socketè¿æ¥æ± \n2. å¯åŠ¨è°ƒåº¦å™¨\n3. ç”¨`m_ip, m_port`æ„é€ ServerSocket\n4. ç”¨å°è£…å¥½çš„ServerSocketæ„é€ ServerRoutineï¼Œç„¶åæŠŠServerRoutineåŠ å…¥åˆ°è°ƒåº¦å™¨çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚\n5. resumeä»»åŠ¡é˜Ÿåˆ—ä¸­çš„åç¨‹ã€‚\n\n```cpp\nvoid Server::start()\n{\n    Singleton<ObjectPool<Socket>>::instance()->init(m_connects);\n    auto s = Singleton<Schedule>::instance();//è°ƒåº¦å™¨\n    s->create();                             //åˆ›å»ºç¬¬ä¸€ä¸ªåç¨‹ï¼ŒæœåŠ¡åç¨‹\n    s->append(new ServerRoutine(new ServerSocket(m_ip, m_port)));\n    while(!s->empty())\n    {\n        s->resume();\n    }\n}\n```\n\n\n\n## æœåŠ¡åç¨‹\n\n1. ç›‘å¬å’Œå»ºç«‹å®¢æˆ·ç«¯çš„è¿æ¥\n2. å½“å®¢æˆ·ç«¯æ²¡æœ‰æ–°è¿æ¥æ—¶ç«‹åˆ»è®©å‡ºCPUï¼Œåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªåç¨‹ã€‚\n3. å½“å®¢æˆ·ç«¯æœ‰æ–°è¿æ¥æ—¶ï¼Œç»™å¯¹åº”çš„è¿æ¥æ–°å»ºä¸€ä¸ªclient routineã€‚\n\n```cpp\n#pargma once\n#include<cerrno>\n#inlcude<socket/socket.h>\nusing namespace xcg::socket;\n\n#include<routine/routine.h>\n#inlcude<routine/schedule.h>\nusing namespace xcg::routine;\n\nnamespace xcg\n{\nnamespace async\n{\n\nclass ServerRoutine : public Routine\n{\npublic:\n    ServerRoutine(Socket * socket);\n    ~ServerRoutine();\n    \n    void run() override;\nprivate:\n    Socket * m_socket;\n};\n\n}\n}\n```\n\n```cpp\n#include<async/server_routine.h>\n#include<async/client_routine.h>\nusing namespace xcg::async;\n\n#include<utility/singleton.h>\n#include<utility/object_pool.h>\nusing namespace xcg::utility;\n\nServerRoutine::ServerRoutine(Socket * socket) : Routine(), m_socket(socket)\n{}\n\nServerRoutine::~ServerRoutine()\n{\n    if(m_socket != nullptr)\n    {\n        delete m_socket;\n        m_socket = nullptr;\n    }\n}\nvoid ServerRoutine::run()\n{\n    log_debug(\"Server routine run\");\n    while(true)\n    {\n        int sockfd = m_socket->accept();\n        if(sockfd < 0)\n        {\n            log_debug(\"server accept would block: sockfd=%d errno=%d error=%s\", sockfd, errno, strerror(errno));\n            yield();                     //æ²¡æœ‰æ–°è¿æ¥ï¼Œè®©å‡ºCPU\n        }\n        else//æœ‰æœ‰æ•ˆè¿æ¥\n        {\n            Socket * socket = nullptr;\n            while(true)//å¦‚æœè¿æ¥æ± æ— èµ„æºåˆ™ä¸€ç›´å¡ä½ç”³è¯·\n            {\n                //ObjectPoolä¸ºè¿æ¥æ± ï¼Œä»è¿æ¥æ± ä¸­å–ä¸€ä¸ªèµ„æºç»™socketã€‚\n                socket = Singleton<ObjectPool<Socket>>::instance()->allocate();\n                if(socket != nullptr)\n                {\n                    break;\n                }\n                log_error(\"socket pool is empty\");\n                yield();                //è¿æ¥æ± å·²æ»¡ï¼Œè®©å‡ºCPU\n            }\n            // æœ‰æ•ˆè¿æ¥å¹¶ä¸”ç”³è¯·å¾—åˆ°èµ„æº åçš„æ“ä½œ\n            socket->m_sockfd = sockfd;\n            socket->set_non_blocking(); //å¥—æ¥å­—è®¾ç½®ä¸ºéé˜»å¡çš„\n            //æ–°å»ºä¸€ä¸ªClient Routineï¼Œæ·»åŠ åˆ°è°ƒåº¦å™¨é˜Ÿåˆ—ã€‚\n            Singleton<Schedule>::instance()->append(new ClientRoutine(socket));\n        }\n    }\n}\n```\n\n## å®¢æˆ·ç«¯åç¨‹\n\n1. å½“å®¢æˆ·ç«¯æ²¡æœ‰æ•°æ®åˆ°è¾¾ï¼Œè®©å‡ºCPUï¼Œåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªåç¨‹ã€‚\n2. å½“å®¢æˆ·ç«¯æœ‰æ•°æ®åˆ°è¾¾ï¼Œç«‹åˆ»å¤„ç†ï¼›\n3. å½“å®¢æˆ·ç«¯å…³é—­è¿æ¥ï¼Œåç¨‹è‡ªåŠ¨é”€æ¯ã€‚\n\n```cpp\n#pragma once\n#include<socket/socket.h>\nusing namespace xcg::socket;\n\n#include<routine/routine.h>\nusing namespace xcg::routine;\n\nnamespace xcg{\nnamespace async{\nclass ClientRoutine : public Routine\n{\npublic:\n    ClientRoutine(Socket * socket);\n    ~ClientRoutine();\n    void run() override;\nprivate:\n    Socket * m_socket;\n};\n}\n}\n```\n\n```cpp\n#include<async/client_routine.h>\nusing namespace xcg::async;\n\n#include<utility/singleton.h>\n#include<utility/object_pool.h>\nusing namespace xcg::utility;\n\nClientRoutine::ClientRoutine(Socket * socket) : Routine(), m_socket(socket)\n{}\n\nClientRoutine::~ClientRoutine()\n{\n    if(m_socket != nullptr)\n    {\n        Singleton<ObjectPool<Socket>>::instance()->release(m_socket);\n        m_socket = nullptr;\n    }\n}\n\nvoid ClientRoutine::run()\n{\n    log_debug(\"client routine run\");\n    char buf[1024];\n    while(true)\n    {\n        std::memset(buf, 0, 1024);\n        //socketå·²ç»åœ¨åˆ›å»ºæ—¶è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ï¼Œè¿”å›å€¼æœ‰ä¸‰ç§æƒ…å†µ:0 ->closed <0 ->æ­¤æ—¶æ²¡æ•°æ®åˆ°è¾¾ >0 ->æœ‰æ•°æ®åˆ°è¾¾\n        int len = m_socket->recv(buf, 1024);\n        if(len == 0)\n        {\n            log_info(\"socket closed by peer\");\n            m_socket->close();\n            break;\n        }\n        else if(len < 0)\n        {\n            log_debug(\"socket recv would block: len=%d, errno=%d, error=%s\", len, errno, strerror(errno));\n            yield();\n        }\n        else\n        {\n            log_info(\"socket recv: len=%d data=%s\", len, buf);\n            m_socket->send(buf, strlen(buf));\n            yield();\n        }\n    }\n}\n```\n\n## å…¥å£å‡½æ•°\n\n```cpp\n#include<iostream>\n#include<frame/server.h>\nusing namespace xcg::frame;\n\nint main()\n{\n    Server * server = Singleton<Server>::instance();\n    server->listen(\"127.0.0.1\", 8080);\n    server->start();\n    \n    return 0;\n}\n```\n\n# åŸºäºåç¨‹ç½‘ç»œæ¡†æ¶çš„èŠå¤©æœåŠ¡å™¨\n\n## å°è£…ä¸€ä¸ªTcpServerç±»\n\n```cpp\n#pragma once\nclass TcpServer : noncopyable\n{\npublic:\n    using ThreadInitCallback = std::function<void(EventLoop*)>;\npublic:\n    TcpServer(EventLoop *loop, const InetAddress &listenAddr,\n              const std::string &nameArg, Option option = kNoReusePort);\n    ~TcpServer();\n    void setThreadInitCallback(const ThreadInitCallback &cb)\n    {\n        m_threadInitCallback = cb;\n    }\n    void setConnectionCallback(const ConnectionCallback &cb)\n    {\n        m_connectionCallback = cb;\n    }\n    void setMessageCallback(const MessageCallback &cb)\n    {\n        m_messageCallback = cb;\n    }\n    void setWriteCompleteCallback(const WriteCompleteCallback &cb)\n    {\n        m_writeCompleteCallback = cb;\n    }\n\n    /* è®¾ç½®åº•å±‚subLoopä¸ªæ•° */\n    void setThreadNum(int numThreads);\n    /* å¼€å¯æœåŠ¡å™¨ç›‘å¬ */\n    void start();\nprivate:\n    void newConnection(int sockfd, const InetAddress & peerAddr);\n    void removeConnection(const TcpConnectionPtr & conn);\n    void removeConnectionInLoop(const TcpConnectionPtr & conn);\nprivate:\n    ConnectionCallback      m_connectionCallback;   //æ–°è¿æ¥æ—¶çš„å›è°ƒ\n    MessageCallback         m_;      //æœ‰è¯»å†™æ¶ˆæ¯æ—¶çš„å›è°ƒ\n    WriteCompleteCallback   m_writeCompleteCallback;//æ¶ˆæ¯å‘é€å®Œæˆåçš„å›è°ƒ\n    ThreadInitCallback      m_threadInitCallback;   //loopçº¿ç¨‹åˆå§‹åŒ–çš„å›è°ƒ\nprivate:\n    using ConnectionMap = std::unordered_map<std::string, TcpConnectionPtr>;\n    ConnectionMap m_connections;\nprivate:\n    std::atomic_int m_started;\n    int m_nextConnId;\n};\n```\n\n```cpp\n/**\n * æœ‰æ–°å®¢æˆ·ç«¯è¿æ¥æ—¶, acceptorä¼šæ‰§è¡Œè¿™ä¸ªå›è°ƒæ“ä½œ; \n */\nvoid TcpServer::newConnection(int sockfd, const InetAddress &peerAddr)\n{\n    EventLoop *ioLoop = m_threadPool->getNextLoop();\n    char buf[64] = {0};\n    snprintf(buf, sizeof buf, \"-%s#%d\", m_IPport.c_str(), m_nextConnId);\n    ++m_nextConnId;\n    std::string connName = m_name + buf;\n    LOG_INFO(\"%s [%s] - new connection [%s] from %s\\n\",\n             __FUNCTION__, m_name.c_str(), connName.c_str(), peerAddr.toIPport().c_str());\n    \n    //é€šè¿‡sockfdè·å–å…¶ç»‘å®šçš„ipåœ°å€å’Œç«¯å£ä¿¡æ¯\n    sockaddr_in local;\n    bzero(&local, sizeof local);\n    socklen_t addrlen = sizeof local;\n    if(::getsockname(sockfd, (sockaddr*)&local, &addrlen) < 0)\n    {\n        LOG_ERROR(\"socket::getsockname\\n\");\n    }\n    InetAddress localAddr(local);\n\n    //æ ¹æ®è¿æ¥æˆåŠŸçš„sockfd, åˆ›å»ºTcpConnectionè¿æ¥å¯¹è±¡\n    TcpConnectionPtr conn(std::make_shared<TcpConnection>\n        (ioLoop, connName, sockfd, localAddr, peerAddr));\n    m_connections[connName] = conn;\n    //ä¸‹é¢çš„å›è°ƒæ˜¯ç”¨æˆ·ç»™TcpServerè®¾ç½®çš„\n    conn->setConnectionCallback(m_connectionCallback);\n    conn->setMessageCallback(m_messageCallback);\n    conn->setWriteCompleteCallback(m_writeCompleteCallback);\n\n    //è®¾ç½®å¦‚ä½•å…³é—­è¿æ¥ - ç”¨æˆ·è°ƒç”¨conn->shutdown() æ—¶å›è°ƒ\n    conn->setCloseCallback(std::bind(&TcpServer::removeConnection, this, _1));\n    //ç›´æ¥è°ƒç”¨TcpConnection::connectEstablished, æŠŠstateç½®ä¸ºconnected, channel tieæ“ä½œ, enableReading;\n    ioLoop->runInLoop(std::bind(&TcpConnection::connectEstablished, conn));\n}\n```\n\n## TcpConnection\n\n```cpp\n#pragma once\n#include\"noncopyable.h\"\n#include\"inetaddress.h\"\n#include\"buffer.h\"\n#include\"callbacks.h\"\n#include<memory>\n#include<atomic>\nclass EventLoop;\nclass Socket;\nclass Channel;\nclass TcpConnection : noncopyable,\n               public std::enable_shared_from_this<TcpConnection>\n{\npublic:\n    enum StateE{\n        kDisconnected, kConnecting, kConnected, kDisconnecting\n    };\n    TcpConnection(EventLoop *loop, const std::string& name, int sockfd,\n                  const InetAddress& localAddr, const InetAddress& peerAddr);\n    ~TcpConnection();\npublic:\n    void connectEstablished();\n    void connectDestoryed();\npublic:\n    /* å…³é—­è¿æ¥ */\n    void shutdown();\npublic:\n    void setConnectionCallback(const ConnectionCallback & cb)\n    {\n        m_connectionCallback = cb;\n    }\n    void setMessageCallback(const MessageCallback & cb)\n    {\n        m_messageCallback = cb;\n    }\n    void setWriteCompleteCallback(const WriteCompleteCallback & cb)\n    {\n        m_writeCompleteCallback = cb;\n    }\n    void setCloseCallback(const CloseCallback &cb)\n    {\n        m_closeCallback = cb;\n    }\n    void setHighWaterMarkCallback(const HighWaterMarkCallback & cb, size_t highWaterMark)\n    {\n        m_highWaterMarkCallback = cb;\n        m_highWaterMark = highWaterMark;\n    }\npublic:\n    bool connected() const {return m_state == kConnected;}\n    void setState(StateE state) {m_state = state;}\npublic:\n    EventLoop * getLoop() const {return m_loop;}\n    const std::string& name() const {return m_name;}\n    const InetAddress& localAddress() const {return m_localAddr;}\n    const InetAddress& peerAddress() const {return m_peerAddr;}\nprivate:\n    void handleRead(Timestamp receiveTime);\n    void handleWrite();\n    void handleClose();\n    void handleError();\nprivate:\n    /**\n     * å‘é€æ•°æ®;\n     * ç”¨æˆ·ä¼šç»™TcpServeræ³¨å†ŒonMessageCallback, \n     * å·²å»ºç«‹è¿æ¥çš„ç”¨æˆ·æœ‰è¯»å†™äº‹ä»¶æ—¶, å°¤å…¶æ˜¯è¯»äº‹ä»¶, onMessageä¼šå“åº”; \n     * å¤„ç†å®Œå®¢æˆ·ç«¯å‘æ¥çš„äº‹ä»¶å(onMessageCallback), æœåŠ¡ç«¯ä¼šsendç»™å®¢æˆ·ç«¯å›å‘æ¶ˆæ¯; \n     * \n     * æ”¶å‘æ•°æ®çš„æ–¹å¼: \n     * æœ¬é¡¹ç›®çš„æ•°æ®æ”¶å‘ç»Ÿä¸€ä½¿ç”¨jsonæˆ–protobufæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²è¿›è¡Œ, \n     * æ‰€ä»¥æ­¤sendå‡½æ•°çš„å‚æ•°ä¸ºäº†æ–¹ä¾¿èµ·è§, ç›´æ¥è§„å®šä¸ºstringç±»å‹; \n     */\n    void send(const std::string & buf);\nprivate:\n    /**\n     * å‘é€æ•°æ®;\n     * åº”ç”¨å†™çš„å¿«, è€Œå†…æ ¸å‘é€æ•°æ®æ…¢, \n     * éœ€è¦æŠŠå¾…å‘é€æ•°æ®å†™å…¥ç¼“å†²åŒº, è€Œä¸”è®¾ç½®äº†æ°´ä½å›è°ƒ.\n     */\n    void sendInLoop(const void * data, size_t len);\nprivate:\n    void shutdownInLoop();\n/*************************å±æ€§*************************/\nprivate:\n    ConnectionCallback\t    m_connectionCallback;       //å…³äºè¿æ¥çš„å›è°ƒ\n    MessageCallback\t        m_messageCallback;          //å·²è¿æ¥ç”¨æˆ·æœ‰è¯»å†™äº‹ä»¶å‘ç”Ÿæ—¶çš„å›è°ƒ\n    WriteCompleteCallback   m_writeCompleteCallback;    //æ¶ˆæ¯å‘é€å®Œæˆåçš„å›è°ƒ\n    HighWaterMarkCallback   m_highWaterMarkCallback;    //é«˜æ°´ä½å›è°ƒï¼Œä¸ºäº†æ§åˆ¶æ”¶å‘æµé‡ç¨³å®š\n    CloseCallback           m_closeCallback;            //å…³é—­è¿æ¥çš„å›è°ƒ\nprivate:\n    EventLoop *m_loop;                  //subLoop\nprivate:\n    std::unique_ptr<Socket>  m_socket;  //unique_ptrç®¡ç†\n    std::unique_ptr<Channel> m_channel; //unique_ptrç®¡ç†\nprivate:\n    const InetAddress m_localAddr;      //æœ¬åœ°åœ°å€ä¿¡æ¯\n    const InetAddress m_peerAddr;       //å¯¹ç«¯åœ°å€ä¿¡æ¯\nprivate:\n    Buffer m_inputBuffer;               //å†™ç¼“å†²åŒº\n    Buffer m_outputBuffer;              //è¯»ç¼“å†²åŒº\nprivate:\n    const std::string m_name;\n    \n    std::atomic_int m_state;            //atomicï¼Œç”¨æšä¸¾ç±»å˜é‡èµ‹å€¼\n    \n    bool m_reading;\n    \n    size_t m_highWaterMark;             //é«˜æ°´ä½é˜ˆå€¼\n};\n```\n\n```cpp\nvoid TcpConnection::handleRead(Timestamp receiveTime)\n{\n    int savedErrno = 0;\n    ssize_t n = m_inputBuffer.readFd(m_channel->fd(), &savedErrno);\n    if(n > 0)\n    {\n        //å·²å»ºç«‹è¿æ¥çš„ç”¨æˆ·ï¼Œæœ‰å¯è¯»äº‹ä»¶å‘ç”Ÿäº†ï¼Œè°ƒç”¨ç”¨æˆ·ä¼ å…¥çš„å›è°ƒæ“ä½œonMessage\n        m_messageCallback(shared_from_this(), &m_inputBuffer, receiveTime);\n    }\n    else if(n == 0) //å®¢æˆ·ç«¯æ–­å¼€\n    {\n        handleClose();\n    }\n    else\n    {\n        errno = savedErrno;\n        LOG_ERROR(\"%s\\n\", __FUNCTION__);\n        handleError();\n    }\n}\nvoid TcpConnection::handleWrite()\n{\n    if(m_channel->isWriting())\n    {\n        int savedErrno = 0;\n        ssize_t n = m_outputBuffer.writeFd(m_channel->fd(), &savedErrno);\n        if(n > 0)\n        {\n            m_outputBuffer.retrieve(n);\n            if(m_outputBuffer.readableBytes() == 0)\n            {\n                m_channel->disableWriting();\n                if(m_writeCompleteCallback)\n                {\n                    /* å”¤é†’loopå¯¹åº”çš„threadçº¿ç¨‹, æ‰§è¡Œå›è°ƒ */\n                    m_loop->queueInLoop(std::bind(m_writeCompleteCallback,\n                                                  shared_from_this()));\n                }\n                if(m_state == kDisconnecting)\n                {\n                    shutdownInLoop();\n                }\n            }\n        }\n        else\n        {\n            LOG_ERROR(\"%s\\n\", __FUNCTION__);\n        }\n    }\n    else\n    {\n        LOG_ERROR(\"%s: connection fd = %d is down, no more writing.\\n\",\n                   __FUNCTION__, m_channel->fd());\n    }\n}\nvoid TcpConnection::handleClose()\n{\n    LOG_INFO(\"%s: fd = %d, state: %d\\n\", __FUNCTION__, m_channel->fd(), m_state.load());\n    setState(kDisconnected);\n    m_channel->disableAll();\n\n    TcpConnectionPtr connPtr(shared_from_this());\n    m_connectionCallback(connPtr);\n    m_closeCallback(connPtr);\n}\nvoid TcpConnection::handleError()\n{\n    int optval;\n    socklen_t optlen = sizeof optval;\n    int err = 0;\n    if(::getsockopt(m_channel->fd(), SOL_SOCKET, SO_ERROR, &optval, &optlen) < 0)\n    {\n        err = errno;\n    }\n    else\n    {\n        err = optval;\n    }\n    LOG_ERROR(\"%s name: %s - SO_ERROR: %d\\n\", __FUNCTION__, m_name.c_str(), err);\n}\n/**\n * 1. åˆ¤æ–­å½“å‰è¿æ¥çš„çŠ¶æ€æ˜¯å¦ä¸ºconnected; \n * 2. åˆ¤æ–­æ­¤loopæ˜¯å¦åœ¨æœ¬threadä¸­, å¦‚æœæ˜¯åˆ™è°ƒç”¨sendInLoop; å¦åˆ™runInLoop, ç»‘å®šçš„å‡½æ•°ä¹Ÿæ˜¯sendInLoop;\n */\nvoid TcpConnection::send(const std::string &buf)\n{\n    if(m_state == kConnected)\n    {\n        if(m_loop->isInLoopThread())\n        {\n            sendInLoop(buf.c_str(), buf.size());\n        }\n        else\n        {\n            m_loop->runInLoop(std::bind(&TcpConnection::sendInLoop,\n                              this, buf.c_str(), buf.size()));\n        }\n    }\n}\n/**\n * å‘é€æ•°æ®;\n * åº”ç”¨å†™çš„å¿«, è€Œå†…æ ¸å‘é€æ•°æ®æ…¢, \n * éœ€è¦æŠŠå¾…å‘é€æ•°æ®å†™å…¥ç¼“å†²åŒº, è€Œä¸”è®¾ç½®äº†æ°´ä½å›è°ƒ.\n */\nvoid TcpConnection::sendInLoop(const void * data, size_t len)\n{\n    ssize_t nwrote = 0;\n    size_t remaining = len;\n    bool faultError = false;\t//è®°å½•æ˜¯å¦äº§ç”Ÿé”™è¯¯\n    if(m_state == kDisconnected)\n    {\n        LOG_ERROR(\"Disconnected, give up writing!\");\n        return;\n    }\n    /** \n     * m_channel->isWriting()ä¸ºfalseè¡¨ç¤ºchannelç¬¬ä¸€æ¬¡å¼€å§‹å†™æ•°æ®, \n     * readableBytes()ä¸º0è¯´æ˜ç¼“å†²åŒºæ²¡æœ‰å¾…å‘é€æ•°æ®; \n     */\n    if(!m_channel->isWriting() && m_outputBuffer.readableBytes() == 0)\n    {\n        nwrote = ::write(m_channel->fd(), data, len);\n        if(nwrote >= 0)\n        {\n            remaining = len - nwrote;\n            if(remaining == 0 && m_writeCompleteCallback)\n            {\n                //å¦‚æœæ­¤æ—¶æ•°æ®å…¨éƒ¨å‘é€å®Œæ¯•, ä¸ç”¨å†ç»™channelè®¾ç½®epolloutäº‹ä»¶\n                m_loop->queueInLoop(std::bind(m_writeCompleteCallback, shared_from_this()));\n            }\n        }\n        else //nwrote < 0\n        {\n            nwrote = 0;\n            if(errno != EWOULDBLOCK)\n            {\n                LOG_ERROR(\"%s\\n\", __FUNCTION__);\n                if(errno == EPIPE || errno == ECONNRESET)// SIGPIPE or RESET\n                {\n                    faultError = true;\n                }\n            }\n        }\n    }\n    if(!faultError && remaining > 0)//æ²¡æœ‰å‡ºé”™, æ²¡æœ‰å‘é€å®Œæ¯•, å‰©ä½™æ•°æ®éœ€è¦å­˜åˆ°ç¼“å†²åŒº, ç„¶åç»™channelæ³¨å†Œepolloutäº‹ä»¶, LTæ¨¡å¼, pollerå‘ç°tcpçš„å‘é€ç¼“å†²åŒºæœ‰ç©ºé—´, ä¼šé€šçŸ¥ç›¸åº”çš„sock->channel, è°ƒç”¨writeCallbackæ–¹æ³•, å³è°ƒç”¨handleWrite, ç›´åˆ°æŠŠå‘é€ç¼“å†²åŒºä¸­æ•°æ®å…¨éƒ¨å‘é€\n    {\n        size_t oldlen = m_outputBuffer.readableBytes();\n        if(oldlen + remaining >= m_highWaterMark && oldlen < m_highWaterMark && m_highWaterMarkCallback)\n        {\n            m_loop->queueInLoop(std::bind(m_highWaterMarkCallback, shared_from_this(), oldlen+remaining));\n        }\n        m_outputBuffer.append((char*)data+nwrote, remaining);//data+nworteå³å‰©ä½™çš„ä½ç½®\n        if(!m_channel->isWriting())//m_channel->isWriting()ä¸ºfalseè¡¨ç¤ºchannelç¬¬ä¸€æ¬¡å¼€å§‹å†™æ•°æ®, ä¹‹å‰æ²¡æœ‰æ³¨å†Œepollout, ç°åœ¨éœ€è¦æ³¨å†Œ\n        {\n            m_channel->enableWriting();\n        }\n    }\n}\n```\n\n\n\n## é‡ç‚¹åœ¨äºClientRoutineçš„æ•°æ®å¤„ç†ä»£ç ç¼–å†™\n\n```cpp\n   void ClientRoutine::run()\n   {\n       log_debug(\"client routine run\");\n       char buf[1024];\n       while(true)\n       {\n           std::memset(buf, 0, 1024);\n           //socketå·²ç»åœ¨åˆ›å»ºæ—¶è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ï¼Œè¿”å›å€¼æœ‰ä¸‰ç§æƒ…å†µ:0 ->closed <0 ->æ­¤æ—¶æ²¡æ•°æ®åˆ°è¾¾ >0 ->æœ‰æ•°æ®åˆ°è¾¾\n           int len = m_socket->recv(buf, 1024);//æ¥å—å®¢æˆ·ç«¯å‘çš„æ¶ˆæ¯\n           if(len == 0)\n           {\n               log_info(\"socket closed by peer\");\n               m_socket->close();\n               break;\n           }\n           else if(len < 0)\n           {\n               log_debug(\"socket recv would block: len=%d, errno=%d, error=%s\", len, errno, strerror(errno));\n               yield();\n           }\n           else\n           {\n               log_info(\"socket recv: len=%d data=%s\", len, buf);\n               //handleRead\n               //å·²å»ºç«‹è¿æ¥çš„ç”¨æˆ·ï¼Œæœ‰å¯è¯»äº‹ä»¶å‘ç”Ÿäº†ï¼Œè°ƒç”¨ç”¨æˆ·ä¼ å…¥çš„å›è°ƒæ“ä½œonMessage\n               //messageCallback(m_socket, buf, time);\n               \n               //handle\n               m_socket->send(buf, strlen(buf));//ç»™å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯\n               yield();\n           }\n       }\n   }\n```\n\n### onMessage\n\n```cpp\n/* ä¸ŠæŠ¥è¯»å†™äº‹ä»¶ç›¸å…³ä¿¡æ¯çš„å›è°ƒå‡½æ•°*/\nvoid ChatServer::onMessage(const TcpConnectionPtr& conn,\n                           Buffer* buffer,\n                           Timestamp time)\n{\n    /**\n     * muduoåº“æˆ–ä»ç½‘ç»œä¸Šè¯»å–çš„æ•°æ®é¦–å…ˆåœ¨æ•°æ®ç¼“å†²åŒº;\n     * æ”¶åˆ°ä¸€ä¸ªæ¶ˆæ¯åï¼ŒretrieveAllAsStringå¯ä»¥æŠŠç¼“å†²åŒºçš„æ•°æ®;\n     * å–å‡ºåˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ã€‚\n     */\n    string buf = buffer->retrieveAllAsString();\n    /**\n     * æ•°æ®çš„ååºåˆ—åŒ–;\n     * jsonä¸­åŒ…å«message_typeï¼Œmessage_id;\n     */\n    json js = json::parse(buf);\n    /**\n     * é€šè¿‡js[\"msgid\"]ç»‘å®šä¸€ä¸ªå›è°ƒæ“ä½œï¼Œå³ä¸€ä¸ªidä¸€ä¸ªæ“ä½œ;\n     * è§£æåˆ°msgidåè·å–ä¸šåŠ¡å¤„ç†å™¨handlerï¼Œå¤„ç†å™¨æ˜¯äº‹å…ˆç»‘å®šçš„æ–¹æ³•ã€‚ç½‘ç»œæ¨¡å—çœ‹ä¸åˆ°ï¼Œä¸šåŠ¡æ¨¡å—ç»‘å®šçš„;\n     * å›è°ƒhandleræ—¶ï¼Œconnã€jså¯¹è±¡ã€timeéƒ½å¯ä»¥ä¼ å…¥;\n     * æˆ‘ä»¬è¦è¾¾åˆ°çš„ç›®çš„ï¼šå®Œå…¨è§£è€¦ç½‘ç»œæ¨¡å—çš„ä»£ç å’Œä¸šåŠ¡æ¨¡å—çš„ä»£ç ;\n     */\n    auto msgHandler = ChatService::instance()->getHandler(\n        js[\"msgid\"].get<int>());    // js[\"msgid\"] ä¾æ—§æ˜¯jsonç±»å‹ï¼Œéœ€è¦è½¬ä¸ºint\n    /* å›è°ƒæ¶ˆæ¯ç»‘å®šå¥½çš„äº‹ä»¶å¤„ç†å™¨ï¼Œæ¥æ‰§è¡Œç›¸åº”çš„ä¸šåŠ¡å¤„ç† */\n    msgHandler(conn, js, time);\n}\n```\n\n\n\n\n\n## ChatServiceç±»çš„è®¾è®¡ä¸å®ç°\n\n```cpp\n      #ifndef CHATSERVICE_H\n      #define CHATSERVICE_H\n      #include<muduo/net/TcpConnection.h>\n      #include<unordered_map>\n      #include<functional>\n      \n      #include\"redis.hpp\"\n      \n      #include\"usermodel.hpp\"\n      #include\"offlinemsgmodel.hpp\"\n      #include\"friendmodel.hpp\"\n      #include\"groupmodel.hpp\"\n      \n      using namespace std;\n      using namespace muduo;\n      using namespace muduo::net;\n      #include\"json.hpp\"\n      using json = nlohmann::json;\n      \n      #include<mutex>\n      \n      /* è¡¨ç¤ºå¤„ç†æ¶ˆæ¯çš„äº‹ä»¶å›è°ƒæ–¹æ³•ç±»å‹ */\n      using MsgHandler = std::function<void(const TcpConnectionPtr&, json&, Timestamp)>;\n      /**\n       * èŠå¤©æœåŠ¡å™¨ä¸šåŠ¡ç±». \n       * ç”¨æ˜ å°„å…³ç³»æ¥å­˜å‚¨æ¶ˆæ¯idå’Œå…·ä½“å¤„ç†å‡½æ•°. \n       * æ­¤ç±»æœ‰ä¸€ä¸ªå®ä¾‹å°±å¤Ÿäº†ï¼Œæ‰€ä»¥é‡‡ç”¨å•ä¾‹æ¨¡å¼. \n       */\n      class ChatService\n      {\n      public:\n          /* è·å–å•ä¾‹å¯¹è±¡çš„æ¥å£å‡½æ•° */\n          static ChatService* instance();\n      public:\n          /* å¤„ç†ç™»å½•ä¸šåŠ¡ */\n          void login(const TcpConnectionPtr &conn, json &js, Timestamp time);\n          /* å¤„ç†æ³¨å†Œä¸šåŠ¡ */\n          void reg(const TcpConnectionPtr &conn, json &js, Timestamp time);\n      \n          /* æ·»åŠ å¥½å‹ä¸šåŠ¡ */\n          void addFriend(const TcpConnectionPtr &conn, json &js, Timestamp time);\n          /* ä¸€å¯¹ä¸€èŠå¤©ä¸šåŠ¡ */\n          void oneChat(const TcpConnectionPtr &conn, json &js, Timestamp time);\n      \n          /* åˆ›å»ºç¾¤ç»„ä¸šåŠ¡ */\n          void createGroup(const TcpConnectionPtr &conn, json &js, Timestamp time);\n          /* åŠ å…¥ç¾¤ç»„ä¸šåŠ¡ */\n          void addGroup(const TcpConnectionPtr &conn, json &js, Timestamp time);\n          /* ç¾¤ç»„èŠå¤©ä¸šåŠ¡ */\n          void groupChat(const TcpConnectionPtr &conn, json &js, Timestamp time);\n      public:\n          /* è·å–æ¶ˆæ¯å¯¹åº”çš„å¤„ç†å™¨ */\n          MsgHandler getHandler(int msgid);\n      public:\n          /* å¤„ç†å®¢æˆ·ç«¯å¼‚å¸¸é€€å‡º */\n          void clientCloseException(const TcpConnectionPtr & conn);\n      public:\n          /* ä¸šåŠ¡é‡ç½®æ–¹æ³•ï¼Œé€šå¸¸åœ¨æœåŠ¡å™¨å¼‚å¸¸é€€å‡ºæ—¶è°ƒç”¨ */\n          void reset();\n      #ifdef __CLUSTER__\n      public:\n          /* ä»Redisæ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å–è®¢é˜…çš„æ¶ˆæ¯ */\n          void handleRedisSubscribeMessage(int channel, string message);\n      #endif\n      \n      private:\n          ChatService();\n      private:\n          UserModel       _userModel;         /* æ•°æ®æ“ä½œç±»å¯¹è±¡ */\n          OfflineMsgModel _offlineMsgModel;   /* æ•°æ®æ“ä½œç±»å¯¹è±¡ */\n          FriendModel     _friendModel;       /* æ•°æ®æ“ä½œç±»å¯¹è±¡ */\n          GroupModel      _groupModel;        /* æ•°æ®æ“ä½œç±»å¯¹è±¡ */\n      private:\n          /* å®šä¹‰äº’æ–¥é”ï¼Œä¿è¯m_userConnectionMapçš„çº¿ç¨‹å®‰å…¨ */\n          mutex _connMutex;\n      private:\n          /* å­˜å‚¨æ¶ˆæ¯idå’Œå…¶å¯¹åº”çš„ä¸šåŠ¡å¤„ç†æ–¹æ³• */\n          unordered_map<int, MsgHandler> _msgHandlerMap;\n          /* å­˜å‚¨åœ¨çº¿ç”¨æˆ·çš„é€šä¿¡è¿æ¥ */\n          unordered_map<int, TcpConnectionPtr> _userConnectionMap;\n      #ifdef __CLUSTER__\n      private:\n          /* redisæ“ä½œå¯¹è±¡ */\n          Redis m_redis;\n      #endif\n      };\n      #endif\n```\n\n```cpp\n      #include\"chatservice.hpp\"\n      #include\"public.hpp\"\n      #include<muduo/base/Logging.h>  // LOG_ERROR <<\n      \n      using namespace muduo;\n      \n      #include<vector>\n      using namespace std;\n      \n      ChatService* ChatService::instance()\n      {\n          static ChatService service;\n          return &service;\n      }\n      /**\n       * æ³¨å†Œæ¶ˆæ¯ä»¥åŠå¯¹åº”çš„Handlerå›è°ƒæ“ä½œ\n       * å¯¹unordered_mapæˆå‘˜å˜é‡è¿›è¡Œåˆå§‹åŒ–\n       * è¿™æ˜¯ä¸šåŠ¡æ¨¡å—çš„æ ¸å¿ƒï¼Œä¹Ÿæ˜¯å¯¹é¡¹ç›®è¿›è¡Œè§£è€¦çš„æ ¸å¿ƒ\n       */\n      ChatService::ChatService()\n      {\n          /* é”®ï¼šæ¶ˆæ¯id - å€¼ï¼šå‡½æ•°å¯¹è±¡ */\n          _msgHandlerMap.insert({LOGIN_MSG, std::bind(&ChatService::login, this, _1, _2, _3)});\n          _msgHandlerMap.insert({REG_MSG, std::bind(&ChatService::reg, this, _1, _2, _3)});\n          _msgHandlerMap.insert({ONE_CHAT_MSG, std::bind(&ChatService::oneChat, this, _1, _2, _3)});\n          _msgHandlerMap.insert({ADD_FRIEND_MSG, std::bind(&ChatService::addFriend, this, _1, _2, _3)});\n      #ifdef __CLUSTER__\n          if(m_redis.connect())\n          {\n              m_redis.init_notify_handler(std::bind(\n                  &ChatService::handleRedisSubscribeMessage, this, _1, _2));\n          }\n      #endif\n      }\n      /* ä¸šåŠ¡é‡ç½®æ–¹æ³•ï¼Œé€šå¸¸åœ¨æœåŠ¡å™¨å¼‚å¸¸é€€å‡ºæ—¶è°ƒç”¨ */\n      void ChatService::reset()\n      {\n          /* æŠŠæ‰€æœ‰onlineç”¨æˆ·çš„çŠ¶æ€ç½®ä¸ºoffline */\n          _userModel.resetAllState();\n      }\n      /* è·å–æ¶ˆæ¯å¯¹åº”çš„å¤„ç†å™¨ */\n      MsgHandler ChatService::getHandler(int msgid)\n      {\n          /* è®°å½•é”™è¯¯æ—¥å¿—ï¼Œmsgidæ²¡æœ‰å¯¹åº”çš„äº‹ä»¶å¤„ç†å›è°ƒæ—¶ */\n          auto it = _msgHandlerMap.find(msgid);\n          if(it == _msgHandlerMap.end())\n          {\n              /* æ²¡æœ‰æ‰¾åˆ°å¤„ç†å™¨æ—¶ï¼Œè¿”å›ä¸€ä¸ªé»˜è®¤çš„å¤„ç†å™¨ï¼Œç©ºæ“ä½œã€‚\n               * å¦‚æ­¤è®¾è®¡çš„å¥½å¤„ï¼Œå³ä½¿æ²¡æœ‰æ‰¾åˆ°ç¨‹åºä¹Ÿä¸ä¼šå› æ­¤æŒ‚æ‰ï¼Œè¿›è¡Œç©ºæ“ä½œï¼Œç»§ç»­è¿è¡Œã€‚\n               * å› ä¸ºéœ€è¦è·å–å‡½æ•°å‚æ•°msgidï¼Œæ‰€ä»¥[=]æŒ‰å€¼è·å–ã€‚\n               */\n              return [=](const TcpConnectionPtr&, json&, Timestamp)\n              {\n                  LOG_ERROR << \"msgid: \" << msgid << \" can't find handler\";\n              };\n          }\n          else\n          {\n              return _msgHandlerMap[msgid];\n          }\n      }\n      /* å¤„ç†ç™»å½•ä¸šåŠ¡ */\n      void ChatService::login(const TcpConnectionPtr &conn,\n                              json &js, Timestamp time)\n      {\n          /* ä»jsonå‚æ•°è·å–è´¦å·ã€å¯†ç ä¿¡æ¯ */\n          int id = js[\"id\"].get<int>();\n          string password = js[\"password\"];\n          User user = _userModel.query(id);\n      \n          json response;\n          response[\"msgid\"] = LOGIN_MSG_ACK;\n          if(user.getId() == id && user.getPassword() == password)\n          {\n              if(user.getState() == \"online\")\n              {\n                  /* è¯¥ç”¨æˆ·å·²ç»ç™»å½•åœ¨çº¿ï¼Œä¸å…è®¸é‡å¤ç™»é™† */\n                  response[\"errno\"] = LOGIN_REPEAT;\n                  response[\"errmsg\"] = \"è¯¥ç”¨æˆ·å·²ç»ç™»å½•\";\n              }\n              else if(user.getState() == \"offline\")\n              {\n                  /* ç™»é™†æˆåŠŸ */\n                  {\n                      /* è®°å½•ç”¨æˆ·è¿æ¥ä¿¡æ¯ */\n                      lock_guard<mutex> lock(_connMutex);\n                      _userConnectionMap.insert({id, conn});\n                  }\n      #ifdef __CLUSTER__\n                  /**\n                   * é›†ç¾¤ç¯å¢ƒä¸‹, å‘redisè®¢é˜…æ­¤id \n                   */\n                  m_redis.subscribe(id);\n      #endif\n                  /* æ›´æ–°ç”¨æˆ·çŠ¶æ€ä¿¡æ¯ */\n                  user.setState(\"online\");\n                  _userModel.updateState(user);\n      \n                  response[\"errno\"] = LOGIN_SUCCEESS;\n                  response[\"id\"] = user.getId();\n                  response[\"name\"] = user.getName();\n                  /* æŸ¥è¯¢è¯¥ç”¨æˆ·æ˜¯å¦åœ¨ç¦»çº¿æ—¶æœªæ”¶åˆ°çš„æ¶ˆæ¯ */\n                  vector<string> offlineMsgVec = _offlineMsgModel.query(id);\n                  if(!offlineMsgVec.empty())\n                  {\n                      response[\"offlinemsg\"] = offlineMsgVec;\n                      /* æŠŠè¯¥ç”¨æˆ·çš„æ‰€æœ‰ç¦»çº¿æ¶ˆæ¯ä»ä»æ•°æ®ä¸­åˆ é™¤æ‰ */\n                      _offlineMsgModel.remove(id);\n                  }\n                  /* æŸ¥è¯¢è¯¥ç”¨æˆ·çš„å¥½å‹ä¿¡æ¯ï¼Œå¹¶è¿”å› */\n                  vector<User> userVec = _friendModel.query(id);\n                  if(!userVec.empty())\n                  {\n                      vector<string> friendJsonInfoVec;\n                      for(User &user : userVec)\n                      {\n                          json js;\n                          js[\"id\"] = user.getId();\n                          js[\"name\"] = user.getName();\n                          js[\"state\"] = user.getState();\n                          friendJsonInfoVec.push_back(js.dump());\n                      }\n                      response[\"friends\"] = friendJsonInfoVec;\n                  }\n              }\n          }\n          else if(user.getId() != id)\n          {\n              /* ç™»å½•å¤±è´¥ï¼Œç”¨æˆ·ä¸å­˜åœ¨ */\n              response[\"errno\"] = LOGIN_NOTFOUND;\n              response[\"errmsg\"] = \"ç”¨æˆ·ä¸å­˜åœ¨\";\n          }\n          else if(user.getPassword() != password)\n          {\n              /* ç™»å½•å¤±è´¥ï¼Œå¯†ç ä¸åŒ¹é… */\n              response[\"errno\"] = LOGIN_WRONGPWD;\n              response[\"errmsg\"] = \"å¯†ç éªŒè¯å¤±è´¥\";\n          }\n          conn->send(response.dump());\n      }\n      /* å¤„ç†æ³¨å†Œä¸šåŠ¡ */\n      void ChatService::reg(const TcpConnectionPtr &conn,\n                            json &js, Timestamp time)\n      {\n          /* LOG_INFO << \"do reg service.\"; */\n          string name = js[\"name\"];\n          string password = js[\"password\"];\n      \n          User user;\n          user.setName(name);\n          user.setPassword(password);\n          bool state = _userModel.insert(user);\n          json response;\n          response[\"msgid\"] = REG_MSG_ACK;\n          if(state)\n          {\n              /* æ³¨å†ŒæˆåŠŸ */\n              response[\"errno\"] = 0;\n              response[\"id\"] = user.getId();\n          }\n          else\n          {\n              /* æ³¨å†Œå¤±è´¥ */\n              response[\"errno\"] = 1;\n          }\n          conn->send(response.dump());\n      }\n      /* å¤„ç†å®¢æˆ·ç«¯å¼‚å¸¸é€€å‡º */\n      void ChatService::clientCloseException(const TcpConnectionPtr & conn)\n      {\n          /* æŸ¥æ‰¾ */\n          lock_guard<mutex> lock(_connMutex);\n          User user;\n          for(auto it = _userConnectionMap.begin(); it != _userConnectionMap.end(); ++it)\n          {\n              if(it->second == conn)\n              {\n                  /* ä»mapè¡¨åˆ é™¤ç”¨æˆ·çš„è¿æ¥ä¿¡æ¯ */\n                  user.setId(it->first);\n                  _userConnectionMap.erase(it);\n                  break;\n              }\n          }\n      #ifdef __CLUSTER__\n          /**\n           * é›†ç¾¤ç¯å¢ƒä¸‹, å‘rediså–æ¶ˆè®¢é˜…æ­¤id\n           */\n          m_redis.unsubscribe(user.getId());\n      #endif\n          /* æ›´æ–°ç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯ */\n          if(user.getId() != -1)\n          {\n              user.setState(\"offline\");\n              _userModel.updateState(user);\n          }\n      }\n      /* ä¸€å¯¹ä¸€èŠå¤©ä¸šåŠ¡ */\n      void ChatService::oneChat(const TcpConnectionPtr &conn, json &js, Timestamp time)\n      {\n          int to = js[\"to\"].get<int>();\n          {\n              lock_guard<mutex> lock(_connMutex);\n              auto it = _userConnectionMap.find(to);\n              if(it != _userConnectionMap.end())\n              {\n                  /* æ¥æ”¶æ–¹åœ¨çº¿ï¼Œè½¬å‘æ¶ˆæ¯ */\n                  /* æœåŠ¡å™¨ä¸»åŠ¨æ¨é€æ¶ˆæ¯ç»™æ¥æ”¶æ–¹ */\n                  it->second->send(js.dump());    // it->second è¡¨ç¤º \n                  return;\n              }\n          }\n      #ifdef __CLUSTER__\n          /**\n           * é›†ç¾¤ç¯å¢ƒä¸‹, éœ€è¦æŸ¥è¯¢å¯¹æ–¹(to)æ˜¯å¦åœ¨çº¿;\n           * ä¸å¯é€šè¿‡æœåŠ¡å™¨connMapæŸ¥è¯¢, æ˜¯é€šè¿‡æ•°æ®åº“ä¿¡æ¯;\n           */\n          User user = _userModel.query(to);\n          if(user.getState() == \"online\")\n          {\n              m_redis.publish(to, js.dump());\n              return;\n          }\n      #endif\n          /* æ¥æ”¶æ–¹ç¦»çº¿ï¼Œå­˜å‚¨ç¦»çº¿æ¶ˆæ¯ */\n          _offlineMsgModel.insert(to, js.dump());\n      }\n      /* æ·»åŠ å¥½å‹ä¸šåŠ¡ */\n      void ChatService::addFriend(const TcpConnectionPtr &conn, json &js, Timestamp time)\n      {\n          int userid = js[\"id\"].get<int>();\n          int friendid = js[\"friendid\"].get<int>();\n      \n          /* å­˜å‚¨å¥½å‹ä¿¡æ¯ -> include\"friendmodel.hpp\" */\n          _friendModel.insert(userid, friendid);\n      }\n      \n      /* åˆ›å»ºç¾¤ç»„ä¸šåŠ¡ */\n      void ChatService::createGroup(const TcpConnectionPtr &conn, json &js, Timestamp time)\n      {\n          int userid = js[\"id\"].get<int>();\n          string groupName = js[\"groupname\"];\n          string groupDesc = js[\"groupdesc\"];\n      \n          /* å­˜å‚¨æ–°åˆ›å»ºçš„ç¾¤ç»„ä¿¡æ¯ */\n          Group group(-1, groupName, groupDesc);\n          if(_groupModel.createGroup(group))\n          {\n              /* æŠŠåˆ›å»ºäººåŠ å…¥ç¾¤ç»„ */\n              _groupModel.addGroup(userid, group.getId(), \"Creator\");\n          }\n      }\n      /* åŠ å…¥ç¾¤ç»„ä¸šåŠ¡ */\n      void ChatService::addGroup(const TcpConnectionPtr &conn, json &js, Timestamp time)\n      {\n          int userid = js[\"id\"].get<int>();\n          int groupid = js[\"groupid\"].get<int>();\n          _groupModel.addGroup(userid, groupid, \"Normal\");\n      }\n      /* ç¾¤ç»„èŠå¤©ä¸šåŠ¡ */\n      void ChatService::groupChat(const TcpConnectionPtr &conn, json &js, Timestamp time)\n      {\n          int userid = js[\"id\"].get<int>();\n          int groupid = js[\"groupid\"].get<int>();\n          vector<int> useridVec = _groupModel.queryGroupUsers(userid, groupid);\n      \n          bool offline = true;\n          bool reallyOffline = true;\n          for(int id : useridVec)\n          {\n              {\n                  lock_guard<mutex> lock(_connMutex);\n                  auto it = _userConnectionMap.find(id);\n                  if(it != _userConnectionMap.end())//åœ¨æœ¬å°æœåŠ¡å™¨ä¸Šçº¿\n                  {\n                      offline = false;\n                      reallyOffline = false;\n                      it->second->send(js.dump());\n                  }\n              }\n      #ifdef __CLUSTER__\n              if(offline)\n              {\n                  /**\n                   * é›†ç¾¤ç¯å¢ƒä¸‹, éœ€è¦åˆ¤æ–­å…¶æ˜¯å¦åœ¨å…¶ä»–æœåŠ¡å™¨ä¸Šåœ¨çº¿;\n                   */\n                  User user = _userModel.query(id);\n                  if(user.getState() == \"online\")\n                  {\n                      reallyOffline = false;\n                      m_redis.publish(id, js.dump());\n                  }\n              }\n      #endif\n              if(reallyOffline)\n              {\n                  _offlineMsgModel.insert(id, js.dump());\n              }\n              reallyOffline = true;\n              offline = true;\n          }\n      }\n      #ifdef __CLUSTER__\n      /**\n       * åœºæ™¯: æœ¬å°æœåŠ¡å™¨æ”¶åˆ°äº†redisæŸä¸€é¢‘é“å‘æ¥çš„é€šçŸ¥æ¶ˆæ¯;\n       *  åœ¨å‰é¢çš„ä»£ç é€»è¾‘ä¸­, redisçš„publishéƒ½æ˜¯åˆ¤æ–­ç”¨æˆ·åœ¨çº¿ä¹‹åæ‰å‘çš„;\n       *   ä½†æ˜¯ç”¨æˆ·å¯èƒ½åœ¨è¿™ä¸ªåˆ¤æ–­å’ŒçœŸæ­£æ”¶åˆ°æ¶ˆæ¯è¿™æ®µæ—¶é—´å†…ä¸‹çº¿,\n       *  æ‰€ä»¥, æœ¬æœåŠ¡å™¨å¤„ç†æ”¶åˆ°redisæŸä¸€é¢‘é“ä¸Šæ¶ˆæ¯çš„å›è°ƒæ—¶,\n       *   éœ€è¦å†æ¬¡åˆ¤æ–­æ­¤idæ˜¯å¦åœ¨çº¿, å¦‚æœåœ¨çº¿åˆ™å‘é€, \n       *   å¦‚æœä¸åœ¨çº¿, éœ€è¦å­˜åˆ°ç¦»çº¿æ¶ˆæ¯æ•°æ®åº“ä¸­; \n       */\n      void ChatService::handleRedisSubscribeMessage(int userid, string msg)\n      {\n          lock_guard<mutex> lock(_connMutex);\n          auto it = _userConnectionMap.find(userid);\n          /* è¯¥ç”¨æˆ·åœ¨çº¿, åˆ™ç›´æ¥å‘é€ */\n          if(it != _userConnectionMap.end())\n          {\n              it->second->send(msg);\n              return;\n          }\n          /* å­˜å‚¨è¯¥ç”¨æˆ·çš„ç¦»çº¿æ¶ˆæ¯ */\n          _offlineMsgModel.insert(userid, msg);\n      }\n      #endif\n```\n\n# é—®é¢˜\n\n1. å¦‚æœèŠå¤©å†…å®¹å¸¦æœ‰`'`å•å¼•å·ï¼Œåˆ™ä¼šå½±å“SQLè¯­å¥çš„æ­£ç¡®è¾“å…¥ï¼Œéœ€è¦å¤„ç†è½¬ä¹‰ã€‚\n\n","categories":["æ“ä½œç³»ç»Ÿ","å¤šçº¿ç¨‹","Cpp","Modern"]},{"title":"Linux_Ubuntué…ç½®","url":"/Linux/Linux_Ubuntué…ç½®/","content":"\n# å†…å®¹\n\n1. å…³é—­UbuntuåŠ¨ç”»\n\n2. é…ç½®ç»ˆç«¯ä»£ç†\n\n3. ä¸‹è½½å®‰è£…makeã€g++-12/gcc-12ã€gitã€net-toolsã€curl\n\n   1. g++å’Œgccæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿd41d8cçš„å›ç­” - çŸ¥ä¹ https://www.zhihu.com/question/20940822/answer/1768772877\n\n   2. å°†g++é»˜è®¤ä¸ºg++-12(å‚è€ƒhttps://cloud.tencent.com/developer/ask/sof/100275)\n\n      ```\n      sudo apt-get install g++-12\n      sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-12 100\n      sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-12 100\n      \n      sudo update-alternatives --set g++ /usr/bin/g++-12\n      sudo update-alternatives --set gcc /usr/bin/gcc-12\n      ```\n\n   3. å‘½ä»¤æ ¼å¼ï¼š`update-alternatives [<é€‰é¡¹> ...] <å‘½ä»¤>`(å‚è€ƒhttps://blog.csdn.net/JasonDing1354/article/details/50470109)\n\n      ```\n      Commands:\n        --install <link> <name> <path> <priority>\n          [--slave <link> <name> <path>] ...\n                                 åœ¨ç³»ç»Ÿä¸­åŠ å…¥ä¸€ç»„æ›¿æ¢é¡¹.\n        --remove <name> <path>   ä» <åç§°> æ›¿æ¢ç»„ä¸­å»é™¤ <è·¯å¾„> é¡¹.\n        --remove-all <name>      ä»æ›¿æ¢ç³»ç»Ÿä¸­åˆ é™¤ <åç§°> æ›¿æ¢ç»„.\n        --auto <name>            å°† <åç§°> çš„ä¸»é“¾æ¥åˆ‡æ¢åˆ°è‡ªåŠ¨æ¨¡å¼.\n        --display <name>         æ˜¾ç¤ºå…³äº <åç§°> æ›¿æ¢ç»„çš„ä¿¡æ¯.\n        --query <name>           machine parseable version of --display <name>.\n        --list <name>            åˆ—å‡º <åç§°> æ›¿æ¢ç»„ä¸­æ‰€æœ‰çš„å¯ç”¨æ›¿æ¢é¡¹.\n        --get-selections         list master alternative names and their status.\n        --set-selections         read alternative status from standard input.\n        --config <name>          åˆ—å‡º <åç§°> æ›¿æ¢ç»„ä¸­çš„å¯é€‰é¡¹ï¼Œå¹¶å°±ä½¿ç”¨å…¶ä¸­\n                                       å“ªä¸€ä¸ªï¼Œå¾è¯¢ç”¨æˆ·çš„æ„è§.\n        --set <name> <path>      å°† <è·¯å¾„> è®¾ç½®ä¸º <åç§°> çš„æ›¿æ¢é¡¹.\n        --all                    å¯¹æ‰€æœ‰å¯é€‰é¡¹ä¸€ä¸€è°ƒç”¨ --config å‘½ä»¤.\n      <link> æ˜¯æŒ‡å‘ /etc/alternatives/<åç§°> çš„ç¬¦å·é“¾æ¥>.\n        (e.g. /usr/bin/pager)\n      <name> æ˜¯è¯¥é“¾æ¥æ›¿æ¢ç»„çš„ä¸»æ§å.\n        (e.g. pager)\n      <path> æ˜¯æ›¿æ¢é¡¹ç›®æ ‡æ–‡ä»¶çš„ä½ç½®.\n        (e.g. /usr/bin/less)\n      <priority> æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œåœ¨è‡ªåŠ¨æ¨¡å¼ä¸‹ï¼Œè¿™ä¸ªæ•°å­—è¶Šé«˜çš„é€‰é¡¹ï¼Œå…¶ä¼˜å…ˆçº§ä¹Ÿå°±è¶Šé«˜.\n      Options:\n        --altdir <directory>     æŒ‡å®šä¸åŒçš„å¯é€‰é¡¹ç›®å½•.\n        --admindir <directory>   æŒ‡å®šä¸åŒçš„ç®¡ç†ç›®å½•.\n        --log <file>             è®¾ç½®logæ–‡ä»¶.\n        --force                  allow replacing files with alternative links.\n        --skip-auto              skip prompt for alternatives correctly configured\n                                 in automatic mode (relevant for --config only)\n        --verbose                è¯¦å°½çš„æ“ä½œè¿›è¡Œä¿¡æ¯ï¼Œæ›´å¤šçš„è¾“å‡º.\n        --quiet                  å®‰é™æ¨¡å¼ï¼Œè¾“å‡ºå°½å¯èƒ½å°‘çš„ä¿¡æ¯.\n        --help                   æ˜¾ç¤ºæœ¬å¸®åŠ©ä¿¡æ¯.\n        --version                æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯.\n      ```\n\n4. ä¸‹è½½å®‰è£…vim\n\n   1. ```\n      git clone https://github.com/vim/vim.git\n      # if you don't have local changes, update to the latest version with:\n      cd vim\n      git pull\n      # If you made some changes, e.g. to a makefile, you can keep them and merge with the latest version with:\n      cd vim\n      git stash\n      git pull\n      git stash pop\n      # If you have local changes you may need to merge. If you are sure you can discard local changes (e.g. if you were just trying a patch), you can use:\n      git fetch --all\n      git reset --hard origin/master\n      ```\n\n   2. ```\n      # Building Vim\n      cd src\n      make distclean  # if you build Vim before\n      make\n      sudo make install\n      ```\n\n   3. ```\n      checking for tgetent()... configure: error: NOT FOUND!\n            You need to install a terminal library; for example ncurses.\n            On Linux that would be the libncurses-dev package.\n            Or specify the name of the library with --with-tlib.\n      # sudo apt-get install libncurses5-dev\n      ```\n\n5. é…ç½®é•œåƒæº - huaweicloud, httpåè®®\n\n6. æ›´æ–°ç³»ç»Ÿè½¯ä»¶\n\n7. å®‰è£…ssh-server `sudo apt-get install openssh-server`\n\n# å…³é—­UbuntuåŠ¨ç”»\n\nUbuntu Desktopåº”ç”¨ç¨‹åºèœå•å¸¦æœ‰ä»å±å¹•åº•è§’åˆ°å±å¹•ä¸­å¿ƒçš„åŠ¨ç”»ã€‚è™½ç„¶è¿™çœ‹èµ·æ¥å¾ˆé…·ï¼Œä½†æ„Ÿè§‰å®ƒå¾ˆå¡ï¼Œå°¤å…¶æ˜¯åœ¨é›†æˆæ˜¾å¡å’Œè™šæ‹Ÿæœºçš„ç¯å¢ƒä¸­ã€‚æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥å…³é—­æ­¤åŠ¨ç”»ï¼Œä»è€Œå¯ä»¥æ›´å¿«åœ°ä»â€œåº”ç”¨ç¨‹åºâ€èœå•ä¸­å¯åŠ¨åº”ç”¨ç¨‹åºã€‚\n\n1. æ‰“å¼€â€œç»ˆç«¯â€\n2. æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå…³é—­åŠ¨ç”»ï¼Œç«‹å³ç”Ÿæ•ˆï¼ˆä¸ç”¨rootï¼‰\n\n```\ngsettings set org.gnome.desktop.interface enable-animations false\n```\n\næƒ³è¦é‡æ–°å¼€å¯åŠ¨ç”»ï¼Œåªéœ€è¦æ‰§è¡Œ\n\n```\ngsettings set org.gnome.desktop.interface enable-animations true\n```\n","categories":["æ“ä½œç³»ç»Ÿ","Linux"]},{"title":"è¯æ±‡æ€»ç»“","url":"/è‹±è¯­/è¯æ±‡æ€»ç»“/","content":"# reverse - reserve - conserve - converse - convert - revert - transverse - invert - converge\n\nåœ¨æ‹‰ä¸è¯­ä¸­ï¼Œ`vers-`è¡¨ç¤º-å¼¯æ›²ã€è½¬å‘ï¼›`-ile`è¡¨ç¤º-æœ‰...çš„å€¾å‘\n\n1. reverse: v. åè½¬ adj. åå‘çš„ï¼›ç›¸åçš„\n    1. revert: æ¢å¤åŸçŠ¶ï¼›å½’è¿˜\n        1. reversion: n. æ¢å¤\n    2. rehabilitate: `/ËŒriËÉ™ËˆbÉªlÉªteÉªt/` vt. å¹³åæ˜­é›ªï¼›ä½¿åº·å¤ï¼›æ¢å¤åŸçŠ¶\n    3. transverse: adj. æ¨ªå‘çš„ï¼›æ¨ªåˆ‡çš„\n2. reserve: é¢„è®¢\n    1. reservation: ä¿ç•™çš„åº§ä½ã€ä½å¤„ç­‰ï¼›é¢„è®¢ï¼›ä¿ç•™æ„è§\n3. converse: adj. ç›¸åçš„ï¼›v. äº¤è°ˆï¼Œè°ˆè¯\n    1. conversation: è°ˆè¯\n    2. conversion: å˜æ¢ï¼›è½¬åŒ–\n5. **converge: `/kÉ™nËˆvÉœËdÊ’/` vi. æ±‡åˆï¼›è¶‹åŒ**\n6. convert: v. ï¼ˆä½¿ï¼‰è½¬å˜ - conversion: n. è½¬åŒ–ï¼›è½¬æ¢ï¼›æ¢ç®—\n    1. invert: v. ä½¿...é¢ å€’ï¼›å€’ç½®...\n7. conserve: ä¿æŠ¤\n    1. conservation: ä¿å­˜ï¼›ä¿æŠ¤\n\nvertã€verseéƒ½æœ‰è½¬å‘ã€è½¬åŒ–çš„æ„æ€ã€‚vergeæ˜¯è¶‹å‘ã€æ¥è¿‘çš„æ„æ€ã€‚\n## divert - diverse - versatile - deflect - inflect - deviate - distort - bias\n\n```\nvers-, vert-, -verse, -version, -version, -versation, -versal, -versary, -vert, vort-, vors-ã€æ‹‰ä¸ã€‘è¡¨ç¤ºâ€œè½¬åŠ¨ï¼Œæ—‹è½¬â€ï¼›â€œä½¿å¼¯æ›²â€\nåŒæ ¹è¯advertisement|irreversible|universal|verse|incontrovertible|conversation|conversely|versatile|\n```\n\n1. diverse: ä¸åŒçš„ï¼›å¤šç§å¤šæ ·çš„\n2. divert: ä½¿è½¬å‘ï¼›ä½¿åˆ†å¿ƒã€è½¬ç§»æ³¨æ„åŠ›ï¼›ä¾›...æ¶ˆé£\n3. diversion - n. è½¬å‘ã€è½¬ç§»ï¼›åç¦»ã€ç»•è¡Œè·¯çº¿ï¼›æ¶ˆé£ã€å¨±ä¹ã€‚\n4. versatile: adj. å¤šæ‰å¤šè‰ºçš„ï¼›å¤šæ–¹é¢çš„ï¼›å¤šç”¨é€”çš„\n5. deflect: v. (ä½¿)è½¬å‘ï¼›(ä½¿)åæ–œ - deflection: n. çªç„¶è½¬å‘ï¼›åæ–œï¼›åç¦»\n6. inflect: v. å¼¯æ›²ï¼›æ”¹å˜ - inflection: n. å˜éŸ³ï¼›è½¬è°ƒ\n7. reflect: vt. åå°„ï¼›ç…§å‡ºï¼›**åçœ** vi. åæ˜ ï¼›æ˜ ç°ï¼›æ·±æ€ - reflection: n. æ˜ åƒï¼Œåæ˜ ï¼›åå°„ï¼›æ·±æ€\n\t1. reflective: adj. æ²‰æ€çš„ï¼Œä¸æ€è€ƒæœ‰å…³çš„ï¼›**æœ‰åå°„æ€§çš„**\n\t2. flexible: adj. å¯å¼¯æ›²çš„\n8. **deviate: `/ËˆdiËvieÉªt/` v. åç¦»ï¼Œè„±ç¦»**\n    1. deviation: `/ËŒdiËviËˆeÉªÊƒn/` n. åç¦»ï¼›åå·®ï¼›èƒŒç¦»ï¼›è¿èƒŒ\n9. distort: v. ä½¿å˜å½¢ï¼›æ‰­æ›²ï¼Œæ­ªæ›²ï¼›æ›²è§£\n    1. distortion: n. æ‰­æ›²ï¼›å˜å½¢ï¼›æ›²è§£ï¼›å¤±çœŸ\n    2. retort: v. åé©³ï¼Œå›å˜´ n. åé©³ï¼›æ›²é¢ˆç“¶ï¼ˆæ¯”å¦‚è’¸é¦å™¨ï¼‰\n        1. resort: n. æ—…æ¸¸èƒœåœ°ï¼›é‡‡å–ã€æªæ–½ã€æ‰‹æ®µï¼ˆè¯‰è¯¸ï¼›å‘...æ±‚åŠ©ï¼‰\n            1. assort: v. æŠŠâ€¦åˆ†ç±»\n                1. assortment: n. å„ç§å„æ ·\n        2. refute: `/rÉªËˆfjuËt/` v. è¯ä¼ªï¼›å¦è®¤ã€åé©³\n10. bias: n. åå‘ v. ä½¿åå‘ adv. å adj. æ–œçš„, ã€ç”µã€‘ååŠ¨çš„\n## å€¾å‘\n\n1. prone: `/prÉ™ÊŠn/` adj. æ˜“äºé­å—...çš„ï¼›æœ‰åš...ï¼ˆåäº‹ï¼‰çš„å€¾å‘\n2. disposed: adj. æœ‰â€¦å€¾å‘çš„ï¼›æ‰“ç®—åšâ€¦çš„ï¼›æœ‰æŸç§å¥åº·çŠ¶æ€çš„ v. å¤„ç†ï¼›é…ç½®ï¼›ä½¿æœ‰å€¾å‘ï¼›ä½¿é€‚åº”ï¼ˆdisposeçš„è¿‡å»åˆ†è¯ï¼‰\n3. incline: v. å€¾å‘\n    1. decline: v. ä¸‹é™\n4. mindset: `/ËˆmaÉªndset/` n. æ€ç»´å€¾å‘ï¼›è§‚å¿µæ¨¡å¼\n# re-: -cede\n\n1. retreat: v./n. æ’¤é€€ã€åé€€ï¼›è®©æ­¥ n. éšå±…åœ°ï¼›é™å…»æ‰€\n    1. entreat: v. æ³æ±‚ï¼›ä¹æ±‚\n2. rescind: `/rÉª'sÉªnd/` v. æ’¤é”€ã€åºŸé™¤ï¼›å–æ¶ˆ\n    1. prescind: `/prÉªËˆsÉªnd/` vi. (è¿‡æ—©æˆ–çªç„¶åœ°ä»æ•´ä½“ä¸­)åˆ†å‰²ï¼›ä¸è€ƒè™‘æŸäº‹\n    2. abscind: `/Ã¦b'sÉªnd/` v. åˆ‡æ–­ã€å‰²æ–­\n    3. exscind: `/ek'sÉªnd/` vt. å‰²å¼€,åˆ‡é™¤\n3. recede: `/rÉª'siËd/` vi. åé€€ï¼Œå‡å¼±\n    1. cede: vt. å±ˆæœï¼›è®©ç»™ï¼Œå‰²è®©ï¼›æ”¾å¼ƒ\n    2. precede: v. é¢†å…ˆï¼Œåœ¨â€¦ä¹‹å‰ï¼›ä¼˜äºï¼Œé«˜äº\n    3. concede: v. æ‰¿è®¤ï¼›å‡ºè®©ï¼›å®¹è®¸\n       The arrogant runner conceded defeat reluctantly. è¿™ä½å‚²æ…¢çš„è·‘æ­¥è¿åŠ¨å‘˜å¾ˆä¸æƒ…æ„¿åœ°æ‰¿è®¤äº†å¤±è´¥ã€‚\n    4. accede: vi. ç­”åº”, åŒæ„ï¼›(æ­£å¼)åŠ å…¥ï¼Œå‚åŠ ï¼›å¼€å§‹ä»»èŒï¼Œå°±èŒï¼Œå°±ä»»ï¼›å°±ä½ï¼Œå³ä½ï¼Œç»§ä»»ï¼›(é€šè¿‡è´¢äº§çš„æ·»é™„è€Œ)å¢åŠ ï¼›ç»§æ‰¿(è´¢äº§)\n    5. secede: v. é€€å‡ºï¼›è„±ç¦»ï¼›å‰²è®©\n## æ¶ˆé£ - treat - recreation - diversion - amusement\n\n1. recreation: n. æ¶ˆé£ã€å¨±ä¹ï¼›é‡ç°ã€é‡å»º\n2. entertainment\n3. treatment\n    1. entreat: v. æ³æ±‚ï¼›ä¹æ±‚\n    2. retreat: v. & n. æ’¤é€€ã€åé€€ï¼›è®©æ­¥ n. éšå±…åœ°ï¼›é™å…»æ‰€\n    3. **treaty: n. ï¼ˆå›½å®¶é—´çš„ï¼‰æ¡çº¦ã€åå®š**\n4. relaxation\n5. diversion: `/daÉªËˆvÉœËÊƒn/` n. åç¦»ï¼›æ¶ˆé£ã€å¨±ä¹\n   The city is full of diversions. åŸå¸‚é‡Œå„ç§å¨±ä¹æ´»åŠ¨æ¯”æ¯”çš†æ˜¯ã€‚\n6. amusement\n# dis-\n\n1. dismay: n. æ²®ä¸§ï¼Œç»æœ›ï¼Œç°å¿ƒ v. ä½¿æƒŠæ„•ï¼›ä½¿ç°å¿ƒï¼Œä½¿å¤±æœ›\n    1. frustrate: v.ï¼ˆå°¤æŒ‡å› æ— æ³•æ”¹å˜æˆ–å®ç°æŸäº‹è€Œï¼‰ä½¿å¿ƒçƒ¦ï¼›ä½¿æ¼æ€’\n        1. The frustrating thing about innovation is that there are many approaches, but no magic formula. å…³äºåˆ›æ–°ä»¤äººæ²®ä¸§çš„æ˜¯ï¼Œåˆ›æ–°æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œå´æ²¡æœ‰é‚£ç§å¥‡å¦™çš„ç¨‹å¼æ–¹æ¡ˆã€‚\n2. distress: n. ï¼ˆæåº¦ï¼‰ç—›è‹¦ã€æ‚²ä¼¤ v. ä½¿å¿§è™‘ã€æ‚²ä¼¤\n3. disdain: v. è”‘è§†\n    1. scorn: è”‘è§†\n        1. scold: v. éª‚ï¼›è´£å¤‡ã€æ•°è½ n. åµåµåš·åš·\n4. discard: v. ä¸¢å¼ƒï¼›æŠ›å¼ƒï¼›é—å¼ƒ\n## discourse - discourage - recourse\n\n1. discourse: n. å¯¹è¯ï¼›è¯è¯­ï¼›æ¼”è®²ï¼›è®ºæ–‡ v. è®²è¿°ï¼›è®ºè¿°\n2. discourage: v. ä½¿æ°”é¦ï¼›ä½¿æ²®ä¸§\n3. recourse: n. æ±‚åŠ©ï¼›ä¾é ï¼›ä¾èµ–\n## æ´¾é€ã€æ´¾é£ã€å‘ï¼›åˆ†é…\n\n1. dispatch: n. v. æ´¾é£ï¼›å‘é€ï¼›æ´¾é€ï¼›æ€¥ä»¶\n    1. dispatcher: è½¦è¾†ã€èˆªç­è°ƒåº¦å‘˜\n2. distribute: åˆ†å‘ï¼›åˆ†æ•£\n    1. scatter: åˆ†æ•£\n    2. contribute: è´¡çŒ®\n3. disperse: v. ï¼ˆä½¿ï¼‰åˆ†æ•£ã€æ•£å¼€ï¼›ç–æ•£ã€é©±æ•£\n4. allot: v. åˆ†é…ï¼›åˆ†æ´¾ï¼ˆä»»åŠ¡ï¼‰\n    1. allotment: n. é…é¢\n    2. alloy: `/ËˆÃ¦lÉ”Éª/` n. åˆé‡‘ v. æŠŠ...é“¸æˆåˆé‡‘\n        1. unalloyed: `/ËŒÊŒnÉ™ËˆlÉ”Éªd/` adj. çº¯ç²¹çš„\n## -stinc-ï¼›æœ¬èƒ½çš„ã€ç›´è§‰çš„ã€è‡ªå‘çš„\n\n1. instinct: **n.** æœ¬èƒ½ã€ç›´è§‰\n    1. instinctive: adj. æœ¬èƒ½çš„ã€ç›´è§‰çš„\n    2. **spontaneous**: `/spÉ’n'teÉªniÉ™s/` adj. **è‡ªå‘çš„ï¼Œè‡ªç„¶äº§ç”Ÿçš„**\n    3. intuitive: adj. ç›´è§‰çš„ï¼›ä¸å‡æ€ç´¢çš„\n        1. intuition: n. ç›´è§‰åŠ›\n2. integral: `/ËˆÉªntÉªÉ¡rÉ™lï¼ŒÉªnËˆteÉ¡rÉ™l/` adj. å¿…éœ€çš„ï¼›ä¸å¯æˆ–ç¼ºçš„\n    1. integrate: `/ËˆÉªntÉªÉ¡reÉªt/` v. æ•´åˆã€ä½¿æˆä¸ºä¸€ä½“ - integrated circuit: é›†æˆç”µè·¯\n    2. integrity: `/ÉªnËˆteÉ¡rÉ™ti/` n. æ­£ç›´ï¼›å®Œæ•´æ€§\n3. distinct: adj. æ¸…æ™°çš„ã€æ˜æ˜¾çš„ï¼›æˆªç„¶ä¸åŒçš„\n    1. distinction: n. åŒºåˆ«ã€åŒºåˆ†ï¼›æ°å‡ºã€å“è¶Š\n    2. distinguish: v. åŒºåˆ«ï¼›ä½¿æ°å‡º\n4. extinct: adj. ç­ç»çš„\n    1. extinction: n. ç­ç»\n5. intrinsic: `/ÉªnËˆtrÉªnzÉªk/` adj. æœ¬èº«å›ºæœ‰çš„ï¼›å†…åœ¨çš„ã€æœ¬è´¨çš„\n6. qualitative: `/ËˆkwÉ’lÉªtÉ™tÉªv/` adj. å®šæ€§çš„ï¼›æ€§è´¨çš„\n## è”‘è§† - æ­§è§† - disdain - discriminate - underestimate - prejudice\n\n1. æ­§è§†ï¼šdiscriminate\n    1. prejudice: n. åè§ã€æˆè§ï¼›æ­§è§† v. ä½¿...æ€€æœ‰åè§\n2. è”‘è§†ï¼šdisdain: `/dÉªsËˆdeÉªn/` v./n. è”‘è§†ã€é„™è§†\n    1. disdainful: `/dÉªsËˆdeÉªnfl/` adj. è½»è§†çš„ï¼›é„™è§†çš„ï¼›å€¨å‚²çš„\n    2. åŒä¹‰è¯ï¼šcontempt: `/kÉ™nËˆtempt/` n. è½»è”‘\n        1. contemplate: `/ËˆkÉ’ntÉ™mpleÉªt/` v. è€ƒè™‘\n    3. despise: `/dÉªËˆspaÉªz/` v. é„™è§†ã€è”‘è§†ã€çœ‹ä¸èµ·\n        1. despite: `/dÉªËˆspaÉªt/` prep. ä¸é¡¾ï¼›å³ä½¿ã€å°½ç®¡\n            1. spite: `/spaÉªt/` n. æ¶æ„ï¼›æ€¨æ¨ = malice\n                1. in spite of: å°½ç®¡ï¼›ä¸ç®¡ã€ä¸é¡¾\n    4. scorn\n    5. underestimate: `/ËŒÊŒndÉ™rËˆestÉªmeÉªt/` v./n. ä½ä¼°ã€è½»è§†\n    6. defiance: `/dÉªËˆfaÉªÉ™ns/` n. è¿æŠ—ã€æ‹’ç»æœä»ï¼›æ— è§†ã€è—è§†\n        1. defiant: adj. è¿æŠ—çš„ï¼›æŒ‘è¡…çš„\n## illusion - disillusion\n\n1. illusion: `/ÉªËˆluËÊ’n/` n. é”™è§‰, å¹»æƒ³, é”™è¯¯è§‚å¿µ\n    1. delusion: `/dÉªËˆluËÊ’n/` n. é”™è§‰ï¼›å¦„æƒ³\n2. disillusion: `/ËŒdÉªsÉªËˆluËÊ’n/` v. ä½¿é†’æ‚Ÿï¼Œä½¿è§‰é†’ï¼›ä½¿å¹»æƒ³ç ´ç­\n## difference - discrepancy\n\n1. discrepancy: `/dÉªËˆskrepÉ™nsi/` n. å·®å¼‚ï¼›ä¸ç¬¦åˆï¼›ä¸ä¸€è‡´\n# æ°å‡ºï¼›ä¾‹å¤–\n\n1. exception: adj. å¼‚å¸¸ï¼›ç‰¹åˆ«ï¼›ä¾‹å¤–\n    1. exceptional: adj. æ°å‡ºçš„ï¼›ä¼˜ç§€çš„ï¼›å¼‚å¸¸çš„ï¼›ç‰¹åˆ«çš„ï¼›ä¾‹å¤–çš„\n2. distinction: n. åŒºåˆ«ï¼Œå·®åˆ«ï¼›å“è¶Šï¼Œæ°å‡º\n3. extraordinary: adj. ä¸å¹³å‡¡çš„ï¼›ç‰¹æ´¾çš„ï¼›ä¸´æ—¶çš„\n\t1. extravagant: adj. å¥¢ä¾ˆçš„ï¼›é“ºå¼ æµªè´¹çš„\n4. exterior: adj. å¤–éƒ¨çš„ n. å¤–è§‚ã€å¤–è¡¨\n# åƒµç¡¬çš„ï¼›é¡½å›ºçš„ - ä¹ æƒ¯\n\n1. rigid: adj. ä¸¥æ ¼çš„ï¼›åƒµç¡¬çš„ï¼Œæ­»æ¿çš„ï¼›åšç¡¬çš„ï¼›ç²¾ç¡®çš„\n2. solid - å›ºä½“çš„ã€å®å¿ƒçš„ï¼›ç»“å®çš„ã€å¯é çš„ï¼›\n3. conventional - ä¼ ç»Ÿçš„ï¼›ä¹ æƒ¯çš„ï¼›å®ˆæ—§çš„ï¼ˆæŸç§ç¨‹åº¦ä¹Ÿå¯ä»¥å¼•ç”³ä¸ºé¡½å›ºæ´¾çš„ï¼‰ï¼›\n    1. convention: n. å…¬çº¦ã€çº¦å®šã€ä¹ ä¿—\n4. customary: adj. ä¹ ä¿—çš„ï¼Œä¹ æƒ¯çš„ï¼›ç‰¹æœ‰çš„ï¼Œç‹¬ç‰¹çš„\n5. tough - åšéŸ§çš„ã€ç‰¢å›ºçš„ï¼›è‰°éš¾çš„ï¼›å¼ºç¡¬çš„ï¼ˆå¯å¼•ç”³ä¸ºn. æ¶æ£ã€æš´å¾’ï¼‰ï¼›\n    1. rough - ç²—ç³™çš„ï¼›è‰°éš¾çš„ã€ä»¤äººç—›è‹¦çš„ - roughly - å¤§è‡´åœ°ï¼›ç²—æš´åœ°\n    2. thorough: adj. å½»åº•çš„ï¼Œå®Œå…¨çš„ï¼›ä»”ç»†çš„ï¼›ç¼œå¯†çš„\n    3. throughout: `/Î¸ruË'aÊŠt/` prep. éåŠï¼Œè´¯ç©¿ adv. åˆ°å¤„ï¼Œè‡ªå§‹è‡³ç»ˆ\n6. stiff: adj. ä¸æ˜“å¼¯æ›²çš„ï¼›ç¡¬çš„ï¼›æŒºç›´çš„ï¼›åƒµç¡¬çš„ adv. éå¸¸ï¼›æå…¶ v. ä¸ç»™å°è´¹\n    1. cliff: n. ï¼ˆå¸¸æŒ‡æµ·æ´‹è¾¹çš„ï¼‰æ‚¬å´–\n7. accustom: v. ä½¿ä¹ æƒ¯ - accustomed: adj. ä¹ æƒ¯äºï¼›é€šå¸¸çš„ï¼›æƒ¯å¸¸çš„\n8. obstinate: adj. æ‰§æ‹—çš„ï¼›é¡½å›ºçš„ï¼›æ£˜æ‰‹çš„ï¼›éš¾ä»¥åº”ä»˜çš„\n    1. Middle English: from Latin `obstinatus`, past participle(è¿‡å»åˆ†è¯) of `obstinare â€˜persistâ€™`.\n# å½»åº•çš„\n\n1. thorough: adj. å½»åº•çš„ï¼Œå®Œå…¨çš„ï¼›ä»”ç»†çš„ï¼›ç¼œå¯†çš„\n    1. throughout: `/Î¸ruË'aÊŠt/` prep. éåŠï¼Œè´¯ç©¿ adv. åˆ°å¤„ï¼Œè‡ªå§‹è‡³ç»ˆ\n2. radical: `/ËˆrÃ¦dÉªkl/` adj. æ ¹æœ¬çš„ï¼›å½»åº•çš„ï¼Œå®Œå…¨çš„ï¼›æ¿€è¿›çš„\n    1. late Middle English (in the senses â€˜forming the rootâ€™ and â€˜inherentâ€™): from late Latin `radicalis`, from Latin `radix(åŸºæ•°ï¼›æ ¹), radic- â€˜rootâ€™`.\n# ç§»åŠ¨\n\n1. motion - n. è¿åŠ¨ï¼›ç§»åŠ¨ v. è¿åŠ¨ï¼›å‘...æ‰“æ‰‹åŠ¿\n2. movement - n. ç§»åŠ¨ï¼›æ´»åŠ¨ï¼›è¿ç§»ï¼›ä¹ç«  - å¯æ•°ï¼Œä¾‹ hand/eye movementsæ‰‹/çœ¼ç›çš„æ´»åŠ¨\n3. motive: n. åŠ¨æœºï¼›ç¼˜ç”±ï¼›ç›®çš„\n# å¯åˆ°è¾¾çš„\n\n1. navigable - ç”¨æ¥å½¢å®¹èˆªçº¿ã€è·¯çº¿æ˜¯é€šè¡Œçš„ã€‚è€Œä¸æ˜¯è¯´æŸä¸€ä¸ªåœ°ç‚¹æ˜¯å¯åˆ°è¾¾çš„ã€‚\n    1. negotiate: è°ˆåˆ¤ï¼›ç£‹å•†\n2. accessible - å¯è®¿é—®çš„ï¼›æ— éšœç¢çš„\n# å‰¯çš„ã€é™„çš„ã€è¡¥å……çš„ã€é™„å±\n\n1. auxiliary: adj. è¾…åŠ©çš„ï¼›å¤‡ç”¨çš„ n. åŠ©åŠ¨è¯ï¼›è¾…åŠ©å·¥ï¼›è¾…åŠ©äººå‘˜\n2. affiliate: `/É™ËˆfÉªlieÉªt/` v. ä½¿å¹¶å…¥ã€éš¶å±äºè¾ƒå¤§çš„ç»„ç»‡ n. é™„å±æœºæ„\n    1. affiliation: `/É™ËŒfÉªliËˆeÉªÊƒn/` n. éš¶å±å…³ç³»ã€ä»å±å…³ç³»\n        1. political affiliation: æ”¿æ²»èƒŒæ™¯ã€ç«‹åœºï¼Œæ”¿æ²»é¢è²Œ\n3. affixation: ` /ËŒÃ¦fÉªk'seÉªÊƒÉ™n/` n. åŠ ç¼€ã€é™„åŠ ï¼›è¯ç¼€æ³•\n    1. affix: `/ËˆÃ¦fÉªks/` vt. é™„åŠ ä¸Š vi. å›ºå®šåœ¨ n. è¯ç¼€\n4. accessory: é™„åŠ çš„ï¼›é™„ä»¶\n5. annex: `/ËˆÃ¦neks/` v. å¼ºå ã€åå¹¶ n. é™„åŠ ã€é™„å±\n6. vice - å‰¯çš„ï¼›ä»£æ›¿çš„\n7. deputy: n. å‰¯æ‰‹ï¼›å‰¯èŒï¼›ä»£ç†äºº\n8. assistant - ååŠ©çš„ï¼›åŠ©æ‰‹\n    1. collaborate: v. åˆä½œï¼›åä½œï¼›å‹¾ç»“ã€é€šæ•Œ - collaboration n. åˆä½œï¼›åä½œï¼›é€šæ•Œè¡Œä¸º\n    2. assassin: `/É™ËˆsÃ¦sÉªn/` n. æš—æ€è€…\n        1. assassination: `/É™ËŒsÃ¦sÉªËˆneÉªÊƒn/` n. æš—æ€ã€è¡Œåˆº\n        2. assault: `/É™ËˆsÉ”Ëlt/` n./v. ä¾µçŠ¯èº«ä½“ï¼›è¢­å‡»\n9. associate: å‰¯çš„ï¼›è”åˆçš„\n10. complementary: `/ËŒkÉ’mplÉªËˆmentri/` adj. äº’è¡¥çš„\n    1. complimentary: `/ËŒkÉ’mplÉªËˆmentri/` adj. å…è´¹çš„ã€èµ é€çš„ï¼›èµæ‰¬çš„ã€é’¦ä½©çš„:\n        1. compliment: `/ËˆkÉ’mplÉªmÉ™nt/` n. é—®å€™ã€è‡´æ„ï¼›èµæ‰¬\n11. supplementary - è¡¥å……çš„\n12. compatible: adj. å¯å…¼å®¹çš„ï¼›å¯å…±å­˜çš„ï¼›å…³ç³»å¥½çš„\n    1. compact: `/kÉ™mËˆpÃ¦kt/, /ËˆkÉ’mpÃ¦kt/` adj. ç´§å‡‘çš„ã€ç´§å®çš„ n. åè®® v. å‹ç´§ã€å‹å®\n13. addition\n14. accompany: v. é™ªä¼´ï¼Œä¼´éšï¼›ç»™â€¦â€¦ä¼´å¥ adj. å’Œâ€¦ä¸€èµ·å‘ç”Ÿçš„ï¼›é™„éšçš„ - accompaniment: n. ä¼´éšç‰©, ï¼ˆéŸ³ä¹ï¼‰ä¼´å¥, ä½é¤ç‰©, ä¼´éšå‘ç”Ÿçš„äº‹æƒ…\n    1. accomplish: v. å®Œæˆã€å®ç°\n# -cess\n\n```\n-cede, -ceed, -cess, -ceaseã€æ‹‰ä¸ã€‘ç§»åŠ¨ï¼›èµ°ï¼Œèµ°å¼€ï¼›æ”¾å¼ƒ\nåŒæ ¹è¯incessant|access|exceed|exceedingly|excess|excessive|necessary|predecessor|\n```\n\n1. exceed: `/ÉªkËˆsiËd/` v. åœ¨æ•°é‡æˆ–å¤§å°ä¸Šè¶…è¿‡\n    1. excess: n. `/ÉªkËˆses/` è¿‡é‡ adj. `/Ëˆekses/` è¿‡é‡çš„\n        1. abundant: `/É™ËˆbÊŒndÉ™nt/` adj. å¤§é‡çš„\n            1. abandon: `/É™ËˆbÃ¦ndÉ™n/` é—å¼ƒ\n            2. redundant: `/rÉªËˆdÊŒndÉ™nt/` adj. è¢«è£å‡çš„ï¼›å¤šä½™çš„\n                1. redundancy: n. è£å‘˜ã€è§£é›‡ï¼›å†—ä½™\n2. accessory: adj. é™„åŠ çš„ï¼›è¾…åŠ©çš„ n. é™„ä»¶ã€é…ä»¶ï¼›åŒè°‹ã€å¸®å‡¶\n    1. access: è®¿é—®ï¼›è¾¾åˆ°\n        1. accessible: å¯è®¿é—®çš„ï¼›æ— éšœç¢çš„\n    2. fitting: n. å¯æ‹†é™¤è£…ç½®ã€é™„ä»¶ adj. åˆèº«çš„\n3. predecessor: n. å‰è¾ˆï¼›å‰ä»»ï¼›åŸå…ˆçš„äº‹ç‰©\n# exert - excel - exile\n\n1. exert: v. ç”¨(åŠ›)ã€è¿ç”¨ï¼›å‘æŒ¥\n    1. exertion: n. è´¹åŠ›ï¼›åŠªåŠ›\n       The old man was out of breath from the exertion of climbing stairs. è¿™åè€äººè´¹åŠ›çˆ¬æ¥¼æ¢¯åï¼Œç´¯å¾—ä¸Šæ°”ä¸æ¥ä¸‹æ°”ã€‚\n2. excel: `/ÉªkËˆsel/` v. å“è¶Šï¼›ä¼˜äºï¼Œèƒœè¿‡ï¼›æ“…é•¿\n    1. exceed\n    2. transcend: `/trÃ¦nËˆsend/` vt. è¶…å‡º\n3. exile: `/ËˆeksaÉªl/` n./v. æµæ”¾ã€æµäº¡ï¼›æ”¾é€\n# ä¸Šå‡ï¼›æé«˜ï¼›å¢é•¿ï¼›æ‰©å¤§\n\n1. arise\n2. rise\n3. increasingly\n4. flourish - ç¹è£ã€å…´æ—ºï¼›è¿…é€Ÿå‘å±•\n    1. nourish: v. æŠšå…»ï¼Œæ»‹å…»ï¼›åŸ¹å…»ï¼ŒåŠ©é•¿\n    2. flour: n. é¢ç²‰\n5. sprawl: è”“å»¶ï¼›éšæ„æ‰©å±•ï¼Œæ— ç»„ç»‡æ— è®¡åˆ’æ‰©å¼ \n   Perhaps matching the trend among the public, green leaders are increasingly advocating cooperation between hunters and environmental groups: After all, both deplore urban sprawl and habitat destruction. æˆ–è®¸æ˜¯ä¸ºäº†è¿åˆå…¬ä¼—çš„è¶‹åŠ¿ï¼Œç¯ä¿é¢†è¢–æ­£ä¸æ–­å€¡å¯¼çŒäººå’Œç¯ä¿ç»„ç»‡ä¹‹é—´çš„åˆä½œï¼šæ¯•ç«Ÿï¼Œä¸¤è€…éƒ½åœ¨è°´è´£åŸå¸‚çš„æ‰©å¼ å’Œæ –æ¯åœ°çš„ç ´åã€‚\n6. thrive: v. ç¹è£ï¼›å…´æ—º\n7. enhance: v. æé«˜ï¼›å¢å¼ºï¼›å¢è¿› - enhancement: n. å¢å¼ºï¼›æ”¹å–„ï¼›å¢åŠ ï¼›å¢è¿›\n8. exalt: vt. æå‡ï¼›ææ‹”ï¼›èµæ‰¬ï¼›ä½¿å¾—æ„\n9. promote: vt. æå‡ï¼›ææ‹”ï¼›ä¿ƒè¿›\n10. prolong: v. å»¶é•¿\n11. foster: vt. å…»è‚²ï¼ŒæŠšè‚²ï¼›åŸ¹å…»ï¼›æŠ±ï¼ˆå¸Œæœ›ç­‰ï¼‰ adj. æ”¶å…»çš„ï¼Œå…»è‚²çš„\n12. boom: n. ç¹è£, åŠæ†, ï¼ˆæŸç§ä½“è‚²è¿åŠ¨ã€éŸ³ä¹ç­‰ï¼‰çªç„¶é£é¡çš„æ—¶æœŸ, å¸†æ¡ v. æ¿€å¢, ç¹è£æ˜Œç››, è½°é¸£, è½°å“ adj. ã€ˆç¾ã€‰çŒ›æ¶¨èµ·æ¥çš„\n13. ascend: v. ä¸Šå‡ï¼›æ”€ç™»\n14. accrue: v. (é€æ¸)å¢é•¿ï¼›ç§¯ç´¯\n15. soar: v. çŒ›å¢\n    1. surge: v./n. æ€¥å‰§çŒ›å¢ï¼›å¥”æ”¾\n16. swell: v./n æ‰©å¤§ã€é¼“å‡ºï¼›è‚¿èƒ€\n    1. sw**o**llen: adj. è‚¿èƒ€çš„\n17. mount: v. ç™»ä¸Šï¼ˆå±±ï¼‰ï¼›å¢åŠ ã€ä¸Šå‡ã€å¢é•¿ï¼›å‘èµ·ã€ç»„ç»‡å¼€å±•\n18. escalate: `/ËˆeskÉ™leÉªt/` v. é€æ­¥æ‰©å¤§ï¼ˆå½±å“ä¸å¥½åœ°ã€æ¶åŒ–åœ°ï¼‰ï¼ˆæ³¨æ„æ˜¯æ‰©å¤§ï¼Œä¸æ˜¯ä¸‹é™ï¼‰\n    The house prices in China have escalated sharply. ä¸­å›½æˆ¿ä»·é£™å‡ã€‚\n## prompt - promote\n\n1. prompt: v. ä¿ƒè¿› adj. è¿…é€Ÿçš„ n. è®¡ç®—æœºå±å¹•ä¸Šçš„æç¤ºç¬¦ã€æ¼”å‘˜çš„æè¯æç™½\n    1. promptly: è¿…é€Ÿåœ°ï¼›ç«‹åˆ»\n    2. impromptu: `/ÉªmËˆprÉ’mptjuË/` adv./adj. å³å…´çš„ï¼ˆåœ°ï¼‰ï¼›æ— å‡†å¤‡çš„ï¼ˆåœ°ï¼‰\n    3. impetus: `/ËˆÉªmpÉªtÉ™s/` n. æ¨åŠ¨ã€ä¿ƒè¿›ã€åˆºæ¿€\n    4. stimulate: `/ËˆstÉªmjuleÉªt/` v. åˆºæ¿€ï¼›æ¿€å‘ï¼›ä¿ƒè¿›\n        1. stimulus: `/ËˆstÉªmjÉ™lÉ™s/` n. åˆºæ¿€ç‰©ï¼›ä¿ƒè¿›å› ç´ \n2. promote vt. æå‡ï¼Œææ‹”ï¼›ä¿ƒè¿›\n    1. promotion: n. æ™‹å‡ï¼›ææ‹”\n    2. exalt: vt. æå‡ï¼›ææ‹”ï¼›èµæ‰¬ï¼›ä½¿å¾—æ„\n# -ump: lump - bump - pump - hump - stump\n\n1. bump: n. ç¢°æ’ï¼›éš†èµ·ã€è‚¿å— v. ç¢°æ’ï¼›é¢ ç°¸è€Œè¡Œ\n2. pump: n./v. æ³µ\n3. lump: n. å—çŠ¶ï¼›è‚¿å— vt. ä½¿æˆå—çŠ¶ï¼›ä½¿...å½’å¹¶ã€æ··åœ¨ä¸€èµ·\n    1. slump: v./n. éª¤é™ã€çŒ›è·Œ\n    2. stump: n. æ ‘æ¡©ï¼›æ®‹ä½™éƒ¨åˆ†ã€æ®‹æ ¹\n4. hump: n. ï¼ˆå¹³é¢ä¸Šçš„ï¼‰å¤§éš†èµ·ç‰©ï¼›é©¼èƒŒï¼ˆå¥½å‹è®°ç¬¬1é›†ï¼‰\n5. ridge: `/rÉªdÊ’/` n. å±±è„Šã€å±±è„‰ï¼›éš†èµ·\n# ä¸‹é™ï¼›ç¼©çŸ­ï¼›æ¶åŒ–\n\n1. recede: `/rÉª'siËd/` vi. åé€€ï¼Œå‡å¼±\n2. abridge: v. åˆ èŠ‚ï¼ŒèŠ‚ç•¥ï¼ˆä¹¦ç±ã€å‰§æœ¬ç­‰ï¼‰\n3. aggravate: `/ËˆÃ¦É¡rÉ™veÉªt/` v. ä½¿ä¸¥é‡ã€æ¶åŒ–\n    1. aggregate: `/ËˆÃ¦É¡rÉªÉ¡É™t/` v./n. æ€»è®¡\n    2. exaggerate: `/ÉªÉ¡ËˆzÃ¦dÊ’É™reÉªt/` v. å¤¸å¤§äº‹å®ã€å¤¸å¼ \n        1. extravagant: `/ÉªkËˆstrÃ¦vÉ™É¡É™nt/` adj. æµªè´¹çš„\n        2. congregate: v. é›†åˆ\n        3. segregate: v. éš”ç¦»å¹¶åŒºåˆ«å¯¹å¾…\n4. escalate: `/ËˆeskÉ™leÉªt/` v. é€æ­¥æ‰©å¤§ï¼ˆå½±å“ä¸å¥½åœ°ã€æ¶åŒ–åœ°ï¼‰ï¼ˆæ³¨æ„æ˜¯ä¸Šå‡ï¼Œä¸æ˜¯ä¸‹é™ï¼‰\n    The house prices in China have escalated sharply. ä¸­å›½æˆ¿ä»·é£™å‡ã€‚\n5. **adverse: `/É™dËˆvÉœËrs/, /ËˆÃ¦dvÉœËrs/` adj. åçš„ã€ä¸åˆ©çš„ã€æœ‰å®³çš„ï¼›åé¢çš„**\n6. slump: v./n. éª¤é™ã€çŒ›è·Œ\n7. tumble: n./v. æš´è·Œ\n    1. humble: adj. è°¦é€Šçš„ï¼›å‘å¾®çš„ v. è´¬ä½ï¼›ä½¿æ„Ÿåˆ°å‘å¾®\n8. plunge: v. æš´è·Œï¼Œéª¤é™ n. éª¤é™\n9. reduction: n. å‰Šå‡ï¼›é™ä½\n## de-\n\n1. decline: v. ä¸‹é™\n    1. incline: v. å€¾å‘\n2. descend: v. ä¸‹é™\n    1. descent: n. ä¸‹é™ï¼›è¡€ç»Ÿã€å®¶ä¸–\n    2. ascend: `/É™Ëˆsend/` vi. ä¸Šå‡ï¼›æ”€ç™»\n        1. ascent: n. ä¸‹é™\n3. deteriorate: `/dÉªËˆtÉªÉ™riÉ™reÉªt/` vi. æ¶åŒ–\n    1. deter: v. é˜»æ­¢ã€åˆ¶æ­¢\n       æ‹‰ä¸å‰ç¼€`deterior-`ï¼šå˜å¾—æ›´å\n        1. defer: `/dÉªËˆfÉœË(r)/` vt. æ¨è¿Ÿã€å»¶æœŸ\n        2. detergent: `/dÉªËˆtÉœËdÊ’É™nt/` n. æ´—æ¶¤å‰‚ã€æ´—æ¶¤ç²‰\n    2. detrimental: adj. ä¸åˆ©çš„\n    3. **wholesome: æœ‰ç›Šå¥åº·çš„**\n    4. impair: v. æŸå®³ï¼›å‰Šå¼±\n    5. toxic: `/ËˆtÉ’ksÉªk/` adj. æœ‰æ¯’çš„ã€æœ‰å®³çš„\n1. deprive: v. å‰¥å¤ºï¼›å¤±å»\n    1. å¸¸ä¸ofæ­é…ï¼šYoung people are being deprived of the thing they need most, perspective. å¹´è½»äººè¢«å‰¥å¤ºäº†ä»–ä»¬æœ€éœ€è¦çš„ä¸œè¥¿ï¼Œå®¢è§‚åˆ¤æ–­åŠ›ã€‚\n## di-: dilute - diminish - diligence\n\n1. dilute: `/daÉªËˆluËt/` v. ç¨€é‡Š adj. ç¨€é‡Šçš„, æ·¡çš„\n    1. dilution: `/daÉªËˆluËÊƒn/` n. ç¨€é‡Šï¼›å‰Šå¼±\n2. diminish: v. å‡å°‘ã€å‡å¼±ã€é™ä½ï¼›è´¬ä½ã€è´¬æŸï¼›è½»è§†\n    1. æ‹‰ä¸ï¼šdi-: å¦å®šï¼›åˆ†ç¦»ï¼›å®Œå…¨ï¼›min-: å˜å°ã€å˜å°‘\n       å¤è‹±è¯­ï¼š-ish: åŠ¨è¯åç¼€\n    2. minish: v. ä½¿å‡å°‘ï¼›ä½¿ç¼©å°\n3. diligence: n. å‹¤å¥‹ï¼›å‹¤å‹‰ï¼›ç”¨åŠŸ - diligent: adj. å­œå­œä¸å€¦çš„ï¼›å‹¤å‹‰çš„ï¼›åˆ»è‹¦çš„\n4. disposal: n. å¤„ç†å¹²å‡€ï¼›æ¸…é™¤\n# dispose - disposition - impose - imposition - expose - exposition\n\n1. dispose: v. å¤„ç†ã€å¤„ç½®ã€å®‰æ’ï¼›ä½¿å€¾å‘äºã€ä½¿æœ‰æ„äºã€ä½¿æ˜“äº\n    1. disposition: n. ï¼ˆæ€§æ ¼ï¼‰å€¾å‘ï¼›å®‰æ’ã€å¸ƒç½®\n    2. disposal: n. å¤„ç†å¹²å‡€ï¼›æ¸…é™¤\n2. impose: `/ÉªmËˆpÉ™ÊŠz/` v. å¼ºåˆ¶æ¨è¡Œã€å®è¡Œï¼›è¿«ä½¿ã€æŠŠâ€¦å¼ºåŠ äº\n    1. imposition: `/ËŒÉªmpÉ™ËˆzÉªÊƒn/` n. ï¼ˆè§„åˆ™çš„ï¼‰å®æ–½ï¼›å¾æ”¶ï¼›ï¼ˆå¼ºè¿«ï¼‰çš„è¦æ±‚\n    2. compulsory: `/kÉ™mËˆpÊŒlsÉ™ri/` adj. å¿…é¡»åšçš„ï¼›å¼ºåˆ¶çš„ã€å¼ºè¿«çš„ï¼›ä¹‰åŠ¡çš„\n3. expose: `/ÉªkËˆspÉ™ÊŠz/` v. æš´éœ²ã€æ˜¾éœ²ï¼›æ­éœ²ï¼›é¢ä¸´ã€é­å—\n    1. exposition: `/ËŒekspÉ™ËˆzÉªÊƒn/` n. è§£é‡Šã€è¯´æ˜ã€é˜è¿°\n# -dge; -orge\n\n1. budget: n. é¢„ç®—\n2. badge: n. è±¡å¾ï¼›æ ‡è®°\n    1. barge: v. å†²æ’ã€ä¹±é—¯\n3. lodge: `/lÉ’dÊ’/`v. ï¼ˆå‘æœºæ„ï¼‰æ­£å¼æå‡ºï¼ˆå£°æ˜ï¼‰ï¼›å€Ÿå®¿ï¼Œç§Ÿä½ï¼›ä¸º...æä¾›ä½å®¿ï¼›å¯„å­˜ï¼Œå­˜æ”¾ï¼Œä½¿å›ºå®šã€åµŒå…¥ n. ä¼ è¾¾å®¤ã€ç®¡ç†å‘˜å®¤ï¼›é—¨æˆ¿, æ—…é¦†ï¼›ä¹¡é—´å°å±‹\n4. dodge: `/dÉ’dÊ’/` v. èº²é¿ n. æ¨è„±çš„è¯¡è®¡\n5. forge: `/fÉ”ËdÊ’/` v. é”»é€ ï¼›ä¼ªé€ ã€å‡å†’ n. é”»é€ ç‚‰ã€é”»é€ å·¥å‚\n6. cartridge: n. å¼¹ç›’ï¼›å¢¨ç›’\n    1. carton: `/ËˆkÉ‘Ëtn/` n. ç¡¬çº¸ç›’\n    2. cartoon: `/kÉ‘ËËˆtuËn/` n. æ¼«ç”»\n7. pledge:`/pledÊ’/` n./v. ä¿è¯ã€æ‰¿è¯º\n## abridge - ridge - bribe - bride - bridle - abide\n\n1. abridge: `/É™ËˆbrÉªdÊ’/` v. åˆ èŠ‚ï¼ŒèŠ‚ç•¥ï¼ˆä¹¦ç±ã€å‰§æœ¬ç­‰ï¼‰\n    1. ridge: `/rÉªdÊ’/` n. å±±è„Šã€å±±è„‰ï¼›éš†èµ·\n2. bribe: `/braÉªb/` v./n. è´¿èµ‚\n3. bride: `/braÉªd/` n. æ–°å¨˜\n    1. bridegroom: æ–°éƒ\n4. bridle: `/ËˆbraÉªdl/` n. é©¬å‹’ï¼›ç³»å¸¦ï¼›çº¦æŸç‰©ï¼›ç¼°ç»³ vt. æ§åˆ¶ï¼›ç»™è£…é©¬å‹’\n5. abide: `/É™ËˆbaÉªd/` v. å®¹å¿ã€å¿å—ï¼›å±…ä½\n# æ”¿æ²»æ–‡åŒ–\n\n## ç‹å›½ã€å†›äº‹æ–‡åŒ–\n\n1. realm: ç‹å›½ï¼›é¢†åŸŸã€èŒƒå›´\n   ç”±reg-è¯æ ¹å¼€å¤´ï¼Œæ‹‰ä¸è¯­ä¸­è¡¨ç¤ºâ€œç»Ÿæ²»ã€ç®¡ç†â€\n    1. reign: v. å›ä¸»ç»Ÿæ²» - rein: ç»Ÿæ²»ã€æ”¯é… - reinforce: åŠ å›ºï¼›åŠ å¼º\n    2. regiment: n. ï¼ˆå†›é˜Ÿçš„ï¼‰å›¢ï¼›ä¸€å¤§ç¾¤äººï¼ˆæˆ–äº‹ç‰©ï¼‰\n1. troop: n. å†›é˜Ÿã€éƒ¨é˜Ÿï¼›ä¸€ç¾¤ã€ä¸€é˜Ÿ v. æˆç¾¤ç»“é˜Ÿè€Œè¡Œï¼›åˆ—é˜Ÿè¡Œè¿›\n2. **extent: n. ç¨‹åº¦ï¼›èŒƒå›´**\n3. empire: `/ËˆempaÉªÉ™(r)/` n. å¸å›½\n    1. emperor: `/ËˆempÉ™rÉ™(r)/` n. çš‡å¸\n    2. empirical: `/ÉªmËˆpÉªrÉªkl/` adj. ç»éªŒä¸»ä¹‰çš„\n    3. imperial: `/ÉªmËˆpÉªÉ™riÉ™l/` adj. çš‡å¸çš„ï¼›å¸å›½çš„\n        1. imperative: n. ç´§è¦çš„äº‹æƒ…ï¼›**ç¥ˆä½¿è¯­æ°”** adj. ç´§è¦çš„\n4. crown: `/kraÊŠn/` n. çš‡å† ã€ç‹å†  v. åŠ å†•\n5. territory: `è‹±/ËˆterÉ™tri/ ç¾/ËˆterÉ™tÉ”Ëri/` n. é¢†åœŸï¼Œé¢†åœ°ï¼›ï¼ˆçŸ¥è¯†ï¼‰é¢†åŸŸï¼ŒèŒƒå›´\n6. royal: ç‹å®¤çš„\n    1. loyal: å¿ è¯šçš„\n    2. moral: n. å¯“æ„ï¼›é“å¾· adj. é“å¾·ä¸Šçš„ï¼›æœ‰é“å¾·çš„\n7. majesty: `/'mÃ¦dÊ’É™sti/` n. å¨ä¸¥ã€åº„ä¸¥\n   The queen was seated on the throne in all her majesty. å¥³ç‹å¨ä¸¥åœ°ååœ¨ç‹åº§ä¸Šã€‚\n    1. throne: `/Î¸rÉ™ÊŠn/` n. å®åº§ï¼›ç‹ä½\n8. palace: n. å®«æ®¿, ç‹å®«, æ€»ç»Ÿåºœ, ä½åœ¨ç‹å®«é‡Œçš„äºº\n9. dictatorship: ç‹¬è£ã€ä¸“æ”¿\n    1. dictate: v. å£æˆã€å£è¿°ï¼›å‘å·æ–½ä»¤ï¼›æ”¯é…ï¼›ä½¿å¬å†™\n10. earl: n. ä¼¯çˆµ\n11. lieutenant: é™†å†›ä¸­å°‰ï¼›æµ·å†›ã€ç©ºå†›ä¸Šå°‰ï¼›å‰¯èŒå®˜å‘˜\n   è‹±`/lefËˆtenÉ™nt/` ç¾`/luËËˆtenÉ™nt/`\n    1. tenant: n. æ‰¿ç§Ÿäººï¼›æˆ¿å®¢ï¼›å±…ä½è€…\n9. sergeant: `/ËˆsÉ‘ËdÊ’É™nt/` n. å£«å…µï¼›ä¸­å£«\n    1. corporal: `/ËˆkÉ”ËpÉ™rÉ™l/` n. ä¸‹å£« adj. è‚‰ä½“çš„ - corporal punishment: ä½“ç½š\n10. marshal: v. æ§åˆ¶äººç¾¤ï¼ˆåŠ¨å‘˜ï¼‰ã€é›†ç»“ n. ç©ºå†›å…ƒå¸…ï¼›å¸ä»ªï¼›å…¸ç¤¼å®˜\n    1. convene: `/kÉ™nËˆviËn/` v. å¬é›†ï¼›å¬å”¤ï¼›èšé›†ï¼›é›†åˆ\n        1. congregate: v. é›†åˆ\n        2. summon: v. ä¼ å”¤æŸäººå‡ºå¸­ï¼›å¬é›†\n        3. recruit: `/rÉªËˆkruËt/` v. æ‹›æ”¶ï¼›åŠ¨å‘˜ n. æ–°æˆå‘˜\n    2. martial adj. å†›äº‹çš„ï¼›å¨æ­¦çš„\n    3. marsh: n. æ²¼æ³½ã€æ¹¿åœ°\n11. infantry: n. ï¼ˆç»Ÿç§°ï¼‰æ­¥å…µ\n    1. cavalry éª‘å…µ artillery ç‚®å…µ archer å¼“å…µ\n12. navy: `/'neÉªvi/` n. æµ·å†›, æµ·å†›éƒ¨é˜Ÿ\n13. warship: n. èˆ°è‰‡ï¼›å†›èˆ°\n    1. worship: n. å´‡æ‹œ, çˆ±æ…•, åšç¤¼æ‹œ vi. åšç¤¼æ‹œ vt. å´‡æ‹œ, çˆ±æ…•\n14. sway: v. æ‘‡åŠ¨ï¼›ä½¿åŠ¨æ‘‡ï¼›è¯´æœã€ä½¿ç›¸ä¿¡ n. å½±å“ï¼›åŠ¨æ‘‡ï¼›ç»Ÿæ²»\n15. veteran: `/'vetÉ™rÉ™n/` n. è€æ‰‹ adj. (å°¤æŒ‡å†›äº‹æ–¹é¢)è€ç»ƒçš„\n16. scout: n. ä¾¦å¯Ÿå‘˜ï¼›ä¾¦å¯Ÿæœº v. ä¾¦å¯Ÿï¼Œæœå¯»ï¼›ç‰©è‰²\n17. escort: `/ËˆeskÉ”Ët/` n. é™ªåŒï¼›æŠ¤é€è€…ï¼›æŠ¤èˆªèˆ°ï¼›æŠ¤å«é˜Ÿ vt. æŠ¤é€ï¼›é™ªåŒ\n18. skirmish: n. å°å†²çª\n19. faction: n. æ´¾ç³»ï¼Œå°é›†å›¢ï¼›å†…è®§\n20. militia: n. æ°‘å…µ\n    1. militancy: n. æˆ˜æ–—çŠ¶æ€ï¼›å¥½æˆ˜å€¾å‘\n21. patriot: `è‹±/ËˆpÃ¦triÉ™t/ ç¾/ËˆpeÉªtriÉ™t/` n. çˆ±å›½è€…\n    1. patriotism: n. çˆ±å›½ä¸»ä¹‰ï¼›çˆ±å›½ç²¾ç¥\n22. sovereign: `/ËˆsÉ’vrÉªn/` n. å›ä¸»ã€å…ƒé¦–\n    1. sovereignty: `/ËˆsÉ’vrÉ™nti/` n. æœ€é«˜ç»Ÿæ²»æƒ\n23. ammunition: `/ËŒÃ¦mjÉ™ËˆnÉªÊƒn/` n. å¼¹è¯ã€å†›ç«\n24. fort: `/fÉ”Ët/` n. è¦å¡ï¼›å ¡å’\n    1. fortify: `/ËˆfÉ”ËtÉªfaÉª/` vt. åŠ å¼ºï¼ˆå»ºç­‘é˜²å¾¡ï¼‰\n        1. fortification: n. ç¢‰å ¡ã€å›´å¢™ï¼›é˜²å¾¡å·¥äº‹\n## æ°‘ä¸»ã€é€‰ä¸¾æ–‡åŒ–\n\n1. vote\n2. elect: v. é€‰ä¸¾ã€é€‰æ‹© adj. è¢«é€‰å‡ºçš„ï¼›å€™ä»»çš„\n    1. electoral: `/ÉªËˆlektÉ™rÉ™l/` adj. æœ‰å…³é€‰ä¸¾çš„\n3. candidate: `/ËˆkÃ¦ndÉªdeÉªt/` n. å€™é€‰äºº\n4. nominee: æåäºº\n5. applicant: å‚ä¸äºº\n6. constituent: `kÉ™n'stitjuÉ™nt`  n. æˆåˆ†ï¼›é€‰æ°‘ï¼›å§”æ‰˜äºº adj. æ„æˆçš„ï¼›é€‰ä¸¾çš„\n7. parliament: `/ËˆpÉ‘ËlÉ™mÉ™nt/` n. è®®ä¼šï¼›å›½ä¼š - è‹±å›½è®®ä¼šéœ€å¤§å†™ï¼ˆåŒ…æ‹¬ä¸‹è®®é™¢å’Œä¸Šè®®é™¢ï¼‰\n8. committee: n. å§”å‘˜ä¼š\n    1. commitment: n. æ‰¿è¯ºã€ä¿è¯ï¼›çº¦æŸã€ä¹‰åŠ¡\n    2. delegation: n. ä»£è¡¨å›¢\n        1. delegate: v. é€‰æ´¾ã€å§”æ´¾ï¼›æˆæƒ\n9. franchise - n./v. æˆæƒï¼ˆç»é”€æƒï¼‰ï¼›é€‰ä¸¾æƒ - enfranchise: ç»™...é€‰ä¸¾æƒï¼›è§£æ”¾ï¼ˆå¥´éš¶ï¼‰\n10. emancipation: n. è§£æ”¾ï¼ˆè¿åŠ¨ï¼‰\n    The political emancipation of women gave females freedom and rights. å¦‡å¥³çš„æ”¿æ²»è§£æ”¾ç»™äºˆäº†å¥³æ€§è‡ªç”±å’Œæƒåˆ©ã€‚\n11. lobby: v. ï¼ˆå°±æŸä¸€é—®é¢˜å‘ç«‹æ³•è€…ï¼‰æ¸¸è¯´ - lobbyist: n. è¯´å®¢ï¼Œè®®æ¡ˆé€šè¿‡è€…\n    And the water is muddied by lobbying from the industries that profit from consumption of obesity-inducing products. åŒæ—¶ï¼Œé‚£äº›ä»è‡´è‚¥èƒ–äº§å“çš„æ¶ˆè´¹ä¸­è·ç›Šçš„äº§ä¸šï¼Œé€šè¿‡æ¸¸è¯´æŠŠè¿™è¶Ÿæ°´æ…æµ‘äº†ã€‚\n12. abolition: n. åºŸæ­¢\n    The reforms finally led to the abolition of the monarchy. è¿™äº›æ”¹é©æœ€ç»ˆåºŸé™¤äº†å›ä¸»åˆ¶ã€‚\n13. tenure: `/ËˆtenjÉ™(r)/` n. ä»»æœŸ\n14. senator: `/ËˆsenÉ™tÉ™(r)/` n. å‚è®®å‘˜\n15. cabinet: n. å†…é˜ï¼›æ©±ã€æŸœ - cabinet minister: å†…é˜å¤§è‡£\n16. parade: `/pÉ™ËˆreÉªd/` n./v. ï¼ˆç‚«è€€åœ°ï¼‰æ¸¸è¡Œ\n    1. paradigm: n. æ¨¡å‹ã€æ¨¡èŒƒã€æ¦œæ ·\n### nominate - dominate - prominent - eminent\n\n1. nominate: vt. æåï¼›ä»»å‘½ï¼›æŒ‡å®šï¼›æ¨è\n2. dominate: vt. æ”¯é…ï¼›æ§åˆ¶ï¼›å ä¼˜åŠ¿ï¼›åœ¨â€¦ä¸­å ä¸»è¦åœ°ä½ vi. å¤„äºæ”¯é…åœ°ä½ï¼›å ä¼˜åŠ¿\n    1. dominance: n. ä¼˜åŠ¿;æ”¯é…åœ°ä½;æ§åˆ¶åŠ› = dominancy: n. ä¼˜åŠ¿,ç»Ÿæ²»\n          1. åœ¨ç”Ÿç‰©å­¦ä¸­ï¼Œæ˜¯æ˜¾æ€§çš„æ„æ€ã€‚\n    2. predominance: n. å“è¶Šï¼›ä¼˜åŠ¿ï¼›æ§åˆ¶\n3. **prominent: adj. çªå‡ºçš„ã€æ˜¾è‘—çš„**\n4. eminent: `/ËˆemÉªnÉ™nt/` adj. è‘—åçš„ã€æ˜¾èµ«çš„ï¼›éå‡¡çš„ã€æ°å‡ºçš„\n    1. eminence: n. è‘—åã€æ˜¾èµ«\n### designate - designation - signify\n\n1. designate: v. æŒ‡å®šï¼›é€‰æ´¾ï¼›æ ‡æ˜ï¼›æŒ‡æ˜\n2. designation: `/dezÉªg'neÉªÊƒ(É™)n/` n. åç§°ï¼›æŒ‡å®šï¼›ç§°å·ï¼›é€‰å®š\n3. resign: è¾èŒ\n4. signify: v. æŒ‡æ˜ã€æŒ‡ç¤º\n## å®˜èŒ\n\n1. minister: n. éƒ¨é•¿ï¼›å¤§è‡£ï¼›å¤–äº¤ä½¿èŠ‚\n2. hierarchy: `/ËˆhaÉªÉ™rÉ‘Ëki/` n. å±‚æ¬¡ä½“ç³»ï¼›ç­‰çº§åˆ¶åº¦\n    1. hierarchical: `/ËŒhaÉªÉ™ËˆrÉ‘ËkÉªkl/` adj. æŒ‰ç­‰çº§åˆ’åˆ†çš„\n3. magistrate: `/ËˆmÃ¦dÊ’ÉªstreÉªt/` n. åŸºå±‚æ‰§æ³•å®˜\n# å®—æ•™æ–‡åŒ–\n\n1. pilgrim: n. æœåœ£è€… (a person who travels to a holy place for religious reasons)\n    1. The pilgrims put their palms together and slowly approached the church.æœåœ£è€…åŒæ‰‹åˆåï¼Œæ…¢æ…¢èµ°è¿‘æ•™å ‚ã€‚\n2. deliverance: n. æ‹¯æ•‘, è§£æ•‘, è§£è„± - å’Œå®—æ•™æœ‰å…³ï¼Œæ„ä¸ºâ€œæ•‘èµâ€\n    1. redemptionï¼›salvation `/sÃ¦lËˆveÉªÊƒn/`ï¼›atonement\n        1. Massive infrastructure construction proved to be the salvation of the country's economy. å¤§é‡çš„åŸºç¡€è®¾æ–½å»ºè®¾æŒ½æ•‘äº†è¯¥å›½ç»æµã€‚\n    2. savior: `/ËˆseÉªvjÉ™(r)/` n. æ•‘ä¸–ä¸»\n        1. savage: `/ËˆsÃ¦vÉªdÊ’/` adj. é‡è›®çš„ n. é‡è›®äºº\n        2. sovereignty: `/ËˆsÉ’vrÉ™nti/` n. æœ€é«˜ç»Ÿæ²»æƒ\n3. bishop: n. ä¸»æ•™\n4. cardinal: n. çº¢è¡£ä¸»æ•™ adj. æœ€åŸºæœ¬çš„\n    1. cardinal number: æ•°å­¦ä¸Šçš„åŸºæ•°\n5. canon\n    1. canon: n. æ•™è§„ï¼›è§„åˆ™ï¼›æ ‡å‡†ï¼›åŸåˆ™\n6. priest: n. ç¥èŒäººå‘˜\n\t1. prime: adj. ä¸»è¦çš„ï¼›é¦–è¦çš„\n    \t1. primitive: adj. åŸå§‹çš„ã€è¿œå¤çš„ï¼›è½åçš„\n\t2. clergy: n. ç¥èŒäººå‘˜\n7. divine: `/dÉªËˆvaÉªn/` adj. ç¥åœ£çš„ï¼›ä¸Šå¤©çš„\n   He suggested that the earthquake had been a divine punishment. ä»–æš—ç¤ºè¯´åœ°éœ‡æ˜¯ä¸Šå¤©çš„æƒ©ç½šã€‚\n7. sacred: `/ËˆseÉªkrÉªd/` adj. ç¥åœ£çš„\n    1. sacrifice: n./v. ç‰ºç‰²ï¼›çŒ®ç¥­\n# ç»æµã€å•†ä¸šæ–‡åŒ–\n\n1. fiscal: `/ËˆfÉªskl/` adj. è´¢æ”¿çš„ï¼›å›½åº“çš„\n2. levy: `/Ëˆlevi/` n. ç¨æ¬¾ v. å¾ç¨\n3. exempt: `/ÉªÉ¡Ëˆzempt/` adj. è±å…çš„ v. å…é™¤ã€è±å…\n    1. exemplify: `/ÉªÉ¡ËˆzemplÉªfaÉª/` v. æ˜¯...çš„ä¾‹è¯ã€æ¦œæ ·ï¼›è¯æ˜äº†...\n## è´¸æ˜“ã€å¸‚åœº\n\n1. barter: v. äº’æ¢ n. äº’æ¢ç‰© - a barter economy ä»¥ç‰©æ˜“ç‰©çš„ç»æµå½¢å¼\n2. bargain: è®¨ä»·è¿˜ä»·\n3. incoterms: n. å›½é™…è´¸æ˜“æœ¯è¯­ï¼ˆInternational Commercial Termsï¼‰\n4. glut: n./v. ä¾›åº”è¿‡å‰©ï¼›ä¾›è¿‡äºæ±‚\n5. budget: n. é¢„ç®—\n    1. assess: v. ä¼°ç®—ã€ä¼°ä»·ï¼›è¯„ä¼°\n6. promissory: adj. è¡¨ç¤ºå…è¯ºçš„, çº¦å®šçš„, ã€å•†ã€‘çº¦å®šæ”¯ä»˜çš„\n    1. Roger signed a promissory note pledging to pay Fiona $50,000. ç½—æ ¼ç­¾äº†ä¸€å¼ æœŸç¥¨ï¼Œæ‰¿è¯ºä»˜ç»™è²å¥¥å¨œ5ä¸‡ç¾å…ƒã€‚\n7. bid: v. æŠ•æ ‡ï¼›å‡ºä»·ï¼›å©å’ï¼›è¡¨ç¤º n. å‡ºä»·ï¼›å«ç‰Œï¼›åŠªåŠ›äº‰å–\n    1. bidding: n. æŠ•æ ‡ï¼›å‡ºä»·ï¼›å‘½ä»¤\n8. wholesale: adv. ä»¥æ‰¹å‘çš„æ–¹å¼: `The factory claims they only sellwholesale, not to the public. è¯¥å·¥å‚å®£ç§°ä»–ä»¬åªæ‰¹å‘ï¼Œä¸é›¶å”®`\n    1. retail: n./v. é›¶å”®\n9. vacant: `/ËˆveÉªkÉ™nt/` adj. é—²ç½®çš„ã€æœªè¢«å ç”¨çš„ - vacant properties: é—²ç½®çš„æˆ¿äº§\n    1. vacation: `/veÉªËˆkeÉªÊƒn/ /vÉ™ËˆkeÉªÊƒn/` n. å‡æœŸ\n    2. vocation: `/vÉ™ÊŠËˆkeÉªÊƒn/` n. èŒä¸šï¼›å·¥ä½œï¼›ä½¿å‘½\n    3. vaccine: `/ËˆvÃ¦ksiËn/` n. ç–«è‹—\n        1. vaccinate: `/ËˆvÃ¦ksÉªneÉªt/` v. ç»™â€¦æ¥ç§ç–«è‹—\n10. investment: æŠ•èµ„\n    1. investigate: é‡‡è®¿ï¼›è°ƒæŸ¥\n        1. inquiry: n. æ‰“å¬ã€è°ƒæŸ¥\n11. smuggle: v. èµ°ç§\n12. turnover: `/ËˆtÉœËnÉ™ÊŠvÉ™(r)/` n. è¥ä¸šé¢ã€æˆäº¤é‡ï¼›äººå‘˜æ›´æ›¿ç‡\n## æŠ¥é…¬ã€å·¥èµ„\n\n1. wage - æ—¥è–ªã€å‘¨è–ª\n2. remuneration: æŠ¥é…¬\n    1. æ‹‰ä¸è¯­ä¸­çš„munerateæ˜¯â€œå±•ç¤ºâ€çš„æ„æ€ï¼Œå› ä¸ºè¯æ ¹`muner-`æœ‰â€œç»™â€çš„æ„æ€ï¼Œåœ¨è¿™é‡Œå¯ä»¥çœ‹ä½œâ€œä»˜å‡ºåŠ³åŠ¨â€ã€‚reæ˜¯â€œå½’â€çš„æ„æ€ã€‚æ‰€ä»¥ï¼Œâ€œå½’+ä»˜å‡ºåŠ³åŠ¨â€=ä»˜å‡ºåŠ³åŠ¨çš„å›é¦ˆã€‚remunerate: ä»˜é…¬ç»™...\n3. recompense: `/'rekÉ™mpens/` v. ç»™â€¦ä»¥è¡¥å¿, èµ”å¿ n. æŠ¥é…¬, èµ”å¿, è¡¥å¿\n## å½’å› äºã€å½’å’äºï¼›æ¬ \n\n1. deserve\n2. due: adj. ç”±äº...çš„ï¼›é¢„è®¡çš„ã€åˆ°æœŸçš„ï¼›ï¼ˆå½¢å®¹é’±ã€ç‰©å“ï¼Œsth. is due to sb.ï¼‰åº”ä»˜ç»™æŸäººçš„ã€æ¬ æŸäººçš„ï¼ˆnot before n.ï¼‰ï¼›ï¼ˆå½¢å®¹äººï¼Œsb. be due for ...ï¼‰æŸäººåº”æœ‰ã€åº”å¾—åˆ°...çš„ï¼›åˆé€‚çš„ã€æ°å½“çš„\n3. owe: v.\n4. ascribe: `/É™ËˆskraÉªb/` v. sth. is ascribed to ... æŸäº‹å½’å› äº...\n## debit - credit - debt\n\n1. debit: `/ËˆdebÉªt/` n. è´¢åŠ¡è®°å½•ä¸­æ‰€æ¬ æˆ–èŠ±è´¹çš„ä¸€ç¬”é’±çš„ä¹¦é¢è®°å½• v. å½“é“¶è¡Œä»è´¦æˆ·å€Ÿè®°æ¬¾é¡¹æ—¶ï¼Œå®ƒä¼šä»è´¦æˆ·ä¸­æ‰£é™¤æ¬¾é¡¹ - debit card å€Ÿè®°å¡\n2. debt: `/det/` n. æ¬ æ¬¾ã€å€ºåŠ¡ï¼›äººæƒ…å€ºã€æ©æƒ…\n    1. indebted: `/ÉªnËˆdetÉªd/` adj. æ„Ÿæ¿€çš„ã€è’™æ©çš„ï¼›ï¼ˆå›½å®¶ï¼‰è´Ÿå€ºçš„\n3. credit: `/ËˆkredÉªt/` n. æ¬ è´¦ï¼›ä¿¡èª‰ï¼›å­¦åˆ† v. å…è®¸â€¦èµŠæ¬ ï¼›ä¸ºâ€¦æä¾›è´·æ¬¾ï¼›ç»™(å­¦ç”Ÿ)è®°å­¦åˆ†\n    1. creditor: è´·æ–¹\n    2. credit card: ä¿¡ç”¨å¡\n## ç§Ÿèµ\n\n1. hire: ç§Ÿèµ\n    1. fire: è§£é›‡\n        1. redundant: `/rÉªËˆdÊŒndÉ™nt/` adj. è¢«è£å‡çš„ï¼›å¤šä½™çš„\n            1. redundancy: n. è£å‘˜ã€è§£é›‡ï¼›å†—ä½™\n2. lease: `/liËs/` n. ç§Ÿçº¦ã€ç§Ÿå¥‘ v. ç§Ÿç”¨ï¼Œç§Ÿå€Ÿï¼Œå‡ºç§Ÿ\n    1. lessee: `/le'siË/` n. æ‰¿ç§Ÿäºº, ç§Ÿæˆ·\n## boycott\n\n1. boycott: v. æŠµåˆ¶ï¼›æ‹’ç»å‚åŠ  n. è”åˆæŠµåˆ¶\n## é‡‘è\n\n1. monetary: adj. è´§å¸çš„ï¼›é‡‘èçš„\n2. surplus: n. ç”Ÿäº§è¿‡å‰©ï¼›è´¸æ˜“é¡ºå·® adj. è¿‡å‰©çš„ï¼›å‰©ä½™çš„ï¼›å¤šä½™çš„\n3. earmark: v. æŒ‡å®šï¼ˆæ¬¾é¡¹ï¼‰ç”¨é€”ï¼›é¢„å…ˆå®‰æ’ï¼ˆè¦åšçš„äº‹ï¼‰ï¼›ç¡®å®šï¼ˆæœªæ¥å‘ç”Ÿçš„äº‹ï¼‰ n. æ ‡è®°ï¼›ç‰¹å¾\n4. crisis: `/ËˆkraÉªsÉªs/` n. å±æœº\n5. leverage: `/ËˆliËvÉ™rÉªdÊ’/` v./n. æ æ†ä½œç”¨ï¼›å……åˆ†åˆ©ç”¨\n## ä¼ä¸šã€äº§ä¸šã€è¡Œä¸š\n\n1. premises: n. ï¼ˆä¼ä¸šçš„ï¼‰æˆ¿å±‹ï¼›ç»è¥åœºåœ°\n2. estate: `/ÉªËˆsteÉªt/` **n.** åœ°äº§ï¼›è´¢äº§\n3. dismissal: n. è§£é›‡, å¼€é™¤, è§£æ•£, æ’¤èŒ\n    1. Many employees firmly oppose the unfair dismissal and are claiming for **compensation**. è®¸å¤šå‘˜å·¥åšå†³åå¯¹è¿™ç§ä¸å…¬å¹³çš„è§£é›‡ï¼Œå¹¶è¦æ±‚èµ”å¿ã€‚\n    2. dismiss: v. å¯¹...ä¸å±‘ï¼›è§£é›‡...\n4. compensate: v. è¡¥å¿ã€èµ”å¿ï¼›ä»˜æŠ¥é…¬ï¼ˆå°¤æŒ‡ä¼ä¸šä¸­ï¼‰\n    1. compensation: n. èµ”å¿é‡‘ï¼›è–ªé…¬\n5. aviation: n. èˆªç©ºï¼›èˆªç©ºä¸š\n6. entrepreneurial: `/ËŒÉ’ntrÉ™prÉ™ËˆnÉœËriÉ™l/` adj. åˆ›ä¸šçš„ï¼›ä¼ä¸šå®¶çš„ï¼›å…·æœ‰åˆ›ä¸šç´ è´¨çš„\n    1. entrepreneur: `/ËŒÉ’ntrÉ™prÉ™ËˆnÉœË(r)/` n. åˆ›ä¸šå®¶ï¼›æ‰¿åŒ…å•†\n7. syndicate: `/ËˆsÉªndÉªkÉ™t/` n. è´¢å›¢ï¼›ä¼ä¸šè”åˆç»„ç»‡\n8. counterfeit: `/ËˆkaÊŠntÉ™fÉªt/` adj. é«˜ä»¿çš„ v. é«˜ä»¿\n## æ³•å¾‹\n\n1. arbitrator: n. ä»²è£äººï¼›å…¬æ–­äºº\n    1. arbiter: n. ä»²è£äººï¼›å…¬æ–­äººï¼›è£å†³äººï¼›å†³å®šè€…\n2. accuse: v. æŒ‡è´£ï¼Œè°´è´£ï¼›æ§å‘Š\n3. **prosecute**: `/ËˆprÉ’sÉªkjuËt/` vt. æ£€ä¸¾ã€å‘Šå‘æŸäººï¼›ç»§ç»­ä»äº‹(æŸäº‹ç‰©)\n    1. è¯æºï¼šlate Middle English (in sense (3)): from Latin `prosecut- â€˜pursued, accompaniedâ€™`, from the verb `prosequi`, from `pro- â€˜onwardâ€™` + `sequi â€˜followâ€™`. pro(å‘å‰)+secut(è·Ÿéš)+ion(åè¯åç¼€)=èµ·è¯‰ã€åŸå‘Šï¼›å®æ–½ã€ä»äº‹\n    2. prosecution: n. è¯‰è®¼ï¼›åŸå‘Šï¼›å®æ–½ï¼›ä»äº‹\n      He could face prosecution for his role in the robbery. ä»–å¯èƒ½å› å‚ä¸æŠ¢åŠ«è€Œé¢ä¸´èµ·è¯‰ã€‚\n    3. **persecute**: v. è¿«å®³ã€æ®‹å®³ï¼›éªšæ‰°ã€çº ç¼ ã€å›°æ‰°\n        1. persecution: n. è¿«å®³\n    4. indict: `/ÉªnËˆdaÉªt/` vt. æ§å‘Šã€èµ·è¯‰ï¼ˆå¸¸ç”¨äºè¢«åŠ¨ï¼‰ - \"c\"ä¸å‘éŸ³\n        1. indictment: `/ÉªnËˆdaÉªtmÉ™nt/` n. ç¤¾ä¼šçš„è¡°è´¥ã€è…è´¥è¿¹è±¡ï¼›èµ·è¯‰ä¹¦ï¼›æ§å‘Šã€èµ·è¯‰\n4. clause: n. ä»å¥ã€å­—å¥ï¼›ï¼ˆæ³•å¾‹ï¼‰æ¡æ¬¾\n   There is a clause in the contract requiring(è§„å®š) a paid leave. åˆåŒé‡Œæœ‰ä¸€é¡¹æ¡æ¬¾è§„å®šäº†å¸¦è–ªå‡æœŸã€‚\n5. waive: v. `/weÉªv/` æ”¾å¼ƒï¼ˆæƒåˆ©ï¼‰\n    1. waiver: n. å¼ƒæƒå£°æ˜\n    2. wield: v. è¡Œä½¿ã€ä½¿ç”¨ï¼›æ”¯é…ã€æŒæƒ\n6. plaintiff: `/ËˆpleÉªntÉªf/` n. åŸå‘Šï¼›èµ·è¯‰äºº\n    1. plaint: n. è¯‰è‹¦ï¼›æ‚²å¹ - complaint n. ä¸æ»¡ã€æŠ±æ€¨\n7. oblige: `/É™ËˆblaÉªdÊ’/` v. å¼ºåˆ¶\n    1. **obligation: `/ËŒÉ’blÉªËˆÉ¡eÉªÊƒn/` n. ä¹‰åŠ¡ã€èŒè´£**\n    2. eligible: `/ËˆelÉªdÊ’É™bl/` adj. æœ‰èµ„æ ¼çš„\n        1. ineligible: adj. ä¸ç¬¦åˆèµ„æ ¼çš„\n            1. inevitable: `/ÉªnËˆevÉªtÉ™bl/` adj. ä¸å¯é¿å…çš„\n8. jury: n. é™ªå®¡å›¢\n9. mandatory: adj. æ³•å®šçš„ã€ä¹‰åŠ¡çš„ã€å¼ºåˆ¶çš„\n10. infringe: `/ÉªnËˆfrÉªndÊ’/` v. è¿åï¼ˆæ³•å¾‹ï¼‰ï¼›ä¾µçŠ¯\n    1. infringement: `/ÉªnËˆfrÉªndÊ’mÉ™nt/` n. è¿æ³•ï¼›ä¾µæƒ\n    2. fringe: `/frÉªndÊ’/` n. è¾¹ç¼˜ v. æˆä¸º...çš„è¾¹ç¼˜\n11. **liable: `/ËˆlaÉªÉ™bl/` adj. åº”è´Ÿæ³•å¾‹è´£ä»»çš„ï¼ˆè¡¨è¯­ï¼‰ï¼›å¯èƒ½é­å—...çš„**\n    1. **liability: n. è´£ä»»ã€ä¹‰åŠ¡ï¼›å€ºåŠ¡ã€éº»çƒ¦çš„äººæˆ–äº‹**\n12. solicitor: `/sÉ™ËˆlÉªsÉªtÉ™(r)/` n. äº‹åŠ¡å¾‹å¸ˆï¼›åˆçº§å¾‹å¸ˆ\n# -sequent\n\n1. consequently: å› æ­¤\n2. subsequent: adj. éšåçš„ã€ç´§æ¥çš„\n# ä¸“ä¸šã€ä¸“å®¶\n\n1. specification - å…·ä½“çš„è§„åˆ™ã€è§„èŒƒã€è§„æ ¼ã€æ ‡å‡†\n2. specific - adj. æ˜ç¡®çš„ã€å…·ä½“çš„ - specifics n. è¯¦æƒ…ã€ç»†èŠ‚\n3. particular: adj. ä¸“æŒ‡çš„ï¼Œç‰¹å®šçš„ï¼›ç‹¬ç‰¹çš„ï¼Œç‰¹åˆ«çš„ï¼›è®²ç©¶çš„ï¼ŒæŒ‘å‰”çš„ n. ç»†èŠ‚ï¼Œè¯¦æƒ…\n4. specialist - ä¸“å®¶ï¼›ä¸“ç§‘åŒ»ç”Ÿ\n5. expert: n.ä¸“å®¶ adj. ç†Ÿç»ƒçš„ï¼›å†…è¡Œçš„\n    1. expertise: n. ä¸“é•¿ï¼›ä¸“é—¨çŸ¥è¯†ï¼›\n6. amateur: `/ËˆÃ¦mÉ™tÉ™(r)/` adj. ä¸šä½™çš„ n. ä¸šä½™çˆ±å¥½è€…ï¼›ç”Ÿæ‰‹\n    1. layman: `/ËˆleÉªmÉ™n/` n. éä¸“ä¸šäººå‘˜ã€é—¨å¤–æ±‰\n7. veteran: `/'vetÉ™rÉ™n/` n. è€å…µ, è€æ‰‹ adj. (å°¤æŒ‡å†›äº‹æ–¹é¢)è€ç»ƒçš„\n8. exclusive: adj. é«˜çº§çš„ï¼Œå¥¢åçš„ï¼›ä¸“ç”¨çš„ï¼›ç‹¬å®¶çš„ n. ç‹¬å®¶æ–°é—»ï¼Œç‹¬å®¶æŠ¥é“\n    1. exclusivity: n. æ’ä»–æ€§ï¼›ä¸“æœ‰æƒï¼›ç‹¬ç‰¹æ€§\n9. proficient: adj. ç†Ÿç»ƒçš„ï¼›ç²¾é€šçš„\n# é©å‘½ã€é©æ–°ã€ç½¢å·¥: -volve; stri-\n\n1. innovation: n. åˆ›æ–°ï¼Œé©æ–°ï¼›æ–°è§‚å¿µï¼Œæ–°æ–¹æ³•\n2. evolve: v. æ¼”å˜ï¼›è¿›åŒ–\n    1. evolutionary è¿›åŒ–çš„\n3. revolve: v. æ—‹è½¬\n    1. revolutionary é©å‘½æ€§çš„ï¼›åˆ›æ–°çš„\n4. revolt: n./v. å›ä¹±ï¼›åæŠ—\n5. reform: `/rÉªËˆfÉ”Ëm/` n./v. æ”¹é© - reform and opening-up æ”¹é©å¼€æ”¾\n## å·å…¥ã€å¿™äº: involve\n\n1. engaged: ä»äº‹äºã€å¿™äºï¼›è¢«å ç”¨çš„ï¼›è®¢å©šçš„\n2. involved: è¢«å·å…¥çš„ï¼›æ¶‰åŠçš„\n    1. evolve: v. æ¼”å˜ã€å‘å±•ã€è¿›åŒ–\n        1. revolve: vi. æ—‹è½¬\n    2. entail: vt. ä½¿æ‰¿æ‹…ï¼›ç‰µæ¶‰\n        1. retail: n./v. é›¶å”®\n## stri-ã€stro-\n\n1. strive - åŠªåŠ›ã€å¥‹æ–—\n2. strike - å‡»æ‰“ï¼›ç½¢å·¥\n3. stroke: n. (ç–¾ç—…çš„)çªç„¶å‘ä½œï¼›ä¸­é£\n4. stroll: v./n. æ•£æ­¥ï¼›é—²é€›\n# complement - compliment - accomplish - competence - compel - offset\n\n1. **compliment: n. è‡´æ„ã€é—®å€™ï¼›èµç¾ã€ç§°èµ**\n2. complimentary: adj. å…è´¹çš„ã€ï¼ˆä»é—®å€™çš„å¼•ç”³è€Œæ¥ï¼‰èµ é€çš„ï¼›é’¦ä½©çš„ã€èµç¾çš„\n3. æ³¨æ„å’ŒcomplementåŒºåˆ«ï¼šcomplementæ˜¯è¡¥å……ï¼›complementaryæ˜¯è¡¥å……çš„ã€è¡¥è¶³çš„\n    1. åŒä¹‰è¯ï¼šsupplementary - è¡¥å……çš„ï¼›é¢å¤–çš„\n4. completion - n. å®Œæˆã€ç»“æŸ\n5. accomplish: v. å®Œæˆ\n    1. accomplishment - n. æˆå°±, å®Œæˆ, æˆç»©, æŠ€è‰º\n    2. accompany: vt. é™ªä¼´, é™ªåŒï¼›ä¼´éšâ€¦åŒæ—¶å‘ç”Ÿï¼›ä¼´å¥\n    3. complain: v. æŠ±æ€¨\n7. compete: `/kÉ™mËˆpiËt/` vi. ç«äº‰\n    1. competence: `/ËˆkÉ’mpÉªtÉ™ns/` n. èƒ½åŠ›ï¼›èƒœä»»ï¼›ï¼ˆæ³•å¾‹ï¼‰æƒé™ã€ç®¡è¾–æƒ\n        1. competent: adj. æœ‰èƒ½åŠ›çš„ï¼›èƒ½èƒœä»»çš„\n    2. competition: `/ËŒkÉ’mpÉ™ËˆtÉªÊƒn/` n. æ¯”èµ›\n    3. competitive: `/kÉ™mËˆpetÉ™tÉªv/` adj. æœ‰ç«äº‰åŠ›çš„\n    4. competitor: `/kÉ™mËˆpetÉªtÉ™(r)/` n. ç«äº‰è€…\n        1. rival: `/ËˆraÉªvl/` n. ç«äº‰å¯¹æ‰‹\n    5. campaign: `/kÃ¦mËˆpeÉªn/` n. è¿åŠ¨ï¼›æˆ˜å½¹ v. å‚åŠ è¿åŠ¨ï¼›é¢†å¯¼è¿åŠ¨\n    6. vie: `/vaÉª/` vi. æ¿€çƒˆç«äº‰ï¼›äº‰å¤º\n        1. æ³•è¯­ä¸­çš„vieæ˜¯ç”Ÿå‘½çš„æ„æ€ï¼›æ‹‰ä¸è¯­ä¸­æ˜¯vita\n        2. viable: `/ËˆvaÉªÉ™bl/` adj. å¯ç”Ÿå­˜çš„ï¼›å¯è¡Œçš„ = feasible\n            1. early 19th cent.: from French, from `vie` â€˜lifeâ€™, from Latin `vita`.\n    7. contention: `/kÉ™nËˆtenÊƒn/` n. äº‰è®ºï¼›çœ‹æ³•ã€è§‚ç‚¹\n        1. content: n. `/ËˆkÉ’ntent/` å†…å®¹ï¼›ç›®å½• adj./v. `/kÉ™nËˆtent/` æ»¡æ„çš„ã€æ„¿æ„çš„\n        2. contend: `/kÉ™nËˆtend/` vt. å£°ç§°ã€ä¸»å¼ ã€è®¤ä¸ºã€è¾©è®ºï¼ˆçº¦ç­‰äºargueï¼‰ vi. ç«äº‰ã€äº‰å¤º\n8. compel: v. å¼ºè¿«ï¼Œè¿«ä½¿\n    1. compelling: adj. ä¸å¯æŠ—æ‹’çš„ï¼›ä»¤äººä¿¡æœçš„ - compelling reason: å……åˆ†çš„ã€ä»¤äººä¿¡æœçš„ç†ç”±\n    2. camel: n. éª†é©¼\n9. offset: `/ËˆÉ’fset/` v. ç”¨èŠ±è´¹å¼¥è¡¥ã€è¡¥å¿ã€æŠµæ¶ˆ\n# ç²¾ç¡®çš„ã€è¯¦ç»†çš„ã€æ˜ç¡®çš„\n\n1. accurate - ç²¾ç¡®çš„ - accuracy - ç²¾ç¡®åº¦\n2. precise - ç²¾ç¡®çš„ - precision - ç²¾ç¡®åº¦\n3. exact\n4. explicit: `/ÉªkËˆsplÉªsÉªt/` adj. è¯¦è¿°çš„ã€æ˜ç™½çš„ï¼›æ˜¾å¼çš„\n   He gave me very explicit directions on how to get there. ä»–æ¸…æ¥šåœ°å‘æˆ‘è¯´æ˜äº†å»é‚£å„¿çš„è·¯çº¿ã€‚\n    1. implicit: adj. å«è“„çš„ï¼›éšå¼çš„\n        1. **obscure: `/É™bËˆskjÊŠÉ™(r)/` adj. æ¨¡ç³Šçš„ï¼›è´¹è§£çš„ï¼›éšçº¦çš„**\n            1. obscurity: n. é»˜é»˜æ— é—»ï¼›éšæ™¦\n    2. elicit: `/iËˆlÉªsÉªt/` vt. å¼•å‡ºã€è¯±å‡º\n# é‚ªæ¶ã€æš´åŠ›ã€æ¶æ¯’\n\n1. vice: `/vaÉªs/` n. ç¼ºç‚¹ã€æ¶ä¹ ï¼›adj. å‰¯çš„ï¼›ä»£æ›¿çš„\n    1. vicious: `/ËˆvÉªÊƒÉ™s/` adj. æ¶æ¯’çš„ï¼›æš´åŠ›çš„\n2. villain: `/ËˆvÉªlÉ™n/` n. æ¶æ£ï¼›åæ´¾äººç‰©ï¼›ç½ªé­ç¥¸é¦– - ç”±vileå¼•ç”³è€Œæ¥ï¼Œvileæ˜¯å‘é„™æ¶åŠ£çš„æ„æ€\n    1. villainous: `/ËˆvÉªlÉ™nÉ™s/` adj. é‚ªæ¶çš„\n3. riotous: `/ËˆraÉªÉ™tÉ™s/` adj. æš´åŠ›çš„\n4. delinquency: n. è¿æ³•è¡Œä¸º\n    1. delinquent: adj. æœ‰è¿æ³•å€¾å‘çš„ï¼›æ¬ å€ºçš„\n5. fierce: `/fÉªÉ™s/` adj. çŒ›çƒˆçš„ã€å‡¶çŒ›çš„ã€æ®‹æš´çš„\n## å¼ºç›—\n\n1. pirate: æµ·ç›—\n2. bandit: å¼ºç›—ï¼›åœŸåŒª - bandå¸ƒæ¡ï¼Œitåç¼€â€”â€”ç”¨å¸ƒæ¡è’™é¢çš„äºº\n## åˆ›ä¼¤ï¼švulnerable - violent\n\n1. vulner: n. åˆ›ä¼¤ï¼›æ¼æ´\n    1. vulnerate: vt. ä½¿å—ä¼¤\n    2. vulnerable: adj. æ˜“å—åˆ›ä¼¤çš„\n    3. vulnerability: è„†å¼±æ€§ï¼›å¼±ç‚¹ï¼›æ˜“ä¼¤æ€§\n2. injure: v. ä¼¤å®³ï¼›ä½¿å—ä¼¤\n    1. injury: n. æŸä¼¤, æŒ«ä¼¤\n3. impair: vt. æŸå®³ï¼›å‰Šå¼±\n4. violent - æš´åŠ›çš„\n5. vicious: æ¶æ¯’çš„\n# ç›˜é—®ã€ç›‘è§†ã€ç›‘ç£\n\n1. scrutiny: n. ä»”ç»†æ£€æŸ¥ï¼›è®¤çœŸå®¡æŸ¥ï¼›å¯†åˆ‡ç›‘è§†\n    1. censorship: n. å®¡æŸ¥ã€æ£€æŸ¥\n2. supervise: v. ç›‘ç£ï¼›ç®¡ç† - supervision: n. ç›‘ç£ï¼›ç®¡ç†\n3. probe: è¿½ç©¶ã€ç›˜é—®ï¼›è¯¦ç»†è°ƒæŸ¥\n4. supervision: n. ç›‘ç£ï¼›æŒ‡å¯¼ - superviseå¼•ç”³è€Œæ¥ï¼Œå¼ºè°ƒç›‘ç£ã€ç›‘ç®¡åœ°æŒ‡å¯¼ã€‚\n5. ward: n. ç›‘ç£ã€ç›‘è§†ã€ä¿æŠ¤ã€çœ‹æŠ¤ï¼›ç—…æˆ¿\n    1. warder: n. (ç›‘ç‹±çš„)çœ‹å®ˆï¼›ç‹±å\n6. surveillance: `/sÉœËËˆveÉªlÉ™ns/` n. ç›‘è§†ï¼›ç›¯æ¢¢\n# inferior - superior\n\n```\n-iorã€æ‹‰ä¸ã€‘åç¼€ï¼›è¡¨ç¤ºâ€œä¸â€¦â€¦æœ‰å…³â€\nåŒæ ¹è¯inferior|anterior|posterior|excelsior|\ninferã€æ‹‰ä¸ã€‘è¡¨åœ¨â€¦â€¦ä¸‹\nåŒæ ¹è¯inferior|infernal|inferno|inferiority|\n```\n\n1. inferior: `/ÉªnËˆfÉªÉ™riÉ™(r)/` adj. ä¸‹ç­‰çš„ï¼Œè¾ƒå·®çš„ n. çº§åˆ«è¾ƒä½çš„äºº\n    1. be inferior to: æ¯”...ä½çº§\n2. superior: `/suËËˆpÉªÉ™riÉ™(r)/` adj. çº§åˆ«æ›´é«˜çš„ n. ä¸Šçº§ã€ä¸Šå¸\n# æ„Ÿè§‰: tense - sense - absence - caution - casual - discern - sentiment - attend - attract - inspiration - tentative\n\n1. sensation - æ„Ÿè§‰ã€çŸ¥è§‰ï¼›æ„Ÿè§‰åŠ›ã€å¯Ÿè§‰åŠ›ï¼›è½°åŠ¨ã€å“—ç„¶ï¼›å¼•èµ·è½°åŠ¨çš„äººæˆ–äº‹\n    1. sence - n. æ„Ÿè§‰ - sense - v. æ„Ÿè§‰\n    2. sensitivity: n. ä½“è´´ï¼Œå–„è§£äººæ„ï¼›æ•æ„Ÿï¼Œå¤šæ„å–„æ„Ÿï¼›çµæ•åº¦ï¼›è¿‡æ•æ€§\n        1. tentative: adj. ä¸ç¡®å®šçš„ã€ä¸è‚¯å®šçš„ã€æš‚å®šçš„ï¼›è¸Œèº‡çš„ã€çŠ¹è±«ä¸å®šçš„ã€ä¸æœæ–­çš„\n2. **perception** - çŸ¥è§‰ã€æ„Ÿè§‰ï¼›æ´å¯ŸåŠ›ã€è®¤è¯†èƒ½åŠ›ï¼›è§‚å¿µã€çœ‹æ³•ï¼›\n    1. perceive: v. è®¤ä¸ºã€è§†ä¸ºï¼›å¯Ÿè§‰ã€æ„Ÿè§‰\n    2. percent: ç™¾åˆ†æ¯”\n3. absence n. ä¸æ³¨æ„ï¼›ç¼ºä¹ - absent adj. ç¼ºå¸­çš„ï¼›ä¸ç”¨å¿ƒçš„\n    1. presence - å‡ºå¸­\n4. caution: ä¸¥è°¨\n5. casual: `/ËˆkÃ¦Ê’uÉ™l/` adj. æ¼«ä¸ç»å¿ƒçš„ï¼›ä¸æ­£ç»çš„\n    1. **casualty: `/ËˆkÃ¦Ê’uÉ™lti/` n. ä¼¤å‘˜ï¼›å—å®³è€…**\n    2. casualness: `/ËˆkÃ¦Ê’uÉ™lnÉ™s/` n. æ¼«ä¸ç»å¿ƒã€éšæ„\n6. distraction: ä¸æ³¨æ„ï¼›åˆ†å¿ƒ\n7. attend: v. å‚åŠ ï¼›æ³¨æ„ï¼›ç…§æ–™\n    1. attention - æ³¨æ„\n    2. attentive: adj. æ³¨æ„çš„ï¼›ä¸“å¿ƒçš„ï¼›ç•™å¿ƒçš„ï¼›å…³å¿ƒçš„\n8. attraction: n. å¸å¼•\n    1. attributive: adj. å®šè¯­çš„ - attributive clause: å®šè¯­ä»å¥\n        1. attributable: adj. å¯å½’å› äº...ï¼›å¯èƒ½ç”±äº...\n9. preoccupy: `/priËˆÉ’kjupaÉª/` vt. å æ®(æŸäºº)æ€æƒ³ï¼›ä½¿å¯¹â€¦å…¨ç¥è´¯æ³¨ï¼Œä½¿ä¸“å¿ƒäº\n10. disturb - æ‰“æ‰° - disturbance - å¹²æ‰°\n    1. intervene: v. å¹²æ¶‰ï¼›å¹²é¢„ï¼›æ‰“æ–­ - intervention n. å¹²é¢„ï¼›å¹²æ¶‰ï¼›ä»‹å…¥\n    2. interfere - interference: å¹²æ¶‰ã€å¹²é¢„\n        1. interpret: v. è§£é‡Šã€é˜è¿°\n    3. interrupt - interruption: n. æ‰“æ‰°ï¼›æ‰“å²”ï¼›é˜»æ–­ç‰©ï¼›ä¸­æ–­æ—¶é—´\n        1. abrupt: adj. çªç„¶çš„ï¼›é²è½çš„ï¼›ï¼ˆæ–œå¡ï¼‰é™¡å³­çš„ï¼›ï¼ˆæ–‡ç« æˆ–è®²è¯ï¼‰ä¸æµç•…çš„\n        2. internal: adj. å†…éƒ¨çš„ï¼›ç»„ç»‡å†…çš„\n    4. intrusion: `/ÉªnËˆtruËÊ’n/ `n. é—¯å…¥ï¼›ä¾µæ‰°\n      His phone call was an intrusion into a peaceful morning. ä»–çš„ç”µè¯æ‰“ç ´äº†è¿™ä¸ªå®é™çš„æ—©æ™¨ã€‚\n    5. disruption: n. ä¸­æ–­ã€æ‰°ä¹±ï¼›ç ´è£‚\n10. agitation: å¿§è™‘ï¼›çƒ¦ä¹±ï¼›éªšåŠ¨ï¼Œç…½åŠ¨\n11. discern: v. çœ‹å‡ºã€è¯†åˆ«å‡º\n12. sentiment: n. è§‚ç‚¹ï¼›çœ‹æ³•ï¼›æƒ…ç»ªï¼›ï¼ˆè¿‡äºï¼‰ä¼¤æ„Ÿ\n    1. sentimental: adj. æƒ…æ„Ÿçš„ï¼ˆè€Œéç†æ€§çš„ï¼‰, ï¼ˆå¤±ä¹‹è¿‡åº¦æˆ–ä¸æ°å½“åœ°ï¼‰ä¼¤æ„Ÿçš„, å¤šæ„å–„æ„Ÿçš„\n13. concentrate: v. ä¸“å¿ƒäºï¼›å…¨ç¥è´¯æ³¨ï¼›é›†ä¸­ã€èšé›†\n    1. concentration: n. ä¸“å¿ƒã€æ³¨æ„åŠ›ï¼›é›†ä¸­ã€é›†ç»“ï¼›æµ“åº¦ã€å«é‡\n14. inspiration: `/ËŒÉªnspÉ™ËˆreÉªÊƒn/` n. çµæ„Ÿï¼›é¼“èˆï¼›å¦™è®¡\n## -tract-\n\n1. extract: v. æå–ï¼›æç‚¼ï¼›ï¼ˆè´¹åŠ›ï¼‰å–å‡ºï¼›æ±‚æ ¹ n. æå–ç‰©ï¼›æ‘˜å½•\n    1. extration: n. æå–ï¼›å¼€é‡‡ï¼›æç‚¼ï¼›æŠ½å‡ºï¼›æŠ½å‡ºç‰©ï¼›è¡€ç»Ÿã€å‡ºèº«\n2. attract: v. å¸å¼•\n    1. appeal: v. æœ‰å¸å¼•åŠ›ï¼›è¯·æ±‚ã€æ±‚åŠ©ï¼› n. ä¸Šè¯‰ï¼›æ³æ±‚ï¼›å¸å¼•åŠ›ã€è¶£å‘³æ€§\n        1. appease: v. å®‰æŠš\n            1. appeasement: n. å®‰æŠšã€ç»¥é–æ”¿ç­–\n            2. soothe: `/suËÃ°/` v. æŠšæ…°ã€å®‰æ…°ï¼›å‡è½»ç–¼ç—›\n            3. console: `/kÉ™nËˆsÉ™ÊŠl/` v. æŠšæ…°ã€å®‰æ…°\n                1. console: `/ËˆkÉ’nsÉ™ÊŠl/` n. æ§åˆ¶å°\n                2. consolation: `/ËŒkÉ’nsÉ™ËˆleÉªÊƒn/` n. å®‰æ…°\n3. tract: n. å¤§ç‰‡åœŸåœ°\n# ç²¾å¯†ã€å¤æ‚\n\n1. sophistication - n. ç²¾å¯†ã€å¤æ‚ï¼›è€ç»ƒï¼›è¯¡è¾©ï¼›æ¸©æ–‡å°”é›…\n    1. The sophistication of new technologies is growing. æ–°æŠ€æœ¯çš„ç²¾å¯†ç¨‹åº¦åœ¨ä¸æ–­æå‡ã€‚\n    2. sophisticate - v. ä½¿...è€äºä¸–æ•…ï¼Œä½¿å •è½ï¼›ä½¿å¤æ‚ã€ç²¾è‡´ï¼›ä½¿è¿·æƒ‘ï¼ˆè¯¯è§£ï¼‰ï¼›æ›²è§£ã€ç¯¡æ”¹ã€è¯¡è¾© n. è€äºä¸–æ•…çš„äººï¼›ç²¾äº...ä¹‹é“çš„äºº\n        1. distort: v. ä½¿å˜å½¢ï¼›æ‰­æ›²ï¼Œæ­ªæ›²ï¼›æ›²è§£\n            1. distortion: n. æ‰­æ›²ï¼›å˜å½¢ï¼›æ›²è§£ï¼›å¤±çœŸ\n2. elaborate: `/ÉªËˆlÃ¦bÉ™rÉ™t/` adj. å¤æ‚çš„ï¼›è¯¦å°½çš„ï¼›ç²¾å¿ƒåˆ¶ä½œçš„ v. è¯¦å°½é˜è¿°ï¼›è¯¦ç»†æè¿°\n    1. late 16th cent. (in the sense â€˜produced by effort of labourâ€™): from Latin elaborat- â€˜worked outâ€™, from the verb elaborare, from e- (variant of ex-) â€˜outâ€™ + labor â€˜workâ€™.\n    2. elaboration: n. è¯¦ç»†çš„è¯´æ˜ã€æè¿°\n3. meticulous: `/mÉ™ËˆtÉªkjÉ™lÉ™s/` adj. æä»”ç»†çš„; ä¸€ä¸ä¸è‹Ÿçš„\n    1. mid 16th cent. (in the sense â€˜fearful or timidâ€™): from Latin `meticulosus`, from `metus â€˜fearâ€™`. The word came to mean â€˜excessively careful about detailâ€™, hence the current sense (early 19th cent.).\n# tomb - timber\n\n1. tomb - å¢“ç¢‘\n2. timber - æœ¨æ\n    1. boarding: n. æœ¨æï¼›æ¿æ\n# -teur\n\n1. amateur: å¤–è¡Œï¼›ä¸šä½™çˆ±å¥½è€…\n# virtual\n\n1. virtual: adj. è™šæ‹Ÿçš„ï¼ˆåªç”¨åœ¨è®¡ç®—æœºé¢†åŸŸï¼Œå…¶å®å¯ä»¥ç†è§£ä¸ºä»¿çœŸçš„ï¼‰ adj. å®é™…ä¸Šçš„ã€å®è´¨ä¸Šçš„\n2. virtually: adv. å®é™…ä¸Šã€äº‹å®ä¸Šï¼›å‡ ä¹ã€å·®ä¸å¤šï¼ˆå¾ˆå°‘è¢«ç¿»è¯‘ä¸ºè™šæ‹Ÿåœ°ï¼‰\n3. virtue: n. ç¾å¾·ï¼›ä¼˜ç‚¹ï¼›å–„è¡Œ\n# å‡è®¾ - å‡è£…/ä¼ªè£… - è™šå‡\n\n1. presume - å‡è®¾ï¼›å‡å®š - presumably: å¤§æ¦‚ï¼›æƒ³å¿…æ˜¯\n2. assume\n    1. assumption: \n3. suppose\n4. sham - n. v. adj. å‡è£…ï¼›ä¼ªè£…ï¼›å‡è±¡\n5. dummy - v. åšå‡åŠ¨ä½œï¼›n. äººä½“æ¨¡å‹ï¼›ä»¿é€ ç‰©ï¼›adj. å‡çš„\n6. vanity\n    1. è¯æ ¹æ˜¯vainï¼Œå¾’åŠ³çš„\n    2. vanityï¼Œå¾’åŠ³çš„åè¯ï¼Œè™šçš„ï¼Œæ‰€ä»¥æ„æ€æ˜¯è™šè£å¿ƒã€‚\n7. disguise: `/dÉªs'É¡aÉªz/` v. å‡è£…ï¼Œå‡æ‰®ï¼›æ©é¥° n. è£…æ‰®ï¼Œä¼ªè£…\n# æ–‡å­¦ç±»ã€è¯­è¨€ç±»\n\n1. tale - å¯Œå«æƒ³è±¡åŠ›çš„å°æ•…äº‹ï¼›å†é™©è®°ï¼›è®²è¿°\n2. myth: `/mÉªÎ¸/` n. ç¥è¯æ•…äº‹, è’è¯çš„è¯´æ³•\n3. biography - ä¼ è®°\n    1. biographer: n. ä¼ è®°ä½œå®¶\n    2. biology: ç”Ÿç‰©å­¦ - biological: ç”Ÿç‰©å­¦çš„\n        1. organism: n. ç”Ÿç‰©ä½“ã€æœ‰æœºä½“ï¼ˆæˆ‘æ€»æ˜¯è®°æˆâ€œæœºä½“ã€æœºèƒ½â€ï¼‰\n4. novel - é•¿ç¯‡å°è¯´ï¼›æ–°é¢–çš„\n5. textual - æ–‡æœ¬çš„ï¼›ç¯‡ç« çš„ã€‚ä»¥textä¸ºè¯æ ¹ã€‚\n    1. æ³¨æ„å’ŒtextileåŒºåˆ†ï¼Œtextileæ˜¯ç»‡ç‰©ï¼›çººç»‡ä¸š\n6. verbal: adj. å£å¤´çš„, è¨€è¯­çš„, è¯è¯­çš„, å£å¤´ï¼ˆè€Œéä¹¦é¢ï¼‰çš„ n. ã€ˆç¾å£ã€‰å£ä¾›, éé™å®šåŠ¨è¯, ã€ˆç½•ã€‰åŒâ€œverbal nounâ€\n7. clause: n. å­å¥, ä»å¥, åˆ†å¥, ï¼ˆæ³•å¾‹æ–‡ä»¶çš„ï¼‰æ¡æ¬¾\n8. phrase: n. çŸ­è¯­ï¼›ä¹ è¯­ï¼›æªè¾\n    1. phase: `/feÉªz/` n. é˜¶æ®µï¼›æ—¶æœŸï¼›ä½ç›¸ v. åˆ†é˜¶æ®µè¿›è¡Œ\n9. infinitive: n. ï¼ˆåŠ¨è¯çš„ï¼‰ä¸å®šå¼\n    1. finite: adj. æœ‰é™çš„ï¼›é™å®šçš„ n. æœ‰é™ä¹‹ç‰©\n    2. definite: adj. æ˜ç¡®çš„, ç¡®åˆ‡çš„ï¼›ä¸€å®šçš„, è‚¯å®šçš„\n    3. infinite: adj. æ— é™çš„ï¼Œæ— ç©·çš„ï¼›æ— æ•°çš„ï¼›æå¤§çš„ n. æ— é™ï¼›æ— é™çš„ä¸œè¥¿ï¼ˆå¦‚ç©ºé—´ï¼Œæ—¶é—´ï¼‰ï¼›æ— ç©·å¤§\n    4. initial: n. é¦–å­—æ¯ adj. æœ€åˆçš„\n        1. initiative: n. ä¸»åŠ¨æ€§ã€ç§¯ææ€§ï¼›ç§¯æçš„å¯¹ç­–ã€å€¡è®® adj. è‡ªå‘çš„\n           A lot depends on how such monitoring initiatives are communicated and this could prevent possible revolts being staged. è¿™åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºå¦‚ä½•æ²Ÿé€šæ­¤ç±»ç›‘ç£ä¸¾æªï¼Œè¿™å¯èƒ½ä¼šé˜²æ­¢å¯èƒ½ä¸Šæ¼”çš„åæŠ—è¡Œä¸ºã€‚\n            1. motive: n. åŠ¨æœº\n10. intone: v. ç¼“æ…¢åº„é‡åœ°è¯´ - intonation: n. è¯­è°ƒï¼›å£°è°ƒï¼›éŸ³å‡†\n11. aforesaid: adj. å‰è¿°çš„ï¼›ä¸Šè¿°çš„\n12. literary: `/ËˆlÉªtÉ™rÉ™ri/` adj. æ–‡å­¦çš„ï¼›ç²¾é€šæ–‡å­¦çš„ï¼›ä¹¦é¢çš„\n    1. illiteracy: `/Éª'lÉªtÉ™rÉ™si/` n. æ–‡ç›²\n13. preposition: n. ä»‹è¯\n14. brief: adj. ç®€çŸ­çš„ã€ç®€æ´çš„ n. ç®€ä»‹ã€æ‘˜è¦\n    1. brevity: `/ËˆbrevÉ™ti/` n. ç®€ç»ƒï¼›ç®€æ´\n    2. abbreviate: `/É™ËˆbriËvieÉªt/` v. ç¼©ç•¥ï¼›ç¼©å†™\n        1. abbreviation: `/É™ËŒbriËviËˆeÉªÊƒn/` n. ç¼©ç•¥è¯­ï¼›ç¼©å†™è¯\n    3. concise: `/kÉ™nËˆsaÉªs/` adj. ç®€æ´çš„\n15. synonym: `/ËˆsÉªnÉ™nÉªm/` n. åŒä¹‰è¯\n16. metaphor: `/ËˆmetÉ™fÉ”Ë(r)/` n. è±¡å¾ï¼›éšå–»\n    1. metaphorical: adj. éšå–»çš„\n17. rhetorical: `/rÉªËˆtÉ’rÉªkl/` adj. ä¿®è¾æ€§çš„ï¼ˆä¸ªäººç†è§£æ˜¯â€œé˜´é˜³æ€ªæ°”çš„â€ï¼‰\n    1. rhetorical question: åé—®ï¼›è®¾é—®ï¼›ä¿®è¾æ€§ç–‘é—®å¥\n18. narrative: n. å™äº‹ adj. å™äº‹ä½“çš„\n    This novel uses first-person narrative, which quickly brings readers into the story. è¿™éƒ¨å°è¯´è¿ç”¨äº†ç¬¬ä¸€äººç§°çš„å™äº‹æ¨¡å¼ï¼Œèƒ½å¾ˆå¿«æŠŠè¯»è€…å¸¦å…¥åˆ°è¿›æ•…äº‹é‡Œã€‚\n    1. narrate: v. å™è¿°ï¼›è®²æ•…äº‹\n16. satirical: `/sÉ™'tÉªrÉªk(É™)l/` adj. è®½åˆºçš„\n    1. satire: `/ËˆsÃ¦taÉªÉ™(r)/` n. è®½åˆºï¼›è®½åˆºæ–‡å­¦ä½œå“\n        1. satirist: `/'sÃ¦tÉ™rÉªst/` n. è®½åˆºä½œå®¶\n17. prose: `/prÉ™ÊŠz/` n. æ•£æ–‡\n## æè¿°\n\n1. depict: å£å¤´æè¿°\n    1. depiction: n. æå†™\n2. portray: `/pÉ”ËËˆtreÉª/` v. å°¤æŒ‡å°è¯´çš„æè¿°ã€æå†™ï¼›æç»˜\n    1. æ³¨æ„ä¸è¦å’Œâ€œtray - ç›˜å­ã€æ¯ç¢Ÿâ€è®°æ··\n    2. portrayal: `/pÉ”ËËˆtreÉªÉ™l/` n. æè¿°ã€æå†™ã€æç»˜ï¼›å±•ç°æ–¹å¼\n       His latest movie is a grim portrayal of the natural disaster. ä»–æœ€æ–°çš„ç”µå½±æ˜¯å¯¹è‡ªç„¶ç¾å®³çš„æ®‹é…·æç»˜ã€‚\n    3. portrait: `/ËˆpÉ”ËtreÉªt/, /ËˆpÉ”ËtrÉ™t/` n. åŠèº«ç”»åƒï¼›è¯¦ç»†çš„æè¿°ã€æç»˜\n## æ‚²å‰§ã€ç¾éš¾ã€æ··ä¹±: tragedy - tragic\n\n1. tragedy: n. æ‚²å‰§ï¼›ï¼ˆæ–‡å­¦ï¼‰æ‚²å‰§ï¼›ä¸å¹¸ï¼›ç¾éš¾\n    1. tragic: adj. æ‚²å‰§çš„ï¼›æ‚²æƒ¨çš„ï¼›å¯æ‚²çš„\n2. strategy: `/ËˆstrÃ¦tÉ™dÊ’i/` n. ç­–ç•¥\n3. havoc:`/ËˆhÃ¦vÉ™k/` n. æµ©åŠ«ã€ç¾å®³ï¼›å¤§ç ´åã€å¤§æ··ä¹±\n4. turbulent: adj. éªšä¹±çš„\n    1. turbulence: n. åŠ¨è¡ï¼›æ··ä¹±ã€éªšä¹±\n    2. turmoil: n. éªšä¹±ã€æ··ä¹±ï¼›ç„¦è™‘\n5. catastrophe: `/kÉ™ËˆtÃ¦strÉ™fi/` n. ï¼ˆçªå¦‚å…¶æ¥çš„ï¼‰å¤§ç¾éš¾ã€å¤§ç¾ç¥¸\n6. devastate: `/ËˆdevÉ™steÉªt/` v. å½»åº•ç ´åï¼›æ¯ç­\n7. disaster: `/dÉªËˆzÉ‘ËstÉ™(r)/` n. ç¾éš¾\n# æ­éœ²ï¼›æ˜¾éœ²\n\n1. uncover\n2. reveal\n    1. conceal: v. éšè—ï¼›æ©ç›–\n3. expose: `/ÉªkËˆspÉ™ÊŠz/` v. æš´éœ²ã€æ˜¾éœ²ï¼›æ­éœ²ï¼›é¢ä¸´ã€é­å—\n    1. exposition: `/ËŒekspÉ™ËˆzÉªÊƒn/` n. è§£é‡Šã€è¯´æ˜ã€é˜è¿°\n4. emerge: v. å‡ºç°ï¼›æ˜¾éœ²ï¼›å˜å¾—æ˜¾çœ¼ - emergency n. ç´§æ€¥æƒ…å†µ\n   merge, mers-ã€æ‹‰ä¸ã€‘è¡¨ç¤ºâ€œæµ¸æ²¡ï¼Œæµ¸å…¥â€\n   è¯æ ¹åŠ©è®°ï¼šsubmerge:subåœ¨ä¸‹é¢+mergeâ†’æ²‰åˆ°ä¸‹é¢å»\n   åŒæ ¹è¯emergency|submerge|immerse|merge|emergence|merger|submersible|\n    1. submerge: v. æµ¸æ²¡ï¼›æ½œå…¥æ°´ä¸­\n    2. immerse: v. ä½¿æ²‰æµ¸ã€æ·±é™·\n        1. immersion: n. æ²‰æµ¸ï¼›ä¸“å¿ƒ\n        2. immune: adj. å…ç–«çš„\n            1. allergic: adj. è¿‡æ•çš„\n                1. allergy: n. è¿‡æ•ååº”\n5. encounter: v. é­é‡ï¼›ä¸â€¦å‘ç”Ÿå†²çª n. é­é‡ï¼›å†²çª\n    1. em-,en-ã€å¸Œè…Šã€‘è¿›å…¥ï¼Œå‘å†…ï¼›ä½¿æˆä¸º\n       è¯æ ¹åŠ©è®°ï¼šencounter: enè¿›å…¥+ counterå¯¹ç«‹= è¿›å…¥å¯¹ç«‹çŠ¶æ€= é­é‡ï¼Œå†²çª\n       åŒæ ¹è¯encounter|enlighten|\n    2. contra-, contro-, counter, contre-ã€æ‹‰ä¸ã€‘å¯¹ç«‹\n       åŒæ ¹è¯encounter|contradiction|contrast|contradict|counterpart|contradictory|contraband|\n# -rine\n\n1. marine - èˆªæµ·çš„ï¼›èˆ¹èˆ¶çš„ï¼›æµ·äº‹çš„ï¼›æµ·æ´‹çš„ - submarine - æ½œè‰‡\n# æµ·\n\n1. marine: `/mÉ™ËˆriËn/` adj. æµ·æ´‹çš„ï¼›æµ·äº§çš„ã€æµ·ç”Ÿçš„\n    1. maritime: `/ËˆmÃ¦rÉªtaÉªm/` adj. æµ·çš„ã€æµ·äº‹çš„ï¼›èˆ¹çš„\n2. ocean\n    1. oceanic\n3. lieutenant: é™†å†›ä¸­å°‰ï¼›æµ·å†›ã€ç©ºå†›ä¸Šå°‰ã€‚\n4. reef: n. ç¤ã€ç¤è„‰ v. æ”¶å¸†\n5. waterfront: n. æ»¨æ°´åœ°åŒºï¼ˆæ¸¯å£æˆ–æµ·è¾¹ï¼‰ï¼›æ°´è¾¹åœ°\n    1. harbor: n. æ¸¯å£ã€æ¸¯æ¹¾ v. å¿ƒæ€€ï¼ˆæƒ³æ³•æˆ–æ„Ÿæƒ…ï¼‰ï¼›åº‡æŠ¤ã€çªè—\n6. pirate: n. æµ·ç›—; ç›—ç‰ˆè€… v. éæ³•å¤åˆ¶, ç›—å°; æŠ¢æ \n7. vessel: n. èˆ¹ï¼›å®¹å™¨ï¼Œå™¨çš¿ï¼ˆå°¤æŒ‡è£…æ¶²ä½“çš„ï¼Œå¦‚ç¢—ã€æ¡¶ï¼‰ï¼›è¡€ç®¡\n    1. vesselè¡€ç®¡ï¼›arteryåŠ¨è„‰ï¼›veiné™è„‰\n8. hull: `/hÊŒl/` n. èˆ¹ä½“ã€èˆ¹èº«ï¼›å£³\n9. cruise: `/kruËz/` n. èˆªæ¸¸\n# èµèµã€é’¦ä½©\n\n1. admire: `/É™dËˆmaÉªÉ™(r)/` v. é’¦ä½©ã€èµèµã€æ¬£èµ\n    1. admiration: `/ËŒÃ¦dmÉ™ËˆreÉªÊƒn/` n. é’¦ä½©ã€èµèµã€æ¬£èµ\n2. appreciate: `/É™ËˆpriËÊƒieÉªt/` v. å¢å€¼ã€å‡å€¼ï¼›é‡è§†ã€æ¬£èµï¼›æ„Ÿæ¿€ã€æ„Ÿè°¢\n    1. appreciation: `/É™ËŒpriËÊƒiËˆeÉªÊƒn/` n. å¢å€¼ã€å‡å€¼ï¼›é‡è§†ã€æ¬£èµï¼›æ„Ÿæ¿€ã€æ„Ÿè°¢\n    2. depreciate: `/dÉªËˆpriËÊƒieÉªt/` v. è´¬å€¼ï¼›æŠ˜æ—§ï¼›è´¬ä½ã€è½»è§†\n    3. depreciation: `/dÉªËŒpriËÊƒiËˆeÉªÊƒn/` n. è´¬å€¼ï¼›æŠ˜æ—§\n3. acknowledge: æ‰¿è®¤ï¼›å…¬å¼€æ„Ÿè°¢\n4. adore: çˆ±æ…•ã€å´‡æ‹œ\n# æ‰¿è®¤\n\n1. acknowledge\n2. concede: v. æ‰¿è®¤ï¼›å‡ºè®©ï¼›å®¹è®¸\n3. confess: v. æ‰¿è®¤ï¼›å¦ç™½ï¼›å¿æ‚” - confession: n. å¦ç™½ï¼›ä¾›è¯ï¼›è®¤ç½ª\n    1. profess: v. å¦„ç§°ã€ä¼ªç§°ï¼›å®£ç§°ã€å…¬å¼€è¡¨æ˜\n# cogni-\n\n1. cognitive: adj. è®¤çŸ¥çš„ï¼›è®¤è¯†èƒ½åŠ›çš„\n2. recognize: v. è®¤è¯†å‡º - recognition: n. æ‰¿è®¤ï¼Œæ¥å—\n\t1. negative: adj. å¦è®¤çš„ï¼Œæ‹’ç»çš„\n# æ”¶å…»ï¼›åŸ¹å…»\n\n1. foster: v. åŸ¹å…»ã€ç…§æ–™ adj. ä»£å…»çš„, æ”¶å…»çš„\n2. adopt\n3. breed: n. å“ç§; ç±»å‹ v. é¥²å…»; ç¹æ®–; å…»è‚², æ•™è‚²; é…¿æˆ, å¯¼è‡´\n4. nourish: v. æŠšå…»ï¼Œæ»‹å…»ï¼›åŸ¹å…»ï¼ŒåŠ©é•¿\n    1. nourishment: n. è¥å…»ï¼›æ»‹å…»å“ï¼›å…»æ–™\n    2. nurture: `/ËˆnÉœËtÊƒÉ™(r)/` v./n. å…»è‚²ã€åŸ¹è‚²ï¼ˆåå‘äºåå¤©åŸ¹å…»ï¼‰\n       This preoccupation inevitably leads to an old debate: whether nature or nurture moulds us more. è¿™ç§å…³æ³¨ä¸å¯é¿å…åœ°å¯¼è‡´äº†ä¸€åœºç†Ÿæ‚‰çš„è¾©è®ºï¼šå¤©æ€§å’Œåå¤©åŸ¹å…»å“ªä¸€ä¸ªå¡‘é€ æˆ‘ä»¬æ›´å¤šã€‚\n        1. nutrition: `/njuËˆtrÉªÊƒn/` n. è¥å…»\n        2. malnutrition: `/ËŒmÃ¦lnjuËˆtrÉªÊƒn/` n. è¥å…»ä¸è‰¯\n    1. aliment: n. æ»‹å…»å“ï¼›é£Ÿç‰© vt. å‘â€¦æä¾›è¥å…»ç‰©\n    2. varnish: n. æ¸…æ¼†ã€äº®å…‰æ¼†ï¼›å…‰æ³½é¢ v. åœ¨â€¦ä¸Šæ¶‚æ¸…æ¼†ï¼›ä½¿â€¦æœ‰å…‰æ³½\n        1. a liquid that is painted onto wood, metal, etc. and that forms a hard shiny surface that you can see through when it is dry\n        2. Middle English: from Old French `vernis`, from medieval Latin `veronix â€˜fragrant resinâ€™` or medieval Greek `berenikÄ“`, probably from Berenice, a town in Cyrenaica, a region of NE Libya.\n5. propagate: v. ç¹æ®–ï¼›ä¼ æ’­ï¼›å®£ä¼ \n    1. propaganda: n. ï¼ˆæ”¿æ²»ï¼‰å®£ä¼ ï¼›é¼“å¹\n# æ‰§è¡Œ\n\n1. perform\n2. conduct: v./n. å®æ–½ï¼›ä¸¾æ­¢ã€è¡¨ç°ï¼›æŒ‡æŒ¥ï¼ˆéŸ³ä¹ï¼‰ï¼›å¸¦é¢†ï¼Œå¼•å¯¼ï¼›ï¼ˆçƒ­ã€ç”µï¼‰ä¼ å¯¼\n    1. conduction: n. ï¼ˆçƒ­ã€ç”µï¼‰ä¼ å¯¼\n3. execute - execution - executive: adj. è¡Œæ”¿çš„ï¼›ç®¡ç†çš„ï¼›è‘£äº‹\n# è¯´æœã€è¯æ˜ï¼›æ”¯æŒã€åŒæ„ã€è®¸å¯ç±»è¯æ±‡\n\n## probe - probable\n\n1. probable - æˆ‘ä»¬éƒ½å¾ˆç†Ÿæ‚‰ï¼Œæ˜¯â€œå¯èƒ½çš„â€çš„æ„æ€ã€‚\n2. probeæ˜¯probableçš„è¯æ ¹ã€‚å®é™…ä¸Šprobeæ˜¯â€œç›˜é—®ï¼›å¼„æ¸…æ¥šâ€çš„æ„æ€ï¼ˆprobeï¼Œv. ç›˜é—®ã€è¿½é—®ï¼›æ¢æŸ¥ã€æ¢æµ‹ - n. æ¢ç©¶ã€è¯¦ç»†è°ƒæŸ¥ï¼›æ¢é’ˆã€æ¢æµ‹å™¨ï¼‰ï¼Œå› æ­¤å¯ä»¥å¼•ç”³ä¸ºâ€œè¯æ˜æ¸…ç™½â€ã€‚å› æ­¤ï¼Œprobableç›´è¯‘ä¸ºâ€œå¯è¢«è¯æ˜çš„â€ï¼Œå¼•ç”³ä¸ºâ€œå¯èƒ½çš„â€ã€‚\n3. æ›´æ ¹æœ¬çš„ï¼Œ`prob-`åœ¨æ‹‰ä¸è¯­ä¸­è¡¨ç¤ºâ€œè¯šå®ï¼›è¯æ˜ï¼›æ£€éªŒã€æµ‹è¯•â€çš„æ„æ€ã€‚\n4. probing - åˆ¨æ ¹é—®åº•çš„\n5. probity - ç›´è¯‘ä¸ºç»è¿‡è¯•ç‚¼è¯æ˜ - å› æ­¤æ„ä¸ºï¼šæ­£ç›´ã€è¯šå®\n## convince - è¯´æœã€ä¿¡ä»»ã€ä¿¡æœã€ç¡®è®¤ - determine - assure - resolute - credulous - deceit - affirm\n\n1. convince: v. ä½¿...ç›¸ä¿¡ï¼›è¯´æœ...\n    1. convinced: adj. è¢«è¯´æœçš„ï¼›ä¿¡äº†çš„ã€åšä¿¡ä¸ç§»çš„\n    2. convict: v. å®šç½ªï¼›è¯æ˜æœ‰ç½ªï¼ˆå¸¸ç”¨äºè¢«åŠ¨è¯­æ€ï¼‰\n        1. **conviction: n. è¯ç½ªï¼›åšå®šçš„ä¿¡å¿µ**\n2. persuade: v. è¯´æœã€åŠå‘Šï¼›ä½¿ç›¸ä¿¡\n    1. persuasion: n. è¯´æœã€åŠå‘Šï¼›ä¿¡ä»°ã€ä¿¡å¿µ\n    2. persuasive: adj. ä»¤äººä¿¡æœçš„ï¼›èƒ½è¯´ä¼šé“ã€å£æ‰å¥½çš„\n        1. eloquence: `/ËˆelÉ™kwÉ™ns/` n. å£æ‰å¥½\n            1. eloquent: `/ËˆelÉ™kwÉ™nt/` adj. å£æ‰å¥½çš„ã€é›„è¾©çš„\n    3. æ˜“æ··ï¼špursuit: n. è¿½æ±‚ï¼›è¿½èµ¶\n3. determine: v. ä½¿ä¸‹å†³å¿ƒï¼›ç¡®å®š\n4. assure: v. ä¿è¯ã€ç¡®ä¿¡ã€ç¡®ä¿ - assurance\n    1. insurance n. ä¿é™©\n    2. reassure: v. ä½¿â€¦å®‰å¿ƒ, æ‰“æ¶ˆâ€¦çš„ç–‘è™‘\n       reå†æ¬¡+surè‚¯å®š=å†æ¬¡è‚¯å®š=ä½¿å®‰å¿ƒ\n5. resolute: **adj.** åšå†³çš„ï¼›æœ‰å†³å¿ƒçš„\n    1. resolution: n. å†³å¿ƒï¼›è§£å†³ã€å†³è®®ï¼›**åˆ†è¾¨ç‡**\n6. repute: `/rÉªËˆpjuËt/` n. åå£°ï¼›äººä»¬å¯¹æŸä¸ªäººã€ç‰©çš„çœ‹æ³•(opinion)\n    1. reputable: `/ËˆrepjÉ™tÉ™bl/` adj. åå£°å¥½çš„\n7. credulity: n. è½»ä¿¡\n    1. credulous: adj. è½»ä¿¡çš„ï¼›æ˜“å—éª—çš„\n    2. incredulous: adj. ä¸èƒ½ç›¸ä¿¡çš„ï¼›è¡¨ç¤ºæ€€ç–‘çš„\n    3. credit: `/ËˆkredÉªt/` n. æ¬ è´¦ï¼›ä¿¡èª‰ï¼›å­¦åˆ† v. å…è®¸â€¦èµŠæ¬ ï¼›ä¸ºâ€¦æä¾›è´·æ¬¾ï¼›ç»™(å­¦ç”Ÿ)è®°å­¦åˆ†\n        1. creditor: è´·æ–¹\n8. deceit: `/dÉª'siËt/` n. æ¬ºéª—ï¼›è¯¡è®¡ - deceitful: adj. ä¸è¯šå®çš„ï¼›éª—äººçš„\n9. debit: `/ËˆdebÉªt/` n. è´¢åŠ¡è®°å½•ä¸­æ‰€æ¬ æˆ–èŠ±è´¹çš„ä¸€ç¬”é’±çš„ä¹¦é¢è®°å½• v. å½“é“¶è¡Œä»è´¦æˆ·å€Ÿè®°æ¬¾é¡¹æ—¶ï¼Œå®ƒä¼šä»è´¦æˆ·ä¸­æ‰£é™¤æ¬¾é¡¹ - debit card å€Ÿè®°å¡\n10. affirm: v. æ–­è¨€ï¼›è‚¯å®š\n    1. affirmative: adj. è‚¯å®šçš„ï¼›åŒæ„çš„\n11. pledge: `/pledÊ’/` n./v. ä¿è¯ã€æ‰¿è¯º\n## just-\n\n1. `just-`æ‹‰ä¸è¯­ä¸­è¡¨ç¤ºå…¬æ­£çš„\n2. justice - å…¬æ­£ - injustice - ä¸å…¬æ­£\n3. justify - è¯æ˜...æ­£ç¡®ã€æœ‰ç†ï¼›ä¸º...è¾©æŠ¤\n    1. justification - è¾©æŠ¤ï¼›æ­£å½“ç†ç”±\n4. justifiable - adj. åˆç†çš„, æœ‰ç†ç”±çš„, æ— å¯éè®®çš„, æ­£å½“çš„\n    1. legitimate: adj. åˆæ³•çš„ï¼›æ­£å½“åˆç†çš„ v. ä½¿åˆæ³•ï¼›è®¤ä¸ºæ­£å½“\n    2. legislative: `/ËˆledÊ’ÉªslÉ™tÉªv/` adj. ç«‹æ³•æœºå…³çš„\n       a legislative assembly/body/council: ç«‹æ³•è®®ä¼šï¼æœºæ„ï¼å§”å‘˜ä¼š\n        1. legislation: n. ç«‹æ³•\n## å‡†è®¸ã€è®¸å¯ã€åŒæ„ã€æ”¯æŒ\n\n1. verify: v. è¯æ˜ï¼›æ ¸å®ï¼›è¯å®\n2. prove\n3. consent: n./v. åŒæ„ã€å…è®¸\n4. approve - approval: åŒæ„ï¼›è®¤å¯\n5. concur: v. åŒæ„, èµåŒ, æ„è§ä¸€è‡´; åŒæ—¶å‘ç”Ÿ\n6. permit: v. å…è®¸ï¼›è®¸å¯ n. è®¸å¯è¯ï¼›æ‰§ç…§\n    1. permissive: adj. æ”¾ä»»çš„ï¼›çºµå®¹çš„ï¼›å§‘æ¯çš„ï¼›æ”¾çºµçš„\n7. affirmative: adj. è‚¯å®šçš„ï¼›åŒæ„çš„\n8. countenance: n. (formal or literary)é¢å®¹ï¼Œè¡¨æƒ… v. (formal)æ”¯æŒï¼›èµåŒï¼›è®¤å¯\n    1. Middle English: from Old French `contenance â€˜bearing, behaviourâ€™`, from `contenir`, from Latin `continere`, from `con- â€˜altogetherâ€™` + `tenere â€˜to holdâ€™`. The early sense was â€˜bearing, demeanour(ä¸¾æ­¢)â€™, also â€˜facial expressionâ€™, hence â€˜the faceâ€™.\n9. recipient: n. æ¥å—è€…ï¼›é¢†å¥–è€…ï¼›æ¥æ”¶å™¨\n   Bob Dylan is the recipient of the Nobel Prize for Literature in 2016.\n   é²å‹ƒÂ·è¿ªä¼¦æ˜¯2016å¹´è¯ºè´å°”æ–‡å­¦å¥–å¾—ä¸»ã€‚\n   Americans routinely overestimate the share of black recipients of public assistance programs.\n   æ¯”å¦‚ï¼Œç¾å›½äººæ€»æ˜¯é«˜ä¼°å…¬å…±æ•‘åŠ©è®¡åˆ’ä¸­é»‘äººæ¥å—è€…çš„æ¯”ä¾‹ã€‚\n10. endorse: `/ÉªnËˆdÉ”Ës/` v. å…¬å¼€èµåŒã€æ”¯æŒã€è®¤å¯ï¼›å¹¿å‘Šä»£è¨€ã€å®£ä¼ \n    1. endorsement: n. èƒŒä¹¦ï¼›å…¬å¼€æ”¯æŒ\n# è¿½æ±‚ã€åšæŒç±»çš„è¯\n\n1. desire: v./n. æ¸´æœ›\n    1. desirable: adj. ç†æƒ³çš„ï¼›ä»¤äººå‘å¾€çš„\n2. persist: v. åšæŒ\n    1. persist**e**nce: n. åšæŒ\n    2. insist: `/ÉªnËˆsÉªst/` v. åšæŒè¦æ±‚\n3. resist: v. æŠµæŠ—\n    1. resist**a**nce: n.\n    2. counteract: `/kÉ™nËˆspaÉªÉ™(r)/` v. æŠµåˆ¶ã€æŠµæŠ—ï¼›æŠµæ¶ˆ\n4. persevere: `/ËŒpÉœËsÉ™ËˆvÉªÉ™(r)/` v. åšæŒä¸æ‡ˆ\n    1. perseverance: `/ËŒpÉœËsÉ™ËˆvÉªÉ™rÉ™ns/` n. æ¯…åŠ›ã€éŸ§æ€§ï¼›ä¸å±ˆä¸æŒ \n5. sustain: `/sÉ™ËˆsteÉªn/` v. ä¿æŒã€ä½¿æŒç»­ä¸æ–­\n   Earth can sustain life. åœ°çƒèƒ½ç»´æŒç”Ÿå‘½ã€‚\n6. pursue: v. è¿½æ±‚\n    1. pursuit: n. è¿½æ±‚\n7. adhere: vi. é»é™„ã€é™„ç€\n    1. adherence: `/É™dËˆhÉªÉ™rÉ™ns/` n. åšæŒï¼›éµå®ˆã€éµå¾ª\n8. cling: `/klÉªÅ‹/` vi. æŠ“ç´§ã€ç´§æ¡ï¼›ç²˜ä½ã€é™„ç€ï¼›åšæŒã€å¢¨å®ˆ\n# enclosure\n\n1. enclosure: n. åœˆåœ°ï¼›å›´åœºï¼›é™„ä»¶\n    1. enclose: v. å›´ç»•ï¼ŒåŒ…å›´ï¼›æŠŠâ€¦â€¦æ”¾å…¥ä¿¡å°\n## substance\n\n1. substance - ç‰©è´¨ï¼›å®è´¨ï¼›å¤§æ„ã€è¦æ—¨ï¼›æ ¹æ®\n2. substantiate v. è¯å®ï¼›è¯æ˜\n3. substantial: adj. å¤§é‡çš„ã€å¯è§‚çš„ï¼›å®è´¨çš„\n## sway - wag - æ‘‡\n\n1. sway: v. æ‘‡åŠ¨ï¼›ä½¿åŠ¨æ‘‡ï¼›è¯´æœã€ä½¿ç›¸ä¿¡ n. å½±å“ï¼›åŠ¨æ‘‡ï¼›ç»Ÿæ²»\n    1. sway=influence(å½±å“)\n2. wag: v. æ‘‡åŠ¨ï¼›æ‘†ï¼ˆå°¾å·´ï¼‰ï¼Œï¼ˆå°¾å·´ï¼‰æ‘‡ï¼Œæ‘†åŠ¨ n. æ‘‡æ‘†ï¼Œæ‘†åŠ¨ï¼›è€å¼€ç©ç¬‘çš„äººï¼Œçˆ±é—¹ç€ç©çš„äºº\n# ç¢°æ’ã€å†²çª\n\n1. crash: ç¢°æ’\n2. clash: å†²çªã€äº¤é”‹\n3. collide: `/kÉ™ËˆlaÉªd/` v. ç¢°æ’ï¼›ç›¸æ’ï¼›ä¸¥é‡ä¸ä¸€è‡´ï¼›æŠµè§¦ - collision: n. ç¢°æ’ï¼›å†²çª\n    1. collapse: v./n. å´©å¡Œï¼›æŠ˜å \n        1. collaborate: v. åˆä½œï¼›åä½œï¼›å‹¾ç»“ã€é€šæ•Œ - collaboration n. åˆä½œï¼›åä½œï¼›é€šæ•Œè¡Œä¸º\n4. conflict\n    1. inflict: vt. ä½¿...é­å—ï¼ˆä¸å¿«ã€ç—›è‹¦ï¼‰\n5. bump: n. ç¢°æ’ï¼›éš†èµ·ã€è‚¿å— v. ç¢°æ’ï¼›é¢ ç°¸è€Œè¡Œ\n    1. pump: n./v. æ³µ\n6. clash: `/klÃ¦Êƒ/` n./vi. å†²çªï¼›äº‰è®º\n# æŠ“ã€æŒ ã€å’¬\n\n1. gnaw: è€é¼ ä¼¼çš„å•ƒå’¬ï¼›æŠ˜ç£¨ - nibble: v. ä¸€ç‚¹ç‚¹åœ°å’¬ n. ä¸€å°å£ï¼›ç‚¹å¿ƒ - ripple: æ¶Ÿæ¼ªã€æ°´çº¹\n2. bite: ç‹—å’¬\n3. sting: èšŠå­å’¬\n4. peck: é¸Ÿå•„\n## scrap - scrub - crack - scratch - crash - crush - cricket - stab - snatch - smack - snap - spur - scotch - scorch - squash - stitch - scramble - rash - staple - ditch\n\n1. scrap: n. ç¢ç‰‡ï¼›ä¸æ¯« v. å–æ¶ˆ\n    1. scrub: v. æ“¦æ´—ã€åˆ·æ´—\n2. crack: ç ´è£‚\n3. scratch: æŠ“æŒ \n4. itch: ä½¿...å‘ç—’\n    1. tickle: v./n. æŒ ç—’ç—’ï¼›æ„Ÿåˆ°å‘ç—’\n    2. tackle: vt. å¤„ç†ã€è§£å†³ï¼ˆéš¾é¢˜ã€å±€é¢ï¼‰\n        1. reckon: vt. è®¤ä¸ºï¼›æŠŠ...å½“ä½œï¼›**ä¼°ç®—**\n            1. beckon: `/ËˆbekÉ™n/` v. æ‹›æ‰‹ç¤ºæ„ï¼›å¸å¼•ã€è¯±æƒ‘\n               The man beckoned the waitress to his counter. ç”·äººæ‹›æ‰‹ç¤ºæ„æœåŠ¡å‘˜åˆ°ä»–çš„æŸœå°å‰æ¥ã€‚\n            2. reckless: `/ËˆreklÉ™s/` adj. æ— æ‰€é¡¾å¿Œçš„ï¼›ä¸è®¡åæœçš„\n        2. sparkle: n./v. é—ªå…‰ã€é—ªçƒã€é—ªè€€\n            1. spark: ç«æ˜Ÿï¼›è¯±å› ã€å¯¼ç«çº¿\n        3. formidable: `/fÉ™ËˆmÉªdÉ™bl/,` adj. éš¾å¯¹ä»˜çš„\n5. crash: ç¢°æ’\n    1. collide: v. ç¢°æ’ï¼›ç›¸æ’ï¼›ä¸¥é‡ä¸ä¸€è‡´ï¼›æŠµè§¦ - collision: n. ç¢°æ’ï¼›å†²çª\n    2. rash: adj. é²è½çš„ n. ä¸€è¿ä¸²ã€å¤§é‡ï¼›ç–¹å­\n6. crush: å‹ç¢ã€å‹æ‰ï¼›æš—æ‹ã€è¿·æ‹\n7. cricket: æ¿çƒè¿åŠ¨ï¼›èŸ‹èŸ€ - not cricket: ï¼ˆå£ï¼‰ä¸å…¬å¹³ã€ä¸æ­£å½“\n8. stab: v. åˆºã€æˆ³\n    1. prick: v. æˆ³ã€åˆºï¼›æ‰ n. è ¢è´§ï¼›ç¬¨è›‹\n9. snatch: v. ä¸€ä¸‹å¤ºå», æŠ¢èµ° n. ç‰‡æ®µï¼›åªè¨€ç‰‡è¯­\n10. smack: v. ç”¨å·´æŒæ‰“ n. æ‹å‡»(å£°) adv. ç›´æ¥åœ°ï¼›çŒ›çƒˆåœ°\n    1. smack one's lips: ä¸æ˜¯æ‰‡æŸäººçš„å˜´å·´ï¼Œè€Œæ˜¯å’‚å’‚å˜´\n       lick one's lips: å‚æ¶ä¸‰å°º\n11. snap: v. çªç„¶æŠ˜æ–­ï¼›çªç„¶ç”Ÿæ°”ï¼›çªç„¶å‘ä½œï¼›çªç„¶ç§»åŠ¨ï¼›ç °ç„¶å…³ä¸Šï¼›çŒ›å’¬ï¼›å‰å£°è¯´\n12. spur: v./n. åˆºæ¿€ï¼›æ¿€åŠ±ï¼›é­ç­–\n13. scotch: v. ä½¿...ç»“æŸï¼›æ‰‘ç­ï¼›é•‡å‹ adj. (å¤§å†™Scotch)è‹æ ¼å…°çš„\n14. scorch: v. çƒ§ç„¦ï¼›æ¯è\n15. squash: `/skwÉ’Êƒ/` vt. å‹æ‰ï¼Œå‹çƒ‚ï¼ŒæŒ¤ç¢\n16. stitch: v./n. ç¼è¡¥ï¼›ç¼åˆ n. é’ˆè„š\n17. scramble: v./n. æ”€çˆ¬ï¼›äº‰æŠ¢ï¼›å¿™ä¹±\n18. staple: `/ËˆsteÉªpl/` adj. ä¸»è¦çš„ã€é‡è¦çš„ n. è®¢ä¹¦é’‰ v. ç”¨è®¢ä¹¦é’‰è£…è®¢\n19. ditch: v. æŠ›å¼ƒã€æ‹œæ‰˜\n    She couldn't stand her boyfriend anymore so she ditched him. å¥¹å†ä¹Ÿå¿å—ä¸äº†å¥¹ç”·æœ‹å‹äº†ï¼Œäºæ˜¯å°±æŠŠä»–ç”©äº†ã€‚\n# ç¢ç‰‡ã€æ¡\n\n```\nfrag-, frang-, fract-, fring-ã€æ‹‰ä¸ã€‘è¡¨ç¤ºâ€œå¼„æ–­â€ï¼›â€œç ´ç¢çš„â€\n```\n\n1. fraction: n. ä¸€å°ç‚¹å„¿ï¼›ç¢ç‰‡\n    1. friction: n. æ‘©æ“¦\n    2. fracture: v./n. æ–­è£‚ï¼›ç ´è£‚\n2. strip: n. æ¡ã€å¸¦ï¼›é™¤å»ï¼›å‰¥å¤º\n    1. strand: n. ï¼ˆçº¿ã€ç»³ï¼‰è‚¡ï¼Œç¼• v. ä½¿æ»ç•™ï¼›ä½¿ææµ…\n3. rag: n. æŠ¹å¸ƒã€ç ´å¸ƒ\n    1. ragged: adj. è¡£è¡«è¤´è¤›çš„\n4. slit: n. ç‹­ç¼ï¼Œè£‚ç¼ï¼›ç‹­é•¿åˆ‡å£ v. åˆ‡å¼€ï¼Œåˆ’å¼€ï¼Œæ’•å¼€ï¼Œåˆ’ç ´\n    1. stab: v. åˆºï¼Œæˆ³\n    2. slot: n. ç©ºä½ï¼›æ’æ§½ã€æ§½ä½ï¼›ï¼ˆèŠ‚ç›®è¡¨çš„ï¼‰ä¸€æ¡£ä½ç½® v. æ’å…¥ã€å¡å…¥\n5. slice: n. è–„ç‰‡ã€åˆ‡ç‰‡ï¼›åˆ‡å¼€ã€åˆ’ç ´\n6. fragile: `è‹±ï¼š/ËˆfrÃ¦dÊ’aÉªl/ ç¾ï¼š/ËˆfrÃ¦dÊ’l/` adj. æ˜“ç¢çš„\n    1. fragility: `/frÉ™ËˆdÊ’ÉªlÉ™ti/` n. è„†å¼±ï¼›è„†æ€§\n    2. delicate\n        1. delicacy: `/ËˆdelÉªkÉ™si/` n. è„†å¼±ï¼›å°å¿ƒã€æ¸©æŸ”ã€å‘¨åˆ°ã€ä½“è´´ï¼›æ£˜æ‰‹ã€å¾®å¦™\n    3. fragment\n        1. segment: n. æ®µï¼›ç‰‡\n7. scrap: n. ç¢ç‰‡ã€ä¸æ¯«ï¼›å–æ¶ˆ\n8. debris: `/ËˆdebriË/` n. ç¢ç‰‡ï¼›æ®‹éª¸ - ç»“å°¾`s`ä¸å‘éŸ³\n## rip - lip\n\n1. rip:`/rÉªp/ ` v. æ’•ç ´ï¼›çŒ›åœ°æ‰¯å¼€ï¼›çªç„¶æ‹‰å¼€ n. æ’•å¼€çš„å¤§å£å­\n    1. ripe:`/raÉªp/` adj. æˆç†Ÿçš„ - ripen:`/ËˆraÉªpÉ™n/` v. ä½¿æˆç†Ÿ\n2. lip: æœ‰å°ç¼çš„å”‡\n# fr-\n\n## frugal\n\n1. frugal: adj. èŠ‚ä¿­çš„ï¼›ï¼ˆå¯¹é‡‘é’±ã€é£Ÿç‰©ç­‰ï¼‰èŠ‚çº¦çš„ï¼›ç®€å•å»‰ä»·çš„\n# -rain: refrain - strain - constrain - drain\n\n1. refrain: v. å…‹åˆ¶ï¼›èŠ‚åˆ¶ï¼›é¿å… n. å‰¯æ­Œï¼›è¿­æ­Œï¼›è¿­å¥\n    1. refrain from doing ... èŠ‚åˆ¶åš...\n2. strain: v./n. æ‹‰ä¼¤ï¼›å‹åŠ›è¿‡å¤§\n3. constrain: v. å¼ºè¿«ï¼›é™åˆ¶\n    1. constrict: v. ï¼ˆä½¿ï¼‰ç´§ç¼©ï¼›é™åˆ¶ã€çº¦æŸ\n    2. restrict: v. é™åˆ¶ï¼›æŸç¼šã€é˜»ç¢\n    3. confine: v. ï¼ˆå¸¸ç”¨äºè¢«åŠ¨ï¼‰é™åˆ¶ï¼›ç›‘ç¦ã€ç´§é—­\n        1. confinement: n. ç¦é—­ã€å…³æŠ¼ã€ç›‘ç¦\n        2. custody: `/ËˆkÊŒstÉ™di/` n. ç›‘æŠ¤ã€ä¿ç®¡ï¼›æ‹˜ç•™ã€ç¾æŠ¼\n4. drain: v. æµå¹²\n# -athe\n\n1. bathe - bathroomçš„è¯æ ¹ã€‚ç”¨æ°´æ¸…æ´—ï¼ˆæ´—æ¾¡ï¼‰ï¼›æ¸¸æ³³ã€‚\n2. lathe: æœºåºŠï¼›ç”¨æœºåºŠåŠ å·¥\n# -stitute: ç»„æˆï¼›æ›¿ä»£ç‰©\n\n1. constitute - ç»„æˆã€æ„æˆï¼›æˆç«‹ã€è®¾å®š\n    1. constituent: adj. ç»„æˆçš„ã€æ„æˆçš„ï¼›ä»»å‘½çš„ã€é€‰ä¸¾çš„ï¼›n. ç»„æˆéƒ¨åˆ†ã€æˆåˆ†ï¼›é€‰æ°‘\n    2. constitution: ç»„ç»‡ï¼›å®ªæ³•\n2. substitute: n. æ›¿ä»£ç‰© v. ç”¨...æ›¿ä»£\n# counsel: å’¨è¯¢\n\n1. counsel: å°¤æŒ‡æ³•å¾‹é¡¾é—®ã€‚\n# å®˜èŒ\n\n1. lieutenant: é™†å†›ä¸­å°‰ï¼›æµ·å†›ã€ç©ºå†›ä¸Šå°‰\n2. errand: `/ËˆerÉ™nd/` n. å·®äº‹ï¼›è·‘è…¿ - çº¦ç­‰äºtrip\n    1. errant: `/ËˆerÉ™nt/` adj. è¡Œä¸ºä¸å½“çš„ã€å‡ºæ ¼çš„ï¼›å‡ºè½¨çš„ã€åç¦»æ­£è·¯çš„ï¼›è¿·é€”çš„\n    2. appointment: n. ä»»å‘½ï¼›å§”æ´¾ï¼›çº¦ä¼šï¼›é¢„çº¦\n# è£…é¥° - decorate - adorn\n\n1. adorn\n    1. adore: çˆ±æ…•ã€å´‡æ‹œ\n2. decorate: v. è£…é¥°ï¼Œè£…ä¿®\n# ç‰¹æœ‰æˆ–å¸¸è§ç‰©ä½“\n\n1. marble: n. å¤§ç†çŸ³\n## ä¸å¸¸è§çš„è¯ä½†å¯èƒ½ä¼šå¸¸è¯´çš„è¯\n\n1. ailment: n. å°ç—…ã€ä¸é€‚\n    1. ail: v. å›°æ‰°ï¼›å¹²æ‰°\n    2. aliment: n. æ»‹å…»å“ï¼›é£Ÿç‰© vt. å‘â€¦æä¾›è¥å…»ç‰©\n    3. nausea: n. æ¶å¿ƒï¼›åèƒƒï¼›ä½œå‘•\n2. tan: v. æ™’é»‘ adj. æ™’é»‘çš„ n. æ™’é»‘çš„çš®è‚¤\n3. dwarf: n. å°çŸ®äººï¼›ä¾å„’ adj. çŸ®å°çš„ v. ä½¿æ˜¾å¾—çŸ®å°ï¼Œä½¿ç›¸å½¢è§ç»Œ\n    1. awkward: adj. ç¬¨æ‹™çš„ï¼›å°´å°¬çš„ï¼›æ£˜æ‰‹çš„ï¼›ä¸åˆé€‚çš„\n    2. cowardly: adj. æ€¯æ‡¦çš„\n4. pest: n. å®³è™«ï¼›è®¨åŒçš„äººï¼ˆæˆ–ç‰©ï¼‰\n5. tyre: è½®èƒ\n6. quota: é…æ¯”ï¼›å®šé¢ã€é…é¢\n## ç”Ÿæ´»ç”¨å…·\n\n1. thermometer: `/Î¸É™ËˆmÉ’mÉªtÉ™(r)/` n. æ¸©åº¦è®¡ï¼›ä½“æ¸©è®¡\n2. barometer: n. æ°”å‹è®¡\n## ç”Ÿæ´»ç”¨å“ï¼šé¤å…·ã€å®¹å™¨\n\n1. tray: ç›˜å­ã€æ¯ç¢Ÿ\n2. plate: ç›˜å­\n3. lid: n. ç›–å­ï¼›çœ¼ç‘ v. ç»™è£…ç›–å­\n    1. hamper: n. å¸¦ç›–å­çš„å¤§ç¯®å­ v. é˜»ç¢\n4. pot: n. é”…ï¼›ç½ï¼›ç›†\n5. frying-pan: n. ç…é”…ï¼›é•¿æŸ„å¹³é”…\n6. pail: n. æ¡¶ï¼›ä¸€æ¡¶çš„é‡\n7. cuisine: `/kwÉªËˆziËn/` n. çƒ¹é¥ªï¼Œèœè‚´ï¼›é£å‘³\n   The hotel restaurant is noted for its excellent cuisine. è¿™å®¶é¥­åº—çš„é¤å…ä»¥ç¾å‘³ä½³è‚´é—»åéè¿©ã€‚\n8. chef: ä¸»å¨ - chief: æœ€é«˜çš„ï¼ˆCEOçš„Cï¼‰\n9. hospitality: n. å¥½å®¢ã€æ®·å‹¤ï¼›ï¼ˆæ¬¾å¾…å®¢äººçš„ï¼‰é¤é¥®ã€æœåŠ¡\n\t1. hostile: æ•Œæ„\n11. basin: n. è„¸ç›†\n12. seal: v./n. å¯†å°\n    1. seam: `/siËm/` n. æ¥ç¼ï¼›çŸ¿å±‚ã€ç…¤å±‚\n## å®¶çººã€å®¶å…·ã€å®¶å±…\n\n1. blanket: æ¯¯å­\n2. rug: n. å°åœ°æ¯¯\n3. couch: n. é•¿æ²™å‘; é•¿æ¤…\n4. mat: n. å«å­\n5. curtain: n. çª—å¸˜ï¼›é—¨å¸˜\n6. pillar: n. ï¼ˆå°¤æŒ‡è£…é¥°çš„ï¼‰æ”¯æŸ±ã€æŸ±çŠ¶ç‰© v. ç”¨æŸ±å­è£…é¥°\n7. furniture: n. å®¶å…· - a piece of furniture\n8. knit: v. ç¼–ç»‡ï¼ˆè¡£ç‰©ã€æ¯¯å­ï¼‰ï¼›ä½¿å›¢ç»“ã€è”åˆ\n    1. knitting: n. é’ˆç»‡å“ã€ç¼–ç»‡ç‰©\n9. balcony: `/ËˆbÃ¦lkÉ™ni/` n. é˜³å°ï¼›æ¥¼å°\n## å†œä¸šå·¥å…·\n\n1. rake: `/reÉªk/` n./v. è€™ã€è€™çŠ¶å·¥å…·\n    1. rakish: `/ËˆreÉªkÉªÊƒ/` adj. ï¼ˆå½¢å®¹ç”·ï¼‰æ”¾è¡çš„ã€è‚†æ— å¿Œæƒ®çš„\n2. shovel: `/ËˆÊƒÊŒvl/` n. é“²\n    1. shove: `/ÊƒÊŒv/` v./n. çŒ›æ¨ï¼›ä¹±æŒ¤\n3. bait: n. è¯±é¥µï¼›é±¼é¥µ vt. å¼•è¯±\n4. crop: n. åº„ç¨¼ï¼›ä½œç‰© v. è£åˆ‡\n5. grain: è°·ç‰©ï¼›é¢—ç²’çŠ¶çš„ä¸œè¥¿\n    1. particle: n. é¢—ç²’ï¼›å¾®ç²’ï¼›æå°‘é‡\n    2. corn: n. ç‰ç±³, (è„šä¸Šçš„)é¸¡çœ¼ï¼›è°·ç‰© v. è…Œï¼›ä½¿æˆé¢—ç²’\n        1. maize: `/meÉªz/` n. ç‰ç±³\n6. fodder: n. è‰æ–™ï¼›é¥²æ–™\n    1. hay: n. ï¼ˆç”¨ä½œé¥²æ–™çš„ï¼‰å¹²è‰ï¼Œè‰æ–™\n7. furrow: v. çŠï¼›ï¼ˆä½¿ï¼‰çš±ï¼ˆçœ‰ï¼‰ n. æ²Ÿï¼›çŠæ²Ÿï¼›è½¦è¾™ï¼›çš±çº¹\n    1. wrinkle: n. è„¸ä¸Šçš„çš±çº¹ï¼›çš±è¤¶ï¼Œçš±ç—• v. èµ·çš±çº¹ï¼›çš±èµ·ï¼›ï¼ˆä½¿ï¼‰èµ·çš±è¤¶\n       She wrinkles her brow since she can't understand this question. å¥¹çœ‹ä¸æ‡‚è¿™ä¸ªé—®é¢˜ï¼Œä¾¿çš±èµ·äº†çœ‰(brow)ã€‚\n8. pole: n. æ†å­ï¼›åœ°æï¼›ç£æ\n    1. a tent pole å¸ç¯·æ”¯æŸ±ï¼›South Pole å—æ North Pole åŒ—æ\n    2. polar: adj. ä¸¤æçš„ï¼›æåœ°çš„ï¼›å®Œå…¨å¯¹ç«‹çš„ï¼›æˆªç„¶ä¸åŒçš„\n    3. polarity: n. æˆªç„¶å¯¹ç«‹ï¼›ä¸¤æåŒ–ï¼›ææ€§\n9. sickle: n. é•°åˆ€\n10. poultry: `/'pÉ™ÊŠltri/` n. å®¶ç¦½ï¼›ç¦½è‚‰\n## ç‰§ä¸š\n\n1. ranch: `/rÉ‘ËntÊƒ/` n. å¤§ç‰§åœºï¼›å¤§é¥²å…»åœº\n## å·¥ä¸šç”Ÿäº§ç”¨å…·ã€å·¥å…·\n\n1. gear: n. é½¿è½®ä¼ åŠ¨è£…ç½®ï¼›v. ç”¨é½¿è½®è¿æ¥\n2. hinge: n. é“°é“¾ã€åˆå¶ v. ç»™...è£…ä¸Šé“°é“¾ - unhinge: v. ä½¿ç²¾ç¥å¤±å¸¸é”™ä¹±\n    1. hinge on å–å†³äº...\n    2. linger: `/ËˆlÉªÅ‹É¡É™(r)/` vi. å¾˜å¾Šï¼›ç£¨è¹­ï¼›ä½™éŸ³ç»•æ¢ã€ä»æœ‰é˜´å½±\n       Is the lingering shadow of the global financial crisis making it harder to accept extravagant indulgences? å…¨çƒé‡‘èå±æœºæ®‹ä½™çš„é˜´å½±æ˜¯å¦æ­£åœ¨ä½¿äººä»¬æ›´éš¾æ¥å—å¥¢ä¾ˆçš„æ”¾çºµ?\n3. valve: é˜€é—¨\n4. adhesive: `/É™d'hiËsÉªv/` n. é»åˆå‰‚, é»ç€å‰‚ adj. é»åˆçš„, é»é™„çš„, æœ‰é™„ç€åŠ›çš„\n5. utensil: n. å™¨å…·ï¼›ç”¨å…·\n6. catalyst: n. å‚¬åŒ–å‰‚ï¼›åˆºæ¿€å› ç´ ï¼›ä¿ƒä½¿å› ç´  - catalytic: adj. èµ·å‚¬åŒ–ä½œç”¨çš„\n7. hose: è½¯ç®¡\n8. bolt: n. èºæ “ï¼›æ’é”€ï¼›é—¨é—© v. ç”¨é—©ã€èºæ “å›ºå®š...\n   I closed the door and drew the bolt. æˆ‘å…³ä¸Šé—¨ï¼Œæ‹‰ä¸Šäº†æ’é”€ã€‚\n9. gauge: `/É¡eÉªdÊ’/` n. æµ‹é‡ä»ªå™¨ï¼›å®½åº¦ã€åšåº¦ã€å°ºåº¦ v. æµ‹é‡ï¼›åˆ¤æ–­\n## å¤©æ°”ç°è±¡\n\n1. mist: è–„é›¾ï¼›fog: æµ“é›¾ï¼›smog: é›¾éœ¾ã€çƒŸé›¾\n    1. frog: n. é’è›™\n2. frost: ç»“éœœ\n    1. condense: `/kÉ™nËˆdens/`v. å‹ç¼©ï¼›å†·å‡ã€å‡ç»“\n        1. condensation: n. å‡ç»“çš„æ°´ç ï¼›ä¹¦çš„ç®€ç¼©ç‰ˆ\n3. melt: èåŒ–\n4. hail: `/heÉªl/` n. å†°é›¹ vt. å‘...æ¬¢å‘¼ï¼›ä½¿åƒä¸‹é›¹æ ·è½ä¸‹ int. æ¬¢è¿ï¼›ä¸‡å²\n## æ¤ç‰©ã€æ ‘\n\n1. oak: æ©¡æ ‘\n2. maple: æ«æ ‘\n## é£Ÿç‰©ã€é…±\n\n1. sauce: é…±\n2. mustard: èŠ¥æœ«\n3. jelly: n. æœå†»ï¼›èƒ¶å‡ç‰© v. ä½¿å‡æˆèƒ¶çŠ¶ - jellied: adj. èƒ¶å†»çŠ¶çš„\n\t1. jellyfish æ°´æ¯ï¼›æµ·èœ‡\n\t2. royal jelly èœ‚ç‹æµ†\n4. powder: ç²‰æœ« - chilli powder: è¾£æ¤’ç²‰\n    1. ponder: v. æ²‰æ€ï¼›ç¢ç£¨ï¼›è€ƒè™‘\n        1. fond: adj. å–œæ¬¢çš„ï¼›æ¸´æœ›çš„\n            1. fonderï¼ˆæ¯”è¾ƒçº§ï¼‰\n                1. ponder: v. ç¢ç£¨\n5. yeast: n. é…µæ¯ï¼›é…µæ¯èŒ\n6. vinegar: `/'vÉªnÉªÉ¡É™(r)/` n. é†‹\n7. dough: é¢å›¢\n    1. flour: é¢ç²‰\n8. recipe: `/ËˆresÉ™pi/` n. é£Ÿè°±ï¼›çƒ¹é¥ªæ³•\n    1. recite: `/rÉªËˆsaÉªt/` v. èƒŒè¯µï¼›é€ä¸€åˆ—ä¸¾\n        1. cite: v. å¼•ç”¨ï¼›ä¸¾ä¾‹\n        2. rehearse: `/rÉªËˆhÉœËs/` v. æ’ç»ƒï¼›é»˜é»˜ç»ƒä¹ \n## ä¹å™¨\n\n1. flute: é•¿ç¬›\n## çº¤ç»´ã€çººç»‡å“ã€å¸ƒæ–™\n\n1. fiber = fibre: çº¤ç»´ç´ \n2. fabric: ç»‡ç‰©ï¼›ç»“æ„\n3. textile: çººç»‡ä¸šï¼›ç»‡ç‰©ï¼›çººç»‡å“\n4. linen: `/ËˆlÉªnÉªn/` adj. äºšéº»åˆ¶çš„ n. äºšéº»ç»‡å“ï¼›äºšéº»å¸ƒ\n    1. liner: `/ËˆlaÉªnÉ™(r)/` n. å®¢è½®\n        1. linear: `/ËˆlÉªniÉ™(r)/` adj. çº¿æ€§çš„\n## è¡£ç‰©ã€é’±åŒ…\n\n1. blouse: å¥³è¡¬è¡£\n2. purse: å¥³é’±åŒ…\n3. cloak: n. æŠ«é£ï¼Œæ–—ç¯·ï¼›é®ç›–ç‰© v. é®ç›–ï¼›æ©ç›–\n4. mitten: n. è¿æŒ‡æ‰‹å¥—\n5. sweater: æ¯›è¡£\n6. scarf: n. å›´å·¾, å¤´å·¾, æŠ«å·¾\n## ææ–™ã€ç‰©è´¨\n\n1. material: ææ–™ï¼›ç‰©è´¨çš„ - raw material åŸææ–™\n    1. substance: å®è´¨ï¼›å¤§æ„ã€è¦æ—¨ï¼›æ ¹æ®\n        1. substantiate v. è¯å®ï¼›è¯æ˜\n2. leather: çš®é©ï¼›feather: ç¾½æ¯›\n    1. fleece: n. ï¼ˆç›¸å¯¹äºwoolï¼ŒæŒ‡å¤„ç†å‰çš„ï¼‰ç¾Šæ¯›, ï¼ˆä¸€åªç¾Šä¸€æ¬¡å‰ªä¸‹çš„ï¼‰æ¯›, ç¾Šæ¯›çŠ¶ç»‡ç‰©, ç»’å¤´ç»‡ç‰©çŸ­ä¸Šè¡£ v. æ•²è¯ˆ, æ•²ç«¹æ \n3. foam: æ³¡æ²«ææ–™ï¼ˆæ©¡èƒ¶ã€å¡‘æ–™ç­‰ï¼‰ - foamy: adj. æ³¡æ²«çš„ï¼›èµ·æ³¡æ²«çš„\n4. timber - æœ¨æ\n    1. boarding: n. æœ¨æï¼›æ¿æ\n5. cable - çº¿ç¼†ï¼›ç”µç¼†ï¼›é’¢ç´¢\n6. carbon - ç¢³\n7. synthetic - ï¼ˆç‰©è´¨ï¼‰åˆæˆçš„ï¼›äººé€ çš„ - synthetic materials: åˆæˆææ–™\n    1. `syn-`ä¸€èµ· + `thet-`æ”¾ç½® + `-ic`ä¸...æœ‰å…³ï¼›...çš„æœ¬è´¨\n    2. artificial: adj. äººé€ çš„\n8. petroleum: `/pÉ™ËˆtrÉ™ÊŠliÉ™m/` n. çŸ³æ²¹\n    1. å¸Œè…Šè¯­ä¼ å…¥æ‹‰ä¸è¯­ï¼špetro-: çŸ³å¤´ã€å²©çŸ³ï¼›oleo-: æ²¹\n    2. petrol: æ±½æ²¹\n9. fuel: n. ç‡ƒæ–™\n10. fossil: n. åŒ–çŸ³\n    1. foil: `/fÉ”Éªl/` n. é‡‘å±è–„ç‰‡ï¼›ç®”çº¸\n## åº¦é‡ã€ç‰©ç†æ€§è´¨\n\n1. density: å¯†åº¦ï¼›å¯†é›†\n2. dozen: ä¸€æ‰“\n    1. doze: å°ç¡ï¼›å°æ†©\n3. dose: `/dÉ™ÊŠs/` n. å‰‚é‡ï¼›ä¸€å‰‚\n4. handful: ä¸€æŠŠ\n5. humidity: `/hjuË'mÉªdÉ™ti/` n. ï¼ˆç©ºæ°”ï¼‰æ¹¿åº¦ï¼›æ¹¿æ°”ï¼›æ¹¿çƒ­\n    1. Humi: æ¹¿åº¦ - humid: adj.æ½®æ¹¿çš„ - humidify: vt. ä½¿æ½®æ¹¿ï¼›ä½¿æ¹¿æ¶¦ - humidifier: n. å¢æ¹¿å™¨ï¼ŒåŠ æ¹¿å™¨\n    2. åŒä¹‰è¯: moist, moisture, dampness, damp, wet, wetness\n    3. humanity: äººæ€§\n    4. humiliate: `/hjuËËˆmÉªlieÉªt/` vt. ç¾è¾±\n        1. humiliation: `/hjuËËŒmÉªliËˆeÉªÊƒn/` n. å±ˆè¾±ã€è€»è¾±\n6. tonnage: n. å¨ä½ï¼›å¨æ•°\n7. quart: n. å¤¸è„±ï¼ˆæ¶²é‡å•ä½ï¼Œåœ¨è‹±å›½å’ŒåŠ æ‹¿å¤§ç­‰äº2å“è„±æˆ–1.14å‡ï¼Œåœ¨ç¾å›½ç­‰äº0.95å‡ï¼‰\n    1. 4å¤¸è„± = 1åŠ ä»‘\n    2. quarter: ä¸€åˆ»é’Ÿï¼›å››åˆ†ä¹‹ä¸€\n        1. quarterly: adj. å­£åº¦çš„ adv. æ¯å­£ä¸€æ¬¡\n8. elastic: n. æ¾ç´§å¸¦ï¼›æ©¡çš®å¸¦ adj. æœ‰å¼¹æ€§çš„\n    1. elasticity: `/ÉªËŒlÃ¦ËˆstÉªsÉ™ti/` n. å¼¹æ€§ï¼›å¼¹åŠ›\n9. texture: `/ËˆtekstÊƒÉ™(r)/` n. è´¨åœ°ï¼›è‚Œç†ã€çº¹ç†ï¼›æ„é€ \n10. momentum: `/mÉ™ËˆmentÉ™m/` n. åŠ¨åŠ›ã€åŠ¿å¤´ï¼›åŠ¨é‡\n## é¥°å“\n\n1. bead: n. ç å­ï¼›ï¼ˆæ¶²ä½“ï¼‰å°æ»´ç  vt. ç”¨å°ç è£…é¥° vi. å½¢æˆç çŠ¶ï¼Œèµ·æ³¡\n    1. beard: `/bÉªÉ™d/` n. èƒ¡é¡»\n2. pearl: `/pÉœËl/` n. çç \n    1. peril: `/ËˆperÉ™l/` n. ä¸¥é‡å±é™©\n        1. hazard: n. å±é™©ï¼›å±å®³\n            1. hazardous: adj. å±é™©çš„ï¼›æœ‰å®³çš„\n        2. **menace: `/ËˆmenÉ™s/` n. å¨èƒï¼›å±é™©çš„äºº\n3. jewelry: n. ç å®, é¦–é¥°, ç å®é¥°å“\n    1. jewelç å®ï¼Œé’»çŸ³ï¼Œå¯æ•°åè¯ã€‚ jewelry/jewelleryæ˜¯ç å®çš„æ€»ç§°,ä¸å¯æ•°åè¯ã€‚\n## å™¨å®˜ã€äººä½“éƒ¨ä½\n\n1. kidney: n. è‚¾\n2. liver: n. è‚\n3. gland: n. è…º\n4. bowel: `/ËˆbaÊŠÉ™l/` n. è‚ \n    1. bowl: `/bÉ™ÊŠl/` n. ç¢—\n    2. vowel: å…ƒéŸ³\n6. hip: n. é«‹ï¼›è‡€éƒ¨ï¼›é‡è”·è–‡æœ adj. æ—¶å°šçš„ï¼Œèµ¶æ—¶é«¦çš„\n7. jaw: `/dÊ’É”Ë/` n. é¢Œï¼›ä¸‹é¢Œï¼ˆä¸‹å·´ï¼‰\n8. limb: n.ï¼ˆäººã€å››è¶³åŠ¨ç‰©çš„ï¼‰è‚¢ï¼Œè‚¢ä½“ï¼›ï¼ˆé¸Ÿçš„ï¼‰ç¿¼\n9. breast: `/brest/` n. èƒ¸éƒ¨\n10. thumb: n. æ‹‡æŒ‡ v. ç”¨æ‹‡æŒ‡æ‘¸, ç”¨æ‹‡æŒ‡æ‹\n11. rib: n. è‚‹éª¨, æ’éª¨, ï¼ˆèˆ¹æˆ–å±‹é¡¶ç­‰çš„ï¼‰è‚‹æ‹±, ï¼ˆç»‡ç‰©çš„ï¼‰å‡¸æ¡èŠ±çº¹ v. å˜²ç¬‘, é€—å¼„, å¼€ï¼ˆæŸäººçš„ï¼‰ç©ç¬‘ï¼ˆç¬‘æ—¶è‚‹éª¨ä¼šè¿åŠ¨â€”â€”å˜²ç¬‘ï¼‰\n    1. rid: v.å…é™¤,æ¸…é™¤,ä½¿...è·è‡ªç”±\n12. skeleton: n. éª¨æ¶ï¼Œéª¨éª¼ï¼›éª¨ç˜¦å¦‚æŸ´çš„äººï¼ˆæˆ–åŠ¨ç‰©ï¼‰ï¼›æ¡†æ¶ï¼Œæçº²ï¼Œæ¦‚è¦\n    1. skeptical: adj. æ€€ç–‘çš„\n        1. suspicious: adj. æ€€ç–‘çš„\n    2. sketch: n. ç´ æã€é€Ÿå†™ï¼›è‰å›¾\n13. elbow: `/'elbÉ™ÊŠ/` v. ç”¨è‚˜æ¨, æŒ¤èº«è¿›æ¥ n. è‚˜, è‚˜çŠ¶ç‰©, æ›²æŠ˜\n14. whisker: n. ï¼ˆç¡¬ï¼‰é¡»ï¼›ç»œè…®èƒ¡å­ï¼›å¾®å¼±çš„å·®è·\n    1. a very small distance or space \"they lost the election by a whisker\"\n    2. a long stiff hair growing from the snout or brow of most mammals as e.g. a cat\n15. snout: n. é¼»å­\n16. organ: n. (äººä½“æˆ–åŠ¨æ¤ç‰©çš„)å™¨å®˜; é£ç´; å£ç´; æœºæ„, æœºå…³\n## è¯å\n\n1. aspirin: é˜¿å¸åŒ¹æ—\n2. penicillin: ç›˜å°¼è¥¿æ—ï¼›é’éœ‰ç´ \n## åŠ¨ç‰©\n\n1. leopard: n. è±¹\n2. panther: `/'pÃ¦nÎ¸É™(r)/` n. é»‘è±¹\n3. beak: n. é¸Ÿå–™, é¹°é’©é¼», å°–é¼», é¼»å­\n4. wasp: n. é»„èœ‚ï¼›èƒ¡èœ‚\n    1. waspish: adj. æš´èºçš„, æ˜“æ€’çš„\n5. rooster: n. å…¬é¸¡\n6. hound: `/haÊŠnd/` n. çŒçŠ¬ï¼›çŒç‹— v. çº ç¼ ï¼Œä¸æ–­éªšæ‰°\n7. penguin: `/ËˆpeÅ‹É¡wÉªn/` n. ä¼é¹…\n8. pigeon: `/ËˆpÉªdÊ’Éªn/` n. é¸½å­\n## å†Œå­\n\n1. leftlet: `/ËˆliËflÉ™t/` n. å®£ä¼ å†Œï¼›ä¼ å• v. æ•£å‘ä¼ å•ï¼ˆæˆ–å°å†Œå­ï¼‰\n    1. leafæ ‘å¶ï¼›letå°çš„ã€‚leaflet å°±æ˜¯å°æ ‘å¶ä¸€æ ·çš„ä¸œè¥¿ï¼Œå’Œä¼ å•å¾ˆç›¸ä¼¼ï¼Œåˆ°å¤„æ¼‚ã€‚\n2. pamphlet: å°å†Œå­\n## ç—…\n\n1. indigestion: `/ËŒÉªndÉª'dÊ’estÊƒÉ™n/` n. æ¶ˆåŒ–ä¸è‰¯ï¼ˆç—‡ï¼‰\n    1. indigenous: `/ÉªnËˆdÉªdÊ’É™nÉ™s/` adj. åœŸç”ŸåœŸé•¿çš„ã€æœ¬åœ°çš„\n2. epidemic: `/ËŒepÉªËˆdemÉªk/` n. ï¼ˆä¼ æŸ“ç—…ï¼‰æµè¡Œã€ä¼ æ’­\n    1. episode: `/ËˆepÉªsÉ™ÊŠd/` n.ï¼ˆç”µè§†å‰§ï¼‰ä¸€é›†ï¼›ï¼ˆå°è¯´ã€äººç”Ÿçš„ï¼‰æ’æ›²\n# limb - lumber - timber\n\n1. limb: n. å››è‚¢\n2. lumber: n. æœ¨æ, æœ¨æ–™ï¼›æ‚ç‰©, ç ´çƒ‚å„¿ vi. ç¼“æ…¢åƒåŠ›åœ°ç§»åŠ¨ï¼›ç¬¨æ‹™åœ°è¡Œè¿›\n3. timber: n. æœ¨æ\n# foremost\n\n1. æœ€é‡è¦çš„ï¼›é¦–è¦çš„\n# æŠ‘åˆ¶: suppress - oppress - repress - depress - stifle\n\n1. sup - suppress: `/sÉ™Ëˆpres/` å‹åˆ¶ã€å‹æŠ‘\n2. op - oppress: `/É™Ëˆpres/` v. æ¬ºå‹ã€å‹è¿«ã€å‹åˆ¶ï¼›å‹æŠ‘\n3. re - repress: `/rÉªËˆpres/` v. å…‹åˆ¶ã€æŠ‘åˆ¶ï¼›å‹æŠ‘\n4. de - depress: `/dÉªËˆpres/` v. ä½¿æŠ‘éƒ\n5. deplore: `/dÉªËˆplÉ”Ë(r)/` vt. å…¬å¼€è°´è´£ï¼›å¼ºçƒˆåå¯¹\n6. stifle: `/ËˆstaÉªfl/` v. æ‰¼æ€ï¼›æŠ‘åˆ¶\n7. strangle: vt. æ‰¼æ€ï¼›é˜»ç¢\n8. hamper: n. å¸¦ç›–å­çš„å¤§ç¯®å­ v. é˜»ç¢\n9. hinder: vt. é˜»ç¢\n10. withhold: `/wÉªÃ°ËˆhÉ™ÊŠld/, /wÉªÎ¸ËˆhÉ™ÊŠld/` vt. æ‹’ç»ç»™ï¼›ä¸ç»™\n11. inhibit: v. é˜»æ­¢\n12. deter: v. é˜»æ­¢ã€åˆ¶æ­¢\n    1. deterrent: `/dÉªËˆtÉœËrÉ™nt/` n. å¨æ…‘åŠ›ï¼›å¨æ…‘æ‰‹æ®µ\n## éšœç¢ã€ç¼ºé™·ï¼›æ®‹ç–¾ã€ç˜«ç—ª: handicap - obstacle - hinder - withhold - drawback\n\n1. handicap: `/ËˆhÃ¦ndikÃ¦p/` n. ç”Ÿç†ï¼ˆæˆ–æ™ºåŠ›ã€äº¤é™…åŠŸèƒ½ï¼‰ç¼ºé™·ï¼›ä¸åˆ©å› ç´ ï¼Œéšœç¢ v. å¦¨ç¢ï¼›é˜»ç¢\n    1. paralysis: `/pÉ™ËˆrÃ¦lÉ™sÉªs/` n. éº»ç—¹ã€ç˜«ç—ªï¼›ï¼ˆæ´»åŠ¨ã€å·¥ä½œèƒ½åŠ›ï¼‰å®Œå…¨ä¸§å¤±\n        1. paradox: `/ËˆpÃ¦rÉ™dÉ’ks/` n. çŸ›ç›¾çš„äººã€äº‹ç‰©ï¼›æ‚–è®º\n    2. cripple: `/ËˆkrÉªpl/` v. ä½¿æ®‹ç–¾ï¼›ä¸¥é‡æŸå®³ n. æ®‹ç–¾äººã€ç˜¸å­ã€è·›å­\n2. obstacle: `/ËˆÉ’bstÉ™kl/` n. éšœç¢ã€ç»Šè„šçŸ³\n3. drawback: `/ËˆdrÉ”ËbÃ¦k/` n. ç¼ºç‚¹ï¼›ä¸åˆ©æ¡ä»¶ã€éšœç¢\n# emission - eliminate - climate - diffusion - omission\n\n1. emit: v. å‘å‡ºï¼ˆå£°éŸ³ï¼‰ï¼›æ•£å‘ï¼ˆæ°”ä½“ã€è¾å°„ç‰©ï¼‰ - emission - å°¤æŒ‡æ°”ä½“çš„æ‰©æ•£ã€å‘æ•£ã€æ¶ˆæ•£\n\t1. permeation: æ¸—é€ï¼›æ‰©æ•£\n2. eliminate - æ¶ˆé™¤ã€å»é™¤ã€æ’é™¤\n3. climate - æ°”å€™\n\t1. climax: n. é«˜æ½®ï¼›æç‚¹ - anticlimax: æ‰«å…´\n\t\t1. summit: n. é¡¶ä¼šï¼Œå³°ä¼š\n\t\t2. culminate: v. ä»¥...å‘Šç»ˆ n. é¡¶ç‚¹ã€å·…å³°ã€é«˜æ½®ï¼›ç»ˆç‚¹\n\t\t   My arguments with the boss culminated in my resignation. æˆ‘å’Œè€æ¿çš„äº‰è®ºä»¥æˆ‘çš„è¾èŒè€Œå‘Šç»ˆã€‚\n4. diffusion: n. ä¼ æ’­ã€æ•£å¸ƒï¼›æ¨å¹¿\n   Modern technologies make the diffusion of information extremely rapid. ç°ä»£æŠ€æœ¯ä½¿ä¿¡æ¯çš„ä¼ æ’­æä¸ºè¿…é€Ÿã€‚\n    1. infusion: n. çŒè¾“ï¼›\n5. omission: `/É™(ÊŠ)'mÉªÊƒ(É™)n/` n. é—æ¼ã€ç–å¿½\n# æˆäºˆ - å¥–åŠ±ã€å¥–ç«  - è±¡å¾ã€æ ‡è®°\n\n1. award: n. å¥–ï¼›å¥–é‡‘ v. æˆäºˆï¼Œç»™ä¸ï¼›è£å®š\n    1. reward: å›æŠ¥\n2. bestow: v. æˆäºˆï¼›çŒ®ç»™ - He bestowed high praise on the winners.\n3. endow\n4. badge: n. è±¡å¾\n5. impart: v. é€šçŸ¥ã€é€éœ²ã€ä¼ æˆï¼›æŠŠï¼ˆæŸæ€§è´¨ï¼‰èµ‹äºˆã€å°†â€¦ç»™äºˆ\n6. confer: `/kÉ™nËˆfÉœË(r)/` vi. åå•† vt. æˆäºˆï¼ˆå­¦ä½ã€å¥–é¡¹ã€è£èª‰ï¼‰\n7. grant: `/É¡rÉ‘Ënt/` v. åŒæ„ã€å‡†äºˆã€æˆäºˆ n. æ‹¨æ¬¾\n## ç‰ˆæƒã€æˆæƒã€æ‰¹å‡† - franchise\n\n1. franchise: n./v. æˆæƒï¼ˆç»é”€æƒï¼‰ï¼›é€‰ä¸¾æƒ\n    1. enfranchise: ç»™...é€‰ä¸¾æƒï¼›è§£æ”¾ï¼ˆå¥´éš¶ï¼‰\n2. pirate: `/ËˆpaÉªrÉ™t/` n. æµ·ç›—ï¼›ç›—ç‰ˆè€… v. ç›—ç”¨\n3. entitle: `/ÉªnËˆtaÉªtl/` v. æˆæƒï¼›ä½¿æœ‰æƒåˆ©ã€èµ„æ ¼ï¼›ç»™...é¢˜å\n4. concession: `/kÉ™nËˆseÊƒn/` n. è®©æ­¥ã€å¦¥åï¼›è®¸å¯ã€æ‰¿è®¤ï¼›ç‰¹è®¸ç»è¥æƒ\n5. ratify: `/ËˆrÃ¦tÉªfaÉª/` v. æ­£å¼æ‰¹å‡†ï¼›ä½¿æ­£å¼ç”Ÿæ•ˆ\n6. eligible: `/ËˆelÉªdÊ’É™bl/` adj. æœ‰èµ„æ ¼çš„\n7. certify: v. ä¹¦é¢è¯æ˜ï¼›åŠæ³•åˆæ ¼è¯ä¹¦\n    1. certificate: `/sÉ™ËˆtÉªfÉªkÉ™t/` n. è¯æ˜ä¹¦ï¼›æ–‡å‡­\n    2. certification: `/ËŒsÉœËtÉªfÉªËˆkeÉªÊƒn/` n. è¯æ˜ã€é‰´å®šçš„è¿‡ç¨‹\n8. credential: `/krÉ™ËˆdenÊƒl/` n. å‡­è¯\n9. ratify: `/ËˆrÃ¦tÉªfaÉª/` vt. æ‰¹å‡†\n    1. ratification: `/ËŒrÃ¦tÉªfÉªËˆkeÉªÊƒn/` n. æ­£å¼æ‰¹å‡†\n10. voucher: `/ËˆvaÊŠtÊƒÉ™r/` n. ä¼˜æƒ åˆ¸ã€ä»£å¸åˆ¸ã€ç¥¨åˆ¸å‡­è¯\n# æ˜“å¿˜çš„\n\n1. agitation: `/ËŒÃ¦dÊ’ÉªËˆteÉªÊƒn/` n. ç„¦è™‘ä¸å®‰ã€çƒ¦ä¹±ï¼›éªšåŠ¨ã€ç…½åŠ¨\n    1. agitate: v. ç…½åŠ¨ã€é¼“åŠ¨ï¼›ä½¿ä¸å®‰ã€çƒ¦ä¹±\n2. **aggravate: vt. ä½¿ä¸¥é‡ã€æ¶åŒ–**\n    1. aggravation: n. åŠ é‡ã€æ¶åŒ–\n    2. aggressive: adj. å…¥ä¾µçš„\n        1. invade: v. æ­¦è£…å…¥ä¾µ\n            1. invasive: adj. ä¾µå…¥çš„ - invasive cancer æ‰©æ•£æ€§è‚¿ç˜¤ï¼›æœ‰åˆ›çš„ - invasive surgery å¼€åˆ€æ‰‹æœ¯\n3. delinquency: n. è¿æ³•è¡Œä¸º\n    1. delinquent: adj. æœ‰è¿æ³•å€¾å‘çš„ï¼›æ¬ å€ºçš„\n4. peel: æ‰’æœçš®\n5. flaw: n. é”™è¯¯ï¼›ç¼ºé™·\n    1. Flaws have appeared in the new version of the software.\n    2. paw: n. åŠ¨ç‰©çš„çˆª\n        1. claw: n. åŠ¨ç‰©çš„çˆªå­\n6. franchise: n./v. æˆæƒï¼ˆç»é”€æƒï¼‰ï¼›é€‰ä¸¾æƒ\n    1. enfranchise: ç»™...é€‰ä¸¾æƒï¼›è§£æ”¾ï¼ˆå¥´éš¶ï¼‰\n7. pine: v. æ†”æ‚´ï¼›æ€å¿µï¼›æ‚¼å¿µ n. æ¾æ ‘\n8. fare: `/feÉ™(r)/` n. è·¯è´¹ v. åšäº‹ã€å¹²ï¼›è¿›å±•\n   bus/taxi fares\n9. whereas: conj. (conjunction) è€Œ, å´ï¼›åä¹‹\n10. cozy: adj. äº²å¯†æ— é—´çš„ã€å¯†åˆ‡çš„ï¼›ï¼ˆå°¤æŒ‡å› åœ°æ–¹å°æˆ–å°é—­è€Œï¼‰æƒ¬æ„çš„\n11. consecutive: `/kÉ™n'sekjÉ™tÉªv/` adj. è¿ç»­ä¸æ–­çš„\n12. juvenile: `/ËˆdÊ’uËvÉ™naÉªl/` adj. ï¼ˆä¸ï¼‰é’å°‘å¹´ï¼ˆæœ‰å…³ï¼‰çš„\n    Lack of care from parents may give rise to juvenile crime. çˆ¶æ¯å¯¹å­©å­ç¼ºä¹å…³çˆ±å®¹æ˜“å¼•å‘é’å°‘å¹´çŠ¯ç½ªã€‚\n    1. avenue: `/ËˆÃ¦vÉ™njuË/` n. æ—è«é“\n        1. venue: `/ËˆvenjuË/` n. æ´»åŠ¨åœºåœ°ï¼ˆå¦‚éŸ³ä¹å…ã€ä½“è‚²æ¯”èµ›åœºé¦†ã€ä¼šåœºï¼‰\n13. customs: n. å…³ç¨ï¼›æµ·å…³éƒ¨é—¨\n    1. custom: ä¹ ä¿—\n14. faculty: å­¦é™¢ï¼›å…¨ä½“æ•™å­¦äººå‘˜\n    1. dean: n. é™¢é•¿ï¼›ä¸»ä»»\n15. bracket: n. æ‹¬å·ï¼›åŒç­‰çº§çš„äºº\n16. intensive: adj. ç´§å¼ çš„ = intense `adj.`\n    1. intensity: n. å‰§çƒˆï¼›ç´§å¼ \n    2. intent: adj. ä¸“æ³¨çš„\n        1. intend: v. æ‰“ç®—ï¼›æƒ³è¦\n17. inevitable: `/ÉªnËˆevÉªtÉ™bl/` adj. å¿…ç„¶å‘ç”Ÿçš„ã€ä¸å¯é¿å…çš„\n18. feasible: adj. å¯è¡Œçš„ï¼›ç°å®çš„\n    1. feasibility: n. å¯è¡Œæ€§ï¼›ç°å®æ€§\n19. deliberate: adj. æ•…æ„çš„ v. ä»”ç»†è€ƒè™‘\n    1. liberate: è§£æ”¾\n20. maneuver: n./v. æœºåŠ¨ï¼›è°‹ç•¥ï¼›æ“ä½œã€æ“çºµ\n    The driver carried out a complex maneuver to pass the narrow lane. è¿™ä¸ªå¸æœºåšå‡ºäº†å¤æ‚è€Œç²¾å·§çš„æ“ä½œé€šè¿‡äº†è¿™æ¡ç‹­çª„çš„é“è·¯ã€‚\n    1. rig: `/rÉªÉ¡/` v. ï¼ˆä¸æ­£å½“åœ°ï¼‰æ“çºµï¼›ç»™èˆ¹è£…å¸†ã€æä¾›ç´¢å…·ï¼›å®‰è£…ã€è£…é… **n. æœ‰ä¸“é—¨ç”¨é€”çš„è®¾å¤‡ã€è£…ç½®**\n21. orient: `/ËˆÉ”Ërient/` v. ä½¿æœå‘ï¼ˆå¸¸ç”¨äºè¢«åŠ¨è¯­æ€ï¼‰ = orientate\n    1. oriented: `/ËˆÉ”ËrientÉªd/` adj. å®šå‘çš„\n    2. orientation: n. æ–¹å‘ï¼›å–å‘\n22. logistic: `/lÉ™ËˆdÊ’ÉªstÉªk/` adj. åå‹¤ç›¸å…³çš„ = logistical\n23. quench: v. è§£ç‡ƒçœ‰ä¹‹æ€¥ã€ç†„ç­ç«ç„°ï¼›è§£æ¸´ã€æ»¡è¶³æ¸´æœ›\n24. cult: `/kÊŒlt/` n. ç‹‚çƒ­ã€å´‡æ‹œ\n25. chronic: `/ËˆkrÉ’nÉªk/` adj. é•¿æœŸçš„ã€æŒç»­æ—¶é—´å¾ˆé•¿çš„ï¼›æ…¢æ€§çš„\n    1. choir: `/ËˆkwaÉªÉ™(r)/` n. åˆå”±å›¢\n26. reclaim: `/rÉªËˆkleÉªm/` v. é‡æ–°å¾—åˆ°ï¼›å–å›ã€æ‹¿å›\n27. ethic: `/ËˆeÎ¸Éªk/` n. é“å¾·è§„èŒƒï¼›ä¼¦ç†\n    1. ethnic: `/ËˆeÎ¸nÉªk/` adj. ç§æ—çš„ã€æ°‘æ—çš„\n## å›°éš¾è¯æ±‡\n\n1. endeavour: `/in'devÉ™/` v./n. åŠªåŠ›ï¼›å‹¤å¥‹\n   If we acknowledge that human manipulation of the Earth has been a destructive force, we can also imagine that human endeavours can help us build a less destructive world in the centuries to come. å¦‚æœæˆ‘ä»¬æ‰¿è®¤äººç±»å¯¹åœ°çƒçš„æ“çºµæ˜¯ä¸€ç§ç ´åæ€§çš„åŠ›é‡é‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥æƒ³è±¡ï¼Œäººç±»å¯ä»¥åŠªåŠ›åœ¨æœªæ¥å‡ ä¸ªä¸–çºªé‡Œå»ºç«‹ä¸€ä¸ªç ´åæ€§è¾ƒå°çš„ä¸–ç•Œã€‚\n2. envisage: `/ÉªnËˆvÉªzÉªdÊ’/` v. æƒ³è±¡ã€è®¾æƒ³ï¼›é¢å¯¹\n   Nicole didn't celebrate her 30th birthday as she had envisaged. å¦®å¯æ²¡æœ‰åƒè‡ªå·±é¢„æƒ³çš„é‚£æ ·å»åº†ç¥è‡ªå·±çš„30å²ç”Ÿæ—¥ã€‚\n   The plan cost a lot more than we had originally envisaged. è¿™é¡¹è®¡åˆ’èŠ±è´¹çš„èµ„é‡‘æ¯”æˆ‘ä»¬æœ€åˆé¢„è®¡çš„è¦å¤šã€‚\n    1. visage: n. ï¼ˆäººçš„ï¼‰è„¸\n3. prestigious: `/preËˆstÉªdÊ’É™s/` adj. æœ‰å¨æœ›çš„\n    1. prestige: `/preËˆstiËÊ’/` n. å¨ä¿¡\n    2. **preside: `/prÉªËˆzaÉªd/` v. ä¸»æŒã€æ‹…ä»»ï¼ˆä¼šè®®ä¸»å¸­ï¼‰**\n5. dedicate: v. çŒ®å‡ºï¼›è‡´åŠ›äº - dedication: n. å¥‰çŒ®\n6. reminiscent: `/ËŒremÉªËˆnÉªsnt/` adj. ä½¿å‹¾èµ·å›å¿†çš„\n   That film is so reminiscent of my adolescence. é‚£éƒ¨ç”µå½±å‹¾èµ·äº†æˆ‘å¯¹é’å°‘å¹´æ—¶ä»£çš„æ— é™å›å¿†ã€‚\n    1. reminiscence: n. è¿½å¿†ã€å›å¿†\n6. unilateral: adj. å•æ–¹é¢çš„\n    1. lateral: adj. ä¾§é¢çš„\n        1. flank: n. ä¾§é¢ v. ä¾§é¢æœ‰...ï¼›ä½äº...çš„ä¾§é¢\n    2. facet: `/ËˆfÃ¦sÉªt/` n. ï¼ˆäº‹ç‰©çš„ï¼‰æ–¹é¢ã€éƒ¨åˆ†ã€ç‰¹å¾ = asoect\n    3. unanimous: `/juËˆnÃ¦nÉªmÉ™s/` adj. ä¸€è‡´çš„\n7. adolescence: `/ËŒÃ¦dÉ™Ëˆlesns/` n. é’æ˜¥æœŸ\n8. simultaneous: `/ËŒsÉªmlËˆteÉªniÉ™s/` adj. åŒæ—¶çš„\n    1. **spontaneous**: `/spÉ’n'teÉªniÉ™s/` adj. **è‡ªå‘çš„ï¼Œè‡ªç„¶äº§ç”Ÿçš„**ï¼›æ— æ„è¯†çš„ï¼›å¤©çœŸç‡ç›´çš„\n    2. simulate: `/ËˆsÉªmjuleÉªt/` v. æ¨¡æ‹Ÿ\n        1. imitate: `/ËˆÉªmÉªteÉªt/` v. æ¨¡ä»¿\n        2. emulate: `/ËˆemjuleÉªt/` v. å‘...çœ‹é½ï¼›ï¼ˆè®¡ç®—æœºï¼‰ä»¿çœŸ\n9. panorama: `/ËŒpÃ¦nÉ™ËˆrÉ‘ËmÉ™/` n. å…¨æ™¯\n    1. panoramic: `/ËŒpÃ¦nÉ™ËˆrÃ¦mÉªk/` adj. å…¨æ™¯çš„\n10. embroider: v. åˆºç»£\n    1. embroidery: n. åˆºç»£\n11. benevolence: `/bÉ™ËˆnevÉ™lÉ™ns/` n. å–„è‰¯ã€ä¹äºåŠ©äººå’Œæ…·æ…¨çš„å“è´¨\n    1. è¯æ ¹ï¼šbene-: å¥½çš„ä¸œè¥¿\n12. inventory: n. ç°æœ‰åº“å­˜æ¸…å•\n    1. inventory = invent + ory : å‘ç°ã€å‘æ˜çš„ä¸œè¥¿è®°ä¸ªè¡¨\n13. gorgeous: `/ËˆÉ¡É”ËdÊ’É™s/` adj. åä¸½çš„ï¼›ç¾ä¸½åŠ¨äººçš„\n14. excursion: `/ÉªkËˆskÉœËÊƒn/` n. çŸ­é€”è¿œè¶³æ—…è¡Œï¼ˆå°¤æŒ‡é›†ä½“ç»„ç»‡ï¼‰\n15. reconcile: `/ËˆrekÉ™nsaÉªl/` v. è°ƒå’Œï¼›å’Œè§£\n    1. reconciliation: `/ËŒrekÉ™nsÉªliËˆeÉªÊƒn/` n. è°ƒå’Œï¼›å’Œè§£ï¼›å’Œè°ä¸€è‡´\n    2. reconciliatory: `/ËŒrekÉ™n'siliÉ™tÉ™ri/` adj. å’Œè§£çš„ï¼›è°ƒå’Œçš„\n16. itinerary: `/aÉªËˆtÉªnÉ™rÉ™ri/` n. è¡Œç¨‹è¡¨ã€æ—…è¡Œè®¡åˆ’\n17. aftermath: `/ËˆÉ‘ËftÉ™mÃ¦Î¸/` n. ï¼ˆæˆ˜äº‰ã€äº‹æ•…ã€ä¸å¿«äº‹æƒ…çš„ï¼‰åæœ\n    A lot of rebuilding took place in the aftermath of the war. æˆ˜åè¿›è¡Œäº†å¤§é‡çš„é‡å»ºå·¥ä½œã€‚\n    How does a country cope with the aftermath of war? ä¸€ä¸ªå›½å®¶å¦‚ä½•å¤„ç†æˆ˜åé—®é¢˜ï¼Ÿ\n18. assimilate: `/É™ËˆsÉªmÉ™leÉªt/` v. é€å½»ç†è§£ã€æ¶ˆåŒ–ã€å¸æ”¶ï¼›ä½¿åŒåŒ–ã€èå…¥ã€æ¥å—\n19. hypocrite: `/ËˆhÉªpÉ™krÉªt/` n. ä¼ªå›å­ã€ä¼ªå–„è€…ã€è™šä¼ªçš„äºº\n20. renaissance: `è‹± /rÉªËˆneÉªsns/ ç¾ /ËˆrenÉ™sÉ‘Ëns/` n. å¤å…´ï¼›æ–‡è‰ºå¤å…´\n21. contingent: `/kÉ™nËˆtÉªndÊ’É™nt/` adj. ä¾æƒ…å†µè€Œå®šçš„ï¼›å¶ç„¶çš„ã€ä¸´æ—¶çš„ï¼ˆçº¦ç­‰äºdepend onï¼‰ n. æ¥è‡ªåŒä¸€åœ°æ–¹çš„ä»£è¡¨å›¢\n22. conspicuous: `/kÉ™nËˆspÉªkjuÉ™s/` adj. æ˜¾çœ¼çš„ã€æ˜¾è‘—çš„\n## å„ç§å­¦å®¶: å¿ƒç†å­¦å®¶ã€è€ƒå¤å­¦å®¶ã€å“²å­¦å®¶\n\n1. archaeology: è€ƒå¤å­¦å®¶\n2. philosophical: `/ËŒfÉªlÉ™ËˆsÉ’fÉªkl/` å“²å­¦çš„\n3. physiological: `/ËŒfÉªziÉ™ËˆlÉ’dÊ’Éªkl/` adj. ç”Ÿç†å­¦çš„ï¼›ç”Ÿç†åŠŸèƒ½çš„\n4. psychological: å¿ƒç†å­¦çš„\n5. psychiatric: `/ËŒsaÉªkiËˆÃ¦trÉªk/` adj. ç²¾ç¥ç—…å­¦çš„\n    1. psychiatrist: `/saÉªËˆkaÉªÉ™trÉªst/` n. ç²¾ç¥ç—…ä¸“å®¶\n6. physicist: ç‰©ç†å­¦å®¶\n7. physician: å†…ç§‘åŒ»ç”Ÿ\n8. geology: åœ°ç†å­¦\n9. zoology: åŠ¨ç‰©å­¦\n10. astronomy: å¤©æ–‡å­¦\n## ä¸»ä¹‰\n\n1. optimism: n. ä¹è§‚ä¸»ä¹‰ - optimistic: adj. ä¹è§‚çš„\n2. pessimism: n. æ‚²è§‚ä¸»ä¹‰\n3. cynicism: `/'sÉªnÉªsÉªz(É™)m/` n. äººäººè‡ªç§ä¸»ä¹‰ï¼›æ‚²è§‚ï¼›ç©ä¸–ä¸æ­ï¼ˆå¯¹ç”Ÿæ´»ä¸ä¸¥è‚ƒã€ä¸è®¤çœŸï¼‰\n4. aesthetic: `è‹± /iËsËˆÎ¸etÉªk/ ç¾ /esËˆÎ¸etÉªk/` adj. ç¾å­¦çš„ï¼›å®¡ç¾çš„\n5. bureaucracy: `/bjÊŠÉ™ËˆrÉ’krÉ™si/` n. å®˜åƒšä¸»ä¹‰\n    1. bureaucratic: `/ËŒbjÊŠÉ™rÉ™ËˆkrÃ¦tÉªk/` adj. å®˜åƒšä¸»ä¹‰çš„\n## è·Ÿé©¬æœ‰å…³çš„\n\n1. pony: n. çŸ®é©¬, å°å‹é©¬, 25 è‹±é•‘ v. ç”¨æ³¨è§£ä¹¦å­¦ä¹ ï¼›ä»˜æ¸…ã€æ¸…å¿ adj. å°(å‹)çš„ - tony tail: é©¬å°¾å‘å‹\n\t1. toll: `/tÉ™ÊŠl/` n. ï¼ˆè‡ªç„¶ç¾å®³ã€å†²çªäº‹æ•…ï¼‰ä¼¤äº¡äººæ•°ï¼›è¿‡è·¯è´¹\n# equa- / formula-\n\nè¯æ ¹ï¼šformula - æ–¹ç¨‹å¼ã€å…¬å¼ã€å‡†åˆ™ã€é…æ–¹\n\n1. equation: ç›¸ç­‰ã€ç›¸åŒï¼›æ–¹ç¨‹å¼ï¼›ç­‰å¼ï¼›å¹³è¡¡ã€ç»¼åˆä½“ï¼ˆé›…æ€çœŸé¢˜ï¼šè¦è€ƒè™‘å¤šç§å› ç´ çš„å¤æ‚å±€é¢ã€å¤åˆä½“ï¼‰\n2. formulate: `/ËˆfÉ”ËmjuleÉªt/` v. è§„åˆ’ã€æ„æƒ³ï¼›ç¡®åˆ‡è¡¨è¾¾\n    1. formulation: `/ËŒfÉ”ËmjuËˆleÉªÊƒn/` n. è§„åˆ’ã€æ„æƒ³ï¼›é…åˆ¶ã€åˆ¶å‰‚ï¼›å…¬å¼åŒ–çš„è¡¨è¾¾\n# èµŒæ³¨ã€è‚¡ä»½\n\n1. stake: `/steÉªk/` n. è‚¡ä»½ï¼›æ¡©ï¼›èµŒæ³¨ v. æ‹¿...å†’é™©ã€æ‰“èµŒ\n2. stock: n. è‚¡ä»½ï¼›åº“å­˜ï¼›å®¶ç•œ\n3. gamble: v. å†’é£é™©ï¼›ç¢°è¿æ°”ï¼›ä»¥â€¦ä¸ºèµŒæ³¨ n. èµŒåšï¼›æ‰“èµŒï¼›å†’é™©\n    1. ramble: n./v. æ¼«æ­¥ï¼›æ¼«è°ˆ\n# stain\n\n1. stainless: ä¸é”ˆçš„\n2. stainæœ‰ç”Ÿé”ˆçš„æ„æ€ï¼Œæœ¬è´¨ä¸Šï¼Œæœ‰â€œæ±¡æŸ“ã€æŸ“è‰²â€çš„æ„æ€\n# roar pour horn moan groan barn growl morn scorn adorn corn\n\n1. roar: å¼å«ã€å’†å“®\n2. pour: å€¾å€’\n3. horn: åŠ¨ç‰©çš„è§’ï¼›å–‡å­ã€å·\n4. moan: æ‚²å¹ã€å‘»åŸï¼›æ²¡åŸå› çš„æŠ±æ€¨ï¼›é£çš„å£°éŸ³ï¼›\n5. groan: n. v.ï¼ˆå› ç—›è‹¦ï¼‰å‘»åŸ\n    1. grain: è°·ç‰©ï¼›é¢—ç²’çŠ¶çš„ä¸œè¥¿\n    2. grind: `/É¡raÉªnd/` v. ç¢¾ç¢, ç£¨ç¢ n. è‹¦å·®äº‹\n6. barn: n. è°·ä»“ï¼›ç•œæ£šï¼›ä»“æˆ¿\n   The hay barn needs repairing. å¹²è‰æ£šéœ€è¦ä¿®ç¼®ã€‚\n    1. bran: ç³ \n1. growl: n. v. ä½æ²‰çš„æ€’å¼ã€å’†å“®\n2. morn: n. [è¯—]ç ´æ™“ï¼›[è¯—]æ—©æ™¨\n3. scorn: v. è”‘è§†\n4. adorn: v. è£…é¥°\n5. corn: n. ç‰ç±³, (è„šä¸Šçš„)é¸¡çœ¼ï¼›è°·ç‰© v. è…Œï¼›ä½¿æˆé¢—ç²’\n# chillyå†·çš„ - `*ill*`\n\n1. chill: `/tÊƒÉªl/` n. å¯’å†·ï¼›å®³æ€• v. ä½¿...å†°å†·ï¼›ä½¿ææƒ§ adj. å¯’å†·çš„\n2. chilly: `/ËˆtÊƒÉªli/` adj. é˜´å†·çš„ã€å¯’å†·çš„ï¼›å†·æ·¡çš„ã€ä¸å‹å¥½çš„\n3. drill: é’»\n# dia-: dairy - diary; diagnose - dialogue\n\n1. dairy: `/ËˆdeÉ™ri/` n. ä¹³åˆ¶å“ adj. ä¹³åˆ¶çš„\n2. diary: `/ËˆdaÉªÉ™ri/` n. æ—¥è®°\n3. diagnose: `/ËŒdaÉªÉ™É¡ËˆnÉ™ÊŠs/` v. è¯Šæ–­\n    1. diagnosis: `/ËŒdaÉªÉ™É¡ËˆnÉ™ÊŠsÉªs/` n. è¯Šæ–­\n4. dialogue: `/ËˆdaÉªÉ™lÉ’É¡/` n. å¯¹è¯\n# sham shed shred shield shelter shun shade cloak shiver shove shrewd\n\n1. shamæ˜¯å‡æ„ï¼›ä¼ªè£…ï¼›å‡è±¡ï¼›è™šå‡\n2. shed: v. æ‘†è„±ï¼›å»é™¤ï¼›è„±è½ï¼ˆçš®ã€æ¯›ï¼‰ n. æ£šå±‹\n3. shred: `/Êƒred/` v. åˆ‡ç¢ï¼›æ’•ç¢ n. ç»†æ¡ã€ç¢ç‰‡ï¼›æå°‘é‡ã€ä¸€ä¸ç‚¹\n4. shieldæ˜¯æ©ä½“ = shelter\n5. shiver: `/ËˆÊƒÉªvÉ™(r)/` v. é¢¤æŠ–ï¼Œå“†å—¦\n    1. shaver: `/'ÊƒeÉªvÉ™/` n. å‰ƒé¡»åˆ€\n6. shun: v. é¿å¼€, å›é¿, é¿å…\n7. shade: n. è«å‡‰å¤„ï¼Œé˜´å½±ï¼›è‰²è°ƒï¼Œè‰²åº¦ v. ç»™â€¦é®æŒ¡ï¼ˆå…‰çº¿ï¼‰ï¼›è«è”½\n    1. shady: `/'ÊƒeÉªdi/` adj. é˜´å‡‰çš„ï¼Œæˆè«çš„ï¼›éæ³•çš„ï¼Œä¸æ­£å½“çš„\n8. cloak: n. æŠ«é£ï¼Œæ–—ç¯·ï¼›é®ç›–ç‰© v. é®ç›–ï¼›æ©ç›–\n9. shove: `/ÊƒÊŒv/` v./n. çŒ›æ¨ï¼›ä¹±æŒ¤\n    1. shovel: `/ËˆÊƒÊŒvl/` n. é“²\n10. shaft: n. ç”µæ¢¯äº•ï¼›æ†ã€è½´\n11. shrewd: `/ÊƒruËd/` adj. ç²¾æ˜çš„ã€æ•é”çš„ï¼›é«˜æ˜çš„\n# å¾—ä½“çš„ã€æ°å½“çš„ã€åˆé€‚çš„ã€æ­£å¸¸çš„ï¼›ä¸­ç«‹çš„\n\n1. decent - decency\n2. moderate - ä¸­ç­‰çš„ï¼›æ¸©å’Œçš„\n3. medium - adj. ä¸­ç­‰çš„ï¼›é€‚ä¸­çš„ n. æ–¹æ³•ï¼›åª’ä»‹\n    1. mediate: `/ËˆmiËdieÉªt/` v. è°ƒåœï¼›æ–¡æ—‹\n        1. mediator: `/ËˆmiËdieÉªtÉ™(r)/` n. è°ƒåœè€…\n        2. intermediate: adj. ï¼ˆä¸¤æï¼‰ä¸­é—´çš„\n4. Nothing special - æ²¡ç‰¹è‰²ï¼›ä¸­è§„ä¸­çŸ©\n5. regular - æ­£å¸¸çš„ï¼›è§„åˆ™çš„\n6. normal - ä¸€èˆ¬çš„\n7. common - æ™®é€šçš„\n    1. Commonwealth: `/ËˆkÉ’mÉ™nwelÎ¸/` n. è”é‚¦ä½“ï¼›è”åˆä½“\n        1. federal: `/ËˆfedÉ™rÉ™l/` adj. è”é‚¦åˆ¶çš„\n    2. commonweal: `/'kÉ’mÉ™nwiËl/` n. ï¼ˆç½‘ç»œï¼‰å…¬ç›Šã€å¤§ä¼—ç¦åˆ©\n        1. weal: `/wiËl/` n. ç¦åˆ© - weal and woe: ç¥¸ç¦\n            1. wealth: `/welÎ¸/` n. è´¢å¯Œ\n8. appropriate: adj. åˆé€‚çš„ã€é€‚å½“çš„ã€æ°å½“çš„ **vt. ï¼ˆæ“…è‡ªï¼‰æŒªç”¨**\n    1. **appropriation: n. ç›—ç”¨**\n    2. approximate: `/É™ËˆprÉ’ksÉªmÉ™t/` adj. è¿‘ä¼¼çš„ã€å¤§çº¦çš„\n        1. proximate: `/ËˆprÉ’ksÉªmÉ™t/` adj. ï¼ˆæ—¶é—´ã€é¡ºåºç­‰ï¼‰æœ€æ¥è¿‘çš„\n9. tactful: adj. åœ†æ»‘çš„ã€ä¸å¾—ç½ªäººçš„ï¼›å¾—ä½“çš„\n    1. tact: n. åœ†æ»‘ã€è€ç»ƒï¼›å¾—ä½“\n        1. tactic: `/ËˆtÃ¦ktÉªk/` n. ç­–ç•¥ï¼›æ‰‹æ®µ\n10. apt: `/Ã¦pt/` adj. æ°å½“çš„ã€é€‚å½“çš„ï¼›æœ‰...å€¾å‘çš„\n    1. aptly: adv. é€‚å½“åœ°\n11. pertinent: `/ËˆpÉœËtÉªnÉ™nt/` adj. æ°å½“çš„ï¼›ç›¸å®œçš„ã€ç›¸åº”çš„\n12. due: adj. ç”±äº...çš„ï¼›é¢„è®¡çš„ã€åˆ°æœŸçš„ï¼›ï¼ˆå½¢å®¹é’±ã€ç‰©å“ï¼Œsth. is due to sb.ï¼‰åº”ä»˜ç»™æŸäººçš„ã€æ¬ æŸäººçš„ï¼ˆnot before n.ï¼‰ï¼›ï¼ˆå½¢å®¹äººï¼Œsb. be due for ...ï¼‰æŸäººåº”æœ‰ã€åº”å¾—åˆ°...çš„ï¼›**åˆé€‚çš„ã€æ°å½“çš„**\n    1. undue: `/ËŒÊŒnËˆdjuË/` adj. ä¸é€‚å½“çš„ï¼›è¿‡åº¦çš„\n# potent - potential - essential - patent\n\n1. potent: adj. æœ‰åŠ›çš„ï¼›çƒˆæ€§çš„\n   This is a very potent drug with little side-effect. è¯¥è¯æ•ˆåŠ›å¾ˆå¼ºï¼Œè€Œå‰¯ä½œç”¨å°ã€‚\n    1. potency: n. æ•ˆåŠ›, å½±å“åŠ›, æ”¯é…åŠ›\n    2. patent: n. ä¸“åˆ© adj. ä¸“åˆ©çš„ï¼›æ–°å¥‡çš„ï¼›æ˜¾ç„¶çš„ v. è·å¾—ä¸“åˆ©\n2. potential: adj. æ½œåœ¨çš„ n. æ½œåœ¨æ€§ã€å¯èƒ½æ€§\n3. essential: å…³é”®çš„\n    1. criticize: æ‰¹åˆ¤ - critical: æ‰¹åˆ¤æ€§çš„ï¼›å…³é”®çš„ï¼ˆrelating to or denoting a point of transition from one state to another. å…³äºæˆ–è¡¨ç¤ºä»ä¸€ç§çŠ¶æ€åˆ°å¦ä¸€ç§çŠ¶æ€çš„è¿‡æ¸¡ç‚¹ï¼‰\n# hint - hire - hut - hunt\n\n1. hint - æš—ç¤º\n    1. clue - çº¿ç´¢ï¼›æç¤º\n2. hire - ç§Ÿèµ - fire - è§£é›‡\n    1. lease: `/liËs/`n. ç§Ÿçº¦ï¼Œç§Ÿå¥‘ v. ç§Ÿç”¨ï¼Œç§Ÿå€Ÿï¼Œå‡ºç§Ÿ\n        1. lessee: `/le'siË/` n. æ‰¿ç§Ÿäºº, ç§Ÿæˆ·\n3. hut: å°å±‹\n4. hunt: v./n. çŒæ•ï¼›æœå¯»\n# çŒç‰©ï¼›æ å¤º\n\n1. hunt: v./n. çŒæ•ï¼›æœå¯»\n2. hound: `/haÊŠnd/` n. çŒçŠ¬ï¼›çŒç‹— v. çº ç¼ ï¼Œä¸æ–­éªšæ‰°\n3. prey: `/preÉª/` vi. æ•é£Ÿ - prey on ; n. å—å®³è€…ï¼›çŒç‰© - be/fall prey to/for sth. å—...çš„åå½±å“\n4. predator: `/ËˆpredÉ™tÉ™(r)/` n. æ•é£Ÿè€…ï¼›æ å¤ºè€…\n# monotonous - consonant\n\n1. monotonous: adj. å•è°ƒä¹å‘³çš„\n    1. monotone: adj. å•è°ƒçš„ n. å•è°ƒï¼›å•éŸ³è°ƒ vt. å•è°ƒåœ°è¯»\n2. consonance: n. ä¸€è‡´ã€åè°ƒï¼›åå’ŒéŸ³ç¨‹\n    1. consonant: adj. ä¸€è‡´çš„ã€å’Œè°çš„ n. è¾…éŸ³ï¼›è¾…éŸ³å­—æ¯\n        1. vowel: å…ƒéŸ³ï¼›å…ƒéŸ³å­—æ¯\n# obesity - obedient - observe - obsess\n\n1. obesity: è‚¥èƒ–ç—‡\n2. obedient: æœä»çš„\n    1. obey: æœä»\n        1. comply: `/kÉ™mËˆplaÉª/` vi. éµå®ˆã€æœä»\n            1. compliance: `/kÉ™mËˆplaÉªÉ™ns/` n. éµå®ˆã€æœä»\n        2. conform: `/kÉ™nËˆfÉ”Ëm/` vi. éšæ³¢é€æµï¼›éµä»ã€æœä»ï¼›ç›¸ç¬¦åˆ\n3. observe: v. è§‚æµ‹ã€è§‚å¯Ÿã€ç›‘è§†ï¼›éµå®ˆ\n    1. serv-, -serveã€æ‹‰ä¸ã€‘è¡¨ç¤ºâ€œçœ‹â€ï¼›â€œç»´æŠ¤ï¼Œä¿æŠ¤â€\n       è¯æ ¹åŠ©è®°ï¼šobservance: ob (=ab å»ï¼Œå¯¹) + serv = å»éµå®ˆ(æƒ¯ä¾‹ï¼Œä»ªå¼)\n       åŒæ ¹è¯conservation|conservative|deserve|observation|observe|preserve|reserve|observance|\n    2. observance: n. éµå®ˆ(è§„åˆ™ã€ä¼ ç»Ÿ)ï¼›(å®—æ•™çš„ã€æ­£å¼çš„)ä»ªå¼ã€æƒ¯ä¾‹\n        1. ritual: `/ËˆrÉªtÊƒuÉ™l/` n. ä»ªå¼ï¼›ç¤¼èŠ‚ç¨‹åº adj. ä¾‹è¡Œå…¬äº‹çš„\n            1. ritualism: `/'rÉªtjÊŠÉ™lÉªzÉ™m/` n. ä»ªå¼ä¸»ä¹‰\n4. obsess: `/É™bËˆses/` vt. ä½¿ç—´è¿· vi. æŒ‚å¿µï¼›æ‹…å¿ƒ\n   A lot of young girls obsess about their weight. è®¸å¤šå¹´è½»å¥³å­©éƒ½è¿‡äºæ‹…å¿ƒè‡ªå·±çš„ä½“é‡ã€‚\n    1. obsessive: adj. ç—´è¿·çš„\n    2. captive: adj. è¢«ä¿˜è·çš„ n. ä¿˜è™\n        1. captivating: adj. è¿·äººçš„ã€æœ‰å¸å¼•åŠ›çš„\n    3. seduce: `/sÉªËˆdjuËs/` v. è¯±éª—\n        1. seduction: `/sÉªËˆdÊŒkÊƒn/` n. è¯±æƒ‘åŠ›ã€é­…åŠ›\n    4. fascinate: `/ËˆfÃ¦sÉªneÉªt/` v. æ·±æ·±å¸å¼•ï¼›ä½¿ç€è¿·\n    5. beckon: `/ËˆbekÉ™n/` v. æ‹›æ‰‹å¸å¼•ã€è¯±æƒ‘\n    6. indulge: `/ÉªnËˆdÊŒldÊ’/` v. æ²‰è¿·äº vt. æ”¾çºµæŸäººã€æŸäº‹\n# transverse - traverse\n\n1. transverse: `/ËˆtrÃ¦nzvÉœËs/` adj. æ¨ªå‘çš„ï¼›æ¨ªæ–­çš„ï¼›æ¨ªåˆ‡çš„\n2. traverse: `/trÉ™ËˆvÉœËs/` v./n. æ¨ªç©¿\n# è’¸å‘ã€è’¸æ±½ã€å–·å‘\n\n1. vapor: è’¸æ±½\n2. evaporate: è’¸å‘ã€æ¶ˆå¤±\n    1. evaporation: è’¸å‘\n    2. evacuate: v. ç–æ•£ã€æ’¤ç¦»\n        1. evade: `/ÉªËˆveÉªd/` v. èº²é¿ã€é€ƒé¿\n3. steam: è’¸æ±½\n4. volcano: ç«å±±\n5. erupt: å–·å‘ã€çˆ†å‘\n    1. eruption\n# span - spin - skin\n\n1. span: n. ä¸€æ®µæ—¶é—´ï¼›æŒç»­æ—¶é—´ v. ï¼ˆæ—¶é—´ï¼‰æŒç»­ï¼›è·¨è¶Š - life span: å¯¿å‘½\n# è®®é¢˜ã€å®£å¸ƒ: issue - manifesto\n\n1. issue: n. å‘è¡Œç‰©ï¼›é—®é¢˜ v. å‘è¡Œ\n2. manifesto: n. å®£è¨€\n\t1. manifest: v. æ¸…æ¥šè¡¨æ˜ï¼›æ˜¾ç¤º\n    \t1. manifestation: n. æ˜¾ç°ã€æ˜¾çµï¼›è¡¨ç°\n# pecu - speculate - articulate - singular - odd - stipulate - queer\n\n1. peculiar: adj. å¤æ€ªçš„ï¼›ç‰¹æœ‰çš„\n    1. peculiarity: æ€ªç™–ï¼›æ€ªå¼‚ï¼›ç‰¹ç‚¹\n    2. singular: adj. å•æ•°çš„ï¼›å¥‡ç‰¹çš„ã€å¼‚å¸¸çš„\n        1. singularity: n. å¼‚å¸¸ã€å¥‡ç‰¹ï¼›ï¼ˆæ•°å­¦ã€ç‰©ç†ï¼‰å¥‡ç‚¹ï¼ˆé»‘æ´ä¸­å¿ƒï¼‰\n    3. odd: adj. æ€ªå¼‚çš„ï¼›å¥‡æ•°çš„ã€å•æ•°çš„\n        1. oddity: n. æ€ªå¼‚ç°è±¡\n    4. queer: adj. å¥‡æ€ªçš„ã€åå¸¸çš„ï¼›gayçš„ã€å¨˜çš„\n2. **speculation: n. çŒœæµ‹ï¼›æŠ•æœºä¹°å–**\n    1. speculative: adj. çŒœæµ‹çš„ã€æ£æ‘©çš„\n3. articulate: v. `/É‘ËËˆtÉªkjuleÉªt/` æµåˆ©åœ°è¡¨è¾¾ adj. `/É‘ËËˆtÉªkjÉ™lÉ™t/` å–„äºè¡¨è¾¾çš„\n4. stipulate: v. `/ËˆstÉªpjuleÉªt/` è§„å®šï¼›æ˜ç¡®è¦æ±‚\n    1. stipulation: `/ËŒstÉªpjuËˆleÉªÊƒn/` n. è§„å®šï¼›æ˜ç¡®è¦æ±‚\n# counter- å¯¹ç«‹: controversy\n\n1. counterpart: å¯¹ç«‹çš„äººï¼›å¯¹åº”çš„äººï¼›ï¼ˆèŒä½ã€ä½œç”¨ï¼‰ç›¸å½“çš„äºº\n2. counteract: `/kÉ™nËˆspaÉªÉ™(r)/` v. æŠµåˆ¶ã€æŠµæŠ—ï¼›æŠµæ¶ˆ\n3. encounter: v. é­é‡ï¼›ä¸â€¦å‘ç”Ÿå†²çª n. é­é‡ï¼›å†²çª\n    1. em-,en-ã€å¸Œè…Šã€‘è¿›å…¥ï¼Œå‘å†…ï¼›ä½¿æˆä¸º\n       è¯æ ¹åŠ©è®°ï¼šencounter: enè¿›å…¥+ counterå¯¹ç«‹= è¿›å…¥å¯¹ç«‹çŠ¶æ€= é­é‡ï¼Œå†²çª\n       åŒæ ¹è¯encounter|enlighten|\n    2. contra-, contro-, counter, contre-ã€æ‹‰ä¸ã€‘å¯¹ç«‹\n       åŒæ ¹è¯encounter|contradiction|contrast|contradict|counterpart|contradictory|contraband|\n3. **contrast: n. åå·®**\n    1. **contract: n. åˆåŒã€å¥‘çº¦ v. æ”¶ç¼©ã€ç¼©ç´§**\n        1. contradict: v. åé©³ã€å¦è®¤\n            1. contradiction: n. çŸ›ç›¾ã€å¯¹ç«‹\n4. contrary: adj. ç›¸åçš„ï¼Œæˆªç„¶ä¸åŒçš„ n. ç›¸å - on the contraryæ­£ç›¸å\n5. controversy: n. äº‰è®ºã€äº‰è®®\n    1. controversial: adj. å¼•èµ·äº‰è®ºçš„ã€æœ‰äº‰è®®çš„\n6. antagonist: `/Ã¦nËˆtÃ¦É¡É™nÉªst/` n. å¯¹æ‰‹ï¼›æ•Œäºº\n    1. foe: n. æ•Œäºº\n    2. opponent: `/É™ËˆpÉ™ÊŠnÉ™nt/` n. å¯¹æ‰‹ï¼›æ•Œäºº\n# explore - explode/explosion - expedition - expedience\n\n1. explore: æ¢ç´¢ï¼ˆé™©ï¼‰\n2. expedition: æ¢é™©\n3. explode - explosion - çˆ†ç‚¸\n    1. blast: n. & v. çˆ†ç‚¸ - blasted: adj. å¯æ¶çš„\n4. expedience: n. æ–¹ä¾¿ï¼Œç§ç«‹ï¼Œæƒå®œä¹‹è®¡ï¼›ä¸å¾—å·²è€Œåšçš„äº‹æƒ…\n   for expedienceâ€˜s sake æƒå®œä¹‹è®¡\n    1. As a matter of expedience, our company will not recruit new staff this year. å‡ºäºæƒå®œä¹‹è®¡ï¼Œæˆ‘ä»¬å…¬å¸ä»Šå¹´ä¸å†æ‹›è˜æ–°å‘˜å·¥ã€‚\n# mosque - mosquito - monastery\n\n1. mosque: æ¸…çœŸå¯º\n2. mosquito: èšŠå­\n3. monastery: n. ä¿®é“é™¢ï¼›åº™å®‡\n# å¯è§‚çš„ã€å¤§é‡çš„ã€å·¨å¤§çš„ã€ä¸€ç¾¤\n\n1. spectacle: å£®è§‚æ™¯è±¡ - spectacular adj. å£®è§‚çš„\n2. considerable: å¤§é‡çš„ - considerably: ç›¸å½“åœ°ï¼›éå¸¸ - inconsiderable: å¾®å°çš„ï¼›ä»·å€¼ä½çš„ï¼›ä¸å€¼å¾—è€ƒè™‘çš„\n    1. considerate: ä½“è°…çš„ï¼›è€ƒè™‘äº†çš„ï¼›è€ƒè™‘å‘¨å…¨çš„ - inconsiderate: è€ƒè™‘ä¸å‘¨çš„\n3. abundant: `/É™ËˆbÊŒndÉ™nt/` adj. å¤§é‡çš„\n    1. abandon: `/É™ËˆbÃ¦ndÉ™n/` é—å¼ƒ\n    2. redundant: `/rÉªËˆdÊŒndÉ™nt/` adj. è¢«è£å‡çš„ï¼›å¤šä½™çš„\n        1. redundancy: n. è£å‘˜ã€è§£é›‡ï¼›å†—ä½™\n4. myriad: adj. æ— æ•°çš„ n. æ— æ•°ï¼›å¤§é‡\n5. plentiful\n6. extensive: adj. å¤§é‡çš„\n7. enormous: å·¨å¤§çš„ã€åºå¤§çš„\n8. overwhelming: adj. å·¨å¤§çš„ï¼›å‹å€’æ€§çš„ã€æ— æ³•æŠ—æ‹’çš„ - overwhelmingly: adv. å‹å€’æ€§åœ°\n9. fabulous: `/ËˆfÃ¦bjÉ™lÉ™s/` adj. å·¨å¤§çš„ï¼›æå¥½çš„\n10. chunk: n. ç›¸å½“å¤§çš„éƒ¨åˆ†ã€æ•°é‡ï¼›å¤§å—\n11. substantial\n12. monumental: adj. é‡è¦çš„ã€æ„ä¹‰æ·±è¿œçš„ã€ä¸æœ½çš„ï¼›éå¸¸å¤§çš„\n    1. monument: n. çºªå¿µç¢‘ï¼›å…¸èŒƒ\n    2. instrumental: `/ËŒÉªnstrÉ™Ëˆmentl/` adj. èµ·é‡è¦ä½œç”¨çš„ï¼›å™¨ä¹çš„\n13. magnitude: n. å·¨å¤§\n14. immense: adj. æå¤§çš„ï¼›å·¨å¤§çš„\n    1. immensely: adv. æå¤§åœ°ï¼›æç«¯åœ°\n    2. immensity: n. å·¨å¤§\n15. immerse: v. æ²‰æµ¸\n    1. immersion: n. æ²‰æµ¸ï¼›ä¸“å¿ƒ\n## å›¢ã€ç¾¤: mass - swarm - regiment\n\n1. mass: n. ä¸€å¤§ç¾¤ï¼›å¤§é‡\n    1. massive: adj. å¤§è€Œé‡çš„ï¼›ç»“å®çš„\n    2. massacre: `/ËˆmÃ¦sÉ™kÉ™(r)/` n./v. å¤§å± æ€\n        1. slaughter: `/ËˆslÉ”ËtÉ™(r)/` n./v. å± å®°ã€å± æ€\n    3. mess: n. æ‚ä¹±\n2. swarm: n. ä¸€å¤§ç¾¤ï¼ˆèœœèœ‚ç­‰æ˜†è™«ï¼‰, ä¸€å¤§æ‰¹ï¼ˆå‘åŒæ–¹å‘ç§»åŠ¨çš„äººï¼‰ v. æˆç¾¤åœ°æ¥å›ç§»åŠ¨, æˆç¾¤åœ°é£æ¥é£å»\n3. regiment: n. ï¼ˆå†›é˜Ÿçš„ï¼‰å›¢ï¼›ä¸€å¤§ç¾¤äººï¼ˆæˆ–äº‹ç‰©ï¼‰\n4. multitude: n. å¤§é‡ï¼›ä¸€å¤§ç¾¤äºº\n5. flock: n. ä¸€ç¾¤ v. èœ‚æ‹¥è€Œè‡³\n    1. block: n. ä¸€å¤§å—\n6. herd: n. å…½ç¾¤ - a herd of: ä¸€ç¾¤\n    1. hurdle: n. è·¨æ æ¯”èµ›ä¸­çš„æ æ¶\n    2. herb: n. è¯è‰ï¼›è‰æœ¬æ¤ç‰©\n        1. herbal: adj. è¯è‰çš„\n# è€ƒè™‘\n\n1. ponder: v. æ²‰æ€ï¼›ç¢ç£¨ï¼›è€ƒè™‘\n    1. fond: adj. å–œæ¬¢çš„ï¼›æ¸´æœ›çš„ - fonderï¼ˆæ¯”è¾ƒçº§ï¼‰\n2. consider: v. è€ƒè™‘\n3. contemplate: v. è€ƒè™‘\n    1. contemplative: `/kÉ™nËˆtemplÉ™tÉªv/, /ËˆkÉ’ntÉ™mpleÉªtÉªv/` adj. æ·±æ€ç†Ÿè™‘çš„\n    2. contemplation: `/ËŒkÉ’ntÉ™mËˆpleÉªÊƒn/` n. æ·±æ€ã€æ²‰æ€ï¼›å‡è§†\n    3. contempt: n. è½»è§†ï¼Œè”‘è§†ï¼›è€»è¾±\n4. given: prep.(preposition) è€ƒè™‘åˆ°ï¼›é‰´äº adj. æ—¢å®šçš„\n   Given his age, he's a remarkably fast swimmer. è€ƒè™‘åˆ°ä»–çš„å¹´é¾„ï¼Œä»–å¯ç§°å¾—ä¸Šæ˜¯ä¸ªå¾ˆå‡ºä¼—çš„æ¸¸æ³³é€‰æ‰‹äº†ã€‚\n# -ct-\n## -spect-ã€-cular\n\n1. spectacle: å£®è§‚æ™¯è±¡ - spectacular adj. å£®è§‚çš„\n2. spectrum: n. å…‰è°±ï¼Œå£°è°±ï¼Œé¢‘è°±ï¼›èŒƒå›´ï¼Œå¹…åº¦ï¼›ç³»åˆ—ï¼Œå±‚æ¬¡\n3. prospect: n. å¯èƒ½æ€§ã€å¸Œæœ›ï¼›å‰æ™¯ã€å‰é€” vi. å‹˜æ¢ï¼›å‹˜å¯Ÿ\n## reluctant\n\n1. reluctant: ä¸æƒ…æ„¿\n   The arrogant runner conceded defeat reluctantly. è¿™ä½å‚²æ…¢çš„è·‘æ­¥è¿åŠ¨å‘˜å¾ˆä¸æƒ…æ„¿åœ°æ‰¿è®¤äº†å¤±è´¥ã€‚\n    1. reluctance: n. ä¸æƒ…æ„¿\n## punctual - punctuality\n\n1. punctual: adj. å‡†æ—¶çš„ï¼Œå®ˆæ—¶çš„ï¼›ç²¾ç¡®çš„\n\t1. punctuality: n. ä¸¥å®ˆæ—¶é—´, æ•æ·\n\t   punctuality is a precious quality: å®ˆæ—¶æ˜¯ä¸€ç§çè´µçš„å“è´¨ã€‚\n2. punctuate: æ‰“æ–­ï¼›åŠ æ ‡ç‚¹\n\t1. punctuation: æ ‡ç‚¹ç¬¦å·ï¼›æ‰“æ–­\n\t2. perpetuate: `/pÉ™ËˆpetÊƒueÉªt/` v. ä½¿æŒä¹…åŒ–\n# æ­£ç›´ï¼›å‚ç›´: erect - vertical - upright\n\n```\nrecti-, rect-ã€æ‹‰ä¸ã€‘è¡¨ç¤ºâ€œæ­£ï¼Œç›´â€ï¼›â€œå¼•å¯¼â€ï¼›â€œç»Ÿæ²»â€\nè¯æ ¹åŠ©è®°ï¼šerection:eä¸Š+rect=ç›´ç«‹å‘ä¸Š\nåŒæ ¹è¯correct|correction|direct|direction|director|erect|incorrect|erection|\n```\n1. erect: v. å»ºç«‹ï¼›å»ºé€ ï¼›ç«–èµ· adj. å‚ç›´çš„ï¼Œç«–ç›´çš„ï¼Œç›´ç«‹çš„\n    1. vertical: adj. å‚ç›´çš„\n    2. upright: `/ËˆÊŒpraÉªt/` adj./adv./n. ç›´ç«‹çš„ï¼›ï¼ˆäººï¼‰æ­£ç›´çš„ã€è¯šå®çš„\n    3. erection: n. å»ºé€ ; ç«–ç«‹; ç«–ç«‹ç‰©; å»ºç­‘ç‰©\n\n# é¢„å…†ã€é¢„å…ˆã€é¢„è¨€ã€é¢„æµ‹\n\n1. herald: `/ËˆherÉ™ld/` vt. æ˜¯...çš„é¢„å…†ã€é¢„ç¤ºç€... n. é¢„å…†\n2. predict: é¢„æµ‹\n3. presume: v. æ¨æµ‹ï¼›å‡è®¾\n4. proforma: adj. é¢„è®¡çš„ n. ä¼°ä»·å•\n5. presentiment: n. é¢„æ„Ÿ, ï¼ˆå°¤æŒ‡ï¼‰ä¸ç¥¥ä¹‹æ„Ÿ\n6. propose: v. è®¡åˆ’ï¼›æè®®ï¼›æ±‚å©š - proposal: n. æå‡ºã€æè®®ï¼›è®¡åˆ’ï¼›ææ¡ˆï¼›æ±‚å©š\n7. prospect: n. å¯èƒ½æ€§ã€å¸Œæœ›ï¼›å‰æ™¯ã€å‰é€” vi. å‹˜æ¢ï¼›å‹˜å¯Ÿ\n    1. late Middle English (as a noun denoting the action of looking towards a distant object): from Latin `prospectus â€˜viewâ€™`, from `prospicere â€˜look forwardâ€™`, from `pro- â€˜forwardâ€™` + `specere â€˜to lookâ€™`. Early use, referring to a view of landscape, gave rise to the meaning â€˜mental pictureâ€™ (mid 16th cent.), which led to the meaning â€˜anticipated eventâ€™.\n8. earmark: v. æŒ‡å®šï¼ˆæ¬¾é¡¹ï¼‰ç”¨é€”ï¼›é¢„å…ˆå®‰æ’ï¼ˆè¦åšçš„äº‹ï¼‰ï¼›ç¡®å®šï¼ˆæœªæ¥å‘ç”Ÿçš„äº‹ï¼‰ n. æ ‡è®°ï¼›ç‰¹å¾\n9. prophet: n. é¢„è¨€å®¶, å…ˆçŸ¥\n    1. Middle English: from Old French `prophete`, via Latin from Greek `prophÄ“tÄ“s â€˜spokesmanâ€™`, from `pro â€˜beforeâ€™` + `phÄ“tÄ“s â€˜speakerâ€™` (from `phÄ“nai â€˜speakâ€™`).\n# æå‡º\n\n1. propose: v. è®¡åˆ’ï¼›æè®®ï¼›æ±‚å©š - proposal: n. æå‡ºã€æè®®ï¼›è®¡åˆ’ï¼›ææ¡ˆï¼›æ±‚å©š\n2. present: v. å‘ˆç°ï¼›ä»‹ç»ï¼›æå‡ºï¼›èµ é€ adj. å‡ºå¸­çš„ï¼›ç°åœ¨çš„ n. ç°åœ¨ï¼›ç¤¼ç‰©ï¼›ç„å‡†\n    1. presence: n. å‡ºå¸­\n    2. presentation: n. æä¾›ï¼›æ˜¾ç¤ºï¼›å¤–è§‚ï¼›æˆäºˆï¼ˆç‰©ï¼‰ï¼›èµ é€ï¼ˆä»ªå¼ï¼‰ï¼›æŠ¥å‘Šï¼›è¡¨æ¼”\n3. lodge: `/lÉ’dÊ’/`v. ï¼ˆå‘æœºæ„ï¼‰æ­£å¼æå‡ºï¼ˆå£°æ˜ï¼‰ï¼›å€Ÿå®¿ï¼Œç§Ÿä½ï¼›ä¸º...æä¾›ä½å®¿ï¼›å¯„å­˜ï¼Œå­˜æ”¾ï¼Œä½¿å›ºå®šã€åµŒå…¥ n. ä¼ è¾¾å®¤ã€ç®¡ç†å‘˜å®¤ï¼›é—¨æˆ¿, æ—…é¦†ï¼›ä¹¡é—´å°å±‹\n4. sponsor: n. èµåŠ©è€…ï¼›ï¼ˆæ³•æ¡ˆçš„ï¼‰å‘èµ·è€… v. èµåŠ©ï¼›å‘èµ·ï¼ˆææ¡ˆã€è®®æ¡ˆï¼‰\n\t1. patronage: `/ËˆpeÉªtrÉ™nÉªdÊ’/` n. èµåŠ©ï¼›æƒ é¡¾ = sponsorship\n    \t1. patron: `/ËˆpeÉªtrÉ™n/` n. èµåŠ©è€…ã€èµ„åŠ©äºº\n        \t1. patronize: `/ËˆpeÉªtrÉ™naÉªz/` v. æ‘†å‡ºé«˜äººä¸€ç­‰çš„æ´¾å¤´\n        \t2. patrol: `/pÉ™ËˆtrÉ™ÊŠl/` n./v. å·¡é€»\n    2. endow: `/ÉªnËˆdaÊŠ/` v. èµ„åŠ©ã€æèµ ï¼›ç»™äºˆã€èµ‹äºˆï¼›å…·æœ‰\n    3. subsidize: `/ËˆsÊŒbsÉªdaÉªz/` v. èµ„åŠ©\n        1. subsidy: `/ËˆsÊŒbsÉ™di/` n. æ”¿åºœè¡¥è´´ã€è¡¥åŠ©é‡‘\n    4. spouse: n. é…å¶ - spouses: n. å¤«å¦‡ - spousal: n. ç»“å©š\n    \t1. æ‹‰ä¸è¯æ ¹ï¼šspous-: æ–°éƒï¼›æ–°å¨˜ï¼›è®¢å©š\n# even\n\n1. even: adv. ç”šè‡³ adj. å¹³å¦çš„ï¼›å‡åŒ€çš„ï¼›åŒæ•°çš„ï¼Œå¶æ•°çš„ v. ä½¿å¹³å¦ã€å¹³å‡ - evenly: adv. å‡åŒ€åœ°ï¼›å…¬å¹³åœ°\n    1. uneven: ä¸å¹³å¦çš„ï¼›å‡¹å‡¸ä¸å¹³çš„ï¼›ä¸è§„åˆ™çš„\n# surrender - surround\n\n1. surrender: v./n. å±ˆæœï¼›è®©æ­¥ï¼›æŠ•é™\n    1. give up\n2. surround: å›´ç»•\n# host - hostile - hustle - hasten - retaliate\n\n1. host: ä¸»äºº\n2. hostile: æ€€æœ‰æ•Œæ„çš„\n    1. hostility: n. ä¸å‹å–„ï¼›æ•Œæ„\n3. hustle: v. æ¨æ¡ï¼›å‚¬ä¿ƒ - ç±»ä¼¼äºurge\n4. haste: n. åŒ†å¿™ï¼›æ€¥å¿™ï¼›è½»ç‡ vi. åŒ†å¿™ï¼›èµ¶ç´§ vt. èµ¶å¿«\n    1. hasty: adj. ä»“ä¿ƒå®Œæˆçš„, æ€¥å¿™çš„, æ€¥é€Ÿçš„ï¼›è‰ç‡çš„, è½»ç‡çš„\n        1. nasty: adj. ç³Ÿç³•çš„\n    2. hasten: `/'heÉªsn/` v. ä¿ƒè¿›, æ€¥å¿™è¿›è¡Œ, èµ¶ç´§è¯´ï¼ˆæˆ–åšï¼‰, ä½¿åŠ å¿«\n5. retaliate: `/rÉªËˆtÃ¦lieÉªt/` vi. æŠ¥å¤ã€å¤ä»‡ï¼›åå‡»\n    1. retaliation: `/rÉªËŒtÃ¦liËˆeÉªÊƒn/` n. æŠ¥å¤\n    2. revenge: `/rÉªËˆvendÊ’/` n. å¤ä»‡ã€æŠ¥å¤\n        1. vengeance: `/ËˆvendÊ’É™ns/` n. æŠ¥ä»‡ã€å¤ä»‡\n# blunt\n\n1. blunt: adj. é’çš„ï¼›ç‡ç›´çš„\n    1. bluntly: ç›´æˆªäº†å½“åœ°\n# hare - bare\n\n1. hare: n. é‡å…” v. é£è·‘ï¼›ç–¾èµ°\n2. bare: adj. å…‰ç§ƒç§ƒçš„, æ— é®è”½çš„ï¼›èµ¤è£¸çš„ï¼›åˆšå¥½å¤Ÿçš„, å‹‰å¼ºçš„\n# è½®å»“ï¼›å¤–å½¢ï¼›æ¦‚è¿°\n\n1. profile\n2. generalization\n3. figure\n    1. å›¾å½¢ï¼›æ•°å­—ï¼›ä½“å½¢ï¼›ç”»åƒ\n    2. è®¡ç®—ï¼›è®¤ä¸ºï¼›æç»˜ - figure out\n4. embody: `/ÉªmËˆbÉ’di/` v. ä½¿å…·ä½“åŒ–ï¼›ä½“ç°\n   She embodies her principles in her behavior. å¥¹æŠŠè‡ªå·±çš„åŸåˆ™ä½“ç°åœ¨è¡ŒåŠ¨ä¸­ã€‚\n    1. embodiment: n. å…¸å‹ï¼›åŒ–èº«\n# è¯„ä¼°ï¼›è¯„ä»·\n\n1. evaluate - evaluation\n    1. elevate: vt. ä¸¾èµ·ï¼›æå‡ï¼›æŒ¯å¥‹æƒ…ç»ªç­‰ï¼›æå‡â€¦çš„èŒä½\n    2. evacuate: v. æ’¤ç¦»ã€æ’¤å‡ºï¼›è½¬ç§»ã€æ’ç©º\n2. estimate\n3. rate\n# deduce - conclude - conduce - exclude - induce - include - delusive\n\n```\nclud-,clusã€æ‹‰ä¸ã€‘è¡¨ç¤ºâ€œå…³â€\nè¯æ ¹åŠ©è®°ï¼šexclude:exå¤–+cludå…³=å…³åœ¨å¤–é¢=æ’é™¤åœ¨å¤–\nåŒæ ¹è¯preclude|conclude|exclude|seclude|occlude|\nclud-, claud-, claus-, clos-, -clude, -clois, -cluding, -cluded, -clus, -clusion, -clusiveã€æ‹‰ä¸ã€‘å…³é—­\nè¯æ ¹åŠ©è®°ï¼šexclude:exå¤–+cludå…³=å…³åœ¨å¤–é¢=æ’é™¤åœ¨å¤–\nåŒæ ¹è¯preclude|cloister|close|conclude|conclusion|exclude|include|\n```\n1. deduce: v. æ¨æ–­, æ¼”ç», æ¨è®º\n    1. æ˜“æ··è¯ï¼šdeduct: vt. æ‰£é™¤ï¼Œå‡å»ï¼›æ¼”ç»\n    2. deduction: n. æ‰£é™¤, å‡é™¤ï¼›æ‰£é™¤çš„é‡ï¼›æ¨æ¼”, æ¨ç†ï¼›ç»“è®º\n2. conclude: vt. ç»“æŸï¼›æ¨æ–­ï¼›å†³å®šï¼Œä½œç»“è®º vi. å†³å®šï¼›æ¨æ–­ï¼›æ–­å®š\n3. conduce: `/kÉ™n'djuËs/` vi. æœ‰ç›Šäºã€å¯¼è‡´\n    1. conducive: adj. æœ‰ç›Šäº...çš„ï¼›ä½¿...å®¹æ˜“å‘ç”Ÿçš„\n4. exclude: v. ä¸åŒ…æ‹¬ï¼Œæ’é™¤ï¼›æ’æ–¥\n    1. include: åŒ…æ‹¬\n    2. exclusive: adj. ä¸“æœ‰çš„ï¼›æ’å¤–çš„ n. ç‹¬å®¶æ–°é—»ã€ç‹¬å®¶æŠ¥é“\n        1. exclusivity: n. æ’ä»–æ€§ï¼›ä¸“æœ‰æƒï¼›ç‹¬ç‰¹æ€§\n5. induce: v. è¯±ä½¿ï¼Œå¼•è¯±ï¼›å¼•èµ·ï¼Œå¯¼è‡´ï¼›å‚¬ç”Ÿ\n    1. inducement: n. è¯±å› ï¼›åˆºæ¿€\n    2. lure: `/lÊŠÉ™(r)/` v./n. è¯±æƒ‘ã€å¼•è¯±ï¼›é¥µ\n       The lure of fame and money tends to make people commit crimes. åä¸åˆ©çš„è¯±æƒ‘å¯èƒ½ä¼šå¼•äººçŠ¯ç½ªã€‚\n        1. allure: `/É™ËˆlÊŠÉ™(r)/` n. è¯±æƒ‘åŠ›ã€å¸å¼•åŠ›\n    3. incent: vt. åˆºæ¿€...é‡‡å–è¡ŒåŠ¨ï¼›æ¿€åŠ±\n        1. incentive: `/ÉªnËˆsentÉªv/` n. åˆºæ¿€ã€æ¿€åŠ±ï¼›æ¿€åŠ±å¥–é‡‘ã€æ¿€åŠ±æ€§å‡å…ä¼˜æƒ ã€è®©åˆ©\n1. include: v. åŒ…æ‹¬ - inclusive: adj. åŒ…å«åœ¨å†…çš„ï¼›åŒ…ç½—ä¸‡è±¡çš„ï¼ŒèŒƒå›´å¹¿æ³›çš„\n2. delusive: adj. æ¬ºç’çš„ï¼›ä½¿è¿·æƒ‘çš„\n    1. early 17th cent.: from Latin `delus- â€˜mockedâ€™`, from the verb `deludere â€˜to mockâ€™`, (from `de- (with pejorative force)` + `ludere â€˜to playâ€™`) + -ive.\n# demand - demonstrate - demographic\n\n1. demand: v./n. è¦æ±‚ï¼›éœ€è¦\n2. demonstrate: v. æ¼”ç¤ºï¼›æ¼”ç¤ºï¼›è¯æ˜ï¼›ç¤ºå¨\n3. demographic: `/ËŒdemÉ™ËˆÉ¡rÃ¦fÉªk/` n. äººå£ç»Ÿè®¡æ•°æ® adj. äººå£å­¦çš„\n4. amend: `/É™Ëˆmend/` v. ä¿®æ­£ï¼›ä¿®è®¢ï¼›èµ”å¿ã€èµ”ç½ª\n# ä¸¥å‰ã€ä¸¥è‹›ã€ä¸¥é‡ï¼›åº„ä¸¥ã€å°Šä¸¥\n\n1. harsh: ä¸¥é…·çš„ï¼›æ¶åŠ£çš„ï¼›ç²—ç³™çš„\n   Harsh weather conditions shaped people's lifestyles. æ¶åŠ£çš„å¤©æ°”çŠ¶å†µå¡‘é€ äº†äººä»¬çš„ç”Ÿæ´»æ–¹å¼ã€‚\n2. severe\n3. cruel\n4. rough\n5. tough\n6. rigor: n. ä¸¥è°¨ã€ä¸¥æ ¼ã€ä¸¥å‰ï¼›è‰°è¾›ã€ä¸¥é…·\n    1. rigorous: adj. è°¨æ…çš„ï¼›ç»†è‡´çš„ï¼›ä¸¥æ ¼çš„ï¼›ä¸¥å‰çš„\n    2. rigid: adj. ä¸¥æ ¼çš„ï¼›åƒµç¡¬çš„ï¼Œæ­»æ¿çš„ï¼›åšç¡¬çš„ï¼›ç²¾ç¡®çš„\n7. grim: adj. ä¸¥è‚ƒçš„ã€ä¸¥é…·çš„ã€ä¸¥è‹›çš„ã€æ— æƒ…çš„ï¼›ä»¤äººæ²®ä¸§çš„ã€ä»¤äººæ‹…å¿§çš„\n8. solemnity: `/sÉ™ËˆlemnÉ™ti/` n. åº„ä¸¥ã€éƒ‘é‡\n9. sober: `/ËˆsÉ™ÊŠbÉ™(r)/` adj. æ²¡å–é†‰çš„ï¼›å†·é™çš„ã€æ¸…é†’çš„ v. ä½¿å†·é™\n3. dignity: `/ËˆdÉªÉ¡nÉ™ti/` n. åº„é‡ã€åº„ä¸¥ã€å°Šä¸¥ï¼›å°Šè´µã€é«˜è´µã€é«˜å°š\n# ç¤¼è²Œ\n\n1. courtesy: `/'kÉœËtÉ™si/` n. ç¤¼è²Œï¼Œè°¦æ­ï¼›å®¢æ°”è¯ adj. å…è´¹ä½¿ç”¨çš„; å‡ºäºç¤¼èŠ‚çš„\n    1. Middle English: from Old French `cortesie`, from `corteis`, based on Latin `cohors â€˜yard, retinueâ€™`.\n    2. court: `/kÉ”Ët/` n. æ³•é™¢\n2. manner: n. æ–¹å¼, æ–¹æ³•ï¼›æ€åº¦ï¼›ç¤¼è²Œ, è§„çŸ©ï¼›(äººæˆ–ç‰©çš„)ç§ç±»\n# -ff\n\n1. stiff: adj. ä¸æ˜“å¼¯æ›²çš„ï¼›ç¡¬çš„ï¼›æŒºç›´çš„ï¼›åƒµç¡¬çš„ adv. éå¸¸ï¼›æå…¶ v. ä¸ç»™å°è´¹\n2. cliff: n. ï¼ˆå¸¸æŒ‡æµ·æ´‹è¾¹çš„ï¼‰æ‚¬å´–\n3. scoff: v. å˜²ç¬‘ï¼›è®¥è®½ï¼›ç‹¼åè™å’½\n## stuff - staff = crew\n\n1. stuff: `/stÊŒf/` n. ä¸œè¥¿\n2. staff: `è‹± /stÉ‘Ëf/ ç¾ /stÃ¦f/` n. å…¨ä½“å‘˜å·¥\n    1. crew: `/kruË/` n. å…¨ä½“å·¥ä½œäººå‘˜\n        1. brew: v. é…¿é€ ï¼ˆå•¤é…’ï¼‰\n            1. brewery: `/ËˆbruËÉ™ri/` n. å•¤é…’å‚\n        2. screw: `/skruË/` v. ç”¨èºä¸å›ºå®šã€æ‹§ç´§ n. èºä¸é’‰\n            1. shrewd: `/ÊƒruËd/` adj. ç²¾æ˜çš„ã€æ•é”çš„ï¼›é«˜æ˜çš„\n# å¿ƒæƒ…ã€æƒ…ç»ª\n\n## æ„¤æ€’ã€æ€¨æ¨\n\n1. resent: `/rÉªËˆzent/` vt. å¯¹â€¦æ„Ÿåˆ°æ„¤æ€’\n    1. resentful: adj. æ„Ÿåˆ°æ„¤æ¨çš„\n2. irritation: `/ËŒÉªrÉªËˆteÉªÊƒn/` n. åˆºæ¿€ï¼›åˆºæ¿€ç‰©ï¼›æ¿€æ€’\n    1. irritate: v. ä½¿çƒ¦æ¼ï¼›åˆºæ¿€\n    2. irrigation: n. çŒæº‰\n    3. agitation: `/ËŒÃ¦dÊ’ÉªËˆteÉªÊƒn/` n. ç„¦è™‘ä¸å®‰ã€çƒ¦ä¹±ï¼›éªšåŠ¨ã€ç…½åŠ¨\n3. outrage: n. æ„¤æ€’ï¼›æš´è¡Œ v. æ¿€æ€’\n    1. rage: `/reÉªdÊ’/` n. æš´æ€’ã€ç‹‚æ€’ v. çŒ›çƒˆè¿›è¡Œ\n4. grudge: n. æ€¨æ¨ï¼›å«Œéš™ v. ä¸æƒ…æ„¿åœ°åš...\n5. malice: `/ËˆmÃ¦lÉªs/` n. æ¶æ„ï¼›æ€¨æ¨\n    1. Middle English: via Old French from Latin `malitia, from malus â€˜badâ€™`.\n    2. spite: `/spaÉªt/` n. æ¶æ„ï¼›æ€¨æ¨ = malice\n        1. in spite of: å°½ç®¡ï¼›ä¸ç®¡ã€ä¸é¡¾\n    3. malicious: adj. æ¶æ„çš„\n    4. **menace: `/ËˆmenÉ™s/` n. å¨èƒï¼›å±é™©çš„äºº**\n6. vex: vt. ä½¿çƒ¦æ¼ï¼›ä½¿è‹¦æ¼ï¼›ä½¿ç”Ÿæ°”\n7. exasperate: v. ä½¿çƒ¦æ¼ã€ä½¿æ¼æ€’ adj. è¢«æ¿€æ€’çš„\n   asperã€æ‹‰ä¸ã€‘ç²—ç³™ï¼›å›°éš¾\n   åŒæ ¹è¯exasperate|asperity|exasperation|exasperated|\n8. dismay: n. æ²®ä¸§ï¼Œç»æœ›ï¼Œç°å¿ƒ v. ä½¿æƒŠæ„•ï¼›ä½¿ç°å¿ƒï¼Œä½¿å¤±æœ›\n    1. frustrate: v.ï¼ˆå°¤æŒ‡å› æ— æ³•æ”¹å˜æˆ–å®ç°æŸäº‹è€Œï¼‰ä½¿å¿ƒçƒ¦ï¼›ä½¿æ¼æ€’\n      The frustrating thing about innovation is that there are many approaches, but no magic formula. å…³äºåˆ›æ–°ä»¤äººæ²®ä¸§çš„æ˜¯ï¼Œåˆ›æ–°æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œå´æ²¡æœ‰é‚£ç§å¥‡å¦™çš„ç¨‹å¼æ–¹æ¡ˆã€‚\n    2. infrastructure: n. åŸºç¡€è®¾æ–½\n9. distress: n. ç—›è‹¦ï¼›æ‚²ä¼¤ v. ä½¿æ‚²ä¼¤ï¼›ä½¿è‹¦æ¼\n10. disdain: v. è”‘è§†\n    1. scorn: è”‘è§†\n        1. scold: v. éª‚, è´£å¤‡, æ•°è½, å¥šè½\n## ç„¦è™‘ã€çƒ¦æ¼ã€ç—›è‹¦ã€æ‹…å¿§ã€å¿§è™‘ã€å“€æ‚¼\n\n1. weo: n. éº»çƒ¦ï¼›é—®é¢˜ï¼›ç—›è‹¦ã€è‹¦æ¼ï¼›æ‚²ä¼¤\n    1. woeful: adj. ç³Ÿç³•çš„ï¼›ä¸¥é‡çš„ï¼›ä¸åˆæ„çš„ï¼›æ‚²æƒ¨çš„\n        1. nasty: `è‹± /ËˆnÉ‘Ësti/ ç¾ /ËˆnÃ¦sti/` adj. ç³Ÿç³•çš„\n        2. atrocious: `/É™ËˆtrÉ™ÊŠÊƒÉ™s/` adj. ç³Ÿç³•çš„\n    2. thorny: `/ËˆÎ¸É”Ëni/` adj. æ£˜æ‰‹çš„ã€éº»çƒ¦çš„ï¼›æœ‰åˆºçš„\n2. anxiety: n. ç„¦è™‘\n3. agony: n. æåº¦ç—›è‹¦ - agonize: v. è‹¦è‹¦æ€ç´¢ï¼›ç„¦è™‘ä¸å·²\n    1. annoy: vt. ä½¿æ¼æ€’ã€ä½¿ç”Ÿæ°”\n        1. anonymity: n. åŒ¿å\n            1. anonymous: adj. åŒ¿åçš„\n4. perturb: v. ä½¿ç„¦è™‘ï¼›ä½¿ä¸å®‰ - perturbed: adj. ç„¦è™‘çš„\n5. dread: v. å®³æ€•ï¼›æ‹…å¿ƒ n. ææƒ§\n    1. dreadful: adj. ç³Ÿç³•çš„ï¼›å¯æ€•çš„ï¼›æå…¶çš„\n6. vex: v. ä½¿æ¼ç«, ä½¿çƒ¦æ¼, ä½¿å¿§è™‘\n7. fluctuate: vi. æ³¢åŠ¨ï¼›èµ·ä¼\n\t1. fluctuation: n. æ³¢åŠ¨,æ¶¨è½,èµ·ä¼\n\t2. punctuation: æ ‡ç‚¹ç¬¦å·ï¼›æ‰“æ–­\n        1. punctuality: æ•æ·ï¼›å‡†æ—¶\n8. preoccupy: v. if something is preoccupying you, you think or worry about it very often or all the time ä½¿æ—¥å¤œæ€è€ƒï¼›ä½¿å¿§å¿ƒå¿¡å¿¡\n   Thoughts of failure preoccupied him. å¤±è´¥çš„æƒ³æ³•å›°æ‰°ç€ä»–ã€‚\n9. grieve: `/É¡riËv/` v. ä¸º...ä¼¤å¿ƒã€å“€æ‚¼\n    1. grief: n. æ‚²ä¼¤ã€å“€æ‚¼\n10. harassment: n. `/ËˆhÃ¦rÉ™smÉ™nt/` ä¾µæ‰°ï¼›éªšæ‰°\n    1. racial/sexual harassment ç§æ—ä¾µæ‰°ï¼›æ€§éªšæ‰°\n    2. hound: v. çº ç¼ ï¼›ä¸æ–­éªšæ‰°\n    3. plague: `/pleÉªÉ¡/` vt. æŠ˜ç£¨ã€çº ç¼  n. ç˜Ÿç–«\n    4. ordeal: n. æŠ˜ç£¨ã€ç£¨éš¾\n11. inflict: vt. ä½¿...é­å—ï¼ˆä¸å¿«ã€ç—›è‹¦ï¼‰\n12. awe: `/É”Ë/` v. ä½¿æ•¬ç•ã€ç•æ€¯\n    1. awful: adj. å¯æ€•çš„\n    2. awesome: adj. ä»¤äººæ•¬ç•çš„ã€æƒŠå¹çš„\n13. appall: v. ä½¿å¤§ä¸ºéœ‡æƒŠã€æƒŠéª‡\n    1. appalling: adj. ä»¤äººéœ‡æƒŠçš„ï¼›éª‡äººå¬é—»çš„\n    2. startle: `/ËˆstÉ‘Ëtl/` v. ä½¿æƒŠå“ã€ä½¿å“ä¸€è·³ã€ä½¿å¤§åƒä¸€æƒŠ\n14. anguish: `/ËˆÃ¦Å‹É¡wÉªÊƒ/` n. ç—›è‹¦\n15. rattle: v. ä½¿ç´§å¼ ã€ææƒ§ï¼›ä½¿å’”å“’ä½œå“ n. å’”å“’å£°\n16. frantic: `/ËˆfrÃ¦ntÉªk/` adj. ï¼ˆç”±äºææƒ§æˆ–æ‹…å¿ƒï¼‰æ— æ³•æ§åˆ¶æ„Ÿæƒ…çš„ï¼Œå‘ç‹‚ä¼¼çš„ï¼›æ‰‹å¿™è„šä¹±çš„\n## hate\n\n1. hate: v. ä»‡æ¨ï¼›æ†æ¨ï¼›åŒæ¶\n2. hatred: n. ä»‡æ¨ï¼›æ†æ¨ï¼›åŒæ¶\n## æŠ±æ€¨: murmur - mutter - grudge - complain - plague\n\n1. murmur: v. æŠ±æ€¨\n2. mutter: v. å’•å“åœ°æŠ±æ€¨ï¼›è½»å£°ä½è¯­\n3. grudge: n. æ€¨æ¨, ç§¯æ€¨, å«Œéš™ v. å‹‰å¼ºåš, ä¸æƒ…æ„¿åœ°ç»™, åæƒœ, è®¤ä¸ºâ€¦ä¸åº”å¾—åˆ°\n4. complain: v. æŠ±æ€¨ï¼›å‘ç‰¢éªš\n5. plague: `/pleÉªÉ¡/` n. ç˜Ÿç–« vt. æŠ˜ç£¨ã€çº ç¼ \n    1. outrage: n. æ„¤æ€’ï¼›æš´è¡Œ v. æ¿€æ€’\n        1. rage: `/reÉªdÊ’/` n. æš´æ€’ã€ç‹‚æ€’ v. çŒ›çƒˆè¿›è¡Œ\n    2. grudge: n. æ€¨æ¨ï¼›å«Œéš™ v. ä¸æƒ…æ„¿åœ°åš...\n# irr-ã€re-\n\n1. resist: v. æŠµæŠ—ã€æŠµåˆ¶\n    1. resistible: adj. å¯æŠµæŠ—çš„\n2. irresistible: adj. ä¸å¯éæ­¢çš„, æ— æ³•æŠµåˆ¶çš„, æè¯±äººçš„, å¿ä¸ä½æƒ³è¦çš„\n## åˆç†: rational - irrational - plausible\n\n1. rational: adj. åˆç†çš„\n    1. plausible: adj. ä¼¼ä¹åˆç†çš„\n        1. è¯æ ¹ï¼šplaus-: (æ‹‰ä¸) è®¤å¯åœ°é¼“æŒ\n2. irrational: adj. ä¸åˆç† n. æ— ç†æ•°ï¼›æ— ç†æ€§çš„ç”Ÿç‰©\n## æ„¤æ€’: irritation\n\n1. irritation: æ„¤æ€’\n# è‡ªè´Ÿã€å‚²æ…¢: conceit - arrogant - concept - conceive - deceive - complacent\n\n1. conceit: n. è‡ªè´Ÿï¼›ç‹‚å¦„ï¼›å¹»æƒ³ vt. å¹»æƒ³\n2. conceited: adj. è‡ªè´Ÿçš„ï¼›éª„å‚²è‡ªå¤§çš„\n    1. arrogant: å‚²æ…¢çš„\n        1. arrogance: n. å‚²æ…¢ã€è‡ªå¤§\n3. concept: n. æ¦‚å¿µ\n    1. notion: n.æ¦‚å¿µï¼›è§‚å¿µï¼›çœ‹æ³•ï¼Œè§è§£\n4. conceive: v. æ„æƒ³ã€è®¾æƒ³\n    1. deceive: `/dÉªËˆsiËv/` v. æ¬ºéª—ï¼›è¯¯å¯¼\n5. haughty: adj. å‚²æ…¢çš„ï¼›é«˜å‚²è‡ªå¤§çš„\n6. complacent: `/kÉ™mËˆpleÉªsnt/` adj. è¿‡äºè‡ªæ»¡çš„\n# infant\n\n1. infant: `/ËˆÉªnfÉ™nt/` n. å©´å„¿ï¼›å¹¼å„¿ adj. å©´å„¿çš„ï¼›åˆæœŸçš„\n2. infantry: n. ï¼ˆç»Ÿç§°ï¼‰æ­¥å…µ\n# hypothesis - hypothetical\n\n```\nhypo-, hyp-ã€å¸Œè…Šã€‘å‰ç¼€ï¼›åœ¨â€¦â€¦ä¹‹ä¸‹ï¼›æ¯”â€¦â€¦å°‘ï¼›ä¸è¶³çš„\nåŒæ ¹è¯hypothesis|hypocrisy|adenohypophysis|\n\nthe-; them-, themat-, thes-, thet-ã€æ‹‰ä¸ã€‘è¡¨ç¤ºâ€œæ”¾ç½®â€\nåŒæ ¹è¯hypothesis|anathema|antithesis|apothecary|boutique|epithet|hypothetical|\n```\n\n1. hypothesis: `/haÉª'pÉ’Î¸É™sÉªs/` n. å‡è®¾, å‡è¯´; (å‡­ç©ºçš„)çŒœæµ‹\n    1. å¤æ•°ï¼šhypotheses\n2. hypothetical: `/ËŒhaÉªpÉ™ËˆÎ¸etÉªkl/` adj. å‡è®¾çš„\n# prescribed - prescription\n\n```\nprescription = pre(ä¹‹å‰) + script(scribe = writeå†™) + tion,â€œåœ¨æŠ“è¯ä¹‹å‰å…ˆç»™ä½ å†™å‡ºæ¥çš„ä¸œè¥¿â€ï¼Œå¤„æ–¹\n```\n\n1. prescribed: v. è§„å®šï¼›å¼€è¯æ–¹ï¼ˆâ€œprescribeâ€çš„è¿‡å»å¼å’Œè¿‡å»åˆ†è¯ï¼‰ adj. è§„å®šçš„\n2. prescription: n. è¯æ–¹ï¼›å¼€å¤„æ–¹ï¼›è¯€çªï¼›ç§˜è¯€\n# é›•åˆ»ã€é›•å¡‘\n\n1. carve: v. é›•åˆ»ï¼Œåˆ‡å‰²\n    1. crave: v. æ¸´æœ›ï¼›æ³æ±‚\n2. sculpt: v.é›•å¡‘ - sculpture n. é›•åƒï¼Œé›•å¡‘å“ï¼›é›•åˆ»æœ¯ï¼Œé›•å¡‘æœ¯\n    1. statue: n. é›•åƒï¼›å¡‘åƒï¼›é“¸åƒ\n        1. stationary: adj. ä¸åŠ¨çš„ã€é™æ­¢çš„\n        2. stationery: n. æ–‡å…·ï¼›ä¿¡çº¸\n# cord-\n\n`cor-`ã€`cord-`ã€`cour-`åœ¨æ‹‰ä¸è¯­ä¸­è¡¨ç¤ºâ€œå¿ƒâ€(coreæ ¸å¿ƒ)ï¼Œ`-ial`è¡¨ç¤ºå½¢å®¹è¯åç¼€\n\n1. cord: n. ç»³ç´¢ï¼›ç²—çº¿ï¼›ç”µçº¿ = rope\n2. cordial: `è‹±/ËˆkÉ”ËdiÉ™l/ ç¾/ËˆkÉ”ËrdÊ’É™l/` adj. çƒ­æƒ…å‹å¥½çš„; çœŸå¿ƒçš„, ç”±è¡·çš„ n. ç”œæœæ±é¥®æ–™; çƒˆæ€§ç”œé…’; å…´å¥‹å‰‚\n3. accord: ac(æœå‘)+cord(å¿ƒ)=å¿ƒå‘ç€ä¸€ä¸ªæ–¹å‘=ä½¿ä¸€è‡´\n4. concord: conä¸€èµ·+cordå¿ƒ=å¤§å®¶é½å¿ƒ=å’Œç¦ï¼Œå…¬çº¦\n# agree\n\n1. agreed: adj. å·²ä¸€è‡´çš„\n2. agreeable: adj. æ¬£ç„¶åŒæ„çš„ï¼›ä»¤äººæ„‰å¿«çš„ï¼Œæƒ¬æ„çš„\n    1. è¿‘ - åï¼šaccordant - discordantï¼›consistent - inconsistent\n# device - devise\n\n1. device\n2. devise: `/dÉªËˆvaÉªz/` v. è®¾è®¡; å‘æ˜; ç­–åˆ’\n# sullen\n\n1. sullen: adj. é—·é—·ä¸ä¹çš„ï¼Œéƒéƒå¯¡æ¬¢çš„ï¼›ï¼ˆå¤©ç©ºæˆ–å¤©æ°”ï¼‰é˜´æ²‰çš„\n# haunt\n\n1. haunt: v. è¦ç»•äºè„‘é™…ï¼ˆä½™éŸ³ç»•æ¢ï¼‰ï¼›ç¼ æ‰° n. å¸¸å»çš„åœºæ‰€ï¼Œæ¶ˆç£¨æ—¶å…‰çš„å»å¤„\n    1. linger: `/ËˆlÉªÅ‹É¡É™(r)/` vi. å¾˜å¾Šï¼›ç£¨è¹­ï¼›ä½™éŸ³ç»•æ¢ã€ä»æœ‰é˜´å½±\n    2. Let's meet at the haunt. è€åœ°æ–¹è§ã€‚\n    3. haunted: adj. é—¹é¬¼çš„ï¼Œåå¤å‡ºç°çš„\n    4. haunting: adj. è¦ç»•å¿ƒå¤´çš„\n        1. a haunting melody è¦ç»•å¿ƒå¤´çš„æ›²è°ƒ\n# genius - genuine\n\n1. genius: `/ËˆdÊ’iËniÉ™s/` n. å¤©æ‰\n    1. ingenious: `/ÉªnËˆdÊ’iËniÉ™s/` adj. ç²¾å·§çš„ï¼›å¿ƒçµæ‰‹å·§çš„\n2. genuine: `/ËˆdÊ’enjuÉªn/` adj. çœŸå®çš„ï¼›çœŸæ­£çš„ï¼›è¯šæ³çš„\n# å«ç”Ÿ - hygiene - sanitary - insane\n\n1. hygiene: n. å«ç”Ÿ\n    1. hygienic: adj. å«ç”Ÿçš„\n2. sanitary: adj. å«ç”Ÿçš„ï¼›ç¯å¢ƒå«ç”Ÿçš„ï¼›å…¬å…±å«ç”Ÿçš„ï¼›æ¸…æ´çš„ n. ï¼ˆæœ‰å«ç”Ÿè®¾å¤‡çš„ï¼‰å…¬å…±å•æ‰€\n\t1. sal, sanã€æ‹‰ä¸ã€‘è¡¨â€œå¥åº·, å¥å…¨â€ï¼›â€œç¦åˆ©â€\n\t   åŒæ ¹è¯salute|insane|salutary|sane|sanitary|sanity|insanity\n\t2. insane: adj. ç²¾ç¥å¤±å¸¸çš„ï¼›æ„šè ¢çš„\n\t\t1. insanity: n. ç²¾ç¥å¤±å¸¸ï¼›ååˆ†æ„šè ¢çš„è¡Œä¸º\n\t\t2. inmate: `/ËˆÉªnmeÉªt/` n. åŒä½è€…ï¼›åŒç‹±çŠ¯äººï¼›åŒç—…æˆ¿ç—…äºº\n\t3. sanctuary: n. é¿éš¾æ‰€ï¼›ä¿æŠ¤åŒº\n    \t1. refuge: `/ËˆrefjuËdÊ’/` n. é¿éš¾ï¼›åº‡æŠ¤\n        \t1. refusal: n. `/rÉªËˆfjuËzl/` n. æ‹’ç»\n    \t2. shelter: n. æ©ä½“ï¼›é¿éš¾æ‰€ v. èº²é¿ï¼›ä¿æŠ¤\n    \t3. haven: `/ËˆheÉªvn/` n. é¿éš¾æ‰€ï¼›ä¿æŠ¤åŒº - tax haven: é¿ç¨åŒº\n3. foul: `/faÊŠl/` adj. å«æœ‰ï¼ˆæˆ–å……æ»¡ï¼‰æœ‰å®³ç‰©è´¨çš„ï¼›ä»¤äººæ¶å¿ƒçš„ï¼›éš¾é—»çš„ï¼Œæ¶è‡­çš„\n   His boss has a foul temper. ä»–çš„è€æ¿è„¾æ°”å¾ˆåã€‚\n4. filth: n. æ±¡ç‰©ï¼Œæ±¡ç§½ï¼›ä¸‹æµè¨€è¾ï¼›æ·«ç§½ä¹¦åˆŠ\n\t1. filthy: adj. è‚®è„çš„ã€æ±¡ç§½çš„ adv. è‚®è„åœ°ï¼›å¯Œå¾—æµæ²¹åœ°\n5. stale: ä¸æ–°é²œçš„\n6. odour = (US) odor: `/ËˆÉ™ÊŠdÉ™(r)/` n. æ°”å‘³ï¼ˆå°¤æŒ‡è‡­å‘³ï¼‰\n# blot - spot - slot - plot\n\n1. spot: n. æ±¡ç‚¹ï¼›åœ°ç‚¹ã€åœºæ‰€ï¼›å°‘é‡  vt. çœ‹å‡ºã€è®¤å‡º  v. å¼„ä¸Šæ±¡æ¸\n2. blot:  n. æ±¡ç‚¹ï¼›è€»è¾±  v. å¸å¹²ã€æ“¦å¹²ï¼›å¼„è„ã€æ±¡æŸï¼›ä½¿è’™è€»\n    1. Blot it dry with a tissue. ç”¨çº¸å·¾æŠŠå®ƒå¸å¹²ã€‚\n    2. blotter: å¸å¢¨çº¸æ¿ï¼›å¸å¢¨ç”¨å…·ï¼›ï¼ˆè­¦å¯Ÿç®¡åŒºçš„ï¼‰æ‹˜æ•è®°å½•\n3. slot: n. ç©ºä½ï¼›æ’æ§½ã€æ§½ä½ï¼›ï¼ˆèŠ‚ç›®è¡¨çš„ï¼‰ä¸€æ¡£ä½ç½® v. æ’å…¥ã€å¡å…¥\n4. plot: n. æƒ…èŠ‚ï¼›å¯†è°‹\n# ä¸»å¼ : profess - confess - contend\n\n1. profess: `/prÉ™'fes/` v.\n    1. to claim that something is true or correct, especially when it is not: å¦„ç§°ï¼›ä¼ªç§°ï¼›å£°ç§°\n    2. to state openly that you have a particular belief, feeling, etc.: å®£ç§°ï¼›å…¬å¼€è¡¨æ˜\n    3. **profession: n. èŒä¸šï¼›è¡Œä¸šã€é¢†åŸŸï¼ˆçš„åŒè¡Œï¼‰**\n2. confess: v. ä¾›è®¤ï¼›å¦ç™½\n3. contend: `/kÉ™nËˆtend/` vt. å£°ç§°ã€ä¸»å¼ ã€è®¤ä¸ºã€è¾©è®ºï¼ˆçº¦ç­‰äºargueï¼‰ vi. ç«äº‰ã€äº‰å¤º\n# æŒ‡è´£ï¼›è´£éª‚\n\n## æŒ‡è´£ã€è°´è´£ï¼›è´£å¤‡\n\n1. rebuke: `/rÉªËˆbjuËk/` v./n. æŒ‡è´£ï¼›æ‰¹è¯„\n    1. å¤šæŒ‡ä¸Šçº§å¯¹ä¸‹çº§è¿›è¡Œçš„å…¬å¼€ã€å¼ºçƒˆã€ä¸¥æ­£è€Œä¸å®½å®¹çš„è´£å¤‡ã€‚éšå«ä¸€å®šæƒå¨çš„æ„å‘³ã€‚\n2. blame: v./n. æŠŠ...å½’å’äºï¼›è´£æ€ªã€æŒ‡è´£\n    1. è¯­æ°”è¾ƒå¼±ã€‚æŒ‡ä¸€èˆ¬çš„è´£éš¾ã€å½’å’ï¼Œä¸å«è´£éª‚ä¹‹æ„ã€‚\n3. condemn: `/kÉ™nËˆdem/` \n    1. æ­£å¼ç”¨è¯ï¼Œè¡¨ç¤ºè°´è´£ï¼Œæœ‰è¾ƒå¼ºçš„å¸æ³•æ„å‘³ï¼Œä¾§é‡ä»é“ä¹‰æˆ–åŸåˆ™ä¸Šçš„è°´è´£ã€‚\n4. denounce: `/dÉªËˆnaÊŠns/` v. å…¬å¼€æŒ‡è´£\n    1. ä¸condemnåŒä¹‰ï¼Œä½†ç€é‡å…¬å¼€æ€§ã€‚\n5. reproach: `/rÉªËˆprÉ™ÊŠtÊƒ/` n./v. è´£å¤‡\n    1. ä¾§é‡æŒ‡å› ä»–äººç²—å¿ƒã€è‡ªç§ç­‰å¼•èµ·ä¸æ»¡è€Œå»æŒ‡è´£ã€æ‰¾å²”ã€‚\n    2. The look of reproach on his mother's face made Tom feel guilty. å¦ˆå¦ˆè„¸ä¸Šè´£å¤‡çš„è¡¨æƒ…ä»¤æ±¤å§†æ„§ç–šä¸å·²ã€‚\n## è´£éª‚\n\n1. scold: `/skÉ™ÊŠld/` \n    1. æ™®é€šç”¨è¯ï¼Œå¤šæŒ‡ä¸Šçº§å¯¹ä¸‹çº§ã€é•¿è¾ˆå¯¹åè¾ˆæˆ–é›‡ä¸»å¯¹é›‡å‘˜çš„æ€åº¦ç²—æš´ã€è¨€è¯æ¿€çƒˆçš„æ•°è½ã€‚\n    2. scorn: `/skÉ”Ën/` n./v. è”‘è§†\n2. swear: `/sweÉ™(r)/` v. å’’éª‚ï¼›å‘èª“\n    1. è¿‡å»å¼: swore\n# ä»…ï¼›å‹‰å¼ºï¼›ä¸è¿‡\n\n1. merely: ä»…ä»…ï¼›åªä¸è¿‡\n2. solely: adv. åª, ä»…, å”¯, å•ç‹¬åœ°\n    1. solemnity: `/sÉ™ËˆlemnÉ™ti/` n. åº„ä¸¥ã€éƒ‘é‡\n3. barely: adv. å‹‰å¼ºæ‰èƒ½ï¼›å‡ ä¹ä¸èƒ½\n# embrace - gratify\n\n1. embrace: v. æ¬£ç„¶æ¥å—ï¼›æ‹¥æŠ±ï¼›åŒ…å« n. æ‹¥æŠ±\n2. gratify: v. ä½¿é«˜å…´, ä½¿æ»¡æ„, æ»¡è¶³ï¼ˆæ„¿æœ›ã€éœ€è¦ç­‰ï¼‰=satisfy\n# ambiguity - ambiguous\n\n1. ambiguity: n. æ­§ä¹‰, æ¨¡æ£±ä¸¤å¯, ä¸æ˜ç¡®, ä¸€è¯­å¤šä¹‰\n2. ambiguous\n# -tain\n\n1. sustain: v. ç»´æŒï¼›æ‰¿å—ï¼Œç»å—ï¼›æ”¯æŒ\n# threat - theater - theatrical - theoretical\n\n1. threat: `/Î¸ret/` n. æå“ã€å¨èƒ\n    1. threaten: `/ËˆÎ¸retn/` v. æå“ã€å¨èƒ\n        1. intimidate: `/ÉªnËˆtÉªmÉªdeÉªt/` v. æå“ã€å¨èƒ\n2. theater: theatre = theater - theatrical å‰§åœºçš„ã€å¤¸å¼ çš„ = dramatic\n3. theoretical: adj. ç†è®ºçš„ï¼›ç†è®ºæ€§çš„ï¼›ç†è®ºä¸Šçš„\n# prevail - prevalent\n\n1. pr**e**vail: v. æµè¡Œï¼›å ä¼˜åŠ¿ã€ä¸Šé£\n    1. pr**ivi**lege: n. ç‰¹æƒã€ç‰¹æ®Šå¾…é‡\n    2. prevalent: adj. æµè¡Œçš„ï¼Œç››è¡Œçš„ï¼›æ™®éçš„\n2. medieval: ä¸­ä¸–çºªçš„\n# å‡ ä½•ç±»ã€æ•°å­¦\n\n1. elliptical: adj. æ¤­åœ†çš„ï¼›çœç•¥çš„ï¼›éšæ™¦çš„\n2. hemisphere: n. åŠçƒ\n3. diameter: n. ç›´å¾„\n4. symmetry: n. å¯¹ç§°ï¼›ç›¸ä¼¼ï¼›ç›¸ç­‰ - symmetrical: adj. å¯¹ç§°çš„\n5. perpendicular: n. å‚ç›´çº¿ï¼›å‚ç›´çš„ä½ç½® adj. å‚ç›´çš„ï¼›å‘ˆç›´è§’çš„\n6. vertical: adj. å‚ç›´çš„ï¼›çºµå‘çš„\n7. spiral: n. èºæ—‹å½¢ adj. èºæ—‹å½¢çš„ v. å‘ˆèºæ—‹çŠ¶ä¸‹é™æˆ–ä¸Šå‡ï¼›æ€¥å‰§å¢é•¿\n8. ordinate: n. åæ ‡è½´\n    1. ordination: n. ä»»å‘½ï¼›æ’æˆç­‰çº§ã€åˆ†ç±»\n    2. subordination: ä¸‹çº§åœ°ä½\n# consicous - confuse - conscience\n\n1. conscience: `/ËˆkÉ’nÊƒÉ™ns/` n. è‰¯å¿ƒã€è‰¯çŸ¥ï¼›å†…ç–šã€æ„§ç–š\n    1. Middle English (also in the sense â€˜inner thoughts or knowledgeâ€™): via Old French from Latin `conscientia, from conscient- â€˜being privy toâ€™`, from the verb `conscire`, from `con- â€˜withâ€™` + `scire â€˜knowâ€™`.\n    2. conscientious: `/ËŒkÉ’nÊƒiËˆenÊƒÉ™s/` adj. å‹¤å‹¤æ³æ³çš„ï¼›ä¸€ä¸ä¸è‹Ÿçš„\n2. conscious: `/ËˆkÉ’nÊƒÉ™s/` adj. æ„è¯†åˆ°çš„ï¼›ç¥å¿—æ¸…é†’çš„ï¼›æ•…æ„çš„\n3. confuse: v. æ··æ·†ï¼›ä½¿è¿·æƒ‘\n    1. baffle: `/ËˆbÃ¦fl/` v. ä½¿å›°æƒ‘\n        1. late 16th cent. (in the sense â€˜cheat, deceiveâ€™): perhaps related to French `bafouer â€˜ridiculeâ€™` or obsolete(è€å¼çš„ï¼›åºŸå¼ƒçš„) French `beffer â€˜mock, deceiveâ€™`.\n4. delusive: `/dÉªËˆluËsÉªv/` adj. æ¬ºç’çš„ï¼›ä½¿è¿·æƒ‘çš„\n# anticipate\n\nåœ¨æ‹‰ä¸è¯­ä¸­ï¼Œ`anti-`è¡¨ç¤º-åœ¨...å‰é¢ã€‚`cip-`è¡¨ç¤º-æ•æ‰ã€æŠ“ã€æ¡ä½ã€‚`-ate`è¡¨ç¤º-åšï¼›ä½¿ï¼Œè®©\n1. anticipate: v. é¢„æœŸï¼›æœŸæœ›\n    1. anticipation: n. é¢„æœŸï¼›æœŸæœ›\n2. participate: å‚ä¸\n# bounce - bound - boundary - redound - bond - bandage - bind\n\n1. bounce: v. å¼¹è·³ï¼›è·³åŠ¨\n    1. bouncy: adj. å¼¹æ€§å¥½çš„ï¼›ç”Ÿæœºå‹ƒå‹ƒçš„ï¼›ç²¾ç¥é¥±æ»¡çš„\n2. bound: adj. ä¸€å®šçš„ï¼›å—çº¦æŸçš„ã€æœ‰ä¹‰åŠ¡çš„ v. è·³è·ƒï¼›å½¢æˆç•Œçº¿ n. è·³è·ƒï¼›è¾¹ç•Œ v. åŠ¨è¯bindçš„è¿‡å»å¼&è¿‡å»åˆ†è¯\n    1. boundary: n. åˆ†ç•Œçº¿ï¼Œè¾¹ç•Œ\n3. redound: v. æœ‰ç›Šäº\n   This course of action will redound to our advantage. è¿™ç§åšæ³•å¯¹æˆ‘ä»¬å¾ˆæœ‰å¥½å¤„ã€‚\n   Our efforts will redound to the general good. æˆ‘ä»¬çš„åŠªåŠ›å°†å¢è¿›å¤§ä¼—çš„åˆ©ç›Šã€‚\n4. bond: n. çº½å¸¦ï¼›è”ç³»\n    1. bondage: n. æŸç¼šï¼›å¥´å½¹ï¼›æ†ç»‘ç™–å¥½\n5. bandage: n. ç»·å¸¦\n6. bind: v. æ†ç»‘ï¼›ç³»ä¸Š\n# projector\n\n1. projector: n. æ”¾æ˜ æœºï¼›æŠ•å½±æœº\n2. projection: n. æŠ•å½±ï¼›æŠ•å°„ï¼›é¢„æµ‹ï¼›æ”¾æ˜ \n# represent - present\n\n1. represent: v. ä»£è¡¨ï¼›è¡¨ç¤ºï¼›è±¡å¾ï¼›æç»˜ï¼›è¡¨ç°\n    1. representation: n. ä»£ç†äººï¼›ä»£è¡¨ï¼›è¡¨ç°ï¼›æè¿°ï¼›é™ˆè¿°\n    2. masterpiece: n. æ°ä½œï¼›åè‘—ï¼›ä»£è¡¨ä½œ\n2. present: v. å‘ˆç°ï¼›ä»‹ç»ï¼›æå‡ºï¼›èµ é€ adj. å‡ºå¸­çš„ï¼›ç°åœ¨çš„ n. ç°åœ¨ï¼›ç¤¼ç‰©ï¼›ç„å‡†\n    1. presence: n. å‡ºå¸­\n    2. presentation: n. æä¾›ï¼›æ˜¾ç¤ºï¼›å¤–è§‚ï¼›æˆäºˆï¼ˆç‰©ï¼‰ï¼›èµ é€ï¼ˆä»ªå¼ï¼‰ï¼›æŠ¥å‘Šï¼›è¡¨æ¼”\n# regret\n\n1. regret: v. åæ‚”ï¼›æ„Ÿåˆ°é—æ†¾ n. é—æ†¾ï¼›åæ‚”\n2. regretful: adj. åæ‚”çš„ï¼›å¤±æœ›çš„ï¼›ä»¤äººæƒ‹æƒœçš„ï¼›é—æ†¾çš„\n# æå…¶ã€éå¸¸ï¼›å°‘é‡ï¼›ç¨å¾®\n\n1. exceedingly\n2. **mighty**: n. å¼ºè€Œæœ‰åŠ›çš„ï¼›å·¨å¤§çš„ï¼›éå‡¡çš„ adv. éå¸¸ï¼›å¾ˆï¼›æå…¶\n3. vast: adj. å·¨å¤§çš„ï¼›å¤§é‡çš„ - vastly: adv. éå¸¸ï¼›å¾ˆï¼›å¹¿å¤§åœ°\n4. particularly: ç‰¹åˆ«ï¼›å°¤å…¶\n5. bitterly: adv. éå¸¸, ä¼¤å¿ƒåœ°, æ„¤æ€’åœ°, æå…¶\n6. particle: n. æå°‘é‡ï¼›å¾®ç²’\n7. trifle: `/'traÉªfl/` n. å°äº‹, çäº‹; ä¸å€¼é’±çš„å°ç‰©ä»¶; ç¨å¾®ï¼Œå°‘é‡\n\t1. trivia - trivial\n\t2. intricacy: n. é”™ç»¼å¤æ‚çš„ç»†èŠ‚ - intricate: adj. é”™ç»¼å¤æ‚çš„\n\t\t1. intrigue: n. é˜´è°‹è¯¡è®¡ v. è¿·ä½ï¼›æ–½è¯¡è®¡\n8. slight: adj. å°‘é‡çš„ï¼›è½»å¾®çš„\n    1. slightly: adv. ç¨å¾®åœ°\n    2. sight: n. è§†åŠ›ã€è§†è§‰\n9. sip: v. å°å£åœ°å–ï¼›æŠ¿ n. ä¸€å°å£çš„é‡\n10. shred: `/Êƒred/` v. åˆ‡ç¢ï¼›æ’•ç¢ n. ç»†æ¡ã€ç¢ç‰‡ï¼›æå°‘é‡ã€ä¸€ä¸ç‚¹\n    1. shrewd: `/ÊƒruËd/` adj. ç²¾æ˜çš„ã€æ•é”çš„ï¼›é«˜æ˜çš„\n# can-ã€van-\n\n1. canvas: n. å¸†å¸ƒï¼›ç”»å¸ƒï¼›æ²¹ç”»\n2. canvass: v. æ¸¸è¯´, åŠè¯´, å…œå”®, (å¤§èŒƒå›´çš„)è°ƒæŸ¥ n. æ¸¸è¯´, è®¨è®º, æ°‘æ„è°ƒæŸ¥\n# -ea-ã€-ee-: bead - breed - beak - greed - reef - reed - steak - sheer - steer\n\n1. bead: ç å­\n2. breed: n. å“ç§ vi. äº¤é…ä»¥ç¹æ®– vt. å…»è‚²ï¼›å­•è‚²ã€å¯¼è‡´\n    1. è¢«åŠ¨è¯­æ€ï¼šbred: I'm a Londoner, born and bred. æˆ‘åœŸç”ŸåœŸé•¿åœ¨ä¼¦æ•¦ã€‚\n    2. species: n. å“ç§\n4. beak: n. é¸Ÿå–™, é¹°é’©é¼», å°–é¼»\n5. greed: n. è´ªå©ªï¼Œè´ªå¿ƒ - greedy: adj. è´ªå¿ƒçš„\n6. reef: n. ç¤ã€ç¤è„‰\n7. reed: n. èŠ¦è‹‡\n8. steak: `/steÉªk/` n. ç‰›æ’ï¼›é±¼æ’ï¼›è‚‰å—\n9. sheer: adj./adv. æ•°é‡ä¹‹å¤§çš„ï¼›çº¯ç²¹çš„ï¼›é™¡å³­çš„\n10. steer: v. æ§åˆ¶ã€æ“çºµï¼›é©¾é©¶ï¼ˆèˆ¹ã€æ±½è½¦ç­‰ï¼‰\n11. steep: é™¡å³­çš„\n12. **feat: n. åŠŸç»©ï¼›è‹±å‹‡äº‹è¿¹**\n13. conceal: v. éšè—ï¼›æ©ç›–\n# mani-\n\n1. manipulate: v. ç†Ÿç»ƒåœ°æ“ä½œã€ä½¿ç”¨ï¼›ï¼ˆæš—ä¸­ï¼‰æ§åˆ¶ã€æ“çºµ\n# steward\n\n```\nward: n. ç›‘ç£ã€ç›‘è§†ã€ä¿æŠ¤ã€çœ‹æŠ¤ï¼›å—ç›‘æŠ¤äººï¼›åŒºã€é€‰åŒºï¼›ç—…æˆ¿ã€ç—…å®¤ v. å®ˆæŠ¤ã€é˜²å¾¡ï¼›ä½¿å…¥ç—…æˆ¿\nwarder: n. (ç›‘ç‹±çš„)çœ‹å®ˆï¼›ç‹±å\n```\n\n1. steward: `/'stjuËÉ™d/` n. ä¹˜åŠ¡å‘˜, æœåŠ¡å‘˜; ç®¡ç†å‘˜; ç®¡å®¶;ï¼ˆæ¯”èµ›ã€é›†ä¼šç­‰å¤§å‹å…¬ä¼—æ´»åŠ¨çš„ï¼‰è´Ÿè´£äºº, ç»Ÿç­¹äºº, ç®¡äº‹, å¹²äº‹\n2. stewardess: n. å¥³ä¹˜åŠ¡å‘˜\n# äº‹ä»¶ï¼›æƒ…å†µ\n\n1. circumstance: n. æƒ…å†µï¼›æƒ…å½¢ï¼›å¢ƒå†µ\n2. event\n3. case\n# -vey\n\n1. survey: è°ƒæŸ¥\n2. convey: v. è¡¨è¾¾ã€ä¼ è¾¾ï¼ˆæ€æƒ³ã€æ„Ÿæƒ³ã€æ„Ÿè§‰ç­‰ï¼‰ï¼›ä¼ é€’ã€ä¼ è¾¾ï¼ˆä¿¡æ¯æˆ–æ¶ˆæ¯ï¼‰\n# assemble - assembly\n\n1. assemble: v.é›†åˆï¼Œæ”¶é›†ï¼›è£…é…ï¼Œç»„è£…\n2. assembly: **ï¼ˆåè¯ï¼‰n.** ä¼šè®®ï¼›è®®ä¼šï¼›é›†åˆï¼Œé›†ä¼šï¼›è£…é…\n    1. assembly-language æ±‡ç¼–è¯­è¨€\n# vender - render\n\n1. vend: vt. å‡ºå”®(å°¤æŒ‡åœŸåœ°ç­‰è´¢äº§)ï¼›(å°¤æŒ‡åœ¨å…¬å…±åœºæ‰€)è´©å–ï¼Œå«å–(å°å•†å“)ï¼›å‘è¡¨(æ„è§ï¼Œè¨€è®º)ï¼›å£°æ˜\n2. vender/vendor: n. ï¼ˆè¡—å¤´ï¼‰å°è´©ï¼›å–ä¸»ï¼Œå–æ–¹\n    1. pedlar: `/ËˆpedlÉ™(r)/` n. æµåŠ¨å°è´©\n        1. peddle: ` /Ëˆpedl/` vt. å«å– vi. æ²¿è¡—å«å–\n        2. pedal: `/Ëˆpedl/` n. è¸æ¿\n        3. paddle: `/ËˆpÃ¦dl/` n. åˆ’æ¡¨\n3. vending machine: è‡ªåŠ¨å”®è´§æœº\n4. vendee: n. ä¹°ä¸»ï¼ˆæ³•å¾‹ç”¨è¯­ï¼‰\n5. render: `/ËˆrendÉ™(r)/`\n    1. ä½¿å˜æˆ\n    2. æäº¤ï¼›å›æŠ¥\n    3. è¡¨è¾¾\n# remainder\n\n1. remain: vi. ä¿æŒï¼›ä¾ç„¶ï¼›ç•™ä¸‹ï¼›å‰©ä½™ï¼›é€—ç•™ï¼›æ®‹å­˜ n. é—è¿¹ï¼›å‰©ä½™ç‰©ï¼Œæ®‹éª¸\n2. remainder: n. å…¶ä»–äººå‘˜ï¼›å‰©ä½™ç‰©ï¼›ä½™æ•°\n    1. Nine people came in and the remainder stayed outside. 9ä¸ªäººè¿›æ¥ï¼Œä½™ä¸‹çš„äººç•™åœ¨å¤–é¢ã€‚\n# over-\n\n1. overlap: v. é‡å ï¼Œéƒ¨åˆ†ç›¸åŒï¼›æœ‰å…±åŒä¹‹å¤„\n    1. Here the methods of archaeology and ethnography overlap. åœ¨è¿™é‡Œï¼Œè€ƒå¤å­¦å’Œäººç§å­¦çš„æ–¹æ³•éƒ¨åˆ†é‡å äº†ã€‚\n2. overthrow: v. æ¨ç¿»ï¼›å°†...èµ¶ä¸‹å°\n3. overhear: v. å¶ç„¶å¬åˆ°ï¼›æ— æ„ä¸­å¬åˆ°\n4. overlook: v. ä¿¯ç°ï¼›å¿½è§†ï¼›æ²¡æ³¨æ„åˆ°\n5. **oversee: vt. ç›‘è§†ã€ç›‘ç£** vt. å·çœ‹åˆ°ï¼Œæ— æ„ä¸­çœ‹åˆ°\n6. overpower: v. åˆ¶æœ\n7. overreach: v. èµ°è¿‡å¤´\n8. override: v. åˆ¶æœï¼›è·µè¸ - overriding: adj. æœ€é‡è¦çš„ï¼›\n9. overrule: v. é©³å›ï¼›å¦å†³\n10. overshadow: v. é®è”½ï¼›ä½¿é»¯ç„¶å¤±è‰²\n11. overstate: v. å¤¸å¤§çš„å™è¿°\n# fortune - fortuity\n\n1. fortune: è´¢äº§ï¼Œè¿æ°”\n2. fortuity: n. å¶ç„¶æ€§ï¼›å¶ç„¶äº‹ä»¶ï¼›å¶ç„¶æœºä¼š\n3. fortuitous: adj. å¶ç„¶çš„, æ„å¤–çš„ï¼›å¹¸è¿çš„\n4. fortunate: adj. å¹¸è¿çš„ï¼Œä¾¥å¹¸çš„\n5. opportunity: n. æœºä¼š\n# å¤©æ–‡åœ°ç†\n\n## åŸå¸‚\n\n1. downtown: adv. åœ¨é—¹å¸‚åŒº n. é—¹å¸‚åŒº adj. é—¹å¸‚åŒºçš„\n2. uptown: n./adv./adj. åœ¨ä½å®…åŒºçš„\n3. urban: adj. åœ¨åŸå¸‚çš„ï¼›åœ¨éƒ½å¸‚çš„\n4. suburban: adj. éƒŠåŒºçš„ n. éƒŠåŒºå±…æ°‘\n5. outland: adj. è¿œç¦»ä¸­å¿ƒçš„ã€åè¿œçš„ n. è¾¹å¢ƒåœ°åŒº\n6. inland: adj. å†…é™†çš„ï¼›å†…åœ°çš„ adv. åœ¨å†…é™†ï¼›åœ¨å†…åœ°\n7. vicinity: `/vÉ™ËˆsÉªnÉ™ti/` n. å‘¨å›´åœ°åŒºï¼›é™„è¿‘\n    1. in the vicinity of 30 or 40: ä¸‰å››åå·¦å³\n## å½¢å®¹è¯\n\n1. adjacent: adj. æ¯—è¿çš„ï¼Œé‚»è¿‘çš„\n## åœ°ç†ã€åœ°å‹ã€åœ°è²Œã€å»ºç­‘è®¾æ–½\n\n1. swamp: n. æ²¼æ³½ v. æ·¹æ²¡ï¼›å¸­å·\n2. inlet: n. æ°´æ¹¾ï¼›å°æ¸¯ï¼›æ³¨å…¥å£\n    1. harbor: n. æ¸¯å£ã€æ¸¯æ¹¾ v. å¿ƒæ€€ï¼ˆæƒ³æ³•æˆ–æ„Ÿæƒ…ï¼‰ï¼›åº‡æŠ¤ã€çªè—\n    2. wharf: `/wÉ”Ëf/` n. ç å¤´\n3. outlet: n. å‡ºå£ï¼›é€šé£å£\n4. valley: `/ËˆvÃ¦li/` n. å±±è°·ï¼›æºªè°·\n5. ridge: `/rÉªdÊ’/` n. å±±è„Šã€å±±è„‰ï¼›éš†èµ·\n6. trench: `/trentÊƒ/` n. æ²Ÿï¼›æ¸ \n7. tropical: adj. çƒ­å¸¦çš„\n8. continent: n. å¤§é™†ï¼›å¤§æ´²\n9. dam: n. æ°´åï¼›éšœç¢ v. ç­‘å\n10. canal: `/kÉ™ËˆnÃ¦l/` n. è¿æ²³ã€æ¸ é“\n11. strait: `/streÉªt/` n. æµ·å³¡ã€æ°´é“ï¼›å›°å¢ƒ\n    1. channel: ä¹Ÿæœ‰æµ·å³¡çš„æ„æ€ï¼Œæ¯”straité•¿è€Œå®½\n    2. straight: `/streÉªt/` adj./adv. ç¬”ç›´çš„ï¼ˆåœ°ï¼‰ï¼›ç«‹å³ã€ç›´æ¥çš„ï¼ˆåœ°ï¼‰\n12. arena: `/É™ËˆriËnÉ™/` n. åœ†å½¢ç«æŠ€åœºã€å‰§åœº\n13. cliff: n. æ‚¬å´–\n14. equator: `/ÉªËˆkweÉªtÉ™(r)/` n. èµ¤é“\n## å„ç§é“è·¯\n\n1. bypass: n. ï¼ˆç»•è¿‡åŸé•‡æˆ–å¸‚ä¸­å¿ƒçš„ï¼‰æ”¯è·¯ï¼›æ—é“ v. ç»•å¼€ã€é¿å¼€ï¼›å¿½è§†ã€ä¸é¡¾\n2. aisle: `/aÉªl/` n. èµ°å»Šã€è¿‡é“\n## å®‡å®™\n\n1. cosmos: å®‡å®™\n\t1. cosmopolitan: adj. ä¸–ç•Œæ€§çš„ï¼›å››æµ·ä¸ºå®¶çš„ n. ä¸–ç•Œä¸»ä¹‰è€…ï¼›å››æµ·ä¸ºå®¶çš„äºº\n## å‡ ä½•\n\n1. orbit: n. è½¨é“ï¼›v. ç»•è½¨é“è€Œè¡Œ\n2. axis: n. è½´\n   The earth **turns on its axis** once every 24hours. åœ°çƒæ¯24å°æ—¶**è‡ªè½¬**ä¸€åœˆ\n3. diameter: ç›´å¾„\n4. curve: æ›²çº¿ã€å¼§çº¿\n5. longitude: ç»åº¦\n    1. latitude: çº¬åº¦\n    2. gratitude: n. æ„Ÿè°¢ã€æ„Ÿæ¿€\n# penetrate\n\n1. penetrate: v. ç©¿é€ï¼Œæ¸—é€ - penetration: n. æ¸—é€ï¼Œç©¿é€ï¼›ä¾µå…¥ï¼Œçªç ´\n# åŸ‹è‘¬ã€è‘¬ç¤¼ï¼šfuneral - burial\n\n1. funeral: n. è‘¬ç¤¼ adj. ä¸§è‘¬çš„\n2. burial: n. åŸ‹è‘¬ï¼›è‘¬ç¤¼ï¼›å¼ƒç» adj. åŸ‹è‘¬çš„\n# deposit - depot\n\n1. deposit: `è‹± /dÉªËˆpÉ’zÉªt/ ç¾ /dÉªËˆpÉ‘ËzÉªt/` n. å­˜æ¬¾ï¼›æŠ¼é‡‘ã€è®¢é‡‘ï¼›æ²‰ç§¯ç‰©ã€å­˜å‚¨ v. å­˜æ”¾ã€å¯„å­˜ï¼›(ä½¿)æ²‰ç§¯\n2. depot: `è‹± /ËˆdepÉ™ÊŠ/ ç¾ /ËˆdiËpoÊŠ/` n. ä»“åº“\n# neglect - negligible\n\n1. neglect: `/nÉªËˆÉ¡lekt/` vt. å¿½è§†ï¼Œå¿½ç•¥ negligent a. ä¸æ³¨æ„çš„ï¼Œç–å¿½çš„\n    1. neglectful: `/nÉªËˆÉ¡lektfl/` adj. å¿½è§†çš„ï¼›é©¬è™çš„\n2. negligible: `/ËˆneÉ¡lÉªdÊ’É™bl/` adj. å¾®ä¸è¶³é“çš„ï¼›ä¸é‡è¦çš„ï¼›ä¸å€¼ä¸€æçš„\n# lapse\n\n1. lapse: n. è¿‡å¤±ï¼Œç–å¿½ï¼›ï¼ˆä¸¤ä»¶äº‹å‘ç”Ÿçš„ï¼‰é—´éš”æ—¶é—´ v. ï¼ˆåˆåŒã€åè®®ï¼‰æœŸæ»¡ç»ˆæ­¢ï¼›ï¼ˆé€æ¸ï¼‰è¡°å¼±ã€æ¶ˆå¤±\n# con-; com-\n1. convene: `/kÉ™nËˆviËn/` v. å¬é›†ï¼›å¬å”¤ï¼›èšé›†ï¼›é›†åˆ\n    1. congregate: v. é›†åˆ\n        1. segregate: `/ËˆseÉ¡rÉªÉ¡eÉªt/` v. éš”ç¦»å¹¶åŒºåˆ«å¯¹å¾…\n            1. separate: adj. `/ËˆseprÉ™t/` å•ç‹¬çš„ï¼›åˆ†å¼€çš„ v. `/ËˆsepÉ™reÉªt/` ä½¿åˆ†å¼€\n            2. aggravate: `/ËˆÃ¦É¡rÉ™veÉªt/` v. ä½¿ä¸¥é‡ã€æ¶åŒ–\n                1. aggregate: `/ËˆÃ¦É¡rÉªÉ¡É™t/` n./v. æ€»è®¡\n            3. exaggerate: `/ÉªÉ¡ËˆzÃ¦dÊ’É™reÉªt/` v. å¤¸å¤§äº‹å®ã€å¤¸å¼ \n    2. marshal: v. æ§åˆ¶äººç¾¤ï¼ˆåŠ¨å‘˜ï¼‰ã€é›†ç»“ n. ç©ºå†›å…ƒå¸…ï¼›å¸ä»ªï¼›å…¸ç¤¼å®˜\n    3. summon: v. ä¼ å”¤æŸäººå‡ºå¸­ï¼›å¬é›†\n    4. mobilize: v. åŠ¨å‘˜ï¼›è°ƒåŠ¨\n2. conquer: `/ËˆkÉ’Å‹kÉ™(r)/` v. å¾æœï¼›å…‹æœ - conqueror: n. å¾æœè€…ï¼›å é¢†è€…ï¼›èƒœåˆ©è€…\n3. convince: v. ä½¿...ç›¸ä¿¡ï¼›è¯´æœ...\n    1. convinced: adj. è¢«è¯´æœçš„ï¼›ä¿¡äº†çš„ã€åšä¿¡ä¸ç§»çš„\n    2. convict: v. å®šç½ªï¼›è¯æ˜æœ‰ç½ªï¼ˆå¸¸ç”¨äºè¢«åŠ¨è¯­æ€ï¼‰\n        1. **conviction: n. è¯ç½ªï¼›åšå®šçš„ä¿¡å¿µ**\n4. consign: v. è¿é€ï¼›æŠŠ...ç½®äºï¼ˆå°¤æŒ‡ä¸å¥½çš„å¢ƒåœ°ï¼‰ï¼›å¼ƒç½®\n5. conceal: v. éšè—\n6. concise: `/kÉ™nËˆsaÉªs/` adj. ç®€æ´çš„\n7. consent: n./v. åŒæ„\n8. confront: vt. ä½¿...é¢ä¸´ã€é¢å¯¹ã€å¯¹ä»˜ï¼›é™ä¸´åˆ°...å¤´ä¸Š\n## ç›¸ç¬¦ã€ä¸€è‡´ï¼›å¯¹åº”\n\n1. correspond: `/ËŒkÉ’rÉ™ËˆspÉ’nd/` adj. ç¬¦åˆçš„ã€ç›¸åº”çš„ã€ç›¸å…³çš„\n    1. correspondence: `/ËŒkÉ’rÉ™ËˆspÉ’ndÉ™ns/ `n. **æ¥å¾€ä¿¡ä»¶**ï¼›ç›¸å…³ã€ç›¸ä¼¼\n    2. resemblance: `/rÉª'zembl(É™)ns/` n. ç›¸ä¼¼\n       She bears a remarkable resemblance to Amy. å¥¹è·Ÿè‰¾ç±³é•¿å¾—éå¸¸ç›¸ä¼¼ã€‚\n        1. analogy: `/É™ËˆnÃ¦lÉ™dÊ’i/` n. ç±»æ¯”ï¼›ç›¸ä¼¼ä¹‹å¤„\n            1. analogous: `analogous` adj. ç›¸ä¼¼çš„ã€ç±»ä¼¼çš„\n    3. assemble: vt. èšé›†ã€é›†åˆ\n        1. assembly: n. é›†ä¼šã€è®®ä¼š\n2. accord: n. åè®® v. ä¸€è‡´ã€ç›¸ç¬¦ - accord with - accordance n. ç¬¦åˆã€ä¸€è‡´\n3. coincide: v. åŒæ—¶å‘ç”Ÿï¼›ç›¸åŒï¼Œç›¸ç¬¦ï¼›ä½ç½®é‡åˆï¼Œé‡å \n    1. coincidence: n. ä¸€è‡´ï¼›ï¼ˆä»¤äººåƒæƒŠçš„ï¼‰å·§åˆï¼›åŒæ—¶å­˜åœ¨ï¼Œå¹¶å­˜\n        1. incidence: `/ËˆÉªnsÉªdÉ™ns/` n. å‘ç”ŸèŒƒå›´ã€å½±å“ç¨‹åº¦ï¼›å‘ç”Ÿç‡\n            1. incident: n. å‘ç”Ÿçš„ä¸å¥½çš„ã€ä¸å¯»å¸¸çš„äº‹æƒ…\n    2. coincidental: adj. å·§åˆï¼›ç¢°å·§ï¼›éè®¡åˆ’ä¹‹ä¸­\n        1. identical: adj. ä¸€æ¨¡ä¸€æ ·çš„\n    3. simultaneously: `/ËŒsÉªmlËˆteÉªniÉ™sli/` adv. åŒæ—¶åœ°\n        1. **spontaneous**: `/spÉ’n'teÉªniÉ™s/` adj. **è‡ªå‘çš„ï¼Œè‡ªç„¶äº§ç”Ÿçš„**ï¼›æ— æ„è¯†çš„ï¼›å¤©çœŸç‡ç›´çš„\n4. concur: v. åŒæ„, èµåŒ, æ„è§ä¸€è‡´; åŒæ—¶å‘ç”Ÿ\n5. **unanimous**: `/juËˆnÃ¦nÉªmÉ™s/` adj. å…¨ä½“ä¸€è‡´çš„; ä¸€è‡´åŒæ„çš„; æ— å¼‚è®®çš„\n    1. dissent: `/dÉªËˆsent/` n./vi. å¼‚è®®ï¼›ä¸åŒæ„\n6. consonance: n. ä¸€è‡´ã€åè°ƒï¼›åå’ŒéŸ³ç¨‹\n    1. consonant: adj. ä¸€è‡´çš„ã€å’Œè°çš„ n. è¾…éŸ³ï¼›è¾…éŸ³å­—æ¯\n        1. vowel: å…ƒéŸ³ï¼›å…ƒéŸ³å­—æ¯\n7. conspire: `/kÉ™nËˆspaÉªÉ™(r)/` v. å…±è°‹ï¼›å¯†è°‹\n8. **consecutive: `/kÉ™n'sekjÉ™tÉªv/` adj. è¿ç»­ä¸æ–­çš„**\n9. **prosecution: n. è¯‰è®¼ï¼›åŸå‘Šï¼›å®æ–½ï¼›ä»äº‹**\n10. concurrent: adj. åŒæ—¶å­˜åœ¨(å‘ç”Ÿã€å®Œæˆ)çš„\n\t1. currency: n. é€šè´§ï¼Œè´§å¸ï¼›æµè½¬\n\t2. currently: adv. ç›®å‰ï¼Œå½“ä¸‹\n11. coherence: n. è¿è´¯æ€§ï¼›æ¡ç†æ€§ï¼›ä¸€è‡´æ€§\n    1. coherent: adj. è¿è´¯çš„ï¼›æœ‰æ¡ç†çš„\n12. contract: n. åˆåŒã€å¥‘çº¦ v. æ”¶ç¼©ã€ç¼©ç´§\n    1. contrast: n. åå·®\n13. compassion: n. åŒæƒ…ï¼›æ€œæ‚¯\n# å·§åˆï¼›å¶ç„¶ - hazard\n\n1. coincidental: adj. å·§åˆï¼›ç¢°å·§ï¼›éè®¡åˆ’ä¹‹ä¸­\n    1. identical: adj. ä¸€æ¨¡ä¸€æ ·çš„\n2. haphazard: `/hÃ¦pËˆhÃ¦zÉ™d/` adj. æ— è®¡åˆ’çš„ï¼›ç»„ç»‡æ··ä¹±çš„ adj. å¶ç„¶çš„ï¼›éšä¾¿çš„ n. å¶ç„¶ï¼›å¶ç„¶äº‹ä»¶\n    1. è¯æºï¼šlate 16th cent.: from `hap(â€˜chance, luckâ€™)`+`hazard`.\n    2. hazard: n. å±é™©ï¼›å±å®³\n        1. hazardous: adj. å±é™©çš„ï¼›æœ‰å®³çš„\n        2. **menace: `/ËˆmenÉ™s/` n. å¨èƒï¼›å±é™©çš„äºº**\n# vibrate\n\n1. vibrate: v. é¢¤åŠ¨ã€éœ‡åŠ¨\n    1. vibration: n. éœ‡åŠ¨ã€é¢¤åŠ¨ï¼›ï¼ˆæ„Ÿæƒ…çš„ï¼‰å…±é¸£ã€æ„Ÿåº”\n# è…è´¥: decay - rot - erode - corrode\n\n1. decay: `/dÉªËˆkeÉª/` v./n. è¡°è´¥ï¼›è…è´¥ï¼›å¤±ä¿®åæŸ\n2. rot: `/rÉ’t/` v./n. è…è´¥\n3. erode: `/ÉªËˆrÉ™ÊŠd/` v. é€æ¸åœ°è…èš€ã€å‰Šå¼±ã€æµå¤±\n    1. erosion: `/ÉªËˆrÉ™ÊŠÊ’n/` n. é€æ¸ç ´åï¼›æµå¤±\n4. corrode: `/kÉ™ËˆrÉ™ÊŠd/` v. è…èš€ã€ä¾µèš€\n# æ€§æ ¼\n\n1. peculiar: adj. å¤æ€ªçš„ï¼›ç‰¹æœ‰çš„ n. ç‰¹æœ‰è´¢äº§ - peculiarity: æ€ªç™–ï¼›æ€ªå¼‚ï¼›ç‰¹ç‚¹\n2. eccentric: `/ÉªkËˆsentrÉªk/` adj. å¤æ€ªçš„ï¼›å¼‚ä¹å¯»å¸¸çš„ - eccentricity: `/ËŒeksen'trÉªsÉªtÉª/` n. æ€ªç™–ï¼›å¤æ€ªè¡Œä¸ºï¼›åå¸¸\n3. meek: adj. æŸ”é¡ºçš„ï¼›æ‡¦å¼±çš„ n. æ¸©é¡ºçš„äººï¼›è°¦æ­çš„äºº\n# bold - bald\n\n1. bold: adj. å‹‡æ•¢çš„, æ— ç•çš„ï¼›å†’å¤±çš„, é²è½çš„ï¼›æ˜æ˜¾çš„, é†’ç›®çš„ï¼›ç²—ä½“çš„, é»‘ä½“çš„\n2. bald: adj. adj. ç§ƒé¡¶çš„ï¼›å…‰ç§ƒçš„ï¼›æ— è£…é¥°çš„ vi. å˜ç§ƒ\n# respective - perspective - prospective\n\n1. respective: å„è‡ªçš„ï¼›åˆ†åˆ«çš„\n    1. irrespective of: adj. ä¸é¡¾...çš„ã€ä¸è€ƒè™‘...çš„ï¼›æ— è®º\n        1. The law applies to everyone irrespective of race, religion or color. æ³•å¾‹é€‚ç”¨äºä»»ä½•äººï¼Œæ— è®ºå…¶ç§æ—ã€å®—æ•™æˆ–è‚¤è‰²ã€‚\n2. perspective: n. å®¢è§‚åˆ¤æ–­åŠ›ï¼›è§‚ç‚¹ã€æ€åº¦ã€è§†è§’\n3. prospective: `/prÉ™ËˆspektÉªv/` adj. æœ‰æœ›çš„ã€å¯èƒ½çš„ï¼›é¢„æœŸçš„ï¼›æ½œåœ¨çš„\n# isolate = desolate = insulate - violate - insult - consult\n\n1. **iso**late: `/ËˆaÉªsÉ™leÉªt/` v. éš”ç»ï¼›å­¤ç«‹\n    1. separate: v. `/ËˆsepÉ™reÉªt/` ä½¿åˆ†å¼€ adj. `/ËˆseprÉ™t/` å•ç‹¬çš„ï¼›åˆ†å¼€çš„\n    2. segregate: `/ËˆseÉ¡rÉªÉ¡eÉªt/` v. éš”ç¦»å¹¶åŒºåˆ«å¯¹å¾…\n2. desolate: `/ËˆdesÉ™lÉ™t/` adj. è’å‡‰çš„ï¼›æ— äººå±…ä½çš„\n3. **insu**late: `/ËˆÉªnsjuleÉªt/` v. ä½¿éš”çƒ­ã€éš”éŸ³ï¼›ç»ç¼˜ã€éš”ç»\n    1. insulation: n. éš”çƒ­ã€éš”éŸ³ã€ç»ç¼˜çš„åŠŸæ•ˆï¼›éš”çƒ­ã€éš”éŸ³ã€ç»ç¼˜ææ–™\n4. violate: `/ËˆvaÉªÉ™leÉªt/` v. è¿åï¼ˆæ³•å¾‹ã€åè®®ï¼‰ï¼›ä¾µçŠ¯ã€æ‰°ä¹±\n    1. infringe: `/ÉªnËˆfrÉªndÊ’/` v. è¿åï¼ˆæ³•å¾‹ï¼‰ï¼›ä¾µçŠ¯\n5. insult: `/ËˆÉªnsÊŒlt/` v./n. è¾±éª‚\n6. consult: `/kÉ™nËˆsÊŒlt/` v. å’¨è¯¢ï¼ˆåªæœ‰åŠ¨è¯ï¼‰\n# -tter\n\n1. shatter: `/ËˆÊƒÃ¦tÉ™(r)/` v. æ‰“ç¢ï¼›ç²‰ç¢ï¼›ä½¿ç»ˆç»“ï¼›ä½¿ç ´ç­\n\t1. grind: `/É¡raÉªnd/` v. ç¢¾ç¢\n2. scatter: `/ËˆskÃ¦tÉ™(r)/` v. åˆ†æ•£\n    1. disperse: `/dÉªËˆspÉœËs/` v. ï¼ˆä½¿ï¼‰åˆ†æ•£ï¼›æ•£å‘ã€ä¼ æ’­\n# comprise - compromise - premises - comprehend\n\n1. comprise: vt. ç”±...ç»„æˆï¼›åŒ…å«\n2. compromise: n./v. å¦¥å\n3. premises: `/ËˆpremÉªsÉªz/` n. ï¼ˆä¼ä¸šçš„ï¼‰æˆ¿å±‹ï¼›ç»è¥åœºåœ°\n4. promissory: adj. æ‰¿è¯ºçš„ï¼›çº¦å®šçš„\n    1. Roger signed a promissory note pledging to pay Fiona $50,000. ç½—æ ¼ç­¾äº†ä¸€å¼ æœŸç¥¨ï¼Œæ‰¿è¯ºä»˜ç»™è²å¥¥å¨œ5ä¸‡ç¾å…ƒã€‚\n5. comprehend: v. ç†è§£ï¼›é¢†æ‚Ÿ\n# referent\n\n1. referent: `/'refÉ™rÉ™nt/` n. æŒ‡ç¤ºç‰©ï¼Œæ‰€æŒ‡å¯¹è±¡\n# åŠ¨ä½œ: squat\n\n1. squat: vi. è¹²åï¼›è¹²ï¼›æ“…è‡ªå ä½(ç©ºå±‹) adj. çŸ®èƒ–çš„ï¼›çŸ®è€Œå®½çš„ n. è¹²åï¼Œè¹²å§¿ï¼›è¢«æ“…è‡ªå ç”¨çš„å»ºç­‘ç‰©\n2. shrug: v. è€¸è‚©ï¼ˆè¡¨ç¤ºä¸çŸ¥é“æˆ–ä¸åœ¨ä¹ï¼‰\n   1. shrub: n. çŒæœ¨\n# è„†å¼±\n\n1. brittle: `/'brÉªtl/` adj. ç¡¬ä½†æ˜“ç¢çš„, è„†æ€§çš„, è„†å¼±çš„, å°–åˆ©çš„ n. è–„ç‰‡è„†ç³– v. å˜è„†\n2. vulner: n. åˆ›ä¼¤ï¼›æ¼æ´\n    1. vulnerate: `/'vÊŒlnÉ™reit/` vt. ä½¿å—ä¼¤\n    2. vulnerable: `/ËˆvÊŒlnÉ™rÉ™bl/` adj. æ˜“å—åˆ›ä¼¤çš„\n    3. vulnerability: `/ËŒvÊŒlnÉ™rÉ™ËˆbÉªlÉ™ti/` n. è„†å¼±æ€§ï¼›å¼±ç‚¹ï¼›æ˜“ä¼¤æ€§\n3. susceptible: `/sÉ™ËˆseptÉ™bl/` adj. æ˜“å—å½±å“çš„ï¼›æ•æ„Ÿçš„ï¼›æ„Ÿæƒ…ä¸°å¯Œçš„\n    1. susceptibility: `/sÉ™ËŒseptÉ™ËˆbÉªlÉ™ti/` n. æ•æ„Ÿæ€§\n4. tender: adj. è„†å¼±çš„ã€å«©çš„ã€æŸ”è½¯çš„ï¼›æ˜“åçš„ v./n. æŠ•æ ‡ï¼›æè®®ã€æå‡º\n# å®¶æ—ï¼›ä¼ æ‰¿ã€é—ä¼ \n\n1. posterity: `/pÉ’'sterÉ™ti/` n. åä»£, å­å­™, åä¸–, åè£”\n2. descendant:  adj. ä¸‹é™çš„ï¼›ç¥–ä¼ çš„ n. åè£”ï¼›å­å­™\n    1. ascend: v. ä¸Šå‡ï¼›æ”€ç™»\n3. heritage: n. ï¼ˆè´µé‡ï¼‰é—äº§\n4. legacy: n. é—äº§\n5. estate: n. åœ°äº§ï¼›è´¢äº§\n# æ·¹æ²¡: inundate\n\n1. inundate: `/'ÉªnÊŒndeÉªt/` v. æ·¹æ²¡, ä½¿ä¸èƒœè´Ÿè·, ä½¿åº”æ¥ä¸æš‡, æ³›æ»¥\n    1. undu-, und-ã€æ‹‰ä¸è¯­ä¼ å…¥æ³•è¯­ã€‘è¡¨ç¤ºâ€œæ³¢åŠ¨â€ï¼›â€œæ¶Œå‡ºâ€\n       åŒæ ¹è¯surround|inundate|redundant|abound|\n    2. undã€æ‹‰ä¸ã€‘è¡¨ç¤ºâ€œæ³¢åŠ¨ï¼Œæ³¢æµªâ€\n       è¯æ ¹åŠ©è®°ï¼šinundate:inåœ¨å†… + und=åœ¨é‡Œé¢æœ‰æ³¢æµª=æ³›æ»¥ï¼Œæ·¹æ²¡\n       åŒæ ¹è¯abundant|abundance|inundate|abound|fecundity|redound|undulate|\n   2. inè¿›å…¥ï¼Œundæ³¢æµªï¼Œateä¸€è¿›å…¥æ³¢æµªåˆ™ï¼šæ·¹æ²¡\n   3. undulate: v. æ³¢åŠ¨èµ·ä¼ï¼›æˆæ³¢æµªå½¢\n   4. abundant: adj. ä¸°å¯Œçš„\n# exhibit - inhibit - prohibit\n\n1. exhibit: `/ÉªÉ¡ËˆzÉªbÉªt/` v. æ˜¾ç¤ºã€å±•è§ˆ n. å±•è§ˆå“ï¼›è¯æ®ï¼›å±•ç¤ºä¼š\n    1. exhibition: `/ËŒeksÉªËˆbÉªÊƒn/` n. å±•è§ˆå“ï¼›å±•è§ˆï¼›è¡¨ç°ï¼›å¥–å­¦é‡‘\n2. inhibit: `/ÉªnËˆhÉªbÉªt/` v. é˜»æ­¢ï¼›æŠ‘åˆ¶ï¼›ä½¿æ‹˜æŸã€æ”¶æ•›\n    1. inhibition: `/ËŒÉªnhÉªËˆbÉªÊƒn/` n. æ‹˜è°¨ã€æ‹˜æŸæ„Ÿï¼›æŠ‘åˆ¶\n    2. inhabit: `/ÉªnËˆhÃ¦bÉªt/` v. å±…ä½åœ¨ã€æ –å±…äº\n        1. inhabitant: n. å±…æ°‘\n3. prohibit: `/prÉ™ËˆhÉªbÉªt/` vt. é˜»æ­¢ã€ç¦æ­¢\n    1. prohibition: `/ËŒprÉ™ÊŠÉªËˆbÉªÊƒn/` n. ï¼ˆæ³•å¾‹ï¼‰ç¦æ­¢\n# hollow\n\n1. hollow: adj. ç©ºçš„ï¼›ç©ºå¿ƒçš„ï¼›ç©ºæ´çš„ n. æ ‘æ´ï¼›å‡¹é™·å¤„ v. ä½¿å‡¹é™·\n# exhaust - fatigue\n\n1. exhaust: vt. ç”¨å°½ã€è€—å°½ï¼›ä½¿éå¸¸ç–²å€¦ vi. æ’æ°” n. æ’æ°”è£…ç½®ï¼›æœºå™¨æ’å‡ºçš„åºŸæ°”\n    1. exhausted: adj. è€—å°½çš„,ç”¨å®Œçš„ï¼›ç­‹ç–²åŠ›å°½çš„ï¼›ç²¾ç–²åŠ›ç«­çš„\n2. fatigue: `/fÉ™ËˆtiËÉ¡/` n. ç–²åŠ³ vt. ä½¿ç–²åŠ³ vi. ç–²åŠ³ adj. ç–²åŠ³çš„\n# è¶³å¤Ÿçš„ã€å……åˆ†çš„: sufficient - adequate\n\n1. sufficient: adj. è¶³å¤Ÿçš„ã€å……åˆ†çš„ - suffice: v. è¶³å¤Ÿï¼›è¶³ä»¥\n2. adequate: adj. è¶³å¤Ÿçš„ã€å……åˆ†çš„ï¼›é€‚å½“çš„\n# blend - mix\n\n1. blend: v./n. æ··åˆï¼›èåˆ\n    1. æ··åˆä¸å…¶å„æˆåˆ†çš„æ€§è´¨é€šå¸¸æ˜¯ä¸€è‡´çš„ï¼Œä¾§é‡æ··åˆæ•´ä½“çš„ç»Ÿä¸€æ€§ä¸å’Œè°æ€§ã€‚\n2. mix: v./n. æ··å’Œ\n    1. æ··åˆçš„å„æˆåˆ†å¯èƒ½æŒ‰åŸæ ·å­˜åœ¨ï¼Œä½†ä¸ä¸€å®šèƒ½è¾¨åˆ«å‡ºæ¥ã€‚\n# scarce - scarcity\n\n1. scarce: `/skeÉ™s/` adj. ç¼ºä¹çš„ã€ä¸è¶³çš„ï¼›ç¨€å°‘çš„\n    1. scarcely: `/ËˆskeÉ™sli/` adv. å‡ ä¹ä¸ï¼›éš¾å¾—ã€å‹‰å¼º\n    2. scarcity: `/ËˆskeÉ™sÉ™ti/` n. ç¼ºä¹ã€ä¸è¶³\n    3. deficient: `/dÉªËˆfÉªÊƒnt/` adj. ç¼ºä¹çš„ã€ä¸è¶³çš„ï¼›æœ‰ç¼ºç‚¹çš„ã€æœ‰ç¼ºé™·çš„\n        1. sufficient: `/sÉ™ËˆfÉªÊƒnt/` adj. è¶³å¤Ÿçš„ã€å……è¶³çš„\n# wade\n\n1. wade: v. è·‹æ¶‰ï¼›è¹šæ°´\n# ç ”è®¨ä¼š\n\n1. workshop\n2. seminar\n3. symposium\n# æ­»äº¡ã€æ¯ç­: mortal - martyr - mar - toll - perish - doom\n\n1. mortal: `/ËˆmÉ”Ëtl/` adj. ä¸èƒ½æ°¸ç”Ÿçš„ï¼›ç»ˆå°†æ­»äº¡çš„ n. å‡¡äººï¼›æ™®é€šäºº\n    1. late Middle English: from Old French, or from Latin `mortalis, from mors, mort- â€˜deathâ€™`\n    2. mortality: `/mÉ”ËËˆtÃ¦lÉ™ti/` n. æ­»äº¡æ•°é‡ã€æ­»äº¡ç‡ï¼›ç”Ÿå‘½çš„æœ‰é™æ€§\n        1. toll: `/tÉ™ÊŠl/` n. ï¼ˆè‡ªç„¶ç¾å®³ã€å†²çªäº‹æ•…ï¼‰ä¼¤äº¡äººæ•°ï¼›è¿‡è·¯è´¹\n        2. perish: `/ËˆperÉªÊƒ/` vi. çªç„¶æ­»äº¡ã€æš´æ¯™ï¼›æ¯ç­\n        3. doom: `/duËm/` n. æ­»äº¡æ—¶åˆ»ï¼›å„è¿ v. ä½¿...æ³¨å®šå¤±è´¥ï¼ˆå¸¸ç”¨äºè¢«åŠ¨ï¼Œbe doomedï¼‰\n2. corpse: `/kÉ”Ëps/` n. æ­»å°¸ã€å°¸ä½“\n3. mar: v. ç ´åã€æŸæ¯\n    1. **martyr: `/ËˆmÉ‘ËtÉ™(r)/` n. çƒˆå£«ï¼›æ®‰é“è€…**\n        1. Old English `martir`, via ecclesiastical Latin from Greek `martur â€˜witnessâ€™ (in Christian use, â€˜martyrâ€™)`\n# å±…æ°‘ï¼›ç§»æ°‘ï¼›é‚»å±…ï¼›å±…æ‰€\n\n1. adjacent: æ¯—è¿çš„ï¼Œé‚»è¿‘çš„ï¼›éš”å£çš„\n    1. adjective: n. å½¢å®¹è¯\n        1. preposition: n. ä»‹è¯\n2. inn: n. å®¢æ ˆ\n3. solitude: n. ç‹¬å±…ã€ç‹¬å¤„ã€éšå±…ï¼›å­¤ç‹¬\n4. inhabit: `/ÉªnËˆhÃ¦bÉªt/` v. å±…ä½åœ¨ã€æ –å±…äº\n    1. inhabitant: `/ÉªnËˆhÃ¦bÉªtÉ™nt/` n. å±…æ°‘ã€ä½æˆ·ï¼›æ –æ¯çš„åŠ¨ç‰©\n       The city's first inhabitants arrived in the 18th century.\n    2. inhibit: `/ÉªnËˆhÉªbÉªt/` v. é˜»æ­¢ï¼›æŠ‘åˆ¶ï¼›ä½¿æ‹˜æŸã€æ”¶æ•›\n        1. inhibition: `/ËŒÉªnhÉªËˆbÉªÊƒn/` n. æ‹˜è°¨ã€æ‹˜æŸæ„Ÿï¼›æŠ‘åˆ¶\n5. reside: `/rÉªËˆzaÉªd/` vi. å±…ä½ã€å®šå±…\n    1. resident: n. å±…æ°‘\n6. tenant: `/ËˆtenÉ™nt/` n. æ‰¿ç§Ÿäººï¼›æˆ¿å®¢ï¼›å±…ä½è€…\n    1. rent: ç§Ÿ\n7. dwelling: n. ä½å®…ã€ä½æ‰€ï¼›å…¬å¯“\n\t1. dweller: å±…æ°‘ã€å±…ä½è€…ï¼›æ –èº«è€…\n8. lounge: n. ï¼ˆæœºåœºç­‰çš„ï¼‰ä¼‘æ¯å®¤\n    1. lodge: `/lÉ’dÊ’/` v. ï¼ˆå‘æœºæ„ï¼‰æ­£å¼æå‡ºï¼ˆå£°æ˜ï¼‰ï¼›å€Ÿå®¿ï¼Œç§Ÿä½ï¼›ä¸º...æä¾›ä½å®¿ï¼›å¯„å­˜ï¼Œå­˜æ”¾ï¼Œä½¿å›ºå®šã€åµŒå…¥ n. ä¼ è¾¾å®¤ã€ç®¡ç†å‘˜å®¤ï¼›é—¨æˆ¿, æ—…é¦†ï¼›ä¹¡é—´å°å±‹\n9. abide: `/É™ËˆbaÉªd/` v. å®¹å¿ã€å¿å—ï¼›å±…ä½\n10. accommodation: n. ä½å®¿ï¼›å’Œè§£ã€è°ƒè§£\n    1. accommodate: v. å®¹çº³ï¼›é€‚åº”ï¼›æä¾›ä½å®¿\n    2. dormitory: n. å­¦ç”Ÿå®¿èˆ\n11. emigrate: `/ËˆemÉªÉ¡reÉªt/` v. ç§»å±…ï¼›ç§»æ°‘è‡³å›½å¤–ï¼ˆæŒ‡ä»æœ¬å›½ç§»å‡ºï¼Œé•¿æœŸå®šå±…åœ¨å¤–ã€‚ï¼‰\n    1. migrate: ï¼ˆé¸Ÿæˆ–åŠ¨ç‰©ï¼‰è¿å¾™\n    2. immigrate: vi. ç§»å…¥ï¼ˆæŒ‡ä»ä»–å›½ç§»å…¥ï¼Œé•¿æœŸå®šå±…ã€‚ï¼‰\n# ally - alien\n\n1. ali**e**n: `/ËˆeÉªliÉ™n/` n. å¤–å›½äººï¼›å¤–æ˜Ÿäºº adj. ä¸ç†Ÿæ‚‰ï¼›ä¸ç›¸å®¹\n    1. alienate: `/ËˆeÉªliÉ™neÉªt/` v. ä½¿ç–è¿œ\n        1. alienation: `/ËŒeÉªliÉ™ËˆneÉªÊƒn/` n. ç–è¿œï¼›æ ¼æ ¼ä¸å…¥\n2. ally: `/ËˆÃ¦laÉª/` n. ç›Ÿå‹ v. ä¸...ç»“ç›Ÿ\n    1. alli**a**nce: `/É™ËˆlaÉªÉ™ns/` n. è”ç›Ÿä½“\n# ç§¯æçš„è¯æ±‡\n\n1. triumph: `/ËˆtraÉªÊŒmf/` n. å·¨å¤§æˆåŠŸã€æˆå°±ã€èƒœåˆ©\n    1. triumphant: `/traÉªËˆÊŒmfÉ™nt/` adj. å·¨å¤§æˆåŠŸçš„ã€å¤§è·å…¨èƒœçš„ï¼›æ´‹æ´‹å¾—æ„çš„\n    2. trumpet: `/ËˆtrÊŒmpÉªt/` n. å–‡å­ã€å°å· v. å®£æ‰¬ã€é¼“å¹\n2. benevolent: `/bÉ™ËˆnevÉ™lÉ™nt/` adj. æ…ˆå–„çš„\n    1. benign: `/bÉªËˆnaÉªn/` adj. å’Œå–„çš„ï¼›æ— å®³çš„\n    2. amiable: `/ËˆeÉªmiÉ™bl/` adj. å’Œå–„çš„\n3. welfare: `/ËˆwelfeÉ™(r)/` n. å¹¸ç¦ï¼›ï¼ˆå¤šä¸ºæ”¿åºœç»™äºˆçš„ï¼‰ç¦åˆ©\n    1. warfare: `/ËˆwÉ”ËfeÉ™(r)/` n. æˆ˜äº‰\n4. merit: `/ËˆmerÉªt/` n. ä¼˜ç‚¹ã€é•¿å¤„ã€ä»·å€¼ï¼›ç¾å¾·ã€åŠŸç»© v. åº”å¾—ã€å€¼å¾— = worth\n# æ¶ˆæçš„è¯æ±‡\n\n1. plight: `/plaÉªt/` n. å›°å¢ƒï¼›è‹¦éš¾\n2. snob: `/snÉ’b/` n. åŠ¿åˆ©å°äººï¼›è‡ªä»¥ä¸ºä¼˜è¶Šçš„äºº\n    1. cynicism: `/'sÉªnÉªsÉªz(É™)m/` n. äººäººè‡ªç§ä¸»ä¹‰ï¼›æ‚²è§‚ï¼›ç©ä¸–ä¸æ­ï¼ˆå¯¹ç”Ÿæ´»ä¸ä¸¥è‚ƒã€ä¸è®¤çœŸï¼‰\n3. **adverse: `/É™dËˆvÉœËrs/, /ËˆÃ¦dvÉœËrs/` adj. åçš„ã€ä¸åˆ©çš„ã€æœ‰å®³çš„ï¼›åé¢çš„**\n    1. aversion: `/É™ËˆvÉœËÊƒn/` n. åŒæ¶ã€åæ„Ÿ\n    2. averse: `/É™ËˆvÉœËs/` adj. ä¸å–œæ¬¢çš„ï¼›ä¸æƒ³çš„ï¼›åå¯¹çš„\n        1. å¸¸ç”¨äºnot averseå¦å®šå¥å‹ï¼Œè¡¨ç¤ºå–œæ¬¢ã€æƒ³åšã€ä¸åå¯¹\n4. wretched: `/ËˆretÊƒÉªd/` adj. ä¸æ„‰å¿«çš„ã€éš¾å—çš„ï¼›å¯æ€œçš„\n    1. wretch: `/retÊƒ/` n. å¯æ€œçš„äºº\n# è€å‹è®°\n\n1. omnipotent: `/É’mËˆnÉªpÉ™tÉ™nt/` adj. æ— æ‰€ä¸èƒ½çš„ã€å…¨èƒ½çš„\n    1. impotent: `/ËˆÉªmpÉ™tÉ™nt/` adj. ä¸èµ·ä½œç”¨çš„ã€æ— èƒ½çš„ï¼›æ€§æ— èƒ½çš„\n    2. å‡ºè‡ªS1E4å¼€åœºï¼ŒJoeyè¯¯æŠŠomnipotentå¬æˆimpotentäº†ã€‚","categories":["è‹±è¯­"]},{"title":"é›…æ€å¬åŠ›","url":"/è‹±è¯­/é›…æ€å¬åŠ›/","content":"\n# è€ƒè¯•æµç¨‹\n\nçº¸ç¬”è€ƒè¯•8ç‚¹åŠå‰è¿›åœºï¼Œ9ç‚¹å‘ç­”é¢˜å¡ã€‚\n\n# é›…æ€å¬åŠ›æ¦‚å†µ\n\nåªè¯»ä¸€éã€‚æ—¶é—´ï¼š35åˆ†é’Ÿ+10åˆ†é’Ÿï¼ˆå¡«ç­”é¢˜å¡ï¼Œåªæœ‰çº¸ç¬”è€ƒè¯•æ‰æœ‰ï¼‰ã€‚\n\nå››ä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†10é“é¢˜ã€‚\n\nç¬¬ä¸€éƒ¨åˆ†ï¼Œconversationï¼Œä¸¤ä¸ªè®²è¯äººã€‚social and semi-official contextã€‚é€šå¸¸æ˜¯å’¨è¯¢ï¼Œæ‰€ä»¥ä¸¤è€…æ˜¯ä¸åŒçš„èº«ä»½ã€‚è¦é¢„åˆ¤è°è¯´å‡ºæ¥ã€‚ç§Ÿæˆ¿å­ã€å’¨è¯¢è€ƒè¯•ã€è®¢é…’åº—ã€‚\n\nç¬¬äºŒéƒ¨åˆ†ï¼Œtalkï¼Œå•ç‹¬è®²è¯ï¼ˆä½†æ˜¯ä¸æ’é™¤æœ‰ä¸¤ä¸ªè®²è¯äººï¼Œä½†æ˜¯å¦å¤–ä¸€ä¸ªäººåªæ˜¯æŠ›ç –å¼•ç‰ï¼‰ã€‚ä»‹ç»å®ä¹ ç”Ÿå·¥ä½œã€æ—…æ¸¸è·¯çº¿ã€‚\n\nç¬¬ä¸‰éƒ¨åˆ†ï¼Œconversation or discussionã€‚æœ€å¤šå››ä¸ªè®²è¯äººï¼Œå®é™…ä¸Šæœ€å¤šä¸‰ä¸ªäººï¼Œä½†æ˜¯ä»å‰‘10 ä¹‹ååŸºæœ¬ä¸Šéƒ½åªæœ‰ä¸¤ä¸ªäººã€‚è¯é¢˜æ˜¯åŸºäºå­¦æœ¯æˆ–ä¸è¯¾ç¨‹ç›¸å…³çš„ã€‚\n\nç¬¬å››éƒ¨åˆ†ï¼Œå¤§å­¦é£æ ¼çš„lecture or talkï¼Œæ—¶é—´è¾ƒé•¿ï¼Œå†…å®¹è¾ƒä¸“ä¸šã€‚ç‰©ç†ã€å¿ƒç†ã€å•†ä¸šã€å¥åº·ã€ç¯å¢ƒä¿æŠ¤ã€å†å²ã€äººæ–‡ã€å»ºç­‘ã€‚\n\n1ã€4å¤§å¤šè€ƒå¡«ç©ºã€å¡«è¡¨ã€å¡«å¥å­ã€ç®€ç­”ï¼Œä¸»è¦å†™å•è¯ã€‚2ã€3å¤§å¤šè€ƒé€‰æ‹©ï¼Œå•é€‰ã€å¤šé€‰ã€åŒ¹é…ã€åœ°å›¾ã€æµç¨‹ï¼ˆåŒ¹é…é¢˜çš„å˜å½¢ï¼‰ã€‚ç¬¬ä¸‰éƒ¨åˆ†é€šå¸¸ä¼šå‡ºé•¿é€‰æ‹©ã€åŒ¹é…ï¼Œéš¾åº¦æœ€å¤§ã€‚\n\n## åšé¢˜æŠ€å·§\n\n1. æ‰€å¬å³æ‰€ç­”ï¼Œä¸ä¼šæ”¹è¯æ€§ã€‚\n2. æ³¨æ„é‡éŸ³ï¼Œå°¤å…¶æ˜¯ç¬¬ä¸‰éƒ¨åˆ†å¡«ç©ºé¢˜\n3. çº¸ç¬”è€ƒè¯•æ—¶ï¼ŒèªŠæŠ„ç­”æ¡ˆæ—¶ï¼Œå…¨éƒ¨å†™ä¸ºå¤§å†™å­—æ¯ã€‚é™¤éå¼ºè°ƒäº†all lower caseï¼ˆç½‘å€ã€å¯†ç ï¼‰\n   1. é¿å…é—å¿˜å¤§å°å†™åŒºåˆ†ã€‚\n   2. å¯¹äºæ£€æŸ¥æ‹¼å†™é”™è¯¯æœ‰å¸®åŠ©\n\n## ç§°è°“\n\n1. Full Name\n   1. first name = given name = forename\n   2. last name = family name = surname\n2. Title\n   1. Mr.\n   2. `Mrs.` - å°¾éŸ³siz å·²å©š, `Miss` - å°¾éŸ³s æœªå©š, `Ms.` - å°¾éŸ³z æœªçŸ¥æ˜¯å¦å·²å©šã€‚\n\n## åœ°ç‚¹\n\n1. æ³¨æ„Postcodeã€Zip codeï¼ˆeg: MK32 6KTï¼‰\n2. Room Number\n   1. 15 & 50\n   2. 40A & 48\n3. Street, Road, Avenueæœ€å¸¸è€ƒï¼ŒLane, Drive, Square, Boulevard, Place, Bay, Highway, Plazaè®¤è¯†å°±å¥½ã€‚\n\n## æ—¥æœŸ\n\n1. `DD/MM/YYYY` or `MM/DD/YYYY`å‡å¯\n2. æ—¥æœŸå†™æˆåŸºæ•°è¯æˆ–åºæ•°è¯å‡å¯ï¼ŒåŸºæ•°è¯ç®€å•ï¼Œæ¯”å¦‚March 31ã€‚å¬åˆ°çš„æ—¶å€™å¯ä»¥å…ˆå†™ä¸ªè‰ç¨¿Mar 31ï¼Œä½†æ˜¯èªŠæŠ„æ—¶è¦æ‹¼å…¨ä¸ºMarchï¼\n\n## æ•°å­—\n\n1. passport number\n2. driving license number\n3. license plate number\n4. student ID/number\n5. membership number\n6. medical card number\n7. flight number\n8. account number\n9. credit card number\n10. fax number\n11. telephone number\n\npassportã€driving licenseã€flightã€credit cardä¸“é—¨è€ƒè¿‡è¿™å››ä¸ªè¯çš„å¡«ç©ºã€‚\n\n### åˆ†æ•°ã€å°æ•°ã€ç™¾åˆ†æ•°\n\n1. `2/3`: two thirdsï¼Œ`1/4`: one fourthï¼Œ`3/4`: three fourths\n   1. over - `219/763`: two hundred and nineteen **over** seven hundred and sixty three\n   2. in out of - `15/20`: fifteen **in out of** twenty\n2. `12.789`: twelve **point** seven eight nine\n   1. `0.67`: **point** six seven; **naught point** six seven; **zero point** six seven\n3. `12.5%`: twelve point five percent; twelve and a half percent\n\n### é’±\n\n`ï¿¡1`: one pound, `ï¿¡2`: two pounds\n\n`ï¿¡2.50`: ä¸åº”è¯¥è¯´æˆtwo point five poundsï¼Œåé¢çš„50åº”è¯¥è½åœ¨fifty ä¾¿å£«ä¸Šã€‚æœ€å¥½åº”è¯¥è¯´æˆä¸¤ç£…äº”ï¼Œtwo pounds fiftyã€‚\n\nå…³äºç¾å…ƒï¼šé›…æ€æ²¡è€ƒè¿‡ç¾åˆ€ï¼Œä½†æ˜¯è€ƒè¿‡Canadian Dollarsã€Australian Dollarsã€‚\n\nç¾å…ƒæœ‰å¯èƒ½`$ 25.50`ä¼šçœç•¥ä¸­é—´çš„dollarï¼Œä¼šå¿µæˆ: twenty-five fiftyã€‚ä½†æ˜¯è‹±é•‘æ²¡è¿™æ ·å¿µè¿‡ã€‚\n\n## æ°‘æ—\n\n1. -ish: **British, English, Spanish, Swedish**ï¼ˆç‘å…¸ï¼Œå›½åæ˜¯Swedenï¼‰, Turkishï¼ˆä¸å¸¸è€ƒï¼‰\n2. -an: American, Canadian, Australian, Russian, German, Italian\n3. -ese: Chinese, Japanese\n4. -iï¼ˆä¸å¸¸è€ƒï¼‰: Iraqi, Kuwaiti, Pakistani\n5. -icï¼ˆä¸å¸¸è€ƒï¼‰: Icelandic, Arabic\n6. ç‰¹æ®Š: New Zealander, French, Swissï¼ˆç‘å£«ï¼Œå›½åæ˜¯Switzerlandï¼‰, Greek, Dutchï¼ˆè·å…°ï¼Œå›½åæ˜¯Netherlandsï¼‰, Thai\n\næœ‰å…³æ°‘æ—çš„é¢˜ä¸€å¾‹éƒ½å¡«å½¢å®¹è¯ã€‚\n\n## è®¡é‡å•ä½\n\nå•ä½å¯ä»¥å†™ç¼©å†™ï¼Œä½†æ˜¯ç¼©å†™ä¸èƒ½å†™æˆå¤§å†™ã€‚ç¼©å†™å¿…é¡»å†™æˆå°å†™ï¼Œä¸”ç¼©å†™åé¢ä¸èƒ½åŠ å¤æ•°sã€‚\n\nå¦‚æœè¦å’Œå…¨éƒ¨æ‹¼å†™å¤§å†™ä¿æŒä¸€è‡´çš„è¯ï¼Œå»ºè®®å…¨æ‹¼å‡ºæ¥ï¼Œå¯ä»¥å†™æˆå¤§å†™ï¼Œæ¯”å¦‚KILOMETERï¼Œä½†æ˜¯æ³¨æ„ï¼Œå¦‚æœæ˜¯å¤æ•°ä¸”æ˜¯å…¨æ‹¼ï¼Œéœ€è¦åŠ Sï¼ŒKILOMETERSã€‚\n\n1. é•¿åº¦ï¼škilometer/km, meter/m, centimeter/cm, mile/ml(Br)/mi(Am)è‹±é‡Œï¼ˆè€ƒè¿‡ï¼‰, feet(pl)/foot(s)/ftè‹±å°º, inch/inè‹±å¯¸ã€‚\n2. é‡é‡ï¼škilogram/kgï¼ˆè€ƒè¿‡ï¼‰, gram/g, pound/lb, tonne/tonå…¬å¨/è‹±å¨\n3. é¢ç§¯ï¼šsquare meter/sq m, hectare/haå…¬é¡·ï¼ˆè€ƒè¿‡ï¼‰, acreè‹±äº©\n4. æ¶²é‡ï¼š**liter/l**ï¼ˆè€ƒè¿‡ï¼‰\n5. æ¸©åº¦ï¼šFahrenheit/F, centigrade/Celsius/C\n6. è´§å¸ï¼š1 dollar = 100 cents, 1 pound = 100 pence(p), Euro, Japanese Yen\n","categories":["è‹±è¯­"]},{"title":"é›…æ€é˜…è¯»","url":"/è‹±è¯­/é›…æ€é˜…è¯»/","content":"\n# è€ƒè¯•æµç¨‹\n\nçº¸ç¬”è€ƒè¯•é˜…è¯»æ€»å…±60åˆ†é’Ÿï¼Œä½†æ˜¯æ²¡æœ‰å•ç‹¬å¡«ç­”é¢˜å¡çš„æ—¶é—´ï¼Œæ‰€ä»¥å®é™…ä¸Šåªèƒ½åš54åˆ†é’Ÿã€‚å†™ä¸€ç¯‡ï¼Œå¡«ä¸€ç¯‡ã€‚\n\nä¸‰ç¯‡æ–‡ç« ã€‚40é“é¢˜ã€‚\n\nå››å¤§ç±»é¢˜å‹ï¼šï¼ˆå…±13ä¸ªå°çš„ç±»åˆ«ï¼‰\n\n1. å¡«ç©º\n   1. ç®€ç­”ã€å®Œæˆå¥å­ã€æ— /æœ‰é€‰é¡¹summaryã€è¡¨æ ¼é¢˜ã€å›¾è¡¨æ ‡è®°ã€æµç¨‹å›¾\n2. åˆ¤æ–­\n3. é€‰æ‹©ï¼ˆå•é€‰ã€å¤šé€‰ï¼‰\n4. åŒ¹é…\n   1. ç‰¹æ®Šè¯åŒ¹é…ã€é¦–å°¾å¥åŒ¹é…ã€æ®µè½ä¿¡æ¯åŒ¹é…ã€å°æ ‡é¢˜ã€‚\n\nå¡«ç©ºã€åˆ¤æ–­éš¾åº¦ç¨ä½ï¼›é€‰æ‹©ã€åŒ¹é…éš¾åº¦ç¨é«˜ã€‚\n\n27-29é“é¢˜6.5åˆ†ï¼Œ30-32é“7.0ï¼Œ33-34é“7.5ã€‚å¹³å‡ä¸€ç¯‡æ–‡ç« åªèƒ½é”™2åˆ°3é“é¢˜ï¼Œæ‰èƒ½ä¿è¯7åˆ†ä»¥ä¸Šã€‚\n\n60%è€ƒå¯ŸåŸºç¡€è¯æ±‡ã€å¥æ³•ï¼›20%è€ƒå¯Ÿé˜…è¯»ç†è§£ã€å®šä½æŠ€å·§ï¼›20%æ–‡ç« é€»è¾‘å…³ç³»ã€åˆ¤æ–­åŠ›ã€‚\n\nå†…å®¹ä¸å›ºå®šï¼Œä½†æ˜¯æ–‡ç« ä½“è£åªæœ‰ä¸¤ç±»ï¼Œè¯´æ˜æ–‡ - ç°è±¡è§£é‡Šã€è®®è®ºæ–‡ - é—®é¢˜è§£å†³ã€‚\n\n## å…¶ä»–\n\nåœ¨ç­”é¢˜å¡ä¸Šä¸èƒ½åªå†™tæˆ–fï¼Œä¸èƒ½å†™ç¼©å†™ï¼Œè¦å…¨éƒ¨éƒ½å†™å®Œï¼Œnot givenä½ è¦å†™æˆnot givenã€‚\n\n# æ–‡ç« éš¾åº¦åˆ†æ\n\n1. ä¸‰ç¯‡éš¾åº¦éšæœº\n2. ç¬¬ä¸€ç¯‡éš¾åº¦å¤§çš„æ¯”ä¾‹æœ‰æ‰€æå‡\n3. ç¬¬ä¸‰ç¯‡ä¸€èˆ¬æ¯”è¾ƒç®€å•\n\néš¾åœ¨å“ªé‡Œï¼Ÿ\n\n1. æ–‡ç« å†…å®¹åç¦»æ—¥å¸¸ç”Ÿæ´»æ¥è§¦çš„çŸ¥è¯†\n   1. å’”åš“å¿½æ‚ å¯çš„å»ºç­‘ç¾¤ã€å¤ä»£çš„äºº\n   2. åœ°ç†ç±»çš„Grand Canyon\n   3. ç¾å›½å¤§å³¡è°·çš„å½¢æˆåŸå› \n   4. åœ°ç†å­¦çš„æ´‹æµ\n   5. å¿ƒç†å­¦ä¸Šæƒ…ç»ªæœ‰å…³çš„å¤§è„‘å®šé‡åˆ†æ\n   6. è¯­è¨€å­¦ä¸Šçš„å£å“¨\n\n2. é¢˜ç›®å›åˆ°åŸæ–‡åŒä¹‰æ›¿æ¢çš„æ¯”ä¾‹å¢åŠ \n   1. ä»¥å‰ä½ çš„é¢˜ç›®å’Œä½ çš„æ–‡ç« è¿˜èƒ½çœ‹åˆ°ä¸€äº›åŸæ–‡åŸè¯ï¼Œä½†æ˜¯ç°åœ¨å°±æ²¡æœ‰äº†ï¼Œç°åœ¨ä½ åœ¨é¢˜ç›®é‡Œçœ‹åˆ°è¿™ä¸ªè¯ï¼Œä½ åœ¨æ–‡ç« ä¸­æ€ä¹ˆéƒ½çœ‹ä¸ç€è¿™ä¸ªè¯ï¼Œå¾€å¾€éƒ½æ˜¯åŒä¹‰è¯æ›¿æ¢\n\n\n## ä¼˜å…ˆé€‰æ‹©å®¹æ˜“é¢˜åš\n\n1. å››å¤§ç±»é¢˜å‹ï¼šï¼ˆå…±13ä¸ªå°çš„ç±»åˆ«ï¼‰å¡«ç©ºã€åˆ¤æ–­éš¾åº¦ç¨ä½ï¼›é€‰æ‹©ã€åŒ¹é…éš¾åº¦ç¨é«˜ã€‚\n   1. å¡«ç©º\n      1. ç®€ç­”ã€å®Œæˆå¥å­ã€æ— /æœ‰é€‰é¡¹summaryã€è¡¨æ ¼é¢˜ã€å›¾è¡¨æ ‡è®°ã€æµç¨‹å›¾\n   2. åˆ¤æ–­\n   3. é€‰æ‹©ï¼ˆå•é€‰ã€å¤šé€‰ï¼‰\n   4. åŒ¹é…\n      1. ç‰¹æ®Šè¯åŒ¹é…ã€é¦–å°¾å¥åŒ¹é…ã€æ®µè½ä¿¡æ¯åŒ¹é…ã€å°æ ‡é¢˜ã€‚\n2. å¦‚æœé¢˜å‹çœ‹ç€å·®ä¸å¤šï¼Œå°±çœ‹æ–‡ç« çš„å¼€å¤´å’Œtopicã€‚ä¼˜å…ˆé€‰æ‹©è‡ªå·±ç†Ÿæ‚‰è¯é¢˜çš„æ–‡ç« ã€‚\n2. æŒ‰é˜…è¯»é‡\n   1. æœ‰çš„æ˜¯ä¸éœ€è¦è¯»å¤ªå¤šçš„å†…å®¹å°±èƒ½åšå¾—å‡ºæ¥ç­”æ¡ˆçš„\n   2. æœ‰çš„é¢˜ç›®è¦æ±‚é˜…è¯»é‡æ¯”è¾ƒé«˜ï¼Œå®ƒéœ€è¦ä½ å¯èƒ½è¯»ä¸€æ•´ç¯‡ï¼Œæˆ–è€…æ˜¯å¯èƒ½è¯»ä¸€ä¸ªæ®µè½æ‰èƒ½åšå¯¹è¿™ç§æƒ…å†µã€‚\n      1. åƒé€‰æ‹©å’ŒåŒ¹é…å°±å±äºéš¾åº¦æ¯”è¾ƒé«˜ï¼Œä¹Ÿå°±æ˜¯é˜…è¯»é‡æ¯”è¾ƒé«˜çš„é¢˜ç›®\n      2. ä½†å¹¶ä¸æ˜¯è¯´æ‰€æœ‰çš„ç®€å•é¢˜å‹éƒ½ä¸€å®šç®€å•ï¼Œä¹Ÿå¹¶ä¸æ˜¯è¯´æ‰€æœ‰çš„éš¾çš„é¢˜å‹ä¸€ç›´éš¾\n4. æŒ‰ç…§æ–‡ç« é•¿åº¦æ¥çœ‹çš„è¯ï¼Œå…ˆåšçŸ­æ–‡ç« ï¼ŒçŸ­çš„å°±æ„å‘³ç€ä½ æ‰€éœ€è¦çœ‹çš„å†…å®¹å°‘ï¼Œæ‰€ä»¥å…ˆåšçŸ­çš„ï¼Œå¦‚æœé•¿åº¦ä¹Ÿéƒ½å·®ä¸å¤šï¼Œé‚£å»çœ‹æ–‡ç« ç”Ÿè¯å¤§æ¦‚ç„ä¸€çœ¼å“ªäº›æ–‡ç« é‡Œé¢ç”Ÿè¯æœ€å°‘ï¼Œå…ˆåšã€‚\n\n# å¦‚ä½•ç»ƒä¹ \n\næ¯å¤©æ‰“å¥½åŸºç¡€è¯­æ³•å’Œå•è¯çš„å°±æ˜¯ç»ƒä¹ ã€‚\n\n## è¯æ±‡\n\nåœ¨APPä¸ŠèƒŒé˜…è¯»è¯æ±‡ï¼Œä¸€å¤©èƒŒ5ç»„åŒä¹‰è¯æ›¿æ¢ï¼ˆå‰‘1~å‰‘9åŒä¹‰æ›¿æ¢ã€å‰‘10åŒä¹‰æ›¿æ¢ã€å‰‘11åŒä¹‰æ›¿æ¢ã€å‰‘13åŒä¹‰æ›¿æ¢ï¼‰ï¼Œç„¶åå†çœ‹æ¯ä¸€æœ¬ä¸åŒä¹¦çš„æ—¶å€™å»èƒŒå®ƒçš„å¿…å¤‡è¯æ±‡ï¼ˆé›…æ€é˜…è¯»å¿…å¤‡è¯æ±‡C4~C11ï¼‰ï¼Œå¦‚æœé˜…è¯»åˆ†æ•°æƒ³è¦åœ¨7.5åˆ†ä»¥ä¸Šï¼Œå•è¯é‡ä¸€å®šæ˜¯åœ¨8000ä»¥ä¸Šçš„ï¼Œè€Œä¸”åŠ ä¸Šé˜…è¯»æŠ€å·§æ‰èƒ½åˆ°7.5åˆ†ä»¥ä¸Šï¼Œå¦‚æœé˜…è¯»æŠ€å·§ç¨å¾®å¼±ä¸€ç‚¹çš„è¯ï¼Œä½ å°±å¾—åˆ°åœ¨10000ã€12000ã€‚\n\nä½†æ˜¯é˜…è¯»çš„å•è¯æœ‰ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯åœ¨äºå®ƒä¸éœ€è¦ä½ å¯¹è¿™ä¸ªå•è¯æœ‰éå¸¸æ·±åˆ»çš„è®¤çŸ¥ï¼Œä½ åªéœ€è¦çœ‹åˆ°è¿™ä¸ªå•è¯è®¤è¯†ï¼ŒçŸ¥é“å®ƒçš„å¤§æ¦‚ä¸­æ–‡æ„æ€å°±è¡Œäº†ï¼Œä¸€å®šä¸è¦å¤ªå‡†ç¡®ï¼Œå¦‚æœé˜…è¯»è¯æ±‡ä½ çš„ä¸­æ–‡æ„æ€èƒŒå¾—å¤ªå‡†ç¡®çš„è¯ï¼Œå…¶å®ä¹Ÿä¸å¥½ï¼Œå› ä¸ºä½ å°±ä¸èƒ½å¿«é€Ÿçš„æ‰¾åˆ°å®ƒçš„åŒä¹‰è¯ã€‚æ¯”å¦‚è¯´æœ‰ä¸ªä¾‹å­è¯´çš„æ˜¯åœ°æ–¹çš„æ°´åˆ©çŒæº‰ç³»ç»Ÿçš„improvingï¼Œç»™äººä»¬å¸¦æ¥äº†è¶³å¤Ÿçš„é£Ÿç‰©ã€‚é‚£é¢˜ç›®è¯´çš„æ˜¯ advanced application systemç»™äººä»¬å¸¦æ¥äº†è¶³å¤Ÿçš„é£Ÿç‰©ã€‚å¦‚æœä½ æƒ³advancedå’Œimprovingè¿™ä¿©è¯å„¿ï¼Œadvancedæ˜¯å…ˆè¿›çš„ï¼Œimprovingæ˜¯è¿›æ­¥ã€‚å¦‚æœèƒŒå¾—éå¸¸çš„å‡†ç¡®ï¼ŒæŠŠå•è¯èƒŒå¾—éå¸¸çš„æ­»çš„è¯ï¼Œå¯èƒ½ä¼šè§‰å¾—ä»–ä¿©è¯´çš„æ„æ€ä¸æ˜¯ç‰¹åˆ«çš„ä¸€è‡´ï¼Œä½†æ˜¯å…¶å®ä»–ä¿©è¯´çš„å°±æ˜¯ä¸€æ¨¡ä¸€æ ·çš„æ„æ€ï¼Œéƒ½æ˜¯å…ˆè¿›ã€è¿›æ­¥ã€é«˜é˜¶ã€å¥½ï¼Œç”¨ä¸€å¥è¯æ€»ç»“å°±æ˜¯ä»–ä¿©è¯´çš„éƒ½æ˜¯å¥½ï¼Œæ°´çš„çŒæº‰ç³»ç»Ÿçš„å¥½ï¼Œåˆ°ä½¿è¿™é‡Œçš„äººä»¬å¯ä»¥ç”Ÿæ´»å¾—å¾ˆå¥½ã€‚æ‰€ä»¥å¯¹äºé˜…è¯»è¯æ±‡æ¥è®²çš„è¯ï¼Œæˆ‘ä»¬ä¸€å®šæ˜¯å»ºè®®å¤§æ¦‚æ„æ€èŒƒå›´å°±è¡Œäº†ï¼Œè¿™æ˜¯è¯æ±‡ã€‚\n\n## é•¿éš¾å¥ä¸å›è¯»\n\nå»æ‰¾å¥å­çš„ä¸»è°“å®¾ã€‚å› ä¸ºåœ¨é˜…è¯»é‡Œé¢ï¼Œä½ æ—¶é—´æ¯”è¾ƒé•¿çš„ä¸€ä¸ªéå¸¸é‡è¦çš„ç‚¹ï¼Œå…¶å®å°±æ˜¯åœ¨äºæˆ‘é¢˜ç›®çœ‹å®Œå›åˆ°åŸæ–‡ï¼ŒåŸæ–‡çœ‹å®Œä»¥åç¬¬ä¸€éæˆ‘æ²¡çœ‹å‡ºæ¥ï¼Œæˆ‘è¦å†çœ‹ä¸€éåˆ°åº•è¯´çš„æ˜¯ä»€ä¹ˆï¼Œè¦çœ‹å¥½å‡ éæ¥è¾¾åˆ°æˆ‘çŸ¥é“è¿™ä¸ªç­”æ¡ˆæ˜¯ä»€ä¹ˆçš„ç›®çš„ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå°±ä¼šèŠ±è´¹æ¯”è¾ƒé•¿çš„æ—¶é—´æ¥åšé¢˜ï¼Œæ‰€ä»¥ä¸€å®šè¦æœ‰é•¿éš¾å¥çš„ä¸å›è¯»è®­ç»ƒã€‚\n\nè¦åšåˆ°çœ‹ä¸€éå°±èƒ½å¤ŸæŒæ¡åˆ°è¿™å¥è¯é‡Œçš„ä¸»å¹²æ˜¯ä»€ä¹ˆï¼Œä¿®é¥°æˆåˆ†æ˜¯ä»€ä¹ˆï¼ŒæŒæ¡åˆ°è¿™å¥è¯çš„ä¸»è¦æ„æ€æƒ³è¡¨è¾¾çš„æ˜¯ä»€ä¹ˆï¼Œå’Œé¢˜ç›®é‡Œé¢çš„å…³ç³»æ˜¯ä»€ä¹ˆã€‚\n\n## ä¸¤ç§è”ç³»é˜…è¯»çš„æ–¹æ³•\n\n### ä¸­è‹±æ–‡å¯¹ç…§é˜…è¯»\n\nç¬¬ä¸€ç§ï¼Œä¸­è‹±æ–‡å¯¹ç…§é˜…è¯»ï¼Œä¸€æ®µè¯ï¼Œå…ˆæŠŠå®ƒç¿»è¯‘æˆè‹±æ–‡ï¼Œç¿»è¯‘å®Œä»¥åå’Œè‹±æ–‡åŸç‰ˆè¿›è¡Œå¯¹ç…§ï¼Œæœ‰å‡ºå…¥ã€‚å¯¹æˆ‘ä»¬ç°åœ¨çš„è¯­è¨€æ°´å¹³æ¥çœ‹çš„è¯ï¼ŒåŒ…æ‹¬å£è¯­ã€å†™ä½œæ˜¯æœ‰å¥½å¤„çš„ã€‚å¦‚æœæŒ‰ç…§ä¸­è‹±æ–‡å¯¹ç…§é˜…è¯»çš„è®­ç»ƒè¿›è¡Œè®­ç»ƒä¸‹å»çš„è¯ï¼Œä½ ä¼šå‘ç°ä½ çš„ç¿»è¯‘èƒ½åŠ›æœ‰å¤§å¹…åº¦çš„è¿›æ­¥å’Œæå‡ï¼Œå°±æ„å‘³ç€ä½ çš„å†™ä½œå’Œä½ çš„å£è¯­éƒ½ä¼šæœ‰è¿›æ­¥ï¼Œè¿™ä¸ªæ–¹æ³•ç¡®å®ä¼šæ¯”è¾ƒè´¹æ—¶é—´ã€‚ä¸å»ºè®®åšæŒçœ‹ä¸€æœ¬ä¹¦ï¼Œæ¯”å¦‚å“ˆåˆ©æ³¢ç‰¹å°ç‹å­ä»€ä¹ˆçš„ï¼Œé‚£äº›å°±æœ‰ç‚¹ä¸å¤ªèƒ½å¤Ÿç›´æ¥çš„è·Ÿæˆ‘ä»¬çš„å†™ä½œç›¸å¯¹åº”ã€‚å»ºè®®çœ‹ä»€ä¹ˆï¼Ÿå»ºè®®å»çœ‹å†™ä½œèŒƒæ–‡ï¼Œå“ªäº›ç¿»è¯‘è½¯ä»¶éå¸¸çš„å¥½ç”¨ï¼Œç›´æ¥æŠŠå®ƒç¿»è¯‘æˆä¸­æ–‡ï¼Œæˆ‘å‘çš„è‚¯å®šéƒ½æ˜¯è‹±æ–‡å†™ä½œèŒƒæ–‡ï¼Œç„¶åä½ å°±æŠŠå®ƒç¿»è¯‘æˆä¸­æ–‡ï¼Œç„¶åä¸­æ–‡çœ‹å®Œä»¥åä¸€å¥ä¸€å¥ç¿»è¯‘ï¼Œç„¶åå¯¹ç…§ä¸€ä¸‹å†™ä½œèŒƒæ–‡ï¼Œå“ªäº›è¡¨è¾¾æ–¹å¼æˆ‘ä»¬æ²¡æœ‰ï¼Œæˆ‘ä»¬æŠŠå®ƒç§¯ç´¯å‡ºæ¥ï¼Œè¿™æ ·çš„è¯å°±ä¼šæ›´åŠ çš„ç›´æ¥çš„é’ˆå¯¹äºæˆ‘ä»¬çš„é›…æ€å­¦ä¹ ã€‚\n\n### ç›´æ¥é˜…è¯»\n\nç¬¬äºŒç§ï¼Œæ˜¯ç›´æ¥é˜…è¯»ã€‚ç›´æ¥é˜…è¯»æ˜¯ä»€ä¹ˆï¼Ÿè·Ÿæˆ‘ä»¬å¹³æ—¶é˜…è¯»ä¸­æ–‡ä¹¦ç±ä¸€æ ·ï¼Œæˆ‘ä»¬ç›´æ¥é˜…è¯»è‹±æ–‡æ–‡ç« ï¼Œç›´æ¥é˜…è¯»è‹±æ–‡æ–‡ç« å°±æ˜¯å¯ä»¥é˜…è¯»ã€‚å¯ä»¥æ‹¿å‰‘4åŠä»¥åçš„çš„é‚£äº›æ–‡ç« ç›´æ¥æ¥é˜…è¯»ï¼Œä»¥ç†è§£æ–‡ç« å¤§æ¦‚å†…å®¹ä¸ºç›®çš„ã€‚ç›´æ¥é˜…è¯»ä¸€å®šè¦æ³¨æ„å»è¯»åšè¿‡é¢˜ç›®çš„æ–‡ç« ã€‚å¦‚æœè¿™ç¯‡æ–‡ç« é¢˜ç›®è¿˜æ²¡æœ‰åšï¼Œå°±ä¸è¦å»è¯»å®ƒã€‚å› ä¸ºä¸€å…±æˆ‘ä»¬å‰‘æ¡¥çœŸé¢˜å°±è¿™ä¹ˆå¤šï¼Œå¯¹å§ï¼Ÿæ¯ä¸€é¢˜æŒ‰ç…§è€ƒè¯•çš„æµç¨‹å»ç»ƒæ‰æ˜¯æœ€å¥½çš„ã€‚\n\næˆ–è€…è¯»æœºç»ã€‚æœºç»æ˜¯ä»€ä¹ˆï¼Ÿå°±æ˜¯ä»¥å¾€çš„è€ƒè¯•çš„å¯èƒ½å­˜åœ¨çš„æ–‡ç« ï¼Œå°±æ˜¯ä»¥è¯»æ–‡ç« ä¸ºç›®çš„å»çœ‹ã€‚\n\nå¦å¤–ä¸€ä¸ªåœ¨è¯»çš„æ—¶å€™è¦æ³¨æ„çš„ä¸€ä¸ªç‚¹å°±æ˜¯ä¸€å®šä¸è¦è¾¹æŸ¥è¾¹è¯»ã€‚æ‰€æœ‰çš„è‹±è¯­å­¦ä¹ ï¼ŒåŒ…æ‹¬å£è¯­ï¼ŒåŒ…æ‹¬å†™ä½œï¼ŒåŒ…æ‹¬å¬åŠ›ï¼ŒåŒ…æ‹¬é˜…è¯»ï¼Œä¸è¦æŠŠæ‰€æœ‰çš„è¿™äº›å¬è¯´è¯»å†™æœ€ç»ˆéƒ½ç»ƒæˆè€ƒè¯æ±‡ã€‚ä½ å¯ä»¥ä»ä¹¦ä¸­æ¥åˆ¤æ–­é™Œç”Ÿå•è¯çš„æ„æ€ï¼Œæ¯”å¦‚è¯´å†™ä½œçš„æ—¶å€™ä½ æƒ³è¦å†™è¿™ä¸ªè¯ï¼Œä½†æ˜¯ä½ ä¸å¤ªä¼šè¡¨è¾¾ï¼Œä½ å¯ä»¥å…ˆå°è¯•ç”¨å…¶ä»–çš„è¡¨è¾¾æ–¹å¼æ¥æŠŠå®ƒæ›¿æ¢å‡ºæ¥ï¼Œç„¶åæœ€åè¡¥å……è¯æ±‡ï¼Œæœ€åæŸ¥ä¸€ä¸‹è¿™ä¸ªå•è¯å’Œå®ƒçš„æ„æ€å’Œä½ æƒ³è±¡çš„ä¸€ä¸ä¸€è‡´ã€‚æœ€åæŸ¥ä¸€ä¸‹è¿™ä¸ªè¡¨è¾¾æ–¹å¼â€”â€”ä½ æƒ³è¦ç”¨çš„ï¼Œä½†æ˜¯ç¬¬ä¸€æ—¶é—´æ²¡æœ‰è¡¨è¾¾å‡ºæ¥çš„ï¼Œè¿™å°±æ˜¯è¡¥å……è¯æ±‡ã€‚\n\n1. è¯»åšè¿‡é¢˜ç›®çš„æ–‡ç« \n2. è¯»æœºç»\n3. ä¸€å®šä¸è¦è¾¹æŸ¥è¾¹è¯»\n4. æœ€åè¡¥å……è¯æ±‡\n\n# è€ƒè¯•æŠ€å·§\n\né›…æ€é˜…è¯»å°±ä¸¤ä¸ªæ–¹é¢ï¼šä¸€æ˜¯å®šä½é¢˜çœ¼ã€åŒä¹‰æ›¿æ¢ã€‚äºŒæ˜¯é˜…è¯»ç†è§£ã€å½’çº³æ€»ç»“ã€‚\n\n1. å®šä½ä¸”ç†è§£ç»†èŠ‚ä¿¡æ¯çš„èƒ½åŠ›â€”â€”åŒä¹‰æ›¿æ¢ã€‚\n2. å½’çº³æ–‡ç« æˆ–è€…æ®µè½ä¸»è¦ä¿¡æ¯çš„èƒ½åŠ›â€”â€”é˜…è¯»èƒ½åŠ›ã€‚\n\n## å®šä½é¢˜çœ¼ã€åŒä¹‰æ›¿æ¢\n\nå¦‚æœæœ‰æ˜æ˜¾é¢˜çœ¼ï¼Œåšé¢˜çš„æ—¶å€™ä¸€å®šæ˜¯å…ˆçœ‹é¢˜ï¼Œå†çœ‹æ–‡ç« ã€‚\n\n1. é¢˜ç›®é‡Œé¢é€šå¸¸æœ‰é¢˜çœ¼ï¼Œè¦åœ¨æ–‡ç« é‡Œé¢æ‰¾åˆ°é¢˜çœ¼ï¼Œå°±æ˜¯æ‰€è¯´çš„ç­”æ¡ˆå¥ï¼Œå¯¹æ¯”ä¸€ä¸‹è¿™ä¸¤ä¸ªè¯´çš„æ˜¯ä»€ä¹ˆï¼Œç„¶åé€‰ç­”æ¡ˆã€‚\n2. å¯¹äºé‚£äº›ç»“æ„æ€§çš„é¢˜ç›®ï¼Œéœ€è¦è€ƒå¯Ÿä½ çš„é˜…è¯»èƒ½åŠ›ï¼Œç»“æ„æ€§çš„é¢˜ç›®å¹¶ä¸èƒ½åœ¨æ–‡ç« ä¸­æ‰¾åˆ°éå¸¸æ˜æ˜¾çš„é¢˜çœ¼ï¼Œå¯èƒ½è¦çœ‹ä¸€æ®µè¯æˆ–è€…æ˜¯æ•´ç¯‡æ–‡ç« æ¥åšè¿™é“é¢˜ï¼Œæ¯”å¦‚è¯´æœ‰çš„é¢˜ç›®æœ€åä¸€ç¯‡ï¼Œæœ€åä¸€é¢˜ï¼Œä»–ä¼šé—®ä½ è¿™ç¯‡æ–‡ç« ä½œè€…çš„æ„å›¾æ˜¯ä»€ä¹ˆï¼Ÿè¿™ç¯‡æ–‡ç« çš„å¼€å¤´æ˜¯ä»€ä¹ˆï¼Ÿè¿™ç¯‡æ–‡ç« çš„ä¸»æ—¨ä¸­å¿ƒæ€æƒ³æ˜¯ä»€ä¹ˆï¼Ÿéœ€è¦å½’çº³æ–‡ç« æˆ–æ®µè½ä¿¡æ¯çš„èƒ½åŠ›ï¼Œæ‰€ä»¥ä¸¤ä¸ªä¸åŒçš„èƒ½åŠ›å¯¹åº”çš„æ˜¯æˆ‘ä»¬ä¸åŒçš„é¢˜ç›®ã€‚\n\né˜…è¯»ä¹‹å‰è¡¥å……å®šä½â€”â€”é€‰æ‹©ä»€ä¹ˆæ ·çš„è¯ä½œä¸ºå®šä½è¯ã€‚æœ‰ä¸€äº›æˆ‘ä»¬å¸¸è§çš„æˆ–å¸¸é€‰çš„è¯ï¼Œç¬¬ä¸€ä¸ªå«ç‰¹æ®Šè¯ï¼šä¸¤ç§æƒ…å†µï¼Œä¸€ä¸ªæ˜¯é¢˜ç›®é‡Œé¢æœ‰ç‰¹æ®Šè¯ï¼Œä¸€ä¸ªæ˜¯é¢˜ç›®é‡Œé¢æ²¡æœ‰ç‰¹æ®Šè¯ã€‚\n\nå¦‚æœé¢˜ç›®é‡Œé¢æœ‰ç‰¹æ®Šè¯æœ€å¥½ï¼Œæ¯”å¦‚è¯´ä¸€äº›å¤§å†™åè¯ï¼Œäººåæˆ–è€…æ˜¯åœ°åï¼Œä¸€äº›æ•°å­—ç­‰ç­‰ï¼Œå¤§å†™çš„é‡è¦åè¯ã€‚è¿™äº›æ¯”è¾ƒå¥½æ‰¾ï¼Œå¹¶ä¸”åœ¨æ–‡ç« ä¸­ä¸ä¼šè¢«æ›¿æ¢ã€‚ä½†æ˜¯æ•°å­—è¦æ³¨æ„ï¼Œä»–å¯èƒ½ä¼šç»™ä½ æŒ–å‘ï¼Œä»–åœ¨é¢˜ç›®é‡Œè·Ÿä½ è¯´1890å¹´ï¼Œåœ¨æ–‡ç« é‡Œä»–å¯èƒ½ä¼šè·Ÿä½ è¯´19ä¸–çºªæœ«ã€‚æ‰€ä»¥æ•°å­—è¦è­¦æƒ•å®ƒçš„æ›¿æ¢ã€‚å¤§å†™æ•°å­—æˆ–è€…æ˜¯ä¸€äº›æ–œä½“æˆ–è€…æ˜¯å¸¦ç¬¦å·ç­‰ç­‰çš„è¿™äº›è¯ï¼Œè¿™äº›è¯å„¿ç›¸å¯¹æ¥è¯´ï¼Œå›å½’æ–‡ç« å½“ä¸­éƒ½æ¯”è¾ƒå¥½æ‰¾ï¼Œæ‰€ä»¥å¦‚æœé¢˜ç›®é‡Œæœ‰è¿™äº›ç‰¹æ®Šè¯ï¼Œå°±ç›´æ¥ä»¥å®ƒä¸ºå®šä½è¯ä¼šæ–‡ç« æ‰¾å°±å¯ä»¥äº†ã€‚\n\nå¦‚æœé¢˜ç›®é‡Œæ²¡æœ‰ç‰¹æ®Šè¯ï¼Œå…¨éƒ½æ˜¯ä¸€äº›å°å†™çš„ï¼Œå¹³å¸¸çš„è¯æ±‡ï¼Œè¦ç”¨å¤šç‚¹å®šä½æ³•ï¼šè¦é€‰æ‹©more than oneå®šä½è¯ï¼Œä»¥é¿å…æ¼æ‰ä¿¡æ¯ï¼Œæˆ–è€…æ‰«è¯»çš„æ—¶å€™å¿½ç•¥äº†ã€‚æ‰€ä»¥å¤šç‚¹å®šä½æ˜¯åœ¨å¥å­çš„ä¸åŒæˆåˆ†é‡Œé¢é€‰åè¯æˆ–è€…æ˜¯åè¯è¯ç»„ã€‚ä¸»è¯­é€‰ä¸€ä¸ªï¼Œå®¾è¯­é€‰ä¸€ä¸ªï¼Œå®šè¯­é€‰ä¸€ä¸ªï¼ŒçŠ¶è¯­é€‰ä¸€ä¸ªï¼Œä¸€èˆ¬é€‰2~3ä¸ªï¼Œè¿™æ ·çš„è¯æŠ“ä½å¤§æ¦‚çš„ä¸»ã€è°“ã€å®¾ã€å®šã€çŠ¶ç­‰ç­‰çš„è¿™äº›ï¼Œå†å»å¯¹åº”çš„æ‰¾æ„æ€ç›¸ç¬¦åˆçš„å¤§è‡´èŒƒå›´ã€‚\n\n## åŒä¹‰æ›¿æ¢\n\nåŒä¹‰æ›¿æ¢å°±æ˜¯å¡«ç©ºå¥å­å®Œæˆæˆ–ç®€ç­”æ‰¾å®šä½ï¼Œç„¶åç†è§£ç»†èŠ‚ä¿¡æ¯ï¼Œé˜…è¯»èƒ½åŠ›åŒ¹é…ï¼Œæ‰¾å°æ ‡é¢˜ç­‰ç­‰è¿™äº›æ®µè½ä¸»è¦ä¿¡æ¯ã€‚ä½†æ˜¯è¿™ä¸ªé€‚åˆå…ˆçœ‹æ–‡ç« å†åšé¢˜ã€‚\n\næ‰€ä»¥æˆ‘ä»¬çš„è€ƒè¯•æŠ€å·§å…ˆçœ‹æ–‡ç« å†çœ‹é¢˜ï¼Œè¿˜æ˜¯å…ˆçœ‹é¢˜å†çœ‹æ–‡ç« ï¼Œéƒ½æœ‰è‡ªå·±çš„ä¼˜ç¼ºç‚¹ã€‚å¦‚æœæˆ‘ä»¬å…ˆçœ‹æ–‡ç« çš„è¯ï¼Œæˆ‘ä»¬åšé¢˜çš„å‡†ç¡®ç‡å°±ä¼šæ¯”è¾ƒé«˜ï¼Œä½†æ˜¯éœ€è¦çœ‹çš„å†…å®¹æ¯”è¾ƒå¤šï¼Œå› ä¸ºé˜…è¯»é‡å¤§ï¼›å¦‚æœå…ˆçœ‹é¢˜ï¼Œå†çœ‹æ–‡ç« çš„è¯ï¼Œé˜…è¯»é‡æ¯”è¾ƒå°ï¼Œä½†æ˜¯æœ‰å¯èƒ½ç”±äºå‰åå¿½ç•¥äº†ä¸€ä¸ªä¿¡æ¯ï¼Œå¯¼è‡´åšä¸å¯¹ã€‚æ‰€ä»¥æˆ‘ä»¬è¦æ ¹æ®é¢˜ç›®çš„ç‰¹æ€§é€‰æ‹©ä¸åŒçš„æŠ€å·§ï¼Œæ¯”å¦‚è¯´ç»†èŠ‚ä¿¡æ¯é¢˜ï¼Œä¸€å®šæ˜¯å…ˆçœ‹é¢˜ï¼Œå†çœ‹æ–‡ç« ï¼Œå¦‚æœæ˜¯ç« ç¯‡ç»“æ„ä½“ï¼Œå¯èƒ½å…ˆçœ‹æ–‡ç« å†çœ‹é¢˜æ¯”è¾ƒå¥½ï¼Œæ‰€ä»¥ä¸åŒçš„é¢˜ç›®æˆ‘ä»¬é€‰æ‹©ä¸åŒçš„åšé¢˜æŠ€å·§ã€‚\n\n# é˜…è¯»æ–¹æ³•\n\næ‰«è¯»ã€ç•¥è¯»ã€ç²¾è¯»ã€‚\n\næ‰«è¯»åªæ˜¯ä¸ºäº†æ‰¾åˆ°å®šä½è¯è€Œå·²ï¼Œä¸éœ€è¦äº†è§£å’Œè®¤è¯†é‡Œé¢çš„æŸä¸€ä¸ªè¯æ±‡æˆ–è€…æ˜¯æŸä¸€ä¸ªçŸ­è¯­ï¼Œæˆ–è€…æ˜¯å®ƒçš„æ–‡ç« æ„æ€ç­‰ç­‰ï¼Œæ‰¾åˆ°é‚£ä¸ªç‚¹å°±è¡Œäº†ã€‚æ‰«è¯»å®Œäº†ä»¥åï¼Œæˆ‘ä»¬å°±æ‰¾åˆ°äº†å®šä½è¯ï¼Œæ¥ä¸‹æ¥å°±è¦å»ç•¥è¯»ã€‚\n\nç•¥è¯»ï¼šå»çœ‹ä¸€ä¸‹å®šä½è¯è·Ÿæˆ‘çš„é¢˜ç›®è¯´çš„è¿™ä¸ªä¸œè¥¿å¤§æ¦‚ä¸€ä¸ä¸€è‡´ï¼Œæ–¹å‘ä¸€ä¸ä¸€æ ·ï¼Œæ˜¯ä¸æ˜¯æˆ‘çš„é¢˜ç›®èŒƒå›´ï¼Œç„¶åå†ç²¾è¯»ã€‚\n\nç²¾è¯»ï¼šä¸€å­—ä¸€å¥çš„å»è®¤çœŸè¯»è¿™ç¯‡æ–‡ç« é‡Œé¢çš„è¯æ±‡æ˜¯ä»€ä¹ˆï¼Œå¥æ³•æ˜¯ä»€ä¹ˆï¼Œç„¶åæ ¹æ®é¢˜ç›®æ‰¾ç­”æ¡ˆã€‚\n\n## æ‰«è¯»\n\næ‰«è¯»é€‚åˆé¢˜ç›®ä¸­æœ‰æ˜æ˜¾å®šä½è¯ï¼Œå›åˆ°åŸæ–‡ä¸­æ‰¾åˆ°å®šä½è¯å°±å¯ä»¥è§£é¢˜äº†ã€‚é‚£ä¹ˆåœ¨è¿™ç§æƒ…å†µä¸‹æ¥ä¸€å®šè¦æ³¨æ„ï¼Œæ‰«è¯»ä¸æ˜¯é€å­—é€å¥é˜…è¯»ï¼Œç”¨wé˜…è¯»æ³•ã€‚\n\nwé˜…è¯»æ³•æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿä¸æ˜¯æ¨ªç€çœ‹ï¼Œè€Œæ˜¯æ¨ªç«–ç»“åˆâ€”â€”æ–œç€ä¸‹æ–œç€ä¸Šï¼Œæ¯æ¬¡wé˜…è¯»5è¡Œã€‚è§†çº¿èŒƒå›´å†…å¯ä»¥åœ¨åŒä¸€æ—¶é—´æœ€å¤§é™åº¦çš„çœ‹åˆ°æœ€å¤šçš„å†…å®¹ã€‚\n\n## ç•¥è¯»\n\nç•¥è¯»é€‚åˆé¢˜ç›®æœ¬èº«æ˜¯æ¦‚æ‹¬æ€»ç»“æ€§çš„è¯è¯­ï¼Œåªéœ€è¦çœ‹å¤§è‡´æ„æ€å°±å¯ä»¥äº†ï¼Œåªéœ€è¦çœ‹æ–‡ç« ä¸»æ—¨å°±è¡Œäº†ã€‚æœ‰é€‰æ‹©æ€§çš„é˜…è¯»ï¼Œè·³è¿‡ç»†èŠ‚ï¼ŒæŠ“å–æ–‡ç« å¤§æ¦‚ã€‚\n\n## ç²¾è¯»\n\nç²¾è¯»è¦æ±‚å°±ä¼šæ¯”è¾ƒé«˜ï¼Œä¸»è¦å°±è€ƒç»ƒä¹ äº†ã€‚\n\nç¬¬ä¸€å°±æ˜¯æ‰¾é•¿éš¾å¥ã€‚å°±æ˜¯ä¸€å¥—é¢˜ä¸­ï¼Œé€‰ä¸‰ç¯‡æ–‡ç« é‡Œé”™é¢˜æœ€å¤šçš„é‚£ç¯‡è¿›è¡Œç²¾è¯»ã€‚ç²¾è¯»æ˜¯è¦æŠŠæ–‡ç« é‡Œé¢æ‰€æœ‰çš„é•¿éš¾å¥éƒ½æ‰¾å‡ºæ¥ï¼ŒæŠŠé‡Œé¢çš„ç”Ÿè¯æ•´ç†å‡ºæ¥ï¼Œè¦æ±‚å¯¹æ–‡ç« èƒŒæ™¯æœ‰æ‰€äº†è§£ï¼ŒæŠŠæ–‡ç« çš„ç»“æ„ä½“ç³»å’Œé€»è¾‘å…³ç³»éƒ½æ‰¾å‡ºæ¥ã€‚é‚£ä¹ˆå…¶ä¸­é•¿éš¾å¥æ‰¾å‡ºæ¥ä»¥åï¼ŒæŒ‰ç…§æˆ‘ä»¬é•¿éš¾å¥è¿›è¡Œåˆ†æï¼Œçœ‹è¿™ä¸ªå¥å­çš„ä¸»è¯­æ˜¯è°ï¼Œè°“è¯­æ˜¯è°ã€‚å…ˆçœ‹å¥å­ä¸»å¥æ˜¯è°ï¼Œç„¶ååˆ†å¥ä¿®é¥°æˆåˆ†æ˜¯ä»€ä¹ˆç­‰ç­‰ã€‚\n\nç¬¬äºŒï¼Œæ‰¾é‡Œé¢çš„ä¸è®¤è¯†çš„å•è¯ï¼ŒåŒ…æ‹¬ä¸€äº›é‡è¦åè¯ï¼ŒåŒ…æ‹¬ä¸€äº›æ–‡ç« ï¼Œç‰¹æ®Šæƒ…å†µï¼Œæ¯”å¦‚æ–‡ç« è®²çš„Marine mammalsï¼Œæµ·æ´‹é‡Œé¢çš„å“ºä¹³åŠ¨ç‰©ï¼Œå®ƒé‡Œé¢è‚¯å®šä¼šè®²åˆ°å„ç§å„æ ·çš„åè¯ï¼Œå„ç§å„æ ·çš„å“ºä¹³åŠ¨ç‰©çš„åå­—ç­‰ç­‰ï¼Œè¿™äº›ä¹Ÿå¾—æ•´ç†å‡ºæ¥ï¼Œå¾—äº†è§£ã€‚\n\nç¬¬ä¸‰ï¼Œäº†è§£æ–‡ç« çš„èƒŒæ™¯ï¼Œé™¤äº†è¿™ç¯‡æ–‡ç« è¯´çš„æµ·æ´‹çš„å“ºä¹³åŠ¨ç‰©ä»¥å¤–ï¼Œå®ƒè¿˜å¯èƒ½æœ‰å“ªäº›æ–¹é¢ã€‚è‡ªå·±é€šè¿‡æœç´¢å¼•æ“æŸ¥æ‰¾ã€‚\n\nç¬¬å››ä¸ªä¹Ÿæ˜¯æœ€é‡è¦çš„ï¼Œå³æ•´ç†å‡ºæ–‡ç« çš„ä½“ç³»ç»“æ„å’Œé€»è¾‘å…³ç³»ï¼Œè¿™äº›ä½“ç³»ç»“æ„å’Œé€»è¾‘å…³ç³»å¯ä»¥å¸®åŠ©ä½ ç†è§£ä¸ä¹‹ç›¸åŒç±»çš„æ–‡ç« çš„æ‰€æœ‰çš„ä½“ç³»ç»“æ„å’Œé€»è¾‘å…³ç³»ï¼Œè¿˜èƒ½å¸®åŠ©ä½ è¿›è¡Œå†™ä½œçš„é€»è¾‘å…³ç³»å’Œä½“ç³»ç»“æ„çš„level upã€‚ä½†å¹¶ä¸æ˜¯ç¿»è¯‘è¿™ç¯‡æ–‡ç« ï¼Œä¸æ˜¯æŠŠè¿™ç¯‡æ–‡ç« é€å­—é€å¥çš„ç¿»è¯‘å‡ºæ¥å»ç†è§£å®ƒæ˜¯ä»€ä¹ˆï¼Œè€Œæ˜¯ç”¨ä½ è‡ªå·±çš„è¯å»æ€»ç»“å®ƒã€‚æ¯”å¦‚è¯´è¿™ç¯‡æ–‡ç« è¯´çš„æ˜¯introduction to film soundï¼Œè¿™ç¯‡æ–‡ç« çš„é¢˜ç›®è®²çš„å°±æ˜¯ç”µå½±å£°éŸ³ï¼Œç„¶ååˆšå¼€å§‹å‘Šè¯‰ä½ film soundå¾ˆé‡è¦ï¼Œå®ƒå…¶ä¸­æœ‰ä¸‰ç§è¡¨è¾¾æ–¹å¼ï¼Œç¬¬ä¸€ç§æ˜¯äººå£°ï¼Œå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„å¯¹ç™½ï¼Œç¬¬äºŒç§æ˜¯éŸ³æ•ˆï¼Œç®¡ä¹å’Œå¼¦ä¹ï¼Œç¬¬ä¸‰ç§æ˜¯éŸ³ä¹ã€‚å³ï¼šå…ˆç»™ä½ å¯¹äºfilm soundä¸Šçš„ä¸€ä¸ªintroductionï¼Œç„¶åå†é€ä¸€å»è§£é‡Šï¼šå¯¹ç™½çš„definitionæ˜¯ä»€ä¹ˆï¼›ä¸¾ä¾‹ï¼šçœŸäººå’Œæ¼”å‘˜é‡åˆï¼›ä¸¾ä¾‹ï¼šå¯¹è¯çš„æ•°é‡å’Œä½¿ç”¨æ–¹å¼ã€‚ä½“ç³»ç»“æ„å…¶å®æ˜¯ï¼šçœ‹æ–‡ç« æ˜¯ä»è¯çœ‹åˆ°å¥å­ï¼Œä»å¥å­çœ‹åˆ°æ„ç¾¤ï¼Œä»æ„ç¾¤çœ‹åˆ°ç« ç¯‡ã€‚\n\n![image-20230404203323026](../../images/é›…æ€é˜…è¯»/image-20230404203323026.png)\n\n# æ—¥å¸¸å·¥ä½œ\n\nåŒä¹‰è¯ã€‚\n\né•¿éš¾å¥åˆ†æã€‚\n","categories":["è‹±è¯­"]},{"title":"Linux_è®¾ç½®ç³»ç»Ÿè¿è¡Œçº§åˆ«","url":"/Linux/Linux_è®¾ç½®ç³»ç»Ÿè¿è¡Œçº§åˆ«/","content":"# åˆ‡æ¢ç³»ç»Ÿè¿è¡Œçº§åˆ«\n* runlevelå‘½ä»¤å¯æŸ¥çœ‹ç³»ç»Ÿè¿è¡Œçº§åˆ«\n* å¯ä»¥ç”¨initå‘½ä»¤åŠ¨æ€åˆ‡æ¢0-6ä¸ƒä¸ªçº§åˆ«\n    1. å…³æœº\n    2. å•ç”¨æˆ·æ¨¡å¼\n    3. å¤šç”¨æˆ·æ— ç½‘ç»œæœåŠ¡\n    4. å®Œå…¨çš„å¤šç”¨æˆ·æ–‡æœ¬ç•Œé¢\n    5. æœªå®šä¹‰æˆ–è‡ªå®šä¹‰\n    6. å›¾å½¢åŒ–ç•Œé¢\n    7. é‡å¯\n\n```bash\nrunlevel\n# ç»“æœ:\n\t# å›¾å½¢åŒ–æ¨¡å¼æ—¶ -> N 5\n\t# å‘½ä»¤è¡Œæ¨¡å¼æ—¶ -> 5 3\ninit 3 #åˆ‡æ¢åˆ°å‘½ä»¤è¡Œæ¨¡å¼\n```\n\n# å¯åŠ¨çº§åˆ«Runlevel\nå‚è€ƒï¼šhttps://www.bbsmax.com/A/x9J2PYpEd6/\n\né¦–å…ˆæ¥äº†è§£ä¸‹å¯åŠ¨çº§åˆ«(Runlevel)ï¼š\n\næŒ‡Unixæˆ–ç±»Unixæ“ä½œç³»ç»Ÿä¸‹ä¸åŒçš„è¿è¡Œæ¨¡å¼ï¼Œè¿è¡Œçº§åˆ«é€šå¸¸åˆ†ä¸º7çº§ï¼š\n\n0. è¿è¡Œçº§åˆ« 0ï¼šç³»ç»ŸåœæœºçŠ¶æ€ï¼Œç³»ç»Ÿé»˜è®¤è¿è¡Œçº§åˆ«ä¸èƒ½è®¾ä¸º0ï¼Œå¦åˆ™ä¸èƒ½æ­£å¸¸å¯åŠ¨\n1. è¿è¡Œçº§åˆ« 1ï¼šå•ç”¨æˆ·å·¥ä½œçŠ¶æ€ï¼Œrootæƒé™ï¼Œç”¨äºç³»ç»Ÿç»´æŠ¤ï¼Œç¦æ­¢è¿œç¨‹ç™»é™†ï¼Œæ— ç½‘ç»œè¿æ¥ï¼Œä¸è¿è¡Œå®ˆæŠ¤è¿›ç¨‹ï¼Œä¸å…è®¸éè¶…çº§ç”¨æˆ·ç™»å½•ã€‚ï¼ˆå¦‚æœå¿˜è®°äº†rootå¯†ç ï¼Œå¯é€šè¿‡å¼€æœºçƒ­é”®è¿›å…¥å•ç”¨æˆ·æ¨¡å¼è¿›è¡Œé‡ç½®ï¼Œå‰ææ˜¯è¦æ¥è§¦åˆ°ä¸»æœºï¼‰\n2. è¿è¡Œçº§åˆ« 2ï¼šå¤šç”¨æˆ·çŠ¶æ€ï¼Œæ— ç½‘ç»œè¿æ¥ï¼Œä¸è¿è¡Œå®ˆæŠ¤è¿›ç¨‹\n3. è¿è¡Œçº§åˆ« 3ï¼šå®Œå…¨çš„å¤šç”¨æˆ·çŠ¶æ€(æœ‰NFS)ï¼Œç™»é™†åè¿›å…¥æ§åˆ¶å°å‘½ä»¤è¡Œæ¨¡å¼ï¼Œæ­£å¸¸ç™»å½•çŠ¶æ€\n4. è¿è¡Œçº§åˆ« 4ï¼šç³»ç»Ÿæœªä½¿ç”¨ï¼Œä¿ç•™ï¼Œç”¨æˆ·è‡ªå®šä¹‰\n5. è¿è¡Œçº§åˆ« 5ï¼šX11æ§åˆ¶å°ï¼Œç™»é™†åè¿›å…¥å›¾å½¢GUIæ¨¡å¼ï¼Œå°±æ˜¯å¸¸è§çš„å¸¦æœ‰å›¾å½¢ç•Œé¢çš„æ¨¡å¼\n6. è¿è¡Œçº§åˆ« 6ï¼šç³»ç»Ÿæ­£å¸¸å…³é—­å¹¶é‡å¯ï¼Œé»˜è®¤è¿è¡Œçº§åˆ«ä¸èƒ½è®¾ä¸º6ï¼Œå¦åˆ™ä¸èƒ½æ­£å¸¸å¯åŠ¨\n\n# è®¾ç½®å¼€æœºè¿›å…¥å‘½ä»¤è¡Œæ¨¡å¼\n\nåœ¨å…¨æ–°çš„Linux systemDä¸­å·²ç»ä½¿ç”¨targetä»£æ›¿Runlevelï¼Œå¦‚multi-user.targetç›¸å½“äºinit 3ï¼Œgraphical.targetç›¸å½“äºinit 5ï¼Œä½†æ˜¯SystemDä»ç„¶å…¼å®¹è¿è¡Œçº§åˆ«(Runlevel)ã€‚\n\nå½“å‰ç»å¤§å¤šæ•°å‘è¡Œç‰ˆå·²é‡‡ç”¨systemdä»£æ›¿UNIX System Vã€‚\n\nè¦è®¾ç½®å¼€æœºè¿›å…¥æ— å›¾å½¢åŒ–ç•Œé¢çš„å‘½ä»¤è¡Œæ¨¡å¼ï¼Œå°±æ˜¯å°†é»˜è®¤çš„å¼€æœºè¿›å…¥è¿è¡Œçº§åˆ« 5 æ›´æ”¹ä¸ºå¼€æœºè¿›å…¥è¿è¡Œçº§åˆ« 3ã€‚\n\næ­¥éª¤ï¼š\n\n1. `sudo vim /etc/default/grub`\n2. sudo update-grub\n3. `systemctl set-default multi-user.target`\n4. reboot\n\n# è®¾ç½®å¼€æœºè¿›å…¥å›¾å½¢ç•Œé¢\n\næ­¥éª¤ï¼š\n\n1. `sudo vim /etc/default/grub`\n2. sudo update-grub\n3. `systemctl set-default graphical.target`\n4. reboot\n","categories":["Linux"]},{"title":"åç¨‹_Cè¯­è¨€åç¨‹å®ç°","url":"/å¤šçº¿ç¨‹/åç¨‹_Cè¯­è¨€åç¨‹å®ç°/","content":"# é—®é¢˜å¼•å…¥ï¼šç”Ÿäº§å’Œæ¶ˆè´¹\n\nå¦‚æœæ­¤æ—¶æœ‰ä¸€æ®µä»£ç ç”Ÿæˆæ•°æ®ï¼Œå¦ä¸€æ®µä»£ç ä½¿ç”¨æ•°æ®ï¼Œå“ªä¸€æ®µä»£ç æ˜¯è°ƒç”¨è€…ï¼Œå“ªä¸€æ®µæ˜¯è¢«è°ƒç”¨è€…å‘¢ï¼Ÿ\n\næœ‰ä¸€æ®µéå¸¸ç®€æ´çš„`run-length decompression code`ï¼Œå’Œä¸€æ®µåŒæ ·ç®€æ´çš„è§£æå™¨ä»£ç ï¼š\n\n```c\n    /* Decompression code */\n    while (1)\n    {\n        c = getchar();\n        if (c == EOF)\n            break;\n        if (c == 0xFF)\n        {\n            len = getchar();\n            c = getchar();\n            while (len--)\n                emit(c);\n        }\n        else\n            emit(c);\n    }\n    emit(EOF);\n```\n\n```c\n\t/* Parser code */\n\twhile (1)\n    {\n        c = getchar();\n        \tbreak;\n        if (isalpha(c))\n        {\n            do\n            {\n                add_to_token(c);\n                c = getchar();\n            } while (isalpha(c));\n            got_token(WORD);\n        }\n        add_to_token(c);\n        got_token(PUNCT);\n    }\n```\n\nç¬¬ä¸€ä¸ªç‰‡æ®µæ¯è°ƒç”¨emitä¸€æ¬¡å°±ç”Ÿæˆä¸€ä¸ªå­—ç¬¦ï¼›å¦ä¸€ä¸ªç‰‡æ®µæ¯è°ƒç”¨getcharä¸€æ¬¡å°±è¦ä½¿ç”¨ä¸€æ¬¡å­—ç¬¦ã€‚å¦‚æœåªèƒ½è°ƒç”¨emitå’Œgetcharæ¥ç›¸äº’ä¼ é€’æ•°æ®ï¼Œå¯ä»¥å¾ˆç®€å•åœ°å°†ä¸¤ä¸ªç‰‡æ®µè¿æ¥åœ¨ä¸€èµ·æ¥è¾¾æˆç›®çš„ï¼Œå³è§£å‹å™¨çš„è¾“å‡ºç›´æ¥ä¼ é€’åˆ°è§£æå™¨ã€‚\n\n# è¿æ¥ä¸¤ä¸ªç‰‡æ®µçš„æ–¹æ¡ˆ\n\nåœ¨ç°ä»£çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸¤ä¸ªè¿›ç¨‹æˆ–è€…çº¿ç¨‹ä¹‹é—´çš„ç®¡é“å®ç°è¿æ¥ï¼Œè§£å‹å™¨ä¸­çš„emitå†™å…¥ä¸€ä¸ªç®¡é“ï¼Œè§£æå™¨ä¸­çš„getcharä»è¿™ä¸ªç®¡é“çš„å¦ä¸€ç«¯è¯»å–ã€‚ç®€å•ã€å¥å£®ï¼Œä½†æ˜¯ç”¨çº¿ç¨‹æ¥è§£å†³æœ‰ç‚¹é‡é‡çº§ã€ä¸å¤Ÿä¾¿æºã€‚ é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸éœ€è¦ä¸ºå¦‚æ­¤ç®€å•çš„ä»»åŠ¡å°†ç¨‹åºåˆ’åˆ†ä¸ºå¤šä¸ªçº¿ç¨‹ã€‚\n\nå¸¸è§„çš„ç­”æ¡ˆ(conventional answer)å°±æ˜¯é‡å†™(rewrite)é€šä¿¡ä¿¡é“çš„æœ«ç«¯ä¸­çš„ä¸€ä¸ªï¼Œå¦‚æ­¤å®ƒå°±æˆäº†ä¸€ä¸ªå¯è¢«è°ƒç”¨çš„å‡½æ•°ã€‚ä¸‹é¢æ˜¯å¯¹æ¯ä¸ªç¤ºä¾‹ç‰‡æ®µæ„å‘³ç€ä»€ä¹ˆçš„ä¾‹å­ã€‚\n\n```c\nint decompressor()\n{\n    static int repchar;\n    static int replen;\n    if (replen > 0)\n    {\n        replen--;\n        return repchar;\n    }\n    c = getchar();\n    if (c == EOF)\n        return EOF;\n    if (c == 0xFF)\n    {\n        replen = getchar();\n        repchar = getchar();\n        replen--;\n        return repchar;\n    }\n    else\n        return c;\n}\n```\n\n```c\nvoid parser(int c)\n{\n    static enum { START, IN_WORD } state;\n    switch (state)\n    {\n        case IN_WORD:\n            if (isalpha(c))\n            {\n                add_to_token(c);\n                return;\n            }\n            got_token(WORD);\n            state = START;\n            /* fall through */\n        case START:\n            add_to_token(c);\n            if (isalpha(c))\n                state = IN_WORD;\n            else\n                got_token(PUNCT);\n            break;\n    }\n}\n```\n\nå½“ç„¶ï¼Œä¸å¿…é‡å†™ä¸¤ä¸ªã€‚å¦‚æœé‡å†™è§£å‹ç¼©å™¨ï¼Œä»¥ä¾¿æ¯æ¬¡è¢«è°ƒç”¨æ—¶è¿”å›ä¸€ä¸ªå­—ç¬¦ï¼Œåˆ™åŸå§‹è§£æå™¨ä»£ç å¯ä»¥ç”¨decompressoræ›¿æ¢getcharã€‚ç›¸åï¼Œå¦‚æœé‡å†™è§£æå™¨ï¼Œä»¥ä¾¿ä¸ºæ¯ä¸ªè¾“å…¥çš„å­—ç¬¦éƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œåˆ™åŸå§‹è§£å‹ç¼©ä»£ç å¯ä»¥è°ƒç”¨parserè€Œä¸æ˜¯emitã€‚å¦‚æœä½ æ˜¯ä¸€ä¸ªè´ªåƒæƒ©ç½šçš„äººï¼Œä½ åªä¼šæƒ³å°†è¿™ä¸¤ä¸ªå‡½æ•°é‡å†™ä¸ºè¢«è°ƒç”¨è€…ã€‚\n\nè¿™å°±æ˜¯é‡ç‚¹ã€‚ä¸åŸå§‹å‡½æ•°ç›¸æ¯”ï¼Œè¿™ä¸¤ä¸ªé‡å†™çš„åŠŸèƒ½éƒ½éå¸¸ä¸‘é™‹ã€‚å½“ä½œä¸ºè°ƒç”¨è€…è€Œä¸æ˜¯è¢«è°ƒç”¨è€…ç¼–å†™æ—¶ï¼Œè¿™é‡Œå‘ç”Ÿçš„ä¸¤ä¸ªè¿‡ç¨‹(process)éƒ½æ›´å®¹æ˜“é˜…è¯»ã€‚è¯•ç€å»æ¨å¯¼è§£æå™¨èƒ½è¯†åˆ«çš„è¯­æ³•ï¼Œæˆ–è€…è§£å‹å™¨èƒ½ç†è§£çš„å‹ç¼©æ•°æ®æ ¼å¼ï¼Œä»…ä»…é€šè¿‡é˜…è¯»ä»£ç ï¼Œä½ ä¼šå‘ç°åŸå§‹çš„ä»£ç å¾ˆæ¸…æ™°ï¼Œé‡å†™çš„ä»£ç éƒ½ä¸å¤ªæ¸…æ¥šã€‚ å¦‚æœæˆ‘ä»¬ä¸å¿…å°†ä»»ä½•ä¸€æ®µä»£ç ä»é‡Œåˆ°å¤–é‡å†™ï¼Œé‚£å°±æ›´å¥½ã€‚\n\n## Knuth's coroutines\n\nåœ¨ The Art of Computer Programming ä¸­ï¼ŒDonald Knuth æå‡ºäº†è§£å†³æ­¤ç±»é—®é¢˜çš„æ–¹æ³•ã€‚ä»–çš„å›ç­”æ˜¯å®Œå…¨æŠ›å¼ƒæ ˆçš„æ¦‚å¿µã€‚ä¸è¦å†å°†ä¸€ä¸ªè¿›ç¨‹è§†ä¸ºè°ƒç”¨è€…ï¼Œå°†å¦ä¸€ä¸ªè¿›ç¨‹è§†ä¸ºè¢«è°ƒç”¨è€…ï¼Œè€Œæ˜¯å¼€å§‹å°†å®ƒä»¬è§†ä¸ºå¹³ç­‰åˆä½œã€‚\n\nå®é™…æ“ä½œä¸Šï¼šç”¨ç•¥æœ‰ä¸åŒçš„åŸè¯­(primitive: In programming, a fundamental element in a language that can be used to create larger procedures that do the work a programmer wants to do.)æ›¿æ¢ä¼ ç»Ÿçš„â€œè°ƒç”¨(call)â€åŸè¯­ã€‚ æ–°çš„â€œè°ƒç”¨â€ä¼šå°†è¿”å›å€¼ä¿å­˜åœ¨å †æ ˆä»¥å¤–çš„å…¶ä»–ä½ç½®ï¼Œç„¶åè·³è½¬åˆ°å¦ä¸€ä¸ªä¿å­˜çš„è¿”å›å€¼ä¸­æŒ‡å®šçš„ä½ç½®ã€‚ å› æ­¤ï¼Œæ¯æ¬¡è§£å‹ç¼©å™¨å‘å‡ºå¦ä¸€ä¸ªå­—ç¬¦æ—¶ï¼Œå®ƒéƒ½ä¼šä¿å­˜å…¶ç¨‹åºè®¡æ•°å™¨å¹¶è·³è½¬åˆ°è§£æå™¨ä¸­æœ€åå·²çŸ¥çš„ä½ç½® - æ¯æ¬¡è§£æå™¨éœ€è¦å¦ä¸€ä¸ªå­—ç¬¦æ—¶ï¼Œå®ƒéƒ½ä¼šä¿å­˜è‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨å¹¶è·³è½¬åˆ°è§£å‹ç¼©å™¨ä¿å­˜çš„ä½ç½®ã€‚ æ§åˆ¶åœ¨ä¸¤ä¸ªä¾‹ç¨‹(routines)ä¹‹é—´æ¥å›ç©¿æ¢­(back and forth)ã€‚\n\nä»ç†è®ºä¸Šè®²ï¼Œè¿™æ˜¯éå¸¸å¥½çš„ï¼Œä½†æ˜¯å®é™…ä¸Šåªèƒ½ä»¥æ±‡ç¼–è¯­è¨€è¿›è¡Œæ“ä½œï¼Œå› ä¸ºæ²¡æœ‰å¸¸ç”¨çš„é«˜çº§è¯­è¨€æ”¯æŒåç¨‹è°ƒç”¨çš„åŸè¯­(coroutine call primitive)ã€‚åƒCè¿™æ ·çš„è¯­è¨€å®Œå…¨å–å†³äºå…¶åŸºäºå †æ ˆçš„ç»“æ„ï¼Œå› æ­¤ï¼Œæ¯å½“æ§åˆ¶ä»ä»»ä½•å‡½æ•°ä¼ é€’åˆ°ä»»ä½•å…¶ä»–å‡½æ•°æ—¶ï¼Œéƒ½å¿…é¡»æœ‰ä¸€ä¸ªæ˜¯è°ƒç”¨è€…ï¼Œå¦ä¸€ä¸ªå¿…é¡»æ˜¯è¢«è°ƒç”¨è€…ã€‚å› æ­¤ï¼Œå¦‚æœæƒ³ç¼–å†™ä¾¿æºå¼ä»£ç ï¼Œåˆ™æ­¤æŠ€æœ¯è‡³å°‘ä¸Unix Pipeè§£å†³æ–¹æ¡ˆä¸€æ ·ä¸åˆ‡å®é™…ã€‚\n\n## Stack-based coroutines\n\næ‰€ä»¥æˆ‘ä»¬çœŸæ­£æƒ³è¦çš„æ˜¯åœ¨Cä¸­æ¨¡ä»¿ Knuth çš„åç¨‹è°ƒç”¨åŸè¯­çš„èƒ½åŠ›ã€‚æˆ‘ä»¬å¿…é¡»æ¥å—ç°å®ï¼Œåœ¨Cçº§åˆ«ï¼Œä¸€ä¸ªå‡½æ•°å°†æ˜¯è°ƒç”¨è€…ï¼Œå¦ä¸€ä¸ªå°†æ˜¯è¢«è°ƒç”¨è€…ã€‚åœ¨è°ƒç”¨è€…ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰é—®é¢˜ï¼›æˆ‘ä»¬å¯¹åŸå§‹ç®—æ³•è¿›è¡Œcodeï¼Œå‡ ä¹å®Œå…¨æŒ‰ç…§ç¼–å†™çš„æ–¹å¼è¿›è¡Œï¼Œå¹¶ä¸”æ¯å½“å®ƒæœ‰ï¼ˆæˆ–éœ€è¦ï¼‰ä¸€ä¸ªå­—ç¬¦æ—¶ï¼Œå®ƒå°±ä¼šè°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°ã€‚\n\nè¢«è°ƒç”¨è€…æœ‰å…¨éƒ¨çš„éš¾é¢˜éœ€è¦è§£å†³ã€‚å¯¹äºè¢«è°ƒç”¨è€…ï¼Œæˆ‘ä»¬æƒ³è¦ä¸€ä¸ªå…·æœ‰â€œè¿”å›å¹¶ç»§ç»­â€æ“ä½œçš„å‡½æ•°ï¼šä»å‡½æ•°è¿”å›ï¼Œä¸‹æ¬¡è°ƒç”¨å®ƒæ—¶ï¼Œä»è¿”å›è¯­å¥ä¹‹åæ¢å¤æ§åˆ¶ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼š\n\n```c\nint function()\n{\n    int i;\n    for (int i = 0; i < 10; i++)\n    {\n        return i; /* won't work, but wouldn't it be nice */\n    }\n}\n```\n\næˆ‘ä»¬æƒ³è¦å¯¹å‡½æ•°è¿›è¡Œåæ¬¡è¿ç»­è°ƒç”¨ï¼Œè¿”å›æ•°å­—0åˆ°9ã€‚æˆ‘ä»¬å¦‚ä½•å®ç°å‘¢ï¼Ÿ å¯ä»¥ä½¿ç”¨gotoè¯­å¥å°†æ§åˆ¶è½¬ç§»åˆ°å‡½æ•°ä¸­çš„ä»»æ„ç‚¹ã€‚ æ‰€ä»¥å¦‚æœæˆ‘ä»¬ä½¿ç”¨çŠ¶æ€å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š\n\n```c\nint function()\n{\n    static int i, state = 0;\n    switch (state)\n    {\n        case 0: goto LABEL0;\n        case 1: goto LABEL1;\n    }\nLABEL0: /* start of function */\n    for (i = 0; i < 10; i++)\n    {\n        state = 1; /* so we will come back to LABEL1 */\n        return i;\nLABEL1:\n        ; /* resume control straight after the return */\n    }\n}\n```\n\nè¿™ä¸ªæ–¹æ³•æœ‰æ•ˆã€‚æˆ‘ä»¬åœ¨å¯èƒ½éœ€è¦æ¢å¤æ§åˆ¶çš„ç‚¹ä¸Šæœ‰ä¸€ç»„æ ‡ç­¾ï¼šä¸€ä¸ªåœ¨å¼€å§‹å¤„ï¼Œä¸€ä¸ªåœ¨æ¯ä¸ª return è¯­å¥ä¹‹åã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªçŠ¶æ€å˜é‡ï¼Œåœ¨å‡½æ•°è°ƒç”¨ä¹‹é—´ä¿å­˜ï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬ä¸‹ä¸€ä¸ªéœ€è¦æ¢å¤æ§åˆ¶çš„æ ‡ç­¾ã€‚åœ¨ä»»ä½•returnä¹‹å‰ï¼Œæˆ‘ä»¬æ›´æ–°çŠ¶æ€å˜é‡ä»¥æŒ‡å‘æ­£ç¡®çš„æ ‡ç­¾ï¼›åœ¨ä»»ä½•è°ƒç”¨ä¹‹åï¼Œæˆ‘ä»¬éƒ½ä¼šå¯¹å˜é‡çš„å€¼è¿›è¡Œåˆ‡æ¢ä»¥æ‰¾å‡ºè·³è½¬åˆ°çš„ä½ç½®ã€‚\n\nä¸è¿‡ï¼Œå®ƒä»ç„¶å¾ˆéš¾çœ‹ã€‚æœ€ç³Ÿç³•çš„éƒ¨åˆ†æ˜¯æ ‡ç­¾é›†å¿…é¡»æ‰‹åŠ¨ç»´æŠ¤ï¼Œå¹¶ä¸”å¿…é¡»åœ¨å‡½æ•°ä½“å’Œåˆå§‹ switch è¯­å¥ä¹‹é—´ä¿æŒä¸€è‡´ã€‚æ¯æ¬¡æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæ–°çš„è¿”å›è¯­å¥ï¼Œæˆ‘ä»¬å¿…é¡»å‘æ˜ä¸€ä¸ªæ–°çš„æ ‡ç­¾åç§°å¹¶å°†å…¶æ·»åŠ åˆ°å¼€å…³ä¸­çš„åˆ—è¡¨ä¸­ï¼›æ¯æ¬¡æˆ‘ä»¬åˆ é™¤ return è¯­å¥æ—¶ï¼Œæˆ‘ä»¬éƒ½å¿…é¡»åˆ é™¤å…¶å¯¹åº”çš„æ ‡ç­¾ã€‚ æˆ‘ä»¬åˆšåˆšå°†ç»´æŠ¤å·¥ä½œé‡å¢åŠ äº†ä¸¤å€ã€‚\n\n## Duff's device\n\nCè¯­è¨€ä¸­è‘—åçš„â€œè¾¾å¤«è£…ç½®â€åˆ©ç”¨äº†è¿™æ ·ä¸€ä¸ªäº‹å®ï¼Œå³ case è¯­å¥åœ¨å…¶åŒ¹é…çš„ switch è¯­å¥çš„å­å—ä¸­ä»ç„¶æ˜¯åˆæ³•çš„ã€‚ Tom Duff ä½¿ç”¨å®ƒæ¥ä¼˜åŒ–è¾“å‡ºå¾ªç¯ï¼š\n\n```c\nswitch (count % 8)\n{\n    case 0: do { *to = *from++;\n    case 7:      *to = *from++;\n    case 6:      *to = *from++;\n    case 5:      *to = *from++;\n    case 4:      *to = *from++;\n    case 3:      *to = *from++;\n    case 2:      *to = *from++;\n    case 1:      *to = *from++;\n               } while ((count -= 8) > 0);\n}\n```\n\næˆ‘ä»¬å¯ä»¥åœ¨åç¨‹æŠ€å·§ä¸­å°†å…¶ç”¨äºç¨å¾®ä¸åŒçš„ç”¨é€”ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ switch è¯­å¥æ¥æ‰§è¡Œè·³è½¬ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ switch è¯­å¥æ¥å†³å®šæ‰§è¡Œå“ªä¸ª goto è¯­å¥ï¼š\n\n```c\nint function(void)\n{\n    static int i, state = 0;\n    switch (state)\n    {\n        case 0: /* start of function */\n            for (i = 0; i < 10; i++)\n            {\n                state = 1; /* so we will come back to \"case 1\" */\n                return i;\n        case 1:\n                ; /* resume control straight after the return */\n            }\n    }\n}\n```\n\nç°åœ¨è¿™çœ‹èµ·æ¥å¾ˆæœ‰å¸Œæœ›ã€‚ æˆ‘ä»¬ç°åœ¨è¦åšçš„å°±æ˜¯æ„å»ºä¸€äº›ç²¾å¿ƒæŒ‘é€‰çš„å®ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¡€æ·‹æ·‹çš„ç»†èŠ‚éšè—åœ¨çœ‹ä¼¼åˆç†çš„ä¸œè¥¿ä¸­ï¼šï¼ˆä½¿ç”¨`do ... while(0)`æ¥ç¡®ä¿`crReturn`ç›´æ¥å‡ºç°åœ¨ if å’Œ else ä¹‹é—´æ—¶ä¸éœ€è¦å¤§æ‹¬å·ï¼‰\n\n```c\n#define crBegin static int state=0; switch(state) { case 0:\n#define crReturn(i,x) do { state=i; return x; case i:; } while (0)\n#define crFinish }\nint function(void) {\n    static int i;\n    crBegin;\n    for (i = 0; i < 10; i++)\n        crReturn(1, i);\n    crFinish;\n}\n```\n\nè¿™å‡ ä¹æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`crReturn`ä»¥è¿™ç§æ–¹å¼ä»å‡½æ•°è¿”å›ï¼Œä»¥ä¾¿åœ¨è¿”å›åç«‹å³æ¢å¤ä¸‹ä¸€æ¬¡è°ƒç”¨çš„æ§åˆ¶ã€‚ å½“ç„¶ï¼Œæˆ‘ä»¬å¿…é¡»éµå®ˆä¸€äº›åŸºæœ¬è§„åˆ™ï¼ˆç”¨`crBegin`å’Œ`crFinish`åŒ…å›´å‡½æ•°ä½“ï¼›å¦‚æœéœ€è¦åœ¨`crReturn`ä¸­ä¿ç•™æ‰€æœ‰å±€éƒ¨å˜é‡ï¼Œåˆ™å°†å®ƒä»¬å£°æ˜ä¸ºé™æ€çš„ï¼›æ°¸è¿œä¸è¦å°†`crReturn`æ”¾åœ¨æ˜¾å¼çš„`switch`è¯­å¥ä¸­ï¼‰ï¼› ä½†è¿™äº›å¹¶æ²¡æœ‰é™åˆ¶æˆ‘ä»¬å¤ªå¤šã€‚\n\nå‰©ä¸‹çš„å”¯ä¸€éšœç¢æ˜¯`crReturn`çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚ æ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä¸­å‘æ˜æ–°æ ‡ç­¾æ—¶å¿…é¡»é¿å…å®ƒä¸ç°æœ‰æ ‡ç­¾åç§°å†²çªä¸€æ ·ï¼Œç°åœ¨æˆ‘ä»¬å¿…é¡»ç¡®ä¿`crReturn`çš„æ‰€æœ‰çŠ¶æ€å‚æ•°éƒ½æ˜¯ä¸åŒçš„ã€‚ ç»“æœå°†æ˜¯ç›¸å½“è‰¯æ€§çš„â€”â€”ç¼–è¯‘å™¨ä¼šæ•è·å®ƒå¹¶ä¸”ä¸ä¼šè®©å®ƒåœ¨è¿è¡Œæ—¶åšå¯æ€•çš„äº‹æƒ…â€”â€”ä½†æˆ‘ä»¬ä»ç„¶éœ€è¦é¿å…è¿™æ ·åšã€‚\n\nANSI Cæä¾›äº†ç‰¹æ®Šçš„å®åç§°`__LINE__`ï¼Œå®ƒè¡¨ç¤ºå½“å‰æºä»£ç è¡Œå·ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†`crReturn`é‡å†™ä¸º\n\n```c\n#define crReturn(x) do { state=__LINE__; return x; \\\n                         case __LINE__:; } while (0)\n```\n\nå¦‚æœæˆ‘ä»¬éµå®ˆç¬¬å››æ¡åŸºæœ¬è§„åˆ™ï¼ˆæ°¸è¿œä¸è¦å°†ä¸¤ä¸ª`crReturn`è¯­å¥æ”¾åœ¨åŒä¸€è¡Œï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ ¹æœ¬å°±ä¸å¿…æ‹…å¿ƒé‚£äº›çŠ¶æ€å‚æ•°ã€‚\n\n## Evaluation\n\nç°åœ¨æˆ‘ä»¬æœ‰äº†è¿™ä¸ªæ€ªç‰©ï¼Œè®©æˆ‘ä»¬ç”¨å®ƒé‡å†™æˆ‘ä»¬åŸæ¥çš„ä»£ç ç‰‡æ®µã€‚\n\n```c\nint decompressor(void) {\n    static int c, len;\n    crBegin;\n    while (1) {\n        c = getchar();\n        if (c == EOF)\n            break;\n        if (c == 0xFF) {\n            len = getchar();\n            c = getchar();\n            while (len--)\n\t        crReturn(c);\n        } else\n\t    crReturn(c);\n    }\n    crReturn(EOF);\n    crFinish;\n}\n```\n\n```c\nvoid parser(int c) {\n    crBegin;\n    while (1) {\n        /* first char already in c */\n        if (c == EOF)\n            break;\n        if (isalpha(c)) {\n            do {\n                add_to_token(c);\n\t\tcrReturn( );\n            } while (isalpha(c));\n            got_token(WORD);\n        }\n        add_to_token(c);\n        got_token(PUNCT);\n\tcrReturn( );\n    }\n    crFinish;\n}\n```\n\næˆ‘ä»¬å·²ç»å°†è§£å‹ç¼©å™¨å’Œè§£æå™¨éƒ½é‡å†™ä¸ºè¢«è°ƒç”¨è€…ï¼Œå®Œå…¨ä¸éœ€è¦æˆ‘ä»¬ä¸Šæ¬¡è¿™æ ·åšæ—¶å¿…é¡»è¿›è¡Œçš„å¤§è§„æ¨¡é‡ç»„ã€‚**æ¯ä¸ªå‡½æ•°çš„ç»“æ„å®Œå…¨åæ˜ äº†å…¶åŸå§‹å½¢å¼çš„ç»“æ„**ã€‚è¯»è€…å¯ä»¥æ¨æ–­å‡ºè§£æå™¨è¯†åˆ«çš„è¯­æ³•æˆ–è§£å‹ç¼©å™¨ä½¿ç”¨çš„å‹ç¼©æ•°æ®æ ¼å¼ï¼Œ**è¿™æ¯”é˜…è¯»æ™¦æ¶©çš„çŠ¶æ€æœºä»£ç è¦å®¹æ˜“å¾—å¤š**ã€‚ä¸€æ—¦æ‚¨å…¨ç¥è´¯æ³¨äºæ–°æ ¼å¼ï¼Œæ§åˆ¶æµç¨‹å°±å¾ˆç›´è§‚ï¼šå½“è§£å‹ç¼©ç¨‹åºæœ‰ä¸€ä¸ªå­—ç¬¦æ—¶ï¼Œå®ƒä¼šä½¿ç”¨`crReturn`å°†å…¶ä¼ å›ç»™è°ƒç”¨è€…ï¼Œå¹¶ç­‰å¾…åœ¨éœ€è¦å¦ä¸€ä¸ªå­—ç¬¦æ—¶å†æ¬¡è°ƒç”¨ã€‚å½“è§£æå™¨éœ€è¦å¦ä¸€ä¸ªå­—ç¬¦æ—¶ï¼Œå®ƒä½¿ç”¨`crReturn`è¿”å›ï¼Œå¹¶ç­‰å¾…ç”¨å‚æ•°`c`ä¸­çš„æ–°å­—ç¬¦å†æ¬¡è°ƒç”¨ã€‚\n\nå¯¹ä»£ç è¿›è¡Œäº†ä¸€ä¸ªå°çš„ç»“æ„æ›´æ”¹ï¼š`parser`ç°åœ¨åœ¨å¾ªç¯çš„æœ«å°¾è€Œä¸æ˜¯å¼€å§‹å¤„æœ‰å®ƒçš„`getchar`ï¼ˆå—¯ï¼Œç›¸åº”çš„`crReturn`ï¼‰ï¼Œå› ä¸ºå½“å‡½æ•°è¿è¡Œæ—¶ç¬¬ä¸€ä¸ªå­—ç¬¦å·²ç»åœ¨`c`ä¸­è¿›å…¥ã€‚æˆ‘ä»¬å¯ä»¥æ¥å—è¿™ä¸ªç»“æ„ä¸Šçš„å°å˜åŒ–ï¼Œæˆ–è€…å¦‚æœæˆ‘ä»¬çœŸçš„å¯¹æ­¤æœ‰å¼ºçƒˆçš„æ„Ÿè§‰ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®š`parser`éœ€è¦ä¸€ä¸ªâ€œåˆå§‹åŒ–â€è°ƒç”¨ï¼Œç„¶åæ‰èƒ½å¼€å§‹å‘å®ƒæä¾›å­—ç¬¦ã€‚\n\nå½“ç„¶ï¼Œå’Œä»¥å‰ä¸€æ ·ï¼Œæˆ‘ä»¬ä¸å¿…ä½¿ç”¨åç¨‹å®é‡å†™è¿™ä¸¤ä¸ªä¾‹ç¨‹ã€‚ä¸€ä¸ªå°±å¤Ÿäº†ï¼›å¦ä¸€ä¸ªå¯ä»¥æ˜¯å®ƒçš„è°ƒç”¨è€…ã€‚\n\næˆ‘ä»¬å·²ç»å®ç°äº†æˆ‘ä»¬æ‰“ç®—å®ç°çš„ç›®æ ‡ï¼šä¸€ç§å¯ç§»æ¤çš„ANSI Cæ–¹æ³•ï¼Œå¯ä»¥åœ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´ä¼ é€’æ•°æ®ï¼Œè€Œæ— éœ€å°†å…¶é‡å†™ä¸ºæ˜¾å¼çŠ¶æ€æœºã€‚æˆ‘ä»¬é€šè¿‡å°†Cé¢„å¤„ç†å™¨ä¸switchè¯­å¥çš„ä¸€ä¸ªå¾ˆå°‘ä½¿ç”¨çš„åŠŸèƒ½ç›¸ç»“åˆæ¥åˆ›å»ºéšå¼çŠ¶æ€æœº(*implicit* state machine)æ¥å®Œæˆæ­¤æ“ä½œã€‚\n\n## ç¼–ç æ ‡å‡†é—®é¢˜\n\nå½“ç„¶ï¼Œè¿™ä¸ªæŠ€å·§è¿åäº†ä¹¦ä¸­çš„æ‰€æœ‰ç¼–ç æ ‡å‡†ã€‚å°è¯•åœ¨æ‚¨å…¬å¸çš„ä»£ç ä¸­è¿™æ ·åšï¼Œå¯èƒ½ä¼šå—åˆ°ä¸¥å‰çš„æ‰¹è¯„ï¼åœ¨å®ä¸­åµŒå…¥äº†ä¸åŒ¹é…çš„å¤§æ‹¬å·ï¼Œåœ¨å­å—ä¸­åµŒå…¥äº†ç”¨ä¾‹ï¼Œä»¥åŠ`crReturn`å®åŠå…¶å¯æ€•çš„ç ´åæ€§å†…å®¹......å¦‚æœæ²¡æœ‰å› ä¸ºè¿™ç§ä¸è´Ÿè´£ä»»çš„ç¼–ç è¡Œä¸ºå½“åœºè¢«è§£é›‡çœŸæ˜¯ä¸ªå¥‡è¿¹ã€‚åº”è¯¥ä¸ºè‡ªå·±æ„Ÿåˆ°ç¾è€»ã€‚\n\nè¿™é‡Œçš„ç¼–ç æ ‡å‡†ç¡®å®æœ‰é—®é¢˜ï¼Œéœ€è¦å£°æ˜ã€‚åœ¨æœ¬æ–‡ä¸­å±•ç¤ºçš„ç¤ºä¾‹ä¸æ˜¯å¾ˆé•¿ï¼Œä¹Ÿä¸æ˜¯å¾ˆå¤æ‚ï¼Œå¹¶ä¸”åœ¨é‡å†™ä¸ºçŠ¶æ€æœºæ—¶ä»ç„¶å¯ä»¥ç†è§£ã€‚ ä½†æ˜¯éšç€å‡½æ•°è¶Šæ¥è¶Šé•¿ï¼Œéœ€è¦é‡å†™çš„ç¨‹åº¦è¶Šæ¥è¶Šå¤§ï¼Œæ¸…æ™°åº¦çš„æŸå¤±ä¹Ÿè¶Šæ¥è¶Šä¸¥é‡ã€‚\n\nè€ƒè™‘ã€‚ ç”±ä»¥ä¸‹å½¢å¼çš„å°å—æ„å»ºçš„å‡½æ•°\n\n```c\n    case STATE1:\n    /* perform some activity */\n    if (condition) state = STATE2; else state = STATE3;\n```\n\nå¯¹äºè¯»è€…æ¥è¯´ï¼Œä¸ç”±ä»¥ä¸‹å½¢å¼çš„å°å—æ„å»ºçš„å‡½æ•°æ²¡æœ‰å¤ªå¤§åŒºåˆ«\n\n```c\n    LABEL1:\n    /* perform some activity */\n    if (condition) goto LABEL2; else goto LABEL3;\n```\n\nä¸€ä¸ªæ˜¯è°ƒç”¨è€…ï¼Œå¦ä¸€ä¸ªæ˜¯è¢«è°ƒç”¨è€…ï¼Œæ²¡é”™ï¼Œä½†æ˜¯å‡½æ•°çš„è§†è§‰ç»“æ„æ˜¯ç›¸åŒçš„ï¼Œå¹¶ä¸”å®ƒä»¬æä¾›çš„å¯¹å…¶åº•å±‚ç®—æ³•çš„æ´å¯ŸåŠ›å½¼æ­¤ä¸€æ ·å°ã€‚ é‚£äº›å› ä¸ºä½¿ç”¨æˆ‘çš„åç¨‹å®è€Œè§£é›‡ä½ çš„äººä¹Ÿä¼šå› ä¸ºä½ ç”¨ goto è¯­å¥è¿æ¥çš„å°å—æ„å»ºå‡½æ•°è€Œå¤§å£°è§£é›‡ä½ ï¼è¿™ä¸€æ¬¡ä»–ä»¬æ˜¯å¯¹çš„ï¼Œå› ä¸ºå¸ƒç½®è¿™æ ·çš„å‡½æ•°ä¼šå¯æ€•åœ°æ©ç›–ç®—æ³•çš„ç»“æ„ã€‚\n\nç¼–ç æ ‡å‡†æ—¨åœ¨æ¸…æ™°ã€‚ é€šè¿‡å°† switchã€return å’Œ case è¯­å¥ç­‰é‡è¦å†…å®¹éšè—åœ¨â€œæ··æ·†â€å®ä¸­ï¼Œç¼–ç æ ‡å‡†ä¼šå£°ç§°æ‚¨å·²ç»æ¨¡ç³Šäº†ç¨‹åºçš„å¥æ³•ç»“æ„ï¼Œå¹¶ä¸”è¿åäº†æ¸…æ™°åº¦è¦æ±‚ã€‚ä½†ä½ è¿™æ ·åšæ˜¯ä¸ºäº†æ­ç¤ºç¨‹åºçš„ç®—æ³•ç»“æ„ï¼Œè¿™æ›´å¯èƒ½æ˜¯è¯»è€…æƒ³çŸ¥é“çš„ï¼\n\nä»»ä½•ä»¥ç‰ºç‰²ç®—æ³•æ¸…æ™°åº¦ä¸ºä»£ä»·åšæŒå¥æ³•æ¸…æ™°åº¦çš„ç¼–ç æ ‡å‡†éƒ½åº”è¯¥è¢«é‡å†™ã€‚ å¦‚æœæ‚¨çš„é›‡ä¸»å› ä½¿ç”¨æ­¤æŠ€å·§è€Œè§£é›‡æ‚¨ï¼Œè¯·åœ¨ä¿å®‰äººå‘˜å°†æ‚¨æ‹–å‡ºå¤§æ¥¼æ—¶åå¤å‘Šè¯‰ä»–ä»¬ã€‚\n\n# Refinements and Code\n\nåœ¨ä¸€ä¸ªä¸¥è‚ƒçš„åº”ç”¨ç¨‹åºä¸­ï¼Œè¿™ä¸ªç©å…·åç¨‹å®ç°ä¸å¤ªå¯èƒ½æœ‰ç”¨ï¼Œå› ä¸ºå®ƒä¾èµ–äºé™æ€å˜é‡ï¼Œå› æ­¤å®ƒæ— æ³•é‡å…¥æˆ–å¤šçº¿ç¨‹ã€‚ ç†æƒ³æƒ…å†µä¸‹ï¼Œåœ¨å®é™…åº”ç”¨ç¨‹åºä¸­ï¼Œæ‚¨å¯èƒ½å¸Œæœ›èƒ½å¤Ÿåœ¨å¤šä¸ªä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ç›¸åŒçš„å‡½æ•°ï¼Œå¹¶ä¸”åœ¨ç»™å®šä¸Šä¸‹æ–‡ä¸­çš„æ¯æ¬¡è°ƒç”¨ä¸­ï¼Œæ§åˆ¶åœ¨åŒä¸€ä¸Šä¸‹æ–‡ä¸­çš„æœ€åä¸€æ¬¡è¿”å›ä¹‹åç«‹å³æ¢å¤ã€‚\n\nè¿™å¾ˆå®¹æ˜“å®Œæˆã€‚ æˆ‘ä»¬å®‰æ’äº†ä¸€ä¸ªé¢å¤–çš„å‡½æ•°å‚æ•°ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŒ‡å‘ä¸Šä¸‹æ–‡ç»“æ„çš„æŒ‡é’ˆï¼› æˆ‘ä»¬å°†æ‰€æœ‰æœ¬åœ°çŠ¶æ€å’Œåç¨‹çŠ¶æ€å˜é‡å£°æ˜ä¸ºè¯¥ç»“æ„çš„å…ƒç´ ã€‚\n\nè¿™æœ‰ç‚¹éš¾çœ‹ï¼Œå› ä¸ºçªç„¶é—´ä½ ä¸å¾—ä¸ä½¿ç”¨`ctx->i`ä½œä¸ºå¾ªç¯è®¡æ•°å™¨ï¼Œè€Œä½ ä»¥å‰åªä¼šä½¿ç”¨`i`ï¼› å®é™…ä¸Šï¼Œæ‚¨æ‰€æœ‰çš„é‡è¦å˜é‡éƒ½æˆä¸ºåç¨‹ä¸Šä¸‹æ–‡ç»“æ„çš„å…ƒç´ ã€‚ ä½†å®ƒæ¶ˆé™¤äº†é‡å…¥çš„é—®é¢˜ï¼Œå¹¶ä¸”ä»ç„¶æ²¡æœ‰å½±å“ä¾‹ç¨‹çš„ç»“æ„ã€‚\n\nï¼ˆå½“ç„¶ï¼Œå¦‚æœ C åªæœ‰ Pascal çš„ with è¯­å¥ï¼Œæˆ‘ä»¬å¯ä»¥å®‰æ’å®æ¥ä½¿è¿™ä¸ªé—´æ¥å±‚ä¹ŸçœŸæ­£é€æ˜ã€‚é—æ†¾çš„æ˜¯ï¼Œè‡³å°‘ C++ ç”¨æˆ·å¯ä»¥é€šè¿‡è®©ä»–ä»¬çš„åç¨‹æˆä¸ºç±»æˆå‘˜æ¥ç®¡ç†å®ƒï¼Œ å¹¶å°†å…¶æ‰€æœ‰å±€éƒ¨å˜é‡ä¿ç•™åœ¨ç±»ä¸­ï¼Œä»¥ä¾¿èŒƒå›´æ˜¯éšå¼çš„ã€‚ï¼‰\n\nè¿™é‡ŒåŒ…å«ä¸€ä¸ª C å¤´æ–‡ä»¶ï¼Œå®ƒå°†è¿™ä¸ªåç¨‹æŠ€å·§å®ç°ä¸ºä¸€ç»„é¢„å®šä¹‰çš„å®ã€‚ æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸¤ç»„å®ï¼Œå‰ç¼€ä¸º scr å’Œ ccrã€‚ scr å®æ˜¯è¯¥æŠ€æœ¯çš„ç®€å•å½¢å¼ï¼Œå½“æ‚¨å¯ä»¥ä½¿ç”¨é™æ€å˜é‡æ—¶ï¼› ccr å®æä¾›é«˜çº§å¯é‡å…¥è¡¨å•ã€‚ å®Œæ•´æ–‡æ¡£åœ¨å¤´æ–‡ä»¶æœ¬èº«çš„æ³¨é‡Šä¸­ç»™å‡ºã€‚\n\nè¯·æ³¨æ„ï¼Œ`Visual C++`ç‰ˆæœ¬ 6 ä¸å–œæ¬¢è¿™ç§åç¨‹æŠ€å·§ï¼Œå› ä¸ºå®ƒçš„é»˜è®¤è°ƒè¯•çŠ¶æ€ï¼ˆç”¨äºç¼–è¾‘å’Œç»§ç»­çš„ç¨‹åºæ•°æ®åº“ï¼‰å¯¹`__LINE__`å®åšäº†ä¸€äº›å¥‡æ€ªçš„äº‹æƒ…ã€‚ è¦ä½¿ç”¨`VC++6`ç¼–è¯‘ä½¿ç”¨åç¨‹çš„ç¨‹åºï¼Œå¿…é¡»å…³é—­â€œç¼–è¾‘å¹¶ç»§ç»­â€ã€‚ ï¼ˆåœ¨é¡¹ç›®è®¾ç½®ä¸­ï¼Œè½¬åˆ°â€œC/C++â€é€‰é¡¹å¡ï¼Œç±»åˆ«â€œå¸¸è§„â€ï¼Œè®¾ç½®â€œè°ƒè¯•ä¿¡æ¯â€ã€‚é€‰æ‹©â€œç”¨äºç¼–è¾‘å’Œç»§ç»­çš„ç¨‹åºæ•°æ®åº“â€ä»¥å¤–çš„ä»»ä½•é€‰é¡¹ã€‚ï¼‰\n\n---\n\nå‚è€ƒæ–‡çŒ®ï¼šhttps://www.chiark.greenend.org.uk/~sgtatham/coroutines.html\n","categories":["æ“ä½œç³»ç»Ÿ","å¤šçº¿ç¨‹"]},{"title":"åç¨‹_Goè¯­è¨€åç¨‹å®ç°","url":"/å¤šçº¿ç¨‹/åç¨‹_Goè¯­è¨€åç¨‹/","content":"# åŸç†\n\n```go\nfunc main()\n{\n    go sayHello()\n    // continue doing other things\n}\nfunc sayHello()\n{\n    fmt.Println(\"hello\")\n}\n```\n\n","categories":["æ“ä½œç³»ç»Ÿ","å¤šçº¿ç¨‹","Go"]},{"title":"Linux_å‡çº§å·¥å…·è½¯ä»¶ä»¥CMakeä¸ºä¾‹","url":"/Linux/Linux_å‡çº§å·¥å…·è½¯ä»¶ä»¥Cmakeä¸ºä¾‹/","content":"\nå‚è€ƒæ–‡ç« ï¼š[ã€å®‰å…¨|æ­£ç¡®ã€‘Ubuntuå‡çº§CMake](https://blog.csdn.net/zzh516451964zzh/article/details/126373715)\n\nä¸»è¦é€šè¿‡å»ºç«‹æ–°çš„è½¯é“¾æ¥æ¥å‡çº§è½¯ä»¶ï¼ŒåŒæ ·é€‚ç”¨äºå‡çº§è½¯ä»¶ï¼šæ— éœ€å¸è½½ï¼Œé€šè¿‡å»ºç«‹è½¯é“¾æ¥å³å¯è§£å†³é—®é¢˜ã€‚å¾ˆå¤šæ•™ç¨‹ä¼šè®©ä½ ä½¿ç”¨autoremoveï¼Œä½†è¯¥æ“ä½œä¼šå°†ä¹‹å‰ç¼–è¯‘è¿‡çš„è®¸å¤šæ–‡ä»¶è¿å¸¦åˆ é™¤ã€‚\n\n1. ä¸‹è½½CMakeï¼Œ[ä¸‹è½½åœ°å€](https://cmake.org/files/)\n\n2. ä¸‹è½½å‹ç¼©åŒ…ï¼Œè¯·æ³¨æ„æ— éœ€ç¼–è¯‘ï¼Œè¿™æ˜¯å·²ç»ç¼–è¯‘å¥½çš„ç‰ˆæœ¬\n\n3. è§£å‹\n\n4. ç§»åŠ¨\n\n   `sudo mv cmake-3.22.1-linux-x86_64 /usr/share/camke-3.22.1`\n\n5. å»ºç«‹è½¯é“¾æ¥\n\n   `sudo ln -sf /usr/share/cmake-3.22.1/bin/cmake /usr/bin/cmake `\n\n6. æ£€æŸ¥æ˜¯å¦æˆåŠŸ\n\n   `cmake --version`\n","categories":["Linux"]},{"title":"git_å…¬é’¥ç§é’¥","url":"/git/git_å…¬é’¥ç§é’¥/","content":"\n\n\n```\nusage: ssh-keygen [-q] [-a rounds] [-b bits] [-C comment] [-f output_keyfile]\n                  [-m format] [-N new_passphrase] [-O option]\n                  [-t dsa | ecdsa | ecdsa-sk | ed25519 | ed25519-sk | rsa]\n                  [-w provider] [-Z cipher]\n       ssh-keygen -p [-a rounds] [-f keyfile] [-m format] [-N new_passphrase]\n                   [-P old_passphrase] [-Z cipher]\n       ssh-keygen -i [-f input_keyfile] [-m key_format]\n       ssh-keygen -e [-f input_keyfile] [-m key_format]\n       ssh-keygen -y [-f input_keyfile]\n       ssh-keygen -c [-a rounds] [-C comment] [-f keyfile] [-P passphrase]\n       ssh-keygen -l [-v] [-E fingerprint_hash] [-f input_keyfile]\n       ssh-keygen -B [-f input_keyfile]\n       ssh-keygen -D pkcs11\n       ssh-keygen -F hostname [-lv] [-f known_hosts_file]\n       ssh-keygen -H [-f known_hosts_file]\n       ssh-keygen -K [-a rounds] [-w provider]\n       ssh-keygen -R hostname [-f known_hosts_file]\n       ssh-keygen -r hostname [-g] [-f input_keyfile]\n       ssh-keygen -M generate [-O option] output_file\n       ssh-keygen -M screen [-f input_file] [-O option] output_file\n       ssh-keygen -I certificate_identity -s ca_key [-hU] [-D pkcs11_provider]\n                  [-n principals] [-O option] [-V validity_interval]\n                  [-z serial_number] file ...\n       ssh-keygen -L [-f input_keyfile]\n       ssh-keygen -A [-a rounds] [-f prefix_path]\n       ssh-keygen -k -f krl_file [-u] [-s ca_public] [-z version_number]\n                  file ...\n       ssh-keygen -Q [-l] -f krl_file [file ...]\n       ssh-keygen -Y find-principals -s signature_file -f allowed_signers_file\n       ssh-keygen -Y match-principals -I signer_identity -f allowed_signers_file\n       ssh-keygen -Y check-novalidate -n namespace -s signature_file\n       ssh-keygen -Y sign -f key_file -n namespace file [-O option] ...\n       ssh-keygen -Y verify -f allowed_signers_file -I signer_identity\n                  -n namespace -s signature_file [-r krl_file] [-O option]\n```\n\n# ç”ŸæˆSSH Keys\n\nå¦‚æœå·²ç»ç”Ÿå­˜äº†ssh keyï¼Œé‚£å°±å¯ä»¥è·³è¿‡è¿™ä¸€æ­¥äº†ã€‚å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š\n\n```bash\nls -l ~/.ssh\n```\n\nå¦‚æœå‡ºç°`id_rsa`å’Œ`id_rsa_pub`é‚£å°±è¯´æ˜å·²ç»ç”Ÿæˆã€‚\n\nå¦‚æœæ²¡æœ‰ï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤ç”Ÿæˆï¼š\n\n```\nssh-keygen -t rsa -C â€œyour_email@example.comâ€\n```\n\n## ç¤ºä¾‹\n\n`ssh-keygen -t rsa -C \"xing-cg@qq.com\"`\n\nå…¶ä¸­ï¼Œ`-t`é€‰é¡¹ä»£è¡¨çš„æ˜¯ç”Ÿæˆå“ªç§å¯†é’¥ï¼Œ`[-t dsa | ecdsa | ecdsa-sk | ed25519 | ed25519-sk | rsa]`ï¼Œé€‰æ‹©rsaã€‚\n\n`-C`é€‰é¡¹ä»£è¡¨æ³¨é‡Šï¼Œä¸€èˆ¬å¡«å†™é‚®ç®±åœ°å€ã€‚\n\n# æ‹·è´ç°æœ‰çš„åˆ°æ–°æœºå™¨ä¸Š\n\nclone githubçš„é¡¹ç›®æ—¶å‡ºé—®é¢˜ï¼ŒæŠ¥ä»¥ä¸‹é”™è¯¯ã€‚\n\n```\nPermission denied (publickey).\n  fatal: Could not read from remote repository.\n  Please make sure you have the correct access rights\n```\n\n## è§£å†³æ–¹æ³•\n\n1. æŸ¥çœ‹ssh-agentæ˜¯å¦å¯ç”¨\n\n   ```\n   ssh-agent -s\n   ```\n\n   å¦‚æœçœ‹åˆ°Agent pid xxxxè¯´æ˜å·²ç»å¯ç”¨ã€‚æ¥ä¸‹æ¥æŠŠç§é’¥æ·»åŠ åˆ°ssh-agentå°±å¯ä»¥äº†ã€‚\n\n2. å°†`.Key`æ·»åŠ åˆ°`ssh-agent`\n\n   ```\n   ssh-add ~/.ssh/id_rsa\n   ```\n\n   å¯èƒ½ä¼šæç¤ºï¼Œ`It is required that your private key files are NOT accessible by others`ã€‚\n\n   ```\n   @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n   @         WARNING: UNPROTECTED PRIVATE KEY FILE!          @\n   @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n   Permissions 0664 for '/home/xcg/.ssh/id_rsa' are too open.\n   It is required that your private key files are NOT accessible by others.\n   This private key will be ignored.\n   ```\n\n   è§£å†³æ–¹æ³•ï¼š`chmod 600 ~/.ssh/id_rsa ~/.ssh/id_rsa.pub`\n\n3. å°†sshçš„å…¬é’¥æ·»åŠ åˆ°gitä¸Š\n\n   1. æŸ¥æ‰¾å…¬é’¥ï¼Œä¸€èˆ¬åœ¨`~/.ssh`ä¸­çš„`id_rsa.pub`ä¸­\n   2. æ‰“å¼€githubæˆ–gitlabï¼Œå†ä¾æ¬¡è¿›å…¥settingsã€ssh keysã€add ssh keysè¿›è¡Œæ·»åŠ ã€‚\n","categories":["Linux","git"]},{"title":"åç¨‹_æ¦‚è¿°","url":"/å¤šçº¿ç¨‹/åç¨‹_æ¦‚è¿°/","content":"# å¤šçº¿ç¨‹çš„ç¼ºé™·\n\n1. å¤šçº¿ç¨‹æ˜¯å¾®ç§’çº§åˆ«ã€‚\n2. çº¿ç¨‹æ•°ä¸€å¤šï¼ŒCPUä½¿ç”¨ç‡ä¼šé£™å‡ã€‚å¯æ‰©å±•æ€§æ¯”è¾ƒå·®\n3. ç¼–å†™å¼‚æ­¥é€»è¾‘ã€éé˜»å¡äº‹ä»¶æ—¶ï¼Œå‡½æ•°å›è°ƒæ–¹å¼åªæœ‰ç¼–å†™ç¨‹åºçš„ç¨‹åºå‘˜æ‰çŸ¥é“è§„åˆ™ã€‚\n# åç¨‹çš„ç›®çš„\n1. æè¿°å¼‚æ­¥é€»è¾‘\n    1. æ¯”å¤šçº¿ç¨‹æ›´å¿«\n    2. æ¯”å‡½æ•°å›è°ƒæ›´ç¾è§‚\n# åç¨‹çš„ä¼˜åŠ¿\n1. æ€§èƒ½å¼ºåŠ²\n    1. åç¨‹åˆ‡æ¢å®éªŒ - ä¸€æ¬¡åç¨‹åˆ‡æ¢çš„å¼€é”€å¯ä»¥è¾¾åˆ°2åˆ°3çº³ç§’ä¹‹é—´ï¼Œå•çº¿ç¨‹åç¨‹åˆ‡æ¢çš„æ—¶é—´å¯ä»¥è¾¾åˆ°7åˆ°8çº³ç§’ï¼Œè·¨çº¿ç¨‹çš„åç¨‹åˆ‡æ¢ä¹Ÿåªéœ€37çº³ç§’å·¦å³ã€‚è¿™äº›æ—¶é—´å¤§å¤§å¿«äºçº¿ç¨‹åˆ‡æ¢çš„æ—¶é—´ã€‚çº¿ç¨‹åˆ‡æ¢è‡³å°‘éœ€è¦2000ä¸ªæ—¶é’Ÿå‘¨æœŸã€‚å‡è®¾CPUä¸º4GHzï¼Œåˆ™è‡³å°‘éœ€è¦500nsï¼Œè‹¥è€ƒè™‘cacheå¤±æ•ˆé—®é¢˜ï¼Œåç¨‹æ•ˆç‡ç›¸å¯¹äºçº¿ç¨‹å°†ä¼šæ˜¯10ã€100å€çš„æ•°é‡çº§ã€‚\n2. è¯­æ³•ä¼˜é›…\n# å®éªŒï¼šæµ‹é‡åç¨‹åˆ‡æ¢å¼€é”€\n\nå†™ä¸¤ä¸ªåç¨‹ï¼Œä½¿å…¶ä¸æ–­åˆ‡æ¢ã€‚\n```cpp\nconstexpr uint32_t total_switch = 2e9; // 2 * 10^9\n\nint count = 0;\n\ntask<> f(const swtch &to)\n{\n    while (count++ < total_switch)\n    {\n        co_await to;\n    }\n}\nint main()\n{\n    swtch to[2];\n    task<> tasks[2] = {f(to[0]), f(to[1])};\n    to[0].target = task[1].get_handle();\n    to[1].target = task[0].get_handle();\n    \n    auto duration = hostTiming([&] {task[0].get_handle().resume(); });\n    \n}\n```\n\nå¾ªç¯å¯¹è®¡æ•°å™¨ç´¯åŠ ï¼Œæ¯æ¬¡éƒ½åˆ‡æ¢ä¸€æ¬¡åç¨‹ã€‚","categories":["æ“ä½œç³»ç»Ÿ","å¤šçº¿ç¨‹"]},{"title":"05_mprpc_rpcæ¡†æ¶","url":"/RPC/05_mprpc_rpcæ¡†æ¶/","content":"# æ— RPCçš„ä»£ç ï¼Œæ€ä¹ˆå‡çº§ä½¿ç”¨RPCæ¡†æ¶\nåœ¨`/example/callee`ä¸­çš„ä»£ç \n```cpp\n#include <iostream>\nclass UserService\n{\npublic:\n    bool Login(std::string name, std::string pwd)\n    {\n        std::cout << \"doing local service: Login\" << std::endl;\n        std::cout << \"name: \" << name << \", pwd: \" << pwd << std::endl;\n    }\n};\nint main()\n{\n    UserService us;\n    us.Login(\"xcg\", \"123456\");\n}\n```\nå¦‚ä¸Šï¼Œè¿™æ˜¯ç‹¬ç«‹çš„ä»£ç ï¼ŒUserServiceå¯ä»¥è¿›è¡ŒLoginå¤„ç†ã€‚ä½†æ˜¯å¦‚æœä¸ä½¿ç”¨RPCæ¡†æ¶ï¼Œåˆ™åªèƒ½åœ¨æœ¬åœ°è¢«è°ƒç”¨ã€‚\néœ€è¦æƒ³åŠæ³•ï¼Œèƒ½è®©è¿œç¨‹è°ƒç”¨ã€‚\n## ç¼–å†™user.proto\nåœ¨`/example/`ä¸­çš„ä»£ç \n```protobuf\nsyntax = \"proto3\";\npackage xcg;\noption cc_generic_services = true;\nmessage ResultCode\n{\n    int32 errcode = 1;\n    bytes errmsg = 2;\n}\nmessage LoginRequest\n{\n    bytes name = 1;\n    bytes pwd = 2;\n}\nmessage LoginResponse\n{\n    ResultCode result = 1;\n    bool success = 2;\n}\nservice UserServiceRpc\n{\n    rpc Login(LoginRequest) returns(LoginResponse);\n}\n```\nä½¿ç”¨protocç¼–è¯‘\n```bash\nprotoc user.proto --cpp_out=./\n```\næ¥ä¸‹æ¥ï¼Œå°±æ˜¯ä½¿ç”¨`user.pb.h`ã€‚\n## æœåŠ¡æä¾›è€…ç»§æ‰¿UserServiceRpcï¼Œå®ç°rpcè™šæ–¹æ³•ï¼Œä¸šåŠ¡å¤„ç†ï¼Œå“åº”\n```cpp\n// userservice.cc\n#include <iostream>\n#include \"user.pb.h\"\n// æœåŠ¡æä¾›è€…\nclass UserService : public xcg::UserServiceRpc\n{\npublic:\n    bool Login(std::string name, std::string pwd)\n    {\n        std::cout << \"doing local service: Login\" << std::endl;\n        std::cout << \"name: \" << name << \", pwd: \" << pwd << std::endl;\n    }\n    // é‡å†™åŸºç±»UserServiceRpcçš„è™šå‡½æ•°ã€‚è¿™äº›æ–¹æ³•éƒ½æ˜¯æ¡†æ¶ç›´æ¥è°ƒç”¨çš„\n    void Login(::google::protobuf::RpcController* controller,\n                       const ::xcg::LoginRequest* request,\n                       ::xcg::LoginResponse* response,\n                       ::google::protobuf::Closure* done)\n    {\n        // æ‹¿åˆ°äº†æ¡†æ¶ç»™ä¸ŠæŠ¥çš„è¯·æ±‚å‚æ•°LoginRequest\n        // éœ€è¦å–å‡ºç›¸åº”æ•°æ®åšæœ¬åœ°ä¸šåŠ¡\n        std::string name = request->name();\n        std::string pwd = request->pwd();\n        // å–å‡ºæ•°æ®åï¼Œè°ƒç”¨æœ¬èº«å·²æœ‰çš„æ–¹æ³•\n        bool login_result = Login(name, pwd);\n        // å¡«å†™å“åº”æ¶ˆæ¯\n        xcg::ResultCode * result_code = response->mutable_result();\n        result_code->set_errcode(0);\n        result_code->set_errmsg(\"ok!\");\n        response->set_success(login_result);\n        // æ‰§è¡Œå›è°ƒæ“ä½œï¼šç”±æ¡†æ¶done->Run()å¤„ç†æ¶ˆæ¯çš„åºåˆ—åŒ–ã€è¿”å›ä¼ è¾“\n        done->Run();\n    }\n};\n```\nè¿™äº›é‡å†™äº†çš„è™šå‡½æ•°ï¼Œåœ¨å“ªé‡Œè¢«è°ƒç”¨å‘¢ï¼Ÿè§[`google::protobuf::NewCallback<>`ç”Ÿæˆå›è°ƒå‡½æ•°](#`google%20protobuf%20NewCallback<>`ç”Ÿæˆå›è°ƒå‡½æ•°)\n## æœåŠ¡è°ƒç”¨æ–¹è°ƒç”¨UserServiceRpc_Stubé‡Œprotobufç»™æˆ‘ä»¬è‡ªåŠ¨å®ç°å¥½çš„rpcæ–¹æ³•\næ¯”å¦‚ï¼Œ`UserServiceRpc_Stub`çš„`Login`æ–¹æ³•ï¼Œæ˜¯ä½äº`user.pb.h`ä¸­çš„ã€‚\n\nè€ŒLoginçš„è°ƒç”¨æœ€ç»ˆä¼šè½åˆ°`UserServiceRpc_Stub`çš„`channel_`æˆå‘˜æ‰€å«çš„æ–¹æ³•`CallMethod`ã€‚\n\nè¦å®ä¾‹åŒ–`UserServiceRpc_Stub`ï¼Œéœ€è¦ä¸€ä¸ª`MprpcChannel`å¯¹è±¡æ¥ç»™å®ƒæ„é€ ï¼Œå¹¶ä¸”è¿™ä¸ª`MprpcChannel`è¦å®ç°`CallMethod`ã€‚\n\nè§[Mprpcchannelç±»](#Mprpcchannelç±»)ã€‚\n## æœåŠ¡è°ƒç”¨è€…ä¸»ç¨‹åºï¼ˆå¦‚calluserservice.ccï¼‰\nå®šä¹‰è¦è°ƒç”¨çš„æŸä¸ªæ–¹æ³•çš„requestï¼ˆå¦‚LoginRequestï¼‰ï¼Œå¡«å†™å‚æ•°ã€‚\n\nå®šä¹‰è¦è°ƒç”¨çš„æŸä¸ªæ–¹æ³•çš„responseï¼ˆå¦‚LoginResponseï¼‰ï¼Œä¸å¡«å†™å‚æ•°ã€‚\n\nå®šä¹‰`UserServiceRpc_Stub`ï¼Œé€šè¿‡`MprpcChannel()`å®ä¾‹åŒ–ã€‚\n\nä¹‹åé€šè¿‡stubå‘èµ·è¿œç¨‹è°ƒç”¨`Login`ã€‚\n```cpp\n#include <iostream>\n#include \"mprpcapplication.h\"\n#include \"user.pb.h\"\n#include \"mprpcchannel.h\"\nint main(int argc, char ** argv)\n{\n    // æ•´ä¸ªç¨‹åºå¯åŠ¨ä»¥åï¼Œæƒ³ä½¿ç”¨mprpcæ¡†æ¶æ¥äº«å—rpcæœåŠ¡è°ƒç”¨ï¼Œä¸€å®šéœ€è¦å…ˆè°ƒç”¨æ¡†æ¶çš„åˆå§‹åŒ–å‡½æ•°ï¼ˆåªåˆå§‹åŒ–ä¸€æ¬¡ï¼‰\n    MprpcApplication::Init(argc, argv);\n\n    // å¡«å†™rpcæ–¹æ³•çš„è¯·æ±‚å‚æ•°\n    xcg::LoginRequest request;\n    request.set_name(\"zhang san\");\n    request.set_pwd(\"123456\");\n    // å®šä¹‰rpcæ–¹æ³•çš„å“åº”\n    xcg::LoginResponse response;\n\n    // åº•å±‚è½¬åˆ°RpcChannel->CallMethodæ¥åšæ‰€æœ‰rpcæ–¹æ³•è°ƒç”¨çš„å‚æ•°åºåˆ—åŒ–å’Œç½‘ç»œå‘é€\n    xcg::UserServiceRpc_Stub stub(new MprpcChannel());\n\n    // å‘èµ·rpcæ–¹æ³•çš„è°ƒç”¨ã€‚\n    stub.Login(nullptr, &request, &response, nullptr);\n    \n    // ä¸€æ¬¡rpcè°ƒç”¨å®Œæˆï¼Œè¯»è°ƒç”¨çš„ç»“æœ\n    if (response.result().errcode() == 0)\n    {\n        // æˆåŠŸ\n        std::cout << \"rpc login response success: \" << response.success() << std::endl;\n    }\n    else\n    {\n        std::cout << \"rpc login response error: \" << response.result().errmsg() << std::endl;\n    }\n    return 0;\n}\n```\n## rpcæœåŠ¡æ¡†æ¶çš„å¯åŠ¨å…¥å£ï¼Ÿ\nrpcæœåŠ¡æ¡†æ¶ç”±å„ä¸ªæœåŠ¡èŠ‚ç‚¹ï¼ˆæœåŠ¡æä¾›è€…ï¼‰å¯åŠ¨ã€‚æ¯”å¦‚`UserService`ï¼Œç±»å¤–å®ç°ä¸€ä¸ªmainå‡½æ•°ï¼Œmainå‡½æ•°ä¸­è°ƒç”¨`MprpcApplication::Init(argc, argv)`è¿›è¡Œæ¡†æ¶ç›¸å…³çš„å¯åŠ¨ï¼Œæ¯”å¦‚è¯»é…ç½®æ–‡ä»¶ã€‚\nä¹‹åï¼Œå„ä¸ªæœåŠ¡èŠ‚ç‚¹ï¼ˆæœåŠ¡æä¾›è€…ï¼‰å¯ä»¥NotifyServiceå‘å¸ƒè‡ªå·±èŠ‚ç‚¹ä¸Šçš„æœåŠ¡åã€æ–¹æ³•åã€‚\nä¹‹åï¼Œå„ä¸ªæœåŠ¡èŠ‚ç‚¹è°ƒç”¨`Run`ï¼Œå¯åŠ¨æœåŠ¡èŠ‚ç‚¹ã€‚\n\n# æ¨¡æ‹Ÿrpcæ¡†æ¶çš„ä½¿ç”¨ï¼Œä»¥åˆ†ææ¡†æ¶éœ€è¦ä»€ä¹ˆä¸œè¥¿\n1. æ¡†æ¶éœ€è¦ä¸€ä¸ªåŸºç¡€ç±»ï¼Œè¿›è¡ŒInitåˆå§‹åŒ–ï¼Œä½¿ç”¨argcã€argvå‚æ•°ã€‚å› ä¸ºrpcæœåŠ¡å™¨æœ¬èº«æœ‰ipåœ°å€ã€ç«¯å£å·ï¼Œéœ€è¦zookeeperçš„ipåœ°å€ã€ç«¯å£å·ã€‚ä»é…ç½®æ–‡ä»¶è¯»ã€‚\n2. æ¡†æ¶éœ€è¦æä¾›ä¸€ä¸ªå¯ä»¥å‘å¸ƒæœåŠ¡çš„RpcProviderã€‚\n\n```cpp\n// userservice.ccçš„ä»£ç \n\n// class UserServiceçš„å®šä¹‰...\n// ...\n\n#include \"mprpcapplication.h\"\nint main(int argc, char ** argv)\n{\n    // æ¡†æ¶çš„åˆå§‹åŒ–æ“ä½œ\n    MprpcApplication::Init(argc, argv);\n        \n    // provideræ˜¯ä¸€ä¸ªrpcç½‘ç»œæœåŠ¡å¯¹è±¡ï¼Œè´Ÿè´£å‘å¸ƒæœåŠ¡åˆ°rpcèŠ‚ç‚¹ä¸Š\n    RpcProvider provider; \n    // æŠŠUserServiceå‘å¸ƒåˆ°rpcèŠ‚ç‚¹ä¸Š\n    provider.NotifyService(new UserService());\n    \n    // å¯åŠ¨ä¸€ä¸ªrpcæœåŠ¡å‘å¸ƒèŠ‚ç‚¹\n    provider.Run();\n    // ä¹‹åï¼Œè¿›ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç­‰å¾…è¿œç¨‹çš„rpcè°ƒç”¨è¯·æ±‚\n}\n```\n## MprpcApplicationç±»\nåœ¨`/src/include`ä¸­ç¼–å†™å¤´æ–‡ä»¶\n```cpp\n#pragma once\n// mprpc æ¡†æ¶çš„åŸºç¡€ç±»ï¼Œç”¨äºåˆå§‹åŒ–æ¡†æ¶\n// å•ä¾‹è®¾è®¡\nclass MprpcApplication\n{\npublic:\n    static void Init(int argc, char ** argv);\n    static MprpcApplication& GetInstance()\n    {\n        static MprpcApplication app;\n        return app;\n    }\nprivate:\n    MprpcApplication()\n    {\n\n    }\n    MprpcApplication(const MprpcApplication&) = delete;\n    MprpcApplication(MprpcApplication&&) = delete;\n};\n```\n## RpcProviderç±»\nåœ¨`/src/include`ä¸­ç¼–å†™å¤´æ–‡ä»¶\n```cpp\n#pragma once\n#include \"google/protobuf/service.h\"\n// æ¡†æ¶æä¾›çš„ä¸“é—¨å‘å¸ƒRPCæœåŠ¡çš„ç½‘ç»œå¯¹è±¡ç±»\nclass RpcProvider\n{\npublic:\n    // è¿™é‡Œæ˜¯æ¡†æ¶æä¾›ç»™å¤–éƒ¨ä½¿ç”¨çš„ï¼Œå¯ä»¥å‘å¸ƒService\n    void NotifyService(::google::protobuf::Service * service);\n    // å¯åŠ¨RPCæœåŠ¡èŠ‚ç‚¹\n    void Run();\n};\n```\n## CMakeLists.txt\n### æ ¹ç›®å½•\n```cmake\ncmake_minimum_required(VERSION 3.0)\nproject(mprpc)\n\nset(EXECUTABLE_OUTPUT_PATH ${PROJECT_SOURCE_DIR}/bin)\n\nset(LIBRARY_OUTPUT_PATH ${PROJECT_SOURCE_DIR}/lib)\n\ninclude_directories(${PROJECT_SOURCE_DIR}/src/include)\ninclude_directories(${PROJECT_SOURCE_DIR}/example)\nlink_directories(${PROJECT_SOURCE_DIR}/lib)\n\n# æ¡†æ¶çš„ä»£ç \nadd_subdirectory(src)\n# ä½¿ç”¨æ¡†æ¶çš„å®ä¾‹ä»£ç \nadd_subdirectory(example)\n```\n\nsrcç”Ÿæˆçš„ä»£ç å°±æ˜¯æ¡†æ¶çš„éƒ¨åˆ†ã€‚éœ€è¦ç”Ÿæˆä¸€ä¸ªå¯¹å¤–çš„soåº“ã€‚\n### srcç›®å½•\n```cmake\n# å½“å‰æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰æ–‡ä»¶ åˆ«å SRC_LIST\naux_source_directory(. SRC_LIST)\n# ç”ŸæˆåŠ¨æ€åº“\nadd_library(mprpc SHARED ${SRC_LIST})\n```\n### exampleç›®å½•\n```cmake\nadd_subdirectory(callee)\n```\n### example/calleeç›®å½•\n```cmake\nset(SRC_LIST userservice.cc ../user.pb.cc)\n\nadd_executable(provider ${SRC_LIST})\n# å£°æ˜ç¼–è¯‘æ—¶éœ€è¦é“¾æ¥mprpcã€protobufåŠ¨æ€åº“\ntarget_link_libraries(provider mprpc protobuf)\n```\n# æµç¨‹\n\n1. ç¼–å†™protobufæ–‡ä»¶ï¼Œä½œä¸ºåè®®ï¼›\n2. ç»§æ‰¿rpcæœåŠ¡ç±»ã€‚å®ç°rpcæ–¹æ³•ã€‚\n    1. è·å–è¯·æ±‚ä½“çš„å‚æ•°\n    2. æœ¬åœ°å¤„ç†ä¸šåŠ¡\n    3. å†™å…¥å“åº”ä½“\n    4. æ‰§è¡Œå›è°ƒæ“ä½œï¼Œå®Œæˆå“åº”æ•°æ®çš„åºåˆ—åŒ–ï¼Œè¿›è¡Œå‘é€å“åº”ã€‚\n3. å‘å¸ƒæœåŠ¡ï¼Œå¯åŠ¨æœåŠ¡\n    1. åˆå§‹åŒ–æ¡†æ¶\n    2. å®šä¹‰å‘å¸ƒrpcæœåŠ¡çš„å¯¹è±¡ï¼ˆproviderï¼‰\n    3. å¯åŠ¨rpcæœåŠ¡å‘å¸ƒèŠ‚ç‚¹ã€‚\n4. æœåŠ¡ç¨‹åºè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œæ¥å—è¿œç¨‹rpcè°ƒç”¨è¯·æ±‚ã€‚\n# rpcæ¡†æ¶çš„ç¼–å†™\n\n## MprpcApplicationç±»\nä¸»è¦éœ€è¦å®ç°Initå‡½æ•°ã€‚\nä¸»è¦ç”¨äºä½¿ç”¨å¤–éƒ¨å‘½ä»¤è¡Œä¼ å…¥çš„å‚æ•°ï¼Œä»¥åŠè¯»å–å‚æ•°ä¸­çš„é…ç½®æ–‡ä»¶ï¼Œè¿›è¡Œåˆå§‹åŒ–ã€‚\n\n1. å¯ä»¥å•ç‹¬å°è£…ä¸€ä¸ªMprpcConfigç±»ã€‚MprpcApplicationç±»ä½¿ç”¨å®ƒè¿›è¡Œconfigçš„è¯»å–ã€‚\n2. Initåªéœ€è¦è¿›è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥å°†MprpcApplicationè®¾è®¡ä¸ºå•ä¾‹æ¨¡å¼ã€‚\n3. ç”±äºInitæ˜¯é™æ€æ–¹æ³•ï¼ŒInitæ–¹æ³•ä½¿ç”¨åˆ°äº†ç±»å†…å¯¹è±¡MprpcConfigï¼Œå› æ­¤MprpcConfigæˆå‘˜éœ€è¦å£°æ˜ä¸ºstaticã€‚\n\n```cpp\n// mprpcapplication.h\n#pragma once\n#include \"mprpcconfig.h\"\n// mprpc æ¡†æ¶çš„åŸºç¡€ç±»ï¼Œç”¨äºåˆå§‹åŒ–æ¡†æ¶\n// å•ä¾‹è®¾è®¡\nclass MprpcApplication\n{\npublic:\n    static void Init(int argc, char ** argv);\n    static MprpcApplication& GetInstance();\nprivate:\n    static MprpcConfig m_config;\n    MprpcApplication()\n    {\n\n    }\n    MprpcApplication(const MprpcApplication&) = delete;\n    MprpcApplication(MprpcApplication&&) = delete;\n};\n```\n### å®ç°\n1. ShowArgsHelpå‡½æ•°ç”¨äºæç¤ºç”¨æˆ·æ­£ç¡®çš„å‘½ä»¤è¡Œå‚æ•°æ ¼å¼\n2. Initå‡½æ•°ä¸»è¦å®ç°\n    1. æ£€æŸ¥å‚æ•°æ ¼å¼\n    2. é€šè¿‡getoptæ‹¿åˆ°å‚æ•°\n    3. è°ƒç”¨MprpcConfigæˆå‘˜çš„LoadConfigFileæ–¹æ³•è§£æé…ç½®æ–‡ä»¶çš„ä¿¡æ¯ï¼Œå³è·å–rpcæœåŠ¡å™¨å’Œzookeeperçš„ipã€ç«¯å£\n\n```cpp\n// mprpcapplication.cc\n#include \"mprpcapplication.h\"\n#include <iostream>\n#include <unistd.h>\nMprpcConfig MprpcApplication::m_config;\nMprpcApplication& MprpcApplication::GetInstance()\n{\n    static MprpcApplication app;\n    return app;\n}\n\nvoid ShowArgsHelp()\n{\n    std::cout << \"format: commad -i <configfile>\" << std::endl;\n}\n// ç±»å¤–å®ç°é™æ€æ–¹æ³•ï¼Œä¸ç”¨å‰é¢åŠ static\nvoid MprpcApplication::Init(int argc, char ** argv)\n{\n    if (argc < 2)\n    {\n        ShowArgsHelp();\n        exit(EXIT_FAILURE);\n    }\n    int c = 0;\n    std::string config_file;\n    while((c = getopt(argc, argv, \"i:\")) != -1)\n    {\n        switch (c)\n        {\n        case 'i':\n            // è·å–åˆ°é…ç½®æ–‡ä»¶çš„åå­—\n            config_file = optarg;\n            break;\n        case '?':\n            // std::cout << \"invalid args!\" << std::endl;\n            ShowArgsHelp();\n            exit(EXIT_FAILURE);\n        case ':':\n            // std::cout << \"need <configfile>!\" << std::endl;\n            ShowArgsHelp();\n            exit(EXIT_FAILURE);\n        default:\n            break;\n        }\n    }\n    // å¼€å§‹åŠ è½½é…ç½®æ–‡ä»¶ rpcserver_ip rpcserver_port zookeeper_ip zookeeper_port\n    m_config.LoadConfigFile(config_file.c_str());\n\n    std::cout << \"rpcserver_ip: \" << m_config.Load(\"rpcserver_ip\") << std::endl;\n    std::cout << \"rpcserver_port: \" << m_config.Load(\"rpcserver_port\") << std::endl;\n    std::cout << \"zookeeper_ip: \" << m_config.Load(\"zookeeper_ip\") << std::endl;\n    std::cout << \"zookeeper_port: \" << m_config.Load(\"zookeeper_port\") << std::endl;\n}\n```\nè‹¥æµ‹è¯•çš„æ˜¯[æ³¨æ„è¯»å–é…ç½®æ–‡ä»¶å¯èƒ½å‡ºç°çš„ç©ºæ ¼ã€æ³¨é‡Šã€æ— æ•ˆä¿¡æ¯é—®é¢˜](#æ³¨æ„è¯»å–é…ç½®æ–‡ä»¶å¯èƒ½å‡ºç°çš„ç©ºæ ¼ã€æ³¨é‡Šã€æ— æ•ˆä¿¡æ¯é—®é¢˜) ä¸­çš„é…ç½®æ–‡ä»¶ï¼Œæ­£ç¡®ç»“æœï¼š\n```bash\nmrcan@ubuntu:~/mprpc/bin$ ./provider -i test.conf \nrpcserver_ip: 127.0.0.1\nrpcserver_port: 8000\nzookeeper_ip: 127.0.0.1\nzookeeper_port: 5000\n```\n## MprpcConfigç±»\n1. æä¾›LoadConfigFileæ–¹æ³•ï¼Œè´Ÿè´£è§£æåŠ è½½é…ç½®æ–‡ä»¶ï¼Œå°†keyã€valueæ’å…¥åˆ°è‡ªèº«çš„mapä¸­\n2. æä¾›Loadæ–¹æ³•ï¼Œå¯ä»¥å¯¹å¤–æä¾›æŸ¥è¯¢keyè¯»å–valueã€‚\n3. éœ€è¦é›†æˆä¸€ä¸ª`unordered_map`è®°å½•keyã€valueã€‚\n4. Trimè´Ÿè´£åœ¨è§£æé…ç½®æ–‡ä»¶è¿‡ç¨‹ä¸­é™¤å»å­—ç¬¦ä¸²å‰åçš„ç©ºæ ¼ã€‚\n\n```cpp\n#pragma once\n#include <unordered_map>\n#include <string>\nclass MprpcConfig\n{\npublic:\n    // è´Ÿè´£è§£æåŠ è½½é…ç½®æ–‡ä»¶\n    void LoadConfigFile(const char * config_file);\n    // æŸ¥è¯¢é…ç½®é¡¹ä¿¡æ¯\n    std::string Load(const std::string& key);\nprivate:\n    std::unordered_map<std::string, std::string> m_configMap;\n    // å»æ‰å­—ç¬¦ä¸²å‰åçš„ç©ºæ ¼\n    void Trim(std::string &str_buf);\n};\n```\n### æ³¨æ„è¯»å–é…ç½®æ–‡ä»¶å¯èƒ½å‡ºç°çš„ç©ºæ ¼ã€æ³¨é‡Šã€æ— æ•ˆä¿¡æ¯é—®é¢˜\n```conf\n      # rpc node ip\n  \n   rpcserver_ip        =   127.0.0.1        \n\n\n        # rpc node port\n      rpcserver_port     =     8000  \n\n\n\n    # zookeeper ip\n            zookeeper_ip   =127.0.0.1       \n\n# zookeeper port\n  zookeeper_port= 5000    \n\n\n```\nå¦‚ä¸Šï¼Œé…ç½®æ–‡ä»¶å¯èƒ½æœ‰ï¼š\n1. æ³¨é‡Š\n2. çº¯ç©ºè¡Œçš„æ¢è¡Œç¬¦å¯ä»¥ç”¨getsè¿‡æ»¤\n3. é…ç½®é¡¹ï¼Œä»¥=åˆ†éš”ï¼Œå‰é¢æ˜¯keyï¼Œåé¢æ˜¯valueï¼Œå¯èƒ½å‰åå„æœ‰ç©ºæ ¼\n    1. keyå‰åçš„ç©ºæ ¼å¯é€šè¿‡Trimå¤„ç†ï¼Œåé¢è‚¯å®šæ²¡æœ‰æ¢è¡Œç¬¦ã€‚\n    2. valueåªèƒ½ç”¨Trimå¤„ç†å‰é¢çš„ç©ºæ ¼ï¼Œå› ä¸ºåé¢å¯èƒ½å­˜åœ¨`ç©ºæ ¼æˆ–æ¢è¡Œç¬¦`ï¼š\n        1. `5000\\n`ï¼šå³æ²¡æœ‰ç©ºæ ¼ï¼Œæœ‰ä¸€ä¸ªæ¢è¡Œç¬¦\n        2. `5000      \\n`ï¼šå³æœ‰ç©ºæ ¼ï¼Œæœ‰æ¢è¡Œç¬¦\n        3. æ‰€ä»¥éœ€è¦å…ˆå»æ‰æœ«å°¾çš„æ¢è¡Œç¬¦ï¼Œå†è¿›è¡ŒTrimå¤„ç†ã€‚\n### å®ç°\n```cpp\n#include \"mprpcconfig.h\"\n#include <iostream>\nvoid MprpcConfig::Trim(std::string &str_buf)\n{\n    // å»æ‰å­—ç¬¦ä¸²å‰é¢å¤šä½™çš„ç©ºæ ¼\n    int idx = str_buf.find_first_not_of(' ');\n    if (idx > 0)\n    {\n        // è¯´æ˜å­—ç¬¦ä¸²å‰é¢æœ‰ç©ºæ ¼\n        str_buf = str_buf.substr(idx, str_buf.size() - idx);\n    }\n    // å»æ‰å­—ç¬¦ä¸²åé¢å¤šä½™çš„ç©ºæ ¼\n    idx = str_buf.find_last_not_of(' ');\n    str_buf = str_buf.substr(0, idx + 1);\n}\nvoid MprpcConfig::LoadConfigFile(const char * config_file)\n{\n    FILE *pf = fopen(config_file, \"r\");\n    if (nullptr == pf)\n    {\n        std::cout << config_file << \" not exist!\" << std::endl;\n        exit(EXIT_FAILURE);\n    }\n    // 1. æ³¨é‡Š\n    // 2. å¤šä½™çš„ç©ºæ ¼\n    // 3. æ­£ç¡®çš„é…ç½®é¡¹ï¼ˆä»¥=åˆ†éš”çš„ï¼‰\n    while (!feof(pf))\n    {\n        char buf[512] = {0};\n        fgets(buf, 512, pf);\n        std::string str_buf(buf);\n        Trim(str_buf);\n\n        // åˆ¤æ–­ # å¼€å¤´çš„æ³¨é‡Š æˆ–è€…çº¯ç©ºè¡Œ\n        if (str_buf[0] == '#' || str_buf.empty())\n        {\n            continue;\n        }\n        int idx = str_buf.find('=');\n        if (idx == -1 || idx == 0)\n        {\n            // é…ç½®é¡¹ä¸åˆæ³•\n            continue;\n        }\n        std::string key;\n        std::string value;\n        key = str_buf.substr(0, idx);\n        // å»æ‰å‰åçš„ç©ºæ ¼\n        Trim(key);\n\n\n        // å»æ‰æœ«å°¾çš„æ¢è¡Œç¬¦\n        int lineBreakIdx = str_buf.find('\\n', idx + 1);\n        value = str_buf.substr(idx + 1, lineBreakIdx - (idx + 1));\n        // å»æ‰å‰åçš„ç©ºæ ¼\n        Trim(value);\n\n        m_configMap.insert({key, value});\n    }\n}\nstd::string MprpcConfig::Load(const std::string& key)\n{\n    auto it = m_configMap.find(key);\n    if (it == m_configMap.end())\n    {\n        return \"\";\n    }\n    return it->second;\n}\n```\n## ä¿®æ”¹MprpcApplication\nå‘å…¶ä¸­æ·»åŠ ä¸€ä¸ªå…¬æœ‰staticæ–¹æ³•`GetConfig()`ä»¥ä¾¿RpcProviderè·å¾—configå¯¹è±¡\n```cpp\n#pragma once\n#include \"mprpcconfig.h\"\n// mprpc æ¡†æ¶çš„åŸºç¡€ç±»ï¼Œç”¨äºåˆå§‹åŒ–æ¡†æ¶\n// å•ä¾‹è®¾è®¡\nclass MprpcApplication\n{\npublic:\n    static void Init(int argc, char ** argv);\n    static MprpcApplication& GetInstance();\n    // ä»¥ä¾¿RpcProviderè·å¾—configå¯¹è±¡\n    static MprpcConfig& GetConfig();\nprivate:\n    static MprpcConfig m_config;\n    MprpcApplication()\n    {\n\n    }\n    MprpcApplication(const MprpcApplication&) = delete;\n    MprpcApplication(MprpcApplication&&) = delete;\n};\n```\n## RpcProviderç±»\næ ¹æ®[[#æ¨¡æ‹Ÿrpcæ¡†æ¶çš„ä½¿ç”¨ï¼Œä»¥åˆ†ææ¡†æ¶éœ€è¦ä»€ä¹ˆä¸œè¥¿]]ï¼Œæ¡†æ¶éœ€è¦æä¾›ä¸€ä¸ªå¯ä»¥å‘å¸ƒæœåŠ¡çš„RpcProviderã€‚\nä¸»è¦å®ç°ï¼š\n1. NotifyServiceï¼Œæ˜¯æ¡†æ¶æä¾›ç»™å¤–éƒ¨ä½¿ç”¨çš„ï¼Œå¯ä»¥å‘å¸ƒService\n2. Runï¼Œå¯åŠ¨RPCæœåŠ¡èŠ‚ç‚¹\n3. Stopï¼Œåœæ­¢æœåŠ¡\n\néœ€è¦é›†æˆä¸€ä¸ªTcpServerï¼Œå’Œæ­é…ä¸€ä¸ªEventloopï¼ˆç›¸å½“äºepollï¼‰ã€‚\nä½†æ˜¯ç»è¿‡è€ƒè™‘ï¼ŒTcpServeræ²¡æœ‰å¿…è¦å†™ä¸ºRpcProviderçš„æˆå‘˜å˜é‡ï¼Œå› ä¸ºåªåœ¨Runæ–¹æ³•ä¸­ä½¿ç”¨ã€‚è€Œä¸”æˆ‘ä»¬æä¾›çš„æ˜¯ä¸€ä¸ªå¯¹å¤–çš„æ¡†æ¶ï¼Œæœ€å¥½ä¸è¦æŠŠTcpServerçš„é…ç½®ã€å¤æ‚çš„å‚æ•°æš´éœ²ç»™ç”¨æˆ·ï¼Œå°½é‡è®©ç”¨æˆ·ç®€å•æ˜“ç”¨ã€‚\nè€ŒEventLoopå¯èƒ½ä¸ä»…Runä½¿ç”¨ï¼ŒStopè¿˜éœ€è¦è°ƒç”¨å®ƒçš„quitã€‚æ‰€ä»¥å®šä¹‰ä¸ºæˆå‘˜å˜é‡ã€‚\n```cpp\n#pragma once\n#include \"google/protobuf/service.h\"\n#include <muduo/net/TcpServer.h>\n#include <muduo/net/EventLoop.h>\n#include <muduo/net/InetAddress.h>\n// æ¡†æ¶æä¾›çš„ä¸“é—¨å‘å¸ƒRPCæœåŠ¡çš„ç½‘ç»œå¯¹è±¡ç±»\nclass RpcProvider\n{\npublic:\n    // è¿™é‡Œæ˜¯æ¡†æ¶æä¾›ç»™å¤–éƒ¨ä½¿ç”¨çš„ï¼Œå¯ä»¥å‘å¸ƒService\n    void NotifyService(::google::protobuf::Service * service);\n    // å¯åŠ¨RPCæœåŠ¡èŠ‚ç‚¹\n    void Run();\nprivate:\n    muduo::net::EventLoop m_eventLoop;\n    // æ–°çš„socketè¿æ¥å›è°ƒ\n    void onConnection(const muduo::net::TcpConnectionPtr&);\n    // å·²å»ºç«‹è¿æ¥çš„ç”¨æˆ·çš„è¯»å†™äº‹ä»¶å›è°ƒ\n    // std::function<void (const TcpConnectionPtr&, Buffer*, Timestamp)>\n    void onMessage(const muduo::net::TcpConnectionPtr&, muduo::net::Buffer*, muduo::Timestamp);\n};\n```\n### Runå®ç°\nRunä¸»è¦å®ç°TcpServerçš„é…ç½®ã€å¯åŠ¨ã€‚\nè¿™å±äºRpcProviderçš„ç½‘ç»œæ¨¡å—ã€‚\n```cpp\n#include \"rpcprovider.h\"\n#include \"mprpcapplication.h\"\n#include <functional>\nvoid RpcProvider::Run()\n{\n    std::string ip = MprpcApplication::GetInstance().GetConfig().Load(\"rpcserver_ip\");\n    uint16_t port = atoi(MprpcApplication::GetInstance().GetConfig().Load(\"rpcserver_port\").c_str());\n    muduo::net::InetAddress address(ip, port);\n    // åˆ›å»ºTcpServerå¯¹è±¡\n    muduo::net::TcpServer server(&m_eventLoop, address, \"RpcProvider\");\n    // ç»‘å®šè¿æ¥å›è°ƒå’Œæ¶ˆæ¯è¯»å†™å›è°ƒæ–¹æ³• - åˆ†ç¦»ç½‘ç»œä»£ç å’Œä¸šåŠ¡ä»£ç \n    // éœ€è¦ç»™TcpServeræä¾›ä¸€ä¸ªè¿”å›å€¼ä¸ºvoidï¼Œå‚æ•°æœ‰TcpConnectionPtrçš„å‡½æ•°\n    // è¿™ä¸ªå‡½æ•°æˆ‘ä»¬åœ¨RpcProviderçš„æˆå‘˜æ–¹æ³•æä¾›\n    // å®é™…ä¸Šï¼ŒonConnectionåˆ°æ—¶å€™ç”±muduoåº“è¿›è¡Œè°ƒç”¨\n    // è°ƒç”¨çš„å°±æ˜¯thiså¯¹è±¡ï¼Œç„¶åéœ€è¦ä¸€ä¸ª_1ä»¥é¢„ç•™TcpConnectionPtr& connè¿™ä¸ªå‚æ•°çš„ä½ç½®\n    // std::function<void (const TcpConnectionPtr&)>\n    server.setConnectionCallback(std::bind(&RpcProvider::onConnection, this, std::placeholders::_1));\n    // std::function<void (const TcpConnectionPtr&, Buffer*, Timestamp)>\n    server.setMessageCallback(std::bind(&RpcProvider::onMessage, this, \n        std::placeholders::_1, std::placeholders::_2, std::placeholders::_3));\n\n    // è®¾ç½®muduoåº“çš„çº¿ç¨‹æ•°é‡\n    server.setThreadNum(4);\n\n    std::cout << \"RpcProvider Start Service at IP: \" << ip << \", port: \" << port << std::endl;\n\n    // å¯åŠ¨ç½‘ç»œæœåŠ¡\n    server.start();\n    // å¯åŠ¨epoll_waitï¼Œä»¥é˜»å¡çš„æ–¹å¼ç­‰å¾…è¿œç¨‹çš„è¿æ¥ã€‚\n    // å¦‚æœæœ‰è¿æ¥è¯·æ±‚ï¼Œåˆ™muduoåº“ä¼šå›è°ƒonConnection\n    // å¦‚æœæœ‰æ”¶å‘æ•°æ®è¯·æ±‚ï¼Œåˆ™muduoåº“ä¼šå›è°ƒonMessage\n    m_eventLoop.loop();\n}\n```\n### NotifyServiceçš„å®ç°\nå‘å¸ƒRpcæœåŠ¡ã€‚\næ˜¯`/example/callee/`ä¸‹çš„å¦‚UserServiceç¨‹åºè°ƒç”¨çš„ã€‚\nï¼ˆé›†æˆçš„muduoç½‘ç»œåº“å®ç°äº†ï¼šä¸å…‰èƒ½è°ƒç”¨æœ¬åœ°çš„RpcProviderï¼Œè€Œæ˜¯å¯ä»¥è¿œç¨‹è°ƒç”¨ç½‘ç»œä¸Šçš„ä»»æ„ä¸€ä¸ªRpcProviderï¼‰\n\næ€ä¹ˆåšåˆ°â€œå‘å¸ƒâ€ï¼Ÿâ€œå‘å¸ƒâ€çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿå…¶å®æ˜¯è®°å½•åœ¨æ¡ˆï¼Œæ–¹ä¾¿è¿œç«¯æŸ¥è¯¢ï¼Œå¹¶ä¸”å®šä½æŸä¸ªæ–¹æ³•ã€‚\né‚£ä¹ˆæˆ‘ä»¬å°±è¦åœ¨RpcProviderç±»ä¸­å¢åŠ ï¼š`m_serviceMap`ï¼Œè®°å½•æ³¨å†Œçš„æ¯ä¸€ä¸ªserviceåå­—å’Œè¿™ä¸ªserviceå¯¹åº”çš„æ‰€æœ‰ï¼ˆnä¸ªï¼‰methodã€‚\n```cpp\n#pragma once\n#include \"google/protobuf/service.h\"\n#include <unordered_map>\n// æ¡†æ¶æä¾›çš„ä¸“é—¨å‘å¸ƒRPCæœåŠ¡çš„ç½‘ç»œå¯¹è±¡ç±»\nclass RpcProvider\n{\npublic:\n    // ...\nprivate:\n    struct ServiceInfo\n    {\n        google::protobuf::Service * m_service;\n        std::unordered_map<std::string, const google::protobuf::MethodDescriptor*> m_methodMap;\n    };\n    std::unordered_map<std::string, ServiceInfo> m_serviceMap;\n\n    // ...\n};\n```\nå½“è¿œç«¯ä¸€ä¸ªServiceæœåŠ¡å™¨ï¼ˆæ¯”å¦‚UserServiceï¼‰è°ƒç”¨RpcProviderçš„NotifyServiceæ—¶ï¼Œä¾¿åœ¨é‡Œé¢è®°å½•ä¿¡æ¯ï¼Œè¿™å°±æ˜¯æ³¨å†Œï¼Œå°±æ˜¯å‘å¸ƒã€‚\næˆ‘ä»¬å¯ä»¥ï¼š\n1. é€šè¿‡è¿œç«¯ä¼ å…¥çš„ServiceæŒ‡é’ˆï¼Œ`service->GetDescriptor()`è·å¾—æœåŠ¡æè¿°ç¬¦`ServiceDescriptor *`ï¼Œ\n2. ä»è€Œè·å¾—æœåŠ¡çš„åå­—`name()`å’Œæ–¹æ³•çš„æ•°é‡`method_count()`ã€æ¯ä¸€ä¸ªæ–¹æ³•çš„æè¿°ç¬¦`MethodDescriptor*`ï¼Œ\n3. ä»è€Œè·å¾—æ¯ä¸€ä¸ªæ–¹æ³•çš„åå­—`name()`ã€‚\n\n* æŠŠæ‰€æœ‰æ–¹æ³•çš„åå­—ã€æ–¹æ³•çš„æè¿°ç¬¦è®°å½•åœ¨`m_methodMap`ä¸­ã€‚\n* æŠŠæœåŠ¡æè¿°ç¬¦å’Œ`m_methodMap`å°è£…åœ¨`ServiceInfo`ç»“æ„ä½“ä¸­ã€‚\n* ä¹‹åï¼ŒæŠŠæœåŠ¡çš„åå­—å’Œè¿™ä¸ª`ServiceInfo`ä½œä¸ºé”®å€¼å¯¹æ’å…¥åˆ°`m_serviceMap`ä¸­ã€‚\n\néœ€è¦å¼•å…¥`<google/protobuf/descriptor.h>`\n```cpp\n#include \"rpcprovider.h\"\n#include \"mprpcapplication.h\"\n#include <functional>\n#include <google/protobuf/descriptor.h>\nvoid RpcProvider::NotifyService(::google::protobuf::Service * service)\n{\n    const google::protobuf::ServiceDescriptor * pserviceDesc = service->GetDescriptor();\n\n    ServiceInfo service_info;\n    service_info.m_service = service;\n    int methodCnt = pserviceDesc->method_count();\n    for(int i = 0; i < methodCnt; ++i)\n    {\n        // è¯¥æ–¹æ³•å®šä¹‰äºServiceDescriptor\n        // const MethodDescriptor* method(int index) const; \n        // è¿”å›çš„æ˜¯ä¸€ä¸ªMethodDescriptor*\n        // è·å–äº†æœåŠ¡å¯¹è±¡æŒ‡å®šä¸‹æ ‡çš„rpcæœåŠ¡æ–¹æ³•çš„æè¿°\n        const google::protobuf::MethodDescriptor* pmethodDesc = pserviceDesc->method(i);\n        std::string method_name = pmethodDesc->name();\n        std::cout << i << \". method_name: \" << method_name << std::endl;\n        service_info.m_methodMap.insert({method_name, pmethodDesc});\n    }\n    \n    std::string service_name = pserviceDesc->name();\n    std::cout << \"service_name: \" << service_name << std::endl;\n    m_serviceMap.insert({service_name, service_info});\n}\n```\n### OnConnection\nåœ¨æœ‰æ–°çš„è¯·æ±‚æ—¶ï¼Œä¼šè§¦å‘OnConnectionå›è°ƒï¼Œç”¨äºå¤„ç†è¿æ¥åçš„æ“ä½œã€‚OnConnectionçš„é€šçŸ¥è°ƒç”¨ä¸æ˜¯ç”¨æˆ·è°ƒç”¨çš„ï¼Œè€Œæ˜¯muduoåº“è‡ªåŠ¨è°ƒç”¨çš„ã€‚\næˆ‘ä»¬æš‚æ—¶ä¸ç”¨å¤„ç†ä»€ä¹ˆå·¥ä½œã€‚åªæ˜¯åˆ¤æ–­ä¸€ä¸‹è¿æ¥çŠ¶æ€æ˜¯å¦æ­£å¸¸ï¼Œå¦‚æœæ–­å¼€äº†åˆ™ä¸»åŠ¨closeã€‚\n```cpp\n// æ–°çš„socketè¿æ¥å›è°ƒ\nvoid RpcProvider::onConnection(const muduo::net::TcpConnectionPtr& conn)\n{\n    if (!conn->connected())\n    {\n        conn->shutdown();\n    }\n}\n```\nrpcçš„è¿æ¥æ˜¯çŸ­è¿æ¥ï¼Œå®¢æˆ·ç«¯è¯·æ±‚ã€æœåŠ¡ç«¯å“åº”ä¹‹åï¼ŒæœåŠ¡ç«¯å°±ä¼šä¸»åŠ¨å…³é—­è¿æ¥ã€‚\n### OnMessage\næ¶ˆæ¯æ˜¯å­—èŠ‚æµçš„ã€‚\n```\n// æ¡†æ¶å†…éƒ¨ï¼ŒRpcProviderå’ŒRpcConsumeråå•†å¥½é€šä¿¡ç”¨çš„protobufæ•°æ®ç±»å‹\n// è¯·æ±‚æ—¶éœ€è¦æä¾› service_name method_name args\n// éœ€è¦å¤„ç†åŒ…å†…çš„ç²˜åŒ…é—®é¢˜ï¼Œæ¯”å¦‚ï¼šUserServiceå’ŒLoginä»¥åŠargsåœ¨ä¸€èµ·ï¼Œæ— æ³•åŒºåˆ†\n// å› æ­¤éœ€è¦header_size + header_str + argsï¼Œå…ˆæŠŠåå­—éƒ¨åˆ†å’Œå‚æ•°éƒ¨åˆ†åŒºåˆ†å¼€\n// è¦æ³¨æ„éœ€è¦åŒºåˆ†argså’Œä¸‹ä¸€ä¸ªè¯·æ±‚åŒ…çš„ åŒ…å¤–ç²˜åŒ…é—®é¢˜ï¼Œéœ€è¦åœ¨header_strä¸­è®°å½•args_size\n// å¯ä»¥é€šè¿‡protobufå®šä¹‰è¿™ä¸ªRpcHeaderçš„messageç±»å‹ï¼Œæ ¹æ®ä¸Šè¿°è®¾è®¡ï¼ŒåŒ…å«äº†service_nameã€method_nameã€args_size\n// header_sizeæŒ‡çš„æ˜¯RpcHeaderè¿™ä¸ªmessageåŒ…çš„å­—ç¬¦ä¸²é•¿åº¦\n// header_sizeï¼ˆuint32_t å¤§å°ä¸ªå­—èŠ‚ï¼‰\n```\n#### å®šä¹‰rpcheader.proto\nåœ¨srcä¸‹å®šä¹‰æ­¤æ–‡ä»¶ï¼ˆ`rpcheader.proto`ï¼‰\n```protobuf\nsyntax = \"proto3\";\n\npackage mprpc;\n\nmessage RpcHeader\n{\n    bytes service_name = 1;\n    bytes method_name = 2;\n    uint32 args_size = 3;\n}\n```\nä¹‹ååœ¨æ­¤ç›®å½•ä¸‹ç”¨protocå‘½ä»¤ç”Ÿæˆccå’Œhæ–‡ä»¶ã€‚\n```sh\nprotoc rpcheader.proto --cpp_out=./\n```\n\n#### rpcprovider.ccå¼•å…¥rpcheader.pb.hï¼Œåšè¯»å–ã€è§£æå·¥ä½œ\n1. è§£ææ¥æ”¶åˆ°çš„å­—ç¬¦æµ`recv_buf`ä¸­çš„å†…å®¹ã€‚\n    1. å–å‡ºå‰4ä¸ªå­—èŠ‚ï¼ˆ`sizeof uint32_t`ï¼‰ï¼Œå³`header_size`ã€‚ï¼ˆ`header_size`æŒ‡çš„æ˜¯RpcHeaderè¿™ä¸ªmessageåŒ…çš„å­—ç¬¦ä¸²é•¿åº¦ï¼ŒåŒ…å«äº†`service_name`ã€`method_name`ã€`args_size`ä¿¡æ¯ï¼‰ã€‚å“åº”ç«¯é€šè¿‡stringçš„`copy`æ–¹æ³•è¯»å‡ºï¼ˆç›¸åº”çš„å†™å…¥æ–¹æ³•æ˜¯insertæ–¹æ³•ï¼Œæ˜¯è¯·æ±‚ç«¯å¡«å†™çš„ï¼‰ã€‚\n    2. è·å–äº†`header_size`ä¹‹åï¼Œåœ¨`recv_buf`å–å‡º4å­—èŠ‚ä¹‹åçš„`header_size`é•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œå­˜å…¥`rpc_header_str`ã€‚\n    3. ç”¨protobufç”Ÿæˆçš„RpcHeaderçš„ParseFromStringæ–¹æ³•å³å¯è§£æ`rpc_header_str`ï¼Œå¡«å…¥äº†RpcHeaderå¯¹è±¡ã€‚å†è°ƒç”¨RpcHeaderå¯¹è±¡æ–¹æ³•`service_name()`ã€`method_name()`ã€`args_size()`å³å¯è¯»å‡ºè§£æåˆ°çš„æ•°æ®ã€‚\n    4. ä¹‹åï¼Œrecv_bufçš„`4å­—èŠ‚ + header_size`ä¹‹åçš„`args_size`é•¿åº¦çš„å­—ç¬¦ä¸²å°±æ˜¯argsçš„æ•°æ®ã€‚å¯ä»¥åŒä¸Šè¿°æ–¹æ³•è§£æå‡ºå†…å®¹ã€‚\n\néœ€è¦å¼•å…¥`\"rpcheader.pb.h\"`\n```cpp\nvoid RpcProvider::onMessage(const muduo::net::TcpConnectionPtr& conn, muduo::net::Buffer* buffer, muduo::Timestamp timestamp)\n{\n    // æ¥æ”¶åˆ°çš„rpcè°ƒç”¨è¯·æ±‚çš„å­—ç¬¦æµ\n    // åŒ…å«äº†æ–¹æ³•åã€å‚æ•°\n    std::string recv_buf = buffer->retrieveAllAsString();\n    // ä»å­—ç¬¦æµä¸­è¯»å–å‰4ä¸ªå­—èŠ‚çš„header_sizeï¼ˆå³æŒ‰å†…å­˜ä¸­åŸæ¥çš„2è¿›åˆ¶è¯»å–ï¼‰\n    // æœ‰ç›¸åº”çš„stringæ–¹æ³•ï¼šinsertã€copyï¼Œæ˜¯æŒ‰2è¿›åˆ¶å†™å…¥ã€è¯»å–å›ºå®šå­—èŠ‚çš„æ•°æ®ï¼Œè€Œä¸æ˜¯ç›´æ¥æŠŠæ•°å­—å­˜ä¸ºé•¿åº¦ä¸ä¸€çš„å­—ç¬¦ä¸²ã€‚\n    uint32_t header_size = 0;\n    // ä»recv_bufçš„ 0 ä½ç½®å¼€å§‹ï¼Œè¯»å–uint32_t å¤§å°ä¸ªå­—èŠ‚ï¼Œå­˜å…¥header_sizeã€‚\n    recv_buf.copy((char*)&header_size, sizeof(uint32_t), 0);\n    // æ ¹æ®header_sizeè¯»å–æ•°æ®å¤´çš„åŸå§‹å­—ç¬¦æµ\n    // substrè¡¨ç¤ºï¼Œç•¥è¿‡recv_bufçš„å‰uint32_t å¤§å°ä¸ªå­—èŠ‚ï¼Œè¿”å›ä¹‹åçš„header_sizeé•¿åº¦çš„å­—ç¬¦ä¸²\n    // rpc_header_str ç›®å‰ä¿å­˜äº†service_name method_name args_size\n    std::string rpc_header_str = recv_buf.substr(sizeof(uint32_t), header_size);\n    // ç”¨rpcheader.pb.hç”Ÿæˆçš„rpcHeaderä¸­çš„ParseFromStringååºåˆ—åŒ–rpc_header_str\n    mprpc::RpcHeader rpcHeader;\n    std::string service_name;\n    std::string method_name;\n    uint32_t args_size;\n    if (rpcHeader.ParseFromString(rpc_header_str))\n    {\n        // headerååºåˆ—åŒ–æˆåŠŸ\n        service_name = rpcHeader.service_name();\n        method_name = rpcHeader.method_name();\n        args_size = rpcHeader.args_size();\n    }\n    else\n    {\n        // headerååºåˆ—åŒ–å¤±è´¥\n        std::cout << \"rpc_header_str: \" << rpc_header_str << \"parse error!\" << std::endl;\n        return;\n    }\n\n    // è·å–rpcæ–¹æ³•å‚æ•°çš„å­—ç¬¦æµæ•°æ®\n    std::string args_str = recv_buf.substr(sizeof(uint32_t) + header_size, args_size);\n\n    // æ‰“å°è°ƒè¯•ä¿¡æ¯\n    std::cout << \"==============================\" << std::endl;\n    std::cout << \"header_size: \" << header_size << std::endl;\n    std::cout << \"rpc_header_str: \" << rpc_header_str << std::endl;\n    std::cout << \"service_name: \" << service_name << std::endl;\n    std::cout << \"method_name: \" << method_name << std::endl;\n    std::cout << \"args_str: \" << args_str << std::endl;\n    std::cout << \"==============================\" << std::endl;\n    // ...\n}\n```\n#### æŸ¥è¡¨è·å–serviceå¯¹è±¡å’Œmethodå¯¹è±¡\n```cpp\n    // ...\n\n    auto service_it = m_serviceMap.find(service_name);\n    if (service_it == m_serviceMap.end())\n    {\n        std::cout << service_name << \" not exist!\" << std::endl;\n        return;\n    }\n    auto method_it = service_it->second.m_methodMap.find(method_name);\n    if (method_it == service_it->second.m_methodMap.end())\n    {\n        std::cout << method_name << \" not exist in \" << service_name << std::endl;\n        return;\n    }\n    \n    google::protobuf::Service *service = service_it->second.m_service;\n    const google::protobuf::MethodDescriptor *method = method_it->second;\n    // ...\n```\n#### `service->GetRequestPrototype(method).New()`ç”Ÿæˆrequestå’Œresponse\n```cpp\n    // ...\n\n    // ç”Ÿæˆrpcæ–¹æ³•è°ƒç”¨çš„è¯·æ±‚requestå’Œå“åº”response\n    google::protobuf::Message *request = service->GetRequestPrototype(method).New();\n    if (!request->ParseFromString(args_str))\n    {\n        std::cout << \"request parse args_str error! args_str: \" << args_str << std::endl;\n        return;\n    }\n    google::protobuf::Message *response = service->GetResponsePrototype(method).New();\n    // ...\n```\n#### `google::protobuf::NewCallback<>`ç”Ÿæˆå›è°ƒå‡½æ•°\n```cpp\n    // ...\n    \n    // ç»™ä¸‹é¢çš„methodæ–¹æ³•çš„è°ƒç”¨ï¼Œç»‘å®šä¸€ä¸ªClosureçš„å›è°ƒå‡½æ•°\n    google::protobuf::Closure* done = google::protobuf::NewCallback\n        <RpcProvider, const muduo::net::TcpConnectionPtr&, google::protobuf::Message*>\n            (this, &RpcProvider::SendRpcResponse, conn, response);\n\n    // åœ¨æ¡†æ¶ä¸Šæ ¹æ®è¿œç«¯rpcè¯·æ±‚ï¼Œè°ƒç”¨å½“å‰rpcèŠ‚ç‚¹ä¸Šå‘å¸ƒçš„æ–¹æ³•\n    service->CallMethod(method, nullptr, request, response, done);\n}\n```\n#### ç¼–å†™`RpcProvider::SendRpcResponse()`\n```cpp\nvoid RpcProvider::SendRpcResponse(const muduo::net::TcpConnectionPtr& conn, google::protobuf::Message* response)\n{\n    std::string response_str;\n    // å°†responseåºåˆ—åŒ–ä¸ºå­—ç¬¦æµ\n    if (response->SerializeToString(&response_str))\n    {\n        // åºåˆ—åŒ–æˆåŠŸåï¼Œé€šè¿‡ç½‘ç»œæŠŠrpcæ–¹æ³•æ‰§è¡Œçš„ç»“æœå‘é€å›rpcçš„è°ƒç”¨æ–¹\n        conn->send(response_str);\n    }\n    else\n    {\n        std::cout << \"Serialize response_str error!\" << std::endl;\n    }\n    conn->shutdown(); // çŸ­è¿æ¥æ•ˆæœï¼Œç”±rpcproviderä¸»åŠ¨æ–­å¼€è¿æ¥ï¼Œè®©å‡ºæœåŠ¡å™¨èµ„æºã€‚\n}\n```\n## Mprpcchannelç±»\n```cpp\n#pragma once\n#include <google/protobuf/service.h>\n#include <google/protobuf/descriptor.h>\n#include <google/protobuf/message.h>\nclass MprpcChannel : public google::protobuf::RpcChannel\n{\npublic:\n    // æ‰€æœ‰é€šè¿‡stubä»£ç†å¯¹è±¡è°ƒç”¨çš„rpcæ–¹æ³•ï¼Œéƒ½èµ°åˆ°è¿™é‡Œäº†ï¼Œç»Ÿä¸€åšrpcæ–¹æ³•è°ƒç”¨çš„æ•°æ®æ•°æ®åºåˆ—åŒ–å’Œç½‘ç»œå‘é€\n    void CallMethod(const google::protobuf::MethodDescriptor *method,\n                    google::protobuf::RpcController *controller, const google::protobuf::Message *request,\n                    google::protobuf::Message *response, google::protobuf::Closure *done);\n       \n};\n```\nåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œå¤„ç†æœåŠ¡è°ƒç”¨æ–¹çš„è¯·æ±‚åŒ…ã€‚\n\nè¿™ä¸ªè¯·æ±‚åŒ…åªåŒ…å«rpcè°ƒç”¨çš„å‡½æ•°å‚æ•°ï¼ˆargsï¼‰ï¼Œä¸åŒ…å«æœåŠ¡åã€æ–¹æ³•åã€‚æœåŠ¡åã€æ–¹æ³•åå¯ä»¥ç”¨`method`å‚æ•°æŸ¥åˆ°ã€‚\n\næŠŠè¯·æ±‚åŒ…ï¼ˆåªåŒ…å«argsï¼‰åºåˆ—åŒ–ï¼Œå¾—åˆ°åºåˆ—åŒ–ä¹‹åçš„argså­—ç¬¦æµ`args_str`é•¿åº¦`args_size`ã€‚\n\nå¡«å†™ RpcHeaderï¼ˆ`service_name`ã€`method_name`ã€`args_size`ï¼‰ï¼Œåºåˆ—åŒ–åå¾—åˆ° RpcHeaderçš„å­—ç¬¦æµ`rpc_header_str`é•¿åº¦`header_size`\n\nä¹‹åæŒ‰ç…§çº¦å®šå¥½çš„æ ¼å¼ï¼ŒæŠŠ`header_size`ã€`rpc_header_str`ã€`args_str`æ ¼å¼åŒ–å¡«å……ã€æ‹¼æ¥åˆ°`send_rpc_str`ã€‚\n\nä¹‹åä¾¿æ˜¯TCPå®¢æˆ·ç«¯ç¼–ç¨‹ï¼ŒæŠŠ`send_rpc_str`å‘é€åˆ°é…ç½®æ–‡ä»¶ä¸­çš„è¿œç«¯ipã€ç«¯å£ã€‚\n\nç­‰å¾…è¿œç«¯å“åº”çš„æ•°æ®ï¼Œè§£æå“åº”æ•°æ®ã€‚å¡«å…¥äº†responseã€‚\n\nCallMethodç»“æŸï¼ŒChannelçš„ä½¿å‘½ç»“æŸï¼ŒStubçš„ä½¿å‘½ç»“æŸã€‚\n\nè°ƒç”¨æ ˆå°±å›åˆ°äº†æœåŠ¡è°ƒç”¨æ–¹çš„ä¸»ç¨‹åºä¸­ï¼Œè¾“å‡ºresponseã€‚\nè§[æœåŠ¡è°ƒç”¨è€…ä¸»ç¨‹åº](#æœåŠ¡è°ƒç”¨è€…ä¸»ç¨‹åº)\n\n>æœåŠ¡è°ƒç”¨æ–¹æ˜¯é€šè¿‡Channelå¾—çŸ¥è¿œç«¯æœåŠ¡æä¾›æ–¹çš„ipã€ç«¯å£çš„ã€‚\n### å®ç°\n```cpp\n#include \"mprpcchannel.h\"\n#include \"rpcheader.pb.h\"\n#include \"mprpcapplication.h\"\n#include <sys/socket.h>\n#include <arpa/inet.h>\n#include <unistd.h>\n#include <error.h>\n// çº¦å®šå¥½çš„åŒ…æ ¼å¼ï¼šï¼ˆheader_size)(service_name method_name args_size)(args)\nvoid MprpcChannel::CallMethod(const google::protobuf::MethodDescriptor *method,\n    google::protobuf::RpcController *controller, const google::protobuf::Message *request,\n    google::protobuf::Message *response, google::protobuf::Closure *done)\n{\n    const google::protobuf::ServiceDescriptor *sd = method->service();\n    std::string service_name = sd->name();\n    std::string method_name = method->name();\n    \n    // åºåˆ—åŒ–(args)ï¼Œä¹‹åæ‰èƒ½è·å–argsçš„åºåˆ—åŒ–å­—ç¬¦ä¸²é•¿åº¦ args_size\n    uint32_t args_size = 0;\n    std::string args_str;\n    if (request->SerializeToString(&args_str))\n    {\n        args_size = args_str.size();\n    }\n    else\n    {\n        std::cout << \"serialize request error!\" << std::endl;\n        return;\n    }\n    // å¡«å†™rpcçš„è¯·æ±‚header\n    mprpc::RpcHeader rpcHeader;\n    rpcHeader.set_service_name(service_name);\n    rpcHeader.set_method_name(method_name);\n    rpcHeader.set_args_size(args_size);\n    // åºåˆ—åŒ–ï¼ˆheader_size)(service_name method_name args_size)\n    uint32_t header_size = 0;\n    std::string rpc_header_str;\n    if (rpcHeader.SerializeToString(&rpc_header_str))\n    {\n        header_size = rpc_header_str.size();\n    }\n    else\n    {\n        std::cout << \"serialize request error!\" << std::endl;\n        return;\n    }\n\n    std::string send_rpc_str;\n    send_rpc_str.insert(0, std::string((char*)&header_size, 4));\n    send_rpc_str += rpc_header_str;\n    send_rpc_str += args_str;\n\n    // æ‰“å°è°ƒè¯•ä¿¡æ¯\n    std::cout << \"==============================\" << std::endl;\n    std::cout << \"header_size: \" << header_size << std::endl;\n    std::cout << \"rpc_header_str: \" << rpc_header_str << std::endl;\n    std::cout << \"service_name: \" << service_name << std::endl;\n    std::cout << \"method_name: \" << method_name << std::endl;\n    std::cout << \"args_str: \" << args_str << std::endl;\n    std::cout << \"==============================\" << std::endl;\n\n    // ä½¿ç”¨tcpç¼–ç¨‹ï¼Œå®Œæˆrpcæ–¹æ³•çš„è¿œç¨‹è°ƒç”¨\n    int cliendfd = socket(AF_INET, SOCK_STREAM, 0);\n    if (-1 == cliendfd)\n    {\n        std::cout << \"Create Socket Error: \" << errno << std::endl;\n        exit(EXIT_FAILURE);\n    }\n\n    // è¯»å–é…ç½®æ–‡ä»¶rpcserverçš„ä¿¡æ¯\n    std::string ip = MprpcApplication::GetInstance().GetConfig().Load(\"rpcserver_ip\");\n    uint16_t port = atoi(MprpcApplication::GetInstance().GetConfig().Load(\"rpcserver_port\").c_str());\n    struct sockaddr_in server_addr;\n    server_addr.sin_family = AF_INET;\n    server_addr.sin_port = htons(port);\n    if (-1 == inet_pton(AF_INET, ip.c_str(), &(server_addr.sin_addr.s_addr)))\n    {\n        std::cout << \"inet_pton Error: \" << errno << std::endl;\n        close(cliendfd);\n        exit(EXIT_FAILURE);\n    }\n    if (-1 == connect(cliendfd, (struct sockaddr*)&server_addr, sizeof(server_addr)))\n    {\n        std::cout << \"connect Error: \" << errno << std::endl;\n        close(cliendfd);\n        exit(EXIT_FAILURE);\n    }\n    if (-1 == send(cliendfd, send_rpc_str.c_str(), send_rpc_str.size(), 0))\n    {\n        std::cout << \"send Error: \" << errno << std::endl;\n        close(cliendfd);\n        exit(EXIT_FAILURE);\n    }\n    char recv_buff[1024] = {0};\n    int recv_size = 0;\n    if (-1 == (recv_size = recv(cliendfd, recv_buff, sizeof(recv_buff), 0)))\n    {\n        std::cout << \"recv Error: \" << errno << std::endl;\n        close(cliendfd);\n        exit(EXIT_FAILURE);\n    }\n    // ååºåˆ—åŒ–rpcè°ƒç”¨çš„å“åº”æ•°æ®\n    // std::string response_str(recv_buff, 0, recv_size); // å¦‚æ­¤æ„é€ æœ‰é—®é¢˜ï¼Œå¦‚æœrecv_buffä¸­å­˜åœ¨\\0åˆ™æ–­å¼€ã€‚\n    // if (!response->ParseFromString(response_str))\n    if (!response->ParseFromArray(recv_buff, recv_size))\n    {\n        std::cout << \"parse response_str error! response_str: \" << recv_buff << std::endl;\n        close(cliendfd);\n        return;\n    }\n    close(cliendfd);\n}\n```\n## MprpcController çš„ä½œç”¨\nç”¨äºè®°å½•rpcè°ƒç”¨è¿‡ç¨‹ä¸­çš„çŠ¶æ€ä¿¡æ¯ã€‚\nè¯•æƒ³ï¼Œå¦‚æœè¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œæˆ–è€…å“åº”è¿‡ç¨‹ä¸­ï¼ŒæŸä¸€ç¯èŠ‚é™¤äº†é—®é¢˜ï¼Œé‚£ä¹ˆæœåŠ¡è°ƒç”¨æ–¹å°±æ‹¿ä¸åˆ°responseä»»ä½•å†…å®¹äº†ï¼Œé‚£ä¹ˆå®ƒå»çœ‹äº†ä¸ªå¯‚å¯ï¼Ÿä¹Ÿä¸æ¸…æ¥šæ˜¯å“ªä¸ªç¯èŠ‚å‡ºé”™äº†ã€‚è¿™æ—¶å€™å¯ä»¥åœ¨å‚æ•°ä¸­ä¼ å…¥`mprpccontroller`çš„æŒ‡é’ˆï¼Œè®©å¯¹åº”çš„MprpcControllerå¯¹è±¡åœ¨å†…éƒ¨è®°å½•çŠ¶æ€ä¿¡æ¯ã€‚\n```cpp\n#pragma once\n#include <google/protobuf/service.h>\nclass MprpcController : public google::protobuf::RpcController\n{\npublic:\n    MprpcController();\n    void Reset();\n    bool Failed() const;\n    std::string ErrorText() const;\n    void SetFailed(const std::string& reason);\n\n    // æš‚æ—¶ç©ºå®ç°\n    void StartCancel();\n    bool IsCanceled() const;\n    void NotifyOnCancel(google::protobuf::Closure *callback);\nprivate:\n    // RPCæ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­çš„çŠ¶æ€\n    bool m_failed;\n    // RPCæ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­çš„é”™è¯¯ä¿¡æ¯\n    std::string m_errText;\n};\n```\n### å®ç°\n```cpp\n#include \"mprpccontroller.h\"\nMprpcController::MprpcController()\n{\n    m_failed = false;\n    m_errText = \"\";\n}\nvoid MprpcController::Reset()\n{\n    m_failed = false;\n    m_errText = \"\";\n}\nbool MprpcController::Failed() const\n{\n    return m_failed;\n}\nstd::string MprpcController::ErrorText() const\n{\n    return m_errText;\n}\nvoid MprpcController::SetFailed(const std::string& reason)\n{\n    m_failed = true;\n    m_errText = reason;\n}\nvoid MprpcController::StartCancel(){}\nbool MprpcController::IsCanceled() const { return false; }\nvoid MprpcController::NotifyOnCancel(google::protobuf::Closure *callback){}\n```\n### å¦‚ä½•ä½¿ç”¨\næ¯”å¦‚åœ¨`calluserservice.cc`ä¸‹ï¼Œå¯ä»¥ï¼š\nåœ¨stubè°ƒç”¨æŸæ–¹æ³•å‰ï¼Œå®šä¹‰ä¸€ä¸ªMprpcControllerå¯¹è±¡ï¼Œä¹‹åæŠŠå…¶æŒ‡é’ˆä¼ åˆ°è°ƒç”¨æ–¹æ³•çš„å‡½æ•°å‚æ•°å†…ã€‚\nåœ¨è¯»å–responseå‰ï¼Œå…ˆåˆ¤æ–­controllerçš„çŠ¶æ€ä¿¡æ¯ã€‚å¦‚æœé”™è¯¯å°±ä¸è¯»äº†ã€‚\n\n```cpp\n#include \"mprpccontroller.h\"\n// ...\n    // å‘èµ·rpcæ–¹æ³•çš„è°ƒç”¨ã€‚\n    MprpcController controller;\n    stub.Login(&controller, &request, &response, nullptr);\n    \n    if (controller.Failed()) // rpcè°ƒç”¨è¿‡ç¨‹ä¸­æœ‰å¼‚å¸¸ï¼Œresponseæ²¡æœ‰å¡«å…¥æ•°æ®\n    {\n        std::cout << controller.ErrorText() << std::endl;\n    }\n    else // ä¸€æ¬¡rpcè°ƒç”¨ç»“æŸï¼Œè¿”å›äº†ï¼Œè¯»è¿”å›çš„responseç»“æœ\n    {\n        if (response.result().errcode() == 0)\n        {\n            // æˆåŠŸ\n            std::cout << \"rpc login response success: \" << response.success() << std::endl;\n        }\n        else\n        {\n            std::cout << \"rpc login response error: \" << response.result().errmsg() << std::endl;\n        }\n    }\n    return 0;\n}\n```\nåœ¨`mprpcchannel.cc`ä¸­ï¼Œæœ‰å¯èƒ½å‡ºç°å¼‚å¸¸çš„åœ°æ–¹ï¼Œå‡ç”¨controllerè®°å½•ã€‚\n\nåˆ«å¿˜äº†åœ¨srcä¸‹çš„CMakeListsä¸­çš„`set(SRC_LIST ... )`åé¢æ·»åŠ ä¸Š`mprpccontroller.cc`ã€‚\n## æ—¥å¿—ç±»\n## ç¼–è¯‘\næ¡†æ¶ä¾èµ–muduoåº“ï¼Œå› æ­¤éœ€è¦åœ¨srcç›®å½•ä¸‹çš„`CMakeLists.txt`æ·»åŠ ï¼š\n\n>å¦‚æœå¿˜è®°äº†åº“å«ä»€ä¹ˆåå­—ï¼Œå¯ä»¥åœ¨`/usr/lib`æˆ–`/usr/local/lib`ä¸‹æŸ¥æ‰¾ï¼š\n\n```bash\nsudo find /usr -name \"libmuduo*\"\n```\n\n```bash\n/usr/local/lib/libmuduo_http.a\n/usr/local/lib/libmuduo_net.a\n/usr/local/lib/libmuduo_base.a\n/usr/local/lib/libmuduo_inspect.a\n```\n\næˆ‘ä»¬éœ€è¦çš„muduoçš„åº“åï¼šmuduo_netã€muduo_base\n```cmake\n# å½“å‰æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰æ–‡ä»¶ åˆ«å SRC_LIST\naux_source_directory(. SRC_LIST)\n# ç”ŸæˆåŠ¨æ€åº“\nadd_library(mprpc SHARED ${SRC_LIST})\n# ä¾èµ–muduoåº“\ntarget_link_libraries(mprpc muduo_net muduo_base pthread)\n```\nç”±äºæˆ‘ä»¬åœ¨ç¼–è¯‘muduoæ—¶ç¼–è¯‘æˆäº†é™æ€åº“ï¼Œè€Œæˆ‘ä»¬ç°åœ¨CMakeæŒ‡å®šç”Ÿæˆçš„æ˜¯åŠ¨æ€åº“ï¼ˆ`add_library(mprpc SHARED ${SRC_LIST})`ï¼‰ã€‚\nç”±äºé‡Œé¢æœ‰é™æ€åº“æˆåˆ†ï¼Œæ‰€ä»¥ç¼–è¯‘é“¾æ¥æ—¶ä¼šæŠ¥é”™ï¼Œå› æ­¤æˆ‘ä»¬æš‚æ—¶å…ˆç”Ÿæˆé™æ€åº“ã€‚\n```cmake\n# å½“å‰æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰æ–‡ä»¶ åˆ«å SRC_LIST\naux_source_directory(. SRC_LIST)\n# ç”Ÿæˆé™æ€åº“\nadd_library(mprpc ${SRC_LIST})\n# ä¾èµ–muduoåº“\ntarget_link_libraries(mprpc muduo_net muduo_base pthread)\n```\n\næµ‹è¯•ï¼š\n```bash\nmrcan@ubuntu:~/mprpc/bin$ ./provider -i test.conf \nrpcserver_ip: 127.0.0.1\nrpcserver_port: 8000\nzookeeper_ip: 127.0.0.1\nzookeeper_port: 5000\nRpcProvider Start Service at IP: 127.0.0.1, port: 8000\n```\n\n### `aux_source_directory`å­˜åœ¨çš„é—®é¢˜\n`~/mprpc/src`ä¸‹çš„`CMakeLists.txt`åŸæœ¬æ˜¯å¦‚ä¸‹å®šä¹‰çš„ï¼š\n```cmake\n# å½“å‰æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰æ–‡ä»¶ åˆ«å SRC_LIST\naux_source_directory(. SRC_LIST)\n# ç”Ÿæˆé™æ€åº“\nadd_library(mprpc ${SRC_LIST})\n# ä¾èµ–muduoåº“\ntarget_link_libraries(mprpc muduo_net muduo_base pthread)\n```\n\n`aux_source_directory(. SRC_LIST)`è¡¨ç¤ºç»™å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰å†…å®¹èµ·äº†åˆ«å`SRC_LIST`ã€‚\nä¸€å¼€å§‹æ„å»ºã€ç¼–è¯‘æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†åé¢å‘ç°å¦‚æœæˆ‘ä»¬ç»™srcç›®å½•å¢åŠ `.cc`æ–‡ä»¶åå†è¿›è¡Œç¼–è¯‘åˆ™æ— æ³•æ‰¾åˆ°è¿™äº›æ–°å¢çš„æ–‡ä»¶ã€‚\n\nè¯´æ˜buildåªè®°å½•äº†å½“æ—¶`src`ç›®å½•ä¸‹çš„æ—§æ–‡ä»¶ï¼Œè€Œæ²¡æœ‰è®°å½•æ–°å¢çš„æ–‡ä»¶ã€‚\næ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯è¿™ä¹ˆå†™å§ï¼š\n```cmake\n# å½“å‰æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰æ–‡ä»¶ åˆ«å SRC_LIST\nset(SRC_LIST mprpcapplication.cc mprpcconfig.cc rpcheader.cc rpcprovider.cc)\n\n# ç”Ÿæˆé™æ€åº“\nadd_library(mprpc ${SRC_LIST})\n# ä¾èµ–muduoåº“\ntarget_link_libraries(mprpc muduo_net muduo_base pthread)\n```\n\n# è°ƒè¯•\n\nåœ¨é¡¶çº§cmakeå†™ä¸‹ï¼š`set(CMAKE_BUILD_TYPE \"Debug\")`\n![](../../images/mprpc_rpcæ¡†æ¶/image-20250713173928826.png)\nè¿è¡Œï¼š\n```bash\ngdb ./provider\n```\n![](../../images/mprpc_rpcæ¡†æ¶/image-20250713174142619.png)\nbreakåŠ æ–­ç‚¹ï¼Œç”±äºæˆ‘ä»¬æ˜¯ç”Ÿæˆäº†soåŠ¨æ€é“¾æ¥åº“ï¼Œæ‰€ä»¥ä¼šæœ‰å¦‚ä¸‹æç¤ºï¼š\n```gdb\nbreak mprpcconfig.cc:ç¬¬nè¡Œ\n```\n![](../../images/mprpc_rpcæ¡†æ¶/image-20250713174407071.png)\nåŠ å®Œæ–­ç‚¹åï¼Œrunï¼Œè¿è¡Œç¨‹åºã€‚ï¼ˆgdbè°ƒè¯•æ—¶ï¼Œå¦‚æœæœ‰å‚æ•°ï¼Œæ­£ç¡®å¯åŠ¨æ–¹å¼æ˜¯ï¼š`run arg1 arg2`ï¼‰\n```gdb\nrun -i test.conf\n```\nç»“æœï¼š\n![](../../images/mprpc_rpcæ¡†æ¶/image-20250713174720348.png)\nè°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥æ•²å…¥btæŸ¥çœ‹æ ˆå¸§ä¿¡æ¯ï¼ŒlæŸ¥çœ‹æºä»£ç ä¿¡æ¯ã€‚\nbt\n![](../../images/mprpc_rpcæ¡†æ¶/image-20250713174846521.png)\nl\n![](../../images/mprpc_rpcæ¡†æ¶/image-20250713174857557.png)\næ•²å…¥nå¯ä»¥å•æ­¥æ‰§è¡Œã€‚\n![](../../images/mprpc_rpcæ¡†æ¶/image-20250713174922879.png)\np + å˜é‡åï¼Œå¯ä»¥æ‰“å°å˜é‡çš„å€¼ã€‚\n![](../../images/mprpc_rpcæ¡†æ¶/image-20250713174949860.png)\nqé€€å‡ºè°ƒè¯•\n# zookeeper\nchannelä¸€å¼€å§‹ä¸çŸ¥é“æœåŠ¡èŠ‚ç‚¹çš„ipã€portï¼Œéœ€è¦å…ˆå»æŸ¥æ‰¾ã€‚\n","categories":["é¡¹ç›®","rpc"]},{"title":"Android_Handler","url":"/Android/Android_Handler/","content":"\n# æ¦‚å¿µ\n\nHandlerã€MessageQueueã€Runnableã€Looperã€‚\n\n# Runnableå’ŒMessage\n\nRunnableå’ŒMessageå¯ä»¥è¢«å‹å…¥æŸä¸ªMessageQueueä¸­ï¼Œå½¢æˆä¸€ä¸ªé›†åˆã€‚\n\næ³¨æ„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æŸç§ç±»å‹çš„MessageQueueåªå…è®¸ä¿å­˜ç›¸åŒç±»å‹çš„ Objectã€‚å›¾ä¸­æˆ‘ä»¬åªæ˜¯ä¸ºäº†å™è¿°æ–¹ä¾¿æ‰å°†å®ƒä»¬æ··æ”¾åœ¨åŒä¸€ä¸ªMessageQueueä¸­ï¼Œå®é™…æºç ä¸­éœ€è¦å…ˆå¯¹Runnableè¿›è¡Œç›¸åº”è½¬æ¢ã€‚\n\n# Looperå¾ªç¯åœ°å»åšæŸä»¶äº‹\n\næ¯”å¦‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒä¸æ–­åœ°ä»MessageQueueä¸­å–å‡ºä¸€ä¸ªitemï¼Œç„¶åä¼ ç»™Handlerè¿›è¡Œå¤„ç†ï¼Œå¦‚æ­¤å¾ªç¯å¾€å¤ã€‚å‡å¦‚é˜Ÿåˆ—ä¸ºç©ºï¼Œé‚£ä¹ˆå®ƒä¼šè¿›å…¥ä¼‘çœ ã€‚\n\n# Handleræ˜¯çœŸæ­£å¤„ç†äº‹æƒ…çš„åœ°æ–¹\n\nå®ƒåˆ©ç”¨è‡ªèº«çš„å¤„ç†æœºåˆ¶ï¼Œå¯¹ä¼ å…¥çš„å„ç§Objectè¿›è¡Œç›¸åº”çš„å¤„ç†å¹¶äº§ç”Ÿæœ€ç»ˆç»“æœã€‚\n\nç”¨ä¸€å¥è¯æ¥æ¦‚æ‹¬å®ƒä»¬ï¼Œå°±æ˜¯ï¼šLooperä¸æ–­è·å–MessageQueueä¸­çš„ä¸€ä¸ªMessageï¼Œç„¶åç”±Handleræ¥å¤„ç†ã€‚\n\nå¯ä»¥çœ‹å‡ºï¼Œä¸Šé¢çš„å‡ ä¸ªå¯¹è±¡æ˜¯ç¼ºä¸€ä¸å¯çš„ã€‚å®ƒä»¬å„å¸å…¶èŒï¼Œå¾ˆåƒä¸€å°è®¡ç®—æœºä¸­CPUçš„å·¥ä½œå¼ï¼šä¸­å¤®å¤„ç†å™¨ï¼ˆLooperï¼‰ä¸æ–­åœ°ä»å†…å­˜ï¼ˆMessageQueueï¼‰ä¸­è¯»å–æŒ‡ä»¤ï¼ˆMessageï¼‰ï¼Œæ‰§è¡ŒæŒ‡ä»¤ï¼ˆHandlerï¼‰ï¼Œæœ€ç»ˆäº§ç”Ÿç»“æœã€‚å½“ç„¶ï¼Œåˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬è¿˜åªæ˜¯ä»é€»è¾‘çš„å±‚é¢ç†æ¸…äº†å®ƒä»¬çš„å…³ç³»ï¼Œæ¥ä¸‹æ¥å°†ä»ä»£ç çš„è§’åº¦æ¥éªŒè¯è¿™äº›å‡è®¾çš„çœŸå®å¯é æ€§ã€‚","categories":["Android"]},{"title":"Android_å¹¿æ’­","url":"/Android/Android_å¹¿æ’­/","content":"\n# å¹¿æ’­\n\nAndroidä¸­çš„æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½å¯ä»¥å¯¹è‡ªå·±æ„Ÿå…´è¶£çš„å¹¿æ’­è¿›è¡Œæ³¨å†Œï¼Œè¿™äº›å¹¿æ’­å¯èƒ½æ˜¯æ¥è‡ªäºç³»ç»Ÿçš„ï¼Œä¹Ÿå¯èƒ½æ˜¯æ¥è‡ªäºå…¶ä»–åº”ç”¨ç¨‹åºçš„ã€‚\n\nAndroidæä¾›äº†ä¸€å¥—å®Œæ•´çš„APIï¼Œå…è®¸åº”ç”¨ç¨‹åºè‡ªç”±åœ°å‘é€å’Œæ¥æ”¶å¹¿æ’­ã€‚\n\nå¹¿æ’­ä¸»è¦å¯ä»¥åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šæ ‡å‡†å¹¿æ’­å’Œæœ‰åºå¹¿æ’­ã€‚\n\n## æ ‡å‡†å¹¿æ’­\n\nå®Œå…¨å¼‚æ­¥æ‰§è¡Œã€‚å¹¿æ’­å‘å‡ºä¹‹åï¼Œæ‰€æœ‰çš„BroadcastReceiverå‡ ä¹ä¼šåœ¨åŒä¸€æ—¶é—´æ”¶åˆ°è¿™æ¡å¹¿æ’­æ¶ˆæ¯ã€‚è¿™ç§å¹¿æ’­æ•ˆç‡æ¯”è¾ƒé«˜ï¼ŒåŒæ—¶ä¹Ÿæ„å‘³ç€å®ƒæ˜¯æ— æ³•æˆªæ–­çš„ã€‚\n\n## æœ‰åºå¹¿æ’­\n\næœ‰åºå¹¿æ’­æ˜¯ä¸€ç§åŒæ­¥æ‰§è¡Œçš„å¹¿æ’­ï¼Œå¹¿æ’­å‘å‡ºä¹‹åï¼ŒåŒä¸€æ—¶åˆ»åªä¼šæœ‰ä¸€ä¸ªBroadcastReceiverèƒ½å¤Ÿæ”¶åˆ°è¿™æ¡å¹¿æ’­æ¶ˆæ¯ï¼Œå½“è¿™ä¸ªBroadcastReceiverä¸­çš„é€»è¾‘æ‰§è¡Œå®Œæ¯•åï¼Œå¹¿æ’­æ‰ä¼šç»§ç»­ä¼ é€’ã€‚\n\nä¼˜å…ˆçº§è¾ƒé«˜çš„BroadcastReceiverå¯ä»¥å…ˆæ”¶åˆ°å¹¿æ’­æ¶ˆæ¯ï¼Œå¹¶ä¸”å‰é¢çš„BroadcastReceiverè¿˜å¯ä»¥æˆªæ–­æ­£åœ¨ä¼ é€’çš„å¹¿æ’­ï¼Œè¿™æ ·åé¢çš„BroadcastReceiverå°±æ— æ³•æ”¶åˆ°å¹¿æ’­æ¶ˆæ¯äº†ã€‚\n\n# æ¥æ”¶ç³»ç»Ÿå¹¿æ’­\n\nAndroidå†…ç½®äº†å¾ˆå¤šç³»ç»Ÿçº§åˆ«çš„å¹¿æ’­ï¼Œå¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­é€šè¿‡ç›‘å¬è¿™äº›å¹¿æ’­æ¥å¾—åˆ°å„ç§ç³»ç»Ÿçš„çŠ¶æ€ä¿¡æ¯ã€‚æ¯”å¦‚æ‰‹æœºå¼€æœºå®Œæˆåä¼šå‘å‡ºä¸€æ¡å¹¿æ’­ï¼Œç”µæ± çš„ç”µé‡å‘ç”Ÿå˜åŒ–ä¼šå‘å‡ºä¸€æ¡å¹¿æ’­ï¼Œç³»ç»Ÿæ—¶é—´å‘ç”Ÿæ”¹å˜ä¹Ÿä¼šå‘å‡ºä¸€æ¡å¹¿æ’­ï¼Œç­‰ç­‰ã€‚å¦‚æœæƒ³è¦æ¥æ”¶è¿™äº›å¹¿æ’­ï¼Œå°±éœ€è¦ä½¿ç”¨BroadcastReceiverã€‚\n\nåº”ç”¨å¯ä»¥æ ¹æ®æ„Ÿå…´è¶£çš„å¹¿æ’­ï¼Œè‡ªç”±åœ°æ³¨å†ŒBroadcastReceiverï¼Œè¿™æ ·å½“æœ‰ç›¸åº”çš„å¹¿æ’­å‘å‡ºæ—¶ï¼Œç›¸åº”çš„BroadcastReceiverå°±èƒ½å¤Ÿæ”¶åˆ°è¯¥å¹¿æ’­ï¼Œå¹¶å¯ä»¥åœ¨å†…éƒ¨è¿›è¡Œé€»è¾‘å¤„ç†ã€‚\n\næ³¨å†ŒBroadcastReceiverçš„æ–¹å¼ä¸€èˆ¬æœ‰ä¸¤ç§ï¼šåœ¨ä»£ç ä¸­æ³¨å†Œå’Œåœ¨AndroidManifest.xmlä¸­æ³¨å†Œã€‚å…¶ä¸­å‰è€…ä¹Ÿè¢«ç§°ä¸ºåŠ¨æ€æ³¨å†Œï¼Œåè€…ä¹Ÿè¢«ç§°ä¸ºé™æ€æ³¨å†Œã€‚\n\n## åŠ¨æ€æ³¨å†Œç›‘å¬æ—¶é—´å˜åŒ–\n\nåˆ›å»ºä¸€ä¸ªBroadcastReceiverå…¶å®åªéœ€æ–°å»ºä¸€ä¸ªç±»ï¼Œè®©å®ƒç»§æ‰¿è‡ªBroadcastReceiverï¼Œå¹¶é‡å†™çˆ¶ç±»çš„onReceiveæ–¹æ³•å°±è¡Œäº†ã€‚è¿™æ ·å½“æœ‰å¹¿æ’­åˆ°æ¥æ—¶ï¼ŒonReceiveæ–¹æ³•å°±ä¼šå¾—åˆ°æ‰§è¡Œï¼Œå…·ä½“çš„é€»è¾‘å°±å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å¤„ç†ã€‚\n\nä¸‹é¢å…ˆé€šè¿‡åŠ¨æ€æ³¨å†Œçš„æ–¹å¼ç¼–å†™ä¸€ä¸ªèƒ½å¤Ÿç›‘å¬æ—¶é—´å˜åŒ–çš„ç¨‹åºï¼Œä½“ä¼šBroadcastReceiverçš„åŸºæœ¬ç”¨æ³•ã€‚æ–°å»ºä¸€ä¸ªBroadcastTesté¡¹ç›®ï¼Œç„¶åä¿®æ”¹MainActivityä¸­çš„ä»£ç ã€‚\n\nå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n    inner class TimeChangeReceiver : BroadcastReceiver() {\n        override fun onReceive(context: Context, intent: Intent) {\n            Toast.makeText(context, \"Time has changed\", Toast.LENGTH_SHORT).show()\n        }\n    }\n    \n    lateinit var timeChangeReceiver: TimeChangeReceiver\n    \n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n        val intentFilter = IntentFilter()\n        intentFilter.addAction(\"android.intent.action.TIME_TICK\")\n        timeChangeReceiver = TimeChangeReceiver()\n        registerReceiver(timeChangeReceiver, intentFilter)\n    }\n    \n    override fun onDestroy() {\n        super.onDestroy()\n        unregisterReceiver(timeChangeReceiver)\n    }\n}\n```\n\nåœ¨MainActivityä¸­å®šä¹‰äº†ä¸€ä¸ªå†…éƒ¨ç±»TimeChangeReceiverï¼Œè¿™ä¸ªç±»æ˜¯ç»§æ‰¿è‡ªBroadcastReceiverçš„ï¼Œå¹¶é‡å†™äº†çˆ¶ç±»çš„onReceiveæ–¹æ³•ã€‚è¿™æ ·æ¯å½“ç³»ç»Ÿæ—¶é—´å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒonReceiveæ–¹æ³•å°±ä¼šå¾—åˆ°æ‰§è¡Œï¼Œè¿™é‡Œåªæ˜¯ç®€å•åœ°ä½¿ç”¨Toastæç¤ºäº†ä¸€æ®µæ–‡æœ¬ä¿¡æ¯ã€‚\n\nç„¶åè§‚å¯ŸonCreateæ–¹æ³•ï¼Œé¦–å…ˆæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªIntentFilterçš„å®ä¾‹ï¼Œå¹¶ç»™å®ƒæ·»åŠ äº†ä¸€ä¸ªå€¼ä¸º`android.intent.action.TIME_TICK`çš„actionï¼Œæ¯å½“ç³»ç»Ÿæ—¶é—´å‘ç”Ÿå˜åŒ–æ—¶ï¼Œç³»ç»Ÿå‘å‡ºæ­¤å€¼çš„å¹¿æ’­ã€‚BroadcastReceiveræƒ³è¦ç›‘å¬ä»€ä¹ˆå¹¿æ’­ï¼Œå°±åœ¨è¿™é‡Œæ·»åŠ ç›¸åº”çš„actionã€‚\n\næ¥ä¸‹æ¥åˆ›å»ºäº†ä¸€ä¸ªTimeChangeReceiverçš„å®ä¾‹ï¼Œç„¶åè°ƒç”¨registerReceiveræ–¹æ³•è¿›è¡Œæ³¨å†Œï¼Œå°†TimeChangeReceiverçš„å®ä¾‹å’ŒIntentFilterçš„å®ä¾‹éƒ½ä¼ äº†è¿›å»ï¼Œè¿™æ ·TimeChangeReceiverå°±ä¼šæ”¶åˆ°æ‰€æœ‰å€¼ä¸º`android.intent.action.TIME_TICK`çš„å¹¿æ’­ï¼Œä¹Ÿå°±å®ç°äº†ç›‘å¬ç³»ç»Ÿæ—¶é—´å˜åŒ–çš„åŠŸèƒ½ã€‚\n\næœ€åè¦è®°å¾—ï¼Œä¸€å®šè¦æ³¨é”€åŠ¨æ€æ³¨å†Œçš„BroadcastReceiveræ‰è¡Œï¼Œåœ¨onDestroyæ–¹æ³•ä¸­é€šè¿‡è°ƒç”¨unregisterReceiveræ–¹æ³•æ¥å®ç°ã€‚\n\nç°åœ¨è¿è¡Œä¸€ä¸‹ç¨‹åºï¼Œç„¶åé™é™ç­‰å¾…æ—¶é—´å‘ç”Ÿå˜åŒ–ã€‚ç³»ç»Ÿæ¯éš”ä¸€åˆ†é’Ÿå°±ä¼šå‘å‡ºä¸€æ¡`android.intent.action.TIME_TICK`çš„å¹¿æ’­ï¼Œå› æ­¤æœ€å¤šåªéœ€è¦ç­‰å¾…ä¸€åˆ†é’Ÿå°±å¯ä»¥æ”¶åˆ°è¿™æ¡å¹¿æ’­ã€‚\n\n### æ€»ç»“\n\næ¥æ”¶å…¶ä»–ç³»ç»Ÿå¹¿æ’­çš„ç”¨æ³•æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚Android ç³»ç»Ÿè¿˜ä¼šåœ¨äº®å±ç†„å±ã€ç”µé‡å˜åŒ–ã€ç½‘ç»œå˜åŒ–ç­‰åœºæ™¯ä¸‹å‘å‡ºå‚æ’­ã€‚å®Œæ•´çš„ç³»ç»Ÿå‚æ’­åˆ—è¡¨åˆ°å¦‚ä¸‹çš„è·¯å¾„ä¸­æŸ¥çœ‹ï¼š`<Android SDK>/platforms/<ä»»æ„android apiç‰ˆæœ¬>/data/broadcast_actions.txt`ã€‚\n\n## é™æ€æ³¨å†Œå®ç°å¼€æœºå¯åŠ¨\n\nåŠ¨æ€æ³¨å†Œçš„BroadcastReceiverå¯ä»¥è‡ªç”±åœ°æ§åˆ¶æ³¨å†Œä¸æ³¨é”€ï¼Œåœ¨çµæ´»æ€§æ–¹é¢æœ‰å¾ˆå¤§çš„ä¼˜åŠ¿ã€‚ä½†æ˜¯å®ƒå­˜åœ¨ç€ä¸€ä¸ªç¼ºç‚¹ï¼Œå³å¿…é¡»åœ¨ç¨‹åºå¯åŠ¨ä¹‹åæ‰èƒ½æ¥æ”¶å¹¿æ’­ï¼Œå› ä¸ºæ³¨å†Œçš„é€»è¾‘æ˜¯å†™åœ¨onCreateæ–¹æ³•ä¸­çš„ã€‚\n\nè®©ç¨‹åºåœ¨æœªå¯åŠ¨çš„æƒ…å†µä¸‹ä¹Ÿèƒ½æ¥æ”¶å¹¿æ’­éœ€è¦ä½¿ç”¨é™æ€æ³¨å†Œçš„æ–¹å¼ã€‚ä»ç†è®ºä¸Šæ¥è¯´ï¼ŒåŠ¨æ€æ³¨å†Œèƒ½ç›‘å¬åˆ°çš„ç³»ç»Ÿå¹¿æ’­ï¼Œé™æ€æ³¨å†Œä¹Ÿåº”è¯¥èƒ½ç›‘å¬åˆ°ï¼Œåœ¨è¿‡å»çš„Androidç³»ç»Ÿä¸­ç¡®å®æ˜¯è¿™æ ·ã€‚ä½†æ˜¯ç”±äºå¤§é‡æ¶æ„çš„åº”ç”¨ç¨‹åºåˆ©ç”¨è¿™ä¸ªæœºåˆ¶åœ¨ç¨‹åºæœªå¯åŠ¨çš„æƒ…å†µä¸‹ç›‘å¬ç³»ç»Ÿå¹¿æ’­ï¼Œä»è€Œä½¿ä»»ä½•åº”ç”¨éƒ½å¯ä»¥é¢‘ç¹åœ°ä»åå°è¢«å”¤é†’ï¼Œä¸¥é‡å½±å“äº†ç”¨æˆ·æ‰‹æœºçš„ç”µé‡å’Œæ€§èƒ½ï¼Œå› æ­¤Androidç³»ç»Ÿå‡ ä¹æ¯ä¸ªç‰ˆæœ¬éƒ½åœ¨å‰Šå‡é™æ€æ³¨å†ŒBroadcastReceiverçš„åŠŸèƒ½ã€‚\n\n## éšå¼å¹¿æ’­\n\nåœ¨Android 8.0ç³»ç»Ÿä¹‹åï¼Œæ‰€æœ‰éšå¼å¹¿æ’­éƒ½ä¸å…è®¸ä½¿ç”¨é™æ€æ³¨å†Œçš„æ–¹å¼æ¥æ¥æ”¶äº†ã€‚éšå¼å¹¿æ’­æŒ‡çš„æ˜¯é‚£äº›æ²¡æœ‰å…·ä½“æŒ‡å®šå‘é€ç»™å“ªä¸ªåº”ç”¨ç¨‹åºçš„å¹¿æ’­ï¼Œå¤§å¤šæ•°ç³»ç»Ÿå¹¿æ’­å±äºéšå¼å¹¿æ’­ï¼Œä½†æ˜¯å°‘æ•°ç‰¹æ®Šçš„ç³»ç»Ÿå¹¿æ’­ç›®å‰ä»ç„¶å…è®¸ä½¿ç”¨é™æ€æ³¨å†Œçš„æ–¹å¼æ¥æ¥æ”¶ã€‚è¿™äº›ç‰¹æ®Šçš„ç³»ç»Ÿå¹¿æ’­åˆ—è¡¨è¯¦è§https://developer.android.google.cn/guide/components/broadcast-exceptions.htmlã€‚\n\nåœ¨è¿™äº›ç‰¹æ®Šçš„ç³»ç»Ÿå¹¿æ’­å½“ä¸­ï¼Œæœ‰ä¸€æ¡å€¼ä¸º`android.intent.action.BOOT_COMPLETED`çš„å¹¿æ’­ï¼Œæ˜¯ä¸€æ¡å¼€æœºå¹¿æ’­ï¼Œç”¨å®ƒæ¥ä¸¾ä¾‹ã€‚\n\nå®ç°ä¸€ä¸ªå¼€æœºå¯åŠ¨çš„åŠŸèƒ½ã€‚åœ¨å¼€æœºçš„æ—¶å€™ï¼Œåº”ç”¨ç¨‹åºè‚¯å®šæ˜¯æ²¡æœ‰å¯åŠ¨çš„ï¼Œå› æ­¤è¿™ä¸ªåŠŸèƒ½æ˜¾ç„¶ä¸èƒ½ä½¿ç”¨åŠ¨æ€æ³¨å†Œçš„æ–¹å¼æ¥å®ç°ï¼Œè€Œåº”è¯¥ä½¿ç”¨é™æ€æ³¨å†Œçš„æ–¹å¼æ¥æ¥æ”¶å¼€æœºå¹¿æ’­ï¼Œç„¶ååœ¨onReceiveæ–¹æ³•é‡Œæ‰§è¡Œç›¸åº”çš„é€»è¾‘ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°å¼€æœºå¯åŠ¨çš„åŠŸèƒ½äº†ã€‚\n\n```kotlin\nclass BootCompleteReceiver : BroadcastReceiver() {\n    override fun onReceive(context: Context, intent: Intent) {\n        Toast.makeText(context, \"Boot Complete\", Toast.LENGTH_LONG).show()\n    }\n}\n```\n\né™æ€çš„BroadcastReceiverä¸€å®šè¦åœ¨AndroidManifest.xmlæ–‡ä»¶ä¸­æ³¨å†Œæ‰å¯ä»¥ä½¿ç”¨ã€‚\n\n```xml\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\" package=\"com.example.broadcasttest\">\n    <application android:allowBackup=\"true\"\n        android:icon=\"@mipmap/ic_launcher\"\n        android:label=\"@string/app_name\"\n        android:roundIcon=\"@mipmap/ic_launcher_round\"\n        android:supportsRtl=\"true\"\n        android:theme=\"@style/AppTheme\">\n        ...\n        <!-- + -->\n        <receiver\n            android:name=\".BootCompleteReceiver\"\n            android:enabled=\"true\"\n            android:exported=\"true\">\n        </receiver>\n    </appLication>\n</manifest>\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œ`<application>`æ ‡ç­¾å†…å‡ºç°äº†ä¸€ä¸ªæ–°çš„æ ‡ç­¾`<receiver>`æ‰€æœ‰é™æ€çš„BroadcastReceiveréƒ½æ˜¯åœ¨è¿™é‡Œè¿›è¡Œæ³¨å†Œçš„ã€‚å®ƒçš„ç”¨æ³•å…¶å®å’Œ`<activity>`æ ‡ç­¾éå¸¸ç›¸ä¼¼ï¼Œä¹Ÿæ˜¯é€šè¿‡`android:name`æŒ‡å®šå…·ä½“æ³¨å†Œå“ªä¸€ä¸ªBroadcastReceiverï¼ŒExportedå±æ€§è¡¨ç¤ºæ˜¯å¦å…è®¸è¿™ä¸ªBroadcastReceiver**æ¥æ”¶æœ¬ç¨‹åºä»¥å¤–çš„å¹¿æ’­**ï¼ŒEnabledå±æ€§è¡¨ç¤ºæ˜¯å¦å¯ç”¨è¿™ä¸ªBroadcastReceiverã€‚\n\nä¸è¿‡ç›®å‰çš„BootCompleteReceiveræ˜¯æ— æ³•æ”¶åˆ°å¼€æœºå¹¿æ’­çš„ï¼Œè¿˜éœ€è¦å¯¹AndroidManifest.xmlæ–‡ä»¶è¿›è¡Œä¿®æ”¹æ‰è¡Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\" package=\"com.example.broadcasttest\">\n    <!-- + -->\n    <uses-permission android:name=\"android.permission.RECEIVE_BOOT_COMPLETED\" />\n    <application android:allowBackup=\"true\"\n        android:icon=\"@mipmap/ic_launcher\"\n        android:label=\"@string/app_name\"\n        android:roundIcon=\"@mipmap/ic_launcher_round\"\n        android:supportsRtl=\"true\"\n        android:theme=\"@style/AppTheme\">\n        ...\n        <receiver\n            android:name=\".BootCompleteReceiver\"\n            android:enabled=\"true\"\n            android:exported=\"true\">\n            <!-- + -->\n            <intent-filter>\n                <action android:name=\"android.intent.action.BOOT_COMPLETED\" />\n            </intent-filter>\n        </receiver>\n    </appLication>\n</manifest>\n```\n\nç”±äºAndroidç³»ç»Ÿå¯åŠ¨å®Œæˆåä¼šå‘å‡ºä¸€æ¡å€¼ä¸º`android.intent.action.BOOT_COMPLETED`çš„å¹¿æ’­ï¼Œå› æ­¤æˆ‘ä»¬åœ¨`<receiver>`æ ‡ç­¾ä¸­åˆæ·»åŠ äº†ä¸€ä¸ª`<intent-filter>`æ ‡ç­¾ï¼Œå¹¶åœ¨é‡Œé¢å£°æ˜äº†ç›¸åº”çš„actionã€‚\n\nå¦å¤–ï¼ŒAndroidç³»ç»Ÿä¸ºäº†ä¿æŠ¤ç”¨æˆ·è®¾å¤‡çš„å®‰å…¨å’Œéšç§ï¼Œåšäº†ä¸¥æ ¼çš„è§„å®šï¼šå¦‚æœç¨‹åºéœ€è¦è¿›è¡Œä¸€äº›å¯¹ç”¨æˆ·æ¥è¯´æ¯”è¾ƒæ•æ„Ÿçš„æ“ä½œï¼Œå¿…é¡»åœ¨AndroidManifest.xmlæ–‡ä»¶ä¸­è¿›è¡Œæƒé™å£°æ˜ã€‚å¦åˆ™ç¨‹åºå°†ä¼šç›´æ¥å´©æºƒã€‚æ¯”å¦‚è¿™é‡Œæ¥æ”¶ç³»ç»Ÿçš„å¼€æœºå¹¿æ’­å°±æ˜¯éœ€è¦è¿›è¡Œæƒé™å£°æ˜çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä¸Šè¿°ä»£ç ä¸­ä½¿ç”¨`<uses-permission>`æ ‡ç­¾å£°æ˜äº†`android.permission.RECEIVE_BOOT_COMPLETED`â€”â€”æ¥æ”¶ç³»ç»Ÿå¼€æœºå¹¿æ’­çš„æƒé™ã€‚Android 6.0ç³»ç»Ÿä¸­å¼•å…¥äº†æ›´åŠ ä¸¥æ ¼çš„è¿è¡Œæ—¶æƒé™ï¼Œä»è€Œèƒ½å¤Ÿæ›´å¥½åœ°ä¿è¯ç”¨æˆ·è®¾å¤‡çš„å®‰å…¨å’Œéšç§ã€‚\n\né‡æ–°è¿è¡Œç¨‹åºï¼Œåˆ™ç¨‹åºå·²ç»å¯ä»¥æ¥æ”¶å¼€æœºå¹¿æ’­äº†ã€‚é‡å¯è®¾å¤‡ï¼Œåœ¨å¯åŠ¨å®Œæˆä¹‹åå°±ä¼šæ”¶åˆ°å¼€æœºå¹¿æ’­ã€‚\n\n### æ€»ç»“\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸è¦åœ¨onReceiveæ–¹æ³•ä¸­æ·»åŠ è¿‡å¤šçš„é€»è¾‘æˆ–è€…è¿›è¡Œä»»ä½•çš„è€—æ—¶æ“ä½œï¼Œå› ä¸ºBroadcastReceiverä¸­æ˜¯ä¸å…è®¸å¼€å¯çº¿ç¨‹çš„ï¼Œå½“onReceiveæ–¹æ³•è¿è¡Œäº†è¾ƒé•¿æ—¶é—´è€Œæ²¡æœ‰ç»“æŸæ—¶ï¼Œç¨‹åºå°±ä¼šå‡ºç°é”™è¯¯ã€‚\n\n# å‘é€è‡ªå®šä¹‰å¹¿æ’­\n\nå‰é¢è®²çš„æ˜¯ç³»ç»Ÿå¹¿æ’­ï¼Œç°åœ¨çœ‹ä¸€ä¸‹åœ¨åº”ç”¨ç¨‹åºä¸­å‘é€è‡ªå®šä¹‰çš„å¹¿æ’­ã€‚\n\n## å‘é€æ ‡å‡†å¹¿æ’­\n\nåœ¨å‘é€å¹¿æ’­ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦å…ˆå®šä¹‰ä¸€ä¸ªBroadcastReceiveræ¥å‡†å¤‡æ¥æ”¶æ­¤å¹¿æ’­ï¼Œä¸ç„¶å‘å‡ºå»ä¹Ÿæ˜¯ç™½å‘ã€‚å› æ­¤æ–°å»ºä¸€ä¸ªMyBroadcastReceiverï¼Œå¹¶åœ¨onReceiveæ–¹æ³•ä¸­åŠ äººå¦‚ä¸‹ä»£ç ï¼š\n\n```kotlin\nclass MyBroadcastReceiver : BroadcastReceiver() {\n    override fun onReceiver(context: Context, intent: Intent) {\n        Toast.makeText(context, \"received in MyBroadcastReceiver\", Toast.LENGTH_SHORT).show()\n    }\n}\n```\n\nå½“MyBroadcastReceiveræ”¶åˆ°è‡ªå®šä¹‰çš„å¹¿æ’­æ—¶ã€‚å°±ä¼šå¼¹å‡º\"received in MyBroadcastReceiver\"çš„æç¤ºã€‚ç„¶ååœ¨AndroidManifest.xmlä¸­å¯¹è¿™ä¸ªBroadcastReceiverè¿›è¡Œä¿®æ”¹ï¼š\n\n```xml\n    <uses-permission android:name=\"android.permission.RECEIVE_BOOT_COMPLETED\"/>\n    <application\n        ...>\n        <receiver android:name=\".MyBroadcastReceiver\"\n            android:enabled=\"true\"\n            android:exported=\"true\">\n            <intent-filter>\n                <action android:name=\"com.example.broadcasttest.MY_BROADCAST\"/>\n            </intent-filter>\n        </receiver>\n    </application>\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œè®©MyBroadcastReceiveræ¥æ”¶ä¸€æ¡å€¼ä¸º`com.example.broadcasttest.MY_BROADCAST`çš„å¹¿æ’­ï¼Œå› æ­¤å¾…ä¼šå„¿åœ¨å‘é€å¹¿æ’­çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦å‘å‡ºè¿™æ ·çš„ä¸€æ¡å¹¿æ’­ã€‚\n\næ¥ä¸‹æ¥ä¿®æ”¹`activity_main.xml`ä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹ï¼š\n\n```xml\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:orientation=\"vertical\">\n    <Button\n        android:id=\"@+id/button\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Send Broadcast\">\n    </Button>\n\n</LinearLayout>\n```\n\nè¿™é‡Œåœ¨å¸ƒå±€æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€ä¸ªæŒ‰é’®ã€‚ç”¨äºä½œä¸ºå‘é€å¹¿æ’­çš„è§¦å‘ç‚¹ã€‚\n\nç„¶åä¿®æ”¹MainActivityä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```kotlin\nclass MyBroadcastReceiver : BroadcastReceiver() {\n    override fun onReceive(context: Context, intent: Intent) {\n        Toast.makeText(context, \"received in MyBroadcastReceiver\",\n            Toast.LENGTH_LONG).show()\n    }\n}\nclass MainActivity : AppCompatActivity() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n        val button: Button = findViewById(R.id.button)\n        button.setOnClickListener {\n            val intent = Intent(\"com.example.broadcasttest.MY_BROADCAST\")\n            intent.setPackage(packageName)\n            sendBroadcast(intent)\n        }\n    }\n}\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶é‡Œé¢åŠ å…¥äº†å‘é€è‡ªå®šä¹‰å¹¿æ’­çš„é€»è¾‘ã€‚\n\né¦–å…ˆæ„å»ºäº†ä¸€ä¸ªIntentå¯¹è±¡å¹¶æŠŠè¦å‘é€çš„å¹¿æ’­çš„å€¼ä¼ å…¥ã€‚ç„¶åè°ƒç”¨Intentçš„setPackageæ–¹æ³•ï¼Œå¹¶ä¼ å…¥å½“å‰åº”ç”¨ç¨‹åºçš„åŒ…åã€‚packageNameæ˜¯getPackageNameçš„è¯­æ³•ç³–å†™æ³•ï¼Œç”¨äºè·å–å½“å‰åº”ç”¨ç¨‹åºçš„åŒ…åã€‚æœ€åè°ƒç”¨sendBroadcastæ–¹æ³•å°†å¹¿æ’­å‘é€å‡ºå»ï¼Œè¿™æ ·æ‰€æœ‰ç›‘å¬`com.example.broadcasttest.MY_BROADCAST`è¿™æ¡å¹¿æ’­çš„BroadcastReceiverå°±ä¼šæ”¶åˆ°æ¶ˆæ¯äº†ã€‚\n\næ­¤æ—¶å‘å‡ºå»çš„å¹¿æ’­å°±æ˜¯ä¸€æ¡**æ ‡å‡†å¹¿æ’­**ã€‚\n\n> å¯¹setPackageæ–¹æ³•è¿›è¡Œæ›´è¯¦ç»†çš„è¯´æ˜ï¼šå‰é¢å·²ç»è¯´è¿‡ï¼Œåœ¨Android8.0ç³»ç»Ÿä¹‹åï¼Œé™æ€æ³¨å†Œçš„BroadcastReceiveræ˜¯æ— æ³•æ¥æ”¶éšå¼å¹¿æ’­çš„ï¼Œè€Œ**é»˜è®¤æƒ…å†µä¸‹æˆ‘ä»¬å‘å‡ºçš„è‡ªå®šä¹‰å¹¿æ’­æ°æ°éƒ½æ˜¯éšå¼å¹¿æ’­**ã€‚å› æ­¤è¿™é‡Œä¸€å®šè¦è°ƒç”¨setPackageæ–¹æ³•ï¼ŒæŒ‡å®šè¿™æ¡å¹¿æ’­æ˜¯å‘é€ç»™å“ªä¸ªåº”ç”¨ç¨‹åºçš„ï¼Œä»è€Œè®©å®ƒå˜æˆä¸€æ¡æ˜¾å¼å¹¿æ’­ï¼Œå¦åˆ™é™æ€æ³¨å†Œçš„BroadcastReceiverå°†æ— æ³•æ¥æ”¶åˆ°è¿™æ¡å¹¿æ’­ã€‚\n\nç°åœ¨é‡æ–°è¿è¡Œç¨‹åºå¹¶ç‚¹å‡»\"Send Broadcast\"æŒ‰é’®ï¼Œå³å¯çœ‹åˆ°æ•ˆæœã€‚\n\nå¦å¤–ï¼Œç”±äºå¹¿æ’­æ˜¯ä½¿ç”¨Intentæ¥å‘é€çš„ã€å› æ­¤ä½ è¿˜å¯ä»¥åœ¨Intentä¸­æºå¸¦ä¸€äº›æ•°æ®ä¼ é€’ç»™ç›¸åº”çš„BroadcastReceiverï¼Œè¿™ä¸€ç‚¹å’ŒActivityçš„ç”¨æ³•æ˜¯æ¯”è¾ƒç›¸ä¼¼çš„ã€‚\n\n## å‘é€æœ‰åºå¹¿æ’­\n\nå’Œæ ‡å‡†å¹¿æ’­ä¸åŒï¼Œæœ‰åºå¹¿æ’­æ˜¯ä¸€ç§åŒæ­¥æ‰§è¡Œçš„å¹¿æ’­ï¼Œå¹¶ä¸”æ˜¯å¯ä»¥è¢«æˆªæ–­çš„ã€‚ä¸ºäº†éªŒè¯è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦å†åˆ›å»ºä¸€ä¸ªæ–°çš„BroadcastReceiverã€‚æ–°å»ºAnotherBroadcastReceiverï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```kotlin\nclass AnotherBroadcastReceiver : BroadcastReceiver() {\n    override fun onReceive(context: Context, intent: Intent) {\n        Toast.makeText(context, \"received in AnotherBroadcastReceiver\",\n            Toast.LENGTH_SHORT).show()\n    }\n}\n```\n\nå¾ˆç®€å•ï¼Œè¿™é‡Œä»ç„¶æ˜¯åœ¨onReceiveæ–¹æ³•ä¸­å¼¹å‡ºäº†ä¸€æ®µæ–‡æœ¬ä¿¡æ¯ã€‚\n\nç„¶ååœ¨AndroidManifest.xmlä¸­å¯¹è¿™ä¸ªBroadcastReceiverçš„é…ç½®è¿›è¡Œä¿®æ”¹ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n    <uses-permission android:name=\"android.permission.RECEIVE_BOOT_COMPLETED\"/>\n    <application\n        ...>\n        <receiver\n            android:name=\".AnotherBroadcastReceiver\"\n            android:enabled=\"true\"\n            android:exported=\"true\">\n            <intent-filter>\n                <action android:name=\"com.example.broadcasttest.MY_BROADCAST\" />\n            </intent-filter>\n        </receiver>\n    </application>\n```\n\nå¯ä»¥çœ‹åˆ°ï¼ŒAnotherBroadcastReceiveråŒæ ·æ¥æ”¶çš„æ˜¯`com.example.broadcasttest.MY_BROADCAST`è¿™æ¡å¹¿æ’­ã€‚ç°åœ¨é‡æ–°è¿è¡Œç¨‹åºï¼Œå¹¶ç‚¹å‡»\"Send Broadcast\"æŒ‰é’®ï¼Œå°±ä¼šåˆ†åˆ«å¼¹å‡ºä¸¤æ¬¡æç¤ºä¿¡æ¯ã€‚\n\nä¸è¿‡ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œç¨‹åºå‘å‡ºçš„éƒ½æ˜¯æ ‡å‡†å¹¿æ’­ã€‚ç°åœ¨æˆ‘ä»¬æ¥å°è¯•ä¸€ä¸‹å‘é€æœ‰åºå¹¿æ’­ã€‚é‡æ–°å›åˆ°BroadcastTesté¡¹ç›®ï¼Œç„¶åä¿®æ”¹MainActivityä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```kotlin\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n        val button: Button = findViewById(R.id.button)\n        button.setOnClickListener {\n            val intent = Intent(\"com.example.broadcasttest.MY_BROADCAST\")\n            intent.setPackage(packageName)\n            // modify\n            sendOrderedBroadcast(intent, null)\n        }\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œå‘é€æœ‰åºå¹¿æ’­åªéœ€è¦æ”¹åŠ¨ä¸€è¡Œä»£ç ï¼Œå³å°†sendBroadcastæ–¹æ³•æ”¹æˆsendOrderedBroadcastæ–¹æ³•ã€‚send0rderedBroadcastæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°ä»ç„¶æ˜¯Intentï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ª**ä¸æƒé™ç›¸å…³çš„å­—ç¬¦ä¸²**ï¼Œè¿™é‡Œä¼ å…¥nullå°±è¡Œäº†ã€‚ç°åœ¨é‡æ–°è¿è¡Œç¨‹åºï¼Œå¹¶ç‚¹å‡»\"Send Broadcast\"æŒ‰é’®ï¼Œä½ ä¼šå‘ç°ï¼Œä¸¤ä¸ªBroadcastReceiverä»ç„¶éƒ½å¯ä»¥æ”¶åˆ°è¿™æ¡å¹¿æ’­ã€‚\n\nçœ‹ä¸Šå»å¥½åƒå’Œæ ‡å‡†å¹¿æ’­å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚ä¸è¿‡åˆ«å¿˜äº†ï¼Œè¿™ä¸ªæ—¶å€™çš„BroadcastReceiveræ˜¯æœ‰å…ˆåé¡ºåºçš„ï¼Œè€Œä¸”å‰é¢çš„BroadcastReceiverè¿˜å¯ä»¥å°†å¹¿æ’­æˆªæ–­ï¼Œä»¥é˜»æ­¢å…¶ç»§ç»­ä¼ æ’­ã€‚\n\nè®¾å®šBroadcastReceiverçš„å…ˆåé¡ºåºï¼šåœ¨æ³¨å†Œçš„æ—¶å€™è¿›è¡Œè®¾å®šã€‚ä¿®æ”¹AndroidManifest.xmlä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n<receiver\n    android:name=\".MyBroadcastReceiver\"\n    android:enabled=\"true\"\n    android:exported=\"true\">\n                   <!-- + -->\n    <intent-filter android:priority=\"100\">\n        <action android:name=\"com.example.broadcasttest.MY_BROADCAST\"/>\n    </intent-filter>\n</receiver>\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬é€šè¿‡`android:priority`å±æ€§ç»™`BroadcastReceiver`è®¾ç½®äº†ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§æ¯”è¾ƒé«˜çš„BroadcastReceiverå°±å¯ä»¥å…ˆæ”¶åˆ°å¹¿æ’­ã€‚è¿™é‡Œå°†MyBroadcastReceiverçš„ä¼˜å…ˆçº§è®¾æˆäº†100ã€‚ä»¥ä¿è¯å®ƒä¸€å®šä¼šåœ¨AnotherBroadcastReceiverä¹‹å‰æ”¶åˆ°å¹¿æ’­ã€‚\n\næ—¢ç„¶å·²ç»è·å¾—äº†æ¥æ”¶å¹¿æ’­çš„ä¼˜å…ˆæƒï¼Œé‚£ä¹ˆMyBroadcastReceiverå°±å¯ä»¥é€‰æ‹©æ˜¯å¦å…è®¸å¹¿æ’­ç»§ç»­ä¼ é€’äº†ã€‚ä¿®æ”¹MyBroadcastReceiverä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```kotlin\nclass MyBroadcastReceiver : BroadcastReceiver() {\n    override fun onReceive(context: Context, intent: Intent) {\n        Toast.makeText(context, \"received in MyBroadcastReceiver\",\n            Toast.LENGTH_SHORT).show()\n        // modify\n        abortBroadcast()\n    }\n}\n```\n\nå¦‚æœåœ¨onReceiveæ–¹æ³•ä¸­è°ƒç”¨äº†abortBroadcastæ–¹æ³•ï¼Œå°±è¡¨ç¤ºå°†è¿™æ¡å¹¿æ’­æˆªæ–­ï¼Œåé¢çš„BroadcastReceiverå°†æ— æ³•å†æ¥æ”¶åˆ°è¿™æ¡å¹¿æ’­ã€‚\n\nç°åœ¨é‡æ–°è¿è¡Œç¨‹åºï¼Œå¹¶ç‚¹å‡»\"Send Broadcast\"æŒ‰é’®ï¼Œä½ ä¼šå‘ç°åªæœ‰MyBroadcastReceiverä¸­çš„Toastä¿¡æ¯èƒ½å¤Ÿå¼¹å‡ºï¼Œè¯´æ˜è¿™æ¡å¹¿æ’­ç»è¿‡MyBroadcastReceiverä¹‹åç¡®å®ç»ˆæ­¢ä¼ é€’äº†ã€‚","categories":["Android"]},{"title":"Linux_vim_\".\"å‘½ä»¤","url":"/Linux/Linux_vim_.å‘½ä»¤/","content":"\n# `.`å‘½ä»¤\n\n`.`å‘½ä»¤å¯ä»¥è®©æˆ‘ä»¬é‡å¤ä¸Šæ¬¡çš„ä¿®æ”¹ï¼Œå®ƒæ˜¯vimä¸­æœ€ä¸ºå¼ºå¤§çš„å¤šé¢æ‰‹ã€‚\n\né¦–å…ˆæˆ‘ä»¬è¦é—®âˆ¶\"ç©¶ç«Ÿä»€ä¹ˆæ˜¯ä¿®æ”¹ï¼Ÿ\"\n\n\"ä¸Šæ¬¡ä¿®æ”¹\"å¯ä»¥æŒ‡å¾ˆå¤šä¸œè¥¿ï¼Œä¸€æ¬¡ä¿®æ”¹çš„å•ä½å¯ä»¥æ˜¯å­—ç¬¦ã€æ•´è¡Œï¼Œç”šè‡³æ˜¯æ•´ä¸ªæ–‡ä»¶ã€‚\n\n# ä¾‹å­ï¼šåˆ é™¤xã€dd\n\n`x`å‘½ä»¤ä¼šåˆ é™¤å…‰æ ‡ä¸‹çš„å­—ç¬¦ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨ã€‚å‘½ä»¤\"é‡å¤ä¸Šæ¬¡ä¿®æ”¹\"æ—¶ï¼Œå°±ä¼šè®©Vimåˆ é™¤å…‰æ ‡ä¸‹çš„å­—ç¬¦ã€‚\n\n![image-20220831180112530](../../images/Linux_vim_.å‘½ä»¤/image-20220831180112530.png)\n\nddå‘½ä»¤ä¹Ÿåšåˆ é™¤æ“ä½œï¼Œä½†å®ƒä¼šæŠŠæ•´è¡Œä¸€èµ·åˆ æ‰ã€‚å¦‚æœåœ¨ddåä½¿ç”¨ã€å‘½ä»¤ï¼Œé‚£ä¹ˆ\"é‡å¤ä¸Šæ¬¡ä¿®æ”¹\"ä¼šè®© Vimåˆ é™¤å½“å‰è¡Œã€‚\n\n# ä¾‹å­ï¼šç¼©è¿›`>G`\n\næœ€åï¼Œ`>G`å‘½ä»¤ä¼šå¢åŠ ä»å½“å‰è¡Œåˆ°æ–‡æ¡£æœ«å°¾å¤„çš„ç¼©è¿›å±‚çº§ã€‚å¦‚æœåœ¨æ­¤å‘½ä»¤åä½¿ç”¨å‘½ä»¤ï¼Œé‚£ä¹ˆ\"é‡å¤ä¸Šæ¬¡ä¿®æ”¹\"ä¼šè®©Vimå¢åŠ ä»å½“å‰è¡Œåˆ°æ–‡æ¡£æœ«å°¾çš„ç¼©è¿›å±‚çº§ã€‚åœ¨ä¸‹ä¾‹ä¸­ï¼Œè®©å…‰æ ‡ä»ç¬¬äºŒè¡Œå¼€å§‹ï¼ˆvimä¸­ï¼Œ`j`ä»£è¡¨å‘ä¸‹ï¼Œ`k`ä»£è¡¨å‘ä¸Šï¼Œ`h`ä»£è¡¨å‘å·¦ï¼Œ`l`ä»£è¡¨å‘å³ï¼‰ï¼Œä»¥ä¾¿ä¸€ç›®äº†ç„¶åœ°çœ‹å‡ºå·®åˆ«ã€‚\n\n![image-20220831201942872](../../images/Linux_vim_.å‘½ä»¤/image-20220831201942872.png)\n\n## æ€»ç»“\n\n`j`ä»£è¡¨å‘ä¸‹ï¼Œ`k`ä»£è¡¨å‘ä¸Šï¼Œ`h`ä»£è¡¨å‘å·¦ï¼Œ`l`ä»£è¡¨å‘å³ã€‚\n\n# vimä¼šè®°å½•æ¯ä¸€ä¸ªæŒ‰é”®æ“ä½œï¼š`.`å‘½ä»¤æ˜¯ä¸€ä¸ªå¾®å‹çš„å®\n\n`x`ã€`dd`ä»¥åŠ`>`å‘½ä»¤éƒ½æ˜¯åœ¨æ™®é€šæ¨¡å¼ä¸­æ‰§è¡Œçš„å‘½ä»¤ï¼Œä¸è¿‡ï¼Œæ¯æ¬¡è¿›å…¥æ’å…¥æ¨¡å¼æ—¶ï¼Œä¹Ÿä¼šå½¢æˆä¸€æ¬¡ä¿®æ”¹ã€‚ä»è¿›å…¥æ’å…¥æ¨¡å¼çš„é‚£ä¸€åˆ»èµ·ï¼ˆä¾‹å¦‚ï¼Œè¾“å…¥`i`ï¼‰ï¼Œç›´åˆ°è¿”å›æ™®é€šæ¨¡å¼æ—¶ä¸ºæ­¢ï¼ˆè¾“å…¥`<Esc>`ï¼‰ï¼ŒVimä¼šè®°å½•æ¯ä¸€ä¸ªæŒ‰é”®æ“ä½œã€‚åšå‡ºè¿™æ ·ä¸€ä¸ªä¿®æ”¹åå†ç”¨å‘½ä»¤çš„è¯ï¼Œå®ƒå°†ä¼šé‡æ–°æ‰§è¡Œæ‰€æœ‰è¿™äº›æŒ‰é”®æ“ä½œï¼ˆåœ¨æ’å…¥æ¨¡å¼ä¸­ç§»åŠ¨å…‰æ ‡ä¹Ÿä¼šé‡ç½®ä¿®æ”¹çŠ¶æ€ï¼‰ã€‚\n\nvimå¯ä»¥å½•åˆ¶ä»»æ„æ•°ç›®çš„æŒ‰é”®æ“ä½œï¼Œç„¶ååœ¨ä»¥åé‡å¤æ‰§è¡Œå®ƒä»¬ã€‚è¿™è®©æˆ‘ä»¬å¯ä»¥æŠŠæœ€å¸¸é‡å¤çš„å·¥ä½œæµç¨‹å½•åˆ¶ä¸‹æ¥ï¼Œå¹¶ç”¨ä¸€ä¸ªæŒ‰é”®é‡æ”¾å®ƒä»¬ã€‚å¯ä»¥æŠŠ`.`å‘½ä»¤å½“æˆä¸€ä¸ªå¾ˆå°çš„å®ï¼ˆmacroï¼‰ã€‚\n\n# å‡å°‘æ— å…³çš„ç§»åŠ¨\n\nåœ¨æ¯è¡Œçš„ç»“å°¾æ·»åŠ ä¸€ä¸ªåˆ†å·ã€‚è¦å®ç°è¿™ä¸€ç‚¹ï¼Œå…ˆå¾—æŠŠå…‰æ ‡ç§»åˆ°è¡Œå°¾ï¼Œç„¶ååˆ‡æ¢åˆ°æ’å…¥æ¨¡å¼è¿›è¡Œä¿®æ”¹ã€‚`$`å‘½ä»¤å¯ä»¥å®Œæˆç§»åŠ¨åŠ¨ä½œï¼Œæ¥ç€å°±å¯ä»¥æ‰§è¡Œ`a;<Esc>`å®Œæˆä¿®æ”¹äº†ã€‚\n\nè¦å®Œæˆå…¨éƒ¨ä¿®æ”¹ï¼Œéœ€è¦å¯¹æ‰€æœ‰è¡Œåšå®Œå…¨ç›¸åŒçš„æ“ä½œï¼Œä½†æ˜¯ï¼Œç”±äºå‘½ä»¤å¯ä»¥é‡å¤ä¸Šæ¬¡çš„ä¿®æ”¹ï¼Œå› æ­¤ä¸å¿…é‡å¤ä¹‹å‰çš„æ“ä½œï¼Œè€Œæ˜¯æ‰§è¡Œä¸¤æ¬¡`j$.`ã€‚ä¸€ä¸ª`.`é”®é¡¶3ä¸ª`a;<Esc>`ï¼Œè™½ç„¶æ¯æ¬¡çœå¾—å¹¶ä¸å¤šï¼Œä¸è¿‡åœ¨é‡å¤æ“ä½œæ—¶ï¼Œç´¯ç§¯æ•ˆåº”å¯ä¸å°ã€‚\n\n`j`å‘½ä»¤ä½¿å…‰æ ‡ä¸‹ç§»ä¸€è¡Œï¼Œè€Œ`$`å‘½ä»¤æŠŠå…‰æ ‡ç§»åˆ°è¡Œå°¾ã€‚æˆ‘ä»¬ç”¨äº†ä¸¤ä¸‹æŒ‰é”®ï¼Œä»…ä»…æ˜¯ä¸ºäº†æŠŠå…‰æ ‡ç§»åˆ°æŒ‡å®šä½ç½®ï¼Œä»¥ä¾¿å¯ä»¥ç”¨`.`å‘½ä»¤ã€‚åº”è¯¥è¿˜æœ‰æ”¹è¿›çš„ä½™åœ°ã€‚\n\n`a`å‘½ä»¤åœ¨å½“å‰å…‰æ ‡ä¹‹åæ·»åŠ å†…å®¹ï¼Œ`A`å‘½ä»¤åˆ™åœ¨å½“å‰è¡Œçš„ç»“å°¾æ·»åŠ å†…å®¹ã€‚ä¸ç®¡å…‰æ ‡å½“å‰å¤„äºä»€ä¹ˆä½ç½®ï¼Œè¾“å…¥`A`éƒ½ä¼šè¿›å…¥æ’å…¥æ¨¡å¼ï¼Œå¹¶æŠŠå…‰æ ‡ç§»åˆ°è¡Œå°¾ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒæŠŠ`$a`å°è£…æˆäº†ä¸€ä¸ªæŒ‰é”®æ“ä½œã€‚Vimæä¾›äº†ä¸å°‘è¿™æ ·çš„å¤åˆå‘½ä»¤ã€‚\n\n![image-20220831210516363](../../images/Linux_vim_.å‘½ä»¤/image-20220831210516363.png)\n\nç”¨`A`æ¥ä»£æ›¿`$a`ï¼Œå¤§å¤§æå‡äº†`.`å‘½ä»¤çš„æ•ˆç‡ã€‚ä¸å¿…å†æŠŠå…‰æ ‡ç§»åˆ°è¡Œå°¾ï¼Œåªéœ€ä¿è¯å®ƒä½äºè¯¥è¡Œå†…å°±è¡Œäº†ï¼ˆå¯åœ¨ä»»æ„ä½ç½®ï¼‰ã€‚ç°åœ¨å¯ä»¥é‡å¤æ‰§è¡Œè¶³å¤Ÿå¤šæ¬¡çš„`j.`ï¼Œå®Œæˆå¯¹åç»­è¡Œçš„ä¿®æ”¹ã€‚\n\nä¸€ä¸ªé”®ç§»åŠ¨ï¼Œå¦ä¸€ä¸ªé”®æ“ä½œï¼Œè¯·ç•™æ„è¿™ç§åº”ç”¨æ¨¡å¼ï¼Œæ›´å¤šçš„ä¾‹å­ä¸­å°†çœ‹åˆ°å®ƒçš„èº«å½±ã€‚\n\nè™½ç„¶è¿™ä¸€æ¨¡å¼å¯¹è¿™ä¸ªç®€çŸ­çš„ä¾‹å­æ¥è¯´å¾ˆå¥½ç”¨ï¼Œä½†å®ƒä¸æ˜¯ä¸‡èƒ½çš„ã€‚è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬ä¸å¾—ä¸ç»™è¿ç»­50è¡Œæ·»åŠ åˆ†å·ï¼Œå³ä¾¿æ¯ä¿®æ”¹ä¸€æ¬¡è¾“ä¸€æ¬¡`j`ï¼Œçœ‹èµ·æ¥ä¹Ÿæ˜¯ä¸€é¡¹å¾ˆç¹é‡çš„å·¥ä½œã€‚\n\n## ä¸€ç®­åŒé›•\n\næˆ‘ä»¬å¯ä»¥è¿™æ ·è¯´ï¼ŒAå‘½ä»¤æŠŠä¸¤ä¸ªåŠ¨ä½œï¼ˆ`$a`ï¼‰åˆå¹¶æˆäº†ä¸€æ¬¡æŒ‰é”®ï¼Œä¸è¿‡å®ƒä¸æ˜¯å”¯ä¸€ä¸€ä¸ªè¿™æ ·çš„å‘½ä»¤ï¼Œå¾ˆå¤šVimçš„å•é”®å‘½ä»¤éƒ½å¯ä»¥è¢«çœ‹æˆä¸¤ä¸ªæˆ–å¤šä¸ªå…¶ä»–å‘½ä»¤çš„ç»„åˆï¼Œä¸‹è¡¨åˆ—å‡ºäº†ç±»ä¼¼çš„ä¸€äº›ä¾‹å­ï¼Œæ‰¾å‡ºå®ƒä»¬ä¹‹é—´åˆ«çš„å…±åŒç‚¹ã€‚\n\n| å¤åˆå‘½ä»¤ | ç­‰æ•ˆçš„é•¿å‘½ä»¤                                                 |\n| -------- | ------------------------------------------------------------ |\n| C        | `c$`                                                         |\n| s        | `cl`                                                         |\n| S        | `^C`                                                         |\n| `|`      | `^i`ï¼ˆ`^`å‘½ä»¤æ˜¯ç§»åˆ°è¡Œé¦–ï¼Œ`i`æ˜¯è¿›å…¥æ’å…¥æ¨¡å¼ï¼Œå…¶å®ä¹Ÿç­‰æ•ˆäº`I`ï¼‰ |\n| A        | `$a`                                                         |\n| o        | `A<CR>`                                                      |\n| O        | `ko`                                                         |\n\næ¯”å¦‚ï¼šè¾“å…¥`ko`ï¼Œç­‰äºè¾“å…¥äº†`k$a<CR>`ã€‚\n\nå®ƒä»¬å…¨éƒ½ä¼šä»æ™®é€šæ¨¡å¼åˆ‡æ¢åˆ°æ’å…¥æ¨¡å¼ã€‚è¿™å¯¹`.`å‘½ä»¤å¯èƒ½äº§ç”Ÿå½±å“ã€‚\n\n# ä½¿ä¿®æ”¹ã€ç§»åŠ¨å¯é‡å¤ï¼š`;`å’Œ`s`å‘½ä»¤\n\nåœ¨ä¸€ä¸ªå­—ç¬¦å‰åå„æ·»åŠ ä¸€ä¸ªç©ºæ ¼ã€‚ä»¥åƒä¸‹é¢è¿™æ ·åœ¨+å·å‰åå„æ·»åŠ ä¸€ä¸ªç©ºæ ¼ï¼Œè®©è‚‰çœ¼æ›´å®¹æ˜“è¯†åˆ«ã€‚\n\n```\nvar foo = \"method(\" + argument1 + \",\" + argument2 + \")\";\n```\n\n`s`å‘½ä»¤æŠŠä¸¤ä¸ªæ“ä½œåˆå¹¶ä¸ºä¸€ä¸ªï¼šå®ƒå…ˆåˆ é™¤å…‰æ ‡ä¸‹çš„å­—ç¬¦ï¼Œç„¶åè¿›å…¥æ’å…¥æ¨¡å¼ã€‚åœ¨åˆ é™¤ï¼‹å·åï¼Œå…ˆè¾“å…¥`ç©ºæ ¼ + ç©ºæ ¼`ï¼Œç„¶åé€€å‡ºæ’å…¥æ¨¡å¼ã€‚\n\nå…ˆåé€€ä¸€æ­¥ï¼Œç„¶åå‰è¿›ä¸‰æ­¥ï¼Œè¿™æ˜¯ä¸ªå¥‡æ€ªçš„å°èŠ±æ‹›ï¼Œçœ‹èµ·æ¥å¯èƒ½ä¸å¤Ÿç›´æ¥ã€‚ä½†è¿™æ ·åšæœ€å¤§çš„å¥½å¤„æ˜¯ï¼šæˆ‘ä»¬å¯ä»¥ç”¨`.`å‘½ä»¤é‡å¤è¿™ä¸€ä¿®æ”¹ã€‚æˆ‘ä»¬æ‰€è¦åšçš„åªæ˜¯æŠŠå…‰æ ‡ç§»åˆ°ä¸‹ä¸€ä¸ª+å·å¤„ï¼Œç„¶åç”¨`.`å‘½ä»¤é‡å¤è¿™ä¸€æ“ä½œå³å¯ã€‚\n\nä½†æ˜¯ç§»åŠ¨å…‰æ ‡åˆ°æŒ‡å®šä½ç½®è¿˜æ˜¯å¤ªéº»çƒ¦äº†ã€‚\n\n`f{char}`å‘½ä»¤è®©VimæŸ¥æ‰¾ä¸‹ä¸€å¤„æŒ‡å®šå­—ç¬¦å‡ºç°çš„ä½ç½®ï¼Œå¦‚æœæ‰¾åˆ°äº†ï¼Œå°±ç›´æ¥æŠŠå…‰æ ‡ç§»åˆ°é‚£é‡Œã€‚å› æ­¤ï¼Œè¾“å…¥`f+`æ—¶ï¼Œå…‰æ ‡ä¼šç›´æ¥ç§»åˆ°ä¸‹ä¸€ä¸ª+å·æ‰€åœ¨çš„ä½ç½®ã€‚\n\nå®Œæˆç¬¬ä¸€å¤„ä¿®æ”¹åï¼Œå¯ä»¥é‡å¤æŒ‰`f+`å‘½ä»¤è·³åˆ°ä¸‹ä¸€ä¸ª+å·æ‰€åœ¨çš„ä½ç½®ã€‚ä¸è¿‡ï¼Œè¿˜æœ‰ä¸€ç§æ›´å¥½çš„æ–¹æ³•å¯ä»¥ç”¨ï¼š`;`å‘½ä»¤ä¼šé‡å¤æŸ¥æ‰¾ä¸Šæ¬¡`f`å‘½ä»¤æ‰€æŸ¥æ‰¾çš„å­—ç¬¦ï¼Œå› æ­¤ä¸ç”¨è¾“å…¥4æ¬¡`f+`ï¼Œè€Œæ˜¯åªè¾“å…¥ä¸€æ¬¡ï¼Œåé¢è·Ÿç€å†ç”¨3æ¬¡`;`å‘½ä»¤ã€‚\n\n`;`å‘½ä»¤å¸¦æˆ‘ä»¬åˆ°ä¸‹ä¸€ä¸ªç›®æ ‡å­—ç¬¦ä¸Šï¼Œ`.`å‘½ä»¤åˆ™é‡å¤ä¸Šæ¬¡çš„ä¿®æ”¹ã€‚å› æ­¤ï¼Œå¯ä»¥è¿ç»­è¾“å…¥3æ¬¡`;.`æ¥å®Œæˆå…¨éƒ¨ä¿®æ”¹ã€‚ä¸å…¶å’ŒVimåŒºåˆ†æ¨¡å¼çš„ç¼–è¾‘æ¨¡å‹åšæ–—äº‰ï¼Œå€’ä¸å¦‚ä¸å®ƒä¸€èµ·ååŒå·¥ä½œã€‚ç„¶åï¼Œå°±èƒ½æŠŠç‰¹å®šä»»åŠ¡å˜å¾—å®¹æ˜“â€”â€”åœ¨é¢å¯¹é‡å¤æ€§å·¥ä½œæ—¶ï¼Œæˆ‘ä»¬éœ€è¦è®©ç§»åŠ¨åŠ¨ä½œå’Œä¿®æ”¹éƒ½èƒ½å¤Ÿé‡å¤ï¼Œè¿™æ ·å°±å¯ä»¥è¾¾åˆ°æœ€ä½³ç¼–è¾‘æ¨¡å¼ã€‚\n\n## æ€»ç»“\n\n1. `s`é”®å…ˆåˆ é™¤å…‰æ ‡ä¸‹çš„å­—ç¬¦ï¼Œç„¶åè¿›å…¥æ’å…¥æ¨¡å¼\n2. `f{char}`å‘½ä»¤æŸ¥æ‰¾ä¸‹ä¸€å¤„æŒ‡å®šå­—ç¬¦å‡ºç°çš„ä½ç½®ï¼Œå¦‚æœæ‰¾åˆ°äº†ï¼Œå°±ç›´æ¥æŠŠå…‰æ ‡ç§»åˆ°é‚£é‡Œ\n3. `;`å‘½ä»¤ä¼šé‡å¤æŸ¥æ‰¾ä¸Šæ¬¡`f`å‘½ä»¤æ‰€æŸ¥æ‰¾çš„å­—ç¬¦\n4. `.`å‘½ä»¤é‡å¤ä¸Šæ¬¡çš„ä¿®æ”¹\n\n# å‡ å¯¹å„¿é‡å¤å’Œå›é€€\n\nå¦‚æœæˆ‘ä»¬çŸ¥é“å¦‚ä½•é‡å¤ä¹‹å‰çš„æ“ä½œï¼Œè€Œæ— éœ€æ¯æ¬¡éƒ½è¾“å…¥æ•´æ¡å‘½ä»¤ï¼Œé‚£ä¹ˆå°±ä¼šè·å¾—æ›´é«˜çš„æ•ˆç‡ã€‚å¯ä»¥å…ˆæ‰§è¡Œä¸€æ¬¡ï¼Œéšååªéœ€é‡å¤å³å¯ã€‚\n\nç„¶è€Œï¼Œè¿™ä¹ˆå°‘çš„æŒ‰é”®å°±å¯ä»¥å®Œæˆè¿™ä¹ˆå¤šçš„äº‹æƒ…ï¼Œéœ€è¦å¾ˆå°å¿ƒåœ°æ“ä½œæ‰è¡Œï¼Œä¸ç„¶å°±å¾ˆå®¹æ˜“å‡ºé”™ã€‚å½“ä¸€éåˆä¸€éåœ°è¿ç»­æŒ‰`j.j.j.`ï¼ˆ`j`ï¼Œå‘ä¸‹ä¸€è¡Œï¼‰æ—¶ï¼Œé‚£ç§æ„Ÿè§‰å°±åƒæ˜¯åœ¨æ•²é¼“ã€‚å¯æ˜¯ï¼Œå¦‚æœä¸å°å¿ƒåœ¨ä¸€è¡Œä¸Šæ•²äº†ä¸¤æ¬¡`j`é”®ï¼Œæˆ–æ•²äº†ä¸¤æ¬¡`.`é”®ï¼Œå°±å¾ˆéº»çƒ¦ã€‚å½“Vimè®©ä¸€ä¸ªæ“ä½œæˆ–ç§»åŠ¨å¯ä»¥å¾ˆæ–¹ä¾¿åœ°é‡å¤æ—¶ï¼Œå®ƒæ€»æ˜¯ä¼šæä¾›æŸç§æ–¹å¼èƒ½å›é€€å›æ¥ã€‚å¯¹å‘½ä»¤è€Œè¨€ï¼Œå¯ä»¥æŒ‰`u`é”®æ’¤é”€ä¸Šæ¬¡çš„ä¿®æ”¹ã€‚å¦‚æœåœ¨ä½¿ç”¨`f{char}`å‘½ä»¤åï¼Œä¸å°å¿ƒæŒ‰äº†å¤ªå¤šæ¬¡`;`é”®ï¼Œå°±ä¼šåç¦»æˆ‘ä»¬çš„ç›®æ ‡ã€‚ä¸è¿‡å¯ä»¥å†æŒ‰`,`é”®è·³å›å»ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šåæ–¹å‘æŸ¥æ‰¾ä¸Šæ¬¡`f{char}`æ‰€æŸ¥æ‰¾çš„å­—ç¬¦ã€‚\n\nVimä¸­å¯é‡å¤æ‰§è¡Œçš„å‘½ä»¤ï¼Œä»¥åŠç›¸åº”çš„å›é€€æ–¹å¼ã€‚\n\n| ç›®çš„                       | æ“ä½œ                    | é‡å¤ | å›é€€ |\n| -------------------------- | ----------------------- | ---- | ---- |\n| åšå‡ºä¸€ä¸ªä¿®æ”¹               | `{edit}`                | `.`  | `u`  |\n| åœ¨è¡Œå†…æŸ¥æ‰¾ä¸‹ä¸€æŒ‡å®šå­—ç¬¦     | `f{char}`/`t{char}`     | `;`  | `,`  |\n| åœ¨è¡Œå†…æŸ¥æ‰¾ä¸Šä¸€æŒ‡å®šå­—ç¬¦     | `F{char}`/`T{char}`     | `;`  | `,`  |\n| æ–‡æ¡£ä¸­æŸ¥æ‰¾ä¸‹ä¸€å¤„åŒ¹é…å­—ç¬¦ä¸² | `/pattern<CR>`          | `n`  | `N`  |\n| æ–‡æ¡£ä¸­æŸ¥æ‰¾ä¸Šä¸€å¤„åŒ¹é…å­—ç¬¦ä¸² | `?pattern<CR>`          | `n`  | `N`  |\n| æ‰§è¡Œæ›¿æ¢                   | `:s/target/replacement` | `&`  | `u`  |\n| æ‰§è¡Œä¸€ç³»åˆ—ä¿®æ”¹             | `qx{changes}q`          | `@x` | `u`  |\n\n# `.`èŒƒå¼\n\næˆ‘ä»¬æƒ³åœ¨ä¸€ç³»åˆ—è¡Œçš„ç»“å°¾æ·»åŠ åˆ†å·ã€‚æˆ‘ä»¬å…ˆç”¨`A[è¿›å…¥æ’å…¥æ¨¡å¼] ;<Esc>`ä¿®æ”¹äº†ç¬¬ä¸€è¡Œï¼Œåšå®Œè¿™æ­¥å‡†å¤‡åï¼Œå°±å¯ä»¥ä½¿ç”¨`.`å‘½ä»¤å¯¹åç»­è¡Œé‡å¤æ­¤ä¿®æ”¹ã€‚æˆ‘ä»¬ä½¿ç”¨äº†`j`å‘½ä»¤åœ¨è¡Œé—´ç§»åŠ¨ï¼Œè¦å®Œæˆå‰©ä½™çš„ä¿®æ”¹ï¼Œåªéœ€ç®€å•åœ°æŒ‰è¶³å¤Ÿå¤šæ¬¡`j.`å°±å¯ä»¥äº†ã€‚\n\næˆ‘ä»¬æƒ³ä¸ºæ¯ä¸ª`+`å·çš„å‰åå„æ·»åŠ ä¸€ä¸ªç©ºæ ¼ã€‚å…ˆç”¨`f+`å‘½ä»¤è·³åˆ°ç›®æ ‡å­—ç¬¦ä¸Šï¼Œç„¶åç”¨`s`å‘½ä»¤æŠŠä¸€ä¸ªå­—ç¬¦æ›¿æ¢æˆ3ä¸ªï¼Œåšå®Œè¿™æ­¥å‡†å¤‡åï¼Œå°±å¯ä»¥æŒ‰è‹¥å¹²æ¬¡`;.`å®Œæˆæ­¤ä»»åŠ¡ã€‚\n\næˆ‘ä»¬æƒ³æŠŠæ¯å¤„å‡ºç°å•è¯\"content\"çš„åœ°æ–¹éƒ½æ›¿æ¢æˆ\"copy\"ã€‚ä½¿ç”¨`*`å‘½ä»¤æ¥æŸ¥æ‰¾ç›®æ ‡å•è¯ï¼Œç„¶åç”¨`cw`å‘½ä»¤ä¿®æ”¹ç¬¬ä¸€å¤„åœ°æ–¹ã€‚åšå®Œè¿™æ­¥å‡†å¤‡åï¼Œå°±å¯ä»¥ç”¨`n`é”®è·³åˆ°ä¸‹ä¸€åŒ¹é…é¡¹ï¼Œç„¶åç”¨`.`é”®åšç›¸åŒçš„ä¿®æ”¹ã€‚è¦å®Œæˆè¿™é¡¹ä»»åŠ¡ï¼Œåªéœ€ç®€å•åœ°æŒ‰è¶³å¤Ÿå¤šæ¬¡`n.`å°±è¡Œäº†ã€‚\n\nç†æƒ³æ¨¡å¼ï¼šç”¨ä¸€é”®ç§»åŠ¨ï¼Œå¦ä¸€é”®æ‰§è¡Œ\n\næ‰€æœ‰è¿™äº›ä¾‹å­éƒ½åˆ©ç”¨`.`å‘½ä»¤é‡å¤ä¸Šæ¬¡çš„ä¿®æ”¹ï¼Œä¸è¿‡è¿™ä¸æ˜¯å®ƒä»¬å”¯ä¸€çš„å…±åŒç‚¹ï¼Œå¦å¤–çš„å…±åŒç‚¹æ˜¯å®ƒä»¬éƒ½åªéœ€è¦æŒ‰ä¸€æ¬¡é”®å°±èƒ½æŠŠå…‰æ ‡ç§»åˆ°ä¸‹ä¸€ä¸ªç›®æ ‡ä¸Šã€‚\n\nç”¨ä¸€æ¬¡æŒ‰é”®ç§»åŠ¨ï¼Œå¦ä¸€æ¬¡æŒ‰é”®æ‰§è¡Œï¼Œå†æ²¡æœ‰æ¯”è¿™æ›´å¥½çš„äº†ï¼Œè¿™å°±æ˜¯ç†æƒ³çš„è§£å†³æ–¹æ¡ˆã€‚è¿™ä¸€ç¼–è¾‘æ¨¡å¼ï¼ŒæŠŠå®ƒå«åš\"`.`èŒƒå¼\"ã€‚\n\n## æ€»ç»“\n\n| æŒ‰é”®      | ä½œç”¨                                         |\n| --------- | -------------------------------------------- |\n| A         | ç§»åˆ°è¡Œå°¾å¹¶è¿›å…¥æ’å…¥æ¨¡å¼                       |\n| j         | å…‰æ ‡å‘ä¸‹ä¸€è¡Œ                                 |\n| `f{char}` | å…‰æ ‡ç§»åˆ°ä¸‹ä¸€ä¸ªcharå­—ç¬¦                       |\n| s         | æŠŠå…‰æ ‡ä¸‹ä¸€ä¸ªå­—ç¬¦åˆ é™¤ï¼Œè¿›å…¥æ’å…¥æ¨¡å¼           |\n| `;`       | æ‰¾ä¸‹ä¸€ä¸ªæŒ‡å®šçš„å­—ç¬¦                           |\n| `*`       | æŸ¥æ‰¾å½“å‰å…‰æ ‡ä¸‹çš„å•è¯ï¼Œå¹¶æŠŠå…‰æ ‡ç§»åˆ°ä¸‹ä¸€ä¸ªå•è¯ |\n| cw        | åˆ é™¤å…‰æ ‡ä¸‹çš„å•è¯ï¼Œè¿›å…¥æ’å…¥æ¨¡å¼               |\n\n`.`å‘½ä»¤è®°å½•çš„æ˜¯ä»è¿›å…¥æ’å…¥æ¨¡å¼åï¼Œåˆ°é€€å‡ºæ’å…¥æ¨¡å¼è¾“å…¥çš„å‘½ä»¤\n","categories":["Linux","vim"]},{"title":"Linux_vim_\"*\"å‘½ä»¤","url":"/Linux/Linux_vim_æ˜Ÿå·å‘½ä»¤/","content":"\n# `@.`/`&`é‡å¤Exå‘½ä»¤\n\n`@:`å¯ä»¥ç”¨æ¥é‡å¤ä»»æ„Exå‘½ä»¤ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥è¾“å…¥`&`æ¥é‡å¤ä¸Šæ¬¡çš„`:substitute`å‘½ä»¤ï¼ˆæœ¬èº«ä¹Ÿæ˜¯ä¸€æ¡Exå‘½ä»¤ï¼‰ã€‚\n\nVimæä¾›äº†ä¸€ä¸ª`:substitute`å‘½ä»¤ä¸“é—¨ç”¨äºæŸ¥æ‰¾æ›¿æ¢ä»»åŠ¡ï¼Œä¸è¿‡ç”¨ä¸Šé¢ä»‹ç»çš„æŠ€æœ¯ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨ä¿®æ”¹ç¬¬ä¸€å¤„åœ°æ–¹ï¼Œç„¶åå†ä¸€ä¸ªä¸ªåœ°æŸ¥æ‰¾æ›¿æ¢å…¶ä»–åŒ¹é…é¡¹ã€‚`.`å‘½ä»¤å¯ä»¥æŠŠæˆ‘ä»¬ä»ç¹é‡çš„å·¥ä½œä¸­è§£æ”¾å‡ºæ¥ï¼Œè€Œå³å°†ç™»åœºçš„å¦ä¸€ä¸ªæœ‰ç”¨çš„å•é”®å‘½ä»¤ï¼Œåˆ™èƒ½å¤Ÿè®©æˆ‘ä»¬æ–¹ä½¿åœ°åœ¨åŒ¹é…é¡¹é—´è·³è½¬ã€‚\n\nåœ¨ä¸‹é¢è¿™æ®µæ–‡æœ¬ä¸­ï¼Œæ¯ä¸€è¡Œéƒ½å‡ºç°äº†å•è¯\"content\"ã€‚\n\n```\n...We're waiting for content before the site can go live...\n...If you are content with this, let's go ahead with it...\n...We'll launch as soon as we have the content..\n```\n\nå‡è®¾æƒ³ç”¨å•è¯\"copy\"ï¼ˆæ„ä¹‰åŒ\"copywriting\"ï¼‰æ¥æ›¿ä»£\"content\"ã€‚ä¹Ÿè®¸åªè¦ç”¨æ›¿æ¢å‘½ä»¤å°±è¡Œäº†ï¼Œåƒä¸‹é¢è¿™æ ·ï¼š`:%s/content/copy/g`ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬è¿è¡Œä¸Šé¢è¿™æ¡å‘½ä»¤ï¼Œå°±ä¼šå‡ºç°\"If you are 'copy' with this,\"è¿™æ ·çš„å¥å­ï¼Œä¹‹æ‰€ä»¥ä¼šæœ‰è¿™ç§é—®é¢˜ï¼Œæ˜¯å› ä¸º\"content\"ä¸€è¯æœ‰ä¸¤ç§å«ä¹‰ï¼Œä¸€ä¸ªæ˜¯\"copy\"çš„åŒä¹‰è¯ï¼Œå¦ä¸€ä¸ªæ˜¯\"happy\"çš„åŒä¹‰è¯ã€‚ç”¨ä¸“ä¸šçš„è¯è¯´ï¼Œæˆ‘ä»¬æ˜¯åœ¨å¤„ç†æ‹¼å†™ç›¸åŒï¼Œä½†å«ä¹‰å’Œå‘éŸ³éƒ½ä¸åŒçš„è¯ã€‚æ‰€ä»¥åœ¨æ›¿æ¢æ—¶ï¼Œä¸€å®šè¦å°å¿ƒæ¯ä¸€æ­¥æ“ä½œã€‚ä¸èƒ½æƒ³å½“ç„¶åœ°ç”¨\"copy\"æ›¿æ¢æ¯ä¸€ä¸ª\"content\"ï¼Œè€Œæ˜¯è¦æ—¶åˆ»ç•™ç¥ï¼Œå¯¹æ¯ä¸ªåœ°\næ–¹éƒ½è¦é—®\"è¿™é‡Œè¦ä¿®æ”¹å—ï¼Ÿ\"ï¼Œç„¶åå›ç­”\"ä¿®æ”¹\"æˆ–è€…\"ä¸æ”¹\"ã€‚`:substitute`å‘½ä»¤èƒ½èƒœä»»è¿™é¡¹å·¥ä½œã€‚\n\n# `*`å‘½ä»¤--æŸ¥æ‰¾å½“å‰å…‰æ ‡ä¸‹çš„å•è¯\n\nå¯ä»¥å…ˆç”¨`/content`ï¼ŒæŠŠå…‰æ ‡ç§»åŠ¨åˆ°æŒ‡å®šçš„å•è¯ä¸Šã€‚ç„¶åæŒ‰`*`é”®ï¼Œå°±å¯ä»¥æ‰¾åˆ°ä¸‹ä¸€ä¸ªåŒè¯ã€‚\n\n![image-20220901180716483](../../images/Linux_vim_æ˜Ÿå·å‘½ä»¤/image-20220901180716483.png)\n\nåˆšå¼€å§‹ï¼ŒæŠŠå…‰æ ‡ç§»åˆ°å•è¯\"content\"ä¸Šï¼Œç„¶åä½¿ç”¨`*`å‘½ä»¤å¯¹å®ƒè¿›è¡ŒæŸ¥æ‰¾ã€‚è¿™ä¼šäº§ç”Ÿä¸¤ä¸ªç»“æœï¼šä¸€æ˜¯å…‰æ ‡è·³åˆ°ä¸‹ä¸€ä¸ªåŒ¹é…é¡¹çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸Šï¼ŒäºŒæ˜¯æ‰€æœ‰å‡ºç°è¿™ä¸ªè¯çš„åœ°æ–¹éƒ½è¢«é«˜äº®æ˜¾ç¤ºå‡ºæ¥ã€‚å¦‚æœæ²¡æœ‰çœ‹åˆ°é«˜äº®ï¼Œè¿è¡Œä¸€ä¸‹ `:set hls`ã€‚æ‰§è¡Œè¿‡ä¸€æ¬¡æŸ¥æ‰¾\"content\"çš„å‘½ä»¤åï¼Œç°åœ¨åªéœ€æŒ‰`n`é”®å°±å¯ä»¥è·³åˆ°ä¸‹ä¸€ä¸ªåŒ¹é…é¡¹ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼ŒæŒ‰ä¸€æ¬¡`*`ï¼Œä¸¤æ¬¡`n`ï¼Œä¼šéå†å®Œæ‰€æœ‰çš„åŒ¹é…é¡¹ï¼Œä»è€Œè·³å›åˆ°æœ¬æ¬¡æŸ¥æ‰¾çš„èµ·ç‚¹ã€‚\n\n## æ€»ç»“\n\n1. `*`å‘½ä»¤çš„ä½œç”¨æ˜¯å…‰æ ‡è·³åˆ°ä¸‹ä¸€ä¸ªåŒ¹é…é¡¹çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸Šã€‚æœ¬è´¨ä¸Šæ˜¯å…ˆ`/\\<content\\>`æœç´¢åŒ¹é…é¡¹ï¼Œåœ¨ç‚¹æŒ‰`n`ã€‚\n2. å¼€å¯æœç´¢åŒ¹é…é¡¹åŒæ—¶é«˜äº®ï¼š`:set hls`\n\n# ä½¿ä¿®æ”¹å¯é‡å¤\n\nå½“å…‰æ ‡ä½äº\"content\"çš„å¼€å¤´æ—¶ï¼Œå°±å¯ä»¥ç€æ‰‹ä¿®æ”¹å®ƒã€‚è¿™åŒ…æ‹¬ä¸¤æ­¥æ“ä½œï¼šé¦–å…ˆè¦åˆ é™¤å•è¯\"content\"ï¼Œç„¶åè¾“å…¥æ›¿ä»£çš„å•è¯ã€‚`cw`å‘½ä»¤ä¼šåˆ é™¤ä»å…‰æ ‡ä½ç½®åˆ°å•è¯ç»“å°¾é—´çš„å­—ç¬¦ï¼Œå¹¶è¿›å…¥æ’å…¥æ¨¡å¼ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥è¾“å…¥å•è¯\"copy\"äº†ã€‚**Vimä¼šæŠŠæˆ‘ä»¬ç¦»å¼€æ’å…¥æ¨¡å¼ä¹‹å‰çš„å…¨éƒ¨æŒ‰é”®æ“ä½œéƒ½è®°å½•ä¸‹æ¥**ï¼Œå› æ­¤æ•´ä¸ª`cw copy<Esc>`ä¼šè¢«å½“æˆä¸€ä¸ªä¿®æ”¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰§è¡Œ`.`å‘½ä»¤ä¼šåˆ é™¤ä»å…‰æ ‡åˆ°å½“å‰å•è¯ç»“å°¾é—´çš„å­—ç¬¦ï¼Œå¹¶æŠŠå®ƒä¿®æ”¹ä¸º\"copy\"ã€‚\n\n# åˆè€Œä¸ºä¸€\n\næ¯æ¬¡æŒ‰`n`é”®æ—¶ï¼Œå…‰æ ‡å°±ä¼šè·³åˆ°ä¸‹ä¸€ä¸ª\"content\"å•è¯æ‰€åœ¨ä¹‹å¤„ï¼Œè€ŒæŒ‰é”®æ—¶ï¼Œå®ƒå°±ä¼šæŠŠå…‰æ ‡ä¸‹çš„å•è¯æ”¹ä¸º\"copy\"ã€‚\n\nå¦‚æœæƒ³æ›¿æ¢æ‰€æœ‰åœ°æ–¹ï¼Œå°±å¯ä»¥ä¸åŠ æ€è€ƒåœ°ä¸€ç›´æŒ‰`n.n.n.`ä»¥å®Œæˆæ‰€æœ‰çš„ä¿®æ”¹ï¼ˆä½†æ˜¯ï¼Œè¿™ç§æƒ…å†µä¸‹ä¹Ÿå¯ä»¥ç”¨`:%s/content/copy/g`å‘½ä»¤ï¼‰ã€‚ç„¶è€Œï¼Œç”±äºæˆ‘ä»¬éœ€è¦ç•™æ„ä¸ç¬¦åˆè¦æ±‚çš„åŒ¹é…é¡¹ï¼Œæ‰€ä»¥åœ¨æŒ‰äº†`n`ä¹‹åï¼Œè¦å®¡è§†ä¸€ä¸‹å½“å‰çš„åŒ¹é…é¡¹ï¼Œç„¶åå†³å®šæ˜¯å¦æŠŠå®ƒæ”¹ä¸º\"copy\"ã€‚å¦‚æœéœ€è¦ä¿®æ”¹çš„è¯ï¼Œå°±æŒ‰`.`å‘½ä»¤ï¼Œåä¹‹åˆ™ä¸ç”¨ã€‚æ— è®ºå†³å®šæ˜¯ä»€ä¹ˆï¼Œéƒ½å¯ä»¥å†æ¬¡æŒ‰`n`ç§»åˆ°ä¸‹ä¸€ä¸ªåœ°æ–¹ï¼Œå¦‚æ­¤å¾ªç¯å¾€å¤ï¼Œç›´åˆ°å®Œæˆå…¨éƒ¨çš„ä¿®æ”¹ã€‚\n","categories":["Linux","vim"]},{"title":"Android_è¿›ç¨‹","url":"/Android/Android_è¿›ç¨‹/","content":"\n# Activityå¯åŠ¨åç”Ÿæˆå‡ ä¸ªThread\n\nActivityå¯åŠ¨åï¼Œé™¤äº†main threadï¼Œè¿˜æœ‰ä¸¤ä¸ªBinder Threadã€‚\n\n# ä¸»çº¿ç¨‹æ˜¯æ€ä¹ˆäº§ç”Ÿçš„\n\n1. ç”±ZygoteInitå¯åŠ¨ï¼Œç»ç”±ä¸€ç³»åˆ—ç³»ç»Ÿè°ƒç”¨åæœ€ç»ˆæ‰æ‰§è¡ŒActivityæœ¬èº«çš„onCreateå‡½æ•°ï¼ŒZygoteä¸ºActivityåˆ›å»ºçš„ä¸»çº¿ç¨‹æ˜¯ActivityThreadã€‚\n\n# Serviceçš„ä¸»çº¿ç¨‹æ˜¯ä»€ä¹ˆ\n\n1. Serviceä¹Ÿæ˜¯å¯„å­˜äºActivityThreadä¹‹ä¸­çš„ï¼Œå¹¶ä¸”å¯åŠ¨æµç¨‹å’ŒActivityåŸºæœ¬ä¸€è‡´ï¼›å³Activityå’ŒServiceåº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹éƒ½æ˜¯ActivityThreadã€‚\n2. å¯åŠ¨Serviceæ—¶ï¼Œä¹ŸåŒæ ·éœ€è¦ä¸¤ä¸ªBinderçº¿ç¨‹çš„æ”¯æŒã€‚\n\n# åŒä¸€ä¸ªç¨‹åºåŒ…ä¸­æœ‰ä¸¤ä¸ªAcivity\n\nä¸¤ä¸ªActivityä¹‹é—´æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿéœ€è¦æœ‰å¤šå°‘çº¿ç¨‹çš„æ”¯æŒï¼Ÿ\n\nAndroidManifest.xmlï¼š\n\n```xml\n/* AndroidManifest.xml */\n<activity android:name=\"./ActivityThreadTest\"\n          android:label=\"@string/title_activity_activity_thread_test\" >\n    <intent-filter>\n        <action android:name=\"android.intent.action.MAIN\" />\n        <category android:name=\"android.intent.category.LAUNCHER\" />\n    </intent-filter>\n</activity>\n\n<activity android:name=\".ActivityThreadTest2\"\n          android:label=\"@string/title_activity_activity_thread_test\" >\n</activity>\n```\n\nActivityThreadTest.java\n\n```java\n/* ActivityThreadTest.java */\npublic void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    Log.i(\"ActivityThreadTest1\", \"We are in ThreadTest1\");\n    setContentView(R.layout.activity_activity_thread_test);\n    Intent intentThread2 = new Intent(this, ActivityThreadTest2.class);\n    startActivity(intentThread2);\n}\n```\n\nå½“æ–­ç‚¹åœåœ¨ActivityThreadTest2çš„onCreateå‡½æ•°ä¸­æ—¶ï¼Œçº¿ç¨‹çš„åˆ†å¸ƒæƒ…å†µå¦‚ä¸‹ï¼š\n\n![image-20220906104610197](../../images/Android_è¿›ç¨‹/image-20220906104610197.png)\n\nå…¶ä¸­æ­ç¤ºäº†ä»¥ä¸‹å‡ ä¸ªç°è±¡ã€‚\n> å½“ActivityThreadTest2è¢«æ‰§è¡Œæ—¶ï¼Œä¸»çº¿ç¨‹å§‹ç»ˆåªæœ‰ä¸€ä¸ªã€‚\n> æ­¤æ—¶ActivityThreadTestæš‚æ—¶é€€å‡ºäº†è¿è¡Œã€‚\n> Binderçº¿ç¨‹æ•°é‡æœ‰æ‰€å˜åŒ–ã€‚\n\n## åŒä¸€ä¸ªAndroidManifest.xmlä¸­å®šä¹‰çš„ç»„ä»¶éƒ½è¿è¡ŒäºåŒä¸€ä¸ªè¿›ç¨‹ä¸­\n\nå¯¹äºåŒä¸€ä¸ªAndroidManifest.xmlä¸­å®šä¹‰çš„å››å¤§ç»„ä»¶ï¼Œé™¤éæœ‰ç‰¹åˆ«å£°æ˜ï¼Œå¦åˆ™å®ƒä»¬éƒ½è¿è¡ŒäºåŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼ˆå¹¶ä¸”å‡ç”±ä¸»çº¿ç¨‹æ¥å¤„ç†äº‹ä»¶ï¼‰ã€‚\n\næ ¹æ®æ“ä½œç³»ç»Ÿçš„åŸºç¡€çŸ¥è¯†ï¼Œå¦‚æœä¸¤ä¸ªå¯¹è±¡å¤„äºåŒä¸€ä¸ªè¿›ç¨‹ç©ºé—´ä¸­ï¼Œé‚£ä¹ˆå†…å­˜åŒºåŸŸåº”è¯¥æ˜¯å¯å…±äº«è®¿é—®çš„ã€‚å¯ä»¥åˆ©ç”¨è¿™ä¸ªåŸç†æ¥è®ºè¯å…ˆåå¯åŠ¨çš„åŒä¸€ä¸ªåŒ…é‡Œçš„ä¸¤ä¸ªActivityæ˜¯å¦å…±å­˜äºåŒä¸€ä¸ªè¿›ç¨‹ä¸­ã€‚å…ˆè®©ActivityThreadTestæ‹¥æœ‰ä¸€ä¸ªstaticçš„å˜é‡ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚\n\n```java\n/* ActivityThreadTest.java */\npublic class ActivityThreadTest extends Activity {\n    static int TestForCoexist = -1;\n    @Override\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        Log.i(\"ActivityThreadTest1\", \"We are in ThreadTest1\");\n        setContentView(R.layout.activity_activity_thread_test);\n        Intent intentThread2 = new Intent(this, ActivityThreadTest2.class);\n        TestForCoexist = 2;\n        startActivity(intentThread2);\n    }\n}\n```\n\nActivityThreadTestä¸­æœ‰ä¸€ä¸ªé™æ€çš„å˜é‡TestForCoexistã€‚å…¶åˆå§‹å€¼ä¸º-1ï¼Œå¹¶åœ¨Activityå¯åŠ¨åï¼ˆonCreate ä¸­ï¼‰è¢«ä¿®æ”¹ä¸º2ã€‚\n\næ¥ç€çœ‹ActivityThreadTest2çš„æºç å®ç°ï¼š\n\n```java\n/* ActivityThreadTest2.java */\npublic class ActivityThreadTest2 extends Activity {\n    @override\n    public void onCreate(Bundle savedInstanceState)\n    super.onCreate(savedInstanceState);\n    Log.i(\"ActivityThreadTest2\",\"We are in ThreadTest2\");\n    setContentView(R.layout.activity_activity_thread_test);\n    Log.i(\"ActivityThreadTest2\",\"TestForCoexist=\"\n          + ActivityThreadTest.TestForCoexist);//å®éªŒç»“æœå°†åœ¨è¿™é‡Œå‘ˆç°\n}\n```\n\n![image-20220906110131202](../../images/Android_è¿›ç¨‹/image-20220906110131202.png)\n\nè¿è¡Œè¿™ä¸ªåº”ç”¨ç¨‹åºï¼Œæ¥çœ‹çœ‹æœ€ç»ˆçš„è¾“å‡ºï¼ŒTestForCoexistä¸º2ã€‚\n\nè¿™å°±è¶³å¤Ÿè¯æ˜ä¸¤ä¸ª Activity æ˜¯åœ¨åŒä¸€ä¸ªè¿›ç¨‹ç©ºé—´ä¸­äº†ã€‚\n\nä»”ç»†è§‚å¯Ÿï¼Œè¿˜ä¼šå‘ç°äºŒè€…æ‰€å¤„çš„åº”ç”¨ç¨‹åºPIDå’ŒTIDå€¼æ˜¯ç›¸åŒçš„ã€‚è¿™éƒ½è¯æ˜äº†ä¸€ä¸ªç»“è®ºï¼Œé‚£å°±æ˜¯åŒä¸€ä¸ªç¨‹åºåŒ…é‡Œçš„ä¸¤ä¸ªActivityé»˜è®¤ç¡®å®éƒ½è¿è¡ŒäºåŒä¸€ä¸ªè¿›ç¨‹ä¸­ã€‚\n\n# è®©ä¸åŒåŒ…çš„ç»„ä»¶è¿è¡Œäºç›¸åŒçš„è¿›ç¨‹ä¸­\n\nAndroidæä¾›äº†ç‰¹æ®Šçš„æ–¹å¼è®©ä¸æ˜¯åŒä¸€ä¸ªåŒ…é‡Œçš„ç»„ä»¶ä¹Ÿå¯ä»¥è¿è¡Œäºç›¸åŒçš„è¿›ç¨‹ä¸­ã€‚ä¼˜åŠ¿å°±æ˜¯ï¼Œå®ƒä»¬å¯ä»¥éå¸¸æ–¹ä¾¿åœ°è¿›è¡Œèµ„æºå…±äº«ï¼Œè€Œä¸ç”¨ç»è¿‡è´¹æ—¶è´¹åŠ›çš„è¿›ç¨‹é—´é€šä¿¡ã€‚åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š\n\n## é’ˆå¯¹ä¸ªåˆ«ç»„ä»¶\n\nå¯ä»¥åœ¨`AndroidManifest.xml`æ–‡ä»¶ä¸­çš„`<activity>`ã€`<service>`ã€`<receiver>`å’Œ`<provider>`ï¼ˆå››å¤§ç»„ä»¶éƒ½æ”¯æŒï¼Œå¯ä»¥æ ¹æ®éœ€è¦æ¥æ·»åŠ ï¼‰æ ‡ç­¾ä¸­åŠ å…¥`android:process`å±æ€§æ¥è¡¨æ˜è¿™ä¸€ç»„ä»¶æƒ³è¦è¿è¡Œåœ¨å“ªä¸ªè¿›ç¨‹ç©ºé—´ä¸­ã€‚\n\n## é’ˆå¯¹æ•´ä¸ªç¨‹åºåŒ…\n\nå¯ä»¥ç›´æ¥åœ¨`<application>`æ ‡ç­¾ä¸­åŠ å…¥`android:process`å±æ€§æ¥æŒ‡æ˜æƒ³è¦ä¾å­˜çš„è¿›ç¨‹ç¯å¢ƒã€‚\n\n# ç»“è®º\n\n1. å››å¤§ç»„ä»¶å¹¶ä¸æ˜¯ç¨‹åºï¼ˆè¿›ç¨‹ï¼‰çš„å…¨éƒ¨ï¼Œè€Œåªæ˜¯å®ƒçš„\"é›¶ä»¶\"ã€‚\n2. åº”ç”¨ç¨‹åºå¯åŠ¨åï¼Œå°†åˆ›å»ºActivityThreadä¸»çº¿ç¨‹ã€‚\n3. åŒä¸€ä¸ªåŒ…ä¸­çš„ç»„ä»¶å°†è¿è¡Œåœ¨ç›¸åŒçš„è¿›ç¨‹ç©ºé—´ä¸­ã€‚\n4. ä¸åŒåŒ…ä¸­çš„ç»„ä»¶å¯ä»¥é€šè¿‡ä¸€å®šçš„æ–¹å¼è¿è¡Œåœ¨ä¸€ä¸ªè¿›ç¨‹ç©ºé—´ä¸­ã€‚\n5. ä¸€ä¸ªActivityåº”ç”¨å¯åŠ¨åè‡³å°‘ä¼šæœ‰3ä¸ªçº¿ç¨‹ï¼šå³ä¸€ä¸ªä¸»çº¿ç¨‹å’Œä¸¤ä¸ªBinderçº¿ç¨‹ã€‚","categories":["Android","æ“ä½œç³»ç»Ÿ"]},{"title":"git_config","url":"/git/git_config/","content":"\n# è§£å†³git cloneæ…¢çš„é—®é¢˜\n\nhttps://zhuanlan.zhihu.com/p/148110705\n\n```\ngit config --global http.proxy 127.0.0.1:11112\ngit config --global https.proxy 127.0.0.1:11112\ngit config --global --unset http.proxy\ngit config --global --unset https.proxy\n```\n\n# å±€åŸŸç½‘é…ç½®ä»£ç†è„šæœ¬\n\n```sh\nMY_PROXY_IP_=\"172.20.83.70\" #æœ‰å¢™çš„ä¸»æœºip\nMY_PROXY_PORT_=\"11113\"      #å¢™çš„ç«¯å£å·\nMY_PROXY_SECRET_=\"\"\nMY_PROXY_LOCATION_TEST_URL_=\"https://myip.ipip.net/\"\nfunction f_proxy_setup() {\n    if [ \"$#\" -eq \"2\" ];\n    then\n        MY_PROXY_IP_=\"$1\"\n        MY_PROXY_PORT_=\"$2\"\n    fi  \n    MY_PROXY_LOCATION_=socks5://${MY_PROXY_IP_}:${MY_PROXY_PORT_}\n    export all_proxy=\"$MY_PROXY_LOCATION_\"\n    echo $all_proxy\n}\n\nfunction f_proxy_down() {\n    echo \"($all_proxy)\" down.\n    export all_proxy=\"\"\n}\n\nfunction f_proxy_location() {\n    echo ALL_PROXY: $all_proxy\n    curl $MY_PROXY_LOCATION_TEST_URL_\n}\n```\n\n","categories":["Linux","git"]},{"title":"Linux_å¢™çš„é…ç½®","url":"/Linux/Linux_å¢™çš„é…ç½®/","content":"\n# å¢™çš„é…ç½®\n\n```sh\n# filename: setProxy.sh\nMY_PROXY_IP_=\"192.168.2.249\"\nMY_PROXY_PORT_=\"10810\"\nMY_PROXY_SECRET_=\"\"\nMY_PROXY_LOCATION_TEST_URL_=\"myip.ipip.net/\"\nfunction f_proxy_setup() {\n    if [ \"$#\" -eq \"2\" ];\n    then\n        MY_PROXY_IP_=\"$1\"\n        MY_PROXY_PORT_=\"$2\"\n    fi  \n    MY_PROXY_LOCATION_=socks5://${MY_PROXY_IP_}:${MY_PROXY_PORT_}\n    export all_proxy=\"$MY_PROXY_LOCATION_\"\n    echo $all_proxy\n}\n\nfunction f_proxy_down() {\n    echo \"($all_proxy)\" down.\n    export all_proxy=\"\"\n}\n\nfunction f_proxy_location() {\n    echo ALL_PROXY: $all_proxy\n    curl $MY_PROXY_LOCATION_TEST_URL_\n}\n```\n\nä½¿ç”¨ï¼š\n\n```\n$ . setProxy.h \"xxx.xxx.xxx.xxx\" \"xxxx\"\n$ f_proxy_setup\n$ f_proxy_location\n$ f_proxy_down\n$ f_proxy_location\n```\n\n","categories":["Linux"]},{"title":"git_commit","url":"/git/git_commit/","content":"\n# ç”¨vimç¼–è¾‘commit\n\n1. åœ¨git configä¸­è®¾ç½®`core.editor`:\n   `git config --global core.editor \"vim\"`\n2. åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½®`GIT_EDITOR`:\n   `export GIT_EDITOR=vim`\n\n# commitè§„çº¦ç›®æ ‡\n\n1. è§„èŒƒã€ç»Ÿä¸€çš„Commit\n   1. æ›´åŠ ç»“æ„åŒ–çš„æäº¤å†å²\n   2. ä¿è¯æ¯æ¬¡ä¿¡æ¯éƒ½æœ‰ç¡®åˆ‡çš„å«ä¹‰\n2. è‡ªåŠ¨ã€æ¸…æ™°çš„ChangeLog\n3. ç®€å•ã€æ–¹ä¾¿çš„issue tracker\n   1. æ–¹ä¾¿ä¿¡æ¯æœç´¢å’Œè¿‡æ»¤\n\n# Commitè§„èŒƒ\n\nä»£ç ç¤ºæ„\n\n```\n[what][key][jira issue ID] describe[part1/n]\n[why] describe\n[how]\n1.describe\n2.\nn.\n```\n\næ®µè½å«ä¹‰è§£é‡Š\n\n| æ®µè½ | å«ä¹‰                                                       | å¤‡æ³¨                       |\n| :--- | :--------------------------------------------------------- | :------------------------- |\n| what | æè¿°æäº¤ï¼ˆé—®é¢˜ã€æ”¹åŠ¨ã€ä¿®æ”¹ç­‰è°ƒæ•´ï¼‰                         | ä¸€å¥è¯ç»“æŸã€‚ä¸è¶…è¿‡80ä¸ªå­—èŠ‚ |\n| why  | é˜è¿°æäº¤ï¼ˆé—®é¢˜è§¦å‘åŸç†ã€æ”¹åŠ¨ç¼˜ç”±ã€ä¿®æ”¹ç†ç”±ç­‰ä¸€åˆ‡åˆç†è§£é‡Šï¼‰ |                            |\n| how  | è§£é‡Šæäº¤ï¼ˆé—®é¢˜è§£å†³åŠæ³•ã€æ”¹åŠ¨é¡¹ã€ä¿®æ”¹é¡¹ç­‰ï¼‰                 | åˆ†ç‚¹åˆ†æ®µ                   |\n\nå­—æ®µå«ä¹‰è§£é‡Š\n\n| å­—æ®µ          | å«ä¹‰                                     | å¤‡æ³¨                                            |\n| :------------ | :--------------------------------------- | :---------------------------------------------- |\n| key           | å…³é”®å­—ï¼Œç”¨äºç›´æ¥åŒºåˆ†commitæœ¬è´¨ï¼Œæå…¶é‡è¦ | ç›®çš„ï¼šè¿‡æ»¤ï¼Œç­›é€‰ç”¨é€”ï¼šå¯ç”¨äºè‡ªåŠ¨åŒ–ç”Ÿäº§ChangeLog |\n| Jira issue ID | jiraé—®é¢˜IDï¼ŒARMR-666                     |                                                 |\n| describe      | æè¿°                                     |                                                 |\n| part 1/n      | è·¨ä»“åº“æäº¤                               | ä¸€èˆ¬ç”¨äºrepoç­‰å¤§å‹ä»“åº“ä½¿ç”¨                      |\n\nkeyå­—æ®µè§£é‡Š\n\n| key      | è§£é‡Š     | å¤‡æ³¨                                   |\n| :------- | :------- | :------------------------------------- |\n| feature  | æ–°ç‰¹æ€§   |                                        |\n| merge    | åˆå¹¶     |                                        |\n| bugfix   | ä¿®å¤é—®é¢˜ |                                        |\n| config   | é…ç½®æœºå‹ | åœ¨TVé‡Œé¢ï¼Œconfigæ˜¯æäº¤æœ€å¤šçš„ä¸€ä¸ªç§ç±»å‹ |\n| refactor | é‡æ„     |                                        |\n\n## é’ˆå¯¹ bug ä¿®æ”¹\n\n```\n[bugfix][ç±»å‹][jira ç¼–å·] bug ç®€è¿°\nï¼ˆæ·»åŠ ä¸€è¡Œç©ºè¡Œï¼‰\n[what]bug è¯¦ç»†æè¿°\n[why]åŸå› \n[how]è§£å†³æ–¹æ³•\n```\n\n## é’ˆå¯¹åŠŸèƒ½æ·»åŠ çš„ä¿®æ”¹\n\n```\n[feature][ç±»å‹][å¯é€‰é¡¹] åŠŸèƒ½ç®€è¿°\nï¼ˆæ·»åŠ ä¸€è¡Œç©ºè¡Œï¼‰\n[what]åŠŸèƒ½çš„è¯¦ç»†æè¿°\nå®ç°æ–¹æ³•\n```\n\n[å¯é€‰é¡¹]â€”â€”å¯è€ƒè™‘å¡«å†™ç‰ˆæœ¬å·ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰æˆ–è€… jira ç¼–å·\n\n## å…¬å…±çº¦å®š\n\n1. ç¬¬ä¸€è¡Œç®€è¿°å°½é‡ç”¨è‹±æ–‡ï¼Œå¯ä»¥ä½¿ç”¨ä¸­æ–‡\n2. bug æœ‰ jira ç¼–å·ï¼Œå¿…é¡»é™„ä¸Š\n3. ç¬¬ä¸€è¡Œç®€è¿°ä¸‹å¿…é¡»ç©ºä¸€è¡Œ\n4. å®¡æ ¸äººå‘ç°logä¸æŒ‰ç…§æœ¬æ–‡è§„èŒƒä¹¦å†™ï¼Œéœ€è¦æ‰“å›\n","categories":["Linux","git"]},{"title":"å¾®æœºåŸç†_DOSç¯å¢ƒæ­å»º_Debug","url":"/å¾®æœºåŸç†/å¾®æœºåŸç†_DOSç¯å¢ƒæ­å»º_Debug/","content":"# Debugæ˜¯ä»€ä¹ˆ\n\nDebugæ˜¯DOSã€Windowséƒ½æä¾›çš„å®æ¨¡å¼ï¼ˆ8086æ–¹å¼ï¼‰ç¨‹åºçš„è°ƒè¯•å·¥å…·ã€‚ä½¿ç”¨å®ƒï¼Œå¯ä»¥æŸ¥çœ‹CPUå„ç§å¯„å­˜å™¨ä¸­çš„å†…å®¹ã€å†…å­˜çš„æƒ…å†µå’Œåœ¨æœºå™¨ç çº§è·Ÿè¸ªç¨‹åºçš„è¿è¡Œã€‚\n\n# æŒ‚è½½ç£ç›˜\n\nä¸‹è½½masmæ–‡ä»¶å¤¹ï¼Œæ˜¯å››ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ”¾åœ¨å®¿ä¸»ç³»ç»Ÿç£ç›˜ä¸‹çš„æŸä¸ªä½ç½®ã€‚\n\néœ€è¦åœ¨DosBoxä¸­è¿›è¡ŒæŒ‚è½½ã€‚\n\nå³åœ¨dosä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼šå‚æ•°1ä¸ºè¦æŒ‚è½½åˆ°dosç³»ç»Ÿçš„æŸä¸ªä½ç½®ï¼Œå‚æ•°2ä¸ºè¦æŒ‚è½½çš„å®¿ä¸»ç³»ç»Ÿä¸­çš„å†…å®¹\n\n```\nmount C D:\\masm\n```\n\nè¾“å…¥åï¼ŒæˆåŠŸæ—¶ä¼šæ˜¾ç¤ºï¼š`Drive C is mounted as local directory D:\\masm\\`\n\nå¯ä»¥åœ¨dosä¸­è¿›å…¥Cç›˜è¿›è¡Œæ‰§è¡Œæ–‡ä»¶äº†ã€‚\n\n# è°ƒèŠ‚çª—å£å¤§å°\n\n1. https://blog.51cto.com/sxhelijian/4895116\n2. https://blog.csdn.net/wxw1920/article/details/120716642\n\n# åŸºæœ¬å‘½ä»¤\n\n1. ç”¨Debugçš„Rå‘½ä»¤æŸ¥çœ‹ã€æ”¹å˜CPUå¯„å­˜å™¨çš„å†…å®¹ï¼›\n2. ç”¨Debugçš„Då‘½ä»¤æŸ¥çœ‹å†…å­˜ä¸­çš„å†…å®¹ï¼›\n3. ç”¨Debugçš„Eå‘½ä»¤æ”¹å†™å†…å­˜ä¸­çš„å†…å®¹ï¼›\n4. ç”¨Debugçš„Uå‘½ä»¤å°†å†…å­˜ä¸­çš„æœºå™¨æŒ‡ä»¤ç¿»è¯‘æˆæ±‡ç¼–æŒ‡ä»¤ï¼›\n5. ç”¨Debugçš„Tå‘½ä»¤æ‰§è¡Œä¸€æ¡æœºå™¨æŒ‡ä»¤ï¼›\n6. ç”¨Debugçš„Aå‘½ä»¤ä»¥æ±‡ç¼–æŒ‡ä»¤çš„æ ¼å¼åœ¨å†…å­˜ä¸­å†™å…¥ä¸€æ¡æœºå™¨æŒ‡ä»¤ã€‚\n\n## Rå‘½ä»¤æŸ¥çœ‹ã€æ”¹å˜CPUå¯„å­˜å™¨å†…å®¹\n\nè¾“å…¥`r`ï¼Œå›è½¦ã€‚å¯æ‰“å°è‹¥å¹²å¯„å­˜å™¨å†…å®¹ã€‚åœ¨æ‰€æœ‰å¯„å­˜å™¨çš„ä¸‹æ–¹ï¼ŒDebugè¿˜åˆ—å‡ºäº†CS:IPæ‰€æŒ‡å‘çš„å†…å­˜å•å…ƒå¤„æ‰€å­˜æ”¾çš„æœºå™¨ç ï¼Œå¹¶å°†å®ƒç¿»è¯‘ä¸ºæ±‡ç¼–æŒ‡ä»¤ã€‚è¾“å‡ºçš„å³ä¸‹è§’è¿˜æœ‰ä¸€ä¸ªä¿¡æ¯\"`DS:0000=CD`\"ã€‚\n\n![image-20220901141954968](../../images/å¾®æœºåŸç†_DOSç¯å¢ƒæ­å»º_Debug/image-20220901141954968.png)\n\nè‹¥è¦ä¿®æ”¹ä¸€ä¸ªå¯„å­˜å™¨ä¸­çš„å€¼ï¼Œæ¯”å¦‚AXä¸­çš„å€¼ï¼Œå¯ç”¨Rå‘½ä»¤ååŠ å¯„å­˜å™¨åæ¥è¿›è¡Œï¼Œè¾“å…¥\"`r ax`\"åæŒ‰Enteré”®ï¼Œå°†å‡ºç°\"`:`\"ä½œä¸ºè¾“å…¥æç¤ºï¼Œåœ¨åé¢è¾“å…¥è¦å†™å…¥çš„æ•°æ®åæŒ‰Enteré”®ï¼Œå³å®Œæˆäº†å¯¹AXä¸­å†…å®¹çš„ä¿®æ”¹ã€‚è‹¥æƒ³çœ‹ä¸€ä¸‹ä¿®æ”¹çš„ç»“æœï¼Œå¯å†ç”¨Rå‘½ä»¤æŸ¥çœ‹ã€‚\n\n## Då‘½ä»¤æŸ¥çœ‹å†…å­˜ä¸­çš„å†…å®¹\n\n`d æ®µåœ°å€:åç§»åœ°å€`ï¼Œå¯ä»¥æ¥æŸ¥çœ‹æŒ‡å®šå†…å­˜åœ°å€åˆçš„é»˜è®¤128ä¸ªå­—èŠ‚çš„å†…å®¹ã€‚åœ¨ä½¿ç”¨\"`d æ®µåœ°å€:åç§»åœ°å€`\"ä¹‹åï¼Œæ¥ç€å†æ¬¡ä½¿ç”¨Då‘½ä»¤ï¼Œå¯å†æ¬¡åˆ—å‡ºåç»­128å­—èŠ‚çš„å†…å®¹ã€‚\n\nå¯ä»¥æŒ‡å®šDå‘½ä»¤çš„æŸ¥çœ‹èŒƒå›´ï¼Œæ­¤æ—¶é‡‡ç”¨\"`d æ®µåœ°å€:èµ·å§‹åç§»åœ°å€ ç»“å°¾åç§»åœ°å€`\"çš„æ ¼å¼ã€‚æ¯”å¦‚è¦çœ‹`1000:0~1000:9`ä¸­çš„å†…å®¹ï¼Œå¯ä»¥ç”¨\"`d1000:0 9`\"å®ç°ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚è‹¥ç»“å°¾åç§»åœ°å€å°äºèµ·å§‹åç§»åœ°å€å°†ä¼šæŠ¥é”™ã€‚\n\n![image-20220901145106731](../../images/å¾®æœºåŸç†_DOSç¯å¢ƒæ­å»º_Debug/image-20220901145106731.png)\n\nå¦‚æœæƒ³çœ‹ç‰¹å®šå†…å­˜å•å…ƒ`10000H`ä¸­çš„å†…å®¹ï¼Œå¯ä»¥ç”¨å›¾ä¸­ä»»ä½•ä¸€ç§æ–¹æ³•çœ‹åˆ°ã€‚å›¾ä¸­ä¸‰ç§æ–¹å¼`æ®µåœ°å€:åç§»åœ°å€`éƒ½è¡¨ç¤ºäº†`10000H`è¿™ä¸€ç‰©ç†åœ°å€ã€‚ï¼ˆåˆ«å¿˜äº†ï¼Œ8086ä¸‹çš„æ®µåœ°å€éœ€è¦ä¹˜ä»¥16ï¼Œç›¸å½“äº$1000H*10H=10000H$ï¼›$0FFFH*10H+10H=FFF0H+10H=10000H$ï¼‰\n\n![image-20220901144739638](../../images/å¾®æœºåŸç†_DOSç¯å¢ƒæ­å»º_Debug/image-20220901144739638.png)\n\n## Eå‘½ä»¤ä¿®æ”¹å†…å­˜ä¸­çš„å†…å®¹\n\næ¯”å¦‚è¦å°†å†…å­˜`1000:0~1000:9`å•å…ƒä¸­çš„å†…å®¹åˆ†åˆ«å†™ä¸º`0~9`ã€‚å¯ä»¥ä½¿ç”¨`e èµ·å§‹åœ°å€ æ•°æ® æ•°æ® æ•°æ® ...`çš„æ ¼å¼æ¥è¿›è¡Œã€‚\n\n![image-20220901143311569](../../images/å¾®æœºåŸç†_DOSç¯å¢ƒæ­å»º_Debug/image-20220901143311569.png)\n\nä¹Ÿå¯ä»¥ç”¨Eå‘½ä»¤ä»¥æé—®çš„æ–¹å¼æ¥é€ä¸ªåœ°ä¿®æ”¹ä»æŸä¸€åœ°å€å¼€å§‹çš„å†…å­˜å•å…ƒä¸­çš„å†…å®¹ï¼Œä»¥ä»`1000:10`å•å…ƒå¼€å§‹ä¸ºä¾‹ï¼Œæ­¥éª¤å¦‚ä¸‹ã€‚\n\n1. è¾“å…¥`e 1000:10`ï¼ŒæŒ‰ Enteré”®ã€‚\n2. Debugæ˜¾ç¤ºèµ·å§‹åœ°å€`1000:0010`ï¼Œå’Œç¬¬ä¸€å•å…ƒï¼ˆå³`1000:0010`å•å…ƒï¼‰çš„åŸå§‹å†…å®¹6Dï¼Œç„¶åå…‰æ ‡åœåœ¨\"`.`\"çš„åé¢æç¤ºè¾“å…¥æƒ³è¦å†™å…¥çš„æ•°æ®ï¼Œæ­¤æ—¶å¯ä»¥æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š\n   1. è¾“å…¥æ•°æ®ï¼Œç„¶åæŒ‰`ç©ºæ ¼é”®`ï¼Œå³ç”¨è¾“å…¥çš„æ•°æ®æ”¹å†™å½“å‰çš„å†…å­˜å•å…ƒ\n   2. ä¸è¾“å…¥æ•°æ®ï¼Œç›´æ¥æŒ‰`ç©ºæ ¼é”®`ï¼Œåˆ™ä¸å¯¹å½“å‰å†…å­˜å•å…ƒè¿›è¡Œæ”¹å†™ã€‚\n3. å½“å‰å•å…ƒå¤„ç†å®Œæˆåï¼ˆä¸è®ºæ˜¯æ”¹å†™æˆ–æ²¡æœ‰æ”¹å†™ï¼Œåªè¦æŒ‰äº†ç©ºæ ¼é”®ï¼Œå°±è¡¨ç¤ºå¤„ç†å®Œæˆï¼‰ï¼ŒDebugå°†æ¥ç€æ˜¾ç¤ºä¸‹ä¸€ä¸ªå†…å­˜å•å…ƒçš„åŸå§‹å†…å®¹ï¼Œå¹¶æç¤ºè¿›è¡Œä¿®æ”¹ï¼Œå¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•å¤„ç†ã€‚\n4. æ‰€æœ‰å¸Œæœ›æ”¹å†™çš„å†…å­˜å•å…ƒæ”¹å†™å®Œæ¯•åï¼ŒæŒ‰`Enter`é”®ï¼ŒEå‘½ä»¤æ“ä½œç»“æŸã€‚\n\n![image-20220901144136193](../../images/å¾®æœºåŸç†_DOSç¯å¢ƒæ­å»º_Debug/image-20220901144136193.png)\n\nè¿˜å¯ä»¥ç”¨Eå‘½ä»¤å‘å†…å­˜ä¸­å†™å…¥å­—ç¬¦ï¼Œæ¯”å¦‚ï¼Œç”¨Eå‘½ä»¤ä»å†…å­˜`1000:0`å¼€å§‹å†™å…¥æ•°å€¼1ã€å­—ç¬¦\"a\"ã€æ•°å€¼2ã€å­—ç¬¦\"b\"ã€æ•°å€¼3ã€å­—ç¬¦\"c\"ï¼Œå¯é‡‡ç”¨å›¾ä¸­æ‰€ç¤ºçš„æ–¹æ³•è¿›è¡Œã€‚\n\n![image-20220901143932131](../../images/å¾®æœºåŸç†_DOSç¯å¢ƒæ­å»º_Debug/image-20220901143932131.png)\n\nä¹Ÿå¯ä»¥ç”¨Eå‘½ä»¤å‘å†…å­˜ä¸­å†™å…¥å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ï¼Œç”¨Eå‘½ä»¤ä»å†…å­˜`1000:0`å¼€å§‹å†™å…¥æ•°å€¼1ã€å­—ç¬¦ä¸²\"a+b\"ã€æ•°å€¼2ã€å­—ç¬¦ä¸²\"c++\"ã€å­—ç¬¦ 3ã€å­—ç¬¦ä¸²\"IBM\"ã€‚\n\n![image-20220901144327149](../../images/å¾®æœºåŸç†_DOSç¯å¢ƒæ­å»º_Debug/image-20220901144327149.png)\n\n## Eå‘½ä»¤å†™å…¥æœºå™¨ç ï¼Œç”¨Uå‘½ä»¤æŸ¥çœ‹æœºå™¨ç å«ä¹‰ï¼ŒTå‘½ä»¤æ‰§è¡Œ\n\nå¯ä»¥ç”¨Eå‘½ä»¤å‘å†…å­˜ä¸­å†™å…¥æœºå™¨ç ï¼Œç”¨Uå‘½ä»¤æŸ¥çœ‹å†…å­˜ä¸­æœºå™¨ç çš„å«ä¹‰ï¼Œç”¨Tå‘½ä»¤æ‰§è¡Œå†…å­˜ä¸­çš„æœºå™¨ç ã€‚\n\næœºå™¨ç ä¹Ÿæ˜¯æ•°æ®ï¼Œå½“ç„¶å¯ä»¥ç”¨Eå‘½ä»¤å°†æœºå™¨ç å†™å…¥å†…å­˜ã€‚æ¯”å¦‚æˆ‘ä»¬è¦ä»å†…å­˜`1000:0`å•å…ƒå¼€å§‹å†™å…¥è¿™æ ·ä¸€æ®µæœºå™¨ç ï¼š\n\n| æœºå™¨ç  | å¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤ |\n| ------ | -------------- |\n| b80100 | mov ax, 0001   |\n| b90200 | mov cx, 0002   |\n| 01c8   | add ax, cx     |\n\nå¯ä»¥ç”¨Eå‘½ä»¤è¿™æ ·è¾“å…¥ï¼š\n\n```\ne 1000:0 b8 01 00 b9 02 00 01 c8\n```\n\nå¯ä»¥ä½¿ç”¨Uå‘½ä»¤æŸ¥çœ‹å†™å…¥çš„æˆ–å†…å­˜ä¸­åŸæœ‰çš„æœºå™¨ç æ‰€å¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤ã€‚æ¯”å¦‚å¯ä»¥ç”¨Uå‘½ä»¤å°†ä»`1000:0`å¼€å§‹çš„å†…å­˜å•å…ƒä¸­çš„å†…å®¹ç¿»è¯‘ä¸ºæ±‡ç¼–æŒ‡ä»¤ï¼Œå¹¶æ˜¾ç¤ºå‡ºæ¥ã€‚\n\nä¸‹å›¾ï¼šé¦–å…ˆç”¨Eå‘½ä»¤å‘ä»`1000:0`å¼€å§‹çš„å†…å­˜å•å…ƒä¸­å†™å…¥äº†8ä¸ªå­—èŠ‚çš„æœºå™¨ç ï¼›ç„¶åç”¨Då‘½ä»¤æŸ¥çœ‹å†…å­˜`1000:0~1000:1f`ä¸­çš„æ•°æ®ï¼ˆä»æ•°æ®çš„è§’åº¦çœ‹ä¸€ä¸‹å†™å…¥çš„å†…å®¹ï¼‰ï¼›æœ€åç”¨Uå‘½ä»¤æŸ¥çœ‹ä»`1000:0`å¼€å§‹çš„å†…å­˜å•å…ƒä¸­çš„æœºå™¨æŒ‡ä»¤å’Œå®ƒä»¬æ‰€å¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤ã€‚\n\n![image-20220901145701343](../../images/å¾®æœºåŸç†_DOSç¯å¢ƒæ­å»º_Debug/image-20220901145701343.png)\n\nUå‘½ä»¤çš„æ˜¾ç¤ºè¾“å‡ºåˆ†ä¸º3éƒ¨åˆ†ï¼Œæ¯ä¸€æ¡æœºå™¨æŒ‡ä»¤çš„åœ°å€ã€æœºå™¨æŒ‡ä»¤ã€æœºå™¨æŒ‡ä»¤æ‰€å¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤ã€‚\n\nå†…å­˜ä¸­çš„æ•°æ®å’Œä»£ç æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œå…³é”®åœ¨äºå¦‚ä½•è§£é‡Šã€‚\n\nä½¿ç”¨Tå‘½ä»¤æ‰§è¡Œå†™å…¥çš„æœºå™¨æŒ‡ä»¤å¯ä»¥æ‰§è¡Œä¸€æ¡æˆ–å¤šæ¡æŒ‡ä»¤ã€‚\n\nç®€å•åœ°ä½¿ç”¨Tå‘½ä»¤ï¼Œå¯ä»¥æ‰§è¡Œ`CS:IP`æŒ‡å‘çš„æŒ‡ä»¤ã€‚\n\n![image-20220901150147031](../../images/å¾®æœºåŸç†_DOSç¯å¢ƒæ­å»º_Debug/image-20220901150147031.png)\n\nå…ˆä¿®æ”¹csã€ipï¼Œä½¿ä¸‹ä¸€æ¡å‘½ä»¤å¯¹å‡†`1000:0`ï¼Œå³`mov ax, 1`ã€‚`t`å‘½ä»¤æ‰§è¡Œåï¼Œå‘ç°ï¼Œaxå˜ä¸ºäº†1ï¼›ipæ”¹å˜ä¸º3ï¼ˆæŒ‡å‘ä¸‹ä¸€æ¡ï¼‰ã€‚\n\n## Aå‘½ä»¤ä»¥æ±‡ç¼–æŒ‡ä»¤çš„å½¢å¼åœ¨å†…å­˜ä¸­å†™å…¥æœºå™¨æŒ‡ä»¤\n\nAå‘½ä»¤ä½¿èƒ½ç›´æ¥ä»¥æ±‡ç¼–æŒ‡ä»¤çš„å½¢å¼å†™å…¥æŒ‡ä»¤ã€‚\n\né¦–å…ˆç”¨Aå‘½ä»¤ï¼Œä»¥æ±‡ç¼–è¯­è¨€å‘ä»`1000:0`å¼€å§‹çš„å†…å­˜å•å…ƒä¸­å†™å…¥äº†å‡ æ¡æŒ‡ä»¤ï¼Œç„¶åç”¨Då‘½ä»¤æŸ¥çœ‹Aå‘½ä»¤çš„æ‰§è¡Œç»“æœã€‚å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä½¿ç”¨Aå‘½ä»¤å†™å…¥æŒ‡ä»¤æ—¶ï¼Œæˆ‘ä»¬è¾“å…¥çš„æ˜¯æ±‡ç¼–æŒ‡ä»¤ï¼ŒDebugå°†è¿™äº›æ±‡ç¼–æŒ‡ä»¤ç¿»è¯‘ä¸ºå¯¹åº”çš„æœºå™¨æŒ‡ä»¤ï¼Œå°†å®ƒä»¬çš„æœºå™¨ç å†™å…¥å†…å­˜ã€‚\n\nä¸å†ç»§ç»­å†™å…¥æ—¶ï¼Œç›´æ¥æŒ‰Enteré”®è¡¨ç¤ºæ“ä½œç»“æŸã€‚\n\n![image-20220901150535967](../../images/å¾®æœºåŸç†_DOSç¯å¢ƒæ­å»º_Debug/image-20220901150535967.png)\n\n![image-20220901150726949](../../images/å¾®æœºåŸç†_DOSç¯å¢ƒæ­å»º_Debug/image-20220901150726949.png)\n","categories":["å¾®æœºåŸç†"]},{"title":"å¾®æœºåŸç†_å¯„å­˜å™¨_ç‰©ç†åœ°å€_æ®µ","url":"/å¾®æœºåŸç†/å¾®æœºåŸç†_å¯„å­˜å™¨_ç‰©ç†åœ°å€_æ®µ/","content":"# CPU\n\nä¸€ä¸ªå…¸å‹çš„CPUï¼ˆæ­¤å¤„è®¨è®ºçš„ä¸æ˜¯æŸä¸€å…·ä½“çš„CPUï¼‰ç”±è¿ç®—å™¨ã€æ§åˆ¶å™¨ã€å¯„å­˜å™¨ç­‰æ„æˆï¼Œè¿™äº›å™¨ä»¶é **å†…éƒ¨æ€»çº¿**ç›¸è¿ã€‚å†…éƒ¨æ€»çº¿å®ç°CPUå†…éƒ¨å„ä¸ªå™¨ä»¶ä¹‹é—´çš„è”ç³»ï¼›å¤–éƒ¨æ€»çº¿å®ç°CPUå’Œä¸»æ¿ä¸Šå…¶ä»–å™¨ä»¶çš„è”ç³»ã€‚ç®€å•åœ°è¯´ï¼Œåœ¨CPUä¸­ï¼š\n\n* **è¿ç®—å™¨**è¿›è¡Œä¿¡æ¯å¤„ç†ï¼›\n* **å¯„å­˜å™¨**è¿›è¡Œä¿¡æ¯å­˜å‚¨ï¼›\n* **æ§åˆ¶å™¨**æ§åˆ¶å„ç§å™¨ä»¶è¿›è¡Œå·¥ä½œï¼›\n* **å†…éƒ¨æ€»çº¿**è¿æ¥å„ç§å™¨ä»¶ï¼Œåœ¨å®ƒä»¬ä¹‹é—´è¿›è¡Œæ•°æ®çš„ä¼ é€ã€‚\n\nå¯¹äºä¸€ä¸ªæ±‡ç¼–ç¨‹åºå‘˜æ¥è¯´ï¼ŒCPUä¸­çš„ä¸»è¦éƒ¨ä»¶æ˜¯å¯„å­˜å™¨ã€‚å¯„å­˜å™¨æ˜¯CPUä¸­ç¨‹åºå‘˜å¯ä»¥ç”¨æŒ‡ä»¤è¯»å†™çš„éƒ¨ä»¶ã€‚ç¨‹åºå‘˜é€šè¿‡æ”¹å˜å„ç§å¯„å­˜å™¨ä¸­çš„å†…å®¹æ¥å®ç°å¯¹CPUçš„æ§åˆ¶ã€‚ä¸åŒçš„CPUï¼Œå¯„å­˜å™¨çš„ä¸ªæ•°ã€ç»“æ„æ˜¯ä¸ç›¸åŒçš„ã€‚8086æœ‰14ä¸ªå¯„å­˜å™¨ï¼Œæ¯ä¸ªå¯„å­˜å™¨æœ‰ä¸€ä¸ªåç§°ã€‚è¿™äº›å¯„å­˜å™¨æ˜¯ï¼šAXã€BXã€CXã€DXã€SIã€DIã€SPã€BPã€IPã€CSã€SSã€DSã€ESã€PSWã€‚\n\n# é€šç”¨å¯„å­˜å™¨--AX/BX/CX/DX\n\n8086çš„æ‰€æœ‰å¯„å­˜å™¨éƒ½æ˜¯16ä½çš„ï¼Œå¯ä»¥å­˜æ”¾ä¸¤ä¸ªå­—èŠ‚ã€‚AXã€BXã€CXã€DXè¿™4ä¸ªå¯„å­˜å™¨é€šå¸¸ç”¨æ¥å­˜æ”¾ä¸€èˆ¬æ€§çš„æ•°æ®ï¼Œè¢«ç§°ä¸ºé€šç”¨å¯„å­˜å™¨ã€‚\n\n8086çš„ä¸Šä¸€ä»£CPUä¸­çš„å¯„å­˜å™¨éƒ½æ˜¯8ä½çš„ï¼Œä¸ºäº†ä¿è¯å…¼å®¹ï¼Œä½¿åŸæ¥åŸºäºä¸Šä»£CPUç¼–å†™çš„ç¨‹åºç¨åŠ ä¿®æ”¹å°±å¯ä»¥è¿è¡Œåœ¨8086ä¹‹ä¸Šï¼Œ8086çš„AXã€BXã€CXã€DXè¿™4ä¸ªå¯„å­˜å™¨éƒ½å¯åˆ†ä¸ºä¸¤ä¸ªå¯ç‹¬ç«‹ä½¿ç”¨çš„8ä½å¯„å­˜å™¨æ¥ç”¨ï¼š\n\n1. AXå¯åˆ†ä¸ºAHå’ŒAL\n2. BXå¯åˆ†ä¸ºBHå’ŒBL\n3. CXå¯åˆ†ä¸ºCHå’ŒCL\n4. DXå¯åˆ†ä¸ºDHå’ŒDL\n\n![image-20220831145025668](../../images/å¾®æœºåŸç†_å¯„å­˜å™¨_ç‰©ç†åœ°å€_æ®µ/image-20220831145025668.png)\n\n# å­—åœ¨å¯„å­˜å™¨ä¸­çš„å­˜å‚¨\n\nå‡ºäºå¯¹å…¼å®¹æ€§çš„è€ƒè™‘ï¼Œ8086å¯ä»¥ä¸€æ¬¡æ€§å¤„ç†ä»¥ä¸‹ä¸¤ç§å°ºå¯¸çš„æ•°æ®ã€‚\n\n1. å­—èŠ‚ï¼šè®°ä¸ºbyteï¼Œä¸€ä¸ªå­—èŠ‚ç”±8ä¸ªbitç»„æˆï¼Œå¯ä»¥å­˜åœ¨8ä½å¯„å­˜å™¨ä¸­ã€‚\n2. å­—ï¼šè®°ä¸ºwordï¼Œä¸€ä¸ªå­—ç”±ä¸¤ä¸ªå­—èŠ‚ç»„æˆï¼Œè¿™ä¸¤ä¸ªå­—èŠ‚åˆ†åˆ«ç§°ä¸ºè¿™ä¸ª**å­—çš„é«˜ä½å­—**\n   **èŠ‚å’Œä½ä½å­—èŠ‚**ã€‚\n\n![image-20220831145223342](../../images/å¾®æœºåŸç†_å¯„å­˜å™¨_ç‰©ç†åœ°å€_æ®µ/image-20220831145223342.png)\n\nä¸€ä¸ªå­—å¯ä»¥å­˜åœ¨ä¸€ä¸ª16ä½å¯„å­˜å™¨ä¸­ï¼Œè¿™ä¸ªå­—çš„é«˜ä½å­—èŠ‚å’Œä½ä½å­—èŠ‚è‡ªç„¶å°±å­˜åœ¨è¿™ä¸ªå¯„å­˜å™¨çš„é«˜8ä½å¯„å­˜å™¨å’Œä½8ä½å¯„å­˜å™¨ä¸­ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸€ä¸ªå­—å‹æ•°æ®20000ï¼Œå­˜åœ¨AXå¯„å­˜å™¨ä¸­ï¼Œåœ¨AHä¸­å­˜å‚¨äº†å®ƒçš„é«˜8ä½ï¼Œåœ¨ALä¸­å­˜å‚¨äº†å®ƒçš„ä½8ä½ã€‚AHå’ŒALä¸­çš„æ•°æ®ï¼Œæ—¢å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªå­—å‹æ•°æ®çš„é«˜8ä½å’Œä½8ä½ï¼Œè¿™ä¸ªå­—å‹æ•°æ®çš„å¤§å°æ˜¯20000ï¼›åˆå¯ä»¥çœ‹æˆæ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„å­—èŠ‚å‹æ•°æ®ï¼Œå®ƒä»¬çš„å¤§å°åˆ†åˆ«æ˜¯78å’Œ32ã€‚\n\n# å‡ æ¡æ±‡ç¼–æŒ‡ä»¤\n\n| æ±‡ç¼–æŒ‡ä»¤   | æ§åˆ¶CPUå®Œæˆçš„æ“ä½œ                  | ç”¨é«˜çº§è¯­è¨€çš„è¯­æ³•æè¿° |\n| ---------- | ---------------------------------- | -------------------- |\n| mov ax, 18 | å°†18é€å…¥å¯„å­˜å™¨AX                   | AX=18                |\n| mov ah, 78 | å°†78é€å…¥å¯„å­˜å™¨AH                   | AH=78                |\n| add ax, 8  | å°†å¯„å­˜å™¨AXä¸­çš„æ•°å€¼åŠ ä¸Š8            | AH=AX+8              |\n| mov ax, bx | å°†å¯„å­˜å™¨BXä¸­çš„æ•°æ®é€å…¥å¯„å­˜å™¨AX     | AX=BX                |\n| add ax, bx | å°†AXå’ŒBXä¸­çš„æ•°å€¼ç›¸åŠ ï¼Œç»“æœå­˜åœ¨AXä¸­ | AX=AX+BX             |\n\nåœ¨å†™ä¸€æ¡æ±‡ç¼–æŒ‡ä»¤æˆ–ä¸€ä¸ªå¯„å­˜å™¨çš„åç§°æ—¶ä¸åŒºåˆ†å¤§å°å†™ã€‚å¦‚mov ax, 18å’ŒMOV AX, 18çš„å«ä¹‰ç›¸åŒã€‚\n\n## è¶Šä½çš„é—®é¢˜\n\n| æ±‡ç¼–æŒ‡ä»¤    | AXä¸­çš„æ•°æ® | BXä¸­çš„æ•°æ® |\n| ----------- | ---------- | ---------- |\n| {start}     | 00C5H      | 4026H      |\n| add al, 93H | ?          | 4026H      |\n\næŒ‡ä»¤æ‰§è¡ŒåAXä¸­çš„æ•°æ®ä¸ºå¤šå°‘ï¼Ÿ\n\nåˆ†æï¼š\n\nç¨‹åºæ®µä¸­çš„æœ€åä¸€æ¡æŒ‡ä»¤`add al, 93H`ï¼Œåœ¨æ‰§è¡Œå‰ï¼Œ`al`ä¸­çš„æ•°æ®ä¸º`C5H`ï¼Œç›¸åŠ åæ‰€å¾—çš„å€¼ä¸º`158H`ï¼Œä½†æ˜¯`al`ä¸º8ä½å¯„å­˜å™¨ï¼Œåªèƒ½å­˜æ”¾ä¸¤ä½åå…­è¿›åˆ¶çš„æ•°æ®ï¼Œæ‰€ä»¥æœ€é«˜ä½çš„`1`ä¸¢å¤±ï¼Œ`ax`ä¸­çš„æ•°æ®ä¸º`0058H`ã€‚ï¼ˆè¿™é‡Œçš„ä¸¢å¤±ï¼ŒæŒ‡çš„æ˜¯è¿›ä½å€¼ä¸èƒ½åœ¨8ä½å¯„å­˜å™¨ä¸­ä¿å­˜ï¼Œä½†æ˜¯CPUå¹¶ä¸æ˜¯çœŸçš„ä¸¢å¼ƒè¿™ä¸ªè¿›ä½å€¼ï¼‰\n\n> æ³¨æ„ï¼Œæ­¤æ—¶alæ˜¯ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„8ä½å¯„å­˜å™¨æ¥ä½¿ç”¨çš„ï¼Œå’Œahæ²¡æœ‰å…³ç³»ï¼ŒCPUåœ¨æ‰§è¡Œè¿™æ¡æŒ‡ä»¤æ—¶è®¤ä¸ºahå’Œalæ˜¯ä¸¤ä¸ªä¸ç›¸å…³çš„å¯„å­˜å™¨ã€‚ä¸è¦é”™è¯¯åœ°è®¤ä¸ºadd al, 93Hçš„æŒ‡ä»¤äº§ç”Ÿçš„è¿›ä½ä¼šå­˜å‚¨åœ¨ahä¸­ï¼Œadd al, 93Hè¿›è¡Œçš„æ˜¯8ä½è¿ç®—ã€‚\n>\n> å¦‚æœæ‰§è¡Œadd ax, 93Hï¼Œä½8ä½çš„è¿›ä½ä¼šå­˜å‚¨åœ¨ahä¸­ï¼ŒCPUåœ¨æ‰§è¡Œè¿™æ¡æŒ‡ä»¤æ—¶è®¤ä¸ºåªæœ‰ä¸€ä¸ª16ä½å¯„å­˜å™¨axï¼Œè¿›è¡Œçš„æ˜¯16 ä½è¿ç®—ã€‚æŒ‡ä»¤`add ax, 93H`æ‰§è¡Œåï¼Œaxä¸­çš„å€¼ä¸ºï¼š0158Hã€‚æ­¤æ—¶ï¼Œä½¿ç”¨çš„å¯„å­˜å™¨æ˜¯16ä½å¯„å­˜å™¨axï¼Œ`add ax, 93H`ç›¸å½“äºå°†axä¸­çš„16ä½æ•°æ®00C5Hå’Œå¦ä¸€ä¸ª16ä½æ•°æ®0093Hç›¸åŠ ï¼Œç»“æœæ˜¯16ä½çš„0158Hã€‚\n\n## æ“ä½œå¯¹è±¡çš„ä½æ•°åº”å½“æ˜¯ä¸€è‡´çš„\n\nåœ¨è¿›è¡Œæ•°æ®ä¼ é€æˆ–è¿ç®—æ—¶ï¼Œè¦æ³¨æ„æŒ‡ä»¤çš„ä¸¤ä¸ªæ“ä½œå¯¹è±¡çš„ä½æ•°åº”å½“æ˜¯ä¸€è‡´çš„ï¼Œä¾‹å¦‚ï¼š\n\n```x86asm\nmov ax, bx\nmov bx, cx\nmov ax, 18H\nmov al, 18H\nadd ax, bx\nadd ax, 20000\n```\n\nç­‰éƒ½æ˜¯æ­£ç¡®çš„æŒ‡ä»¤ï¼Œè€Œï¼š\n\n```x86asm\nmov ax, bl    ; åœ¨8ä½å¯„å­˜å™¨å’Œ16ä½å¯„å­˜å™¨ä¹‹é—´ä¼ é€æ•°æ®\nmov bh, ax    ; åœ¨16ä½å¯„å­˜å™¨å’Œ8ä½å¯„å­˜å™¨ä¹‹é—´ä¼ é€æ•°æ®\nmov al, 20000 ; 8ä½å¯„å­˜å™¨æœ€å¤§å¯å­˜æ”¾å€¼ä¸º255çš„æ•°æ®\nadd al, 100H  ; å°†ä¸€ä¸ªé«˜äº8ä½çš„æ•°æ®åŠ åˆ°ä¸€ä¸ª8ä½å¯„å­˜å™¨ä¸­\n```\n\n\nç­‰éƒ½æ˜¯é”™è¯¯çš„æŒ‡ä»¤ï¼Œé”™è¯¯çš„åŸå› éƒ½æ˜¯æŒ‡ä»¤çš„ä¸¤ä¸ªæ“ä½œå¯¹è±¡çš„ä½æ•°ä¸ä¸€è‡´ã€‚\n\n# ç‰©ç†åœ°å€\n\nCPUè®¿é—®å†…å­˜å•å…ƒæ—¶ï¼Œè¦ç»™å‡ºå†…å­˜å•å…ƒçš„åœ°å€ã€‚å³ï¼ŒCPUé€šè¿‡åœ°å€æ€»çº¿é€å…¥å­˜å‚¨å™¨çš„ï¼Œå¿…é¡»æ˜¯ä¸€ä¸ªå†…å­˜å•å…ƒçš„ç‰©ç†åœ°å€ã€‚\n\næ‰€æœ‰çš„å†…å­˜å•å…ƒæ„æˆçš„å­˜å‚¨ç©ºé—´æ˜¯ä¸€ä¸ªä¸€ç»´çš„çº¿æ€§ç©ºé—´ï¼Œæ¯ä¸€ä¸ªå†…å­˜å•å…ƒåœ¨è¿™ä¸ªç©ºé—´ä¸­éƒ½æœ‰å”¯ä¸€çš„åœ°å€ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªå”¯ä¸€çš„åœ°å€ç§°ä¸ºç‰©ç†åœ°å€ã€‚\n\nåœ¨CPUå‘åœ°å€æ€»çº¿ä¸Šå‘å‡ºç‰©ç†åœ°å€ä¹‹å‰ï¼Œå¿…é¡»è¦åœ¨å†…éƒ¨å…ˆå½¢æˆè¿™ä¸ªç‰©ç†åœ°å€ã€‚ä¸åŒçš„CPUå¯ä»¥æœ‰ä¸åŒçš„å½¢æˆç‰©ç†åœ°å€çš„æ–¹å¼ã€‚\n\nä¸‹é¢åˆ†æ8086æ˜¯å¦‚ä½•åœ¨å†…éƒ¨å½¢æˆå†…å­˜å•å…ƒçš„ç‰©ç†åœ°å€çš„ã€‚\n\n# 16ä½CPU\n\nä»€ä¹ˆæ˜¯16ä½ç»“æ„ï¼ˆ16ä½æœºã€å­—é•¿ä¸º16ä½ç­‰å¸¸è§è¯´æ³•ï¼Œä¸16ä½ç»“æ„çš„å«ä¹‰ç›¸åŒï¼‰çš„CPUï¼Ÿæ¦‚æ‹¬åœ°è®²ï¼Œ16ä½ç»“æ„æè¿°äº†ä¸€ä¸ªCPUå…·æœ‰ä¸‹é¢å‡ æ–¹é¢çš„ç»“æ„ç‰¹æ€§ã€‚\n\n* è¿ç®—å™¨ä¸€æ¬¡æœ€å¤šå¯ä»¥å¤„ç†16ä½çš„æ•°æ®ï¼›\n* å¯„å­˜å™¨çš„æœ€å¤§å®½åº¦ä¸º16ä½ï¼›\n* å¯„å­˜å™¨å’Œè¿ç®—å™¨ä¹‹é—´çš„é€šè·¯ä¸º16ä½ã€‚\n\n8086æ˜¯16ä½ç»“æ„çš„CPUï¼Œè¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨8086å†…éƒ¨ï¼Œèƒ½å¤Ÿä¸€æ¬¡æ€§å¤„ç†ã€ä¼ è¾“ã€æš‚æ—¶å­˜å‚¨çš„ä¿¡æ¯çš„æœ€å¤§é•¿åº¦æ˜¯16ä½çš„ã€‚å†…å­˜å•å…ƒçš„åœ°å€åœ¨é€ä¸Šåœ°å€æ€»çº¿ä¹‹å‰ï¼Œå¿…é¡»åœ¨CPUä¸­å¤„ç†ã€ä¼ è¾“ã€æš‚æ—¶å­˜æ”¾ï¼Œå¯¹äº16ä½CPUï¼Œèƒ½ä¸€æ¬¡æ€§å¤„ç†ã€ä¼ è¾“ã€æš‚æ—¶å­˜å‚¨16ä½çš„â€œå•ä½â€åœ°å€ã€‚\n\n# 8086CPUç»™å‡ºç‰©ç†åœ°å€çš„æ–¹æ³•\n\n8086æ˜¯16ä½ç»“æ„ï¼Œåœ¨å†…éƒ¨ä¸€æ¬¡æ€§å¤„ç†ã€ä¼ è¾“ã€æš‚æ—¶å­˜å‚¨çš„åœ°å€ä¸º16ä½ã€‚ä½†æ˜¯8086æœ‰20ä½åœ°å€æ€»çº¿ï¼Œå¯ä»¥ä¼ é€20ä½åœ°å€ï¼Œè¾¾åˆ°1MBå¯»å€èƒ½åŠ›ã€‚ä»8086CPUçš„å†…éƒ¨ç»“æ„æ¥çœ‹ï¼Œå¦‚æœå°†åœ°å€ä»å†…éƒ¨ç®€å•åœ°å‘å‡ºï¼Œé‚£ä¹ˆå®ƒåªèƒ½é€å‡º16ä½çš„åœ°å€ï¼Œè¡¨ç°å‡ºçš„å¯»å€èƒ½åŠ›åªæœ‰64Kâ€œå•ä½â€ä¸ªåœ°å€ã€‚\n\n8086CPUé‡‡ç”¨ä¸€ç§åœ¨å†…éƒ¨**ç”¨ä¸¤ä¸ª16ä½åœ°å€åˆæˆ**çš„æ–¹æ³•æ¥å½¢æˆä¸€ä¸ª20ä½çš„ç‰©ç†åœ°å€ã€‚\n\nå½“8086CPUè¦è¯»å†™å†…å­˜æ—¶ï¼š\n\n1. CPUä¸­çš„ç›¸å…³éƒ¨ä»¶æä¾›ä¸¤ä¸ª16ä½çš„åœ°å€ï¼Œä¸€ä¸ªç§°ä¸ºæ®µåœ°å€ï¼Œå¦ä¸€ä¸ªç§°ä¸ºåç§»åœ°å€ï¼›\n2. æ®µåœ°å€å’Œåç§»åœ°å€é€šè¿‡**å†…éƒ¨æ€»çº¿**é€å…¥ä¸€ä¸ªç§°ä¸º**åœ°å€åŠ æ³•å™¨**çš„éƒ¨ä»¶ï¼›\n3. åœ°å€åŠ æ³•å™¨å°†ä¸¤ä¸ª16ä½åœ°å€åˆæˆä¸ºä¸€ä¸ª20ä½çš„ç‰©ç†åœ°å€ï¼›\n4. åœ°å€åŠ æ³•å™¨é€šè¿‡å†…éƒ¨æ€»çº¿å°†20ä½ç‰©ç†åœ°å€é€å…¥è¾“å…¥/è¾“å‡ºæ§åˆ¶ç”µè·¯ï¼ˆå¯ä»¥çœ‹åˆ°ï¼Œåœ°å€åŠ æ³•å™¨åˆ°è¾“å…¥/è¾“å‡ºæ§åˆ¶ç”µè·¯ä¹‹é—´çš„å†…éƒ¨æ€»çº¿éœ€è¦æœ‰20ä½ï¼‰ï¼›\n5. è¾“å…¥/è¾“å‡ºæ§åˆ¶ç”µè·¯å°†20ä½ç‰©ç†åœ°å€é€ä¸Šå…¶ä¸å†…å­˜ä¹‹é—´çš„åœ°å€æ€»çº¿ï¼›\n6. 20ä½ç‰©ç†åœ°å€è¢«åœ°å€æ€»çº¿ä¼ é€åˆ°å­˜å‚¨å™¨ã€‚\n\nåœ°å€åŠ æ³•å™¨é‡‡ç”¨$ç‰©ç†åœ°å€=æ®µåœ°å€Ã—16(å·¦ç§»4ä½)+åç§»åœ°å€$çš„æ–¹æ³•ç”¨æ®µåœ°å€å’Œåç§»åœ°å€åˆæˆç‰©ç†åœ°å€ã€‚\n\n# æ®µ\n\nå…¶å®ï¼Œå†…å­˜å¹¶æ²¡æœ‰åˆ†æ®µï¼Œæ®µçš„åˆ’åˆ†æ¥è‡ªäºCPUï¼Œç”±äº8086CPUç”¨â€œåŸºç¡€åœ°å€+åç§»åœ°å€=ç‰©ç†åœ°å€â€çš„æ–¹å¼ç»™å‡ºå†…å­˜å•å…ƒçš„ç‰©ç†åœ°å€ï¼Œä½¿å¾—æˆ‘ä»¬åœ¨é€»è¾‘ä¸Šå¯ä»¥ç”¨åˆ†æ®µçš„æ–¹å¼æ¥ç®¡ç†å†…å­˜ã€‚å¯ä»¥æ ¹æ®éœ€è¦ï¼Œå°†åœ°å€è¿ç»­ã€èµ·å§‹åœ°å€ä¸º16çš„å€æ•°çš„ä¸€ç»„å†…å­˜å•å…ƒå®šä¹‰ä¸ºä¸€ä¸ªæ®µã€‚\n\nåœ¨8086æœºä¸­ï¼Œå­˜å‚¨å•å…ƒçš„åœ°å€ç”¨ä¸¤ä¸ªå…ƒç´ æ¥æè¿°ï¼Œå³æ®µåœ°å€å’Œåç§»åœ°å€ã€‚\"æ•°æ®åœ¨21F60Hå†…å­˜å•å…ƒä¸­ã€‚\"è¿™å¥è¯å¯¹äº8086æœºä¸€èˆ¬ä¸è¿™æ ·è®²ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä¸¤ç§ç±»ä¼¼çš„è¯´æ³•ï¼š1ã€æ•°æ®å­˜åœ¨å†…å­˜2000:1F60å•å…ƒä¸­ï¼›2ã€æ•°æ®å­˜åœ¨å†…å­˜çš„2000Hæ®µä¸­çš„1F60Hå•å…ƒä¸­ã€‚è¿™ä¸¤ç§æè¿°éƒ½è¡¨ç¤º\"æ•°æ®åœ¨å†…å­˜21F60Hå•å…ƒä¸­\"ã€‚\n\n# æ®µå¯„å­˜å™¨--CSä¸ºä¾‹\n\næˆ‘ä»¬å‰é¢è®²åˆ°ï¼Œ8086åœ¨è®¿é—®å†…å­˜æ—¶è¦ç”±ç›¸å…³éƒ¨ä»¶æä¾›å†…å­˜å•å…ƒçš„æ®µåœ°å€å’Œåç§»åœ°å€ï¼Œé€å…¥åœ°å€åŠ æ³•å™¨åˆæˆç‰©ç†åœ°å€ã€‚è¿™é‡Œï¼Œéœ€è¦çœ‹ä¸€ä¸‹ï¼Œæ˜¯ä»€ä¹ˆéƒ¨ä»¶æä¾›æ®µåœ°å€ã€‚æ®µåœ°å€åœ¨8086çš„æ®µå¯„å­˜å™¨ä¸­å­˜æ”¾ã€‚8086æœ‰4ä¸ªæ®µå¯„å­˜å™¨CSã€DSã€SSã€ESã€‚å½“8086è¦è®¿é—®å†…å­˜æ—¶ç”±è¿™4ä¸ªæ®µå¯„å­˜å™¨æä¾›å†…å­˜å•å…ƒçš„æ®µåœ°å€ã€‚çœ‹ä¸€ä¸‹CSï¼ˆCSï¼Œå…¨æ‹¼ä¸ºCode Segmentï¼‰ã€‚\n\nCSå’ŒIPæ˜¯8086ä¸­ä¸¤ä¸ªæœ€å…³é”®çš„å¯„å­˜å™¨ï¼Œå®ƒä»¬æŒ‡ç¤ºäº†CPUå½“å‰è¦è¯»å–æŒ‡ä»¤çš„åœ°å€ã€‚CSä¸ºä»£ç æ®µå¯„å­˜å™¨ï¼ŒIPä¸ºæŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨ï¼Œä»åç§°ä¸Šå¯ä»¥çœ‹å‡ºå®ƒä»¬å’ŒæŒ‡ä»¤çš„å…³ç³»ã€‚\n\nåœ¨8086PCæœºä¸­ï¼Œä»»æ„æ—¶åˆ»ï¼Œè®¾CSä¸­çš„å†…å®¹ä¸ºMï¼ŒIPä¸­çš„å†…å®¹ä¸ºNï¼Œ8086å°†ä»å†…å­˜MÃ—16+Nå•å…ƒå¼€å§‹ï¼Œè¯»å–ä¸€æ¡æŒ‡ä»¤å¹¶æ‰§è¡Œã€‚\n\nä¹Ÿå¯ä»¥è¿™æ ·è¡¨è¿°ï¼š8086æœºä¸­ï¼Œä»»æ„æ—¶åˆ»ï¼ŒCPUå°†CS:IPæŒ‡å‘çš„å†…å®¹å½“ä½œæŒ‡ä»¤æ‰§è¡Œã€‚\n\nåœ¨å†…å­˜ä¸­ï¼ŒæŒ‡ä»¤å’Œæ•°æ®æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œéƒ½æ˜¯äºŒè¿›åˆ¶ä¿¡æ¯ï¼ŒCPUåœ¨å·¥ä½œçš„æ—¶å€™æŠŠæœ‰çš„ä¿¡æ¯çœ‹ä½œæŒ‡ä»¤ï¼Œæœ‰çš„ä¿¡æ¯çœ‹ä½œæ•°æ®ã€‚ç°åœ¨ï¼Œå¦‚æœæå‡ºä¸€ä¸ªé—®é¢˜ï¼š**CPUæ ¹æ®ä»€ä¹ˆå°†å†…å­˜ä¸­çš„ä¿¡æ¯çœ‹ä½œæŒ‡ä»¤ï¼Ÿå¯ä»¥è¯´ï¼ŒCPUå°†CS:IPæŒ‡å‘çš„å†…å­˜å•å…ƒä¸­çš„å†…å®¹çœ‹ä½œæŒ‡ä»¤**ï¼Œå› ä¸ºï¼Œåœ¨ä»»ä½•æ—¶å€™ï¼ŒCPUå°†CSã€IPä¸­çš„å†…å®¹å½“ä½œæŒ‡ä»¤çš„æ®µåœ°å€å’Œåç§»åœ°å€ï¼Œç”¨å®ƒä»¬åˆæˆæŒ‡ä»¤çš„ç‰©ç†åœ°å€ï¼Œåˆ°å†…å­˜ä¸­è¯»å–æŒ‡ä»¤ç ï¼Œæ‰§è¡Œã€‚å¦‚æœè¯´ï¼Œå†…å­˜ä¸­çš„ä¸€æ®µä¿¡æ¯æ›¾è¢«CPUæ‰§è¡Œè¿‡çš„è¯ï¼Œé‚£ä¹ˆï¼Œå®ƒæ‰€åœ¨çš„å†…å­˜å•å…ƒå¿…ç„¶è¢«CS:IPæŒ‡å‘è¿‡ã€‚\n\n## ä¿®æ”¹CSã€IPçš„æŒ‡ä»¤--è½¬ç§»æŒ‡ä»¤\n\nCPUä»ä½•å¤„æ‰§è¡ŒæŒ‡ä»¤æ˜¯ç”±CSã€IPä¸­çš„å†…å®¹å†³å®šçš„ï¼Œåœ¨CPUä¸­ï¼Œç¨‹åºå‘˜èƒ½å¤Ÿç”¨æŒ‡ä»¤è¯»å†™çš„éƒ¨ä»¶åªæœ‰å¯„å­˜å™¨ï¼Œç¨‹åºå‘˜å¯ä»¥é€šè¿‡æ”¹å˜å¯„å­˜å™¨ä¸­çš„å†…å®¹å®ç°æ§åˆ¶CPUçš„æ‰§è¡Œç›®æ ‡æŒ‡ä»¤ã€‚\n\nå¦‚ä½•æ”¹å˜CSã€IPçš„å€¼å‘¢ï¼Ÿæ˜¾ç„¶ï¼Œ8086å¿…é¡»æä¾›ç›¸åº”çš„æŒ‡ä»¤ã€‚æˆ‘ä»¬å¦‚ä½•ä¿®æ”¹AXä¸­çš„å€¼ï¼Ÿå¯ä»¥ç”¨movæŒ‡ä»¤ï¼Œå¦‚`mov ax, 123`å°†axä¸­çš„å€¼è®¾ä¸º123ã€‚æ˜¾ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•è®¾ç½®å…¶ä»–å¯„å­˜å™¨çš„å€¼ï¼Œå¦‚`mov bx, 123`ï¼Œ`mov cx, 123`ï¼Œ`mov dx, 123`ç­‰ã€‚\n\nå…¶å®ï¼Œ**8086å¤§éƒ¨åˆ†å¯„å­˜å™¨çš„å€¼ï¼Œéƒ½å¯ä»¥ç”¨movæŒ‡ä»¤æ¥æ”¹å˜ï¼ŒmovæŒ‡ä»¤è¢«ç§°ä¸ºä¼ é€æŒ‡ä»¤**ã€‚\n\nä½†æ˜¯ï¼ŒmovæŒ‡ä»¤ä¸èƒ½ç”¨äºè®¾ç½®CSã€IPçš„å€¼ï¼ŒåŸå› å¾ˆç®€å•ï¼Œå› ä¸º8086æ²¡æœ‰èµ‹äºˆmovè¿™æ ·çš„æƒé™ã€‚8086ä¸ºCSã€IPæä¾›äº†å¦å¤–çš„æŒ‡ä»¤æ¥æ”¹å˜å®ƒä»¬çš„å€¼ã€‚èƒ½å¤Ÿæ”¹å˜CSã€IPçš„å†…å®¹çš„æŒ‡ä»¤è¢«ç»Ÿç§°ä¸º**è½¬ç§»æŒ‡ä»¤**ã€‚çœ‹ä¸€ä¸ªæœ€ç®€å•çš„å¯ä»¥ä¿®æ”¹CSã€IPçš„æŒ‡ä»¤ï¼š`jmp`æŒ‡ä»¤ã€‚\n\n### jmp æ®µåœ°å€:åç§»åœ°å€\n\nè‹¥æƒ³åŒæ—¶ä¿®æ”¹CSã€IPçš„å†…å®¹ï¼Œå¯ç”¨å½¢å¦‚\"`jmp æ®µåœ°å€:åç§»åœ°å€`\"çš„æŒ‡ä»¤å®Œæˆï¼Œå¦‚`jmp 2AE3:3`ï¼Œæ‰§è¡Œåï¼š`CS=2AE3H`ï¼Œ`IP=0003H`ï¼ŒCPUå°†ä»`2AE33H`å¤„è¯»å–æŒ‡ä»¤ã€‚`jmp 3:0B16`ï¼Œæ‰§è¡Œåï¼š`CS=0003H`ï¼Œ`IP=0B16H`ï¼ŒCPUå°†ä»`00B46H`å¤„è¯»å–æŒ‡ä»¤ã€‚\n\n\"`jmp æ®µåœ°å€:åç§»åœ°å€`\"æŒ‡ä»¤çš„åŠŸèƒ½ä¸ºï¼šç”¨æŒ‡ä»¤ä¸­ç»™å‡ºçš„æ®µåœ°å€ä¿®æ”¹CSï¼Œåç§»åœ°å€ä¿®æ”¹IPã€‚\n\n### jmp æŸä¸€åˆæ³•å¯„å­˜å™¨\n\nè‹¥æƒ³ä»…ä¿®æ”¹IPçš„å†…å®¹ï¼Œå¯ç”¨å½¢å¦‚\"`jmp æŸä¸€åˆæ³•å¯„å­˜å™¨`\"çš„æŒ‡ä»¤å®Œæˆï¼Œå¦‚`jmp ax`ï¼ŒæŒ‡ä»¤æ‰§è¡Œå‰ï¼š`ax=1000H`ï¼Œ`CS=2000H`ï¼Œ`IP=0003H`ï¼›æŒ‡ä»¤æ‰§è¡Œåï¼š`ax=1000H`ï¼Œ`CS=2000H`ï¼Œ`IP=1000H`ã€‚`jmp bx`ï¼ŒæŒ‡ä»¤æ‰§è¡Œå‰ï¼š`bx=0B16H`ï¼Œ`CS=2000H`ï¼Œ`IP=0003H`ã€‚æŒ‡ä»¤æ‰§è¡Œåï¼š`bx=0B16H`ï¼Œ`CS=2000H`ï¼Œ`IP=0B16H`ã€‚\n\n\"jmp æŸä¸€åˆæ³•å¯„å­˜å™¨\"æŒ‡ä»¤çš„åŠŸèƒ½ä¸ºï¼šç”¨å¯„å­˜å™¨ä¸­çš„å€¼ä¿®æ”¹IPã€‚\n\n`jmp ax`ï¼Œåœ¨å«ä¹‰ä¸Šå¥½ä¼¼ï¼š`mov IP, ax`ã€‚\n\n### ç”¨æ±‡ç¼–è§£é‡Šæ±‡ç¼–\n\n\"ç”¨æ±‡ç¼–è§£é‡Šæ±‡ç¼–\"èƒ½æ›´å¥½åœ°ç†è§£æ±‡ç¼–æŒ‡ä»¤çš„åŠŸèƒ½ï¼Œè¦å¼ºè°ƒçš„æ˜¯ï¼Œæ˜¯ç”¨\"å·²çŸ¥çš„æ±‡ç¼–æŒ‡ä»¤çš„è¯­æ³•\"è¿›è¡Œæè¿°ï¼Œå¹¶ä¸æ˜¯ç”¨\"å·²çŸ¥çš„æ±‡ç¼–æŒ‡ä»¤\"æ¥æè¿°ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬ç”¨`mov IP, ax`æ¥æè¿°`jmp ax`ï¼Œå¹¶ä¸æ˜¯è¯´çœŸæœ‰`mov IP, ax`è¿™æ ·çš„æŒ‡ä»¤ï¼Œè€Œæ˜¯ç”¨movæŒ‡ä»¤çš„è¯­æ³•æ¥è¯´æ˜`jmp`æŒ‡ä»¤çš„åŠŸèƒ½ã€‚æˆ‘ä»¬å¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•æè¿°`jmp 3:01B6`çš„åŠŸèƒ½ï¼š`jmp 3:01B6`åœ¨å«ä¹‰ä¸Šå¥½ä¼¼`mov CS, 3`, `mov IP, 01B6`ã€‚\n\n## æ€»ç»“\n\n1. æ®µåœ°å€åœ¨8086çš„æ®µå¯„å­˜å™¨ä¸­å­˜æ”¾ã€‚å½“8086è¦è®¿é—®å†…å­˜æ—¶ï¼Œç”±æ®µå¯„å­˜å™¨æä¾›å†…å­˜å•å…ƒçš„æ®µåœ°å€ã€‚8086æœ‰4ä¸ªæ®µå¯„å­˜å™¨ï¼Œå…¶ä¸­CSç”¨æ¥å­˜æ”¾æŒ‡ä»¤çš„æ®µåœ°å€ã€‚\n2. CSå­˜æ”¾æŒ‡ä»¤çš„æ®µåœ°å€ï¼ŒIPå­˜æ”¾æŒ‡ä»¤çš„åç§»åœ°å€ã€‚8086æœºä¸­ï¼Œä»»æ„æ—¶åˆ»ï¼ŒCPUå°†CS:IPæŒ‡å‘çš„å†…å®¹å½“ä½œæŒ‡ä»¤æ‰§è¡Œã€‚\n3. 8086çš„å·¥ä½œè¿‡ç¨‹\n   1. ä»CS:IPæŒ‡å‘çš„å†…å­˜å•å…ƒè¯»å–æŒ‡ä»¤ï¼Œè¯»å–çš„æŒ‡ä»¤è¿›å…¥æŒ‡ä»¤ç¼“å†²å™¨ï¼›\n   2. IPæŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼›\n   3. æ‰§è¡ŒæŒ‡ä»¤ã€‚ï¼ˆè½¬åˆ°æ­¥éª¤1ï¼Œé‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚ï¼‰\n4. 8086æä¾›è½¬ç§»æŒ‡ä»¤ä¿®æ”¹CSã€IPçš„å†…å®¹\n\n# è®¿é—®å†…å­˜çš„è§’åº¦\n\n","categories":["å¾®æœºåŸç†"]},{"title":"Linux_vimç§¯ç´¯_vimå®ç”¨æŠ€å·§ç¬”è®°","url":"/Linux/Linux_vimç§¯ç´¯/","content":"\n# å‘½ä»¤è¡Œæ¨¡å¼ï¼ˆæ™®é€šæ¨¡å¼ï¼‰\n\nä¹Ÿç§°ä¸ºäº¤äº’æ¨¡å¼ï¼Œè¿™æ˜¯ `vim` çš„é»˜è®¤æ¨¡å¼ï¼Œæ¯æ¬¡ä½¿ç”¨ `vim` å‘½ä»¤ç¼–è¾‘æ–‡ä»¶çš„æ—¶å€™ï¼Œå°±ä¼šå…ˆè¿›å…¥è¿™ä¸ªæ¨¡å¼ã€‚\n- åœ¨è¿™ä¸ªæ¨¡å¼ä¸‹ï¼Œä½ ä¸èƒ½è¾“å…¥æ–‡æœ¬ï¼›\n- å®ƒå¯ä»¥è®©æˆ‘ä»¬åœ¨æ–‡æœ¬é—´ç§»åŠ¨ï¼Œåˆ é™¤ä¸€è¡Œæ–‡æœ¬ï¼Œå¤åˆ¶ç²˜è´´æ–‡æœ¬ï¼Œè·³è½¬åˆ°æŒ‡å®šè¡Œï¼Œæ’¤é”€æ“ä½œï¼Œç­‰ç­‰ã€‚\n## å¸¸ç”¨å‘½ä»¤\n\n| å‘½ä»¤  | ä½œç”¨                                                                   |\n| --- | -------------------------------------------------------------------- |\n| i   | åˆ‡æ¢åˆ°è¾“å…¥æ¨¡å¼ï¼Œä»¥è¾“å…¥å­—ç¬¦                                                        |\n| x   | åˆ é™¤å½“å‰å…‰æ ‡æ‰€åœ¨å¤„çš„å­—ç¬¦                                                         |\n| X   | åˆ é™¤å½“å‰å…‰æ ‡å‰ä¸€ä¸ªå­—ç¬¦                                                          |\n| :   | åˆ‡æ¢åˆ°åº•çº¿å‘½ä»¤æ¨¡å¼ï¼Œä»¥åœ¨æœ€åº•ä¸€è¡Œè¾“å…¥å‘½ä»¤                                                 |\n| gg  | è·³è½¬åˆ°æ–‡ä»¶å¼€å¤´                                                              |\n| G   | è·³è½¬åˆ°æ–‡ä»¶æœ«å°¾                                                              |\n| dd  | å‰ªåˆ‡ï¼šåˆ é™¤å…‰æ ‡æ‰€åœ¨ä¸€æ•´è¡Œæ•°æ®ï¼Œä¸”ä¸´æ—¶å­˜å‚¨åˆ°ç¼“å­˜åŒº                                             |\n| yy  | å¤åˆ¶ï¼šæŠŠæ•´è¡Œæ–‡æœ¬åˆ°ä¸´æ—¶ç¼“å­˜åŒºã€‚                                                      |\n| på°å†™ | ç²˜è´´ï¼šå°†æŒ‡å®šç¼“å­˜åŒºå†…å®¹æ”¾åœ¨å…‰æ ‡ä½ç½®ä¹‹ä¸‹ï¼š<br>å¦‚æœæ˜¯æ•´è¡Œæ–‡æœ¬åˆ™æ”¾åœ¨å½“å‰çš„ä¸‹ä¸€è¡Œï¼Œè‹¥æ˜¯éæ•´è¡Œæ–‡æœ¬åˆ™æ”¾åœ¨å…‰æ ‡åé¢              |\n| På¤§å†™ | ç²˜è´´ï¼šå°†æŒ‡å®šç¼“å†²åŒºçš„å†…å®¹æ”¾åˆ°å½“å‰å…‰æ ‡çš„ä½ç½®ä¹‹ä¸Šï¼š<br>å¦‚æœæ˜¯æ•´è¡Œæ–‡æœ¬åˆ™æ”¾åœ¨è¿™ä¸€è¡Œå¹¶åœ¨æœ€åæ¢è¡Œï¼Œè‹¥æ˜¯éæ•´è¡Œæ–‡æœ¬åˆ™æ”¾åœ¨å…‰æ ‡å‰é¢       |\n| u   | æ’¤é”€æœ€è¿‘çš„ä¿®æ”¹ï¼Œé’ˆå¯¹æ‰€æœ‰ä¿®æ”¹                                                       |\n| U   | æ’¤é”€å¯¹å½“å‰è¡Œä¸Šåšçš„æ‰€æœ‰ä¿®æ”¹                                                        |\n| r   | æ›¿æ¢å…‰æ ‡ä½ç½®ä¸Šçš„ä¸€ä¸ªå­—ç¬¦ï¼Œä½†ä¸ä¼šè¿›å…¥ `insert` æ¨¡å¼ï¼Œå…ˆæŒ‰ `r` å†æŒ‰è¦æ›¿æ¢æˆçš„å­—ç¬¦ï¼Œä¹Ÿå¯ä»¥ `2r` æŠŠå…‰æ ‡åé¢ä¸¤ä¸ªéƒ½æ›¿æ¢æ‰ |\n| R   | æ›¿æ¢ä»å…‰æ ‡ä½ç½®å¼€å§‹çš„å­—ç¬¦ï¼ŒåŒæ—¶æ”¹å˜ `vim` åˆ°æ–‡æœ¬è¾“å…¥æ¨¡å¼                                      |\n| .   | é‡å¤ä¸Šä¸€æ¬¡çš„ä¿®æ”¹ -- æ³¨æ„è¯¥å‘½ä»¤æ˜¯è‹±æ–‡ç¬¦å·ç‚¹                                              |\n| >>  | å‘å³ç§»åŠ¨æœ¬è¡Œä¸€æ®µè·ç¦»                                                           |\n| <<  | å‘å·¦ç§»åŠ¨æœ¬è¡Œä¸€æ®µè·ç¦»                                                           |\n\né“¾æ¥ï¼šhttps://juejin.cn/post/7070699702732783623  \n## å…¶ä»–\ncopy wordã€delete wordï¼š\n\nä¸wæœ‰å…³çš„éƒ½ä¼šåŠ ä¸Šå•è¯ä¹‹åçš„ç©ºæ ¼ã€‚\n\n`cw`åˆ é™¤ä»å…‰æ ‡ä½ç½®åˆ°å½“å‰è¯ç»“å°¾å¤„çš„æ–‡æœ¬ï¼ˆä¸€ä¸ªå•è¯+ç©ºæ ¼ï¼‰ï¼Œå¹¶åˆ‡æ¢åˆ°æ’å…¥æ¨¡å¼\n`dw`åˆ é™¤å…‰æ ‡ä¸‹çš„å•è¯+ç©ºæ ¼\n`yw`å¤åˆ¶ä¸€ä¸ªå•è¯ï¼Œ`y2w`å¤åˆ¶2ä¸ªå•è¯\n`y$`å¤åˆ¶ä»å½“å‰å…‰æ ‡åˆ°è¡Œç»“å°¾çš„æ‰€æœ‰å•è¯\n`y0`å¤åˆ¶ä»å½“å‰å…‰æ ‡åˆ°è¡Œé¦–çš„æ‰€æœ‰å•è¯\n`yy`å¤åˆ¶ä¸€æ•´è¡Œ\n`2yy`å¤åˆ¶ä»å½“å‰å…‰æ ‡æ‰€åœ¨è¡Œå¼€å§‹çš„ 2 è¡Œ\n# ç¬”è®°\n\næ ·å¼ï¼š**æ™®é€šæ¨¡å¼**æ‰€ç”¨çš„æ ·å¼ä¹Ÿç”¨äº**å¯è§†æ¨¡å¼**ï¼›è€Œ**æ’å…¥æ¨¡å¼**çš„æ ·å¼ä¹Ÿç”¨æ¥è¡¨ç¤º**å‘½ä»¤è¡Œæ¨¡å¼**åŠ**æ›¿æ¢æ¨¡å¼**ä¸‹è¾“å…¥çš„æŒ‰é”®ã€‚å¯ä»¥é€šè¿‡ä¸Šä¸‹æ–‡æ¸…æ¥šåœ°çŸ¥é“å½“å‰å¤„äºå“ªä¸ªæ¨¡å¼ã€‚\n\n![image-20220829205901688](../../images/Linux_vimç§¯ç´¯/image-20220829205901688.png)\n\n## å‘½ä»¤è¡Œä¸­æ“ä½œ\n\n![image-20220829210003288](../../images/Linux_vimç§¯ç´¯/image-20220829210003288.png)\n\n# å¦‚ä½•æ¿€æ´»æŸ¥æ‰¾çš„å­—ç¬¦ä¸²æ‰€æœ‰éƒ½é«˜äº®\n\n# å¯è§†æ¨¡å¼\n\nå¯è§†æ¨¡å¼å…è®¸åœ¨ç¼“å†²åŒºå†…é€‰æ‹©æ–‡æœ¬ï¼Œç„¶ååœ¨å…¶ä¸Šæ“ä½œã€‚åœ¨ä¸‹ä¾‹ä¸­ï¼Œç”¨`it`æ–‡æœ¬å¯¹è±¡é€‰ä¸­`<a>`æ ‡ç­¾å†…çš„æ–‡æœ¬ã€‚\n\nè¿™ä¼šå‡ºç°ä¸€ç§ï¼šé«˜äº®æ˜¾ç¤ºå¯è§†é€‰åŒºã€‚æ ·å¼ä¸æŸ¥æ‰¾åŒ¹é…é¡¹çš„æ ·å¼ç›¸åŒã€‚\n\n# ä½¿ç”¨VimåŸç”Ÿé…ç½®\n\n```bash\nvim -u NONE -N\n```\n\n`-u NONE`æ ‡å¿—è®©Vimåœ¨å¯åŠ¨æ—¶ä¸åŠ è½½vimrcï¼Œè¿™æ ·ï¼Œå®šåˆ¶é¡¹å°±ä¸ä¼šç”Ÿæ•ˆï¼Œæ’ä»¶ä¹Ÿä¼šè¢«ç¦ç”¨ã€‚å½“ä¸åŠ è½½vimrcæ–‡ä»¶æ—¶ï¼ŒVimä¼šåˆ‡æ¢åˆ°viå…¼å®¹æ¨¡å¼ï¼Œè¿™å°†å¯¼è‡´å¾ˆå¤šæœ‰ç”¨çš„åŠŸèƒ½è¢«ç¦ç”¨ï¼Œ`-N`æ ‡å¿—åˆ™ä¼šä½¿èƒ½`'nocompatible'`é€‰é¡¹ï¼Œé˜²æ­¢è¿›å…¥viå…¼å®¹æ¨¡å¼ã€‚\n\næœ‰äº›Vimçš„å†…ç½®åŠŸèƒ½æ˜¯ç”±Vimè„šæœ¬å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰åœ¨æ¿€æ´»æ’ä»¶æ—¶ï¼Œå®ƒä»¬æ‰ä¼šå·¥ä½œã€‚ä¸‹é¢æ˜¯åŒ…å«äº†æ¿€æ´»Vimå†…ç½®æ’ä»¶çš„æœ€å°é…ç½®æ–‡ä»¶ã€‚\n\n```\nset nocompatible\nfiletype plugin on\n```\n\nåœ¨å¯åŠ¨Vimæ—¶ï¼Œå¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œç”¨è¯¥æ–‡ä»¶å–ä»£é»˜è®¤çš„vimrcã€‚\n\n```\nvim -u code/essential.vim\n```\n\n> æ¿€æ´»Vimå†…ç½®çš„æ’ä»¶åŠŸèƒ½åï¼Œå¯ä»¥ä½¿ç”¨è¯¸å¦‚netrwã€omni-completionï¼Œä»¥åŠå¾ˆå¤šå…¶ä»–çš„åŠŸèƒ½ã€‚Vimçš„å‡ºå‚é…ç½®ï¼ŒæŒ‡çš„å°±æ˜¯æ¿€æ´»äº†å†…ç½®çš„æ’ä»¶åŠŸèƒ½ï¼Œå¹¶ä¸”ç¦ç”¨äº†viå…¼å®¹æ¨¡å¼æ—¶çš„é…ç½®ã€‚\n\n# Vimç‰ˆæœ¬\n\næœ‰äº›VimåŠŸèƒ½å¯ä»¥åœ¨ç¼–è¯‘æœŸé—´è¢«ç¦ç”¨ã€‚ä¾‹å¦‚ï¼Œåœ¨é…ç½®ç¼–è¯‘é€‰é¡¹æ—¶ï¼Œå¯ä»¥ä¼ å…¥`--with-features=tiny`å‚æ•°ï¼Œè¿™ä¼šç¦ç”¨é™¤æœ€åŸºæœ¬çš„åŠŸèƒ½å¤–çš„å…¶ä»–æ‰€æœ‰åŠŸèƒ½ï¼ˆVimçš„åŠŸèƒ½é›†è¿˜åŒ…æ‹¬smallã€normalã€bigå’Œhugeï¼‰ã€‚\n\nå¯ä»¥æŸ¥é˜…`:h+feature-list`ï¼Œæµè§ˆå®Œæ•´çš„åŠŸèƒ½åˆ—è¡¨ã€‚å¦‚æœå‘ç°Vimç¼ºå°‘æŸä¸ªåŠŸèƒ½ï¼Œé‚£ä¹ˆä¹Ÿè®¸æ­£åœ¨ä½¿ç”¨ä¸€ä¸ªæœ€å°åŠŸèƒ½é›†çš„Vimå‘è¡Œç‰ˆã€‚å¯ä»¥ç”¨`:version`å‘½ä»¤æ£€æŸ¥æ­¤åŠŸèƒ½æ˜¯å¦å¯ç”¨ã€‚\n\n# è®¾ç½®è¡Œå·\n\nä¸´æ—¶è®¾ç½®\n\n`:set number`ï¼ˆæˆ–`:set nu`ï¼‰æ˜¾ç¤ºè¡Œå·\n`:set nonumber`ï¼ˆæˆ–`:set nonu`ï¼‰å–æ¶ˆè¡Œå·\n\næ°¸ä¹…æ˜¾ç¤ºè¡Œå·\n\n1. æŸ¥æ‰¾Vimè®¾å®šæ–‡ä»¶`sudo find / -name vimrc`\n2. ä¿®æ”¹Vimè®¾å®šæ–‡ä»¶`/etc/vimrc`ï¼Œæœ«å°¾æ·»åŠ `set number`ï¼ˆæˆ–`set nu`ï¼‰ï¼Œä¿å­˜å³å¯ã€‚\n","categories":["Linux","vim"]},{"title":"git_æ¢è¡Œç¬¦é—®é¢˜","url":"/git/git_æ¢è¡Œç¬¦é—®é¢˜/","content":"\n# é—®é¢˜\n\ngit diffæ—¶å‘ç°æ˜æ˜åªæ”¹åŠ¨äº†å‡ è¡Œä»£ç ï¼Œä½†æ˜¯å¯¹æ¯”æ—¶å´æ˜¾ç¤ºå…¨éƒ¨æ–‡æ¡£éƒ½ä¿®æ”¹è¿‡äº†ï¼Œè€Œä¸”åˆ°å¤„éƒ½æ˜¯`^M`å­—ç¬¦ï¼Œå¯¼è‡´çœ‹ä¸å‡ºä¿®æ”¹ç‚¹ï¼Œè¾¾ä¸åˆ°git diffçš„æ•ˆæœã€‚\n\n# è§£å†³æ–¹æ¡ˆ\n\n- åˆ†æåŸå› \n  `^M`æ ¹æ®ASCIIç è¡¨, æŸ¥å‡ºæ˜¯`\\r`ï¼Œå³windowsæ¢è¡Œç¬¦`\\r\\n`çš„å‰ä¸€åŠã€‚çŒœæµ‹å¯èƒ½æ˜¯æ–‡ä»¶ç¼–å†™/æŸ¥çœ‹æ“ä½œç³»ç»Ÿä¸åŒå¯¼è‡´ï¼Œç”¨`od -tc æ–‡ä»¶`æŸ¥çœ‹æ–‡ä»¶ï¼Œç¡®å®æ˜¯`\\r`æ¢è¡Œç¬¦å¯¼è‡´çš„ã€‚\n\n- è§£å†³æ–¹æ¡ˆ\n\næœäº†ä¸€ä¸‹ï¼Œåƒéä¸€å¾‹çš„è§£å†³æ–¹æ¡ˆæ˜¯åŠ ä¸€ä¸ªé…ç½®ï¼Œå¿½ç•¥æ¢è¡Œç¬¦çš„å·®å¼‚ï¼š\n\n```shell\ngit config --global core.whitespace cr-at-eol  \n```\n\nä½†æ˜¯è®¾ç½®åå¹¶æ²¡æœ‰æ•ˆæœï¼Œå¯èƒ½å’Œgitç‰ˆæœ¬æœ‰å…³ã€‚\n\næ—¢ç„¶æ˜¯`\\r`çš„é—®é¢˜ï¼Œé‚£æŠŠ`\\r`å»æ‰è¯•è¯•ï¼Œç”¨UEç¼–è¾‘å™¨æ ¹æ®æ­£åˆ™`$\\n`æ›¿æ¢æˆ`\\n`åï¼Œæ¢è¡Œç¬¦å˜æˆäº†`\\n`ã€‚\n\næŠŠå†…å®¹è´´åˆ°ideaåï¼Œå‘ç°æ¢è¡Œç¬¦è¿˜æ˜¯`\\r`ï¼Œè¿™ä¸ªæ—¶å€™å‘ç°å¯èƒ½æ˜¯ideaè®¾ç½®æ¢è¡Œç¬¦çš„é—®é¢˜ã€‚é‚ç™¾åº¦äº†ä¸‹ideaæ¢è¡Œç¬¦è®¾ç½®ã€‚\n\n# IDEæ¢è¡Œç¬¦è®¾ç½®\n\n## ideaå…¨å±€æ¢è¡Œç¬¦\n\n`file` -> `setting` -> `code style` -> `Line separator`\n\né»˜è®¤æ˜¯System-Dependentï¼Œå°±æ˜¯æ ¹æ®å½“å‰æ“ä½œç³»ç»Ÿè¿›è¡Œè®¾ç½®ã€‚æŠŠå®ƒæ”¹æˆ`\\n`ã€‚\n\n## å•ä¸ªæ–‡ä»¶ä¿®æ”¹æ¢è¡Œç¬¦\n\nä¿®æ”¹ä¸º`\\n`ï¼Œå³LFã€‚\n\næœ€åå‘ç°ï¼Œå†…å®¹é‡Œçš„`^M`æ²¡æœ‰äº†ã€‚`git diff`ç»“æœä¹Ÿæ­£å¸¸äº†ã€‚\n","categories":["Linux","git"]},{"title":"Linux_åœ°å€æ˜ å°„","url":"/Linux/Linux_åœ°å€æ˜ å°„/","content":"\n# å†…å®¹\n\n* å®æ¨¡å¼\n* ä¿æŠ¤æ¨¡å¼\n* å®æ¨¡å¼ä¸‹çš„åœ°å€æ˜ å°„\n* ä¿æŠ¤æ¨¡å¼ä¸‹çš„åœ°å€æ˜ å°„\n* å†…å­˜çš„åˆ†æ®µå¼æ˜ å°„\n* å†…å­˜çš„åˆ†é¡µå¼æ˜ å°„\n\n# å¼•å…¥\n\nåœ¨ç¨‹åºä¸­æ‰“å°å˜é‡çš„åœ°å€ã€‚æ­¤åœ°å€æ˜¯ä»€ä¹ˆåœ°å€ï¼Ÿ\n\n","categories":["æ“ä½œç³»ç»Ÿ","Linux"]},{"title":"FFmpeg_å¸¸ç”¨å‘½ä»¤","url":"/ä¸€äº›å·¥å…·çš„ä½¿ç”¨/FFmpeg_å¸¸ç”¨å‘½ä»¤/","content":"# å†…å®¹\n\n* å¸¸ç”¨å‚æ•°é€‰é¡¹\n* æŠ½å–è§†é¢‘çš„éŸ³é¢‘ï¼Œä¿å­˜ä¸ºå•ç‹¬çš„æ–‡ä»¶\n\n# å¸¸ç”¨å‚æ•°é€‰é¡¹\n\n| é€‰é¡¹                       | æè¿°                 |\n| -------------------------- | -------------------- |\n| `-i`                       | è¾“å…¥çš„æ–‡ä»¶           |\n| `-vn`                      | disable video        |\n| `-b:v`                     | è§†é¢‘ç ç‡             |\n| `-b:a`                     | éŸ³é¢‘ç ç‡             |\n| `-acodec`/`-vcodec` `copy` | ä»£è¡¨å¤ç”¨åŸéŸ³è§†é¢‘æ ¼å¼ |\n\n# æŠ½å–éŸ³é¢‘\n\nhttps://superuser.com/questions/332347/how-can-i-convert-mp4-video-to-mp3-audio-with-ffmpeg\n\nThe basic command is:\n\n```\nffmpeg -i filename.mp4 filename.mp3\n```\n\nor\n\n```\nffmpeg -i video.mp4 -b:a 192K -vn music.mp3\n```\n\nCheck this URL: [MP4 Video to MP3 File Using ffmpeg (Ubuntu 9.10 Karmic Koala)](http://donnieknows.com/blog/mp4-video-mp3-file-using-ffmpeg-ubuntu-910-karmic-koala) link broken [Updated on 7th Dec 2021]\n\n**Note:** Ubuntu does not supply FFmpeg, but the fork named [Libav](http://libav.org/). The syntax is the same â€“ just use `avconv` instead of `ffmpeg` for the above examples.\n\n---\n\nhttps://stackoverflow.com/questions/9913032/how-can-i-extract-audio-from-video-with-ffmpeg\n\nTo extract the audio stream without re-encoding:\n\n```\nffmpeg -i input-video.avi -vn -acodec copy output-audio.aac\n```\n\n- `-vn` is no video.\n- `-acodec copy` says use the same audio stream that's already in there.\n\nRead the output to see what codec it is, to set the right filename extension.\n\n# æŒ‰æ—¶é—´èŒƒå›´æˆªå–\n\nhttps://blog.csdn.net/u011573853/article/details/103221606\n\n* æˆªå–ä¸€æ®µéŸ³é¢‘\n\n  ```\n  ffmpeg -i lesson.mp3 -ss 6:17 -to 8:25 -c copy lessson4.mp3\n  ```\n\n* æŠŠéŸ³é¢‘åŠ å…¥ä»å¤´åŠ å…¥åˆ°è§†é¢‘\n  ```\n  ffmpeg -i lessson4.mp3 -i video.mp4 -map 0:0 -map 1:1 -c copy movie.mp4\n  ```\n\n* æˆªå–ä¸€æ®µè§†é¢‘\n  ```\n  ffmpeg -i '1.mp4' -ss 00:01:17 -t 00:10:45 -vcodec copy -acodec copy yundong.mp4\n  ffmpeg -ss 00:00:10 -i input.mp4 -c copy output.mp4 # å‡å»å‰é¢10ç§’\n  ```\n\n# å¸¸ç”¨æ“ä½œå‘½ä»¤æ€»ç»“\n\nhttps://www.jianshu.com/p/341e0673bfe8\n\n## æˆªå›¾\n\n```bash\nffmpeg -ss 00:43:55 -i video.mp4  -f image2  -vframes 1 -y frame.png\n```\n\næ³¨æ„å°†`ss`æ”¾åˆ°æœ€å‰é¢å¯ä»¥åŠ å¿«é€Ÿåº¦, `-y`ä»£è¡¨è¦†ç›–æ–‡ä»¶ `-vframes`ä»£è¡¨å¸§æ•° `-i`ä»£è¡¨è¾“å…¥ï¼Œå³inï¼›`-ss`ä¹Ÿå¯ä»¥ä½¿ç”¨å•ä¸ªæ•°å­—ï¼Œä»£è¡¨ç§’æ•°ï¼Œä»0å¼€å§‹è®¡ç®—ã€‚\n\n## å»å›ºå®šæ°´å°\n\n```bash\nffmpeg -i video.mp4 -vf \"delogo=x=1680:y=60:w=160:h=55\"  -y  new_1.mp4\n```\n\nè¿™é‡Œ`-vf`è¡¨ç¤º`video filter`ï¼Œ å…¶ä¸­`delogo`çš„å‚æ•°ä»£è¡¨æ°´å°çš„åæ ‡å’Œå¤§å°ï¼ŒæŠŠè§†é¢‘å·¦ä¸Šè§’ä½œä¸ºåæ ‡åŸç‚¹ï¼Œæ¨ªå‘ä¸ºxè½´ï¼Œçºµå‘ä¸ºyè½´ã€‚è¿™ç§æƒ…å†µé™¤éé¢„å…ˆçŸ¥é“æ°´å°çš„ä½ç½®å’Œå¤§å°ï¼Œå¦åˆ™ä¸æ˜¯ç‰¹åˆ«æ–¹ä¾¿ï¼Œå½“ç„¶ï¼Œå‡†ç¡®è¯†åˆ«æ°´å°ä½ç½®ä¹Ÿæ˜¯ä¸€ä¸ªéš¾ç‚¹ï¼Œä¸æ˜¯å¾ˆè½»æ˜“èƒ½å®ç°çš„ã€‚\n å¯èƒ½æ ¹æ®æŸäº›`ffmpeg`ç‰ˆæœ¬ä¸åŒï¼Œéœ€è¦åŠ `-strict experimental` å‚æ•°ï¼Œä¸€ç§æƒ…å†µæ˜¯æ¯”è¾ƒè€çš„ç‰ˆæœ¬éŸ³é¢‘`ACC`å±äºå®éªŒé˜¶æ®µï¼Œå¯ä»¥æŒ‰æƒ…å†µè®¾ç½®æˆ–è€…å‡çº§`ffmpeg`ç‰ˆæœ¬ã€‚\n\n## è·å–è§†é¢‘æ—¶é•¿\n\n```bash\nffprobe -v error -show_entries format=duration -of default=noprint_wrappers=1:nokey=1 new_out.mp4\n```\n\nffprobe æ˜¯ffmpeg é…å¥—çš„ä¸€ä¸ªå·¥å…·ï¼Œå¯ä»¥æŸ¥çœ‹ä¸€äº›å†…å®¹ä¿¡æ¯ã€‚ä¸Šé¢çš„å‘½ä»¤å¯ä»¥ç›´æ¥è·å¾—ç§’ä¸ºå•ä½çš„è§†é¢‘æ—¶é•¿\n\n1. è·å–è§†é¢‘ä¿¡æ¯å¹¶ä¼˜åŒ–å±•ç¤º\n    `ffprobe -v quiet -print_format json -show_format -show_streams pianpian.mp4`\n    è¿™é‡Œ`-v`ä»£è¡¨æ—¥å¿—çº§åˆ«ï¼Œå¯ä»¥ä½¿ç”¨`debug`ç”¨æ¥åˆ†ææŸäº›å¼‚å¸¸ï¼›  ä¸Šé¢çš„å‘½ä»¤ä¼šä»¥jsonæ ¼å¼è¾“å‡º`format`å’Œ`stream`ä¸¤é¡¹çš„ä¿¡æ¯.\n2. è½¬ç å†ç”Ÿæˆm3u8\n    å…ˆè½¬ä¸ºtsæ ¼å¼:\n\n```bash\nffmpeg -y -i video.mp4 -c:v copy -c:a copy -vbsf h264_mp4toannexb output.ts\n```\n\nè¿™é‡Œ `-c:v`, `-c:a`åˆ†åˆ«ä»£è¡¨è§†é¢‘ï¼ŒéŸ³é¢‘æ ¼å¼ï¼Œ`copy`ä»£è¡¨åŸè§†é¢‘æ ¼å¼ï¼Œ `-vbsf`æˆ–è€…`-bsf:v`(`-bsf:a`)ï¼Œè¡¨ç¤º`bitstream filter`ï¼Œè½¬ç æ ¼å¼ã€‚\n è½¬æ¢m3u8ï¼š\n\n```bash\nffmpeg -i output.ts  -c copy -map 0 -f segment -segment_list index.m3u8 -segment_time 10 video_sgs/video-%03d.ts\n```\n\nä¸­é—´å‚æ•°æ²¡æœ‰å¤ªäº†è§£ï¼ŒåŠŸèƒ½æ˜¯å°†è§†é¢‘åˆ†æ®µå¹¶ç”Ÿæˆm3u8æ–‡ä»¶ï¼Œ åŒ…æ‹¬è®¾ç½®åˆ†æ®µè§†é¢‘çš„é•¿åº¦ã€‚\n\n## è§†é¢‘åˆ†å¸§\n\n```bash\nffmpeg -i src01.avi %d.jpg\n```\n\nå°†è§†é¢‘æ‰€æœ‰å¸§ä¿å­˜ä¸ºå›¾ç‰‡ã€‚ æ³¨æ„æ•´ä½“å†…å®¹å¯èƒ½æ¯”è¾ƒå¤§ï¼Œå®éªŒä¸­19MBçš„1280*720è§†é¢‘ï¼Œåˆ†å¸§åçš„å›¾ç‰‡æœ‰3.8Gã€‚\n\n## è§†é¢‘åŠ æ–‡å­—æ°´å°\n\n```bash\nffmpeg -i input.mp4 -vf \"drawtext=fontfile=simhei.ttf:text='é›·':x=100:y=10:fontsize=24:fontcolor=yellow:shadowy=2\" drawtext.mp4\n```\n\nå¯ä»¥ç»™æ°´å°è®¾ç½®å­—ä½“ï¼Œå¤§å°ï¼Œé¢œè‰²ç­‰ã€‚ å­—ä½“é¢œè‰²å¯ä»¥ç”¨RGBä»£ç ï¼Œæ¯”å¦‚`fontcolor=#FFFF00`ï¼Œå¦‚æœè¦è®¾ç½®é€æ˜åº¦å¯ä»¥è¿™æ ·å†™ï¼š`fontcolor=#FFFFFF@0.6`ï¼Œè¡¨ç¤º0.6çš„é€æ˜åº¦ï¼Œå–å€¼ä¸º`0.1-1.0`ã€‚\n `shadowy`è¡¨ç¤ºé˜´å½±ã€‚\n\n> æ³¨æ„ï¼š è¿™é‡Œå†’å·`:`æ˜¯å…³é”®å­—ï¼Œå¦‚æœæ˜¯è¦åŠ åˆ°æ°´å°é‡Œï¼Œéœ€è¦è½¬ä¹‰ï¼Œç”¨å››ä¸ª\\ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­\n\n```bash\nffmpeg -i source.mp4 -vf \"drawtext=fontfile=MicroYaHei.ttf:text=By\\\\\\\\:ä¸‰å³¡ä¸å¥½äºº:x=1240:y=44:fontsize=73:fontcolor=#FFFFFF@0.8\"  -y drawtext_out.mp4\n```\n\n## ffmpegé™åˆ¶cpuæ•°\n\n ffmpegåœ¨å»æ°´å°ï¼ŒåŠ æ°´å°çš„æ—¶å€™ï¼Œé»˜è®¤éƒ½æ˜¯å æ»¡å¯ç”¨CPUçš„ï¼ŒæŸäº›æƒ…å†µä¸‹éœ€è¦é™åˆ¶CPUæ•°ã€‚ç½‘ä¸Šæ–‡ç« ä¹±ä¸ƒå…«ç³Ÿï¼Œå„ç§æŠ„ï¼Œå¾ˆå¤šè¯´ç”¨`-threads` å‚æ•°ï¼Œä½†è¯´çš„ä¸æ˜ä¸ç™½ã€‚ ä»¥ä¸‹äº²æµ‹ï¼Œ`-threads`å‚æ•°æ”¾åˆ° -y å‰é¢æ˜¯å¯ä»¥ç”Ÿæ•ˆçš„ï¼Œ Linux å¯ä»¥ç”¨`top -H -p <pid>` çœ‹è¿è¡Œçº¿ç¨‹æ•°æ¥éªŒè¯ï¼Œ åŒæ—¶å¯ä»¥ç”¨`uptime`æ¯”è¾ƒé™åˆ¶çº¿ç¨‹å’Œä¸é™åˆ¶çš„CPUä½¿ç”¨ç‡ã€‚ å¦‚ä¸‹æ˜¯é™åˆ¶ä¸º2ä¸ªçº¿ç¨‹ã€‚\n\n```bash\nffmpeg -i source.mp4 -vf \"drawtext=fontfile=MicroYaHei.ttf:text=By\\\\\\\\:ä¸‰å³¡ä¸å¥½äºº:x=1240:y=44:fontsize=73:fontcolor=#FFFFFF@0.8\"  -threads 2  -y drawtext_out.mp4\n```\n# å°†å¤šä¸ªTSæ–‡ä»¶æ‰¹é‡è½¬æ¢ä¸ºMP4æ ¼å¼\næ‰¹é‡è½¬æ¢è„šæœ¬\n- â€‹**Windowsï¼ˆæ‰¹å¤„ç†è„šæœ¬ï¼‰â€‹**ï¼š    \n    1. æ–°å»ºæ–‡æœ¬æ–‡ä»¶ï¼Œè¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š        \n        ```bash\n        @echo off\n        for %%i in (*.ts) do (\n            ffmpeg -i \"%%i\" -c copy \"%%~ni.mp4\"\n        )\n        pause\n        ```\n    2. ä¿å­˜ä¸ºÂ `convert.bat`ï¼Œæ”¾åˆ°TSæ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹ï¼ŒåŒå‡»è¿è¡Œã€‚\n- â€‹**Linux/macOSï¼ˆShellè„šæœ¬ï¼‰â€‹**ï¼š\n    1. æ–°å»ºè„šæœ¬æ–‡ä»¶Â `convert.sh`ï¼š\n        ```bash\n        #!/bin/bash\n        for file in *.ts; do\n            ffmpeg -i \"$file\" -c copy \"${file%.ts}.mp4\"\n        done\n        ```\n    2. æ·»åŠ æ‰§è¡Œæƒé™å¹¶è¿è¡Œï¼š\n        ```bash\n        chmod +x convert.sh\n        ./convert.sh\n        ```\n## Windows\nåœ¨Windowsæ‰¹å¤„ç†è„šæœ¬ä¸­ï¼Œ`\"%%~ni.mp4\"`Â æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ â€‹**å˜é‡æ‰©å±•è¯­æ³•**ï¼Œç”¨äºå¤„ç†æ–‡ä»¶åã€‚å…·ä½“å«ä¹‰åˆ†è§£å¦‚ä¸‹ï¼š\n\n- åœ¨æ‰¹å¤„ç†è„šæœ¬ä¸­å¿…é¡»ä½¿ç”¨ â€‹**åŒç™¾åˆ†å·**â€‹ï¼ˆ`%%i`ï¼‰ï¼Œè€Œåœ¨å‘½ä»¤è¡Œç›´æ¥æ‰§è¡Œæ—¶ç”¨å•ç™¾åˆ†å·ï¼ˆ`%i`ï¼‰ã€‚\n\n| ç¬¦å·          | å«ä¹‰                                 |\n| ----------- | ---------------------------------- |\n| `%%i`       | å¾ªç¯å˜é‡ï¼Œè¡¨ç¤ºå½“å‰å¤„ç†çš„æ–‡ä»¶åï¼ˆå¦‚Â `video1.ts`ï¼‰     |\n| `%~ni`      | å»æ‰æ–‡ä»¶åçš„æ‰©å±•åï¼ˆ`.ts`ï¼‰ï¼Œåªä¿ç•™ä¸»æ–‡ä»¶åï¼ˆ`video1`ï¼‰ |\n| `.mp4`      | æ·»åŠ æ–°çš„æ‰©å±•å                            |\n| `%%~ni.mp4` | ç»„åˆåçš„å®Œæ•´æ–°æ–‡ä»¶åï¼ˆ`video1.mp4`ï¼‰           |\nå…¶ä»–å¸¸è§å˜é‡æ‰©å±•\n\n|è¯­æ³•|ä½œç”¨|ç¤ºä¾‹ï¼ˆåŸæ–‡ä»¶åï¼š`D:\\Videos\\test.ts`ï¼‰|\n|---|---|---|\n|`%%~i`|å®Œæ•´è·¯å¾„+æ–‡ä»¶å|`D:\\Videos\\test.ts`|\n|`%%~di`|é©±åŠ¨å™¨ç›˜ç¬¦|`D:`|\n|`%%~pi`|æ–‡ä»¶è·¯å¾„ï¼ˆä¸å«æ–‡ä»¶åï¼‰|`\\Videos\\`|\n|`%%~ni`|ä¸»æ–‡ä»¶åï¼ˆä¸å«æ‰©å±•åï¼‰|`test`|\n|`%%~xi`|æ‰©å±•åï¼ˆåŒ…å«ç‚¹å·ï¼‰|`.ts`|\n|`%%~fi`|å®Œæ•´ç»å¯¹è·¯å¾„|`D:\\Videos\\test.ts`|\n- `-c copy`ï¼šç›´æ¥å¤åˆ¶éŸ³è§†é¢‘æµï¼Œæ— éœ€é‡æ–°ç¼–ç ï¼ˆé€Ÿåº¦å¿«ï¼‰ã€‚\n- å¦‚éœ€é‡æ–°ç¼–ç ï¼ˆå…¼å®¹æ€§æ›´å¥½ï¼Œä½†é€Ÿåº¦æ…¢ï¼‰ï¼š\n\n```bash\nffmpeg -i input.ts -c:v libx264 -c:a aac output.mp4\n```","categories":["ä¸€äº›å·¥å…·çš„ä½¿ç”¨"]},{"title":"x86ä½“ç³»å†ç¨‹","url":"/è®¡ç®—æœºçŸ¥è¯†ä½“ç³»/x86ä½“ç³»å†ç¨‹/","content":"# å†…å®¹\n\næ¯”è¾ƒè‘—åçš„èŠ¯ç‰‡ä½“ç³»ï¼š\n\n* Intel x86\n* AMD\n* ARM7/9\n* ppc\n* mips\n\nIntelå’ŒAMDå¤šç”¨äºPCã€‚ç°åœ¨çš„æ‰‹æœºã€å¹³æ¿ç”¨çš„å¤§å¤šæ˜¯ARM9ï¼Œå¯ç©¿æˆ´è®¾å¤‡å¤§å¤šæ˜¯ppcã€mipsã€‚ARMã€ppcã€mipså®æ—¶æ€§éå¸¸å¥½ã€‚\n\n> è¯»æœ¬æ–‡å‰éœ€è¦æ˜ç¡®ï¼š\n>\n> 1. CPUä½æ•°è¡¨ç¤ºALUå®½åº¦ï¼ˆæ•°æ®æ€»çº¿æ¡æ•°ï¼‰ã€‚æ‰€ä»¥è¦è¯´CPUæ˜¯å¤šå°‘ä½ç”±ALUå®½åº¦ï¼ˆæ•°æ®æ€»çº¿æ¡æ•°ï¼‰å†³å®šã€‚\n> 2. CPUå¯å¯»å€èƒ½åŠ›ç”±CPUèŠ¯ç‰‡ä¸Šçš„åœ°å€æ€»çº¿æ¡æ•°å†³å®šã€‚\n> 3. CPUåœ°å€æ€»çº¿æ¡æ•°ä¸ç­‰äºCPUä½æ•°ã€‚\n\n# Intel 80x86å®¶æ—å‘å±•å†ç¨‹\n\næ¯å¤©æ‰€è®²åˆ°çš„x86-32ä½ä½“ç³»æŒ‡çš„æ˜¯ä»Intel 80386èŠ¯ç‰‡ä¸€ç›´åˆ°åé¢æ‰€å‘å±•çš„ä¸€ç³»åˆ—32ä½å¤„ç†å™¨ã€‚è€Œx86å¹¶ä¸æ˜¯ä»32ä¸ºèµ·æ­¥ï¼Œè€Œæ˜¯ä»1978å¹´çš„8086ï¼ˆ16ä½ï¼‰å¼€å§‹å‘å±•ï¼Œç»è¿‡80186ï¼ˆ16ï¼‰ã€80286ï¼ˆä¼ª32ï¼‰ã€‚\n\n1. 1970å¹´ä»£\n   1. 4004 -- 4ä½\n   2. 8008 -- 8ä½\n2. 1974å¹´ä»£\n   1. 8080 -- 8ä½\n   1. 8085 -- 8ä½\n3. 1978å¹´ä»£\n   1. 8086 -- 16ä½\n   2. 80186 -- 16ä½\n4. 1983å¹´ä»£\n   1. 80286 -- 32ä½ï¼ˆä¼ªï¼‰\n   2. 80386 -- 32ä½ï¼ˆçœŸï¼‰\n   3. 80486 -- 32ä½\n5. 1993å¹´ä»£\n   1. Pentium -- 32ä½\n\n8ä½èŠ¯ç‰‡å¦‚æœåªæœ‰8æ¡åœ°å€æ€»çº¿ï¼Œé‚£ä¹ˆåªèƒ½å¯»å€256å­—èŠ‚ï¼Œè¿™æ ·çš„CPUå±€é™æ€§å¤ªé«˜ï¼Œå› æ­¤æ—©æœŸçš„8ä½CPUï¼ˆå¦‚8080ã€8085ï¼‰çš„åœ°å€æ€»çº¿è®¾è®¡æˆäº†16æ¡ï¼Œå¯ä»¥å¯»å€64KBã€‚\n\n8ä½èŠ¯ç‰‡çš„å¯„å­˜å™¨åªæœ‰1ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯å¯»æ‰¾çš„åœ°å€æ˜¯16ä½å³2å­—èŠ‚åœ°å€ï¼Œä¸èƒ½å…¨éƒ¨æ”¾åˆ°ä¸€ä¸ªå¯„å­˜å™¨ä¸­ï¼Œéœ€è¦åˆ†å¼€å­˜æ”¾ã€‚8ä½èŠ¯ç‰‡å¯¼è‡´æ•°æ®ä½æ•°å’Œåœ°å€ä½æ•°ä¸å¯¹ç­‰ï¼Œå½¢æˆäº†å†å²åŒ…è¢±ï¼Œæ‰€ä»¥åœ¨8080å’Œ8085ä¸­å‡ºç°äº†å¾ˆå¤š16ä½çš„æ±‡ç¼–æŒ‡ä»¤ä»¥è§£å†³æ•°æ®å’Œåœ°å€ä½æ•°ä¸å¯¹ç­‰çš„é—®é¢˜ã€‚\n\nåˆ°äº†8086èŠ¯ç‰‡ï¼Œæ˜¯16ä½CPUï¼Œåœ°å€æ€»çº¿è®¾è®¡ä¸º20æ¡ï¼Œå¯å¯»å€1MBã€‚è™½ç„¶æ•°æ®å’Œåœ°å€ä½æ•°ä¸å¯¹ç­‰ï¼Œä½†æ˜¯å·§å¦™çš„è®¾è®¡å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå½“åˆè®¾è®¡å¸ˆæ²¡æœ‰æŒ‰ç…§8080ã€8085é‚£æ ·è®¾è®¡20ä½æ±‡ç¼–æŒ‡ä»¤ï¼Œè€Œæ˜¯è®©åœ°å€å…¥å¯„å­˜å™¨æ—¶å³ç§»4ä½ã€‚\n\n# å¼€åˆ›x86ä½“ç³»--å¼€å§‹åˆ†æ®µ--å®æ¨¡å¼\n\nä»8086å¼€å§‹ï¼Œå¢åŠ äº†4ä¸ªæ®µå¯„å­˜å™¨ï¼ŒCSã€DSã€SSã€ESï¼Œåˆ†åˆ«æ˜¯ä»£ç æ®µå¯„å­˜å™¨ã€æ•°æ®æ®µå¯„å­˜å™¨ã€å †æ ˆæ®µå¯„å­˜å™¨ã€æ‰©å±•æ®µå¯„å­˜å™¨ï¼Œéƒ½æ˜¯16ä½ï¼Œå¯å­˜æ”¾2å­—èŠ‚ã€‚å¦å¤–è¿˜æœ‰ä¸€ä¸ªIPå¯„å­˜å™¨ï¼Œä¹Ÿæ˜¯16ä½ï¼Œåå­—å«ä¹‰ä¸ºæŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨ï¼Œå¯ä¸“é—¨å­˜æ”¾å†…å­˜åœ°å€åç§»é‡ï¼Œå³å†…å­˜åœ°å€ã€‚\n\næ­¤æ—¶ï¼Œè®¾è®¡å¸ˆæŠŠå†…å­˜åˆ’åˆ†ä¸ºåˆ†æ®µä½“ç³»ï¼Œè§„å®šæ¯ä¸ªæ®µçš„èµ·å§‹åœ°å€å¿…é¡»æ˜¯16çš„å€æ•°ï¼Œæ‰€ä»¥æ¯ä¸ªæ®µè‡³å°‘æœ‰16ä¸ªå­—èŠ‚ï¼Œæœ€å¤§å‘¢ï¼Ÿæ˜¯IPå¯„å­˜å™¨èƒ½æœ€å¤§æ”¯æŒå­˜æ”¾çš„æ•°å­—ï¼Œå³$2^{16}=64KB$ã€‚æ­¤æ—¶ï¼Œæ¯ä¸€æ®µçš„å†…å®¹éƒ½æœ‰å…¶æ®µèµ·å§‹åœ°å€å’Œæ®µèŒƒå›´ã€‚è¿™å°±å¯ä»¥æŠŠæ¯ä¸€æ®µçš„èµ·å§‹åœ°å€å†™åˆ°ç›¸åº”çš„æ®µå¯„å­˜å™¨ä¸­äº†ã€‚\n\nä¸ºå•¥è§„å®šæ¯ä¸ªæ®µçš„èµ·å§‹åœ°å€å¿…é¡»æ˜¯16çš„å€æ•°ï¼Ÿå¦‚æœä¸€ä¸ªæ•°å­—èƒ½è¢«16æ•´é™¤ï¼Œé‚£ä¹ˆ2è¿›åˆ¶ä¸‹ï¼Œè¿™ä¸ªæ•°å­—çš„ä½å››ä½å‡ä¸º0ï¼å› æ­¤å¯ä»¥å³ç§»å››ä½å·²çŸ¥çš„æ•°æ®ï¼ŒæŠŠå…¶ä½™é«˜ä½æœ‰æ•ˆæ•°æ®å­˜æ”¾åˆ°16ä½æ®µå¯„å­˜å™¨ä¸­ï¼è¿™å°±æ˜¯å·§å¦™ä¹‹å¤„ã€‚\n\nç”±æ­¤ä»¥æ¥ï¼Œä¹‹åçš„å¯»å€æ–¹å¼å°±å˜æˆï¼šå–å…·ä½“å¯¹åº”æ®µçš„æ®µå¯„å­˜å™¨ä¸ºæ®µåŸºå€ï¼Œä½œä¸ºåœ°å€æ€»çº¿é«˜16ä½ï¼Œå†åŠ ä¸Šå…·ä½“æ•°æ®åœ¨æ®µä¸­çš„ç›¸å¯¹åç§»é‡ï¼ˆä»IPå¯„å­˜å™¨ä¸­çš„å€¼å–ï¼‰ã€‚\n\nå¦‚æ­¤æ¨æ¼”ï¼š\n\n1. æ®µå¯„å­˜å™¨ä¸­çš„å€¼ï¼Œå·¦ç§»4ä½ï¼Œå¯¹åº”çš„å€¼å°±ç§°ä¸ºï¼šæ®µåŸºå€\n2. IPå¯„å­˜å™¨ä¸­çš„å€¼ï¼Œå°±ç§°ä¸ºä¸€ä¸ªå†…å­˜æ®µä¸Šçš„åç§»é‡/åç§»åœ°å€/ç›¸å¯¹åœ°å€/**é€»è¾‘åœ°å€**\n\nåœ¨8086èŠ¯ç‰‡å¼€åˆ›çš„å¹´ä»£ï¼Œè¿˜æ²¡æœ‰è™šæ‹Ÿåœ°å€æ˜ å°„çš„æ¦‚å¿µï¼Œå› æ­¤å¯»å€å¾—åˆ°çš„æ•°æ®åœ°å€ç›´æ¥å¯¹åº”äº†å†…å­˜ä¸Šçš„ç‰©ç†åœ°å€ã€‚è¿™æ ·çš„æ¨¡å¼ï¼Œç§°ä¸º**å®åœ°å€æ¨¡å¼**ï¼Œä¹Ÿå«å®æ¨¡å¼ã€‚\n\n# èåˆæ“ä½œç³»ç»Ÿ--ä¿æŠ¤æ¨¡å¼\n\nå®ç°ä¿æŠ¤æœºåˆ¶ï¼Œå°±è¦åœ¨ä¿å­˜æ®µèµ·å§‹åœ°å€çš„åŒæ—¶ï¼Œè®°å½•æ®µçš„èŒƒå›´ï¼Œç¡®ä¿ä¸è¦è¶Šç•Œã€‚åŒæ—¶ä¹Ÿè¦ç»™æ¯ä¸€ä¸ªæ®µè®°å½•å…¶è®¿é—®æƒé™ã€‚\n\n1. å†…å­˜æ®µèµ·å§‹åœ°å€\n2. å†…å­˜æ®µé•¿åº¦ - é˜²æ­¢åç§»é‡ï¼ˆé€»è¾‘åœ°å€ï¼‰è¶Šç•Œ\n3. å†…å­˜çš„æƒé™ä¿¡æ¯ - ç¡®ä¿ä»–äººè®¿é—®æ—¶åˆæ³•ï¼Œé¿å…ä»»æ„è¯»å–ã€ä¿®æ”¹ã€æ‰§è¡Œ\n\nè™½ç„¶32ä½å¤„ç†å™¨æ˜¯32ä½ï¼Œä½†æ˜¯å…¶æ®µå¯„å­˜å™¨çš„å¤§å°ä¾æ—§æ˜¯16ä½ï¼Œè‚¯å®šæ˜¯æ— æ³•å­˜æ”¾è¿™äº›å…¨éƒ¨å†…å®¹çš„ï¼Œå³ä½¿æœ‰32ä½çš„å¯„å­˜å™¨ä¹Ÿä¸å¤Ÿå­˜å‚¨ã€‚\n\nä½†åœ¨80386è¿™ä¸ªå¤„ç†å™¨ä¸Šï¼Œåšå‡ºäº†å˜é©ï¼Œå¢åŠ äº†GTDRå’ŒLDTRä¸¤ä¸ªå¯„å­˜å™¨ï¼Œåˆ†åˆ«æ˜¯å…¨å±€æ®µæè¿°ç¬¦è¡¨å¯„å­˜å™¨ã€å±€éƒ¨æ®µæè¿°ç¬¦è¡¨å¯„å­˜å™¨ï¼Œå‰è€…æ˜¯æ‰€æœ‰è¿›ç¨‹å…±äº«çš„ï¼Œåè€…æ˜¯æ¯ä¸ªè¿›ç¨‹ç§æœ‰çš„ã€‚\n\næ®µæè¿°ç¬¦è¡¨å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¾æ¬¡å­˜æ”¾äº†æ¯ä¸ªæ®µçš„ä¿¡æ¯ã€‚\n\nå› æ­¤ï¼Œä»å‰çš„æ®µå¯„å­˜å™¨åˆ™éœ€è¦ç”¨æ¥å­˜å‚¨æ®µæè¿°ç¬¦è¡¨ä¸­æœ¬æ®µå¯¹åº”çš„ä¸‹æ ‡å€¼ã€‚\n\næ®µå¯„å­˜å™¨ï¼Œå…±16ä½ï¼Œä½2ä½å­˜å‚¨æƒé™æ ‡å¿—ï¼Œ00è¡¨ç¤ºæœ€é«˜æƒé™ï¼Œ11è¡¨ç¤ºæœ€ä½æƒé™ï¼Œè¡¨ç¤ºå½“å‰æ®µå±äºç”¨æˆ·æ€/å†…æ ¸æ€ä¸‹çš„ç©ºé—´ã€‚ç¬¬3ä¸ªä½ä½è¡¨ç¤ºå½“å‰æ®µçš„ä¿¡æ¯å­˜å‚¨åœ¨GDTR/LDTRä¸­ï¼Œ0è¡¨ç¤ºGDTRï¼Œ1è¡¨ç¤ºLDTRã€‚å‰©ä¸‹çš„é«˜13ä½å­˜å‚¨æè¿°ç¬¦è¡¨ä¸­å¯¹åº”çš„ä¸‹æ ‡å€¼ã€‚æœ€å¤§å€¼ä¸º$2^{13}=8192$ã€‚å…¶ä¸­å†…æ ¸ä»£ç å ç”¨äº†12ä¸ªå…¨å±€æ®µæè¿°ç¬¦è¡¨é¡¹ï¼Œå› æ­¤å¯ç”¨çš„å€¼æœ‰8180ä¸ªã€‚\n\n![image-20220828210620727](../../images/x86ä½“ç³»å†ç¨‹/image-20220828210620727.png)\n\næ®µæè¿°ç¬¦è¡¨çš„è¡¨é¡¹çš„ç»“æ„ï¼š\n\n![image-20220828210941156](../../images/x86ä½“ç³»å†ç¨‹/image-20220828210941156.png)\n\næ®µæè¿°è¡¨ä¸­çš„ä¸€ä¸ªè¡¨é¡¹ä¸­è®°å½•äº†32ä½æ®µåŸºå€ï¼Œ20ä½æ®µé•¿åº¦å¤§å°åŠå…¶å•ä½ã€‚\n\n## ä¿æŠ¤æ¨¡å¼ä¸‹å†…å­˜åˆ†æ®µçš„åœ°å€æ˜ å°„\n\næ®µå¯„å­˜å™¨å­˜å‚¨çš„å€¼ï¼Œå³ç§»3ä½ï¼Œå¾—åˆ°æ®µæè¿°ç¬¦ä¸­å¯¹åº”çš„ä¸‹æ ‡å€¼ã€‚å†åˆ°æ®µæè¿°ç¬¦ï¼ˆGDTï¼‰ä¸­å–å¾—è¯¥æ®µçš„ä¿¡æ¯ï¼ˆåŸºå€ã€å¤§å°ã€æƒé™å±æ€§ï¼‰ã€‚\n\nåˆ™ä¿æŠ¤æ¨¡å¼ä¸‹å†…å­˜åˆ†æ®µçš„åœ°å€æ˜ å°„å¯ä»¥å¦‚ä¸‹è®¡ç®—è·å¾—ï¼šï¼ˆä»¥å–å¾—DSæ•°æ®æ®µæŸåœ°å€ä¸ºä¾‹ï¼‰\n\n$GDT[DS>>3].BaseAddr+IP=çº¿æ€§åœ°å€$ã€‚å…¶ä¸­ï¼ŒIPè¦å’Œè®°å½•çš„æ®µé•¿åº¦è¿›è¡Œæ¯”è¾ƒï¼Œåˆ¤æ–­æ˜¯å¦è¶Šç•Œã€‚\n\nå¦‚æœæ²¡æœ‰åˆ†é¡µæœºåˆ¶ï¼Œåˆ™ä»¥ä¸Šçº¿æ€§åœ°å€å°±æ˜¯å®é™…çš„ç‰©ç†åœ°å€ã€‚\n\n## ä¿æŠ¤æ¨¡å¼ä¸‹å†…å­˜åˆ†é¡µçš„åœ°å€æ˜ å°„\n\nç»§ç»­ï¼Œåˆ¤æ–­å†…æ ¸æ˜¯å¦æ‰“å¼€å†…å­˜é¡µæ˜ å°„ï¼Œæ ‡å¿—ä½å­˜å‚¨äºCR0å¯„å­˜å™¨ä¸­çš„PGä½ï¼Œä¸º0è¡¨ç¤ºåªåˆ†æ®µï¼Œä¸º1è¡¨ç¤ºä½¿ç”¨å†…å­˜åˆ†é¡µã€‚\n\n| å¯„å­˜å™¨ | æè¿°                         |\n| ------ | ---------------------------- |\n| CR0    | PGï¼šå†…å­˜æ˜¯å¦å¼€å¯åˆ†é¡µæœºåˆ¶     |\n| CR2    | ä¿å­˜å‘ç”Ÿç¼ºé¡µå¼‚å¸¸æ—¶çš„è™šæ‹Ÿåœ°å€ |\n| CR3    | ä¿å­˜å½“å‰è¿›ç¨‹çš„é¡µç›®å½•èµ·å§‹åœ°å€ |\n| CR4    | PAEæ˜¯å¦å¼€å¯ç‰©ç†åœ°å€æ‰©å±•      |\n\nå¦‚æœæ‰“å¼€äº†å†…å­˜åˆ†é¡µæœºåˆ¶ï¼Œé‚£ä¹ˆå¾—åˆ°çš„è¯¥çº¿æ€§åœ°å€å°±ç§°ä¸ºè™šæ‹Ÿåœ°å€ï¼Œéœ€è¦ç»è¿‡é¡µé¢çš„å¤šçº§æ˜ å°„ï¼Œæ‰èƒ½å¾—åˆ°çœŸæ­£çš„ç‰©ç†åœ°å€ã€‚\n\n32ä½ä¸‹ï¼Œéœ€è¦äºŒçº§æ˜ å°„ï¼›36ä½ä¸‹ï¼Œéœ€è¦ä¸‰çº§æ˜ å°„ï¼›64ä½ä¸‹ï¼Œéœ€è¦å››çº§æ˜ å°„ã€‚\n\næ‹¿32ä½ä¸¾ä¾‹å­ï¼Œåˆ†ä¸ºä¸‰æ®µï¼Œ10ã€10ã€12ã€‚é«˜10ä½è¡¨ç¤ºé¡µç›®å½•çš„ä¸‹æ ‡å€¼ï¼Œæ¬¡10ä½è¡¨ç¤ºé¡µè¡¨çš„ä¸‹æ ‡å€¼ï¼Œä½12ä½è¡¨ç¤ºç‰©ç†é¡µé¢ä¸Šçš„åç§»é‡ã€‚\n\n10ä½é™åˆ¶äº†é¡µç›®å½•æœ€å¤šæœ‰1024é¡¹ï¼Œæ¯ä¸€é¡¹éƒ½æ˜¯4å­—èŠ‚ï¼Œ32ä½ï¼Œåˆ™é¡µç›®å½•æœ¬èº«å 4KBã€‚é¡µç›®å½•é¡¹ä¸­å­˜å‚¨äº†é¡µè¡¨çš„åœ°å€ã€‚\n\n10ä½é™åˆ¶äº†é¡µè¡¨æœ€å¤šæœ‰1024é¡¹ï¼Œæ¯ä¸€é¡¹éƒ½æ˜¯4å­—èŠ‚ï¼Œ32ä½ï¼Œåˆ™é¡µè¡¨æœ¬èº«å 4KBã€‚é¡µè¡¨é¡¹ä¸­å­˜å‚¨äº†ä¸€ä¸ªç‰©ç†é¡µé¢çš„èµ·å§‹åœ°å€ã€‚\n\n12ä½é™åˆ¶äº†åœ°å€åç§»é‡æœ€å¤§ä¸º4Kï¼Œåˆšå¥½å¯¹åº”äºä¸€ä¸ªé¡µé¢çš„å¤§å°4KBï¼Œç¡®ä¿ä¸ä¼šç¡®ç•Œã€‚\n\nå› ä¸ºä¸€é¡µæ˜¯4KBï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªé¡µé¢çš„åœ°å€éƒ½æ˜¯4Kçš„æ•´æ•°å€ï¼Œé‚£ä¹ˆè¿™äº›åœ°å€çš„ä½12ä½éƒ½ä¸º0ï¼Œæ‰€ä»¥PTï¼ˆé¡µè¡¨ï¼‰ä¸­çš„é¡µè¡¨é¡¹çš„32ä½ä¸­åªéœ€é«˜20ä½æ¥å­˜å‚¨ç‰©ç†é¡µé¢å·ï¼ˆä¹Ÿç§°ä½œæ¡†å·ï¼‰ã€‚åŒæ ·çš„é“ç†ï¼Œæ¯ä¸ªé¡µè¡¨éƒ½æ˜¯4KBï¼Œé‚£ä¹ˆPGï¼ˆé¡µç›®å½•ï¼‰ä¸­çš„é¡µç›®å½•é¡¹çš„32ä½ä¸­åªéœ€é«˜20ä½æ¥å­˜å‚¨é¡µè¡¨çš„èµ·å§‹åœ°å€ã€‚å‰©ä¸‹çš„12ä½å­˜ä»€ä¹ˆå‘¢ï¼Ÿæƒé™ä¿¡æ¯ï¼ˆæ¯”å¦‚é¡µæœ‰æ— åˆ†é…ï¼Ÿæ˜¯å¦å¯è®¿é—®ï¼Ÿæ˜¯å¦æ˜¯è„é¡µï¼‰ã€‚\n\nå…¶ä¸­ï¼ŒPTé¡¹çš„æœ€ä½1ä½æ˜¯presentä½ï¼Œä¸º0è¡¨ç¤ºé¡µè¡¨é¡¹å¯¹åº”çš„ç‰©ç†é¡µé¢åœ¨äº¤æ¢åˆ†åŒºä¸­ï¼Œä¸º1è¡¨ç¤ºæ­¤é¡µé¢å°±åœ¨ç‰©ç†å†…å­˜ä¸­ã€‚æ¢é¡µç®—æ³•ä¸­éœ€è¦ä¸è¿™ä¸ªä½æ‰“äº¤é“ã€‚\n\nç‰©ç†é¡µé¢çš„ç»“æ„ä½“å¯åœ¨å†…æ ¸æºç ä¸­`struct page`çœ‹åˆ°ï¼Œå‘½åä¸º`mem_map_t`ã€‚\n\nç‰©ç†é¡µé¢å®é™…ä¸Šç”¨åŠ¨æ€å¼€è¾Ÿçš„æ•°ç»„æ¥ç®¡ç†ï¼Œæ˜¯ä¸€ä¸ª`mem_map_t * mem_map`ã€‚PTé¡¹çš„é«˜20ä½å³ä¸ºç‰©ç†é¡µé¢æ•°ç»„çš„ä¸‹æ ‡ã€‚\n\næœ€å¤šæœ‰1024ä¸ªPGï¼Œ1ä¸ªPGå¯ä»¥æ˜ å°„1024ä¸ªPTï¼Œ1ä¸ªPTå¯ä»¥æ˜ å°„1024ä¸ªç‰©ç†é¡µé¢ï¼Œ1ä¸ªç‰©ç†é¡µé¢æœ‰4KBã€‚ç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—å¾—åˆ°ï¼Œ$1024*1024*4KB=4GB$\n\n### é—®é¢˜ï¼šæ¯ä¸ªè¿›ç¨‹å¦‚ä½•ç¡®ä¿é¡µç›®å½•ã€é¡µè¡¨åœ°å€ä¸å†²çª\n\næˆ‘ä»¬å¯ä»¥æƒ³åˆ°ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½åˆ†é…äº†ç›¸åŒå¤§å°çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚é‚£ä¹ˆå˜é‡çš„åœ°å€ä¹Ÿå¯èƒ½ä¼šå­˜åœ¨ç›¸åŒçš„æƒ…å†µã€‚è€Œæ¯ä¸ªCPUéƒ½è¦åŒæ—¶æ‰§è¡Œå¤šä¸ªè¿›ç¨‹ï¼ŒCR3å¯„å­˜å™¨ï¼ˆå­˜æ”¾é¡µç›®å½•åœ°å€ï¼‰åªæœ‰ä¸€ä¸ªã€‚æ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼Œæ‰€ä»¥ä¸åŒè¿›ç¨‹åœ¨åˆ‡æ¢çš„æ—¶å€™ï¼Œè¦æŠŠè‡ªå·±çš„é¡µç›®å½•åœ°å€æ›´æ–°åˆ°CR3å¯„å­˜å™¨ä¸­ã€‚\n\nå¯åœ¨å†…æ ¸ä»£ç ä¸­`switch_mm`å‡½æ•°ä¸­çœ‹åˆ°ï¼š\n\n```c\nstatic inline void switch_mm(struct mm_struct *prev, ...)\n{\n    {\n        ...\n        asm volatile(\"movl %0, %%cr3\": :\"r\" (__pa(next->pgd)));\n    }\n}\n```\n\n","categories":["æ“ä½œç³»ç»Ÿ","è®¡ç®—æœºçŸ¥è¯†ä½“ç³»"]},{"title":"Linux_vim_ä¼šè¯å’Œviminfo","url":"/Linux/Linux_vim_ä¼šè¯å’Œviminfo/","content":"\næ‰€ç”¨å‘½ä»¤æ¶‰åŠåˆ°çš„å¸®åŠ©å…¥å£ï¼š\n\n```\n:help mksession\n:help 'sessionoptions'\n:help source\n:help wviminfo\n:help rviminfo\n:help 'viminfo'\n```\n\nå¾ˆå¤šè½¯ä»¶éƒ½å…·æœ‰è¿™æ ·ä¸€ç§åŠŸèƒ½ï¼šåœ¨ä½ ä¸‹ä¸€æ¬¡å¯åŠ¨è¯¥è½¯ä»¶æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨ä¸ºä½ æ¢å¤åˆ°ä½ ä¸Šæ¬¡é€€å‡ºçš„ç¯å¢ƒï¼Œæ¢å¤çª—å£å¸ƒå±€ã€æ‰€æ‰“å¼€çš„æ–‡ä»¶ï¼Œç”šè‡³æ˜¯ä¸Šæ¬¡çš„è®¾ç½®ã€‚\n\nvimæœ‰æ²¡æœ‰è¿™ç§åŠŸèƒ½å‘¢ï¼Ÿç­”æ¡ˆå½“ç„¶æ˜¯è‚¯å®šçš„ï¼è¿™éœ€è¦ä½¿ç”¨vimçš„ä¼šè¯(session)åŠviminfoçš„ä¿å­˜å’Œæ¢å¤åŠŸèƒ½ã€‚\n\nä½¿ç”¨ä¼šè¯(session)å’Œviminfoï¼Œå¯ä»¥æŠŠç¼–è¾‘ç¯å¢ƒä¿å­˜ä¸‹æ¥ï¼Œç„¶ååœ¨ä¸‹æ¬¡å¯åŠ¨vimåï¼Œå¯ä»¥å†æ¢å¤å›è¿™ä¸ªç¯å¢ƒã€‚åœ¨å¼€å‘é¡¹ç›®æˆ–ä¹¦å†™æ–‡æ¡£æ—¶ï¼Œå¦‚æœåœ¨ä¸­é€”é€€å‡ºäº†vimè€Œä¸èƒ½æ¢å¤åŸå…ˆçš„ç¼–è¾‘ç¯å¢ƒçš„è¯ï¼Œåˆè¦é‡æ–°æ‰“å¼€ä½ æ‰€æ‰“å¼€çš„æ–‡ä»¶ï¼Œé‡æ–°å®šä¹‰ä½ çš„æ˜ å°„(map)ã€ç¼©å†™(abbreviate)ï¼Œé‡æ–°å®šä½ä½ æ‰€è®¾å®šçš„æ ‡è®°çš„ä½ç½®(mark)ï¼Œé‡æ–°è®¾ç½®é¡¹ç›®ç›¸å…³è®¾ç½®(options)ç­‰ç­‰ï¼Œä¸æ˜¯ä¸€èˆ¬çš„éº»çƒ¦ï¼\n\nè¦æ¢å¤ä¸Šæ¬¡çš„ç¼–è¾‘ç¯å¢ƒï¼Œæˆ‘ä»¬éœ€è¦ä¿å­˜ä¸¤ç§ä¸åŒçš„ä¿¡æ¯ï¼Œä¸€ç§æ˜¯ä¼šè¯(session)ä¿¡æ¯ï¼Œå¦å¤–ä¸€ç§æ˜¯viminfoä¿¡æ¯ã€‚\n\n- ä¼šè¯ä¿¡æ¯ä¸­ä¿å­˜äº†æ‰€æœ‰çª—å£çš„è§†å›¾ï¼Œå¤–åŠ å…¨å±€è®¾ç½®ã€‚\n- viminfoä¿¡æ¯ä¸­ä¿å­˜äº†å‘½ä»¤è¡Œå†å²(history)ã€æœç´¢å­—ç¬¦ä¸²å†å²(search)ã€è¾“å…¥è¡Œå†å²ã€éç©ºçš„å¯„å­˜å™¨å†…å®¹(register)ã€æ–‡ä»¶çš„ä½ç½®æ ‡è®°(mark)ã€æœ€è¿‘æœç´¢/æ›¿æ¢çš„æ¨¡å¼ã€ç¼“å†²åŒºåˆ—è¡¨ã€å…¨å±€å˜é‡ç­‰ä¿¡æ¯ã€‚\n\n# ä¼šè¯\n\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨`:mksession [file]`å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªä¼šè¯æ–‡ä»¶ï¼Œå¦‚æœçœç•¥æ–‡ä»¶åçš„è¯ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåä¸º`Session.vim`çš„ä¼šè¯æ–‡ä»¶ã€‚\n\nä¼šè¯æ–‡ä»¶ï¼Œå…¶æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª**vimè„šæœ¬**ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸Šè¿°å‘½ä»¤ç”Ÿæˆä¸€ä¸ªsessionæ–‡ä»¶ï¼Œç„¶åå†æŸ¥çœ‹å…¶ä¸­çš„å†…å®¹ï¼Œå°±ä¼šå¯¹sessionæ–‡ä»¶æœ‰ä¸€ä¸ªæ·±å…¥çš„è®¤è¯†ã€‚\n\nä¼šè¯æ–‡ä»¶ä¸­ä¿å­˜å“ªäº›ä¿¡æ¯ï¼Œæ˜¯ç”±`sessionoptions`é€‰é¡¹å†³å®šçš„ã€‚ç¼ºçœçš„`sessionoptions`é€‰é¡¹åŒ…æ‹¬ï¼š`blank`, `buffers`, `curdir`, `folds`, `help`, `options`, `tabpages`, `winsize`ï¼Œä¹Ÿå°±æ˜¯ä¼šè¯æ–‡ä»¶ä¼šæ¢å¤å½“å‰ç¼–è¾‘ç¯å¢ƒçš„ç©ºçª—å£ã€æ‰€æœ‰çš„ç¼“å†²åŒºã€å½“å‰ç›®å½•ã€æŠ˜å (fold)ç›¸å…³çš„ä¿¡æ¯ã€å¸®åŠ©çª—å£ã€æ‰€æœ‰çš„é€‰é¡¹å’Œæ˜ å°„ã€æ‰€æœ‰çš„æ ‡ç­¾é¡µ(tab)ã€çª—å£å¤§å°ã€‚\n\nå¦‚æœä½ ä½¿ç”¨windowsä¸Šçš„vimï¼Œå¹¶ä¸”å¸Œæœ›ä½ çš„ä¼šè¯æ–‡ä»¶å¯ä»¥åŒæ—¶è¢«windowsç‰ˆæœ¬çš„vimå’ŒUNIXç‰ˆæœ¬çš„vimå…±åŒä½¿ç”¨çš„è¯ï¼Œåœ¨`sessionoptions`ä¸­åŠ å…¥`slash`å’Œ`unix`ï¼Œå‰è€…æŠŠæ–‡ä»¶åä¸­çš„`\\`æ›¿æ¢ä¸º`/`ï¼Œåè€…ä¼šæŠŠä¼šè¯æ–‡ä»¶çš„æ¢è¡Œç¬¦ä¿å­˜æˆunixæ ¼å¼ã€‚\n\nå¦‚æœä½ ä¸å¸Œæœ›åœ¨`session`æ–‡ä»¶ä¸­ä¿å­˜å½“å‰è·¯å¾„ï¼Œè€Œæ˜¯å¸Œæœ›`session`æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•è‡ªåŠ¨æˆä¸ºå½“å‰å·¥ä½œç›®å½•ï¼Œé‚£ä¹ˆï¼Œéœ€è¦åœ¨`sessionoptions`å»æ‰`curdir`ï¼ŒåŠ å…¥`sesdir`ï¼Œè¿™æ ·æ¯æ¬¡è½½å…¥`session`æ–‡ä»¶æ—¶ï¼Œæ­¤æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•å°±è¢«è®¾ä¸ºvimçš„å½“å‰å·¥ä½œç›®å½•ã€‚åœ¨ä½ é€šè¿‡ç½‘ç»œè®¿é—®å…¶å®ƒé¡¹ç›®çš„sessionæ–‡ä»¶æ—¶ï¼Œæˆ–è€…ä½ çš„é¡¹ç›®æœ‰å¤šä¸ªä¸åŒç‰ˆæœ¬ï¼ˆä½äºä¸åŒçš„ç›®å½•ï¼‰ï¼Œè€Œä½ æƒ³å§‹ç»ˆä½¿ç”¨ä¸€ä¸ªsessionæ–‡ä»¶æ—¶ï¼Œè¿™ä¸ªé€‰é¡¹æ¯”è¾ƒæœ‰ç”¨ï¼šä½ åªéœ€è¦æŠŠsessionæ–‡ä»¶æ‹·è´åˆ°ä¸åŒçš„ç›®å½•ï¼Œç„¶åä½¿ç”¨å°±å¯ä»¥äº†ã€‚è®¾ç½®æ­¤é€‰é¡¹åï¼Œsessionæ–‡ä»¶ä¸­ä¿å­˜çš„æ˜¯æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ï¼Œè€Œä¸æ˜¯ç»å¯¹è·¯å¾„ã€‚\n\næˆ‘ä»¬åœ¨ä¸Šé¢ä½¿ç”¨`:mksession`å‘½ä»¤åˆ›å»ºäº†ä¼šè¯æ–‡ä»¶ï¼Œé‚£ä¹ˆæ€ä¹ˆä½¿ç”¨ä¼šè¯æ–‡ä»¶æ¢å¤ç¼–è¾‘ç¯å¢ƒå‘¢ï¼Ÿå¾ˆç®€å•ï¼Œä½ åªéœ€è¦ä½¿ç”¨`:source session-file`æ¥å¯¼å…¥ä¼šè¯æ–‡ä»¶ã€‚å› ä¸ºä¼šè¯æ–‡ä»¶æ˜¯ä¸€ä¸ªè„šæœ¬ï¼Œé‡Œé¢ä¿å­˜çš„æ˜¯Exå‘½ä»¤ï¼Œæ‰€ä»¥`source`å‘½ä»¤åªæ˜¯æŠŠä¼šè¯æ–‡ä»¶ä¸­çš„Exå‘½ä»¤æ‰§è¡Œä¸€éã€‚\n\n# viminfo\n\nä½¿ç”¨`:wviminfo [file]`å‘½ä»¤ï¼Œå¯ä»¥æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ª`viminfo`æ–‡ä»¶ã€‚\n\nå…¶å®ï¼Œåœ¨vimé€€å‡ºæ—¶ï¼Œæ¯æ¬¡éƒ½ä¼šä¿å­˜ä¸€ä¸ª`.viminfo`æ–‡ä»¶åœ¨ç”¨æˆ·çš„ä¸»ç›®å½•ã€‚æˆ‘ä»¬ä½¿ç”¨`:wviminfo`å‘½ä»¤åˆ™æ˜¯æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ª`viminfo`æ–‡ä»¶ï¼Œå› ä¸ºç¼ºçœçš„`.viminfo`æ–‡ä»¶ä¼šåœ¨æ¯æ¬¡é€€å‡ºvimæ—¶è‡ªåŠ¨æ›´æ–°ï¼Œè°çŸ¥é“ä½ åœ¨å…³é—­å½“å‰è½¯ä»¶é¡¹ç›®åï¼Œåˆä½¿ç”¨vimåšè¿‡äº›ä»€ä¹ˆå‘¢ï¼Ÿè¿™æ ·çš„è¯ï¼Œ`.viminfo`ä¸­çš„ä¿¡æ¯ï¼Œä¹Ÿè®¸å°±ä¸ä½ æ‰€è¿›è¡Œçš„è½¯ä»¶é¡¹ç›®æ— å…³äº†ã€‚è¿˜æ˜¯æ‰‹åŠ¨ä¿å­˜ä¸€ä¸ªä¿é™©ã€‚\n\n`:wviminfo`å‘½ä»¤ä¿å­˜å“ªäº›å†…å®¹ï¼Œä»¥åŠä¿å­˜çš„æ•°é‡ï¼Œç”±`viminfo`é€‰é¡¹å†³å®šï¼Œè¿™ä¸ªé€‰é¡¹çš„å€¼åœ¨windowsä¸Šå’Œåœ¨linuxä¸Šçš„ç¼ºçœå€¼ä¸åŒï¼Œå…·ä½“å«ä¹‰å‚é˜…æ‰‹å†Œã€‚\n\nè¦è¯»å…¥ä½ æ‰€ä¿å­˜çš„`viminfo`æ–‡ä»¶ï¼Œä½¿ç”¨`:rviminfo [file]`å‘½ä»¤ã€‚\n\nç°åœ¨ï¼Œå…ˆçœ‹ä¸€ä¸‹æˆ‘ä»¬å½“å‰ç›®å½•ï¼Œæ‰§è¡Œ`:pwd`ï¼Œæ˜¾ç¤º`/home/xcg/vimtest`ï¼Œæ¥ä¸‹æ¥ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š\n\n```vim\n:cd src                            \"åˆ‡æ¢åˆ°/home/xcg/vimtest/srcç›®å½• éœ€è¦å…ˆåœ¨å¤–éƒ¨åˆ›å»ºè¯¥ç›®å½•\n:set sessionoptions-=curdir        \"åœ¨session optionä¸­å»æ‰curdir\n:set sessionoptions+=sesdir        \"åœ¨session optionä¸­åŠ å…¥sesdir\n:mksession vim90.vim               \"åˆ›å»ºä¸€ä¸ªä¼šè¯æ–‡ä»¶\n:wviminfo vim90.viminfo            \"åˆ›å»ºä¸€ä¸ªviminfoæ–‡ä»¶\n:qa                                \"é€€å‡ºvim\n```\n\né€€å‡ºvimåï¼Œåœ¨å‘½ä»¤è¡Œä¸‹æ‰§è¡Œ`vim`ï¼Œå†æ¬¡è¿›å…¥vimï¼Œè¿™æ—¶çœ‹åˆ°çš„æ˜¯ä¸€ä¸ªç©ºç™½çª—å£ã€‚ç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š\n\n```\n:source ~/vimtest/src/vim90.vim    'è½½å…¥ä¼šè¯æ–‡ä»¶\n:rviminfo vim90.viminfo            'è¯»å…¥viminfoæ–‡ä»¶\n```\n\nå¤ªæ£’äº†ï¼Œåˆæ¢å¤åˆ°æ˜¨å¤©é€€å‡ºæ—¶çš„çŠ¶æ€äº†ï¼ç»§ç»­å·¥ä½œã€‚ä¸è¿‡ï¼Œæ¯æ¬¡éƒ½è¦æ‰‹å·¥ä¿®æ”¹`sessionoptions`æˆ–`viminfo`å—ï¼Ÿå¤šéº»çƒ¦å•Šã€‚åˆ«ç€æ€¥ï¼Œç°åœ¨æ˜¯æ—¶å€™ä»‹ç»vimrcäº†ã€‚","categories":["Linux","vim"]},{"title":"Linux_vimrc","url":"/Linux/Linux_vimrc/","content":"\n# vimå®‰è£…\n\nLinuxä¸‹çš„å®‰è£…ã€‚\n\nThe Vim repository at GitHub: Vim is available through git. This is the most straightforward way to get Vim and keep it up-to-date.\n\nYou can obtain Vim for the first time with:\n\n```\ngit clone https://github.com/vim/vim.git\n```\n\nAnd, if you don't have local changes, update to the latest version with:\n\n```\ncd vim\ngit pull\n```\n\nIf you made some changes, e.g. to a makefile, you can keep them and merge with the latest version with:\n\n```\ncd vim\ngit stash\ngit pull\ngit stash pop\n```\n\nIf you have local changes you may need to merge. If you are sure you can discard local changes (e.g. if you were just trying a patch), you can use:\n\n```\ngit fetch --all\ngit reset --hard origin/master\n```\n\n## Building Vim\n\nBuild and install Vim as usual. If you are happy with the defaults:\n\n```\ncd src\nmake distclean  # if you build Vim before\nmake\nsudo make install\n```\n\n# vimrcåœ¨å“ª\n\nvimrcç©¶ç«Ÿåœ¨å“ªå„¿å‘¢ï¼Ÿè¿™ä¸ªé—®é¢˜å¯¹ä¸€ä¸ªvimçš„å…¥é—¨ç”¨æˆ·æ¥è¯´ï¼Œå¯èƒ½å®åœ¨ä¸æ˜¯ä¸ªé—®é¢˜ï¼Œä½ å¯èƒ½å›ç­”ï¼šâ€ä¸å°±æ˜¯`$HOME/.vimrc`å—ï¼Ÿâ€ã€‚æ˜¯çš„ï¼Œè¿™ä¸ªç­”æ¡ˆæ­£ç¡®ï¼Œä¸è¿‡ä¸æ˜¯å…¨éƒ¨ã€‚\n\né¦–å…ˆï¼Œåœ¨Linuxä¸‹çš„Vimä¸­è¾“å…¥`:version`å‘½ä»¤(å¯èƒ½ä½ æ˜¯ä½¿ç”¨Linuxä¸‹çš„viå‘½ä»¤æ‰“å¼€ç¼–è¾‘å™¨ï¼Œä¸è¿‡åœ¨å¤§å¤šæ•°Linuxä¸­ï¼Œviå‘½ä»¤æ‰“å¼€çš„å°±æ˜¯Vim)ï¼Œæˆ‘ä»¬ç•¥è¿‡ä¸ç›¸å…³çš„å†…å®¹ï¼Œå…³äºvimrcçš„æ˜¾ç¤ºå¦‚ä¸‹(å¯èƒ½ä½ çš„æ˜¾ç¤ºä¸å®Œå…¨å’Œè¿™é‡Œç›¸åŒ)ï¼š\n\n```\n# Linuxä¸‹çš„vim\n:version\nVIM - Vi IMproved 8.0 (2016 Sep 12, compiled Jun 26 2017 11:44:34)\nIncluded patches: 1-678\n\n   system vimrc file: \"$VIM/vimrc\"\n     user vimrc file: \"$HOME/.vimrc\"\n 2nd user vimrc file: \"~/.vim/vimrc\"\n      user exrc file: \"$HOME/.exrc\"\n  system gvimrc file: \"$VIM/gvimrc\"\n    user gvimrc file: \"$HOME/.gvimrc\"\n2nd user gvimrc file: \"~/.vim/gvimrc\"\n...\n```\n\nåœ¨ä¸Šé¢ï¼Œæˆ‘ä»¬çœ‹åˆ°åˆ—å‡ºäº†å‡ ä¸ªvimrcæ–‡ä»¶ï¼Œæœ‰ä¸€ä¸ªç³»ç»Ÿçš„vimrcæ–‡ä»¶ï¼Œè¿˜æœ‰ç”¨æˆ·çš„vimrcæ–‡ä»¶ï¼Œä»¥åŠç³»ç»Ÿå’Œç”¨æˆ·gvimrcæ–‡ä»¶ã€‚å‡ºäºå’Œviå…¼å®¹çš„ç›®çš„ï¼Œvimä¹Ÿæ”¯æŒviçš„exrcé…ç½®æ–‡ä»¶ã€‚\n\næ¥ç€ï¼Œæˆ‘ä»¬åœ¨Windowsç³»ç»Ÿä¸­è¾“å…¥`:version`å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹è¾“å‡º(ä½¿ç”¨çš„æ˜¯é¢„ç¼–è¯‘çš„Vim 8.0)ï¼š\n\n```\n# Windowsä¸‹çš„vim\nVIM - Vi IMproved 9.0 (2022 Jun 28, compiled Jun 28 2022 12:46:00)\nMS-Windows 32-bit GUI version with OLE support\nCompiled by mool@tororo\n\n   system vimrc file: \"$VIM\\vimrc\"\n     user vimrc file: \"$HOME\\_vimrc\"\n 2nd user vimrc file: \"$HOME\\vimfiles\\vimrc\"\n 3rd user vimrc file: \"$VIM\\_vimrc\"\n      user exrc file: \"$HOME\\_exrc\"\n  2nd user exrc file: \"$VIM\\_exrc\"\n  system gvimrc file: \"$VIM\\gvimrc\"\n    user gvimrc file: \"$HOME\\_gvimrc\"\n2nd user gvimrc file: \"$HOME\\vimfiles\\gvimrc\"\n3rd user gvimrc file: \"$VIM\\_gvimrc\"\n       defaults file: \"$VIMRUNTIME\\defaults.vim\"\n    system menu file: \"$VIMRUNTIME\\menu.vim\"\n```\n\næ¯”è¾ƒä¸€ä¸‹ä¸Šé¢ä¸¤ä¸ª`:version`å‘½ä»¤çš„è¾“å‡ºï¼Œæˆ‘ä»¬å‘ç°ï¼š\n\n1. Vimå¯åŠ¨æ—¶ï¼Œä¼šå…ˆå°è¯•æ‰§è¡Œç”¨æˆ·vimrcï¼Œå¹¶ä½¿ç”¨æ‰€æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªç”¨æˆ·vimrcä¸­çš„é…ç½®ï¼Œå¿½ç•¥å…¶ä½™çš„ç”¨æˆ·vimrcã€‚å…¶æ¬¡æ‰æ‰¾ç³»ç»Ÿçš„vimrcæ–‡ä»¶ã€‚\n2. åœ¨Linuxä¸‹ä½¿ç”¨çš„vimrcæ–‡ä»¶åä¸º`.vimrc`ï¼Œåœ¨Linuxä¸‹ï¼Œå¦‚æœæœªæ‰¾åˆ°åä¸º`.vimrc`çš„æ–‡ä»¶ï¼Œä¹Ÿä¼šå°è¯•æŸ¥æ‰¾åä¸º`_vimrc`æ–‡ä»¶ï¼›åœ¨Windowsä¸‹ä¹Ÿæ˜¯è¿™æ ·ï¼Œåªä¸è¿‡æŸ¥æ‰¾é¡ºåºé¢ å€’ä¸€ä¸‹ï¼Œå¦‚æœæœªæ‰¾åˆ°åä¸º`_vimrc`çš„æ–‡ä»¶ï¼Œä¼šå»æŸ¥æ‰¾`.vimrc`ã€‚\n3. åœ¨Windowsä¸‹å› ä¸ºä¸æ”¯æŒä»¥ç‚¹`.`å¼€å¤´çš„æ–‡ä»¶åï¼Œvimrcæ–‡ä»¶çš„åå­—ä½¿ç”¨`_vimrc`ã€‚æœ‰ä¸¤ä¸ªå¯é€‰çš„ç”¨æˆ·vimrcæ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯`$HOME\\_vimrc`ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯`$VIM\\_vimrc`ã€‚\n4. ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œvimrcçš„æ‰§è¡Œå…ˆäºgvimrcã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠå…¨éƒ¨vimé…ç½®å‘½ä»¤éƒ½æ”¾åœ¨vimrcä¸­ï¼Œä¸éœ€è¦ç”¨gvimrcã€‚\n\nå¯¹äºvimåˆå­¦è€…ï¼Œå¦‚æœä¸çŸ¥é“`$HOME`æˆ–è€…`$VIM`å…·ä½“æ˜¯å“ªä¸ªç›®å½•ï¼Œå¯ä»¥åœ¨vimä¸­ç”¨ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹ï¼š\n\n```vim\n:echo $VIM     # /usr/shared/vim\n:echo $HOME    # /home/xcg\n```\n\nåˆ†åˆ«æ‰“å°çš„æ˜¯`/usr/share/vim`ï¼ˆvimç›®å½•ï¼‰ï¼Œ`/ssd_b/xcg`ï¼ˆå®¶ç›®å½•ï¼‰ã€‚\n\n## é€‰æ‹©vimé…ç½®\n\nWindowsç‰ˆæœ¬çš„Vimåœ¨å®‰è£…æ—¶ï¼Œç¼ºçœä¼šå®‰è£…ä¸€ä¸ª`$VIM/_vimrc`ï¼Œä½ å¯ä»¥ç›´æ¥ä¿®æ”¹è¿™ä¸ª`_vimrc`ï¼ŒåŠ å…¥ä½ è‡ªå·±çš„é…ç½®(ä½¿ç”¨`:e $VIM/_vimrc`å³å¯æ‰“å¼€æ­¤æ–‡ä»¶)ã€‚æˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨Windowsä¸­å¢åŠ ä¸€ä¸ªåä¸º`HOME`çš„ç¯å¢ƒå˜é‡(`æ§åˆ¶é¢æ¿` -> `ç³»ç»Ÿ` â€“> `é«˜çº§` â€“> `ç¯å¢ƒå˜é‡`)ï¼Œç„¶åæŠŠä½ çš„vimrcæ”¾åœ¨HOMEç¯å¢ƒå˜é‡æ‰€æŒ‡å®šçš„ç›®å½•ä¸­ã€‚ä»ä¸Šé¢`:version`å‘½ä»¤çš„è¾“å‡ºçœ‹åˆ°ï¼Œ`$HOME/_vimrc`å¦‚æœå­˜åœ¨ï¼Œå°±ä¼šæ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ä¸­çš„é…ç½®ï¼Œä»è€Œè·³è¿‡`$VIM/_vimrc`ã€‚\n\n1. å¦‚æœä½¿ç”¨`vim -u filename`å‘½ä»¤æ¥å¯åŠ¨Vimï¼Œåˆ™ä¼šç”¨ä½ æŒ‡å®šçš„`filename`ä½œä¸ºVimçš„é…ç½®æ–‡ä»¶(åœ¨è°ƒè¯•ä½ çš„vimrcæ—¶æœ‰ç”¨)ï¼›\n2. å¦‚æœç”¨`vim -u NONE`å‘½ä»¤å¯åŠ¨Vimï¼Œåˆ™ä¸è¯»å–ä»»ä½•vimrcæ–‡ä»¶ï¼šå½“ä½ æ€€ç–‘ä½ çš„vimrcé…ç½®æœ‰é—®é¢˜æ—¶ï¼Œå¯ä»¥ç”¨è¿™ç§æ–¹å¼è·³è¿‡vimrcçš„æ‰§è¡Œã€‚\n\n## æ€»ç»“\n\nLinuxå’ŒWindowsä¸‹vimçš„å¯åŠ¨ä¼˜å…ˆå¯»æ‰¾`$HOME/.vimrc`ï¼ˆWindowsä¸‹æ˜¯`_vimrc`ï¼‰ï¼Œå³ç”¨æˆ·è‡ªå·±çš„é…ç½®ã€‚ç”¨æˆ·é…ç½®æ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼Œä½¿ç”¨çš„æ˜¯ç³»ç»Ÿçš„é…ç½®æ–‡ä»¶`$VIM/vimrc`ã€‚\n\n# vimrcåˆæ­¥\n\næ‰€ç”¨å‘½ä»¤çš„å¸®åŠ©å…¥å£ï¼š\n\n```\n:help compatible\n:help mapleader\n:help map\n:help autocmd\n```\n\nvimçš„ç¯å¢ƒä¾èµ–ä¼šè¯(session)æ–‡ä»¶å’Œviminfoæ–‡ä»¶ï¼Œå…¶ä¸­â€˜sessionoptionsâ€™é€‰é¡¹å’Œâ€˜viminfoâ€™é€‰é¡¹çš„é…ç½®å¯èƒ½ä¼šæ ¹æ®éœ€è¦è¿›è¡Œè°ƒæ•´ã€‚ä½†å¦‚ä½•ä¿å­˜æ‰€åšçš„è°ƒæ•´å‘¢ï¼Ÿéœ€è¦vimrcæ–‡ä»¶ã€‚\n\nå½“vimåœ¨å¯åŠ¨æ—¶ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°vimrcæˆ–gvimrcï¼Œå®ƒç¼ºçœä¸ºVIå…¼å®¹çš„æ¨¡å¼ã€‚è¿™æ„å‘³ç€ï¼Œåªèƒ½ä½¿ç”¨VIæ‰€å…·å¤‡çš„åŠŸèƒ½ï¼Œè€Œvimä¸­çš„å¤§é‡æ‰©å±•åŠŸèƒ½å°†æ— æ³•ä½¿ç”¨ã€‚\n\nvimä¸­è‡ªå¸¦äº†ä¸€ä¸ªvimrcä¾‹å­ï¼Œä»è¿™ä¸ªä¾‹å­å¼€å§‹åˆ†æã€‚\n\nä¸‹é¢ä»¥Linuxä¸‹çš„vimä¸ºä¾‹ã€‚\n\nç¤ºä¾‹çš„vimrc(åä¸º`vimrc_example.vim`)é€šå¸¸ä½äº`/usr/share/vim/vimXXX/`ç›®å½•ä¸‹ï¼Œå…¶ä¸­vimXXXä¸ä½¿ç”¨çš„vimç‰ˆæœ¬æœ‰å…³ã€‚\n\né¦–å…ˆæŠŠè¿™ä¸ªç¤ºä¾‹çš„vimrcæ‹·è´åˆ°ç›¸åº”çš„ç›®å½•ï¼Œåœ¨Linuxä¸‹ï¼Œåº”è¯¥æŠŠå®ƒæ‹·è´åˆ°ä½ çš„homeç›®å½•ä¸‹ï¼Œåå­—ä¸ºâ€.vimrcâ€ã€‚\n\nä¸‹é¢æ˜¯shellå‘½ä»¤ï¼š\n\n```\ncp /usr/share/vim/vim90/vimrc_example.vim ~/.vimrc \n```\n\næˆ–è€…ä½ åœ¨vimä¸­æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå’Œä¸Šé¢çš„shellå‘½ä»¤å®Œæˆç›¸åŒçš„åŠŸèƒ½ï¼š\n\n```\n:!cp $vimRUNTIME/vimrc_example.vim ~/.vimrc \n```\n\nå¯ä»¥å…ˆè¯»ä¸€ä¸‹ç°åœ¨çš„vimrcï¼Œçœ‹çœ‹å®ƒéƒ½è®¾å®šäº†ä»€ä¹ˆï¼š\n\n```\n:e ~/.vimrc \n```\n\nè¿™æ˜¯ä¸€ä¸ªæ³¨é‡Šè‰¯å¥½çš„æ–‡ä»¶ï¼Œä¸éœ€è¦å¤šè§£é‡Šã€‚\n\n> å¯¹windowsç‰ˆæœ¬çš„vimï¼Œå®ƒå·²ç»é»˜è®¤çš„æœ‰äº†ä¸€ä¸ªvimrcï¼Œå¯ä»¥åœ¨vimåœ¨ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æŸ¥çœ‹å®ƒã€‚\n>\n> ```\n> :e $vim/_vimrc \n> ```\n>\n> åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œå®ƒåŒ…å«äº†ä¸Šé¢æåˆ°çš„`vimrc_example.vim`ã€‚åŒæ—¶ï¼Œå®ƒä¼šæŠŠvimè®¾ç½®çš„æ›´ç¬¦åˆwindowsçš„æ“ä½œä¹ æƒ¯ã€‚æ¯”å¦‚ï¼Œæ”¯æŒCTRL-Cæ‹·è´ï¼ŒCTRL-Vç²˜è´´ç­‰ç­‰ã€‚Windowsä¸‹çš„ç”¨æˆ·ï¼Œå¯ä»¥ä½¿ç”¨`$vim/_vimrc`æ¥åšä¸ºç¬¬ä¸€ä¸ªvimrcã€‚\n>\n> é¡ºä¾¿æä¸€å¥ï¼Œåœ¨unix/linuxä¸­ï¼Œæ–‡ä»¶åå¯ä»¥ä»¥â€.â€å¼€å¤´ï¼Œè¡¨æ˜æ­¤æ–‡ä»¶æ˜¯éšè—çš„ã€‚è€Œåœ¨windowsä¸­ï¼Œä¸å…è®¸æ–‡ä»¶åä»¥â€.â€å¼€å¤´ï¼Œæ‰€ä»¥ï¼Œwindowsç‰ˆæœ¬çš„vimï¼Œå°†è¯»å–`_vimrc`æ¥åšä¸ºè‡ªå·±çš„é…ç½®æ–‡ä»¶ã€‚\n\n## æ‰“å¼€vimrcçš„å¿«æ·æ–¹å¼\n\nåœ¨ä»Šåä½¿ç”¨vimçš„æ—¥å­é‡Œï¼Œä¼šé¢‘ç¹çš„æ›´æ”¹vimrcã€‚æ‰€ä»¥éœ€è¦è®¾ç½®ä¸€äº›å¿«æ·æ–¹å¼ï¼Œä½¿æˆ‘ä»¬èƒ½å¿«é€Ÿçš„è®¿é—®vimrcã€‚\n\næŠŠä¸‹é¢è¿™æ®µå†…å®¹æ‹·è´åˆ°vimrcä¸­ï¼š\n\n```\n1  \"Set mapleader\n2    let mapleader = \",\"\n3\n4  \"Fast reloading of the .vimrc\n5    map <silent> <leader>ss :source ~/.vimrc<cr>\n6  \"Fast editing of .vimrc\n7    map <silent> <leader>ee :e ~/.vimrc<cr>\n8  \"When .vimrc is edited, reload it\n9    autocmd! bufwritepost .vimrc source ~/.vimrc \n```\n\n- åœ¨vimrcä¸­ï¼ŒåŒå¼•å·å¼€å¤´çš„è¡Œï¼Œå°†è¢«å½“ä½œæ³¨é‡Šå¿½ç•¥ã€‚\n- ç¬¬2è¡Œï¼Œç”¨æ¥è®¾ç½®`mapleader`å˜é‡ï¼Œå½“`mapleader`ä¸ºæœªè®¾ç½®æˆ–ä¸ºç©ºæ—¶ï¼Œä½¿ç”¨ç¼ºçœçš„â€`\\`â€æ¥ä½œä¸ºmapleaderã€‚\n\nmapleaderå˜é‡æ˜¯ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿçœ‹ä¸‹é¢çš„ä»‹ç»ã€‚\n\n- ç¬¬5è¡Œå®šä¹‰äº†ä¸€ä¸ªæ˜ å°„(map)ï¼Œè¿™ä¸ªæ˜ å°„æŠŠ`<leader>ss`ï¼Œæ˜ å°„ä¸ºå‘½ä»¤`:source ~/.vimrc<cr>`ã€‚å½“å®šä¹‰ä¸€ä¸ªæ˜ å°„æ—¶ï¼Œå¯ä»¥ä½¿ç”¨`<leader>`å‰ç¼€ã€‚è€Œåœ¨æ˜ å°„ç”Ÿæ•ˆæ—¶ï¼Œvimä¼šæŠŠ`<leader>`æ›¿æ¢æˆmapleaderå˜é‡çš„å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è¿™é‡Œå®šä¹‰çš„`<leader>ss`åœ¨ä½¿ç”¨æ—¶å°±å˜æˆäº†â€`,ss`â€œï¼Œå½“è¾“å…¥è¿™ä¸€å¿«æ·æ–¹å¼æ—¶ï¼Œå°±ä¼šsourceä¸€æ¬¡`~/.vimrc`æ–‡ä»¶(ä¹Ÿå°±æ˜¯é‡æ–°æ‰§è¡Œä¸€é`.vimrc`æ–‡ä»¶)ã€‚\n- ç¬¬7è¡Œï¼Œå®šä¹‰äº†`<leader>ee`å¿«æ·é”®ï¼Œå½“è¾“å…¥`,ee`æ—¶ï¼Œä¼šæ‰“å¼€`~/.vimrc`è¿›è¡Œç¼–è¾‘ã€‚\n- ç¬¬9è¡Œï¼Œå®šä¹‰äº†ä¸€ä¸ªè‡ªåŠ¨å‘½ä»¤ï¼Œæ¯æ¬¡å†™å…¥`.vimrc`åï¼Œéƒ½ä¼šæ‰§è¡Œè¿™ä¸ªè‡ªåŠ¨å‘½ä»¤ï¼Œsourceä¸€æ¬¡`~/.vimrc`æ–‡ä»¶ã€‚\n\næœ‰äº†ä¸Šé¢çš„å¿«æ·é”®ï¼Œæˆ‘ä»¬å°±èƒ½å¿«é€Ÿçš„æ‰“å¼€vimrcæ–‡ä»¶ç¼–è¾‘ï¼Œå¿«é€Ÿé‡æ–°source vimrcæ–‡ä»¶ï¼Œæ–¹ä¾¿å¤šäº†ã€‚æ³¨æ„ï¼Œ`,ee`ã€`,ss`å‘½ä»¤ä¸æ˜¯åœ¨å†’å·æ¨¡å¼ä¸‹è¾“å…¥ï¼Œè€Œæ˜¯ç©ºæ‚¬æ¨¡å¼ä¸‹è¾“å…¥ï¼Œåœ¨å³ä¸‹è§’å¯çœ‹åˆ°è¾“å…¥çš„å‘½ä»¤ã€‚\n\n## ä½¿ç”¨åŒä¸€ä¸ªvimrcæ–‡ä»¶\n\nä¸ºäº†å®ç°æ— è®ºåœ¨windowsè¿˜æ˜¯åœ¨linuxä¸­éƒ½èƒ½ä½¿ç”¨vimä½œä¸ºç¼ºçœç¼–è¾‘å™¨ã€‚å¹¶ä¸”ï¼Œæƒ³ä½¿ç”¨åŒä¸€ä¸ªvimrcæ–‡ä»¶ã€‚å› æ­¤å®šä¹‰äº†ä¸€ä¸ª`MySys()`å‡½æ•°ï¼Œç”¨æ¥åŒºåˆ†ä¸åŒçš„å¹³å°ï¼Œä»¥è¿›è¡Œä¸åŒçš„é…ç½®ã€‚\n\nå¦å¤–ï¼Œåœ¨ç¼–è¾‘vimrcæ–‡ä»¶æ—¶ï¼Œæœ€å¥½æ–°å¼€ä¸€ä¸ªæ ‡ç­¾é¡µæ¥ç¼–è¾‘ï¼Œè€Œä¸æ˜¯åœ¨å½“å‰çª—å£ä¸­ã€‚å› æ­¤ï¼Œå®šä¹‰äº†`SwitchToBuf()`å‡½æ•°ï¼Œå®ƒåœ¨æ‰€æœ‰æ ‡ç­¾é¡µçš„çª—å£ä¸­æŸ¥æ‰¾æŒ‡å®šçš„æ–‡ä»¶åï¼Œå¦‚æœæ‰¾åˆ°è¿™æ ·ä¸€ä¸ªçª—å£ï¼Œå°±è·³åˆ°æ­¤çª—å£ä¸­ï¼›å¦åˆ™ï¼Œå®ƒæ–°å»ºä¸€ä¸ªæ ‡ç­¾é¡µæ¥æ‰“å¼€vimrcæ–‡ä»¶ã€‚\n\n> æ³¨ï¼šæ ‡ç­¾é¡µ(tab)åŠŸèƒ½åªæœ‰åœ¨vim 7.0ç‰ˆæœ¬ä»¥ä¸Šæ‰æ”¯æŒã€‚\n\nä¸‹é¢æ˜¯ç¤ºä¾‹ï¼š\n\n```\n\" Platform\nfunction! MySys()\n  if has(\"win32\")\n    return \"windows\"\n  else\n    return \"linux\"\n  endif\nendfunction\n\nfunction! SwitchToBuf(filename)\n    \"let fullfn = substitute(a:filename, \"^\\\\~/\", $HOME . \"/\", \"\")\n    \" find in current tab\n    let bufwinnr = bufwinnr(a:filename)\n    if bufwinnr != -1\n        exec bufwinnr . \"wincmd w\"\n        return\n    else\n        \" find in each tab\n        tabfirst\n        let tab = 1\n        while tab <= tabpagenr(\"$\")\n            let bufwinnr = bufwinnr(a:filename)\n            if bufwinnr != -1\n                exec \"normal \" . tab . \"gt\"\n                exec bufwinnr . \"wincmd w\"\n                return\n            endif\n            tabnext\n            let tab = tab + 1\n        endwhile\n        \" not exist, new tab\n        exec \"tabnew \" . a:filename\n    endif\nendfunction\n\n\"Fast edit vimrc\nif MySys() == 'linux'\n    \"Fast reloading of the .vimrc\n    map <silent> <leader>ss :source ~/.vimrc<cr>\n    \"Fast editing of .vimrc\n    map <silent> <leader>ee :call SwitchToBuf(\"~/.vimrc\")<cr>\n    \"When .vimrc is edited, reload it\n    autocmd! bufwritepost .vimrc source ~/.vimrc\nelseif MySys() == 'windows'\n    \" Set helplang\n    set helplang=cn\n    \"Fast reloading of the _vimrc\n    map <silent> <leader>ss :source ~/_vimrc<cr>\n    \"Fast editing of _vimrc\n    map <silent> <leader>ee :call SwitchToBuf(\"~/_vimrc\")<cr>\n    \"When _vimrc is edited, reload it\n    autocmd! bufwritepost _vimrc source ~/_vimrc\nendif\n\n\" For windows version\nif MySys() == 'windows'\n    source $VIMRUNTIME/mswin.vim\n    behave mswin\nendif \n```\n\næ³¨æ„ï¼šåœ¨windowsä¸­ä¹Ÿå®šä¹‰äº†ä¸€ä¸ªâ€HOMEâ€ç¯å¢ƒå˜é‡ï¼Œç„¶åæŠŠ`_vimrc`æ”¾åœ¨â€HOMEâ€ç¯å¢ƒå˜é‡æ‰€æŒ‡å‘çš„ç›®å½•ä¸­ã€‚è¿™æ ·æ‰èƒ½åœ¨windowsä¸­ä½¿ç”¨ã€‚\n\nå¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬çŸ¥é“å¦‚ä½•æ°¸ä¹…æ›´æ”¹`â€˜sessionoptionsâ€™`é€‰é¡¹å’Œ`â€˜viminfoâ€™`é€‰é¡¹äº†ï¼ŒæŠŠå¯¹å®ƒä»¬çš„é…ç½®æ”¾å…¥vimrcå³å¯ã€‚\n\nvimè‡ªå¸¦çš„ç¤ºä¾‹vimrcä¸­ï¼Œåªå®šä¹‰æœ€åŸºæœ¬çš„é…ç½®ã€‚\n\nåœ¨http://www.amix.dk/vim/vimrc.htmlæœ‰ä¸€ä¸ªéå¸¸å¼ºå¤§çš„vimrcï¼Œæœ‰äººæˆç§°ä¸ºâ€å²ä¸Šæœ€å¼ºçš„vimrcâ€ï¼Œæˆ–è®¸æœ‰äº›è¨€è¿‡å…¶å®ã€‚ä¸è¿‡ï¼Œå¦‚æœé€šè¯»äº†è¿™ä¸ªvimrcï¼Œç›¸ä¿¡èƒ½ä»ä¸­å­¦åˆ°å¾ˆå¤šã€‚[è¿™é‡Œ](http://blog.csdn.net/redguardtoo/archive/2006/09/03/1172136.aspx)æœ‰ä¸€ä¸ªredguardtooä¿®æ”¹è¿‡çš„ç‰ˆæœ¬ï¼Œå¯ä»¥å¯¹ç…§å‚è€ƒä¸€ä¸‹ã€‚ä½†æ˜¯ä¸è¦ç…§æ‹·è¿™ä¸¤ä¸ªvimrcï¼Œå¯èƒ½è¿™ä¸ªæ–‡ä»¶çš„è®¾å®šå¹¶ä¸ç¬¦åˆä½ çš„ä¹ æƒ¯ã€‚å¦å¤–ï¼Œè¿™ä¸ªæ–‡ä»¶çš„è®¾å®šï¼Œå¯èƒ½ä¹Ÿä¸èƒ½åœ¨å½“å‰çš„å·¥ä½œç¯å¢ƒä¸­è¿è¡Œã€‚\n","categories":["Linux","vim"]},{"title":"Linux_vimä¿å­˜é¡¹ç›®ç›¸å…³é…ç½®","url":"/Linux/Linux_vimä¿å­˜é¡¹ç›®ç›¸å…³é…ç½®/","content":"\næœ¬èŠ‚æ‰€ç”¨å‘½ä»¤çš„å¸®åŠ©å…¥å£ï¼š\n\n```\n:help 'path'\n:help mksession\n:help find\n:help gf\n:help CTRL-W_f\n```\n\n# å¼•å…¥ï¼špath\n\nvimrcå®šä¹‰äº†vimé€šå¸¸çš„è¡Œä¸ºã€‚ç„¶è€Œï¼Œæ¯ä¸ªé¡¹ç›®éƒ½æœ‰å…¶ç‰¹æ®Šçš„å®šä¹‰ï¼Œè™½ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨vimrcä¸­å¯¹æ¯ä¸ªé¡¹ç›®è¿›è¡Œå®šåˆ¶ï¼Œä½†è¿™æ ·ä¸€æ¥ï¼Œvimrcä¼šå˜å¾—å¾ˆå¤§ï¼Œä½¿vimå¯åŠ¨é€Ÿåº¦å˜æ…¢ï¼›å¦å¤–ä¹Ÿä¼šä½¿vimrcå˜å¾—éš¾ä»¥ç»´æŠ¤ã€‚\n\nå› æ­¤ï¼Œä½¿ç”¨å…¶å®ƒçš„æ–¹æ³•æ¥ä¿å­˜é¡¹ç›®ç›¸å…³çš„ä¿¡æ¯ï¼Œå°†ä»¥*path*é€‰é¡¹çš„è®¾ç½®ä¸ºä¾‹è¿›è¡Œã€‚\n\npathé€‰é¡¹å®šä¹‰äº†ä¸€ä¸ªç›®å½•åˆ—è¡¨ï¼Œåœ¨ä½¿ç”¨`gf`ï¼Œ`find`ï¼Œä»¥åŠ`CTRL-W f`ç­‰vimå‘½ä»¤æ—¶ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨pathé€‰é¡¹å®šä¹‰çš„ç›®å½•åˆ—è¡¨ä¸­æŸ¥æ‰¾ç›¸åº”çš„æ–‡ä»¶ã€‚pathé€‰é¡¹ä»¥é€—å·åˆ†éš”å„ç›®å½•åã€‚æˆ‘ä»¬ä»¥vimçš„æºä»£ç ä¸ºä¾‹ï¼ˆæºä»£ç æ”¾åœ¨`~/src/vimXX/`ç›®å½•ä¸­ï¼‰ã€‚\n\nå¯¹äºè¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬çš„*path*é€‰é¡¹è®¾ç½®å¦‚ä¸‹ï¼š\n\n```\nset path=.,/usr/include,,~/src/vim90/**\n```\n\nç¨å¾®è§£é‡Šä¸€ä¸‹å„é¡¹çš„å«ä¹‰ï¼Œæ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹*path*é€‰é¡¹çš„å¸®åŠ©é¡µï¼š\n\n- `.`ï¼šåœ¨å½“å‰æ–‡ä»¶æ‰€åœ¨ç›®å½•ä¸­æœç´¢\n- `/usr/include`ï¼šåœ¨`/usr/include`ç›®å½•ä¸­æœç´¢\n- `,,`ï¼šåœ¨å½“å‰å·¥ä½œè·¯å¾„ä¸­æœç´¢\n- `~/src/vim90/**`ï¼šåœ¨`~/src/vim90`çš„æ‰€æœ‰å­ç›®å½•æ ‘ä¸­è¿›è¡Œæœç´¢\n\nè®¾ç½®äº†*path*é€‰é¡¹åï¼Œæ€ä¹ˆç”¨å‘¢ï¼Ÿ\n\næˆ‘ä»¬æŠŠå…‰æ ‡å®šä½åˆ°`src/main.c`æ–‡ä»¶ç¬¬22è¡Œçš„`fcntl.h`å•è¯ä¸Šï¼Œç„¶ååœ¨`Normal`æ¨¡å¼ä¸‹æŒ‰`gf`ã€‚å’¦ï¼Œ`vim`æ‰“å¼€äº†`/usr/include/fcntl.h`æ–‡ä»¶ï¼\n\nç°åœ¨æˆ‘ä»¬æŒ‰`CTRL-^`å›åˆ°åˆšæ‰çš„ä½ç½®ï¼Œå…‰æ ‡ä»æ—§å®šä½åœ¨ç¬¬22è¡Œçš„`fcntl.h`å•è¯ä¸Šï¼Œç„¶åæŒ‰`CTRL-W f`ã€‚å•Šå“ˆï¼Œè¿™æ¬¡vimæ‰“å¼€äº†ä¸€ä¸ªæ°´å¹³åˆ†éš”çª—å£ï¼Œåœ¨æ­¤çª—å£ä¸­æ‰“å¼€äº†`/usr/include/fcntl.h`ã€‚\n\nå°½ç®¡åœ¨`src/main.c`ä¸­æœªæŒ‡å®š`fcntl.h`çš„è·¯å¾„ï¼Œä½†vimä¼šåœ¨*path*é€‰é¡¹å®šä¹‰çš„è·¯å¾„ä¸­æœç´¢æ­¤æ–‡ä»¶ï¼Œå¾ˆæ–¹ä¾¿ã€‚\n\nç°åœ¨æˆ‘ä»¬çœ‹ä¸€ä¸‹`find`å‘½ä»¤ï¼Œè¾“å…¥ï¼š\n\n```\n:find netrw.vim\n```\n\nvimæ‰“å¼€äº†`~/src/vim90/runtime/autoload/netrw.vim`æ–‡ä»¶ã€‚ç”¨è¿™ç§æ–¹æ³•æ‰“å¼€æ–‡ä»¶çœŸæ˜¯å¤ªæ–¹ä¾¿äº†ï¼Œä½ ä¸ç”¨è¾“å…¥æ–‡ä»¶çš„è·¯å¾„ï¼Œvimä¼šè‡ªåŠ¨åœ¨*path*é€‰é¡¹å®šä¹‰çš„è·¯å¾„ä¸­æœç´¢ã€‚ä¸è¿‡`find`å‘½ä»¤ä¹Ÿæœ‰ç¼ºé™·ï¼Œå¦‚æœä½ åªè®°å¾—æ–‡ä»¶åçš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆå°±æ²¡æœ‰åŠæ³•ç”¨findå‘½ä»¤æ‰“å¼€è¿™ä¸ªæ–‡ä»¶äº†ã€‚è€Œä¸”findå‘½ä»¤ä¹Ÿä¸å…è®¸ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ã€‚æ²¡å…³ç³»ï¼Œæˆ‘ä»¬è¿˜æœ‰æ›´å¥½çš„æ–¹æ³•æ¥æ‰“å¼€æ–‡ä»¶ï¼Œè¦ç”¨åˆ°Lookupfileæ’ä»¶ã€‚\n\n*path*é€‰é¡¹ä»‹ç»å®Œäº†ï¼Œè¿›å…¥æ­£é¢˜ï¼Œå¦‚ä½•æŠŠæœ¬é¡¹ç›®ç›¸å…³çš„é…ç½®ä¿å­˜èµ·æ¥ï¼Œä¸‹æ¬¡æ‰“å¼€æœ¬é¡¹ç›®æ—¶è‡ªåŠ¨æ¢å¤è¿™äº›é…ç½®å‘¢ï¼Ÿ\n\næˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•åšåˆ°è¿™ä¸€ç‚¹ã€‚\n\n## é¡¹ç›®ç›¸å…³çš„é…ç½®ä¿å­˜èµ·æ¥ï¼šæ–¹æ³•1\n\næˆ‘ä»¬åœ¨`~/src/vim90/`ç›®å½•ä¸‹å»ºç«‹ä¸€ä¸ªæ–‡ä»¶ï¼Œå‡å®šæ–‡ä»¶åä¸º`workspace.vim`ï¼Œæ–‡ä»¶å†…å®¹ä¸ºï¼š\n\n```\n\"set project path\nset path+=~/src/vim70/** \n```\n\nè¿™ä¸ªæ–‡ä»¶ä¸­ä¿å­˜äº†é¡¹ç›®ç›¸å…³çš„ä¿¡æ¯ï¼Œä¾‹å¦‚é€‰é¡¹å€¼ï¼Œé”®æ˜ å°„ï¼Œå‡½æ•°å®šä¹‰ï¼Œè‡ªåŠ¨å‘½ä»¤ï¼Œç­‰ç­‰ã€‚æˆ‘ä»¬çš„ä¾‹å­ä¸­åªå®šä¹‰çš„pathé€‰é¡¹ï¼Œæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨`set path=â€¦`è¯­å¥ï¼Œåœ¨vimæ‰‹å†Œä¸­å»ºè®®ä½¿ç”¨`set path+=â€¦`å’Œ`set path-=â€¦`æ ¼å¼ã€‚\n\næ¥ä¸‹æ¥ï¼Œåœ¨ä½ çš„vimrcæ–‡ä»¶ä¸­åŠ å…¥ä¸‹é¢çš„è¯­å¥ï¼š\n\n```\n\" execute project related configuration in current directory\nif filereadable(\"workspace.vim\")\n    source workspace.vim\nendif\n```\n\nä»¥åï¼Œæ¯æ¬¡åœ¨`~/src/vim90/`ç›®å½•ä¸­å¯åŠ¨vimæ—¶ï¼Œviméƒ½ä¼šè‡ªåŠ¨è½½å…¥`workspace.vim`ï¼Œæ¢å¤é¡¹ç›®çš„é…ç½®ä¿¡æ¯ã€‚\n\n## æ–¹æ³•2\n\nå›é¡¾ä¼šè¯(session)å’Œviminfoçš„ä½œç”¨ã€‚ä½¿ç”¨sessionæ–‡ä»¶å’Œviminfoä¹Ÿå¯ä»¥ä¿å­˜é¡¹ç›®ç¯å¢ƒçš„æ–¹æ³•ã€‚å¦‚æœä½ ä½¿ç”¨äº†ä¼šè¯æ–‡ä»¶ï¼Œé‚£ä¹ˆé€‰é¡¹å€¼ï¼Œé”®æ˜ å°„ï¼Œå’Œå…¶å®ƒå¾ˆå¤šä¿¡æ¯éƒ½å·²ç»ä¿å­˜äº†ã€‚ä½†ä¼šè¯çš„åŠŸèƒ½æ¯•ç«Ÿæœ‰é™ï¼Œä¸èƒ½æŠŠé¡¹ç›®ç›¸å…³çš„é…ç½®å…¨éƒ¨ä¿å­˜ä¸‹æ¥ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ\n\nvimçš„ä½œè€…å·²ç»æƒ³åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œå¹¶æä¾›äº†è§£å†³åŠæ³•ã€‚\n\nåœ¨vimè½½å…¥ä¼šè¯æ–‡ä»¶çš„æœ€åä¸€æ­¥ï¼Œå®ƒä¼šæŸ¥æ‰¾ä¸€ä¸ªé¢å¤–çš„æ–‡ä»¶å¹¶æ‰§è¡Œå…¶ä¸­çš„exå‘½ä»¤ã€‚æŸ¥æ‰¾çš„è§„åˆ™æ˜¯ï¼ŒæŠŠä¼šè¯æ–‡ä»¶åçš„åç¼€å»æ‰ï¼Œç„¶ååœ¨åé¢åŠ ä¸Š`x.vim`ã€‚å‡è®¾ä½ çš„ä¼šè¯æ–‡ä»¶åä¸º`example.session`ï¼Œvimå°±ä¼šæŸ¥æ‰¾æ˜¯å¦æœ‰`examplex.vim`ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œå°±ä¼šæ‰§è¡Œæ­¤æ–‡ä»¶ä¸­çš„exå‘½ä»¤ã€‚\n\nå¥½äº†ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºæˆ‘ä»¬çš„ä¼šè¯æ–‡ä»¶ï¼š\n\n```\n:cd ~/src/vim70\n:set sessionoptions-=curdir        'åœ¨session optionä¸­å»æ‰curdir\n:set sessionoptions+=sesdir        'åœ¨session optionä¸­åŠ å…¥sesdir\n:mksession vim70s.vim              'åˆ›å»ºä¸€ä¸ªä¼šè¯æ–‡ä»¶ \n```\n\nç„¶åå†ç¼–è¾‘ä¸€ä¸ªåä¸º~/src/vim70/vim70sx.vimçš„æ–‡ä»¶ï¼Œæ–‡ä»¶çš„å†…å®¹ä¸ºï¼ˆå½“ç„¶ï¼Œä½ å¯ä»¥åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­åŠ å…¥æ›´å¤šå†…å®¹ï¼‰ï¼š\n\n```\n\"set project path\nset path+=~/src/vim70/** \n```\n\né€€å‡ºvimåï¼Œåœ¨å‘½ä»¤è¡Œä¸‹æ‰§è¡Œâ€gvim &â€ï¼Œå†æ¬¡è¿›å…¥vimï¼Œè¿™æ—¶çœ‹åˆ°çš„æ˜¯ä¸€ä¸ªç©ºç™½çª—å£ã€‚ç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š\n\n```\n:source ~/src/vim70/vim70s.vim  'è½½å…¥ä¼šè¯æ–‡ä»¶ \n```\n\nå¤ªæ£’äº†ï¼åŸæ¥çš„ä¼šè¯ç¯å¢ƒå·²ç»æ¢å¤ï¼Œå¹¶ä¸”é¡¹ç›®ç›¸å…³çš„é…ç½®ä¹Ÿè®¾ç½®å¥½äº†ï¼\n","categories":["Linux","vim"]},{"title":"Linux_å¿˜è®°rootå¯†ç ","url":"/Linux/Linux_å¿˜è®°rootå¯†ç /","content":"\n1. é‡å¯ubuntuç³»ç»Ÿï¼Œå¯åŠ¨æ—¶æŒç»­ç‚¹æŒ‰ESCï¼Œç›´åˆ°è¿›å…¥GRUBç•Œé¢ï¼Œé€‰æ‹©Advanced option for ubuntuï¼ŒæŒ‰ä¸‹å›è½¦é”®ã€‚\n   ![image-20220826170207222](../../images/Linux_å¿˜è®°rootå¯†ç /image-20220826170207222.png)\n2. é€‰æ‹©recovery modeï¼ŒæŒ‰å›è½¦ï¼Œè¿›å…¥Recovery Menuï¼Œé€‰æ‹©\"Root Drop to root shell prompt\"ï¼‰\n3. è¿›å…¥shellç•Œé¢ï¼Œä½¿ç”¨`passwd`å‘½ä»¤é‡æ–°è®¾å®šå¯†ç ï¼š`password root`ï¼Œå›è½¦ç¡®è®¤ã€‚\n4. è¾“å…¥æ–°å¯†ç ï¼Œä¸¤æ¬¡ã€‚\n5. sudo rebootï¼Œé‡å¯ç³»ç»Ÿè¿›å…¥GUIç•Œé¢ã€‚\n\n>å¯èƒ½ä¼šåœ¨å…¶ä¸­å¾ˆæœ‰å¯èƒ½ä¼šå‡ºç°â€Authentication token manipulation errorâ€œçš„é”™è¯¯ã€‚åˆ«å…ˆæ‰§è¡Œâ€`mount -rw -o remount /`â€œï¼Œç„¶åå†æ‰§è¡Œç¬¬3æ­¥å°±å¯ä»¥äº†ã€‚\n","categories":["Linux"]},{"title":"Linux_æŒ‚è½½","url":"/Linux/Linux_æŒ‚è½½/","content":"# Unix æŒ‚è½½å…‰ç›˜\nVMware - è™šæ‹Ÿæœºè®¾ç½®ï¼š\n![](../../images/Linux_æŒ‚è½½/image-20250716174155893.png)\n\nåœ¨æ ¹ç›®å½•ä¸‹çš„devä¸­ï¼š`/dev/`ï¼ˆdevä»£è¡¨è®¾å¤‡ï¼‰\n![](../../images/Linux_æŒ‚è½½/image-20250716174257622.png)\nå¯ä»¥çœ‹åˆ°ä¸€ä¸ªiso9660çš„ç›®å½•ã€‚è¿™æ˜¯å…‰ç›˜è®¾å¤‡åœ¨Unixç³»ç»Ÿä¸Šçš„å­˜åœ¨å½¢å¼ã€‚\n![](../../images/Linux_æŒ‚è½½/image-20250716174340480.png)\nè¿›å…¥ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„å…‰ç›˜å†…å®¹åç§°`Regular Expression`å·²ç»åˆ—åœ¨å…¶ä¸­ã€‚\n![](../../images/Linux_æŒ‚è½½/image-20250716174436888.png)\næ˜¯cï¼Œä»£è¡¨å­—ç¬¦å½¢å¼çš„æ–‡ä»¶ã€‚ï¼ˆå­—ç¬¦ç±»æ–‡ä»¶ä»£è¡¨å¯ä»¥åƒæ–‡ä»¶æµä¸€æ ·è¯»å–ï¼‰\n\nå®ƒå®é™…åªæ˜¯ä¸€ä¸ªé©±åŠ¨å™¨ï¼Œéœ€è¦æŠŠå®ƒæŒ‚è½½åˆ°ç³»ç»Ÿçš„ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ã€‚\nä½¿ç”¨mountæŒ‡ä»¤ï¼ŒæŠŠå®ƒæŒ‚è½½åˆ°`/mnt`ä¸‹ã€‚\n```sh\nmount -t cd9660 /dev/iso9660/REGULAR%20EXPRESSION /mnt\n```\n![](../../images/Linux_æŒ‚è½½/image-20250716174812838.png)\n![](../../images/Linux_æŒ‚è½½/image-20250716174848207.png)\n\nç°åœ¨è¿›å…¥`/mnt`ï¼Œå¯ä»¥çœ‹åˆ°å…‰ç›˜å†…å®é™…çš„æ–‡ä»¶äº†ã€‚\n\n# VirtualBox\n\nä¸‹æŒ‚è½½å…±äº«æ–‡ä»¶å¤¹\nå‚è€ƒï¼šhttps://blog.csdn.net/qq_33827423/article/details/126019729\n\n1. åœ¨Windowsä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹æ–¹ä¾¿ä½œä¸ºä¸€ä¸ª**å…±äº«ç›®å½•**ï¼Œç›®å½•åéšæ„ï¼Œä½†å°½é‡æ–¹ä¾¿è‡ªå·±è¾¨è¯†ã€‚\n2. VirtualBoxè™šæ‹Ÿæœºå…±äº«æ–‡ä»¶å¤¹çš„è®¾ç½®ï¼š\n   1. é€‰ä¸­éœ€è¦å»ºç«‹å…±äº«çš„è™šæ‹Ÿæœºå¹¶æ‰“å¼€`è®¾ç½®-å…±äº«æ–‡ä»¶å¤¹`\n      ![image-20220826171144159](../../images/Linux_VirtualBoxä¸‹æŒ‚è½½å…±äº«æ–‡ä»¶å¤¹/image-20220826171144159.png)\n   2. æ·»åŠ å…±äº«æ–‡ä»¶å¤¹\n      ![image-20220826171356245](../../images/Linux_VirtualBoxä¸‹æŒ‚è½½å…±äº«æ–‡ä»¶å¤¹/image-20220826171356245-1706720450168-1.png)\n","categories":["Linux"]},{"title":"è®¡ç®—æœºçŸ¥è¯†ä½“ç³»2022_0827","url":"/è®¡ç®—æœºçŸ¥è¯†ä½“ç³»/è®¡ç®—æœºçŸ¥è¯†ä½“ç³»2022_0827/","content":"# ä¸€æ®µä»£ç \n\n```cpp\nint gdata1 = 10;\nint gdata2 = 0;\nint gdata3;\n\nstatic int gdata4 = 11;\nstatic int gdata5 = 0;\nstatic int gdata6;\n\nint main()\n{\n    int a = 12;\n    int b = 0;\n    int c;\n    \n    static int d = 13;\n    static int e = 0;\n    static int f;\n    \n    return 0;\n}\n```\n\nä»¥ä¸Šï¼Œæœ‰è‹¥å¹²å˜é‡ã€‚\n\næœ‰å…¨å±€å˜é‡ã€é™æ€å…¨å±€å˜é‡ï¼Œæœ‰å±€éƒ¨å˜é‡ã€é™æ€å±€éƒ¨å˜é‡ã€‚\n\n# ä»£ç å’Œç¨‹åºçš„å…³ç³»\n\n1. ä»»ä½•è¯­è¨€ä»£ç äº§ç”Ÿçš„ç¨‹åºï¼Œæ— éæ˜¯äº§ç”Ÿäº†ä¸¤ç§ä¸œè¥¿ã€‚â€”â€”æŒ‡ä»¤ã€æ•°æ®ã€‚ç¨‹åºå‘˜åº”è¯¥å¯¹è‡ªå·±å†™çš„ä»£ç äº†è§£æ¸…æ¥šï¼Œå“ªäº›æ˜¯æ•°æ®ï¼Œå“ªäº›æ˜¯æŒ‡ä»¤ã€‚\n2. æŒ‡ä»¤å’Œæ•°æ®åŠ è½½åˆ°å†…å­˜ä¹‹åï¼Œè‚¯å®šè¦åŒºåˆ†åŒºåŸŸï¼Œæ€ä¹ˆåˆ’åˆ†ï¼Ÿ\n\n## è®¡ç®—æœºç»„æˆ\n\nä¸‰å¤§ä»¶ï¼šCPUã€å†…å­˜ã€I/Oï¼Œæ¯å®¶å‚å•†æœ‰æ¯å®¶ç‹¬è‡ªçš„äº§å“å®ç°ã€‚\n\nä¸ºäº†åœ¨åº”ç”¨å±‚å±è”½ä¸åŒäº§å“çš„å·®å¼‚ï¼š\n\n1. IOçš„å±è”½æ˜¯VFSï¼ˆè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼‰åšçš„ã€‚\n2. å†…å­˜å’ŒIOä¸€èµ·ä½œä¸ºä¸€ä¸ªèµ„æºåˆ†é…çš„å•ä½ï¼Œç”¨è™šæ‹Ÿå­˜å‚¨å™¨ï¼ˆè™šæ‹Ÿå†…å­˜ï¼‰å±è”½ã€‚\n3. CPUã€å†…å­˜ã€IOä¸€èµ·ä½œä¸ºä¸€ä¸ªèµ„æºè°ƒåº¦çš„å•ä½ï¼Œç”¨è¿›ç¨‹æ¥å±è”½ã€‚\n\nå› æ­¤ï¼Œæˆ‘ä»¬å†™çš„ç¨‹åºä»£ç æ˜¯ä¸å¯èƒ½ç›´æ¥åŠ è½½åˆ°ç‰©ç†å†…å­˜ä¸Šçš„ã€‚è€Œæ˜¯å…ˆåŠ è½½åˆ°è™šæ‹Ÿå†…å­˜ä¸Šã€‚\n\n## è™šæ‹Ÿå†…å­˜\n\nè™šæ‹Ÿçš„â€”â€”ä¸å­˜åœ¨ï¼Œå´çœ‹å¾—åˆ°ã€‚é‚£ä¹ˆè™šæ‹Ÿè¿™ä¸ªæ¦‚å¿µå®é™…ä¸Šæ˜¯ä¸å­˜åœ¨çš„ï¼Œåªæ˜¯é€»è¾‘å±‚æŠ½è±¡å‡ºæ¥çš„ã€‚\n\næ¯ä¸ªç¨‹åºè¿›è¡Œè¿è¡Œæ—¶ï¼Œç³»ç»Ÿéƒ½ä¼šç»™å…¶åˆ†é…è™šæ‹Ÿå†…å­˜ã€‚ç„¶åç³»ç»Ÿå†…éƒ¨å†å»è‡ªåŠ¨ç®¡ç†å¤„ç†åº•å±‚çš„ç‰©ç†å†…å­˜ã€‚\n\nè™šæ‹Ÿå†…å­˜å¤§å°æœ‰å¤šå¤§ï¼Ÿå’Œç³»ç»Ÿçš„ä½æ•°æœ‰å…³ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸ºå’ŒCPUçš„ä½æ•°æœ‰å…³ã€‚CPUä½æ•°çš„å«ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ\n\n### ç³»ç»Ÿçš„ä½æ•°/CPUçš„ä½æ•°â€”â€”CPUä½æ•°!=åœ°å€æ€»çº¿ä½æ•°\n\nä½æ•°å¯ä»¥è¡¡é‡ä¸€ä¸ªCPUçš„è®¡ç®—èƒ½åŠ›ã€‚\n\nCPUä¸»è¦æ˜¯ç”¨æ¥è¿ç®—æ•°æ®ã€‚ä¸€å¥è¯æ¥è¯´**CPUçš„ä½æ•°ç­‰äºå®ƒä¸€æ¬¡æ€§å¯ä»¥è®¡ç®—çš„æ•°æ®çš„é•¿åº¦**ã€‚æ‰€ä»¥ï¼ŒCPUçš„ä½æ•°å®é™…ä¸ŠæŒ‡çš„æ˜¯CPUä¸­ALUï¼ˆç®—æœ¯é€»è¾‘å•å…ƒï¼‰çš„å®½åº¦ã€‚\n\nALUè¿ç®—çš„æ•°æ®ä»ä½•è€Œæ¥ï¼Ÿä»å¯„å­˜å™¨å“ªæ¥ï¼Œé‚£ä¹ˆå¯„å­˜å™¨çš„æ•°æ®ä»ä½•è€Œæ¥ï¼Ÿâ€”â€”æ•°æ®æ€»çº¿ã€‚æ‰€ä»¥ï¼ŒCPUçš„ä½æ•°=ALUå®½åº¦=æ•°æ®æ€»çº¿çš„æ¡æ•°\n\næ‰€ä»¥ï¼ŒCPUä½æ•°å‹æ ¹å’Œåœ°å€æ€»çº¿æ²¡å…³ç³»ï¼Œæ¯”å¦‚è¯´x86ä½“ç³»ä¸‹çš„16ä½CPUï¼Œå®ƒçš„æ•°æ®æ€»çº¿æ˜¯16ä½ï¼Œè€Œåœ°å€æ€»çº¿æ˜¯20ä½ï¼›8ä½CPUçš„æ•°æ®æ€»çº¿æ˜¯8ä½ï¼Œåœ°å€æ€»çº¿æ˜¯16ä½ã€‚\n\nè™šæ‹Ÿå†…å­˜æœ‰å¤šå¤§ï¼Ÿå’Œåœ°å€æ€»çº¿æ•°æœ‰å…³ï¼Œä»£è¡¨CPUçš„å¯å¯»å€èƒ½åŠ›ï¼Œå‡å¦‚CPUæœ‰32æ¡åœ°å€æ€»çº¿ï¼Œé‚£ä¹ˆè¯¥CPUå¯å¯»å€$2^{32}$bitå³4Gã€‚æ¯ä¸ªç¨‹åºéƒ½ä¼šæœ‰4Gçš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚ä½†æ˜¯è¦æ³¨æ„ï¼ŒCPUä½æ•°ä¸ä¸€å®šç­‰äºåœ°å€æ€»çº¿æ¡æ•°ï¼æ¯”å¦‚8086ï¼Œæ˜¯16ä½CPUï¼Œä½†æ˜¯åœ°å€æ€»çº¿æœ‰20æ¡ï¼Œæ‰€ä»¥å¯å¯»å€èƒ½åŠ›æ˜¯$2^{20}=1MB$ã€‚\n\næ€»ç»“ï¼š\n\n1. CPUä½æ•°è¡¨ç¤ºALUå®½åº¦ï¼ˆæ•°æ®æ€»çº¿æ¡æ•°ï¼‰ã€‚æ‰€ä»¥è¦è¯´CPUæ˜¯å¤šå°‘ä½ç”±ALUå®½åº¦ï¼ˆæ•°æ®æ€»çº¿æ¡æ•°ï¼‰å†³å®šã€‚\n2. CPUå¯å¯»å€èƒ½åŠ›ç”±CPUèŠ¯ç‰‡ä¸Šçš„åœ°å€æ€»çº¿æ¡æ•°å†³å®šã€‚\n3. CPUåœ°å€æ€»çº¿æ¡æ•°ä¸ç­‰äºCPUä½æ•°ã€‚\n\n### ç¨‹åºè™šæ‹Ÿåœ°å€ç©ºé—´çš„å¸ƒå±€\n\nç•¥ï¼Œè§â€œè¿›ç¨‹åœ°å€ç©ºé—´ä½“ç³»â€ä¸€æ–‡ã€‚\n\n# ä»ç¼–è¯‘åˆ°é“¾æ¥--ä»objåˆ°å¯æ‰§è¡Œæ–‡ä»¶\n\n32ä½ç³»ç»Ÿä¸‹ï¼Œobjæ–‡ä»¶çš„åœ°å€æ˜¯æŒ‰4å­—èŠ‚å¯¹é½çš„ã€‚\n\nå¯æ‰§è¡Œæ–‡ä»¶æ˜¯æŒ‰ç…§é¡µé¢å¯¹é½çš„ï¼Œä¸€é¡µçš„é»˜è®¤å¤§å°æ˜¯4096Byteï¼Œå³4KBã€‚\n\n## ç¬¬ä¸€æ­¥ï¼šåˆå¹¶ã€è°ƒæ•´\n\n### åˆå¹¶ç›¸åŒåå­—çš„æ®µï¼Ÿ\n\nå¤šä¸ªobjæ–‡ä»¶åœ¨è¿›è¡Œé“¾æ¥æ—¶ï¼Œç¬¬ä¸€æ­¥ï¼Œåˆå¹¶æ¯ä¸€ä¸ªobjæ–‡ä»¶ç›¸åŒçš„æ®µã€‚è¿™æ ·æœ‰åˆ©äºå……åˆ†åˆ©ç”¨æ¯1é¡µæ¥å­˜å‚¨ä¿¡æ¯ã€‚\n\næ¯”å¦‚æœ‰3ä¸ªobjæ–‡ä»¶ï¼Œ3ä¸ªobjçš„textæ®µåˆå¹¶åœ¨ä¸€èµ·ï¼Œè‹¥ä¸è¶…è¿‡4KBï¼Œåˆ™å 1é¡µã€‚ç±»ä¼¼åœ°ï¼Œdataæ®µã€bssæ®µä¹Ÿåˆå¹¶å¹¶ä¸”å„è‡ªå ç‹¬ç«‹çš„é¡µé¢ã€‚\n\nå³ï¼Œå¯æ‰§è¡Œæ–‡ä»¶çš„é¡µé¢æ˜¯æŒ‰ä¸åŒæ®µæ¥åˆ’åˆ†çš„ï¼Œæ¯ä¸€é¡µä¸Šéƒ½æœ‰å…¨éƒ¨çš„objçš„åŒä¸€ä¸ªæ®µã€‚\n\n### ä¼˜åŒ–ï¼šåˆå¹¶ç›¸åŒæƒé™å±æ€§çš„æ®µ\n\nå…¶å®ï¼Œå¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œå³æŒ‰ç…§ç›¸åŒçš„æƒé™å±æ€§å»åˆ’åˆ†é¡µã€‚æ¯”å¦‚åªè¯»æ•°æ®ã€å¯è¯»å¯å†™æ•°æ®ã€å¯è¯»å¯æ‰§è¡Œç­‰ç­‰ã€‚\n\nåªè¯»æ•°æ®æ¯”å¦‚è¯´ï¼šå¸¸é‡å­—ç¬¦ä¸²å°±å­˜åœ¨äº`.rodata`æ®µï¼›å¦å¤–ä»£ç æ®µä¹Ÿæ˜¯åªè¯»çš„ã€‚æ‰€ä»¥å¯ä»¥æŠŠè¿™ä¸¤è€…å­˜åœ¨åŒä¸€é¡µä¸­ã€‚\n\nå¯è¯»å¯å†™æ•°æ®æ¯”å¦‚è¯´ï¼šdataæ®µå’Œbssæ®µåˆå¹¶ï¼Œè¿™æ ·å°±èŠ‚çœäº†ä¸€ä¸ªé¡µé¢çš„ç©ºé—´ã€‚\n\nå› æ­¤ï¼Œ**é“¾æ¥çš„ç¬¬ä¸€æ­¥ï¼šæ‰€æœ‰ç›¸åŒå±æ€§çš„æ®µè¿›è¡Œåˆå¹¶ï¼Œç»„ç»‡åœ¨åŒä¸€ä¸ªé¡µé¢ä¸Š**ã€‚\n\n### è°ƒæ•´æ®µè¡¨ä¸­æ¯ä¸€ä¸ªæ®µçš„èµ·å§‹åç§»é‡å’Œæ®µçš„å¤§å°\n\nå› ä¸ºæ®µè¿›è¡Œäº†åˆå¹¶ï¼Œå› æ­¤éœ€è¦è°ƒæ•´æ®µçš„èµ·å§‹åç§»é‡ã€‚\n\n### åˆå¹¶ç¬¦å·è¡¨\n\næ¯ä¸€ä¸ªobjæ–‡ä»¶éƒ½æœ‰ç¬¦å·è¡¨ï¼Œç¬¦å·è¡¨ä¹Ÿè¦åˆå¹¶ã€‚\n\n### è¿›è¡Œç¬¦å·è§£æ\n\næ‰€æœ‰objç¬¦å·è¡¨ä¸­å¯¹ç¬¦å·å¼•ç”¨çš„åœ°æ–¹éƒ½è¦æ‰¾åˆ°è¯¥ç¬¦å·åœ¨å“ªé‡Œã€å“ªä¸ªæ–‡ä»¶ä¸­å®šä¹‰ï¼Ÿ\n\nä¹Ÿæ˜¯åœ¨æ­¤æ­¥ï¼Œè¿›è¡Œå¼ºå¼±ç¬¦å·ã€ç¬¦å·é‡å®šä¹‰çš„åˆ¤åˆ«ã€å†³ç­–ã€‚\n\n### åˆ†é…å†…å­˜åœ°å€\n\nä¹‹å‰objç¬¦å·è¡¨ä¸­å¯¹ç¬¦å·å¼•ç”¨çš„åœ°æ–¹çš„åœ°å€æ˜¯ç©ºçš„ï¼Œå¾…å¡«ï¼Œç°åœ¨è¦åˆ†é…å…¶åœ°å€ã€‚å¾—åˆ°åˆæ³•çš„è™šæ‹Ÿç©ºé—´çš„åœ°å€ã€‚\n\n## ç¬¬äºŒæ­¥ï¼šé“¾æ¥çš„æ ¸å¿ƒâ€”â€”ç¬¦å·çš„é‡å®šä½\n\nå·²ç»åšå¥½äº†ç¬¦å·è§£æã€å†…å­˜åœ°å€çš„åˆ†é…ï¼Œç°åœ¨è¦æ›´æ–°ä¹‹å‰ç¬¦å·åœ°å€é”™è¯¯ã€å¾…å¡«çš„åœ°å€ä¿¡æ¯ã€‚å³**åœ¨æŒ‡ä»¤æ®µé‡ŒæŠŠæ²¡å¡«çš„åœ°å€ä¿®æ”¹ä¸ºæ­£ç¡®çš„åœ°å€**ã€‚\n\n# å¯æ‰§è¡Œæ–‡ä»¶çš„æ ¼å¼\n\nè§‚å¯Ÿå¯æ‰§è¡Œæ–‡ä»¶å…¶ELF Headerï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªEntry point addresså±æ€§ï¼Œå­˜å‚¨äº†ç¨‹åºçš„å…¥å£åœ°å€ï¼Œé€šå¸¸æ˜¯mainå‡½æ•°åœ°å€ã€‚\n\nå…¶æ¬¡ï¼Œç›¸æ¯”objæ–‡ä»¶ï¼Œå…¶å¤šäº†ä¸€ä¸ªæ¨¡å—æ˜¯program headersã€‚\n\nè€Œä¸”program headeræœ‰å¾ˆå¤šä¸ªï¼Œæ¯”å¦‚ï¼Œè¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶æœ‰3ä¸ªprogram headerã€‚\n\n```\n# readelf -l <å¯æ‰§è¡Œæ–‡ä»¶å>\nProgram Headers:\n  Type      Offset      VirtAddr    PhysAddr    FileSiz MemSiz  Flg Align\n  LOAD      0x000000    0x08048000  0x08048000  0x000e2 0x00028\tR E\t0x1000\n  LOAD      0x0000e4    0x080490e4  0x080490e4  0x00010 0x00028 RW  0x1000\n  GNU_STACK 0x000000    0x00000000  0x00000000  0x00000 0x00000 RW  0x4\n  \n Section to Segment mapping:\n  Segment Sections...\n   00     .text\n   01     ,data .bss\n   02\n   \n```\n\nä¸¤ä¸ªLoadç±»å‹çš„headerçš„Alignæ˜¯0x1000ï¼Œè¯´æ˜å…¶å¯¹é½æ–¹å¼æ˜¯4KBï¼Œä¸€é¡µã€‚\n\næ²¡æœ‰è¿™ä¸¤ä¸ªLOADé¡µæ“ä½œç³»ç»Ÿå°†ä¸çŸ¥é“è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶å¦‚ä½•æ‰§è¡Œã€‚\n\nä¸‹é¢çš„Section to Segment mappingè¯´çš„æ˜¯æ¯ä¸€ä¸ªheaderé‡Œé¢å¯¹åº”ã€åŒ…å«ç€å“ªäº›æ®µã€‚\n\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸€ä¸ªè¯´çš„æ˜¯LOAD1ï¼ŒåŒ…å«äº†.textæ®µï¼›ç¬¬äºŒä¸ªè¯´çš„æ˜¯LOAD2ï¼ŒåŒ…å«äº†.dataå’Œ.bssæ®µï¼›\n\nåŒæ—¶å¯ä»¥åœ¨Flgå±æ€§çœ‹åˆ°ï¼Œç¬¬ä¸€ä¸ªLOADæ˜¯REï¼Œä»£è¡¨å¯è¯»ã€å¯æ‰§è¡Œï¼›ç¬¬äºŒä¸ªLOADæ˜¯RWï¼Œå¯è¯»å¯å†™ã€‚ä¹Ÿè¯å®äº†ï¼Œå¯æ‰§è¡Œæ–‡ä»¶çš„é¡µé¢æ˜¯æŒ‰ç…§ä¹‹å‰objæ–‡ä»¶ä¸­ç›¸åŒå±æ€§çš„æ®µæ¥åˆå¹¶åˆ°ä¸€é¡µçš„ã€‚\n\nprogram headersåŒ…å«çš„è¿™ä¸¤ä¸ªLOADé¡µæŒ‡ç¤ºäº†æ“ä½œç³»ç»Ÿï¼Œè¦æŠŠå“ªäº›ä¸œè¥¿åŠ è½½åˆ°å†…å­˜ä¸Šã€‚è¿™æ˜¯å¯æ‰§è¡Œæ–‡ä»¶å’Œä¸å¯æ‰§è¡Œæ–‡ä»¶çš„æœ¬è´¨åŒºåˆ«ã€‚\n\n# å¯æ‰§è¡Œæ–‡ä»¶åŠ è½½/æ˜ å°„åˆ°è™šæ‹Ÿåœ°å€ç©ºé—´\n\nå¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„LOADé¡µï¼Œè™šæ‹Ÿåœ°å€ç©ºé—´éƒ½æ˜¯æŒ‰é¡µåˆ’åˆ†çš„ã€‚\n\nå¯æ‰§è¡Œæ–‡ä»¶åŠ è½½/æ˜ å°„åˆ°è™šæ‹Ÿåœ°å€ç©ºé—´è¿™ä¸ªè¿‡ç¨‹æ˜¯mmapã€‚æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿç¬¬9ç« ã€‚\n\n# è™šæ‹Ÿåœ°å€ç©ºé—´åŠ è½½/æ˜ å°„åˆ°ç‰©ç†å†…å­˜\n\nç‰©ç†å†…å­˜ä¹Ÿæ˜¯æŒ‰é¡µé¢åˆ’åˆ†çš„ã€‚\n\nè™šæ‹Ÿåœ°å€ç©ºé—´åŠ è½½/æ˜ å°„åˆ°ç‰©ç†å†…å­˜â€”â€”å¤šçº§é¡µè¡¨æ˜ å°„æ–¹å¼å®ç°ã€‚\n\n# ç¨‹åºçš„è¿è¡Œ\n\n1. åˆ›å»ºè™šæ‹Ÿåœ°å€ç©ºé—´åˆ°ç‰©ç†å†…å­˜çš„æ˜ å°„ï¼ˆåˆ›å»ºå†…æ ¸åœ°å€æ˜ å°„ç»“æ„ä½“ï¼‰ï¼Œåˆ›å»ºé¡µç›®å½•å’Œé¡µè¡¨ã€‚\n2. åŠ è½½ä»£ç æ®µå’Œæ•°æ®æ®µã€‚\n3. æŠŠå¯æ‰§è¡Œæ–‡ä»¶çš„å…¥å£åœ°å€å†™å…¥CPUå¯„å­˜å™¨ä¸­ã€‚\n\nå¯ä»¥æ‰§è¡Œ`strace <å¯æ‰§è¡Œæ–‡ä»¶å>`æŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶è¿è¡Œåæ‰€åšçš„åŠ¨ä½œã€‚\n\n![image-20220828091756955](../../images/è®¡ç®—æœºçŸ¥è¯†ä½“ç³»2022_0827/image-20220828091756955.png)\n\nå¯ä»¥çœ‹åˆ°ï¼Œæ‰§è¡Œäº†execveï¼Œå¯æƒ³è€ŒçŸ¥å’Œæˆ‘ä»¬çš„å¸¸è¯†ç›¸ç¬¦ï¼Œä¸€ä¸ªæ–°çš„ç¨‹åºè¦æ‰§è¡Œï¼Œé¦–å…ˆè¦forkï¼Œä¹‹åå†execæ›¿æ¢è¿›ç¨‹åœ°å€ç©ºé—´ã€‚\n\nä¹‹åï¼Œè¿›è¡Œè‹¥å¹²æ¬¡mmapã€‚å³å®Œæˆå¯æ‰§è¡Œæ–‡ä»¶LOADé¡µåŠ è½½åˆ°è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚\n\nå†ä¹‹åï¼Œæœ€ç»ˆç¨‹åºè‚¯å®šæ˜¯è¦è·‘åˆ°ç‰©ç†å†…å­˜ä¸Šè¿è¡Œçš„ï¼Œå°šéœ€å®Œæˆè™šæ‹Ÿåœ°å€ç©ºé—´åˆ°ç‰©ç†å†…å­˜ç©ºé—´çš„æ˜ å°„ã€‚--è¯·è§â€œLinux_åœ°å€æ˜ å°„â€ä¸€æ–‡ã€‚\n\n# ç›¸å…³ä¹¦ç±\n\n1. ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»1ã€2ã€3ã€4ã€6ã€10ç« ï¼›\n2. æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ5ã€6ã€7ã€8ã€9ç« ã€‚\n3. ç°ä»£æ“ä½œç³»ç»Ÿ/æ“ä½œç³»ç»Ÿç²¾é«“ä¸è®¾è®¡åŸç†\n\n* è™šæ‹Ÿå†…å­˜\n* è¿›ç¨‹ç®¡ç†ä»¥åŠé€šä¿¡\n* ç½‘ç»œ\n* è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ\n","categories":["è®¡ç®—æœºçŸ¥è¯†ä½“ç³»"]},{"title":"Android_è¿œç¨‹æŠ“å–è®¾å¤‡ä¿¡æ¯ä¸ŠæŠ¥æœåŠ¡","url":"/Android/Android_è¿œç¨‹æŠ“å–è®¾å¤‡ä¿¡æ¯ä¸ŠæŠ¥æœåŠ¡/","content":"\n# éœ€æ±‚\n\nè¿œç¨‹è¯Šæ–­ï¼Œè¯Šæ–­ä¿¡æ¯åŒ…æ‹¬åŸºç¡€ç³»ç»Ÿä¿¡æ¯ã€ç¡¬ä»¶ä¿¡æ¯ã€å®¹é‡ä¿¡æ¯ã€ç½‘ç»œä¿¡æ¯ç­‰ï¼Œå…¼å®¹æ—§å¹³å°è¿œç¨‹è¯Šæ–­é€»è¾‘å’Œæ—§ç‰ˆæœ¬å›ºä»¶ã€‚\n\nå‰ç«¯æ¨¡æ‹Ÿæ•ˆæœï¼š\n\n![image-20220825152733320](../../images/Android_è®¾å¤‡ä¿¡æ¯æŠ“å–/image-20220825152733320.png)\n\n| è¿œç¨‹è¯Šæ–­å±æ€§                    | å¤‡æ³¨                                                         |\n| ------------------------------- | ------------------------------------------------------------ |\n| å…‰çº¿ä¼ æ„Ÿå™¨                      | å½“å‰æ•°å€¼ï¼Œæˆ–å¼‚å¸¸                                             |\n| è‰²æ¸©ä¼ æ„Ÿå™¨                      | å½“å‰æ•°å€¼ï¼Œæˆ–å¼‚å¸¸                                             |\n| é‡åŠ›ä¼ æ„Ÿå™¨                      | å½“å‰æ•°å€¼ï¼ˆxï¼Œyï¼Œzï¼‰ï¼Œæˆ–å¼‚å¸¸                                  |\n| éº¦å…‹é£                          | æ­£å¸¸æˆ–å¼‚å¸¸                                                   |\n| DNS                             | å¯èƒ½æœ‰å¤šä¸ªåœ°å€ã€‚                                             |\n| ç½‘ç»œè¯Šæ–­æ¨¡å— - æŠ–åŠ¨ã€ä¸¢åŒ…ã€å»¶æ—¶ | å¯èƒ½éœ€è¦å‚è€ƒå¤šä¸ªåœ°å€ï¼Œå¦‚æœåªæŒ‰å¸Œæ²ƒåå°æ¥è¯Šæ–­ï¼Œåˆ™ä¸èƒ½åˆ¤æ–­ç¬¬ä¸‰æ–¹æ˜¯å¦æœ‰é—®é¢˜ |\n| ç½‘ç»œè¯Šæ–­æ¨¡å— - å½“å‰å±€åŸŸç½‘è®¾å¤‡æ•° | è·å–å±€åŸŸç½‘å…¶ä»–è®¾å¤‡æ•°å¯èƒ½ä¸å…·æœ‰å‚è€ƒä»·å€¼ï¼Œé‡ç‚¹éœ€è¦åˆ¤æ–­è®¾å¤‡æœ¬èº«çš„ç½‘ç»œæƒ…å†µ |\n\n# è®¾å¤‡ç«¯ä¸»è¦ä»»åŠ¡\n\n1. ç³»ç»Ÿç‰ˆæœ¬\n2. è·å–æ—¶é—´\n   1. ç³»ç»Ÿå½“å‰æ—¶é—´\n   2. å·²è¿è¡Œæ—¶é—´\n   3. ä¸Šæ¬¡å¯åŠ¨æ—¶é—´ï¼Œæ— ç›´æ¥è·å–çš„APIï¼Œç³»ç»Ÿå½“å‰æ—¶é—´å‡å»å·²è¿è¡Œæ—¶é—´å³å¯ã€‚\n3. æ„ŸçŸ¥çŠ¶æ€\n   1. ä¸‰ä¸ªä¼ æ„Ÿå™¨ï¼Œå¼‚æ­¥è·å–å…¶å³æ—¶å€¼ã€‚\n   2. éº¦å…‹é£çŠ¶æ€ï¼Œå¼‚æ­¥æ£€æµ‹ã€‚\n4. ç¡¬ä»¶è´Ÿè½½\n   1. CPUè´Ÿè½½è®¡ç®—\n   2. å†…å­˜ã€ç¡¬ç›˜çŠ¶æ€ä¿¡æ¯è·å–\n5. ç½‘å¡ä¿¡æ¯è·å–\n   1. å†…ç½‘IPåœ°å€\n   2. å­ç½‘æ©ç \n   3. MACåœ°å€\n   4. DNSé…ç½®åœ°å€\n6. å¤–ç½‘ä¿¡æ¯\n   1. å¤–ç½‘IPåœ°å€\n   2. è¿è¥å•†åç§°\n\n# é“¾è·¯\n\nè®¾å¤‡ç«¯æœåŠ¡ç¨‹åºå¸¸è¿è¡Œï¼Œç›‘å¬åç«¯IOTä¸‹å‘æŒ‡ä»¤ã€‚è®¾å¤‡è¿›è¡Œä¸€ç³»åˆ—ä¿¡æ¯æŠ“å–ã€ç¡¬ä»¶æ£€æŸ¥åï¼Œdoputä¸ŠæŠ¥ã€‚\n\n# æ¡†æ¶è®¾è®¡\n\n```kotlin\n/**\n * çº¦å®šåˆ†å‘è§„åˆ™ï¼š\n * æœåŠ¡ç±»å‹: key = method\n * å±æ€§ç±»å‹: key = thing.property.get#å±æ€§å æˆ–è€… thing.property.get#å±æ€§å\n */\nobject ExtHandlerManager : CoroutineScope {\n    override val coroutineContext: CoroutineContext\n        get() = Dispatchers.Default\n    private val serviceMap = hashMapOf<String, IServiceHandler>()\n    private val propertyMap = hashMapOf<String, IPropertyHandler>()\n    var iotClient: ICIoTClient? = null\n    \n    init {\n        //service\n        serviceMap[\"thing.service.sendDiagnosisFetchMinder\"] = SendDiagnosisFetchMinderHandler()\n    }\n    fun registerHandlers(manger: IHandlerManager?) {\n        manger?.apply {\n            for ((k, v) in serviceMap) {\n                registerServiceHandler(k, v)\n            }\n            for ((k, v) in propertyMap) {\n                registerPropertyHandler(k, v)\n            }\n            startHandle()\n        }\n    }\n\n    fun unregisterHandlers(manger: IHandlerManager?) {\n        manger?.apply {\n            for ((k, v) in serviceMap) {\n                unregisterServiceHandler(k, v)\n            }\n            for ((k, v) in propertyMap) {\n                unregisterPropertyHandler(k, v)\n            }\n        }\n    }\n}\n```\n\n## Handleræ¥å£\n\nIOTä¸‹å‘æŒ‡ä»¤ï¼Œå‘è®¾å¤‡è¯·æ±‚ã€‚è®¾å¤‡ç«¯æ”¶åˆ°è¯·æ±‚åï¼Œç”¨å¯¹åº”çš„handlerè¿›è¡Œè¯·æ±‚å‚æ•°çš„å¤„ç†ã€‚å³å®ç°onRequestæ–¹æ³•ã€‚å…¶ä¸­ï¼Œè¯·æ±‚å¯å¸¦å‚æ•°ï¼Œçº¦å®šä¸ºjsonä¸²ï¼Œå¯ä¸‹å‘ä¸€ä¸ªtaskUidï¼Œæ–¹ä¾¿åç»­è®¾å¤‡å‘é€å“åº”æ—¶å›ä¼ ã€‚\n\n```kotlin\ninterface IServiceHandler {\n    fun onRequest(topic: String?, method: String?, params: String?, traceId: String?)\n}\n```\n\næ¥åˆ°è¯·æ±‚åï¼Œå¯ä¸€ä¸ªRunnableçº¿ç¨‹ï¼Œçº¿ç¨‹å‡½æ•°é‡Œæ‰§è¡Œ`DiagnosisFetchListener().sendDiagnosisFetchMinder(taskUid)`ï¼Œå¼€å§‹è¿›è¡Œè®¾å¤‡ä¿¡æ¯çš„æŠ“å–å’Œè¯Šæ–­ï¼Œä¹‹åæ•´åˆä¸ºjsonä¸²åå“åº”ç»™IOTåå°ã€‚\n\n```kotlin\n/**\n * RemoteDetectSystemInfoHandler\n * @Author xingchenggong 2022/08/23\n */\nclass SendDiagnosisFetchMinderHandler : IServiceHandler, CoroutineScope {\n    private val TAG = \"SendDiagnosisFetchMinderHandler\"\n    override val coroutineContext: CoroutineContext\n        get() = Dispatchers.Default\n    private val handler = Handler(Looper.getMainLooper())\n\n    //{\n    //    \"uid\": \"text, 32å­—èŠ‚\"\n    //}\n    override fun onRequest(topic: String?, method: String?, params: String?, traceId: String?) {\n        Log.i(TAG, \">>> topic: $topic, method:$method, params:$params, traceId:$traceId\")\n        var taskUid: String? = null\n        if(!params.isNullOrEmpty()) {\n            taskUid = JSONObject(params).get(\"taskUid\") as String\n            val paramsAvailable = checkParamsAvailable(taskUid)\n        } else {\n            Log.e(TAG, \"DiagnosisFetch error, cause params is empty\")\n            return\n        }\n        try {\n            val diagnosisFetchInfo = Runnable { DiagnosisFetchListener().sendDiagnosisFetchMinder(taskUid) }\n            handler.post(diagnosisFetchInfo)\n        } catch (e: IllegalStateException) {\n            Log.e(TAG, \">>> onRequest:java.lang.IllegalStateException\")\n        }\n    }\n    private fun checkParamsAvailable(uid: String): Boolean {\n        var paramsAvailable = true\n        if(uid.isBlank()) {\n            Log.e(TAG, \"checkParamsAvailable failed, uid is empty\")\n            paramsAvailable = false\n        }\n        return paramsAvailable\n    }\n\n}\n```\n\n# è®¾å¤‡ä¿¡æ¯æŠ“å–å’Œè¯Šæ–­ä»¥åŠä¹‹åå“åº”åå°çš„å®ç°\n\n## æ•°æ®æ¨¡å‹\n\n```kotlin\ndata class DiagnosisReportInfo(\n    val taskUid: String,\n    val diagnosisResultBo: DiagnosisFetchInfo,\n    val taskStatus: Int\n)\ndata class OuterNetInfo(\n    val ip: String,         //å¤–ç½‘ip\n    val netOperator: String //å¤–ç½‘è¿è¥å•†\n)\ndata class InnerNetInfo(\n    val ip: String,         //å†…ç½‘ip\n    val subNetMask: String, //å­ç½‘æ©ç \n    val mac: String,        //ç½‘å¡åœ°å€\n    val dns: List<String>   //dns\n)\ndata class DiagnosisFetchInfo(\n    val version: String,\n    val systemTime: Long,\n    val lastStartTime: Long,\n    val runningTime: Long,\n    val lightSensorData: String,\n    val colorTemperatureSensorData: String,\n    val gravitySensorData: String,\n    val microphoneState: String,\n    val cpuInfo: Float,\n    val totalMemory: Float,\n    val usageMemory: Float,\n    val totalStorage: Float,\n    val usageStorage: Float,\n    val outerNetInfo: OuterNetInfo,\n    val innerNetInfoWifi: InnerNetInfo,\n    val innerNetInfoEth: InnerNetInfo\n)\n```\n\n## æ—¶é—´è·å–\n\n```kotlin\nimport android.os.SystemClock\n/**\n * @author: xingchenggong 2022/08/22\n */\nobject SystemTimeUtils {\n\n    fun getCurrentSystemTimestamp(): Long{\n        try {\n            return System.currentTimeMillis()\n        } catch (e: Exception) {\n            e.printStackTrace()\n        }\n        return 0\n    }\n    fun getElapsedTimeMillis(): Long {\n        try {\n            return SystemClock.elapsedRealtime()\n        } catch (e: Exception) {\n            e.printStackTrace()\n        }\n        return 0\n    }\n    fun getLastStartTimestamp(): Long {\n        var timestamp = getCurrentSystemTimestamp() - getElapsedTimeMillis()\n        return if(timestamp >= 0) {\n            timestamp\n        } else {\n            0\n        }\n    }\n}\n```\n\n## ä¼ æ„Ÿå™¨çŠ¶æ€è·å–\n\n```java\nimport android.content.Context;\nimport android.hardware.Sensor;\nimport android.hardware.SensorEvent;\nimport android.hardware.SensorEventListener;\nimport android.hardware.SensorManager;\nimport android.os.Handler;\nimport android.os.HandlerThread;\nimport android.os.Looper;\nimport android.os.Message;\n\nimport androidx.annotation.NonNull;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\npublic class SensorUtil {\n    private SensorResultCallback mSensorResultCallback;\n    private H mHandler;\n    private Looper mLooper;\n    private SensorManager mSensorManager = null;\n    private SensorEventListener mSensorEventListener;\n    private boolean mIsAlreadyGetResult = false;\n\n    private final static int MSG_GET_SENSOR_TIME_OUT = 100;\n    private final static int MSG_GET_SENSOR_NORMAL = 101;\n    private String mSensorName;\n    public SensorUtil(String name) {\n        mSensorName = name;\n    }\n\n    public Boolean startRegisterListener(Context context, int sensorType, SensorResultCallback callback) {\n        mSensorResultCallback = callback;\n        HandlerThread thread = new HandlerThread(mSensorName);\n        thread.start();\n        mLooper = thread.getLooper();\n        mHandler = new H(mLooper);\n\n        mSensorManager = (SensorManager) context.getSystemService(Context.SENSOR_SERVICE);\n        Sensor sensor = mSensorManager.getDefaultSensor(sensorType);\n\n        if (sensor == null) {\n            return false;\n        }\n\n        mSensorEventListener = new SensorEventListener() {\n            @Override\n            public void onSensorChanged(SensorEvent event) {\n                if (!mIsAlreadyGetResult) {\n                    mIsAlreadyGetResult = true;\n                    mHandler.removeMessages(MSG_GET_SENSOR_TIME_OUT);\n                    mHandler.removeMessages(MSG_GET_SENSOR_NORMAL);\n                    List<Float> result = new ArrayList<Float>(3);  //TODO get result\n                    int i = event.values.length;\n                    for (float val : event.values) {\n                        result.add(val);\n                    }\n                    mHandler.obtainMessage(MSG_GET_SENSOR_NORMAL, 0, 0, result).sendToTarget();\n                }\n            }\n\n            @Override\n            public void onAccuracyChanged(Sensor sensor, int accuracy) {\n\n            }\n        };\n\n        mSensorManager.registerListener(mSensorEventListener, sensor, SensorManager.SENSOR_DELAY_NORMAL);\n\n        mHandler.removeMessages(MSG_GET_SENSOR_TIME_OUT);\n        mHandler.sendEmptyMessageDelayed(MSG_GET_SENSOR_TIME_OUT, 5000);\n        return true;\n    }\n\n    private void stopListener() {\n        if (mSensorManager != null && mSensorEventListener != null) {\n            mSensorManager.unregisterListener(mSensorEventListener);\n        }\n\n        if (mLooper != null) {\n            mLooper.quitSafely();\n        }\n    }\n\n    public interface SensorResultCallback {\n        void onDataCallBack(List<Float> result);\n        void onGetDataTimeout();\n    }\n\n    private class H extends Handler {\n        private H() {\n            super();\n        }\n\n        private H(Looper looper) {\n            super(looper);\n        }\n\n        @Override\n        public void handleMessage(@NonNull Message msg) {\n            super.handleMessage(msg);\n\n            if (mSensorResultCallback == null) {\n                return;\n            }\n\n            switch (msg.what) {\n                case MSG_GET_SENSOR_NORMAL:\n                    mSensorResultCallback.onDataCallBack((List<Float>)msg.obj);\n                    break;\n                case MSG_GET_SENSOR_TIME_OUT:\n                    mSensorResultCallback.onGetDataTimeout();\n                    break;\n            }\n            stopListener();\n            mSensorResultCallback = null;\n        }\n    }\n}\n```\n\n## éº¦å…‹é£æ£€æµ‹\n\n```kotlin\nobject DeviceInfoUtils {\n    /**\n     * åˆ¤æ–­å½“å‰è®¾å¤‡æ˜¯å¦æ˜¯XX15\n     */\n    @JvmStatic\n    fun isXX15Model(): Boolean {\n        // XX15\n        return Build.MODEL.contains(\"XX15\")\n    }\n\n    /**\n     * åˆ¤æ–­å½“å‰è®¾å¤‡æ˜¯å¦æ˜¯XX02\n     */\n    @JvmStatic\n    fun isXX02Model(): Boolean {\n        // XX02\n        return Build.MODEL.contains(\"XX02\")\n    }\n}\n\nclass DetectMicUtils {\n    private val audioRecordTest by lazy {\n        AudioRecordTest()\n    }\n    private fun detectMic(): Boolean {\n        // ä¸åŒè®¾å¤‡å‹å·ä¸åŒçš„æ£€æµ‹æ–¹å¼\n        return if (DeviceInfoUtils.isXX15Model()) {\n            audioRecordTest.beginTest()\n        } else {\n            SystemPropertiesUtils.set(\"mic.hw.test.req\", \"1\")\n            Thread.sleep(2000L)\n            SystemPropertiesUtils.get(\"mic.hw.test.ret\", \"0\") == \"11\"\n        }\n    }\n    fun getMicState(): String {\n        return if (detectMic()) {\n            \"æ­£å¸¸\"\n        } else {\n            \"å¼‚å¸¸\"\n        }\n    }\n}\n```\n\n```kotlin\nimport android.media.AudioFormat\nimport android.media.AudioRecord\nimport android.media.MediaRecorder\n\nclass AudioRecordTest {\n\n    private val AUDIO_INPUT = MediaRecorder.AudioSource.VOICE_RECOGNITION\n    private val AUDIO_SAMPLE_RATE = 32000\n    private val AUDIO_CHANNEL = AudioFormat.CHANNEL_IN_MONO\n    private val AUDIO_ENCODING = AudioFormat.ENCODING_PCM_16BIT\n\n    private val MAX_ALLOW_DB_BETWEEN_VALUE = 5\n    private val MIN_DB_VALUE = 3 // åªæœ‰åº•å™ªæ—¶ä¼šæœ‰ 0 ~ 2dbå€¼\n    private var recordBufSize = 0\n\n    private lateinit var recordBuffer: ByteArray\n    private var mAudioRecord: AudioRecord? = null\n    private lateinit var recordBufferMic: ByteArray\n    private lateinit var recordBufferMic1: ByteArray\n    private lateinit var recordBufferMic2: ByteArray\n\n    private var isRecording = false\n    private var mErrorCounts = 0\n    private var mInValidDataCounts = 0\n    private var mValidDataCounts = 0\n\n    fun isRecordTesting():Boolean {\n        return isRecording\n    }\n\n    fun beginTest():Boolean {\n        var result = false\n\n        if (isRecording) {\n            return result\n        }\n\n        recordBufSize =\n            AudioRecord.getMinBufferSize(AUDIO_SAMPLE_RATE, AUDIO_CHANNEL, AUDIO_ENCODING)\n\n        mAudioRecord = AudioRecord(AUDIO_INPUT, AUDIO_SAMPLE_RATE, AUDIO_CHANNEL,\n            AUDIO_ENCODING, recordBufSize)\n\n        recordBuffer = ByteArray(recordBufSize)\n\n        if (recordBufSize % 4 == 0) {\n            recordBufferMic = ByteArray(recordBufSize / 2)\n            recordBufferMic1 = ByteArray(recordBufSize / 4)\n            recordBufferMic2 = ByteArray(recordBufSize / 4)\n        }\n\n        isRecording = true\n        mValidDataCounts = 0\n        mInValidDataCounts = 0\n        mErrorCounts = 0\n\n        mAudioRecord!!.startRecording()\n\n        while (isRecording) {\n            val read = mAudioRecord!!.read(recordBuffer, 0, recordBufSize)\n\n            if (read > AudioRecord.SUCCESS) {\n                try {\n                    var i = 0\n                    while (i + 7 < read) {\n                        var index = i / 2\n                        recordBufferMic[index] = recordBuffer[i]\n                        recordBufferMic[index + 1] = recordBuffer[i + 1]\n                        recordBufferMic[index + 2] = recordBuffer[i + 2]\n                        recordBufferMic[index + 3] = recordBuffer[i + 3]\n\n                        index /= 2\n\n                        recordBufferMic1[index] = recordBuffer[i]\n                        recordBufferMic1[index + 1] = recordBuffer[i + 1]\n\n                        recordBufferMic2[index] = recordBuffer[i + 2]\n                        recordBufferMic2[index + 1] = recordBuffer[i + 3]\n\n                        i += 8\n                    }\n\n                    val origDb = getPcmDB(recordBufferMic, read / 2) // è·å–åŸå§‹micçš„åˆ†è´å€¼\n                    val mic1Db = getPcmDB(recordBufferMic1, read / 4) // è·å–mic1çš„åˆ†è´å€¼\n                    val mic2Db = getPcmDB(recordBufferMic2, read / 4) // è·å–mic2çš„åˆ†è´å€¼\n\n                    if (origDb < 0 && mic1Db < 0 && mic2Db < 0) {\n                        if (++mInValidDataCounts >= 100) { // å¤§çº¦ 1s\n                            stopRecordTest()\n                            result = false\n                            break\n                        }\n                    } else if (Math.abs(origDb - mic1Db) >= MAX_ALLOW_DB_BETWEEN_VALUE\n                        || Math.abs(origDb - mic2Db) >= MAX_ALLOW_DB_BETWEEN_VALUE\n                        || mic1Db <= MIN_DB_VALUE && mic2Db <= MIN_DB_VALUE) {\n                        if (++mErrorCounts >= 10) {\n                            stopRecordTest()\n                            result = false\n                            break\n                        }\n                    } else {\n                        mInValidDataCounts = 0\n                        mErrorCounts = 0\n                        if (++mValidDataCounts >= 100) {\n                            stopRecordTest()\n                            result = true\n                        }\n                    }\n                } catch (e: Exception) {\n                    stopRecordTest()\n                    result = false\n                    e.printStackTrace()\n                }\n            } else if (read < AudioRecord.SUCCESS) {\n                stopRecordTest()\n                result = false\n            }\n        }\n\n        return result\n    }\n\n    private fun getPcmDB(pcmData: ByteArray, size: Int): Int {\n        var sum = 0.0\n        var temp: Long\n        var i = 0\n        while (i < pcmData.size) {\n            temp = (pcmData[i + 1].toLong() shl 8) or (pcmData[i].toLong() and 0x000000FF.toLong())\n            sum += Math.abs(temp).toDouble()\n            i += 2\n        }\n        return (20 * Math.log10(sum / size.toDouble())).toInt()\n    }\n\n    private fun stopRecordTest() {\n        if (!isRecording) {\n            return\n        }\n        isRecording = false\n        if (null != mAudioRecord) {\n            mAudioRecord!!.stop()\n            mAudioRecord!!.release()\n            mAudioRecord = null\n        }\n    }\n}\n```\n\n## ç¡¬ä»¶è´Ÿè½½æƒ…å†µ\n\n### CPUè´Ÿè½½\n\n```java\n    @SuppressLint({\"DefaultLocale\", \"LongLogTag\"})\n    public static float getCpuTotalUsageFloat() {\n        try {\n            double cpuIdleTimePre;\n            double cpuOccupiedTimePre;\n            double cpuIdleTimeCur;\n            double cpuOccupiedTimeCur;\n\n            ShellCommandUtils.CommandResult cpuInfoResult = ShellCommandUtils.executeCommand(\"cat /proc/stat | head -n 1\");\n            if (cpuInfoResult.result == 0) {\n                String line = cpuInfoResult.successMsg;\n                String[] cpuTimeSubInfo = line.split(\" \");\n                cpuIdleTimePre = Double.parseDouble(cpuTimeSubInfo[5]);//5:idle\n                cpuOccupiedTimePre = Double.parseDouble(cpuTimeSubInfo[2]) +//2:user\n                        Double.parseDouble(cpuTimeSubInfo[3]) +//3:nice\n                        Double.parseDouble(cpuTimeSubInfo[4]) +//4:system\n                        Double.parseDouble(cpuTimeSubInfo[6]) +//6:iowait\n                        Double.parseDouble(cpuTimeSubInfo[7]) +//7:irq\n                        Double.parseDouble(cpuTimeSubInfo[8]);//8:softirq\n            } else {\n                Log.e(TAG, \"getCpuTotalUsage: \" + cpuInfoResult.errorMsg);\n                return 0.0f;\n            }\n            try {\n                Thread.sleep(360);\n            } catch (Exception e) {\n                e.printStackTrace();\n            }\n\n            cpuInfoResult = ShellCommandUtils.executeCommand(\"cat /proc/stat | head -n 1\");\n            if (cpuInfoResult.result == 0) {\n                String line = cpuInfoResult.successMsg;\n                String[] cpuTimeSubInfo = line.split(\" \");\n                cpuIdleTimeCur = Double.parseDouble(cpuTimeSubInfo[5]);//5:idle\n                cpuOccupiedTimeCur = Double.parseDouble(cpuTimeSubInfo[2]) +//2:user\n                        Double.parseDouble(cpuTimeSubInfo[3]) +//3:nice\n                        Double.parseDouble(cpuTimeSubInfo[4]) +//4:system\n                        Double.parseDouble(cpuTimeSubInfo[6]) +//6:iowait\n                        Double.parseDouble(cpuTimeSubInfo[7]) +//7:irq\n                        Double.parseDouble(cpuTimeSubInfo[8]);//8:softirq\n            } else {\n                Log.e(TAG, \"getCpuTotalUsage: \" + cpuInfoResult.errorMsg);\n                return 0.0f;\n            }\n            double deltaCpuOccupiedTime = 100 * (cpuOccupiedTimeCur - cpuOccupiedTimePre);\n            double deltaCpuTotalTime = (cpuOccupiedTimeCur + cpuIdleTimeCur) -\n                    (cpuOccupiedTimePre + cpuIdleTimePre);\n            BigDecimal deltaCpuOccupiedTimeBigDecimal = new BigDecimal(deltaCpuOccupiedTime);\n            BigDecimal deltaCpuTotalTimeBigDecimal = new BigDecimal(deltaCpuTotalTime);\n            float cpuUsageIntValue = deltaCpuOccupiedTimeBigDecimal.divide(deltaCpuTotalTimeBigDecimal,\n                    BigDecimal.ROUND_HALF_UP).intValue();\n            return cpuUsageIntValue;\n        } catch (Exception e) {\n            e.printStackTrace();\n            Log.e(TAG, \"getCpuTotalUsage: \" + e.getMessage());\n        }\n        return 0.0f;\n    }\n```\n\n### è·å–å­˜å‚¨ä¿¡æ¯\n\n```kotlin\nimport android.annotation.SuppressLint\nimport android.app.ActivityManager\nimport android.content.Context\nimport android.content.Context.ACTIVITY_SERVICE\nimport utils.FormatterUtils.formatFromByteToGB\n\nclass SystemMemoryUtils(context: Context) {\n\n    companion object {\n        const val TAG = \"SystemStorageUtils\"\n    }\n\n    private val mContext = context\n\n    @SuppressLint(\"ServiceCast\")\n    private val mActivityManager =\n        mContext.getSystemService(ACTIVITY_SERVICE) as ActivityManager\n\n    val instance by lazy(LazyThreadSafetyMode.SYNCHRONIZED) {\n        getCurrentSystemMemoryUsage()\n    }\n\n    fun getSystemMemoryTotalFloat(): Float {\n        try {\n            val memoryInfo = ActivityManager.MemoryInfo()\n            mActivityManager.getMemoryInfo(memoryInfo)\n            return formatFromByteToGB(memoryInfo.totalMem)\n        } catch (e: Exception) {\n            e.printStackTrace()\n        }\n        return 0.0f\n    }\n\n    fun getCurrentSystemMemoryUsageFloat(): Float {\n        try {\n            val memoryInfo = ActivityManager.MemoryInfo()\n            mActivityManager.getMemoryInfo(memoryInfo)\n            return formatFromByteToGB(memoryInfo.totalMem - memoryInfo.availMem)\n        } catch (e: Exception) {\n            e.printStackTrace()\n        }\n        return 0.0f\n    }\n}\n```\n\n```kotlin\nimport android.app.usage.StorageStatsManager\nimport android.content.Context\nimport android.content.Context.STORAGE_STATS_SERVICE\nimport android.os.Build\nimport android.os.storage.StorageManager\nimport androidx.annotation.RequiresApi\nimport java.io.IOException\nimport java.text.DecimalFormat\n\n@RequiresApi(Build.VERSION_CODES.O)\nclass SystemStorageUtils(context: Context) {\n    companion object{\n        const val TAG = \"SystemStorageUtils\"\n    }\n    private val mContext = context\n    private val mStorageStatsManager =\n        mContext.getSystemService(STORAGE_STATS_SERVICE) as StorageStatsManager\n\n    fun getSystemTotalStorageFloat(): Float {\n        return FormatterUtils.formatFromByteToGB(mStorageStatsManager.getTotalBytes(StorageManager.UUID_DEFAULT))\n    }\n\n    fun getCurrentSystemStorageUsageFloat(): Float {\n        try {\n            val totalStorage = mStorageStatsManager.getTotalBytes(StorageManager.UUID_DEFAULT)\n            val availableStorage = mStorageStatsManager.getFreeBytes(StorageManager.UUID_DEFAULT)\n            return FormatterUtils.formatFromByteToGB(totalStorage - availableStorage)\n        } catch (e: IOException) {\n            e.printStackTrace()\n        }\n        return 0.0f\n    }\n}\n```\n\n## å†…ç½‘ç½‘å¡ä¿¡æ¯è·å–\n\n```java\n    public static String getDeviceSpecifiedMacAddress(String NICName) {\n        if(NICName == null || NICName.isEmpty())\n        {\n            return \"\";\n        }\n        try {\n            Enumeration<NetworkInterface> enumeration = NetworkInterface.getNetworkInterfaces();\n            while (enumeration.hasMoreElements()) {\n                NetworkInterface networkInterface = enumeration.nextElement();\n                if (networkInterface != null && !TextUtils.isEmpty(networkInterface.getName())) {\n                    if (networkInterface.getName().equalsIgnoreCase(NICName)) {\n                        byte[] arrayOfByte = networkInterface.getHardwareAddress();\n                        if (arrayOfByte != null && arrayOfByte.length > 0) {\n                            StringBuilder deviceMacAddress = new StringBuilder();\n                            // format the mac address\n                            for (byte b : arrayOfByte) {\n                                deviceMacAddress.append(String.format(\"%02X:\", b));\n                            }\n                            if (deviceMacAddress.length() > 0) {\n                                deviceMacAddress.deleteCharAt(deviceMacAddress.length() - 1);\n                            }\n                            return deviceMacAddress.toString();\n                        }\n                    }\n                }\n            }\n        } catch (SocketException e) {\n            e.printStackTrace();\n            Log.e(TAG, \"getDeviceSpecifiedMacAddress: \" + e.getMessage());\n        }\n        return \"\";\n    }\n    public static String getDeviceSpecifiedIPAddress(String NICName) {\n        if(NICName == null || NICName.isEmpty())\n        {\n            return \"\";\n        }\n        String IPAddress = \"\";\n        try {\n            Enumeration<NetworkInterface> enumeration = NetworkInterface.getNetworkInterfaces();\n            while (enumeration.hasMoreElements()) {\n                NetworkInterface networkInterface = enumeration.nextElement();\n                if (networkInterface != null) {\n                    if (networkInterface.getName().equalsIgnoreCase(NICName)) {\n                        Enumeration<InetAddress> ei = networkInterface.getInetAddresses();\n                        while (ei.hasMoreElements()) {\n                            InetAddress i = ei.nextElement();\n                            if(i instanceof Inet4Address)\n                                IPAddress = i.getHostAddress();\n                        }\n                    }\n                }\n            }\n        } catch (SocketException e) {\n            e.printStackTrace();\n        }\n        return IPAddress;\n    }\n    /**\n     *  Masks a raw IP address byte array with the specified prefix length.\n     */\n    public static void maskRawAddress(byte[] array, int prefixLength) {\n        if (prefixLength < 0 || prefixLength > array.length * 8) {\n            throw new RuntimeException(\"IP address with \" + array.length +\n                    \" bytes has invalid prefix length \" + prefixLength);\n        }\n\n        int offset = prefixLength / 8;\n        int remainder = prefixLength % 8;\n        byte mask = (byte)(0xFF << (8 - remainder));\n\n        if (offset < array.length) array[offset] = (byte)(array[offset] & mask);\n\n        offset++;\n\n        for (; offset < array.length; offset++) {\n            array[offset] = 0;\n        }\n    }\n    /**\n     * Get InetAddress masked with prefixLength.  Will never return null.\n     * @param address the IP address to mask with\n     * @param prefixLength the prefixLength used to mask the IP\n     */\n    public static InetAddress getNetworkPart(InetAddress address, int prefixLength) {\n        byte[] array = address.getAddress();\n        maskRawAddress(array, prefixLength);\n\n        InetAddress netPart = null;\n        try {\n            netPart = InetAddress.getByAddress(array);\n        } catch (UnknownHostException e) {\n            throw new RuntimeException(\"getNetworkPart error - \" + e.toString());\n        }\n        return netPart;\n    }\n    private static String ipv4PrefixLengthToSubnetMask(int prefixLength) {\n        try {\n            InetAddress all = InetAddress.getByAddress(\n                    new byte[]{(byte) 255, (byte) 255, (byte) 255, (byte) 255});\n            return getNetworkPart(all, prefixLength).getHostAddress();\n        } catch (UnknownHostException e) {\n            return null;\n        }\n    }\n    public static String getDeviceSpecifiedSubNetMaskFromConnectionManager(Context context, String NICName) {\n        if(NICName == null || NICName.isEmpty())\n        {\n            return \"\";\n        }\n        String subnet = \"\";\n        if (Build.VERSION.SDK_INT >= 21 && context != null) {\n            ConnectivityManager connectivityManager = (ConnectivityManager) context.getSystemService(context.CONNECTIVITY_SERVICE);\n            if (connectivityManager != null) {\n                for (Network network : connectivityManager.getAllNetworks()) {\n                    LinkProperties lp = connectivityManager.getLinkProperties(network);\n                    if (lp.getInterfaceName().equals(NICName))\n                    {\n                        Log.w(\"SUBNETMASK\", NICName);\n                        for (LinkAddress addr : lp.getLinkAddresses()) {\n                            if (addr.getAddress() instanceof Inet4Address) {\n                                subnet = ipv4PrefixLengthToSubnetMask(addr.getPrefixLength());\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        return subnet;\n    }\n\n    public static List<String> getDeviceActiveNetWorkDnsFromConnectionManager(Context context, int type) {\n        ConnectivityManager connectivityManager = (ConnectivityManager) context.getSystemService(context.CONNECTIVITY_SERVICE);\n        NetworkInfo activeNetworkInfo = connectivityManager.getActiveNetworkInfo();\n        return getDeviceSpecifiedDnsFromConnectionManager(context, activeNetworkInfo.getType());\n    }\n\n    public static List<String> getDeviceSpecifiedDnsFromConnectionManager(Context context, int type) {\n        List<String> dnsServers = new ArrayList<>();\n        if (Build.VERSION.SDK_INT >= 21 && context != null) {\n            ConnectivityManager connectivityManager = (ConnectivityManager) context.getSystemService(context.CONNECTIVITY_SERVICE);\n            if (connectivityManager != null) {\n                for (Network network : connectivityManager.getAllNetworks()) {\n                    NetworkInfo networkInfo = connectivityManager.getNetworkInfo(network);\n                    if (networkInfo != null && networkInfo.getType() == type) {\n                        LinkProperties lp = connectivityManager.getLinkProperties(network);\n                        for (InetAddress addr : lp.getDnsServers()) {\n                            dnsServers.add(addr.getHostAddress());\n                        }\n                    }\n                }\n            }\n        }\n        return dnsServers;\n    }\n```\n\n## å¤–ç½‘ä¿¡æ¯è·å–\n\n```java\n    @SuppressLint(\"LongLogTag\")\n    public static String getEthernetIPFromJson(String ethernetJsonStr) {\n        try {\n            if (ethernetJsonStr.isEmpty()) {\n                Log.d(TAG, \"getEthernetIPFromJson: Analysis Json is empty!\");\n                return \"NA\";\n            }\n            JSONObject jsonObject = new JSONObject(ethernetJsonStr);\n            String msg = jsonObject.getString(\"msg\");\n            if (msg.isEmpty()) {\n                Log.d(TAG, \"getEthernetIPFromJson: Analysis Json no msg tag!\");\n                return \"NA\";\n            }\n            if (!msg.equals(\"ok\")) {\n                Log.d(TAG, \"getEthernetIPFromJson: Analysis Json TAG ok failed!\");\n                return \"NA\";\n            }\n            jsonObject = jsonObject.getJSONObject(\"data\");\n            String ethernetIPFromJson = jsonObject.getString(\"ip\");\n            if (ethernetIPFromJson == null || ethernetIPFromJson.isEmpty())\n                ethernetIPFromJson = \"NA\";\n            return ethernetIPFromJson;\n        } catch (JSONException e) {\n            e.printStackTrace();\n            Log.e(TAG, \"getEthernetIPFromJson: \" + e.getMessage());\n            return \"NA\";\n        }\n    }\n\n    @SuppressLint(\"LongLogTag\")\n    public static String getEthernetOperatorFromJson(String ethernetJsonStr) {\n        try {\n            if (ethernetJsonStr.isEmpty()) {\n                Log.d(TAG, \"getEthernetIPFromJson: Analysis Json is empty!\");\n                return \"NA\";\n            }\n            JSONObject jsonObject = new JSONObject(ethernetJsonStr);\n            String msg = jsonObject.getString(\"msg\");\n            if (msg.isEmpty()) {\n                Log.d(TAG, \"getEthernetIPFromJson: Analysis Json no msg tag!\");\n                return \"NA\";\n            }\n            if (!msg.equals(\"ok\")) {\n                Log.d(TAG, \"getEthernetOperatorFromJson: Analysis Json TAG ok failed!\");\n                return \"NA\";\n            }\n            jsonObject = jsonObject.getJSONObject(\"data\");\n            return jsonObject.getString(\"operator\");\n        } catch (JSONException e) {\n            e.printStackTrace();\n            Log.e(TAG, \"getEthernetOperatorFromJson: \" + e.getMessage());\n        }\n        return \"NA\";\n    }\n```\n\n## æ±‡æ€»\n\n```kotlin\nclass DiagnosisFetchListener {\n    private var mSystemVersion : String? = null\n\n    private fun getSystemVersion():String {\n        if (mSystemVersion.isNullOrEmpty()) {\n            mSystemVersion = SystemPropertiesUtils.get(BuildConfig.SYSTEM_VERSION_PROP, \"xxxOS\")\n        }\n        return mSystemVersion as String\n    }\n    //æ–¹æ³•ï¼šthing.event.sendDiagnosisFetchMinder.post\n    //{\n    //    \"method\": \"thing.event.sendDiagnosisFetchMinder.post\",\n    //}\n    fun sendDiagnosisFetchMinder(taskUid: String) {\n        GetEthernetInfoRequestJson().getEthernetRequest(object : GetEthernetInfoRequestJson.AnalysisEthernetJson {\n            @RequiresApi(Build.VERSION_CODES.O)\n            override fun analysisEthernetFromJson(json: String) {\n                if (json.isEmpty()){\n                    Log.e(\n                        DeviceReport.TAG,\n                        \">>> analysisEthernetFromJson(): origin json string is empty, return\")\n                    return\n                }\n                val ip: String = RemoteDetectSystemInfoUtil.getEthernetIPFromJson(json)\n                val netOperator: String = RemoteDetectSystemInfoUtil.getEthernetOperatorFromJson(json)\n\n                if (ip.isEmpty() || netOperator.isEmpty()) {\n                    Log.d(DeviceReport.TAG, \">>> CIot-ext-Handler sendDiagnosisFetchMinder!! ip or netOperator is null!\")\n                }\n                val version: String = getSystemVersion()\n                //systemTime, millis\n                val systemTime: Long = SystemTimeUtils.getCurrentSystemTimestamp()\n                //lastStartTime, millis\n                val lastStartTime: Long = SystemTimeUtils.getLastStartTimestamp()\n                //runningTime, millis\n                val runningTime: Long = SystemTimeUtils.getElapsedTimeMillis()\n\n                //lightSensor\n                val lightSensorUtil = SensorUtil(\"lightSensor\")\n                var lightSensorData: String = \"\"\n                if(! lightSensorUtil.startRegisterListener(\n                        ContextHelper.getApplicationContext(),\n                        Sensor.TYPE_LIGHT, object: SensorUtil.SensorResultCallback {\n                            override fun onDataCallBack(result: List<Float>) {\n                                lightSensorData = result[0].toString() + \"lux\"\n                            }\n                            override fun onGetDataTimeout() {\n                                lightSensorData = \"è¶…æ—¶å¼‚å¸¸\"\n                            }\n\n                        }))\n                {\n                    lightSensorData = \"è·å–ä¼ æ„Ÿå™¨å¤±è´¥ï¼Œå¯èƒ½æ˜¯ç¡¬ä»¶å¼‚å¸¸\"\n                }\n                //colorTemperatureSensor\n                val colorTemperatureSensorUtil = SensorUtil(\"colorTemperatureSensor\")\n                var colorTemperatureSensorData: String = \"\"\n                if(! colorTemperatureSensorUtil.startRegisterListener(\n                        ContextHelper.getApplicationContext(),\n                        36, object: SensorUtil.SensorResultCallback {\n                            override fun onDataCallBack(result: List<Float>) {\n                                colorTemperatureSensorData = result[0].toString() + \"k\"\n                            }\n                            override fun onGetDataTimeout() {\n                                colorTemperatureSensorData = \"è¶…æ—¶å¼‚å¸¸\"\n                            }\n\n                        }))\n                {\n                    colorTemperatureSensorData = \"è·å–ä¼ æ„Ÿå™¨å¤±è´¥ï¼Œå¯èƒ½æ˜¯ç¡¬ä»¶å¼‚å¸¸\"\n                }\n                //gravitySensorData\n                val gravitySensorUtil = SensorUtil(\"gravitySensor\")\n                var gravitySensorData: String = \"\"\n                if(! gravitySensorUtil.startRegisterListener(\n                        ContextHelper.getApplicationContext(),\n                        Sensor.TYPE_ACCELEROMETER, object : SensorUtil.SensorResultCallback {\n                            override fun onDataCallBack(result: List<Float>) {\n                                gravitySensorData = \"x:\" + result[0].toString() +\n                                                    \" y:\" + result[1].toString() +\n                                                    \" z:\" + result[2].toString()\n                            }\n                            override fun onGetDataTimeout() {\n                                gravitySensorData = \"è¶…æ—¶å¼‚å¸¸\"\n                            }\n                        }))\n                {\n                    gravitySensorData = \"è·å–ä¼ æ„Ÿå™¨å¤±è´¥ï¼Œå¯èƒ½æ˜¯ç¡¬ä»¶å¼‚å¸¸\"\n                }\n                //microphoneState\n                val microphoneState: String = DetectMicUtils().getMicState()\n                // å®¹é‡æƒ…å†µ\n                val cpuInfo: Float = RemoteDetectSystemInfoUtil.getCpuTotalUsageFloat()\n                val totalMemory: Float = SystemMemoryUtils(ContextHelper.getApplicationContext()).getSystemMemoryTotalFloat()\n                val usageMemory: Float = SystemMemoryUtils(ContextHelper.getApplicationContext()).getCurrentSystemMemoryUsageFloat()\n                val totalStorage: Float = SystemStorageUtils(ContextHelper.getApplicationContext()).getSystemTotalStorageFloat()\n                val usageStorage: Float = SystemStorageUtils(ContextHelper.getApplicationContext()).getCurrentSystemStorageUsageFloat()\n\n                // å†…ç½‘æƒ…å†µ\n                // ip, å­ç½‘æ©ç , macåœ°å€, DNS(å¯èƒ½æœ‰å¤šä¸ª),\n                val wlan0ip: String = RemoteDetectSystemInfoUtil.getDeviceSpecifiedIPAddress(\"wlan0\")\n                val wlan0subnetmask: String = RemoteDetectSystemInfoUtil.\n                        getDeviceSpecifiedSubNetMaskFromConnectionManager(ContextHelper.getApplicationContext(),\"wlan0\")\n                val wlan0mac: String = RemoteDetectSystemInfoUtil.getDeviceSpecifiedMacAddress(\"wlan0\")\n                val wlan0dns: List<String> = RemoteDetectSystemInfoUtil.\n                        getDeviceSpecifiedDnsFromConnectionManager(getApplicationContext(), ConnectivityManager.TYPE_WIFI)\n\n                val eth0ip: String = RemoteDetectSystemInfoUtil.getDeviceSpecifiedIPAddress(\"eth0\")\n                val eth0subnetmask: String = RemoteDetectSystemInfoUtil.\n                        getDeviceSpecifiedSubNetMaskFromConnectionManager(ContextHelper.getApplicationContext(), \"eth0\")\n                val eth0mac: String = RemoteDetectSystemInfoUtil.getDeviceSpecifiedMacAddress(\"eth0\")\n                val eth0dns: List<String> = RemoteDetectSystemInfoUtil.\n                        getDeviceSpecifiedDnsFromConnectionManager(getApplicationContext(), ConnectivityManager.TYPE_ETHERNET)\n\n                var outerNetInfo: OuterNetInfo = OuterNetInfo(ip, netOperator)\n\n                var innerNetInfoWifi: InnerNetInfo = InnerNetInfo(wlan0ip,wlan0subnetmask, wlan0mac, wlan0dns)\n\n                var innerNetInfoEth: InnerNetInfo = InnerNetInfo(eth0ip,eth0subnetmask, eth0mac, eth0dns)\n\n                val diagnosisFetchInfo = DiagnosisFetchInfo(\n                    version,\n                    systemTime,\n                    lastStartTime,\n                    runningTime,\n                    lightSensorData,\n                    colorTemperatureSensorData,\n                    gravitySensorData,\n                    microphoneState,\n                    cpuInfo,\n                    totalMemory,\n                    usageMemory,\n                    totalStorage,\n                    usageStorage,\n                    outerNetInfo,\n                    innerNetInfoWifi,\n                    innerNetInfoEth\n                )\n                val diagnosisReportInfo = DiagnosisReportInfo(taskUid, diagnosisFetchInfo, 2)\n\n                HttpHelper.getInstance().doPut(HttpConstants.updateDiagnosisPutUrl(), diagnosisReportInfo, object: Callback {\n                    override fun onFailure(call: Call, e: IOException) {\n                        Log.e(DeviceReport.TAG, \"updateDiagnosisPutUrl:response onFailure\")\n                    }\n\n                    override fun onResponse(call: Call, response: Response) {\n                        val body = response.body!!.string()\n                        try {\n                            if (response.isSuccessful && isJsonAndGetCode(body) == 0) {\n                                Log.d(DeviceReport.TAG, \"updateDiagnosisPutUrl:response $body\")\n                            } else {\n                                Log.e(DeviceReport.TAG, \"updateDiagnosisPutUrl failed ${response.code}\")\n                            }\n                        } catch (e: Exception) {\n                            Log.e(DeviceReport.TAG, e.printStackTrace().toString())\n                        }\n                    }\n                })\n            }\n        })\n    }\n    private fun isJsonAndGetCode(str: String): Int {\n        try {\n            val jsonStr = JSONObject(str)\n            if (jsonStr.has(\"code\")) {\n                Log.d(DeviceReport.TAG, \"code = \" + jsonStr.getInt(\"code\"))\n                return jsonStr.getInt(\"code\")\n            }\n        } catch (e: Exception) {\n            e.printStackTrace()\n        }\n        return -1\n    }\n}\n```\n\n# å“åº”ï¼šdoPutæ–¹æ³•\n\nå®ç°äºHttpHelperç±»ã€‚\n\n```java\n    private static final String TAG = \"HttpHelper\";\n    private static final MediaType MEDIA_TYPE = MediaType.parse(\"application/json; charset=UTF-8\");\n    private static final String KEY_HEADER_APP_CODE = \"x-app-code\";\n    private static final String KEY_HEADER_APP_VERSION = \"x-app-version\";\n    private static final String KEY_HEADER_CONTENT_TYPE = \"Content-Type\";\n    private static final String KEY_HEADER_REQ_IP = \"x-req-ip\";\n    public static final String KEY_HEADER_AUTH_TOKEN = \"x-auth-token\";\n    \n\n    private Request.Builder addHeaders() {\n        // todo fix version name to xxx.xxx.xxx\n        Request.Builder builder = new Request.Builder()\n                .addHeader(\"Connection\", \"keep-alive\")\n                .addHeader(KEY_HEADER_APP_CODE, BuildConfig.DEF_APP_CODE)\n                .addHeader(KEY_HEADER_APP_VERSION, \"3.0.0\");\n        if (mToken != null) {\n            builder.addHeader(KEY_HEADER_AUTH_TOKEN, mToken);\n        }\n        return builder;\n    }\n\n    public int doPut(String url, Object src, Callback callback) {\n        return localDoPut(url, src, callback);\n    }\n\n    private int localDoPut(String url, Object src, Callback callback) {\n        String json = new Gson().toJson(src);\n        Log.d(TAG, json);\n        RequestBody requestBody = RequestBody.create(MEDIA_TYPE, json);\n        Request request = addHeaders().addHeader(KEY_HEADER_CONTENT_TYPE, \"application/json\").url(url).put(requestBody).build();\n        Call call = mOkHttpClient.newCall(request);  // å¼€å§‹è°ƒç”¨è¯·æ±‚put\n        if (callback != null) {\n            call.enqueue(callback);\n        }\n        mId++;\n        return mId;\n    }\n```\n\n# æœ€ç»ˆåå°æ”¶åˆ°çš„jsonä¸²\n\n```json\n{\n    \"diagnosisResultBo\": {\n        \"colorTemperatureSensorData\": \"4652.254k\",\n        \"cpuInfo\": 4.0,\n        \"gravitySensorData\": \"x:9.122001 y:-0.162 z:0.722\",\n        \"innerNetInfoEth\": {\n            \"dns\": [],\n            \"ip\": \"\",\n            \"mac\": \"\",\n            \"subNetMask\": \"\"\n        },\n        \"innerNetInfoWifi\": {\n            \"dns\": [\n                \"10.254.254.254\",\n                \"10.21.41.2\"\n            ],\n            \"ip\": \"176.20.209.204\",\n            \"mac\": \"FA:04:1B:4C:E4:99\",\n            \"subNetMask\": \"255.255.240.0\"\n        },\n        \"lastStartTime\": 1661398955912,\n        \"lightSensorData\": \"219.675lux\",\n        \"microphoneState\": \"æ­£å¸¸\",\n        \"outerNetInfo\": {\n            \"ip\": \"172.20.209.204\",\n            \"netOperator\": \"\"\n        },\n        \"runningTime\": 11675621,\n        \"systemTime\": 1661410631533,\n        \"totalMemory\": 6.1607113,\n        \"totalStorage\": 128.0,\n        \"usageMemory\": 1.7563075,\n        \"usageStorage\": 24.85746,\n        \"version\": \"20220805_1045_userdebug_V3.0.1\"\n    },\n    \"taskStatus\": 2,\n    \"taskUid\": \"123321\"\n}\n```\n\n","categories":["Android"]},{"title":"Android_onClick","url":"/Android/Android_onClick/","content":"\n# ä¸åŒçš„ç»‘å®šç‚¹å‡»å›è°ƒæ–¹å¼\n\nç¬¬ä¸€ç§æ–¹å¼ï¼šåŒ¿åå‡½æ•°\n\n```java\npublic class MainActivity extends AppCompatActivity {\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        Button button = (Button) findViewById(R.id.button);\n        button.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View view) {\n                // ...\n            }\n        });\n        \n        ImageView imageView = (ImageView) findViewById(R.id.image_view);\n        imageView.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View view) {\n                // ...\n            }\n        });\n    }\n}\n```\n\nç¬¬äºŒç§æ–¹å¼ï¼šç»§æ‰¿OnClickListeneræ¥å£ï¼Œå®ç°onClickå‡½æ•°ã€‚ä½¿ç»„ä»¶ç›´æ¥ç»‘å®šthisã€‚æ¯å½“è¢«ç‚¹å‡»æ—¶ï¼Œç»Ÿä¸€è°ƒç”¨onClickï¼Œé‡Œé¢è¿›è¡Œcaseé€»è¾‘åˆ†æµã€‚ä¾æ®Viewçš„idä¸å…¶R.idå¯¹æ¯”è¿›è¡Œã€‚\n\n```java\npublic class MainActivity extends AppCompatActivity implements View.OnClickListener{\n    private EditText editText;\n    private ImageView imageView;\n    private ProgressBar progressBar;\n    private static int COUNT;\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        Button button = (Button) findViewById(R.id.button);\n        imageView = (ImageView) findViewById(R.id.image_view);\n        progressBar = (ProgressBar) findViewById(R.id.progress_bar);\n        button.setOnClickListener(this);\n        imageView.setOnClickListener(this);\n    }\n    @Override\n    public void onClick(View v) {\n        switch (v.getId()) {\n            case R.id.button:\n                if (progressBar.getVisibility() == View.GONE) {\n                    progressBar.setVisibility(View.VISIBLE);\n                } else {\n                    progressBar.setVisibility(View.GONE);\n                }\n                break;\n            case R.id.image_view:\n                if(COUNT == 1) {\n                    imageView.setImageResource(R.drawable.img_2);\n                    COUNT = 0;\n                } else {\n                    imageView.setImageResource(R.drawable.img_1);\n                    COUNT = 1;\n                }\n                break;\n            default:\n                break;\n        }\n    }\n}\n```\n\n\n","categories":["Android"]},{"title":"04_protobuf","url":"/RPC/04_protobuf/","content":"protobufï¼ˆprotocol bufferï¼‰æ˜¯Googleçš„ä¸€ç§æ•°æ®äº¤æ¢çš„æ ¼å¼ï¼Œç‹¬ç«‹äºå¹³å°è¯­è¨€ã€‚\nprotobufæä¾›äº†å¤šç§è¯­è¨€çš„å®ç°ï¼šJavaã€C#ã€C++ã€Goå’ŒPythonç­‰ï¼Œæ¯ä¸€ç§å®ç°éƒ½åŒ…å«äº†ç›¸åº”è¯­è¨€çš„ç¼–è¯‘å™¨åŠåº“æ–‡ä»¶ã€‚\n# å®‰è£…\nè§ã€Šmprpc_ç¯å¢ƒé…ç½®ã€‹ä¸€ç¯‡ã€‚\n\nå®‰è£…æˆåŠŸåï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œè¾“å…¥`protoc`ï¼Œè¿™æ˜¯protobufçš„ç¼–è¯‘å‘½ä»¤ï¼Œå¯é€šè¿‡ç®€å•çš„é…ç½®æ–‡ä»¶ç”Ÿæˆç›¸åº”çš„ä»£ç ã€‚\næ¯”å¦‚å‘½ä»¤è¡Œçš„å¯é€‰é¡¹ï¼š\n```bash\n  --cpp_out=OUT_DIR           Generate C++ header and source.\n  --csharp_out=OUT_DIR        Generate C# source file.\n  --java_out=OUT_DIR          Generate Java source file.\n  --js_out=OUT_DIR            Generate JavaScript source.\n  --objc_out=OUT_DIR          Generate Objective C header and source.\n  --php_out=OUT_DIR           Generate PHP source file.\n  --python_out=OUT_DIR        Generate Python source file.\n  --ruby_out=OUT_DIR          Generate Ruby source file.\n```\n## VSCodeæ’ä»¶\nå¯ä»¥å®‰è£…ä¸€ä¸ªvscode-proto3\n# å®šä¹‰æ¶ˆæ¯ç±»å‹ - message\næœ¬è´¨ä¸Šï¼Œmessageæ˜¯ç”Ÿæˆäº†ä¸€ä¸ªå…¬æœ‰ç»§æ‰¿äº`::google::protobuf::Message`çš„ç±»ã€‚\næä¾›äº†messageæˆå‘˜å˜é‡çš„è¯»å†™æ–¹æ³•ã€ï¼ˆåï¼‰åºåˆ—åŒ–æ–¹æ³•ã€‚\n![](../../images/mprpc_protobuf/image-20250713011107435.png)\n\n## ç¤ºä¾‹\n\nåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªtestæ–‡ä»¶å¤¹ï¼Œåœ¨å…¶ä¸­å†å»ºä¸€ä¸ªprotobufæ–‡ä»¶å¤¹ã€‚\n\nè¿›å…¥æ–‡ä»¶å¤¹ï¼Œæ–°å»ºä¸€ä¸ª`test.proto`ã€`main.cc`è¿›è¡Œæµ‹è¯•ã€‚\n\n```protobuf\nsyntax = \"proto3\";  //å£°æ˜protobufçš„ç‰ˆæœ¬\npackage xcg;        //å£°æ˜ä»£ç æ‰€åœ¨çš„åŒ…ï¼Œç›¸å½“äºcppçš„namespace\n\n//å®šä¹‰ç™»å½•è¯·æ±‚æ¶ˆæ¯ç±»å‹\nmessage LoginRequest\n{\n    string name = 1;//æ•°å­—1ä¸ä»£è¡¨å­—ç¬¦ä¸²çš„å€¼ï¼Œè€Œæ˜¯å£°æ˜æ­¤å±æ€§ä¸ºç¬¬å‡ ä¸ªå­—æ®µ\n    string pwd = 2;\n}\n//å®šä¹‰ç™»å½•å“åº”æ¶ˆæ¯ç±»å‹\nmessage LoginResponse\n{\n    int32 errcode = 1;//é”™è¯¯ç \n    string errmsg = 2;//é”™è¯¯æ¶ˆæ¯\n    bool success = 3; //æ ‡å¿—ç™»å½•æ˜¯å¦æˆåŠŸ\n}\n```\n\nå…¶ä¸­çš„stringä¸ä»£è¡¨å…·ä½“çš„æŸä¸€è¯­è¨€å½“ä¸­çš„å­—ç¬¦ä¸²ç±»å‹ï¼Œè€Œæ˜¯protobufä¸­çš„å­—ç¬¦ä¸²ç±»å‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œprotobufä¸­çš„ç±»å‹åªæ˜¯ä¸ªæŠ½è±¡ï¼Œå…·ä½“å®ç°åˆ™çœ‹ä½ æ˜¯ç”¨å“ªç§è¯­è¨€ç¼–è¯‘ã€‚\n\nå±æ€§åé¢çš„` = 1`æ•°å­—1ä¸ä»£è¡¨å­—ç¬¦ä¸²çš„å€¼ï¼Œè€Œæ˜¯å£°æ˜æ­¤å±æ€§ä¸ºç¬¬å‡ ä¸ªå­—æ®µã€‚\n## protobufç»™å±æ€§ç”Ÿæˆçš„æ–¹æ³•\n1. `set_xxx(param)`\n2. `xxx()`\n\nprotobufç”Ÿæˆçš„ç±»éƒ½ä¼šç»™æ¯ä¸€ä¸ªå±æ€§æä¾›`set_xxx(param)`å’Œ`xxx()`çš„æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯å†™å…¥ã€è¯»å–ã€‚\n\n## åºåˆ—åŒ–æ–¹æ³•\n\nprotobufç”Ÿæˆçš„ç±»æœ‰ä¸€ç³»åˆ—çš„åºåˆ—åŒ–æ–¹æ³•ã€‚è¿”å›å€¼ä¸ºboolï¼Œtrueè¡¨ç¤ºåºåˆ—åŒ–æˆåŠŸã€‚è°ƒç”¨æ—¶éœ€è¦ç”¨ä¸€ä¸ªprotobufç±»å¯¹è±¡è°ƒç”¨ã€‚\n\nå¦‚ï¼š\n1. SerializeToString - åºåˆ—åŒ–åˆ°å­—ç¬¦ä¸²ä¸­\n   ```cpp\n   bool SerializeToString(std::string* output) const;\n   ```\n2. SerializeToArray - åºåˆ—åŒ–åˆ°å­—èŠ‚æ•°ç»„ä¸­\n   ```cpp\n   bool SerializeToArray(void * data, int size) const;\n   ```\n3. SerializeToFileDescriptor - åºåˆ—åŒ–åˆ°æ–‡ä»¶æè¿°ç¬¦\n4. SerializeToOstream - åºåˆ—åŒ–åˆ°è¾“å‡ºæµ\n\n## ååºåˆ—åŒ–æ–¹æ³•\n\nprotobufç”Ÿæˆçš„ç±»ï¼Œç›¸åº”åœ°æœ‰ä¸€ç³»åˆ—çš„ååºåˆ—åŒ–æ–¹æ³•ã€‚è¿”å›å€¼ä¸ºboolï¼Œtrueè¡¨ç¤ºååºåˆ—åŒ–æˆåŠŸã€‚è°ƒç”¨æ—¶éœ€è¦ç”¨ä¸€ä¸ªprotobufç±»å¯¹è±¡è°ƒç”¨ã€‚\n\nå¦‚ï¼š\n1. ParseFromString\n   ```cpp\n   inline bool ParseFromString(const std::string& data)\n   {\n       return ParseFromArray(data.data(), static_cast<int>(data.size()));\n   }\n   ```\n# protobufçš„â€œç¼–è¯‘â€--protocç”Ÿæˆç›¸åº”è¯­è¨€çš„ä»£ç \n\n```\nprotoc test.proto --cpp_out=./\n```\n\nå…¶ä¸­ï¼Œ`--cpp_out`é€‰é¡¹æ˜¯æŒ‡æ˜ç”ŸæˆCppå¤´æ–‡ä»¶å’Œæºæ–‡ä»¶ï¼Œåé¢å¸¦çš„å‚æ•°æŒ‡æ˜ç”Ÿæˆçš„ç›®å½•ã€‚æ ¼å¼ï¼š`--cpp_out=OUT_DIR`ã€‚\n\nç›¸åº”åœ°ï¼Œä¹Ÿä¼šæœ‰å…¶ä»–è¯­è¨€çš„é€‰é¡¹ï¼Œå¦‚`--java_out`å°±æ˜¯ç”ŸæˆJavaæºæ–‡ä»¶ï¼ˆJavaæ²¡æœ‰å¤´æ–‡ä»¶ï¼‰ï¼›`python_out`å°±æ˜¯ç”Ÿæˆpythonæºæ–‡ä»¶ã€‚\n\næ‰§è¡Œè¯¥å‘½ä»¤ï¼Œå½“å‰ç›®å½•ä¸‹å‡ºç°ï¼š`test.pb.cc`å’Œ`test.pb.h`ã€‚\n\nå…¶ä¸­ï¼Œ`test.pb.h`åŒ…å«`LoginRequest`å’Œ`LoginResponse`ç±»çš„å®šä¹‰ï¼Œè€Œä¸”å®ƒä»¬å·²ç»è‡ªåŠ¨åŒ…å«åˆ°äº†`xcg`çš„namespaceã€‚\n\n# ç¼–å†™cppæ–‡ä»¶, ä½¿ç”¨protobufçš„ç”Ÿæˆç±»\n\n```cpp\n// main.cc\n#include\"test.pb.h\"\n#include<iostream>\n\n#include \"test.pb.h\"\n#include <iostream>\nusing namespace xcg;\nint main()\n{\n    // å°è£…äº†loginè¯·æ±‚å¯¹è±¡çš„æ•°æ®\n    LoginRequest req;\n    req.set_name(\"zhang san\");\n    req.set_pwd(\"123456\");\n    // å¯¹è±¡æ•°æ®åºåˆ—åŒ– ä¸º å­—ç¬¦ä¸²\n    std::string send_str;\n    if(req.SerializeToString(&send_str))\n    {\n        std::cout << send_str << std::endl;\n    }\n    // ä»ä¸€ä¸ªå­—ç¬¦ä¸²ååºåˆ—åŒ–åˆ°loginè¯·æ±‚å¯¹è±¡\n    LoginRequest req2;\n    if (req2.ParseFromString(send_str))\n    {\n        std::cout << req2.name() << std::endl;\n        std::cout << req2.pwd() << std::endl;\n    }\n    return 0;\n}\n```\nç¼–è¯‘å‘½ä»¤ï¼šæ³¨æ„éœ€è¦é“¾æ¥protobufçš„åº“ã€‚\n```bash\ng++ main.cc test.pb.cc -lprotobuf\n```\nè¿è¡Œç»“æœï¼š\n```\n\n        zhang san123456\nzhang san\n123456\n```\n\n\n# stringå’Œbytes\n\nåœ¨ç¼–å†™protobufæ–‡ä»¶ä¸­çš„ç±»å‹æ—¶ï¼Œå°½é‡ä¸è¦ç”¨stringç±»å‹ï¼Œè€Œæ˜¯ç”¨bytesç±»å‹ï¼Œå¯ä»¥é¿å…ä¸­é—´ä¼ è¾“ã€å­˜å‚¨å­—ç¬¦æ•°æ®æ—¶ï¼Œé¢å¤–çš„å­—ç¬¦ã€å­—èŠ‚ä¹‹é—´çš„è½¬æ¢ã€‚å› ä¸ºbyteså­˜å‚¨æ„å‘³ç€ç›´æ¥ä»¥åŸå§‹äºŒè¿›åˆ¶è¿›è¡Œå­˜å‚¨ã€‚å¦‚æœä½¿ç”¨stringï¼Œä¸­é—´è¿‡ç¨‹å­˜åœ¨ç€å­—ç¬¦åˆ°å­—èŠ‚ç çš„ç›¸äº’è½¬æ¢ã€‚\n\næ¯”å¦‚å¦‚æœå­˜åœ¨Unicodeï¼Œåˆ™ä½¿ç”¨stringå¯èƒ½ä¼šå­˜åœ¨å­˜å‚¨æ•ˆç‡ä¸é«˜çš„é—®é¢˜ã€‚\n```protobuf\n//å®šä¹‰ç™»å½•è¯·æ±‚æ¶ˆæ¯ç±»å‹\nmessage LoginRequest\n{\n    bytes name = 1;//æ•°å­—1ä¸ä»£è¡¨å­—ç¬¦ä¸²çš„å€¼ï¼Œè€Œæ˜¯å£°æ˜æ­¤å±æ€§ä¸ºç¬¬å‡ ä¸ªå­—æ®µ\n    bytes pwd = 2;\n}\n```\n# ä¸‰ç§ç±»å‹\n\n1. æ•°æ®\n2. åˆ—è¡¨ï¼ˆæ•°ç»„ï¼‰\n3. æ˜ å°„è¡¨ï¼ˆmapï¼‰\n# åµŒå¥—ç±»ä¸­çš„å±æ€§æ–¹æ³•\nå¦‚æœæ˜¯åµŒå¥—ç±»ï¼Œæ¯”å¦‚æˆ‘ä»¬å®šä¹‰çš„ResultCodeï¼Œé‚£ä¹ˆè¿™ä¸ªå­ç±»çš„æ¯ä¸€ä¸ªå±æ€§çš„æ–¹æ³•æ˜¯`mutable_xxx()`ï¼Œè¿™ä¸ªè¿”å›çš„æŒ‡é’ˆæ˜¯éconstçš„ã€‚æ™®é€šçš„`xxx()`æ–¹æ³•è¿”å›çš„æ˜¯constå€¼ï¼Œä¸å¯ä¿®æ”¹ã€‚\n```cpp\n#include \"test.pb.h\"\n#include <iostream>\nusing namespace xcg;\nint main()\n{\n    LoginResponse rsp;\n    ResultCode *rc = rsp.mutable_result();\n    rc->set_errcode(0);\n    rc->set_errmsg(\"ç™»é™†å¤„ç†å¤±è´¥\");\n    GetFriendListsResponse rsp2;\n    ResultCode *rc2 = rsp2.mutable_result();\n    rc2->set_errcode(0);\n    rc2->set_errmsg(\"æˆåŠŸ\");\n\n    User * user1 = rsp2.add_friend_list();\n    user1->set_name(\"zhang san\");\n    user1->set_age(20);\n    user1->set_sex(User::MAN);\n    User * user2 = rsp2.add_friend_list();\n    user2->set_name(\"li si\");\n    user2->set_age(22);\n    user2->set_sex(User::WOMAN);\n\n    std::cout << rsp2.friend_list_size() << std::endl;\n\n}\n```\n# åˆ—è¡¨ - repeated\n\n```protobuf\nmessage GetFriendListsRequest\n{\n    uint32 userid = 1;\n}\nmessage GetFriendListsResponse\n{\n    int32 errcode = 1;\n    bytes errmsg = 2;\n    bool success = 3;\n}\n```\n\n> å†™åˆ°æ­¤ï¼Œæˆ‘ä»¬å‘ç°ï¼Œä¸åŒçš„å“åº”ç±»å¯èƒ½ç”¨åˆ°é‡å¤çš„å±æ€§ï¼Œå³errcodeå’Œerrmsgï¼Œå¯ä»¥æŠ½è±¡å°è£…ä¸ºä¸€ä¸ªResultCodeç±»å‹ã€‚\n\n```protobuf\nmessage ResultCode\n{\n    int32 errcode = 1;\n    bytes errmsg = 2;\n}\n```\näºæ˜¯ï¼Œå“åº”ç±»å¯ä»¥æ”¹ä¸ºï¼š\n```protobuf\nmessage LoginResponse\n{\n    ResultCode result = 1;\n    bool success = 2;\n}\nmessage GetFriendListResponse\n{\n    ResultCode result = 1;\n    // ...\n    bool success;\n}\n```\n\n## User\n\nå…¶ä¸­æšä¸¾çš„0å’Œ1ä¸ä»£è¡¨å­—æ®µçš„é¡ºåºï¼Œè€Œæ˜¯å’Œæ™®é€šè¯­è¨€ä¸€æ ·çš„å®šä¹‰æ–¹æ³•ï¼Œä»0å¼€å§‹ã€‚\n```protobuf\nmessage User\n{\n    bytes name = 1;\n    uint32 age = 2;\n    enum Sex\n    {\n        MAN = 0;\n        WOMAN = 1;\n    }\n    Sex sex = 3;\n}\n```\n\n## GetFriendListsResponse - ä½¿ç”¨åˆ—è¡¨å­˜å‚¨\nåˆ—è¡¨éœ€è¦ä½¿ç”¨repeatedå…³é”®å­—ä»£è¡¨ã€‚\n\n```protobuf\nmessage GetFriendListResponse\n{\n    ResultCode result = 1;\n    repeated User friend_list = 2; // åˆ—è¡¨ï¼ˆæ•°ç»„ï¼‰ç±»å‹\n}\n```\n\n## åˆ—è¡¨ç±»çš„å±æ€§æ–¹æ³•\n## xxx_size() - è¿”å›åˆ—è¡¨å¤§å°\n## add_xxx() - æ·»åŠ ã€è¿”å›ä¸€ä¸ªå¯å†™å…ƒç´ \nå¯ä»¥çœ‹åˆ°ï¼Œå¯¹äº`repeated`ç±»å‹ï¼Œå³åˆ—è¡¨ç±»å‹ï¼Œéƒ½ç”Ÿæˆäº†`add_xxx()`æ–¹æ³•ã€‚å¾€åˆ—è¡¨é‡Œå¢åŠ ä¸€ä¸ªç©ºå…ƒç´ ï¼Œå¹¶è¿”å›è¯¥å…ƒç´ çš„åœ°å€ã€‚æˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚\n\n```cpp\n::xcg::User* add_friend_list();\n```\n\n## xxx(int) - è¿”å›æŸä¸‹æ ‡å¤„çš„åªè¯»å…ƒç´ \nåˆ—è¡¨ç±»å‹ï¼Œæœ‰ä¸€ä¸ª`xxx(int)`æ–¹æ³•ã€‚å¯ä»¥è¿”å›åªè¯»æ•°æ®ã€‚ï¼ˆè¿”å›ä¸€ä¸ªconstå¼•ç”¨ï¼‰\n\n```cpp\nconst ::xcg::User& friend_list(int index) const;\n```\n\nç”¨æ­¤æ–¹æ³•ç»“åˆ`friend_list_size`æ–¹æ³•ï¼Œå¯ä»¥éå†åˆ—è¡¨ä¸­çš„å…ƒç´ ã€‚\n\n## ä¿®æ”¹protobufè‡ªå®šä¹‰ç±»å‹æˆå‘˜çš„æ–¹å¼\n\nå‰é¢è‡ªå®šä¹‰äº†ResultCodeï¼Œä½†æ˜¯åœ¨ç¼–å†™cppä»£ç æ—¶ï¼Œå‘ç°å…¶æ²¡æœ‰ç”Ÿæˆ`set_result`æ–¹æ³•ï¼Œåªæœ‰`result`æ–¹æ³•ï¼Œæ­¤æ–¹æ³•è¿”å›çš„æ˜¯å¯¹åº”ç±»å‹çš„å¸¸å¼•ç”¨ã€‚è¿™è¯´æ˜è‡ªå®šä¹‰çš„ç±»å¯¹è±¡ç»Ÿä¸€éƒ½è§†ä¸ºconstç±»å‹ã€‚å¹¸äºçš„æ˜¯ï¼Œè¿˜æä¾›äº†ä¸€ä¸ªæ–¹æ³•æ˜¯`mutable_result`æ–¹æ³•ï¼Œè¿”å›çš„æ˜¯æ™®é€šæŒ‡é’ˆï¼Œå¯ç”¨æ­¤æŒ‡é’ˆå†™å…¥æ•°æ®ã€‚\n\n```cpp\nconst ::xcg::ResultCode& result() const;\n::xcg::ResultCode* mutable_result();\n```\n\næ‰€ä»¥ï¼Œä¿®æ”¹è‡ªå®šä¹‰ç±»å‹æˆå‘˜çš„æ­£ç¡®æ–¹å¼ï¼š\n\n```cpp\nint main()\n{\n    LoginResponse rsp;\n    ResultCode * resultCode = rsp.mutable_result();\n    resultCode->set_errcode(1);\n    resultCode->set_errmsg(\"ç™»å½•å¤±è´¥\");\n}\n```\n\n# æ˜ å°„è¡¨ - map\n\n```protobuf\nmessage LoginRequest\n{\n    bytes name = 1;\n    bytes pwd = 2;\n    map<int32, string> test = 3;\n}\n```\n\n# å®šä¹‰æè¿°rpcæ–¹æ³•çš„ç±»å‹ - service\nserviceæœ¬è´¨ä¸Šæ˜¯ç»§æ‰¿äº†`::google::protobuf::Service`ç±»ï¼Œç”Ÿæˆäº†serviceåŒ…å«çš„rpcæ–¹æ³•ã€‚è¿˜æä¾›äº†ä¸€ä¸ªè¿”å›æœåŠ¡æè¿°ç¬¦çš„æ–¹æ³•ã€‚\n![](../../images/mprpc_protobuf/image-20250713011313148.png)\nç”Ÿæˆçš„è¿™ä¸ªUserServiceRpcç±»ä¸ç”¨å¡«å‚æ•°ï¼Œæœ‰é»˜è®¤æ„é€ ã€‚æ­¤ç±»å±äºæœåŠ¡æä¾›è€…ï¼ˆcalleeï¼‰ã€‚å…¶ä¸­çš„æ–¹æ³•éƒ½æ˜¯è™šå‡½æ•°ã€‚\nè¿˜å¯¹åº”ç”Ÿæˆäº†å¸¦`_Stub`åç¼€çš„ç±»ã€‚ç»§æ‰¿äºä¸Šé¢è¿™ä¸ªä¸å¸¦åç¼€çš„ç±»ã€‚éœ€è¦å¡«å†™ä¸€ä¸ª`RpcChannel*`æŒ‡é’ˆä½œä¸ºæˆå‘˜å˜é‡è¿›è¡Œæ„é€ ã€‚æ²¡æœ‰é»˜è®¤æ„é€ ã€‚æ­¤ç±»å±äºæœåŠ¡è°ƒç”¨è€…ï¼ˆcallerï¼‰ã€‚ç”±äºç»§æ‰¿çš„æ˜¯ä¸Šé¢è¿™ä¸ªç±»ï¼Œå…¶ä¸­çš„æ–¹æ³•ä¹Ÿæ˜¯è™šå‡½æ•°ã€‚\nè¿™ä¸ª`_Stub`ç±»ä¸­çš„æ–¹æ³•å®ç°éƒ½æ˜¯é€šè¿‡è°ƒç”¨channelçš„CallMethodæ–¹æ³•è¿›è¡Œçš„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°éƒ½æ˜¯`descriptor()->method(n)`ï¼Œnä¸ºrpcæ–¹æ³•çš„é¡ºåºå·ã€‚\nè¿™ä¸ªRpcChannelç±»æ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œå…¶ä¸­çš„CallMethodæ˜¯çº¯è™šæ–¹æ³•ã€‚\néœ€è¦æˆ‘ä»¬å»å®ç°ä¸€ä¸ªMyRpcChannelï¼Œå¹¶å®ç°å…·ä½“çš„CallMethodã€‚\n## å‰è¨€\nåœ¨åˆ†å¸ƒå¼æ¡†æ¶ä¸­ï¼Œæœ€ä¸»è¦è§£å†³çš„é—®é¢˜å°±æ˜¯è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ã€‚\nç›´ç™½ä¸€ç‚¹ï¼Œserver1æƒ³è¦è°ƒç”¨å¦ä¸€ä¸ªä¸»æœºä¸Šserver2çš„æ–¹æ³•ã€‚\nä¸ä»…ä»…éœ€è¦ä¼ è¯·æ±‚å‚æ•°ï¼Œserver1è¿˜éœ€è¦è¯´æ˜è‡ªå·±æƒ³è¦è°ƒç”¨å“ªä¸ªæ–¹æ³•ã€‚æ€»ä¹‹ï¼Œéœ€è¦ä¼ æ–¹æ³•åå­—æ ‡è¯†ã€è¯·æ±‚å‚æ•°ã€‚\nprotobufçš„æ ¸å¿ƒåŠŸèƒ½å®šä½åœ¨äºå¯¹å‚æ•°çš„**åºåˆ—åŒ–ã€ååºåˆ—åŒ–**ã€‚\nç¬¬äºŒä¸ªæ ¸å¿ƒåŠŸèƒ½å°±æ˜¯ï¼Œå¸®æˆ‘ä»¬åŒºåˆ†è°ƒç”¨å“ªä¸ªæ–¹æ³•ã€‚ä½†æ˜¯è¦æ˜ç™½çš„æ˜¯ï¼Œprotobufæœ¬èº«ä¸æä¾›ä»»ä½•çš„RPCé€šä¿¡åŠŸèƒ½ï¼Œå®ƒåªæ˜¯**å¯¹æ–¹æ³•è¿›è¡Œæè¿°**ã€‚\n## rpcå…³é”®å­—ï¼šç¤ºä¾‹\n```protobuf\nrpc æ–¹æ³•å(messageç±»å‹) returns(messageç±»å‹);\n```\n\n```protobuf\nservice UserServiceRpc\n{\n    rpc Login(LoginRequest) returns(LoginResponse);\n    rpc GetFriendList(GetFriendListRequest) returns(GetFriendListResponse);\n}\n```\n## optionå…³é”®å­—ï¼šç¤ºä¾‹\n\nå¦‚æœåªæ˜¯å†™äº†ä¸Šé¢çš„ä»£ç ï¼Œç”¨protocç¼–è¯‘ï¼Œé»˜è®¤æ˜¯ä¸ä¼šç”Ÿæˆæˆ‘ä»¬å£°æ˜çš„æ‰€æœ‰serviceæœåŠ¡ç±»å’Œrpcæ–¹æ³•æè¿°çš„ã€‚\nè¦ç”Ÿæˆï¼Œéœ€è¦åœ¨protoæ–‡ä»¶ä¸­æ˜¾å¼å£°æ˜optionè¯­å¥ã€‚\n\n```protobuf\noption cc_generic_services = true;\n```\n\nä¸Šé¢è¿™å¥è¡¨ç¤ºï¼šç”Ÿæˆæ‰€æœ‰å®šä¹‰çš„serviceæœåŠ¡ç±»å’Œrpcæ–¹æ³•æè¿°ã€‚\n\n## æœåŠ¡ç±»å’Œrpcæ–¹æ³•æè¿°ç±»\n\nç»è¿‡ç¼–è¯‘é“¾æ¥åï¼Œæ–°ç”Ÿæˆçš„`pb.h`æ–‡ä»¶ä¸­ï¼š\n\nç”Ÿæˆäº†`UserServiceRpc`ç±»ã€`UserServiceRpc_Stub`ç±»ã€‚\n\næœåŠ¡ç±»ï¼Œæ­¤ä¾‹ä¸º`UserServiceRpc`ï¼Œç»§æ‰¿äº`::google::protobuf::Service`ã€‚\n\nå¹¶ä¸”å…¶ä¸­ç”Ÿæˆäº†protobufæ–‡ä»¶ä¸­å®šä¹‰çš„è‡ªå®šä¹‰æ–¹æ³•ï¼š\n\n1. `virtual void Login(...)`\n2. `virtual void GetFriendList(...)`\n\nè¿˜æœ‰è·å–rpcæ–¹æ³•æè¿°çš„`GetDescriptor`æ–¹æ³•ï¼š\n\n```cpp\nconst ::PROTOBUF_NAMESPACE_ID::ServiceDescriptor* GetDescriptor();\n```\n\nè¯¥æè¿°åŒ…æ‹¬ï¼šæœåŠ¡çš„åå­—ã€æœåŠ¡åŒ…å«çš„æ–¹æ³•ï¼ˆåŒ…æ‹¬è¯¥æ–¹æ³•æ˜¯å±äºå“ªä¸ªç±»çš„ï¼‰ã€‚\n\nå®é™…ä¸Šï¼Œç±»ä¼¼äº`UserServiceRpc`è¿™ä¸ªç±»ï¼Œåœ¨åˆ†å¸ƒå¼æ¡†æ¶ä¸­æ˜¯calleeçš„è§’è‰²ï¼Œå……å½“RPC Service Providerï¼Œå³æœåŠ¡æä¾›è€…ã€‚\n\n## Stubç±» - ç»§æ‰¿äºServiceç±»\n\n```cpp\nclass UserServiceRpc_Stub : public UserServiceRpc\n```\n\nå®é™…ä¸Šï¼ŒStubåœ¨åˆ†å¸ƒå¼æ¡†æ¶ä¸­æ˜¯callerï¼Œå……å½“Service Consumerï¼Œå³æœåŠ¡æ¶ˆè´¹è€…ã€‚\n\n1. å¸¦å‚æ„é€ å‡½æ•°\n   ```cpp\n   UserServiceRpc_Stub(::PROTOBUF_NAMESPACE_ID::RpcChannel * channel);\n   ```\n\n2. æˆå‘˜å˜é‡ï¼š`::PROTOBUF_NAMESPACE_ID::RpcChannel * channel_`\n\nå…¶æ¬¡ï¼Œè¯¥ç±»ä¹Ÿç”Ÿæˆäº†protobufæ–‡ä»¶ä¸­å®šä¹‰çš„è‡ªå®šä¹‰æ–¹æ³•ï¼š\n\n1. `void Login(...)`\n2. `void GetFriendList(...)`\n\næ³¨æ„ï¼Œè™½ç„¶æ²¡å†™æ˜virtualï¼Œä½†å› ä¸ºç»§æ‰¿äºUserServiceRpcï¼Œæ‰€ä»¥åŒæ ·æ˜¯è™šå‡½æ•°ï¼Œåªä¸è¿‡ç”ŸæˆStubç±»æ—¶è‡ªåŠ¨å®ç°äº†è¯¥å‡½æ•°ã€‚\n\n```cpp\nvoid UserServiceRpc::Login(::PROTOBUF_NAMESPACE_ID::RpcController* controller,\n                           const ::xcg::LoginRequest*,\n                           ::xcg::LoginResponse*,\n                           ::google::protobuf::Closure* done)\n{\n  channel_->CallMethod(descriptor()->method(0),\n                       controller, request, response, done);\n}\n\nvoid UserServiceRpc::GetFriendList(::PROTOBUF_NAMESPACE_ID::RpcController* controller,\n                                   const ::xcg::GetFriendListRequest*,\n                                   ::xcg::GetFriendListResponse*,\n                                   ::google::protobuf::Closure* done)\n{\n  channel_->CallMethod(descriptor()->method(1),\n                       controller, request, response, done);\n}\n```\n\n## RpcChannel\n\n```cpp\nclass PROTOBUF_EXPORT RpcChannel\n```\n\nåœ¨ä¸Šé¢çš„Stubç±»ä¸­çš„â€œç”Ÿæˆå‡½æ•°â€ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæœ€ç»ˆè°ƒçš„æ˜¯å…¶æ„é€ æ—¶ä¼ å…¥çš„channelå¯¹è±¡çš„CallMethodæ–¹æ³•ã€‚è€ŒRpcChannelä¸­çš„CallMethodæ˜¯ä¸ªçº¯è™šå‡½æ•°ï¼š\n\n```cpp\nvirtual void CallMethod(const MethodDescriptor* method,\n                        RpcController* controller, const Message* request,\n                        Message* response, Closure* done) = 0;\n```\n\nè¯´æ˜ï¼Œéœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªMyRpcChannelï¼Œç»§æ‰¿äºRpcChannelï¼Œå¹¶å®ç°å…·ä½“çš„CallMethodã€‚åœ¨æ„é€ Stubç±»å¯¹è±¡æ—¶ï¼Œä¼ å…¥æ­¤MyRpcChannelã€‚\n\n## æ€»ç»“\n\næ•´ä¸ªRPCæ¡†æ¶çš„æµç¨‹ï¼šï¼ˆä»¥å®ŒæˆLoginä¸¾ä¾‹ï¼‰\n\n1. Userè°ƒç”¨`UserServiceRpc_Stub`ç±»ä¸­çš„`Login`ã€‚\n2. `UserServiceRpc_Stub`ç±»å°±å……å½“ä¸­é—´è°ƒç”¨è€…ï¼Œæœ€ç»ˆè°ƒç”¨å…¶RpcChannelæˆå‘˜çš„å…·ä½“å®ç°çš„CallMethodæ–¹æ³•ã€‚\n3. ä¸åŒçš„Stubçš„æˆå‘˜å‡½æ•°ï¼Œå¯¹åº”ç€ä¸€ä¸ªç‰¹å®šçš„method IDï¼Œæ¯”å¦‚Loginï¼Œå¯¹åº”`descriptor()->method(0)`ï¼ŒGetFriendListï¼Œå¯¹åº”`descriptor()->method(1)`ã€‚\n4. å…·ä½“çš„methodï¼Œéœ€è¦Rpc Service Provideræ¥æä¾›ï¼Œå³`UserServiceRpc`ç±»ã€‚åŒæ—¶ï¼ŒRpcæ–¹æ³•çš„å…·ä½“æè¿°ä¹Ÿä¼šåœ¨æ­¤ç±»ä¸­å­˜å‚¨ã€‚æè¿°åŒ…æ‹¬ï¼šæœåŠ¡çš„åå­—ã€æœåŠ¡åŒ…å«çš„æ–¹æ³•ï¼ˆåŒ…æ‹¬è¯¥æ–¹æ³•æ˜¯å±äºå“ªä¸ªç±»çš„ï¼‰ã€‚\n5. æœ€ç»ˆï¼Œåœ¨è¿œç«¯çš„Serverä¸Šæ‰§è¡Œè¯¥methodæ–¹æ³•ã€‚\n6. Userçš„è°ƒç”¨è¯·æ±‚åœ¨è¿œç«¯Serverå¤„ç†å®Œæˆåï¼Œç»“æœå°±ä»Serverè¿›è¡Œå›ä¼ ã€‚\n\n# æœ¬åœ°æœåŠ¡å‘å¸ƒä¸ºrpcæœåŠ¡\n\nè¿œç«¯ï¼ŒæœåŠ¡çš„æä¾›æ–¹ï¼Œæœ¬åœ°æœåŠ¡ç±»ï¼Œå¦‚ä½•å¯¹æ¥åˆ°rpcæ¡†æ¶ï¼Ÿ\n\n```cpp\n#include<iostream>\n\n#include\"user.pb.h\"\n\nclass UserService : public xcg::UserServiceRpc\n{\npublic:\n    bool Login(std::string name, std::string password)\n    {   \n        std::cout << \"doing local service: Login\" << std::endl;\n        std::cout << \"name: \" << name << \", password: \" << password << std::endl;\n        return true;\n    }   \n    // Override\n    void Login(::PROTOBUF_NAMESPACE_ID::RpcController* controller,\n               const ::xcg::LoginRequest* request,\n               ::xcg::LoginResponse* response,\n               ::google::protobuf::Closure* done)\n    {   \n        // local process\n        std::string name = request->name();\n        std::string password = request->password();\n\n        bool login_result = Login(name, password);\n    \n        // response content\n        xcg::Result * result = response->mutable_result();\n        result->set_errcode(0);\n        result->set_errmsg(\"ok\");\n        response->set_success(login_result);\n\n        // callback to response\n        done->Run();\n    }   \n};\n```\n\næœ¬åœ°æœåŠ¡ç±»ï¼Œç»§æ‰¿äºUserServiceRpcï¼Œéœ€è¦å®ç°å…¶ä¸­çš„`Login(...)`æ–¹æ³•ï¼Œå³protobufä¸­å®šä¹‰çš„rpcæ–¹æ³•æè¿°ã€‚\n\n1. ä»¥æ­¤ä½œä¸ºrpcè¿œç«¯è°ƒç”¨çš„æ¥å£ï¼›\n2. åœ¨æ­¤æ¥å£é‡Œï¼Œè¿›è¡Œè¿œç«¯å‚æ•°çš„è·å–ï¼›\n3. ç„¶åå¯¹è¿™äº›å‚æ•°è¿›è¡Œæœ¬åœ°å¤„ç†ï¼›\n4. å¤„ç†åï¼Œè¿›è¡Œå“åº”ä½“çš„å¡«å……ï¼›\n5. è°ƒç”¨`done->Run()`ã€‚è¿›è¡Œå›è°ƒã€‚ä¸»è¦å®Œæˆå“åº”ä½“çš„åºåˆ—åŒ–ä»¥åŠå‘é€å“åº”ï¼ˆç”±rpcæ¡†æ¶å®Œæˆï¼‰ã€‚\n\n## Closure\n\ndoneæ˜¯Closureç±»å‹ï¼Œæ­¤ç±»ä¸ºæŠ½è±¡ç±»ï¼Œå†…å®¹å¾ˆç®€å•ï¼Œæœ‰ä¸€ä¸ªRunçº¯è™šå‡½æ•°ï¼š\n\n```cpp\nclass PROTOBUF_EXPORT Closure\n{\npublic:\n    Closure() {}\n    virtual ~Closure();\n    \n    virtual void Run() = 0;\n    \nprivate:\n    GOOGLE_DISALLOW_EVIL_CONSTRUCTORS(Closure);\n};\n```\n\nè¯´æ˜ï¼Œéœ€è¦å…ˆè‡ªå®šä¹‰ä¸€ä¸ªMyClosureï¼Œå…·ä½“å®ç°Runæ–¹æ³•é€»è¾‘ï¼Œå†åœ¨å¤–éƒ¨è°ƒç”¨Loginæ—¶ä¼ å…¥æ­¤ClosureæŒ‡é’ˆã€‚\n\n","categories":["é¡¹ç›®","rpc"]},{"title":"Android_Fragment","url":"/Android/Android_Fragment/","content":"\n# ç¢ç‰‡\n\nç¢ç‰‡ï¼ˆFragmentï¼‰æ˜¯ä¸€ç§å¯ä»¥åµŒå…¥åœ¨æ´»åŠ¨å½“ä¸­çš„UIç‰‡æ®µï¼Œå®ƒèƒ½è®©ç¨‹åºæ›´åŠ åˆç†å’Œå……åˆ†åœ°åˆ©ç”¨å¤§å±å¹•çš„ç©ºé—´ï¼Œå› è€Œåœ¨å¹³æ¿ä¸Šåº”ç”¨å¾—éå¸¸å¹¿æ³›ã€‚è™½ç„¶ç¢ç‰‡å¯¹æ˜¯å…¨æ–°çš„æ¦‚å¿µï¼Œä½†å®ƒå’Œæ´»åŠ¨å®åœ¨æ˜¯å¤ªåƒäº†ï¼ŒåŒæ ·éƒ½èƒ½åŒ…å«å¸ƒå±€ï¼Œæœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸã€‚ç”šè‡³å¯ä»¥å°†ç¢ç‰‡ç†è§£æˆä¸€ä¸ªè¿·ä½ å‹çš„æ´»åŠ¨ï¼Œè™½ç„¶è¿™ä¸ªè¿·ä½ å‹çš„æ´»åŠ¨æœ‰å¯èƒ½å’Œæ™®é€šçš„æ´»åŠ¨æ˜¯ä¸€æ ·å¤§çš„ã€‚\n\né‚£ä¹ˆç©¶ç«Ÿè¦å¦‚ä½•ä½¿ç”¨ç¢ç‰‡æ‰èƒ½å……åˆ†åœ°åˆ©ç”¨å¹³æ¿å±å¹•çš„ç©ºé—´å‘¢ï¼Ÿæƒ³è±¡æˆ‘ä»¬æ­£åœ¨å¼€å‘ä¸€ä¸ªæ–°é—»åº”ç”¨ï¼Œå…¶ä¸­ä¸€ä¸ªç•Œé¢ä½¿ç”¨RecyclerViewå±•ç¤ºäº†ä¸€ç»„æ–°é—»çš„æ ‡é¢˜ï¼Œå½“ç‚¹å‡»äº†å…¶ä¸­ä¸€ä¸ªæ ‡é¢˜æ—¶ï¼Œå°±æ‰“å¼€å¦ä¸€ä¸ªç•Œé¢æ˜¾ç¤ºæ–°é—»çš„è¯¦ç»†å†…å®¹ã€‚å¦‚æœæ˜¯åœ¨æ‰‹æœºä¸­è®¾è®¡ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ–°é—»æ ‡é¢˜åˆ—è¡¨æ”¾åœ¨ä¸€ä¸ªæ´»åŠ¨ä¸­ï¼Œå°†æ–°é—»çš„è¯¦ç»†å†…å®¹æ”¾åœ¨å¦ä¸€ä¸ªæ´»åŠ¨ä¸­ã€‚\n\n![image-20220819172155397](../../images/Android_Fragment/image-20220819172155397.png)\n\nå¯æ˜¯å¦‚æœåœ¨å¹³æ¿ä¸Šä¹Ÿè¿™ä¹ˆè®¾è®¡ï¼Œé‚£ä¹ˆæ–°é—»æ ‡é¢˜åˆ—è¡¨å°†ä¼šè¢«æ‹‰é•¿è‡³å¡«å……æ»¡æ•´ä¸ªå¹³æ¿çš„å±å¹•ï¼Œè€Œæ–°é—»çš„æ ‡é¢˜ä¸€èˆ¬éƒ½ä¸ä¼šå¤ªé•¿ï¼Œè¿™æ ·å°†ä¼šå¯¼è‡´ç•Œé¢ä¸Šæœ‰å¤§é‡çš„ç©ºç™½åŒºåŸŸã€‚\n\n![image-20220819172231085](../../images/Android_Fragment/image-20220819172231085.png)\n\nå› æ­¤ï¼Œæ›´å¥½çš„è®¾è®¡æ–¹æ¡ˆæ˜¯å°†æ–°é—»æ ‡é¢˜åˆ—è¡¨ç•Œé¢å’Œæ–°é—»è¯¦ç»†å†…å®¹ç•Œè€Œåˆ†åˆ«æ”¾åœ¨ä¸¤ä¸ªç¢ç‰‡ä¸­ï¼Œç„¶ååœ¨åŒä¸€ä¸ªæ´»åŠ¨é‡Œå¼•å…¥è¿™ä¸¤ä¸ªç¢ç‰‡ï¼Œè¿™æ ·å°±å¯ä»¥å°†å±å¹•ç©ºé—´å……åˆ†åœ°åˆ©ç”¨èµ·æ¥äº†ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚\n\n![image-20220819172306008](../../images/Android_Fragment/image-20220819172306008.png)\n\n# ç¢ç‰‡çš„ä½¿ç”¨æ–¹å¼\n\næ–°å»ºä¸€ä¸ªFragmentTesté¡¹ç›®ã€‚\n\nåœ¨ä¸€ä¸ªæ´»åŠ¨å½“ä¸­æ·»åŠ ä¸¤ä¸ªç¢ç‰‡ï¼Œä½¿å…¶å¹³åˆ†æ´»åŠ¨ç©ºé—´ã€‚\n\næ–°å»ºä¸€ä¸ªå·¦ä¾§Fragmentçš„å¸ƒå±€`left_fragment.xml`ï¼Œæ­¤å¸ƒå±€éå¸¸ç®€å•ï¼Œåªæ”¾ç½®äº†ä¸€ä¸ªæŒ‰é’®ï¼Œæ°´å¹³å±…ä¸­æ˜¾ç¤ºï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:orientation=\"vertical\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n    <Button android:id=\"@+id/button\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_gravity=\"center_horizontal\"\n        android:text=\"Button\">\n\n    </Button>\n\n</LinearLayout>\n```\n\nç„¶åæ–°å»ºå³ä¾§æ˜¯Fragmentçš„å¸ƒå±€`right_fragment.xml`ï¼Œå°†æ­¤å¸ƒå±€èƒŒæ™¯è‰²è®¾ç½®ä¸ºç»¿è‰²ï¼Œæ”¾ç½®äº†ä¸€ä¸ªTextViewç”¨äºæ˜¾ç¤ºä¸€æ®µæ–‡æœ¬ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:orientation=\"vertical\"\n    android:background=\"#00ff00\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n    <TextView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_gravity=\"center_horizontal\"\n        android:textSize=\"20sp\"\n        android:text=\"This is right fragment\">\n    </TextView>\n\n</LinearLayout>\n```\n\næ¥ç€æ–°å»ºä¸€ä¸ªLeftFragmentç±»ï¼Œå¹¶è®©ä»–ç»§æ‰¿è‡ªFragmentã€‚\n\n> æ³¨æ„ï¼Œè¿™é‡Œå¯èƒ½ä¼šæœ‰ä¸¤ä¸ªä¸åŒåŒ…ä¸‹çš„Fragmentä¾›ä½ é€‰æ‹©ï¼Œä¸€ä¸ªæ˜¯ç³»ç»Ÿå†…ç½®çš„`android.app.Fragment`ï¼Œä¸€ä¸ªæ˜¯AndroidXåº“ä¸­çš„`androidx.fragment.app.Fragment`ã€‚è¿™é‡Œè¯·ä¸€å®šä½¿ç”¨AndoridXåº“ä¸­çš„Fragmentï¼Œå› ä¸ºå®ƒå¯ä»¥è®©ç¢ç‰‡çš„ç‰¹æ€§åœ¨æ‰€æœ‰Androidç³»ç»Ÿç‰ˆæœ¬ä¸­ä¿æŒä¸€è‡´ã€‚è€Œç³»ç»Ÿå†…ç½®çš„fragmentåœ¨Android 9.0ä¸­å·²è¢«åºŸå¼ƒã€‚ä½¿ç”¨AndroidXåº“ä¸­çš„Fragmentå¹¶ä¸éœ€è¦åœ¨build.gradleæ–‡ä»¶ä¸­æ·»åŠ é¢å¤–çš„ä¾èµ–ï¼Œåªéœ€åœ¨åˆ›å»ºæ–°é¡¹ç›®æ—¶å‹¾é€‰äº†`Use androidx.* artifacts`é€‰é¡¹ï¼ŒAndroid Studioä¼šè‡ªåŠ¨å¸®ä½ å¯¼å…¥å¿…è¦çš„AndroidXåº“ã€‚\n\nç¼–å†™ä¸€ä¸‹LeftFragmentä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\npublic class LeftFragment extends Fragment {\n    @Override\n    public View onCreateView(LayoutInflater inflater, ViewGroup container,\n                             Bundle savedInstanceState) {\n        View view = inflater.inflate(R.layout.left_fragment, container, false);\n        return view;\n    }\n    \n}\n```\n\nè¿™é‡Œä»…ä»…æ˜¯é‡å†™äº†Fragmentçš„onCreateViewæ–¹æ³•ï¼Œç„¶ååœ¨è¿™ä¸ªæ–¹æ³•ä¸­é€šè¿‡Layoutlnflaterçš„inflateæ–¹æ³•å°†åˆšæ‰å®šä¹‰çš„left_fragmentå¸ƒå±€åŠ¨æ€åŠ è½½è¿›æ¥ï¼Œæ•´ä¸ªæ–¹æ³•ç®€å•æ˜äº†ã€‚æ¥ç€ç”¨åŒæ ·çš„æ–¹æ³•å†æ–°å»ºä¸€ä¸ª RightFragmentï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\npublic class RightFragment extends Fragment {\n    @Override\n    public View onCreateView(LayoutInflater inflater, ViewGroup container,\n                             Bundle savedInstanceState) {\n        View view = inflater.inflate(R.layout.right_fragment, container, false);\n        return view;\n    }\n}\n```\n\nä¸‹æ¥ä¿®æ”¹`activity_main.xml`ä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:orientation=\"horizontal\"> <!-- æ°´å¹³æ’å¸ƒ -->\n    <fragment android:id=\"@+id/leftFrag\"\n        android:layout_width=\"0dp\"\n        android:layout_height=\"match_parent\"\n        android:name=\"com.example.fragmenttest.LeftFragment\"\n        android:layout_weight=\"1\">\n\n    </fragment>\n    <fragment android:id=\"@+id/rightFrag\"\n        android:layout_width=\"0dp\"\n        android:layout_height=\"match_parent\"\n        android:name=\"com.example.fragmenttest.RightFragment\"\n        android:layout_weight=\"1\">\n\n    </fragment>\n</LinearLayout>\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†`<fragment>`æ ‡ç­¾åœ¨å¸ƒå±€ä¸­æ·»åŠ ç¢ç‰‡ï¼Œéœ€è¦é€šè¿‡`android:name`å±æ€§æ¥æ˜¾å¼æŒ‡æ˜è¦æ·»åŠ çš„ç¢ç‰‡ç±»åï¼Œæ³¨æ„ä¸€å®šè¦å°†ç±»çš„åŒ…åä¹ŸåŠ ä¸Šã€‚\n\nç°åœ¨è¿è¡Œä¸€ä¸‹ç¨‹åºï¼Œæ•ˆæœå¦‚å›¾æ‰€ç¤ºã€‚\n\n![image-20220819181016143](../../images/Android_Fragment/image-20220819181016143.png)\n\n# åŠ¨æ€æ·»åŠ ç¢ç‰‡\n\nå·²ç»å®è·µåœ¨å¸ƒå±€æ–‡ä»¶ä¸­æ·»åŠ ç¢ç‰‡ï¼Œä¸è¿‡ç¢ç‰‡çœŸæ­£çš„å¼ºå¤§ä¹‹å¤„åœ¨äºï¼Œå®ƒå¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€åœ°æ·»åŠ åˆ°æ´»åŠ¨å½“ä¸­ã€‚æ ¹æ®å…·ä½“æƒ…å†µæ¥åŠ¨æ€åœ°æ·»åŠ ç¢ç‰‡ï¼Œå°±å¯ä»¥å°†ç¨‹åºç•Œé¢å®šåˆ¶å¾—æ›´åŠ å¤šæ ·åŒ–ã€‚\næˆ‘ä»¬è¿˜æ˜¯åœ¨ä¸Šä¸€èŠ‚ä»£ç çš„åŸºç¡€ä¸Šç»§ç»­å®Œå–„ï¼Œæ–°å»º`another_right_fragment.xml`ï¼Œä»£ç å¦‚ä¸‹ï¼š\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:orientation=\"vertical\"\n    android:background=\"#ffff00\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n    <TextView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_gravity=\"center_horizontal\"\n        android:textSize=\"24sp\"\n        android:text=\"This is another right fragment\">\n        \n    </TextView>\n\n</LinearLayout>\n```\n\nè¿™ä¸ªå¸ƒå±€æ–‡ä»¶çš„ä»£ç å’Œ`right_fragment.xml`ä¸­çš„ä»£ç åŸºæœ¬ç›¸åŒï¼Œåªæ˜¯å°†èƒŒæ™¯è‰²æ”¹æˆäº†é»„è‰²ï¼Œå¹¶å°†æ˜¾ç¤ºçš„æ–‡å­—æ”¹äº†æ”¹ã€‚ç„¶åæ–°å»º`AnotherRightFragment`ä½œä¸ºå¦ä¸€ä¸ªå³ä¾§ç¢ç‰‡ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n","categories":["Android"]},{"title":"Android_Service","url":"/Android/Android_Service/","content":"\n# æœåŠ¡\n\næœåŠ¡æ˜¯Androidä¸­å®ç°ç¨‹åºåå°è¿è¡Œçš„è§£å†³æ–¹æ¡ˆï¼Œé€‚åˆä¸éœ€è¦å’Œç”¨æˆ·äº¤äº’è€Œä¸”é•¿æœŸè¿è¡Œçš„ä»»åŠ¡ã€‚æœåŠ¡çš„è¿è¡Œä¸ä¾èµ–äºä»»ä½•ç”¨æˆ·ç•Œé¢ï¼Œå³ä½¿ç¨‹åºè¢«åˆ‡æ¢åˆ°åå°ï¼Œæˆ–è€…ç”¨æˆ·æ‰“å¼€äº†å¦å¤–ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼ŒæœåŠ¡ä»ç„¶èƒ½å¤Ÿä¿æŒæ­£å¸¸è¿è¡Œã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæœåŠ¡å¹¶ä¸æ˜¯è¿è¡Œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹å½“ä¸­çš„ï¼Œè€Œæ˜¯ä¾èµ–äºåˆ›å»ºæœåŠ¡æ—¶æ‰€åœ¨çš„åº”ç”¨ç¨‹åºè¿›ç¨‹ã€‚å½“æŸä¸ªåº”ç”¨ç¨‹åºè¿›ç¨‹è¢«æ€æ‰æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºè¯¥è¿›ç¨‹çš„æœåŠ¡ä¹Ÿä¼šåœæ­¢è¿è¡Œã€‚å¦å¤–ï¼Œä¹Ÿä¸è¦è¢«æœåŠ¡çš„åå°æ¦‚å¿µæ‰€è¿·æƒ‘ï¼Œå®é™…ä¸ŠæœåŠ¡å¹¶ä¸ä¼šè‡ªåŠ¨å¼€å¯çº¿ç¨‹ï¼Œæ‰€æœ‰çš„ä»£ç éƒ½æ˜¯é»˜è®¤è¿è¡Œåœ¨ä¸»çº¿ç¨‹å½“ä¸­çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡çš„å†…éƒ¨æ‰‹åŠ¨åˆ›å»ºå­çº¿ç¨‹ï¼Œå¹¶åœ¨è¿™é‡Œæ‰§è¡Œå…·ä½“çš„ä»»åŠ¡ï¼Œå¦åˆ™å°±æœ‰å¯èƒ½å‡ºç°ä¸»çº¿ç¨‹è¢«é˜»å¡ä½çš„æƒ…å†µã€‚\n\n# å®šä¹‰ä¸€ä¸ªæœåŠ¡\n\næ–°å»ºä¸€ä¸ªServiceTesté¡¹ç›®ï¼Œç„¶åç‚¹å‡»`com.example.servicetest`ï¼Œ`New`ï¼Œ`Service`ï¼Œ`Service`ã€‚å°†æœåŠ¡å‘½åä¸º`MyService`ï¼ŒExportedå±æ€§è¡¨ç¤ºæ˜¯å¦å…è®¸å…¶ä»–ç¨‹åºè®¿é—®è¿™ä¸ªæœåŠ¡ï¼ŒEnabledå±æ€§è¡¨ç¤ºæ˜¯å¦å¯ç”¨è¿™ä¸ªæœåŠ¡ã€‚\n\nè§‚å¯ŸMyServiceä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\npublic class MyService extends Service {\n    public MyService() {\n        \n    }\n    @Override\n    public IBinder onBind(Intent intent) {\n        throw new UnsupportedOperationException(\"Not yet implemented\");\n    }\n}\n```\n\nå¯è§ï¼ŒMyServiceç»§æ‰¿è‡ªServiceç±»ã€‚\n\nonBindæ–¹æ³•ç‰¹åˆ«é†’ç›®ã€‚è¿™æ˜¯Serviceä¸­å”¯ä¸€çš„æŠ½è±¡æ–¹æ³•ï¼Œå¿…é¡»åœ¨å­ç±»ä¸­å®ç°ã€‚\n\næ—¢ç„¶æ˜¯å®šä¹‰ä¸€ä¸ªæœåŠ¡ï¼Œè‡ªç„¶åº”è¯¥åœ¨æœåŠ¡ä¸­å»å¤„ç†ä¸€äº›äº‹æƒ…ï¼Œå¤„ç†äº‹æƒ…çš„é€»è¾‘åº”è¯¥å†™åœ¨å“ªé‡Œï¼Ÿè¿™æ—¶ï¼Œå°±è¦é‡å†™Serviceä¸­çš„å¦å¤–çš„ä¸€äº›æ–¹æ³•ã€‚å¦‚ä¸‹ï¼š\n\n```java\npublic class MyService extends Service {\n    ...\n    @Override\n    public void onCreate() {\n        super.onCreate();\n    }\n    @Override\n    public int onStartCommand(Intent intent, int flags, int startId) {\n        return super.onStartCommand(intent, flags, startId);\n    }\n    @Override\n    public void onDestroy() {\n        super.onDestroy();\n    }\n}\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæˆ‘ä»¬åˆé‡å†™äº†onCreateã€onStartCommandå’ŒonDestroyè¿™3ä¸ªæ–¹æ³•ï¼Œå®ƒä»¬æ˜¯æ¯ä¸ªæœåŠ¡ä¸­æœ€å¸¸ç”¨åˆ°çš„3ä¸ªæ–¹æ³•äº†ã€‚å…¶ä¸­onCreateæ–¹æ³•ä¼šåœ¨æœåŠ¡åˆ›å»ºçš„æ—¶å€™è°ƒç”¨ï¼ŒonStartCommandæ–¹æ³•ä¼šåœ¨æ¯æ¬¡æœåŠ¡å¯åŠ¨çš„æ—¶å€™è°ƒç”¨ï¼ŒonDestroyæ–¹æ³•ä¼šåœ¨æœåŠ¡é”€æ¯çš„æ—¶å€™è°ƒç”¨ã€‚\n\né€šå¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›æœåŠ¡ä¸€æ—¦å¯åŠ¨å°±ç«‹åˆ»å»æ‰§è¡ŒæŸä¸ªåŠ¨ä½œï¼Œå°±å¯ä»¥å°†é€»è¾‘å†™åœ¨onStartCommandæ–¹æ³•é‡Œã€‚è€Œå½“æœåŠ¡é”€æ¯æ—¶ï¼Œæˆ‘ä»¬åˆåº”è¯¥åœ¨onDestroyæ–¹æ³•ä¸­å»å›æ”¶é‚£äº›ä¸å†ä½¿ç”¨çš„èµ„æºã€‚\n\nå¦å¤–éœ€è¦æ³¨æ„ï¼Œæ¯ä¸€ä¸ªæœåŠ¡éƒ½éœ€è¦åœ¨AndroidManifest.xmlæ–‡ä»¶ä¸­è¿›è¡Œæ³¨å†Œæ‰èƒ½ç”Ÿæ•ˆï¼Œè¿™æ˜¯Androidå››å¤§ç»„ä»¶å…±æœ‰çš„ç‰¹ç‚¹ã€‚æ‰“å¼€AndroidManifest.xmlæ–‡ä»¶ç§ä¸€ç§ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    package=\"com.example.servicetest\">\n    <application\n        android:allowBackup=\"true\"\n        android:icon=\"@mipmap/ic_launcher\"\n        android:label=\"@string/app_name\"\n        android:supportsRtl=\"true\"\n        android:theme=\"@style/AppTheme\">\n        ...\n        <service\n            android:name=\".MyService\"\n            android:enabled=\"true\"\n            android:exported=\"true\">\n        </service>\n    </application>\n</manifest>\n```\n\nè¿™æ ·çš„è¯ï¼Œå°±å·²ç»å°†ä¸€ä¸ªæœåŠ¡å®Œå…¨å®šä¹‰å¥½äº†ã€‚Exportedå±æ€§è¡¨ç¤ºæ˜¯å¦å…è®¸å…¶ä»–ç¨‹åºè®¿é—®è¿™ä¸ªæœåŠ¡ï¼ŒEnabledå±æ€§è¡¨ç¤ºæ˜¯å¦å¯ç”¨è¿™ä¸ªæœåŠ¡ã€‚\n\n# å¯åŠ¨å’Œåœæ­¢æœåŠ¡\n\nå®šä¹‰å¥½äº†æœåŠ¡ä¹‹åï¼Œæ¥ä¸‹æ¥å°±åº”è¯¥è€ƒè™‘å¦‚ä½•å»å¯åŠ¨ä»¥åŠåœæ­¢è¿™ä¸ªæœåŠ¡ã€‚å¯åŠ¨å’Œåœæ­¢ä¸»è¦æ˜¯å€ŸåŠ©Intentæ¥å®ç°ã€‚åœ¨ServiceTesté¡¹ç›®ä¸­å°è¯•å»å¯åŠ¨ä»¥åŠåœæ­¢MyServiceè¿™ä¸ªæœåŠ¡ã€‚\n\né¦–å…ˆï¼Œä¿®æ”¹`activity_main.xml`ä¸­çš„ä»£ç ã€‚æˆ‘ä»¬åœ¨å¸ƒå±€æ–‡ä»¶ä¸­åŠ å…¥äº†ä¸¤ä¸ªæŒ‰é’®ï¼Œåˆ†åˆ«æ˜¯ç”¨äºå¯åŠ¨æœåŠ¡å’Œåœæ­¢æœåŠ¡çš„ã€‚å¦‚ä¸‹ï¼š\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:orientation=\"vertical\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n    <Button\n        android:id=\"@+id/start_service\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Start Service\"/>\n    <Button\n        android:id=\"@+id/stop_service\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Stop Service\"/>\n</LinearLayout>\n```\n\nç„¶åä¿®æ”¹MainActivityä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\npublic class MainActivity extends AppCompatActivity implements View.OnClickListener {\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        Button startServiceBtn = (Button) findViewById(R.id.start_service);\n        Button stopServiceBtn = (Button) findViewById(R.id.stop_service);\n        startServiceBtn.setOnClickListener(this);\n        stopServiceBtn.setOnClickListener(this);\n    }\n    @Override\n    public void onClick(View v) {\n        switch (v.getId()) {\n            case R.id.start_service:\n                Intent startIntent = new Intent(this, MyService.class);\n                startService(startIntent);\n                break;\n            case R.id.stop_service:\n                Intent stopIntent = new Intent(this, MyService.class);\n                stopService(stopIntent);\n                break;\n            default:\n                break;\n        }\n    }\n}\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œåœ¨onCreateæ–¹æ³•ä¸­åˆ†åˆ«è·å–åˆ°äº†Start ServiceæŒ‰é’®å’ŒStop ServiceæŒ‰é’®çš„å®ä¾‹å¹¶ç»™å®ƒä»¬æ³¨å†Œäº†ç‚¹å‡»äº‹ä»¶ã€‚ç„¶ååœ¨Start ServiceæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶é‡Œï¼Œæˆ‘ä»¬æ„å»ºå‡ºäº†ä¸€ä¸ªIntentå¯¹è±¡ï¼Œå¹¶è°ƒç”¨startServiceæ–¹æ³•æ¥å¯åŠ¨MyServiceè¿™ä¸ªæœåŠ¡ã€‚åœ¨Stop SerivceæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶é‡Œï¼Œæˆ‘ä»¬åŒæ ·æ„å»ºå‡ºäº†ä¸€ä¸ªIntentå¯¹è±¡ï¼Œå¹¶è°ƒç”¨stopServiceæ–¹æ³•æ¥åœæ­¢MyServiceè¿™ä¸ªæœåŠ¡ã€‚\n\nstartServiceå’ŒstopServiceæ–¹æ³•éƒ½æ˜¯å®šä¹‰åœ¨Contextç±»ä¸­çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ´»åŠ¨é‡Œå¯ä»¥ç›´æ¥è°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚æ³¨æ„ï¼Œè¿™é‡Œå®Œå…¨æ˜¯ç”±æ´»åŠ¨æ¥å†³å®šæœåŠ¡ä½•æ—¶åœæ­¢çš„ï¼Œå¦‚æœæ²¡æœ‰ç‚¹å‡»Stop ServiceæŒ‰é’®ï¼ŒæœåŠ¡å°±ä¼šä¸€ç›´å¤„äºè¿è¡ŒçŠ¶æ€ã€‚é‚£æœåŠ¡æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•è®©è‡ªå·²åœæ­¢ä¸‹æ¥å‘¢ï¼Ÿå½“ç„¶å¯ä»¥ï¼Œåªéœ€è¦åœ¨MyServiceçš„ä»»ä½•ä¸€ä¸ªä½ç½®è°ƒç”¨stopSelfæ–¹æ³•å°±èƒ½è®©è¿™ä¸ªæœåŠ¡åœæ­¢ä¸‹æ¥äº†ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥åˆæœ‰ä¸€ä¸ªé—®é¢˜éœ€è¦æ€è€ƒäº†ï¼Œå¦‚ä½•è¯å®æœåŠ¡å·²ç»æˆåŠŸå¯åŠ¨æˆ–è€…åœæ­¢äº†å‘¢ï¼Ÿæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯åœ¨MyServiceçš„å‡ ä¸ªæ–¹æ³•ä¸­åŠ å…¥æ‰“å°æ—¥å¿—ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\n    @Override\n    public void onCreate() {\n        super.onCreate();\n        Log.d(\"MyService\", \"onCreate executed\");\n    }\n    @Override\n    public int onStartCommand(Intent intent, int flags, int startId) {\n        Log.d(\"MyService\", \"onStartCommand executed\");\n        return super.onStartCommand(intent, flags, startId);\n    }\n    @Override\n    public void onDestroy() {\n        super.onDestroy();\n        Log.d(\"MyService\", \"onDestroy executed\");\n    }\n```\n\nç‚¹å‡»ä¸€ä¸‹Start ServiceæŒ‰é’®ï¼Œè§‚å¯Ÿlogcatä¸­çš„æ‰“å°æ—¥å¿—ã€‚\n\n```\ncom.example.servicetest D/MyService: onCreate executed\ncom.example.servicetest D/MyService: onStartCommand executed\n```\n\nMyServiceä¸­çš„onCreateå’ŒonStartCommandæ–¹æ³•éƒ½æ‰§è¡Œäº†ï¼Œè¯´æ˜è¿™ä¸ªæœåŠ¡ç¡®å®å·²ç»å¯åŠ¨æˆåŠŸäº†ï¼Œå¹¶ä¸”ä½ è¿˜å¯ä»¥åœ¨`Settings`ï¼Œ`System`ï¼Œ`Developer options`ï¼Œ`Running services`ä¸­æ‰¾åˆ°ServiceTestã€‚å¯ä»¥åœ¨å…¶ä¸­åœæ­¢æœåŠ¡ã€‚åˆ™ä¼šçœ‹åˆ°æ—¥å¿—ï¼š\n\n```\ncom.example.servicetest D/MyService: onDestroy executed\n```\n\nç”±æ­¤è¯æ˜ï¼ŒMyServiceç¡®å®å·²ç»æˆåŠŸåœæ­¢ä¸‹æ¥äº†ã€‚è¯è¯´å›æ¥ï¼Œè™½ç„¶æˆ‘ä»¬å·²ç»å­¦ä¼šäº†å¯åŠ¨æœåŠ¡ä»¥åŠåœæ­¢æœåŠ¡çš„æ–¹æ³•ï¼Œæœ‰ä¸€ä¸ªç–‘æƒ‘ï¼Œé‚£å°±æ˜¯onCreateæ–¹æ³•å’ŒonStartCommandæ–¹æ³•åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿå› ä¸ºåˆšåˆšç‚¹å‡»Start ServiceæŒ‰é’®åä¸¤ä¸ªæ–¹æ³•éƒ½æ‰§è¡Œäº†ã€‚å…¶å®onCreateæ–¹æ³•æ˜¯åœ¨æœåŠ¡ç¬¬ä¸€æ¬¡åˆ›å»ºçš„æ—¶å€™è°ƒç”¨çš„ï¼Œè€ŒonStartCommandæ–¹æ³•åˆ™åœ¨æ¯æ¬¡å¯åŠ¨æœåŠ¡çš„æ—¶å€™éƒ½ä¼šè°ƒç”¨ï¼Œç”±äºåˆšæ‰æˆ‘ä»¬æ˜¯ç¬¬ä¸€æ¬¡ç‚¹å‡»Start ServiceæŒ‰é’®ï¼ŒæœåŠ¡æ­¤æ—¶è¿˜æœªåˆ›å»ºï¼ˆCreateï¼‰è¿‡ï¼Œæ‰€ä»¥ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šæ‰§è¡Œï¼Œä¹‹åå†è¿ç»­å¤šç‚¹å‡»å‡ æ¬¡Start ServiceæŒ‰é’®ï¼Œä¼šå‘ç°åªæœ‰onStartCommandå¾—åˆ°æ‰§è¡Œã€‚\n\n# æ´»åŠ¨å’ŒæœåŠ¡è¿›è¡Œé€šä¿¡ - onBind\n\näº†è§£äº†å¯åŠ¨å’Œåœæ­¢æœåŠ¡çš„æ–¹æ³•ï¼Œè™½ç„¶æœåŠ¡æ˜¯åœ¨æ´»åŠ¨é‡Œå¯åŠ¨çš„ï¼Œä½†åœ¨å¯åŠ¨äº†æœåŠ¡ä¹‹åï¼Œæ´»åŠ¨ä¸æœåŠ¡åŸºæœ¬å°±æ²¡æœ‰ä»€ä¹ˆå…³ç³»äº†ã€‚ä¹‹åæœåŠ¡ä¼šä¸€ç›´å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œä½†å…·ä½“è¿è¡Œçš„æ˜¯ä»€ä¹ˆé€»è¾‘ï¼Œæ´»åŠ¨å°±æ§åˆ¶ä¸äº†äº†ã€‚è¿™å°±ç±»ä¼¼äºæ´»åŠ¨é€šçŸ¥äº†æœåŠ¡ä¸€ä¸‹ï¼šä½ å¯ä»¥å¯åŠ¨äº†ï¼ç„¶åæœåŠ¡å°±å»å¿™è‡ªå·±çš„äº‹æƒ…äº†ï¼Œä½†æ´»åŠ¨å¹¶ä¸çŸ¥é“æœåŠ¡åˆ°åº•å»åšäº†ä»€ä¹ˆäº‹æƒ…ï¼Œä»¥åŠå®Œæˆå¾—å¦‚ä½•ã€‚\n\né‚£ä¹ˆæœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•èƒ½è®©æ´»åŠ¨å’ŒæœåŠ¡çš„å…³ç³»æ›´ç´§å¯†ä¸€äº›å‘¢ï¼Œè¿™å°±éœ€è¦å€ŸåŠ©æˆ‘ä»¬åˆšåˆšå¿½ç•¥çš„onBindæ–¹æ³•äº†ã€‚\n\næ¯”å¦‚è¯´ï¼Œç›®å‰æˆ‘ä»¬å¸Œæœ›åœ¨MyServiceé‡Œæä¾›ä¸€ä¸ªä¸‹è½½åŠŸèƒ½ï¼Œç„¶ååœ¨æ´»åŠ¨ä¸­å¯ä»¥å†³å®šä½•æ—¶å¼€å§‹ä¸‹è½½ï¼Œä»¥åŠéšæ—¶æŸ¥çœ‹ä¸‹è½½è¿›åº¦ã€‚å®ç°è¿™ä¸ªåŠŸèƒ½çš„æ€è·¯æ˜¯åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„Binderå¯¹è±¡æ¥å¯¹ä¸‹è½½åŠŸèƒ½è¿›è¡Œç®¡ç†ï¼Œä¿®æ”¹MyServiceä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\npublic class MyService extends Service {\n    \n    private DownloadBinder mBinder = new DownloadBinder();\n    class DownloadBinder extends Binder {\n        public void startDownload() {\n            Log.d(\"MyService\", \"startDownload executed\");\n        }\n        public int getProgress() {\n            Log.d(\"MyService\", \"getProgress executed\");\n            return 0;\n        }\n    }\n    @Override\n    public IBinder onBind(Intent intent) {\n        return mBinder;\n    }\n    \n    ...\n}\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæˆ‘ä»¬æ–°å»ºäº†ä¸€ä¸ªDownLoadBinderç±»ï¼Œå¹¶è®©å®ƒç»§æ‰¿è‡ªBinderï¼Œç„¶ååœ¨å®ƒçš„å†…éƒ¨æä¾›äº†å¼€å§‹ä¸‹è½½ä»¥åŠæŸ¥çœ‹ä¸‹è½½è¿›åº¦çš„æ–¹æ³•ã€‚å½“ç„¶è¿™åªæ˜¯ä¸¤ä¸ªæ¨¡æ‹Ÿæ–¹æ³•ï¼Œå¹¶æ²¡æœ‰å®ç°çœŸæ­£çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸¤ä¸ªæ–¹æ³•ä¸­åˆ†åˆ«æ‰“å°äº†ä¸€è¡Œæ—¥å¿—ã€‚\n\næ¥ç€ï¼ŒMyServiceä¸­åˆ›å»ºäº†DownloadBinderçš„å®ä¾‹ï¼Œç„¶ååœ¨onBindæ–¹æ³•é‡Œè¿”å›äº†è¿™ä¸ªå®ä¾‹ï¼Œè¿™æ ·MyServiceä¸­çš„å·¥ä½œå°±å…¨éƒ¨å®Œæˆäº†ã€‚\n\nä¸‹é¢å°±è¦çœ‹ä¸€çœ‹ï¼Œåœ¨æ´»åŠ¨ä¸­å¦‚ä½•å»è°ƒç”¨æœåŠ¡é‡Œçš„è¿™äº›æ–¹æ³•äº†ã€‚é¦–å…ˆéœ€è¦åœ¨å¸ƒå±€æ–‡ä»¶é‡Œæ–°å¢ä¸¤ä¸ªæŒ‰é’®ï¼Œä¿®æ”¹`activity_main.xml`ä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n    <Button android:id=\"@+id/bind_service\"\n        android:layout_height=\"wrap_content\"\n        android:layout_width=\"match_parent\"\n        android:text=\"Bind Service\"/>\n    <Button android:id=\"@+id/unbind_service\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Unbind Service\"/>\n```\n\nè¿™ä¸¤ä¸ªæŒ‰é’®åˆ†åˆ«æ˜¯ç”¨äºæ´»åŠ¨ç»‘å®šæœåŠ¡å’Œæ´»åŠ¨å–æ¶ˆç»‘å®šæœåŠ¡çš„ï¼Œå½“ä¸€ä¸ªæ´»åŠ¨å’ŒæœåŠ¡ç»‘å®šäº†ä¹‹åï¼Œå°±å¯ä»¥è°ƒç”¨è¯¥æœåŠ¡é‡Œçš„Binderæä¾›çš„æ–¹æ³•äº†ã€‚ä¿®æ”¹MainActivityä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\npublic class MainActivity extends AppCompatActivity implements View.OnClickListener {\n\n    private MyService.DownloadBinder downloadBinder;\n    private ServiceConnection connection = new ServiceConnection() {\n        @Override\n        public void onServiceConnected(ComponentName name, IBinder service) {\n            downloadBinder = (MyService.DownloadBinder) service;\n            downloadBinder.startDownload();\n            downloadBinder.getProgress();\n        }\n\n        @Override\n        public void onServiceDisconnected(ComponentName name) {\n        }\n    };\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        // ...\n        Button bindService = (Button) findViewById(R.id.bind_service);\n        Button unbindService = (Button) findViewById(R.id.unbind_service);\n        bindService.setOnClickListener(this);\n        unbindService.setOnClickListener(this);\n    }\n    @Override\n    public void onClick(View v) {\n        switch (v.getId()) {\n            // ...\n            case R.id.bind_service:\n                Intent bindIntent = new Intent(this, MyService.class);\n                bindService(bindIntent, connection, BIND_AUTO_CREATE);\n                break;\n            case R.id.unbind_service:\n                unbindService(connection);\n                break;\n            default:\n                break;\n        }\n    }\n}\n```\n\nè¿™é‡Œé¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªServiceConnectionçš„åŒ¿åç±»ï¼Œåœ¨é‡Œé¢é‡å†™äº†onServiceConnectedæ–¹æ³•å’ŒonServiceDisconnectedæ–¹æ³•ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•åˆ†åˆ«ä¼šåœ¨æ´»åŠ¨ä¸æœåŠ¡æˆåŠŸç»‘å®šä»¥åŠæ´»åŠ¨ä¸æœåŠ¡çš„è¿æ¥å–æ¶ˆç»‘å®šçš„æ—¶å€™è°ƒç”¨ã€‚åœ¨onServiceConnectedæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åˆé€šè¿‡å‘ä¸‹è½¬å‹å¾—åˆ°äº†DownloadBinderçš„å®ä¾‹ï¼Œæœ‰äº†è¿™ä¸ªå®ä¾‹ï¼Œæ´»åŠ¨å’ŒæœåŠ¡ä¹‹é—´çš„å…³ç³»å°±å˜å¾—éå¸¸ç´§å¯†äº†ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨æ´»åŠ¨ä¸­æ ¹æ®å…·ä½“çš„åœºæ™¯æ¥è°ƒç”¨DownloadBinderä¸­çš„ä»»ä½•publicæ–¹æ³•ï¼Œå³å®ç°äº†æŒ‡æŒ¥æœåŠ¡å¹²ä»€ä¹ˆæœåŠ¡å°±å»å¹²ä»€ä¹ˆçš„åŠŸèƒ½ã€‚è¿™é‡Œä»ç„¶åªæ˜¯åšäº†ä¸ªç®€å•çš„æµ‹è¯•ï¼Œåœ¨onServiceConnectedæ–¹æ³•ä¸­è°ƒç”¨äº†DownloadBinderçš„startDownloadå’ŒgetProgressæ–¹æ³•ã€‚\n\nå½“ç„¶ï¼Œç°åœ¨æ´»åŠ¨å’ŒæœåŠ¡å…¶å®è¿˜æ²¡è¿›è¡Œç»‘å®šå‘¢ï¼Œè¿™ä¸ªåŠŸèƒ½æ˜¯åœ¨Bind ServiceæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶é‡Œå®Œæˆçš„ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæˆ‘ä»¬ä»ç„¶æ˜¯æ„å»ºå‡ºäº†ä¸€ä¸ªIntentå¯¹è±¡ï¼Œç„¶åè°ƒç”¨bindServiceæ–¹æ³•å°†MainActivityå’Œ MyServiceè¿›è¡Œç»‘å®šã€‚\n\nbindServiceæ–¹æ³•æ¥æ”¶3ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯æ„å»ºå‡ºçš„Intentå¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å‰é¢åˆ›å»ºå‡ºçš„ServiceConnectionçš„å®ä¾‹ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°åˆ™æ˜¯ä¸€ä¸ªæ ‡å¿—ä½ï¼Œè¿™é‡Œä¼ å…¥`BIND_AUTO_CREATE`è¡¨ç¤ºåœ¨æ´»åŠ¨å’ŒæœåŠ¡è¿›è¡Œç»‘å®šåè‡ªåŠ¨åˆ›å»ºæœåŠ¡ã€‚è¿™ä¼šä½¿å¾—MyServiceä¸­çš„onCreateæ–¹æ³•å¾—åˆ°æ‰§è¡Œï¼Œ**ä½†onStartCommandæ–¹æ³•ä¸ä¼šæ‰§è¡Œ**ã€‚\n\nç„¶åå¦‚æœæˆ‘ä»¬æƒ³è§£é™¤æ´»åŠ¨å’ŒæœåŠ¡ä¹‹é—´çš„ç»‘å®šï¼Œè°ƒç”¨ä¸€ä¸‹unbindServiceæ–¹æ³•å°±å¯ä»¥äº†ï¼Œè¿™ä¹Ÿæ˜¯Unbind ServiceæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶é‡Œå®ç°çš„åŠŸèƒ½ã€‚ä½†æ˜¯è§£é™¤ç»‘å®šä¸ä¼šç»“æŸæœåŠ¡ã€‚\n\nç‚¹å‡»ä¸€ä¸‹ Bind ServiceæŒ‰é’®ï¼Œç„¶åè§‚å¯Ÿlogcatä¸­çš„æ‰“å°æ—¥å¿—ã€‚\n\n```\ncom.example.servicetest D/MyService: onCreate executed\ncom.example.servicetest D/MyService: startDownload executed\ncom.example.servicetest D/MyService: getProgress executed\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œé¦–å…ˆæ˜¯MyServiceçš„onCreateæ–¹æ³•å¾—åˆ°äº†æ‰§è¡Œï¼Œç„¶åstartDownloadå’ŒgetProgressæ–¹æ³•éƒ½å¾—åˆ°äº†æ‰§è¡Œï¼Œè¯´æ˜ç¡®å®å·²ç»åœ¨æ´»åŠ¨é‡ŒæˆåŠŸè°ƒç”¨äº†æœåŠ¡é‡Œæä¾›çš„æ–¹æ³•äº†ã€‚\n\nå¦å¤–éœ€è¦æ³¨æ„ï¼Œä»»ä½•ä¸€ä¸ªæœåŠ¡åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºèŒƒå›´å†…éƒ½æ˜¯é€šç”¨çš„ï¼Œå³MyServiceä¸ä»…å¯ä»¥å’ŒMainActivityç»‘å®šï¼Œè¿˜å¯ä»¥å’Œä»»ä½•ä¸€ä¸ªå…¶ä»–çš„æ´»åŠ¨è¿›è¡Œç»‘å®šï¼Œè€Œä¸”åœ¨ç»‘å®šå®Œæˆåå®ƒä»¬éƒ½å¯ä»¥è·å–åˆ°ç›¸åŒçš„DownloadBinderå®ä¾‹ã€‚\n\n# æœåŠ¡çš„ç”Ÿå‘½å‘¨æœŸ\n\nå‰é¢ä½¿ç”¨åˆ°çš„onCreateã€onStartCommandã€onBindå’ŒonDestroyç­‰æ–¹æ³•éƒ½æ˜¯åœ¨æœåŠ¡çš„ç”Ÿå‘½å‘¨æœŸå†…å¯èƒ½å›è°ƒçš„æ–¹æ³•ã€‚\n\nä¸€æ—¦åœ¨é¡¹ç›®çš„ä»»ä½•ä½ç½®è°ƒç”¨äº†Contextçš„startServiceæ–¹æ³•ï¼Œç›¸åº”çš„æœåŠ¡å°±ä¼šå¯åŠ¨èµ·æ¥ï¼Œå¹¶å›è°ƒonStartCommandæ–¹æ³•ã€‚å¦‚æœè¿™ä¸ªæœåŠ¡ä¹‹å‰è¿˜æ²¡æœ‰åˆ›å»ºè¿‡ï¼ŒonCreateæ–¹æ³•ä¼šå…ˆäºonStartCommandæ–¹æ³•æ‰§è¡Œã€‚æœåŠ¡å¯åŠ¨äº†ä¹‹åä¼šä¸€ç›´ä¿æŒè¿è¡ŒçŠ¶æ€ï¼Œç›´åˆ° stopServiceæˆ–stopSelfæ–¹æ³•è¢«è°ƒç”¨ã€‚\n\næ³¨æ„ï¼Œè™½ç„¶æ¯è°ƒç”¨ä¸€æ¬¡startServiceæ–¹æ³•ï¼ŒonStartCommandå°±ä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œä½†å®é™…ä¸Šæ¯ä¸ªæœåŠ¡éƒ½åªä¼šå­˜åœ¨ä¸€ä¸ªå®ä¾‹ã€‚æ‰€ä»¥ä¸ç®¡ä½ è°ƒç”¨äº†å¤šå°‘æ¬¡startServiceæ–¹æ³•ï¼Œåªéœ€è°ƒç”¨ä¸€æ¬¡stopServiceæˆ–stopSelfæ–¹æ³•ï¼ŒæœåŠ¡å°±ä¼šåœæ­¢ä¸‹æ¥äº†ã€‚\n\nå¦å¤–ï¼Œè¿˜å¯ä»¥è°ƒç”¨Contextçš„bindServiceæ¥è·å–ä¸€ä¸ªæœåŠ¡çš„æŒä¹…è¿æ¥ï¼Œè¿™æ—¶å°±ä¼šå›è°ƒæœåŠ¡ä¸­çš„onBindæ–¹æ³•ã€‚ç±»ä¼¼åœ°ï¼Œå¦‚æœè¿™ä¸ªæœåŠ¡ä¹‹å‰è¿˜æ²¡æœ‰åˆ›å»ºè¿‡ï¼ŒonCreateæ–¹æ³•ä¼šå…ˆäºonBindæ–¹æ³•æ‰§è¡Œã€‚ä¹‹åï¼Œè°ƒç”¨æ–¹å¯ä»¥è·å–åˆ°onBindæ–¹æ³•é‡Œè¿”å›çš„IBinderå¯¹è±¡çš„å®ä¾‹ï¼Œè¿™æ ·å°±èƒ½è‡ªç”±åœ°å’ŒæœåŠ¡è¿›è¡Œé€šä¿¡äº†ã€‚åªè¦è°ƒç”¨æ–¹å’ŒæœåŠ¡ä¹‹é—´çš„è¿æ¥æ²¡æœ‰æ–­å¼€ï¼ŒæœåŠ¡å°±ä¼šä¸€ç›´ä¿æŒè¿è¡ŒçŠ¶æ€ã€‚\n\nå½“è°ƒç”¨äº†startServiceæ–¹æ³•åï¼Œåˆå»è°ƒç”¨stopServiceæ–¹æ³•ï¼Œè¿™æ—¶æœåŠ¡ä¸­çš„onDestroyæ–¹æ³•å°±ä¼šæ‰§è¡Œï¼Œè¡¨ç¤ºæœåŠ¡å·²ç»é”€æ¯äº†ã€‚\n\nä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œæˆ‘ä»¬æ˜¯å®Œå…¨æœ‰å¯èƒ½å¯¹ä¸€ä¸ªæœåŠ¡æ—¢è°ƒç”¨äº†startServiceæ–¹æ³•ï¼Œåˆè°ƒç”¨äº†bindServiceæ–¹æ³•çš„ï¼Œè¿™ç§æƒ…å†µä¸‹è¯¥å¦‚ä½•æ‰èƒ½è®©æœåŠ¡é”€æ¯æ‰å‘¢ï¼Ÿæ ¹æ®Androidç³»ç»Ÿçš„æœºåˆ¶ï¼Œä¸€ä¸ªæœåŠ¡åªè¦è¢«å¯åŠ¨æˆ–è€…è¢«ç»‘å®šäº†ä¹‹åï¼Œå°±ä¼šä¸€ç›´å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œ**å¿…é¡»è¦è®©ä»¥ä¸Šä¸¤ç§æ¡ä»¶åŒæ—¶ä¸æ»¡è¶³ï¼ŒæœåŠ¡æ‰èƒ½è¢«é”€æ¯**ã€‚æ‰€ä»¥ï¼Œè¿™ç§æƒ…å†µä¸‹è¦åŒæ—¶è°ƒç”¨stopServiceå’ŒunbindServiceæ–¹æ³•ï¼ŒonDestroyæ–¹æ³•æ‰ä¼šæ‰§è¡Œã€‚\n\nå®æµ‹ï¼Œå½“bindä¹‹åï¼Œç›´æ¥ç‚¹å‡»stopserviceä¸ä¼šè°ƒç”¨destroyã€‚å¦‚æœç‚¹å‡»äº†stopserviceä¹‹åï¼Œåªè¦unbindï¼Œå°±ä¼šç«‹å³destroyã€‚å¯å‚é˜…ï¼šhttps://blog.csdn.net/qq_30591155/article/details/105200843\n\nè¿™æ ·å°±å·²ç»æŠŠæœåŠ¡çš„ç”Ÿå‘½å‘¨æœŸå®Œæ•´åœ°èµ°äº†ä¸€éã€‚\n\n# å‰å°æœåŠ¡\n\n","categories":["Android"]},{"title":"03_mprpc_ç¯å¢ƒé…ç½®","url":"/RPC/03_mprpc_ç¯å¢ƒé…ç½®/","content":"ç¯å¢ƒï¼šLinuxã€muduoåº“å®‰è£…ã€protobufåº“å®‰è£…ã€XShellï¼ˆè¿œç¨‹è¿æ¥ï¼‰ã€VSCode\n# é¡¹ç›®ç›®å½•ç»„ç»‡\n\nç•¥\n# protobufç®€ä»‹\n\nprotobufæ˜¯Googleåˆ›å§‹çš„ä¸€ç§æ•°æ®äº¤æ¢çš„æ ¼å¼ï¼Œç‹¬ç«‹ä¸å¹³å°è¯­è¨€ã€‚\n\næä¾›äº†å¤šç§è¯­è¨€çš„å®ç°ã€‚æ¯ä¸€ç§å®ç°éƒ½åŒ…å«äº†ç›¸åº”è¯­è¨€çš„ç¼–è¯‘å™¨ä»¥åŠåº“æ–‡ä»¶ã€‚\n\nç”±äºå®ƒæ˜¯ä¸€ç§äºŒè¿›åˆ¶çš„æ ¼å¼ï¼Œæ¯”xmlã€jsonå¿«ã€‚\n\nå¾ˆé€‚åˆç”¨äºåˆ†å¸ƒå¼åº”ç”¨ä¹‹é—´çš„æ•°æ®é€šä¿¡æˆ–è€…å¼‚æ„ç¯å¢ƒä¸‹çš„æ•°æ®äº¤æ¢ã€‚ä½œä¸ºä¸€ç§æ•ˆç‡å’Œå…¼å®¹æ€§éƒ½å¾ˆä¼˜ç§€çš„äºŒè¿›åˆ¶æ•°æ®ä¼ è¾“æ ¼å¼ï¼Œå¯ä»¥ç”¨äºç½‘ç»œä¼ è¾“ã€é…ç½®æ–‡ä»¶ã€æ•°æ®å­˜å‚¨ç­‰è¯¸å¤šé¢†åŸŸã€‚\n\n# å®‰è£…é…ç½®\n\nåœ¨githubæºä»£ç ä¸‹è½½åœ°å€ï¼šhttps://github.com/google/protobuf\n\næºç åŒ…ä¸­çš„`src/README.md`ï¼Œæœ‰è¯¦ç»†çš„å®‰è£…è¯´æ˜ï¼Œå®‰è£…è¿‡ç¨‹å¦‚ä¸‹ï¼š\n\n1. è§£å‹å‹ç¼©åŒ…ï¼š`unzip protobuf-master.zip`\n2. è¿›å…¥è§£å‹åçš„æ–‡ä»¶å¤¹ï¼š`cd protobuf-master`\n3. å®‰è£…æ‰€éœ€å·¥å…·ï¼š`sudo apt install autoconf automake libtool curl`\n4. è‡ªåŠ¨ç”Ÿæˆconfigureé…ç½®æ–‡ä»¶ï¼š`./autogen.sh`\n5. é…ç½®ç¯å¢ƒï¼š`./configure`\n6. ç¼–è¯‘æºä»£ç (æ—¶é—´æ¯”è¾ƒé•¿)ï¼šmake\n7. å®‰è£…ï¼šsudo make install\n8. åˆ·æ–°åŠ¨æ€åº“ï¼šsudo ldconfig\n\nå®‰è£…æˆåŠŸåï¼Œå‘½ä»¤è¡Œè¾“å…¥protocï¼Œèƒ½å‡ºæ¥ä¿¡æ¯ã€‚\n# è¿œç¨‹è¿æ¥SSH\nè§å…¶ä»–ç¯‡ã€‚\n# gitç®¡ç†\nåœ¨ä»£ç ç›®å½•ä¸­ï¼Œgit initã€‚ä»0å¼€å§‹å°±ç”¨gitç®¡ç†ã€‚\n```bash\ngit init\ngit checkout -b dev #åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯å¹¶åˆ‡æ¢åˆ°å®ƒ\n```\ndevè¡¨ç¤ºå¼€å‘åˆ†æ”¯ï¼Œä¸æ˜¯æˆç†Ÿçš„ä»£ç ï¼Œå¯å½“ä½œç»ƒä¹ çš„ç¯å¢ƒã€‚\n","categories":["é¡¹ç›®","rpc"]},{"title":"Android_UI","url":"/Android/Android_UI/","content":"\n# å¦‚ä½•ç¼–å†™ç¨‹åºç•Œé¢\n\nAndroidä¸­æœ‰å¤šç§ç¼–å†™ç¨‹åºç•Œé¢çš„æ–¹å¼å¯ä¾›é€‰æ‹©ã€‚Android Studioå’ŒEclipseä¸­éƒ½æä¾›äº†ç›¸åº”çš„å¯è§†åŒ–ç¼–è¾‘å™¨ï¼Œå…è®¸ä½¿ç”¨æ‹–æ”¾æ§ä»¶çš„æ–¹å¼æ¥ç¼–å†™å¸ƒå±€ï¼Œå¹¶èƒ½åœ¨è§†å›¾ä¸Šç›´æ¥ä¿®æ”¹æ§ä»¶çš„å±æ€§ã€‚ä¸è¿‡å¹¶ä¸æ¨èä½¿ç”¨è¿™ç§æ–¹å¼æ¥ç¼–å†™ç•Œé¢ï¼Œå› ä¸ºå¯è§†åŒ–ç¼–è¾‘å·¥å…·å¹¶ä¸åˆ©äºå»çœŸæ­£äº†è§£ç•Œé¢èƒŒåçš„å®ç°åŸç†ã€‚é€šè¿‡è¿™ç§æ–¹å¼åˆ¶ä½œå‡ºçš„ç•Œé¢é€šå¸¸ä¸å…·æœ‰å¾ˆå¥½çš„å±å¹•é€‚é…æ€§ï¼Œè€Œä¸”å½“éœ€è¦ç¼–å†™è¾ƒä¸ºå¤æ‚çš„ç•Œé¢æ—¶å¯è§†åŒ–ç¼–è¾‘å·¥å…·å°†å¾ˆéš¾èƒœä»»ã€‚\n\nå› æ­¤æ‰€æœ‰çš„ç•Œé¢éƒ½å°†é€šè¿‡æœ€åŸºæœ¬çš„æ–¹å¼å»å®ç°ï¼Œå³ç¼–å†™XMLä»£ç ã€‚å®Œå…¨æŒæ¡äº†ä½¿ç”¨XMLæ¥ç¼–å†™ç•Œé¢çš„æ–¹æ³•ä¹‹åï¼Œä¸ç®¡æ˜¯è¿›è¡Œé«˜å¤æ‚åº¦çš„ç•Œé¢å®ç°ï¼Œè¿˜æ˜¯åˆ†æå’Œä¿®æ”¹å½“å‰ç°æœ‰ç•Œé¢ï¼Œéƒ½å°†æ˜¯æ‰‹åˆ°æ“’æ¥ã€‚è®²äº†è¿™ä¹ˆå¤šç†è®ºçš„ä¸œè¥¿ï¼Œä¹Ÿæ˜¯æ—¶å€™å­¦ä¹ ä¸€ä¸‹åˆ°åº•å¦‚ä½•ç¼–å†™ç¨‹åºç•Œé¢äº†ï¼Œä¸‹é¢å°±ä»Androidä¸­å‡ ç§å¸¸è§çš„æ§ä»¶å¼€å§‹ã€‚\n\n# å¸¸ç”¨æ§ä»¶çš„ä½¿ç”¨æ–¹æ³•\n\nAndroidæä¾›äº†å¤§é‡çš„UIæ§ä»¶ï¼Œåˆç†åœ°ä½¿ç”¨è¿™äº›æ§ä»¶å°±å¯ä»¥éå¸¸è½»æ¾åœ°ç¼–å†™å‡ºç›¸å½“ä¸é”™çš„ç•Œé¢ï¼Œä¸‹é¢æˆ‘ä»¬å°±æŒ‘é€‰å‡ ç§å¸¸ç”¨çš„æ§ä»¶ï¼Œè¯¦ç»†ä»‹ç»ä¸€ä¸‹å®ƒä»¬çš„ä½¿ç”¨æ–¹æ³•ã€‚\n\né¦–å…ˆæ–°å»ºä¸€ä¸ªUIWidgetTesté¡¹ç›®ï¼Œç®€å•èµ·è§ï¼Œæˆ‘ä»¬è¿˜æ˜¯å…è®¸Android Studioè‡ªåŠ¨åˆ›å»ºæ´»åŠ¨ã€‚æ´»åŠ¨åå’Œå¸ƒå±€åéƒ½ä½¿ç”¨é»˜è®¤å€¼ã€‚\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:orientation=\"vertical\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n    <TextView\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:id=\"@+id/text_view\"\n        android:gravity=\"center\"\n        android:textSize=\"24sp\"\n        android:textColor=\"#00ff00\"\n        android:text=\"This is TextView\">\n\n    </TextView>\n    <Button android:id=\"@+id/button\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:textAllCaps=\"false\"\n        android:text=\"Button\">\n\n    </Button>\n    <EditText android:id=\"@+id/edit_text\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\">\n\n    </EditText>\n</LinearLayout>\n```\n\nAndroidæ§ä»¶çš„ä½¿ç”¨è§„å¾‹ï¼šç”¨æ³•åŸºæœ¬ä¸Šéƒ½å¾ˆç›¸ä¼¼ï¼Œç»™æ§ä»¶å®šä¹‰ä¸€ä¸ªidï¼Œå†æŒ‡å®šæ§ä»¶çš„å®½åº¦å’Œé«˜åº¦ï¼Œç„¶åå†é€‚å½“åŠ å…¥ä¸€äº›æ§ä»¶ç‰¹æœ‰çš„å±æ€§å°±å·®ä¸å¤šäº†ã€‚æ‰€ä»¥ä½¿ç”¨XMLæ¥ç¼–å†™ç•Œé¢å…¶å®ä¸€ç‚¹éƒ½ä¸éš¾ï¼Œå®Œå…¨å¯ä»¥ä¸ç”¨å€ŸåŠ©ä»»ä½•å¯è§†åŒ–å·¥å…·æ¥å®ç°ã€‚\n\nä¸€äº›åšå¾—æ¯”è¾ƒäººæ€§åŒ–çš„è½¯ä»¶ä¼šåœ¨è¾“å…¥æ¡†é‡Œæ˜¾ç¤ºä¸€äº›æç¤ºæ€§çš„æ–‡å­—ï¼Œç„¶åä¸€æ—¦ç”¨æˆ·è¾“å…¥äº†ä»»ä½•å†…å®¹ï¼Œè¿™äº›æç¤ºæ€§çš„æ–‡å­—å°±ä¼šæ¶ˆå¤±ã€‚è¿™ç§æç¤ºåŠŸèƒ½åœ¨Androidé‡Œæ˜¯éå¸¸å®¹æ˜“å®ç°çš„ï¼Œæˆ‘ä»¬ç”šè‡³ä¸éœ€è¦åšä»»ä½•çš„é€»è¾‘æ§åˆ¶ï¼Œå› ä¸ºç³»ç»Ÿå·²ç»å¸®æˆ‘ä»¬éƒ½å¤„ç†å¥½äº†ã€‚ä¿®æ”¹`activity_main.xml`ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n    <EditText android:id=\"@+id/edit_text\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:hint=\"Type something here\">\n        <!-- è¿™é‡Œä½¿ç”¨android:hint å±æ€§æŒ‡å®šäº†ä¸€æ®µæç¤ºæ€§çš„æ–‡æœ¬ -->\n    </EditText>\n```\n\n# 3ç§åŸºæœ¬å¸ƒå±€\n\nä¸€ä¸ªä¸°å¯Œçš„ç•Œé¢æ€»æ˜¯è¦ç”±å¾ˆå¤šä¸ªæ§ä»¶ç»„æˆçš„ï¼Œé‚£å¦‚ä½•æ‰èƒ½è®©å„ä¸ªæ§ä»¶éƒ½æœ‰æ¡ä¸ç´Šåœ°æ‘†æ”¾åœ¨ç•Œé¢ä¸Šï¼Œè€Œä¸æ˜¯ä¹±ç³Ÿç³Ÿçš„å‘¢ï¼Ÿè¿™å°±éœ€è¦å€ŸåŠ©**å¸ƒå±€**æ¥å®ç°äº†ã€‚å¸ƒå±€æ˜¯ä¸€ç§å¯ç”¨äºæ”¾ç½®å¾ˆå¤šæ§ä»¶çš„å®¹å™¨ï¼Œå®ƒå¯ä»¥æŒ‰ç…§ä¸€å®šçš„è§„å¾‹è°ƒæ•´å†…éƒ¨æ§ä»¶çš„ä½ç½®ï¼Œä»è€Œç¼–å†™å‡ºç²¾ç¾çš„ç•Œé¢ã€‚å½“ç„¶ï¼Œå¸ƒå±€çš„å†…éƒ¨é™¤äº†æ”¾ç½®æ§ä»¶å¤–ï¼Œä¹Ÿå¯ä»¥æ”¾ç½®å¸ƒå±€ï¼Œé€šè¿‡å¤šå±‚å¸ƒå±€çš„åµŒå¥—ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿå®Œæˆä¸€äº›æ¯”è¾ƒå¤æ‚çš„ç•Œé¢å®ç°ã€‚\n\nå‡†å¤‡å·¥ä½œï¼šæ–°å»ºä¸€ä¸ªUILayoutTesté¡¹ç›®ã€‚\n\n## çº¿æ€§å¸ƒå±€\n\nLinearLayoutåˆç§°ä½œçº¿æ€§å¸ƒå±€ã€‚\n\nè¿™ä¸ªå¸ƒå±€ä¼šå°†ä»–æ‰€åŒ…å«çš„æ§ä»¶åœ¨çº¿æ€§æ–¹å‘ä¸Šä¾æ¬¡æ’åˆ—ã€‚\n\n### æ’åˆ—æ–¹å‘ï¼šorientation\n\n`android:orientation`å±æ€§æŒ‡å®šäº†æ’åˆ—æ–¹å‘ã€‚è‹¥æŒ‡å®š`vertical`åˆ™ä¼šåœ¨å‚ç›´æ–¹å‘æ’åˆ—ï¼Œå¦‚æœæŒ‡å®šçš„æ˜¯horizontalåˆ™ä¼šåœ¨æ°´å¹³æ–¹å‘æ’åˆ—ã€‚å¦‚æœä¸æŒ‡å®š`android:orientation`å±æ€§çš„å€¼ï¼Œé»˜è®¤çš„æ’åˆ—æ–¹å‘å°±æ˜¯`horizontal`ã€‚\n\nå¦‚æœLinearLayoutçš„æ’åˆ—æ–¹å‘æ˜¯horizontalï¼Œå†…éƒ¨çš„æ§ä»¶å°±ç»å¯¹ä¸èƒ½å°†`å®½åº¦`æŒ‡å®šä¸º`match_parent`ï¼Œå› ä¸ºè¿™æ ·çš„è¯ï¼Œå•ç‹¬ä¸€ä¸ªæ§ä»¶å°±ä¼šå°†æ•´ä¸ªæ°´å¹³æ–¹å‘å æ»¡ï¼Œå…¶ä»–çš„æ§ä»¶å°±æ²¡æœ‰å¯æ”¾ç½®çš„ä½ç½®äº†ã€‚åŒæ ·çš„é“ç†ï¼Œå¦‚æœLinearLayoutçš„æ’åˆ—æ–¹å‘æ˜¯verticalï¼Œå†…éƒ¨çš„æ§ä»¶å°±ä¸èƒ½å°†`é«˜åº¦`æŒ‡å®šä¸º`match_parent`ã€‚\n\n### å¯¹é½æ–¹å¼ï¼šlayout_gravity\n\n`android:layout_gravity`å±æ€§ï¼Œå’Œ`android:gravity`å±æ€§çœ‹èµ·æ¥æœ‰äº›ç›¸ä¼¼ï¼Œè¿™ä¸¤ä¸ªå±æ€§æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿå…¶å®ä»åå­—å°±å¯ä»¥çœ‹å‡ºï¼Œ`android:gravity`ç”¨äºæŒ‡å®šæ–‡å­—åœ¨æ§ä»¶ä¸­çš„å¯¹é½æ–¹å¼ï¼Œè€Œ`android:layout_gravity`ç”¨äºæŒ‡å®šæ§ä»¶åœ¨å¸ƒå±€ä¸­çš„å¯¹é½æ–¹å¼ã€‚`android:layout_gravity`çš„å¯é€‰å€¼å’Œ`android:gravity`å·®ä¸å¤šï¼Œä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œå½“LinearLayoutçš„æ’åˆ—æ–¹å‘æ˜¯`horizontal`æ—¶ï¼Œåªæœ‰å‚ç›´æ–¹å‘ä¸Šçš„å¯¹é½æ–¹å¼æ‰ä¼šç”Ÿæ•ˆï¼Œå› ä¸ºæ­¤æ—¶æ°´å¹³æ–¹å‘ä¸Šçš„é•¿åº¦æ˜¯ä¸å›ºå®šçš„ï¼Œæ¯æ·»åŠ ä¸€ä¸ªæ§ä»¶ï¼Œæ°´å¹³æ–¹å‘ä¸Šçš„é•¿åº¦éƒ½ä¼šæ”¹å˜ï¼Œå› è€Œæ— æ³•æŒ‡å®šè¯¥æ–¹å‘ä¸Šçš„å¯¹é½æ–¹å¼ã€‚åŒæ ·çš„é“ç†ï¼Œå½“LinearLayoutçš„æ’åˆ—æ–¹å‘æ˜¯`vertical`æ—¶ï¼Œåªæœ‰æ°´å¹³æ–¹å‘ä¸Šçš„å¯¹é½æ–¹å¼æ‰ä¼šç”Ÿæ•ˆã€‚`layout_gravity`æ”¯æŒçš„é€‰é¡¹ï¼š`center_vertical`ã€`center`ã€`bottom`ã€`center_horizontal`ã€`clip_horizontal`ã€`clip_vertical`ã€`end`ã€`fill`ã€`fill_horizontal`ã€`fill_vertical`ã€`left`ã€`right`ã€`start`ã€`top`ã€‚\n\nä¿®æ”¹`activity_main.xml`ä¸­çš„ä»£ç ï¼š\n\n```xml\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:orientation=\"horizontal\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n    <Button android:id=\"@+id/button1\"\n        android:layout_height=\"wrap_content\"\n        android:layout_width=\"wrap_content\"\n        android:layout_gravity=\"top\"\n        android:text=\"Button 1\">\n    </Button>\n    <Button android:id=\"@+id/button2\"\n        android:layout_height=\"wrap_content\"\n        android:layout_width=\"wrap_content\"\n        android:layout_gravity=\"center_vertical\"\n        android:text=\"Button 1\">\n    </Button>\n    <Button android:id=\"@+id/button3\"\n        android:layout_height=\"wrap_content\"\n        android:layout_width=\"wrap_content\"\n        android:layout_gravity=\"bottom\"\n        android:text=\"Button 1\">\n    </Button>\n\n</LinearLayout>\n```\n\n![image-20220816142157513](../../images/Android_UI/image-20220816142157513.png)\n\n### æ¯”ä¾‹å ä½ï¼šlayout_weight\n\næ­¤å±æ€§å…è®¸æˆ‘ä»¬ä½¿ç”¨æ¯”ä¾‹çš„æ–¹å¼æ¥æŒ‡å®šæ§ä»¶çš„å¤§å°ï¼Œå®ƒåœ¨æ‰‹æœºå±æš®çš„é€‚é…æ€§æ–¹é¢å¯ä»¥èµ·åˆ°éå¸¸é‡è¦çš„ä½œç”¨ã€‚æ¯”å¦‚æˆ‘ä»¬æ­£åœ¨ç¼–å†™ä¸€ä¸ªæ¶ˆæ¯å‘é€ç•Œé¢ã€éœ€è¦ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘æ¡†å’Œä¸€ä¸ªå‘é€æŒ‰é’®ï¼Œä¿®æ”¹`activity_main.xml`ä¸­çš„ä»£ç ã€å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:orientation=\"horizontal\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n    <EditText android:id=\"@+id/input_message\"\n        android:layout_width=\"0dp\"\n        android:layout_height=\"wrap_content\"\n        android:layout_weight=\"1\"\n        android:hint=\"Type something\">\n        \n    </EditText>\n    <Button android:id=\"@+id/send\"\n        android:layout_width=\"0dp\"\n        android:layout_height=\"wrap_content\"\n        android:layout_weight=\"1\"\n        android:text=\"Send\">\n        \n    </Button>\n\n</LinearLayout>\n```\n\nè¿™é‡Œå°†EditTextå’ŒButtonçš„å®½åº¦éƒ½æŒ‡å®šæˆäº†`0dp`ï¼Œè¿™æ ·æ–‡æœ¬ç¼–è¾‘æ¡†å’ŒæŒ‰é’®è¿˜èƒ½æ˜¾ç¤ºå‡ºæ¥å—ï¼Ÿä¸ç”¨æ‹…å¿ƒï¼Œç”±äºä½¿ç”¨äº†`android:layout_weight`å±æ€§ï¼Œæ­¤æ—¶æ§ä»¶çš„å®½åº¦å°±ä¸åº”è¯¥å†ç”±`android:layout_width`æ¥å†³å®šï¼Œè¿™é‡ŒæŒ‡å®šæˆ`0dp`æ˜¯ä¸€ç§æ¯”è¾ƒè§„èŒƒçš„å†™æ³•ã€‚åœ¨EditTextå’ŒButtoné‡Œéƒ½å°†`android:layout_weight`å±æ€§çš„å€¼æŒ‡å®šä¸º1ã€‚è¿™è¡¨ç¤ºEditTextå’ŒButtonå°†åœ¨æ°´å¹³æ–¹å‘å¹³åˆ†å®½åº¦ã€‚\n\n> dpæ˜¯Androidä¸­ç”¨äºæŒ‡å®šæ§ä»¶å¤§å°ã€é—´è·ç­‰å±æ€§çš„å•ä½ã€‚\n\nä¸ºä»€ä¹ˆå°†`android:layout_weight`å±æ€§çš„å€¼åŒæ—¶æŒ‡å®šä¸º1å°±ä¼šå¹³åˆ†å±å¹•å®½åº¦å‘¢ï¼Ÿå…¶å®åŸç†ä¹Ÿå¾ˆç®€å•ï¼Œç³»ç»Ÿä¼šå…ˆæŠŠLinearLayoutä¸‹æ‰€æœ‰æ§ä»¶æŒ‡å®šçš„`layout_weight`å€¼ç›¸åŠ ï¼Œå¾—åˆ°ä¸€ä¸ªæ€»å€¼ï¼Œç„¶åæ¯ä¸ªæ§ä»¶æ‰€å å¤§å°çš„æ¯”ä¾‹å°±æ˜¯ç”¨è¯¥æ§ä»¶çš„`layout_weight`å€¼é™¤ä»¥åˆšæ‰ç®—å‡ºçš„æ€»å€¼ã€‚å› æ­¤å¦‚æœæƒ³è®©EditTextå æ®å±å¹•å®½åº¦çš„3/5ã€‚Buttonå æ®å±å¹•å®½åº¦çš„2/5ï¼Œåªéœ€è¦å°†EditTextçš„`layout_weight`æ”¹æˆ3ï¼ŒButtonçš„`layout_weight`æ”¹æˆ2å°±å¯ä»¥äº†ã€‚\n\n![image-20220816143444781](../../images/Android_UI/image-20220816143444781.png)\n\næˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡æŒ‡å®šéƒ¨åˆ†æ§ä»¶çš„`layout_weight`å€¼æ¥å®ç°æ›´å¥½çš„æ•ˆæœã€‚ä¿®æ”¹`activity_main.xml`ä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:orientation=\"horizontal\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n    <EditText android:id=\"@+id/input_message\"\n        android:layout_width=\"0dp\"\n        android:layout_height=\"wrap_content\"\n        android:layout_weight=\"1\"\n        android:hint=\"Type something\">\n    </EditText>\n    <Button android:id=\"@+id/send\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Send\">        \n    </Button>\n        \n</LinearLayout>\n```\n\nè¿™é‡Œæˆ‘ä»¬ä»…æŒ‡å®šäº†EditTextçš„`android:layout_weight`å±æ€§ï¼Œå¹¶å°†Buttonçš„å®½åº¦æ”¹å›`wrap_content`ã€‚è¿™è¡¨ç¤ºButtonçš„å®½åº¦ä»ç„¶æŒ‰ç…§`wrap_content`æ¥è®¡ç®—ï¼Œè€ŒEditTextåˆ™ä¼šå æ»¡å±å¹•æ‰€æœ‰çš„å‰©ä½™ç©ºé—´ã€‚ä½¿ç”¨è¿™ç§æ–¹å¼ç¼–å†™çš„ç•Œé¢ï¼Œä¸ä»…åœ¨å„ç§å±å¹•çš„é€‚é…æ–¹é¢ä¼šéå¸¸å¥½ï¼Œè€Œä¸”çœ‹èµ·æ¥ä¹Ÿæ›´åŠ èˆ’æœã€‚\n\n![image-20220816144347201](../../images/Android_UI/image-20220816144347201.png)\n\n## ç›¸å¯¹å¸ƒå±€\n\nRelativeLayoutåˆç§°ä½œç›¸å¯¹å¸ƒå±€ï¼Œä¹Ÿæ˜¯ä¸€ç§éå¸¸å¸¸ç”¨çš„å¸ƒå±€ã€‚å’ŒLinearLayoutçš„æ’åˆ—è§„åˆ™ä¸åŒï¼ŒRelativeLayoutæ˜¾å¾—æ›´åŠ éšæ„ä¸€äº›ï¼Œå®ƒå¯ä»¥é€šè¿‡ç›¸å¯¹å®šä½çš„æ–¹å¼è®©æ§ä»¶å‡ºç°åœ¨å¸ƒå±€çš„ä»»ä½•ä½ç½®ã€‚ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼ŒRelativeLayoutä¸­çš„å±æ€§éå¸¸å¤šï¼Œä¸è¿‡è¿™äº›å±æ€§éƒ½æ˜¯æœ‰è§„å¾‹å¯å¾ªçš„ï¼Œå…¶å®å¹¶ä¸éš¾ç†è§£å’Œè®°å¿†ã€‚\n\n### ç›¸å¯¹äºparent\n\nä¿®æ”¹`activity_main.xml`ä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n<RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n    <Button\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_alignParentLeft=\"true\"\n        android:layout_alignParentTop=\"true\"\n        android:text=\"Button 1\">\n\n    </Button>\n    <Button\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_alignParentLeft=\"true\"\n        android:layout_alignParentBottom=\"true\"\n        android:text=\"Button 2\">\n\n    </Button>\n    <Button\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_centerInParent=\"true\"\n        android:text=\"Button 3\">\n\n    </Button>\n    <Button\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_alignParentRight=\"true\"\n        android:layout_alignParentTop=\"true\"\n        android:text=\"Button 4\">\n\n    </Button>\n    <Button\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_alignParentRight=\"true\"\n        android:layout_alignParentBottom=\"true\"\n        android:text=\"Button 5\">\n\n    </Button>\n</RelativeLayout>\n```\n\nä»¥ä¸Šä»£ç å·²ç»ä¸éœ€è¦å†åšè¿‡å¤šè§£é‡Šäº†ï¼Œå› ä¸ºå®åœ¨æ˜¯å¤ªå¥½ç†è§£äº†ã€‚æˆ‘ä»¬è®©`Button1`å’Œçˆ¶å¸ƒå±€çš„å·¦ä¸Šè§’å¯¹é½ï¼Œ`Button2`å’Œçˆ¶å¸ƒå±€çš„å³ä¸Šè§’å¯¹é½ï¼Œ`Button3`å±…ä¸­æ˜¾ç¤ºï¼Œ`Button4`å’Œçˆ¶å¸ƒå±€çš„å·¦ä¸‹è§’å¯¹é½ï¼Œ`Button5`å’Œçˆ¶å¸ƒå±€çš„å³ä¸‹è§’å¯¹é½ã€‚è™½ç„¶`android:layout_alignParentLeft`ã€`android:Layout alignParentTop`ã€`android:layout_alignParentRight`ã€`android:layout_alignParentBottom`ã€`android:layout_centerInParent`è¿™å‡ ä¸ªå±æ€§æˆ‘ä»¬ä¹‹å‰éƒ½æ²¡æ¥è§¦è¿‡ï¼Œå¯æ˜¯å®ƒä»¬çš„åå­—å·²ç»å®Œå…¨è¯´æ˜äº†å®ƒä»¬çš„ä½œç”¨ã€‚\n\n![image-20220816145421370](../../images/Android_UI/image-20220816145421370.png)\n\n### ç›¸å¯¹äºæ§ä»¶\n\nä¸Šé¢ä¾‹å­ä¸­çš„æ¯ä¸ªæ§ä»¶éƒ½æ˜¯ç›¸å¯¹äºçˆ¶å¸ƒå±€è¿›è¡Œå®šä½çš„ï¼Œé‚£æ§ä»¶å¯ä¸å¯ä»¥ç›¸å¯¹äºæ§ä»¶è¿›è¡Œå®šä½å‘¢ï¼Ÿå½“ç„¶æ˜¯å¯ä»¥çš„ï¼Œä¿®æ”¹`activity_main.xml`ä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n<RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n    <Button android:id=\"@+id/button3\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_centerInParent=\"true\"\n        android:text=\"Button 3\">\n    </Button>\n    <Button android:id=\"@+id/button1\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_above=\"@id/button3\"\n        android:layout_toLeftOf=\"@id/button3\"\n        android:text=\"Button 1\">\n    </Button>\n    <Button android:id=\"@+id/button2\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_above=\"@id/button3\"\n        android:layout_toRightOf=\"@id/button3\"\n        android:text=\"Button 2\">\n    </Button>\n    <Button android:id=\"@+id/button4\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_below=\"@id/button3\"\n        android:layout_toLeftOf=\"@id/button3\"\n        android:text=\"Button 4\">\n    </Button>\n    <Button android:id=\"@+id/button5\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_below=\"@id/button3\"\n        android:layout_toRightOf=\"@id/button3\"\n        android:text=\"Button 5\">\n    </Button>\n</RelativeLayout>\n```\n\nè¿™æ¬¡çš„ä»£ç ç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œä¸è¿‡ä»ç„¶æ˜¯æœ‰è§„å¾‹å¯å¾ªçš„ã€‚`android:layout_above`å±æ€§å¯ä»¥è®©ä¸€ä¸ªæ§ä»¶ä½äºå¦ä¸€ä¸ªæ§ä»¶çš„ä¸Šæ–¹ï¼Œéœ€è¦ä¸ºè¿™ä¸ªå±æ€§æŒ‡å®šç›¸å¯¹æ§ä»¶idçš„å¼•ç”¨ï¼Œè¿™é‡Œæˆ‘ä»¬å¡«å…¥äº†`@id/button3`ï¼Œè¡¨ç¤ºè®©è¯¥æ§ä»¶ä½äºButton3çš„ä¸Šæ–¹ã€‚å…¶ä»–çš„å±æ€§ä¹Ÿéƒ½æ˜¯ç›¸ä¼¼çš„ï¼Œ`android:layout_below`è¡¨ç¤ºè®©ä¸€ä¸ªæ§ä»¶ä½äºå¦ä¸€ä¸ªæ§ä»¶çš„ä¸‹æ–¹ï¼Œ`android:layout_toLeftOf`è¡¨ç¤ºè®©ä¸€ä¸ªæ§ä»¶ä½äºå¦ä¸€ä¸ªæ§ä»¶çš„å·¦ä¾§ï¼Œ`android:layout_toRightOf`è¡¨ç¤ºè®©ä¸€ä¸ªæ§ä»¶ä½äºå¦ä¸€ä¸ªæ§ä»¶çš„å³ä¾§ã€‚\n\n> æ³¨æ„ï¼Œå½“ä¸€ä¸ªæ§ä»¶å»å¼•ç”¨å¦ä¸€ä¸ªæ§ä»¶çš„idæ—¶ï¼Œè¯¥æ§ä»¶ä¸€å®šè¦å®šä¹‰åœ¨å¼•ç”¨æ§ä»¶çš„åé¢ï¼Œä¸ç„¶ä¼šå‡ºç°æ‰¾ä¸åˆ°idçš„æƒ…å†µã€‚\n\n![image-20220816152848133](../../images/Android_UI/image-20220816152848133.png)\n\nRelativeLayoutä¸­è¿˜æœ‰å¦å¤–ä¸€ç»„ç›¸å¯¹äºæ§ä»¶è¿›è¡Œå®šä½çš„å±æ€§ï¼Œ`android:layout_alignLeft`è¡¨ç¤ºè®©ä¸€ä¸ªæ§ä»¶çš„å·¦è¾¹ç¼˜å’Œå¦ä¸€ä¸ªæ§ä»¶çš„å·¦è¾¹ç¼˜å¯¹é½ï¼Œ`android:layout_alignRight`è¡¨ç¤ºè®©ä¸€ä¸ªæ§ä»¶çš„å³è¾¹ç¼˜å’Œå¦ä¸€ä¸ªæ§ä»¶çš„å³è¾¹ç¼˜å¯¹é½ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰`android:layout_alignTop`å’Œ`android:layout_alignBottom`ï¼Œé“ç†éƒ½æ˜¯ä¸€æ ·çš„ã€‚\n\n## å¸§å¸ƒå±€\n\nFrameLayoutåˆç§°ä½œå¸§å¸ƒå±€ï¼Œå®ƒç›¸æ¯”äºå‰é¢ä¸¤ç§å¸ƒå±€å°±ç®€å•å¤ªå¤šäº†ï¼Œå› æ­¤å®ƒçš„åº”ç”¨åœºæ™¯ä¹Ÿå°‘äº†å¾ˆå¤šã€‚è¿™ç§å¸ƒå±€æ²¡æœ‰æ–¹ä¾¿çš„å®šä½æ–¹å¼ï¼Œæ‰€æœ‰çš„æ§ä»¶éƒ½ä¼šé»˜è®¤æ‘†æ”¾åœ¨å¸ƒå±€çš„å·¦ä¸Šè§’ã€‚ä¿®æ”¹`activity_main.xml`ä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n<FrameLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n    <TextView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"This is Text View\">\n    </TextView>\n    <ImageView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:src=\"@mipmap/ic_launcher\">\n    </ImageView>\n\n</FrameLayout>\n```\n\nFrameLayoutä¸­åªæ˜¯æ”¾ç½®äº†ä¸€ä¸ªTextViewå’Œä¸€ä¸ªImageViewã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“å‰é¡¹ç›®æˆ‘ä»¬æ²¡æœ‰å‡†å¤‡ä»»ä½•å›¾ç‰‡ï¼Œæ‰€ä»¥è¿™é‡ŒImageViewç›´æ¥ä½¿ç”¨äº†mipmapæ¥è®¿é—®`ic_launcher`è¿™å¼ å›¾ã€‚\n\n![image-20220816153957404](../../images/Android_UI/image-20220816153957404.png)\n\nå¯ä»¥çœ‹åˆ°ï¼Œæ–‡å­—å’Œå›¾ç‰‡éƒ½æ˜¯ä½äºå¸ƒå±€çš„å·¦ä¸Šè§’ã€‚ç”±äºImageViewæ˜¯åœ¨ TextViewä¹‹åæ·»åŠ çš„ï¼Œå› æ­¤å›¾ç‰‡å‹åœ¨äº†æ–‡å­—çš„ä¸Šé¢ã€‚å½“ç„¶é™¤äº†è¿™ç§é»˜è®¤æ•ˆæœä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨`layout_gravity`å±æ€§æ¥æŒ‡å®šæ§ä»¶åœ¨å¸ƒå±€ä¸­çš„å¯¹é½æ–¹å¼ï¼Œè¿™å’ŒLinearLayoutä¸­çš„ç”¨æ³•æ˜¯ç›¸ä¼¼çš„ã€‚ä¿®æ”¹`activity_main.xml`ä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n<FrameLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n    <TextView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_gravity=\"left\"\n        android:text=\"This is Text View\">\n    </TextView>\n    <ImageView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_gravity=\"right\"\n        android:src=\"@mipmap/ic_launcher\">\n    </ImageView>\n\n</FrameLayout>\n```\n\næˆ‘ä»¬æŒ‡å®šTextViewåœ¨FrameLayoutä¸­å±…å·¦å¯¹é½ï¼ŒæŒ‡å®šImageViewåœ¨FrameLayoutä¸­å±…å³å¯¹é½ã€‚\n\n![image-20220816154415718](../../images/Android_UI/image-20220816154415718.png)\n\næ€»ä½“æ¥è®²ï¼ŒFrameLayoutç”±äºå®šä½æ–¹å¼çš„æ¬ ç¼ºï¼Œå¯¼è‡´å®ƒçš„åº”ç”¨åœºæ™¯ä¹Ÿæ¯”è¾ƒå°‘ï¼Œä¸è¿‡åœ¨ç”¨ç¢ç‰‡çš„æ—¶å€™æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥ç”¨åˆ°å®ƒçš„ã€‚\n\n# è‡ªå®šä¹‰æ§ä»¶\n\nå‰é¢æ²¡æœ‰å…³æ³¨æ§ä»¶å’Œå¸ƒå±€çš„ç»§æ‰¿ç»“æ„ã€‚\n\næˆ‘ä»¬æ‰€ç”¨çš„æ‰€æœ‰**æ§ä»¶**éƒ½æ˜¯ç›´æ¥æˆ–é—´æ¥ç»§æ‰¿è‡ªViewçš„ï¼Œæ‰€ç”¨çš„æ‰€æœ‰**å¸ƒå±€**éƒ½æ˜¯ç›´æ¥æˆ–é—´æ¥ç»§æ‰¿è‡ªViewGroupçš„ã€‚Viewæ˜¯Androidä¸­æœ€åŸºæœ¬çš„ä¸€ç§UIç»„ä»¶ï¼Œå®ƒå¯ä»¥åœ¨å±å¹•ä¸Šç»˜åˆ¶ä¸€å—çŸ©å½¢åŒºåŸŸï¼Œå¹¶èƒ½å“åº”è¿™å—åŒºåŸŸçš„å„ç§äº‹ä»¶ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„å„ç§æ§ä»¶å…¶å®å°±æ˜¯åœ¨Viewçš„åŸºç¡€ä¹‹ä¸Šåˆæ·»åŠ äº†å„è‡ªç‰¹æœ‰çš„åŠŸèƒ½ã€‚è€ŒViewGroupåˆ™æ˜¯ä¸€ç§ç‰¹æ®Šçš„Viewï¼Œå®ƒå¯ä»¥åŒ…å«å¾ˆå¤šå­Viewå’Œå­ViewGroupã€‚æ˜¯ä¸€ä¸ªç”¨äºæ”¾ç½®æ§ä»¶å’Œå¸ƒå±€çš„å®¹å™¨ã€‚\n\nå½“ç³»ç»Ÿè‡ªå¸¦çš„æ§ä»¶å¹¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚æ—¶ï¼Œå¯ä»¥åˆ©ç”¨ä¸Šé¢çš„ç»§æ‰¿ç»“æ„æ¥åˆ›å»ºè‡ªå®šä¹‰æ§ä»¶å‘¢ã€‚æœ‰ä¸¤ç§ç®€å•æ–¹æ³•åˆ›å»ºè‡ªå®šä¹‰æ§ä»¶ã€‚\n\nå…ˆå°†å‡†å¤‡å·¥ä½œåšå¥½ï¼Œåˆ›å»ºä¸€ä¸ªUICustomViewsé¡¹ç›®ã€‚\n\n## å¼•å…¥å¸ƒå±€\n\nå¦‚æœç”¨è¿‡iPhoneåº”è¯¥ä¼šçŸ¥é“ï¼Œå‡ ä¹æ¯ä¸€ä¸ªiPhoneåº”ç”¨çš„ç•Œé¢é¡¶éƒ¨éƒ½ä¼šæœ‰ä¸€ä¸ªæ ‡é¢˜æ ï¼Œæ ‡é¢˜æ ä¸Šä¼šæœ‰ä¸€åˆ°ä¸¤ä¸ªæŒ‰é’®å¯ç”¨äºè¿”å›æˆ–å…¶ä»–æ“ä½œï¼ˆiPhoneæ²¡æœ‰å®ä½“è¿”å›é”®ï¼‰ã€‚ç°åœ¨å¾ˆå¤šAndroidç¨‹åºä¹Ÿéƒ½å–œæ¬¢æ¨¡ä»¿iPhoneçš„é£æ ¼ï¼Œåœ¨ç•Œé¢çš„é¡¶éƒ¨æ”¾ç½®ä¸€ä¸ªæ ‡é¢˜æ ã€‚è™½ç„¶Androidç³»ç»Ÿå·²ç»ç»™æ¯ä¸ªæ´»åŠ¨æä¾›äº†æ ‡é¢˜æ åŠŸèƒ½ï¼Œä½†è¿™é‡Œæˆ‘ä»¬å†³å®šå…ˆä¸ä½¿ç”¨å®ƒï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„æ ‡é¢˜æ ã€‚\n\nç»è¿‡å‰é¢çš„çŸ¥è¯†ï¼Œåˆ›å»ºä¸€ä¸ªæ ‡é¢˜æ å¸ƒå±€ä¸æ˜¯ä»€ä¹ˆå›°éš¾çš„äº‹æƒ…äº†ï¼Œåªéœ€è¦åŠ å…¥ä¸¤ä¸ªButtonå’Œä¸€ä¸ªTextViewï¼Œç„¶ååœ¨å¸ƒå±€ä¸­æ‘†æ”¾å¥½å°±å¯ä»¥äº†ã€‚å¯æ˜¯è¿™æ ·åšå´å­˜åœ¨ç€ä¸€ä¸ªé—®é¢˜ï¼Œä¸€èˆ¬æˆ‘ä»¬çš„ç¨‹åºä¸­å¯èƒ½æœ‰å¾ˆå¤šä¸ªæ´»åŠ¨éƒ½éœ€è¦è¿™æ ·çš„æ ‡é¢˜æ ï¼Œå¦‚æœåœ¨æ¯ä¸ªæ´»åŠ¨çš„å¸ƒå±€ä¸­éƒ½ç¼–å†™ä¸€éåŒæ ·çš„æ ‡é¢˜æ ä»£ç ï¼Œæ˜æ˜¾å°±ä¼šå¯¼è‡´ä»£ç çš„å¤§é‡é‡å¤ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨**å¼•å…¥å¸ƒå±€**çš„æ–¹å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ–°å»ºä¸€ä¸ªå¸ƒå±€`title.xml`ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"wrap_content\"\n    android:background=\"@drawable/title_bg\">\n    <Button\n        android:id=\"@+id/title_back\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_gravity=\"center\"\n        android:layout_margin=\"5dp\"\n        android:background=\"@drawable/back_bg\"\n        android:text=\"Back\"\n        android:textColor=\"#fff\">\n        \n    </Button>\n    <TextView\n        android:id=\"@+id/title_text\"\n        android:layout_width=\"0dp\"\n        android:layout_height=\"wrap_content\"\n        android:layout_gravity=\"center\"\n        android:layout_weight=\"1\"\n        android:gravity=\"center\"\n        android:text=\"Title Text\"\n        android:textColor=\"#fff\"\n        android:textSize=\"24sp\">\n        \n    </TextView>\n    <Button\n        android:id=\"@+id/title_edit\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_gravity=\"center\"\n        android:layout_margin=\"5dp\"\n        android:background=\"@drawable/edit_bg\"\n        android:text=\"Edit\"\n        android:textColor=\"#fff\">\n        \n    </Button>\n</LinearLayout>\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨LinearLayoutä¸­åˆ†åˆ«åŠ å…¥äº†ä¸¤ä¸ªButtonå’Œä¸€ä¸ªTextViewï¼Œå·¦è¾¹çš„Buttonå¯ç”¨äºè¿”å›ï¼Œå³è¾¹çš„Buttonå¯ç”¨äºç¼–è¾‘ï¼Œä¸­é—´çš„TextViewåˆ™å¯ä»¥æ˜¾ç¤ºä¸€æ®µæ ‡é¢˜æ–‡æœ¬ã€‚ä¸Šé¢ä»£ç ä¸­çš„å¤§å¤šæ•°å±æ€§éƒ½æ˜¯ä½ å·²ç»è§è¿‡çš„ï¼Œä¸‹é¢æˆ‘æ¥è¯´æ˜ä¸€ä¸‹å‡ ä¸ªä¹‹å‰æ²¡æœ‰è®²è¿‡çš„å±æ€§ã€‚`android:background`ç”¨äºä¸ºå¸ƒå±€æˆ–æ§ä»¶æŒ‡å®šä¸€ä¸ªèƒŒæ™¯ï¼Œå¯ä»¥ä½¿ç”¨é¢œè‰²æˆ–å›¾ç‰‡æ¥è¿›è¡Œå¡«å……ï¼Œè¿™é‡Œæå‰å‡†å¤‡3å¼ å›¾ç‰‡`title_bg.png`ã€`back_bg.png`å’Œ`edit_bg.png`ï¼Œåˆ†åˆ«ç”¨äºä½œä¸ºæ ‡é¢˜æ ã€è¿”å›æŒ‰é’®å’Œç¼–è¾‘æŒ‰é’®çš„èƒŒæ™¯ã€‚å¦å¤–ï¼Œåœ¨ä¸¤ä¸ªButtonä¸­éƒ½ä½¿ç”¨ `android:layout_marqin`è¿™ä¸ªå±æ€§ï¼Œå®ƒå¯ä»¥æŒ‡å®šæ§ä»¶åœ¨ä¸Šä¸‹å·¦å³æ–¹å‘ä¸Šåç§»çš„è·ç¦»ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨`android:layout_marginLeft`æˆ–`android:layout_marginTop`ç­‰å±æ€§æ¥å•ç‹¬æŒ‡å®šæ§ä»¶åœ¨æŸä¸ªæ–¹å‘ä¸Šåç§»çš„è·ç¦»ã€‚ç°åœ¨æ ‡é¢˜æ å¸ƒå±€å·²ç»ç¼–å†™å®Œæˆäº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯å¦‚ä½•åœ¨ç¨‹åºä¸­ä½¿ç”¨è¿™ä¸ªæ ‡é¢˜æ äº†ï¼Œä¿®æ”¹`activity_main.xml`ä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n    \n    <include layout=\"@layout/title\"/>\n    \n</LinearLayout>\n```\n\nåªéœ€è¦é€šè¿‡ä¸€è¡Œincludeè¯­å¥å°†æ ‡é¢˜æ å¸ƒå±€å¼•å…¥è¿›æ¥å°±å¯ä»¥äº†ã€‚\n\næœ€ååˆ«å¿˜äº†åœ¨MainActivityä¸­å°†ç³»ç»Ÿè‡ªå¸¦çš„æ ‡é¢˜æ éšè—æ‰ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\npublic class MainActivity extends AppCompatActivity {\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        ActionBar actionBar = getSupportActionBar();\n        if (actionBar != null) {\n            actionbar.hide();\n        }\n    }\n}\n// è¿™é‡Œè°ƒç”¨äº†getSupportActionBaræ–¹æ³•æ¥è·å¾—ActionBarçš„å®ä¾‹ï¼Œç„¶åå†è°ƒç”¨ActionBarçš„hideæ–¹æ³•å°†æ ‡é¢˜æ éšè—èµ·æ¥ã€‚\n```\n\n![image-20220816163052927](../../images/Android_UI/image-20220816163052927.png)\n\n## åˆ›å»ºè‡ªå®šä¹‰æ§ä»¶\n\nå¼•å…¥å¸ƒå±€çš„æŠ€å·§ç¡®å®è§£å†³äº†é‡å¤ç¼–å†™å¸ƒå±€ä»£ç çš„é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœå¸ƒå±€ä¸­æœ‰ä¸€äº›æ§ä»¶è¦æ±‚èƒ½å¤Ÿå“åº”äº‹ä»¶ï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦åœ¨æ¯ä¸ªæ´»åŠ¨ä¸­ä¸ºè¿™äº›æ§ä»¶å•ç‹¬ç¼–å†™ä¸€æ¬¡äº‹ä»¶æ³¨å†Œçš„ä»£ç ã€‚æ¯”å¦‚è¯´æ ‡é¢˜æ ä¸­çš„è¿”å›æŒ‰é’®ï¼Œå…¶å®ä¸ç®¡æ˜¯åœ¨å“ªä¸€ä¸ªæ´»åŠ¨ä¸­ï¼Œè¿™ä¸ªæŒ‰é’®çš„åŠŸèƒ½éƒ½æ˜¯ç›¸åŒçš„ï¼Œå³é”€æ¯å½“å‰æ´»åŠ¨ã€‚è€Œå¦‚æœåœ¨æ¯ä¸€ä¸ªæ´»åŠ¨ä¸­éƒ½éœ€è¦é‡æ–°æ³¨å†Œä¸€éè¿”å›æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ï¼Œæ— ç–‘ä¼šå¢åŠ å¾ˆå¤šé‡å¤ä»£ç ï¼Œè¿™ç§æƒ…å†µæœ€å¥½æ˜¯ä½¿ç”¨è‡ªå®šä¹‰æ§ä»¶çš„æ–¹å¼æ¥è§£å†³ã€‚æ–°å»ºTitleLayoutç»§æ‰¿è‡ªLinearLayoutï¼Œè®©å®ƒæˆä¸ºæˆ‘ä»¬è‡ªå®šä¹‰çš„æ ‡é¢˜æ æ§ä»¶ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\npublic class TitleLayout extends LinearLayout {\n    public TitleLayout(Context context, AttributeSet attrs) {\n        super(context, attrs);\n        LayoutInflater.from(context).inflate(R.layout.title, this);\n    }\n}\n```\n\né¦–å…ˆæˆ‘ä»¬é‡å†™äº†LinearLayoutä¸­å¸¦æœ‰ä¸¤ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°ï¼Œåœ¨å¸ƒå±€ä¸­å¼•å…¥TitleLayoutæ§ä»¶å°±ä¼šè°ƒç”¨è¿™ä¸ªæ„é€ å‡½æ•°ã€‚ç„¶ååœ¨æ„é€ å‡½æ•°ä¸­éœ€è¦å¯¹æ ‡é¢˜æ å¸ƒå±€è¿›è¡ŒåŠ¨æ€åŠ è½½ï¼Œè¿™å°±è¦å€ŸåŠ©`LayoutInflater`æ¥å®ç°äº†ã€‚é€šè¿‡Layoutlnflaterçš„fromæ–¹æ³•å¯ä»¥æ„å»ºå‡ºä¸€ä¸ªLayoutInflaterå¯¹è±¡ï¼Œç„¶åè°ƒç”¨inflateæ–¹æ³•å°±å¯ä»¥åŠ¨æ€åŠ è½½ä¸€ä¸ªå¸ƒå±€æ–‡ä»¶ï¼Œinflateæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦åŠ è½½çš„å¸ƒå±€æ–‡ä»¶çš„idï¼Œè¿™é‡Œæˆ‘ä»¬ä¼ å…¥ `R.layout.titel`ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç»™åŠ è½½å¥½çš„å¸ƒå±€å†æ·»åŠ ä¸€ä¸ªçˆ¶å¸ƒå±€ï¼Œè¿™é‡Œæˆ‘ä»¬æƒ³è¦æŒ‡å®šä¸ºTitleLayoutï¼Œäºæ˜¯ç›´æ¥ä¼ å…¥thisã€‚ç°åœ¨è‡ªå®šä¹‰æ§ä»¶å·²ç»åˆ›å»ºå¥½äº†ï¼Œç„¶åæˆ‘ä»¬éœ€è¦åœ¨å¸ƒå±€æ–‡ä»¶ä¸­æ·»åŠ è¿™ä¸ªè‡ªå®šä¹‰æ§ä»¶ï¼Œä¿®æ”¹`activity_main.xml`ä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n    <com.example.uicustomviews.TitleLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"/>\n\n</LinearLayout>\n```\n\næ·»åŠ è‡ªå®šä¹‰æ§ä»¶å’Œæ·»åŠ æ™®é€šæ§ä»¶çš„æ–¹å¼åŸºæœ¬æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡**åœ¨æ·»åŠ è‡ªå®šä¹‰æ§ä»¶çš„æ—¶å€™éœ€è¦æŒ‡æ˜æ§ä»¶çš„å®Œæ•´ç±»å**ï¼ŒåŒ…ååœ¨è¿™é‡Œæ˜¯ä¸å¯ä»¥çœç•¥çš„ã€‚é‡æ–°è¿è¡Œç¨‹åºï¼Œä¼šå‘ç°æ­¤æ—¶æ•ˆæœå’Œä½¿ç”¨å¼•å…¥å¸ƒå±€æ–¹å¼çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚ä¸‹é¢å°è¯•ä¸ºæ ‡é¢˜æ ä¸­çš„æŒ‰é’®æ³¨å†Œç‚¹å‡»äº‹ä»¶ï¼Œä¿®æ”¹TitleLayoutä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\npublic class TitleLayout extends LinearLayout {\n    public TitleLayout(Context context, AttributeSet attrs) {\n        super(context, attrs);\n        LayoutInflater.from(context).inflate(R.layout.title, this);\n        Button titleBack = (Button) findViewById(R.id.title_back);\n        Button titleEdit = (Button) findViewById(R.id.title_edit);\n        titleBack.setOnClickListener(new OnClickListener() {\n            @Override\n            public void onClick(View view) {\n                ((Activity) getContext()).finish();\n            }\n        });\n        titleEdit.setOnClickListener(new OnClickListener() {\n            @Override\n            public void onClick(View view) {\n                Toast.makeText(getContext(), \"You clicked Edit button\",\n                        Toast.LENGTH_SHORT).show();\n            }\n        });\n    }\n}\n```\n\nå¦‚æ­¤ä¸€æ¥ï¼ŒåŸæœ‰çš„æ ‡é¢˜æ å¸ƒå±€åœ¨MainActivityä¸­éšè—ï¼Œåæ¥çš„è‡ªå®šä¹‰æ ‡é¢˜æ åœ¨TitleLayout.javaä¸­åŠ¨æ€åŠ è½½ã€‚\n\n![image-20220816170200744](../../images/Android_UI/image-20220816170200744.png)\n\né¦–å…ˆè¿˜æ˜¯é€šè¿‡`findViewById`æ–¹æ³•å¾—åˆ°æŒ‰é’®çš„å®ä¾‹ï¼Œç„¶ååˆ†åˆ«è°ƒç”¨setOnClickListeneræ–¹æ³•ç»™ä¸¤ä¸ªæŒ‰é’®æ³¨å†Œäº†ç‚¹å‡»äº‹ä»¶ï¼Œå½“ç‚¹å‡»è¿”å›æŒ‰é’®æ—¶é”€æ¯æ‰å½“å‰çš„æ´»åŠ¨ï¼Œå½“ç‚¹å‡»ç¼–è¾‘æŒ‰é’®æ—¶å¼¹å‡ºä¸€æ®µæ–‡æœ¬ã€‚\n\nè¿™æ ·çš„è¯ï¼Œæ¯å½“æˆ‘ä»¬åœ¨ä¸€ä¸ªå¸ƒå±€ä¸­å¼•å…¥TitleLayoutæ—¶ï¼Œè¿”å›æŒ‰é’®å’Œç¼–è¾‘æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶å°±å·²ç»è‡ªåŠ¨å®ç°å¥½äº†ï¼Œè¿™å°±çœå»äº†å¾ˆå¤šç¼–å†™é‡å¤ä»£ç çš„å·¥ä½œã€‚\n","categories":["Android"]},{"title":"02_RPCé€šä¿¡åŸç†","url":"/RPC/02_RPCé€šä¿¡åŸç†/","content":"# RPCé€šä¿¡åŸç†\n\nremote procedure callï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ã€‚åˆ†å¸ƒå¼é€šä¿¡é æ­¤å®ç°ã€‚ä¹Ÿæ˜¯åˆ†å¸ƒå¼é€šä¿¡åº•å±‚è¦è§£å†³çš„é—®é¢˜ã€‚\n\n# æ•´ä½“æµç¨‹\n\nrpcæ–¹æ³•åå­—ï¼Œå‚æ•°ã€‚å‚æ•°ä¸€èˆ¬éœ€è¦æ‰“åŒ…ã€‚\n\nä»callerç«¯çš„Useråˆ°RPCRuntimeï¼Œä¸­é—´éœ€è¦åºåˆ—åŒ–çš„æµç¨‹ï¼Œå³æŠŠå‚æ•°æ‰“åŒ…çš„æµç¨‹ã€‚åºåˆ—åŒ–ä¹‹åå°±å¯ä»¥é€šè¿‡ç½‘ç»œä¼ åˆ°è¿œç«¯å¦å¤–çš„æœºå™¨ã€‚ç½‘ç»œå¯ä»¥é€‰ç”¨muduoç½‘ç»œåº“ã€‚\n\ncallerç«¯\n\n1. User - **ç”¨æˆ·å¯è§**\n   1. local call - **ç”¨æˆ·å¯è§**\n2. User-stub\n   1. pack argument\n3. RPCRuntime\n   1. transmit\n   2. wait\n\nè¿œç«¯calleeç«¯æ¥æ”¶åˆ°RPCè¯·æ±‚ä¹‹åï¼Œä»ç½‘ç»œåº•å±‚ä¸ŠæŠ¥ä¸Šæ¥ï¼Œéœ€è¦æŠŠæ‰“åŒ…çš„å‚æ•°è¿›è¡Œè§£æï¼Œå³ååºåˆ—åŒ–ä¸ºå…·ä½“çš„ä¿¡æ¯ï¼Œæ¯”å¦‚æ–¹æ³•çš„æ ‡è¯†ã€å‚æ•°ã€‚ä¼ é€’åˆ°è¿›ç¨‹ä¸­æ‰§è¡ŒæŸä¸ªå‡½æ•°ã€‚\n\ncalleeç«¯\n\n1. RPCRuntime\n   1. receive\n2. Server-stub\n   1. unpack argument\n3. Server - **æœåŠ¡å™¨å¯è§**\n   1. call - **æœåŠ¡å™¨å¯è§**\n   2. workï¼ˆæ‰§è¡Œå‡½æ•°ï¼‰ - **æœåŠ¡å™¨å¯è§**\n   3. return - **æœåŠ¡å™¨å¯è§**\n\nè¿œç«¯calleeè¿”å›ç»“æœæ—¶ï¼Œéœ€è¦pack resultï¼Œç»™ç»“æœå†…å®¹æ‰“åŒ…ï¼Œåºåˆ—åŒ–ã€‚ä¼ é€ç»™callerã€‚\n\n1. Server\n   1. return\n2. Server-stub\n   1. pack result\n3. RPCRuntime\n   1. transmit\n\ncallerç«¯æ”¶åˆ°è¿”å›åŒ…åï¼Œå”¤é†’ï¼Œååºåˆ—åŒ–ï¼Œè§£æä¸ºunpack resultï¼Œç”Ÿæˆæœ¬åœ°å¯¹è±¡ã€‚\n\n1. RPCRuntime\n   1. receive\n2. User-stub\n   1. unpack result\n3. User - **ç”¨æˆ·å¯è§**\n   1. local return - **ç”¨æˆ·å¯è§**\n\næˆ‘ä»¬RPCæ¡†æ¶è¦å®ç°çš„ä¸œè¥¿ï¼Œé™¤äº†æ ‡è¯†çš„ç”¨æˆ·å¯è§ã€æœåŠ¡å™¨å¯è§çš„åœ°æ–¹ä¹‹å¤–ï¼Œéƒ½è¦å®ç°å¹¶å°è£…ã€‚\n\n![image-20220815205906401](../../images/RPCé€šä¿¡åŸç†/image-20220815205906401.png)\n\né»„è‰²éƒ¨åˆ†ï¼šè®¾è®¡rpcæ–¹æ³•å‚æ•°çš„æ‰“åŒ…å’Œè§£æï¼Œ ä¹Ÿå°±æ˜¯æ•°æ®çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œ **ä½¿ç”¨Protobuf**ã€‚æ­¤éƒ¨åˆ†ç§°ä¹‹ä¸ºstubï¼Œæ„æ€æ˜¯æ¡©ï¼Œæ˜¯ä¸€ä¸ªä»£ç†ç±»çš„è§’è‰²ã€‚\n\nç»¿è‰²éƒ¨åˆ†ï¼šç½‘ç»œéƒ¨åˆ†ï¼ŒåŒ…æ‹¬å¯»æ‰¾rpcæœåŠ¡ä¸»æœºï¼Œå‘èµ·rpcè°ƒç”¨è¯·æ±‚å’Œå“åº”rpcè°ƒç”¨ç»“æœï¼Œ**ä½¿ç”¨muduoç½‘ç»œåº“å’ŒzookeeperæœåŠ¡é…ç½®ä¸­å¿ƒ**ï¼ˆä¸“é—¨åšæœåŠ¡å‘ç°ï¼‰ã€‚\n\nmprpcæ¡†æ¶ä¸»è¦åŒ…å«ä»¥ä¸Šä¸¤ä¸ªéƒ¨åˆ†çš„å†…å®¹ã€‚\n\n# åºåˆ—åŒ–ã€ååºåˆ—åŒ–å·¥å…·\n\nç”¨protobufã€‚\n\nprotobufæ˜¯äºŒè¿›åˆ¶å­˜å‚¨çš„ã€‚ç›¸æ¯”äºxmlã€jsonçš„æ–‡æœ¬å­˜å‚¨å½¢å¼æ¥è¯´ï¼Œ\n1. äºŒè¿›åˆ¶å­˜å‚¨æœ‰èŠ‚çœç©ºé—´çš„ä¼˜ç‚¹ã€‚åœ¨åŒç­‰ç½‘ç»œç¯å¢ƒä¸‹ï¼Œæ€§èƒ½æ›´ä¼˜ã€‚\n2. protobufä¸éœ€è¦å­˜å‚¨é¢å¤–çš„ä¿¡æ¯ï¼Œè€Œjsonå­˜å‚¨çš„æ˜¯key-valueã€‚protobufåªå­˜å‚¨å€¼æ•°æ®ã€‚\n\nå¯èƒ½çš„å½¢å¼ï¼š\nJsonï¼š\n```json\nname: \"zhang san\",\npwd: \"123456\"\n```\nProtobufï¼š\n```protobuf\n\"zhangsan\"\"123456\"\n```","categories":["é¡¹ç›®","rpc"]},{"title":"git_å„ç§åˆ‡æ¢åˆ†æ”¯_å›é€€","url":"/git/git_å„ç§åˆ‡æ¢åˆ†æ”¯_å›é€€/","content":"\nå‚è€ƒæ–‡ç« ï¼šä¸€æ–‡è®²é€ Git åº•å±‚æ•°æ®ç»“æ„å’ŒåŸç† - é˜¿é‡Œå¼€å‘è€…çš„æ–‡ç«  - çŸ¥ä¹ https://zhuanlan.zhihu.com/p/142289703\n\n![image-20220815154815483](../../images/Linux_git_add/image-20220815154815483.png)\n\n# ç®€è¦è¯´æ˜\n\n| å‘½ä»¤     | æè¿°                                          |\n| -------- | --------------------------------------------- |\n| checkout | Switch branches or restore working tree files |\n| reset    | Reset current HEAD to the specified state     |\n| revert   | Revert some existing commits                  |\n| rebase   | Reapply commits on top of another base tip    |\n| switch   | Switch branches                               |\n| restore  | Restore working tree files                    |\n\nå¯ä»¥çœ‹å‡ºï¼Œcheckoutå®é™…ä¸Šæ˜¯switchå’Œrestoreçš„ç»“åˆã€‚\n\n# å¯¹åº”çš„åœºæ™¯\n\n## checkout\n\nä¸¤ä¸ªä½œç”¨ï¼Œä¸€æ˜¯åˆ‡æ¢åˆ†æ”¯ï¼ŒäºŒæ˜¯æ¢å¤å·¥ä½œåŒºä»£ç ã€‚å¦‚æœcheckoutç›¸åŒåˆ†æ”¯ï¼Œåˆ™ä½œç”¨å°±æ˜¯æ¢å¤å·¥ä½œåŒºä»£ç ã€‚å› æ­¤ï¼Œå¯ä»¥ä½œç”¨äºï¼Œæƒ³è¦æŠŠæœªaddçš„ä»£ç æ¢å¤åˆ°æœ€æ–°commitçš„çŠ¶æ€ã€‚\n\n## reset\n\n1. `git reset --mixed`ï¼šæ­¤ä¸ºé»˜è®¤æ–¹å¼ï¼Œç­‰åŒäºä¸å¸¦ä»»ä½•å‚æ•°çš„git resetã€‚è¿™ç§æ–¹å¼ï¼Œåªä¿ç•™æºç ï¼Œå›é€€commitå’Œindexä¿¡æ¯\n2. `git reset --soft`ï¼šå›é€€åˆ°æŸä¸ªç‰ˆæœ¬ï¼Œåªå›é€€äº†commitçš„ä¿¡æ¯ï¼Œå¦‚æœè¿˜è¦æäº¤ï¼Œç›´æ¥commitå³å¯ï¼ˆä¿®æ”¹çš„å†…å®¹å˜æˆæœªaddçš„çŠ¶æ€ï¼‰ï¼Œç´¢å¼•ï¼ˆæš‚å­˜åŒºï¼‰å’Œå·¥ä½œç›®å½•çš„å†…å®¹æ˜¯ä¸å˜çš„ï¼Œåœ¨ä¸‰ä¸ªå‘½ä»¤ä¸­å¯¹ç°æœ‰ç‰ˆæœ¬åº“çŠ¶æ€æ”¹åŠ¨æœ€å°ã€‚\n3. `git reset --hard`ï¼šå½»åº•å›é€€åˆ°æŸä¸ªç‰ˆæœ¬ï¼Œæœ¬åœ°çš„æºç ä¹Ÿä¼šå˜ä¸ºä¸Šä¸€ä¸ªç‰ˆæœ¬çš„å†…å®¹ï¼Œæ‰€æœ‰ä¿®æ”¹çš„å†…å®¹éƒ½ä¼šä¸¢å¤±ï¼Œ (ä¿®æ”¹çš„ä»£ç  ä¸ä¼šå˜æˆæœªaddçš„çŠ¶æ€)ã€‚ç´¢å¼•ï¼ˆæš‚å­˜åŒºï¼‰å†…å®¹å’Œå·¥ä½œç›®å½•å†…å®¹éƒ½ä¼šå˜ç»™å®šæäº¤æ—¶çš„çŠ¶æ€ã€‚\n\n## revert\n\nrevertæˆ‘ä»¬commitäº†ä¸‰ä¸ªç‰ˆæœ¬ï¼ˆç‰ˆæœ¬ä¸€ã€ç‰ˆæœ¬äºŒã€ ç‰ˆæœ¬ä¸‰ï¼‰ï¼Œçªç„¶å‘ç°ç‰ˆæœ¬äºŒä¸è¡Œï¼ˆå¦‚ï¼šæœ‰bugï¼‰ï¼Œæƒ³è¦æ’¤é”€ç‰ˆæœ¬äºŒï¼Œä½†åˆä¸æƒ³å½±å“æ’¤é”€ç‰ˆæœ¬ä¸‰çš„æäº¤å°±å¯ä»¥ç”¨ git revert å‘½ä»¤æ¥ååšç‰ˆæœ¬äºŒï¼Œç”Ÿæˆæ–°çš„ç‰ˆæœ¬å››ï¼Œè¿™ä¸ªç‰ˆæœ¬å››é‡Œä¼šä¿ç•™ç‰ˆæœ¬ä¸‰çš„ä¸œè¥¿ï¼Œä½†æ’¤é”€äº†ç‰ˆæœ¬äºŒçš„ä¸œè¥¿\n\nå‚è€ƒé“¾æ¥ï¼šhttps://www.jianshu.com/p/ef34fa4c8bf8\n\n## rebase\n\nhttps://blog.csdn.net/weixin_42310154/article/details/119004977\n\n# gitå›é€€\n\n## åªå›é€€å•ä¸ªæ–‡ä»¶\n\nhttps://zhuanlan.zhihu.com/p/267141048\n\nGitåœ¨2.17ä¸­æ–°å¢ä¸¤ä¸ªå‘½ä»¤ï¼Œrestoreå’Œswitchï¼Œåˆ†æ‹…checkoutçš„èŒè´£ï¼›\n\n```\n# æ”¾å¼ƒå·¥ä½œåŒºçš„å†…å®¹ï¼Œä½¿ä¿æŒä¸æš‚å­˜åŒºä¸€è‡´\ngit restore src/index.js src/images/file.png\n```\n\n> è¿™é‡Œçš„é»˜è®¤å‚æ•°æ˜¯`--worktree`ï¼ˆå·¥ä½œåŒºï¼‰\n\næš‚å­˜åŒºå•ä¸ªæ–‡ä»¶æ”¾å¼ƒä¿®æ”¹ï¼š\n\n```\n# æ”¾å¼ƒæš‚å­˜åŒºçš„å†…å®¹ï¼Œä½¿ä¸æœ€è¿‘ä¸€æ¬¡æäº¤ä¿æŒä¸€è‡´ï¼ˆHEADï¼‰\ngit restore --stage src/index.js src/images/file.png\n```\n\n> è¿™é‡Œæ˜¯æš‚å­˜åŒºçš„å†…å®¹å‘ç”Ÿäº†å˜åŒ–ï¼Œå·¥ä½œåŒºçš„å†…å®¹ä¸ä¼šå—å½±å“\n\nå·¥ä½œåŒºå•ä¸ªæ–‡ä»¶æ¢å¤åˆ°æŸä¸ªæäº¤ç‰ˆæœ¬\n\n```\n# æ¢å¤å·¥ä½œåŒºçš„æŸä¸ªæ–‡ä»¶åˆ°æŒ‡å®šçš„æŸä¸ªç‰ˆæœ¬ï¼Œå¦‚æœæ–‡ä»¶æœ‰ä¿®æ”¹ä¹Ÿä¼šè¢«è¦†ç›–\ngit restore --source HEAD src/index.js src/images/file.png\ngit restore --source d68fsdf68s6df src/index.js src/images/file.png\n```\n\n> æ¢å¤æ“ä½œæ‰§è¡Œåéœ€è¦add\n\næš‚å­˜åŒºå•ä¸ªæ–‡ä»¶æ¢å¤åˆ°æŸä¸ªæäº¤ç‰ˆæœ¬\n\n```\n# æ¢å¤æš‚å­˜åŒºçš„æŸä¸ªæ–‡ä»¶åˆ°æŒ‡å®šçš„æŸä¸ªç‰ˆæœ¬ï¼Œå¦‚æœæš‚å­˜åŒºæ–‡ä»¶æœ‰æœªæäº¤ä¹Ÿä¼šè¢«è¦†ç›–\ngit reset HEAD src/index.js src/images/file.png\ngit reset d68fsdf68s6df src/index.js src/images/file.png\n```\n\nå¦‚æœéœ€è¦å°†å·¥ä½œåŒºä¸æš‚å­˜åŒºçš„æŸä¸ªæ–‡ä»¶éƒ½æ¢å¤åˆ°ä¹‹å‰æŸä¸ªæäº¤ç‰ˆæœ¬ï¼Œåˆ™ä½¿ç”¨checkoutæ¥æ“ä½œï¼Œç®€ç§°co\n\n```\n# åŒæ—¶å°†å·¥ä½œåŒºä¸æš‚å­˜åŒºçš„æŸä¸ªæ–‡ä»¶æ¢å¤åˆ°æŒ‡å®šç‰ˆæœ¬\ngit co HEAD src/index.js src/images/file.png\ngit co d68fsdf68s6df src/index.js src/images/file.png\n```\n\n","categories":["Linux","git"]},{"title":"åˆ†å¸ƒå¼å’Œé›†ç¾¤ä¹‹é—´çš„å¯¹æ¯”","url":"/é¡¹ç›®/åˆ†å¸ƒå¼å’Œé›†ç¾¤ä¹‹é—´çš„å¯¹æ¯”/","content":"\n# å•æœºæœåŠ¡å™¨\n\nä¸šåŠ¡ç³»ç»Ÿåšäº†æ¨¡å—åŒ–è®¾è®¡ï¼Œæ¯ä¸€ä¸ªæ¨¡å—éƒ½åŒ…å«å¾ˆå¤šç‰¹å®šçš„ä¸šåŠ¡ã€‚\n\næ‹¿èŠå¤©æœåŠ¡å™¨ä¸¾ä¾‹å­ï¼Œä¸€ä¸ªserverä¸Šï¼Œæœ‰è‹¥å¹²ä¸ªæ¨¡å—æ„æˆï¼Œæ¯”å¦‚ï¼Œç”¨æˆ·ç®¡ç†ã€å¥½å‹ç®¡ç†ã€ç¾¤ç»„ç®¡ç†ã€æ¶ˆæ¯ç®¡ç†ã€åå°ç®¡ç†æ¨¡å—ã€‚æ¯ä¸€ä¸ªæ¨¡å—éƒ½åŒ…å«ç‰¹å®šçš„ä¸šåŠ¡ï¼Œæ¯”å¦‚ç”¨æˆ·ç®¡ç†æ¨¡å—å°±åŒ…å«ç”¨æˆ·çš„ç™»å½•ï¼ˆé€šå¸¸ç”¨ä¸€ä¸ªæ–¹æ³•æ¥åšç™»å½•ä¸šåŠ¡ï¼‰ï¼Œå†å¦‚ç”¨æˆ·çš„æ³¨å†Œã€ç”¨æˆ·çš„æ³¨é”€ã€‚å¥½å‹ç®¡ç†æ¨¡å—åŒ…å«æ·»åŠ å¥½å‹ã€åˆ é™¤å¥½å‹ï¼›ç¾¤ç»„ç®¡ç†åŒ…å«åŠ ç¾¤ã€åˆ›å»ºç¾¤ã€åˆ é™¤ç¾¤æˆå‘˜ç­‰ç­‰ï¼›æ¶ˆæ¯ç®¡ç†åŒ…å«ç¦»çº¿æ¶ˆæ¯ã€ä¸€å¯¹ä¸€èŠå¤©æ¶ˆæ¯ã€ç¾¤èŠæ¶ˆæ¯ï¼›åå°ç®¡ç†åŒ…å«å¹¿æ’­æ¶ˆæ¯ç­‰ã€‚\n\n## é—®é¢˜ï¼šå•æœºæœåŠ¡å™¨åœ¨æ€§èƒ½ã€è®¾è®¡ä¸Šæœ‰ä½•ç“¶é¢ˆï¼Ÿ\n\n1. èŠå¤©æœåŠ¡å™¨æ‰€èƒ½æ‰¿å—çš„ç”¨æˆ·çš„å¹¶å‘é‡**å—é™äºç¡¬ä»¶èµ„æº**ã€‚æ¯”å¦‚32ä½æœåŠ¡å™¨ï¼Œæœ€å¤šæ”¯æŒ2wå¤šäººåŒæ—¶åœ¨çº¿èŠå¤©ï¼Œå³ç›´æ¥å—é™äºsocketèµ„æºã€‚\n2. æ‰€æœ‰æ¨¡å—è€¦åˆåœ¨ä¸€ä¸ªå•ä½“æœåŠ¡å™¨ä¸Šï¼Œå¦‚æœä¿®æ”¹ä»»æ„ä¸€ä¸ªæ¨¡å—ï¼Œå“ªæ€•æ˜¯å‡ è¡Œä»£ç ï¼Œéƒ½ä¼šå¯¼è‡´æ•´ä¸ªé¡¹ç›®ä»£ç é‡æ–°ç¼–è¯‘ã€éƒ¨ç½²ã€‚\n3. å„æ¨¡å—å¯¹äºç¡¬ä»¶èµ„æºçš„éœ€æ±‚ä¸ä¸€æ ·ã€‚æœ‰äº›æ¨¡å—å±äºCPUå¯†é›†å‹ï¼ˆè®¡ç®—é‡å¤§ï¼‰ï¼Œæœ‰äº›æ˜¯å±äºIOå¯†é›†å‹çš„ã€‚CPUå¯†é›†å‹æ¨¡å—åº”å½“éƒ¨ç½²åœ¨CPUæ€§èƒ½é«˜çš„æœºå™¨ä¸Šï¼ŒIOå¯†é›†å‹åˆ™å¯¹CPUæ€§èƒ½è¦æ±‚ä¸é«˜ï¼Œè€Œæ˜¯éœ€è¦å†…å­˜èµ„æºå¤šã€å¸¦å®½å¤§çš„æœºå™¨ã€‚\n\n# é›†ç¾¤æœåŠ¡å™¨\n\nç°åœ¨ï¼ŒæŠŠåŒä¸€ä¸ªæœåŠ¡å™¨ç¨‹åºï¼Œç‹¬ç«‹åœ°è¿è¡Œåœ¨ä¸‰ä¸ªæœåŠ¡å™¨ä¸Šï¼Œåˆ†åˆ«æ˜¯server1ã€server2ã€server3ï¼Œæ¯ä¸€å°æœåŠ¡å™¨éƒ½æ˜¯ä¸€å¥—ç‹¬ç«‹çš„èŠå¤©ç³»ç»Ÿã€‚\n\nè§£å†³äº†å•æœºæœåŠ¡å™¨çš„é—®é¢˜1ï¼Œæå‡äº†ç”¨æˆ·çš„å¹¶å‘é‡ã€‚ä½†æ˜¯æ²¡æœ‰è§£å†³é—®é¢˜2ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹ä»£ç ï¼Œä»éœ€é‡æ–°ç¼–è¯‘ï¼Œåªä¸è¿‡åªéœ€è¦ç¼–è¯‘1ä»½ï¼Œä½†æ˜¯ä»éœ€é‡æ–°éƒ¨ç½²åœ¨å¤šå°æœåŠ¡å™¨ä¸Šã€‚é’ˆå¯¹é—®é¢˜3ï¼Œå•çº¯çš„é›†ç¾¤åªæ˜¯æ°´å¹³åœ°æ‰©å±•ç¡¬ä»¶æœºå™¨ï¼Œæ¯ä¸€å°æœºå™¨ä¸Šçš„ç¨‹åºå¹¶æ²¡æœ‰åˆ†æ¨¡å—å»é’ˆå¯¹æ€§åœ°åˆ†é…ç¡¬ä»¶èµ„æºã€‚\n\næ¯”å¦‚ï¼Œåå°ç®¡ç†ä½¿ç”¨çš„ç”¨æˆ·å¹¶ä¸å¤šï¼Œåªæœ‰æä¸ªåˆ«çš„ç®¡ç†å‘˜æ‰èƒ½ä½¿ç”¨ï¼Œå› æ­¤æ­¤æ¨¡å—æ ¹æœ¬ä¸éœ€è¦é«˜å¹¶å‘ã€‚å¦‚æœå°†åå°ç®¡ç†éƒ¨ç½²åœ¨æ¯ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œå¯èƒ½ä¼šæµªè´¹ç¡¬ä»¶èµ„æºã€‚\n\nå› æ­¤ï¼Œå¯ä»¥æƒ³åˆ°ï¼Œå¦‚æœä¸èƒ½å¾ˆå¥½åœ°åˆ†é…é›†ç¾¤ç¯å¢ƒä¸­çš„æœºå™¨èµ„æºï¼Œå¯èƒ½ä¸èƒ½æŠŠæ•´ä½“ç³»ç»Ÿçš„æ€§èƒ½å‘æŒ¥åˆ°æœ€å¤§ï¼Œå³ä¸åˆ†æ¨¡å—è¿›è¡Œéƒ¨ç½²åˆ™ä¸èƒ½å……åˆ†åˆ©ç”¨å…¨éƒ¨èµ„æºã€‚\n\nä¼˜ç‚¹æ˜¯ï¼Œéƒ¨ç½²å¾ˆç®€å•ï¼Œå› ä¸ºæ²¡æœ‰è¿‡å¤šçš„è®¾è®¡ï¼Œæ¯å°æœºå™¨çš„éƒ¨ç½²æ–¹å¼æ˜¯ä¸€æ ·çš„ï¼Œç›´æ¥è¿è¡ŒåŒä¸€ä¸ªç¨‹åºå³å¯ã€‚\n\n# åˆ†å¸ƒå¼æœåŠ¡å™¨\n\nç°æœ‰ä¸‰å°æœåŠ¡å™¨ï¼Œserver1éƒ¨ç½²ç”¨æˆ·ç®¡ç†ã€æ¶ˆæ¯ç®¡ç†æ¨¡å—ï¼›server2éƒ¨ç½²å¥½å‹ç®¡ç†ã€ç¾¤ç»„ç®¡ç†æ¨¡å—ï¼›server3éƒ¨ç½²åå°ç®¡ç†æ¨¡å—ã€‚\n\nç›¸å¯¹äºé›†ç¾¤æœåŠ¡å™¨ï¼Œå¦‚æœserver2å¤±æ•ˆï¼Œæ•´ä¸ªç³»ç»Ÿä»å¯ä»¥æ­£å¸¸è¿è¡Œã€‚è€Œå¦‚æœåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä»»ä½•ä¸€ä¸ªæœåŠ¡å™¨å¤±æ•ˆï¼Œéƒ½ä¼šé€ æˆæ•´ä¸ªç³»ç»Ÿçš„å¤±æ•ˆã€‚å› æ­¤ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯æ‰€æœ‰æœåŠ¡å™¨å…±åŒæ„æˆä¸€ä¸ªèŠå¤©ç³»ç»Ÿï¼Œç»™å®¢æˆ·ç«¯æä¾›æœåŠ¡ã€‚å› æ­¤ä¹ŸæŠŠæ¯ä¸ªæœåŠ¡å™¨ç§°ä¸ºåˆ†å¸ƒå¼èŠ‚ç‚¹ã€‚\n\nè§£å†³äº†é—®é¢˜2ï¼Œå› ä¸ºåˆ†æ¨¡å—éƒ¨ç½²ï¼Œå¦‚æœåªä¿®æ”¹äº†æŸä¸€æ¨¡å—çš„ä»£ç ï¼Œåªéœ€è¦éƒ¨åˆ†ç¼–è¯‘ï¼Œåªéœ€è¦å¯¹æŸä¸€èŠ‚ç‚¹è¿›è¡Œå•ç‹¬çš„éƒ¨ç½²ã€‚\n\nè§£å†³äº†é—®é¢˜3ï¼Œæ¯”å¦‚èŠ‚ç‚¹3åå°ç®¡ç†æ¨¡å—åŒ…å«CPUå¯†é›†å‹ä¸šåŠ¡ï¼Œåˆ™å…¶å¯¹åº”çš„æœºå™¨å¯ä»¥é’ˆå¯¹æ€§å¢åŠ CPUæ€§èƒ½ï¼Œç›¸å¯¹åœ°å‡å°‘å†…å­˜èµ„æºã€ç½‘ç»œå¸¦å®½èµ„æºã€‚ç›¸åçš„ï¼ŒèŠ‚ç‚¹1çš„ç”¨æˆ·ç®¡ç†ã€æ¶ˆæ¯ç®¡ç†æ¨¡å—å¯¹åº”çš„æœºå™¨å¢åŠ å†…å­˜èµ„æºã€ç½‘ç»œå¸¦å®½èµ„æºï¼Œè€Œä¸éœ€è¦è¿‡é«˜çš„CPUæ€§èƒ½ã€‚å¦‚æ­¤ï¼Œå¯ä»¥æœ‰åˆ©äºç¡¬ä»¶èµ„æºçš„åˆç†åˆ†é…ã€‚\n\n# åˆ†å¸ƒå¼+é›†ç¾¤æœåŠ¡å™¨\n\næ ¹æ®èŠ‚ç‚¹çš„å¹¶å‘è¦æ±‚ï¼Œå¯ä»¥é’ˆå¯¹æŸä¸€èŠ‚ç‚¹å†åšèŠ‚ç‚¹æ¨¡å—é›†ç¾¤éƒ¨ç½²ã€‚\n\nåˆ†å¸ƒå¼èŠ‚ç‚¹1ä¸»è¦è´Ÿè´£ç”¨æˆ·è¿æ¥ã€ä¿¡æ¯ä¼ é€’çš„å¤„ç†ï¼Œå¯¹å¹¶å‘é‡è¦æ±‚å¤§ï¼Œæ‰€ä»¥æ­¤æ—¶æˆ‘ä»¬éœ€è¦é’ˆå¯¹æ­¤èŠ‚ç‚¹è¿›è¡Œæ‰©å®¹ï¼Œå³å¢åŠ æœåŠ¡å™¨åŒæ ·éƒ¨ç½²ç”¨æˆ·ç®¡ç†ã€æ¶ˆæ¯ç®¡ç†æ¨¡å—ã€‚\n\nè€Œä¸”ï¼Œä¹Ÿå¯ä»¥çµæ´»çš„è°ƒæ•´ä¸åŒèŠ‚ç‚¹çš„èŒè´£ï¼Œæ¯”å¦‚ï¼Œå¯ä»¥åŒæ ·åœ¨èŠ‚ç‚¹2ä¸Šéƒ¨ç½²ç”¨æˆ·ç®¡ç†æ¨¡å—ï¼Œå½“èŠ‚ç‚¹1å¤±æ•ˆæ—¶ï¼Œå¯ä»¥å¯ç”¨èŠ‚ç‚¹2çš„ç”¨æˆ·ç®¡ç†æ¨¡å—ã€‚\n\n## å¸¦æ¥çš„æŒ‘æˆ˜\n\n1. è½¯ä»¶è®¾è®¡ï¼šéœ€è¦è®¾è®¡æ•´ä¸ªç³»ç»Ÿçš„è½¯ä»¶æ¨¡å—åˆ’åˆ†ï¼Œå¦åˆ™å„æ¨¡å—å¯èƒ½ä¼šå®ç°å¤§é‡é‡å¤çš„ä»£ç \n2. æ¡†æ¶è®¾è®¡ï¼šå„æ¨¡å—ä¹‹é—´å¦‚ä½•è®¿é—®ã€é€šä¿¡ï¼Ÿå„æ¨¡å—éƒ½è¿è¡Œåœ¨ä¸åŒçš„è¿›ç¨‹é‡Œï¼Œæ¯”å¦‚å¥½å‹ç®¡ç†æ¨¡å—ã€ç¾¤ç»„ç®¡ç†æ¨¡å—ã€‚éœ€è¦ä¸€ä¸ªæœºåˆ¶ä½¿å‡½æ•°è°ƒç”¨é€æ˜åŒ–ã€‚\n\n## åˆ†å¸ƒå¼ç³»ç»Ÿæ¡†æ¶è§£å†³çš„é—®é¢˜\n\næ¯”å¦‚ï¼ŒèŠ‚ç‚¹1è´Ÿè´£å®Œç”¨æˆ·çš„ç™»å½•åï¼Œéœ€è¦è·å–å¥½å‹åˆ—è¡¨ï¼Œåˆ™éœ€è¦ä¸€ä¸ªæœºåˆ¶è®¿é—®èŠ‚ç‚¹2ä¸Šçš„å¥½å‹ç®¡ç†æ¨¡å—ã€‚èŠ‚ç‚¹1ä¸Šçš„æ¨¡å—æ€ä¹ˆè°ƒç”¨æœºå™¨2ä¸Šçš„æ¨¡å—çš„ä¸€ä¸ªä¸šåŠ¡æ–¹æ³•ï¼Ÿæœºå™¨1ä¸Šçš„ä¸€ä¸ªæ¨¡å—è¿›ç¨‹1æ€ä¹ˆè°ƒç”¨æœºå™¨1ä¸Šçš„æ¨¡å—è¿›ç¨‹2é‡Œé¢çš„ä¸€ä¸ªä¸šåŠ¡æ–¹æ³•ï¼Ÿ\n\néœ€è¦åœ¨ç½‘ç»œä¸Šä¼ é€’å‡½æ•°çš„æ ‡è¯†ï¼Œå‡½æ•°å¤æ‚çš„å‚æ•°çš„æ•°æ®ç»™å…¶ä»–æœºå™¨ã€‚å…¶ä»–æœºå™¨æ‰§è¡Œå®Œæ¯•åï¼Œè¿”å›æ•°æ®çš„è¿‡ç¨‹ä¹Ÿæ˜¯éœ€è¦åœ¨ç½‘ç»œä¸Šä¼ é€’ç»™è°ƒç”¨æ–¹æœºå™¨ã€‚\n\nè¿™ä¸ªè¿‡ç¨‹å¾ˆå¤æ‚ï¼Œå› ä¸ºæœ‰å¯èƒ½æ¯ä¸ªä¼ é€’è¿‡ç¨‹éƒ½ä¼šå­˜åœ¨ç½‘ç»œå¼‚å¸¸é—®é¢˜ï¼Œéœ€è¦æœ‰æœºåˆ¶å»å‘Šè¯‰è°ƒç”¨æ–¹ä¼ è¾“çŠ¶æ€ã€‚æ‰€ä»¥ï¼Œéœ€è¦æŠŠæ•´ä¸ªè¿‡ç¨‹å°è£…åˆ°åˆ†å¸ƒå¼ç½‘ç»œé€šä¿¡æ¡†æ¶ä¹‹ä¸­ã€‚åˆ™åœ¨ç”¨æˆ·çœ‹æ¥ï¼Œè°ƒç”¨è¿œç«¯çš„æ–¹æ³•å°±å’Œè°ƒç”¨æœ¬åœ°è¿›ç¨‹å†…çš„æ–¹æ³•ä¸€æ ·ç®€å•ï¼Œä¸ç”¨å…³æ³¨å…·ä½“ç»†èŠ‚ã€‚\n\næ€»çš„æ¥è¯´ï¼Œåˆ†å¸ƒå¼æ˜¯ä¸ºäº†å…‹æœéƒ¨ç½²è§£è€¦åŒ–ã€èµ„æºåˆ†é…æœ€å¤§åŒ–è€Œç”Ÿã€‚è€Œå®ç°åˆ†å¸ƒå¼æ¡†æ¶éœ€è¦å°è£…ç½‘ç»œé€šä¿¡çš„å…·ä½“ç»†èŠ‚ï¼Œå°¤å…¶æ˜¯ï¼Œä¸€ï¼Œä¼ é€’å‡½æ•°çš„æ ‡è¯†ï¼Œå‡½æ•°å¤æ‚çš„å‚æ•°çš„æ•°æ®ç»™å…¶ä»–æœºå™¨ï¼ŒäºŒï¼Œéœ€è¦æœ‰æœºåˆ¶å»å‘Šè¯‰è°ƒç”¨æ–¹æ¯ä¸€ä¸ªä¼ é€’è¿‡ç¨‹ä¸­çš„ä¼ è¾“çŠ¶æ€ã€‚\n\n","categories":["é¡¹ç›®","rpc"]},{"title":"Android_åº”ç”¨åˆä½“éªŒ","url":"/Android/Android_åº”ç”¨åˆä½“éªŒ/","content":"\n# ä»‹ç»\n\næœ¬æ–‡å°†ä»‹ç»å¦‚ä½•æ„å»ºç®€å•çš„Androidåº”ç”¨ã€‚é¦–å…ˆï¼Œäº†è§£å¦‚ä½•é€šè¿‡Android Studioåˆ›å»º`â€œHello, World!â€`é¡¹ç›®å¹¶è¿è¡Œå®ƒã€‚ç„¶åï¼Œä¸ºåº”ç”¨åˆ›å»ºä¸€ä¸ªæ–°ç•Œé¢ï¼Œè¯¥ç•Œé¢ä¼šæ¥å—ç”¨æˆ·è¾“å…¥ï¼Œå¹¶åˆ‡æ¢åˆ°åº”ç”¨ä¸­çš„ä¸€ä¸ªæ–°å±å¹•ä»¥æ˜¾ç¤ºç”¨æˆ·è¾“å…¥å†…å®¹ã€‚\n\nå¼€å§‹ä¹‹å‰ï¼Œéœ€è¦äº†è§£æœ‰å…³Androidåº”ç”¨çš„ä¸¤ä¸ªåŸºæœ¬æ¦‚å¿µï¼šå®ƒä»¬å¦‚ä½•æä¾›å¤šä¸ªå…¥å£ç‚¹ï¼Œä»¥åŠå®ƒä»¬å¦‚ä½•é€‚åº”ä¸åŒçš„è®¾å¤‡ã€‚\n\n## åº”ç”¨æä¾›å¤šä¸ªå…¥å£ç‚¹\n\nAndroidåº”ç”¨éƒ½æ˜¯å°†å„ç§å¯å•ç‹¬è°ƒç”¨çš„ç»„ä»¶åŠ ä»¥ç»„åˆæ„å»ºè€Œæˆã€‚ä¾‹å¦‚ï¼Œactivityæ˜¯æä¾›ç•Œé¢(UI)çš„ä¸€ç§åº”ç”¨ç»„ä»¶ã€‚\n\nâ€œä¸»â€activityåœ¨ç”¨æˆ·ç‚¹æŒ‰æ‚¨çš„åº”ç”¨å›¾æ ‡æ—¶å¯åŠ¨ã€‚è¿˜å¯ä»¥å°†ç”¨æˆ·ä»å…¶ä»–ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œä»é€šçŸ¥ä¸­ï¼Œç”šè‡³ä»å…¶ä»–åº”ç”¨ä¸­ï¼‰å¼•å¯¼è‡³æŸä¸ªactivityã€‚\n\nå…¶ä»–ç»„ä»¶ï¼ˆå¦‚`WorkManager`ï¼‰å¯ä½¿åº”ç”¨èƒ½å¤Ÿåœ¨æ²¡æœ‰ç•Œé¢çš„æƒ…å†µä¸‹æ‰§è¡Œåå°ä»»åŠ¡ã€‚\n\n## åº”ç”¨å¯é€‚åº”ä¸åŒçš„è®¾å¤‡\n\nAndroidå…è®¸æ‚¨ä¸ºä¸åŒçš„è®¾å¤‡æä¾›ä¸åŒçš„èµ„æºã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥é’ˆå¯¹ä¸åŒçš„å±å¹•å°ºå¯¸åˆ›å»ºä¸åŒçš„å¸ƒå±€ã€‚ç³»ç»Ÿä¼šæ ¹æ®å½“å‰è®¾å¤‡çš„å±å¹•å°ºå¯¸ç¡®å®šè¦ä½¿ç”¨çš„å¸ƒå±€ã€‚\n\nå¦‚æœåº”ç”¨çš„ä»»ä½•åŠŸèƒ½éœ€è¦ä½¿ç”¨ç‰¹å®šçš„ç¡¬ä»¶ï¼ˆä¾‹å¦‚æ‘„åƒå¤´ï¼‰ï¼Œæ‚¨å¯ä»¥åœ¨è¿è¡Œæ—¶æŸ¥è¯¢è¯¥è®¾å¤‡æ˜¯å¦å…·æœ‰è¯¥ç¡¬ä»¶ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™åœç”¨ç›¸åº”çš„åŠŸèƒ½ã€‚æ‚¨å¯ä»¥æŒ‡å®šåº”ç”¨éœ€è¦ä½¿ç”¨ç‰¹å®šçš„ç¡¬ä»¶ï¼Œè¿™æ ·ï¼ŒGoogle Playå°±ä¸ä¼šå…è®¸åœ¨æ²¡æœ‰è¿™äº›ç¡¬ä»¶çš„è®¾å¤‡ä¸Šå®‰è£…åº”ç”¨ã€‚\n\n# ç•Œé¢å¸ƒå±€\n\nAndroidåº”ç”¨çš„ç•Œé¢ï¼ˆUIï¼‰ä»¥**å¸ƒå±€**å’Œ**å¾®ä»¶**çš„å±‚æ¬¡ç»“æ„å½¢å¼æ„å»ºè€Œæˆã€‚å¸ƒå±€æ˜¯`ViewGroup`å¯¹è±¡ï¼Œå³æ§åˆ¶å…¶å­è§†å›¾åœ¨å±å¹•ä¸Šçš„æ”¾ç½®æ–¹å¼çš„å®¹å™¨ã€‚å¾®ä»¶æ˜¯`View`å¯¹è±¡ï¼Œå³æŒ‰é’®å’Œæ–‡æœ¬æ¡†ç­‰ç•Œé¢ç»„ä»¶ã€‚\n\n![ViewGroupå¯¹è±¡å¦‚ä½•åœ¨å¸ƒå±€ä¸­å½¢æˆåˆ†æ”¯å¹¶åŒ…å«Viewå¯¹è±¡çš„å›¾ç¤º](https://developer.android.com/static/images/viewgroup_2x.png)\n\nAndroidæä¾›äº†ViewGroupå’ŒViewç±»çš„XMLè¯æ±‡è¡¨ï¼Œå› æ­¤ç•Œé¢çš„å¤§éƒ¨åˆ†å†…å®¹éƒ½åœ¨XMLæ–‡ä»¶ä¸­å®šä¹‰ã€‚\n\nAndroid Studioçš„å¸ƒå±€ç¼–è¾‘å™¨ä¼šåœ¨å¼€å‘è€…æ‹–æ”¾è§†å›¾æ„å»ºå¸ƒå±€æ—¶è‡ªåŠ¨ç¼–å†™XMLä»£ç ï¼Œå¦‚ä½•ä½¿ç”¨å¸ƒå±€ç¼–è¾‘å™¨åˆ›å»ºå¸ƒå±€å‘¢ï¼Ÿ\n\n# æ„å»ºç®€å•çš„ç•Œé¢ - å¸ƒå±€ç¼–è¾‘å™¨\n\nå·¦ä¸‹æ–¹çš„Component Treeé¢æ¿æ˜¾ç¤ºå¸ƒå±€çš„è§†å›¾å±‚æ¬¡ç»“æ„ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæ ¹è§†å›¾æ˜¯`ConstraintLayout`ï¼Œå®ƒä»…åŒ…å«ä¸€ä¸ª`TextView`å¯¹è±¡ã€‚\n\n`ConstraintLayout`æ˜¯ä¸€ç§å¸ƒå±€ï¼Œå®ƒæ ¹æ®åŒçº§è§†å›¾å’Œçˆ¶å¸ƒå±€çš„çº¦æŸæ¡ä»¶å®šä¹‰æ¯ä¸ªè§†å›¾çš„ä½ç½®ï¼Œè¿™æ ·ä¸€æ¥ï¼Œä½¿ç”¨æ‰å¹³è§†å›¾å±‚æ¬¡ç»“æ„æ—¢å¯ä»¥åˆ›å»ºç®€å•å¸ƒå±€ï¼Œåˆå¯ä»¥åˆ›å»ºå¤æ‚å¸ƒå±€ã€‚è¿™ç§å¸ƒå±€æ— éœ€åµŒå¥—å¸ƒå±€ã€‚åµŒå¥—å¸ƒå±€æ˜¯å¸ƒå±€å†…çš„å¸ƒå±€ï¼Œä¼šå¢åŠ ç»˜åˆ¶ç•Œé¢æ‰€éœ€çš„æ—¶é—´ã€‚\n\nä¾‹å¦‚å¯ä»¥å£°æ˜ä»¥ä¸‹å¸ƒå±€ã€‚\n\n* è§†å›¾Aè·ç¦»çˆ¶å¸ƒå±€é¡¶éƒ¨16dp\n* è§†å›¾Aè·ç¦»çˆ¶å¸ƒå±€å·¦ä¾§16dp\n* è§†å›¾Bè·ç¦»è§†å›¾Aå³ä¾§16dp\n* è§†å›¾Bä¸è§†å›¾Aé¡¶éƒ¨å¯¹é½\n\n![ConstraintLayoutå†…æ”¾æœ‰ä¸¤ä¸ªè§†å›¾çš„å›¾ç¤º](https://developer.android.com/static/training/basics/firstapp/images/constraint-example_2x.png)\n\n## æ·»åŠ æ–‡æœ¬æ¡†\n\næŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤æ·»åŠ æ–‡æœ¬æ¡†ï¼š\n\n1. é¦–å…ˆï¼Œéœ€è¦ç§»é™¤å¸ƒå±€ä¸­å·²æœ‰çš„å†…å®¹ã€‚åœ¨Componrnt Treeé¢æ¿ä¸­ç‚¹å‡»TextViewï¼Œç„¶åæŒ‰Deleteé”®ã€‚\n2. åœ¨Paletteé¢æ¿ä¸­ï¼Œç‚¹å‡»Textä»¥æ˜¾ç¤ºå¯ç”¨çš„æ–‡æœ¬æ§ä»¶ã€‚\n3. å°†Plain Textæ‹–åŠ¨åˆ°è®¾è®¡ç¼–è¾‘å™¨ä¸­ï¼Œå¹¶å°†å…¶æ”¾åœ¨é è¿‘å¸ƒå±€é¡¶éƒ¨çš„ä½ç½®ã€‚è¿™æ˜¯ä¸€ä¸ªæ¥å—çº¯æ–‡æœ¬è¾“å…¥çš„`EditText`å¾®ä»¶ã€‚\n4. ç‚¹å‡»è®¾è®¡ç¼–è¾‘å™¨ä¸­çš„è§†å›¾ã€‚ç°åœ¨ï¼Œå¯ä»¥åœ¨æ¯ä¸ªè§’ä¸Šçœ‹åˆ°è°ƒæ•´è§†å›¾å¤§å°çš„æ­£æ–¹å½¢æ‰‹æŸ„ï¼Œå¹¶åœ¨æ¯ä¸ªè¾¹ä¸Šçœ‹åˆ°åœ†å½¢çº¦æŸé”šç‚¹ã€‚ä¸ºäº†æ›´å¥½åœ°æ§åˆ¶ï¼Œå¯èƒ½éœ€è¦æ”¾å¤§ç¼–è¾‘å™¨ã€‚\n5. ç‚¹å‡»å¹¶æŒ‰ä½é¡¶è¾¹ä¸Šçš„é”šç‚¹ï¼Œå°†å…¶å‘ä¸Šæ‹–åŠ¨ï¼Œç›´è‡³å…¶è´´é åˆ°å¸ƒå±€é¡¶éƒ¨ï¼Œç„¶åå°†å…¶é‡Šæ”¾ã€‚è¿™æ˜¯ä¸€ä¸ªçº¦æŸæ¡ä»¶ï¼šå®ƒä¼šå°†è§†å›¾çº¦æŸåœ¨å·²è®¾ç½®çš„é»˜è®¤å¤–è¾¹è·å†…ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå°†å…¶è®¾ç½®ä¸ºè·ç¦»å¸ƒå±€é¡¶éƒ¨16dpã€‚\n6. ä½¿ç”¨ç›¸åŒçš„è¿‡ç¨‹åˆ›å»ºä¸€ä¸ªä»è§†å›¾å·¦ä¾§åˆ°å¸ƒå±€å·¦ä¾§çš„çº¦æŸæ¡ä»¶ã€‚\n\nç»“æœå¦‚å›¾ã€‚\n\n![æŒ‰ç…§åˆ°çˆ¶å¸ƒå±€é¡¶éƒ¨å’Œå·¦ä¾§çš„è·ç¦»çº¦æŸæ–‡æœ¬æ¡†](https://developer.android.com/static/images/training/basics/firstapp/building-ui-constrained-top-left.png)\n\n## æ·»åŠ æŒ‰é’®\n\n1. åœ¨Paletteé¢æ¿ä¸­ï¼Œç‚¹å‡»Buttons\n2. å°†Buttonå¾®ä»¶æ‹–åˆ°è®¾è®¡ç¼–è¾‘å™¨ä¸­ï¼Œå¹¶å°†å…¶æ”¾åœ¨é è¿‘å³ä¾§çš„ä½ç½®ã€‚\n3. åˆ›å»ºä¸€ä¸ªä»æŒ‰é’®å·¦ä¾§åˆ°æ–‡æœ¬æ¡†å³ä¾§çš„çº¦æŸæ¡ä»¶ã€‚\n4. å¦‚éœ€æŒ‰æ°´å¹³å¯¹é½çº¦æŸè§†å›¾ï¼Œè¯·åˆ›å»ºä¸€ä¸ªæ–‡æœ¬åŸºçº¿ä¹‹é—´çš„çº¦æŸæ¡ä»¶ã€‚ä¸ºæ­¤ï¼Œè¯·å³é”®ç‚¹å‡»æŒ‰é’®ï¼Œç„¶åé€‰æ‹©`Show Baseline`ã€‚åŸºçº¿é”šç‚¹æ˜¾ç¤ºåœ¨æŒ‰é’®å†…éƒ¨ã€‚ç‚¹å‡»å¹¶æŒ‰ä½æ­¤é”šç‚¹ï¼Œç„¶åå°†å…¶æ‹–åŠ¨åˆ°ç›¸é‚»æ–‡æœ¬æ¡†ä¸­æ˜¾ç¤ºçš„åŸºçº¿é”šç‚¹ä¸Šã€‚ï¼ˆä¹Ÿå¯ä»¥å³é”®ç‚¹å‡»æ–‡æœ¬æ¡†ï¼Œä»æ–‡æœ¬æ¡†å†…éƒ¨å‘å‡ºåŸºçº¿é”šç‚¹ï¼Œæ‹–åŠ¨åˆ°ç›¸é‚»æŒ‰é’®ä¸­æ˜¾ç¤ºçš„åŸºçº¿é”šç‚¹ä¸Šã€‚ï¼‰\n\nç»“æœåº”å¦‚å›¾æ‰€ç¤ºã€‚\n\n![æŒ‰ç…§åˆ°æ–‡æœ¬æ¡†å³ä¾§çš„è·ç¦»ä»¥åŠæ–‡æœ¬æ¡†åŸºçº¿æ¥çº¦æŸæŒ‰é’®](https://developer.android.com/static/images/training/basics/firstapp/building-ui-constrained-baseline.png)\n\n> è¿˜å¯ä»¥æ ¹æ®é¡¶è¾¹æˆ–åº•è¾¹å®ç°æ°´å¹³å¯¹é½ã€‚ä½†æŒ‰é’®çš„å›¾ç‰‡å‘¨å›´æœ‰å†…è¾¹è·ï¼Œå› æ­¤å¦‚æœä»¥è¿™ç§æ–¹å¼å¯¹é½ï¼Œé‚£ä¹ˆå®ƒä»¬çœ‹ä¸Šå»æ˜¯æ²¡æœ‰å¯¹é½çš„ã€‚\n\n## æ›´æ”¹ç•Œé¢å­—ç¬¦ä¸²\n\nè‹¥è¦é¢„è§ˆç•Œé¢ï¼Œç‚¹å‡»å·¥å…·æ ä¸­çš„`Select Design Surface`ï¼Œç„¶åé€‰æ‹©`Design`ã€‚æ–‡æœ¬è¾“å…¥å’ŒæŒ‰é’®æ ‡ç­¾åº”è®¾ç½®ä¸ºé»˜è®¤å€¼ã€‚\n\nè‹¥è¦æ›´æ”¹ç•Œé¢å­—ç¬¦ä¸²ï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š\n\n1. Projectçª—å£ï¼Œæ‰“å¼€`app > res > values > strings.xml`ã€‚è¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²èµ„æºæ–‡ä»¶ï¼Œå¯ä»¥åœ¨æ­¤æ–‡ä»¶ä¸­æŒ‡å®šæ‰€æœ‰ç•Œé¢å­—ç¬¦ä¸²ã€‚å¯ä»¥åˆ©ç”¨è¯¥æ–‡ä»¶åœ¨ä¸€ä¸ªä½ç½®ç®¡ç†æ‰€æœ‰ç•Œé¢å­—ç¬¦ä¸²ï¼Œä½¿å­—ç¬¦ä¸²çš„æŸ¥æ‰¾ã€æ›´æ–°å’Œæœ¬åœ°åŒ–å˜å¾—æ›´åŠ å®¹æ˜“ã€‚\n\n2. ç‚¹å‡»çª—å£é¡¶éƒ¨çš„`Open editor`ã€‚æ­¤æ—¶å°†æ‰“å¼€`Translations Editor`ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªå¯ä»¥æ·»åŠ å’Œä¿®æ”¹é»˜è®¤å­—ç¬¦ä¸²çš„ç®€å•ç•Œé¢ã€‚è¿˜æœ‰åŠ©äºè®©æ‰€æœ‰å·²ç¿»è¯‘çš„å­—ç¬¦ä¸²äº•ç„¶æœ‰åºã€‚\n\n3. ç‚¹å‡»åŠ å·Add Keyå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°å­—ç¬¦ä¸²ä½œä¸ºæ–‡æœ¬æ¡†çš„â€œæç¤ºæ–‡æœ¬â€ã€‚æ­¤æ—¶ä¼šæ‰“å¼€å¦‚å›¾æ‰€ç¤ºçš„çª—å£ã€‚\n   ![ç”¨äºæ·»åŠ æ–°å­—ç¬¦ä¸²çš„å¯¹è¯æ¡†](https://developer.android.com/static/training/basics/firstapp/images/add-string.png)\n\n   åœ¨Add Keyå¯¹è¯æ¡†ä¸­ï¼Œå®Œæˆä»¥ä¸‹æ­¥éª¤ï¼š\n\n   1. åœ¨`Key`å­—æ®µä¸­è¾“å…¥â€œ`edit_message`â€ã€‚\n   2. åœ¨`Default Value`å­—æ®µä¸­è¾“å…¥â€œ`Enter a message`â€ã€‚\n   3. ç‚¹å‡»`OK`ã€‚\n\n4. å†æ·»åŠ ä¸€ä¸ªåä¸º\"`button_send`\"ä¸”å€¼ä¸º\"`Send`\"çš„é”®ã€‚\n\nç°åœ¨ï¼Œæ‚¨å¯ä»¥ä¸ºæ¯ä¸ªè§†å›¾è®¾ç½®è¿™äº›å­—ç¬¦ä¸²ã€‚è‹¥è¦è¿”å›å¸ƒå±€æ–‡ä»¶ï¼Œè¯·ç‚¹å‡»æ ‡ç­¾é¡µæ ä¸­çš„`activity_main.xml`ã€‚ç„¶åï¼Œæ·»åŠ å­—ç¬¦ä¸²ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n1. ç‚¹å‡»å¸ƒå±€ä¸­çš„æ–‡æœ¬æ¡†ã€‚å¦‚æœå³ä¾§è¿˜æœªæ˜¾ç¤º`Attributes`çª—å£ï¼Œè¯·ç‚¹å‡»å³ä¾§è¾¹æ ä¸Šçš„ `Attributes`ã€‚\n2. æ‰¾åˆ°`text`å±æ€§ï¼ˆå½“å‰è®¾ä¸ºâ€œ`Name`â€ï¼‰å¹¶åˆ é™¤ç›¸åº”çš„å€¼ã€‚\n3. æ‰¾åˆ°`hint`å±æ€§ï¼Œç„¶åç‚¹å‡»æ–‡æœ¬æ¡†å³ä¾§çš„![img](https://developer.android.com/static/studio/images/buttons/pick-resource.png)(`Pick a Resource`)ã€‚åœ¨æ˜¾ç¤ºçš„å¯¹è¯æ¡†ä¸­ï¼ŒåŒå‡»åˆ—è¡¨ä¸­çš„`edit_message`ã€‚\n4. ç‚¹å‡»å¸ƒå±€ä¸­çš„æŒ‰é’®ï¼Œæ‰¾åˆ°å…¶`text`å±æ€§ï¼ˆå½“å‰è®¾ä¸ºâ€œ`Button`â€ï¼‰ã€‚ç„¶åç‚¹å‡»![img](https://developer.android.com/static/studio/images/buttons/pick-resource.png)(`Pick a Resource`)ï¼Œå¹¶é€‰æ‹©`button_send`ã€‚\n\n## è®©æ–‡æœ¬æ¡†å¤§å°å¯çµæ´»è°ƒæ•´\n\nè‹¥è¦åˆ›å»ºä¸€ä¸ªé€‚åº”ä¸åŒå±å¹•å°ºå¯¸çš„å¸ƒå±€ï¼Œéœ€è¦**è®©æ–‡æœ¬æ¡†æ‹‰ä¼¸**ä»¥å¡«å……å»é™¤æŒ‰é’®å’Œå¤–è¾¹è·å**å‰©ä½™çš„æ‰€æœ‰æ°´å¹³ç©ºé—´**ã€‚\n\nç»§ç»­æ“ä½œä¹‹å‰ï¼Œç‚¹å‡»å·¥å…·æ ä¸­çš„`Select Design Surface`ï¼Œç„¶åé€‰æ‹©`Blueprint`ã€‚\n\nè‹¥è¦è®©æ–‡æœ¬æ¡†å¤§å°å¯çµæ´»è°ƒæ•´ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š\n\n1. é€‰æ‹©ä¸¤ä¸ªè§†å›¾ã€‚è‹¥è¦æ‰§è¡Œæ­¤æ“ä½œï¼Œè¯·ç‚¹å‡»ä¸€ä¸ªè§†å›¾ï¼Œåœ¨æŒ‰ä½`Shift`é”®çš„åŒæ—¶ç‚¹å‡»å¦ä¸€ä¸ªè§†å›¾ï¼Œç„¶åå³é”®ç‚¹å‡»ä»»ä¸€è§†å›¾å¹¶ä¾æ¬¡é€‰æ‹©`Chains > Create Horizontal Chain`ã€‚å¸ƒå±€éšå³æ˜¾ç¤ºå‡ºæ¥ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚\n   ![é€‰æ‹©Create Horizontal Chainåæ‰€å¾—åˆ°çš„ç»“æœ](https://developer.android.com/static/images/training/basics/firstapp/building-ui-horizontal-chain.png)\n\n   é“¾æ˜¯ä¸¤ä¸ªæˆ–å¤šä¸ªè§†å›¾ä¹‹é—´çš„åŒå‘çº¦æŸæ¡ä»¶ï¼Œå¯è®©æ‚¨é‡‡ç”¨ä¸€è‡´çš„æ–¹å¼å®‰æ’é“¾æ¥çš„è§†å›¾ã€‚\n\n2. é€‰æ‹©æŒ‰é’®å¹¶æ‰“å¼€`Attributes`çª—å£ã€‚ç„¶åä½¿ç”¨`Constraint Widget`å°†å³å¤–è¾¹è·è®¾ä¸º`16 dp`ã€‚\n\n3. ç‚¹å‡»æ–‡æœ¬æ¡†ä»¥æŸ¥çœ‹å…¶å±æ€§ã€‚ç„¶åï¼Œç‚¹å‡»å®½åº¦æŒ‡ç¤ºå™¨ï¼ˆé€”ä¸­çº¢æ¡†æ¡†ä½çš„åœ°æ–¹ï¼‰ä¸¤æ¬¡ï¼Œç¡®ä¿å°†å…¶è®¾ç½®ä¸ºé”¯é½¿çŠ¶çº¿(Match Constraints)ï¼Œå¦‚å›¾ä¸­çš„`æ ‡æ³¨1`æ‰€ç¤ºã€‚\n   ![ç‚¹å‡»ä»¥å°†å®½åº¦æ›´æ”¹ä¸ºMatch Constraints](https://developer.android.com/static/images/training/basics/firstapp/building-ui-match-constraints-2x.png)\n\n   â€œMatch constraintsâ€è¡¨ç¤ºå®½åº¦å°†å»¶é•¿ä»¥ç¬¦åˆæ°´å¹³çº¦æŸæ¡ä»¶å’Œå¤–è¾¹è·çš„å®šä¹‰ã€‚å› æ­¤ï¼Œæ–‡æœ¬æ¡†å°†æ‹‰ä¼¸ä»¥å¡«å……å»é™¤æŒ‰é’®å’Œæ‰€æœ‰å¤–è¾¹è·åå‰©ä½™çš„æ°´å¹³ç©ºé—´ã€‚\n\nç°åœ¨ï¼Œå¸ƒå±€å·²ç»å®Œæˆï¼Œå¦‚å›¾ã€‚\n\n![æ–‡æœ¬æ¡†ç°åœ¨æ‹‰ä¼¸ä»¥å¡«å……å‰©ä½™ç©ºé—´](https://developer.android.com/static/images/training/basics/firstapp/building-ui-constraint-fill.png)\n\næœ€ç»ˆå¸ƒå±€XMLåº”ä¸ºä»¥ä¸‹å†…å®¹ï¼šå°†å…¶ä¸**Code**æ ‡ç­¾é¡µä¸­çœ‹åˆ°çš„å†…å®¹è¿›è¡Œæ¯”è¾ƒçœ‹çœ‹é”™äº†æ²¡ã€‚å±æ€§é¡ºåºä¸åŒæ²¡å½±å“ã€‚\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<androidx.constraintlayout.widget.ConstraintLayout\n    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    tools:context=\"com.example.myfirstapp.MainActivity\">\n\n    <EditText\n        android:id=\"@+id/editText\"\n        android:layout_width=\"0dp\"\n        android:layout_height=\"wrap_content\"\n        android:layout_marginStart=\"16dp\"\n        android:layout_marginLeft=\"16dp\"\n        android:layout_marginTop=\"16dp\"\n        android:ems=\"10\"\n        android:hint=\"@string/edit_message\"\n        android:inputType=\"textPersonName\"\n        app:layout_constraintEnd_toStartOf=\"@+id/button\"\n        app:layout_constraintHorizontal_bias=\"0.5\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\" />\n\n    <Button\n        android:id=\"@+id/button\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_marginEnd=\"16dp\"\n        android:layout_marginStart=\"16dp\"\n        android:text=\"@string/button_send\"\n        app:layout_constraintBaseline_toBaselineOf=\"@+id/editText\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"0.5\"\n        app:layout_constraintStart_toEndOf=\"@+id/editText\" />\n</androidx.constraintlayout.widget.ConstraintLayout>\n```\n\næ­¤æ—¶å¯ä»¥æµ‹è¯•è¿è¡Œä¸€ä¸‹ã€‚\n\nä¸‹é¢æ„å»ºåœ¨ç‚¹æŒ‰æŒ‰é’®åå¯åŠ¨çš„å¦ä¸€ä¸ªactivityã€‚\n\n# å¯åŠ¨å¦ä¸€ä¸ªActivity\n\nå°†å‘MainActivityæ·»åŠ ä¸€äº›ä»£ç ï¼Œä»¥ä¾¿åœ¨ç”¨æˆ·ç‚¹æŒ‰SendæŒ‰é’®æ—¶å¯åŠ¨ä¸€ä¸ªæ˜¾ç¤ºæ¶ˆæ¯çš„æ–°activityã€‚\n\n## å“åº”â€œSendâ€æŒ‰é’®\n\nå‘`MainActivity`ç±»æ·»åŠ ä¸€ä¸ªåœ¨ç”¨æˆ·ç‚¹æŒ‰SendæŒ‰é’®æ—¶è°ƒç”¨çš„æ–¹æ³•ï¼š\n\n1. åœ¨`app > java > com.example.myfirstapp > MainActivity`æ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹`sendMessage()`æ–¹æ³•æ¡©ï¼Œè¿™ä¸ªæ–¹æ³•å°†åœ¨æŸä¸ªäº‹ä»¶å‘ç”Ÿåè¢«å›è°ƒã€‚\n   ```java\n   public class MainActivity extends AppCompatActivity\n   {\n       // ...\n       \n       /* Called when the user taps the Send Button */\n       public void sendMessage(View view)\n       {\n           // Do something in response to button\n       }\n   }\n   ```\n\n   >å¯èƒ½ä¼šçœ‹åˆ°ä¸€æ¡é”™è¯¯ï¼Œå› ä¸ºAndroid Studioæ— æ³•è§£æç”¨ä½œæ–¹æ³•å‚æ•°çš„Viewç±»ã€‚è‹¥è¦æ¸…é™¤é”™è¯¯ï¼Œç‚¹å‡»Viewå£°æ˜ï¼Œå°†å…‰æ ‡ç½®äºå…¶ä¸Šï¼Œç„¶åæŒ‰Alt+Enterï¼ˆåœ¨ Mac ä¸Šåˆ™æŒ‰Option+Enterï¼‰è¿›è¡Œå¿«é€Ÿä¿®å¤ã€‚å¦‚æœå‡ºç°ä¸€ä¸ªèœå•ï¼Œé€‰æ‹©Import classã€‚\n\n2. è¿”å›åˆ°activity_main.xmlæ–‡ä»¶ï¼Œå¹¶ä»è¯¥æŒ‰é’®è°ƒç”¨æ­¤æ–¹æ³•ï¼š\n\n   1. é€‰æ‹©å¸ƒå±€ç¼–è¾‘å™¨ä¸­çš„ç›¸åº”æŒ‰é’®ã€‚\n   2. åœ¨Attributesçª—å£ä¸­ï¼Œæ‰¾åˆ°`onClick`å±æ€§ï¼Œå¹¶ä»å…¶ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹©`sendMessage[MainActivity]`ï¼›æˆ–è€…åœ¨`activity_main.xml`ä¸­çš„`Button`æ ‡ç­¾ä¸­åŠ å…¥`android:onClick=\"sendMessage\"`å±æ€§ã€‚\n\n   ç°åœ¨ï¼Œå½“ç”¨æˆ·ç‚¹æŒ‰è¯¥æŒ‰é’®æ—¶ï¼Œç³»ç»Ÿå°†è°ƒç”¨`sendMessage()`æ–¹æ³•ã€‚\n\n   >è¯·æ³¨æ„æ­¤æ–¹æ³•ä¸­æä¾›çš„è¯¦ç»†ä¿¡æ¯ã€‚ç³»ç»Ÿéœ€è¦è¿™äº›ä¿¡æ¯æ¥è¯†åˆ«æ­¤æ–¹æ³•æ˜¯å¦ä¸`android:onClick`å±æ€§å…¼å®¹ã€‚å…·ä½“æ¥è¯´ï¼Œæ­¤æ–¹æ³•å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š\n   >\n   >1. publicã€‚\n   >2. è¿”å›å€¼ä¸ºç©ºï¼Œæˆ–åœ¨`Kotlin`ä¸­ä¸ºéšå¼`Unit`ã€‚\n   >3. `View`æ˜¯å”¯ä¸€çš„å‚æ•°ã€‚è¿™æ˜¯åœ¨ç¬¬1æ­¥ç»“æŸæ—¶ç‚¹å‡»çš„`View`å¯¹è±¡ã€‚\n\n3. æ¥ä¸‹æ¥ï¼Œå¡«å†™æ­¤æ–¹æ³•ï¼Œä»¥è¯»å–æ–‡æœ¬å­—æ®µçš„å†…å®¹ï¼Œå¹¶å°†è¯¥æ–‡æœ¬ä¼ é€’ç»™å¦ä¸€ä¸ªactivityã€‚\n\n## æ„å»ºä¸€ä¸ªintent\n\n`Intent`æ˜¯åœ¨ç›¸äº’ç‹¬ç«‹çš„ç»„ä»¶ï¼ˆå¦‚ä¸¤ä¸ª`activity`ï¼‰ä¹‹é—´æä¾›è¿è¡Œæ—¶ç»‘å®šåŠŸèƒ½çš„å¯¹è±¡ã€‚`Intent`è¡¨ç¤ºåº”ç”¨æ‰§è¡ŒæŸé¡¹æ“ä½œçš„æ„å›¾ã€‚å¯ä»¥ä½¿ç”¨`intent`æ‰§è¡Œå¤šç§ä»»åŠ¡ï¼Œä½†åœ¨æœ¬ä¾‹ä¸­ï¼Œ`intent`å°†ç”¨äºå¯åŠ¨å¦ä¸€ä¸ª`activity`ã€‚\n\nåœ¨`MainActivity`ä¸­ï¼Œæ·»åŠ `EXTRA_MESSAGE`å¸¸é‡å’Œ`sendMessage()`ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n```java\npublic class MainActivity extends AppCompatActivity {\n    public static final String EXTRA_MESSAGE = \"com.example.myfirstapp.MESSAGE\";\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n    }\n\n    /** Called when the user taps the Send button */\n    public void sendMessage(View view) {\n        Intent intent = new Intent(this, DisplayMessageActivity.class);\n        EditText editText = (EditText) findViewById(R.id.editText);\n        String message = editText.getText().toString();\n        intent.putExtra(EXTRA_MESSAGE, message);\n        startActivity(intent);\n    }\n}\n```\n\n`DisplayMessageActivity`ä»æœ‰é”™è¯¯ï¼Œä½†æ²¡æœ‰å…³ç³»ï¼Œä¸‹ä¸€éƒ¨åˆ†ä¸­å°†ä¿®å¤é”™è¯¯ã€‚\n\n`sendMessage()`å°†å‘ç”Ÿä»¥ä¸‹æƒ…å†µï¼š\n\n* `Intent`æ„é€ å‡½æ•°ä¼šè·å–ä¸¤ä¸ªå‚æ•°ï¼š`Context`å’Œ`Class`ã€‚\n  `Context`å‚æ•°é¦–å…ˆä¼šè¢«ä½¿ç”¨ï¼Œå› ä¸º`Activity`ç±»æ˜¯`Context`çš„å­ç±»ï¼Œåœ¨æ„é€ activityæ—¶ï¼Œåˆ™å…ˆæ„é€ contextçˆ¶æ¨¡å—ã€‚\n  åœ¨æœ¬ä¾‹ä¸­ï¼Œç³»ç»Ÿå°†`Intent`ä¼ é€’åˆ°çš„åº”ç”¨ç»„ä»¶çš„`class`å‚æ•°æ˜¯è¦å¯åŠ¨çš„activityã€‚\n* `putExtra()`æ–¹æ³•å°†`editText`çš„å€¼æ·»åŠ åˆ°intentã€‚`Intent`èƒ½å¤Ÿä»¥ç§°ä¸º`\"extra\"`çš„é”®å€¼å¯¹å½¢å¼æºå¸¦æ•°æ®ã€‚\n  keyæ˜¯ä¸€ä¸ªå…¬å…±å¸¸é‡`EXTRA_MESSAGE`ï¼Œå› ä¸ºä¸‹ä¸€ä¸ªactivityå°†ä½¿ç”¨è¯¥é”®æ£€ç´¢æ–‡æœ¬å€¼ã€‚ä¸ºintent extraå®šä¹‰é”®æ—¶ï¼Œæœ€å¥½ä½¿ç”¨åº”ç”¨çš„è½¯ä»¶åŒ…åç§°ä½œä¸ºå‰ç¼€ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿è¿™äº›é”®æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œè¿™åœ¨åº”ç”¨éœ€è¦ä¸å…¶ä»–åº”ç”¨è¿›è¡Œäº¤äº’æ—¶å¾ˆé‡è¦ã€‚\n  valueæ˜¯messageï¼Œå³ä¸ºeditTextçš„å†…å®¹ã€‚å°†åœ¨ä¸‹ä¸€ä¸ªactivityä¸­è·å–ã€‚\n* `startActivity()`æ–¹æ³•å°†å¯åŠ¨ä¸€ä¸ªç”±`Intent`æŒ‡å®šçš„`DisplayMessageActivity`å®ä¾‹ï¼Œæ¥ä¸‹æ¥éœ€è¦åˆ›å»ºè¯¥ç±»ã€‚\n\n# åˆ›å»ºç¬¬äºŒä¸ªactivity\n\n1. åœ¨Projectçª—å£ä¸­ï¼Œå³é”®ç‚¹å‡»appæ–‡ä»¶å¤¹ï¼Œç„¶åä¾æ¬¡é€‰æ‹©`New > Activity > Empty Activity`ã€‚\n2. åœ¨`Configure Activity`çª—å£ä¸­ï¼Œè¾“å…¥â€œ`DisplayMessageActivity`â€ä½œä¸º`Activity Name`ã€‚å°†æ‰€æœ‰å…¶ä»–å±æ€§ä¿ç•™ä¸ºé»˜è®¤è®¾ç½®ï¼Œç„¶åç‚¹å‡»`Finish`ã€‚\n\nAndroid Studioä¼šè‡ªåŠ¨æ‰§è¡Œä¸‹åˆ—ä¸‰é¡¹æ“ä½œï¼š\n\n* åˆ›å»º`DisplayMessageActivity`æ–‡ä»¶ã€‚\n* åˆ›å»º`DisplayMessageActivity`æ–‡ä»¶å¯¹åº”çš„å¸ƒå±€æ–‡ä»¶ `activity_display_message.xml`ã€‚\n* åœ¨`AndroidManifest.xml`ä¸­æ·»åŠ æ‰€éœ€çš„`<activity>`å…ƒç´ ã€‚\n\nå¦‚æœæ‚¨è¿è¡Œåº”ç”¨å¹¶ç‚¹æŒ‰ç¬¬ä¸€ä¸ª`activity`ä¸Šçš„æŒ‰é’®ï¼Œå°†å¯åŠ¨ç¬¬äºŒä¸ª`activity`ï¼Œä½†å®ƒä¸ºç©ºã€‚è¿™æ˜¯å› ä¸ºç¬¬äºŒä¸ª`activity`ä½¿ç”¨æ¨¡æ¿æä¾›çš„ç©ºå¸ƒå±€ã€‚\n\n## æ·»åŠ æ–‡æœ¬è§†å›¾\n\næ–°activityåŒ…å«ä¸€ä¸ªç©ºç™½å¸ƒå±€æ–‡ä»¶ã€‚è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼Œåœ¨æ˜¾ç¤ºæ¶ˆæ¯çš„ä½ç½®æ·»åŠ ä¸€ä¸ªæ–‡æœ¬è§†å›¾ï¼š\n\n1. æ‰“å¼€`app > res > layout > activity_display_message.xml`æ–‡ä»¶ã€‚\n2. ç‚¹å‡»å·¥å…·æ ä¸­çš„![img](https://developer.android.com/static/studio/images/buttons/layout-editor-autoconnect-on.png)`Enable Autoconnection to Parent`ã€‚ç³»ç»Ÿå°†å¯ç”¨`Autoconnect`ã€‚\n3. åœ¨`Palette`é¢æ¿ä¸­ï¼Œç‚¹å‡»`Text`ï¼Œå°†`TextView`æ‹–åŠ¨åˆ°å¸ƒå±€ä¸­ï¼Œç„¶åå°†å…¶æ”¾ç½®åœ¨é è¿‘å¸ƒå±€é¡¶éƒ¨ä¸­å¿ƒçš„ä½ç½®ï¼Œä½¿å…¶è´´é åˆ°å‡ºç°çš„å‚ç›´çº¿ä¸Šã€‚`Autoconnect`å°†æ·»åŠ å·¦ä¾§å’Œå³ä¾§çº¦æŸæ¡ä»¶ï¼Œä»¥ä¾¿å°†è¯¥è§†å›¾æ”¾ç½®åœ¨æ°´å¹³ä¸­å¿ƒä½ç½®ã€‚\n4. å†åˆ›å»ºä¸€ä¸ªä»æ–‡æœ¬è§†å›¾é¡¶éƒ¨åˆ°å¸ƒå±€é¡¶éƒ¨çš„çº¦æŸæ¡ä»¶ï¼Œä½¿è¯¥è§†å›¾å¦‚å›¾1ä¸­æ‰€ç¤ºã€‚\n\næˆ–è€…ï¼Œæ‚¨å¯ä»¥å¯¹æ–‡æœ¬æ ·å¼è¿›è¡Œä¸€äº›è°ƒæ•´ï¼Œæ–¹æ³•æ˜¯åœ¨`Attributes`çª—å£çš„`Common Attributes`é¢æ¿ä¸­å±•å¼€`textAppearance`ï¼Œç„¶åæ›´æ”¹`textSize`å’Œ`textColor`ç­‰å±æ€§ã€‚\n\n## æ˜¾ç¤ºæ¶ˆæ¯\n\nåœ¨æ­¤æ­¥éª¤ä¸­ï¼Œä¿®æ”¹ç¬¬äºŒä¸ªactivityä»¥æ˜¾ç¤ºç¬¬ä¸€ä¸ªactivityä¼ é€’çš„æ¶ˆæ¯ã€‚\n\nåœ¨`DisplayMessageActivity`ä¸­ï¼Œå°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°`onCreate()`æ–¹æ³•ä¸­ï¼š\n```java\n@Override\nprotected void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.activity_display_message);\n    \n    // Get the Intent that started this activity and extract the string\n    Intent intent = getIntent();\n    String message = intent.getStringExtra(MainActivity.EXTRA_MESSAGE);\n\n    // Capture the layout's TextView and set the string as its text\n    TextView textView = findViewById(R.id.textView);\n    textView.setText(message);\n}\n```\n\n## æ·»åŠ å‘ä¸Šå¯¼èˆªåŠŸèƒ½\n\nåº”ç”¨ä¸­ï¼Œä¸æ˜¯ä¸»å…¥å£ç‚¹çš„æ¯ä¸ªå±å¹•ï¼ˆæ‰€æœ‰ä¸æ˜¯ä¸»å±å¹•çš„å±å¹•ï¼‰éƒ½å¿…é¡»æä¾›å¯¼èˆªåŠŸèƒ½ï¼Œä»¥ä¾¿å°†ç”¨æˆ·å¼•å¯¼è‡³åº”ç”¨å±‚æ¬¡ç»“æ„ä¸­çš„é€»è¾‘çˆ¶çº§å±å¹•ã€‚ä¸ºæ­¤ï¼Œè¯·åœ¨åº”ç”¨æ ä¸­æ·»åŠ å‘ä¸ŠæŒ‰é’®ã€‚\n\nè‹¥è¦æ·»åŠ å‘ä¸ŠæŒ‰é’®ï¼Œéœ€è¦åœ¨`AndroidManifest.xml`æ–‡ä»¶ä¸­å£°æ˜å“ªä¸ªactivityæ˜¯é€»è¾‘çˆ¶çº§ã€‚æ‰“å¼€`app > manifests > AndroidManifest.xml`æ–‡ä»¶ï¼Œæ‰¾åˆ°`DisplayMessageActivity`çš„`<activity>`æ ‡è®°ï¼Œç„¶åå°†å…¶æ›¿æ¢ä¸ºä»¥ä¸‹ä»£ç ï¼š\n\n```xml\n<activity android:name=\".DisplayMessageActivity\"\n          android:parentActivityName=\".MainActivity\">\n    <!-- The meta-data tag is required if you support API level 15 and lower -->\n    <meta-data\n        android:name=\"android.support.PARENT_ACTIVITY\"\n        android:value=\".MainActivity\" />\n</activity>\n```\n\nAndroidç³»ç»Ÿç°åœ¨ä¼šè‡ªåŠ¨å‘åº”ç”¨æ æ·»åŠ å‘ä¸ŠæŒ‰é’®ã€‚","categories":["Android"]},{"title":"Android_æ¶æ„","url":"/Android/Android_æ¶æ„/","content":"\n# åˆ†å±‚\n\nAndroidå¤§è‡´å¯ä»¥åˆ†ä¸ºå››å±‚æ¶æ„ï¼šLinuxå†…æ ¸å±‚ã€ç³»ç»Ÿè¿è¡Œåº“å±‚ã€åº”ç”¨æ¡†æ¶å±‚å’Œåº”ç”¨å±‚ã€‚\n\n![](../../images/Android_æ¶æ„/image-20250820060459795.png)\n1. åº”ç”¨å±‚ã€‚ç³»ç»Ÿå†…ç½®çš„åº”ç”¨ç¨‹åºä»¥åŠéç³»ç»Ÿçº§çš„åº”ç”¨ç¨‹åºéƒ½å±äºåº”ç”¨å±‚ï¼Œè´Ÿè´£ä¸ç”¨æˆ·è¿›è¡Œç›´æ¥äº¤äº’ï¼Œé€šå¸¸éƒ½æ˜¯ç”¨Javaå¼€å‘ã€‚\n\n2. åº”ç”¨æ¡†æ¶å±‚ã€‚è¿™ä¸€å±‚æ˜¯ç”±Javaä»£ç ç¼–å†™çš„ï¼Œå¯ä»¥ç§°ä¸ºJava API Frameworkã€‚è¿™ä¸€å±‚ä¸»è¦æä¾›äº†æ„å»ºåº”ç”¨ç¨‹åºæ—¶å¯èƒ½ç”¨åˆ°çš„å„ç§APIï¼ŒAndroidè‡ªå¸¦çš„ä¸€äº›æ ¸å¿ƒåº”ç”¨å°±æ˜¯ä½¿ç”¨è¿™äº›APIå®Œæˆçš„ï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥é€šè¿‡è¿™äº›APIæ¥æ„å»ºè‡ªå·±çš„åº”ç”¨ç¨‹åºã€‚å¼€å‘è€…APIå¯ä»¥ç›´æ¥æ˜ å°„åˆ°åº•å±‚HALæ¥å£ï¼Œå¹¶å¯æä¾›ä¸å®ç°é©±åŠ¨ç¨‹åºç›¸å…³çš„å®ç”¨ä¿¡æ¯ã€‚è¿™ä¸€å±‚æ‰€æä¾›çš„ä¸»è¦ç»„ä»¶æœ‰ï¼š\n\n   1. Activity Managerï¼Œæ´»åŠ¨ç®¡ç†å™¨ã€‚ç®¡ç†å„ä¸ªåº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸï¼Œä»¥åŠå¸¸ç”¨çš„å¯¼èˆªå›é€€åŠŸèƒ½ã€‚\n   2. Location Managerï¼Œä½ç½®ç®¡ç†å™¨ã€‚æä¾›åœ°ç†ä½ç½®åŠå®šä½åŠŸèƒ½æœåŠ¡ã€‚\n   3. Package Managerï¼ŒåŒ…ç®¡ç†å™¨ã€‚ç®¡ç†æ‰€æœ‰å®‰è£…åœ¨Androidç³»ç»Ÿä¸­çš„åº”ç”¨ç¨‹åºã€‚\n   4. Notification Managerï¼Œé€šçŸ¥ç®¡ç†å™¨ã€‚ä½¿å¾—åº”ç”¨ç¨‹åºå¯ä»¥åœ¨çŠ¶æ€æ ä¸­æ˜¾ç¤ºè‡ªå®šä¹‰çš„æç¤ºä¿¡æ¯ã€‚\n   5. Resource Managerï¼Œèµ„æºç®¡ç†å™¨ã€‚æä¾›åº”ç”¨ç¨‹åºä½¿ç”¨çš„å„ç§éä»£ç èµ„æºï¼Œå¦‚æœ¬åœ°åŒ–å­—ç¬¦ä¸²ã€å›¾ç‰‡ã€å¸ƒå±€æ–‡ä»¶ã€é¢œè‰²æ–‡ä»¶ç­‰ã€‚\n   6. Telephony Managerï¼Œç”µè¯ç®¡ç†å™¨ã€‚ç®¡ç†æ‰€æœ‰çš„ç§»åŠ¨è®¾å¤‡åŠŸèƒ½ã€‚\n   7. Window Managerï¼Œçª—å£ç®¡ç†å™¨ã€‚ç®¡ç†æ‰€æœ‰å¼€å¯çš„çª—å£ç¨‹åºã€‚\n   8. Content Providerï¼Œå†…å®¹æä¾›å™¨ã€‚ä½¿å¾—ä¸åŒåº”ç”¨ç¨‹åºä¹‹é—´å¯ä»¥å…±äº«æ•°æ®ã€‚\n   9. View Systemï¼Œè§†å›¾ç³»ç»Ÿã€‚æ„å»ºåº”ç”¨ç¨‹åºçš„åŸºæœ¬ç»„ä»¶ã€‚\n\n   ![image-20220812120406746](../../images/Android_æ¶æ„/image-20220812120406746.png)\n\n3. Binder IPCã€‚Binder è¿›ç¨‹é—´é€šä¿¡ (IPC) æœºåˆ¶å…è®¸åº”ç”¨æ¡†æ¶è·¨è¶Šè¿›ç¨‹è¾¹ç•Œå¹¶è°ƒç”¨Androidç³»ç»ŸæœåŠ¡ä»£ç ï¼Œè¿™ä½¿å¾—é«˜çº§æ¡†æ¶APIèƒ½ä¸Androidç³»ç»ŸæœåŠ¡è¿›è¡Œäº¤äº’ã€‚åœ¨åº”ç”¨æ¡†æ¶çº§åˆ«ï¼Œå¼€å‘è€…æ— æ³•çœ‹åˆ°æ­¤ç±»é€šä¿¡çš„è¿‡ç¨‹ï¼Œä½†ä¸€åˆ‡ä¼¼ä¹éƒ½åœ¨â€œæŒ‰éƒ¨å°±ç­åœ°è¿è¡Œâ€ã€‚\n\n4. ç³»ç»ŸæœåŠ¡å±‚ã€‚ç³»ç»ŸæœåŠ¡æ˜¯ä¸“æ³¨äºç‰¹å®šåŠŸèƒ½çš„æ¨¡å—åŒ–ç»„ä»¶ï¼Œä¾‹å¦‚çª—å£ç®¡ç†å™¨ã€æœç´¢æœåŠ¡æˆ–é€šçŸ¥ç®¡ç†å™¨ã€‚åº”ç”¨æ¡†æ¶ API æ‰€æä¾›çš„åŠŸèƒ½å¯ä¸ç³»ç»ŸæœåŠ¡é€šä¿¡ï¼Œä»¥è®¿é—®åº•å±‚ç¡¬ä»¶ã€‚Android åŒ…å«ä¸¤ç»„æœåŠ¡ï¼šâ€œç³»ç»Ÿâ€ï¼ˆè¯¸å¦‚çª—å£ç®¡ç†å™¨å’Œé€šçŸ¥ç®¡ç†å™¨ä¹‹ç±»çš„æœåŠ¡ï¼‰å’Œâ€œåª’ä½“â€ï¼ˆæ¶‰åŠæ’­æ”¾å’Œå½•åˆ¶åª’ä½“çš„æœåŠ¡ï¼‰ã€‚\n   1. è¿™ä¸€å±‚é€šè¿‡ä¸€äº›`C/C++`åº“æ¥ä¸ºAndroidç³»ç»Ÿæä¾›äº†ä¸»è¦çš„ç‰¹æ€§æ”¯æŒã€‚å¦‚SQLiteåº“æä¾›äº†æ•°æ®åº“çš„æ”¯æŒï¼Œ`OpenGL|ES`åº“æä¾›äº†3Dç»˜å›¾çš„æ”¯æŒï¼ŒWebkitåº“æä¾›äº†æµè§ˆå™¨å†…æ ¸çš„æ”¯æŒç­‰ã€‚\n   2. è¿™ä¸€å±‚è¿˜æœ‰Androidè¿è¡Œæ—¶åº“ï¼Œå®ƒä¸»è¦æä¾›äº†ä¸€äº›æ ¸å¿ƒåº“ï¼Œèƒ½å¤Ÿå…è®¸å¼€å‘è€…ä½¿ç”¨Javaè¯­è¨€æ¥ç¼–å†™Androidåº”ç”¨ã€‚å¦å¤–ï¼ŒAndroidè¿è¡Œæ—¶åº“ä¸­è¿˜åŒ…å«äº†Dalvikè™šæ‹Ÿæœºï¼ˆ5.0ç³»ç»Ÿä¹‹åæ”¹ä¸ºARTè¿è¡Œç¯å¢ƒï¼‰ï¼Œå®ƒä½¿å¾—æ¯ä¸€ä¸ªAndroidåº”ç”¨éƒ½èƒ½è¿è¡Œåœ¨ç‹¬ç«‹çš„è¿›ç¨‹å½“ä¸­ï¼Œå¹¶ä¸”æ‹¥æœ‰ä¸€ä¸ªè‡ªå·±çš„Dalvikè™šæ‹Ÿæœºå®ä¾‹ã€‚ç›¸è¾ƒäºJavaè™šæ‹Ÿæœºï¼ŒDalvikæ˜¯ä¸“é—¨ä¸ºç§»åŠ¨è®¾å¤‡å®šåˆ¶çš„ï¼Œå®ƒé’ˆå¯¹æ‰‹æœºå†…å­˜ã€CPUæ€§èƒ½æœ‰é™ç­‰æƒ…å†µåšäº†ä¼˜åŒ–å¤„ç†ã€‚\n\n5. ç¡¬ä»¶æŠ½è±¡å±‚ã€‚HAL å¯å®šä¹‰ä¸€ä¸ªæ ‡å‡†æ¥å£ä»¥ä¾›ç¡¬ä»¶ä¾›åº”å•†å®ç°ï¼Œè¿™å¯è®© Android å¿½ç•¥è¾ƒä½çº§åˆ«çš„é©±åŠ¨ç¨‹åºå®ç°ã€‚å€ŸåŠ© HALï¼Œæ‚¨å¯ä»¥é¡ºåˆ©å®ç°ç›¸å…³åŠŸèƒ½ï¼Œè€Œä¸ä¼šå½±å“æˆ–æ›´æ”¹æ›´é«˜çº§åˆ«çš„ç³»ç»Ÿã€‚HAL å®ç°ä¼šè¢«å°è£…æˆæ¨¡å—ï¼Œå¹¶ä¼šç”± Android ç³»ç»Ÿé€‚æ—¶åœ°åŠ è½½ã€‚å¦‚éœ€äº†è§£è¯¦æƒ…ï¼Œè¯·å‚é˜…[ç¡¬ä»¶æŠ½è±¡å±‚ (HAL)](https://source.android.com/devices/architecture/hal)ã€‚\n\n6. Linuxå†…æ ¸ã€‚Androidç³»ç»Ÿæ˜¯åŸºäºLinuxå†…æ ¸çš„ï¼Œè¿™ä¸€å±‚ä¸ºAndroidè®¾å¤‡çš„å„ç§ç¡¬ä»¶æä¾›äº†åº•å±‚çš„é©±åŠ¨ï¼Œå¦‚æ˜¾ç¤ºé©±åŠ¨ã€éŸ³é¢‘é©±åŠ¨ã€ç…§ç›¸æœºé©±åŠ¨ã€è“ç‰™é©±åŠ¨ã€Wi-Fié©±åŠ¨ã€ç”µæºç®¡ç†ç­‰ã€‚å¼€å‘è®¾å¤‡é©±åŠ¨ç¨‹åºä¸å¼€å‘å…¸å‹çš„ Linux è®¾å¤‡é©±åŠ¨ç¨‹åºç±»ä¼¼ã€‚Android ä½¿ç”¨çš„ Linux å†…æ ¸ç‰ˆæœ¬åŒ…å«ä¸€äº›ç‰¹æ®Šçš„è¡¥å……åŠŸèƒ½ï¼Œä¾‹å¦‚ä½å†…å­˜ç»ˆæ­¢å®ˆæŠ¤è¿›ç¨‹ï¼ˆä¸€ä¸ªå†…å­˜ç®¡ç†ç³»ç»Ÿï¼Œå¯æ›´ä¸»åŠ¨åœ°ä¿ç•™å†…å­˜ï¼‰ã€å”¤é†’é”å®šï¼ˆä¸€ç§ [`PowerManager`](https://developer.android.com/reference/android/os/PowerManager.html) ç³»ç»ŸæœåŠ¡ï¼‰ã€Binder IPC é©±åŠ¨ç¨‹åºï¼Œä»¥åŠå¯¹ç§»åŠ¨åµŒå…¥å¼å¹³å°æ¥è¯´éå¸¸é‡è¦çš„å…¶ä»–åŠŸèƒ½ã€‚è¿™äº›è¡¥å……åŠŸèƒ½ä¸»è¦ç”¨äºå¢å¼ºç³»ç»ŸåŠŸèƒ½ï¼Œä¸ä¼šå½±å“é©±åŠ¨ç¨‹åºå¼€å‘ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»»æ„ç‰ˆæœ¬çš„å†…æ ¸ï¼Œåªè¦å®ƒæ”¯æŒæ‰€éœ€åŠŸèƒ½ï¼ˆå¦‚ Binder é©±åŠ¨ç¨‹åºï¼‰å³å¯ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨ä½¿ç”¨ Android å†…æ ¸çš„æœ€æ–°ç‰ˆæœ¬ã€‚å¦‚éœ€äº†è§£è¯¦æƒ…ï¼Œè¯·å‚é˜…[æ„å»ºå†…æ ¸](https://source.android.com/setup/building-kernels)ä¸€æ–‡ã€‚\n\n# HIDL(HALæ¥å£å®šä¹‰è¯­è¨€) - AIDL\n\nHAL Interface Definition Languageã€‚\n\nAndroid 8.0 é‡æ–°è®¾è®¡äº† Android æ“ä½œç³»ç»Ÿæ¡†æ¶ï¼ˆåœ¨ä¸€ä¸ªåä¸ºâ€œTrebleâ€çš„é¡¹ç›®ä¸­ï¼‰ï¼Œä»¥ä¾¿è®©åˆ¶é€ å•†èƒ½å¤Ÿä»¥æ›´ä½çš„æˆæœ¬æ›´è½»æ¾ã€æ›´å¿«é€Ÿåœ°å°†è®¾å¤‡æ›´æ–°åˆ°æ–°ç‰ˆ Android ç³»ç»Ÿã€‚åœ¨è¿™ç§æ–°æ¶æ„ä¸­ï¼ŒHAL æ¥å£å®šä¹‰è¯­è¨€ï¼ˆHIDLï¼Œå‘éŸ³ä¸ºâ€œhide-lâ€ï¼‰**æŒ‡å®šäº† HAL å’Œå…¶ç”¨æˆ·ä¹‹é—´çš„æ¥å£ï¼Œè®©ç”¨æˆ·æ— éœ€é‡æ–°æ„å»º HALï¼Œå°±èƒ½æ›¿æ¢ Android æ¡†æ¶**ã€‚åœ¨ Android 10 ä¸­ï¼ŒHIDL åŠŸèƒ½å·²æ•´åˆåˆ° AIDL(Android Interface Definition Language, å³Androidæ¥å£å®šä¹‰è¯­è¨€)ä¸­ã€‚æ­¤åï¼ŒHIDL å°±è¢«åºŸå¼ƒäº†ï¼Œå¹¶ä¸”ä»…ä¾›å°šæœªè½¬æ¢ä¸º AIDL çš„å­ç³»ç»Ÿä½¿ç”¨ã€‚\n\n# Androidè¿›é˜¶è§£å¯†ä¸­çš„åˆ†å±‚\n\nAndroidç³»ç»Ÿæ¶æ„åˆ†ä¸º5å±‚ï¼Œä»ä¸Šåˆ°ä¸‹ä¾æ¬¡æ˜¯åº”ç”¨å±‚ã€åº”ç”¨æ¡†æ¶å±‚ã€ç³»ç»Ÿè¿è¡Œåº“å±‚ã€ç¡¬ä»¶æŠ½è±¡å±‚å’ŒLinuxå†…æ ¸å±‚ã€‚\n\n![image-20220812144626701](../../images/Android_æ¶æ„/image-20220812144626701.png)\n\n1. åº”ç”¨å±‚ï¼ˆSystem Appsï¼‰\n\n   1. ç³»ç»Ÿå†…ç½®çš„åº”ç”¨ç¨‹åºä»¥åŠéç³»ç»Ÿçº§çš„åº”ç”¨ç¨‹åºéƒ½å±äºåº”ç”¨å±‚ï¼Œè´Ÿè´£ä¸ç”¨æˆ·è¿›è¡Œç›´æ¥äº¤äº’ï¼Œé€šå¸¸éƒ½æ˜¯ç”¨Javaè¿›è¡Œå¼€å‘çš„ã€‚\n\n2. åº”ç”¨æ¡†æ¶å±‚ï¼ˆJava API Frameworkï¼‰\n\n   1. åº”ç”¨æ¡†æ¶å±‚ä¸ºå¼€å‘äººå‘˜æä¾›äº†å¼€å‘åº”ç”¨ç¨‹åºæ‰€éœ€è¦çš„APIï¼Œæˆ‘ä»¬å¹³å¸¸å¼€å‘åº”ç”¨ç¨‹åºéƒ½æ˜¯è°ƒç”¨è¿™ä¸€å±‚æ‰€æä¾›çš„APIï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬ç³»ç»Ÿåº”ç”¨ã€‚è¿™ä¸€å±‚æ˜¯ç”±Javaä»£ç ç¼–å†™çš„ï¼Œå¯ä»¥ç§°ä¸ºJava Frameworkã€‚ä¸‹é¢æ¥çœ‹è¿™ä¸€å±‚æ‰€æä¾›çš„ä¸»è¦ç»„ä»¶ã€‚\n\n   2. | åç§°                               | åŠŸèƒ½æè¿°                                                     |\n      | ---------------------------------- | ------------------------------------------------------------ |\n      | Activity Managerï¼ˆæ´»åŠ¨ç®¡ç†å™¨ï¼‰     | ç®¡ç†å„ä¸ªåº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸã€‚ä»¥åŠå¸¸ç”¨çš„å¯¼èˆªå›é€€åŠŸèƒ½             |\n      | Location Managerï¼ˆä½ç½®ç®¡ç†å™¨ï¼‰     | æä¾›åœ°ç†ä½ç½®åŠå®šä½åŠŸèƒ½æœåŠ¡                                   |\n      | Package Managerï¼ˆåŒ…ç®¡ç†å™¨ï¼‰        | ç®¡ç†æ‰€æœ‰å®‰è£…åœ¨Androidç³»ç»Ÿä¸­çš„åº”ç”¨ç¨‹åº                        |\n      | Notification Managerï¼ˆé€šçŸ¥ç®¡ç†å™¨ï¼‰ | ä½¿å¾—åº”ç”¨ç¨‹åºå¯ä»¥åœ¨çŠ¶æ€æ ä¸­æ˜¾ç¤ºè‡ªå®šä¹‰çš„æç¤ºä¿¡æ¯               |\n      | Resource Managerï¼ˆèµ„æºç®¡ç†å™¨ï¼‰     | æä¾›åº”ç”¨ç¨‹åºä½¿ç”¨çš„å„ç§éä»£ç èµ„æºï¼Œå¦‚æœ¬åœ°åŒ–å­—ç¬¦ä¸²ã€å›¾ç‰‡ã€å¸ƒå±€æ–‡ä»¶ã€ é¢œè‰²æ–‡ä»¶ç­‰ |\n      | Telephony Managerï¼ˆç”µè¯ç®¡ç†å™¨ï¼‰    | ç®¡ç†æ‰€æœ‰çš„ç§»åŠ¨è®¾å¤‡åŠŸèƒ½                                       |\n      | Window Managerï¼ˆçª—å£ç®¡ç†å™¨ï¼‰       | ç®¡ç†æ‰€æœ‰å¼€å¯çš„çª—å£ç¨‹åº                                       |\n      | Content Providerï¼ˆå†…å®¹æä¾›å™¨ï¼‰     | ä½¿å¾—ä¸åŒåº”ç”¨ç¨‹åºä¹‹é—´å¯ä»¥å…±äº«æ•°æ®                             |\n      | View Systemï¼ˆè§†å›¾ç³»ç»Ÿï¼‰            | æ„å»ºåº”ç”¨ç¨‹åºçš„åŸºæœ¬ç»„ä»¶                                       |\n\n3. ç³»ç»Ÿè¿è¡Œåº“å±‚ï¼ˆNativeï¼‰ã€‚ç³»ç»Ÿè¿è¡Œåº“å±‚åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯`C/C++`ç¨‹åºåº“å’ŒAndroidè¿è¡Œæ—¶åº“\n\n   1. `C/C++`ç¨‹åºåº“èƒ½è¢«Androidç³»ç»Ÿä¸­çš„ä¸åŒç»„ä»¶æ‰€ä½¿ç”¨ï¼Œå¹¶é€šè¿‡åº”ç”¨ç¨‹åºæ¡†æ¶ä¸ºå¼€å‘è€…æä¾›æœåŠ¡ï¼Œè¡¨åˆ—å‡ºäº†ä¸»è¦çš„`C/C++`ç¨‹åºåº“ã€‚\n\n      | åŠŸèƒ½æè¿°        | åç§°                                                         |\n      | --------------- | ------------------------------------------------------------ |\n      | OpenGL ES       | 3Dç»˜å›¾å‡½æ•°åº“                                                 |\n      | Libc            | ä»BSDç»§æ‰¿æ¥çš„æ ‡å‡†Cç³»ç»Ÿå‡½æ•°åº“ï¼Œä¸“é—¨ä¸ºåŸºäºåµŒå…¥å¼Linuxçš„è®¾å¤‡å®šåˆ¶ |\n      | Media Framework | å¤šåª’ä½“åº“ã€‚æ”¯æŒå¤šç§å¸¸ç”¨çš„éŸ³é¢‘ã€‚è§†é¢‘æ ¼å¼å½•åˆ¶å’Œå›æ”¾             |\n      | SQLite          | è½»å‹çš„å…³ç³»å‹æ•°æ®åº“å¼•æ“                                       |\n      | SGL             | åº•å±‚çš„2Då›¾å½¢æ¸²æŸ“å¼•æ“                                         |\n      | SSL             | å®‰å…¨å¥—æ¥å±‚ï¼Œæ˜¯ä¸€ç§ä¸ºç½‘ç»œé€šä¿¡æä¾›å®‰å…¨åŠæ•°æ®å®Œæ•´æ€§çš„å®‰å…¨åè®®   |\n      | FreeType        | å¯ç§»æ¤çš„å­—ä½“å¼•æ“ï¼Œå®ƒæä¾›ç»Ÿä¸€çš„æ¥å£æ¥è®¿é—®å¤šç§å­—ä½“æ ¼å¼æ–‡ä»¶     |\n\n   2. Androidè¿è¡Œæ—¶åº“åˆåˆ†ä¸ºæ ¸å¿ƒåº“å’ŒARTï¼ˆAndroid 5.0ç³»ç»Ÿä¹‹åï¼ŒDalvikè™šæ‹Ÿæœºè¢«ARTå–ä»£ï¼‰ã€‚\n\n      1. æ ¸å¿ƒåº“æä¾›äº†Javaè¯­è¨€æ ¸å¿ƒåº“çš„å¤§å¤šæ•°åŠŸèƒ½ï¼Œè¿™æ ·å¼€å‘è€…å¯ä»¥ä½¿ç”¨Javaè¯­è¨€æ¥ç¼–å†™Androidåº”ç”¨ã€‚\n      2. ä¸JVMç›¸æ¯”ï¼ŒDalvikè™šæ‹Ÿæœºï¼ˆDVMï¼‰æ˜¯ä¸“é—¨ä¸ºç§»åŠ¨è®¾å¤‡å®šåˆ¶çš„ï¼Œå…è®¸åœ¨æœ‰é™çš„å†…å­˜ä¸­åŒæ—¶è¿è¡Œå¤šä¸ªè™šæ‹Ÿæœºçš„å®ä¾‹ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªDalvikåº”ç”¨ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„Linuxè¿›ç¨‹æ‰§è¡Œã€‚ç‹¬ç«‹çš„è¿›ç¨‹å¯ä»¥é˜²æ­¢åœ¨è™šæ‹Ÿæœºå´©æºƒçš„æ—¶å€™æ‰€æœ‰ç¨‹åºéƒ½è¢«å…³é—­ã€‚DVMä¸­çš„åº”ç”¨æ¯æ¬¡è¿è¡Œæ—¶ï¼Œå­—èŠ‚ç éƒ½éœ€è¦é€šè¿‡å³æ—¶ç¼–è¯‘å™¨ï¼ˆJust In Timeï¼ŒJITï¼‰è½¬æ¢ä¸ºæœºå™¨ç ï¼Œè¿™ä¼šä½¿å¾—åº”ç”¨çš„è¿è¡Œæ•ˆç‡é™ä½ã€‚è€ŒARTçš„æœºåˆ¶ä¸DVMä¸åŒï¼Œåœ¨ARTä¸­ï¼Œç³»ç»Ÿåœ¨å®‰è£…åº”ç”¨æ—¶ä¼šè¿›è¡Œä¸€æ¬¡é¢„ç¼–è¯‘ï¼ˆAhead Of Timeï¼ŒAOTï¼‰ï¼Œå°†å­—èŠ‚ç é¢„å…ˆç¼–è¯‘æˆæœºå™¨ç å¹¶å­˜å‚¨åœ¨æœ¬åœ°ï¼Œè¿™æ ·åº”ç”¨æ¯æ¬¡è¿è¡Œæ—¶å°±ä¸éœ€è¦æ‰§è¡Œç¼–è¯‘äº†ï¼Œè¿è¡Œæ•ˆç‡ä¹Ÿå¤§å¤§æé«˜ã€‚\n\n4. ç¡¬ä»¶æŠ½è±¡å±‚ï¼ˆHALï¼‰\n\n   1. ç¡¬ä»¶æŠ½è±¡å±‚æ˜¯ä½äºæ“ä½œç³»ç»Ÿå†…æ ¸ä¸ç¡¬ä»¶ç”µè·¯ä¹‹é—´çš„æ¥å£å±‚ï¼Œå…¶ç›®çš„åœ¨äºå°†ç¡¬ä»¶æŠ½è±¡åŒ–ï¼Œä¸ºäº†ä¿æŠ¤ç¡¬ä»¶å‚å•†çš„çŸ¥è¯†äº§æƒï¼Œå®ƒéšè—äº†ç‰¹å®šå¹³å°çš„ç¡¬ä»¶æ¥å£ç»†èŠ‚ï¼Œä¸ºæ“ä½œç³»ç»Ÿæä¾›è™šæ‹Ÿç¡¬ä»¶å¹³å°ï¼Œä½¿å…¶å…·æœ‰ç¡¬ä»¶æ— å…³æ€§ï¼Œå¯åœ¨å¤šç§å¹³å°ä¸Šè¿›è¡Œç§»æ¤ã€‚ä»è½¯ç¡¬ä»¶æµ‹è¯•çš„è§’åº¦æ¥çœ‹ï¼Œè½¯ç¡¬ä»¶çš„æµ‹è¯•å·¥ä½œéƒ½å¯åˆ†åˆ«åŸºäºç¡¬ä»¶æŠ½è±¡å±‚æ¥å®Œæˆï¼Œä½¿å¾—è½¯ç¡¬ä»¶æµ‹è¯•å·¥ä½œçš„å¹¶è¡Œè¿›è¡Œæˆä¸ºå¯èƒ½ã€‚é€šä¿—æ¥è®²ï¼Œå°±æ˜¯å°†æ§åˆ¶ç¡¬ä»¶çš„åŠ¨ä½œæ”¾åœ¨ç¡¬ä»¶æŠ½è±¡å±‚ä¸­ã€‚\n\n5. Linuxå†…æ ¸å±‚ï¼ˆLinux Kernelï¼‰\n\n   1. Androidçš„æ ¸å¿ƒç³»ç»ŸæœåŠ¡åŸºäºLinuxå†…æ ¸ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ äº†éƒ¨åˆ†Androidä¸“ç”¨çš„é©±åŠ¨ã€‚ç³»ç»Ÿçš„å®‰å…¨æ€§ã€å†…å­˜ç®¡ç†ã€è¿›ç¨‹ç®¡ç†ã€ç½‘ç»œåè®®æ ˆå’Œé©±åŠ¨æ¨¡å‹ç­‰éƒ½ä¾èµ–äºè¯¥å†…æ ¸ã€‚\n","categories":["Android"]},{"title":"Android_é¡¹ç›®ç›®å½•ç»“æ„","url":"/Android/Android_é¡¹ç›®ç›®å½•ç»“æ„/","content":"\n# é¡¹ç›®ç›®å½•ç»“æ„\n\n1. `.gradle`å’Œ`.idea`ï¼šè¿™ä¸¤ä¸ªç›®å½•éƒ½æ˜¯Android Studioè‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶ã€‚æ— é¡»å…³å¿ƒï¼Œä¸è¦æ‰‹åŠ¨ç¼–è¾‘ã€‚\n2. appï¼šé¡¹ç›®ä¸­çš„ä»£ç ã€èµ„æºç­‰å†…å®¹å‡ ä¹éƒ½æ˜¯æ”¾ç½®åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œå¼€å‘å·¥ä½œä¹ŸåŸºæœ¬éƒ½æ˜¯åœ¨è¿™ä¸ªç›®å½•ä¸‹è¿›è¡Œã€‚\n3. buildï¼šè¿™ä¸ªç›®å½•ä¸»è¦åŒ…å«äº†ä¸€äº›åœ¨ç¼–è¯‘æ—¶è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶ã€‚\n4. gradleï¼šè¿™ä¸ªç›®å½•ä¸‹åŒ…å«äº†`gradle wrapper`çš„é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨gradle wrapperçš„æ–¹å¼ä¸éœ€è¦æå‰å°†gradleä¸‹è½½å¥½ï¼Œè€Œæ˜¯ä¼šè‡ªåŠ¨æ ¹æ®æœ¬åœ°çš„ç¼“å­˜æƒ…å†µå†³å®šæ˜¯å¦éœ€è¦è”ç½‘ä¸‹è½½gradleã€‚Android Studioé»˜è®¤æ²¡æœ‰å¯ç”¨gradle wrapperçš„æ–¹å¼ï¼Œå¦‚æœéœ€è¦æ‰“å¼€ï¼Œå¯ä»¥ç‚¹å‡»`File, Settings, Build, Execution, Deployment, Gradle`ï¼Œè¿›è¡Œé…ç½®æ›´æ”¹ã€‚\n5. `.gitignore`ï¼šè¿™ä¸ªæ–‡ä»¶ç”¨æ¥å°†æŒ‡å®šçš„ç›®å½•æˆ–æ–‡ä»¶æ’é™¤åœ¨ç‰ˆæœ¬æ§åˆ¶ä¹‹å¤–ã€‚\n6. `build.gradle`ï¼šé¡¹ç›®å…¨å±€çš„gradleæ„å»ºè„šæœ¬ï¼Œæ–‡ä»¶å†…å®¹é€šå¸¸ä¸éœ€è¦ä¿®æ”¹ã€‚\n7. `gradle.properties`ï¼šé¡¹ç›®å…¨å±€çš„gradleé…ç½®æ–‡ä»¶ï¼Œåœ¨è¿™é‡Œé…ç½®çš„å±æ€§å°†ä¼šå½±å“åˆ°é¡¹ç›®ä¸­æ‰€æœ‰çš„gradleç¼–è¯‘è„šæœ¬ã€‚\n8. gradlewå’Œ`gradlew.bat`ï¼šè¿™ä¸¤ä¸ªæ–‡ä»¶æ˜¯ç”¨æ¥åœ¨å‘½ä»¤è¡Œç•Œé¢ä¸­æ‰§è¡Œgradleå‘½ä»¤çš„ï¼Œå…¶ä¸­gradlewæ˜¯åœ¨Linuxæˆ–Macç³»ç»Ÿä½¿ç”¨ï¼Œ`gradlew.bat`æ˜¯åœ¨Windowsç³»ç»Ÿä¸­ä½¿ç”¨ã€‚\n9. `é¡¹ç›®å.iml`ï¼šimlæ–‡ä»¶æ˜¯æ‰€æœ‰IntelliJ IDEAé¡¹ç›®éƒ½ä¼šè‡ªåŠ¨ç”Ÿæˆçš„ä¸€ä¸ªæ–‡ä»¶ï¼ˆAndroid Studioæ˜¯åŸºäºIntelliJ IDEAå¼€å‘çš„ï¼‰ï¼Œç”¨äºæ ‡è¯†è¿™æ˜¯ä¸€ä¸ªIntelliJ IDEAé¡¹ç›®ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶ä¸­çš„ä»»ä½•å†…å®¹ã€‚\n10. `local.properties`ï¼šè¿™ä¸ªæ–‡ä»¶ç”¨äºæŒ‡å®šæœ¬æœºä¸­çš„Android SDKè·¯å¾„ï¼Œé€šå¸¸å†…å®¹éƒ½æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œå¹¶ä¸éœ€è¦ä¿®æ”¹ã€‚é™¤éæœ¬æœºä¸­çš„Android SDKä½ç½®å‘ç”Ÿäº†å˜åŒ–ï¼Œé‚£ä¹ˆå°±å°†è¿™ä¸ªæ–‡ä»¶ä¸­çš„è·¯å¾„æ”¹æˆæ–°çš„ä½ç½®å³å¯ã€‚\n11. `settings.gradle`ï¼šç”¨äºæŒ‡å®šé¡¹ç›®ä¸­æ‰€æœ‰å¼•å…¥çš„æ¨¡å—ã€‚ç”±äºæ­¤æ—¶é¡¹ç›®ä¸­åªæœ‰ä¸€ä¸ªappæ¨¡å—ï¼Œå› æ­¤æ–‡ä»¶ä¸­åªå¼•å…¥äº†appè¿™ä¸€ä¸ªæ¨¡å—ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæ¨¡å—çš„å¼•å…¥æ˜¯è‡ªåŠ¨å®Œæˆçš„ï¼Œå¾ˆå°‘å»æ‰‹åŠ¨ä¿®æ”¹æ­¤æ–‡ä»¶ã€‚\n\nå‘ç°ï¼ŒåŸºæœ¬ä¸Šé™¤äº†appç›®å½•ä¹‹å¤–ï¼Œå¤§å¤šæ•°ç›®å½•ã€æ–‡ä»¶éƒ½æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ã€‚ä¸‹é¢å¯¹appå†…å®¹è¿›è¡Œæ›´ä¸ºè¯¦ç»†çš„åˆ†æã€‚\n\n1. buildï¼šè¿™ä¸ªç›®å½•å’Œå¤–å±‚çš„buildç›®å½•ç±»ä¼¼ï¼Œä¸»è¦ä¹Ÿæ˜¯åŒ…å«äº†ä¸€äº›åœ¨ç¼–è¯‘æ—¶è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶ï¼Œä¸è¿‡å®ƒé‡Œé¢çš„å†…å®¹æ›´å¤šæ›´æ‚ï¼Œä¸éœ€è¦è¿‡å¤šå…³å¿ƒã€‚\n2. libsï¼šå¦‚æœä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨åˆ°äº†ç¬¬ä¸‰æ–¹jaråŒ…ï¼Œå°±éœ€è¦æŠŠè¿™äº›jaråŒ…éƒ½æ”¾åœ¨libsç›®å½•ä¸‹ï¼Œæ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹çš„jaråŒ…éƒ½ä¼šè¢«è‡ªåŠ¨æ·»åŠ åˆ°æ„å»ºè·¯å¾„é‡Œå»ã€‚\n3. androidTestï¼šæ­¤å¤„æ˜¯ç”¨æ¥ç¼–å†™Android Testæµ‹è¯•ç”¨ä¾‹çš„ï¼Œå¯ä»¥å¯¹é¡¹ç›®è¿›è¡Œä¸€äº›è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚\n4. javaï¼šjavaç›®å½•æ˜¯æ”¾ç½®æ‰€æœ‰Javaä»£ç çš„åœ°æ–¹ï¼Œå±•å¼€è¯¥ç›®å½•ï¼Œå°†çœ‹åˆ°åˆšæ‰åˆ›å»ºçš„HelloWorldActivityæ–‡ä»¶å°±åœ¨é‡Œé¢ã€‚\n5. resï¼šè¿™ä¸ªç›®å½•ä¸‹çš„å†…å®¹æœ‰ç‚¹å¤šã€‚ç®€å•ç‚¹è¯´ï¼Œå°±æ˜¯åœ¨é¡¹ç›®ä¸­ä½¿ç”¨åˆ°çš„æ‰€æœ‰å›¾ç‰‡ã€å¸ƒå±€ã€å­—ç¬¦ä¸²ç­‰èµ„æºéƒ½è¦å­˜æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ã€‚å½“ç„¶è¿™ä¸ªç›®å½•ä¸‹è¿˜æœ‰å¾ˆå¤šå­ç›®å½•ï¼Œå›¾ç‰‡æ”¾åœ¨drawableç›®å½•ä¸‹ï¼Œå¸ƒå±€æ”¾åœ¨layoutç›®å½•ä¸‹ï¼Œå­—ç¬¦ä¸²æ”¾åœ¨valuesç›®å½•ä¸‹ï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒä¼šæŠŠæ•´ä¸ªresç›®å½•å¼„å¾—ä¹±ç³Ÿç³Ÿçš„ã€‚\n\n6. `AndroidManifest.xml`ï¼šè¿™æ˜¯æ•´ä¸ªAndroidé¡¹ç›®çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨ç¨‹åºä¸­å®šä¹‰çš„æ‰€æœ‰å››å¤§ç»„ä»¶éƒ½éœ€è¦åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œæ³¨å†Œï¼Œå¦å¤–è¿˜å¯ä»¥åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ç»™åº”ç”¨ç¨‹åºæ·»åŠ æƒé™å£°æ˜ã€‚\n7. testï¼šæ­¤å¤„æ˜¯ç”¨æ¥ç¼–å†™Unit Testæµ‹è¯•ç”¨ä¾‹çš„ï¼Œæ˜¯å¯¹é¡¹ç›®è¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•çš„å¦ä¸€ç§æ–¹å¼ã€‚\n8. `.gitignore`ï¼šè¿™ä¸ªæ–‡ä»¶ç”¨äºå°†appæ¨¡å—å†…çš„æŒ‡å®šçš„ç›®å½•æˆ–æ–‡ä»¶æ’é™¤åœ¨ç‰ˆæœ¬æ§åˆ¶ä¹‹å¤–ï¼Œä½œç”¨å’Œå¤–å±‚çš„`.gitignore`æ–‡ä»¶ç±»ä¼¼ã€‚\n9. `app.iml`ï¼šIntelliJ IDEAé¡¹ç›®è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶ï¼Œä¸éœ€è¦å…³å¿ƒæˆ–ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶ä¸­çš„å†…å®¹ã€‚\n10. `build.gradle`ï¼šè¿™æ˜¯appæ¨¡å—çš„gradleæ„å»ºè„šæœ¬ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸­ä¼šæŒ‡å®šå¾ˆå¤šé¡¹ç›®æ„å»ºç›¸å…³çš„é…ç½®ã€‚\n11. `proguard-rules.pro`ï¼šè¿™ä¸ªæ–‡ä»¶ç”¨äºæŒ‡å®šé¡¹ç›®ä»£ç çš„æ··æ·†è§„åˆ™ï¼Œå½“ä»£ç å¼€å‘å®Œæˆåæ‰“æˆå®‰è£…åŒ…æ–‡ä»¶ï¼Œå¦‚æœä¸å¸Œæœ›ä»£ç è¢«åˆ«äººç ´è§£ï¼Œé€šå¸¸ä¼šå°†ä»£ç è¿›è¡Œæ··æ·†ï¼Œä»è€Œè®©ç ´è§£è€…éš¾ä»¥é˜…è¯»ã€‚\n\n# AndroidManifest.xml\n\n```xml\n<activity anroid:name=\".HelloWorldActivity\">\n    <intent-filter>\n        <action android:name=\"android.intent.action.MAIN\"></action>\n        <category android:name=\"android.intent.category.LAUNCHER\"></category>\n    </intent-filter>\n</activity>\n```\n\nè¿™æ®µä»£ç è¡¨ç¤ºå¯¹HelloWorldActivityè¿™ä¸ªæ´»åŠ¨è¿›è¡Œæ³¨å†Œï¼Œ æ²¡æœ‰åœ¨AndroidManifest.xmlé‡Œæ³¨å†Œçš„æ´»åŠ¨æ˜¯ä¸èƒ½ä½¿ç”¨çš„ã€‚å…¶ä¸­intent-filteré‡Œçš„ä¸¤è¡Œä»£ç éå¸¸é‡è¦ï¼Œ`<action android:name=\"android.intent.action.MAIN\"/>`å’Œ\t`<category android:name=\"android.intent.category.LAUNCHER\"/>`è¡¨ç¤ºHelloWorldActivityæ˜¯è¿™ä¸ªé¡¹ç›®çš„ä¸»æ´»åŠ¨ï¼Œåœ¨æ‰‹æœºä¸Šç‚¹å‡»åº”ç”¨å›¾æ ‡ï¼Œ é¦–å…ˆå¯åŠ¨çš„å°±æ˜¯è¿™ä¸ªæ´»åŠ¨ã€‚\n\nActivityæ˜¯Androidåº”ç”¨ç¨‹åºçš„é—¨é¢ï¼Œå‡¡æ˜¯åœ¨åº”ç”¨ä¸­çœ‹å¾—åˆ°çš„ä¸œè¥¿ï¼Œéƒ½æ˜¯æ”¾åœ¨æ´»åŠ¨ä¸­çš„ã€‚å› æ­¤çœ‹åˆ°çš„ç•Œé¢ï¼Œå…¶å®å°±æ˜¯HelloWorldActivityè¿™ä¸ªæ´»åŠ¨ã€‚æ‰“å¼€HelloWorldActivityï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\npublic class HelloWorldActivity extends AppCompatActivity{\n    @Override\n    protected void onCreate(Bundle savedInstanceState){\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.hello_world_layout);\n    }\n}\n```\n\nå¯ä»¥çœ‹åˆ°ï¼ŒHelloWorldActivityæ˜¯ç»§æ‰¿è‡ªAppCompatActivityçš„ï¼Œè¿™æ˜¯ä¸€ç§å‘ä¸‹å…¼å®¹çš„Activityï¼Œå¯ä»¥å°†Activityåœ¨å„ä¸ªç³»ç»Ÿç‰ˆæœ¬ä¸­å¢åŠ çš„ç‰¹æ€§å’ŒåŠŸèƒ½æœ€ä½å…¼å®¹åˆ°Android2.1ç³»ç»Ÿã€‚\n\nActivityæ˜¯Androidç³»ç»Ÿæä¾›çš„ä¸€ä¸ªæ´»åŠ¨åŸºç±»ï¼Œæˆ‘ä»¬é¡¹ç›®ä¸­æ‰€æœ‰çš„æ´»åŠ¨éƒ½å¿…é¡»ç»§æ‰¿å®ƒæˆ–è€…å®ƒçš„å­ç±»æ‰èƒ½æ‹¥æœ‰æ´»åŠ¨çš„ç‰¹æ€§ï¼ˆAppCompatActivityæ˜¯Activityçš„å­ç±»ï¼‰ã€‚ç„¶åå¯ä»¥çœ‹åˆ°HelloWorldActivityä¸­æœ‰ä¸€ä¸ª`onCreate()`æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªæ´»åŠ¨è¢«åˆ›å»ºæ—¶å¿…å®šè¦æ‰§è¡Œçš„æ–¹æ³•ï¼Œå…¶ä¸­åªæœ‰ä¸¤è¡Œä»£ç ï¼Œå¹¶ä¸”æ²¡æœ‰`Hello World!`çš„å­—æ ·ã€‚é‚£ä¹ˆæ˜¾ç¤ºçš„`Hello World!`æ˜¯åœ¨å“ªé‡Œå®šä¹‰çš„å‘¢ï¼Ÿ\n\nå…¶å®Androidç¨‹åºçš„è®¾è®¡è®²ç©¶é€»è¾‘å’Œè§†å›¾åˆ†ç¦»ï¼Œå› æ­¤æ˜¯**ä¸æ¨èåœ¨æ´»åŠ¨ä¸­ç›´æ¥ç¼–å†™ç•Œé¢çš„ï¼Œæ›´åŠ é€šç”¨çš„ä¸€ç§åšæ³•æ˜¯ï¼Œåœ¨å¸ƒå±€æ–‡ä»¶ä¸­ç¼–å†™ç•Œé¢ï¼Œç„¶ååœ¨æ´»åŠ¨ä¸­å¼•å…¥è¿›æ¥**ã€‚å¯ä»¥çœ‹åˆ°ï¼Œåœ¨onCreateæ–¹æ³•çš„ç¬¬äºŒè¡Œè°ƒç”¨äº†setContentViewæ–¹æ³•ï¼Œå°±æ˜¯è¿™ä¸ªæ–¹æ³•ç»™å½“å‰çš„æ´»åŠ¨å¼•å…¥äº†ä¸€ä¸ª`hello_world_layout`å¸ƒå±€ï¼Œ`Hello World!`å°±æ˜¯åœ¨è¿™é‡Œå®šä¹‰çš„ã€‚\n\nå¸ƒå±€æ–‡ä»¶éƒ½æ˜¯å®šä¹‰åœ¨`res/layout`ç›®å½•ä¸‹çš„ï¼Œå±•å¼€layoutç›®å½•ï¼Œä¼šçœ‹åˆ°`hello_world_layout.xml`è¿™ä¸ªæ–‡ä»¶ã€‚æ‰“å¼€è¯¥æ–‡ä»¶å¹¶åˆ‡æ¢åˆ°Textè§†å›¾ï¼Œä»£ç å°±å‡ºæ¥äº†ï¼š\n\n# é¡¹ç›®ä¸­çš„èµ„æº\n\n1. æ‰€æœ‰ä»¥drawableå¼€å¤´çš„æ–‡ä»¶å¤¹éƒ½æ˜¯ç”¨æ¥æ”¾å›¾ç‰‡çš„ï¼›\n2. æ‰€æœ‰ä»¥mipmapå¼€å¤´çš„æ–‡ä»¶å¤¹éƒ½æ˜¯ç”¨æ¥æ”¾åº”ç”¨å›¾æ ‡çš„ï¼›\n3. æ‰€æœ‰ä»¥valueså¼€å¤´çš„æ–‡ä»¶å¤¹éƒ½æ˜¯ç”¨æ¥æ”¾å­—ç¬¦ä¸²ã€æ ·å¼ã€é¢œè‰²ç­‰é…ç½®çš„ï¼›\n4. layoutæ–‡ä»¶å¤¹æ˜¯ç”¨æ¥æ”¾å¸ƒå±€æ–‡ä»¶çš„ã€‚\n\nmipmapå¼€å¤´çš„æ–‡ä»¶å¤¹æœ‰å¾ˆå¤šï¼Œä¸»è¦æ˜¯ä¸ºäº†å…¼å®¹å„ç§è®¾å¤‡ã€‚drawableæ–‡ä»¶å¤¹ä¹Ÿæ˜¯ç›¸åŒçš„é“ç†ï¼Œè™½ç„¶Android Studioæ²¡æœ‰è‡ªåŠ¨ç”Ÿæˆï¼Œä½†åº”è¯¥è‡ªå·±åˆ›å»ºdrawable-hdpiã€drawable-xhdpiã€drawable-xxhdpiç­‰æ–‡ä»¶å¤¹ã€‚åœ¨åˆ¶ä½œç¨‹åºçš„æ—¶å€™æœ€å¥½èƒ½å¤Ÿç»™åŒä¸€å¼ å›¾ç‰‡æä¾›å‡ ä¸ªä¸åŒåˆ†è¾¨ç‡çš„ç‰ˆæœ¬ï¼Œåˆ†åˆ«æ”¾åœ¨å¯¹åº”çš„æ–‡ä»¶å¤¹ä¸‹ã€‚å½“ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨æ ¹æ®å½“å‰è¿è¡Œè®¾å¤‡åˆ†è¾¨ç‡çš„é«˜ä½é€‰æ‹©åŠ è½½ã€‚å¦‚æœåªæœ‰ä¸€ä»½å›¾ç‰‡ï¼Œé‚£å°±éƒ½æ”¾åœ¨drawable-xxhdpiæ–‡ä»¶å¤¹ä¸‹ã€‚\n\n## values\n\næ‰“å¼€`res/values/strings.xml`æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n<resources>\n    <string name=\"app_name\">HelloWorld</string>\n</resources>\n```\n\nè¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªåº”ç”¨ç¨‹åºåçš„å­—ç¬¦ä¸²ï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼æ¥å¼•ç”¨å®ƒã€‚\n\n* åœ¨ä»£ç ä¸­é€šè¿‡`R.string.app_name`å¯ä»¥è·å¾—è¯¥å­—ç¬¦ä¸²çš„å¼•ç”¨\n* åœ¨XMLä¸­é€šè¿‡`@string/app_name`å¯ä»¥è·å¾—è¯¥å­—ç¬¦ä¸²çš„å¼•ç”¨\n\nå…¶ä¸­stringéƒ¨åˆ†å¯ä»¥æ›¿æ¢ï¼Œå¦‚æœå¼•ç”¨çš„æ˜¯å›¾ç‰‡èµ„æºå¯ä»¥æ›¿æ¢æˆdrawableï¼Œå¦‚æœå¼•ç”¨çš„æ˜¯åº”ç”¨å›¾æ ‡å¯ä»¥æ›¿æ¢æˆmipmapï¼Œå¦‚æœå¼•ç”¨çš„æ˜¯å¸ƒå±€æ–‡ä»¶å¯ä»¥æ›¿æ¢æˆlayout\n\næ‰“å¼€`AndroidManifest.xml`æ–‡ä»¶ï¼Œæ‰¾åˆ°å¦‚ä¸‹ä»£ç ï¼š\n\n```xml\n<application>\n    android:allowBackup=\"true\"\n    android:icon=\"@mipmap/ic_launcher\"\n    android:label=\"@string/app_name\"\n    android:supportRtl=\"true\"\n    android:theme=\"@style/AppTheme\"\n    ...\n</application>\n```\n\nå…¶ä¸­ï¼ŒHelloWorldé¡¹ç›®çš„åº”ç”¨å›¾æ ‡æ˜¯é€šè¿‡`android:icon`æ¥æŒ‡å®šçš„ï¼Œåº”ç”¨çš„åç§°åˆ™æ˜¯é€šè¿‡`android:label`å±æ€§æŒ‡å®šçš„ã€‚\n\n# build.gradleæ–‡ä»¶\n\nAndroid Studioé‡‡ç”¨Gradleæ¥æ„å»ºé¡¹ç›®ã€‚Gradleä½¿ç”¨ä¸€ç§åŸºäºGroovyçš„é¢†åŸŸç‰¹å®šé¢„è¨€ï¼ˆDSLï¼‰æ¥å£°æ˜é¡¹ç›®è®¾ç½®ï¼Œæ‘’å¼ƒäº†ä¼ ç»ŸåŸºäºXMLï¼ˆå¦‚Antå’ŒMavenï¼‰çš„çƒ¦çé…ç½®ã€‚\n\nHelloWorldé¡¹ç›®ä¸­æœ‰ä¸¤ä¸ª`build.gradle`æ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯åœ¨æœ€å¤–å±‚ç›®å½•ä¸‹ï¼Œä¸€ä¸ªæ˜¯åœ¨appç›®å½•ä¸‹ã€‚\n\n# Androidç³»ç»Ÿæºç ç›®å½•\n\n## æ•´ä½“ç»“æ„\n\nå„ä¸ªç‰ˆæœ¬çš„æºç ç›®å½•åŸºæœ¬æ˜¯ç±»ä¼¼çš„ï¼Œå¦‚æœæ˜¯ç¼–è¯‘åçš„æºç ç›®å½•ï¼Œä¼šå¤šä¸€ä¸ªoutæ–‡ä»¶å¤¹ï¼Œç”¨æ¥å­˜å‚¨ç¼–è¯‘äº§ç”Ÿçš„æ–‡ä»¶ã€‚\n\n| Androidæºç æ ¹ç›®å½• | æè¿°                                                 |\n| ----------------- | ---------------------------------------------------- |\n| art               | ARTè¿è¡Œç¯å¢ƒ                                          |\n| bionic            | ç³»ç»ŸCåº“                                              |\n| bootable          | å¯åŠ¨å¼•å¯¼ç›¸å…³ä»£ç                                      |\n| build             | å­˜æ”¾ç³»ç»Ÿç¼–è¯‘è§„åˆ™åŠgenericç­‰åŸºç¡€å¼€å‘åŒ…é…ç½®            |\n| cts               | Androidå…¼å®¹æ€§æµ‹è¯•å¥—ä»¶æ ‡å‡†                            |\n| dalvik            | Dalvikè™šæ‹Ÿæœº                                         |\n| developers        | å¼€å‘è€…ç›®å½•                                           |\n| development       | ä¸åº”ç”¨ç¨‹åºå¼€å‘ç›¸å…³                                   |\n| device            | è®¾å¤‡ç›¸å…³é…ç½®                                         |\n| external          | å¼€æºæ¨¡ç»„ç›¸å…³æ–‡ä»¶                                     |\n| frameworks        | åº”ç”¨ç¨‹åºæ¡†æ¶ï¼ŒAndroidç³»ç»Ÿæ ¸å¿ƒéƒ¨åˆ†ï¼Œç”±Javaå’Œ`C++`ç¼–å†™ |\n| hardware          | ä¸»è¦æ˜¯ç¡¬ä»¶æŠ½è±¡å±‚çš„ä»£ç                                |\n| libcore           | æ ¸å¿ƒåº“ç›¸å…³æ–‡ä»¶                                       |\n| libnativehelper   | åŠ¨æ€åº“ï¼Œå®ç°JNIåº“çš„åŸºç¡€                              |\n| out               | ç¼–è¯‘å®Œæˆåä»£ç åœ¨æ­¤ç›®å½•è¾“å‡º                           |\n| packages          | åº”ç”¨ç¨‹åºåŒ…                                           |\n| pdk               | Plug Development Kitçš„ç¼©å†™ï¼Œæœ¬åœ°å¼€å‘å¥—ä»¶             |\n| platform_testing  | å¹³å°æµ‹è¯•                                             |\n| prebuilts         | X86å’ŒARMæ¶æ„ä¸‹é¢„ç¼–è¯‘çš„ä¸€äº›èµ„æº                       |\n| sdk               | SDKå’Œæ¨¡æ‹Ÿå™¨                                          |\n| system            | åº•å±‚æ–‡ä»¶ç³»ç»Ÿåº“ã€åº”ç”¨å’Œç»„ä»¶                           |\n| toolchain         | å·¥å…·é“¾æ–‡ä»¶                                           |\n| tools             | å·¥å…·æ–‡ä»¶                                             |\n| Makefile          | å…¨å±€Makefileæ–‡ä»¶ï¼Œç”¨æ¥å®šä¹‰ç¼–è¯‘è§„åˆ™                   |\n\n## packagesç›®å½•ç»“æ„\n\nåº”ç”¨å±‚ä½äºæ•´ä¸ªAndroidç³»ç»Ÿçš„æœ€ä¸Šå±‚ï¼Œå¼€å‘è€…å¼€å‘çš„åº”ç”¨ç¨‹åºä»¥åŠç³»ç»Ÿå†…ç½®çš„åº”ç”¨ç¨‹åºéƒ½åœ¨åº”ç”¨å±‚ã€‚æºç æ ¹ç›®å½•ä¸­çš„packagesç›®å½•å¯¹åº”ç€ç³»ç»Ÿåº”ç”¨å±‚ï¼Œå®ƒçš„ç›®å½•ç»“æ„å¦‚è¡¨æ‰€ç¤ºã€‚\n\n| packagesç›®å½• | æè¿°           |\n| ------------ | -------------- |\n| apps         | æ ¸å¿ƒåº”ç”¨ç¨‹åº   |\n| experimental | ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åº |\n| inputmethods | è¾“å…¥æ³•ç›®å½•     |\n| providers    | å†…å®¹æä¾›è€…ç›®å½• |\n| screensavers | å±å¹•ä¿æŠ¤       |\n| services     | é€šä¿¡æœåŠ¡       |\n| wallpapers   | å¢™çº¸           |\n\n## åº”ç”¨æ¡†æ¶å±‚éƒ¨åˆ†\n\nåº”ç”¨æ¡†æ¶å±‚æ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œä¸€æ–¹é¢å‘ä¸Šæä¾›æ¥å£ç»™åº”ç”¨å±‚è°ƒç”¨ï¼Œå¦ä¸€æ–¹é¢å‘ä¸‹ä¸`C/C++`ç¨‹åºåº“åŠç¡¬ä»¶æŠ½è±¡å±‚ç­‰è¿›è¡Œè¡”æ¥ã€‚åº”ç”¨æ¡†æ¶å±‚çš„ä¸»è¦å®ç°ä»£ç åœ¨`frameworks/base`å’Œ`frameworks/av`ç›®å½•ä¸‹ï¼Œå…¶ä¸­`frameworks/base`ç›®å½•ç»“æ„å¦‚è¡¨æ‰€ç¤ºã€‚\n\n| frameworks/baseç›®å½• | æè¿°                    |\n| ------------------- | ----------------------- |\n| api                 | å®šä¹‰API                 |\n| cmds                | é‡è¦å‘½ä»¤ï¼šamã€app_proce |\n| core                | æ ¸å¿ƒåº“                  |\n| data                | å­—ä½“å’Œå£°éŸ³ç­‰æ•°æ®æ–‡ä»¶    |\n| graphics            | ä¸å›¾å½¢å›¾åƒç›¸å…³          |\n| keystore            | ä¸æ•°æ®ç­¾åè¯ä¹¦ç›¸å…³      |\n| libs                | åº“                      |\n| location            | åœ°ç†ä½ç½®ç›¸å…³åº“          |\n| media               | å¤šåª’ä½“ç›¸å…³åº“            |\n| native              | æœ¬åœ°åº“                  |\n| nfc-extras          | ä¸NFCç›¸å…³               |\n| obex                | è“ç‰™ä¼ è¾“                |\n| opengl              | 2D/3Då›¾å½¢API            |\n| packages            | è®¾ç½®ã€TTSã€VPNç¨‹åº      |\n| sax                 | XMLè§£æå™¨               |\n| services            | ç³»ç»ŸæœåŠ¡                |\n| telephony           | ç”µè¯é€šä¿¡ç®¡ç†            |\n| test-runner         | æµ‹è¯•å·¥å…·ç›¸å…³            |\n| tests               | ä¸æµ‹è¯•ç›¸å…³              |\n| tools               | å·¥å…·                    |\n| wifi                | WiFiæ— çº¿ç½‘ç»œ            |\n\n## `C/C++`ç¨‹åºåº“éƒ¨åˆ†\n\nç³»ç»Ÿè¿è¡Œåº“å±‚ï¼ˆNativeï¼‰ä¸­çš„`C/C++`ç¨‹åºåº“çš„ç±»å‹ç¹å¤šï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œ`C/C++`ç¨‹åºåº“å¹¶ä¸å®Œå…¨åœ¨ä¸€ä¸ªç›®å½•ä¸­ï¼Œè¿™é‡Œç»™å‡ºå‡ ä¸ªå¸¸ç”¨ä¸”æ¯”è¾ƒé‡è¦çš„`C/C++`ç¨‹åºåº“æ‰€åœ¨çš„ç›®å½•ä½ç½®ï¼Œå¦‚è¡¨æ‰€ç¤ºã€‚\n\n| ç›®å½•ä½ç½®                                    | æè¿°                                             |\n| ------------------------------------------- | ------------------------------------------------ |\n| bionic                                      | Googleå¼€å‘çš„ç³»ç»ŸCåº“ï¼Œä»¥BSDè®¸å¯å½¢å¼å¼€æº           |\n| `frameworks/av/media`                       | ç³»ç»Ÿåª’ä½“åº“                                       |\n| `frameworks/native/opengl`                  | ç¬¬ä¸‰æ–¹å›¾å½¢æ¸²æŸ“åº“                                 |\n| `frameworks/native/services/surfaceflinger` | å›¾å½¢æ˜¾ç¤ºåº“ï¼Œä¸»è¦è´Ÿè´£å›¾å½¢çš„æ¸²æŸ“ã€å åŠ å’Œç»˜åˆ¶ç­‰åŠŸèƒ½ |\n| `external/sqlite`                           | è½»é‡çº§å…³ç³»å‹æ•°æ®åº“SQLiteçš„`C++`å®ç°              |\n\nAndroidè¿è¡Œæ—¶åº“çš„ä»£ç åœ¨`art/`ç›®å½•ä¸­ï¼›ç¡¬ä»¶æŠ½è±¡å±‚çš„ä»£ç åœ¨`hardware/`ç›®å½•ä¸­ï¼Œè¿™æ˜¯æ‰‹æœºå‚å•†æ”¹åŠ¨æœ€å¤§çš„éƒ¨åˆ†ï¼Œæ ¹æ®æ‰‹æœºç»ˆç«¯æ‰€é‡‡ç”¨çš„ç¡¬ä»¶å¹³å°ä¸åŒä¼šæœ‰ä¸åŒçš„å®ç°ã€‚\n\n# æºç é˜…è¯»\n\nç³»ç»Ÿæºç çš„é˜…è¯»æœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œæ€»çš„æ¥è¯´åˆ†ä¸ºä¸¤ç§ï¼šä¸€ç§æ˜¯åœ¨çº¿é˜…è¯»ï¼Œå¦ä¸€ç§æ˜¯ä¸‹è½½æºç åˆ°æœ¬åœ°ç”¨è½¯ä»¶å·¥å…·é˜…è¯»ã€‚\n\n1. åœ¨çº¿é˜…è¯»\n   1. Android åœ¨çº¿é˜…è¯»æºç çš„ç½‘ç«™æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚www.grepcode.comã€www.androidxref.comï¼Œwww.androidos.net.cnç­‰ï¼Œè¿™é‡Œæ¨èä½¿ç”¨www.androidxref.comè¿›è¡Œåœ¨çº¿é˜…è¯»ã€‚\n2. ä½¿ç”¨æœ¬åœ°å·¥å…·ï¼Œæœ¬åœ°é˜…è¯»æºç å¯ä»¥é‡‡ç”¨Android Studioã€Eclipseã€Sublimeå’ŒSource Insightç­‰è½¯ä»¶ã€‚\n","categories":["Android"]},{"title":"Android_repoå’Œç¼–è¯‘_çƒ§å½•","url":"/Android/Android_repoå’Œç¼–è¯‘_çƒ§å½•/","content":"# git\n\nå‚è€ƒæ–‡ç« ï¼š[Gitä¸‰å¤§ç‰¹è‰²ä¹‹Stage](https://blog.csdn.net/qq_32452623/article/details/78417609)\n\n## ä¸‰ä¸ªåŒº\n\nGitæœ¬åœ°æ•°æ®ç®¡ç†ï¼Œå¤§æ¦‚å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªåŒºï¼Œå·¥ä½œåŒºã€æš‚å­˜åŒºã€ç‰ˆæœ¬åº“ã€‚\n\n1. å·¥ä½œåŒºï¼ˆWorking Directoryï¼‰æ˜¯æˆ‘ä»¬ç›´æ¥ç¼–è¾‘çš„åœ°æ–¹ï¼Œä¾‹å¦‚ Android Studio æ‰“å¼€çš„é¡¹ç›®ï¼Œè®°äº‹æœ¬æ‰“å¼€çš„æ–‡æœ¬ç­‰ï¼Œè‚‰çœ¼å¯è§ï¼Œç›´æ¥æ“ä½œã€‚\n2. æš‚å­˜åŒºï¼ˆStage æˆ– Indexï¼‰æ˜¯æ•°æ®æš‚æ—¶å­˜æ”¾çš„åŒºåŸŸï¼Œå¯åœ¨å·¥ä½œåŒºå’Œç‰ˆæœ¬åº“ä¹‹é—´è¿›è¡Œæ•°æ®çš„å‹å¥½äº¤æµã€‚\n3. ç‰ˆæœ¬åº“ï¼ˆcommit Historyï¼‰å­˜æ”¾å·²ç»æäº¤çš„æ•°æ®ï¼Œpush çš„æ—¶å€™ï¼Œå°±æ˜¯æŠŠè¿™ä¸ªåŒºçš„æ•°æ® push åˆ°è¿œç¨‹ä»“åº“äº†ã€‚\n\n## Stageï¼ˆæš‚å­˜åŒºï¼‰èµ‹äºˆGitæ›´å¤šçµæ´»æ€§\n\n* ä¿®æ”¹äº†4ä¸ªæ–‡ä»¶ï¼Œåœ¨ä¸æ”¾å¼ƒä»»ä½•ä¿®æ”¹çš„æƒ…å†µä¸‹ï¼Œå…¶ä¸­ä¸€ä¸ªæ–‡ä»¶ä¸æƒ³æäº¤ï¼Œå¦‚ä½•æ“ä½œï¼Ÿï¼ˆæ²¡add: `git add`ï¼›å·²ç»add: `git reset --soft`ï¼‰\n* ä¿®æ”¹åˆ°ä¸€åŠçš„æ–‡ä»¶ï¼Œçªç„¶é—´ä¸éœ€è¦æˆ–è€…æ”¾å¼ƒä¿®æ”¹äº†ï¼Œæ€ä¹ˆæ¢å¤æœªä¿®æ”¹å‰æ–‡ä»¶ï¼Ÿ (`git checkout`)\n* ä»£ç å†™ä¸€åŠï¼Œè¢«æ‰“æ–­å»åšå…¶ä»–åŠŸèƒ½å¼€å‘ï¼Œæœªå®Œæˆä»£ç ä¿å­˜ï¼Ÿ(`git stash`)\n* ä»£ç å†™ä¸€åŠï¼Œå‘ç°å¿˜è®°åˆ‡æ¢åˆ†æ”¯äº†ï¼Ÿ(`git stash & git checkout`)\n* ä»£ç éœ€è¦å›æ»šäº†ï¼Ÿï¼ˆ`git reset`ï¼‰\n\nä¸Šé¢æåˆ°çš„ checkout & stash & reset ç­‰å‘½ä»¤ï¼Œé€šè¿‡ä¸åŒçš„å‚æ•°æ­é…ä½¿ç”¨ï¼Œå¯ä»¥åœ¨å·¥ä½œåŒºï¼Œæš‚å­˜åŒºå’Œç‰ˆæœ¬åº“ä¹‹é—´ï¼Œè½»æ¾è¿›è¡Œæ•°æ®çš„æ¥å›åˆ‡æ¢ã€‚\n\n## stashçš„ä½¿ç”¨åœºæ™¯\n\næ­¤æ—¶æˆ‘åœ¨`feature_666`åˆ†æ”¯ï¼Œéå¸¸èšç²¾ä¼šç¥åŠ æŒé«˜ä¸“æ³¨åœ°å®ç°ä¸€ä¸ªåŠŸèƒ½666æ¨¡å—ï¼Œç®€ç›´é”®ç›˜å¦‚é£çš„ç¼–å†™ä»£ç ã€‚ç„¶åè¿™æ—¶ï¼Œå®¢æˆ·åé¦ˆå‡ºä¸€ä¸ªbugï¼Œéå¸¸ä¸¥é‡ï¼Œå¿…é¡»ç«‹é©¬è§£å†³ï¼Œä¼˜å…ˆçº§ä¸º0ï¼äºæ˜¯ï¼Œæˆ‘éœ€è¦å»åˆ°releaseåˆ†æ”¯å»checkoutæ–°çš„åˆ†æ”¯å»å·¥ä½œäº†ï¼Œä½†æ˜¯666åŠŸèƒ½è¿˜æ²¡å®Œæˆæ€ä¹ˆåŠï¼Ÿ\n\næ­¤æ—¶é¢ä¸´ç€ä¸€ä¸ªé€‰æ‹©é¢˜ï¼š\n\nAï¼šæäº¤ååˆ‡æ¢ï¼Œä»£ç ä¿å­˜åˆ°åˆ†æ”¯`feature_666`ï¼Œå´äº§ç”Ÿä¸€ä¸ªæ— æ„ä¹‰çš„æäº¤ã€‚\n\nBï¼šä¸æäº¤ç›´æ¥åˆ‡æ¢ï¼Œç„¶è€Œè¿™ä¸ªé€‰é¡¹æ ¹æœ¬æ²¡äººä¼šé€‰ã€‚\n\næ˜¯ä¸æ˜¯å¾ˆéš¾é€‰ï¼Œæ­¤æ—¶ï¼Œåˆ«å¿˜è®°è¿˜æœ‰Cé€‰é¡¹ï¼\n\nCï¼šä½¿ç”¨`git stash`ï¼Œå°†å½“å‰ä¿®æ”¹(æœªæäº¤çš„ä»£ç )å­˜å…¥ç¼“å­˜åŒºï¼Œåˆ‡æ¢åˆ†æ”¯ä¿®æ”¹`bug`ï¼Œå›æ¥å†é€šè¿‡`git stash pop`å–å‡ºæ¥ã€‚\n\n# repo\n\n```\nusage: repo COMMAND [ARGS]\nThe most commonly used repo commands are:\n  abandon        Permanently abandon a development branch\n  branch         View current topic branches\n  branches       View current topic branches\n  checkout       Checkout a branch for development\n  cherry-pick    Cherry-pick a change.\n  diff           Show changes between commit and working tree\n  diffmanifests  Manifest diff utility\n  download       Download and checkout a change\n  gitc-delete    Delete a GITC Client.\n  gitc-init      Initialize a GITC Client.\n  grep           Print lines matching a pattern\n  info           Get info on the manifest branch, current branch or unmerged branches\n  init           Initialize a repo client checkout in the current directory\n  list           List projects and their associated directories\n  overview       Display overview of unmerged project branches\n  prune          Prune (delete) already merged topics\n  rebase         Rebase local branches on upstream branch\n  smartsync      Update working tree to the latest known good revision\n  stage          Stage file(s) for commit\n  start          Start a new branch for development\n  status         Show the working tree status\n  sync           Update working tree to the latest revision\n  upload         Upload changes for code review\nSee 'repo help <command>' for more information on a specific command.\nSee 'repo help --all' for a complete list of recognized commands.\n```\n\n## repo init\n\n`repo init -u git@gitlab.gz.cvte.cn:tc02_mtk_android10_0/manifest.git -m mtk8788_s..wo_tc02a_sys828.xml -b develop_dt15`\n\nrepo initï¼šInitialize a repo client checkout in the current directoryï¼Œé€‰é¡¹ï¼šï¼ˆå¯é€šè¿‡`repo help init`æŸ¥çœ‹ï¼‰\n\n| é€‰é¡¹                                        | å«ä¹‰                                                |\n| ------------------------------------------- | --------------------------------------------------- |\n| `-u URL`, `--manifest-url=URL`              | manifest repository location                        |\n| `-m NAME.xml`, `--manifest-name=NAME.xml`   | initial manifest file                               |\n| `-b REVISION`, `--manifest-branch=REVISION` | manifest branch or revision (use HEAD for  default) |\n\n## repo sync\n\nrepo syncï¼šUpdate working tree to the latest revisionã€‚å¯å¸¦`-j10`æŒ‡å®šå¹¶è¡Œæ•°é‡ã€‚\n\n### æè¿°\n\n```\nUpdate working tree to the latest revision\n\nUsage: repo sync [<project>...]\n\nOptions:\n  -h, --help            show this help message and exit\n  -j JOBS, --jobs=JOBS  number of jobs to run in parallel (default: 1; based\n                        on number of CPU cores)\n  --jobs-network=JOBS   number of network jobs to run in parallel (defaults to\n                        --jobs)\n  --jobs-checkout=JOBS  number of local checkout jobs to run in parallel\n                        (defaults to --jobs)\n  -f, --force-broken    obsolete option (to be deleted in the future)\n  --fail-fast           stop syncing after first error is hit\n  --force-sync          overwrite an existing git directory if it needs to\n                        point to a different object directory. WARNING: this\n                        may cause loss of data\n  --force-remove-dirty  force remove projects with uncommitted modifications\n                        if projects no longer exist in the manifest. WARNING:\n                        this may cause loss of data\n  -l, --local-only      only update working tree, don't fetch\n  --no-manifest-update, --nmu\n                        use the existing manifest checkout as-is. (do not\n                        update to the latest revision)\n  -n, --network-only    fetch only, don't update working tree\n  -d, --detach          detach projects back to manifest revision\n  -c, --current-branch  fetch only current branch from server\n  --no-current-branch   fetch all branches from server\n  -m NAME.xml, --manifest-name=NAME.xml\n                        temporary manifest to use for this sync\n  --clone-bundle        enable use of /clone.bundle on HTTP/HTTPS\n  --no-clone-bundle     disable use of /clone.bundle on HTTP/HTTPS\n  -u MANIFEST_SERVER_USERNAME, --manifest-server-username=MANIFEST_SERVER_USERNAME\n                        username to authenticate with the manifest server\n  -p MANIFEST_SERVER_PASSWORD, --manifest-server-password=MANIFEST_SERVER_PASSWORD\n                        password to authenticate with the manifest server\n  --fetch-submodules    fetch submodules from server\n  --use-superproject    use the manifest superproject to sync projects;\n                        implies -c\n  --no-use-superproject\n                        disable use of manifest superprojects\n  --tags                fetch tags\n  --no-tags             don't fetch tags (default)\n  --optimized-fetch     only fetch projects fixed to sha1 if revision does not\n                        exist locally\n  --retry-fetches=RETRY_FETCHES\n                        number of times to retry fetches on transient errors\n  --prune               delete refs that no longer exist on the remote\n                        (default)\n  --no-prune            do not delete refs that no longer exist on the remote\n  -s, --smart-sync      smart sync using manifest from the latest known good\n                        build\n  -t SMART_TAG, --smart-tag=SMART_TAG\n                        smart sync using manifest from a known tag\n\n  Logging options:\n    -v, --verbose       show all output\n    -q, --quiet         only show errors\n\n  Multi-manifest options:\n    --outer-manifest    operate starting at the outermost manifest\n    --no-outer-manifest\n                        do not operate on outer manifests\n    --this-manifest-only\n                        only operate on this (sub)manifest\n    --no-this-manifest-only, --all-manifests\n                        operate on this manifest and its submanifests\n\n  repo Version options:\n    --no-repo-verify    do not verify repo source code\n\nDescription\n\nThe 'repo sync' command synchronizes local project directories with the remote\nrepositories specified in the manifest. If a local project does not yet exist,\nit will clone a new local directory from the remote repository and set up\ntracking branches as specified in the manifest. If the local project already\nexists, 'repo sync' will update the remote branches and rebase any new local\nchanges on top of the new remote changes.\n\n'repo sync' will synchronize all projects listed at the command line. Projects\ncan be specified either by name, or by a relative or absolute path to the\nproject's local directory. If no projects are specified, 'repo sync' will\nsynchronize all projects listed in the manifest.\n\nThe -d/--detach option can be used to switch specified projects back to the manifest revision. This option is especially helpful if the project is currently on a topic branch, but the manifest revision is temporarily needed.\n\nThe -s/--smart-sync option can be used to sync to a known good build as\nspecified by the manifest-server element in the current manifest. The\n-t/--smart-tag option is similar and allows you to specify a custom tag/label.\n\nThe -u/--manifest-server-username and -p/--manifest-server-password options can\nbe used to specify a username and password to authenticate with the manifest\nserver when using the -s or -t option.\n\nIf -u and -p are not specified when using the -s or -t option, 'repo sync' will\nattempt to read authentication credentials for the manifest server from the\nuser's .netrc file.\n\n'repo sync' will not use authentication credentials from -u/-p or .netrc if the\nmanifest server specified in the manifest file already includes credentials.\n\nBy default, all projects will be synced. The --fail-fast option can be used to\nhalt syncing as soon as possible when the first project fails to sync.\n\nThe --force-sync option can be used to overwrite existing git directories if\nthey have previously been linked to a different object directory. WARNING: This\nmay cause data to be lost since refs may be removed when overwriting.\n\nThe --force-remove-dirty option can be used to remove previously used projects\nwith uncommitted changes. WARNING: This may cause data to be lost since\nuncommitted changes may be removed with projects that no longer exist in the\nmanifest.\n\nThe --no-clone-bundle option disables any attempt to use $URL/clone.bundle to\nbootstrap a new Git repository from a resumeable bundle file on a content\ndelivery network. This may be necessary if there are problems with the local\nPython HTTP client or proxy configuration, but the Git binary works.\n\nThe --fetch-submodules option enables fetching Git submodules of a project from\nserver.\n\nThe -c/--current-branch option can be used to only fetch objects that are on the\nbranch specified by a project's revision.\n\nThe --optimized-fetch option can be used to only fetch projects that are fixed\nto a sha1 revision if the sha1 revision does not already exist locally.\n\nThe --prune option can be used to remove any refs that no longer exist on the\nremote.\n\nSSH Connections\n\nIf at least one project remote URL uses an SSH connection (ssh://, git+ssh://,\nor user@host:path syntax) repo will automatically enable the SSH ControlMaster\noption when connecting to that host. This feature permits other projects in the\nsame 'repo sync' session to reuse the same SSH tunnel, saving connection setup\noverheads.\n\nTo disable this behavior on UNIX platforms, set the GIT_SSH environment variable\nto 'ssh'. For example:\n\n  export GIT_SSH=ssh\n  repo sync\n\nCompatibility\n\nThis feature is automatically disabled on Windows, due to the lack of UNIX\ndomain socket support.\n\nThis feature is not compatible with url.insteadof rewrites in the user's\n~/.gitconfig. 'repo sync' is currently not able to perform the rewrite early\nenough to establish the ControlMaster tunnel.\n\nIf the remote SSH daemon is Gerrit Code Review, version 2.0.10 or later is\nrequired to fix a server side protocol bug.\n```\n\n### `-d`, `--detach`\n\nå‚è€ƒæ–‡ç« ï¼šhttps://segmentfault.com/a/1190000021005727\n\nä½¿ç”¨repo syncå‘½ä»¤æ¥åŒæ­¥è¿œç«¯æœåŠ¡å™¨çš„Androidä»£ç ï¼Œå¦‚æœæœ¬åœ°ä¿®æ”¹äº†ä»£ç ä½†è¿˜æ²¡æœ‰commitï¼Œä¼šæç¤ºæ— æ³•syncï¼š`error: android/frameworks/base/: contains uncommitted changes`ã€‚æ­¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨git resetå‘½ä»¤ä¸¢å¼ƒæœ¬åœ°ä¿®æ”¹ï¼ˆå¦‚æœæ²¡æœ‰git addåˆ°æš‚å­˜åŒºï¼Œå…¶å®git checkoutä¹Ÿå¯ä»¥ï¼‰ï¼Œç„¶åå†æ‰§è¡Œrepo syncæ¥åŒæ­¥ä»£ç ã€‚å¦‚æœæƒ³è¦ä¸ä¸¢å¤±æœ¬åœ°ä¿®æ”¹ï¼Œå¼ºåˆ¶åŒæ­¥è¿œç«¯æœåŠ¡å™¨ä»£ç ï¼Œå¯ä»¥åŠ ä¸Š-dé€‰é¡¹ï¼Œ`repo sync -d`å‘½ä»¤ä¼šå°†HEADå¼ºåˆ¶æŒ‡å‘repo manifestç‰ˆæœ¬ï¼Œè€Œå¿½ç•¥æœ¬åœ°çš„æ”¹åŠ¨ã€‚\n\n**æ³¨æ„**ï¼šåŠ ä¸Š`-d`é€‰é¡¹åªè¡¨ç¤ºå¿½ç•¥æœ¬åœ°æ”¹åŠ¨ï¼Œå¯ä»¥å¼ºåˆ¶åŒæ­¥è¿œç«¯æœåŠ¡å™¨çš„ä»£ç ï¼Œä½†æ˜¯**æœ¬åœ°ä¿®æ”¹çš„æ–‡ä»¶è¿˜æ˜¯ä¿æŒæ”¹åŠ¨ä¸å˜ï¼Œä¸ä¼šå¼ºåˆ¶è¦†ç›–æ‰æœ¬åœ°ä¿®æ”¹**ã€‚è€Œä¸”åŒæ­¥ä¹‹åï¼Œæœ¬åœ°çš„åˆ†æ”¯æŒ‡å‘ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä¸å†æŒ‡å‘åŸæ¥çš„åˆ†æ”¯ã€‚å…·ä½“ä¸¾ä¾‹å¦‚ä¸‹ã€‚\n\n1. æ‰§è¡Œ`repo sync -d`ä¹‹å‰çš„åˆ†æ”¯ä¿¡æ¯ï¼š\n   ```\n   $ git branch\n   * curent_branch_xxx\n   ```\n\n2. æ‰§è¡Œ`repo sync -d`ä¹‹åçš„åˆ†æ”¯ä¿¡æ¯ï¼š\n   ```\n   $ git branch\n   * (detached from 715faf5)\n     curent_branch_xxx\n   ```\n\n   å³ï¼Œä»è¿œç«¯æœåŠ¡å™¨åŒæ­¥çš„ä»£ç ï¼Œæ˜¯åŒæ­¥åˆ°è·Ÿè¸ªè¿œç«¯æœåŠ¡å™¨çš„åˆ†æ”¯ï¼Œè¿˜æ²¡æœ‰ä»gitä»“åº“æŠŠä»£ç checkoutåˆ°æœ¬åœ°ï¼Œè€Œå½“å‰æœ¬åœ°ä¿®æ”¹çš„ä»£ç å¤„åœ¨æœªå‘½ååˆ†æ”¯ä¸‹ï¼Œæ˜¯ä¸åŒçš„åˆ†æ”¯ï¼Œäº’ä¸å¹²æ‰°ï¼Œæ‰èƒ½åœ¨ä¸ä¸¢å¼ƒæœ¬åœ°ä¿®æ”¹çš„æƒ…å†µä¸‹ï¼Œå¼ºåˆ¶åŒæ­¥è¿œç«¯æœåŠ¡å™¨ä»£ç ã€‚\n\n3. æ‰§è¡Œ`git status`å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°æœ¬åœ°è¿˜æ˜¯æœ‰ä¿®æ”¹è¿‡ä¸”è¿˜æ²¡æœ‰ commit çš„æ–‡ä»¶ï¼ŒåŒæ­¥è¿œç«¯æœåŠ¡å™¨ä»£ç åï¼Œå¹¶ä¸ä¼šå¼ºåˆ¶è¦†ç›–æœ¬åœ°æ–‡ä»¶çš„ä¿®æ”¹ï¼š\n   ```\n   $ git status\n   HEAD detached at 715faf5\n   Changes not staged for commit:\n     (use \"git add <file>...\" to update what will be committed)\n     (use \"git checkout -- <file>...\" to discard changes in working directory)\n           modified:   vendor/chioverride/default/g_pipelines.h\n           modified:   vendor/topology/g_usecase.xml\n   ```\n\nå³ï¼Œå¦‚æœæƒ³è¦ä¸¢å¼ƒæœ¬åœ°ä¿®æ”¹ã€è®©æœ¬åœ°ä»£ç è·ŸåŒæ­¥åçš„ git ä»“åº“ä»£ç ä¸€è‡´ï¼Œ`repo sync -d`å‘½ä»¤è¾¾ä¸åˆ°è¿™ä¸ªæ•ˆæœã€‚\n\nå¦å¤–ï¼Œrepo syncæœ‰ä¸€ä¸ª`--force-sync`é€‰é¡¹ï¼Œå…·ä½“è¯´æ˜å¦‚ä¸‹ï¼š\n\n> **--force-sync**\n> overwrite an existing git directory if it needs to point to a different object directory. WARNING: this may cause loss of data\n\nä»è¯´æ˜æ¥çœ‹ï¼Œåƒæ˜¯å¯ä»¥å¼ºåˆ¶åŒæ­¥ï¼Œä¸”å¯èƒ½ä¸¢å¤±æœ¬åœ°æ”¹åŠ¨ã€‚ä½†æ˜¯å®é™…æµ‹è¯•å‘ç°ï¼Œè¿™ä¸ªé€‰é¡¹å¹¶ä¸èƒ½å¼ºåˆ¶è¦†ç›–æœ¬åœ°çš„æ”¹åŠ¨ã€‚å¦‚æœæœ¬åœ°æ–‡ä»¶å‘ç”Ÿæ”¹åŠ¨ï¼ŒåŠ ä¸Šè¿™ä¸ªé€‰é¡¹ä¹Ÿæ˜¯ä¼š sync æŠ¥é”™ï¼š\n\n```bash\n$ repo sync --force-sync .\nFetching project tools/\nerror: tools/: contains uncommitted changes\n```\n\nå¦‚æœæƒ³è¦è¦†ç›–æœ¬åœ°ä¿®æ”¹çš„ä»£ç ï¼Œåˆ™éœ€è¦ç»§ç»­ï¼š\n\n```bash\n# å°†HEADå¼ºåˆ¶æŒ‡å‘manifeståº“ï¼Œå¿½ç•¥æœ¬åœ°çš„æ”¹åŠ¨\nrepo sync -d\n# Remove all working directory (and staged) changes\nrepo forall -c 'git reset --hard'\n# Clean untracked files\nrepo forall -c 'git clean -f -d'\n# æ‹‰ä»£ç \nrepo sync -c # fetch only current branch from server\n```\n\n> forallçš„ä½œç”¨ï¼šRun a shell command in each project\n```\nUsage: repo forall [<project>...] -c <command> [<arg>...]\nrepo forall -r str1 [str2] ... -c <command> [<arg>...]\n\nOptions:\n  -h, --help            show this help message and exit\n  -j JOBS, --jobs=JOBS  number of jobs to run in parallel (default: 8; based\n                        on number of CPU cores)\n  -r, --regex           execute the command only on projects matching regex or\n                        wildcard expression\n  -i, --inverse-regex   execute the command only on projects not matching\n                        regex or wildcard expression\n  -g GROUPS, --groups=GROUPS\n                        execute the command only on projects matching the\n                        specified groups\n  -c, --command         command (and arguments) to execute\n  -e, --abort-on-errors\n                        abort if a command exits unsuccessfully\n  --ignore-missing      silently skip & do not exit non-zero due missing\n                        checkouts\n  --interactive         force interactive usage\n\n  Logging options:\n    -v, --verbose       show all output\n    -q, --quiet         only show errors\n    -p                  show project headers before output\n\n  Multi-manifest options:\n    --outer-manifest    operate starting at the outermost manifest\n    --no-outer-manifest\n                        do not operate on outer manifests\n    --this-manifest-only\n                        only operate on this (sub)manifest\n    --no-this-manifest-only, --all-manifests\n                        operate on this manifest and its submanifests\n\nRun `repo help forall` to view the detailed manual.\n\nDescription\n\nExecutes the same shell command in each project.\n\nThe -r option allows running the command only on projects matching regex or\nwildcard expression.\n\nBy default, projects are processed non-interactively in parallel. If you want to\nrun interactive commands, make sure to pass --interactive to force --jobs 1.\nWhile the processing order of projects is not guaranteed, the order of project\noutput is stable.\n```\nå› æ­¤ï¼Œ`repo forall -c 'git reset --hard'`è¡¨ç¤ºï¼Œåœ¨æ¯ä¸€ä¸ªrepoä¸‹å±çš„gitä»“åº“ç›®å½•ä¸­éƒ½æ‰§è¡Œ`git reset --hard`æŒ‡ä»¤ã€‚\n\n## repo start\n\nrepo startï¼šStart a new branch for developmentã€‚é€‰é¡¹ï¼š`--all`, begin branch in all projectsã€‚\n\n# ç¼–è¯‘\n\nå‚è€ƒæ–‡ç« ï¼š[androidç¼–è¯‘åˆ†æä¹‹2â€”envsetup.sh](https://blog.51cto.com/u_15147256/2792451)\n\næ€»çš„æ¥è¯´ï¼Œandroidç¼–è¯‘åˆ†ä¸¤éƒ¨åˆ†ï¼š\n\n1. ç¼–è¯‘å‰çš„å‡†å¤‡å·¥ä½œï¼Œä¸»è¦æ˜¯åœ¨shellç¯å¢ƒä¸­æå‰è®¾ç½®äº†å¾ˆå¤šå˜é‡å’Œå‡½æ•°ï¼›\n2. æ‰§è¡Œmakeè¿›è¡Œç¼–è¯‘ï¼Œäº§ç”Ÿå„ç§é•œåƒæ–‡ä»¶ã€‚\n\n## æµç¨‹\n\n1. `source build/envsetup.sh`\n2. `lunch`\n3. pick a combo\n\n```\n$ . build/envsetup.sh\nincluding device/mediatek/build/vendorsetup.sh\n$ lunch\nYou're building on Linux\n\nLunch menu... pick a combo:\n     1. aosp_arm-eng\n     2. aosp_arm64-eng\n     3. aosp_blueline-userdebug\n     4. aosp_bonito-userdebug\n     5. aosp_car_arm-userdebug\n     6. aosp_car_arm64-userdebug\n     7. aosp_car_x86-userdebug\n     8. aosp_car_x86_64-userdebug\n     9. aosp_cf_arm64_phone-userdebug\n     10. aosp_cf_x86_64_phone-userdebug\n     11. aosp_cf_x86_auto-userdebug\n     12. aosp_cf_x86_phone-userdebug\n     13. aosp_cf_x86_tv-userdebug\n     14. aosp_crosshatch-userdebug\n     15. aosp_marlin-userdebug\n     16. aosp_sailfish-userdebug\n     17. aosp_sargo-userdebug\n     18. aosp_taimen-userdebug\n     19. aosp_walleye-userdebug\n     20. aosp_walleye_test-userdebug\n     21. aosp_x86-eng\n     22. aosp_x86_64-eng\n     23. beagle_x15-userdebug\n     24. fuchsia_arm64-eng\n     25. fuchsia_x86_64-eng\n     26. full_tb8321p2_bsp-eng\n     27. full_tb8321p2_bsp-user\n     28. full_tb8321p2_bsp-userdebug\n     29. full_tb8321p2_bsp_2g-eng\n     30. full_tb8321p2_bsp_2g-user\n     31. full_tb8321p2_bsp_2g-userdebug\n     32. full_tb8765ap1_64_bsp-eng\n     33. full_tb8765ap1_64_bsp-user\n     34. full_tb8765ap1_64_bsp-userdebug\n     35. full_tb8765ap1_bsp-eng\n     36. full_tb8765ap1_bsp-user\n     37. full_tb8765ap1_bsp-userdebug\n     38. full_tb8765ap1_bsp_1g-eng\n     39. full_tb8765ap1_bsp_1g-user\n     40. full_tb8765ap1_bsp_1g-userdebug\n     41. full_tb8766p1_64_bsp-eng\n     42. full_tb8766p1_64_bsp-user\n     43. full_tb8766p1_64_bsp-userdebug\n     44. full_tb8766p1_bsp_1g-eng\n     45. full_tb8766p1_bsp_1g-user\n     46. full_tb8766p1_bsp_1g-userdebug\n     47. full_tb8768p1_64_bsp-eng\n     48. full_tb8768p1_64_bsp-user\n     49. full_tb8768p1_64_bsp-userdebug\n     50. full_tb8768p2_64_bsp_sp-eng\n     51. full_tb8768p2_64_bsp_sp-user\n     52. full_tb8768p2_64_bsp_sp-userdebug\n     53. full_tb8768tp1_64_bsp-eng\n     54. full_tb8768tp1_64_bsp-user\n     55. full_tb8768tp1_64_bsp-userdebug\n     56. full_tb8788m1_64_wifi-eng\n     57. full_tb8788m1_64_wifi-user\n     58. full_tb8788m1_64_wifi-userdebug\n     59. full_tb8788p1_64_bsp-eng\n     60. full_tb8788p1_64_bsp-user\n     61. full_tb8788p1_64_bsp-userdebug\n     62. full_tb8788p1_64_wifi-eng\n     63. full_tb8788p1_64_wifi-user\n     64. full_tb8788p1_64_wifi-userdebug\n        ...\n     \nWhich would you like? [aosp_arm-eng] full_tb8788p1_64_wifi-userdebug\nEnter customer product(default: s..wo):\nnot specific S..WO_CUSTOMER_PRODUCT, reset to s..wo.\ndevice/mediateksample/tb8788p1_64_wifi/device.mk:196: warning: \"---------Including s..wo apps---------\"\n```\n\nlunchæç¤ºä½ åšé€‰æ‹©ï¼Œå¯ä»¥ç›´æ¥å›è½¦ï¼Œå¯ä»¥è¾“å…¥åºå·ï¼Œä¹Ÿå¯ä»¥è¾“å…¥åºå·åçš„å­—ç¬¦ä¸²ã€‚\n\nç¼–è¯‘æ—¶ï¼Œç›´æ¥æ‰§è¡Œmakeå³å¯ã€‚AOSPä»£ç çš„æ ¹ç›®å½•ä¸‹æœ‰ä¸€ä¸ª`Makefile`ï¼Œä½†æ˜¯å†…å®¹åªæœ‰ä¸€å¥ï¼ŒåŒ…å«äº†`build/core`ç›®å½•ä¸‹çš„`main.mk`ï¼Œæ­£å¦‚åå­—æ‰€ç¤ºï¼Œ`main.mk`æ˜¯androidç¼–è¯‘ç³»ç»Ÿä¸­æœ€ä¸»è¦çš„makefileã€‚\n\n```shell\n### DO NOT EDIT THIS FILE ###\ninclude build/make/core/main.mk\n### DO NOT EDIT THIS FILE ###\n```\n\n## mã€mmã€mmmçš„åŒºåˆ«\n\né¦–å…ˆï¼Œä½¿ç”¨è¿™ä¸‰ä¸ªç¼–è¯‘å‘½ä»¤ï¼Œéœ€è¦æå‰åœ¨æºç ç›®å½•ä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå¦åˆ™ä¼šæç¤ºå‘½ä»¤æ‰¾ä¸åˆ°ï¼š\n\n```bash\n$ . build/envsetup.sh # æˆ–è€… source build/envsetup.sh\nincluding device/mediatek/build/vendorsetup.sh\n```\n\nbuild/envsetup.shè¿™ä¸ªè„šæœ¬åŒ…å«äº†å¾ˆå¤šçš„shellå‡½æ•°ï¼Œæœ‰äº›å‡½æ•°æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œenvsetup.shä¸­çš„ç¬¬ä¸€ä¸ªå‡½æ•°ä¸ºhmmï¼Œç±»ä¼¼äº`-help`çš„åŠŸèƒ½ï¼Œæç¤ºå½“æ‰§è¡Œå®Œsourceåï¼Œandroidç³»ç»Ÿç›®å‰èƒ½å¹²äº›ä»€ä¹ˆï¼Œæ‰§è¡Œhmmã€‚\n\n```\n~/myProject/DT15/alps$ hmm\nRun \"m help\" for help with the build system itself.\n\nInvoke \". build/envsetup.sh\" from your shell to add the following functions to your environment:\n- lunch:      lunch <product_name>-<build_variant>\n              Selects <product_name> as the product to build, and <build_variant> as the variant to\n              build, and stores those selections in the environment to be read by subsequent\n              invocations of 'm' etc.\n- tapas:      tapas [<App1> <App2> ...] [arm|x86|mips|arm64|x86_64|mips64] [eng|userdebug|user]\n- croot:      Changes directory to the top of the tree, or a subdirectory thereof.\n- m:          Makes from the top of the tree.\n- mm:         Builds all of the modules in the current directory, but not their dependencies.\n- mmm:        Builds all of the modules in the supplied directories, but not their dependencies.\n              To limit the modules being built use the syntax: mmm dir/:target1,target2.\n- mma:        Builds all of the modules in the current directory, and their dependencies.\n- mmma:       Builds all of the modules in the supplied directories, and their dependencies.\n- provision:  Flash device with all required partitions. Options will be passed on to fastboot.\n- cgrep:      Greps on all local C/C++ files.\n- ggrep:      Greps on all local Gradle files.\n- jgrep:      Greps on all local Java files.\n- resgrep:    Greps on all local res/*.xml files.\n- mangrep:    Greps on all local AndroidManifest.xml files.\n- mgrep:      Greps on all local Makefiles files.\n- sepgrep:    Greps on all local sepolicy files.\n- sgrep:      Greps on all local source files.\n- godir:      Go to the directory containing a file.\n- allmod:     List all modules.\n- gomod:      Go to the directory containing a module.\n- pathmod:    Get the directory containing a module.\n- refreshmod: Refresh list of modules for allmod/gomod.\n\nEnvironment options:\n- SANITIZE_HOST: Set to 'true' to use ASAN for all host modules. Note that\n                 ASAN_OPTIONS=detect_leaks=0 will be set by default until the\n                 build is leak-check clean.\n- ANDROID_QUIET_BUILD: set to 'true' to display only the essential messages.\n\nLook at the source to view more functions. The complete list is:\naddcompletions add_lunch_combo allmod build_build_var_cache cgrep check_product check_type check_variant choosecombo chooseproduct choosetype choosevariant _complete_android_module_names core coredump_enable coredump_setup cproj croot _croot destroy_build_var_cache enable_zsh_completion findmakefile get_abs_build_var getbugreports get_build_var getlastscreenshot get_make_command getprebuilt getscreenshotpath getsdcardpath gettargetarch gettop ggrep godir gomod hmm is isviewserverstarted jgrep key_back key_home key_menu lunch _lunch m make mangrep mgrep mm mma mmm mmma pathmod pez printconfig print_lunch_menu provision qpid rcgrep refreshmod resgrep runhat runtest sepgrep setpaths set_sequence_number set_stuff_for_environment sgrep should_add_completion smoketest source_s..wo_setup source_vendorsetup startviewserver stopviewserver systemstack tapas tracedmdump treegrep validate_current_shell _wrap_build\n\n```\n\n- mï¼šMakes from the top of the tree. ç¼–è¯‘æ•´ä¸ªå®‰å“æºç æ ‘ã€‚å³æ‰¾åˆ°æœ€é¡¶å±‚ç›®å½•ç¼–è¯‘androidã€‚\n- mmï¼šBuilds all of the modules in the current directory, but not their dependencies. ç¼–è¯‘å½“å‰ç›®å½•ä¸‹çš„æ¨¡å—ï¼Œå½“å‰ç›®å½•ä¸‹éœ€è¦æœ‰Android.mkè¿™ä¸ªmakefileæ–‡ä»¶ï¼Œå¦åˆ™å°±å¾€ä¸Šæ‰¾æœ€è¿‘çš„Android.mkæ–‡ä»¶ã€‚\n- mmmï¼šBuilds all of the modules in the supplied directories, but not their dependencies. To limit the modules being built use the syntax: `mmm dir/:target1,target2`. ç¼–è¯‘æŒ‡å®šè·¯å¾„ä¸‹çš„æ¨¡å—ï¼ŒæŒ‡å®šçš„è·¯å¾„ä¸‹é¢éœ€è¦æœ‰Android.mkè¿™ä¸ªæ–‡ä»¶ã€‚\n\n```\n~/myProject/DT15/alps$\nmmm vendor/mediatek/proprietary/packages/apps/MtkSettings/\n```\n\n# adb push\n\né¡¹ç›®å¼€å‘ä¸­éœ€è¦å‘å®‰å“çš„ç›®å½•ä¸‹ä¼ è¾“ä¸€äº›æ–‡ä»¶ï¼Œå› æ­¤è®°å½•ä¸€ä¸‹adb pullçš„ä½¿ç”¨æ–¹å¼å’Œadb pushçš„ä½¿ç”¨ã€‚æ‘¸ç´¢å®Œæ¯•åï¼Œåšä¸€ä¸ªè®°å½•ã€‚\n\né¦–å…ˆå£°æ˜ä¸€ä¸‹ï¼Œè¿™ä¸¤ç§ä½¿ç”¨æ–¹å¼éƒ½ä»…èƒ½åœ¨adb deviceåˆ—è¡¨é‡Œåªæœ‰ä¸€ä¸ªè®¾å¤‡çš„æ—¶å€™ä½¿ç”¨ï¼Œå¦åˆ™éœ€è¦å¸¦ä¸Šipã€‚\n\nç”±äºadb pushè¡¨ç¤ºå‘è®¾å¤‡ä¼ è¾“ï¼Œadb pullè¡¨ç¤ºå‘è®¾å¤‡å¤–ä¼ è¾“ã€‚ä½†æ˜¯äºŒè€…çš„ç”¨æ³•éƒ½æ˜¯ä»åœ°å€1å‘åœ°å€2ä¼ è¾“å› æ­¤ï¼Œåªä»‹ç»adb pushã€‚\n\n## ä¼ è¾“æ–‡ä»¶\n\nå¯ä»¥æŒ‡å®šç›®æ ‡åœ°ç‚¹æ–‡ä»¶çš„åå­—ï¼Œæ­¤æ—¶ä¼šå¯¹è¯¥æ–‡ä»¶è¿›è¡Œè¦†ç›–ï¼Œä¸è¦æ±‚ä¼ è¾“çš„ç›®æ ‡æ–‡ä»¶åç¼€å’Œå¾…ä¼ è¾“æ–‡ä»¶ä¸€è‡´ï¼Œä¾‹å¦‚ï¼š`adb push C:\\Users\\Administrator\\Desktop\\123.txt /sdcard/test/321.c`ï¼Œç›¸å½“äºä¼ è¾“åˆ°ç›®çš„åè¿›è¡Œäº†ä¸€æ¬¡é‡å‘½åã€‚\n\nä¹Ÿå¯ä»¥çœç•¥ç›®æ ‡åœ°ç‚¹çš„åå­—ï¼Œæ­¤æ—¶ä¼šåœ¨ç›®æ ‡åœ°ç‚¹ç”Ÿæˆä¸€ä¸ªå’Œä¼ è¾“æ–‡ä»¶åŒåçš„æ–‡ä»¶ï¼ŒåŒæ ·ä¼šå¯¹ç›®çš„åœ°åŒåæ–‡ä»¶è¿›è¡Œè¦†ç›–ï¼Œä¾‹å¦‚ï¼š`adb push C:\\Users\\Administrator\\Desktop\\123.txt /sdcard/test/`\n\n## ä¼ è¾“æ–‡ä»¶å¤¹\n\nä¼ è¾“æ–‡ä»¶å¤¹æ—¶ï¼Œåªä¼šåœ¨ç›®çš„ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªåŒåçš„å­ç›®å½•ï¼Œä¸è®ºä¼ è¾“å‰æ˜¯å¦åŒ…å«æ–œæ ä½œä¸ºç»“å°¾ï¼Œä¾‹å¦‚ï¼š`adb push C:\\Users\\Administrator\\Desktop\\video\\ /sdcard/test/`ã€‚ä¸Šé¢è¿™ä¸ªè¯­å¥åœ¨videoåé¢æˆ–è€…æ˜¯teståé¢ä¸è®ºåŠ ä¸åŠ æ–œæ ï¼Œéƒ½ä¼šåœ¨testç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªå«videoçš„æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”åŒ…å«vidioå†…åŸæœ¬çš„å†…å®¹ã€‚\n\nå¦‚æœå¸Œæœ›ä¼ è¾“æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶è€Œä¸æ˜¯ä¼ è¾“æ–‡ä»¶å¤¹ï¼Œé‚£ä¹ˆéœ€è¦åŠ ä¸Š`.`ï¼Œä¾‹å¦‚ï¼š`adb push C:\\Users\\Administrator\\Desktop\\video\\. /sdcard/test/`ï¼Œæ­¤æ—¶å°±ä¼šåœ¨testæ–‡ä»¶å¤¹ä¸‹æ”¾ç½®videoæ–‡ä»¶å¤¹å†…çš„å†…å®¹äº†ã€‚\n\n`/drives/q/myProject/DT15/alps/out/target/product/tb8788p1_64_wifi î‚° adb push . /product/priv-app/;adb shell stop;adb shell start`\n\n## Android Q remountæ­¥éª¤\n\n1. `adb shell am start com.android.settings/.Settings`\n2. å…³äºï¼Œç‰ˆæœ¬å·ï¼Œå¿«é€Ÿè¿ç»­ç‚¹å‡»ï¼Œè¿›å…¥å¼€å‘è€…æ¨¡å¼\n3. `adb shell am start -a com.android.settings.APPLICATION_DEVELOPMENT_SETTINGS`\n4. æ‰“å¼€OEMè§£é”\n5. adb reboot bootloader\n6. fastboot flashing unlock\n7. press volume up-keyï¼ˆæŒ‰éŸ³é‡ä¸Šé”®ï¼‰\n8. fastboot reboot\n9. adb root\n10. adb disable-verity\n11. adb reboot\n12. adb root\n13. adb remount\n\n# æ€»ç»“\n\nå¤§è‡´æµ‹è¯•äº†ä»¥ä¸Šå†…å®¹ï¼ŒåŸºæœ¬å¤Ÿç®€å•çš„ä½¿ç”¨äº†ï¼Œå¦‚æœè¿æ¥äº†å¤šä¸ªè®¾å¤‡åˆæƒ³æŒ‡å®šä¸€å°è¿›è¡Œä¼ è¾“ï¼Œé‚£ä¹ˆæŒ‡ä»¤ä¸Šéœ€è¦åœ¨adbå’Œpushç›´æ¥åŠ å…¥`-s deviceId`ï¼Œå…¶ä¸­deviceIdéœ€è¦æ›¿æ¢æˆç”¨adb deviceså‘½ä»¤æŸ¥çœ‹åˆ°çš„è®¾å¤‡çš„åç§°ï¼ˆæœ‰å¯èƒ½æ˜¯ipåœ°å€+ç«¯å£ï¼‰ã€‚ä¾‹å¦‚ï¼š`adb -s 192.168.10.12:5432 push`\n\n# é¢å¤–\n\n```\n îƒ¨ 11/08/2022 î‚° îƒ© 11:04.56 î‚° îƒª /drives/q/myProject/DT15/alps/out/target/product/tb8788p1_64_wifi î‚° adb root;adb remount product\nadbd is already running as root\nE Skipping /product\nW No partitions to remount\n/system/bin/remount exited with status 7\nremount failed\n                                                                                                                                                                                                 âœ“\n\n îƒ¨ 11/08/2022 î‚° îƒ© 11:05.14 î‚° îƒª /drives/q/myProject/DT15/alps/out/target/product/tb8788p1_64_wifi î‚° adb root;adb remount vendor\nadbd is already running as root\nE Skipping /vendor\nW No partitions to remount\n/system/bin/remount exited with status 7\nremount failed\n                                                                                                                                                                                                 âœ“\n\n îƒ¨ 11/08/2022 î‚° îƒ© 11:05.21 î‚° îƒª /drives/q/myProject/DT15/alps/out/target/product/tb8788p1_64_wifi î‚° adb reboot bootloader\n                                                                                                                                                                                                 âœ“\n\n îƒ¨ 11/08/2022 î‚° îƒ© 11:06.07 î‚° îƒª /drives/q/myProject/DT15/alps/out/target/product/tb8788p1_64_wifi î‚° fastboot devices\nS..WOS202110120008      fastboot\n                                                                                                                                                                                                 âœ“\n\n îƒ¨ 11/08/2022 î‚° îƒ© 11:06.26 î‚° îƒª /drives/q/myProject/DT15/alps/out/target/product/tb8788p1_64_wifi î‚° fastboot flashing unlock\n(bootloader) Start unlock flow\n\nOKAY [  6.276s]\nFinished. Total time: 6.276s\n                                                                                                                                                                                                 âœ“\n\n îƒ¨ 11/08/2022 î‚° îƒ© 11:07.02 î‚° îƒª /drives/q/myProject/DT15/alps/out/target/product/tb8788p1_64_wifi î‚° fastboot reboot\nRebooting                                          OKAY [  0.003s]\nFinished. Total time: 0.003s\n                                                                                                                                                                                                 âœ“\n îƒ¨ 11/08/2022 î‚° îƒ© 11:08.03 î‚° îƒª /drives/q/myProject/DT15/alps/out/target/product/tb8788p1_64_wifi î‚° adb connect 192.168.137.230\nconnected to 192.168.137.230:5555\n                                                                                                                                                                                                 âœ“\n îƒ¨ 11/08/2022 î‚° îƒ© 11:09.42 î‚° îƒª /drives/q/myProject/DT15/alps/out/target/product/tb8788p1_64_wifi î‚° adb root\nrestarting adbd as root\n                                                                                                                                                                                                 âœ“\n îƒ¨ 11/08/2022 î‚° îƒ© 11:09.45 î‚° îƒª /drives/q/myProject/DT15/alps/out/target/product/tb8788p1_64_wifi î‚° adb disable-verity\nusing overlayfs\nSuccessfully disabled verity\nNow reboot your device for settings to take effect\n                                                                                                                                                                                                 âœ“\n\n îƒ¨ 11/08/2022 î‚° îƒ© 11:09.51 î‚° îƒª /drives/q/myProject/DT15/alps/out/target/product/tb8788p1_64_wifi î‚° adb reboot\n                                                                                                                                                                                                 âœ“\n îƒ¨ 11/08/2022 î‚° îƒ© 11:10.37 î‚° îƒª /drives/q/myProject/DT15/alps/out/target/product/tb8788p1_64_wifi î‚° adb root;adb remount\nremount succeeded\n                                                                                                                                                                                                 âœ“\n îƒ¨ 11/08/2022 î‚° îƒ© 11:10.48 î‚° îƒª /drives/q/myProject/DT15/alps/out/target/product/tb8788p1_64_wifi î‚° adb root;adb remount ;adb push product/priv-app/MtkSettings/ /product/priv-app/\nadbd is already running as root\nremount succeeded\nproduct/priv-app/MtkSettings/: 3 files pushed, 0 skipped. 11.3 MB/s (34525797 bytes in 2.918s)\n                                                                                                                                                                                                 âœ“\n îƒ¨ 11/08/2022 î‚° îƒ© 11:11.11 î‚° îƒª /drives/q/myProject/DT15/alps/out/target/product/tb8788p1_64_wifi î‚° adb root;adb remount ;adb push product/priv-app/MtkSettings/ /product/priv-app/;adb shell stop;adb shell start\nadbd is already running as root\nremount succeeded\nproduct/priv-app/MtkSettings/: 3 files pushed, 0 skipped. 11.2 MB/s (34525817 bytes in 2.945s)\n```\n\n# MTKçƒ§å½•\n\n## å‡†å¤‡æµç¨‹\n\nè½¯ä»¶ï¼šWindowsç³»ç»Ÿã€MTKçƒ§å½•å·¥å…·åŠé©±åŠ¨åŒ… - `mtk_SP_Flash_Tool_+_Driver.zip`\n\nè§£å‹MTKçƒ§å½•å·¥å…·åŠé©±åŠ¨åŒ…ï¼Œæœ‰ä»¥ä¸‹æ–‡ä»¶ï¼š\n\n![image-20220815091907230](../../images/Android_repoå’Œç¼–è¯‘_çƒ§å½•/image-20220815091907230.png)\n\né©±åŠ¨å®‰è£…ï¼š\n\n1. æ‰“å¼€SPé©±åŠ¨å®‰è£…ç¨‹åºï¼š\n   `Driver_Auto_Installer_EXE_v5.1632.00\\Driver_Auto_Installer_SP_Drivers_20160804\\DriverInstall.exe`ã€‚\n2. æ‰“å¼€USBé©±åŠ¨å®‰è£…ç¨‹åºï¼š`usb_driver\\setup.exe`\n\nçƒ§å½•å·¥å…·ç¨‹åºï¼š`SP_Flash_Tool_exe_Windows_v5.1916.00.000\\flash_tool.exe`\n\n1. ç‚¹å‡»Download-Agentå³è¾¹çš„chooseæŒ‰é’®ï¼Œé€‰æ‹©å½“å‰çƒ§å½•å·¥å…·ç›®å½•ä¸‹çš„`MTK_AllInOne_DA.bin`æ–‡ä»¶ï¼›\n2. ç‚¹å‡»Scatter-loading Fileæ å³è¾¹çš„chooseæŒ‰é’®ï¼Œé€‰æ‹©ç³»ç»Ÿå›ºä»¶åŒ…é‡Œçš„`MT6771_Android_scatter.txt`ã€‚\n3. é€‰æ‹©ä¸‰ç§æ¨¡å¼ä¹‹ä¸€ï¼Œæœ€åç‚¹å‡»Downloadå‡†å¤‡çƒ§å½•ã€‚\n4. é‡å¯è®¾å¤‡ï¼Œè¿›è¡Œçƒ§å½•å†™å…¥ã€‚\n5. çƒ§å½•å®Œæˆåï¼Œæ‹”æ’è®¾å¤‡ç”µæºï¼Œå¼€æœºå³å¯è¿›å…¥ç³»ç»Ÿã€‚\n\n## ä¸‰ç§æ¨¡å¼çš„å·®å¼‚\n\n1. Format All + Downloadï¼Œå¯¹åº”çš„æ˜¯å…¨æ“¦å‡çº§ï¼Œä¼šæŠŠå„ç§æ ‡è¯†æ“¦é™¤ï¼Œæ¯”å¦‚å†™æ ‡è¯†ä½ã€æœºå™¨SNç ã€‚\n2. Firmware Upgradeï¼Œä¹Ÿä¼šé‡å†™å„ç§æ ‡è¯†ï¼Œå¸¸åœ¨ä¸åŒå¼€å‘ç‰ˆæœ¬ä¹‹é—´è½¬æ¢æ—¶ä½¿ç”¨ï¼Œå¦‚userå’Œuserdebugä¹‹é—´è½¬æ¢ã€‚\n3. Download Onlyï¼Œä¸€èˆ¬æ˜¯åŒä¸€å¼€å‘ç‰ˆæœ¬ä¸‹æ–°æ—§ç‰ˆæœ¬å·çš„åˆ‡æ¢ï¼Œæˆ–è€…åŒç‰ˆæœ¬å·ä¸åŒä»£ç çš„è°ƒè¯•ä½¿ç”¨ã€‚\n","categories":["Android"]},{"title":"Android_åŸç”Ÿè®¾ç½®å…¥å£é—®é¢˜","url":"/Android/Android_åŸç”Ÿè®¾ç½®å…¥å£é—®é¢˜/","content":"\n# é—®é¢˜å¼•å…¥\n\n> æŸæ²ƒå­¦ä¹ æœºä¸Šé¢ï¼Œå‡ºç°å‡ æ¬¡ç³»ç»Ÿçš„åŠ¨ç”»æ—¶é•¿ç¼©æ”¾è¢«è®¾ç½®ä¸º0ï¼Œå¯¼è‡´åº”ç”¨åŠ¨ç”»å¼‚å¸¸ã€‚\n\næŸæ²ƒå­¦ä¹ æœºAndroidç‰ˆæœ¬ï¼š10ã€‚\n\n>transition_animation_scale 0.5\n>window_animation_scale 0.5\n>animator_duration_scale 1.0\n\nå®é™…ä¸Šï¼Œè¿™ä¸ªæ˜¯å¼€å‘è€…é€‰é¡¹ä¸­æ‰èƒ½è°ƒæ•´çš„å‚æ•°ï¼Œè€Œä¸”è¿™ä¸ªè®¾ç½®çš„å…¥å£åœ¨å®šåˆ¶ç‰ˆç³»ç»Ÿä¸Šå±è”½æ‰äº†ï¼Œä¸ä»‹å…¥ç¬¬ä¸‰æ–¹åº”ç”¨æˆ–è€…å¼€å‘å·¥å…·ä¸ä¼šç›´æ¥æ‰“å¼€ï¼Œæ‰€ä»¥å¯èƒ½çš„åŸå› æœ‰ï¼š\n\n1. é€šè¿‡å¼€å‘å·¥å…·æˆ–è€…ç¬¬ä¸‰æ–¹åº”ç”¨è¿›å…¥äº†å¼€å‘è€…é€‰é¡¹ï¼Œæ‰‹åŠ¨è°ƒæ•´å‚æ•°ã€‚\n2. ç¬¬ä¸‰æ–¹åº”ç”¨ä¿®æ”¹äº†åŠ¨ç”»æ—¶é•¿ç¼©æ”¾é…ç½®ï¼›\n\né’ˆå¯¹ç¬¬ä¸€ç§å¯èƒ½ï¼šç½‘ä¸Šä¸‹è½½äº†ä¸€ä¸ª[Open Settings(shortcut to settings)](https://apkpure.com/open-settings-shortcut-to-settings/dxidev.openhiddensettings)APKã€‚å°è¯•åœ¨æŸåº¦å­¦ä¹ æœºå’ŒæŸæ²ƒå­¦ä¹ æœºä¸Šæ‰“å¼€ï¼Œå‘ç°ï¼ŒæŸåº¦è¿›å…¥äº†å‚å®¶å®šåˆ¶çš„è®¾ç½®ä¸­ï¼Œè€ŒæŸæ²ƒå´è½»æ¾åœ°è¿›å…¥äº†Androidçš„åŸç”Ÿè®¾ç½®ç¨‹åºä¸­ã€‚\n\nå®é™…ä¸Šå­¦ä¹ æœºè¿™ç±»äº§å“æ˜¯ä¸æƒ³æŠŠåŸç”Ÿè®¾ç½®çš„æœºä¼šè®©åº¦ç»™æ™®é€šç”¨æˆ·çš„ï¼Œæ‰€ä»¥ï¼ŒæŸæ²ƒçš„å­¦ä¹ æœºè¿›ä¸å»å®å±æ²¡æœ‰å‘¨å…¨è€ƒè™‘ç³»ç»Ÿå®‰å…¨æ€§ã€‚\n\nç»è‡ªå·±æ¨¡æ‹Ÿå¼€å‘ç¬¬ä¸‰æ–¹åº”ç”¨è®¾ç½®å‚æ•°ï¼Œæ’é™¤äº†ç¬¬ä¸‰æ–¹åº”ç”¨ç›´æ¥è®¾ç½®çš„å¯èƒ½ï¼Œè§ä¸‹æ–‡ã€‚\n\n# Android Settingsä¸­System/Global/Secure\n\nhttps://blog.csdn.net/qq_37580586/article/details/122327215\n\næ¥ç”µé“ƒå£°ã€é”å±æ—¶é—´ã€æ—¥æœŸæ ¼å¼ç­‰ç­‰è¿™äº›å±æ€§çš„è®¾ç½®é€šå¸¸æœ‰Settingsä¸ºå…¥å£ï¼Œé€šè¿‡SettingsProvideræ¥è¿›è¡Œã€‚SettingsProviderä¹Ÿæ˜¯æ‰€æœ‰ç³»ç»Ÿè®¾ç½®çš„ç®¡ç†è€…ã€‚\n\nåœ¨Android 5.0ç‰ˆæœ¬ä¹‹å‰ï¼ŒSettingsProviderä¸­ç³»ç»Ÿè®¾ç½®æ˜¯å­˜å‚¨åœ¨settings.dbæ•°æ®åº“ä¸­ï¼›ä½†æ˜¯åœ¨Android 6.0ä¹‹åï¼ŒSettingsProviderä¸­ç³»ç»Ÿè®¾ç½®æ”¹ä¸ºç”±xmlå­˜å‚¨åœ¨dataåˆ†åŒºã€‚\n\nä¸ºä½•è¦ä»settings.dbæ”¹ä¸ºxmlå­˜å‚¨ï¼Ÿ\n\n1. è¿™æ¬¡ä¿®æ”¹ä¸»è¦æ¶‰åŠåˆ°`global`, `secure`, `system`ä¸‰ä¸ªè¡¨ã€‚æ”¹ä¸ºäº†`settings_global.xml`ã€`settings_secure.xml`ã€`settings_system.xml`ï¼Œå¯¹åº”`/frameworks/base/core/java/android/provider/Settings.java`ä¸­çš„ä¸‰ä¸ªå†…éƒ¨ç±»ï¼šGlobalã€Secureã€Systemã€‚å…¶å®è¿˜æœ‰ä¸¤ä¸ªxmlï¼Œ`settings_config.xml`ã€`settings_ssaid.xml`ã€‚\n   1. Globalï¼šæ‰€æœ‰çš„åå¥½è®¾ç½®å¯¹ç³»ç»Ÿçš„æ‰€æœ‰ç”¨æˆ·å…¬å¼€ï¼Œç¬¬ä¸‰æ–¹APPåªè¯»ï¼›\n   2. Systemï¼šåŒ…å«å„ç§å„æ ·çš„ç”¨æˆ·åå¥½ç³»ç»Ÿè®¾ç½®ï¼Œç¬¬ä¸‰æ–¹APPåªè¯»ï¼›\n   3. Secureï¼šå®‰å…¨æ€§çš„ç”¨æˆ·åå¥½ç³»ç»Ÿè®¾ç½®ï¼Œç¬¬ä¸‰æ–¹APPåªè¯»ã€‚\n2. å®ç°æ–¹å¼ä»ä¹‹å‰çš„æ•°æ®åº“ï¼Œæ”¹ä¸ºå¼‚æ­¥æ€§èƒ½æ›´åŠ ä¼˜è‰¯çš„xmlã€‚\n3. è¿™æ¬¡ä¿®æ”¹ä¸»è¦æ˜¯åŸºäºæ€§èƒ½çš„è€ƒé‡ï¼ˆå†™å…¥ä¸€æ¡è€—æ—¶ä»400msé™ä½ä¸º10msï¼‰ï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤Ÿä½¿å¾—ä¿å­˜æ•°æ®çš„è¿‡ç¨‹æ›´åŠ å¯ä¿¡ã€‚\n4. å®é™…ä¸Šï¼Œä½¿ä¿å­˜æ•°æ®è¿‡ç¨‹æ›´åŠ å¯ä¿¡è¿™ä¸€æ¡å¹¶ä¸æ˜¯é—®é¢˜çš„å…³é”®ï¼Œå†™å…¥å¤±è´¥çš„æƒ…å†µéå¸¸ç½•è§ï¼Œè€Œä¸”ä¸Šå±‚åº”ç”¨ä¿®æ”¹SettingsProviderè®¾ç½®éƒ½æ˜¯é€šè¿‡SettingsProvideræ¥å®ç°çš„ã€‚æ‰€ä»¥å½“ä¸Šå±‚APPä¸‹æ¬¡å†æ¬¡å¯åŠ¨çš„æ—¶å€™ï¼Œå¹¶ä¸çŸ¥é“æ•°æ®å†™å…¥å¤±è´¥ã€‚\n5. ä»dbæ”¹ä¸ºxmlä»¥åŠç›¸åº”é€»è¾‘ï¼Œå¯ä»¥æœ‰æ•ˆçš„é˜²æ­¢æŸäº›æ¶æ„APPç›‘å¬æŸäº›è®¾ç½®é€‰é¡¹ï¼Œè¿›è€Œé¢‘ç¹çš„è¿›è¡Œæ“ä½œã€‚\n6. æ¯ä¸ªç”¨æˆ·éƒ½æœ‰è‡ªå·±çš„ä¸€ä»½SettingsProviderè®¾ç½®xmlæ–‡æ¡£ã€‚é€šå¸¸ä½äº`/data/system/users/userid/`ã€‚\n7. æ§åˆ¶APPé’ˆå¯¹SettingsProviderçš„å†™å…¥ï¼Œå³åˆæ³•æ€§åˆ¤æ–­\n8. æ§åˆ¶SettingsProviderçš„å¤§å°ï¼ˆæ•°æ®é‡å¤§å°ï¼Œå ç”¨å†…å­˜å¤§å°ï¼‰\n\nå…¶å®ä¸»è¦åŸå› å°±æ˜¯å› ä¸ºæ€§èƒ½ã€å®‰å…¨ä¸¤ä¸ªåŸå› ã€‚\n\n# ä¸SystemPropertieså¯¹æ¯”\n\n`settings_global.xml`ã€`settings_secure.xml`ã€`settings_system.xml`ï¼Œå¯¹åº”`/frameworks/base/core/java/android/provider/Settings.java`ä¸­çš„ä¸‰ä¸ªå†…éƒ¨ç±»ã€‚\n\nå®ƒä»¬ä¸‰ä¸ªéƒ½ç»§æ‰¿äº†`NameValueTable`ï¼Œè€ŒNameValueTableéƒ½ç»§æ‰¿äº†`BaseColumns`ã€‚æŸ¥çœ‹`/frameworks/base/core/java/android/provider/BaseColumns.java`å¯ä»¥çœ‹åˆ°ï¼š\n```java\npackage android.provider;\npublic interface BaseColumns {\n    /**\n     * The unique ID for a row.\n     * <P>Type: INTEGER (long)</P>\n     */\n    public static final String _ID = \"_id\";\n\n    /**\n     * The count of rows in a directory.\n     * <P>Type: INTEGER</P>\n     */\n    public static final String _COUNT = \"_count\";\n}\n```\n\nSettingsä¸­ä¸è®ºæ˜¯Globalã€Systemè¿˜æ˜¯Secureçš„æ•°æ®éƒ½ç”±é”®å€¼å¯¹ç»„æˆçš„ã€‚\n\nSettingsProvideræœ‰ç‚¹ç±»ä¼¼Androidçš„propertiesç³»ç»Ÿï¼ˆAndroidå±æ€§ç³»ç»Ÿï¼‰ï¼šSystemPropertiesã€‚ä½†æ˜¯SettingsProviderå’ŒSystemPropertiesæœ‰ä»¥ä¸‹ä¸åŒç‚¹ï¼š\n\n1. æ•°æ®ä¿å­˜æ–¹å¼ä¸åŒï¼šSystemPropertiesçš„æ•°æ®ä¿å­˜å±æ€§æ–‡ä»¶ä¸­ï¼ˆ`/system/build.prop`ç­‰ï¼‰ï¼Œå¼€æœºåä¼šè¢«åŠ è½½åˆ°`system properties store`ï¼›SettingsProviderçš„æ•°æ®ä¿å­˜åœ¨æ–‡ä»¶`/data/system/users/0/settings_***.xml`å’Œæ•°æ®åº“`settings.db`ä¸­ï¼›\n2. ä½œç”¨èŒƒå›´ä¸åŒï¼šSystemPropertieså¯ä»¥å®ç°è·¨è¿›ç¨‹ã€è·¨å±‚æ¬¡è°ƒç”¨ï¼Œå³åº•å±‚çš„`c/c++`å¯ä»¥è°ƒç”¨ï¼Œjavaå±‚ä¹Ÿå¯ä»¥è°ƒç”¨ï¼›SettingsProvideråªèƒ½èƒ½åœ¨javaå±‚ï¼ˆAPPï¼‰ä½¿ç”¨ï¼›\n3. å…¬å¼€ç¨‹åº¦ä¸åŒï¼šSystemPropertiesæœ‰éƒ¨åˆ†åŠŸèƒ½ä¸Šå±‚ç¬¬ä¸‰æ–¹APPå¯ä»¥ä½¿ç”¨ï¼ˆå¯¹äºåŠ äº†`@hide`æ ‡è®°çš„ç¬¬ä¸‰æ–¹APPä»…å¯è¯»ï¼Œä¸å¯ä¿®æ”¹ï¼‰ï¼›SettingsProviderä¸Šå±‚ç¬¬ä¸‰æ–¹APPä¸å¯ä»¥ä½¿ç”¨ï¼›\n\n# Settingsçš„ä¿®æ”¹æ–¹å¼\n\n## adb shell\n\né€šè¿‡adb shellè¿›è¡Œä¿®æ”¹ï¼Œæ ¼å¼ä¸ºï¼š\n\n```bash\nadb shell settings get [global/system/secure] [key]\nadb shell settings put [global/system/secure] [key] [value]\nadb shell settings list [global/system/secure]\n```\n\n```\nPS C:\\Users\\ThinkPad> adb shell\ntb8788p1_64_wifi:/ # settings put global transition_animation_scale 0.5\ntb8788p1_64_wifi:/ # settings get global transition_animation_scale\n0.5\ntb8788p1_64_wifi:/ # settings list system\naccelerometer_rotation=0\nalarm_alert=content://media/internal/audio/media/35?title=Cesium&canonical=1\nalarm_alert_set=1\nbackground_power_saving_enable=1\ndim_screen=1\ndisplay_paper_mode_activated=0\ndisplay_paper_mode_texture=255\ndtmf_tone=1\ndtmf_tone_type=0\nend_button_behavior=2\nethernet_state=1\ngsensor_change_all_process=0\nhaptic_feedback_enabled=0\nhearing_aid=0\nhide_rotation_lock_toggle_for_accessibility=0\nimport_remove_running=false\nisEthernetOpen=0\nis_ambient_sensor_adjust=1\nis_gravity_sensor_adjust=1\nis_light_sensor_adjust=1\nis_proximity_sensor_adjust=1\nlockscreen_sounds_enabled=0\nmachine_serial_number=62210304000055\nmode_ringer_streams_affected=166\nmute_streams_affected=111\nnotification_light_pulse=1\nnotification_sound=content://media/internal/audio/media/56?title=Pixie%20Dust&canonical=1\nnotification_sound_set=1\nnotification_vibration_intensity=0\npointer_speed=0\nradio.data.stall.recovery.action=0\nring_vibration_intensity=0\nringtone=content://media/internal/audio/media/177?title=Flutey%20Phone&canonical=1\nringtone_set=1\nscreen_brightness=204\nscreen_brightness_for_vr=86\nscreen_brightness_mode=0\nscreen_off_timeout=600000\ns..wo_close_voice_call=1\nshow_password=0\nsound_effects_enabled=1\nstu_fingerprint=.........\nsystem_s..wo_sensor_value_report=1\nsystem_user_login_state=1\ntime_12_24=24\ntty_mode=0\nuser_rotation=0\nvibrate_when_ringing=0\nvoice_trigger_active_command_id=1\nvoice_wakeup_mode=1\nvolume_alarm=5\nvolume_bluetooth_sco=5\nvolume_music=5\nvolume_music_speaker=1\nvolume_music_usb_headset=2\nvolume_notification=5\nvolume_ring=5\nvolume_system=5\nvolume_voice=3\nwebsite_control_state=0\n```\n\n## åº”ç”¨ä¿®æ”¹\n\n```java\n// ç¤ºä¾‹\nimport android.provider.Settings;//éœ€è¦é€šè¿‡æä¾›å™¨ä¸­çš„settingsç±»ä¿®æ”¹\nSettings.Global.putString(mContext.getContentResolver(), \"audio_test_result\", value);//ä¿®æ”¹\nSettings.Global.getString(mContext.getContentResolver(), \"audio_test_result\");//æŸ¥è¯¢\n```\n\n```xml\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:orientation=\"vertical\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n    <Button\n        android:id=\"@+id/change_button\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"ChangeAppArgs\">\n    </Button>\n</LinearLayout>\n```\n\n```java\nimport android.provider.Settings;\npublic class MainActivity extends AppCompatActivity {\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        Button button = (Button) findViewById(R.id.change_button);\n        button.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View view) {\n                Settings.Global.putString(getContentResolver(), \"animator_duration_scale\", \"1.0\");\n                String ads = Settings.Global.getString(getContentResolver(), \"animator_duration_scale\");\n                Log.d(\"MainActivity\", \"animator_duration_scale: \" + ads);\n            }\n        });\n    }\n}\n```\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    package=\"com.example.appchangeargtest\">\n    <!-- error: This Permission is only granted to system apps -->\n    <uses-permission android:name=\"android.permission.WRITE_SECURE_SETTINGS\"/>\n    <application\n        android:allowBackup=\"true\"\n        android:icon=\"@mipmap/ic_launcher\"\n        android:label=\"@string/app_name\"\n        android:roundIcon=\"@mipmap/ic_launcher_round\"\n        android:supportsRtl=\"true\"\n        android:theme=\"@style/Theme.AppChangeArgTest\">\n        <activity\n            android:name=\".MainActivity\"\n            android:exported=\"true\">\n            <intent-filter>\n                <action android:name=\"android.intent.action.MAIN\" />\n\n                <category android:name=\"android.intent.category.LAUNCHER\" />\n            </intent-filter>\n        </activity>\n    </application>\n\n</manifest>\n```\n\næç¤ºï¼š`error: This Permission is only granted to system apps`ã€‚è¯´æ˜ç¬¬ä¸‰æ–¹Appè‚¯å®šæ˜¯æ— æ³•ä¿®æ”¹è¿™ä¸ªåŠ¨ç”»ç¼©æ”¾çš„ï¼Œè€Œæ˜¯ç³»ç»Ÿåº”ç”¨æ‰æœ‰æƒä¿®æ”¹ï¼Œå› æ­¤ä¹Ÿæ’é™¤äº†ä¸‰æ–¹åº”ç”¨ç›´æ¥ä¿®æ”¹åŠ¨ç”»æ—¶é•¿ç¼©æ”¾å‚æ•°ã€‚\n\n# æ¨æµ‹å¦‚ä½•æ‰¾åˆ°åŸç”Ÿè®¾ç½®å…¥å£\n\né€šè¿‡Intentæ¥æµ‹è¯•\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    package=\"com.example.intenttosetting\">\n    <application ...>\n        <activity\n            android:name=\".MainActivity\"\n            android:exported=\"true\">\n            <intent-filter>\n                <action android:name=\"android.intent.action.MAIN\" />\n                <category android:name=\"android.intent.category.LAUNCHER\" />\n            </intent-filter>\n        </activity>\n    </application>\n</manifest>\n```\n\n```xml\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:orientation=\"vertical\"\n    android:layout_height=\"match_parent\"\n    android:layout_width=\"match_parent\">\n\n    <Button\n        android:id=\"@+id/settings\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"SETTINGS\">\n    </Button>\n    <Button\n        android:id=\"@+id/develop_settings\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"APPLICATION_DEVELOPMENT_SETTINGS\">\n    </Button>\n    <Button\n        android:id=\"@+id/accessibility_settings\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"ACCESSIBILITY_SETTINGS\">\n    </Button>\n    <Button\n        android:id=\"@+id/device_info\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"DEVICE_INFO\">\n    </Button>\n    <Button\n        android:id=\"@+id/top_settings\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"top_settings\">\n    </Button>\n\n    <EditText\n        android:id=\"@+id/editText\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:ems=\"10\"\n        android:inputType=\"textPersonName\"\n        android:text=\"packageName\" />\n\n    <EditText\n        android:id=\"@+id/editText2\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:ems=\"10\"\n        android:inputType=\"textPersonName\"\n        android:text=\"className\" />\n\n    <Button\n        android:id=\"@+id/package_class\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"package_class\" />\n\n    <EditText\n        android:id=\"@+id/editText3\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:ems=\"10\"\n        android:inputType=\"textPersonName\"\n        android:text=\"actionName\" />\n\n    <Button\n        android:id=\"@+id/action\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"ACTION\" />\n</LinearLayout>\n```\n\n```java\npublic class MainActivity extends AppCompatActivity {\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        Button b1 = (Button) findViewById(R.id.settings);\n        b1.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View view) {\n                Intent intent = new Intent(\"android.settings.SETTINGS\");\n                startActivity(intent);\n            }\n        });\n        Button b2 = (Button) findViewById(R.id.develop_settings);\n        b2.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View view) {\n                Intent intent = new Intent(\"com.android.settings.APPLICATION_DEVELOPMENT_SETTINGS\");\n                startActivity(intent);\n            }\n        });\n        Button b3 = (Button) findViewById(R.id.accessibility_settings);\n        b3.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View view) {\n                Intent intent = new Intent(\"android.settings.ACCESSIBILITY_SETTINGS\");\n                startActivity(intent);\n            }\n        });\n        Button b4 = (Button) findViewById(R.id.device_info);\n        b4.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View view) {\n                Intent intent = new Intent(\"android.settings.DEVICE_INFO_SETTINGS\");\n                startActivity(intent);\n            }\n        });\n        Button b5 = (Button) findViewById(R.id.top_settings);\n        b5.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View view) {\n                Intent intent = new Intent();\n                intent.setClassName(\"com.android.settings\", \"com.android.settings.SubSettings\");\n                startActivity(intent);\n            }\n        });\n        Button b_package_class = (Button) findViewById(R.id.package_class);\n        b_package_class.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View view) {\n                EditText t1 = (EditText) findViewById(R.id.editText);\n                EditText t2 = (EditText) findViewById(R.id.editText2);\n                Intent intent = new Intent();\n                intent.setClassName(t1.getText().toString(), t2.getText().toString());\n                startActivity(intent);\n            }\n        });\n        Button b_action = (Button) findViewById(R.id.action);\n        b_action.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View view) {\n                EditText t3 = (EditText) findViewById(R.id.editText3);\n                Intent intent = new Intent(t3.getText().toString());\n                startActivity(intent);\n            }\n        });\n    }\n}\n```\n\næƒ…å†µå¦‚ä¸‹ï¼š\n\n| intent                                                     | æŸæ²ƒ                                                         | æŸåº¦                                                         |\n| ---------------------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |\n| `android.settings.SETTINGS`                                | ç›´æ¥è¿›åŸç”Ÿè®¾ç½®ã€‚                                             | è¿›å‚å®¶è®¾ç½®ã€‚                                                 |\n| `com.android.settings.APPLICATION_DEVELOPMENT_SETTINGS`    | æç¤ºè¯·å…ˆå¯ç”¨å¼€å‘è€…é€‰é¡¹ã€‚å¦‚æœå¤„äºå¼€å‘è€…æ¨¡å¼ï¼Œåˆ™ç›´æ¥è¿›ã€‚       | æç¤ºè¯·å…ˆå¯ç”¨å¼€å‘è€…é€‰é¡¹ã€‚å¦‚æœå¤„äºå¼€å‘è€…æ¨¡å¼ï¼Œåˆ™ç›´æ¥è¿›ã€‚       |\n| `android.settings.ACCESSIBILITY_SETTINGS`                  | ç›´æ¥è¿›æ— éšœç¢è®¾ç½®ã€‚                                           | ç›´æ¥è¿›æ— éšœç¢è®¾ç½®ã€‚                                           |\n| `android.settings.DEVICE_INFO_SETTINGS`                    | ç›´æ¥è¿›å…³äºæœ¬æœºä¿¡æ¯ï¼Œä¸‹æ‹‰èœå•ç‚¹å‡»è‹¥å¹²æ¬¡ç‰ˆæœ¬å·ï¼Œå¯ä»¥è¿›å…¥å¼€å‘è€…æ¨¡å¼ã€‚ | ç›´æ¥è¿›å…³äºæœ¬æœºä¿¡æ¯ï¼Œä¸‹æ‹‰èœå•ç‚¹å‡»è‹¥å¹²æ¬¡ç‰ˆæœ¬å·ï¼Œå¯ä»¥è¿›å…¥å¼€å‘è€…æ¨¡å¼ã€‚ |\n| `com.android.settings`, `com.android.settings.SubSettings` | å´©æºƒï¼Œæ—¥å¿—æŠ¥é”™ï¼Œpermission denial, id = 1000ã€‚ç–‘ä¼¼æ˜¯æ­¤æ“ä½œåªæœ‰ç³»ç»Ÿåº”ç”¨æ‰å¯æ“ä½œã€‚ | ç›´æ¥è¿›åŸç”Ÿè®¾ç½®é¡¶å±‚ç•Œé¢ï¼                                     |\n| æŸä¸€å­è®¾ç½®é¡¹ç›®çš„å·¦ä¸Šè§’è¿”å›æŒ‰é”®æµå‘                         | å¯ä»¥è¿”å›åˆ°è®¾ç½®é¡¶å±‚ç•Œé¢                                       | ç»è¿‡å¤„ç†ï¼Œç»Ÿä¸€è¿”å›åˆ°æ¡Œé¢ï¼Œå³ä¸å¯è¿”å›åˆ°è®¾ç½®é¡¶å±‚ç•Œé¢ã€‚         |\n\nç”±ä»¥ä¸Šå®éªŒï¼Œæ¨æµ‹ï¼ŒæŸæ²ƒç”¨æˆ·å¯ä»¥é€šè¿‡å„ç§ç¬¬ä¸‰æ–¹åº”ç”¨å…ˆè½¬åˆ°åŸç”Ÿè®¾ç½®ä¸‹ç‚¹æŒ‰ç‰ˆæœ¬å·è¿›å…¥å¼€å‘è€…æ¨¡å¼ï¼Œåè¿›å…¥å¼€å‘è€…é€‰é¡¹è°ƒæ•´åŠ¨ç”»æ—¶é•¿ç¼©æ”¾ã€‚\n\nç”±æ­¤ï¼Œä¸ºäº†é¿å…ç”¨æˆ·è¿›å…¥åŸç”Ÿè®¾ç½®è¿›è¡Œé…ç½®ï¼Œé€ æˆä¸å¯é¢„æµ‹çš„å¼‚å¸¸ç°è±¡ï¼Œéœ€è¦å®šåˆ¶ä¸€ä¸ªè®¾ç½®ç¨‹åºï¼Œå±è”½æ‰åŸç”Ÿè®¾ç½®çš„æ´»åŠ¨å…¥å£ã€‚æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹å‘ï¼š\n\n1. æŠŠåŸæ¥actionæŒ‡å‘çš„åŸç”Ÿè®¾ç½®ç¨‹åºæŒ‡å‘å‚å®¶å®šåˆ¶è®¾ç½®ç¨‹åºã€‚\n\n   ```xml\n   // ä»¥ä¸‹ä¿¡æ¯æ¥è‡ª.../vendor/mediatek/proprietary/packages/apps/MtkSettings/AndroidManifest.xml\n           <activity android:name=\".homepage.SettingsHomepageActivity\"\n                     android:label=\"@string/settings_label_launcher\"\n                     android:theme=\"@style/Theme.Settings.Home\"\n                     android:launchMode=\"singleTask\">\n               <intent-filter android:priority=\"1\">\n                   <action android:name=\"android.settings.SETTINGS\" />\n                   <category android:name=\"android.intent.category.DEFAULT\" />\n               </intent-filter>\n               <meta-data android:name=\"com.android.settings.PRIMARY_PROFILE_CONTROLLED\"\n                          android:value=\"true\" />\n           </activity>\n   ```\n\n\n# æ‹¦æˆªè¿›å…¥å¼€å‘è€…æ¨¡å¼\n\nè¿›å…¥ç‰ˆæœ¬å·ç•Œé¢åï¼Œå¿«é€Ÿè¿ç»­ç‚¹æŒ‰ç‰ˆæœ¬å·ï¼Œä¼šæ˜¾ç¤ºä¿¡æ¯ï¼šâ€œç°åœ¨åªéœ€å†æ‰§è¡Œnæ­¥æ“ä½œå³å¯è¿›å…¥å¼€å‘è€…æ¨¡å¼â€ã€‚ä»¥æ­¤ä¸ºå…¥å£ï¼Œæ£€ç´¢è¿™ä¸ªå­—ç¬¦ä¸²çš„ä»£å·ã€‚\n\n```xml\n~/myProject/DT15/alps/vendor/mediatek/proprietary/packages/apps/MtkSettings/src$ rg \"æ­¥æ“ä½œå³å¯è¿›å…¥å¼€å‘è€…æ¨¡å¼\" ..\n../res/values-zh-rCN/strings.xml\n26:      <item quantity=\"other\">ç°åœ¨åªéœ€å†æ‰§è¡Œ <xliff:g id=\"STEP_COUNT_1\">%1$d</xliff:g> æ­¥æ“ä½œå³å¯è¿›å…¥å¼€å‘è€…æ¨¡å¼ã€‚</item>\n27:      <item quantity=\"one\">ç°åœ¨åªéœ€å†æ‰§è¡Œ <xliff:g id=\"STEP_COUNT_0\">%1$d</xliff:g> æ­¥æ“ä½œå³å¯è¿›å…¥å¼€å‘è€…æ¨¡å¼ã€‚</item>\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªä¿¡æ¯çš„å­—ç¬¦ä¸²åœ¨`.../res/values-zh-rCN/strings.xml`ä¸­å®šä¹‰ã€‚\n\n```xml\n25     <plurals name=\"show_dev_countdown\" formatted=\"false\" msgid=\"7201398282729229649\">\n26       <item quantity=\"other\">ç°åœ¨åªéœ€å†æ‰§è¡Œ <xliff:g id=\"STEP_COUNT_1\">%1$d</xliff:g> æ­¥æ“ä½œå³å¯è¿›å…¥å¼€å‘è€…æ¨¡å¼ã€‚</item>\n27       <item quantity=\"one\">ç°åœ¨åªéœ€å†æ‰§è¡Œ <xliff:g id=\"STEP_COUNT_0\">%1$d</xliff:g> æ­¥æ“ä½œå³å¯è¿›å…¥å¼€å‘è€…æ¨¡å¼ã€‚</item>\n28     </plurals>\n```\n\nè¿™ä¸ªå­—ç¬¦ä¸²çš„nameä¸º`show_dev_countdown`ï¼Œé¡ºè—¤æ‘¸ç“œã€‚\n\n```\n~/myProject/DT15/alps/vendor/mediatek/proprietary/packages/apps/MtkSettings/src/com$ rg show_dev_countdown\nandroid/settings/deviceinfo/BuildNumberPreferenceController.java\n196:                                R.plurals.show_dev_countdown, mDevHitCountdown,\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œè¾“å‡ºæ­¤å­—ç¬¦ä¸²çš„ä»£ç æ–‡ä»¶åªæœ‰ä¸€ä¸ªï¼Œ`BuildNumberPreferenceController.java`ï¼Œæ‹¦æˆªè¿›å…¥å¼€å‘è€…æ¨¡å¼çš„è§£å†³ä¹‹é“åˆ™èšç„¦åœ¨äº†æ­¤æ–‡ä»¶ä¸Šã€‚\n\n# åŸç”Ÿè®¾ç½®å…¥å£è·³è½¬\n\n```java\npublic class SettingsHomepageActivity extends FragmentActivity {\n    private static final String TAG = SettingsHomepageActivity.class.getSimpleName();\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        String password = getIntent().getStringExtra(\"password\");\n        if(password != null && password.equals(\".........\")) {\n            Log.w(TAG, \"Origin Action\");\n            setContentView(R.layout.settings_homepage_container);\n            final View root = findViewById(R.id.settings_homepage_container);\n            root.setSystemUiVisibility(\n                    View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION | View.SYSTEM_UI_FLAG_LAYOUT_STABLE);\n\n            setHomepageContainerPaddingTop();\n\n            final Toolbar toolbar = findViewById(R.id.search_action_bar);\n            FeatureFactory.getFactory(this).getSearchFeatureProvider()\n                    .initSearchToolbar(this /* activity */, toolbar, SettingsEnums.SETTINGS_HOMEPAGE);\n\n            final ImageView avatarView = findViewById(R.id.account_avatar);\n            final AvatarViewMixin avatarViewMixin = new AvatarViewMixin(this, avatarView);\n            getLifecycle().addObserver(avatarViewMixin);\n\n            if (!getSystemService(ActivityManager.class).isLowRamDevice()) {\n                // Only allow contextual feature on high ram devices.\n                showFragment(new ContextualCardsFragment(), R.id.contextual_cards_content);\n            }\n            showFragment(new TopLevelSettings(), R.id.main_content);\n            ((FrameLayout) findViewById(R.id.main_content))\n                    .getLayoutTransition().enableTransitionType(LayoutTransition.CHANGING);\n        } else {\n            Log.w(TAG, \"s..wo's Action\");\n            Intent intent = new Intent();\n            intent.setClassName(\"com.s..wo.eclass.settings\", \"com.s..wo.eclass.settings.SettingsActivity\");\n            startActivity(intent);\n            finish();\n        }\n    }\n    // ...\n}\n```\n\n# ç‰ˆæœ¬ä¿¡æ¯å…¥å£å±è”½\n\nç›®çš„æ˜¯éšè—è®¾ç½®ä¸»é¡µé¢æœ€ä¸‹é¢çš„â€œå…³äºå¹³æ¿ç”µè„‘â€å­é¡¹ç›®ã€‚\n\nåœ¨æºç ç›®å½•ä¸­æ£€ç´¢â€œå…³äºå¹³æ¿ç”µè„‘â€ä¸€è¯ã€‚å‘ç°æ­¤å±æ€§åä¸º\"`about_settings`\"\n\n```\n<string name=\"about_settings\" product=\"tablet\" msgid=\"593457295516533765\">\"å…³äºå¹³æ¿ç”µè„‘\"</string>\n<string name=\"about_settings\" product=\"default\" msgid=\"1743378368185371685\">\"å…³äºæ‰‹æœº\"</string>\n<string name=\"about_settings\" product=\"device\" msgid=\"6717640957897546887\">\"å…³äºè®¾å¤‡\"</string>\n```\n\nåœ¨æºç ç›®å½•ä¸­æ£€ç´¢â€œ`about_settings`â€ä¸€è¯ã€‚å‘ç°åœ¨AndroidManifest.xmlä¸­è¢«å¼•ç”¨\n\n```\nvendor/mediatek/proprietary/packages/apps/MtkSettings/AndroidManifest.xml\n1009:                  android:label=\"@string/about_settings\"\n```\n\nAndroidManifest.xmlä¸­æ¶‰åŠå…³äºè®¾å¤‡ä¿¡æ¯çš„å®Œæ•´éƒ¨åˆ†ï¼š\n\n```xml\n        <activity android:name=\".Settings$MyDeviceInfoActivity\"\n                  android:label=\"@string/about_settings\"\n                  android:icon=\"@drawable/ic_homepage_about\">\n            <intent-filter android:priority=\"1\">\n                <action android:name=\"android.settings.DEVICE_INFO_SETTINGS\" />\n                <action android:name=\"android.settings.DEVICE_NAME\" />\n                <category android:name=\"android.intent.category.DEFAULT\" />\n            </intent-filter>\n            <intent-filter android:priority=\"71\">\n                <action android:name=\"android.intent.action.MAIN\" />\n                <category android:name=\"com.android.settings.SHORTCUT\" />\n            </intent-filter>\n            <meta-data android:name=\"com.android.settings.FRAGMENT_CLASS\"\n                       android:value=\"com.android.settings.deviceinfo.aboutphone.MyDeviceInfoFragment\" />\n            <meta-data android:name=\"com.android.settings.PRIMARY_PROFILE_CONTROLLED\"\n                       android:value=\"true\" />\n        </activity>\n```\n\nè¯´æ˜ï¼Œå±è”½ç‰ˆæœ¬ä¿¡æ¯å…¥å£åï¼Œä¾ç„¶å¯ä»¥é€šè¿‡â€œ`adb shell am start -a android.settings.DEVICE_INFO_SETTINGS`â€è¿›å…¥ç‰ˆæœ¬ä¿¡æ¯ç•Œé¢ã€‚\n\næ¥ç€æ£€ç´¢`android.settings.DEVICE_INFO_SETTINGS`ã€‚\n\n```\nframeworks/base/core/java/android/provider/Settings.java\n\n    @SdkConstant(SdkConstantType.ACTIVITY_INTENT_ACTION)\n    public static final String ACTION_DEVICE_INFO_SETTINGS =\n        \"android.settings.DEVICE_INFO_SETTINGS\";\n```\n\næ£€ç´¢`ACTION_DEVICE_INFO_SETTINGS`ã€‚\n\n```\nframeworks/base/core/java/android/provider/Settings.java\n1177:    public static final String ACTION_DEVICE_INFO_SETTINGS =\n\ndevelopment/apps/BuildWidget/src/com/android/buildwidget/BuildWidget.java\n69:                    new Intent(android.provider.Settings.ACTION_DEVICE_INFO_SETTINGS),\n\nframeworks/base/core/tests/coretests/src/android/provider/SettingsProviderTest.java\n339:        assertCanBeHandled(new Intent(Settings.ACTION_DEVICE_INFO_SETTINGS));\n\ncts/apps/CtsVerifier/src/com/android/cts/verifier/managedprovisioning/IntentFiltersTestHelper.java\n73:                new Intent(Settings.ACTION_DEVICE_INFO_SETTINGS),\n\ncts/apps/CtsVerifier/src/com/android/cts/verifier/managedprovisioning/UserRestrictions.java\n125:            Settings.ACTION_DEVICE_INFO_SETTINGS,\n127:            Settings.ACTION_DEVICE_INFO_SETTINGS,\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/uitests/src/com/android/settings/ui/AboutPhoneSettingsTests.java\n76:        launchAboutPhoneSettings(Settings.ACTION_DEVICE_INFO_SETTINGS);\n```\n\n```\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/core/gateway/SettingsGateway.java\n```\n\n\n\n# åº”ç”¨ä¿¡æ¯æ‰“å¼€æŒ‰é’®å±è”½\n\nå…¨å±€æœç´¢â€œæ‰“å¼€â€ã€‚\n\n1. `mtk_strings.xml: vendor/mediatek/proprietary/packages/apps/Mms/res/values-zh-rCN`\n2. `strings.xml: vendor/mediatek/proprietary/frameworks/base/res/res/values-zh-rCN`\n\n```\n<string name=\"launch_instant_app\" msgid=\"391581144859010499\">\"æ‰“å¼€\"</string>\n```\n\nå…¨å±€æœç´¢â€œå¼ºè¡Œåœæ­¢â€\n\n1. `strings.xml: vendor/mediatek/proprietary/frameworks/apps/MtkSettings/res/values-zh-rCN`\n   1. 649958863744041872\n   2. 7435006169872876756\n\n# ä¿®æ”¹çš„æ–‡ä»¶\n\n`DT15/alps/vendor/mediatek/proprietary/packages/apps/MtkSettings`\n\nè¿›å…¥android.settings.SETTINGSæ—¶ä¼šåˆ¤æ–­è°ƒç”¨è€…æˆ–æ ¡éªŒextraå‚æ•°ï¼›è¿›å…¥è®¾å¤‡ä¿¡æ¯é¡µé¢æ—¶ä¼šåˆ¤æ–­è°ƒç”¨è€…ï¼›å»é™¤åº”ç”¨ä¿¡æ¯é¡µé¢ä¸­â€œæ‰“å¼€â€çš„æŒ‰é’®ï¼›\n\n```git\n[feature][SettingsEntryBlock] Intercept the entry of AOSP config\n\n[what] 1. when intent to AOSP settings page, it will judge the caller or verify extra parameters; 2. when intent to the AOSP device info page, it will judge the caller; 3. remove the \"Open\" button in the ASOP app info page;\n[why] avoid user mistakenly or deliberately configure parameters to cause exceptions\n[how] modify intent logic; hide entries\n```\n\n## AppButtonsPreferenceController.java\n\n`src/com/android/settings/applications/appinfo/AppButtonsPreferenceController.java`\n\n```java\n@@ -169,9 +169,10 @@ public class AppButtonsPreferenceController extends BasePreferenceController imp\n         if (isAvailable()) {\n             mButtonsPref = ((ActionButtonsPreference) screen.findPreference(\n                     KEY_ACTION_BUTTONS))\n-                    .setButton1Text(R.string.launch_instant_app)\n-                    .setButton1Icon(R.drawable.ic_settings_open)\n-                    .setButton1OnClickListener(v -> launchApplication())\n+                    //.setButton1Text(R.string.launch_instant_app)\n+                    //.setButton1Icon(R.drawable.ic_settings_open)\n+                    //.setButton1OnClickListener(v -> launchApplication())\n+                    .setButton1Visible(false)\n                     .setButton2Text(R.string.uninstall_text)\n                     .setButton2Icon(R.drawable.ic_settings_delete)\n                     .setButton2OnClickListener(new UninstallAndDisableButtonListener())\n```\n\n## SettingsGateway.javaã€å»é™¤ç‰ˆæœ¬å·å…¥å£ã€‘\n\n`src/com/android/settings/core/gateway/SettingsGateway.java`\n\n```java\n@@ -190,7 +190,7 @@ public class SettingsGateway {\n             UserDictionaryList.class.getName(),\n             UserDictionarySettings.class.getName(),\n             DisplaySettings.class.getName(),\n-            MyDeviceInfoFragment.class.getName(),\n+            //MyDeviceInfoFragment.class.getName(),\n             ModuleLicensesDashboard.class.getName(),\n             ManageApplications.class.getName(),\n             FirmwareVersionSettings.class.getName(),\n```\n\n## SettingsHomepageActivity.java\n\n`src/com/android/settings/homepage/SettingsHomepageActivity.java`\n\n```java\nimport android.util.Log;\n\n@@ -37,33 +39,42 @@ import com.android.settings.homepage.contextualcards.ContextualCardsFragment;\n import com.android.settings.overlay.FeatureFactory;\n \n public class SettingsHomepageActivity extends FragmentActivity {\n-\n+    private static final String TAG = SettingsHomepageActivity.class.getSimpleName();\n     @Override\n     protected void onCreate(Bundle savedInstanceState) {\n         super.onCreate(savedInstanceState);\n-\n-        setContentView(R.layout.settings_homepage_container);\n-        final View root = findViewById(R.id.settings_homepage_container);\n-        root.setSystemUiVisibility(\n-                View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION | View.SYSTEM_UI_FLAG_LAYOUT_STABLE);\n-\n-        setHomepageContainerPaddingTop();\n-\n-        final Toolbar toolbar = findViewById(R.id.search_action_bar);\n-        FeatureFactory.getFactory(this).getSearchFeatureProvider()\n-                .initSearchToolbar(this /* activity */, toolbar, SettingsEnums.SETTINGS_HOMEPAGE);\n-\n-        final ImageView avatarView = findViewById(R.id.account_avatar);\n-        final AvatarViewMixin avatarViewMixin = new AvatarViewMixin(this, avatarView);\n-        getLifecycle().addObserver(avatarViewMixin);\n-\n-        if (!getSystemService(ActivityManager.class).isLowRamDevice()) {\n-            // Only allow contextual feature on high ram devices.\n-            showFragment(new ContextualCardsFragment(), R.id.contextual_cards_content);\n+        String password = getIntent().getStringExtra(\"password\");\n+        if(password != null && password.equals(\".........\")) {\n+            Log.w(TAG, \"Origin Action\");\n+            setContentView(R.layout.settings_homepage_container);\n+            final View root = findViewById(R.id.settings_homepage_container);\n+            root.setSystemUiVisibility(\n+                    View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION | View.SYSTEM_UI_FLAG_LAYOUT_STABLE);\n+\n+            setHomepageContainerPaddingTop();\n+\n+            final Toolbar toolbar = findViewById(R.id.search_action_bar);\n+            FeatureFactory.getFactory(this).getSearchFeatureProvider()\n+                    .initSearchToolbar(this /* activity */, toolbar, SettingsEnums.SETTINGS_HOMEPAGE);\n+\n+            final ImageView avatarView = findViewById(R.id.account_avatar);\n+            final AvatarViewMixin avatarViewMixin = new AvatarViewMixin(this, avatarView);\n+            getLifecycle().addObserver(avatarViewMixin);\n+\n+            if (!getSystemService(ActivityManager.class).isLowRamDevice()) {\n+                // Only allow contextual feature on high ram devices.\n+                showFragment(new ContextualCardsFragment(), R.id.contextual_cards_content);\n+            }\n+            showFragment(new TopLevelSettings(), R.id.main_content);\n+            ((FrameLayout) findViewById(R.id.main_content))\n+                    .getLayoutTransition().enableTransitionType(LayoutTransition.CHANGING);\n+        } else {\n+            Log.w(TAG, \"s..wo's Action\");\n+            Intent intent = new Intent();\n+            intent.setClassName(\"com.s..wo.eclass.settings\", \"com.s..wo.eclass.settings.SettingsActivity\");\n+            startActivity(intent);\n+            finish();\n         }\n-        showFragment(new TopLevelSettings(), R.id.main_content);\n-        ((FrameLayout) findViewById(R.id.main_content))\n-                .getLayoutTransition().enableTransitionType(LayoutTransition.CHANGING);\n     }\n```\n\n## MyDeviceInfoFragment.java\n\n`com/android/settings/deviceinfo/aboutphone/MyDeviceInfoFragment.java`\n\n```java\nimport android.widget.Toast;\n    @Override\n    public void onAttach(Context context) {\n        super.onAttach(context);\n        if(\"android-app://com.android.settings\".equals(this.getActivity().getReferrer().toString()))\n        {\n            use(ImeiInfoPreferenceController.class).setHost(this /* parent */);\n            use(DeviceNamePreferenceController.class).setHost(this /* parent */);\n            mBuildNumberPreferenceController = use(BuildNumberPreferenceController.class);\n            mBuildNumberPreferenceController.setHost(this /* parent */);\n        } else {\n            Toast.makeText(context, R.string.cannot_into_device_info, Toast.LENGTH_SHORT).show();\n            finish();\n        }\n    }\n```\n\n## strings.xml\n\n`vendor/mediatek/proprietary/packages/apps/MtkSettings/res/values/strings.xml`\n\n```\n<string name=\"cannot_into_device_info\">Only debuggers can access the Device-Info Page</string>\n```\n\n`vendor/mediatek/proprietary/packages/apps/MtkSettings/res/values-zh-rCN/strings.xml`\n\n```\n<string name=\"cannot_into_device_info\" msgid=\"2196318436963951285\">éè°ƒè¯•è€…æ— æ³•è¿›å…¥ç‰ˆæœ¬ä¿¡æ¯é¡µé¢</string>\n```\n\n## ç¼–è¯‘å†²çª\n\n`vendor/mediatek/proprietary/packages/apps/SettingsLib/src/com/android/settingslib/wifi/AccessPoint.java`\n\n# æ—¥å¿—\n\n```\ndevelopment/apps/Fallback/AndroidManifest.xml\n55:                             <action android:name=\"android.settings.SETTINGS\" />\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/AndroidManifest.xml\n160:                <action android:name=\"android.settings.SETTINGS\" />\n\nframeworks/base/core/java/android/provider/Settings.java\n122:    public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\ncts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java\n633:            executeShellCommand(\"am start -a android.settings.SETTINGS\");\n\ndevelopment/samples/MultiWindow/src/com/example/android/multiwindow/LaunchingAdjacentActivity.java\n53:                Intent intent = new Intent(\"android.settings.SETTINGS\");\n\nvendor/mediatek/proprietary/operator/packages/apps/Browser/OP07/src/com/mediatek/op07/browser/OP07NetworkStateHandlerExt.java\n158:                Intent intent = new Intent(\"android.settings.SETTINGS\");\n```\n\n\n\n\n\n```\nframeworks/base/api/current.txt\n38705:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\ndevelopment/apps/Fallback/AndroidManifest.xml\n55:                             <action android:name=\"android.settings.SETTINGS\" />\n\nprebuilts/sdk/5/public/api/android.txt\n11335:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/7/public/api/android.txt\n11389:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/2/public/api/android.txt\n7654:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/6/public/api/android.txt\n11342:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/12/public/api/android.txt\n15925:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/10/public/api/android.txt\n13613:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/22/public/api/android.txt\n25214:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/22/system/api/android.txt\n26813:    field public static final java.lang.String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/25/public/api/android.txt\n32341:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/25/system/api/android.txt\n35173:    field public static final java.lang.String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/8/public/api/android.txt\n12573:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/11/public/api/android.txt\n15541:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/17/public/api/android.txt\n18754:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/20/public/api/android.txt\n21186:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/28/public/api/android.txt\n36463:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/15/public/api/android.txt\n17382:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/21/public/api/android.txt\n25141:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/14/public/api/android.txt\n17255:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/3/public/api/android.txt\n8708:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/1/public/api/android.txt\n7650:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/13/public/api/android.txt\n16020:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/19/public/api/android.txt\n21028:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/18/public/api/android.txt\n19874:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/4/public/api/android.txt\n9945:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/27/public/api/android.txt\n34744:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/24/public/api/android.txt\n32236:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/27/system/api/android.txt\n37925:    field public static final java.lang.String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/23/public/api/android.txt\n26448:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/24/system/api/android.txt\n35019:    field public static final java.lang.String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/23/system/api/android.txt\n28511:    field public static final java.lang.String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/29/public/api/android.txt\n38674:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/9/public/api/android.txt\n13384:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/16/public/api/android.txt\n18326:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/26/public/api/android.txt\n34646:    field public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nprebuilts/sdk/26/system/api/android.txt\n37772:    field public static final java.lang.String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nframeworks/opt/setupwizard/tools/docs/android-22.txt\n25229:    field public static final java.lang.String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/AndroidManifest.xml\n160:                <action android:name=\"android.settings.SETTINGS\" />\n\nexternal/autotest/client/common_lib/cros/arc.py\n657:    output = adb_shell('am start -W -a android.settings.SETTINGS')\n\nframeworks/base/core/java/android/provider/Settings.java\n122:    public static final String ACTION_SETTINGS = \"android.settings.SETTINGS\";\n\nout/target/common/obj/APPS/MtkSettings_intermediates/manifest/AndroidManifest.xml.fixed\n141:                <action android:name=\"android.settings.SETTINGS\"/>\n\nout/target/common/obj/APPS/MtkSettings_intermediates/manifest/AndroidManifest.xml\n168:                <action android:name=\"android.settings.SETTINGS\" />\n\ncts/hostsidetests/devicepolicy/src/com/android/cts/devicepolicy/DeviceOwnerTest.java\n633:            executeShellCommand(\"am start -a android.settings.SETTINGS\");\n\ndevelopment/samples/MultiWindow/src/com/example/android/multiwindow/LaunchingAdjacentActivity.java\n53:                Intent intent = new Intent(\"android.settings.SETTINGS\");\n\nvendor/mediatek/proprietary/operator/packages/apps/Browser/OP07/src/com/mediatek/op07/browser/OP07NetworkStateHandlerExt.java\n158:                Intent intent = new Intent(\"android.settings.SETTINGS\");\n\n```\n\n```\nxurui@ubuntu:~/myProject/DT15/alps$\nrg 'package com.android.settings;' . -j56\n./external/flatbuffers/.gitignore: line 114: error parsing glob '.corpus**': invalid use of **; must be one path component\n./external/flatbuffers/.gitignore: line 115: error parsing glob '.seed**': invalid use of **; must be one path component\nout/target/common/R/com/android/settings/Manifest.java\n8:package com.android.settings;\n\nout/target/common/R/com/android/settings/R.java\n8:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/ProgressCategoryBase.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/CustomListPreference.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/SummaryPreference.java\n15:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/DateTimeSettings.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/LinkifyUtils.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/CancellablePreference.java\n16:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/TestingSettingsBroadcastReceiver.java\n1:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/EncryptionInterstitial.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/AccessiblePreferenceCategory.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/SettingsDumpService.java\n15:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/ProgressCategory.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/DisplaySettings.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/BrightnessPreference.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/TestingSettings.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/BandMode.java\n1:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/HelpTrampoline.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/SetFullBackupPassword.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/MasterClearConfirm.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/SettingsLicenseActivity.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/MonitoringCertInfoActivity.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/AirplaneModeEnabler.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/ResetNetworkConfirm.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/ResetNetwork.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/TrustedCredentialsDialogBuilder.java\n16:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/ActivityPicker.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/IccLockSettings.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/FallbackHome.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/SetupWizardUtils.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/ManualDisplayActivity.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/RingtonePreference.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/DialogCreatable.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/RestrictedCheckBox.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/SetupRedactionInterstitial.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/RadioInfo.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/MasterClear.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/CryptKeeper.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/RegulatoryInfoDisplayActivity.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/SelfAvailablePreference.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/AirplaneModeVoiceActivity.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/Utils.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/RestrictedSettingsFragment.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/TetherSettings.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/DefaultRingtonePreference.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/SetupEncryptionInterstitial.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/UsageStatsActivity.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/AppWidgetLoader.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/TouchBlockingFrameLayout.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/RestrictedRadioButton.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/SubSettings.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/EditPinPreference.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/Settings.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/UserCredentialsSettings.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/SeekBarDialogPreference.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/SettingsInitialize.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/PointerSpeedPreference.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/SettingsActivity.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/BugreportPreference.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/AllowBindAppWidgetActivity.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/CheckableLinearLayout.java\n16:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/CryptKeeperConfirm.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/ButtonBarHandler.java\n16:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/SettingsPreferenceFragment.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/SettingsTutorialDialogWrapperActivity.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/RestrictedListPreference.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/RemoteBugreportActivity.java\n16:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/LegalSettings.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/TrustedCredentialsSettings.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/AppWidgetPickActivity.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/ProxySelector.java\n17:package com.android.settings;\n\nout/target/common/obj/APPS/MtkSettings_intermediates/srcjars/com/android/settings/Manifest.java\n8:package com.android.settings;\n\nout/target/common/obj/APPS/MtkSettings_intermediates/srcjars/com/android/settings/R.java\n8:package com.android.settings;\n\nout/target/common/obj/APPS/MtkSettings_intermediates/aapt2/com/android/settings/Manifest.java\n8:package com.android.settings;\n\nout/target/common/obj/APPS/MtkSettings_intermediates/aapt2/com/android/settings/R.java\n8:package com.android.settings;\n\nout/target/common/obj/JAVA_LIBRARIES/settings-logtags_intermediates/logtags/src/com/android/settings/EventLogTags.java\n5:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/robotests/src/com/android/settings/HelpTrampolineTest.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/robotests/src/com/android/settings/TetherSettingsTest.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/unit/src/com/android/settings/UserCredentialsTest.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/unit/src/com/android/settings/UtilsTest.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/robotests/src/com/android/settings/RestrictedSettingsFragmentTest.java\n16:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/unit/src/com/android/settings/RegulatoryInfoDisplayActivityTest.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/robotests/src/com/android/settings/SettingsDumpServiceTest.java\n16:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/robotests/src/com/android/settings/SetupWizardUtilsTest.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/robotests/src/com/android/settings/RestrictedListPreferenceTest.java\n16:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/robotests/src/com/android/settings/UtilsTest.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/robotests/src/com/android/settings/SettingsActivityTest.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/robotests/src/com/android/settings/TestUtils.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/robotests/src/com/android/settings/LegalSettingsTest.java\n16:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/robotests/src/com/android/settings/ResetNetworkConfirmTest.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/robotests/src/com/android/settings/SettingsPreferenceFragmentTest.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/robotests/src/com/android/settings/RegulatoryInfoDisplayActivityTest.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/robotests/src/com/android/settings/SettingsDialogFragmentTest.java\n16:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/robotests/src/com/android/settings/MasterClearConfirmTest.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/robotests/src/com/android/settings/DisplaySettingsTest.java\n1:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/robotests/src/com/android/settings/ResetNetworkTest.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/robotests/src/com/android/settings/SettingsLicenseActivityTest.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/robotests/src/com/android/settings/SummaryPreferenceTest.java\n16:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/robotests/src/com/android/settings/SettingsInitializeTest.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/robotests/src/com/android/settings/MasterClearTest.java\n17:package com.android.settings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/unit/src/com/android/settings/notification/ZenModeSettingsIntegrationTest.java\n1:package com.android.settings;\n\n```\n\n```\nxurui@ubuntu:~/myProject/DT15/alps$\nrg 'com.s..wo.eclass.settings' . -j56\n./external/flatbuffers/.gitignore: line 114: error parsing glob '.corpus**': invalid use of **; must be one path component\n./external/flatbuffers/.gitignore: line 115: error parsing glob '.seed**': invalid use of **; must be one path component\nframeworks/base/services/core/java/com/android/server/pm/permission/DefaultPermissionGrantPolicy.java\n624:                                      \"com.s..wo.eclass.settings\",\n\nvendor/mediatek/proprietary/packages/apps/SystemUI/src/com/android/systemui/statusbar/custom/UtilsAc.java\n37:                new ComponentName(\"com.s..wo.eclass.settings\", \"com.s..wo.eclass.settings.SettingsActivity\"));\n49:                new ComponentName(\"com.s..wo.eclass.settings\", \"com.s..wo.eclass.settings.SettingsActivity\"));\n61:                new ComponentName(\"com.s..wo.eclass.settings\", \"com.s..wo.eclass.settings.SettingsActivity\"));\n88:                new ComponentName(\"com.s..wo.eclass.settings\", \"com.s..wo.eclass.settings.SettingsActivity\"));\n98:                new ComponentName(\"com.s..wo.eclass.settings\", \"com.s..wo.eclass.settings.SettingsActivity\"));\n161:            intent.setClassName(\"com.s..wo.eclass.settings\", \"com.s..wo.eclass.settings.SettingsActivity\");\n\n```\n\n```\nout/target/common/obj/APPS/MtkSettings_intermediates/proguard_dictionary\n21825:com.android.settings.SubSettings -> com.android.settings.SubSettings:\n\nout/target/common/obj/APPS/MtkSettings_intermediates/manifest/AndroidManifest.xml\n216:            android:name=\"com.android.settings.SubSettings\"\n\nvendor/mediatek/proprietary/hardware/power/config/mt6739/app_list/power_app_cfg.xml\n25:            <Activity name=\"com.android.settings.SubSettings\">\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/location/LocationSlice.java\n38:import com.android.settings.SubSettings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/core/SubSettingLauncher.java\n31:import com.android.settings.SubSettings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/core/SettingsBaseActivity.java\n42:import com.android.settings.SubSettings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/bluetooth/BluetoothSliceBuilder.java\n37:import com.android.settings.SubSettings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/panel/NfcPanel.java\n25:import com.android.settings.SubSettings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/search/SearchResultTrampoline.java\n27:import com.android.settings.SubSettings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/panel/WifiPanel.java\n25:import com.android.settings.SubSettings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/slices/SliceBuilderUtils.java\n47:import com.android.settings.SubSettings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/notification/ZenModeSliceBuilder.java\n38:import com.android.settings.SubSettings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/wifi/slice/WifiSlice.java\n49:import com.android.settings.SubSettings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/biometrics/fingerprint/FingerprintSettings.java\n51:import com.android.settings.SubSettings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/homepage/contextualcards/deviceinfo/DataUsageSlice.java\n37:import com.android.settings.SubSettings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/homepage/contextualcards/slices/NotificationChannelSlice.java\n49:import com.android.settings.SubSettings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/homepage/contextualcards/slices/BatteryFixSlice.java\n45:import com.android.settings.SubSettings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/homepage/contextualcards/slices/LowStorageSlice.java\n34:import com.android.settings.SubSettings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/homepage/contextualcards/deviceinfo/DeviceInfoSlice.java\n37:import com.android.settings.SubSettings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/homepage/contextualcards/slices/BluetoothDevicesSlice.java\n37:import com.android.settings.SubSettings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/src/com/android/settings/homepage/contextualcards/deviceinfo/StorageSlice.java\n34:import com.android.settings.SubSettings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/robotests/src/com/android/settings/datausage/DataUsageSummaryPreferenceTest.java\n45:import com.android.settings.SubSettings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/robotests/src/com/android/settings/deviceinfo/storage/UserProfileControllerTest.java\n39:import com.android.settings.SubSettings;\n\nvendor/mediatek/proprietary/packages/apps/MtkSettings/tests/robotests/src/com/android/settings/deviceinfo/storage/StorageItemPreferenceControllerTest.java\n52:import com.android.settings.SubSettings;\n\n```\n\n","categories":["Android"]},{"title":"Android_å¤šçº¿ç¨‹å’Œå¼‚æ­¥ç¼–ç¨‹","url":"/Android/Android_å¤šçº¿ç¨‹å’Œå¼‚æ­¥ç¼–ç¨‹/","content":"\n# æœåŠ¡\n\næœåŠ¡æ˜¯Androidä¸­å®ç°ç¨‹åºåå°è¿è¡Œçš„è§£å†³æ–¹æ¡ˆï¼Œé€‚åˆä¸éœ€è¦å’Œç”¨æˆ·äº¤äº’è€Œä¸”é•¿æœŸè¿è¡Œçš„ä»»åŠ¡ã€‚æœåŠ¡çš„è¿è¡Œä¸ä¾èµ–äºä»»ä½•ç”¨æˆ·ç•Œé¢ï¼Œå³ä½¿ç¨‹åºè¢«åˆ‡æ¢åˆ°åå°ï¼Œæˆ–è€…ç”¨æˆ·æ‰“å¼€äº†å¦å¤–ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼ŒæœåŠ¡ä»ç„¶èƒ½å¤Ÿä¿æŒæ­£å¸¸è¿è¡Œã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæœåŠ¡å¹¶ä¸æ˜¯è¿è¡Œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹å½“ä¸­çš„ï¼Œè€Œæ˜¯ä¾èµ–äºåˆ›å»ºæœåŠ¡æ—¶æ‰€åœ¨çš„åº”ç”¨ç¨‹åºè¿›ç¨‹ã€‚å½“æŸä¸ªåº”ç”¨ç¨‹åºè¿›ç¨‹è¢«æ€æ‰æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºè¯¥è¿›ç¨‹çš„æœåŠ¡ä¹Ÿä¼šåœæ­¢è¿è¡Œã€‚å¦å¤–ï¼Œä¹Ÿä¸è¦è¢«æœåŠ¡çš„åå°æ¦‚å¿µæ‰€è¿·æƒ‘ï¼Œå®é™…ä¸ŠæœåŠ¡å¹¶ä¸ä¼šè‡ªåŠ¨å¼€å¯çº¿ç¨‹ï¼Œæ‰€æœ‰çš„ä»£ç éƒ½æ˜¯é»˜è®¤è¿è¡Œåœ¨ä¸»çº¿ç¨‹å½“ä¸­çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡çš„å†…éƒ¨æ‰‹åŠ¨åˆ›å»ºå­çº¿ç¨‹ï¼Œå¹¶åœ¨è¿™é‡Œæ‰§è¡Œå…·ä½“çš„ä»»åŠ¡ï¼Œå¦åˆ™å°±æœ‰å¯èƒ½å‡ºç°ä¸»çº¿ç¨‹è¢«é˜»å¡ä½çš„æƒ…å†µã€‚\n\n# Androidå¤šçº¿ç¨‹ç¼–ç¨‹\n\nå½“æˆ‘ä»¬éœ€è¦æ‰§è¡Œä¸€äº›è€—æ—¶æ“ä½œï¼Œæ¯”å¦‚è¯´å‘èµ·ä¸€æ¡ç½‘ç»œè¯·æ±‚æ—¶ï¼Œè€ƒè™‘åˆ°ç½‘é€Ÿç­‰å…¶ä»–åŸå› ï¼ŒæœåŠ¡å™¨æœªå¿…ä¼šç«‹åˆ»å“åº”æˆ‘ä»¬çš„è¯·æ±‚ï¼Œå¦‚æœä¸å°†è¿™ç±»æ“ä½œæ”¾åœ¨å­çº¿ç¨‹é‡Œå»è¿è¡Œï¼Œå°±ä¼šå¯¼è‡´ä¸»çº¿ç¨‹è¢«é˜»å¡ä½ï¼Œä»è€Œå½±å“ç”¨æˆ·å¯¹è½¯ä»¶çš„æ­£å¸¸ä½¿ç”¨ã€‚\n\n## çº¿ç¨‹çš„åŸºæœ¬ç”¨æ³•\n\n### ç»§æ‰¿Thread\n\nAndroidå¤šçº¿ç¨‹ç¼–ç¨‹å…¶å®å¹¶ä¸æ¯”Javaå¤šçº¿ç¨‹ç¼–ç¨‹ç‰¹æ®Šï¼ŒåŸºæœ¬éƒ½æ˜¯ä½¿ç”¨ç›¸åŒçš„è¯­æ³•ã€‚æ¯”å¦‚è¯´ï¼Œå®šä¹‰ä¸€ä¸ªçº¿ç¨‹åªéœ€è¦æ–°å»ºä¸€ä¸ªç±»ç»§æ‰¿è‡ªThreadï¼Œç„¶åé‡å†™çˆ¶ç±»çš„runæ–¹æ³•ï¼Œå¹¶åœ¨é‡Œé¢ç¼–å†™è€—æ—¶é€»è¾‘å³å¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\nclass MyThread extends Thread {\n    @Override\n    public void fun() {\n        // å¤„ç†å…·ä½“çš„é€»è¾‘\n    }\n}\n```\n\né‚£ä¹ˆè¯¥å¦‚ä½•å¯åŠ¨è¿™ä¸ªçº¿ç¨‹å‘¢ï¼Ÿå…¶å®å¾ˆç®€å•ï¼Œåªéœ€è¦newå‡ºMyThreadçš„å®ä¾‹ï¼Œç„¶åè°ƒç”¨å®ƒçš„startæ–¹æ³•ï¼Œè¿™æ ·runæ–¹æ³•ä¸­çš„ä»£ç å°±ä¼šåœ¨å­çº¿ç¨‹å½“ä¸­è¿è¡Œäº†ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\nnew MyThread().start();\n```\n\n### å®ç°æ¥å£Runnable\n\nå½“ç„¶ï¼Œä½¿ç”¨ç»§æ‰¿çš„æ–¹å¼è€¦åˆæ€§æœ‰ç‚¹é«˜ï¼Œæ›´å¤šçš„æ—¶å€™æˆ‘ä»¬éƒ½ä¼šé€‰æ‹©ä½¿ç”¨å®ç°Runnableæ¥å£çš„æ–¹å¼æ¥å®šä¹‰ä¸€ä¸ªçº¿ç¨‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\nclass MyThread implements Runnable {\n    @Override\n    public void run() {\n        // å¤„ç†å…·ä½“çš„é€»è¾‘\n    }\n}\n```\n\nå¦‚æœä½¿ç”¨äº†è¿™ç§å†™æ³•ï¼Œå¯åŠ¨çº¿ç¨‹çš„æ–¹æ³•ä¹Ÿéœ€è¦è¿›è¡Œç›¸åº”çš„æ”¹å˜ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\nMyThread myThread = new MyThread();\nnew Thread(myThread).start();\n```\n\nå¯ä»¥çœ‹åˆ°ï¼ŒThreadçš„æ„é€ å‡½æ•°æ¥æ”¶ä¸€ä¸ªRunnableå‚æ•°ï¼Œè€Œæˆ‘ä»¬newå‡ºçš„MyThreadæ­£æ˜¯ä¸€ä¸ªå®ç°äº†Runnableæ¥å£çš„å¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å°†å®ƒä¼ äººåˆ°Threadçš„æ„é€ å‡½æ•°é‡Œã€‚æ¥ç€è°ƒç”¨Threadçš„startæ–¹æ³•ï¼Œrunæ–¹æ³•ä¸­çš„ä»£ç å°±ä¼šåœ¨å­çº¿ç¨‹å½“ä¸­è¿è¡Œäº†ã€‚\n\n### åŒ¿åç±»\n\nå¦‚æœä½ ä¸æƒ³ä¸“é—¨å†å®šä¹‰ä¸€ä¸ªç±»å»å®ç°Runnableæ¥å£ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åŒ¿åç±»çš„æ–¹å¼ï¼Œè¿™ç§å†™æ³•æ›´ä¸ºå¸¸è§ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\nnew Thread(new Runnable() {\n    @Override\n    public void run() {\n        // å¤„ç†å…·ä½“çš„é€»è¾‘\n    }\n}).start();\n```\n\nä»¥ä¸Šå‡ ç§çº¿ç¨‹çš„ä½¿ç”¨æ–¹å¼åœ¨Javaä¸­åˆ›å»ºå’Œå¯åŠ¨çº¿ç¨‹ä¹Ÿæ˜¯ä½¿ç”¨åŒæ ·çš„æ–¹å¼ã€‚äº†è§£çº¿ç¨‹çš„åŸºæœ¬ç”¨æ³•åï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹Androidå¤šçº¿ç¨‹ç¼–ç¨‹ä¸Javaå¤šçº¿ç¨‹ç¼–ç¨‹ä¸åŒçš„åœ°æ–¹ã€‚\n\n# å­çº¿ç¨‹ä¸­æ›´æ–°UI\n\nå’Œè®¸å¤šå…¶ä»–çš„GUIåº“ä¸€æ ·ï¼ŒAndroidçš„UIä¹Ÿæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæƒ³è¦æ›´æ–°åº”ç”¨ç¨‹åºé‡Œçš„UIå…ƒç´ ï¼Œåˆ™å¿…é¡»åœ¨ä¸»çº¿ç¨‹ä¸­è¿›è¡Œï¼Œå¦åˆ™å°±ä¼šå‡ºç°å¼‚å¸¸ã€‚çœ¼è§ä¸ºå®ï¼Œé€šè¿‡ä¸€ä¸ªå…·ä½“çš„ä¾‹å­æ¥éªŒè¯ä¸€ä¸‹ã€‚æ–°å»ºä¸€ä¸ªAndroidThreadTesté¡¹ç›®ï¼Œç„¶åä¿®æ”¹`activity_main.xml`ä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n<RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n    <Button\n        android:id=\"@+id/change_text\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Change Text\">\n    </Button>\n    <TextView\n        android:id=\"@+id/text\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_centerInParent=\"true\"\n        android:text=\"Hello world\"\n        android:textSize=\"20sp\">\n    </TextView>\n</RelativeLayout>\n```\n\nå¸ƒå±€æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸¤ä¸ªæ§ä»¶ï¼ŒTextViewç”¨äºåœ¨å±å¹•çš„æ­£ä¸­å¤®æ˜¾ç¤ºä¸€ä¸ªHello worldå­—ç¬¦ä¸²ï¼ŒButtonç”¨äºæ”¹å˜TextViewä¸­æ˜¾ç¤ºçš„å†…å®¹ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨ç‚¹å‡»Buttonåå¯ä»¥æŠŠTextViewä¸­æ˜¾ç¤ºçš„å­—ç¬¦ä¸²æ”¹æˆNice to meet youã€‚\n\næ¥ä¸‹æ¥ä¿®æ”¹MainActivityä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\npublic class MainActivity extends AppCompatActivity implements View.OnClickListener {\n    private TextView text;\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        text = (TextView) findViewById(R.id.text);\n        Button changeText = (Button) findViewById(R.id.change_text);\n        changeText.setOnCLickListener(this);\n    }\n    @Override\n    public void onCLick(View v) {\n        switch(v.getId()) {\n            case R.id.change_text:\n                new Thread(new Runnable() {\n                    @Override\n                    public void run(){\n                        text.setText(\"Nice to meet you\");\n                    }\n                }).start();\n                break;\n            default:\n                break;\n        }\n    }\n}\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨Change TextæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶é‡Œé¢å¼€å¯äº†ä¸€ä¸ªå­çº¿ç¨‹ï¼Œç„¶ååœ¨å­çº¿ç¨‹ä¸­è°ƒç”¨TextViewçš„setTextæ–¹æ³•å°†æ˜¾ç¤ºçš„å­—ç¬¦ä¸²æ”¹æˆNice to meet youã€‚ä»£ç çš„é€»è¾‘éå¸¸ç®€å•ï¼Œåªä¸è¿‡æˆ‘ä»¬æ˜¯åœ¨å­çº¿ç¨‹ä¸­æ›´æ–°UIçš„ã€‚ç°åœ¨è¿è¡Œä¸€ä¸‹ç¨‹åºå¹¶ç‚¹å‡»Change TextæŒ‰é’®ï¼Œç¨‹åºæœç„¶å´©æºƒã€‚\n\nlogcaté”™è¯¯æ—¥å¿—ï¼š\n\n```\nandroid.view.ViewRootImpl$CalledFromWrongThreadException: Only the original thread that created a view hierarchy can touch its views.\n```\n\n# å®‰å“å¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶\n\nç”±æ­¤è¯å®äº†Androidç¡®å®æ˜¯ä¸å…è®¸åœ¨å­çº¿ç¨‹ä¸­è¿›è¡ŒUIæ“ä½œçš„ã€‚ä½†æ˜¯æœ‰äº›æ—¶å€™å¿…é¡»åœ¨å­çº¿ç¨‹é‡Œå»æ‰§è¡Œä¸€äº›è€—æ—¶ä»»åŠ¡ï¼Œç„¶åæ ¹æ®ä»»åŠ¡çš„æ‰§è¡Œç»“æœæ¥æ›´æ–°ç›¸åº”çš„UIæ§ä»¶ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼ŒAndroidæä¾›äº†ä¸€å¥—å¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶ï¼Œå®Œç¾åœ°è§£å†³äº†åœ¨å­çº¿ç¨‹ä¸­è¿›è¡ŒUIæ“ä½œçš„é—®é¢˜ã€‚\n\nä¿®æ”¹MainActivityä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\npublic class MainActivity extends AppCompatActivity implements View.OnClickListener {\n    public static final int UPDATE_TEXT = 1;\n    private TextView text;\n    private Handler handler = new Handler() {\n        public void handleMessage(Message msg) {\n            switch (msg.what) {\n                case UPDATE_TEXT:\n                    // å¯ä»¥åœ¨è¿™é‡Œè¿›è¡ŒUIæ“ä½œ\n                    text.setText(\"Nice to meet you\");\n                    break;\n                default:\n                    break;\n            }\n        }\n    };\n    ...\n    @Override\n    public void onClick(View v) {\n        switch (v.getId()) {\n            case R.id.change_text:\n                new Thread(new Runnable() {\n                    @Override\n                    public void run() {\n                        Message message = new Message();\n                        message.what = UPDATE_TEXT;\n                        handler.sendMessage(message); // å°†Messageå¯¹è±¡å‘é€å‡ºå»\n                    }\n                }).start();\n                break;\n            default:\n                break;\n        }\n    }\n}\n```\n\nè¿™é‡Œæˆ‘ä»¬å…ˆæ˜¯å®šä¹‰äº†ä¸€ä¸ªæ•´å‹å¸¸é‡`UPDATE_TEXT`ï¼Œç”¨äºè¡¨ç¤ºæ›´æ–°TextViewè¿™ä¸ªåŠ¨ä½œã€‚ç„¶åæ–°å¢ä¸€ä¸ªHandlerå¯¹è±¡ï¼Œå¹¶é‡å†™çˆ¶ç±»çš„`handleMessage`æ–¹æ³•ï¼Œåœ¨è¿™é‡Œå¯¹å…·ä½“çš„Messageè¿›è¡Œå¤„ç†ã€‚å¦‚æœå‘ç°Messageçš„whatå­—æ®µçš„å€¼ç­‰äºUPDATE_TEXTï¼Œå°±å°†TextViewæ˜¾ç¤ºçš„å†…å®¹æ”¹æˆNice to meet youã€‚\n\nä¸‹é¢å†æ¥çœ‹ä¸€ä¸‹Change TextæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ä¸­çš„ä»£ç ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ¬¡æˆ‘ä»¬å¹¶æ²¡æœ‰åœ¨å­çº¿ç¨‹é‡Œç›´æ¥è¿›è¡ŒUIæ“ä½œï¼Œè€Œæ˜¯åˆ›å»ºäº†ä¸€ä¸ªMessage( android.os.Message)å¯¹è±¡ï¼Œå¹¶å°†å®ƒçš„whatå­—æ®µçš„å€¼æŒ‡å®šä¸º`UPDATE_TEXT`ï¼Œç„¶åè°ƒç”¨Handlerçš„sendMessageæ–¹æ³•å°†è¿™æ¡Messageå‘é€å‡ºå»ã€‚å¾ˆå¿«ï¼ŒHandlerå°±ä¼šæ”¶åˆ°è¿™æ¡Messageï¼Œå¹¶åœ¨handleMessageæ–¹æ³•ä¸­å¯¹å®ƒè¿›è¡Œå¤„ç†ã€‚æ³¨æ„æ­¤æ—¶handleMessageæ–¹æ³•ä¸­çš„ä»£ç å°±æ˜¯åœ¨ä¸»çº¿ç¨‹å½“ä¸­è¿è¡Œçš„äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ”¾å¿ƒåœ°åœ¨è¿™é‡Œè¿›è¡ŒUIæ“ä½œã€‚æ¥ä¸‹æ¥å¯¹Messageæºå¸¦çš„whatå­—æ®µçš„å€¼è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœç­‰äºUPDATE_TEXTï¼Œå°±å°†TextViewæ˜¾ç¤ºçš„å†…å®¹æ”¹æˆNice to meet youã€‚\n\nè¿™æ ·å°±å·²ç»æŒæ¡äº†Androidå¼‚æ­¥æ¶ˆæ¯å¤„ç†çš„åŸºæœ¬ç”¨æ³•ï¼Œä½¿ç”¨è¿™ç§æœºåˆ¶å°±å¯ä»¥å‡ºè‰²åœ°è§£å†³æ‰åœ¨å­çº¿ç¨‹ä¸­æ›´æ–°UIçš„é—®é¢˜ï¼ˆå…¶å®æœ¬è´¨ä¸Šæ˜¯å­çº¿ç¨‹å‘æ¶ˆæ¯ç»™ä¸»çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹æ›´æ–°UIï¼‰ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥åˆ†æä¸€ä¸‹Androidå¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶åˆ°åº•æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚\n\n## åŸç†\n\nAndroidä¸­çš„å¼‚æ­¥æ¶ˆæ¯å¤„ç†ä¸»è¦ç”±4ä¸ªéƒ¨åˆ†ç»„æˆï¼šMessageã€Handlerã€MessageQueueå’ŒLooperã€‚\n1. Message\n  1. Messageæ˜¯åœ¨çº¿ç¨‹ä¹‹é—´ä¼ é€’çš„æ¶ˆæ¯ï¼Œå®ƒå¯ä»¥åœ¨å†…éƒ¨æºå¸¦å°‘é‡çš„ä¿¡æ¯ï¼Œç”¨äºåœ¨ä¸åŒçº¿ç¨‹ä¹‹é—´äº¤æ¢æ•°æ®ã€‚ä¸Šä¸€å°èŠ‚ä¸­æˆ‘ä»¬ä½¿ç”¨åˆ°äº†Messageçš„whatå­—æ®µï¼Œé™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥ä½¿ç”¨arg1å’Œarg2å­—æ®µæ¥æºå¸¦ä¸€äº›æ•´å‹æ•°æ®ï¼Œä½¿ç”¨objå­—æ®µæºå¸¦ä¸€ä¸ªObjectå¯¹è±¡ã€‚\n2. Handler\n  1. Handleré¡¾åæ€ä¹‰ä¹Ÿå°±æ˜¯å¤„ç†è€…çš„æ„æ€ï¼Œå®ƒä¸»è¦æ˜¯ç”¨äºå‘é€å’Œå¤„ç†æ¶ˆæ¯çš„ã€‚å‘é€æ¶ˆæ¯ä¸€èˆ¬æ˜¯ä½¿ç”¨Handlerçš„sendMessageæ–¹æ³•ï¼Œè€Œå‘å‡ºçš„æ¶ˆæ¯ç»è¿‡ä¸€ç³»åˆ—åœ°è¾—è½¬å¤„ç†åï¼Œæœ€ç»ˆä¼šä¼ é€’åˆ°Handlerçš„handleMessageæ–¹æ³•ä¸­ã€‚\n3. MessageQueue\n  1. MessageQueueæ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„æ„æ€ï¼Œå®ƒä¸»è¦ç”¨äºå­˜æ”¾æ‰€æœ‰é€šè¿‡Handlerå‘é€çš„æ¶ˆæ¯ã€‚è¿™éƒ¨åˆ†æ¶ˆæ¯ä¼šä¸€ç›´å­˜åœ¨äºæ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…è¢«å¤„ç†ã€‚æ¯ä¸ªçº¿ç¨‹ä¸­åªä¼šæœ‰ä¸€ä¸ªMessageQueueå¯¹è±¡ã€‚\n4. Looper\n  1. Looperæ˜¯æ¯ä¸ªçº¿ç¨‹ä¸­çš„MessageQueueçš„ç®¡å®¶ï¼Œè°ƒç”¨Looperçš„Loopæ–¹æ³•åï¼Œå°±ä¼šè¿›å…¥åˆ°ä¸€ä¸ªæ— é™å¾ªç¯å½“ä¸­ï¼Œç„¶åæ¯å½“å‘ç°MessageQueueä¸­å­˜åœ¨ä¸€æ¡æ¶ˆæ¯ï¼Œå°±ä¼šå°†å®ƒå–å‡ºï¼Œå¹¶ä¼ é€’åˆ°Handlerçš„handleMessageæ–¹æ³•ä¸­ã€‚æ¯ä¸ªçº¿ç¨‹ä¸­ä¹Ÿåªä¼šæœ‰ä¸€ä¸ªLooperå¯¹è±¡ã€‚\n\näº†è§£äº†Messageã€Handlerã€MessageOueueä»¥åŠLooperçš„åŸºæœ¬æ¦‚å¿µåï¼Œæˆ‘ä»¬å†æ¥æŠŠå¼‚æ­¥æ¶ˆæ¯å¤„ç†çš„æ•´ä¸ªæµç¨‹æ¢³ç†ä¸€éã€‚é¦–å…ˆéœ€è¦åœ¨ä¸»çº¿ç¨‹å½“ä¸­åˆ›å»ºä¸€ä¸ªHandlerå¯¹è±¡ï¼Œå¹¶é‡å†™handLeMessageæ–¹æ³•ã€‚ç„¶åå½“å­çº¿ç¨‹ä¸­éœ€è¦è¿›è¡ŒUIæ“ä½œæ—¶ï¼Œå°±åˆ›å»ºä¸€ä¸ªMessageå¯¹è±¡ï¼Œå¹¶é€šè¿‡Handlerå°†è¿™æ¡æ¶ˆæ¯å‘é€å‡ºå»ã€‚ä¹‹åè¿™æ¡æ¶ˆæ¯ä¼šè¢«æ·»åŠ åˆ°MessageQueueçš„é˜Ÿåˆ—ä¸­ç­‰å¾…è¢«å¤„ç†ï¼Œè€ŒLooperåˆ™ä¼šä¸€ç›´å°è¯•ä»MessageQueueä¸­å–å‡ºå¾…å¤„ç†æ¶ˆæ¯ï¼Œæœ€ååˆ†å‘å›Handlerçš„handleMessageæ–¹æ³•ä¸­ã€‚ç”±äºHandleræ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»ºçš„ï¼Œæ‰€ä»¥æ­¤æ—¶handleMessageæ–¹æ³•ä¸­çš„ä»£ç ä¹Ÿä¼šåœ¨ä¸»çº¿ç¨‹ä¸­è¿è¡Œï¼Œäºæ˜¯æˆ‘ä»¬åœ¨è¿™é‡Œå°±å¯ä»¥å®‰å¿ƒåœ°è¿›è¡ŒUIæ“ä½œäº†ã€‚æ•´ä¸ªå¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶çš„æµç¨‹å¦‚å›¾æ‰€ç¤ºã€‚\n\n![image-20220817202437951](../../images/Android_Service/image-20220817202437951.png)\n\n# ä½¿ç”¨AsyncTask\n\nä¸è¿‡ä¸ºäº†æ›´åŠ æ–¹ä¾¿æˆ‘ä»¬åœ¨å­çº¿ç¨‹ä¸­å¯¹UIè¿›è¡Œæ“ä½œï¼ŒAndroidè¿˜æä¾›äº†å¦å¤–ä¸€äº›å¥½ç”¨çš„å·¥å…·ï¼Œæ¯”å¦‚AsyncTaskã€‚å€ŸåŠ©AsyncTaskï¼Œå³ä½¿ä½ å¯¹å¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶å®Œå…¨ä¸äº†è§£ï¼Œä¹Ÿå¯ä»¥ååˆ†ç®€å•åœ°ä»å­çº¿ç¨‹åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹ã€‚å½“ç„¶ï¼ŒAsyncTaskèƒŒåçš„å®ç°åŸç†ä¹Ÿæ˜¯åŸºäºå¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶çš„ï¼Œåªæ˜¯Androidå¸®æˆ‘ä»¬åšäº†å¾ˆå¥½çš„å°è£…è€Œå·²ã€‚é¦–å…ˆæ¥çœ‹ä¸€ä¸‹AsyncTaskçš„åŸºæœ¬ç”¨æ³•ï¼Œç”±äºAsyncTaskæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨å®ƒï¼Œå°±å¿…é¡»è¦åˆ›å»ºä¸€ä¸ªå­ç±»å»ç»§æ‰¿å®ƒã€‚åœ¨ç»§æ‰¿æ—¶æˆ‘ä»¬å¯ä»¥ä¸ºAsyncTaskç±»æŒ‡å®š3ä¸ªæ³›å‹å‚æ•°ï¼Œè¿™3ä¸ªå‚æ•°çš„ç”¨é€”å¦‚ä¸‹ã€‚\n\n1. Paramsã€‚åœ¨æ‰§è¡ŒAsyncTaskæ—¶éœ€è¦ä¼ å…¥çš„å‚æ•°ï¼Œå¯ç”¨äºåœ¨åå°ä»»åŠ¡ä¸­ä½¿ç”¨ã€‚\n2. Progressã€‚åå°ä»»åŠ¡æ‰§è¡Œæ—¶ã€å¦‚æœéœ€è¦åœ¨ç•Œé¢ä¸Šæ˜¾ç¤ºå½“å‰çš„è¿›åº¦ï¼Œåˆ™ä½¿ç”¨è¿™é‡ŒæŒ‡å®šçš„æ³›å‹ä½œä¸ºè¿›åº¦å•ä½ã€‚\n3. Resultã€‚å½“ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œå¦‚æœéœ€è¦å¯¹ç»“æœè¿›è¡Œè¿”å›ï¼Œåˆ™ä½¿ç”¨è¿™é‡ŒæŒ‡å®šçš„æ³›å‹ä½œä¸ºè¿”å›å€¼ç±»å‹ã€‚\n\nå› æ­¤ï¼Œä¸€ä¸ªæœ€ç®€å•çš„è‡ªå®šä¹‰AsyncTaskå°±å¯ä»¥å†™æˆå¦‚ä¸‹æ–¹å¼ï¼š\n\n```java\nclass DownloadTask extends AsyncTask<Void, Integer, Boolean> {\n    ...\n}\n```\n\nè¿™é‡Œæˆ‘ä»¬æŠŠAsyncTaskçš„ç¬¬ä¸€ä¸ªæ³›å‹å‚æ•°æŒ‡å®šä¸ºVoidï¼Œè¡¨ç¤ºåœ¨æ‰§è¡ŒAsyncTaskçš„æ—¶å€™ä¸éœ€è¦ä¼ å…¥å‚æ•°ç»™åå°ä»»åŠ¡ã€‚ç¬¬äºŒä¸ªæ³›å‹å‚æ•°æŒ‡å®šä¸ºIntegerï¼Œè¡¨ç¤ºä½¿ç”¨æ•´å‹æ•°æ®æ¥ä½œä¸ºè¿›åº¦æ˜¾ç¤ºå•ä½ã€‚ç¬¬ä¸‰ä¸ªæ³›å‹å‚æ•°æŒ‡å®šä¸ºBooleanï¼Œåˆ™è¡¨ç¤ºä½¿ç”¨å¸ƒå°”å‹æ•°æ®æ¥åé¦ˆæ‰§è¡Œç»“æœã€‚\n\nå½“ç„¶ï¼Œç›®å‰æˆ‘ä»¬è‡ªå®šä¹‰çš„DownloadTaskè¿˜æ˜¯ä¸€ä¸ªç©ºä»»åŠ¡ï¼Œå¹¶ä¸èƒ½è¿›è¡Œä»»ä½•å®é™…çš„æ“ä½œï¼Œæˆ‘ä»¬è¿˜éœ€è¦å»é‡å†™AsyncTaskä¸­çš„å‡ ä¸ªæ–¹æ³•æ‰èƒ½å®Œæˆå¯¹ä»»åŠ¡çš„å®šåˆ¶ã€‚ç»å¸¸éœ€è¦å»é‡å†™çš„æ–¹æ³•æœ‰ä»¥ä¸‹4ä¸ªã€‚\n\n1. `onPreExecute()`\n   1. è¿™ä¸ªæ–¹æ³•ä¼šåœ¨åå°ä»»åŠ¡å¼€å§‹æ‰§è¡Œä¹‹å‰è°ƒç”¨ï¼Œç”¨äºè¿›è¡Œä¸€äº›ç•Œé¢ä¸Šçš„åˆå§‹åŒ–æ“ä½œï¼Œæ¯”å¦‚æ˜¾ç¤ºä¸€ä¸ªè¿›åº¦æ¡å¯¹è¯æ¡†ç­‰ã€‚\n2. `doInBackground(Params...)`\n   1. è¿™ä¸ªæ–¹æ³•ä¸­çš„æ‰€æœ‰ä»£ç éƒ½ä¼šåœ¨å­çº¿ç¨‹ä¸­è¿è¡Œï¼Œæˆ‘ä»¬åº”è¯¥åœ¨è¿™é‡Œå»å¤„ç†æ‰€æœ‰çš„è€—æ—¶ä»»åŠ¡ã€‚ä»»åŠ¡ä¸€æ—¦å®Œæˆå°±å¯ä»¥é€šè¿‡returnè¯­å¥æ¥å°†ä»»åŠ¡çš„æ‰§è¡Œç»“æœè¿”å›ï¼Œå¦‚æœAsyncTaskçš„ç¬¬ä¸‰ä¸ªæ³›å‹å‚æ•°æŒ‡å®šçš„æ˜¯Voidå°±å¯ä»¥ä¸è¿”å›ä»»åŠ¡æ‰§è¡Œç»“æœã€‚æ³¨æ„ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­æ˜¯ä¸å¯ä»¥è¿›è¡ŒUIæ“ä½œçš„ï¼Œå¦‚æœéœ€è¦æ›´æ–°UIå…ƒç´ ï¼Œæ¯”å¦‚è¯´åé¦ˆå½“å‰ä»»åŠ¡çš„æ‰§è¡Œè¿›åº¦ï¼Œå¯ä»¥è°ƒç”¨`publishProgress(Progress...)`æ–¹æ³•æ¥å®Œæˆã€‚\n3. `onProgressUpdate(Progress...)`\n   1. å½“åœ¨åå°ä»»åŠ¡ä¸­è°ƒç”¨äº†`publishProgress(Progress...)`æ–¹æ³•åï¼Œ`onProgressUpdate(Progress...)`æ–¹æ³•å°±ä¼šå¾ˆå¿«è¢«è°ƒç”¨ï¼Œè¯¥æ–¹æ³•ä¸­æºå¸¦çš„å‚æ•°å°±æ˜¯åœ¨åå°ä»»åŠ¡ä¸­ä¼ é€’è¿‡æ¥çš„ã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å¯ä»¥å¯¹UIè¿›è¡Œæ“ä½œï¼Œåˆ©ç”¨å‚æ•°ä¸­çš„æ•°å€¼å°±å¯ä»¥å¯¹ç•Œé¢å…ƒç´ è¿›è¡Œç›¸åº”çš„æ›´æ–°ã€‚\n4. `onPostExecute(Result)`\n   1. å½“åå°ä»»åŠ¡æ‰§è¡Œå®Œæ¯•å¹¶é€šè¿‡returnè¯­å¥è¿›è¡Œè¿”å›æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•å°±å¾ˆå¿«ä¼šè¢«è°ƒç”¨ã€‚è¿”å›çš„æ•°æ®ä¼šä½œä¸ºå‚æ•°ä¼ é€’åˆ°æ­¤æ–¹æ³•ä¸­ï¼Œå¯ä»¥åˆ©ç”¨è¿”å›çš„æ•°æ®æ¥è¿›è¡Œä¸€äº› Uæ“ä½œï¼Œæ¯”å¦‚è¯´æé†’ä»»åŠ¡æ‰§è¡Œçš„ç»“æœï¼Œä»¥åŠå…³é—­æ‰è¿›åº¦æ¡å¯¹è¯æ¡†ç­‰ã€‚\n\nå› æ­¤ï¼Œä¸€ä¸ªæ¯”è¾ƒå®Œæ•´çš„è‡ªå®šä¹‰AsyncTaskå°±å¯ä»¥å†™æˆå¦‚ä¸‹æ–¹å¼ï¼š\n\n```java\nclass DownloadTask extends AsyncTask<Void, Integer, Boolean> {\n    @Override\n    protected void onPreExecute() {\n        progressDialog.show(); // æ˜¾ç¤ºè¿›åº¦å¯¹è¯æ¡†\n    }\n    @Override\n    protected Boolean doInBackground(Void... params) {\n        try {\n            while (true) {\n                int downloadPercent = doDownload();\n                publishProgress(downloadPercent);\n                if(downloadPercent >= 100) {\n                    break;\n                }\n            }\n        } catch (Exception e) {\n            return false;\n        }\n        return true;\n    }\n    @Override\n    protected void onProgressUpdate(Integer... values) {\n        // åœ¨è¿™é‡Œæ›´æ–°ä¸‹è½½è¿›åº¦\n        progressDialog.setMessage(\"Download \" + values[0] + \"%\");\n    }\n    @Override\n    protected void onPostExecute(Boolean result) {\n        progressDialog.dismiss(); // å…³é—­è¿›åº¦å¯¹è¯æ¡†\n        // åœ¨è¿™é‡Œæç¤ºä¸‹è½½ç»“æœ\n        if (result) {\n            Toast.makeText(context, \"Download succeeded\", Toast.LENGTH_SHORT).show();\n        } else {\n            Toast.makeText(context, \"Download failed\", Toast.LENGTH_SHORT).show();\n        }\n    }\n}\n```\n\nåœ¨è¿™ä¸ªDownloadTaskä¸­ï¼Œæˆ‘ä»¬åœ¨doInBackgroundæ–¹æ³•é‡Œå»æ‰§è¡Œå…·ä½“çš„ä¸‹è½½ä»»åŠ¡ã€‚è¿™ä¸ªæ–¹æ³•é‡Œçš„ä»£ç éƒ½æ˜¯åœ¨å­çº¿ç¨‹ä¸­è¿è¡Œçš„ï¼Œå› è€Œä¸ä¼šå½±å“åˆ°ä¸»çº¿ç¨‹çš„è¿è¡Œã€‚æ³¨æ„è¿™é‡Œè™šæ„äº†ä¸€ä¸ªdoDownloadæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äºè®¡ç®—å½“å‰çš„ä¸‹è½½è¿›åº¦å¹¶è¿”å›ï¼Œæˆ‘ä»¬å‡è®¾è¿™ä¸ªæ–¹æ³•å·²ç»å­˜åœ¨äº†åœ¨å¾—åˆ°äº†å½“å‰çš„ä¸‹è½½è¿›åº¦åï¼Œä¸‹é¢å°±è¯¥è€ƒè™‘å¦‚ä½•æŠŠå®ƒæ˜¾ç¤ºåˆ°ç•Œé¢ä¸Šäº†ï¼Œç”±äºdoInBackgroundæ–¹æ³•æ˜¯åœ¨å­çº¿ç¨‹ä¸­è¿è¡Œçš„ï¼Œåœ¨è¿™é‡Œè‚¯å®šä¸èƒ½è¿›è¡ŒUIæ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è°ƒç”¨publishProgressæ–¹æ³•å¹¶å°†å½“å‰çš„ä¸‹è½½è¿›åº¦ä¼ è¿›æ¥ï¼Œè¿™æ ·onProgressUpdateæ–¹æ³•å°±ä¼šå¾ˆå¿«è¢«è°ƒç”¨ï¼Œåœ¨è¿™é‡Œå°±å¯ä»¥è¿›è¡ŒUIæ“ä½œäº†ã€‚\n\nå½“ä¸‹è½½å®Œæˆåï¼ŒdoInBackgroundæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªå¸ƒå°”å‹å˜é‡ï¼Œè¿™æ ·onPostExecuteæ–¹æ³•å°±ä¼šå¾ˆå¿«è¢«è°ƒç”¨ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­è¿è¡Œçš„ã€‚ç„¶ååœ¨è¿™é‡Œæˆ‘ä»¬ä¼šæ ¹æ®ä¸‹è½½çš„ç»“æœæ¥å¼¹å‡ºç›¸åº”çš„Toastæç¤ºï¼Œä»è€Œå®Œæˆæ•´ä¸ªDownloadTaskä»»åŠ¡ã€‚\n\nç®€å•æ¥è¯´ï¼Œä½¿ç”¨AsyncTaskçš„è¯€çªå°±æ˜¯ï¼Œåœ¨doInBackgroundæ–¹æ³•ä¸­æ‰§è¡Œå…·ä½“çš„è€—æ—¶ä»»åŠ¡ã€‚åœ¨onProgressUpdateæ–¹æ³•ä¸­è¿›è¡ŒUIæ“ä½œï¼Œåœ¨onPostExecuteæ–¹æ³•ä¸­æ‰§è¡Œä¸€äº›ä»»åŠ¡çš„æ”¶å°¾å·¥ä½œã€‚\n\nå¦‚æœæƒ³è¦å¯åŠ¨è¿™ä¸ªä»»åŠ¡ï¼Œåªéœ€ç¼–å†™ä»¥ä¸‹ä»£ç å³å¯ï¼š\n\n```java\nnew DownLoadTask().execute();\n```\n\n\nä»¥ä¸Šå°±æ˜¯AsyncTaskçš„åŸºæœ¬ç”¨æ³•ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦å»è€ƒè™‘ä»€ä¹ˆå¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶ï¼Œä¹Ÿä¸éœ€è¦ä¸“é—¨ä½¿ç”¨ä¸€ä¸ªHandleræ¥å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚åªéœ€è¦è°ƒç”¨ä¸€ä¸‹publishProgressæ–¹æ³•ï¼Œå°±å¯ä»¥è½»æ¾åœ°ä»å­çº¿ç¨‹åˆ‡æ¢åˆ°UIçº¿ç¨‹äº†ã€‚\n","categories":["Android","æ“ä½œç³»ç»Ÿ","å¤šçº¿ç¨‹"]},{"title":"Android_ContentProvider","url":"/Android/Android_ContentProvider/","content":"\n# ä¸ºäº†è·¨ç¨‹åºå…±äº«æ•°æ®\n\nå¯¹äºAndroidæ•°æ®æŒä¹…åŒ–æŠ€æœ¯ï¼ŒåŒ…æ‹¬æ–‡ä»¶å­˜å‚¨ã€SharedPreferenceså­˜å‚¨ä»¥åŠæ•°æ®åº“å­˜å‚¨ï¼Œè¿™äº›æŒä¹…åŒ–æŠ€æœ¯æ‰€ä¿å­˜çš„æ•°æ®éƒ½åªèƒ½åœ¨å½“å‰åº”ç”¨ç¨‹åºä¸­è®¿é—®ã€‚è™½ç„¶æ–‡ä»¶å’ŒSharedPreferenceså­˜å‚¨ä¸­æä¾›äº† `MODE_WORLD_READABLE`å’Œ`MODE_WORLD_WRITEABLE`è¿™ä¸¤ç§æ“ä½œæ¨¡å¼ï¼Œç”¨äºä¾›ç»™å…¶ä»–çš„åº”ç”¨ç¨‹åºè®¿é—®å½“å‰åº”ç”¨çš„æ•°æ®ï¼Œä½†è¿™ä¸¤ç§æ¨¡å¼åœ¨Android 4.2ç‰ˆæœ¬ä¸­éƒ½å·²è¢«åºŸå¼ƒäº†ã€‚å› ä¸ºAndroidå®˜æ–¹å·²ç»ä¸å†æ¨èä½¿ç”¨è¿™ç§æ–¹å¼æ¥å®ç°è·¨ç¨‹åºæ•°æ®å…±äº«çš„åŠŸèƒ½ï¼Œè€Œæ˜¯åº”è¯¥ä½¿ç”¨æ›´åŠ å®‰å…¨å¯é çš„**å†…å®¹æä¾›å™¨(ContentProvider)**æŠ€æœ¯ã€‚\n\nä¸ºä»€ä¹ˆè¦å°†æˆ‘ä»¬ç¨‹åºä¸­çš„æ•°æ®å…±äº«ç»™å…¶ä»–ç¨‹åºå‘¢ï¼Ÿå½“ç„¶ï¼Œè¿™ä¸ªæ˜¯è¦è§†æƒ…å†µè€Œå®šçš„ï¼Œæ¯”å¦‚è¯´è´¦å·å’Œå¯†ç è¿™æ ·çš„éšç§æ•°æ®æ˜¾ç„¶æ˜¯ä¸èƒ½å…±äº«ç»™å…¶ä»–ç¨‹åºçš„ï¼Œä¸è¿‡ä¸€äº›å¯ä»¥è®©å…¶ä»–ç¨‹åºè¿›è¡ŒäºŒæ¬¡å¼€å‘çš„åŸºç¡€æ€§æ•°æ®ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥é€‰æ‹©å°†å…¶å…±äº«çš„ã€‚ä¾‹å¦‚ç³»ç»Ÿçš„ç”µè¯ç°¿ç¨‹åºï¼Œå®ƒçš„æ•°æ®åº“ä¸­ä¿å­˜äº†å¾ˆå¤šçš„è”ç³»äººä¿¡æ¯ï¼Œå¦‚æœè¿™äº›æ•°æ®éƒ½ä¸å…è®¸ç¬¬ä¸‰æ–¹çš„ç¨‹åºè¿›è¡Œè®¿é—®çš„è¯ï¼Œææ€•å¾ˆå¤šåº”ç”¨çš„åŠŸèƒ½éƒ½è¦å¤§æ‰“æŠ˜æ‰£äº†ã€‚é™¤äº†ç”µè¯ç°¿ä¹‹å¤–ï¼Œè¿˜æœ‰çŸ­ä¿¡ã€åª’ä½“åº“ç­‰ç¨‹åºéƒ½å®ç°äº†è·¨ç¨‹åºæ•°æ®å…±äº«çš„åŠŸèƒ½ï¼Œè€Œä½¿ç”¨çš„æŠ€æœ¯å½“ç„¶å°±æ˜¯å†…å®¹æä¾›å™¨äº†ï¼Œä¸‹é¢å°±æ¥å¯¹è¿™ä¸€æŠ€æœ¯è¿›è¡Œæ·±å…¥çš„æ¢è®¨ã€‚\n\n# è¿è¡Œæ—¶æƒé™\n\nå†…å®¹æä¾›å™¨ï¼ˆContent Providerï¼‰ä¸»è¦ç”¨äºåœ¨ä¸åŒçš„åº”ç”¨ç¨‹åºä¹‹é—´å®ç°æ•°æ®å…±äº«çš„åŠŸèƒ½ï¼Œå®ƒæä¾›äº†ä¸€å¥—å®Œæ•´çš„æœºåˆ¶ï¼Œå…è®¸ä¸€ä¸ªç¨‹åºè®¿é—®å¦ä¸€ä¸ªç¨‹åºä¸­çš„æ•°æ®ï¼ŒåŒæ—¶è¿˜èƒ½ä¿è¯è¢«è®¿æ•°æ®çš„å®‰å…¨æ€§ã€‚\n\nç›®å‰ï¼Œä½¿ç”¨å†…å®¹æä¾›å™¨æ˜¯Androidå®ç°è·¨ç¨‹åºå…±äº«æ•°æ®çš„æ ‡å‡†æ–¹å¼ã€‚\n\nä¸åŒäºæ–‡ä»¶å­˜å‚¨å’ŒSharedPreferenceså­˜å‚¨ä¸­çš„ä¸¤ç§å…¨å±€å¯è¯»å†™æ“ä½œæ¨¡å¼ï¼Œå†…å®¹æä¾›å™¨å¯ä»¥é€‰æ‹©åªå¯¹å“ªä¸€éƒ¨åˆ†æ•°æ®è¿›è¡Œå…±äº«ï¼Œä»è€Œä¿è¯ç¨‹åºä¸­çš„éšç§æ•°æ®ä¸ä¼šæœ‰æ³„æ¼çš„é£é™©ã€‚\n\nåœ¨æ­£å¼å¼€å§‹å­¦ä¹ å†…å®¹æä¾›å™¨ä¹‹å‰ï¼Œéœ€è¦å…ˆæŒæ¡å¦å¤–ä¸€ä¸ªéå¸¸é‡è¦çš„çŸ¥è¯†â€”â€”Androidè¿è¡Œæ—¶æƒé™ï¼Œå› ä¸ºå†…å®¹æä¾›å™¨ä¼šä½¿ç”¨åˆ°è¿è¡Œæ—¶æƒé™çš„åŠŸèƒ½ã€‚å½“ç„¶ä¸å…‰æ˜¯å†…å®¹æä¾›å™¨ç”¨åˆ°ã€‚\n\nAndroidçš„**æƒé™æœºåˆ¶**ä»ç¬¬ä¸€ä¸ªç‰ˆæœ¬å¼€å§‹å°±å·²ç»å­˜åœ¨äº†ã€‚ä½†å…¶å®ä¹‹å‰Androidçš„æƒé™æœºåˆ¶åœ¨ä¿æŠ¤ç”¨æˆ·å®‰å…¨å’Œéšç§ç­‰æ–¹é¢èµ·åˆ°çš„ä½œç”¨æ¯”è¾ƒæœ‰é™ï¼Œå°¤å…¶æ˜¯ä¸€äº›å¤§å®¶éƒ½ç¦»ä¸å¼€çš„å¸¸ç”¨è½¯ä»¶ï¼Œéå¸¸å®¹æ˜“â€œåº—å¤§æ¬ºå®¢â€ã€‚ä¸ºæ­¤ï¼ŒAndroidå¼€å‘å›¢é˜Ÿåœ¨Android 6.0ç³»ç»Ÿä¸­å¼•ç”¨äº†**è¿è¡Œæ—¶æƒé™**è¿™ä¸ªåŠŸèƒ½ï¼Œä»è€Œæ›´å¥½åœ°ä¿æŠ¤äº†ç”¨æˆ·çš„å®‰å…¨å’Œéšç§ã€‚\n\n## Androidæƒé™æœºåˆ¶è¯¦è§£\n\né¦–å…ˆæ¥çœ‹ä¸€ä¸‹è¿‡å»Androidçš„æƒé™æœºåˆ¶æ˜¯ä»€ä¹ˆæ ·çš„ã€‚æ¯”å¦‚ä¸ºäº†è¦è®¿é—®ç³»ç»Ÿçš„ç½‘ç»œçŠ¶æ€ä»¥åŠç›‘å¬å¼€æœºå¹¿æ’­ï¼Œäºæ˜¯åœ¨`AndroidManifest.xml`æ–‡ä»¶ä¸­æ·»åŠ äº†è¿™æ ·ä¸¤å¥æƒé™å£°æ˜ï¼š\n\n```xml\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    package=\"com.example.broadcasttest\">\n    <uses-permission android:name=\"android.permission.RECEIVE_BOOT_COMPLETED\">\n    </uses-permission>\n    <uses-permission android:name=\"android.permission.ACCESS_NETWORK_STATE\">\n    </uses-permission>\n    ...\n</manifest>\n```\n\nå› ä¸ºè®¿é—®ç³»ç»Ÿçš„ç½‘ç»œçŠ¶æ€ä»¥åŠç›‘å¬å¼€æœºå¹¿æ’­æ¶‰åŠäº†ç”¨æˆ·è®¾å¤‡çš„å®‰å…¨æ€§ï¼Œå› æ­¤å¿…é¡»åœ¨AndroidManifest.xmlä¸­åŠ å…¥æƒé™å£°æ˜ï¼Œå¦åˆ™ç¨‹åºå°±ä¼šå´©æºƒã€‚\n\né‚£ä¹ˆç°åœ¨é—®é¢˜æ¥äº†ï¼ŒåŠ å…¥äº†è¿™ä¸¤å¥æƒé™å£°æ˜åï¼Œå¯¹äºç”¨æˆ·æ¥è¯´åˆ°åº•æœ‰ä»€ä¹ˆå½±å“å‘¢ï¼Ÿä¸ºä»€ä¹ˆè¿™æ ·å°±å¯ä»¥ä¿æŠ¤ç”¨æˆ·è®¾å¤‡çš„å®‰å…¨æ€§äº†å‘¢?\n\nå…¶å®ç”¨æˆ·ä¸»è¦åœ¨ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢å¾—åˆ°äº†ä¿æŠ¤ï¼Œä¸€æ–¹é¢ï¼Œå¦‚æœç”¨æˆ·åœ¨ä½äº6.0ç³»ç»Ÿçš„è®¾å¤‡ä¸Šå®‰è£…è¯¥ç¨‹åºï¼Œä¼šåœ¨å®‰è£…ç•Œé¢ç»™å‡ºæé†’â€”â€”â€œæ­¤åº”ç”¨å°†è·å¾—ä»¥ä¸‹æƒé™ï¼šæŸ¥çœ‹ç½‘ç»œè¿æ¥ã€å¼€æœºå¯åŠ¨â€ã€‚è¿™æ ·ç”¨æˆ·å°±å¯ä»¥æ¸…æ¥šåœ°çŸ¥æ™“è¯¥ç¨‹åºä¸€å…±ç”³è¯·äº†å“ªäº›æƒé™ï¼Œä»è€Œå†³å®šæ˜¯å¦è¦å®‰è£…è¿™ä¸ªç¨‹åºã€‚\n\nå¦ä¸€æ–¹é¢ï¼Œç”¨æˆ·å¯ä»¥éšæ—¶åœ¨åº”ç”¨ç¨‹åºç®¡ç†ç•Œé¢æŸ¥çœ‹ä»»æ„ä¸€ä¸ªç¨‹åºçš„æƒé™ç”³è¯·æƒ…å†µã€‚è¿™æ ·è¯¥ç¨‹åºç”³è¯·çš„æ‰€æœ‰æƒé™å°±å°½æ”¶çœ¼åº•ï¼Œä»€ä¹ˆéƒ½ç’ä¸è¿‡ç”¨æˆ·çš„çœ¼ç›ï¼Œä»¥æ­¤ä¿è¯åº”ç”¨ç¨‹åºä¸ä¼šå‡ºç°å„ç§æ»¥ç”¨æƒé™çš„æƒ…å†µã€‚\n\nè¿™ç§æƒé™æœºåˆ¶çš„è®¾è®¡æ€è·¯å…¶å®éå¸¸ç®€å•ï¼Œå°±æ˜¯ç”¨æˆ·å¦‚æœè®¤å¯ä½ æ‰€ç”³è¯·çš„æƒé™ï¼Œé‚£ä¹ˆå°±ä¼šå®‰è£…ç¨‹åºï¼Œå¦‚æœä¸è®¤å¯ç”³è¯·çš„æƒé™ï¼Œé‚£ä¹ˆæ‹’ç»å®‰è£…å°±å¯ä»¥äº†ã€‚\n\nä½†æ˜¯ç†æƒ³æ˜¯ç¾å¥½çš„ï¼Œç°å®å´å¾ˆæ®‹é…·ï¼Œå› ä¸ºå¾ˆå¤šæˆ‘ä»¬æ‰€ç¦»ä¸å¼€çš„å¸¸ç”¨è½¯ä»¶æ™®éå­˜åœ¨ç€æ»¥ç”¨æƒé™çš„æƒ…å†µï¼Œä¸ç®¡åˆ°åº•ç”¨ä¸ç”¨å¾—åˆ°ï¼Œåæ­£å…ˆæŠŠæƒé™ç”³è¯·äº†å†è¯´ã€‚æ¯”å¦‚è¯´å¾®ä¿¡æ‰€ç”³è¯·çš„æƒé™ã€‚\n\nAndroidå¼€å‘å›¢é˜Ÿå½“ç„¶ä¹Ÿæ„è¯†åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œäºæ˜¯åœ¨6.0ç³»ç»Ÿä¸­åŠ å…¥äº†è¿è¡Œæ—¶æƒé™åŠŸèƒ½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·ä¸éœ€è¦åœ¨å®‰è£…è½¯ä»¶çš„æ—¶å€™ä¸€æ¬¡æ€§æˆæƒæ‰€æœ‰ç”³è¯·çš„æƒé™ï¼Œè€Œæ˜¯å¯ä»¥åœ¨è½¯ä»¶çš„ä½¿ç”¨è¿‡ç¨‹ä¸­å†å¯¹æŸä¸€é¡¹æƒé™ç”³è¯·è¿›è¡Œæˆæƒã€‚æ¯”å¦‚è¯´ä¸€æ¬¾ç›¸æœºåº”ç”¨åœ¨è¿è¡Œæ—¶ç”³è¯·äº†åœ°ç†ä½ç½®å®šä½æƒé™ï¼Œå°±ç®—æˆ‘æ‹’ç»äº†è¿™ä¸ªæƒé™ï¼Œä½†æ˜¯æˆ‘åº”è¯¥ä»ç„¶å¯ä»¥ä½¿ç”¨è¿™ä¸ªåº”ç”¨çš„å…¶ä»–åŠŸèƒ½ï¼Œè€Œä¸æ˜¯åƒä¹‹å‰é‚£æ ·ç›´æ¥æ— æ³•å®‰è£…å®ƒã€‚\n\nå½“ç„¶ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰æƒé™éƒ½éœ€è¦åœ¨è¿è¡Œæ—¶ç”³è¯·ï¼Œå¯¹äºç”¨æˆ·æ¥è¯´ï¼Œä¸åœåœ°æˆæƒä¹Ÿå¾ˆçƒ¦çã€‚Androidç°åœ¨å°†æ‰€æœ‰çš„æƒé™å½’æˆäº†ä¸¤ç±»ï¼Œä¸€ç±»æ˜¯æ™®é€šæƒé™ï¼Œä¸€ç±»æ˜¯å±é™©æƒé™ã€‚å‡†ç¡®åœ°è®²ï¼Œå…¶å®è¿˜æœ‰ç¬¬ä¸‰ç±»ç‰¹æ®Šæƒé™ï¼Œä¸è¿‡è¿™ç§æƒé™ä½¿ç”¨å¾—å¾ˆå°‘ï¼Œå› æ­¤ä¸åœ¨è®¨è®ºèŒƒå›´ä¹‹å†…ã€‚æ™®é€šæƒé™æŒ‡çš„æ˜¯é‚£äº›ä¸ä¼šç›´æ¥å¨èƒåˆ°ç”¨æˆ·çš„å®‰å…¨å’Œéšç§çš„æƒé™ï¼Œå¯¹äºè¿™éƒ¨åˆ†æƒé™ç”³è¯·ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬è¿›è¡Œæˆæƒï¼Œè€Œä¸éœ€è¦ç”¨æˆ·å†å»æ‰‹åŠ¨æ“ä½œäº†ã€‚å±é™©æƒé™åˆ™è¡¨ç¤ºé‚£äº›å¯èƒ½ä¼šè§¦åŠç”¨æˆ·éšç§æˆ–è€…å¯¹è®¾å¤‡å®‰å…¨æ€§é€ æˆå½±å“çš„æƒé™ï¼Œå¦‚è·å–è®¾å¤‡è”ç³»äººä¿¡æ¯ã€å®šä½è®¾å¤‡çš„åœ°ç†ä½ç½®ç­‰ï¼Œå¯¹äºè¿™éƒ¨åˆ†æƒé™ç”³è¯·ï¼Œå¿…é¡»è¦ç”±ç”¨æˆ·æ‰‹åŠ¨ç‚¹å‡»æˆæƒæ‰å¯ä»¥ï¼Œå¦åˆ™ç¨‹åºå°±æ— æ³•ä½¿ç”¨ç›¸åº”çš„åŠŸèƒ½ã€‚\n\nä½†æ˜¯Androidä¸­æœ‰ä¸€å…±æœ‰ä¸Šç™¾ç§æƒé™ï¼Œæ€ä¹ˆä»ä¸­åŒºåˆ†å“ªäº›æ˜¯æ™®é€šæƒé™ï¼Œå“ªäº›æ˜¯å±é™©æƒé™ï¼Ÿå…¶å®ä¸éš¾ï¼Œå±é™©æƒé™å¾ˆå°‘ï¼Œé™¤äº†å±é™©æƒé™ä¹‹å¤–ï¼Œå‰©ä½™çš„å°±æ˜¯æ™®é€šæƒé™ã€‚ä¸‹è¡¨ä¸ºåˆ°Android 10ä¸ºæ­¢æ‰€æœ‰çš„å±é™©æƒé™ã€‚\n\n| æƒé™ç»„å             | æƒé™å                                                       |\n| -------------------- | ------------------------------------------------------------ |\n| CALENDAR             | `READ_CALENDAR`<br />`WRITE_CALENDAR`                        |\n| CALL_LOG             | `READ_CALL_LOG`<br />`WRITE_CALL_LOG`<br />`PROCESS_OUTGOING_CALLS` |\n| CAMERA               | CAMERA                                                       |\n| CONTACTS             | `READ_CONTACTS`<br />`WRITE_CONTACTS`<br />`GET_ACCOUNTS`    |\n| LOCATION             | `ACCESS_FINE_LOCATION`<br />`ACCESS_COARSE_LOCATION`<br />`ACCESS_BACKGROUND_LOCATION` |\n| MICROPHONE           | `RECORD_AUDIO`                                               |\n| PHONE                | `READ_PHONE_STATE`<br />`READ_PHONE_NUMBERS`<br />`CALL_PHONE`<br />`ANSWER_PHONE_CALLS`<br />`ADD_VOICEMAIL`<br />`USE_SIP`<br />`ACCEPT_HANDOVER` |\n| SENSORS              | `BODY_SENSORS`                                               |\n| ACTIVITY_RECOGNITION | `ACTIVITY_RECOGNITION`                                       |\n| SMS                  | `SEND_SMS`<br />`RECEIVE_SMS`<br />`READ_SMS`<br />`RECEIVE_WAP_PUSH`<br />`RECEIVE_MMS` |\n| STORAGE              | `READ_EXTERNAL_STORAGE`<br />`WRITE_EXTERNAL_STORAGE`<br />`ACCESS_MEDIA_LOCATION` |\n\næ¯å½“è¦ä½¿ç”¨ä¸€ä¸ªæƒé™æ—¶ï¼Œå¯ä»¥å…ˆåˆ°è¿™å¼ è¡¨ä¸­æ¥æŸ¥ä¸€ä¸‹ï¼Œå¦‚æœæ˜¯å±äºè¿™å¼ è¡¨ä¸­çš„æƒé™ï¼Œé‚£ä¹ˆå°±éœ€è¦è¿›è¡Œè¿è¡Œæ—¶æƒé™å¤„ç†ï¼Œå¦‚æœä¸åœ¨è¿™å¼ è¡¨ä¸­ï¼Œé‚£ä¹ˆåªéœ€è¦åœ¨AndroidManifest.xmlæ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸‹æƒé™å£°æ˜å°±å¯ä»¥äº†ã€‚\n\nå¦å¤–æ³¨æ„ä¸€ä¸‹ï¼Œè¡¨æ ¼ä¸­æ¯ä¸ªå±é™©æƒé™éƒ½å±äºä¸€ä¸ªæƒé™ç»„ï¼Œæˆ‘ä»¬åœ¨è¿›è¡Œè¿è¡Œæ—¶æƒé™å¤„ç†æ—¶ä½¿ç”¨çš„æ˜¯æƒé™åï¼Œä½†æ˜¯ç”¨æˆ·ä¸€æ—¦åŒæ„æˆæƒäº†ï¼Œé‚£ä¹ˆè¯¥æƒé™æ‰€å¯¹åº”çš„æƒé™ç»„ä¸­æ‰€æœ‰çš„å…¶ä»–æƒé™ä¹Ÿä¼šåŒæ—¶è¢«æˆæƒã€‚ä½†æ˜¯è°¨è®°ï¼Œä¸è¦åŸºäºæ­¤è§„åˆ™æ¥å®ç°ä»»ä½•åŠŸèƒ½é€»è¾‘ï¼Œå› ä¸ºAndroidç³»ç»Ÿéšæ—¶å¯èƒ½è°ƒæ•´æƒé™çš„åˆ†ç»„ã€‚\n\n## åœ¨ç¨‹åºè¿è¡Œæ—¶ç”³è¯·æƒé™\n\né¦–å…ˆæ–°å»ºä¸€ä¸ªRuntimePermissionTesté¡¹ç›®ã€‚å…ˆä»¥`CALL_PHONE`è¿™ä¸ªæƒé™ä½œä¸ºç¤ºä¾‹ã€‚\n\n`CALL_PHONE`è¿™ä¸ªæƒé™æ˜¯ç¼–å†™æ‹¨æ‰“ç”µè¯åŠŸèƒ½çš„æ—¶å€™éœ€è¦å£°æ˜çš„ï¼Œå› ä¸ºæ‹¨æ‰“ç”µè¯ä¼šæ¶‰åŠç”¨æˆ·æ‰‹æœºçš„èµ„è´¹é—®é¢˜ï¼Œå› è€Œè¢«åˆ—ä¸ºäº†å±é™©æƒé™ã€‚åœ¨Android 6.0ç³»ç»Ÿå‡ºç°ä¹‹å‰ï¼Œæ‹¨æ‰“ç”µè¯åŠŸèƒ½çš„å®ç°éå¸¸ç®€å•ï¼Œä¿®æ”¹`activity_main.xml`å¸ƒå±€æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n    <Button\n        android:id=\"@+id/make_call\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Make Call\">\n    </Button>\n</LinearLayout>\n```\n\nä¿®æ”¹MainActivityä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹ï¼š\n\nJavaç‰ˆï¼š\n\n```java\npublic class MainActivity extends AppCompatActivity {\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        Button makeCall = (Button) findViewById(R.id.make_call);\n        makeCall.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View view) {\n                try {\n                    Intent intent = new Intent(Intent.ACTION_CALL);\n                    intent.setData(Uri.parse(\"tel:10086\"));\n                    startActivity(intent);\n                } catch (SecurityException e) {\n                    e.printStackTrace();\n                }\n            }\n        });\n    }\n}\n```\n\nkotlinç‰ˆï¼š\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n        makeCall.setOnClickListener {\n            try {\n                val intent = Intent(Intent.ACTION_CALL)\n                intent.data = Uri.parse(\"tel:10086\")\n                startActivity(intent)\n            } catch (e: SecurityException) {\n                e.printStackTrace()\n            }\n        }\n    }\n}\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œåœ¨æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ä¸­ï¼Œæ„å»ºäº†ä¸€ä¸ªéšå¼Intentï¼ŒIntentçš„actionæŒ‡å®šä¸º`Intent.ACTION_CALL`ï¼Œè¿™æ˜¯ä¸€ä¸ªç³»ç»Ÿå†…ç½®çš„æ‰“ç”µè¯çš„åŠ¨ä½œï¼Œç„¶ååœ¨dataéƒ¨åˆ†æŒ‡å®šäº†åè®®æ˜¯telï¼Œå·ç æ˜¯10086ã€‚è¦æ³¨æ„åŒºåˆ†ï¼Œ`Intent.ACTION_DIAL`è¡¨ç¤ºæ‰“å¼€æ‹¨å·ç•Œé¢ï¼Œè¿™ä¸ªæ˜¯ä¸éœ€è¦å£°æ˜æƒé™çš„ï¼Œè€Œ`Intent.ACTION_CALL`åˆ™å¯ä»¥ç›´æ¥æ‹¨æ‰“ç”µè¯ï¼Œå› æ­¤å¿…é¡»å£°æ˜æƒé™ã€‚\n\nå¦å¤–ä¸ºäº†é˜²æ­¢ç¨‹åºå´©æºƒï¼Œå°†æ‰€æœ‰æ“ä½œéƒ½æ”¾åœ¨äº†å¼‚å¸¸æ•è·ä»£ç å—å½“ä¸­ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥ä¿®æ”¹`AndroidManifest.xml`æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­å£°æ˜å¦‚ä¸‹æƒé™ï¼š\n\n```xml\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    package=\"com.example.filetest\">\n    <uses-permission android:name=\"android.permission.CALL_PHONE\">\n    </uses-permission>\n    ...\n</manifest>\n```\n\nè¿™æ ·æ‹¨æ‰“ç”µè¯çš„åŠŸèƒ½æˆåŠŸå®ç°äº†ï¼Œåœ¨ä½äºAndroid 6.0ç³»ç»Ÿçš„æ‰‹æœºä¸Šéƒ½æ˜¯å¯ä»¥æ­£å¸¸è¿è¡Œçš„ï¼Œä½†æ˜¯å¦‚æœåœ¨6.0æˆ–è€…æ›´é«˜ç‰ˆæœ¬ç³»ç»Ÿçš„æ‰‹æœºä¸Šè¿è¡Œï¼Œç‚¹å‡»Make CallæŒ‰é’®å°±æ²¡æœ‰ä»»ä½•æ•ˆæœï¼Œè¿™æ—¶è§‚å¯Ÿlogcatä¸­çš„æ‰“å°æ—¥å¿—ï¼Œä¼šçœ‹åˆ°é”™è¯¯ä¿¡æ¯ä¸­æé†’æˆ‘ä»¬â€œPermission Denialâ€ï¼Œå¯ä»¥çœ‹å‡ºï¼Œè¿™æ˜¯æƒé™è¢«ç¦æ­¢æ‰€å¯¼è‡´ï¼Œå› ä¸ºAndroid 6.0åŠä»¥ä¸Šç³»ç»Ÿåœ¨ä½¿ç”¨å±é™©æƒé™æ—¶å¿…é¡»è¿›è¡Œè¿è¡Œæ—¶æƒé™å¤„ç†ã€‚\n\nä¿®æ”¹MainActivityä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹ï¼š\n\nJavaä»£ç ï¼š\n\n```java\npublic class MainActivity extends AppCompatActivity {\n    @Override\n\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        Button makeCall = (Button) findViewById(R.id.makeCall);\n        makeCall.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View view) {\n                if(ContextCompat.checkSelfPermission(MainActivity.this,\n                        Manifest.permission.CALL_PHONE) != PackageManager.PERMISSION_GRANTED) {\n                    ActivityCompat.requestPermissions(MainActivity.this, new String[]{ Manifest.permission.CALL_PHONE }, 1);\n                } else {\n                    call();\n                }\n            }\n        });\n    }\n    private void call() {\n        try {\n            Intent intent = new Intent(Intent.ACTION_CALL);\n            intent.setData(Uri.parse(\"tel:10086\"));\n            startActivity(intent);\n        } catch (SecurityException e) {\n            e.printStackTrace();\n        }\n    }\n    // ç”¨æˆ·é€‰æ‹©åŒæ„æˆ–æ‹’ç»åï¼Œä¼šå›è°ƒåˆ°æ­¤æ–¹æ³•ä¸­ï¼Œæˆæƒçš„ç»“æœä¼šå°è£…åœ¨grantResultså‚æ•°ä¸­ã€‚\n    @Override\n    public void onRequestPermissionsResult(int requestCode, String[] permissions,\n                                          int[] grantResults) {\n        super.onRequestPermissionsResult(requestCode, permissions, grantResults);\n        switch (requestCode) {\n            case 1:\n                if (grantResults.length > 0 && grantResults[0] == PackageManager.PERMISSION_GRANTED) {\n                    call();\n                } else {\n                    Toast.makeText(this, \"You denied the permission\", Toast.LENGTH_SHORT).show();\n                }\n                break;\n            default:\n\n        }\n    }\n}\n```\n\nkotlinç‰ˆï¼š\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n        makeCall.setOnClickListener {\n            if(ContextCompat.checkSelfPermission(this,\n                    Manifest.permission.CALL_PHONE) != PackageManager.PERMISSION_GRANTED) {\n                ActivityCompat.requestPermissions(this,\n                arrayOf(Manifest.permission.CALL_PHONE), 1)\n            }\n            else {\n                call()\n            }\n        }\n    }\n    override fun onRequestPermissionsResult(requestCode: Int,\n                                            permissions: Array<String>,\n                                            grantResultsï¼› IntArray) {\n        super.onRequestPermissionsResult(requestCode, permissions, grantResults)\n        when (requestCode) {\n            1 -> {\n                if (grantResults.isNotEmpty() &&\n                    grantResults[0] == PackManager.PERMISSION_GRANTED) {\n                    call()\n                } else {\n                    Toast.makeText(this, \"You denied the permission\",\n                                   Toast.LENGTH_SHORT).show()\n                }\n            }\n        }\n    }\n    private fun call() {\n        try {\n            val intent = Intent(Intent.ACTION_CALL)\n            intent.data = Uri.parse(\"tel:10086\")\n            startActivity(intent)\n        } catch (e: SecurityException) {\n            e.printStackTrace()\n        }\n    }\n}\n```\n\nä¸Šé¢çš„ä»£ç å°†è¿è¡Œæ—¶æƒé™çš„å®Œæ•´æµç¨‹éƒ½è¦†ç›–äº†ï¼Œä¸‹é¢æ¥å…·ä½“è§£æä¸€ä¸‹ã€‚è¯´ç™½äº†ï¼Œè¿è¡Œæ—¶æƒé™çš„æ ¸å¿ƒå°±æ˜¯åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ç”±ç”¨æˆ·æˆæƒå»æ‰§è¡ŒæŸäº›å±é™©æ“ä½œï¼Œç¨‹åºæ˜¯ä¸å¯ä»¥æ“…è‡ªåšä¸»å»æ‰§è¡Œè¿™äº›å±é™©æ“ä½œçš„ã€‚å› æ­¤ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯è¦å…ˆåˆ¤æ–­ç”¨æˆ·æ˜¯ä¸æ˜¯å·²ç»ç»™è¿‡æˆæƒäº†ï¼Œå€ŸåŠ©çš„æ˜¯ContextCompat.checkSelfPermissionæ–¹æ³•ã€‚checkSelfPermissionæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯Contextï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å…·ä½“çš„æƒé™åï¼Œæ¯”å¦‚æ‰“ç”µè¯çš„æƒé™åå°±æ˜¯`Manifest.permission.CALL_PHONE`ï¼Œç„¶åæˆ‘ä»¬ä½¿ç”¨æ–¹æ³•çš„è¿”å›å€¼å’Œ`PackageManager.PERMISSION_GRANTED`åšæ¯”è¾ƒï¼Œç›¸ç­‰å°±è¯´æ˜ç”¨æˆ·å·²ç»æˆæƒï¼Œä¸ç­‰å°±è¡¨ç¤ºç”¨æˆ·æ²¡æœ‰æˆæƒã€‚\n\nå¦‚æœå·²ç»æˆæƒçš„è¯å°±ç®€å•äº†ï¼Œç›´æ¥å»æ‰§è¡Œæ‹¨æ‰“ç”µè¯çš„é€»è¾‘æ“ä½œå°±å¯ä»¥äº†ï¼Œè¿™é‡Œæˆ‘ä»¬æŠŠæ‹¨æ‰“ç”µè¯çš„é€»è¾‘å°è£…åˆ°äº†callæ–¹æ³•å½“ä¸­ã€‚å¦‚æœæ²¡æœ‰æˆæƒçš„è¯ï¼Œåˆ™éœ€è¦è°ƒç”¨`ActivityCompat.requestPermissions`æ–¹æ³•æ¥å‘ç”¨æˆ·ç”³è¯·æˆæƒï¼Œ`requestPermissions`æ–¹æ³•æ¥æ”¶3ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è¦æ±‚æ˜¯Activityçš„å®ä¾‹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªStringæ•°ç»„ï¼Œæˆ‘ä»¬æŠŠè¦ç”³è¯·çš„æƒé™åæ”¾åœ¨æ•°ç»„ä¸­å³å¯ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è¯·æ±‚ç ï¼Œåªè¦æ˜¯å”¯ä¸€å€¼å°±å¯ä»¥äº†ï¼Œè¿™é‡Œä¼ å…¥äº†1ã€‚\n\nè°ƒç”¨å®Œäº†`requestPermissions`æ–¹æ³•ä¹‹åï¼Œç³»ç»Ÿä¼šå¼¹å‡ºä¸€ä¸ªæƒé™ç”³è¯·çš„å¯¹è¯æ¡†ï¼Œç„¶åç”¨æˆ·å¯ä»¥é€‰æ‹©åŒæ„æˆ–æ‹’ç»æˆ‘ä»¬çš„æƒé™ç”³è¯·ï¼Œä¸è®ºæ˜¯å“ªç§ç»“æœï¼Œæœ€ç»ˆéƒ½ä¼šå›è°ƒåˆ°`onRequestPermissionsResult`æ–¹æ³•ä¸­ï¼Œè€Œæˆæƒçš„ç»“æœåˆ™ä¼šå°è£…åœ¨`grantResults`å‚æ•°å½“ä¸­ã€‚è¿™é‡Œæˆ‘ä»¬åªéœ€è¦åˆ¤æ–­ä¸€ä¸‹æœ€åçš„æˆæƒç»“æœï¼Œå¦‚æœç”¨æˆ·åŒæ„çš„è¯å°±è°ƒç”¨callæ–¹æ³•æ¥æ‹¨æ‰“ç”µè¯ï¼Œå¦‚æœç”¨æˆ·æ‹’ç»çš„è¯æˆ‘ä»¬åªèƒ½æ”¾å¼ƒæ“ä½œï¼Œå¹¶ä¸”å¼¹å‡ºä¸€æ¡å¤±è´¥æç¤ºã€‚\n\nç°åœ¨é‡æ–°è¿è¡Œä¸€ä¸‹ç¨‹åºï¼Œå¹¶ç‚¹å‡»Make CallæŒ‰é’®ã€‚ç”±äºç”¨æˆ·è¿˜æ²¡æœ‰æˆæƒè¿‡æˆ‘ä»¬æ‹¨æ‰“ç”µè¯æƒé™ï¼Œå› æ­¤ç¬¬ä¸€æ¬¡è¿è¡Œä¼šå¼¹å‡ºä¸€ä¸ªæƒé™ç”³è¯·çš„å¯¹è¯æ¡†ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©åŒæ„æˆ–è€…æ‹’ç»ã€‚\n\nå¦‚æœé€‰æ‹©åŒæ„ï¼Œå°±æˆåŠŸè¿›å…¥åˆ°æ‹¨æ‰“ç”µè¯ç•Œé¢äº†ï¼Œç”±äºç”¨æˆ·å·²ç»å®Œæˆäº†æˆæƒæ“ä½œï¼Œä¹‹åå†ç‚¹å‡»Make CallæŒ‰é’®å°±ä¸ä¼šå†å¼¹å‡ºæƒé™ç”³è¯·å¯¹è¯æ¡†äº†ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥æ‹¨æ‰“ç”µè¯ã€‚é‚£å¯èƒ½ä½ ä¼šæ‹…å¿ƒï¼Œä¸‡ä¸€ä»¥åæˆ‘åˆåæ‚”äº†æ€ä¹ˆåŠï¼Ÿæ²¡æœ‰å…³ç³»ï¼Œç”¨æˆ·éšæ—¶éƒ½å¯ä»¥å°†æˆäºˆç¨‹åºçš„å±é™©æƒé™è¿›è¡Œå…³é—­ï¼Œè¿›å…¥`Settings/Apps/RuntimePermissionTest/Permissions`ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥å¯¹ä»»ä½•æˆäºˆè¿‡çš„å±é™©æƒé™è¿›è¡Œå…³é—­äº†ã€‚\n\n# è®¿é—®å…¶ä»–ç¨‹åºä¸­çš„æ•°æ®\n\nå†…å®¹æä¾›å™¨çš„ç”¨æ³•ä¸€èˆ¬æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ä½¿ç”¨ç°æœ‰çš„å†…å®¹æä¾›å™¨æ¥è¯»å–å’Œæ“ä½œç›¸åº”ç¨‹åºä¸­çš„æ•°æ®ï¼Œå¦ä¸€ç§æ˜¯åˆ›å»ºè‡ªå·±çš„å†…å®¹æä¾›å™¨ç»™ç¨‹åºçš„æ•°æ®æä¾›å¤–éƒ¨è®¿é—®æ¥å£ã€‚\n\nå¦‚æœä¸€ä¸ªåº”ç”¨ç¨‹åºé€šè¿‡å†…å®¹æä¾›å™¨å¯¹å…¶æ•°æ®æä¾›äº†å¤–éƒ¨è®¿é—®æ¥å£ï¼Œé‚£ä¹ˆä»»ä½•å…¶ä»–çš„åº”ç”¨ç¨‹åºå°±éƒ½å¯ä»¥å¯¹è¿™éƒ¨åˆ†æ•°æ®è¿›è¡Œè®¿é—®ã€‚Androidç³»ç»Ÿä¸­è‡ªå¸¦çš„ç”µè¯ç°¿ã€çŸ­ä¿¡ã€åª’ä½“åº“ç­‰ç¨‹åºéƒ½æä¾›äº†ç±»ä¼¼çš„è®¿é—®æ¥å£ï¼Œè¿™å°±ä½¿å¾—ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºå¯ä»¥å……åˆ†åœ°åˆ©ç”¨è¿™éƒ¨åˆ†æ•°æ®æ¥å®ç°æ›´å¥½çš„åŠŸèƒ½ã€‚\n\n## ContentResolverçš„åŸºæœ¬ç”¨æ³•\n\nå¯¹äºæ¯ä¸€ä¸ªåº”ç”¨ç¨‹åºæ¥è¯´ï¼Œå¦‚æœæƒ³è¦è®¿é—®å†…å®¹æä¾›å™¨ä¸­å…±äº«çš„æ•°æ®ï¼Œå°±ä¸€å®šè¦å€ŸåŠ©`ContentResolver`ç±»ï¼Œå¯ä»¥é€šè¿‡Contextä¸­çš„getContentResolveræ–¹æ³•è·å–åˆ°è¯¥ç±»çš„å®ä¾‹ã€‚\n\nContentResolverä¸­æä¾›äº†ä¸€ç³»åˆ—çš„æ–¹æ³•ç”¨äºå¯¹æ•°æ®è¿›è¡ŒCRUDæ“ä½œï¼Œå…¶ä¸­insertæ–¹æ³•ç”¨äºæ·»åŠ æ•°æ®ï¼Œupdateæ–¹æ³•ç”¨äºæ›´æ–°æ•°æ®ï¼Œdeleteæ–¹æ³•ç”¨äºåˆ é™¤æ•°æ®ï¼Œqueryæ–¹æ³•ç”¨äºæŸ¥è¯¢æ•°æ®ã€‚SQLiteDatabaseä¸­ä¹Ÿæ˜¯ä½¿ç”¨è¿™å‡ ä¸ªæ–¹æ³•æ¥è¿›è¡ŒCRUDæ“ä½œçš„ï¼Œåªä¸è¿‡å®ƒä»¬åœ¨æ–¹æ³•å‚æ•°ä¸Šç¨å¾®æœ‰ä¸€äº›åŒºåˆ«ã€‚\n\nä¸åŒäºSQLiteDatabaseï¼ŒContentResolverä¸­çš„å¢åˆ æ”¹æŸ¥æ–¹æ³•ä¸æ¥æ”¶è¡¨åå‚æ•°ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€ä¸ªUriå‚æ•°ä»£æ›¿ï¼Œè¿™ä¸ªå‚æ•°è¢«ç§°ä¸º**å†…å®¹URI**ã€‚å†…å®¹URIç»™å†…å®¹æä¾›å™¨ä¸­çš„æ•°æ®å»ºç«‹äº†å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå®ƒä¸»è¦ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šauthorityå’Œpathã€‚ï¼ˆå…¶å®è¿˜æœ‰ä¸€ä¸ªå›ºå®šçš„éƒ¨åˆ†ï¼Œæ˜¯å¤´éƒ¨åè®®å£°æ˜ï¼‰\n\nauthorityæ˜¯ç”¨äºå¯¹ä¸åŒçš„åº”ç”¨ç¨‹åºåšåŒºåˆ†çš„ï¼Œä¸€èˆ¬ä¸ºäº†é¿å…å†²çªï¼Œéƒ½ä¼šé‡‡ç”¨ç¨‹åºåŒ…åçš„æ–¹å¼æ¥è¿›è¡Œå‘½åã€‚æ¯”å¦‚æŸä¸ªç¨‹åºçš„åŒ…åæ˜¯`com.example.app`ï¼Œé‚£ä¹ˆè¯¥ç¨‹åºå¯¹åº”çš„`authority`å°±å¯ä»¥å‘½åä¸º`com.example.app.provider`ã€‚\n\npathåˆ™æ˜¯ç”¨äºå¯¹**åŒä¸€åº”ç”¨ç¨‹åºä¸­ä¸åŒçš„è¡¨**åšåŒºåˆ†çš„ï¼Œé€šå¸¸éƒ½ä¼šæ·»åŠ åˆ°authorityçš„åé¢ã€‚æ¯”å¦‚æŸä¸ªç¨‹åºçš„æ•°æ®åº“é‡Œå­˜åœ¨ä¸¤å¼ è¡¨ï¼štablelå’Œtable2ï¼Œè¿™æ—¶å°±å¯ä»¥å°†pathåˆ†åˆ«å‘½åä¸º`/tablel`å’Œ`/table2`ï¼Œç„¶åæŠŠ`authority`å’Œ`path`è¿›è¡Œç»„åˆï¼Œå†…å®¹`URI`å°±å˜æˆäº†`com.example.app.provider/table1`å’Œ`com.example.app.provider/table2`ã€‚ä¸è¿‡ï¼Œç›®å‰è¿˜å¾ˆéš¾è¾¨è®¤å‡ºè¿™ä¸¤ä¸ªå­—ç¬¦ä¸²å°±æ˜¯ä¸¤ä¸ªå†…å®¹URIï¼Œæˆ‘ä»¬è¿˜éœ€è¦**åœ¨å­—ç¬¦ä¸²çš„å¤´éƒ¨åŠ ä¸Šåè®®å£°æ˜**ã€‚å› æ­¤ï¼Œå†…å®¹URIæœ€æ ‡å‡†çš„æ ¼å¼å†™æ³•å¦‚ä¸‹ï¼š\n\n`content://com.example.app.provider/tablel`ï¼Œ`content://com.example.app.provider/table2`\n\nå‘ç°ï¼Œå†…å®¹URIå¯ä»¥éå¸¸æ¸…æ¥šåœ°è¡¨è¾¾å‡ºæˆ‘ä»¬æƒ³è¦è®¿é—®å“ªä¸ªç¨‹åºä¸­å“ªå¼ è¡¨é‡Œçš„æ•°æ®ã€‚ä¹Ÿæ­£æ˜¯å› æ­¤ï¼ŒContentResolverä¸­çš„å¢åˆ æ”¹æŸ¥æ–¹æ³•æ‰éƒ½æ¥æ”¶Uriå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå› ä¸ºå¦‚æœä½¿ç”¨è¡¨åçš„è¯ï¼Œç³»ç»Ÿå°†æ— æ³•å¾—çŸ¥æˆ‘ä»¬æœŸæœ›è®¿é—®çš„æ˜¯å“ªä¸ªåº”ç”¨ç¨‹åºé‡Œçš„è¡¨ã€‚\n\nåœ¨å¾—åˆ°äº†å†…å®¹URIå­—ç¬¦ä¸²ä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†å®ƒ**è§£ææˆUriå¯¹è±¡**æ‰å¯ä»¥ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚è§£æçš„æ–¹æ³•ä¹Ÿç›¸å½“ç®€å•ï¼Œåªéœ€è¦è°ƒç”¨`Uri.parse`æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š`Uri uri = Uri.parse(\"content://com.example.app.provider/table1\")`ã€‚ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªUriå¯¹è±¡æ¥æŸ¥è¯¢table1è¡¨ä¸­çš„æ•°æ®äº†ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\nCursor cursor = getContentResolver().query(\n    uri,\n    projection,\n    selection,\n    selectionArgs,\n    sortOrder);\n```\n\nè¿™äº›å‚æ•°å’ŒSQLiteDatabaseä¸­queryæ–¹æ³•é‡Œçš„å‚æ•°å¾ˆåƒï¼Œä½†æ€»ä½“æ¥è¯´è¦ç®€å•ä¸€äº›ï¼Œæ¯•ç«Ÿè¿™æ˜¯åœ¨è®¿é—®å…¶ä»–ç¨‹åºä¸­çš„æ•°æ®ï¼Œæ²¡å¿…è¦æ„å»ºè¿‡äºå¤æ‚çš„æŸ¥è¯¢è¯­å¥ã€‚\n\nqueryæ–¹æ³•çš„å‚æ•°è¯´æ˜ï¼š\n\n| queryæ–¹æ³•å‚æ•° | å¯¹åº”SQLéƒ¨åˆ†               | æè¿°                             |\n| ------------- | ------------------------- | -------------------------------- |\n| uri           | from table_name           | æŒ‡å®šæŸ¥è¯¢æŸä¸ªåº”ç”¨ç¨‹åºä¸‹çš„æŸä¸€å¼ è¡¨ |\n| projection    | select column1, column2   | æŒ‡å®šæŸ¥è¯¢çš„åˆ—å                   |\n| selection     | where column = value      | æŒ‡å®šwhereçš„çº¦æŸæ¡ä»¶              |\n| selectionArgs | -                         | ä¸ºwhereä¸­çš„å ä½ç¬¦æä¾›å…·ä½“çš„å€¼    |\n| sortOrder     | order by column1, column2 | æŒ‡å®šæŸ¥è¯¢ç»“æœçš„æ’åºæ–¹å¼           |\n\næŸ¥è¯¢å®Œæˆåè¿”å›çš„ä»ç„¶æ˜¯ä¸€ä¸ªCursorå¯¹è±¡ï¼Œè¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥å°†æ•°æ®ä»Cursorå¯¹è±¡ä¸­é€ä¸ªè¯»å–å‡ºæ¥äº†ã€‚è¯»å–çš„æ€è·¯ä»ç„¶æ˜¯é€šè¿‡ç§»åŠ¨æ¸¸æ ‡çš„ä½ç½®æ¥éå†Cursorçš„æ‰€æœ‰è¡Œï¼Œç„¶åå†å–å‡ºæ¯ä¸€è¡Œä¸­ç›¸åº”åˆ—çš„æ•°æ®ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\nif(cursor != null) {\n    while (cursor.moveToNext()) {\n        String column1 = cursor.getString(cursor.getColumnIndex(\"column1\"));\n        int column2 = cursor.getInt(cursor.getColumnIndex(\"column2\"));\n    }\n    cursor.close();\n}\n```\n\nå‘table1è¡¨æ·»åŠ æ•°æ®ï¼Œä»£ç å¦‚ä¸‹ï¼š\n\n```java\nContentValues values = new ContentValues();\nvalues.put(\"column1\", \"text\");\nvalues.put(\"column2\", 1);\ngetContentResolver().insert(uri, values);\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œä»ç„¶æ˜¯å°†å¾…æ·»åŠ çš„æ•°æ®ç»„è£…åˆ°ContentValuesä¸­ï¼Œç„¶åè°ƒç”¨ContentResolverçš„insertæ–¹æ³•ï¼Œå°†Uriå’ŒContentValuesä½œä¸ºå‚æ•°ä¼ å…¥å³å¯ã€‚\n\nç°åœ¨å¦‚æœæˆ‘ä»¬æƒ³è¦æ›´æ–°è¿™æ¡æ–°æ·»åŠ çš„æ•°æ®ï¼ŒæŠŠcolumn1çš„å€¼æ¸…ç©ºï¼Œå¯ä»¥å€ŸåŠ©ContentResolverçš„updateæ–¹æ³•å®ç°ã€‚ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\nContentValues values = new ContentValues();\nvalues.put(\"column1\", \"\");\ngetContentResolver().update(uri, values, \"column1 = ? and column2 = ?\",\n                            new String[] {\"text\", \"1\"});\n```\n\næ³¨æ„ä¸Šè¿°ä»£ç ä½¿ç”¨äº†selectionå’ŒselectionArgså‚æ•°æ¥å¯¹æƒ³è¦æ›´æ–°çš„æ•°æ®è¿›è¡Œçº¦æŸï¼Œä»¥é˜²æ­¢æ‰€æœ‰çš„è¡Œéƒ½ä¼šå—å½±å“ã€‚æœ€åï¼Œå¯ä»¥è°ƒç”¨ContentResolverçš„deleteæ–¹æ³•å°†è¿™æ¡æ•°æ®åˆ é™¤æ‰ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\ngetContentResolver().delete(uri, \"column2 = ?\", new String[] {\"1\"});\n```\n\nåˆ°è¿™é‡Œä¸ºæ­¢ï¼Œæˆ‘ä»¬å°±æŠŠContentResolverä¸­çš„å¢åˆ æ”¹æŸ¥æ–¹æ³•å…¨éƒ¨å­¦å®Œäº†ã€‚è¿™äº›çŸ¥è¯†å…¶å®å’ŒSQLiteDatabaseå¾ˆç±»ä¼¼ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„åªæœ‰uriè¿™ä¸ªå‚æ•°è€Œå·²ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±åˆ©ç”¨ç›®å‰æ‰€å­¦çš„çŸ¥è¯†ï¼Œçœ‹ä¸€çœ‹å¦‚ä½•è¯»å–ç³»ç»Ÿç”µè¯ç°¿ä¸­çš„è”ç³»äººä¿¡æ¯ã€‚\n\n## ç¤ºä¾‹ï¼šè¯»å–ç”µè¯ç°¿è”ç³»äºº\n\næ–°å»ºä¸€ä¸ªContactsTesté¡¹ç›®ã€‚\n\n`activity_main.xml`ï¼š\n\n```xml\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:orientation=\"vertical\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n    <ListView\n        android:id=\"@+id/contacts_view\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\">\n    </ListView>\n</LinearLayout>\n```\n\nMainActivityï¼š\n\n```java\npublic class MainActivity extends AppCompatActivity {\n    ArrayAdapter<String> adpter;\n    List<String> contactsList = new ArrayList<>();\n    \n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        // é¦–å…ˆè·å–ListViewæ§ä»¶çš„å®ä¾‹\n        ListView contactsView = (ListView) findViewById(R.id.contacts_view);\n        adapter = new ArrayAdapter<String>(this, android.R.layout.simple_list_item_1, contactsList);\n        // è®¾ç½®é…ç½®å™¨\n        contactsView.setAdapter(adapter);\n        \n        if (ContextCompat.checkSelfPermission(this, Manifest.permission.READ_CONTACTS) != PackageManager.PERMISSION_GRANTED) {\n            ActivityCompat.requestPermissions(this, new String[]{Manifest.permission.READ_CONTACTS}, 1);          \n        } else {\n            readContacts();\n        }\n    }\n    \n    private void readContacts() {\n        Cursor cursor = null;\n        try {\n            // æŸ¥è¯¢è”ç³»äººæ•°æ®\n            // ContactsContract.CommonDataKinds.Phoneç±»å·²ç»åšå¥½äº†å°è£…ï¼Œæä¾›äº†ä¸€ä¸ªCONTENT_URIå¸¸é‡\n            cursor = getContentResolver().query(ContactsContract.CommonDataKinds.Phone.CONTENT_URI, null, null, null, null);\n            if(cursor != null) {\n                while (cursor.moveToNext()) {\n                    // è·å–è”ç³»äººå§“å\n                    // DISPLAY_NAME å¯¹åº”è”ç³»äººåå­—è¿™ä¸€åˆ—\n                    String displayName = cursor.getString(cursor.getColumnIndex(ContactContract.CommonDataKinds.Phone.DISPLAY_NAME));\n                    // è·å–è”ç³»äººæ‰‹æœºå·\n                    // NUMBER å¯¹åº”è”ç³»äººæ‰‹æœºå·è¿™ä¸€åˆ—\n                    String number = cursor.getString(cursor.getColumnIndex(ContactsContract.CommonDataKinds.Phone.NUMBER));\n                    // æ·»åŠ åˆ°ListViewçš„æ•°æ®æºListå®¹å™¨ä¸­\n                    contactsList.add(displayName + \"\\n\" + number);\n                }\n                // é€šçŸ¥åˆ·æ–°ä¸€ä¸‹ListView\n                adapter.notifyDataSetChanged();\n            }\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            if (cursor != null) {\n                // åƒä¸‡ä¸è¦å¿˜è®°å…³é—­Cursorå¯¹è±¡\n                cursor.close();\n            }\n        }\n    }\n    @Override\n    public void onRequestPermissionResult(int requestCode, String[] permissions, int[] grantResults) {\n        switch (requestCode) {\n            case 1:\n                if (grantResults.length > 0 && grantResults[0] == PackageManager.PERMISSION_GRANTED) {\n                    readContacts();\n                } else {\n                    Toast.makeText(this, \"You denied the permission\", Toast.LENGTH_SHORT).show();\n                }\n                break;\n            default:\n        }\n    }\n}\n```\n\nè¯»å–ç³»ç»Ÿè”ç³»äººçš„æƒé™åƒä¸‡ä¸è¦å¿˜è®°åœ¨AndroidManifest.xmlä¸­å£°æ˜\n\n```xml\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    package=\"com.example.contactstest\">\n    <uses-permission android:name=\"android.permission.READ_CONTACTS\" />\n    ...\n</manifest>\n```\n\n# åˆ›å»ºè‡ªå·±çš„å†…å®¹æä¾›å™¨\n\nåœ¨è‡ªå·±çš„ç¨‹åºä¸­è®¿é—®å…¶ä»–åº”ç”¨ç¨‹åºçš„æ•°æ®ï¼Œæ€»ä½“æ¥è¯´æ€è·¯è¿˜æ˜¯éå¸¸ç®€å•çš„ï¼Œåªéœ€è¦è·å–åˆ°è¯¥åº”ç”¨ç¨‹åºçš„å†…å®¹URIï¼Œç„¶åå€ŸåŠ©ContentResolverè¿›è¡ŒCRUDæ“ä½œå°±å¯ä»¥äº†ã€‚å¯æ˜¯é‚£äº›æä¾›å¤–éƒ¨è®¿é—®æ¥å£çš„åº”ç”¨ç¨‹åºéƒ½æ˜¯å¦‚ä½•å®ç°è¿™ç§åŠŸèƒ½çš„å‘¢ï¼Ÿå®ƒä»¬åˆæ˜¯æ€æ ·ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ä½¿å¾—éšç§æ•°æ®ä¸ä¼šæ³„æ¼å‡ºå»ï¼Ÿ\n\n## åˆ›å»ºå†…å®¹æä¾›å™¨çš„æ­¥éª¤\n\nå‰é¢å·²ç»æåˆ°è¿‡ï¼Œå¦‚æœæƒ³è¦å®ç°è·¨ç¨‹åºå…±äº«æ•°æ®çš„åŠŸèƒ½ï¼Œå®˜æ–¹æ¨èçš„æ–¹å¼æ˜¯ä½¿ç”¨å†…å®¹æä¾›å™¨ï¼Œå¯ä»¥é€šè¿‡æ–°å»ºä¸€ä¸ªç±»å»ç»§æ‰¿ContentProviderçš„æ–¹å¼æ¥åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„å†…å®¹æä¾›å™¨ã€‚ContentProviderç±»ä¸­æœ‰6ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨å­ç±»ç»§æ‰¿å®ƒçš„æ—¶å€™ï¼Œéœ€è¦å°†è¿™6ä¸ªæ–¹æ³•å…¨éƒ¨é‡å†™ã€‚æ–°å»ºMyProviderç»§æ‰¿è‡ªContentProviderï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\npublic class MyProvider extends ContentProvider {\n    @Override\n    public boolean onCreate() {\n        return false;\n    }\n    @Override\n    public Cursor query(Uri uri, String[] projection, String selection, String[] selectionArgs, String sortOrder) {\n        return null;\n    }\n    @Override\n    public Uri insert(Uri uri, ContentValues values) {\n        return null;\n    }\n    @Override\n    public int update(Uri uri, ContentValues values, String selection, String[] selectionArgs) {\n        return 0;\n    }\n    @Override\n    public int delete(Uri uri, String selection, String[] selectionArgs) {\n        return 0;\n    }\n    @Override\n    public String getType(Uri uri) {\n        return null;\n    }\n}\n```\n\n1. onCreate()\n   1. åˆå§‹åŒ–å†…å®¹æä¾›å™¨çš„æ—¶å€™è°ƒç”¨ã€‚é€šå¸¸ä¼šåœ¨è¿™é‡Œå®Œæˆå¯¹æ•°æ®åº“çš„åˆ›å»ºå’Œå‡çº§ç­‰æ“ä½œï¼Œè¿”å›trueè¡¨ç¤ºå†…å®¹æä¾›å™¨åˆå§‹åŒ–æˆåŠŸï¼Œè¿”å›falseåˆ™è¡¨ç¤ºå¤±è´¥ã€‚æ³¨æ„ï¼Œåªæœ‰å½“å­˜åœ¨ContentResolverå°è¯•è®¿é—®æˆ‘ä»¬ç¨‹åºä¸­çš„æ•°æ®æ—¶ï¼Œå†…å®¹æä¾›å™¨æ‰ä¼šè¢«åˆå§‹åŒ–ã€‚\n2. query()\n   1. ä»å†…å®¹æä¾›å™¨ä¸­æŸ¥è¯¢æ•°æ®ã€‚ä½¿ç”¨uriå‚æ•°æ¥ç¡®å®šæŸ¥è¯¢å“ªå¼ è¡¨ï¼Œprojectionå‚æ•°ç”¨äºç¡®å®šæŸ¥è¯¢å“ªäº›åˆ—ï¼Œselectionå’ŒselectionArgså‚æ•°ç”¨äºçº¦æŸæŸ¥è¯¢å“ªäº›è¡Œï¼ŒsortOrderå‚æ•°ç”¨äºå¯¹ç»“æœè¿›è¡Œæ’åºï¼ŒæŸ¥è¯¢çš„ç»“æœå­˜æ”¾åœ¨Cursorå¯¹è±¡ä¸­è¿”å›ã€‚\n3. insert()\n   1. å‘å†…å®¹æä¾›å™¨ä¸­æ·»åŠ ä¸€æ¡æ•°æ®ã€‚ä½¿ç”¨uriå‚æ•°æ¥ç¡®å®šè¦æ·»åŠ åˆ°çš„è¡¨ï¼Œå¾…æ·»åŠ çš„æ•°æ®ä¿å­˜åœ¨valueså‚æ•°ä¸­ã€‚æ·»åŠ å®Œæˆåï¼Œè¿”å›ä¸€ä¸ªç”¨äºè¡¨ç¤ºè¿™æ¡æ–°è®°å½•çš„URIã€‚\n\n4. update()\n   1. æ›´æ–°å†…å®¹æä¾›å™¨ä¸­å·²æœ‰çš„æ•°æ®ã€‚ä½¿ç”¨uriå‚æ•°æ¥ç¡®å®šæ›´æ–°å“ªä¸€å¼ è¡¨ä¸­çš„æ•°æ®ï¼Œæ–°æ•°æ®ä¿å­˜åœ¨valueså‚æ•°ä¸­ï¼Œselectionå’ŒselectionArgså‚æ•°ç”¨äºçº¦æŸæ›´æ–°å“ªäº›è¡Œï¼Œå—å½±å“çš„è¡Œæ•°å°†ä½œä¸ºè¿”å›å€¼è¿”å›ã€‚\n\n5. delete()\n   1. ä»å†…å®¹æä¾›å™¨ä¸­åˆ é™¤æ•°æ®ã€‚ä½¿ç”¨uriå‚æ•°æ¥ç¡®å®šåˆ é™¤å“ªä¸€å¼ è¡¨ä¸­çš„æ•°æ®ï¼Œselectionå’ŒselectionArgs å‚æ•°ç”¨äºçº¦æŸåˆ é™¤å“ªäº›è¡Œï¼Œè¢«åˆ é™¤çš„è¡Œæ•°å°†ä½œä¸ºè¿”å›å€¼è¿”å›ã€‚\n\n6. getType()\n   1. æ ¹æ®ä¼ å…¥çš„å†…å®¹URIæ¥è¿”å›ç›¸åº”çš„MIMEç±»å‹ã€‚\n\n\nå¯ä»¥çœ‹åˆ°ï¼Œå‡ ä¹æ¯ä¸€ä¸ªæ–¹æ³•éƒ½ä¼šå¸¦æœ‰Uriè¿™ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°ä¹Ÿæ­£æ˜¯è°ƒç”¨ContentResolverçš„å¢åˆ æ”¹æŸ¥æ–¹æ³•æ—¶ä¼ é€’è¿‡æ¥çš„ã€‚è€Œç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä¼ å…¥çš„Uriå‚æ•°è¿›è¡Œè§£æï¼Œä»ä¸­åˆ†æå‡ºè°ƒç”¨æ–¹æœŸæœ›è®¿é—®çš„è¡¨å’Œæ•°æ®ã€‚å›é¡¾ä¸€ä¸‹ï¼Œä¸€ä¸ªæ ‡å‡†çš„å†…å®¹URIå†™æ³•æ˜¯è¿™æ ·çš„ï¼š`content://com.example.app.provider/table1`ã€‚è¿™å°±è¡¨ç¤ºè°ƒç”¨æ–¹æœŸæœ›è®¿é—®çš„æ˜¯`com.example.app`è¿™ä¸ªåº”ç”¨çš„table1è¡¨ä¸­çš„æ•°æ®ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨è¿™ä¸ªå†…å®¹URIçš„åé¢åŠ ä¸Šä¸€ä¸ª`id`ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š`content://com.example.app.provider/tablel/1`ã€‚è¿™å°±è¡¨ç¤ºè°ƒç”¨æ–¹æœŸæœ›è®¿é—®çš„æ˜¯`com.example.app`è¿™ä¸ªåº”ç”¨çš„`table1`è¡¨ä¸­idä¸º1çš„æ•°æ®ã€‚å†…å®¹URIçš„æ ¼å¼ä¸»è¦å°±åªæœ‰ä»¥ä¸Šä¸¤ç§ï¼Œä»¥è·¯å¾„ç»“å°¾å°±è¡¨ç¤ºæœŸæœ›è®¿é—®è¯¥è¡¨ä¸­æ‰€æœ‰çš„æ•°æ®ï¼Œä»¥idç»“å°¾å°±è¡¨ç¤ºæœŸæœ›è®¿é—®è¯¥è¡¨ä¸­æ‹¥æœ‰ç›¸åº”idçš„æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨é€šé…ç¬¦çš„æ–¹å¼æ¥åˆ†åˆ«åŒ¹é…è¿™ä¸¤ç§æ ¼å¼çš„å†…å®¹URIï¼Œè§„åˆ™å¦‚ä¸‹ï¼š\n\n* `*`ï¼Œè¡¨ç¤ºåŒ¹é…ä»»æ„é•¿åº¦çš„ä»»æ„å­—ç¬¦ï¼›\n* `#`ï¼Œè¡¨ç¤ºåŒ¹é…ä»»æ„é•¿åº¦çš„æ•°å­—ã€‚\n\næ‰€ä»¥ï¼Œä¸€ä¸ªèƒ½å¤ŸåŒ¹é…ä»»æ„è¡¨çš„å†…å®¹URIæ ¼å¼å°±å¯ä»¥å†™æˆï¼š`content://com.example.app.provider/*`ï¼Œè€Œä¸€ä¸ªèƒ½å¤ŸåŒ¹é…`table1`è¡¨ä¸­ä»»æ„ä¸€è¡Œæ•°æ®çš„å†…å®¹URIæ ¼å¼å°±å¯ä»¥å†™æˆï¼š`content://com.example.app.provider/table1/#`ã€‚\n\næ¥ç€ï¼Œæˆ‘ä»¬å†å€ŸåŠ©UriMatcherè¿™ä¸ªç±»å°±å¯ä»¥è½»æ¾åœ°å®ç°åŒ¹é…å†…å®¹URIçš„åŠŸèƒ½ã€‚UriMatcherä¸­æä¾›äº†ä¸€ä¸ªaddURIæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ¥æ”¶3ä¸ªå‚æ•°ï¼Œå¯ä»¥åˆ†åˆ«æŠŠauthorityã€pathå’Œä¸€ä¸ªè‡ªå®šä¹‰ä»£å·ä¼ è¿›å»ã€‚è¿™æ ·ï¼Œå½“è°ƒç”¨UriMatcherçš„matchæ–¹æ³•æ—¶ï¼Œå°±å¯ä»¥å°†ä¸€ä¸ªUriå¯¹è±¡ä¼ å…¥ï¼Œè¿”å›å€¼æ˜¯æŸä¸ªèƒ½å¤ŸåŒ¹é…è¿™ä¸ªUriå¯¹è±¡æ‰€å¯¹åº”çš„è‡ªå®šä¹‰ä»£å·ï¼Œåˆ©ç”¨è¿™ä¸ªä»£å·ï¼Œå°±å¯ä»¥åˆ¤æ–­å‡ºè°ƒç”¨æ–¹æœŸæœ›è®¿é—®çš„æ˜¯å“ªå¼ è¡¨ä¸­çš„æ•°æ®äº†ã€‚ä¿®æ”¹`MyProvider`ä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\npublic class MyProvider extends ContenProvider {\n    public static final int TABLE1_DIR = 0;\n    public static final int TABLE1_ITEM = 1;\n    public static final int TABLE2_DIR = 2;\n    public static final int TABLE2_ITEM = 3;\n    private static UriMatcher uriMatcher;\n    static {\n        uriMatcher = new UriMatcher(UriMatcher.NO_MATCH);\n        uriMatcher.addURI(\"com.example.app.provider\", \"table1\", TABLE1_DIR);\n        uriMatcher.addURI(\"com.example.app.provider \", \"table1/#\", TABLE1_ITEM);\n        uriMatcher.addURI(\"com.example.app.provider \", \"table2\", TABLE2_DIR);\n        uriMatcher.addURI(\"com.example.app.provider \", \"table2/#\", TABLE2_ITEM);\n    }\n    ...\n    @Override\n    public Cursor query(Uri uri, String[] projection, String selection, String[] selectionArgs, String sortOrder) {\n        switch (uriMatcher.match(uri)) {\n            case TABLE1_DIR:\n                break;\n            case TABLE1_ITEM:\n                break;\n            case TABLE2_DIR:\n                break;\n            case TABLE2_ITEM:\n                break;\n            default:\n                break;\n        }\n    }\n    ...\n}\n```\n\nå¯ä»¥çœ‹åˆ°ï¼ŒMyProviderä¸­æ–°å¢äº†4ä¸ªæ•´å‹å¸¸é‡ï¼Œå…¶ä¸­`TABLE1_DIR`è¡¨ç¤ºè®¿é—®`table1`è¡¨ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œ`TABLE1_ITEM`è¡¨ç¤ºè®¿é—®`table1`è¡¨ä¸­çš„å•æ¡æ•°æ®ï¼Œ`TABLE2_DIR`è¡¨ç¤ºè®¿é—®`table2`è¡¨ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œ`TABLE2_ITEM`è¡¨ç¤ºè®¿é—®`table2`è¡¨ä¸­çš„å•æ¡æ•°æ®ã€‚æ¥ç€åœ¨é™æ€ä»£ç å—é‡Œæˆ‘ä»¬åˆ›å»ºäº†UriMatcherçš„å®ä¾‹ï¼Œå¹¶è°ƒç”¨addURIæ–¹æ³•ï¼Œå°†æœŸæœ›åŒ¹é…çš„å†…å®¹URIæ ¼å¼ä¼ é€’è¿›å»ï¼Œæ³¨æ„è¿™é‡Œä¼ å…¥çš„è·¯å¾„å‚æ•°æ˜¯å¯ä»¥ä½¿ç”¨é€šé…ç¬¦çš„ã€‚ç„¶åå½“queryæ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œå°±ä¼šé€šè¿‡UriMatcherçš„matchæ–¹æ³•å¯¹ä¼ å…¥çš„Uriå¯¹è±¡è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœå‘ç°UriMatcherä¸­æŸä¸ªå†…å®¹URIæ ¼å¼æˆåŠŸåŒ¹é…äº†è¯¥Uriå¯¹è±¡ï¼Œåˆ™ä¼šè¿”å›ç›¸åº”çš„è‡ªå®šä¹‰ä»£å·ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥åˆ¤æ–­å‡ºè°ƒç”¨æ–¹æœŸæœ›è®¿é—®çš„åˆ°åº•æ˜¯ä»€ä¹ˆæ•°æ®äº†ã€‚\n\nä¸Šè¿°ä»£ç åªæ˜¯ä»¥queryæ–¹æ³•ä¸ºä¾‹åšäº†ä¸ªç¤ºèŒƒï¼Œå…¶å®insertã€updateã€deleteè¿™å‡ ä¸ªæ–¹æ³•çš„å®ç°ä¹Ÿæ˜¯å·®ä¸å¤šçš„ï¼Œå®ƒä»¬éƒ½ä¼šæºå¸¦Uriè¿™ä¸ªå‚æ•°ï¼Œç„¶ååŒæ ·åˆ©ç”¨UriMatcherçš„matchæ–¹æ³•åˆ¤æ–­å‡ºè°ƒç”¨æ–¹æœŸæœ›è®¿å‘çš„æ˜¯å“ªå¼ è¡¨ï¼Œå†å¯¹è¯¥è¡¨ä¸­çš„æ•°æ®è¿›è¡Œç›¸åº”çš„æ“ä½œå°±å¯ä»¥äº†ã€‚\n\né™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæ–¹æ³•ä¼šæ¯”è¾ƒé™Œç”Ÿï¼Œå³getTypeæ–¹æ³•ã€‚å®ƒæ˜¯æ‰€æœ‰çš„å†…å®¹æä¾›å™¨éƒ½å¿…é¡»æä¾›çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºè·å–Uriå¯¹è±¡æ‰€å¯¹åº”çš„MIMEç±»å‹ã€‚ä¸€ä¸ªå†…å®¹URIæ‰€å¯¹åº”çš„MIMEå­—ç¬¦ä¸²ä¸»è¦ç”±3éƒ¨åˆ†ç»„æˆï¼ŒAndroidå¯¹è¿™3ä¸ªéƒ¨åˆ†åšäº†å¦‚ä¸‹æ ¼å¼è§„å®šï¼š\n\n1. å¿…é¡»ä»¥vndå¼€å¤´ã€‚\n2. å¦‚æœå†…å®¹URIä»¥è·¯å¾„ç»“å°¾ï¼Œåˆ™åæ¥`android.cursor.dir/`ï¼Œå¦‚æœå†…å®¹URIä»¥idç»“å°¾ï¼Œåˆ™åæ¥ `android.cursor.item/`ã€‚\n3. æœ€åæ¥ä¸Š`vnd.<authority>.<path>`ã€‚\n\næ‰€ä»¥ï¼Œå¯¹äº`content://com.example.app.provider/table1`è¿™ä¸ªå†…å®¹URIï¼Œå®ƒæ‰€å¯¹åº”çš„MIMEç±»å‹å°±å¯ä»¥å†™æˆï¼š`vnd.android.cursor.dir/vnd.com.example.app.provider.table1`ã€‚å¯¹äº`content://com.example.app.provider/table1/1`è¿™ä¸ªå†…å®¹URIï¼Œå®ƒæ‰€å¯¹åº”çš„MIMEç±»å‹å°±å¯ä»¥å†™æˆï¼š`vnd.android.cursor.item/vnd.com.example.app.provider.table1`ã€‚\n\nç°åœ¨å¯ä»¥ç»§ç»­å®Œå–„MyProviderä¸­çš„å†…å®¹äº†ï¼Œè¿™æ¬¡æ¥å®ç°`getType()`æ–¹æ³•ä¸­çš„é€»è¾‘ï¼Œä»£ç å¦‚ä¸‹ï¼š\n\n```java\npublic class MyProvider extends ContentProvider {\n    ...\n    @Override\n    public String getType(Uri uri) {\n        switch (uriMatcher.match(uri)) {\n            case TABLE1_DIR:\n                return \"vnd.android.cursor.dir/vnd.com.example.app.provider.table1\";\n            case TABLE1_ITEM:\n                return \"vnd.android.cursor.item/vnd.com.example.app.provider.table1\";\n            case TABLE2_DIR:\n                return \"vnd.android.cursor.dir/vnd.com.example.app.provider.table2\";\n            case TABLE2_ITEM:\n                return \"vnd.android.cursor.item/vnd.com.example.app.provider.table2\";\n            default:\n                break;\n        }\n        return null;\n    }\n}\n```\n\nåˆ°è¿™é‡Œï¼Œä¸€ä¸ªå®Œæ•´çš„å†…å®¹æä¾›å™¨å°±åˆ›å»ºå®Œæˆäº†ï¼Œç°åœ¨ä»»ä½•ä¸€ä¸ªåº”ç”¨ç¨‹åºéƒ½å¯ä»¥ä½¿ç”¨ContentResolveræ¥è®¿é—®æˆ‘ä»¬ç¨‹åºä¸­çš„æ•°æ®ã€‚é‚£ä¹ˆå‰é¢æ‰€æåˆ°çš„ï¼Œå¦‚ä½•æ‰èƒ½ä¿è¯éšç§æ•°æ®ä¸ä¼šæ³„æ¼å‡ºå»å‘¢ï¼Ÿå…¶å®å¤šäºäº†å†…å®¹æä¾›å™¨çš„è‰¯å¥½æœºåˆ¶ï¼Œè¿™ä¸ªé—®é¢˜åœ¨ä¸çŸ¥ä¸è§‰ä¸­å·²ç»è¢«è§£å†³äº†ã€‚å› ä¸º**æ‰€æœ‰çš„CRUDæ“ä½œéƒ½ä¸€å®šè¦åŒ¹é…åˆ°ç›¸åº”çš„å†…å®¹URIæ ¼å¼æ‰èƒ½è¿›è¡Œ**ï¼Œè€Œæˆ‘ä»¬å½“ç„¶ä¸å¯èƒ½å‘UriMatcherä¸­æ·»åŠ éšç§æ•°æ®çš„URIï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†æ•°æ®æ ¹æœ¬æ— æ³•è¢«å¤–éƒ¨ç¨‹åºè®¿é—®åˆ°ï¼Œå®‰å…¨é—®é¢˜ä¹Ÿå°±ä¸å­˜åœ¨äº†ã€‚ä¸‹é¢å°±æ¥å®æˆ˜ä¸€ä¸‹ï¼ŒçœŸæ­£ä½“éªŒä¸€å›è·¨ç¨‹åºæ•°æ®å…±äº«çš„åŠŸèƒ½ã€‚\n\n## å®ç°è·¨ç¨‹åºæ•°æ®å…±äº«\n\nç®€å•èµ·è§ï¼Œè¿˜æ˜¯åœ¨DatabaseTesté¡¹ç›®çš„åŸºç¡€ä¸Šç»§ç»­å¼€å‘ï¼Œé€šè¿‡å†…å®¹æä¾›å™¨æ¥ç»™å®ƒåŠ å…¥å¤–éƒ¨è®¿é—®æ¥å£ã€‚æ‰“å¼€DatabaseTesté¡¹ç›®ï¼Œé¦–å…ˆå°†MyDatabaseHelperä¸­ä½¿ç”¨Toastå¼¹å‡ºåˆ›å»ºæ•°æ®åº“æˆåŠŸçš„æç¤ºå»é™¤æ‰ï¼Œå› ä¸ºè·¨ç¨‹åºè®¿é—®æ—¶ä¸èƒ½ç›´æ¥ä½¿ç”¨Toastã€‚æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ªå†…å®¹æä¾›å™¨ï¼Œå³å‡»`com.example.databasetest`åŒ…ï¼Œnewï¼Œotherï¼ŒContent Providerã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæˆ‘ä»¬å°†å†…å®¹æä¾›å™¨å‘½åä¸º`DatabaseProvider.authority`æŒ‡å®šä¸º`com.example.databasetest.provider`ï¼Œ`Exported`å±æ€§è¡¨ç¤ºæ˜¯å¦å…è®¸å¤–éƒ¨ç¨‹åºè®¿é—®æˆ‘ä»¬çš„å†…å®¹æä¾›å™¨ï¼Œ`Enabled`å±æ€§è¡¨ç¤ºæ˜¯å¦å¯ç”¨è¿™ä¸ªå†…å®¹æä¾›å™¨ã€‚å°†ä¸¤ä¸ªå±æ€§éƒ½å‹¾ä¸­ï¼Œç‚¹å‡»Finishå®Œæˆåˆ›å»ºã€‚\n\næ¥ç€ä¿®æ”¹DatabaseProviderä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹ï¼š\n\n```java\npublic class DatabaseProvider extends ContentProvider {\n    public static final int BOOK_DIR = 0;\n    public static final int BOOK_ITEM = 1;\n    public static final int CATEGORY_DIR = 2;\n    public static final int CATEGORY_ITEM = 3;\n    public static final String AUTHORITY = \"com.example.sqlitetest.provider\";\n    private static UriMatcher uriMatcher;\n    private MyDatabaseHelper dbHelper;\n    static {\n        uriMatcher = new UriMatcher(UriMatcher.NO_MATCH);\n        uriMatcher.addURI(AUTHORITY, \"book\", BOOK_DIR);\n        uriMatcher.addURI(AUTHORITY, \"book/#\", BOOK_ITEM);\n        uriMatcher.addURI(AUTHORITY, \"category\", CATEGORY_DIR);\n        uriMatcher.addURI(AUTHORITY, \"category/#\", CATEGORY_ITEM);\n    }\n    @Override\n    public boolean onCreate() {\n        dbHelper = new MyDatabaseHelper(getContext(), \"Bookstore.db\", null, 2);\n        return true;\n    }\n    @Override\n    public Cursor query(Uri uri, String[] projection, String selection, String[] selectionArgs, String sortOrder) {\n        // æŸ¥è¯¢æ•°æ®\n        SQLiteDatabase db = dbHelper.getReadableDatabase();\n        Cursor cursor = null;\n        switch (uriMatcher.match(uri)) {\n            case BOOK_DIR:\n                cursor = db.query(\"Book\", projection, selection, selectionArgs, null, null, sortOrder);\n                break;\n            case BOOK_ITEM:\n                String bookId = uri.getPathSegments().get(1);\n                cursor = db.query(\"Book\", projection, \"id = ?\", new String[] {bookId}, null, null, sortOrder);\n                break;\n            case CATEGORY_DIR:\n                cursor = db.query(\"Category\", projection, selection, selectionArgs, null, null, sortOrder);\n                break;\n            case CATEGORY_ITEM:\n                String categoryId = uri.getPathSegments().get(1);\n                cursor = db.query(\"Category\", projection, \"id = ?\", new String[] {categoryId}, null, null, sortOrder);\n                break;\n            default:\n                break;\n        }\n        return cursor;\n    }\n    @Override\n    public Uri insert(Uri uri, ContentValues values) {\n        // æ·»åŠ æ•°æ®\n        SQLiteDatabase db = dbHelper.getWritableDatabase();\n        Uri uriReturn = null;\n        switch (uriMatcher.match(uri)) {\n            case BOOK_DIR:\n            case BOOK_ITEM:\n                long newBookId = db.insert(\"Book\", null, values);\n                uriReturn = Uri.parse(\"content://\" + AUTHORITY + \"/book/\" + newBookId);\n                break;\n            case CATEGORY_DIR:\n            case CATEGORY_ITEM:\n                long newCategoryId = db.insert(\"Category\", null, values);\n                uriReturn = Uri.parse(\"content://\" + AUTHORITY + \"/category/\" + newCategoryId);\n                break;\n            default:\n                break;\n        }\n        return uriReturn;\n    }\n    @Override\n    public int update(Uri uri, ContentValues values, String selection, String[] selectionArgs) {\n        // æ›´æ–°æ•°æ®\n        SQLiteDatabase db = dbHelper.getWritableDatabase();\n        int updateRows = 0;\n        switch (uriMatcher.match(uri)) {\n            case BOOK_DIR:\n                updateRows = db.update(\"Book\", values, selection, selectionArgs);\n                break;\n            case BOOK_ITEM:\n                String bookId = uri.getPathSegments().get(1);\n                updateRows = db.update(\"Book\", values, \"id = ?\", new String[]{bookId});\n                break;\n            case CATEGORY_DIR:\n                updateRows = db.update(\"Category\", values, selection, selectionArgs);\n                break;\n            case CATEGORY_ITEM:\n                String categoryId = uri.getPathSegments().get(1);\n                updateRows = db.update(\"Category\", values, \"id = ?\", new String[]{categoryId});\n                break;\n            default:\n                break;\n        }\n        return updateRows;\n    }\n    @Override\n    public int delete(Uri uri, String selection, String[] selectionArgs) {\n        // åˆ é™¤æ•°æ®\n        SQLiteDatabase db = dbHelper.getWritableDatabase();\n        int deleteRows = 0;\n        switch (uriMatcher.match(uri)) {\n            case BOOK_DIR:\n                deleteRows = db.delete(\"Book\", selection, selectionArgs);\n                break;\n            case BOOK_ITEM:\n                String bookId = uri.getPathSegments().get(1);\n                deleteRows = db.delete(\"Book\", \"id = ?\", new String[]{bookId});\n                break;\n            case CATEGORY_DIR:\n                deleteRows = db.delete(\"Category\", selection, selectionArgs);\n                break;\n            case CATEGORY_ITEM:\n                String categoryId = uri.getPathSegments().get(1);\n                deleteRows = db.delete(\"Category\", \"id = ?\", new String[]{categoryId});\n                break;\n            default:\n                break;\n        }\n        return deleteRows;\n    }\n    @Override\n    public String getType(Uri uri) {\n        switch (uriMatcher.match(uri)) {\n            case BOOK_DIR:\n                return \"vnd.android.cursor.dir/vnd.com.example.sqlitetest.provider.book\";\n            case BOOK_ITEM:\n                return \"vnd.android.cursor.item/vnd.com.example.sqlitetest.provider.book\";\n            case CATEGORY_DIR:\n                return \"vnd.android.cursor.dir/vnd.com.example.sqlitetest.provider.category\";\n            case CATEGORY_ITEM:\n                return \"vnd.android.cursor.item/vnd.com.example.sqlitetest.provider.category\";\n        }\n        return null;\n    }\n}\n```\n\nä»£ç è™½ç„¶å¾ˆé•¿ï¼Œä½†æ˜¯è¿™äº›å†…å®¹éƒ½éå¸¸å®¹æ˜“ç†è§£ï¼Œå› ä¸ºä½¿ç”¨åˆ°çš„å…¨éƒ¨éƒ½æ˜¯ä¸Šé¢çš„çŸ¥è¯†ã€‚é¦–å…ˆåœ¨ç±»çš„ä¸€å¼€å§‹ï¼ŒåŒæ ·æ˜¯å®šä¹‰äº†4ä¸ªå¸¸é‡ï¼Œåˆ†åˆ«ç”¨äºè¡¨ç¤ºè®¿é—®Bookè¡¨ä¸­çš„æ‰€æœ‰æ•°æ®ã€è®¿é—®Bookè¡¨ä¸­çš„å•æ¡æ•°æ®ã€è®¿é—®Categoryè¡¨ä¸­çš„æ‰€æœ‰æ•°æ®å’Œè®¿é—®Categoryè¡¨ä¸­çš„å•æ¡æ•°æ®ã€‚ç„¶ååœ¨é™æ€ä»£ç å—é‡Œå¯¹UriMatcherè¿›è¡Œäº†åˆå§‹åŒ–æ“ä½œï¼Œå°†æœŸæœ›åŒ¹é…çš„å‡ ç§URIæ ¼å¼æ·»åŠ äº†è¿›å»ã€‚\n\næ¥ä¸‹æ¥å°±æ˜¯æ¯ä¸ªæŠ½è±¡æ–¹æ³•çš„å…·ä½“å®ç°äº†ï¼Œå…ˆæ¥çœ‹ä¸‹onCreateæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä»£ç å¾ˆçŸ­ï¼Œå°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªMyDatabaseHelperçš„å®ä¾‹ï¼Œç„¶åè¿”å›trueè¡¨ç¤ºå†…å®¹æä¾›å™¨åˆå§‹åŒ–æˆåŠŸï¼Œè¿™æ—¶æ•°æ®åº“å°±å·²ç»å®Œæˆäº†åˆ›å»ºæˆ–å‡çº§æ“ä½œã€‚\n\næ¥ç€çœ‹ä¸€ä¸‹queryæ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­å…ˆè·å–åˆ°äº†SQLiteDatabaseçš„å®ä¾‹ï¼Œç„¶åæ ¹æ®ä¼ å…¥çš„Uriå‚æ•°åˆ¤æ–­å‡ºç”¨æˆ·æƒ³è¦è®¿é—®å“ªå¼ è¡¨ï¼Œå†è°ƒç”¨SQLiteDatabaseçš„queryè¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶å°†Cursorå¯¹è±¡è¿”å›å°±å¥½äº†ã€‚æ³¨æ„å½“è®¿é—®å•æ¡æ•°æ®çš„æ—¶å€™æœ‰ä¸€ä¸ªç»†èŠ‚ï¼Œè¿™é‡Œè°ƒç”¨äº†Uriå¯¹è±¡çš„getPathSegmentsæ–¹æ³•ï¼Œå®ƒä¼šå°†å†…å®¹URIæƒé™ä¹‹åçš„éƒ¨åˆ†ä»¥`\"/\"`ç¬¦å·è¿›è¡Œåˆ†å‰²ï¼Œå¹¶æŠŠåˆ†å‰²åçš„ç»“æœæ”¾å…¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ä¸­ï¼Œé‚£è¿™ä¸ªåˆ—è¡¨çš„ç¬¬0ä¸ªä½ç½®å­˜æ”¾çš„å°±æ˜¯è·¯å¾„ï¼Œç¬¬1ä¸ªä½ç½®å­˜æ”¾çš„å°±æ˜¯idäº†ã€‚å¾—åˆ°äº†idä¹‹åï¼Œå†é€šè¿‡selectionå’ŒselectionArgså‚æ•°è¿›è¡Œçº¦æŸï¼Œå°±å®ç°äº†æŸ¥è¯¢å•æ¡æ•°æ®çš„åŠŸèƒ½ã€‚\n\nå†å¾€åå°±æ˜¯ insertæ–¹æ³•ï¼ŒåŒæ ·å®ƒä¹Ÿæ˜¯å…ˆè·å–åˆ°äº†SQLiteDatabaseçš„å®ä¾‹ã€ç„¶åæ ¹æ®ä¼ å…¥çš„Uriå‚æ•°åˆ¤æ–­å‡ºç”¨æˆ·æƒ³è¦å¾€å“ªå¼ è¡¨é‡Œæ·»åŠ æ•°æ®ã€‚å†è°ƒç”¨SQLiteDatabaseçš„insertæ–¹æ³•è¿›è¡Œæ·»åŠ å°±å¯ä»¥äº†ã€‚æ³¨æ„insertæ–¹æ³•è¦æ±‚è¿”å›ä¸€ä¸ªèƒ½å¤Ÿè¡¨ç¤ºè¿™æ¡æ–°å¢æ•°æ®çš„URIï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦è°ƒç”¨`Uri.parse`æ–¹æ³•æ¥å°†ä¸€ä¸ªå†…å®¹URIè§£ææˆUriå¯¹è±¡ï¼Œå½“ç„¶è¿™ä¸ªå†…å®¹URIæ˜¯ä»¥æ–°å¢æ•°æ®çš„idç»“å°¾çš„ã€‚\n\næ¥ä¸‹æ¥å°±æ˜¯updateæ–¹æ³•äº†ï¼Œä¹Ÿæ˜¯å…ˆè·å–SQLiteDatabaseçš„å®ä¾‹ã€‚ç„¶åæ ¹æ®ä¼ å…¥çš„Uriå‚æ•°åˆ¤æ–­å‡ºç”¨æˆ·æƒ³è¦æ›´æ–°å“ªå¼ è¡¨é‡Œçš„æ•°æ®ï¼Œå†è°ƒç”¨SQLiteDatabaseçš„updateæ–¹æ³•è¿›è¡Œæ›´æ–°å°±å¥½äº†ï¼Œå—å½±å“çš„è¡Œæ•°å°†ä½œä¸ºè¿”å›å€¼è¿”å›ã€‚\n\nä¸‹é¢æ˜¯deleteæ–¹æ³•ï¼Œä»ç„¶æ˜¯å…ˆè·å–åˆ°SQLiteDatabaseçš„å®ä¾‹ï¼Œç„¶åæ ¹æ®ä¼ å…¥çš„Uriå‚æ•°åˆ¤æ–­å‡ºç”¨æˆ·æƒ³è¦åˆ é™¤å“ªå¼ è¡¨é‡Œçš„æ•°æ®ï¼Œå†è°ƒç”¨SQLiteDatabaseçš„deleteæ–¹æ³•è¿›è¡Œåˆ é™¤å°±å¥½äº†ï¼Œè¢«åˆ é™¤çš„è¡Œæ•°å°†ä½œä¸ºè¿”å›å€¼è¿”å›ã€‚\n\næœ€åæ˜¯getTypeæ–¹æ³•ã€‚è¿™æ ·æˆ‘ä»¬å°±å°†å†…å®¹æä¾›å™¨ä¸­çš„ä»£ç å…¨éƒ¨ç¼–å†™å®Œäº†ã€‚å¦å¤–è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œå†…å®¹æä¾›å™¨ä¸€å®šè¦åœ¨AndroidManifest.xmlæ–‡ä»¶ä¸­æ³¨å†Œæ‰å¯ä»¥ä½¿ç”¨ã€‚ä¸è¿‡å¹¸è¿çš„æ˜¯ï¼Œç”±äºæˆ‘ä»¬æ˜¯ä½¿ç”¨Android Studioçš„å¿«æ·æ–¹å¼åˆ›å»ºçš„å†…å®¹æä¾›å™¨ï¼Œå› æ­¤æ³¨å†Œè¿™ä¸€æ­¥å·²ç»è¢«è‡ªåŠ¨å®Œæˆäº†ã€‚æ‰“å¼€AndroidManifest.xmlæ–‡ä»¶ç§ä¸€ç§ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    package=\"com.example.sqlitetest\">\n\n    <application\n        android:allowBackup=\"true\"\n        android:icon=\"@mipmap/ic_launcher\"\n        android:label=\"@string/app_name\"\n        android:roundIcon=\"@mipmap/ic_launcher_round\"\n        android:supportsRtl=\"true\"\n        android:theme=\"@style/Theme.SQLiteTest\">\n        <provider\n            android:name=\".DatabaseProvider\"\n            android:authorities=\"com.example.sqlitetest.provider\"\n            android:enabled=\"true\"\n            android:exported=\"true\"></provider>\n\n        <activity\n            android:name=\".MainActivity\"\n            android:exported=\"true\">\n            <intent-filter>\n                <action android:name=\"android.intent.action.MAIN\" />\n\n                <category android:name=\"android.intent.category.LAUNCHER\" />\n            </intent-filter>\n        </activity>\n    </application>\n\n</manifest>\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œ`<application>`æ ‡ç­¾å†…å‡ºç°äº†ä¸€ä¸ªæ–°çš„æ ‡ç­¾`<provider>`ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒæ¥å¯¹`DatabaseProvider`è¿™ä¸ªå†…å®¹æä¾›å™¨è¿›è¡Œæ³¨å†Œã€‚`android:name`å±æ€§æŒ‡å®šäº†`DatabaseProvider`çš„ç±»åï¼Œ`android:authorities`å±æ€§æŒ‡å®šäº†DatabaseProviderçš„authorityï¼Œè€Œenabledå’Œexportedå±æ€§åˆ™æ˜¯æ ¹æ®æˆ‘ä»¬åˆšæ‰å‹¾é€‰çš„çŠ¶æ€è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œè¿™é‡Œè¡¨ç¤ºå…è®¸DatabaseProviderè¢«å…¶ä»–åº”ç”¨ç¨‹åºè¿›è¡Œè®¿é—®ã€‚\n\nç°åœ¨DatabaseTestè¿™ä¸ªé¡¹ç›®å°±å·²ç»æ‹¥æœ‰äº†è·¨ç¨‹åºå…±äº«æ•°æ®çš„åŠŸèƒ½äº†ï¼Œæˆ‘ä»¬èµ¶å¿«æ¥å°è¯•ä¸€ä¸‹ã€‚é¦–å…ˆéœ€è¦å°†DatabaseTestç¨‹åºåˆ é™¤æ‰ï¼Œä»¥é˜²æ­¢é—ç•™æ•°æ®å¯¹æˆ‘ä»¬é€ æˆå¹²æ‰°ã€‚ç„¶åè¿è¡Œä¸€ä¸‹é¡¹ç›®ï¼Œå°†DatabaseTestç¨‹åºé‡æ–°å®‰è£…åœ¨æ¨¡æ‹Ÿå™¨ä¸Šäº†ã€‚æ¥ç€å…³é—­æ‰DatabaseTestè¿™ä¸ªé¡¹ç›®å¹¶åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ProviderTestæˆ‘ä»¬å°±å°†é€šè¿‡è¿™ä¸ªç¨‹åºå»è®¿é—®DatabaseTestä¸­çš„æ•°æ®ã€‚\n\nå…ˆæ¥ç¼–å†™ä¸€ä¸‹å¸ƒå±€æ–‡ä»¶ï¼Œä¿®æ”¹`activity_main.xml`ä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:orientation=\"vertical\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\" >\n    <Button\n        android:id=\"@+id/add_data\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Add To Book\">\n    </Button>\n    <Button\n        android:id=\"@+id/update_data\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Update Book\">\n    </Button>\n    <Button\n        android:id=\"@+id/delete_data\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Delete From Book\">\n    </Button>\n    <Button\n        android:id=\"@+id/query_data\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Query From Book\">\n    </Button>\n</LinearLayout>\n```\n\nå¸ƒå±€æ–‡ä»¶å¾ˆç®€å•ã€é‡Œé¢æ”¾ç½®äº†4ä¸ªæŒ‰é’®ï¼Œåˆ†åˆ«ç”¨äºæ·»åŠ ã€æŸ¥è¯¢ã€ä¿®æ”¹å’Œåˆ é™¤æ•°æ®ã€‚ç„¶åä¿®æ”¹MainActivityä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\npublic class MainActivity extends AppCompatActivity {\n    private String newId;\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n\n        Button addData = (Button) findViewById(R.id.add_data);\n        addData.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                Uri uri = Uri.parse(\"content://com.example.sqlitetest.provider/book\");\n                ContentValues values = new ContentValues();\n                values.put(\"name\", \"A Clash of Kings\");\n                values.put(\"author\", \"George Martin\");\n                values.put(\"pages\", 1040);\n                values.put(\"price\", 22.85);\n                Uri newUri = getContentResolver().insert(uri, values);\n                newId = newUri.getPathSegments().get(1);\n            }\n        });\n\n        Button updateData = (Button) findViewById(R.id.update_data);\n        updateData.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                Uri uri = Uri.parse(\"content://com.example.sqlitetest.provider/book\");\n                ContentValues values = new ContentValues();\n                values.put(\"name\", \"A Storm of Swords\");\n                values.put(\"pages\", 1216);\n                values.put(\"price\", 24.05);\n                getContentResolver().update(uri, values, null, null);\n            }\n        });\n\n        Button deleteData = (Button) findViewById(R.id.delete_data);\n        deleteData.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View view) {\n                Uri uri = Uri.parse(\"content://com.example.sqlitetest.provider/book\");\n                getContentResolver().delete(uri, null, null);\n            }\n        });\n\n        Button queryData = (Button) findViewById(R.id.query_data);\n        queryData.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View view) {\n                Uri uri = Uri.parse(\"content://com.example.sqlitetest.provider/book\");\n                Cursor cursor = getContentResolver().query(uri, null, null, null, null, null);\n                if(cursor != null) {\n                    while(cursor.moveToNext()) {\n                        String name = cursor.getString(cursor.getColumnIndex(\"name\"));\n                        String author = cursor.getString(cursor.getColumnIndex(\"author\"));\n                        int pages = cursor.getInt(cursor.getColumnIndex(\"pages\"));\n                        double price = cursor.getDouble(cursor.getColumnIndex(\"price\"));\n                        Log.d(\"MainActivity\", \"book name is \" + name);\n                        Log.d(\"MainActivity\", \"book author is \" + author);\n                        Log.d(\"MainActivity\", \"book pages is \" + pages);\n                        Log.d(\"MainActivity\", \"book price is \" + price);\n                    }\n                    cursor.close();\n                }\n            }\n        });\n    }\n}\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åˆ†åˆ«åœ¨è¿™4ä¸ªæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶é‡Œé¢å¤„ç†äº†å¢åˆ æ”¹æŸ¥çš„é€»è¾‘ã€‚æ·»åŠ æ•°æ®çš„æ—¶å€™ï¼Œé¦–å…ˆè°ƒç”¨äº†Uri.parseæ–¹æ³•å°†ä¸€ä¸ªå†…å®¹URIè§£ææˆUriå¯¹è±¡ï¼Œç„¶åæŠŠè¦æ·»åŠ çš„æ•°æ®éƒ½å­˜æ”¾åˆ°ContentValueså¯¹è±¡ä¸­ï¼Œæ¥ç€è°ƒç”¨ContentResolverçš„insertæ–¹æ³•æ‰§è¡Œæ·»åŠ æ“ä½œå°±å¯ä»¥äº†ã€‚æ³¨æ„insertæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªUriå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¸­åŒ…å«äº†æ–°å¢æ•°æ®çš„idï¼Œæˆ‘ä»¬é€šè¿‡getPathSegmentsæ–¹æ³•å°†è¿™ä¸ªidå–å‡ºï¼Œç¨åä¼šç”¨åˆ°å®ƒã€‚\n\næŸ¥è¯¢æ•°æ®çš„æ—¶å€™ï¼ŒåŒæ ·æ˜¯è°ƒç”¨äº†Uri.parseæ–¹æ³•å°†ä¸€ä¸ªå†…å®¹URIè§£ææˆUriå¯¹è±¡ï¼Œç„¶åè°ƒç”¨ContentResolverçš„queryæ–¹æ³•å»æŸ¥è¯¢æ•°æ®ï¼ŒæŸ¥è¯¢çš„ç»“æœå½“ç„¶è¿˜æ˜¯å­˜æ”¾åœ¨Cursorå¯¹è±¡ä¸­çš„ã€‚ä¹‹åå¯¹Cursorè¿›è¡Œéå†ï¼Œä»ä¸­å–å‡ºæŸ¥è¯¢ç»“æœï¼Œå¹¶æ‰“å°å‡ºæ¥ã€‚\n\næ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯å…ˆå°†å†…å®¹URIè§£ææˆUriå¯¹è±¡ï¼Œç„¶åæŠŠæƒ³è¦æ›´æ–°çš„æ•°æ®å­˜æ”¾åˆ°ContentValueså¯¹è±¡ä¸­ï¼Œå†è°ƒç”¨ContentResolverçš„updateæ–¹æ³•æ‰§è¡Œæ›´æ–°æ“ä½œå°±å¯ä»¥äº†ã€‚\n\næ³¨æ„è¿™é‡Œæˆ‘ä»¬ä¸ºäº†ä¸æƒ³è®©Bookè¡¨ä¸­çš„å…¶ä»–è¡Œå—åˆ°å½±å“ï¼Œåœ¨è°ƒç”¨Uri.parseæ–¹æ³•æ—¶ï¼Œç»™å†…å®¹URIçš„å°¾éƒ¨å¢åŠ äº†ä¸€ä¸ªidï¼Œè€Œè¿™ä¸ªidæ­£æ˜¯æ·»åŠ æ•°æ®æ—¶æ‰€è¿”å›çš„ã€‚è¿™å°±è¡¨ç¤ºæˆ‘ä»¬åªå¸Œæœ›æ›´æ–°åˆšåˆšæ·»åŠ çš„é‚£æ¡æ•°æ®ï¼ŒBookè¡¨ä¸­çš„å…¶ä»–è¡Œéƒ½ä¸ä¼šå—å½±å“ã€‚\n\nåˆ é™¤æ•°æ®çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯ä½¿ç”¨åŒæ ·çš„æ–¹æ³•è§£æäº†ä¸€ä¸ªä»¥idç»“å°¾çš„å†…å®¹URIï¼Œç„¶åè°ƒç”¨ContentResolverçš„deleteæ–¹æ³•æ‰§è¡Œåˆ é™¤æ“ä½œå°±å¯ä»¥äº†ã€‚ç”±äºæˆ‘ä»¬åœ¨å†…å®¹URIé‡ŒæŒ‡å®šäº†ä¸€ä¸ªidï¼Œå› æ­¤åªä¼šåˆ æ‰æ‹¥æœ‰ç›¸åº”idçš„é‚£è¡Œæ•°æ®ï¼ŒBookè¡¨ä¸­çš„å…¶ä»–æ•°æ®éƒ½ä¸ä¼šå—å½±å“ã€‚\n","categories":["Android"]},{"title":"Android_æ•°æ®å’Œæ–‡ä»¶å­˜å‚¨","url":"/Android/Android_æ•°æ®å’Œæ–‡ä»¶å­˜å‚¨/","content":"\n# æ•°æ®å’Œæ–‡ä»¶å­˜å‚¨æ¦‚è§ˆ\n\nAndroidä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿç±»ä¼¼äºå…¶ä»–å¹³å°ä¸ŠåŸºäºç£ç›˜çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæä¾›äº†ä»¥ä¸‹å‡ ç§ä¿å­˜åº”ç”¨æ•°æ®çš„é€‰é¡¹ï¼š\n\n- **åº”ç”¨ä¸“å±å­˜å‚¨ç©ºé—´**ï¼šå­˜å‚¨ä»…ä¾›åº”ç”¨ä½¿ç”¨çš„æ–‡ä»¶ï¼Œå¯ä»¥å­˜å‚¨åˆ°å†…éƒ¨å­˜å‚¨å·ä¸­çš„ä¸“å±ç›®å½•æˆ–å¤–éƒ¨å­˜å‚¨ç©ºé—´ä¸­çš„å…¶ä»–ä¸“å±ç›®å½•ã€‚ä½¿ç”¨å†…éƒ¨å­˜å‚¨ç©ºé—´ä¸­çš„ç›®å½•ä¿å­˜å…¶ä»–åº”ç”¨ä¸åº”è®¿é—®çš„æ•æ„Ÿä¿¡æ¯ã€‚\n- **å…±äº«å­˜å‚¨**ï¼šå­˜å‚¨ä¸å…¶ä»–åº”ç”¨å…±äº«çš„æ–‡ä»¶ï¼ŒåŒ…æ‹¬åª’ä½“ã€æ–‡æ¡£å’Œå…¶ä»–æ–‡ä»¶ã€‚\n- **åå¥½è®¾ç½®**ï¼šä»¥é”®å€¼å¯¹å½¢å¼å­˜å‚¨ç§æœ‰åŸå§‹æ•°æ®ã€‚\n- **æ•°æ®åº“**ï¼šä½¿ç”¨RoomæŒä¹…æ€§åº“å°†ç»“æ„åŒ–æ•°æ®å­˜å‚¨åœ¨ä¸“ç”¨æ•°æ®åº“ä¸­ã€‚\n\nä¸‹è¡¨æ±‡æ€»äº†è¿™äº›é€‰é¡¹çš„ç‰¹ç‚¹ï¼š\n\n||å†…å®¹ç±»å‹|è®¿é—®æ–¹æ³•|æ‰€éœ€æƒé™|å…¶ä»–åº”ç”¨æ˜¯å¦å¯è®¿é—®| å¸è½½åº”ç”¨æ—¶æ˜¯å¦ç§»é™¤æ–‡ä»¶ |\n|-|-|-|-|-|-|\n|åº”ç”¨ä¸“å±æ–‡ä»¶|ä»…ä¾›åº”ç”¨ä½¿ç”¨çš„æ–‡ä»¶|ä»å†…éƒ¨å­˜å‚¨ç©ºé—´è®¿é—®ï¼Œå¯ä»¥ä½¿ç”¨`getFilesDir()`æˆ–`getCacheDir()`æ–¹æ³•ï¼›ä»å¤–éƒ¨å­˜å‚¨ç©ºé—´è®¿é—®ï¼Œå¯ä»¥ä½¿ç”¨`getExternalFilesDir()`æˆ–`getExternalCacheDir()`æ–¹æ³• | ä»å†…éƒ¨å­˜å‚¨ç©ºé—´è®¿é—®ä¸éœ€è¦ä»»ä½•æƒé™ã€‚å¦‚æœåº”ç”¨åœ¨æ­è½½Android 4.4ï¼ˆAPIçº§åˆ«19ï¼‰æˆ–æ›´é«˜ç‰ˆæœ¬çš„è®¾å¤‡ä¸Šè¿è¡Œï¼Œä»å¤–éƒ¨å­˜å‚¨ç©ºé—´è®¿é—®ä¸éœ€è¦ä»»ä½•æƒé™ |å¦|æ˜¯|\n| åª’ä½“ | å¯å…±äº«çš„åª’ä½“æ–‡ä»¶ï¼ˆå›¾ç‰‡ã€éŸ³é¢‘æ–‡ä»¶ã€è§†é¢‘ï¼‰ | `MediaStore` API                                             | åœ¨Android 11ï¼ˆAPIçº§åˆ«30ï¼‰æˆ–æ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œè®¿é—®å…¶ä»–åº”ç”¨çš„æ–‡ä»¶éœ€è¦`READ_EXTERNAL_STORAGE`åœ¨Android 10ï¼ˆAPIçº§åˆ«29ï¼‰ä¸­ï¼Œè®¿é—®å…¶ä»–åº”ç”¨çš„æ–‡ä»¶éœ€è¦`READ_EXTERNAL_STORAGE`æˆ–`WRITE_EXTERNAL_STORAGE`åœ¨Android 9ï¼ˆAPIçº§åˆ«28ï¼‰æˆ–æ›´ä½ç‰ˆæœ¬ä¸­ï¼Œè®¿é—®æ‰€æœ‰æ–‡ä»¶å‡éœ€è¦ç›¸å…³æƒé™ | æ˜¯ï¼Œä½†å…¶ä»–åº”ç”¨éœ€è¦`READ_EXTERNAL_STORAGE`æƒé™ | å¦                       |\n| æ–‡æ¡£å’Œå…¶ä»–æ–‡ä»¶ | å…¶ä»–ç±»å‹çš„å¯å…±äº«å†…å®¹ï¼ŒåŒ…æ‹¬å·²ä¸‹è½½çš„æ–‡ä»¶   | å­˜å‚¨è®¿é—®æ¡†æ¶                                                 | æ—                                                            | æ˜¯ï¼Œå¯ä»¥é€šè¿‡ç³»ç»Ÿæ–‡ä»¶é€‰æ‹©å™¨è®¿é—®                  | å¦                       |\n| åº”ç”¨åå¥½è®¾ç½® | é”®å€¼å¯¹                                   | Jetpack Preferencesåº“ | æ—                                                            | å¦                                              | æ˜¯                       |\n| æ•°æ®åº“                                                       | ç»“æ„åŒ–æ•°æ®                               | RoomæŒä¹…æ€§åº“ | æ—                                                            | å¦                                              | æ˜¯                       |\n\nåº”æ ¹æ®è‡ªå·±çš„å…·ä½“éœ€æ±‚é€‰æ‹©è§£å†³æ–¹æ¡ˆï¼š\n\n- æ•°æ®éœ€è¦å ç”¨å¤šå°‘ç©ºé—´ï¼Ÿ\n\n  å†…éƒ¨å­˜å‚¨ç©ºé—´ä¸­ç”¨äºå­˜å‚¨åº”ç”¨ä¸“å±æ•°æ®çš„ç©ºé—´æœ‰é™ã€‚å¦‚æœéœ€è¦ä¿å­˜å¤§é‡æ•°æ®ï¼Œåº”ä½¿ç”¨å…¶ä»–ç±»å‹çš„å­˜å‚¨ç©ºé—´ã€‚\n\n- æ•°æ®è®¿é—®éœ€è¦è¾¾åˆ°æ€æ ·çš„å¯é ç¨‹åº¦ï¼Ÿ\n\n  å¦‚æœåº”ç”¨çš„åŸºæœ¬åŠŸèƒ½éœ€è¦æŸäº›æ•°æ®ï¼ˆä¾‹å¦‚åº”ç”¨å¯åŠ¨æ—¶éœ€è¦çš„æ•°æ®ï¼‰ï¼Œå¯ä»¥å°†ç›¸åº”æ•°æ®å­˜æ”¾åˆ°å†…éƒ¨å­˜å‚¨ç›®å½•æˆ–æ•°æ®åº“ä¸­ã€‚å­˜å‚¨åœ¨å¤–éƒ¨å­˜å‚¨ç©ºé—´ä¸­çš„åº”ç”¨ä¸“å±æ–‡ä»¶å¹¶éä¸€ç›´å¯ä»¥è®¿é—®ï¼Œå› ä¸ºæœ‰äº›è®¾å¤‡å…è®¸ç”¨æˆ·ç§»é™¤å¤–éƒ¨å­˜å‚¨å®ä½“è®¾å¤‡ã€‚\n\n- éœ€è¦å­˜å‚¨å“ªç±»æ•°æ®ï¼Ÿ\n\n  å¦‚æœæ•°æ®ä»…ä¾›æ‚¨çš„åº”ç”¨ä½¿ç”¨ï¼Œåº”ä½¿ç”¨åº”ç”¨ä¸“å±å­˜å‚¨ç©ºé—´ã€‚å¯¹äºå¯åˆ†äº«çš„åª’ä½“å†…å®¹ï¼Œåº”ä½¿ç”¨å…±äº«çš„å­˜å‚¨ç©ºé—´ï¼Œä»¥ä¾¿å…¶ä»–åº”ç”¨å¯ä»¥è®¿é—®ç›¸åº”å†…å®¹ã€‚å¯¹äºç»“æ„åŒ–æ•°æ®ï¼Œåº”ä½¿ç”¨åå¥½è®¾ç½®ï¼ˆé€‚åˆé”®å€¼å¯¹æ•°æ®ï¼‰æˆ–æ•°æ®åº“ï¼ˆé€‚åˆåŒ…å«2ä¸ªä»¥ä¸Šåˆ—çš„æ•°æ®ï¼‰ã€‚\n\n- æ•°æ®æ˜¯å¦åº”ä»…ä¾›ä½ çš„åº”ç”¨ä½¿ç”¨ï¼Ÿ\n\n  åœ¨å­˜å‚¨æ•æ„Ÿæ•°æ®ï¼ˆä¸å¯é€šè¿‡ä»»ä½•å…¶ä»–åº”ç”¨è®¿é—®çš„æ•°æ®ï¼‰æ—¶ï¼Œåº”ä½¿ç”¨å†…éƒ¨å­˜å‚¨ç©ºé—´ã€åå¥½è®¾ç½®æˆ–æ•°æ®åº“ã€‚å†…éƒ¨å­˜å‚¨ç©ºé—´çš„ä¸€ä¸ªé¢å¤–ä¼˜åŠ¿æ˜¯ç”¨æˆ·æ— æ³•çœ‹åˆ°ç›¸åº”æ•°æ®ã€‚\n\n# å­˜å‚¨ä½ç½®çš„ç±»åˆ«\n\nAndroidæä¾›ä¸¤ç±»ç‰©ç†å­˜å‚¨ä½ç½®ï¼šå†…éƒ¨å­˜å‚¨ç©ºé—´å’Œå¤–éƒ¨å­˜å‚¨ç©ºé—´ã€‚åœ¨å¤§å¤šæ•°è®¾å¤‡ä¸Šï¼Œå†…éƒ¨å­˜å‚¨ç©ºé—´å°äºå¤–éƒ¨å­˜å‚¨ç©ºé—´ã€‚ä¸è¿‡ï¼Œæ‰€æœ‰è®¾å¤‡ä¸Šçš„å†…éƒ¨å­˜å‚¨ç©ºé—´éƒ½æ˜¯å§‹ç»ˆå¯ç”¨çš„ï¼Œå› æ­¤åœ¨å­˜å‚¨åº”ç”¨æ‰€ä¾èµ–çš„æ•°æ®æ—¶æ›´ä¸ºå¯é ã€‚\n\nå¯ç§»é™¤å·ï¼ˆä¾‹å¦‚SDå¡ï¼‰åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­å±äºå¤–éƒ¨å­˜å‚¨ç©ºé—´ã€‚Androidä½¿ç”¨è·¯å¾„ï¼ˆä¾‹å¦‚`/sdcard`ï¼‰è¡¨ç¤ºè¿™äº›å­˜å‚¨è®¾å¤‡ã€‚\n\n>æ³¨æ„ï¼šå¯ç”¨äºä¿å­˜æ–‡ä»¶çš„ç¡®åˆ‡ä½ç½®å¯èƒ½å› è®¾å¤‡è€Œå¼‚ã€‚å› æ­¤ï¼Œè¯·å‹¿ä½¿ç”¨ç¡¬ç¼–ç çš„æ–‡ä»¶è·¯å¾„ã€‚\n\né»˜è®¤æƒ…å†µä¸‹ï¼Œåº”ç”¨æœ¬èº«å­˜å‚¨åœ¨å†…éƒ¨å­˜å‚¨ç©ºé—´ä¸­ã€‚ä¸è¿‡ï¼Œå¦‚æœAPKéå¸¸å¤§ï¼Œä¹Ÿå¯ä»¥åœ¨åº”ç”¨çš„æ¸…å•æ–‡ä»¶ä¸­æŒ‡æ˜åå¥½è®¾ç½®ï¼Œä»¥ä¾¿å°†åº”ç”¨å®‰è£…åˆ°å¤–éƒ¨å­˜å‚¨ç©ºé—´ï¼š\n\n```xml\n<manifest ...\n    android:installLocation=\"preferExternal\" >\n    ...\n</manifest>\n```\n\n# å¯¹å¤–éƒ¨å­˜å‚¨ç©ºé—´çš„è®¿é—®å’Œæ‰€éœ€æƒé™\n\nAndroidå®šä¹‰äº†ä»¥ä¸‹ä¸å­˜å‚¨ç›¸å…³çš„æƒé™ï¼š`READ_EXTERNAL_STORAGE`ã€`WRITE_EXTERNAL_STORAGE`å’Œ `MANAGE_EXTERNAL_STORAGE`ã€‚\n\nåœ¨è¾ƒä½ç‰ˆæœ¬çš„Androidç³»ç»Ÿä¸­ï¼Œåº”ç”¨éœ€è¦å£°æ˜`READ_EXTERNAL_STORAGE`æƒé™æ‰èƒ½è®¿é—®ä½äºå¤–éƒ¨å­˜å‚¨ç©ºé—´ä¸­åº”ç”¨ä¸“å±ç›®å½•ä¹‹å¤–çš„ä»»ä½•æ–‡ä»¶ã€‚æ­¤å¤–ï¼Œåº”ç”¨éœ€è¦å£°æ˜`WRITE_EXTERNAL_STORAGE`æƒé™æ‰èƒ½å‘åº”ç”¨ä¸“å±ç›®å½•ä»¥å¤–çš„ä»»ä½•æ–‡ä»¶å†™å…¥æ•°æ®ã€‚\n\nAndroidç³»ç»Ÿçš„ç‰ˆæœ¬è¶Šæ–°ï¼Œå°±è¶Šä¾èµ–äºæ–‡ä»¶çš„ç”¨é€”è€Œä¸æ˜¯ä½ç½®æ¥ç¡®å®šåº”ç”¨å¯¹ç‰¹å®šæ–‡ä»¶çš„è®¿é—®å’Œå†™å…¥èƒ½åŠ›ã€‚ç‰¹åˆ«æ˜¯ï¼Œå¦‚æœåº”ç”¨ä»¥Android 11ï¼ˆAPIçº§åˆ«30ï¼‰æˆ–æ›´é«˜ç‰ˆæœ¬ä¸ºç›®æ ‡å¹³å°ï¼Œ`WRITE_EXTERNAL_STORAGE`æƒé™å®Œå…¨ä¸ä¼šå½±å“åº”ç”¨å¯¹å­˜å‚¨çš„è®¿é—®æƒé™ã€‚è¿™ç§åŸºäºç”¨é€”çš„å­˜å‚¨æ¨¡å‹å¯å¢å¼ºç”¨æˆ·éšç§ä¿æŠ¤ï¼Œå› ä¸ºåº”ç”¨åªèƒ½è®¿é—®å…¶åœ¨è®¾å¤‡æ–‡ä»¶ç³»ç»Ÿä¸­å®é™…ä½¿ç”¨çš„åŒºåŸŸã€‚\n\nAndroid 11å¼•å…¥äº†`MANAGE_EXTERNAL_STORAGE`æƒé™ï¼Œè¯¥æƒé™æä¾›å¯¹åº”ç”¨ä¸“å±ç›®å½•å’Œ`MediaStore`ä¹‹å¤–æ–‡ä»¶çš„å†™å…¥æƒé™ã€‚æ­¤æƒé™ä½¿å¤§å¤šæ•°åº”ç”¨æ— éœ€å£°æ˜æ­¤æƒé™å³å¯å®ç°å…¶ç”¨ä¾‹ï¼Œå‚é˜…æœ‰å…³å¦‚ä½•[ç®¡ç†å­˜å‚¨è®¾å¤‡ä¸Šæ‰€æœ‰æ–‡ä»¶](https://developer.android.com/training/data-storage/manage-all-files?hl=zh-cn)çš„æŒ‡å—ã€‚\n\n# åˆ†åŒºå­˜å‚¨\n\nä¸ºäº†è®©ç”¨æˆ·æ›´å¥½åœ°ç®¡ç†è‡ªå·±çš„æ–‡ä»¶å¹¶å‡å°‘æ··ä¹±ï¼Œä»¥Android 10ï¼ˆAPIçº§åˆ«29ï¼‰åŠæ›´é«˜ç‰ˆæœ¬ä¸ºç›®æ ‡å¹³å°çš„åº”ç”¨åœ¨é»˜è®¤æƒ…å†µä¸‹è¢«æˆäºˆäº†å¯¹å¤–éƒ¨å­˜å‚¨ç©ºé—´çš„åˆ†åŒºè®¿é—®æƒé™ï¼ˆå³åˆ†åŒºå­˜å‚¨ï¼‰ã€‚æ­¤ç±»åº”ç”¨åªèƒ½è®¿é—®å¤–éƒ¨å­˜å‚¨ç©ºé—´ä¸Šçš„åº”ç”¨ä¸“å±ç›®å½•ï¼Œä»¥åŠæœ¬åº”ç”¨æ‰€åˆ›å»ºçš„ç‰¹å®šç±»å‹çš„åª’ä½“æ–‡ä»¶ã€‚\n\n> æ³¨æ„ï¼šå¦‚æœåº”ç”¨åœ¨è¿è¡Œæ—¶è¯·æ±‚ä¸å­˜å‚¨ç©ºé—´ç›¸å…³çš„æƒé™ï¼Œé¢å‘ç”¨æˆ·çš„å¯¹è¯æ¡†ä¼šè¡¨æ˜åº”ç”¨æ­£åœ¨è¯·æ±‚å¯¹å¤–éƒ¨å­˜å‚¨å¹¿æ³›çš„è®¿é—®ï¼Œå³ä½¿å¯ç”¨åˆ†åŒºå­˜å‚¨ä¹Ÿæ˜¯å¦‚æ­¤ã€‚\n\né™¤éåº”ç”¨éœ€è¦è®¿é—®å­˜å‚¨åœ¨åº”ç”¨ä¸“å±ç›®å½•å’Œ`MediaStore` APIå¯ä»¥è®¿é—®çš„ç›®å½•ä¹‹å¤–çš„æ–‡ä»¶ï¼Œå¦åˆ™è¯·ä½¿ç”¨åˆ†åŒºå­˜å‚¨ã€‚å¦‚æœå°†åº”ç”¨ä¸“å±æ–‡ä»¶å­˜å‚¨åœ¨å¤–éƒ¨å­˜å‚¨ç©ºé—´ä¸­ï¼Œåˆ™å¯ä»¥å°†è¿™äº›æ–‡ä»¶å­˜æ”¾åœ¨å¤–éƒ¨å­˜å‚¨ç©ºé—´ä¸­çš„åº”ç”¨ä¸“å±ç›®å½•å†…ï¼Œä»¥ä¾¿æ›´åŠ è½»æ¾åœ°é‡‡ç”¨åˆ†åŒºå­˜å‚¨ã€‚è¿™æ ·ï¼Œåœ¨å¯ç”¨åˆ†åŒºå­˜å‚¨åï¼Œåº”ç”¨å°†å¯ä»¥ç»§ç»­è®¿é—®è¿™äº›æ–‡ä»¶ã€‚\n\nå¦‚éœ€åº”ç”¨é€‚åˆåˆ†åŒºå­˜å‚¨ï¼Œå‚é˜…[å­˜å‚¨ç”¨ä¾‹å’Œæœ€ä½³å®è·µ](https://developer.android.com/training/data-storage/use-cases?hl=zh-cn)æŒ‡å—ã€‚å¦‚åº”ç”¨æœ‰å…¶ä»–ç”¨ä¾‹æœªåŒ…å«åœ¨åˆ†åŒºå­˜å‚¨èŒƒå›´å†…ï¼Œè¯·[æäº¤åŠŸèƒ½è¯·æ±‚](https://source.android.com/setup/contribute/report-bugs?hl=zh-cn)ã€‚å¯ä»¥[æš‚æ—¶é€‰æ‹©åœç”¨åˆ†åŒºå­˜å‚¨](https://developer.android.com/training/data-storage/use-cases?hl=zh-cn#opt-out-scoped-storage)ã€‚\n\n# æ–‡ä»¶å­˜å‚¨\n\næ–‡ä»¶å­˜å‚¨ä¸å¯¹å­˜å‚¨çš„å†…å®¹è¿›è¡Œä»»ä½•æ ¼å¼åŒ–å¤„ç†ï¼Œæ‰€æœ‰æ•°æ®åŸå°ä¸åŠ¨åœ°ä¿å­˜åˆ°æ–‡ä»¶å½“ä¸­ï¼Œå› è€Œæ¯”è¾ƒé€‚åˆå­˜å‚¨ä¸€äº›ç®€å•çš„æ–‡æœ¬æ•°æ®æˆ–äºŒè¿›åˆ¶æ•°æ®ã€‚å¦‚æœæƒ³ä½¿ç”¨æ–‡ä»¶å­˜å‚¨çš„æ–¹å¼æ¥ä¿å­˜ä¸€äº›è¾ƒä¸ºå¤æ‚çš„ç»“æ„åŒ–æ•°æ®ï¼Œéœ€è¦å®šä¹‰ä¸€å¥—è‡ªå·±çš„æ ¼å¼è§„èŒƒï¼Œæ–¹ä¾¿ä¹‹åå°†æ•°æ®ä»æ–‡ä»¶ä¸­é‡æ–°è§£æå‡ºæ¥ã€‚\n\n## å†™å…¥åˆ°æ–‡ä»¶ä¸­\n\n`Context`ç±»ä¸­æä¾›äº†ä¸€ä¸ª`openFileOutput()`æ–¹æ³•ï¼Œå¯ä»¥ç”¨äºå°†æ•°æ®å­˜å‚¨åˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ã€‚æ­¤æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ–‡ä»¶åï¼Œåœ¨æ–‡ä»¶åˆ›å»ºçš„æ—¶å€™ä½¿ç”¨ï¼Œæ³¨æ„æ­¤æ–‡ä»¶åä¸å¯åŒ…å«è·¯å¾„ï¼Œå› ä¸ºæ‰€æœ‰çš„æ–‡ä»¶éƒ½é»˜è®¤å­˜å‚¨åˆ°`/data/data/<package name>/files/`ç›®å½•ä¸‹ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ–‡ä»¶çš„æ“ä½œæ¨¡å¼ï¼Œä¸»è¦æœ‰`MODE_PRIVATE`å’Œ`MODE_APPEND`ä¸¤ç§æ¨¡å¼å¯é€‰ã€‚é»˜è®¤æ˜¯`MODE_PRIVATE`ï¼Œè¡¨ç¤ºå½“æŒ‡å®šç›¸åŒæ–‡ä»¶åæ—¶ï¼Œç›´æ¥è¦†ç›–åŸæ–‡ä»¶å†…å®¹ã€‚`MODE_APPEND`åˆ™è¡¨ç¤ºè¿½åŠ å†…å®¹ã€‚`MODE_WORLD_READABLE`å’Œ`MODE_WORLD_WRITEABLE`è¡¨ç¤ºå…è®¸å…¶ä»–åº”ç”¨ç¨‹åºå¯¹ç¨‹åºçš„æ–‡ä»¶è¿›è¡Œè¯»å†™æ“ä½œï¼Œç”±äºè¿™ä¸¤ç§æ¨¡å¼è¿‡äºå±é™©ï¼Œå®¹æ˜“å¼•èµ·åº”ç”¨çš„å®‰å…¨æ¼æ´ï¼Œå·²åœ¨Android 4.2ç‰ˆæœ¬ä¸­åºŸå¼ƒã€‚\n\n`openFileOutput()`æ–¹æ³•è¿”å›ä¸€ä¸ª`FileOutputStream`å¯¹è±¡ï¼Œå¾—åˆ°è¿™ä¸ªå¯¹è±¡ä¹‹åå€ŸåŠ©å®ƒæ„å»ºå‡ºOutputStreamWriterå¯¹è±¡ï¼Œå†ä½¿ç”¨OutputStreamWriterå¯¹è±¡æ„å»ºå‡ºBufferedWriterå¯¹è±¡ï¼Œå¦‚æ­¤å°±å¯ä»¥ä½¿ç”¨é€šè¿‡BufferedWriterå°†æ–‡æœ¬å†…å®¹å†™å…¥æ–‡ä»¶ã€‚è¿™å°±æ˜¯ç”¨Javaæµçš„æ–¹å¼å°†æ•°æ®å†™å…¥æ–‡ä»¶ä¸­ã€‚\n\njavaä»£ç ç¤ºä¾‹ï¼š\n\n```java\npublic void save() {\n    String somedata = \"Data to save\";\n    FileOutputStream out = null;\n    BufferedWriter writer = null;\n    try {\n        out = openFileOutput(\"data\", Context.MODE_PRIVATE);\n        writer = new BufferedWriter(new OutputStreamWriter(out));\n        writer.write(somedata);\n    } catch (IOException e) {\n        e.printStackTrace();\n    } finally {\n        try {\n            if (writer != null) {\n                writer.close();\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n}\n```\n\nkotlinä»£ç ç¤ºä¾‹ï¼š\n\n```kotlin\nfun save(inputText: String) {\n    // kotlinæ²¡æœ‰å¼‚å¸¸æ£€æŸ¥æœºåˆ¶ï¼Œæ„å‘³ç€ä½¿ç”¨kotlinç¼–å†™çš„æ‰€æœ‰ä»£ç ä¸ä¼šå¼ºåˆ¶è¦æ±‚ä½ è¿›è¡Œå¼‚å¸¸æ•è·æˆ–å¼‚å¸¸æŠ›å‡ºï¼›\n    // æ­¤å¤„çš„try catchä»£ç å—æ˜¯å‚ç…§Javaçš„ç¼–ç¨‹è§„èŒƒæ·»åŠ çš„ï¼Œå³ä½¿ä¸å†™ä¾ç„¶å¯ä»¥ç¼–è¯‘é€šè¿‡\n    try {\n        val output = openFileOutput(\"data\", Context.MODE_PRIVATE)\n        val writer = BufferedWriter(OutputStreamWriter(output))\n        // kotlinæä¾›çš„ä¸€ä¸ªå†…ç½®æ‰©å±•å‡½æ•°ï¼Œä¿è¯åœ¨lambdaè¡¨è¾¾å¼ä¸­çš„ä»£ç å…¨éƒ¨æ‰§è¡Œå®Œä¹‹åè‡ªåŠ¨å°†å¤–å±‚çš„æµå…³é—­ï¼Œ\n        // è¿™æ ·å°±ä¸ç”¨å†ç¼–å†™ä¸€ä¸ªfinallyè¯­å¥æ‰‹åŠ¨å»å…³é—­æµäº†ã€‚\n        writer.use {\n            it.write(inputText)\n        } catch (e: IOException) {\n            e.printStackTrace();\n        }\n    }\n}\n```\n\n### å®ä¾‹\n\nåˆ›å»ºä¸€ä¸ªFilePersistenceTesté¡¹ç›®ï¼Œä¿®æ”¹activity_main.xmlä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹ï¼š\n\n```xml\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:orientation=\"vertical\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\" >\n    <EditText\n        android:id=\"@+id/editText\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:hint=\"Type something here\" >\n    </EditText>\n</LinearLayout>\n```\n\nè¿™é‡Œæ˜¯åœ¨å¸ƒå±€ä¸­åŠ å…¥äº†ä¸€ä¸ªEditTextï¼Œç”¨äºè¾“å…¥æ–‡æœ¬å†…å®¹ã€‚\n\næ­¤æ—¶è¿è¡Œç¨‹åºï¼Œè¡—é¢ä¸Šæœ‰ä¸€ä¸ªæ–‡æœ¬è¾“å…¥æ¡†ï¼Œè¾“å…¥å†…å®¹åï¼ŒæŒ‰ä¸‹Backé”®ï¼Œè¾“å…¥çš„å†…å®¹å°±ä¸¢å¤±äº†ï¼Œå› ä¸ºæ­¤æ—¶å®ƒæ˜¯ä¸€ä¸ªç¬æ—¶æ•°æ®ï¼Œåœ¨Activityé”€æ¯åä¼šè¢«å›æ”¶ã€‚ç°åœ¨è¦åšçš„æ˜¯ï¼Œåœ¨æ•°æ®è¢«å›æ”¶ä¹‹å‰å°†å®ƒå­˜å‚¨åˆ°æ–‡ä»¶ä¸­ã€‚ä¿®æ”¹MainActivityä»£ç ï¼š\n\njavaç‰ˆï¼š\n\n```java\npublic class MainActivity extends AppCompatActivity() {\n    private EditText edit;\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        edit = (EditText) findViewById(R.id.edit);\n    }\n    @Override\n    protected void onDestroy() {\n        super.onDestory();\n        String inputText = edit.getText().toString();\n        save(inputText);\n    }\n    public void save(String inputText) {\n        FileOutputStream out = null;\n        BufferedWriter writer = null;\n        try {\n            out = openFileOutput(\"data\", Context.MODE_PRIVATE);\n            writer = new BufferedWriter(new OutputStreamWriter(out));\n            writer.write(inputText);\n        } catch (IOException e) {\n            e.printStackTrace();\n        } finally {\n            try {\n                if (writer != null) {\n                    writer.close();\n                }\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n```\n\nkotlinç‰ˆï¼š\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n    override fun onCreate(savedInstanceState : Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n    }\n    override fun onDestroy() {\n        super.onDestroy()\n        val inputText = editText.text.toString()\n        save(inputText)\n    }\n    private fun save(inputText: String) {\n        try {\n            val output = openFileOutput(\"data\", Context.MODE_PRIVATE)\n            val writer = BufferedWriter(OutputStreamWriter(output))\n            writer.use {\n                it.write(inputText)\n            }\n        } catch (e: IOException) {\n            e.printStackTrace()\n        }\n    }\n}\n```\n\nè¿›å…¥`/data/data/com.example.filetest/files/`ç›®å½•ï¼Œå³å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªdataæ–‡ä»¶ã€‚\n\néœ€è¦æƒ³åŠæ³•åœ¨ä¸‹æ¬¡å¯åŠ¨ç¨‹åºæ—¶è®©è¿™äº›æ•°æ®èƒ½å¤Ÿè¿˜åŸåˆ°EditTextä¸­ã€‚\n\n## ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®\n\nç±»ä¼¼äºå°†æ•°æ®å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ï¼ŒContextç±»ä¸­è¿˜æä¾›äº†ä¸€ä¸ª`openFileInput`æ–¹æ³•ï¼Œç”¨äºä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œåªæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œå³è¦è¯»å–çš„æ–‡ä»¶åï¼Œç„¶åç³»ç»Ÿä¼šè‡ªåŠ¨åˆ°`/data/data/<package name>/files/`ç›®å½•ä¸‹å»åŠ è½½è¿™ä¸ªæ–‡ä»¶ï¼Œå¹¶è¿”å›ä¸€ä¸ªFileInputStreamå¯¹è±¡ï¼Œå¾—åˆ°äº†è¿™ä¸ªå¯¹è±¡ä¹‹åå†é€šè¿‡Javaæµçš„æ–¹å¼å°±å¯ä»¥å°†æ•°æ®è¯»å–å‡ºæ¥äº†ã€‚\n\nJavaç‰ˆï¼š\n\n```java\npublic String load() {\n    FileInputStream in = null;\n    BufferedReader reader = null;\n    StringBuilder content = new StringBuilder();\n    try {\n        in = openFileInput(\"data\");\n        reader = new BufferedReader(new InputStreamReader(in));\n        String line = \"\";\n        while((line = reader.readLine()) != null) {\n            content.append(line);\n        }\n    } catch (IOException e) {\n        e.printStackTrace();\n    } finally {\n        if (reader != null) {\n            try {\n                reader.close();\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n    return content.toString();\n}\n```\n\nkotlinç‰ˆï¼š\n\n```kotlin\nfun load(): String {\n    val content = StringBuilder()\n    try {\n        val input = openFileInput(\"data\")\n        val reader = BufferedReader(InputStreamReader(input))\n        reader.use {\n            // æ­¤å¤„ä½¿ç”¨äº†ä¸€ä¸ªforEachLineå‡½æ•°ï¼Œæ˜¯Kotlinæä¾›çš„ä¸€ä¸ªå†…ç½®æ‰©å±•å‡½æ•°ï¼Œå®ƒä¼šå°†è¯»åˆ°çš„æ¯è¡Œå†…å®¹éƒ½å›è°ƒåˆ°lambdaè¡¨è¾¾å¼ä¸­ï¼Œåœ¨lambdaè¡¨è¾¾å¼ä¸­å®Œæˆæ‹¼æ¥é€»è¾‘å³å¯\n            reader.forEachLine {\n                content.append(it)\n            }\n        }\n    } catch (e: IOException) {\n        e.printStackTrace()\n    }\n    return content.toString()\n}\n```\n\nåœ¨è¿™æ®µä»£ç ä¸­ï¼Œé¦–å…ˆé€šè¿‡`openFileInput`æ–¹æ³•è·å–åˆ°äº†ä¸€ä¸ª`FileInputStream`å¯¹è±¡ï¼Œç„¶åå€ŸåŠ©å®ƒåˆæ„å»ºå‡ºäº†ä¸€ä¸ª`InputStreamReader`å¯¹è±¡ï¼Œæ¥ç€å†ä½¿ç”¨`InputStreamReader`æ„å»ºå‡ºä¸€ä¸ª`BufferedReader` å¯¹è±¡ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡`BufferedReader`è¿›è¡Œä¸€è¡Œè¡Œåœ°è¯»å–ï¼ŒæŠŠæ–‡ä»¶ä¸­æ‰€æœ‰çš„æ–‡æœ¬å†…å®¹å…¨éƒ¨è¯»å–å‡ºæ¥ï¼Œå¹¶å­˜æ”¾åœ¨ä¸€ä¸ª`StringBuilder`å¯¹è±¡ä¸­ï¼Œæœ€åè¿”å›StringBuilderçš„toStringå°±å¯ä»¥äº†ã€‚\n\nä¿®æ”¹MainActivityä¸­çš„ä»£ç ï¼Œä½¿å¾—é‡æ–°å¯åŠ¨ç¨‹åºæ—¶EditTextä¸­èƒ½å¤Ÿä¿ç•™æˆ‘ä»¬ä¸Šæ¬¡è¾“å…¥çš„å†…å®¹ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š\n\nJavaç‰ˆ\n\n```java\npublic class MainActivity extends AppCompatActivity {\n    private EditText edit;\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        edit = (EditText) findViewById(R.id.edit);\n        String inputText = load();\n        if (!TextUtils.isEmpty(inputText)) {\n            edit.setText(inputText);\n            edit.setSelection(inputText.length());\n            Toast.makeText(this, \"Restoring succeeded\", Toast.LENGTH_SHORT).show();\n        }\n    }\n    ...\n    public String load() {\n        FileInputStream in = null;\n        BufferedReader reader = null;\n        StringBuilder content = new StringBuilder();\n        try {\n            in = openFileInput(\"data\");\n            reader = new BufferedReader(new InputStreamReader(in));\n            String line = \"\";\n            while((line = reader.readLine()) != null) {\n                content.append(line);\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        } finally {\n            if (reader != null) {\n                try {\n                    reader.close();\n                } catch (IOException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n        return content.toString();\n    }\n}\n```\n\nkotlinç‰ˆï¼š\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n        val inputText = load()\n        if(inputText.isNotEmpty()) {\n            editText.setText(inputText)\n            editText.setSelection(inputText.length)\n            Toast.makeText(this, \"Restoring succeeded\", Toast.LENGTH_SHORT).show()\n        }\n    }\n    private fun load(): String {\n        val content = StringBuilder()\n        try {\n            val input = openFileInput(\"data\")\n            val reader = BufferedReader(InputStreamReader(input))\n            reader.use {\n                reader.forEachLine {\n                    content.append(it)\n                }\n            }\n        } catch (e: IOException) {\n            e.printStackTrace()\n        }\n        return content.toString()\n    }\n    ...\n}\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œåœ¨onCreateæ–¹æ³•ä¸­è°ƒç”¨loadæ–¹æ³•æ¥è¯»å–æ–‡ä»¶ä¸­å­˜å‚¨çš„æ–‡æœ¬å†…å®¹ï¼Œå¦‚æœè¯»åˆ°çš„å†…å®¹ä¸ä¸ºnullï¼Œå°±è°ƒç”¨EditTextçš„setTextæ–¹æ³•å°†å†…å®¹å¡«å……åˆ°EditTexté‡Œï¼Œå¹¶è°ƒç”¨setSelectionæ–¹æ³•å°†è¾“å…¥å…‰æ ‡ç§»åŠ¨åˆ°æ–‡æœ¬çš„æœ«å°¾ä½ç½®ä»¥ä¾¿äºç»§ç»­è¾“å…¥ï¼Œç„¶åå¼¹å‡ºä¸€å¥è¿˜åŸæˆåŠŸçš„æç¤ºã€‚\n\næ³¨æ„ï¼Œä¸Šè¿°ä»£ç åœ¨å¯¹å­—ç¬¦ä¸²è¿›è¡Œéç©ºåˆ¤æ–­çš„æ—¶å€™ä½¿ç”¨äº†TextUtils.isEmptyæ–¹æ³•ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½ç”¨çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥ä¸€æ¬¡æ€§è¿›è¡Œä¸¤ç§ç©ºå€¼çš„åˆ¤æ–­ã€‚å½“ä¼ å…¥çš„å­—ç¬¦ä¸²ç­‰äºnullæˆ–è€…ç­‰äºç©ºå­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œè¿™ä¸ªæ–¹æ³•éƒ½ä¼šè¿”å›trueï¼Œä»è€Œä½¿å¾—æˆ‘ä»¬ä¸éœ€è¦å…ˆå•ç‹¬åˆ¤æ–­è¿™ä¸¤ç§ç©ºå€¼å†ä½¿ç”¨é€»è¾‘è¿ç®—ç¬¦è¿æ¥èµ·æ¥äº†ã€‚\n\nç°åœ¨é‡æ–°è¿è¡Œä¸€ä¸‹ç¨‹åºï¼Œåˆšæ‰ä¿å­˜çš„Contentå­—ç¬¦ä¸²è‚¯å®šä¼šè¢«å¡«å……åˆ°EditTextä¸­ï¼Œç„¶åç¼–å†™ä¸€ç‚¹å…¶ä»–çš„å†…å®¹ï¼Œæ¯”å¦‚åœ¨EditTextä¸­è¾“å…¥Helloï¼Œæ¥ç€æŒ‰ä¸‹Backé”®é€€å‡ºç¨‹åºï¼Œå†é‡æ–°å¯åŠ¨ç¨‹åºï¼Œè¿™æ—¶åˆšæ‰è¾“å…¥çš„å†…å®¹å¹¶ä¸ä¼šä¸¢å¤±ï¼Œè€Œæ˜¯è¿˜åŸåˆ°äº†EditTextä¸­ã€‚\n\n## æ€»ç»“\n\næ–‡ä»¶å­˜å‚¨çš„æ ¸å¿ƒæŠ€æœ¯å°±æ˜¯Contextç±»ä¸­æä¾›çš„openFileInputå’ŒopenFileOutputæ–¹æ³•ï¼Œä¹‹åå°±æ˜¯åˆ©ç”¨Javaçš„å„ç§æµæ¥è¿›è¡Œè¯»å†™æ“ä½œã€‚\n\nä½†æ˜¯æ–‡ä»¶å­˜å‚¨çš„æ–¹å¼å¹¶ä¸é€‚åˆç”¨äºä¿å­˜ä¸€äº›è¾ƒä¸ºå¤æ‚çš„æ–‡æœ¬æ•°æ®ã€‚\n\n# SQLiteæ•°æ®åº“å­˜å‚¨\n\nAndroidç³»ç»Ÿå†…ç½®äº†SQLiteæ•°æ®åº“ã€‚SQLiteæ˜¯ä¸€æ¬¾è½»é‡çº§çš„å…³ç³»å‹æ•°æ®åº“ï¼Œè¿ç®—é€Ÿåº¦å¿«ï¼Œå ç”¨èµ„æºå°‘ï¼Œé€šå¸¸åªéœ€è¦å‡ ç™¾KBçš„å†…å­˜å°±å¤Ÿäº†ï¼Œå› è€Œç‰¹åˆ«é€‚åˆåœ¨ç§»åŠ¨è®¾å¤‡ä¸Šä½¿ç”¨ã€‚\n\nSQLiteä¸ä»…æ”¯æŒæ ‡å‡†çš„SQLè¯­æ³•ï¼Œè¿˜éµå¾ªäº†æ•°æ®åº“çš„ACIDäº‹åŠ¡ã€‚\n\nå‰é¢çš„æ–‡ä»¶å­˜å‚¨åªé€‚ç”¨äºä¿å­˜ä¸€äº›ç®€å•çš„æ•°æ®å’Œé”®å€¼å¯¹ï¼Œå½“éœ€è¦å­˜å‚¨å¤§é‡å¤æ‚çš„å…³ç³»å‹æ•°æ®çš„æ—¶å€™å°±éœ€è¦ç”¨åˆ°æ•°æ®åº“ã€‚æ¯”å¦‚çŸ­ä¿¡ç¨‹åºä¸­å¯èƒ½ä¼šæœ‰å¾ˆå¤šä¸ªä¼šè¯ï¼Œæ¯ä¸ªä¼šè¯ä¸­åˆåŒ…å«äº†å¾ˆå¤šæ¡ä¿¡æ¯å†…å®¹ï¼Œå¹¶ä¸”å¤§éƒ¨åˆ†ä¼šè¯è¿˜å¯èƒ½å„è‡ªå¯¹åº”äº†ç”µè¯ç°¿ä¸­çš„æŸä¸ªè”ç³»äººã€‚\n\n## åˆ›å»ºæ•°æ®åº“\n\nAndroidä¸ºäº†è®©æˆ‘ä»¬èƒ½å¤Ÿæ›´åŠ æ–¹ä¾¿åœ°ç®¡ç†æ•°æ®åº“ï¼Œä¸“é—¨æä¾›äº†ä¸€ä¸ªSQLiteOpenHelperå¸®åŠ©ç±»ï¼Œå€ŸåŠ©è¿™ä¸ªç±»å°±å¯ä»¥éå¸¸ç®€å•åœ°å¯¹æ•°æ®åº“è¿›è¡Œåˆ›å»ºå’Œå‡çº§ã€‚\n\nSQLiteOpenHelperæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œè¿™æ„å‘³ç€è¦åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„å¸®åŠ©ç±»ç»§æ‰¿å®ƒã€‚SQLiteOpenHelperä¸­æœ‰ä¸¤ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯onCreateå’ŒonUpgradeï¼Œå¿…é¡»é‡å†™è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œç„¶ååˆ†åˆ«åœ¨è¿™ä¸¤ä¸ªæ–¹æ³•ä¸­å»å®ç°åˆ›å»ºã€å‡çº§æ•°æ®åº“çš„é€»è¾‘ã€‚\n\nSQLiteOpenHelperä¸­è¿˜æœ‰ä¸¤ä¸ªéå¸¸é‡è¦çš„å®ä¾‹æ–¹æ³•ï¼šgetReadableDatabaseå’ŒgetWritableDatabaseã€‚è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½å¯ä»¥åˆ›å»ºæˆ–æ‰“å¼€ä¸€ä¸ªç°æœ‰çš„æ•°æ®åº“ï¼ˆå¦‚æœæ•°æ®åº“å·²å­˜åœ¨åˆ™ç›´æ¥æ‰“å¼€ï¼Œå¦åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“ï¼‰å¹¶è¿”å›ä¸€ä¸ª**å¯å¯¹æ•°æ®åº“è¿›è¡Œè¯»å†™æ“ä½œçš„å¯¹è±¡**ã€‚ä¸åŒçš„æ˜¯ï¼Œå½“æ•°æ®åº“ä¸å¯å†™å…¥çš„æ—¶å€™ï¼ˆå¦‚ç£ç›˜ç©ºé—´å·²æ»¡ï¼‰ï¼ŒgetReadableDatabaseæ–¹æ³•è¿”å›çš„å¯¹è±¡å°†ä»¥åªè¯»çš„æ–¹å¼å»æ‰“å¼€æ•°æ®åº“ï¼Œè€ŒgetWritableDatabaseæ–¹æ³•åˆ™å°†å‡ºç°å¼‚å¸¸ã€‚\n\nSQLiteOpenHelperä¸­æœ‰ä¸¤ä¸ªæ„é€ æ–¹æ³•å¯ä¾›é‡å†™ï¼Œä¸€èˆ¬ä½¿ç”¨å‚æ•°å°‘çš„é‚£ä¸ªæ„é€ æ–¹æ³•å³å¯ã€‚è¿™ä¸ªæ„é€ æ–¹æ³•ä¸­æ¥æ”¶4ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯Contextï¼Œå¿…é¡»è¦æœ‰å®ƒæ‰èƒ½å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ•°æ®åº“åï¼Œåˆ›å»ºæ•°æ®åº“æ—¶ä½¿ç”¨çš„å°±æ˜¯è¿™é‡ŒæŒ‡å®šçš„åç§°ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°å…è®¸æˆ‘ä»¬åœ¨æŸ¥è¯¢æ•°æ®çš„æ—¶å€™è¿”å›ä¸€ä¸ªè‡ªå®šä¹‰çš„ Cursorï¼Œä¸€èˆ¬éƒ½æ˜¯ä¼ å…¥nullã€‚ç¬¬å››ä¸ªå‚æ•°è¡¨ç¤ºå½“å‰æ•°æ®åº“çš„ç‰ˆæœ¬å·ï¼Œå¯ç”¨äºå¯¹æ•°æ®åº“è¿›è¡Œå‡çº§æ“ä½œã€‚æ„å»ºå‡ºSQLiteOpenHelperçš„å®ä¾‹ä¹‹åï¼Œå†è°ƒç”¨å®ƒçš„getReadableDatabaseæˆ–getWritableDatabaseæ–¹æ³•å°±èƒ½å¤Ÿåˆ›å»ºæ•°æ®åº“äº†ï¼Œæ•°æ®åº“æ–‡ä»¶ä¼šå­˜æ”¾åœ¨`/data/data/<package name>/databases/`ç›®å½•ä¸‹ã€‚æ­¤æ—¶ï¼Œé‡å†™çš„onCreateæ–¹æ³•ä¹Ÿä¼šå¾—åˆ°æ‰§è¡Œï¼Œæ‰€ä»¥é€šå¸¸ä¼šåœ¨è¿™é‡Œå»å¤„ç†ä¸€äº›åˆ›å»ºè¡¨çš„é€»è¾‘ã€‚\n\nç¤ºä¾‹ï¼šæˆ‘ä»¬å¸Œæœ›åˆ›å»ºä¸€ä¸ªåä¸ºBookStore.dbçš„æ•°æ®åº“ï¼Œç„¶ååœ¨è¿™ä¸ªæ•°æ®åº“ä¸­æ–°å»ºä¸€å¼ Bookè¡¨ï¼Œè¡¨ä¸­æœ‰idï¼ˆä¸»é”®ï¼‰ã€ä½œè€…ã€ä»·æ ¼ã€é¡µæ•°å’Œä¹¦åç­‰åˆ—ã€‚Bookè¡¨å»ºè¡¨è¯­å¥ï¼š\n\n```sqlite\ncreate table Book (\n    id     integer primary key autoincrement,\n    author text,\n    price  real,\n    pages  integer,\n    name   text)\n```\n\nSQLiteçš„æ•°æ®ç±»å‹å¾ˆç®€å•ï¼Œintegerè¡¨ç¤ºæ•´å‹ï¼Œrealè¡¨ç¤ºæµ®ç‚¹å‹ï¼Œtextè¡¨ç¤ºæ–‡æœ¬ç±»å‹ï¼Œblobè¡¨ç¤ºäºŒè¿›åˆ¶ç±»å‹ã€‚å¦å¤–ï¼Œä¸Šè¿°å»ºè¡¨è¯­å¥ä¸­è¿˜ä½¿ç”¨äº†`primary key`å°†`id`åˆ—è®¾ä¸ºä¸»é”®ï¼Œå¹¶ç”¨`autoincrement`å…³é”®å­—è¡¨ç¤ºidåˆ—æ˜¯è‡ªå¢é•¿çš„ã€‚ç„¶åéœ€è¦åœ¨ä»£ç ä¸­å»æ‰§è¡Œè¿™æ¡SQLè¯­å¥ï¼Œæ‰èƒ½å®Œæˆåˆ›å»ºè¡¨çš„æ“ä½œã€‚æ–°å»ºMyDatabaseHelperç±»ç»§æ‰¿SQLiteOpenHelperï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\npublic class MyDatabaseHelper extends SQLiteOpenHelper {\n    public static final String CREATE_BOOK = \"create table Book (\"\n        + \"id integer primary key autoincrement, \"\n        + \"author text, \"\n        + \"price real, \"\n        + \"pages integer, \"\n        + \"name text)\";\n    private Context mContext;\n    public MyDatabaseHelper(Context context, String name,\n                            SQLiteDatabase.CursorFactory factory, int version) {\n        super(context, name, factory, version);\n        mContext = context;\n    }\n    @Override\n    public void onCreate(SQLiteDatabase db) {\n        db.execSQL(CREATE_BOOK);\n        Toast.makeText(mContext, \"Create succeeded\", Toast.LENGTH_SHORT).show();\n    }\n    @Override\n    public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {\n        \n    }\n}\n```\n\nå»ºè¡¨è¯­å¥å®šä¹‰æˆäº†ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡ï¼Œç„¶ååœ¨onCreateæ–¹æ³•ä¸­åˆè°ƒç”¨äº†SQLiteDatabaseçš„execSQLæ–¹æ³•å»æ‰§è¡Œè¿™æ¡å»ºè¡¨è¯­å¥ï¼Œå¹¶å¼¹å‡ºä¸€ä¸ªToastæç¤ºåˆ›å»ºæˆåŠŸï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯åœ¨æ•°æ®åº“åˆ›å»ºå®Œæˆçš„åŒæ—¶è¿˜èƒ½æˆåŠŸåˆ›å»ºBookè¡¨ã€‚\n\nä¿®æ”¹`activity_main.xml`ä¸­çš„ä»£ç ï¼š\n\n```xml\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:orientation=\"vertical\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\" >\n    <Button\n        android:id=\"@+id/create_database\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Create database\">\n    </Button>\n</LinearLayout>\n```\n\nå¸ƒå±€æ–‡ä»¶å¾ˆç®€å•ï¼Œå°±æ˜¯åŠ å…¥äº†ä¸€ä¸ªæŒ‰é’®ï¼Œç”¨äºåˆ›å»ºæ•°æ®åº“æœ€åä¿®æ”¹MainActivityä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\npublic class MainActivity extends AppCompatActivity {\n    private MyDatabaseHelper dbHelper;\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        dbHelper = new MyDatabaseHelper(this, \"BookStore.db\", null, 1);\n        Button createDatabase = (Button) findViewById(R.id.create_database);\n        createDatabase.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                dbHelper.getWritableDatabase();\n            }\n        });\n    }\n}\n```\n\nåœ¨onCreateæ–¹æ³•ä¸­æ„å»ºäº†ä¸€ä¸ªMyDatabaseHelperå¯¹è±¡ï¼Œå¹¶ä¸”é€šè¿‡æ„é€ å‡½æ•°çš„å‚æ•°å°†æ•°æ®åº“åæŒ‡å®šä¸º \"BookStore.db\"ï¼Œç‰ˆæœ¬å·æŒ‡å®šä¸º1ï¼Œç„¶ååœ¨æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶é‡Œè°ƒç”¨äº†getWritableDatabaseæ–¹æ³•ã€‚è¿™æ ·å½“ç¬¬ä¸€æ¬¡ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œå°±ä¼šæ£€æµ‹åˆ°å½“å‰ç¨‹åºä¸­å¹¶æ²¡æœ‰BookStore.dbæ•°æ®åº“ï¼Œäºæ˜¯ä¼šåˆ›å»ºè¯¥æ•°æ®åº“å¹¶è°ƒç”¨MyDatabaseHelperä¸­çš„onCreateæ–¹æ³•ï¼Œè¿™æ ·Bookè¡¨ä¹Ÿå°±å¾—åˆ°äº†åˆ›å»ºï¼Œç„¶åä¼šå¼¹å‡ºä¸€ä¸ªToastæç¤ºåˆ›å»ºæˆåŠŸã€‚å†æ¬¡ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œä¼šå‘ç°æ­¤æ—¶å·²ç»å­˜åœ¨BookStore.dbæ•°æ®åº“äº†ï¼Œå› æ­¤ä¸ä¼šå†åˆ›å»ºä¸€æ¬¡ã€‚\n\næ€æ ·æ‰èƒ½è¯å®æ•°æ®åº“çš„ç¡®åˆ›å»ºæˆåŠŸäº†ï¼Ÿå¦‚æœè¿˜æ˜¯ä½¿ç”¨File Explorerï¼Œé‚£ä¹ˆæœ€å¤šåªèƒ½çœ‹åˆ°databasesç›®å½•ä¸‹å‡ºç°äº†ä¸€ä¸ªBookStore.dbæ–‡ä»¶ï¼ŒBookè¡¨æ˜¯æ— æ³•é€šè¿‡File Explorerçœ‹åˆ°çš„ã€‚å› æ­¤æ¢ä¸€ç§æŸ¥çœ‹æ–¹å¼ï¼šä½¿ç”¨adb shellæ¥å¯¹æ•°æ®åº“å’Œè¡¨çš„åˆ›å»ºæƒ…å†µè¿›è¡Œæ£€æŸ¥ã€‚\n\nadbæ˜¯Android SDKä¸­è‡ªå¸¦çš„ä¸€ä¸ªè°ƒè¯•å·¥å…·ï¼Œä½¿ç”¨è¿™ä¸ªå·¥å…·å¯ä»¥ç›´æ¥å¯¹è¿æ¥åœ¨ç”µè„‘ä¸Šçš„æ‰‹æœºæˆ–æ¨¡æ‹Ÿå™¨è¿›è¡Œè°ƒè¯•æ“ä½œã€‚å®ƒå­˜æ”¾åœ¨sdkçš„platform-toolsç›®å½•ä¸‹ï¼Œå¦‚æœæƒ³è¦åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨è¿™ä¸ªå·¥å…·ï¼Œå°±éœ€è¦å…ˆæŠŠå®ƒçš„è·¯å¾„é…ç½®åˆ°ç¯å¢ƒå˜é‡é‡Œã€‚\n\nå¦‚æœä½¿ç”¨çš„æ˜¯Windowsç³»ç»Ÿï¼Œåœ¨ç³»ç»Ÿå˜é‡é‡Œæ‰¾åˆ°Pathå¹¶ç‚¹å‡»ç¼–è¾‘ï¼Œå°†platform-toolsç›®å½•é…ç½®è¿›å»ï¼›å¦‚æœä½¿ç”¨çš„æ˜¯Linuxæˆ–Macç³»ç»Ÿï¼Œå¯ä»¥åœ¨homeè·¯å¾„ä¸‹ç¼–è¾‘`.bash`æ–‡ä»¶ï¼Œå°†platform-toolsç›®å½•é…ç½®è¿›å»å³å¯ã€‚\n\næ‰“å¼€å‘½ä»¤è¡Œç•Œé¢ï¼Œè¾“äººadb shellï¼Œå°±è¿›å…¥åˆ°è®¾å¤‡çš„æ§åˆ¶å°ï¼Œè¾“å…¥suå‘½ä»¤åˆ‡æ¢æˆè¶…çº§ç®¡ç†å‘˜ï¼Œæ¥ä¸‹æ¥ä½¿ç”¨cdå‘½ä»¤è¿›å…¥åˆ°`/data/data/com.example.databasetest/databases/`ç›®å½•ä¸‹ï¼Œå¹¶ä½¿ç”¨lså‘½ä»¤æŸ¥çœ‹åˆ°è¯¥ç›®å½•é‡Œçš„æ–‡ä»¶ã€‚\n\n![image-20220808112149277](../../images/Android_æ•°æ®å’Œæ–‡ä»¶å­˜å‚¨/image-20220808112149277.png)\n\nè¿™ä¸ªç›®å½•ä¸‹å‡ºç°äº†ä¸¤ä¸ªæ•°æ®åº“æ–‡ä»¶ï¼Œä¸€ä¸ªæ­£æ˜¯æˆ‘ä»¬åˆ›å»ºçš„BookStore.dbè€Œå¦ä¸€ä¸ªBookStore.db-journalåˆ™æ˜¯ä¸ºäº†è®©æ•°æ®åº“èƒ½å¤Ÿæ”¯æŒäº‹åŠ¡è€Œäº§ç”Ÿçš„ä¸´æ—¶æ—¥å¿—æ–‡ä»¶ï¼Œé€šå¸¸æƒ…å†µä¸‹è¿™ä¸ªæ–‡ä»¶çš„å¤§å°éƒ½æ˜¯0å­—èŠ‚ã€‚\n\n![image-20220808112213683](../../images/Android_æ•°æ®å’Œæ–‡ä»¶å­˜å‚¨/image-20220808112213683.png)\n\næ¥ä¸‹æ¥å€ŸåŠ©`sqlite`å‘½ä»¤æ‰“å¼€æ•°æ®åº“ï¼Œåªéœ€è¦é”®å…¥`sqlite3`ï¼Œåé¢åŠ ä¸Šæ•°æ®åº“åå³å¯ã€‚\n\né¦–å…ˆæ¥çœ‹ä¸€ä¸‹ç›®å‰æ•°æ®åº“ä¸­æœ‰å“ªäº›è¡¨ï¼Œé”®å…¥`.table`å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ—¶æ•°æ®åº“ä¸­æœ‰ä¸¤å¼ è¡¨ï¼Œ`android_metadata`è¡¨æ˜¯æ¯ä¸ªæ•°æ®åº“ä¸­éƒ½ä¼šè‡ªåŠ¨ç”Ÿæˆçš„ï¼Œè€Œå¦å¤–ä¸€å¼ Bookè¡¨å°±æ˜¯æˆ‘ä»¬åœ¨MyDatabaseHelperä¸­åˆ›å»ºçš„ã€‚è¿™é‡Œè¿˜å¯ä»¥é€šè¿‡`.schema`å‘½ä»¤æ¥æŸ¥çœ‹å®ƒä»¬çš„å»ºè¡¨è¯­å¥ã€‚\n\nç”±æ­¤è¯æ˜ï¼ŒBookStore.dbæ•°æ®åº“å’ŒBookè¡¨ç¡®å®å·²ç»åˆ›å»ºæˆåŠŸäº†ã€‚ä¹‹åé”®å…¥`.exit`æˆ–`.quit`å‘½ä»¤å¯ä»¥é€€å‡ºæ•°æ®åº“çš„ç¼–è¾‘ï¼Œå†é”®å…¥`exit`å‘½ä»¤å°±å¯ä»¥é€€å‡ºè®¾å¤‡æ§åˆ¶å°äº†ã€‚\n\n![image-20220808113854180](../../images/Android_æ•°æ®å’Œæ–‡ä»¶å­˜å‚¨/image-20220808113854180.png)\n\n## å‡çº§æ•°æ®åº“\n\nonUpgradeæ–¹æ³•æ˜¯ç”¨äºå¯¹æ•°æ®åº“è¿›è¡Œå‡çº§çš„ã€‚\n\nç›®å‰é¡¹ç›®ä¸­å·²ç»æœ‰ä¸€å¼ Bookè¡¨ç”¨äºå­˜æ”¾ä¹¦çš„å„ç§è¯¦ç»†æ•°æ®ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å†æ·»åŠ ä¸€å¼ Categoryè¡¨ç”¨äºè®°å½•å›¾ä¹¦çš„åˆ†ç±»ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿæ¯”å¦‚Categoryè¡¨ä¸­æœ‰idï¼ˆä¸»é”®ï¼‰ã€åˆ†ç±»åå’Œåˆ†ç±»ä»£ç è¿™å‡ ä¸ªåˆ—ï¼Œé‚£ä¹ˆå»ºè¡¨è¯­å¥å°±å¯ä»¥å†™æˆï¼š\n```sqlite\ncreate table Category (\n    id            integer primary key autoincrement,\n    category_name text,\n    category_code integer)\n```\n\næ¥ä¸‹æ¥æˆ‘ä»¬å°†è¿™æ¡å»ºè¡¨è¯­å¥æ·»åŠ åˆ°MyDatabaseHelperä¸­ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\npublic class MyDatabaseHelper extends SQLiteOpenHelper {\n    public static String CREATE_BOOK = \"create table Book (\"\n        + \"id integer primary key autoincrement, \"\n        + \"author text, \"\n        + \"price real, \"\n        + \"pages integer, \"\n        + \"name text)\";\n    public static final String CREATE_CATEGORY = \"create table Category (\"\n        + \"id integer primary key autoincrement, \"\n        + \"category_name text, \"\n        + \"category_code integer)\";     //+\n    private Context mContext;\n    public MyDatabaseHelper(Context context, String name,\n                            SQLiteDatabase.CursorFactory factory, int version) {\n        super(Context, name, factory, version);\n        mContext = context;\n    }\n    @Override\n    public void onCreate(SQLiteDatabase db) {\n        db.execSQL(CREATE_BOOK);\n        db.execSQL(CREATE_CATEGORY);    //+\n        Toast.makeText(mContext, \"Create succeeded\", Toast.LENGTH_SHORT).show();\n    }\n    @Override\n    public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {\n        \n    }\n}\n```\n\nå¯è§ï¼Œæ­¤ç¨‹åºä¼å›¾é€šè¿‡MyDatabaseHelperæ„é€ æ—¶è‡ªåŠ¨è°ƒç”¨onCreateæ¥åˆ›å»ºCategoryæ•°æ®åº“ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬é‡æ–°è¿è¡Œä¸€ä¸‹ç¨‹åºå¹¶ç‚¹å‡»æŒ‰é’®ï¼Œæ²¡æœ‰å¼¹å‡ºåˆ›å»ºæˆåŠŸçš„æç¤ºã€‚å½“ç„¶ï¼Œå¯ä»¥é€šè¿‡adbå·¥å…·åˆ°æ•°æ®åº“ä¸­å†å»æ£€æŸ¥ä¸€ä¸‹ï¼Œè¿™æ ·ä¼šæ›´åŠ åœ°ç¡®è®¤Categoryè¡¨æ²¡æœ‰åˆ›å»ºæˆåŠŸã€‚å› ä¸ºæŒ‰é’®ç»‘å®šçš„ç‚¹å‡»äº‹ä»¶å›è°ƒæ˜¯`dbHelper.getWritableDatabase();`ï¼Œè€Œæ­¤æ—¶BookStore.dbæ•°æ®åº“å·²ç»å­˜åœ¨äº†ï¼Œä¹‹åä¸ç®¡æˆ‘ä»¬æ€æ ·ç‚¹å‡»æŒ‰é’®ï¼Œ`getWritableDatabase()`éƒ½ä¸ä¼šä½¿MyDatabaseHelperä¸­çš„onCreateæ–¹æ³•å†æ¬¡æ‰§è¡Œï¼Œå› æ­¤æ–°æ·»åŠ çš„è¡¨ä¹Ÿå°±æ— æ³•å¾—åˆ°åˆ›å»ºäº†ã€‚å¯ä»¥çœ‹å‡ºï¼Œ`getWritableDatabase()`åªèƒ½ç”¨äºåˆ›å»ºä¸€æ¬¡æ•°æ®åº“ï¼Œä¹‹ååªæ˜¯å•çº¯åœ°æ‰“å¼€ç°æœ‰çš„æ•°æ®åº“å¹¶è¿”å›ä¸€ä¸ªå¯å¯¹æ•°æ®åº“è¿›è¡Œè¯»å†™æ“ä½œçš„å¯¹è±¡ã€‚\n\næ­£ç¡®çš„åšæ³•æ˜¯è¿ç”¨SQLiteOpenHelperçš„å‡çº§åŠŸèƒ½ï¼Œä¿®æ”¹MyDatabaseHelperç±»ä¸­çš„ä»£ç ï¼š\n\n```java\npublic class MyDatabaseHelper extends SQLiteOpenHelper {\n    ...\n    @Override\n    public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {\n        db.execSQL(\"drop table if exists Book\");\n        db.execSQL(\"drop table if exists Category\");\n        onCreate(db);\n    }\n}\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨onUpgradeæ–¹æ³•ä¸­æ‰§è¡Œäº†ä¸¤æ¡DROPè¯­å¥ï¼Œå¦‚æœå‘ç°æ•°æ®åº“ä¸­å·²ç»å­˜åœ¨Bookè¡¨æˆ–Categoryè¡¨äº†ï¼Œå°±å°†è¿™ä¸¤å¼ è¡¨åˆ é™¤æ‰ã€‚ç„¶åå†è°ƒç”¨onCreateæ–¹æ³•é‡æ–°åˆ›å»ºã€‚è¿™é‡Œå…ˆå°†å·²ç»å­˜åœ¨çš„è¡¨åˆ é™¤æ‰ã€‚æ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯å¦‚ä½•è®©onUpgradeæ–¹æ³•èƒ½å¤Ÿæ‰§è¡Œäº†ï¼Œè¿˜è®°å¾—SQLiteOpenHelperçš„æ„é€ æ–¹æ³•é‡Œæ¥æ”¶çš„ç¬¬å››ä¸ªå‚æ•°è¡¨ç¤ºå½“å‰æ•°æ®åº“çš„ç‰ˆæœ¬å·ï¼Œä¹‹å‰æˆ‘ä»¬ä¼ äººçš„æ˜¯1ï¼Œç°åœ¨åªè¦ä¼ å…¥ä¸€ä¸ªæ¯”1å¤§çš„æ•°ï¼Œå°±å¯ä»¥è®© onUpgradeæ–¹æ³•å¾—åˆ°æ‰§è¡Œäº†ã€‚ä¿®æ”¹MainActivityä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\npublic class MainActivity extends AppCompatActivity {\n    private MyDatabaseHelper dbHelper;\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        dbHelper = new MyDatabaseHelper(this, \"BookStore.db\", null, 2);\n        Button createDatabase = (Button) findViewById(R.id.create_database);\n        createDatabase.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                dbHelper.getWritableDatabase();\n            }\n        });\n    }\n}\n```\n\nè¿™é‡Œå°†æ•°æ®åº“ç‰ˆæœ¬å·æŒ‡å®šä¸º2ï¼Œè¡¨ç¤ºæˆ‘ä»¬å¯¹æ•°æ®åº“è¿›è¡Œå‡çº§äº†ã€‚ç°åœ¨é‡æ–°è¿è¡Œç¨‹åºï¼Œå¹¶ç‚¹å‡»æŒ‰é’®ï¼Œè¿™æ—¶å°±ä¼šå†æ¬¡å¼¹å‡ºåˆ›å»ºæˆåŠŸçš„æç¤ºã€‚ä¸ºäº†éªŒè¯Categoryè¡¨å·²ç»åˆ›å»ºæˆåŠŸï¼Œåœ¨adb shellä¸­æ‰“å¼€BookStore.dbæ•°æ®åº“ï¼Œç„¶åé”®å…¥`.table`å‘½ä»¤ï¼Œæ¥ç€é”®å…¥`.schema`å‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹å»ºè¡¨è¯­å¥ã€‚ç”±æ­¤å¯ä»¥çœ‹å‡ºï¼ŒCategoryè¡¨å·²ç»åˆ›å»ºæˆåŠŸäº†ï¼ŒåŒæ—¶ä¹Ÿè¯´æ˜æˆ‘ä»¬çš„å‡çº§åŠŸèƒ½çš„ç¡®èµ·åˆ°äº†ä½œç”¨ã€‚\n\n![image-20220808144646963](../../images/Android_æ•°æ®å’Œæ–‡ä»¶å­˜å‚¨/image-20220808144646963.png)\n\n## æ·»åŠ æ•°æ®\n\nå¦‚æœä½ æ¯”è¾ƒç†Ÿæ‚‰SQLè¯­è¨€çš„è¯ï¼Œä¸€å®šä¼šçŸ¥é“æ·»åŠ æ•°æ®æ—¶ä½¿ç”¨insertï¼ŒæŸ¥è¯¢æ•°æ®æ—¶ä½¿ç”¨selectï¼Œæ›´æ–°æ•°æ®æ—¶ä½¿ç”¨updateï¼Œåˆ é™¤æ•°æ®æ—¶ä½¿ç”¨deleteã€‚ä½†æ˜¯å¼€å‘è€…çš„æ°´å¹³æ€»ä¼šæ˜¯å‚å·®ä¸é½çš„ï¼Œæœªå¿…æ¯ä¸€ä¸ªäººéƒ½èƒ½éå¸¸ç†Ÿæ‚‰åœ°ä½¿ç”¨SQLè¯­è¨€ï¼Œå› æ­¤Androidä¹Ÿæä¾›äº†ä¸€ç³»åˆ—çš„è¾…åŠ©æ€§æ–¹æ³•ï¼Œä½¿å¾—åœ¨Androidä¸­å³ä½¿ä¸å»ç¼–å†™SQLè¯­å¥ï¼Œä¹Ÿèƒ½è½»æ¾å®Œæˆæ‰€æœ‰çš„CRUDæ“ä½œã€‚\n\nå‰é¢æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œè°ƒç”¨SQLiteOpenHelperçš„getReadableDatabaseæˆ–getwritableDatabaseæ–¹æ³•æ˜¯å¯ä»¥ç”¨äºåˆ›å»ºå’Œå‡çº§æ•°æ®åº“çš„ï¼Œä¸ä»…å¦‚æ­¤ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•è¿˜éƒ½ä¼šè¿”å›ä¸€ä¸ª`SQLiteDatabase`å¯¹è±¡ï¼Œå€ŸåŠ©è¿™ä¸ªå¯¹è±¡å°±å¯ä»¥å¯¹æ•°æ®è¿›è¡ŒCRUDæ“ä½œäº†ã€‚\n\né¦–å…ˆå‘æ•°æ®åº“çš„è¡¨æ·»åŠ æ•°æ®ã€‚SQLiteDatabaseä¸­æä¾›äº†ä¸€ä¸ª`insert`æ–¹æ³•ï¼šè¿™ä¸ªæ–¹æ³•å°±æ˜¯ä¸“é—¨ç”¨äºæ·»åŠ æ•°æ®çš„ã€‚å®ƒæ¥æ”¶3ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¡¨åï¼›ç¬¬äºŒä¸ªå‚æ•°ç”¨äºåœ¨æœªæŒ‡å®šæ·»åŠ æ•°æ®çš„æƒ…å†µä¸‹ç»™æŸäº›å¯ä¸ºç©ºçš„åˆ—è‡ªåŠ¨èµ‹å€¼NULLï¼Œä¸€èˆ¬æˆ‘ä»¬ç”¨ä¸åˆ°è¿™ä¸ªåŠŸèƒ½ï¼Œç›´æ¥ä¼ å…¥nullå³å¯ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª`ContentValues`å¯¹è±¡ï¼Œå®ƒæä¾›äº†ä¸€ç³»åˆ—çš„`put`æ–¹æ³•é‡è½½ï¼Œç”¨äºå‘ContentValuesä¸­æ·»åŠ æ•°æ®ï¼Œåªéœ€è¦å°†è¡¨ä¸­çš„æ¯ä¸ªåˆ—åä»¥åŠç›¸åº”çš„å¾…æ·»åŠ æ•°æ®ä¼ å…¥å³å¯ã€‚è¿™å°±æ˜¯åŸºæœ¬ç”¨æ³•ï¼Œæ¥ä¸‹æ¥é€šè¿‡ä¾‹å­æµ‹è¯•ã€‚ä¿®æ”¹`activity_main.xml`ä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:orientation=\"vertical\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\" >\n    \n    ...\n    \n    <Button\n        android:id=\"@+id/add_data\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Add data\">\n    </Button>\n</LinearLayout>\n```\n\nåœ¨å¸ƒå±€æ–‡ä»¶ä¸­åˆæ–°å¢äº†ä¸€ä¸ªæŒ‰é’®ï¼Œç¨åå°±ä¼šåœ¨è¿™ä¸ªæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶é‡Œç¼–å†™æ·»åŠ æ•°æ®çš„é€»è¾‘ã€‚æ¥ç€ä¿®æ”¹MainActivityä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\npublic class MainActivity extends AppCompatActivity {\n    private MyDatabaseHelper dbHelper;\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        dbHelper = new MyDatabaseHelper(this, \"BookStore.db\", null, 2);\n        ...\n        Button addData = (Button) findViewById(R.id.add_data);\n        addData.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                SQLiteDatabase db = dbHelper.getWritableDatabase();\n                ContentValues values = new ContentValues();\n                // å¼€å§‹ç»„è£…ç¬¬ä¸€æ¡æ•°æ®\n                values.put(\"name\", \"The Da Vinci Code\");\n                values.put(\"author\", \"Dan Brown\");\n                values.put(\"pages\", 454);\n                values.put(\"price\", 16.96);\n                db.insert(\"Book\", null, values); // æ’å…¥ç¬¬ä¸€æ¡æ•°æ®\n                values.clear();\n                // ç»„è£…ç¬¬äºŒæ¡\n                values.put(\"name\", \"The Lost Symbol\");\n                values.put(\"author\", \"Dan Brown\");\n                values.put(\"pages\", 510);\n                values.put(\"price\", 19.95);\n                db.insert(\"Book\", null, values); // æ’å…¥ç¬¬ä¸€æ¡æ•°æ®\n                values.clear();\n            }\n        });\n    }\n}\n```\n\nè¿™é‡Œåªå¯¹Bookè¡¨é‡Œå…¶ä¸­å››åˆ—çš„æ•°æ®è¿›è¡Œäº†ç»„è£…ï¼Œidé‚£ä¸€åˆ—æ²¡å¹¶æ²¡ç»™å®ƒèµ‹å€¼ã€‚è¿™æ˜¯å› ä¸ºåœ¨å‰é¢åˆ›å»ºè¡¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å°†idåˆ—è®¾ç½®ä¸ºè‡ªå¢é•¿äº†ï¼Œå®ƒçš„å€¼ä¼šåœ¨å…¥åº“çš„æ—¶å€™è‡ªåŠ¨ç”Ÿæˆã€‚æ¥ä¸‹æ¥ä½¿ç”¨ContentValuesåˆ†åˆ«ç»„è£…äº†ä¸¤æ¬¡ä¸åŒçš„å†…å®¹ï¼Œå¹¶è°ƒç”¨äº†ä¸¤æ¬¡insertæ–¹æ³•ã€‚\n\n![image-20220808151332330](../../images/Android_æ•°æ®å’Œæ–‡ä»¶å­˜å‚¨/image-20220808151332330.png)\n\n## æ›´æ–°æ•°æ®\n\næ¥ä¸‹æ¥çœ‹çœ‹æ€æ ·ä¿®æ”¹è¡¨ä¸­å·²æœ‰çš„æ•°æ®ã€‚SQLiteDatabaseä¸­ä¹Ÿæä¾›äº†ä¸€ä¸ªéå¸¸å¥½ç”¨çš„updateæ–¹æ³•ï¼Œç”¨äºå¯¹æ•°æ®è¿›è¡Œæ›´æ–°ï¼Œè¿™ä¸ªæ–¹æ³•æ¥æ”¶4ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å’Œinsertæ–¹æ³•ä¸€æ ·æ˜¯è¡¨åã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯ContentValueså¯¹è±¡ï¼Œè¦æŠŠæ›´æ–°æ•°æ®åœ¨è¿™é‡Œç»„è£…è¿›å»ã€‚ç¬¬ä¸‰ã€ç¬¬å››ä¸ªå‚æ•°ç”¨äºçº¦æŸæ›´æ–°æŸä¸€è¡Œæˆ–æŸå‡ è¡Œä¸­çš„æ•°æ®ï¼Œä¸æŒ‡å®šçš„è¯é»˜è®¤å°±æ˜¯æ›´æ–°æ‰€æœ‰è¡Œã€‚\n\næ¯”å¦‚è¯´ä¿®æ”¹ç¬¬ä¸€æœ¬ä¹¦çš„ä»·æ ¼ã€‚åº”è¯¥æ€ä¹ˆæ“ä½œå‘¢ï¼Ÿé¦–å…ˆä¿®æ”¹`activity_main.xml`ä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:orientation=\"vertical\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\" >\n    ...\n    <Button\n        android:id=\"@+id/update_data\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Update data\">\n    </Button>\n</LinearLayout>\n```\n\næ·»åŠ äº†ä¸€ä¸ªç”¨äºæ›´æ–°æ•°æ®çš„æŒ‰é’®ã€‚ç„¶åä¿®æ”¹MainActivityä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\npublic class MainActivity extends AppCompatActivity {\n    private MyDatabaseHelper dbHelper;\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        dbHelper = new MyDatabaseHelper(this, \"BookStore.db\", null, 2);\n        ...\n        Button updateData = (Button) findViewById(R.id.update_data);\n        updateData.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                SQLiteDatabase db = dbHelper.getWritableDatabase();\n                ContentValues values = new ContentValues();\n                values.put(\"price\", 10.99);\n                db.update(\"Book\", values, \"name = ?\", new String[]{\"The Da Vinci Code\"});\n            }\n        });\n    }\n}\n```\n\nè¿™é‡Œåœ¨æ›´æ–°æ•°æ®æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶é‡Œé¢æ„å»ºäº†ä¸€ä¸ªContentValueså¯¹è±¡ï¼Œå¹¶ä¸”åªç»™å®ƒæŒ‡å®šäº†ä¸€ç»„æ•°æ®ï¼Œè¯´æ˜åªæ˜¯æƒ³æŠŠä»·æ ¼è¿™ä¸€åˆ—çš„æ•°æ®æ›´æ–°æˆ10.99ã€‚ç„¶åè°ƒç”¨äº†SQLiteDatabaseçš„updateæ–¹æ³•å»æ‰§è¡Œå…·ä½“çš„æ›´æ–°æ“ä½œï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œä½¿ç”¨äº†ç¬¬ä¸‰ã€ç¬¬å››ä¸ªå‚æ•°æ¥æŒ‡å®šå…·ä½“æ›´æ–°å“ªå‡ è¡Œã€‚**ç¬¬ä¸‰ä¸ªå‚æ•°å¯¹åº”çš„æ˜¯SQLè¯­å¥çš„whereéƒ¨åˆ†**ï¼Œè¡¨ç¤ºæ›´æ–°æ‰€æœ‰`name`ç­‰äº`?`çš„è¡Œï¼Œè€Œ`?`æ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼Œå¯ä»¥é€šè¿‡ç¬¬å››ä¸ªå‚æ•°æä¾›çš„ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ä¸­çš„æ¯ä¸ªå ä½ç¬¦æŒ‡å®šç›¸åº”çš„å†…å®¹ã€‚å› æ­¤ä¸Šè¿°ä»£ç æƒ³è¡¨è¾¾çš„æ„å›¾æ˜¯å°†åå­—æ˜¯The Da Vinci Codeçš„è¿™æœ¬ä¹¦çš„ä»·æ ¼æ”¹æˆ10.99ã€‚\n\n![image-20220808152812798](../../images/Android_æ•°æ®å’Œæ–‡ä»¶å­˜å‚¨/image-20220808152812798.png)\n\n## åˆ é™¤æ•°æ®\n\nSQLiteDatabaseä¸­æä¾›äº†ä¸€ä¸ªdeleteæ–¹æ³•ï¼Œä¸“é—¨ç”¨äºåˆ é™¤æ•°æ®ï¼Œè¿™ä¸ªæ–¹æ³•æ¥æ”¶3ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°ä»ç„¶æ˜¯è¡¨åï¼Œè¿™ä¸ªå·²ç»æ²¡ä»€ä¹ˆå¥½è¯´çš„äº†ï¼Œç¬¬äºŒã€ç¬¬ä¸‰ä¸ªå‚æ•°åˆæ˜¯ç”¨äºçº¦æŸåˆ é™¤æŸä¸€è¡Œæˆ–æŸå‡ è¡Œçš„æ•°æ®ï¼Œä¸æŒ‡å®šçš„è¯é»˜è®¤å°±æ˜¯åˆ é™¤æ‰€æœ‰è¡Œã€‚ä¿®æ”¹`activity_main.xml`ä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:orientation=\"vertical\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\" >\n    ...\n    <Button\n        android:id=\"@+id/delete_data\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Delete data\">\n    </Button>\n</LinearLayout>\n```\n\nä¿®æ”¹MainActivityä»£ç ï¼š\n\n```java\npublic class MainActivity extends AppCompatActivity {\n    private MyDatabaseHelper dbHelper;\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        dbHelper = new MyDatabaseHelper(this, \"BookStore.db\", null, 2);\n        ...\n        Button deleteData = (Button) findViewById(R.id.delete_data);\n        deleteData.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View view) {\n                SQLiteDatabase db = dbHelper.getWritableDatabase();\n                db.delete(\"Book\", \"pages > ?\", new String[]{\"500\"});\n            }\n        });\n    }\n}\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨åˆ é™¤æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶é‡ŒæŒ‡æ˜å»åˆ é™¤Bookè¡¨ä¸­çš„æ•°æ®ï¼Œå¹¶ä¸”é€šè¿‡ç¬¬äºŒã€ç¬¬ä¸‰ä¸ªå‚æ•°æ¥æŒ‡å®šä»…åˆ é™¤é‚£äº›é¡µæ•°è¶…è¿‡500é¡µçš„ä¹¦ã€‚å½“ç„¶è¿™ä¸ªéœ€æ±‚å¾ˆå¥‡æ€ªï¼Œè¿™é‡Œä¹Ÿä»…ä»…æ˜¯ä¸ºäº†åšä¸ªæµ‹è¯•ã€‚ä½ å¯ä»¥å…ˆæŸ¥çœ‹ä¸€ä¸‹å½“å‰Bookè¡¨é‡Œçš„æ•°æ®ï¼Œå…¶ä¸­The Lost Symbolè¿™æœ¬ä¹¦çš„é¡µæ•°è¶…è¿‡äº†500é¡µï¼Œä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬ç‚¹å‡»åˆ é™¤æŒ‰é’®æ—¶ï¼Œè¿™æ¡è®°å½•åº”è¯¥ä¼šè¢«åˆ é™¤æ‰ã€‚\n\n![image-20220808153356471](../../images/Android_æ•°æ®å’Œæ–‡ä»¶å­˜å‚¨/image-20220808153356471.png)\n\n## æŸ¥è¯¢æ•°æ®\n\næ­¤å¤„åªä»‹ç»Androidä¸Šçš„æŸ¥è¯¢åŠŸèƒ½ã€‚\n\nSQLiteDatabaseä¸­è¿˜æä¾›äº†ä¸€ä¸ªqueryæ–¹æ³•ç”¨äºå¯¹æ•°æ®è¿›è¡ŒæŸ¥è¯¢ã€‚è¿™ä¸ªæ–¹æ³•çš„å‚æ•°éå¸¸å¤æ‚ã€æœ€çŸ­çš„ä¸€ä¸ªæ–¹æ³•é‡è½½ä¹Ÿéœ€è¦ä¼ äºº7ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°è¿˜æ˜¯è¡¨åï¼›ç¬¬äºŒä¸ªå‚æ•°ç”¨äºæŒ‡å®šå»æŸ¥è¯¢å“ªå‡ åˆ—ï¼Œå¦‚æœä¸æŒ‡å®šåˆ™é»˜è®¤æŸ¥è¯¢æ‰€æœ‰åˆ—ï¼›ç¬¬ä¸‰ã€ç¬¬å››ä¸ªå‚æ•°ç”¨äºçº¦æŸæŸ¥è¯¢æŸä¸€è¡Œæˆ–æŸå‡ è¡Œçš„æ•°æ®ï¼Œä¸æŒ‡å®šåˆ™é»˜è®¤æŸ¥è¯¢æ‰€æœ‰è¡Œçš„æ•°æ®ï¼›ç¬¬äº”ä¸ªå‚æ•°ç”¨äºæŒ‡å®šéœ€è¦å»group byçš„åˆ—ï¼Œä¸æŒ‡å®šåˆ™è¡¨ç¤ºä¸å¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œgroup byæ“ä½œï¼›ç¬¬å…­ä¸ªå‚æ•°ç”¨äºå¯¹group byä¹‹åçš„æ•°æ®è¿›è¡Œè¿›ä¸€æ­¥çš„è¿‡æ»¤ï¼Œä¸æŒ‡å®šåˆ™è¡¨ç¤ºä¸è¿›è¡Œè¿‡æ»¤ï¼›ç¬¬ä¸ƒä¸ªå‚æ•°ç”¨äºæŒ‡å®šæŸ¥è¯¢ç»“æœçš„æ’åºæ–¹å¼ï¼Œä¸æŒ‡å®šåˆ™è¡¨ç¤ºä½¿ç”¨é»˜è®¤çš„æ’åºæ–¹å¼ã€‚æ›´å¤šè¯¦ç»†çš„å†…å®¹å¯ä»¥å‚è€ƒä¸‹è¡¨ã€‚å…¶ä»–å‡ ä¸ªqueryæ–¹æ³•çš„é‡è½½å…¶å®ä¹Ÿå¤§åŒå°å¼‚ï¼Œè¿™é‡Œå°±ä¸å†è¿›è¡Œä»‹ç»äº†ã€‚\n\n| queryæ–¹æ³•å‚æ•° | å¯¹åº”SQLéƒ¨åˆ†               | æè¿°                            |\n| ------------- | ------------------------- | ------------------------------- |\n| table         | from table_name           | æŒ‡å®šè¡¨å                        |\n| columns       | select column1, column2   | æŒ‡å®šåˆ—å                        |\n| selection     | where column = value      | æŒ‡å®šwhereçº¦æŸæ¡ä»¶               |\n| selectionArgs | -                         | ä¸ºwhereæ¡ä»¶ä¸­çš„å ä½ç¬¦æä¾›å…·ä½“å€¼ |\n| groupBy       | group by column           | æŒ‡å®šéœ€è¦group byçš„åˆ—            |\n| having        | having column = value     | å¯¹group byåçš„ç»“æœè¿›ä¸€æ­¥çº¦æŸ    |\n| orderBy       | order by column1, column2 | æŒ‡å®šæŸ¥è¯¢ç»“æœçš„æ’åºæ–¹å¼          |\n\nè™½ç„¶queryæ–¹æ³•çš„å‚æ•°éå¸¸å¤šï¼Œä½†æ˜¯ä¸è¦å¯¹å®ƒäº§ç”Ÿç•æƒ§ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¿…ä¸ºæ¯æ¡æŸ¥è¯¢è¯­å¥éƒ½æŒ‡å®šæ‰€æœ‰çš„å‚æ•°ï¼Œå¤šæ•°æƒ…å†µä¸‹åªéœ€è¦ä¼ å…¥å°‘æ•°å‡ ä¸ªå‚æ•°å°±å¯ä»¥å®ŒæˆæŸ¥è¯¢æ“ä½œäº†ã€‚è°ƒç”¨queryæ–¹æ³•åä¼šè¿”å›ä¸€ä¸ªCursorå¯¹è±¡ï¼ŒæŸ¥è¯¢åˆ°çš„æ‰€æœ‰æ•°æ®éƒ½å°†ä»è¿™ä¸ªå¯¹è±¡ä¸­å–å‡ºã€‚\n\nä¿®æ”¹`activity_main.xml`ä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:orientation=\"vertical\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\" >\n    ...\n    <Button\n        android:id=\"@+id/query_data\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Query data\">\n    </Button>\n</LinearLayout>\n```\n\nä¿®æ”¹MainActivityä¸­çš„ä»£ç ï¼š\n\n```java\npublic class MainActivity extends AppCompatActivity {\n    private MyDatabaseHelper dbHelper;\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        dbHelper = new MyDatabaseHelper(this, \"BookStore.db\", null, 2);\n        ...\n        Button queryData = (Button) findViewById(R.id.query_data);\n        queryData.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View view) {\n                SQLiteDatabase db = dbHelper.getWritableDatabase();\n                Cursor cursor = db.query(\"Book\", null, null, null, null, null, null);\n                if(cursor.moveToFirst()) {\n                    do {\n                        // éå†Cursorå¯¹è±¡ï¼Œå–å‡ºæ•°æ®å¹¶æ‰“å°\n                        String name = cursor.getString(cursor.getColumnIndex(\"name\"));\n                        String author = cursor.getString(cursor.getColumnIndex(\"author\"));\n                        int pages = cursor.getInt(cursor.getColumnIndex(\"pages\"));\n                        double price = cursor.getDouble(cursor.getColumnIndex(\"price\"));\n                        Log.d(\"MainActivity\", \"book name is \" + name);\n                        Log.d(\"MainActivity\", \"book author is \" + author);\n                        Log.d(\"MainActivity\", \"book pages is \" + pages);\n                        Log.d(\"MainActivity\", \"book price is \" + price);\n                    } while (cursor.moveToNext());\n                }\n                cursor.close();\n            }\n        });\n    }\n}\n```\n\næˆ‘ä»¬é¦–å…ˆåœ¨æŸ¥è¯¢æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶é‡Œé¢è°ƒç”¨äº†SQLiteDatabaseçš„queryæ–¹æ³•å»æŸ¥è¯¢æ•°æ®ã€‚è¿™é‡Œçš„queryæ–¹æ³•éå¸¸ç®€å•ï¼Œåªæ˜¯ä½¿ç”¨äº†ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡æ˜å»æŸ¥è¯¢Bookè¡¨ï¼Œåé¢çš„å‚æ•°å…¨éƒ¨ä¸ºnullã€‚è¿™å°±è¡¨ç¤ºå¸Œæœ›æŸ¥è¯¢è¿™å¼ è¡¨ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œè™½ç„¶è¿™å¼ è¡¨ä¸­ç›®å‰åªå‰©ä¸‹ä¸€æ¡æ•°æ®äº†ã€‚æŸ¥è¯¢å®Œä¹‹åå°±å¾—åˆ°äº†ä¸€ä¸ªCursorå¯¹è±¡ï¼Œæ¥ç€æˆ‘ä»¬è°ƒç”¨å®ƒçš„moveToFirstæ–¹æ³•å°†æ•°æ®çš„æŒ‡é’ˆç§»åŠ¨åˆ°ç¬¬ä¸€è¡Œçš„ä½ç½®ï¼Œç„¶åè¿›å…¥äº†ä¸€ä¸ªå¾ªç¯å½“ä¸­ï¼Œå»éå†æŸ¥è¯¢åˆ°çš„æ¯ä¸€è¡Œæ•°æ®ã€‚åœ¨è¿™ä¸ªå¾ªç¯ä¸­å¯ä»¥é€šè¿‡Cursorçš„getColumnIndexæ–¹æ³•è·å–åˆ°æŸä¸€åˆ—åœ¨è¡¨ä¸­å¯¹åº”çš„ä½ç½®ç´¢å¼•ï¼Œç„¶åå°†è¿™ä¸ªç´¢å¼•ä¼ å…¥åˆ°ç›¸åº”çš„å–å€¼æ–¹æ³•ä¸­ï¼Œå°±å¯ä»¥å¾—åˆ°ä»æ•°æ®åº“ä¸­è¯»å–åˆ°çš„æ•°æ®äº†ã€‚æ¥ç€æˆ‘ä»¬ä½¿ç”¨Logçš„æ–¹å¼å°†å–å‡ºçš„æ•°æ®æ‰“å°å‡ºæ¥ï¼Œå€Ÿæ­¤æ¥æ£€æŸ¥ä¸€ä¸‹è¯»å–å·¥ä½œæœ‰æ²¡æœ‰æˆåŠŸå®Œæˆã€‚æœ€ååˆ«å¿˜äº†è°ƒç”¨closeæ–¹æ³•æ¥å…³é—­Cursorã€‚\n\nç‚¹å‡»ä¸€ä¸‹QuerydataæŒ‰é’®åï¼ŒæŸ¥çœ‹logcatçš„æ‰“å°å†…å®¹ã€‚\n\n![image-20220808160134432](../../images/Android_æ•°æ®å’Œæ–‡ä»¶å­˜å‚¨/image-20220808160134432.png)\n\n## ä½¿ç”¨SQLæ“ä½œæ•°æ®åº“\n\nè™½ç„¶Androidå·²ç»ç»™æˆ‘ä»¬æä¾›äº†å¾ˆå¤šéå¸¸æ–¹ä¾¿çš„APIç”¨äºæ“ä½œæ•°æ®åº“ï¼Œä¸è¿‡æœ‰ä¸€äº›äººä¸ä¹ æƒ¯å»ä½¿ç”¨è¿™äº›è¾…åŠ©æ€§çš„æ–¹æ³•ï¼Œè€Œæ˜¯æ›´åŠ é’çäºç›´æ¥ä½¿ç”¨SQLæ¥æ“ä½œæ•°æ®åº“ã€‚è¿™ç§äººä¸€èˆ¬éƒ½å±äºSQLå¤§ç‰›ï¼ŒAndroidå……åˆ†è€ƒè™‘åˆ°äº†è¿™äº›äººçš„ç¼–ç¨‹ä¹ æƒ¯ï¼ŒåŒæ ·æä¾›äº†ä¸€ç³»åˆ—çš„æ–¹æ³•ï¼Œä½¿å¾—å¯ä»¥ç›´æ¥é€šè¿‡SQLæ¥æ“ä½œæ•°æ®åº“ã€‚ä¸‹é¢å°±æ¥ç®€ç•¥ä½¿ç”¨SQLæ¥å®Œæˆå‰é¢çš„CRUDæ“ä½œã€‚\n\n* æ·»åŠ æ•°æ®çš„æ–¹æ³•å¦‚ä¸‹ï¼š\n  ```java\n  db.execSQL(\"insert into Book (name, author, pages, price) values(?, ?, ?, ?)\",\n             new String[]{\"The Da Vinci Code\", \"Dan Brown\", \"454\", \"16.96\"});\n  db.execSQL(\"insert into Book (name, author, pages, price) values(?, ?, ?, ?)\",\n             new String[]{\"The Lost Symbol\", \"Dan Brown\", \"510\", \"19.95\"});\n  ```\n\n* æ›´æ–°æ•°æ®çš„æ–¹æ³•å¦‚ä¸‹ï¼š\n  ```java\n  db.execSQL(\"update Book set price = ? where name = ?\",\n             new String[]{\"10.99\", \"The Da Vinci Code\"});\n  ```\n\n* åˆ é™¤æ•°æ®çš„æ–¹æ³•å¦‚ä¸‹ï¼š\n  ```java\n  db.execSQL(\"delete from Book where pages > ?\", new String[]{\"500\"});\n  ```\n\n* æŸ¥è¯¢æ•°æ®çš„æ–¹æ³•å¦‚ä¸‹ï¼š\n  ```java\n  db.rawQuery(\"select * from Book\", null);\n  ```\n\nå¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†æŸ¥è¯¢æ•°æ®çš„æ—¶å€™è°ƒç”¨çš„æ˜¯SQLiteDatabaseçš„rawQueryæ–¹æ³•ï¼Œå…¶ä»–çš„æ“ä½œéƒ½æ˜¯è°ƒç”¨çš„execSQLæ–¹æ³•ã€‚é€‰æ‹©ä½¿ç”¨å“ªä¸€ç§æ–¹å¼å°±çœ‹ä½ ä¸ªäººçš„å–œå¥½äº†ã€‚\n","categories":["Android"]},{"title":"Android_Intent","url":"/Android/Android_Intent/","content":"\n# ç®€ä»‹\n\nIntentä¸»è¦è§£å†³æ´»åŠ¨ä¹‹é—´çš„ç›¸äº’è·³è½¬ã€‚\n\n# FirstActivity\n\nä»Add No Activityæ‰‹åŠ¨åˆ›å»ºæ´»åŠ¨ã€‚\n\nå³å‡»`com.example.activitytest`åŒ…ï¼Œæ–°å»ºä¸€ä¸ªEmpty Activityï¼Œå‘½åä¸º`FirstActivity.java`ã€‚\n\nåˆ›å»ºå’ŒåŠ è½½å¸ƒå±€ï¼š\n\n1. å³å‡»`app/src/main/res`ç›®å½•ï¼Œæ–°å»ºä¸€ä¸ªç›®å½•ï¼Œåä¸º`layout`ï¼Œå¯¹ç€`layout`ç›®å½•å³é”®æ–°å»ºä¸€ä¸ªLayout resource fileï¼Œä¼šå¼¹å‡ºä¸€ä¸ªæ–°å»ºå¸ƒå±€èµ„æºæ–‡ä»¶çš„çª—å£ï¼Œå°†æ­¤å¸ƒå±€æ–‡ä»¶å‘½åä¸º`first_layout.xml`ï¼Œæ ¹å…ƒç´ å†™æˆLinearLayoutã€‚\n\n2. ç¼–è¾‘`first_layout.xml`ã€‚\n\n   ```xml\n   <?xml version=\"1.0\" encoding=\"utf-8\"?>\n   <LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n       android:layout_width=\"match_parent\"\n       android:layout_height=\"match_parent\"\n       android:orientation=\"vertical\">\n   \n       <Button\n           android:id=\"@+id/button_1\"\n           android:layout_width=\"match_parent\"\n           android:layout_height=\"wrap_content\"\n           android:text=\"Button 1\"></Button>\n   </LinearLayout>\n   <!-- è¿™é‡Œæ·»åŠ äº†ä¸€ä¸ªButtonå…ƒç´ ï¼Œå¹¶åœ¨Buttonå…ƒç´ çš„å†…éƒ¨å¢åŠ äº†å‡ ä¸ªå±æ€§ã€‚\n   android:idæ˜¯ç»™å½“å‰çš„å…ƒç´ å®šä¹‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦ï¼Œä¹‹åå¯ä»¥åœ¨ä»£ç ä¸­å¯¹è¿™ä¸ªå…ƒç´ è¿›è¡Œæ“ä½œã€‚\n   @+id/button_1è¿™ç§è¯­æ³•å¯èƒ½æ¯”è¾ƒé™Œç”Ÿï¼Œä½†å¦‚æœæŠŠåŠ å·å»æ‰ï¼Œå˜æˆ@id/button_1å°±æˆä¸ºäº†åœ¨xmlä¸­å¼•ç”¨èµ„æºçš„è¯­æ³•ã€‚\n   åªä¸è¿‡æ˜¯æŠŠstringæ›¿æ¢æˆäº†idã€‚è¿™è¯´æ˜ï¼Œå¦‚æœä½ éœ€è¦åœ¨xmlä¸­å¼•ç”¨ä¸€ä¸ªidï¼Œå°±ä½¿ç”¨@id/id_nameè¿™ç§è¯­æ³•ã€‚\n   è€Œå¦‚æœéœ€è¦åœ¨xmlä¸­å®šä¹‰ä¸€ä¸ªidåˆ™è¦ä½¿ç”¨@+id/id_nameè¿™ç§è¯­æ³•ã€‚\n   éšåandroid:layout_widthæŒ‡å®šäº†å½“å‰å…ƒç´ çš„å®½åº¦ï¼›\n   ä½¿ç”¨match_parentè¡¨ç¤ºè®©å½“å‰å…ƒç´ å’Œçˆ¶å…ƒç´ ä¸€æ ·å®½ã€‚\n   android:layout_heightæŒ‡å®šäº†å½“å‰å…ƒç´ çš„é«˜åº¦ã€‚\n   è¿™é‡Œä½¿ç”¨wrap_contentè¡¨ç¤ºå½“å‰å…ƒç´ çš„é«˜åº¦åªè¦èƒ½åˆšå¥½åŒ…å«é‡Œé¢çš„å†…å®¹å°±è¡Œã€‚\n   android:textæŒ‡å®šäº†å…ƒç´ ä¸­æ˜¾ç¤ºçš„æ–‡å­—å†…å®¹ -->\n   ```\n\n3. é‡æ–°å›åˆ°FirstActivity,javaï¼Œåœ¨onCreateæ–¹æ³•ä¸­åŠ å…¥ä¸€è¡Œä»£ç \n\n   ```java\n   public class FirstActivity extends AppCompatActivity {\n       @Override\n       protected void onCreate(Bundle savedInstanceState) {\n           super.onCreate(savedInstanceState);   //é»˜è®¤æœ‰è¿™è¡Œ\n           /**\n            * è¿™é‡Œè°ƒç”¨äº†setContentViewæ–¹æ³•æ¥ç»™å½“å‰æ´»åŠ¨åŠ è½½ä¸€ä¸ªå¸ƒå±€ï¼Œ\n            * ä¸€èˆ¬ä¼ å…¥ä¸€ä¸ªå¸ƒå±€æ–‡ä»¶çš„idã€‚\n            * é¡¹ç›®ä¸­æ·»åŠ çš„ä»»ä½•èµ„æºéƒ½ä¼šåœ¨Ræ–‡ä»¶ä¸­ç”Ÿæˆä¸€ä¸ªç›¸åº”çš„èµ„æºidï¼Œ\n            * å› æ­¤åˆ›å»ºçš„first_layout.xmlå¸ƒå±€çš„idå·²æ·»åŠ åˆ°Ræ–‡ä»¶ä¸­ã€‚\n            * åªéœ€è¦è°ƒç”¨R.layout.first_layoutå°±å¯ä»¥å¾—åˆ°first_layout.xmlå¸ƒå±€çš„id\n            */\n           setContentView(R.layout.first_layout);//åŠ å…¥æ­¤è¡Œ\n       }\n   }\n   ```\n\n4. æ‰€æœ‰çš„æ´»åŠ¨éƒ½è¦åœ¨AndroidManifest.xmlæ–‡ä»¶ä¸­æ³¨å†Œæ‰èƒ½ç”Ÿæ•ˆã€‚åœ¨`application`æ ‡ç­¾å†…é€šè¿‡æ·»åŠ `activity`æ ‡ç­¾æ¥å¯¹æ´»åŠ¨è¿›è¡Œæ³¨å†Œã€‚ä½†æ˜¯ä»…ä»…æ³¨å†Œæ´»åŠ¨è¿˜æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºè¿˜æ²¡ä¸ºç¨‹åºé…ç½®ä¸»æ´»åŠ¨ã€‚ä¹Ÿå°±æ˜¯è¯´ç¨‹åºè¿è¡Œèµ·æ¥åä¸çŸ¥é“é¦–å…ˆè¦å¯åŠ¨å“ªä¸ªæ´»åŠ¨ã€‚é…ç½®ä¸»æ´»åŠ¨çš„æ–¹æ³•å°±æ˜¯åœ¨`<activity>`æ ‡ç­¾çš„å†…éƒ¨åŠ å…¥`<intent-filter>`æ ‡ç­¾ï¼Œå¹¶åœ¨æ­¤æ ‡ç­¾é‡Œæ·»åŠ `<action android:name=\"android.intnet.action.MAIN\" />`å’Œ`<category android:name=\"android.intent.category.LAUNCHER\" />`è¿™ä¸¤å¥å£°æ˜å³å¯ã€‚\n\n   ```xml\n   <?xml version=\"1.0\" encoding=\"utf-8\"?>\n   <manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\n       package=\"com.example.intenttest\">\n   \n       <application\n           android:allowBackup=\"true\"\n           android:icon=\"@mipmap/ic_launcher\"\n           android:label=\"@string/app_name\"\n           android:roundIcon=\"@mipmap/ic_launcher_round\"\n           android:supportsRtl=\"true\"\n           android:theme=\"@style/Theme.IntentTest\">\n           <!-- æ­¤å¤„å®šä¹‰ç¨‹åºçš„ä¸»æ´»åŠ¨ï¼Œå³ç‚¹å‡»æ¡Œé¢åº”ç”¨ç¨‹åºå›¾æ ‡æ—¶é¦–å…ˆæ‰“å¼€çš„å°±æ˜¯è¿™ä¸ªæ´»åŠ¨\n                å¦‚æœæ²¡æœ‰å£°æ˜ä»»ä½•ä¸€ä¸ªæ´»åŠ¨ä½œä¸ºä¸»æ´»åŠ¨ï¼Œè¿™ä¸ªç¨‹åºä»ç„¶æ˜¯å¯ä»¥æ­£å¸¸å®‰è£…ï¼Œ\n                åªæ˜¯æ— æ³•åœ¨å¯åŠ¨å™¨ä¸­çœ‹åˆ°æˆ–è€…æ‰“å¼€æ­¤ç¨‹åºã€‚è¿™ç§ç¨‹åºä¸€èˆ¬æ˜¯ä½œä¸ºç¬¬ä¸‰æ–¹æœåŠ¡ä¾›å…¶ä»–åº”ç”¨åœ¨å†…éƒ¨è¿›è¡Œè°ƒç”¨ï¼Œ\n                å¦‚æ”¯ä»˜å®å¿«æ·æ”¯ä»˜æœåŠ¡ã€‚-->\n           <!-- åœ¨<activity>ä¸­ä½¿ç”¨äº†android:nameæ¥æŒ‡å®šå…·ä½“æ³¨å†Œå“ªä¸€ä¸ªæ´»åŠ¨ã€‚\n                .FirstAcitivtyè¡¨ç¤ºcom.example.activitytest.FirstActivityçš„ç¼©å†™ã€‚\n                ç”±äºæœ€å¤–å±‚çš„<manifest>æ ‡ç­¾ä¸­å·²ç»é€šè¿‡packageå±æ€§æŒ‡å®šäº†ç¨‹åºçš„åŒ…åæ˜¯com.example.activitytestï¼Œå› æ­¤åœ¨æ³¨å†Œæ´»åŠ¨æ—¶è¿™ä¸€éƒ¨åˆ†å¯ä»¥çœç•¥ï¼Œç›´æ¥ä½¿ç”¨.FirstActivityã€‚-->\n               <!-- android:labelå¯æŒ‡å®šæ´»åŠ¨ä¸­æ ‡é¢˜æ çš„å†…å®¹ï¼Œæ ‡é¢˜æ æ˜¯æ˜¾ç¤ºåœ¨æ´»åŠ¨æœ€é¡¶éƒ¨ã€‚\n                    ç»™ä¸»æ´»åŠ¨æŒ‡å®šçš„labelä¸ä»…ä¼šæˆä¸ºæ ‡é¢˜æ ä¸­çš„å†…å®¹ï¼Œè¿˜ä¼šæˆä¸ºå¯åŠ¨å™¨(Launcher)\n                    ä¸­åº”ç”¨ç¨‹åºæ˜¾ç¤ºçš„åç§°ã€‚-->\n           <activity\n               android:name=\".FirstActivity\"\n               android:label=\"This is FirstActivity\"\n               android:exported=\"true\">\n               <intent-filter>\n                   <action android:name=\"android.intent.action.MAIN\" />\n                   <category android:name=\"android.intent.category.LAUNCHER\" />\n               </intent-filter>\n           </activity>\n       </application>\n   </manifest>\n   ```\n\né”€æ¯æ´»åŠ¨ï¼š\n\n1. å¦‚ä½•é”€æ¯ä¸€ä¸ªæ´»åŠ¨ï¼Ÿæœ€ç®€å•çš„æ–¹æ³•æ˜¯æŒ‰ä¸€ä¸‹Backé”®å°±å¯ä»¥é”€æ¯å½“å‰çš„æ´»åŠ¨ã€‚å¦‚æœä¸æƒ³é€šè¿‡æŒ‰é”®çš„æ–¹å¼ï¼Œè€Œæ˜¯å¸Œæœ›åœ¨ç¨‹åºä¸­é€šè¿‡ä»£ç æ¥é”€æ¯æ´»åŠ¨ï¼Œåˆ™è°ƒç”¨Activityç±»æä¾›çš„finishæ–¹æ³•ï¼Œå°±å¯ä»¥é”€æ¯å½“å‰æ´»åŠ¨äº†ã€‚\n\n2. ä¿®æ”¹æŒ‰é’®ç›‘å¬å™¨ä¸­çš„ä»£ç ï¼š\n\n   ```java\n   button1.setOnClickListener(new View.OnClickListener() {\n       @Override\n       public void onClick(View v) {\n           finish();\n       }\n   });\n   ```\n\n3. é‡æ–°è¿è¡Œç¨‹åºï¼Œç‚¹å‡»ä¸€ä¸‹æŒ‰é’®ï¼Œå½“å‰çš„æ´»åŠ¨å°±è¢«é”€æ¯äº†ã€‚æ•ˆæœå’ŒæŒ‰ä¸‹backé”®æ˜¯ä¸€æ ·çš„ã€‚\n\n# Intent\n\nç¼–å†™ç¬¬äºŒä¸ªæ´»åŠ¨ã€‚åˆ›å»ºä¸€ä¸ªEmpty Activityï¼Œæ´»åŠ¨çš„å¯¹è¯æ¡†ä¸­ï¼Œä¸è¦å‹¾é€‰Launcher Activityé€‰é¡¹ã€‚\n\nç”±äºSecondActivityä¸æ˜¯ä¸»æ´»åŠ¨ï¼Œå› æ­¤ä¸éœ€è¦é…ç½®`<intent-filter>`æ ‡ç­¾é‡Œçš„å†…å®¹ï¼Œæ³¨å†Œæ´»åŠ¨çš„ä»£ç ä¹Ÿç®€å•äº†å¾ˆå¤šã€‚\n\nå‰©ä¸‹çš„é—®é¢˜æ˜¯å¦‚ä½•å»å¯åŠ¨æ­¤SecondActivityæ´»åŠ¨ã€‚\n\néœ€è¦å¼•å…¥ä¸€ä¸ªæ¦‚å¿µâ€”â€”Intentã€‚\n\nIntentæ˜¯Androidç¨‹åºä¸­å„ç»„ä»¶ä¹‹é—´è¿›è¡Œäº¤äº’çš„ä¸€ç§é‡è¦æ–¹å¼ï¼Œä¸ä»…å¯ä»¥æŒ‡æ˜å½“å‰ç»„ä»¶æƒ³è¦æ‰§è¡Œçš„åŠ¨ä½œï¼Œè¿˜å¯ä»¥åœ¨ä¸åŒç»„ä»¶ä¹‹é—´ä¼ é€’æ•°æ®ã€‚\n\nIntentä¸€èˆ¬å¯è¢«ç”¨äºå¯åŠ¨æ´»åŠ¨ã€å¯åŠ¨æœåŠ¡ä»¥åŠå‘é€å¹¿æ’­ç­‰åœºæ™¯ã€‚\n\nIntentå¤§è‡´å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šæ˜¾å¼Intentå’Œéšå¼Intentã€‚\n\n# æ˜¾å¼Intent\n\næ„å›¾å¾ˆæ˜æ˜¾çš„Intentï¼Œç§°ä¹‹ä¸ºæ˜¾å¼Intentã€‚\n\nIntentæœ‰å¤šä¸ªæ„é€ å‡½æ•°çš„é‡è½½ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯`Intent(Context packageContext, Class<?> cls)`ã€‚è¿™ä¸ªæ„é€ å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°`Context`è¦æ±‚æä¾›ä¸€ä¸ªå¯åŠ¨æ´»åŠ¨çš„ä¸Šä¸‹æ–‡ï¼Œç¬¬äºŒä¸ªå‚æ•°Classåˆ™æ˜¯æŒ‡å®šæƒ³è¦å¯åŠ¨çš„ç›®æ ‡æ´»åŠ¨ã€‚\n\nå¦‚ä½•ä½¿ç”¨æ­¤Intentï¼Ÿ\n\nActivityç±»ä¸­æä¾›äº†ä¸€ä¸ª`startActivity()`æ–¹æ³•ï¼Œæ­¤æ–¹æ³•æ˜¯ä¸“é—¨ç”¨äºå¯åŠ¨æ´»åŠ¨çš„ï¼Œæ¥æ”¶ä¸€ä¸ªIntentå‚æ•°ã€‚å¯æŠŠæ„å»ºå¥½çš„Intentä¼ å…¥startActivityæ–¹æ³•å°±å¯ä»¥å¯åŠ¨ç›®æ ‡æ´»åŠ¨äº†ã€‚\n\nFirstActivityä¸­æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š\n\n```java\nbutton1.setOnClickListener(new View.OnClickListener(){\n    @Override\n    public void onClick(View v){\n        Intent intent = new Intent(FirstActivity.this, SecondActivity.class);\n        startActivity(intent);\n    }\n});\n```\n\né¦–å…ˆæ„å»ºå‡ºäº†ä¸€ä¸ªIntentï¼Œä¼ å…¥`FirstActivity.this`ä½œä¸ºä¸Šä¸‹æ–‡ï¼Œä¼ å…¥`SecondActivity.class`ä½œä¸ºç›®æ ‡æ´»åŠ¨ã€‚è¿™ä¸ªIntentæ„å›¾å³ä¸ºåœ¨FirstActivityè¿™ä¸ªæ´»åŠ¨çš„åŸºç¡€ä¸Šæ‰“å¼€SecondActivityè¿™ä¸ªæ´»åŠ¨ã€‚é€šè¿‡startActivity()æ–¹æ³•æ¥æ‰§è¡Œè¿™ä¸ªIntentã€‚\n\n# éšå¼Intent\n\nç›¸æ¯”äºæ˜¾å¼Intentï¼Œéšå¼Intentåˆ™å«è“„äº†è®¸å¤šï¼Œå®ƒå¹¶ä¸æ˜ç¡®æŒ‡å‡ºè¦å¯åŠ¨å“ªä¸€ä¸ªæ´»åŠ¨ï¼Œè€Œæ˜¯æŒ‡å®šäº†ä¸€ç³»åˆ—æŠ½è±¡çš„actionå’Œcategoryç­‰ä¿¡æ¯ã€‚ç„¶åäº¤ç”±ç³»ç»Ÿå»åˆ†æè¿™ä¸ªIntentï¼Œå¸®å¿™æ‰¾å‡ºåˆé€‚çš„æ´»åŠ¨æ¥å¯åŠ¨ã€‚\n\nä½•ä¸ºåˆé€‚çš„æ´»åŠ¨ï¼Ÿç®€å•æ¥è¯´æ˜¯å¯ä»¥å“åº”æˆ‘ä»¬è¿™ä¸ªéšå¼Intentçš„æ´»åŠ¨ã€‚ç›®å‰SecondActivityè¿˜ä¸èƒ½å“åº”éšå¼Intentã€‚\n\né€šè¿‡åœ¨`<activity>`æ ‡ç­¾ä¸‹é…ç½®`<intent-filter>`çš„å†…å®¹ï¼Œå¯ä»¥æŒ‡å®šå½“å‰æ´»åŠ¨èƒ½å¤Ÿå“åº”çš„`action`å’Œ`category`ï¼Œæ‰“å¼€`AndroidManifest.xml`ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š\n\n```xml\n<activity android:name=\".SecondActivity\" >\n    <intent-filter>\n        <action android:name=\"com.example.activitytest.ACTION_START\"></action>\n        <category android:name=\"android.intent.category.DEFAULT\"></category>\n    </intent-filter>\n</activity>\n```\n\nåœ¨`<action>`è¿™ä¸ªæ ‡ç­¾ä¸­æˆ‘ä»¬æŒ‡æ˜äº†å½“å‰æ´»åŠ¨å¯ä»¥å“åº”`com.example.activity.ACTION_START`è¿™ä¸ªactionï¼Œè€Œ`<category>`æ ‡ç­¾åˆ™åŒ…å«äº†ä¸€äº›é™„åŠ ä¿¡æ¯ï¼Œæ›´ç²¾ç¡®åœ°æŒ‡æ˜äº†å½“å‰çš„æ´»åŠ¨èƒ½å¤Ÿå“åº”çš„Intentä¸­è¿˜å¯èƒ½å¸¦æœ‰çš„categoryã€‚åªæœ‰`<action>`å’Œ`<category>`ä¸­çš„å†…å®¹åŒæ—¶èƒ½å¤ŸåŒ¹é…ä¸ŠIntentä¸­æŒ‡å®šçš„actionå’Œcategoryæ—¶ï¼Œè¿™ä¸ªæ´»åŠ¨æ‰èƒ½å“åº”è¯¥Intentã€‚\n\nä¿®æ”¹FirstActivityä¸­æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\nbutton1.setOnClickListener(new View.OnClickListener(){\n    @Override\n    public void onClick(View v){\n        Intent intent = new Intent(\"com.example.activitytest.ACTION_START\");\n        startActivity(intent);\n    }\n});\n```\n\næ­¤å¤„ä½¿ç”¨åˆ°äº†Intentçš„å¦ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œç›´æ¥å°†actionçš„å­—ç¬¦ä¸²ä¼ äº†è¿›å»ï¼Œè¡¨æ˜æƒ³è¦å¯åŠ¨èƒ½å¤Ÿå“åº”`com.example.activitytest.ACTION_START`è¿™ä¸ªactionçš„æ´»åŠ¨ã€‚ä¸ºä½•æ²¡æœ‰æŒ‡å®šcategoryï¼Ÿå› ä¸º`android.intent.category.DEFAULT`æ˜¯ä¸€ç§é»˜è®¤çš„categoryï¼Œåœ¨è°ƒç”¨startActivityæ–¹æ³•çš„æ—¶å€™ä¼šè‡ªåŠ¨å°†è¿™ä¸ªcategoryæ·»åŠ åˆ°Intentä¸­ã€‚\n\n## æŒ‡å®šå¤šä¸ªcategory\n\næ¯ä¸ªIntentä¸­åªèƒ½æŒ‡å®šä¸€ä¸ªactionï¼Œä½†å´èƒ½æŒ‡å®šå¤šä¸ªcategoryã€‚\n\næœ€å¼€å§‹Intentåªæœ‰ä¸€ä¸ªé»˜è®¤çš„categoryã€‚ç°åœ¨æ¥å¢åŠ ä¸€ä¸ªã€‚å¯ä»¥è°ƒç”¨Intentä¸­çš„`addCategory`æ–¹æ³•æ¥æ·»åŠ ä¸€ä¸ªcategoryã€‚\n\nä¿®æ”¹FirstActivityä¸­æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\nbutton1.setOnClickListener(new View.OnClickListener(){\n    @Override\n    public void onClick(View v){\n        Intent intent = new Intent(\"com.example.activity.ACTION_START\");\n        intent.addCategory(\"com.example.activitytest.MY_CATEGORY\");\n        startActivity(intent);\n    }\n});\n```\n\nè¿™é‡Œæˆ‘ä»¬æŒ‡å®šäº†ä¸€ä¸ªè‡ªå®šä¹‰çš„categoryï¼Œå€¼ä¸º`com.example.activitytest.MY_CATEGORY`ã€‚è°ƒç”¨Intentä¸­çš„`addCategory`æ–¹æ³•æ¥æ·»åŠ ä¸€ä¸ªcategoryã€‚\n\nè¿™æ—¶ï¼Œå·¥ä½œè¿˜æ²¡å®Œæ¯•ï¼ŒSecondActivityçš„`<intent-filter>`æ ‡ç­¾ä¸­å¹¶æ²¡æœ‰å£°æ˜å¯ä»¥å“åº”è¿™ä¸ªcategoryï¼Œæ‰€ä»¥æ­¤æ—¶æ²¡æœ‰ä»»ä½•æ´»åŠ¨å¯ä»¥å“åº”è¯¥Intentã€‚ç°åœ¨æˆ‘ä»¬åœ¨`<intent-filter>`ä¸­å†æ·»åŠ ä¸€ä¸ªcategoryçš„å£°æ˜ï¼Œå¦‚ä¸‹ï¼š\n\n```xml\n<activity android:name=\".SecondActivity\">\n    <intent-filter>\n        <action android:name=\"com.example.activitytest.ACTION_START\"></action>\n        <category android:name=\"android.intent.category.DEFAULT\"></category>\n        <category android:name=\"com.example.activitytest.MY_CATEGORY\"></category>\n    </intent-filter>\n</activity>\n```\n\n## æ›´å¤šç”¨æ³•\n\nä½¿ç”¨éšå¼Intentï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥å¯åŠ¨è‡ªå·±ç¨‹åºå†…çš„æ´»åŠ¨ï¼Œè¿˜å¯ä»¥å¯åŠ¨å…¶ä»–ç¨‹åºçš„æ´»åŠ¨ï¼Œè¿™ä½¿å¾—Androidå¤šä¸ªåº”ç”¨ç¨‹åºä¹‹é—´çš„åŠŸèƒ½å¯ä»¥å…±äº«ã€‚æ¯”å¦‚ä½ çš„åº”ç”¨ç¨‹åºéœ€è¦å±•ç¤ºä¸€ä¸ªç½‘é¡µï¼Œæ²¡å¿…è¦è‡ªå·±å»å®ç°ä¸€ä¸ªæµè§ˆå™¨ï¼Œåªéœ€è¦è°ƒç”¨ç³»ç»Ÿçš„æµè§ˆå™¨æ¥æ‰“å¼€è¿™ä¸ªç½‘é¡µã€‚\n\nä¿®æ”¹FirstActivityä¸­æŒ‰é’®ç‚¹å‡»äº‹ä»¶çš„ä»£ç ï¼Œå¦‚ä¸‹ï¼š\n\n```java\nbutton1.setOnClickListener(new View.OnClickListener() {\n    @Override\n    public void onClick(View view) {\n        /**\n         * è¿™é‡Œé¦–å…ˆæŒ‡å®šäº†Intentçš„actionæ˜¯Intent.ACTION_VIEWï¼Œè¿™æ˜¯ä¸€ä¸ªAndroidç³»ç»Ÿ\n         * å†…ç½®çš„åŠ¨ä½œï¼Œå…¶å¸¸é‡å€¼ä¸ºandroid.intent.action.VIEWã€‚ç„¶åé€šè¿‡Uri.parse()æ–¹æ³•\n         * å°†ä¸€ä¸ªç½‘å€å­—ç¬¦ä¸²è§£ææˆä¸€ä¸ªUriå¯¹è±¡ï¼Œå†è°ƒç”¨Intentçš„setData()æ–¹æ³•å°†è¿™ä¸ªUriå¯¹è±¡ä¼ é€’è¿›å»\n         */\n        Intent intent = new Intent(Intent.ACTION_VIEW);\n        intent.setData(Uri.parse(\"http://www.baidu.com\"));\n        startActivity(intent);\n    }\n});\n```\n\nä¸æ­¤å¯¹åº”ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨`<intent-filter>`æ ‡ç­¾ä¸­å†é…ç½®ä¸€ä¸ª`<data>`æ ‡ç­¾ï¼Œç”¨äºæ›´ç²¾ç¡®åœ°æŒ‡å®šå½“å‰æ´»åŠ¨èƒ½å¤Ÿå“åº”ä»€ä¹ˆç±»å‹çš„æ•°æ®ã€‚`<data>`æ ‡ç­¾ä¸­ä¸»è¦å¯ä»¥é…ç½®ä»¥ä¸‹å†…å®¹ã€‚\n\n* `android:scheme`ç”¨äºæŒ‡å®šæ•°æ®çš„åè®®éƒ¨åˆ†ï¼Œå¦‚ä¸Šä¾‹ä¸­çš„httpéƒ¨åˆ†ã€‚\n* `android:host`ç”¨äºæŒ‡å®šæ•°æ®çš„ä¸»æœºåéƒ¨åˆ†ï¼Œå¦‚ä¸Šä¾‹ä¸­`www.baidu.com`éƒ¨åˆ†ã€‚\n* `android:port`ç”¨äºæŒ‡å®šæ•°æ®çš„ç«¯å£éƒ¨åˆ†ï¼Œä¸€èˆ¬ç´§éšåœ¨ä¸»æœºåä¹‹åã€‚\n* `android:path`ç”¨äºæŒ‡å®šä¸»æœºåå’Œç«¯å£ä¹‹åçš„éƒ¨åˆ†ï¼Œå¦‚ä¸€æ®µç½‘å€ä¸­è·Ÿåœ¨åŸŸåä¹‹åçš„å†…å®¹\n* `android:mimeType`ç”¨äºæŒ‡å®šå¯ä»¥å¤„ç†çš„æ•°æ®ç±»å‹ï¼Œå…è®¸ä½¿ç”¨é€šé…ç¬¦çš„æ–¹å¼è¿›è¡ŒæŒ‡å®šã€‚\n\nåªæœ‰dataæ ‡ç­¾ä¸­æŒ‡å®šçš„å†…å®¹å’ŒIntentä¸­æºå¸¦çš„Dataå®Œå…¨ä¸€è‡´æ—¶ï¼Œå½“å‰æ´»åŠ¨æ‰èƒ½å¤Ÿå“åº”è¯¥Intentã€‚ä¸€èˆ¬åœ¨`<data>`æ ‡ç­¾ä¸­ä¸ä¼šæŒ‡å®šè¿‡å¤šçš„å†…å®¹ï¼Œå¦‚ä¸Šé¢æµè§ˆå™¨ç¤ºä¾‹ä¸­ï¼Œå…¶å®åªè¦æŒ‡å®š`android:scheme`ä¸ºhttpå°±å¯ä»¥å“åº”æ‰€æœ‰çš„httpåè®®çš„Intentäº†ã€‚\n\nä¸ºäº†ç†è§£ï¼Œå»ºç«‹ThirdActivityï¼Œå¸ƒå±€æ–‡ä»¶èµ·åä¸º`third_layout`ã€‚\n\n```xml\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\">\n    android:orientation=\"vertical\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    <Button>\n        android:id=\"@+id/button_3\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Button 3\"\n    </Button>\n</LinearLayout>\n```\n\nThirdActivity.javaä¸­çš„ä»£ç ä¿æŒä¸å˜å°±å¯ä»¥äº†ã€‚\n\nåœ¨AndroidManifest.xmlä¸­ä¿®æ”¹ThirdActivityçš„æ³¨å†Œä¿¡æ¯ï¼š\n\n```xml\n<activity android:name=\".ThirdActivity\">\n    <intent-filter>\n        <action android:name=\"android.intent.action.VIEW\"></action>\n        <category android:name=\"android.intent.category.DEFAULT\"></category>\n        <data android:scheme=\"http\"></data>\n    </intent-filter>\n</activity>\n```\n\næˆ‘ä»¬åœ¨ThirdActivityçš„`<intent-filter>`ä¸­é…ç½®äº†å½“å‰æ´»åŠ¨èƒ½å¤Ÿå“åº”çš„actionæ˜¯`Intent.ACTION_VIEW`çš„å¸¸é‡å€¼ï¼Œè€Œcategoryåˆ™æ¯«æ— ç–‘é—®æŒ‡å®šäº†é»˜è®¤çš„categoryå€¼ï¼Œå¦å¤–åœ¨`<data>`æ ‡ç­¾ä¸­æˆ‘ä»¬é€šè¿‡`android:scheme`æŒ‡å®šäº†æ•°æ®çš„åè®®å¿…é¡»æ˜¯httpåè®®ï¼Œè¿™æ ·ThirdActivityåº”è¯¥å°±å’Œæµè§ˆå™¨ä¸€æ ·ï¼Œèƒ½å¤Ÿå“åº”ä¸€ä¸ªæ‰“å¼€ç½‘é¡µçš„Intentäº†ã€‚è¿è¡Œä¸€ä¸‹ç¨‹åºè¯•è¯•ï¼Œåœ¨FirstActivityçš„ç•Œé¢ç‚¹å‡»ä¸€ä¸‹æŒ‰é’®ï¼Œç»“æœåº”è¯¥å¯ä»¥çœ‹åˆ°ç³»ç»Ÿè‡ªåŠ¨å¼¹å‡ºä¸€ä¸ªåˆ—è¡¨ï¼Œæ˜¾ç¤ºäº†ç›®å‰èƒ½å¤Ÿå“åº”è¿™ä¸ªIntentçš„æ‰€æœ‰ç¨‹åºã€‚å¯å“åº”çš„ç¨‹åºæœ‰ä¸¤ä¸ªï¼šä¸€æ˜¯Broswerï¼Œä¼šæ‰“å¼€æµè§ˆå™¨å¹¶æ˜¾ç¤ºç½‘é¡µï¼›äºŒæ˜¯è¿™ä¸ªappåå­—ï¼Œä¼šå¯åŠ¨ThirdActivityï¼Œä½†æ˜¯å®é™…ä¸Šè¿™ä¸ªæ´»åŠ¨å¹¶æ²¡æœ‰åŠ è½½ã€æ˜¾ç¤ºç½‘é¡µçš„åŠŸèƒ½ã€‚\n\n# å‘æ´»åŠ¨ä¼ é€’æ•°æ®\n\n## å‘ä¸‹ä¸€ä¸ªæ´»åŠ¨ä¼ é€’\n\nIntentä¸ä»…å¯ä»¥å¯åŠ¨ä¸€ä¸ªæ´»åŠ¨ï¼Œè¿˜å¯ä»¥åœ¨å¯åŠ¨æ´»åŠ¨çš„æ—¶å€™ä¼ é€’æ•°æ®ã€‚\n\nIntentä¸­æä¾›äº†ä¸€ç³»åˆ—`putExtra`æ–¹æ³•çš„é‡è½½ï¼Œå¯ä»¥æŠŠæˆ‘ä»¬æƒ³è¦ä¼ é€’çš„æ•°æ®æš‚å­˜åœ¨Intentä¸­ï¼Œå¯åŠ¨äº†å¦ä¸€ä¸ªæ´»åŠ¨åï¼Œåªéœ€è¦æŠŠè¿™äº›æ•°æ®å†ä»Intentä¸­å–å‡ºå°±å¯ä»¥äº†ã€‚æ¯”å¦‚FirstActivityä¸­æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç°åœ¨æƒ³æŠŠè¿™ä¸ªå­—ç¬¦ä¸²ä¼ é€’åˆ°SecondActivityä¸­ï¼Œå¯ä»¥è¿™æ ·ç¼–å†™ï¼š\n\n```java\nbutton1.setOnClickListener(new View.OnClickListener() {\n    @Override\n    public void onClick(View v) {\n        String data = \"Hello SecondActivity\";\n        Intent intent = new Intent(FirstActivity.this, SecondActivity.class);\n        intent.putExtra(\"extra_data\", data);\n        startActivity(intent);\n    }\n});\n```\n\nè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æ˜¾ç¤ºIntentçš„æ–¹å¼æ¥å¯åŠ¨SecondActivityï¼Œå¹¶é€šè¿‡`putExtra()`æ–¹æ³•ä¼ é€’äº†ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚æ³¨æ„è¿™é‡ŒputExtraæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é”®ï¼Œç”¨äºåé¢ä»Intentä¸­å–å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ‰æ˜¯çœŸæ­£è¦ä¼ é€’çš„æ•°æ®ã€‚\n\nç„¶ååœ¨SecondActivityä¸­å°†ä¼ é€’çš„æ•°æ®å–å‡ºï¼Œå¹¶æ‰“å°å‡ºæ¥ï¼Œä»£ç å¦‚ä¸‹ï¼š\n\n```java\npublic class SecondActivity extends AppCompatActivity {\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.second_layout);\n        Intent intent = getIntent();\n        String data = intent.getStringExtra(\"extra_data\");\n        Log.d(\"SecondActivity\", data);\n    }\n}\n```\n\né¦–å…ˆå¯ä»¥é€šè¿‡`getlntent`æ–¹æ³•è·å–åˆ°ç”¨äºå¯åŠ¨`SecondActivity`çš„`Intent`ï¼Œç„¶åè°ƒç”¨`getStringExtra`æ–¹æ³•ï¼Œä¼ å…¥ç›¸åº”çš„é”®å€¼ï¼Œå°±å¯ä»¥å¾—åˆ°ä¼ é€’çš„æ•°æ®äº†ã€‚è¿™é‡Œç”±äºæˆ‘ä»¬ä¼ é€’çš„æ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ä½¿ç”¨`getStringExtra`æ–¹æ³•æ¥è·å–ä¼ é€’çš„æ•°æ®ã€‚å¦‚æœä¼ é€’çš„æ˜¯æ•´å‹æ•°æ®ï¼Œåˆ™ä½¿ç”¨`getlntExtra`æ–¹æ³•ï¼›å¦‚æœä¼ é€’çš„æ˜¯å¸ƒå°”å‹æ•°æ®ï¼Œåˆ™ä½¿ç”¨`getBooleanExtra`æ–¹æ³•ï¼Œä»¥æ­¤ç±»æ¨ã€‚\n\né‡æ–°è¿è¡Œç¨‹åºï¼Œåœ¨FirstActivityçš„ç•Œé¢ç‚¹å‡»ä¸€ä¸‹æŒ‰é’®ä¼šè·³è½¬åˆ°SecondActivityï¼ŒæŸ»çœ‹logcatæ‰“å°çš„ä¿¡æ¯ã€‚\n\n```\n507-24507/com.example.intenttest D/SecondActivity: Hello SecondActivity\n```\n\n## å‘ä¸Šä¸€ä¸ªä¼ é€’\n\næ—¢ç„¶å¯ä»¥ä¼ é€’æ•°æ®ç»™ä¸‹ä¸€ä¸ªæ´»åŠ¨ï¼Œé‚£ä¹ˆèƒ½ä¸èƒ½å¤Ÿè¿”å›æ•°æ®ç»™ä¸Šä¸€ä¸ªæ´»åŠ¨å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚ä¸è¿‡ä¸åŒçš„æ˜¯ï¼Œè¿”å›ä¸Šä¸€ä¸ªæ´»åŠ¨åªéœ€è¦æŒ‰ä¸€ä¸‹Backé”®å°±å¯ä»¥äº†ï¼Œå¹¶æ²¡æœ‰ä¸€ä¸ªç”¨äºå¯åŠ¨æ´»åŠ¨çš„Intentæ¥ä¼ é€’æ•°æ®ã€‚é€šè¿‡æŸ¥é˜…æ–‡æ¡£å‘ç°ï¼ŒActivityä¸­è¿˜æœ‰ä¸€ä¸ª`startActivityForResult()`æ–¹æ³•ä¹Ÿæ˜¯ç”¨äºå¯åŠ¨æ´»åŠ¨çš„ï¼Œä½†è¿™ä¸ªæ–¹æ³•æœŸæœ›åœ¨**æ´»åŠ¨é”€æ¯çš„æ—¶å€™èƒ½å¤Ÿè¿”å›ä¸€ä¸ªç»“æœç»™ä¸Šä¸€ä¸ªæ´»åŠ¨**ã€‚æ¯«æ— ç–‘é—®ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ã€‚\n\n`startActivityForResult`æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è¿˜æ˜¯Intentï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯**è¯·æ±‚ç **ï¼Œç”¨äºåœ¨ä¹‹åçš„å›è°ƒä¸­åˆ¤æ–­æ•°æ®çš„æ¥æºã€‚æˆ‘ä»¬ä¿®æ”¹FirstActivityä¸­æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºâˆ¶\n\n```java\nbutton1.setOnClickListener(new View.OnClickListener() {\n    @Override\n    public void onClick(View view) {\n        Intent intent = new Intent(FirstActivity.this, SecondActivity.class);\n        startActivityForResult(intent, 1);\n    }\n});\n```\n\nè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†startActivityForResultæ–¹æ³•æ¥å¯åŠ¨SecondActivityï¼Œè¯·æ±‚ç åªè¦æ˜¯ä¸€ä¸ªå”¯ä¸€å€¼å°±å¯ä»¥äº†ï¼Œè¿™é‡Œä¼ å…¥äº†1ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨SecondActivityä¸­ç»™æŒ‰é’®æ³¨å†Œç‚¹å‡»äº‹ä»¶ï¼Œå¹¶åœ¨ç‚¹å‡»äº‹ä»¶ä¸­æ·»åŠ è¿”å›æ•°æ®çš„é€»è¾‘ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\npublic class SecondActivity extends AppCompatActivity {\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.second_layout);\n        Button button2 = (Button) findViewById(R.id.button_2);\n        button2.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                Intent intent = new Intent();\n                intent.putExtra(\"data_return\", \"Hello FirstActivity\");\n                setResult(RESULT_OK, intent);\n                finish();\n            }\n        });\n    }\n}\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ„å»ºäº†ä¸€ä¸ªIntentï¼Œåªä¸è¿‡è¿™ä¸ªIntentä»…ä»…æ˜¯ç”¨äºä¼ é€’æ•°æ®è€Œå·²ï¼Œå®ƒæ²¡æœ‰æŒ‡å®šä»»ä½•çš„â€œæ„å›¾â€ã€‚ç´§æ¥ç€æŠŠè¦ä¼ é€’çš„æ•°æ®å­˜æ”¾åœ¨Intentä¸­ï¼Œç„¶åè°ƒç”¨äº†setResultæ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•éå¸¸é‡è¦ï¼Œæ˜¯ä¸“é—¨ç”¨äºå‘ä¸Šä¸€ä¸ªæ´»åŠ¨è¿”å›æ•°æ®çš„ã€‚setResultæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ç”¨äºå‘ä¸Šä¸€ä¸ªæ´»åŠ¨è¿”å›å¤„ç†ç»“æœï¼Œä¸€èˆ¬åªä½¿ç”¨RESULT_OKæˆ–RESULT_CANCELEDè¿™ä¸¤ä¸ªå€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°åˆ™æŠŠå¸¦æœ‰æ•°æ®çš„Intentä¼ é€’å›å»ï¼Œç„¶åè°ƒç”¨äº†finishæ–¹æ³•æ¥é”€æ¯å½“å‰æ´»åŠ¨ã€‚\n\nç”±äºæˆ‘ä»¬æ˜¯ä½¿ç”¨startActivityForResultæ–¹æ³•æ¥å¯åŠ¨SecondActivityçš„ï¼Œåœ¨SecondActivityè¢«é”€æ¯ä¹‹åä¼šå›è°ƒä¸Šä¸€ä¸ªæ´»åŠ¨çš„onActivityResultæ–¹æ³•ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨FirstActivityä¸­é‡å†™è¿™ä¸ªæ–¹æ³•æ¥å¾—åˆ°è¿”å›çš„æ•°æ®ï¼Œå¦‚ä¸‹æ‰€ç¤ºâˆ¶\n\n```java\n@Override\nprotected void onActivityResult(int requestCode, int resultCode, @Nullable Intent data) {\n    switch (requestCode) {\n        case 1:\n            if(resultCode == RESULT_OK) {\n                String returnedData = data.getStringExtra(\"data_return\");\n                Log.d(\"FirstActivity\", returnedData);\n            }\n            break;\n        default:\n    }\n}\n```\n\nonActivityResultæ–¹æ³•å¸¦æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°requestCodeï¼Œå³æˆ‘ä»¬åœ¨å¯åŠ¨æ´»åŠ¨æ—¶ä¼ å…¥çš„è¯·æ±‚ç ã€‚ç¬¬äºŒä¸ªå‚æ•°resultCodeï¼Œå³æˆ‘ä»¬åœ¨è¿”å›æ•°æ®æ—¶ä¼ å…¥çš„å¤„ç†ç»“æœã€‚ç¬¬ä¸‰ä¸ªå‚æ•°dataï¼Œå³æºå¸¦ç€è¿”å›æ•°æ®çš„Intentã€‚ç”±äºåœ¨ä¸€ä¸ªæ´»åŠ¨ä¸­æœ‰å¯èƒ½è°ƒç”¨startActivityForResultæ–¹æ³•å»å¯åŠ¨å¾ˆå¤šä¸åŒçš„æ´»åŠ¨ï¼Œæ¯ä¸€ä¸ªæ´»åŠ¨è¿”å›çš„æ•°æ®éƒ½ä¼šå›è°ƒåˆ°onActivityResultè¿™ä¸ªæ–¹æ³•ä¸­ï¼Œå› æ­¤æˆ‘ä»¬é¦–å…ˆè¦åšçš„å°±æ˜¯é€šè¿‡æ£€æŸ¥requestCodeçš„å€¼æ¥åˆ¤æ–­æ•°æ®æ¥æºã€‚ç¡®å®šæ•°æ®æ˜¯ä»SecondActivityè¿”å›çš„ä¹‹åï¼Œæˆ‘ä»¬å†é€šè¿‡resultCodeçš„å€¼æ¥åˆ¤æ–­å¤„ç†ç»“æœæ˜¯å¦æˆåŠŸã€‚æœ€åä»dataä¸­å–å€¼å¹¶æ‰“å°å‡ºæ¥ï¼Œè¿™æ ·å°±å®Œæˆäº†å‘ä¸Šä¸€ä¸ªæ´»åŠ¨è¿”å›æ•°æ®çš„å·¥ä½œã€‚\n\né‡æ–°è¿è¡Œç¨‹åºï¼Œåœ¨FirstActivityçš„ç•Œé¢ç‚¹å‡»æŒ‰é’®ä¼šæ‰“å¼€SecondActivityï¼Œç„¶ååœ¨SecondActivityç•Œé¢ç‚¹å‡»Button2æŒ‰é’®ä¼šå›åˆ°FirstActivityï¼Œè¿™æ—¶æŸ¥çœ‹logcatçš„æ‰“å°ä¿¡æ¯ã€‚\n\n```\n31184-31184/com.example.intenttest D/FirstActivity: Hello FirstActivity\n```\n\nä½†æ˜¯å¯èƒ½ä¼šå­˜åœ¨ç¼ºé™·ã€‚å¦‚æœç”¨æˆ·åœ¨SecondActivityä¸­å¹¶ä¸æ˜¯é€šè¿‡ç‚¹å‡»æŒ‰é’®ï¼Œè€Œæ˜¯é€šè¿‡æŒ‰ä¸‹backé”®å›åˆ°FirstActivityï¼Œè¿™æ ·æ•°æ®å°±æ— æ³•è¿”å›åˆ°ä¸Šä¸€ä¸ªæ´»åŠ¨ã€‚å¯ä»¥åœ¨SecondActivityä¸­é‡å†™onBackPressedæ–¹æ³•æ¥è§£å†³ï¼š\n\n```java\n@Override\npublic void onBackPressed() {\n    Intent intent = new Intent();\n    intent.putExtra(\"data_return\", \"Hello FirstActivity\");\n    setResult(RESULT_OK, intent);\n    finish();\n}\n```\n\nå¦‚æ­¤ï¼Œå½“ç”¨æˆ·æŒ‰ä¸‹backé”®ï¼Œå°±ä¼šå»æ‰§è¡ŒonBackPressedæ–¹æ³•ä¸­çš„ä»£ç ã€‚\n\n","categories":["Android"]},{"title":"Cpp_åˆ›å»ºç›®å½•","url":"/Cpp/Cpp_åˆ›å»ºç›®å½•/","content":"\nå‚è€ƒæ–‡ç« ï¼šhttps://blog.csdn.net/guotianqing/article/details/109823501\n\n# systemè°ƒç”¨\n\nç®€å•ç²—é‡ï¼Œé€‚ç”¨äºLinuxç³»ç»Ÿã€‚\n\n```cpp\nint main(int argc, char **argv)\n{\n    if(argc != 2)\n    {\n        cout << \"Usage: \" << argv[0] << \" dir\" << endl;\n        return -1;\n    }\n    string path(argv[1]);\n    string cmd(\"mkdir -p \" + path);\n    int ret = system(cmd.c_str());\n    if(ret)\n    {\n        cout << \"create dir error: \" << ret << \", :\" << stderror(errno) << endl;\n        return -1;\n    }\n    cout << \"system cmd create dir ok: \" << argv[1] << endl;\n    return 0;\n}\n```\n\næ­¤æ–¹å¼ï¼Œç›´æ¥ä½¿ç”¨ç³»ç»Ÿå‘½ä»¤æ‰§è¡ŒLinuxä¸‹mkdirå‘½ä»¤åˆ›å»ºç›®å½•ï¼Œç¼ºç‚¹æ˜¯systemç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œè¦å¤„ç†å„ç§è¿”å›å€¼æƒ…å†µã€‚\n\n# mkdirå‡½æ•°\n\n`C++`ä¸­æä¾›äº†ç”¨äºåˆ›å»ºç›®å½•çš„å‡½æ•°ï¼ŒåŸå‹å¦‚ä¸‹ï¼š\n\n```cpp\nint mkdir(const char * path, mode_t mode);\n// The file permission bits of the new directory shall be initialized from mode\n// If path names a symbolic link, mkdir() shall fail and set errno to [EEXIST].\n// Upon successful completion, mkdir() shall return 0. Otherwise, -1 shall be returned, no directory shall be created, and errno shall be set to indicate the error.\n```\n\nå¯èƒ½çš„é”™è¯¯å¦‚ä¸‹ï¼š\n\n* EACCES - è®¿é—®é”™è¯¯\n  * Search permission is denied on a component of the path prefix, or write permission is denied on the parent directory of the directory to be created.\n* EEXIST - å·²å­˜åœ¨\n  * The named file exists.\n* ELOOP - é“¾æ¥é”™è¯¯\n  * A loop exists in symbolic links encountered during resolution of the path argument.\n* EMLINK - é“¾æ¥è¾¾åˆ°ä¸Šé™\n  * The link count of the parent directory would exceed `LINK_MAX`.\n* ENAMETOOLONG - åå­—å¤ªé•¿\n  * The length of the path argument exceeds `PATH_MAX` or a pathname component is longer than `NAME_MAX`.\n* ENOENT - ç›®å½•å‰ç¼€æœ‰éƒ¨åˆ†ä¸å­˜åœ¨\n  * A component of the path prefix specified by path does not name an existing directory or path is an empty string.\n* ENOSPC - æ²¡æœ‰è¶³å¤Ÿç©ºé—´\n  * The file system does not contain enough space to hold the contents of the new directory or to extend the parent directory of the new directory.\n* ENOTDIR - ç›®å½•å‰ç¼€æœ‰ä¸€éƒ¨åˆ†ä¸æ˜¯ç›®å½•\n  * A component of the path prefix is not a directory.\n* EROFS - æ–‡ä»¶ç³»ç»Ÿåªè¯»\n  * The parent directory resides on a read-only file system.\n\nç›®å½•çš„æƒé™å¦‚ä¸‹ï¼š\n\n```\nUser:   S_IRUSR (read), S_IWUSR (write), S_IXUSR (execute)\nGroup:  S_IRGRP (read), S_IWGRP (write), S_IXGRP (execute)\nOthers: S_IROTH (read), S_IWOTH (write), S_IXOTH (execute)\n```\n\n\nå®ƒä»¬ç»„åˆåœ¨ä¸€èµ·ï¼Œå½¢æˆäº†å¦‚ä¸‹å¿«æ·æ–¹å¼ï¼š\n\n```\nRead + Write + Execute: S_IRWXU (User), S_IRWXG (Group), S_IRWXO (Others)\nDEFFILEMODE: Equivalent of 0666 = rw-rw-rw-\nACCESSPERMS: Equivalent of 0777 = rwxrwxrwx\n```\n\nä½¿ç”¨mkdirå‡½æ•°ï¼Œæ›¿æ¢ä¸Šé¢ç¨‹åºä¸­çš„æ ¸å¿ƒä»£ç ï¼š\n\n```cpp\nret = mkdir(path.c_str(), S_IRWXU | S_IRWXG | S_IROTH | S_IXOTH);\nif(ret && errno == EEXIST)\n{\n    cout << \"dir: \" << path << \" already exist\" << endl;\n}\nelse if(ret)\n{\n    cout << \"create dir error: \" << ret << \", :\" << strerror(errno) << endl;\n    return -1;\n}\nelse\n{\n    cout << \"mkdir create dir succ: \" << path << endl;\n}\n```\n\n# booståº“create_directory\n\n```cpp\n#include<boost/filesystem.hpp>\nif(!boost::filesystem::is_directory(path))\n{\n    cout << \"begin create path: \" << path << endl;\n    if(!boost::filesystem::create_directory(path))\n    {\n        cout << \"create_directories failed: \" << path << endl;\n        return -1;\n    }\n}\nelse\n{\n    cout << path << \" already exist\" << endl;\n}\n```\n\nç¼–è¯‘æ—¶å¢åŠ `-lboost_system -lboost_filesystem`é€‰é¡¹ã€‚\n\næ³¨æ„ï¼Œä»¥ä¸Šå‡½æ•°åªèƒ½ç”¨äºåˆ›å»ºå•ä¸ªç›®å½•ï¼Œä¸èƒ½åˆ›å»ºå¤šçº§ç›®å½•ï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸\n\n```\nbegin create signal_dir: ./c/d\nterminate called after throwing an instance of 'boost::filesystem::filesystem_error'\n  what():  boost::filesystem::create_directory: No such file or directory: \"./c/d\"\n[1]    16669 abort (core dumped)  ./a.out ./c/d\n```\n\nå¦‚æœéœ€è¦ä¸€æ¬¡åˆ›å»ºå¤šçº§ç›®å½•ï¼Œéœ€è¦è°ƒç”¨`create_directories`\n\n# C++17åº“create_directory\n\nåŸå‹å¦‚ä¸‹ï¼š\n\n```cpp\n// ä»¥æ‰€æœ‰æƒé™åˆ›å»ºå•ä¸ªç›®å½•ï¼Œçˆ¶ç›®å½•å¿…é¡»å­˜åœ¨ï¼Œå¦‚æœç›®å½•å·²ç»å­˜åœ¨ï¼Œä¸ä¼šæŠ¥é”™\nbool create_directory(const std::filesystem::path& p);\nbool create_directory(const std::filesystem::path& p, std::error_code& ec) noexcept;\n// ä¸ä¸Šé¢ä¸€æ ·ï¼Œåªä¸è¿‡åˆ›å»ºçš„ç›®å½•çš„æƒé™æ˜¯ä»å·²ç»å­˜åœ¨çš„ç›®å½•å±æ€§æ‹·è´è¿‡æ¥çš„ã€‚è¿™ä¸ªç‰¹æ€§ä¾èµ–æ“ä½œç³»ç»Ÿ\nbool create_directory(const std::filesystem::path& p, const std::filesystem::path& existing_p);\nbool create_directory(const std::filesystem::path& p, const std::filesystem::path& existing_p, std::error_code& ec) noexcept;\n// åˆ›å»ºå±‚çº§ç›®å½•ï¼Œä¸ºæ¯çº§ä¸å­˜åœ¨çš„ç›®å½•è°ƒç”¨ç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœç›®å½•å·²ç»å­˜åœ¨ï¼Œå®ƒä»€ä¹ˆä¹Ÿä¸åšï¼Œä¸”ä¸ä¼šæŠ¥é”™\nbool create_directories(const std::filesystem::path& p);\nbool create_directories(const std::filesystem::path& p, std::error_code& ec);\n// åˆ›å»ºæˆåŠŸè¿”å›trueï¼Œå¦åˆ™false\n```\n\nä½¿ç”¨ä¸boostç±»ä¼¼ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š\n\n```cpp\n#include <filesystem>\nif (std::filesystem::create_directories(path))\n{\n\tcout << \"fs create dir succ: \" << path << endl;\n}\n```\n","categories":["Cpp"]},{"title":"Linux_ç¯å¢ƒé…ç½®","url":"/Linux/Linux_ç¯å¢ƒé…ç½®/","content":"# `.profile`\n`.profile`Â æ–‡ä»¶åœ¨ Linux/Unix ç³»ç»Ÿä¸­æ‰®æ¼”ç€é‡è¦çš„è§’è‰²ï¼Œå®ƒæ˜¯ä½äºç”¨æˆ·å®¶ç›®å½• (`~/`) ä¸‹çš„ä¸€ä¸ªâ€‹**â€‹éšè—æ–‡ä»¶â€‹**â€‹ï¼ˆä»¥ç‚¹å¼€å¤´ï¼‰ã€‚å®ƒä¸»è¦ç”¨äºåœ¨â€‹**â€‹ç™»å½• shellâ€‹**â€‹ çš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­ä¸ºç‰¹å®šç”¨æˆ·è®¾ç½®â€‹**â€‹ç¯å¢ƒå˜é‡â€‹**â€‹å’Œâ€‹**â€‹å¯åŠ¨ç¨‹åºâ€‹**â€‹ã€‚\n\nä»¥ä¸‹æ˜¯å…³äºÂ `.profile`Â æ–‡ä»¶çš„è¯¦ç»†è¯´æ˜ï¼š\n\n1. â€‹**â€‹ä¸»è¦ç›®çš„ï¼šç”¨æˆ·ç¯å¢ƒå®šåˆ¶â€‹**â€‹\n    \n    - â€‹**â€‹è®¾ç½®ç¯å¢ƒå˜é‡ï¼šâ€‹**â€‹ è¿™æ˜¯Â `.profile`Â æœ€å¸¸è§çš„ç”¨é€”ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œè®¾ç½®Â `PATH`ï¼ˆå†³å®šç³»ç»Ÿå»å“ªé‡ŒæŸ¥æ‰¾å¯æ‰§è¡Œå‘½ä»¤ï¼‰ã€`EDITOR`ï¼ˆé»˜è®¤æ–‡æœ¬ç¼–è¾‘å™¨ï¼‰ã€`LANG`ï¼ˆç³»ç»Ÿè¯­è¨€å’ŒåŒºåŸŸè®¾ç½®ï¼‰ã€`JAVA_HOME`ã€`PYTHONPATH`Â ç­‰ç­‰ã€‚è¿™äº›å˜é‡å®šä¹‰äº†ä½ çš„å·¥ä½œç¯å¢ƒã€‚\n    - â€‹**â€‹è¿è¡Œå¯åŠ¨å‘½ä»¤ï¼šâ€‹**â€‹ ä½ å¯ä»¥åœ¨ç™»å½•æ—¶è‡ªåŠ¨è¿è¡ŒæŸäº›å‘½ä»¤æˆ–å°è„šæœ¬ã€‚ä¾‹å¦‚ï¼š\n        - æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯æˆ–ç³»ç»ŸçŠ¶æ€ (`uptime`,Â `fortune`,Â `echo \"Welcome back, $USER\"`)\n        - è®¾ç½®å‘½ä»¤åˆ«å (`alias ll='ls -l'`)\n        - è®¾ç½® shell é€‰é¡¹ (`set -o noclobber`Â - é˜²æ­¢è¦†ç›–æ–‡ä»¶)\n        - å¯åŠ¨ä»£ç†æˆ–åå°æœåŠ¡ï¼ˆä»¥å‰æ›´å¸¸è§ï¼Œç°åœ¨å¯èƒ½æœ‰æ›´å¥½çš„æ–¹æ³•ï¼‰\n2. â€‹**â€‹æ‰§è¡Œæ—¶æœºï¼šç™»å½•æ—¶â€‹**â€‹\n    \n    - å½“ä½ é€šè¿‡â€‹**â€‹ç™»å½• shellâ€‹**â€‹ è¿›å…¥ç³»ç»Ÿæ—¶ï¼Œ`.profile`Â æ–‡ä»¶ä¼šè¢«è‡ªåŠ¨è¯»å–å’Œæ‰§è¡Œã€‚\n    - ä»€ä¹ˆæ˜¯ç™»å½• shellï¼Ÿ\n        - é€šè¿‡æ§åˆ¶å°ï¼ˆæ–‡æœ¬ç™»å½•ç•Œé¢ï¼‰ç™»å½•ã€‚\n        - ä½¿ç”¨Â `ssh username@hostname`Â è¿œç¨‹ç™»å½•ã€‚\n        - ä½¿ç”¨Â `su - username`Â æˆ–Â `sudo -i`ï¼ˆåˆ‡æ¢ç”¨æˆ·å¹¶æ¨¡æ‹Ÿå®Œæ•´ç™»å½•ï¼‰ã€‚\n        - å›¾å½¢ç•Œé¢ç™»å½•åå¯åŠ¨çš„â€‹**â€‹ç¬¬ä¸€ä¸ªâ€‹**â€‹ç»ˆç«¯ï¼ˆå–å†³äºæ¡Œé¢ç¯å¢ƒå’Œç»ˆç«¯æ¨¡æ‹Ÿå™¨çš„é…ç½®ï¼Œæœ‰æ—¶æ˜¯ç™»å½• shellï¼Œæœ‰æ—¶ä¸æ˜¯ï¼‰ã€‚\n    - â€‹**â€‹é‡è¦ï¼šâ€‹**â€‹ å¹¶éæ‰€æœ‰ç»ˆç«¯ä¼šè¯éƒ½æ˜¯ç™»å½• shellã€‚å¦‚æœä½ åªæ˜¯æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯çª—å£ï¼ˆæ ‡ç­¾é¡µï¼‰ï¼Œå®ƒé€šå¸¸æ˜¯â€‹**â€‹éç™»å½• shellâ€‹**â€‹ï¼Œä¸ä¼šè¯»å–Â `.profile`ï¼Œè€Œæ˜¯è¯»å–Â `.bashrc`ï¼ˆå¯¹äº bashï¼‰æˆ–ç±»ä¼¼çš„æ–‡ä»¶ã€‚\n3. â€‹**â€‹ä¸ç³»ç»Ÿçº§é…ç½®çš„å…³ç³»â€‹**â€‹\n    \n    - â€‹**â€‹`/etc/profile`â€‹**â€‹: è¿™æ˜¯ä¸€ä¸ªç³»ç»Ÿçº§åˆ«çš„å…¨å±€é…ç½®æ–‡ä»¶ï¼Œåœ¨ç”¨æˆ·ç™»å½•æ—¶ï¼Œâ€‹**â€‹æœ€å…ˆâ€‹**â€‹è¢«æ‰§è¡Œã€‚\n    - â€‹**â€‹`/etc/profile.d/*.sh`â€‹**â€‹:Â `/etc/profile`Â é€šå¸¸ä¼šè°ƒç”¨æ‰§è¡Œè¿™ä¸ªç›®å½•ä¸‹æ‰€æœ‰çš„Â `.sh`Â è„šæœ¬æ–‡ä»¶ï¼Œç”¨äºå­˜æ”¾ç³»ç»Ÿçº§åˆ«çš„é¢å¤–é…ç½®ã€‚\n    - â€‹**â€‹`~/.profile`â€‹**â€‹: åœ¨Â `/etc/profile`Â ä¹‹åæ‰§è¡Œã€‚å®ƒæ˜¯ç”¨æˆ·â€‹**â€‹å®šåˆ¶è‡ªå·±ç™»å½•ç¯å¢ƒâ€‹**â€‹çš„ä¸»è¦åœ°æ–¹ï¼Œå¯ä»¥è¦†ç›–æˆ–è¡¥å……ç³»ç»Ÿçº§åˆ«çš„è®¾ç½®ã€‚\n    - â€‹**â€‹`~/.bash_profile`Â æˆ–Â `~/.bash_login`Â (bash ç‰¹æœ‰)â€‹**â€‹: å¦‚æœÂ `.profile`Â æ‰€åœ¨çš„ shell æ˜¯ bashï¼Œå¹¶ä¸”ç”¨æˆ·å®¶ç›®å½•ä¸‹å­˜åœ¨Â `~/.bash_profile`Â æˆ–Â `~/.bash_login`ï¼Œé‚£ä¹ˆ bash ä¼šâ€‹**â€‹ä¼˜å…ˆæ‰§è¡Œå®ƒä»¬â€‹**â€‹ï¼Œè€Œâ€‹**â€‹è·³è¿‡â€‹**â€‹Â `~/.profile`ï¼ˆé™¤éè¿™äº›æ–‡ä»¶æ˜¾å¼åœ°Â `source ~/.profile`ï¼‰ã€‚\n    - â€‹**â€‹`~/.bashrc`Â (bash ç‰¹æœ‰)â€‹**â€‹: ä¸»è¦ç”¨äºâ€‹**â€‹éç™»å½•çš„äº¤äº’å¼ shellâ€‹**â€‹ (å³å¤§éƒ¨åˆ†æ–°æ‰“å¼€çš„ç»ˆç«¯çª—å£)ã€‚åœ¨ç™»å½• shell ä¸­ï¼Œå¦‚æœÂ `~/.bash_profile`Â å­˜åœ¨ï¼Œå®ƒé€šå¸¸ä¼šå»è°ƒç”¨Â `~/.bashrc`ï¼Œè¿™æ ·ç™»å½• shell ä¹Ÿèƒ½è·å¾—å…¶ä¸­çš„è®¾ç½®ï¼ˆåˆ«åã€å‡½æ•°ç­‰ï¼‰ã€‚\n4. â€‹**â€‹æ–‡ä»¶å‘½åä¸ä½ç½®â€‹**â€‹\n    \n    - â€‹**â€‹è·¯å¾„ï¼šâ€‹**â€‹ ä½äºç”¨æˆ·çš„å®¶ç›®å½•ä¸‹ï¼Œå³Â `~/.profile`Â æˆ–Â `/home/username/.profile`ã€‚\n    - â€‹**â€‹å…¼å®¹æ€§ï¼šâ€‹**â€‹Â `.profile`Â æ˜¯ä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„åå­—ï¼Œè¢« Bourne Shell (`sh`)ã€Bashã€Korn Shell (`ksh`) ç­‰å¹¿æ³›æ”¯æŒã€‚å®ƒä¸ºä¸åŒ shell æä¾›äº†ä¸€ä¸ªå…¬å…±çš„é…ç½®ç‚¹ã€‚\n    - â€‹**â€‹Shell ä¸“å±æ–‡ä»¶ï¼šâ€‹**â€‹ è®¸å¤šç”¨æˆ·ï¼ˆå°¤å…¶æ˜¯ bash ç”¨æˆ·ï¼‰æ›´å–œæ¬¢æˆ–ä¹ æƒ¯ä½¿ç”¨Â `~/.bash_profile`ï¼ˆç”¨äºç™»å½• bashï¼‰å’ŒÂ `~/.bashrc`ï¼ˆç”¨äºäº¤äº’å¼éç™»å½• bashï¼‰ï¼Œå¹¶å°†Â `.profile`Â ç”¨ä½œå¤‡ç”¨æˆ–å…¼å®¹é…ç½®ã€‚\n5. â€‹**â€‹æŸ¥çœ‹ä¸ç¼–è¾‘â€‹**â€‹\n    \n    - æŸ¥çœ‹ï¼š`cat ~/.profile`Â æˆ–Â `less ~/.profile`\n    - ç¼–è¾‘ï¼šä½¿ç”¨ä½ å–œæ¬¢çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆå¦‚Â `nano ~/.profile`,Â `vim ~/.profile`ï¼‰ã€‚ç¡®ä¿ä½ ç¼–è¾‘çš„æ˜¯ä½ è‡ªå·±çš„å®¶ç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚\n6. â€‹**â€‹é‡è¦æ³¨æ„äº‹é¡¹â€‹**â€‹\n    \n    - â€‹**â€‹ç”Ÿæ•ˆéœ€è¦ï¼šâ€‹**â€‹ ä¿®æ”¹Â `.profile`Â åï¼Œè¿™äº›æ›´æ”¹â€‹**â€‹ä¸ä¼šâ€‹**â€‹ç«‹å³åœ¨å½“å‰å·²ç»æ‰“å¼€çš„ä¼šè¯ä¸­ç”Ÿæ•ˆï¼ˆå› ä¸ºä½ ä¿®æ”¹æ—¶ï¼Œç™»å½•è¿‡ç¨‹å·²ç»å®Œæˆï¼‰ã€‚è¦è®©ä¿®æ”¹ç”Ÿæ•ˆï¼Œä½ éœ€è¦ï¼š\n        - â€‹**â€‹æ–¹æ³•ä¸€ (æ¨è)ï¼šâ€‹**â€‹ é‡æ–°ç™»å½•ï¼ˆlogout åå† loginï¼‰ã€‚\n        - â€‹**â€‹æ–¹æ³•äºŒï¼šâ€‹**â€‹ åœ¨å½“å‰çš„ç™»å½• shell ä¸­æ‰§è¡ŒÂ `source ~/.profile`Â æˆ–Â `. ~/.profile`Â å‘½ä»¤æ¥å¼ºåˆ¶é‡æ–°åŠ è½½è¯¥æ–‡ä»¶ã€‚\n    - â€‹**â€‹è°¨æ…ä¿®æ”¹ï¼šâ€‹**â€‹ é”™è¯¯çš„è¯­æ³•ï¼ˆæ¯”å¦‚å¼•å·ä¸åŒ¹é…ã€é”™è¯¯çš„å˜é‡èµ‹å€¼ï¼‰æˆ–æ‰§è¡Œæœ‰é—®é¢˜çš„å‘½ä»¤å¯èƒ½å¯¼è‡´ä½ ç™»å½•æ—¶å‡ºé”™ï¼Œç”šè‡³æ— æ³•ç™»å½•ã€‚åœ¨ä¿®æ”¹é‡è¦æ–‡ä»¶å‰æœ€å¥½å¤‡ä»½ã€‚\n    - â€‹**â€‹`~/.bash_profile`Â vsÂ `~/.profile`Â (bash ç”¨æˆ·):â€‹**â€‹ å¦‚æœÂ `~/.bash_profile`Â å­˜åœ¨ï¼Œbash ä¼šå¿½ç•¥Â `~/.profile`ã€‚å› æ­¤ï¼Œå¾ˆå¤šç³»ç»Ÿé»˜è®¤åˆ›å»ºçš„æ˜¯Â `.profile`ï¼Œä½†å¦‚æœç”¨æˆ·åˆ›å»ºäº†Â `.bash_profile`ï¼Œå®ƒå°±ä¼šæ¥ç®¡ã€‚æ¨èåšæ³•æ˜¯è®©Â `~/.bash_profile`Â é‡Œç®€å•åœ°åŒ…å«Â `source ~/.profile`ï¼Œç„¶åå†åŒ…å«Â `source ~/.bashrc`ï¼Œè¿™æ ·å¯ä»¥åŒæ—¶å…¼å®¹ç™»å½•é…ç½®å’Œäº¤äº’é…ç½®ã€‚\n\n## â€‹æ€»ç»“â€‹\n`.profile`Â æ˜¯ä¸ªäºº Linux/Unix ç¯å¢ƒçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¹‹ä¸€ã€‚å®ƒåœ¨ä½ é€šè¿‡ç™»å½• shell è¿›å…¥ç³»ç»Ÿæ—¶è‡ªåŠ¨è¿è¡Œï¼Œå…¶ä¸»è¦ä»»åŠ¡æ˜¯ä¸ºä½ å®šä¹‰ä¸ªæ€§åŒ–çš„ç¯å¢ƒå˜é‡ï¼ˆå¦‚Â `PATH`,Â `EDITOR`ï¼‰å’Œç™»å½•æ—¶éœ€è¦è¿è¡Œçš„å‘½ä»¤æˆ–è„šæœ¬ã€‚ç†è§£å®ƒä¸Â `/etc/profile`ã€`~/.bash_profile`ã€`~/.bashrc`Â ç­‰æ–‡ä»¶çš„å…³ç³»å’Œæ‰§è¡Œé¡ºåºï¼Œå¯¹äºæœ‰æ•ˆç®¡ç†å’Œå®šåˆ¶ä½ çš„ shell ç¯å¢ƒè‡³å…³é‡è¦ã€‚\n# Linuxé…ç½®ç›¸å…³\n\n[bashrc sourceåé•¿æœŸæœ‰æ•ˆ](https://www.csdn.net/tags/MtTaEg0sMDg4NTIyLWJsb2cO0O0O.html)","categories":["Linux"]},{"title":"Android_åº”ç”¨åŸºç¡€çŸ¥è¯†","url":"/Android/Android_åº”ç”¨åŸºç¡€çŸ¥è¯†/","content":"\n# Androidåº”ç”¨\n\nå¯ä»¥ä½¿ç”¨Kotlinã€Javaå’Œ`C++`è¯­è¨€ç¼–å†™Androidåº”ç”¨ã€‚Android SDKå·¥å…·ä¼šå°†ä»£ç è¿åŒä»»ä½•æ•°æ®å’Œèµ„æºæ–‡ä»¶ç¼–è¯‘æˆä¸€ä¸ªAPKï¼ˆAndroid package, Androidè½¯ä»¶åŒ…ï¼‰ï¼Œå³å¸¦æœ‰`.apk`åç¼€çš„å½’æ¡£æ–‡ä»¶ï¼›æˆ–è€…Android App Bundleã€‚\n\n* ä¸€ä¸ªAPKæ–‡ä»¶åŒ…å«Androidåº”ç”¨åœ¨è¿è¡Œæ—¶çš„å¿…éœ€å†…å®¹ï¼Œå®ƒä¹Ÿæ˜¯Androidè®¾å¤‡ç”¨æ¥å®‰è£…åº”ç”¨çš„æ–‡ä»¶ã€‚\n* ä¸€ä¸ªAABæ–‡ä»¶åŒ…å«ä¸€ä¸ªAndroidåº”ç”¨ç¨‹åºé¡¹ç›®ï¼ŒåŒ…æ‹¬ä¸€äº›åœ¨è¿è¡Œæ—¶ä¸éœ€è¦çš„é™„åŠ å…ƒæ•°æ®ã€‚ABBæ˜¯ä¸€ç§å‘å¸ƒæ ¼å¼ï¼Œæ˜¯ä¸å¯å®‰è£…åˆ°Androidè®¾å¤‡ä¸Šçš„ï¼Œå®ƒæ¨è¿Ÿ(defer)APKçš„ç”Ÿæˆã€ç­¾ååˆ°æ›´æ™šçš„é˜¶æ®µã€‚åœ¨Google Playåˆ†å‘åº”ç”¨ç¨‹åºæ—¶ï¼ŒGoogle Playçš„æœåŠ¡å™¨æ‰ç”Ÿæˆä¼˜åŒ–åçš„APKï¼Œä»…åŒ…å«ç‰¹å®šè®¾å¤‡å®‰è£…åº”ç”¨æ‰€éœ€è¦çš„èµ„æºå’Œä»£ç ã€‚\n\næ¯ä¸ª Android åº”ç”¨éƒ½å¤„äºå„è‡ªçš„å®‰å…¨æ²™ç›’ä¸­ï¼Œå¹¶å—ä»¥ä¸‹ Android å®‰å…¨åŠŸèƒ½çš„ä¿æŠ¤ï¼š\n\n- Android æ“ä½œç³»ç»Ÿæ˜¯ä¸€ç§å¤šç”¨æˆ· Linux ç³»ç»Ÿï¼Œå…¶ä¸­æ¯ä¸ªåº”ç”¨éƒ½æ˜¯ä¸€ä¸ªä¸åŒçš„ç”¨æˆ·ï¼›\n- é»˜è®¤æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä¼šä¸ºæ¯ä¸ªåº”ç”¨åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ Linux ç”¨æˆ· IDï¼ˆè¯¥ ID ä»…ç”±ç³»ç»Ÿä½¿ç”¨ï¼Œåº”ç”¨å¹¶ä¸çŸ¥æ™“ï¼‰ã€‚ç³»ç»Ÿä¼šä¸ºåº”ç”¨ä¸­çš„æ‰€æœ‰æ–‡ä»¶è®¾ç½®æƒé™ï¼Œä½¿å¾—åªæœ‰è¢«åˆ†é…ç»™è¯¥åº”ç”¨çš„ç”¨æˆ·idå¯¹åº”çš„ç”¨æˆ·æ‰èƒ½è®¿é—®è¿™äº›æ–‡ä»¶ï¼›\n- æ¯ä¸ªè¿›ç¨‹éƒ½æ‹¥æœ‰è‡ªå·±çš„è™šæ‹Ÿæœº (VM)ï¼Œå› æ­¤åº”ç”¨ä»£ç ç‹¬ç«‹äºå…¶ä»–åº”ç”¨è€Œè¿è¡Œã€‚\n- é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªåº”ç”¨éƒ½åœ¨å…¶è‡ªå·±çš„ Linux è¿›ç¨‹å†…è¿è¡Œã€‚Android ç³»ç»Ÿä¼šåœ¨éœ€è¦æ‰§è¡Œä»»ä½•åº”ç”¨ç»„ä»¶æ—¶å¯åŠ¨è¯¥è¿›ç¨‹ï¼Œç„¶åå½“ä¸å†éœ€è¦è¯¥è¿›ç¨‹æˆ–ç³»ç»Ÿå¿…é¡»ä¸ºå…¶ä»–åº”ç”¨æ¢å¤å†…å­˜æ—¶ï¼Œå…¶ä¾¿ä¼šå…³é—­è¯¥è¿›ç¨‹ã€‚\n\nAndroidç³»ç»Ÿå®ç°äº†**åº”ç”¨æœ€å°‘ç‰¹æƒ**çš„åŸåˆ™ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºåªèƒ½è®¿é—®å…¶å·¥ä½œæ‰€éœ€çš„ç»„ä»¶ï¼Œæ²¡æœ‰æ›´å¤šã€‚è¿™åˆ›é€ äº†ä¸€ä¸ªéå¸¸å®‰å…¨çš„ç¯å¢ƒï¼Œåœ¨è¯¥ç¯å¢ƒä¸­ï¼Œåº”ç”¨ç¨‹åºæ— æ³•è®¿é—®æœªç»è®¸å¯çš„ç³»ç»Ÿéƒ¨åˆ†ã€‚ä½†æ˜¯ï¼Œä¸€ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡å…¶ä»–æ–¹æ³•ä¸å…¶ä»–åº”ç”¨ç¨‹åºå…±äº«æ•°æ®ï¼Œå¹¶ä¸”åº”ç”¨ç¨‹åºå¯ä»¥è®¿é—®ç³»ç»ŸæœåŠ¡ï¼š\n\n* å¯ä»¥å®‰æ’ä¸¤ä¸ªappå…±äº«ç›¸åŒçš„Linuxç”¨æˆ·IDã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»–ä»¬å¯ä»¥è®¿é—®å½¼æ­¤çš„æ–‡ä»¶ã€‚ä¸ºäº†èŠ‚çœç³»ç»Ÿèµ„æºï¼Œå…·æœ‰ç›¸åŒç”¨æˆ·IDçš„appä¹Ÿå¯ä»¥å®‰æ’åœ¨ç›¸åŒçš„Linuxè¿›ç¨‹ä¸­è¿è¡Œå¹¶å…±äº«ç›¸åŒçš„VMã€‚è¿™äº›appè¿˜å¿…é¡»è¢«ç­¾ç½²ç›¸åŒçš„è¯ä¹¦ç­¾åã€‚\n* ä¸€ä¸ªappå¯ä»¥è¯·æ±‚è®¸å¯æ¥è®¿é—®è®¾å¤‡æ•°æ®ï¼Œæ¯”å¦‚è®¾å¤‡çš„å®šä½ã€æ‘„åƒå¤´ã€è“ç‰™è¿æ¥ã€‚ç”¨æˆ·å¿…é¡»æ˜ç¡®åœ°æˆäºˆè¿™äº›è®¸å¯ã€‚\n\n# åº”ç”¨ç¨‹åºç»„ä»¶ï¼ˆApp componentsï¼‰\n\nåº”ç”¨ç¨‹åºç»„ä»¶æ˜¯Androidåº”ç”¨ç¨‹åºçš„é‡è¦æ„ä»¶æ¨¡å—ã€‚ç³»ç»Ÿæˆ–ç”¨æˆ·å¯ä»¥é€šè¿‡æ¯ä¸ªç»„ä»¶æ¥è¿›å…¥appã€‚æœ‰äº›ç»„ä»¶ä¾èµ–å…¶ä»–ç»„ä»¶ã€‚\n\næœ‰å››å¤§ç±»åº”ç”¨ç¨‹åºç»„ä»¶ï¼š\n\n1. Activity\n2. Service\n3. Broadcast receiver\n4. Content provider\n\næ¯ç§ç±»å‹éƒ½æœ‰ä¸€ä¸ªç‹¬ç‰¹çš„ç›®çš„ï¼Œå¹¶ä¸”å…·æœ‰ç‹¬ç‰¹çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯ä»¥å®šä¹‰ç»„ä»¶çš„åˆ›å»ºå’Œç ´åæ–¹å¼ã€‚\n\n## Activity\n\nActivityæ˜¯ä¸ç”¨æˆ·äº¤äº’çš„åˆ‡å…¥ç‚¹ï¼Œä»£è¡¨ç€å…·æœ‰ç”¨æˆ·ç•Œé¢çš„ä¸€ä¸ªå±å¹•ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªé‚®ç®±appå¯èƒ½æœ‰ä¸€ä¸ªactivityï¼Œå±•ç¤ºäº†ä¸€åˆ—æ–°é‚®ä»¶ï¼Œå¦ä¸€ä¸ªactivityç”¨äºæ’°å†™é‚®ä»¶ï¼Œä»¥åŠå¦ä¸€activityåœ¨é˜…è¯»é‚®ä»¶ã€‚å°½ç®¡è¿™äº›activityå…±åŒå·¥ä½œå»å½¢æˆå‡èšçš„ç”¨æˆ·ä½“éªŒï¼Œä½†æ¯ä¸ªactivityç‹¬ç«‹äºå…¶ä»–activityã€‚ä¾‹å¦‚ï¼Œå¦‚æœç”µå­é‚®ä»¶appå…è®¸ï¼Œå…¶ä»–çš„appå¯ä»¥ä»ä»»æ„ä¸€ä¸ªactivityå¯åŠ¨ã€‚æ¯”å¦‚ï¼Œæ‹ç…§appå¯ä»¥å¯åŠ¨é‚®ç®±appçš„activityï¼Œä»¥æ’°å†™ä¸€ä¸ªæ–°çš„é‚®ä»¶ï¼Œç”±æ­¤å…è®¸ç”¨æˆ·æ¥åˆ†äº«ç…§ç‰‡ã€‚\n\nActivityä¿ƒè¿›ç€ç³»ç»Ÿå’Œappä¹‹é—´çš„ä»¥ä¸‹å…³é”®äº¤äº’ï¼š\n\n* æŒç»­è·Ÿè¸ªç”¨æˆ·å½“å‰å…³å¿ƒä»€ä¹ˆï¼ˆå±å¹•ä¸Šæœ‰ä»€ä¹ˆï¼‰ï¼Œæ¥ç¡®ä¿ç³»ç»Ÿç»§ç»­è¿è¡Œåœ¨æ‰˜ç®¡ç€activityçš„è¿›ç¨‹ã€‚\n* äº†è§£å…ˆå‰ä½¿ç”¨çš„è¿›ç¨‹åŒ…å«ç”¨æˆ·å¯èƒ½è¿”å›çš„å†…å®¹ï¼ˆå·²åœæ­¢çš„activityï¼‰ï¼Œå› æ­¤æ›´ä¼˜å…ˆåœ°ä¿æŒè¿™äº›è¿›ç¨‹ã€‚\n* å¸®åŠ©appå¤„ç†ç»ˆæ­¢å…¶è¿›ç¨‹çš„æƒ…å†µï¼Œä¾¿äºç”¨æˆ·è¿”å›åˆ°å·²æ¢å¤å…¶ä¹‹å‰çŠ¶æ€çš„activityã€‚\n* ä¸ºappæä¾›ä¸€ç§ç”¨æˆ·æµäº¤äº’çš„å®ç°ï¼Œå¹¶è®©ç³»ç»Ÿåè°ƒè¿™äº›æµã€‚ï¼ˆæœ€ç»å…¸çš„ç¤ºä¾‹æ˜¯å…±äº«ï¼‰\n\n>An *activity* is the entry point for interacting with the user. It represents a single screen with a user interface. For example, an email app might have one activity that shows a list of new emails, another activity to compose an email, and another activity for reading emails. Although the activities work together to form a cohesive user experience in the email app, each one is independent of the others. As such, a different app can start any one of these activities if the email app allows it. For example, a camera app can start the activity in the email app that composes new mail to allow the user to share a picture. An activity facilitates the following key interactions between system and app:\n>\n>- Keeping track of what the user currently cares about (what is on screen) to ensure that the system keeps running the process that is hosting the activity.\n>- Knowing that previously used processes contain things the user may return to (stopped activities), and thus more highly prioritize keeping those processes around.\n>- Helping the app handle having its process killed so the user can return to activities with their previous state restored.\n>- Providing a way for apps to implement user flows between each other, and for the system to coordinate these flows. (The most classic example here being share.)\n\n# å¼‚æ­¥æ¶ˆæ¯Intentå¯åŠ¨ç»„ä»¶\n\nåœ¨å››ç§ç»„ä»¶ç±»å‹ä¸­ï¼Œæœ‰ä¸‰ç§ç±»å‹ï¼ˆActivity, Service, Broadcast Receiverï¼‰å‡é€šè¿‡**å¼‚æ­¥æ¶ˆæ¯Intent**è¿›è¡Œå¯åŠ¨ï¼ŒIntentä¼šåœ¨è¿è¡Œæ—¶å¯¹å„ä¸ªç»„ä»¶è¿›è¡Œäº’ç›¸ç»‘å®šã€‚å¯ä»¥å°†Intentè§†ä¸ºè¯·æ±‚å…¶ä»–ç»„ä»¶åšå‡ºåŠ¨ä½œçš„ä¿¡ä½¿ï¼Œæ— è®ºè¿™ä¸ªç»„ä»¶æ˜¯å±äºä½ çš„appè¿˜æ˜¯å…¶ä»–appã€‚\n\néœ€è¦ä½¿ç”¨Intentå¯¹è±¡åˆ›å»ºIntentï¼Œè¯¥å¯¹è±¡é€šè¿‡å®šä¹‰æ¶ˆæ¯æ¥å¯åŠ¨ç‰¹å®šç»„ä»¶ï¼ˆæ˜¾å¼Intentï¼‰æˆ–ç‰¹å®šçš„**ç»„ä»¶ç±»å‹**ï¼ˆéšå¼Intentï¼‰ã€‚\n\nå¯¹äºActivityå’ŒæœåŠ¡ï¼ŒIntent ä¼šå®šä¹‰è¦æ‰§è¡Œçš„æ“ä½œï¼ˆä¾‹å¦‚ï¼Œ`view`æˆ–`send`æŸå†…å®¹ï¼‰ï¼Œå¹¶ä¸”å¯æŒ‡å®šå¾…æ“ä½œæ•°æ®çš„`URI`ï¼Œä»¥åŠæ­£åœ¨å¯åŠ¨çš„ç»„ä»¶å¯èƒ½éœ€è¦äº†è§£çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼ŒIntentå¯èƒ½ä¼šä¼ è¾¾å¯¹Activityçš„è¯·æ±‚ï¼Œä»¥ä¾¿æ˜¾ç¤ºå›¾åƒæˆ–æ‰“å¼€ç½‘é¡µã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡å¯åŠ¨Activityæ¥æ¥æ”¶ç»“æœï¼Œè¿™æ ·Activityè¿˜ä¼šè¿”å›`Intent`ä¸­çš„ç»“æœã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å‘å‡ºä¸€ä¸ªIntentï¼Œè®©ç”¨æˆ·é€‰å–æŸä½è”ç³»äººå¹¶å°†å…¶è¿”å›ç»™æ‚¨ã€‚è¿”å›çš„IntentåŒ…å«æŒ‡å‘æ‰€é€‰è”ç³»äººçš„URIã€‚\n\næ¯ç§ç»„ä»¶éƒ½æœ‰ç‹¬ç‰¹çš„å¯åŠ¨æ–¹æ³•ï¼š\n\n1. å¯ä»¥é€šè¿‡ä¼ é€’ä¸€ä¸ª`Intent`è°ƒç”¨`startActivity()`å¯åŠ¨ä¸€ä¸ªactivityæˆ–ç»™è¿™ä¸ªactivityæ–°çš„äº‹æƒ…å»åšã€‚ï¼ˆæˆ–è€…`startActivityForResult()`ï¼Œå½“ä½ æƒ³è®©activityè¿”å›ä¸€ä¸ªç»“æœæ—¶ï¼‰\n2. \n\n# æ¸…å•æ–‡ä»¶ï¼ˆAndroidManifest.xmlï¼‰\n\nåœ¨Androidç³»ç»Ÿå¯åŠ¨åº”ç”¨ç»„ä»¶ä¹‹å‰ï¼Œç³»ç»Ÿå¿…é¡»é€šè¿‡è¯»å–åº”ç”¨çš„æ¸…å•æ–‡ä»¶(`AndroidManifest.xml`)ç¡®è®¤ç»„ä»¶å­˜åœ¨ã€‚åº”ç”¨å¿…é¡»åœ¨æ­¤æ–‡ä»¶ä¸­å£°æ˜å…¶æ‰€æœ‰ç»„ä»¶ï¼Œè¯¥æ–‡ä»¶å¿…é¡»**ä½äºåº”ç”¨é¡¹ç›®ç›®å½•çš„æ ¹ç›®å½•**ä¸­ã€‚\n\né™¤äº†å£°æ˜åº”ç”¨çš„ç»„ä»¶å¤–ï¼Œæ¸…å•æ–‡ä»¶è¿˜æœ‰è®¸å¤šå…¶ä»–ä½œç”¨ï¼Œå¦‚ï¼š\n\n- ç¡®å®šåº”ç”¨éœ€è¦çš„ä»»ä½•ç”¨æˆ·æƒé™ï¼Œå¦‚äº’è”ç½‘è®¿é—®æƒé™æˆ–å¯¹ç”¨æˆ·è”ç³»äººçš„è¯»å–æƒé™ã€‚\n- æ ¹æ®åº”ç”¨ä½¿ç”¨çš„APIï¼Œå£°æ˜åº”ç”¨æ‰€éœ€çš„æœ€ä½[APIçº§åˆ«](https://developer.android.com/guide/topics/manifest/uses-sdk-element#ApiLevels)ã€‚\n- å£°æ˜åº”ç”¨ä½¿ç”¨æˆ–éœ€è¦çš„ç¡¬ä»¶å’Œè½¯ä»¶åŠŸèƒ½ï¼Œå¦‚ç›¸æœºã€è“ç‰™æœåŠ¡æˆ–å¤šç‚¹è§¦æ‘¸å±å¹•ã€‚\n- å£°æ˜åº”ç”¨éœ€è¦é“¾æ¥çš„APIåº“ï¼ˆAndroidæ¡†æ¶APIé™¤å¤–ï¼‰ï¼Œå¦‚[Googleåœ°å›¾åº“](http://code.google.com/android/add-ons/google-apis/maps-overview.html)ã€‚\n\n## å£°æ˜ç»„ä»¶\n\næ¸…å•æ–‡ä»¶çš„ä¸»è¦ä»»åŠ¡æ˜¯å‘ŠçŸ¥ç³»ç»Ÿåº”ç”¨ç»„ä»¶çš„ç›¸å…³ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œæ¸…å•æ–‡ä»¶å¯æŒ‰å¦‚ä¸‹æ‰€ç¤ºå£°æ˜Activityï¼š\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<manifest ... >\n    <application android:icon=\"@drawable/app_icon.png\" ... >\n        <activity android:name=\"com.example.project.ExampleActivity\"\n                  android:label=\"@string/example_label\" ... >\n        </activity>\n        ...\n    </application>\n</manifest>\n```\n\nåœ¨`<application>`å…ƒç´ ä¸­ï¼Œ`android:icon`å±æ€§æŒ‡å‘æ ‡è¯†åº”ç”¨çš„å›¾æ ‡æ‰€å¯¹åº”çš„èµ„æºã€‚\n\nåœ¨`<activity>`å…ƒç´ ä¸­ï¼Œ`android:name`å±æ€§æŒ‡å®š`Activity`å­ç±»çš„å®Œå…¨é™å®šç±»åï¼Œ`android:label`å±æ€§æŒ‡å®šç”¨ä½œActivityçš„ç”¨æˆ·å¯è§æ ‡ç­¾çš„å­—ç¬¦ä¸²ã€‚\n\næ‚¨å¿…é¡»ä½¿ç”¨ä»¥ä¸‹å…ƒç´ å£°æ˜æ‰€æœ‰åº”ç”¨ç»„ä»¶ï¼š\n\n- Activityçš„`<activity>`å…ƒç´ ã€‚\n- æœåŠ¡çš„`<service>`å…ƒç´ ã€‚\n- å¹¿æ’­æ¥æ”¶å™¨çš„`<receiver>`å…ƒç´ ã€‚\n- å†…å®¹æä¾›ç¨‹åºçš„`<provider>`å…ƒç´ ã€‚\n\nå¦‚æœæœªåœ¨æ¸…å•æ–‡ä»¶ä¸­å£°æ˜æºä»£ç ä¸­åŒ…å«çš„Activityã€æœåŠ¡å’Œå†…å®¹æä¾›ç¨‹åºï¼Œåˆ™è¿™äº›ç»„ä»¶å¯¹ç³»ç»Ÿä¸å¯è§ï¼Œå› æ­¤ä¸ä¼šè¿è¡Œã€‚ä¸è¿‡ï¼Œå¯ä»¥`BroadcastReceiver`å¯¹è±¡çš„å½¢å¼ï¼Œåœ¨æ¸…å•ä¸­å£°æ˜æˆ–åœ¨ä»£ç ä¸­åŠ¨æ€åˆ›å»ºå¹¿æ’­æ¥æ”¶å™¨ï¼›ä»¥åŠé€šè¿‡è°ƒç”¨`registerReceiver()`ï¼Œåœ¨ç³»ç»Ÿä¸­æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨ã€‚\n\n## å£°æ˜ç»„ä»¶åŠŸèƒ½\n\nå¦‚ä¸Šæ–‡å¯åŠ¨ç»„ä»¶ä¸­æ‰€è¿°ï¼Œå¯ä»¥ä½¿ç”¨`Intent`æ¥å¯åŠ¨Activityã€æœåŠ¡å’Œå¹¿æ’­æ¥æ”¶å™¨ã€‚æ‚¨å¯ä»¥é€šè¿‡åœ¨Intentä¸­æ˜¾å¼å‘½åç›®æ ‡ç»„ä»¶ï¼ˆä½¿ç”¨ç»„ä»¶ç±»åï¼‰æ¥ä½¿ç”¨`Intent`ã€‚è¿˜å¯ä½¿ç”¨éšå¼Intentï¼Œé€šè¿‡å®ƒæ¥æè¿°è¦æ‰§è¡Œçš„æ“ä½œç±»å‹å’Œå¾…æ“ä½œæ•°æ®ï¼ˆå¯é€‰ï¼‰ã€‚å€ŸåŠ©éšå¼ Intentï¼Œç³»ç»Ÿèƒ½å¤Ÿåœ¨è®¾å¤‡ä¸Šæ‰¾åˆ°å¯æ‰§è¡Œè¯¥æ“ä½œçš„ç»„ä»¶ï¼Œå¹¶å¯åŠ¨è¯¥ç»„ä»¶ã€‚å¦‚æœæœ‰å¤šä¸ªç»„ä»¶å¯ä»¥æ‰§è¡ŒIntentæ‰€æè¿°çš„æ“ä½œï¼Œåˆ™**ç”±ç”¨æˆ·é€‰æ‹©ä½¿ç”¨å“ªä¸€ä¸ªç»„ä»¶**ã€‚\n\n>æ³¨æ„ï¼šå¦‚æœä½¿ç”¨Intentæ¥å¯åŠ¨`Service`ï¼Œéœ€è¦ä½¿ç”¨æ˜¾å¼Intentæ¥ç¡®ä¿åº”ç”¨çš„å®‰å…¨æ€§ã€‚ä½¿ç”¨éšå¼Intentå¯åŠ¨æœåŠ¡å­˜åœ¨å®‰å…¨éšæ‚£ï¼Œå› ä¸ºæ— æ³•ç¡®å®šå“ªäº›æœåŠ¡å°†å“åº”Intentï¼Œä¸”ç”¨æˆ·æ— æ³•çœ‹åˆ°å“ªäº›æœåŠ¡å·²å¯åŠ¨ã€‚ä»Android 5.0ï¼ˆAPIçº§åˆ«21ï¼‰å¼€å§‹ï¼Œå¦‚æœä½¿ç”¨éšå¼Intentè°ƒç”¨`bindService()`ï¼Œç³»ç»Ÿä¼šæŠ›å‡ºå¼‚å¸¸ã€‚æ‰€ä»¥å‹¿ä¸ºæœåŠ¡å£°æ˜Intentè¿‡æ»¤å™¨ã€‚\n\né€šè¿‡å°†æ”¶åˆ°çš„Intentä¸è®¾å¤‡ä¸Šå…¶ä»–åº”ç”¨çš„æ¸…å•æ–‡ä»¶ä¸­æä¾›çš„**Intentè¿‡æ»¤å™¨**è¿›è¡Œæ¯”è¾ƒï¼Œç³»ç»Ÿä¾¿å¯è¯†åˆ«èƒ½å“åº”Intentçš„ç»„ä»¶ã€‚\n\nåœ¨åº”ç”¨çš„æ¸…å•æ–‡ä»¶ä¸­å£°æ˜Activityæ—¶ï¼Œæ‚¨å¯ä»¥é€‰æ‹©æ€§åœ°åŠ å…¥å£°æ˜ActivityåŠŸèƒ½çš„Intentè¿‡æ»¤å™¨ï¼Œä»¥ä¾¿å“åº”æ¥è‡ªå…¶ä»–åº”ç”¨çš„ Intentã€‚å¯ä»¥å°†`<intent-filter>`å…ƒç´ ä½œä¸ºç»„ä»¶å£°æ˜å…ƒç´ çš„å­é¡¹è¿›è¡Œæ·»åŠ ï¼Œä»è€Œä¸ºç»„ä»¶å£°æ˜Intentè¿‡æ»¤å™¨ã€‚\n\nä¾‹å¦‚ï¼Œå¦‚æœæ„å»ºçš„ç”µå­é‚®ä»¶åº”ç”¨åŒ…å«ç”¨äºæ’°å†™æ–°ç”µå­é‚®ä»¶çš„Activityï¼Œåˆ™å¯é€šè¿‡å£°æ˜Intentè¿‡æ»¤å™¨æ¥å“åº”`â€œsendâ€`Intentï¼ˆç›®çš„æ˜¯å‘é€æ–°ç”µå­é‚®ä»¶ï¼‰ï¼Œå¦‚ä¸‹æ–¹ç¤ºä¾‹æ‰€ç¤ºï¼š\n\n```xml\n<manifest ... >\n    ...\n    <application ... >\n        <activity android:name=\"com.example.project.ComposeEmailActivity\">\n            <intent-filter>\n                <action android:name=\"android.intent.action.SEND\" />\n                <data android:type=\"*/*\" />\n                <category android:name=\"android.intent.category.DEFAULT\" />\n            </intent-filter>\n        </activity>\n    </application>\n</manifest>\n```\n\nå¦‚æœå¦ä¸€ä¸ªåº”ç”¨åˆ›å»ºåŒ…å«`ACTION_SEND`æ“ä½œçš„Intentå¹¶å°†å…¶ä¼ é€’åˆ°`startActivity()`ï¼Œåˆ™ç³»ç»Ÿå¯èƒ½ä¼šå¯åŠ¨æ‚¨çš„Activityï¼Œä»¥ä¾¿ç”¨æˆ·èƒ½å¤Ÿè‰æ‹Ÿå¹¶å‘é€ç”µå­é‚®ä»¶ã€‚\n\n## å£°æ˜åº”ç”¨è¦æ±‚\n\nAndroidè®¾å¤‡å¤šç§å¤šæ ·ï¼Œä½†å¹¶éæ‰€æœ‰è®¾å¤‡éƒ½æä¾›ç›¸åŒçš„ç‰¹æ€§å’ŒåŠŸèƒ½ã€‚ä»¥é˜²å°†åº”ç”¨å®‰è£…åœ¨ç¼ºå°‘åº”ç”¨æ‰€éœ€ç‰¹æ€§çš„è®¾å¤‡ä¸Šï¼Œå¿…é¡»é€šè¿‡åœ¨æ¸…å•æ–‡ä»¶ä¸­å£°æ˜è®¾å¤‡å’Œè½¯ä»¶è¦æ±‚ï¼Œä¸ºè¯¥åº”ç”¨æ”¯æŒçš„è®¾å¤‡ç±»å‹æ˜ç¡®å®šä¹‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ã€‚å…¶ä¸­çš„å¤§å¤šæ•°å£°æ˜åªæ˜¯ä¸ºäº†æä¾›ä¿¡æ¯ï¼Œç³»ç»Ÿå¹¶ä¸ä¼šè¯»å–å®ƒä»¬ï¼Œä½†Google Playç­‰å¤–éƒ¨æœåŠ¡ä¼šè¯»å–å®ƒä»¬ï¼Œä»¥ä¾¿åœ¨ç”¨æˆ·é€šè¿‡å…¶è®¾å¤‡æœç´¢åº”ç”¨æ—¶ä¸ºç”¨æˆ·æä¾›è¿‡æ»¤åŠŸèƒ½ã€‚\n\nä¾‹å¦‚ï¼Œå¦‚æœåº”ç”¨éœ€è¦ç›¸æœºåŠŸèƒ½ï¼Œå¹¶ä½¿ç”¨Android 2.1ï¼ˆAPIçº§åˆ«7ï¼‰ä¸­å¼•å…¥çš„ APIï¼Œå¿…é¡»åœ¨æ¸…å•æ–‡ä»¶ä¸­å£°æ˜ä»¥ä¸‹è¦æ±‚ï¼Œå¦‚ä¸‹æ–¹ç¤ºä¾‹æ‰€ç¤ºï¼š\n\n```xml\n<manifest ... >\n    <uses-feature android:name=\"android.hardware.camera.any\"\n                  android:required=\"true\" />\n    <uses-sdk android:minSdkVersion=\"7\" android:targetSdkVersion=\"19\" />\n    ...\n</manifest>\n```\n\né€šè¿‡ç¤ºä¾‹ä¸­æ‰€è¿°çš„å£°æ˜ï¼Œæ²¡æœ‰ç›¸æœºä¸”Androidç‰ˆæœ¬ä½äº2.1çš„è®¾å¤‡å°†æ— æ³•ä»Google Playå®‰è£…æ‚¨çš„åº”ç”¨ã€‚ä¸è¿‡ï¼Œå¯ä»¥å£°æ˜åº”ç”¨ä½¿ç”¨ç›¸æœºï¼Œä½†å¹¶ä¸è¦æ±‚å¿…é¡»ä½¿ç”¨ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œ`required`å±æ€§è®¾ç½®ä¸º`false`ï¼Œå¹¶åœ¨è¿è¡Œæ—¶æ£€æŸ¥è®¾å¤‡æ˜¯å¦æ‹¥æœ‰ç›¸æœºï¼Œç„¶åæ ¹æ®éœ€è¦åœç”¨ä»»ä½•ç›¸æœºåŠŸèƒ½ã€‚\n\n# åº”ç”¨èµ„æº\n\nAndroidåº”ç”¨å¹¶éä»…åŒ…å«ä»£ç ï¼Œå®ƒè¿˜éœ€è¦ä¸æºä»£ç åˆ†ç¦»çš„èµ„æºï¼Œå¦‚å›¾åƒã€éŸ³é¢‘æ–‡ä»¶ä»¥åŠä»»ä½•ä¸åº”ç”¨çš„è§†è§‰å‘ˆç°æœ‰å…³çš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡XMLæ–‡ä»¶å®šä¹‰Activityç•Œé¢çš„åŠ¨ç”»ã€èœå•ã€æ ·å¼ã€é¢œè‰²å’Œå¸ƒå±€ã€‚å€ŸåŠ©åº”ç”¨èµ„æºï¼Œæ— éœ€ä¿®æ”¹ä»£ç å³å¯è½»æ¾æ›´æ–°åº”ç”¨çš„å„ç§ç‰¹æ€§ã€‚é€šè¿‡æä¾›å¤‡ç”¨èµ„æºé›†ï¼Œå¯ä»¥é’ˆå¯¹å„ç§è®¾å¤‡é…ç½®ï¼ˆå¦‚ä¸åŒçš„è¯­è¨€å’Œå±å¹•å°ºå¯¸ï¼‰ä¼˜åŒ–åº”ç”¨ã€‚\n\nå¯¹äºåœ¨Androidé¡¹ç›®ä¸­åŠ å…¥çš„æ¯ä¸€é¡¹èµ„æºï¼ŒSDKæ„å»ºå·¥å…·å‡ä¼šå®šä¹‰å”¯ä¸€çš„æ•´å‹IDï¼Œå¯ä»¥åˆ©ç”¨æ­¤IDæ¥å¼•ç”¨èµ„æºï¼Œè¿™äº›èµ„æºæˆ–æ¥è‡ªåº”ç”¨ä»£ç ï¼Œæˆ–æ¥è‡ªXMLä¸­å®šä¹‰çš„å…¶ä»–èµ„æºã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„åº”ç”¨åŒ…å«åä¸º`logo.png`çš„å›¾åƒæ–‡ä»¶ï¼ˆä¿å­˜åœ¨`res/drawable/`ç›®å½•ä¸­ï¼‰ï¼Œåˆ™SDKå·¥å…·ä¼šç”Ÿæˆåä¸º`R.drawable.logo`çš„èµ„æºIDã€‚æ­¤IDæ˜ å°„åˆ°åº”ç”¨ç‰¹å®šçš„æ•´å‹æ•°ï¼Œæ‚¨å¯ä»¥åˆ©ç”¨å®ƒæ¥å¼•ç”¨è¯¥å›¾åƒï¼Œå¹¶å°†å…¶æ’å…¥æ‚¨çš„ç•Œé¢ã€‚\n\nå¦‚æœæä¾›ä¸æºä»£ç åˆ†ç¦»çš„èµ„æºï¼Œåˆ™å…¶ä¸­æœ€é‡è¦çš„ä¸€ä¸ªä¼˜ç‚¹åœ¨äºï¼Œå¯ä»¥æä¾›é€‚ç”¨äºä¸åŒè®¾å¤‡é…ç½®çš„å¤‡ç”¨èµ„æºã€‚ä¾‹å¦‚ï¼Œé€šè¿‡åœ¨XMLä¸­å®šä¹‰ç•Œé¢å­—ç¬¦ä¸²ï¼Œå¯ä»¥å°†å­—ç¬¦ä¸²ç¿»è¯‘ä¸ºå…¶ä»–è¯­è¨€ï¼Œå¹¶å°†è¿™äº›å­—ç¬¦ä¸²ä¿å­˜åœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­ã€‚ç„¶åï¼ŒAndroidç³»ç»Ÿä¼šæ ¹æ®å‘èµ„æºç›®å½•åç§°è¿½åŠ çš„è¯­è¨€é™å®šç¬¦ï¼ˆå¦‚ä¸ºæ³•è¯­å­—ç¬¦ä¸²å€¼è¿½åŠ `res/values-fr/`ï¼‰å’Œç”¨æˆ·çš„è¯­è¨€è®¾ç½®ï¼Œå¯¹ç•Œé¢åº”ç”¨ç›¸åº”çš„è¯­è¨€å­—ç¬¦ä¸²ã€‚\n\nAndroidæ”¯æŒè®¸å¤šä¸åŒçš„å¤‡ç”¨èµ„æºé™å®šç¬¦ã€‚é™å®šç¬¦æ˜¯èµ„æºç›®å½•åç§°ä¸­åŠ å…¥çš„çŸ­å­—ç¬¦ä¸²ï¼Œç”¨äºå®šä¹‰è¿™äº›èµ„æºé€‚ç”¨çš„è®¾å¤‡é…ç½®ã€‚ä¾‹å¦‚ï¼Œæ‚¨åº”æ ¹æ®è®¾å¤‡çš„å±å¹•æ–¹å‘å’Œå°ºå¯¸ä¸ºActivityåˆ›å»ºä¸åŒçš„å¸ƒå±€ã€‚å½“è®¾å¤‡å±å¹•ä¸ºçºµå‘ï¼ˆé•¿å‹ï¼‰æ—¶ï¼Œå¯èƒ½æƒ³è¦ä¸€ç§å‚ç›´æ’åˆ—æŒ‰é’®çš„å¸ƒå±€ï¼›ä½†å½“å±å¹•ä¸ºæ¨ªå‘ï¼ˆå®½å‹ï¼‰æ—¶ï¼Œå¯ä»¥æŒ‰æ°´å¹³æ–¹å‘æ’åˆ—æŒ‰é’®ã€‚å¦‚è¦æ ¹æ®æ–¹å‘æ›´æ”¹å¸ƒå±€ï¼Œå¯ä»¥å®šä¹‰ä¸¤ç§ä¸åŒçš„å¸ƒå±€ï¼Œç„¶åå¯¹æ¯ä¸ªå¸ƒå±€çš„ç›®å½•åç§°åº”ç”¨ç›¸åº”çš„é™å®šç¬¦ã€‚ç„¶åï¼Œç³»ç»Ÿä¼šæ ¹æ®å½“å‰è®¾å¤‡æ–¹å‘è‡ªåŠ¨åº”ç”¨ç›¸åº”çš„å¸ƒå±€ã€‚\n","categories":["Android"]},{"title":"Linux_ä¸‰å‰‘å®¢","url":"/Linux/Linux_ä¸‰å‰‘å®¢/","content":"\n# å†…å®¹\n\n1. grep\n2. awk\n3. sed\n\n# awk\n\næ˜¯æŒ‰`{åŸŸ åˆ†éš”ç¬¦ åŸŸ}`ç”ŸæˆæŠ¥è¡¨çš„å·¥å…·ã€‚\n\nç»å…¸åº”ç”¨æœ‰ï¼šæŠŠï¼ˆæ–‡æœ¬ï¼‰æ–‡ä»¶ä¸­æµ®ç‚¹æ•°çš„æ•´æ•°éƒ¨åˆ†è§£æå‡ºæ¥ã€‚\n\n```sh\n# file.txt\n1.7\n12.89\n23.9\n```\n\n```sh\nawk -F. '{print $1}' file.txt\n# æ‰§è¡Œç»“æœ\n\t# 1\n\t# 12\n\t# 23\n```\n\né‡å®šå‘ï¼š\n\n```sh\nawk -F. '{print $1}' file.txt > newfile\ncat newfile\n# æ‰§è¡Œç»“æœ(æ¥è‡ªnewfile)\n\t# 1\n\t# 12\n\t# 23\n```\n\nå°æ”¹åŠ¨ï¼šæŠŠï¼ˆæ–‡æœ¬ï¼‰æ–‡ä»¶**ä¸­æµ®ç‚¹æ•°çš„**å°æ•°**éƒ¨åˆ†è§£æå‡ºæ¥ã€‚\n\n```sh\nawk -F. '{print $2}' file.txt > newfile\ncat newfile\n# æ‰§è¡Œç»“æœ(æ¥è‡ªnewfile)\n\t# 7\n\t# 89\n\t# 9\n```\n\n```sh\ncp /etc/passwd .\nawk -F: '{print $1,$3}' passwd\nawk -F: '{if($3 >= 1000) print $1,$3}' passwd\nawk -F: 'BEGIN{print \"name\\t uid\"}{print $1\"\\t\"$3}END{print\"----end----\"}' passwd\n```\n\n## åœºæ™¯--å¯¹å‘½ä»¤æ‰§è¡Œè¾“å‡ºçš„ä¿¡æ¯è¿›è¡Œå¤„ç†\n\n### ç¼–å†™è„šæœ¬æ€æ­»å…¨éƒ¨å½“å‰æ­£åœ¨ç¡çœ çš„è¿›ç¨‹\n\n```sh\n# some shells are sleeping...\nps -ef | grep sleep | grep -v \"grep\"\n# xcg\t4168\t4162\t0\t......\nps -ef | grep sleep | grep -v \"grep\" | awk '{print $2}' # 4168\n```\n\n```sh\n#!/usr/bin/bash\nPIDS=`ps -ef | grep sleep | grep -v \"grep\" | awk '{print $2}'`\nif [ -z \"$PIDS\" ]\nthen\n\techo \"æ²¡æœ‰sleepingè¿›ç¨‹åœ¨è¿è¡Œ\"\n\texit 0\nfi\nfor pid in $PIDS\t\t# PIDSä¸è¦åŠ åŒå¼•å·ï¼Œå¦‚æœåŠ äº†ï¼Œé‚£ä¹ˆpidä¼šä¸€æ¬¡æ¥æ”¶æ•´ä¸ªPIDSã€‚è™½ç„¶ä¹Ÿèƒ½(kill xxx xxx,è€Œä¸æ˜¯kill xxx,kill xxx)ã€‚ä½†æ˜¯echoåªechoä¸€æ¬¡ï¼Œè¾“å‡ºå‡ºç°é—®é¢˜ã€‚\ndo\n\tkill $pid\n\techo \"è¿›ç¨‹:$pid è¢«æ€æ­»äº†\"\ndone\n```\n\n### ç»“åˆnetstat -natpå‘½ä»¤\n\nè·å–ç«¯å£ã€åœ°å€ä¿¡æ¯ã€çŠ¶æ€ä¿¡æ¯å»å¤„ç†\n\n### ç»“åˆfreeå‘½ä»¤\n\n# sed\n\næ˜¯å¯¹æ–‡ä»¶è¿›è¡Œç¼–è¾‘çš„å·¥å…·ã€‚åœ¨æŸè¡Œå¢åˆ å†…å®¹ã€‚\n\nç¤ºä¾‹ï¼šå¯¹æ–‡ä»¶æ–‡æœ¬è¿›è¡Œç®€å•å¤„ç†\n\n```sh\n# file.txt\n1.7\n12.89\n23.9\n```\n\n```sh\nsed '2i\\3.3' file.txt > newfile # åœ¨ç¬¬äºŒè¡Œä¹‹å‰æ’å…¥3.3ï¼Œä¹‹åçš„è¡Œä¸‹ç§»ä¸€è¡Œã€\n# 1.7\n# 3.3\n# 12.89\n# 23.9\n```\n\n```sh\nsed '2a\\3.3' file.txt > newfile # åœ¨ç¬¬äºŒè¡Œä¸‹é¢é™„åŠ 3.3ï¼Œä¹‹åçš„è¡Œä¸‹ç§»ä¸€è¡Œ\n# 1.7\n# 12.89\n# 3.3\n# 23.9\n```\n\n```sh\nsed '2,3d' file.txt > newfile # åˆ é™¤ç¬¬2ã€3è¡Œ\n# 1.7\n```\n\n```sh\nsed '1,2p' file.txt # æ‰“å°1~2è¡Œï¼Œä½†æ˜¯é»˜è®¤ä¼šé‡å¤æ‰“å°\n# 1.7\n# 1.7\n# 12.89\n# 12.89\n# 23.9\nsed '1,3p' file.txt # æ‰“å°1~3è¡Œï¼Œä½†æ˜¯é»˜è®¤ä¼šé‡å¤æ‰“å°\n# 1.7\n# 1.7\n# 12.89\n# 12.89\n# 23.9\n# 23.9\nsed -n '1,2p' file.txt # åªæ‰“å°1~2è¡Œ\n# 1.7\n# 12.89\n```\n\n# ä¸‰å‰‘å®¢ç»“åˆ\n\nè¦çµæ´»è¿ç”¨ä¸‰å‰‘å®¢ï¼Œåº”å¯¹ä¸¤ç§ç»“åˆæ–¹å¼ï¼š\n\n1. ç»“åˆï¼Œå¯¹æ–‡ä»¶æ“ä½œ\n2. ç»“åˆï¼Œå¯¹å‘½ä»¤æ“ä½œ\n\n```sh\nnetstat -natp\t\t\t      # æœªè¿‡æ»¤\nnetstat -natp | grep tcp      # æ³¨æ„ï¼Œæ­¤æ—¶ \"|\" è¿™ä¸ªç®¡é“åªèƒ½ç”¨æ¥ è¿‡æ»¤ æ ‡å‡†è¾“å‡º(1)çš„ä¿¡æ¯ï¼Œå¦‚æœå‰é¢çš„ä¿¡æ¯æœ‰æ ‡å‡†é”™è¯¯è¾“å‡ºstderr(2)åˆ™æ— æ³•è¿‡æ»¤ã€‚\nnetstat -natp 2>&1 | grep tcp # æ­¤æ—¶å·²æŠŠæ ‡å‡†é”™è¯¯è¾“å‡º2é‡å®šå‘åˆ°1,è¿™æ—¶å†è¿‡æ»¤æ—¶å°†ä¼šä¸€è§†åŒä»ã€‚\n```\n\næœªè¿‡æ»¤çš„ç»“æœï¼š\n![image-20220222015642539](../../images/Linux_ä¸‰å‰‘å®¢/image-20220222015642539.png)\n\næ ‡å‡†é”™è¯¯è¾“å‡ºæœªé‡å®šå‘æ—¶ï¼š\n`|`ç®¡é“é»˜è®¤åªä¼ è¾“æ ‡å‡†è¾“å‡º1çš„å†…å®¹ï¼Œå› æ­¤grepåªå¯¹æ ‡å‡†è¾“å‡º1è¿›è¡Œäº†è¿‡æ»¤ã€‚ç¬¬ä¸€è¡Œæ‹¬å·çš„æç¤ºå†…å®¹æ˜¯æ ‡å‡†é”™è¯¯è¾“å‡º2çš„ä¸œè¥¿ã€‚\n![image-20220222015307603](../../images/Linux_ä¸‰å‰‘å®¢/image-20220222015307603.png)\n\næ ‡å‡†é”™è¯¯è¾“å‡ºé‡å®šå‘åï¼ˆè¿‡æ»¤æ‰ä¸Šé¢çš„æç¤ºä¿¡æ¯ï¼‰ï¼š\n`netstat -natp 2>&1 | grep tcp`\nå…¶ä¸­ï¼Œ`2>&1`è¡¨ç¤ºçš„æ˜¯ï¼šæ ‡å‡†è¾“å‡º2é‡å®šå‘åˆ°1ï¼Œå…¶ä¸­ï¼Œ`>&`å¿…é¡»åŒæ—¶ä½¿ç”¨ï¼Œè¡¨ç¤ºï¼šæŠŠ2é‡å®šå‘åˆ°1å¹¶ä¸”ä¸€èµ·ä¼ è¾“ç»™ç®¡é“ã€‚\n`2>1`ä¸èƒ½ï¼šåˆ›å»ºåä¸º \"1\" çš„æ–‡ä»¶å¹¶å†™å…¥é”™è¯¯ä¿¡æ¯ã€‚\n`2&1`ä¸èƒ½ï¼šè¯¯è®¤ä¸º`&`æ˜¯åå°æ‰§è¡Œå‘½ä»¤\n![image-20220222015341443](../../images/Linux_ä¸‰å‰‘å®¢/image-20220222015341443.png)\n\nsedå‰”é™¤å‰nè¡Œåï¼ˆè¿‡æ»¤æ‰ä¸Šé¢çš„æç¤ºä¿¡æ¯åšæ³•2ï¼‰ï¼š\n\n```sh\nnetstat -natp | sed -n '4,$p' # è¾“å‡º4è¡ŒåŠä¹‹åçš„å…¨éƒ¨è¡Œ\n```\n\n![image-20220222015940913](../../images/Linux_ä¸‰å‰‘å®¢/image-20220222015940913.png)\n\nç»“åˆawkæå–ç¬¬4åˆ—ï¼ˆLocal Addressï¼‰ï¼š\n\n```sh\nnetstat -natp | sed -n '4,$p' | awk 'print $4'\n```\n\n![image-20220222020120370](../../images/Linux_ä¸‰å‰‘å®¢/image-20220222020120370.png)\n\næ¥ä¸Šä¸€æ­¥ï¼Œæå–åœ°å€ä¿¡æ¯ä¸­çš„ç«¯å£å·ã€‚\n\n```sh\nnetstat -natp | sed -n '4,$p' | awk 'print $4' | awk -F: '{print $2}'\n```\n\n![image-20220222020238848](../../images/Linux_ä¸‰å‰‘å®¢/image-20220222020238848.png)\n\nä½†æ˜¯å‡ºç°é—®é¢˜ï¼Œæœ€åçš„\":::22\"å’Œ\"::1:631\"è¢«å¿½ç•¥äº†ã€‚éœ€è¦å¦åˆ†ä¸€ç±»ç‰¹æ®Šå¤„ç†ã€‚\n\nç„¶åï¼Œæˆ‘ä»¬ç”¨ä¸Šé¢è¿™ä¸ªå‘½ä»¤ï¼Œå¯ä»¥åšä»¥ä¸‹å·¥ä½œï¼šæŸ¥è¯¢æŸä¸ªç«¯å£æ˜¯å¦è¢«æ‰“å¼€ï¼Ÿ\n\n```sh\n#!/usr/bin/bash\nif [ \"$#\" -ne 1 ]\nthen\n\techo \"è¯·è¾“å…¥æŸ¥è¯¢çš„ç«¯å£\"\n\texit 0\nfi\n\ntest_port=$1\n\nPORTS=`netstat -natp 2>&1 | sed -n '4,$p' | awk '{print $4}' | awk -F: '{print $2}'`\nif [ -z \"$PORTS\" ]\nthen\n\techo \"æ²¡æœ‰æ‰“å¼€çš„ç«¯å£\"\n\texit 0\nfi\n\nport=\"\"\nfor i in $PORTS\ndo\n\tif [ \"$i\" -eq \"$test_port\" ]\n\tthen\n\t\tport=$i\n\tfi\ndone\nif [ -n \"$port\" ]\nthen\n\techo \"ç«¯å£:$port æ˜¯æ‰“å¼€çš„\"\nelse\n\techo \"ç«¯å£:$port æœªæ‰“å¼€\"\nfi\n```\n\n![image-20220222020743625](../../images/Linux_ä¸‰å‰‘å®¢/image-20220222020743625.png)\n\n# æ—¥ç§¯æœˆç´¯\n\n## awkä»æŒ‡å®šåˆ—æ‰“å°åˆ°æœ€åä¸€åˆ—\n\nhttps://stackoverflow.com/questions/1602035/how-to-print-third-column-to-last-column\n\n![image-20220801103120355](../../images/Linux_ä¸‰å‰‘å®¢/image-20220801103120355.png)\n\n![image-20220801103359029](../../images/Linux_ä¸‰å‰‘å®¢/image-20220801103359029.png)\n\nå…¶ä¸­ï¼Œæ¶‰åŠäº†ä¸¤ä¸ªawkå†…ç½®å˜é‡ï¼šNFå’ŒFSã€‚\n\n![image-20220801103601475](../../images/Linux_ä¸‰å‰‘å®¢/image-20220801103601475.png)\n","categories":["Linux"]},{"title":"git_stash","url":"/git/git_stash/","content":"\nå‚è€ƒæ–‡ç« ï¼šhttps://blog.csdn.net/qq_32452623/article/details/76100140\n\n# ä¸€å¥è¯è§£é‡Šstashçš„å·¥ä½œ\n\nå°†ä¿®æ”¹å­˜å‚¨åˆ°æš‚å­˜åŒºï¼Œå·¥ä½œåŒºä¼šåˆ é™¤è¿™äº›ä¿®æ”¹ã€‚\n\næ€»çš„æ¥è¯´ï¼Œgit stashå‘½ä»¤çš„ä½œç”¨å°±æ˜¯å°†ç›®å‰è¿˜ä¸æƒ³æäº¤çš„ä½†æ˜¯å·²ç»ä¿®æ”¹çš„å†…å®¹è¿›è¡Œä¿å­˜è‡³å †æ ˆä¸­ï¼Œåç»­å¯ä»¥åœ¨æŸä¸ªåˆ†æ”¯ä¸Šæ¢å¤å‡ºå †æ ˆä¸­çš„å†…å®¹ã€‚è¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œ**stashä¸­çš„å†…å®¹ä¸ä»…ä»…å¯ä»¥æ¢å¤åˆ°åŸå…ˆå¼€å‘çš„åˆ†æ”¯ï¼Œä¹Ÿå¯ä»¥æ¢å¤åˆ°å…¶ä»–ä»»æ„æŒ‡å®šçš„åˆ†æ”¯ä¸Š**ã€‚\n\ngit stashä½œç”¨çš„èŒƒå›´åŒ…æ‹¬å·¥ä½œåŒºå’Œæš‚å­˜åŒºä¸­çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰æäº¤çš„å†…å®¹éƒ½ä¼šä¿å­˜è‡³å †æ ˆä¸­ã€‚\n\n# ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å®ƒ\n\nä½¿ç”¨è¿™ä¸ªå‘½ä»¤çš„åœºæ™¯ï¼š\n\næ­¤æ—¶æˆ‘åœ¨`feature_666`åˆ†æ”¯éå¸¸èšç²¾ä¼šç¥åŠ æŒé«˜ä¸“æ³¨åœ°å®ç°ä¸€ä¸ªåŠŸèƒ½`666`æ¨¡å—ï¼Œç®€ç›´é”®ç›˜å¦‚é£çš„ç¼–å†™ä»£ç ã€‚\n\nç„¶åè¿™æ—¶ï¼Œå®¢æˆ·åé¦ˆå‡ºä¸€ä¸ªbugï¼Œéå¸¸ä¸¥é‡ï¼Œå¿…é¡»ç«‹é©¬è§£å†³ï¼Œä¼˜å…ˆçº§ä¸º0ï¼\n\näºæ˜¯ï¼Œéœ€è¦å»åˆ°`release`åˆ†æ”¯å»checkoutæ–°çš„åˆ†æ”¯å»å·¥ä½œäº†ï¼Œä½†æ˜¯`666`åŠŸèƒ½è¿˜æ²¡å®Œæˆæ€ä¹ˆåŠï¼Ÿ\n\næ­¤æ—¶é¢ä¸´ç€ä¸€ä¸ªé€‰æ‹©é¢˜ï¼š\n\nAï¼šæäº¤ååˆ‡æ¢ï¼Œä»£ç ä¿å­˜åˆ°åˆ†æ”¯`feature_666`ï¼Œå´äº§ç”Ÿä¸€ä¸ªæ— æ„ä¹‰çš„æäº¤\n\nBï¼šä¸æäº¤ç›´æ¥åˆ‡æ¢ï¼Œç„¶è€Œè¿™ä¸ªé€‰é¡¹æ ¹æœ¬æ²¡äººä¼šé€‰ã€‚\n\næ˜¯ä¸æ˜¯å¾ˆéš¾é€‰ï¼Œæ­¤æ—¶ï¼Œåˆ«å¿˜è®°è¿˜æœ‰Cé€‰é¡¹ï¼\n\nCï¼šä½¿ç”¨`git stash`ï¼Œå°†å½“å‰ä¿®æ”¹(æœªæäº¤çš„ä»£ç )å­˜å…¥ç¼“å­˜åŒºï¼Œåˆ‡æ¢åˆ†æ”¯ä¿®æ”¹bugï¼Œå›æ¥å†é€šè¿‡`git stash pop`å–å‡ºæ¥ã€‚\n\n```bash\ngit stash save \"æœ¬åœ°ç¼“å­˜å†…å®¹æ ‡è¯†\" # æŠŠæœ¬åœ°å½“å‰æ”¹åŠ¨æš‚å­˜èµ·æ¥ï¼Œæ­¤æ—¶masteråˆ†æ”¯å°±æ¢å¤åˆ°äº†ä¸Šæ¬¡æ‹‰å–æ—¶çš„çŠ¶æ€\ngit checkout test # åˆ‡æ¢åˆ°éœ€è¦æ”¹åŠ¨çš„åˆ†æ”¯\ngit stash popã€€ã€€ã€€ # å°†æ”¹åŠ¨popåˆ°è‡ªå·±å½“å‰çš„åˆ†æ”¯\n```\n\n\n\n## è¿˜æœ‰ä¸€ç§åœºæ™¯ - ä»£ç å†²çª\n\næˆ‘åœ¨æœ¬åœ°ä¿®æ”¹å¥½åï¼Œå‘ç°è¿œç¨‹åˆ†æ”¯å·²ç»è¢«æ”¹åŠ¨äº†ï¼Œæ­¤æ—¶æˆ‘æœ¬åœ°ä¹Ÿè¢«æ”¹åŠ¨äº†å°±é€ æˆäº†å†²çªï¼Œ**æ— æ³•pushæˆ–è€…pull**ã€‚\n\næ­¤æ—¶å¯ä»¥ä½¿ç”¨`git stash`ï¼š\n\n```bash\ngit stash save \"æœ¬åœ°ç¼“å­˜å†…å®¹æ ‡è¯†\" # æŠŠæœ¬åœ°çš„æ”¹åŠ¨æš‚å­˜èµ·æ¥;\ngit pull # æ‹‰å–è¿œç«¯åˆ†æ”¯ï¼ˆæ­¤æ—¶æœ¬åœ°åˆ†æ”¯ä¼šå›æ»šåˆ°ä¸Šæ¬¡commitçš„æƒ…å†µï¼Œæ–°çš„æ”¹åŠ¨éƒ½å·²ä¿å­˜åœ¨äº†stashä¸­ï¼‰;\ngit stash pop # å°†æ ˆé¡¶æ”¹åŠ¨å†…å®¹é‡æ–°åŠ å›æœ¬åœ°åˆ†æ”¯ï¼Œå°±å¯ä»¥ç»§ç»­ä¿®æ”¹äº†ï¼Œå½“ç„¶ï¼Œå¦‚æœæ”¹å¥½äº†å°±æ˜¯add,commit,pushæ“ä½œã€‚\n```\n\n# ä¾‹å­\n\n## å­˜å‚¨ä¿®æ”¹\n\nOKï¼Œ ä¸Šä¸€ä¸ªcommitçš„æ—¶å€™ï¼Œä»£ç å¿«ç…§æ˜¯è¿™ä¸ªæ ·å­çš„\n\n```java\npublic class MainActivity extends AppCompatActivity {\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n\n        String s = \"å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯xcg\";\n    }\n}\n```\n\næ­¤æ—¶çš„æˆ‘åœ¨å†™ä»£ç å¦‚ä¸‹ï¼š\n\n```java\npublic class MainActivity extends AppCompatActivity {\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n\n        String s = \"å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯xcg\";\n        String s1 = \"æˆ‘ç°åœ¨åœ¨å†™ä¸€ä¸ªè¶…çº§å‰å®³çš„åŠŸèƒ½ï¼Œä½†æ˜¯æˆ‘è¿˜æ²¡å†™å®Œ,ç”šè‡³è¿˜æœ‰ç‚¹åœ°æ–¹åœ¨æŠ¥é”™\";\n    }\n}\n```\nä»£ç åˆ°æ­¤å¤„ï¼Œç´§æ€¥bugå‡ºç°äº†ï¼Œä¸€ç§’éƒ½ä¸èƒ½ç­‰ï¼Œ é€‰æ‹©ä¸‹åˆ—æ“ä½œã€‚\n\n```bash\ngit stash #å°†ä¿®æ”¹å­˜å‚¨åˆ°æš‚å­˜åŒºï¼Œå·¥ä½œåŒºä¼šåˆ é™¤è¿™äº›ä¿®æ”¹\ngit checkout <bug_branch>\n```\n\n![image-20220815152311937](../../images/Linux_git/image-20220815152311937.png)\n\næš‚å­˜åçš„å·¥ä½œåŒºä»£ç ä¼šæ¢å¤åˆ°æœ€åä¸€æ¬¡æäº¤æ—¶çš„ä»£ç ï¼š\n\n```java\npublic class MainActivity extends AppCompatActivity {\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n\n        String s = \"å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯xcg\";\n    }\n}\n```\n\n## æŸ¥çœ‹ä¿®æ”¹\n\nå¦‚æœä½ æœ‰ä¸¢å¤±ä»£ç çš„ç»å†ï¼Œè‚¯å®šä¼šå¯¹è¿™ä¸ªä¹‹å‰æ²¡æ¥è§¦çš„æ–°å‘½ä»¤ä¸æ”¾å¿ƒï¼Œé‚£ä¹ˆæ€ä¹ˆç¡®å®šä½ æ“ä½œæˆåŠŸäº†å‘¢ï¼Ÿ\n\n```bash\ngit stash show #æŸ¥çœ‹åˆšæ‰æš‚å­˜çš„ä¿®æ”¹\n```\n\n![image-20220815152500609](../../images/Linux_git/image-20220815152500609.png)\n\n## å–å‡ºä¿®æ”¹\n\nç°åœ¨bugæ”¹å®Œäº†ï¼Œè¦é‡æ–°å›æ¥å¼€å‘äº†ï¼Œå–å‡ºä¿®æ”¹\n\n```bash\ngit checkout <feture_branch> # åˆ‡æ¢åˆšæ‰åŠŸèƒ½å¼€å‘çš„åˆ†æ”¯\ngit stash pop # å–å‡ºä¿®æ”¹\n```\n\n![image-20220815152542661](../../images/Linux_git/image-20220815152542661.png)\n\nå–å‡ºä¿®æ”¹åçš„å·¥ä½œåŒºä»£ç ä¸ºï¼š\n\n```java\npublic class MainActivity extends AppCompatActivity {\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n\n        String s = \"å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æ®µå°æ†¨\";\n        String s1 = \"æˆ‘ç°åœ¨åœ¨å†™ä¸€ä¸ªè¶…çº§å‰å®³çš„åŠŸèƒ½ï¼Œä½†æ˜¯æˆ‘è¿˜æ²¡å†™å®Œ,ç”šè‡³è¿˜æœ‰ç‚¹åœ°æ–¹åœ¨æŠ¥é”™\";\n    }\n}\n```\n\n# å…³äºstashæ›´å¤šçš„ç»†èŠ‚\n\né€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œå·²ç»çŸ¥é“å¦‚ä½•ä½¿ç”¨git stashäº†ï¼Œä½†æ˜¯ï¼Œå¦‚æœç†è§£å®ƒçš„ä¸€äº›ç»†èŠ‚çš„è¯ï¼Œä¼šä½¿ç”¨å¾—æ›´åŠ çµæ´»å’Œå¾—å¿ƒåº”æ‰‹ã€‚\n\n## ä¿®æ”¹å­˜å‚¨åˆ°ä»€ä¹ˆä½ç½®äº†?\n\nå½“æˆ‘ä»¬ä½¿ç”¨`git init`ç»™é¡¹ç›®æ·»åŠ ç‰ˆæœ¬æ§åˆ¶çš„æ—¶å€™ï¼Œä¼šåœ¨é¡¹ç›®è·¯å¾„ä¸‹ç”Ÿæˆä¸€ä¸ª`.git`éšè—æ–‡ä»¶å¤¹ã€‚`.git`ä¸­å­˜å‚¨ç€ç‰ˆæœ¬ç®¡ç†çš„æ‰€æœ‰ä¿¡æ¯ã€‚`.git/refs/stash`ä¸­ï¼Œå­˜å‚¨çš„æ˜¯æœ€åä¸€ä¸ª`stash`å¯¹åº”çš„èŠ‚ç‚¹æŒ‡é’ˆã€‚\n\n![image-20220815152613130](../../images/Linux_git/image-20220815152613130.png)\n\nåŒæ ·ï¼Œåœ¨`.git/log/refs/stash`ä¸­å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å…¨éƒ¨çš„stashè®°å½•ä¿¡æ¯ã€‚\n\n## å­˜å‚¨å¤šä¸ªstashçš„æƒ…å†µ\n\næˆ‘ä»¬æ¥å°è¯•ä¸€ä¸‹ä¿®æ”¹æ–‡ä»¶ï¼Œç„¶åå†æ¬¡ä½¿ç”¨`git stash`ï¼Œæ­¤æ—¶æˆ‘ä»¬æœ‰ä¸ªä¸¤ä¸ªæš‚å­˜ä¿®æ”¹ï¼Œé‚£ä¹ˆæ€ä¹ˆæŸ¥çœ‹å‘¢ï¼Ÿ\n\n```bash\ngit stash list # æŸ¥çœ‹æš‚å­˜åŒºçš„æ‰€æœ‰æš‚å­˜ä¿®æ”¹è®°å½•\n```\n\n![image-20220815152651571](../../images/Linux_git/image-20220815152651571.png)\n\næ­¤æ—¶ä½ æœ‰æ²¡æœ‰å‘ç°ï¼Œè¿™ä¸¤ä¸ªçš„åç§°æ˜¯ä¸€æ ·ï¼Œè¿™æ˜¯ä¸ªä»€ä¹ˆé¬¼ï¼Ÿ\n\nåˆ«æ€•ï¼Œåç§°æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯æŒ‡å‘çš„ä¿®æ”¹æ˜¯ä¸ä¸€æ ·çš„ï¼Œæˆ‘ä»¬ä»`.git/log/refs/stash`ä¸­å¯ä»¥çœ‹åˆ°ä¸¤è€…çš„å¯¹åº”çš„èŠ‚ç‚¹æŒ‡é’ˆæ˜¯ä¸ä¸€æ ·çš„ã€‚\n\n### å¢åˆ æŸ¥\n\nå¦‚æœå†æ¬¡æ‰§è¡Œgit stashï¼Œæ–°çš„æ”¹åŠ¨å°†ä¼šå‡ºç°åœ¨æ ˆé¡¶ï¼Œæ ˆä¸­å…ƒç´ ä¼šè¶Šæ¥è¶Šå¤šï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨`git stash list`å‘½ä»¤æŸ¥çœ‹æ ˆä¸­å…ƒç´ ï¼Œæ­¤æ—¶æ¯ä¸ªæ ˆä¸­å…ƒç´ ä¼šæœ‰è‡ªå·±å¯¹åº”çš„ç¼–å·ã€‚\n\nä½¿ç”¨`git stash apply stash@{0}`ï¼ˆ0å¯ä»¥æ¢æˆå¯¹åº”ç¼–å·ï¼‰ï¼Œæ¥æ·»åŠ ä¸åŒæ”¹åŠ¨ã€‚åŒæ ·ï¼Œä¹Ÿå¯ä»¥`git stash drop stash@{0}`æ¥åˆ é™¤å¯¹åº”æ”¹åŠ¨ã€‚`git stash clear`å¯ä»¥æ¸…ç©ºã€‚\n\n## stashçš„å­˜å‚¨çš„åç§°æ˜¯æ€ä¹ˆæ¥çš„ï¼Œå¯ä»¥ä¿®æ”¹å—ï¼Ÿ\n\nå½“ä½¿ç”¨`git stash`åˆ›å»ºstashçš„æ—¶å€™ï¼Œä¼šç»™stashä¸€ä¸ªé»˜è®¤çš„åç§°ã€‚\n\n![image-20220815152721588](../../images/Linux_git/image-20220815152721588.png)\n\nä¹‹å‰æœ‰è¯´ï¼Œstashå­˜å‚¨çš„å†…å®¹å°±æ˜¯ï¼Œå½“å‰å·¥ä½œåŒºè·å½“å‰åˆ†æ”¯æœ€åä¸€æ¬¡æäº¤æ—¶çš„ä¿®æ”¹ã€‚æ‰€ä»¥ï¼Œstashçš„é»˜è®¤å‘½åè§„åˆ™å°±æ˜¯ï¼š\n`WIP on <branch_name> : <latest_commit_id> <latest_commit_message>`ã€‚\n\nå…¶ä¸­WIPè§£é‡Šå¦‚ä¸‹ï¼š`Work In Progess`çš„ç®€ç§°ï¼Œè¯´æ˜ä»£è¡¨äº†å·¥ä½œåŒºè¿›åº¦ã€‚\n\nåŒæ ·çš„è¿˜æœ‰Indexï¼Œä»£è¡¨çš„æ˜¯å·²ç»è¢«addä½†æ˜¯è¿˜æœªè¢«æäº¤çš„è¿›åº¦ã€‚\n\nå¦‚æœåœ¨æœªæäº¤çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œ`git stash`ä¸¤æ¬¡ï¼Œå°±å¦‚ä¸Šå›¾ï¼Œæ— æ³•å‡†ç¡®åˆ†è¾¨ä¸¤ä¸ª`stash`å…·ä½“ä¿®æ”¹çš„æ˜¯å“ªäº›å†…å®¹ï¼Œè¿™æ ·ç”¨ï¼Œæ˜¾çš„ä¼Ÿå¤§çš„Gitä¸€ç‚¹éƒ½ä¸æ™ºèƒ½ï¼Œæ€ä¹ˆå¯ä»¥ï¼\n\næ‰€ä»¥ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç»™stashå­˜å‚¨çš„ä¿®æ”¹èµ·ä¸ªåå­—ï¼Œæ˜¾ç„¶éå¸¸é‡è¦ï¼Œæ–¹å¼å¦‚ä¸‹ï¼š`git stash save <message>`ã€‚\n\n## å–å‡ºä¹Ÿæœ‰å¥½å‡ ç§æ–¹å¼\n\nä¸Šé¢çš„æ¼”ç¤ºä¸­ï¼Œå–å‡ºstashçš„æ–¹å¼éƒ½æ˜¯\n\n```bash\ngit stash pop  # å–å‡ºæœ€è¿‘ä¸€æ¬¡æš‚å­˜å¹¶åˆ é™¤è®°å½•åˆ—è¡¨ä¸­å¯¹åº”è®°å½•\n```\n\n\nè¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½ç”¨çš„å–å‡ºæ–¹å¼ï¼Œä¸€èˆ¬ä½¿ç”¨çš„é¢‘ç‡æœ€é«˜ï¼Œä½†å¹¶éé€‚ç”¨æ‰€æœ‰æƒ…å†µã€‚\n\nå› ä¸º`git stash pop`æ˜¯å¼¹å‡ºæ ˆé¡¶çš„ä¸€ä¸ª`stash`ï¼Œä¹Ÿå°±æ˜¯æœ€åä¸€æ¬¡å­˜å‚¨çš„`stash`ã€‚åœ¨å­˜å‚¨å¤šä¸ªstash ï¼Œæƒ³**å–å‡ºéæ ˆé¡¶**çš„ä¸€ä¸ªçš„æƒ…å†µä¸‹ï¼Œæ˜¯ä¸é€‚ç”¨çš„ã€‚\n\nè¿™ä¸ªæ—¶å€™è¦ä½¿ç”¨ï¼š\n\n```bash\ngit stash list # æŸ¥çœ‹æš‚å­˜åŒºçš„æ‰€æœ‰æš‚å­˜ä¿®æ”¹\ngit stash apply stash@{X} # å–å‡ºç›¸åº”çš„æš‚å­˜\ngit stash drop stash@{X} # å°†è®°å½•åˆ—è¡¨ä¸­å–å‡ºçš„å¯¹åº”æš‚å­˜è®°å½•åˆ é™¤\n```\n\n# git stashä¸addå…³ç³»\n\ngit addåªæ˜¯æŠŠæ–‡ä»¶åŠ åˆ°gitç‰ˆæœ¬æ§åˆ¶é‡Œï¼Œå¹¶ä¸ç­‰äºå°±è¢«stashèµ·æ¥äº†ï¼Œgit addå’Œgit stashæ²¡æœ‰å¿…ç„¶å…³ç³»ï¼Œä½†æ˜¯æ‰§è¡Œgit stashèƒ½æ­£ç¡®å­˜å‚¨çš„å‰ææ˜¯æ–‡ä»¶å¿…é¡»åœ¨gitç‰ˆæœ¬æ§åˆ¶ä¸­æ‰è¡Œã€‚\n\nå¸¸è§„git stashçš„ä¸€ä¸ªé™åˆ¶æ˜¯å®ƒä¼šæš‚å­˜æ‰€æœ‰çš„æ–‡ä»¶ã€‚æœ‰æ—¶ï¼Œåªå¤‡ä»½æŸäº›æ–‡ä»¶æ›´ä¸ºæ–¹ä¾¿ï¼Œè®©å¦å¤–ä¸€äº›ä¸ä»£ç åº“ä¿æŒä¸€è‡´ã€‚ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æŠ€å·§ï¼Œç”¨æ¥å¤‡ä»½éƒ¨åˆ†æ–‡ä»¶ï¼š\n\n1. addé‚£äº›ä½ ä¸æƒ³å¤‡ä»½çš„æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼š`git add file1.js, file2.js`ï¼‰ï¼›\n2. è°ƒç”¨`git stash â€“keep-index`ã€‚åªä¼šå¤‡ä»½é‚£äº›æ²¡æœ‰è¢«addçš„æ–‡ä»¶ã€‚\n3. è°ƒç”¨`git reset`å–æ¶ˆå·²ç»addçš„æ–‡ä»¶çš„å¤‡ä»½ï¼Œç»§ç»­è‡ªå·±çš„å·¥ä½œã€‚\n","categories":["Linux","git"]},{"title":"Ubuntu20.04å®‰è£…MySQL8.0","url":"/æ•°æ®åº“/Ubuntu20.04å®‰è£…MySQL8.0/","content":"\n### ä¸‹è½½å®‰è£…\n\nä¸‹è½½mysqlå‘½ä»¤ï¼š\n\n```bash\nsudo apt-get update  #æ›´æ–°è½¯ä»¶æº\nsudo apt-get install mysql-server  #å®‰è£…mysql\n```\n\n### æœåŠ¡å¯åŠ¨/åœæ­¢\n\nå¯åŠ¨/å…³é—­mysqlæœåŠ¡ï¼š\n\n```bash\nservice mysql start\nservice mysql stop\n```\n\n### ä¿®æ”¹rootç”¨æˆ·å¯†ç \n\næŸ¥çœ‹é»˜è®¤ç”¨æˆ·ååŠå¯†ç ï¼š\n\n```bash\n# é¦–å…ˆï¼Œåˆ‡æ¢åˆ°ç®¡ç†å‘˜èº«ä»½\nsu\nsudo cat /etc/mysql/debian.cnf\n```\n\nä½¿ç”¨æ˜¾ç¤ºçš„é»˜è®¤useråŠpasswordç™»å½•ï¼š\n\n```bash\nmysql -u debian-sys-maint -pXXX\n```\n\næ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼š\n\n```sql\nuse mysql;\nselect user, plugin from mysql.user;\n```\n\n![image-20220724225357816](../../images/Ubuntu20.04å®‰è£…MySQL8.0/image-20220724225357816.png)\n\n```sql\nupdate user set plugin='caching_sha2_password' where user='root';\n```\n\n![image-20220724225327069](../../images/Ubuntu20.04å®‰è£…MySQL8.0/image-20220724225327069.png)\n\nè®¾ç½®`mysql root`è´¦æˆ·å¯†ç ï¼š\n\n```sql\nALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '123';\nFLUSH PRIVILEGES;\nExit;\n```\n\nä½¿ç”¨`mysql -u root -p`å°è¯•ç™»å½•ï¼š\n\n```bash\nmysql -u root -p123\n```\n\n### ç”¨æˆ·ç®¡ç†ï¼ˆNavicatè¿œç¨‹ç™»å½•é…ç½®ï¼‰\n\nMySQL8.0åçš„ç™»å½•æ–¹å¼åˆ†ä¸ºäº†ä¸¤ç§ã€‚\n\n```sql\nselect user, host, plugin from mysql.user;\n```\n\n![image-20220724225534065](../../images/Ubuntu20.04å®‰è£…MySQL8.0/image-20220724225534065.png)\n\n`localhost`è¡¨ç¤ºæœ¬åœ°ç™»å½•çš„ç”¨æˆ·ã€‚\n`%`è¡¨ç¤ºå¯ä»¥è¿œç¨‹ç™»å½•çš„ç”¨æˆ·ã€‚é»˜è®¤æ˜¯æ²¡æœ‰çš„ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºã€‚\n\n**åˆ›å»ºç”¨æˆ·ç¤ºä¾‹**\n\n```sql\ncreate user 'xcg'@'localhost' identified by '123'; #åˆ›å»ºåä¸ºxcgçš„æœ¬åœ°ç”¨æˆ·ï¼Œå¯†ç ä¸º123\ncreate user 'root'@'%' identified WITH mysql_native_password by '123'; #åˆ›å»ºåä¸ºrootçš„è¿œç¨‹ç”¨æˆ·ï¼Œå¯†ç ä¸º123ï¼ŒæŒ‡å®šåŠ å¯†æ–¹å¼ã€‚\n```\n\n**ä¿®æ”¹ç”¨æˆ·å¯†ç ï¼ŒæŒ‡å®šåŠ å¯†æ–¹å¼ã€‚ç¤ºä¾‹**\n\n```sql\nALTER user 'root'@'localhost' IDENTIFIED WITH mysql_native_password by '123456';\n```\n\n**æˆæƒç”¨æˆ·å¯¹å“ªäº›æ•°æ®åº“çš„å“ªäº›è¡¨å¯ä»¥è¿›è¡Œæ“ä½œ**\n\n```sql\ngrant all privileges on *.* to root@'%' with grant option; # *.* è¡¨ç¤ºæ‰€æœ‰æ•°æ®åº“çš„æ‰€æœ‰è¡¨\n```\n\n**åˆ é™¤ç”¨æˆ·**\n\n```sql\ndrop user 'name'@'localhost';\n```\n\n### å¯¼å…¥æ•°æ®åº“sqlè„šæœ¬\n\nåœ¨ç™»å½•mysqlä¹‹åï¼Œç”¨`source`å‘½ä»¤+sqlè„šæœ¬æ–‡ä»¶è·¯å¾„å¯¼å…¥è„šæœ¬å‘½ä»¤ã€‚\nå¯ä»¥ç”¨vscodeè¿œç¨‹ç™»å½•åï¼Œå°†sqlæ–‡ä»¶æ‹–è¿›ä¸€ä¸ªå®¹æ˜“æ‰¾åˆ°çš„ä½ç½®ã€‚\nå¯¼å…¥ä¹‹å‰éœ€è¦æå‰åˆ›å»ºå¥½æ•°æ®åº“ï¼Œå¹¶ä¸”useã€‚\n\n```sql\ncreate database test;\nuse test;\nsource /home/xcg/vscode/chat.sql #ä¸ç”¨å¸¦åˆ†å·\n```\n\nå¯¼å…¥åï¼Œå¯ä»¥`show tables;`æŸ¥çœ‹æ˜¯å¦æˆåŠŸã€‚","categories":["æ•°æ®åº“","MySQL"]},{"title":"åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸­é—´ä»¶é€‰å‹å’Œæ—¥å¿—æ¨¡å—","url":"/é¡¹ç›®/åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸­é—´ä»¶é€‰å‹å’Œæ—¥å¿—æ¨¡å—/","content":"# é¡¹ç›®è½¯ä»¶ç»“æ„\n\n* ç½‘ç»œå±‚\n    * å¤šçº¿ç¨‹+`reactor+one loop per thread`+`socket api`\n    * åŒæ­¥/å¼‚æ­¥/é˜»å¡/éé˜»å¡\n    * `select`/`poll`/`epoll`\n    * æ± åŒ–æŠ€æœ¯\n    * IOæ¨¡å‹\n    * ç½‘ç»œæ•°æ®åŒ…çš„æ”¶å‘è¿‡ç¨‹\n* ä¸šåŠ¡å±‚\n    * çŠ¶æ€æœº/MVCæ¨¡å¼\n* ç¼“å­˜å±‚\n    * ä¸ºäº†å­˜å‚¨è¿‡ç¨‹çš„é«˜æ•ˆæ€§ï¼Œä½¿ç”¨å†…å­˜å‹æ•°æ®åº“ - `redis`/`memcached`ï¼Œå…¶ä¸­`redis`å¯ä»¥æŒä¹…åŒ–\n* å­˜å‚¨å±‚\n    * å…³ç³»å‹æ•°æ®åº“ - `mysql`/`oracle`/`sql server`/`maridb`/`mongodb`\n\n# ç¯å¢ƒé…ç½®\n\nä¸»è¦æ˜¯äº‘æœåŠ¡å™¨çš„è´­ä¹°ã€è¿œç¨‹ç™»å½•é…ç½®ã€vscode ssh remoteé…ç½®ï¼Œgité…ç½®ï¼Œè¿œç¨‹ä»“åº“é…ç½®ã€‚\n\n# æ—¥å¿—ç»„ä»¶\n\n```\n[æ—¶é—´æˆ³][å¸¦é¢œè‰² æ—¥å¿—çº§åˆ«][æ–‡ä»¶å][å‡½æ•°å][è¡Œå·] - [æ—¥å¿—msg]\n```\n\n## ç»„æˆéƒ¨åˆ†\n\nåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œå‰é¢çš„éƒ¨åˆ†å°è£…ä¸ºä¸€ä¸ªæ—¥å¿—å¤´éƒ¨ï¼Œè®°ä¸ºMessageç±»ã€‚åé¢çš„å…·ä½“ä¿¡æ¯å†…å®¹æ‹¼æ¥åœ¨å¤´éƒ¨ä¹‹åå³å¯ã€‚\n\n* æ—¥å¿—çº§åˆ«\n\n1ã€é‡è¦ç¨‹åº¦ï¼›2ã€æ—¥å¿—çº§åˆ«è¶Šç»†ï¼Œæ‰“å°çš„ä¿¡æ¯å°±è¶Šå¤šï¼Œä¼šå¯¹ç£ç›˜IOé€ æˆå½±å“ï¼Œå½±å“æ€§èƒ½ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæœ‰è¿™äº›ç±»åˆ«ï¼šinfoã€debugã€errorã€fatalã€‚æˆ‘ä»¬åˆ†åˆ«è®¾ç½®ä¸ºç™½è‰²ã€ç»¿è‰²ã€é»„è‰²ã€çº¢è‰²ã€‚\n\n* æ–‡ä»¶åã€å‡½æ•°åã€è¡Œå·å¯ä»¥ç”¨Cè¯­è¨€å†…ç½®çš„å®ã€‚\n\n```c\nint main()\n{\n    printf(\"[file:%s] [function:%s] [lineNumber:%d]\\n\", __FILE__, __FUNCTION__, __LINE__);\n}\n```\n\n## æ—¶é—´æˆ³ç±»Timestamp\n\n```mermaid\nclassDiagram\nclass Timestamp{\n\t-secondSinceEpoch : uint64_t\n\t+TimeStamp()\n\t+TimeStamp(uint64_t)\n\t+ToString() string\n\t+Now()\n}\n```\n\n## æ—¥å¿—ç±»Logger\n\n### æ¶ˆæ¯ç±»Message\n\nç”±ä¸¤å¤§éƒ¨åˆ†ç»„æˆï¼Œä¸€éƒ¨åˆ†æ˜¯æ¶ˆæ¯å¤´ï¼Œæ˜¾ç¤ºä¿¡æ¯å‘ç”Ÿçš„ä½ç½®ï¼ŒäºŒæ˜¯æ¶ˆæ¯ä½“ï¼Œæ˜¯å…·ä½“å†…å®¹ã€‚\n\n```mermaid\nclassDiagram\nclass Message{\n\t-m_coloredHeader //å¸¦é¢œè‰²çš„æ—¥å¿—å¤´ è¾“å‡ºåˆ°terminal\n\t-m_commonHeader //ä¸å¸¦é¢œè‰²çš„æ—¥å¿—å¤´ è¾“å‡ºåˆ°logfile\n\t-m_msg æ—¥å¿—æ¶ˆæ¯\n\t-formatFieldWithColor(COLOR_NUMBER, bool dark, string delimiter, string fieldName, bool colored) string\n\t+Message(LOG_LEVEL, string fileName, string functionName, int lineNumber)\n\t+FormatHeader(LOG_LEVEL, string fileName, string functionName, int lineNumber, bool colored) string\n\t+ToString(bool colored) string\n\t+operator<<(constT& t)\n}\n```\n\n### æ—¥å¿—ç±»Logger\n\n```mermaid\nclassDiagram\nclass Logger{\n\t-m_level : LOG_LEVEL\n\t-m_logToTerminal : bool\n\t-m_logToFile : bool\n\t-m_logFile : std::fstream\n\t-Logger()\n\t+getInstance()\n\t+SetLogToTerminal(bool logToTerminal)\n\t+GetLogToTerminal() bool\n\t+SetLogToFile(bool logToFile)\n\t+GetLogToFile(const string& logFileName) bool\n\t+SetLogFile(const std::string & logFileName)\n\t+OffLogFile()\n\t+SetLogLevel(LOG_LEVEL level)\n\t+GetLogLevel() LOG_LEVEL\n\t+operator+=(constMessage& msg)\n}\n```\n\næ—¥å¿—ç±»çš„è®¾è®¡æ¨¡å¼ä¸ºå•ä¾‹æ¨¡å¼ï¼ŒæŠŠæ„é€ å‡½æ•°ç§æœ‰åŒ–ï¼Œæä¾›ç”Ÿæˆå¯¹è±¡çš„é™æ€æ–¹æ³•ã€‚\n\n## Linux errno\n\nç³»ç»Ÿè°ƒç”¨æŠ›å‡ºçš„é”™è¯¯ä¿¡æ¯é¦–å…ˆæ˜¯ä¸€ä¸ªé”™è¯¯ç ï¼Œå¦‚æœè¦å’Œæˆ‘ä»¬è‡ªå·±å®ç°çš„æ—¥å¿—ç±»ç»“åˆçš„è¯ï¼Œéœ€è¦çŸ¥é“Linux errnoçš„å«ä¹‰ã€‚\n\nLinuxä¸­ç³»ç»Ÿè°ƒç”¨çš„é”™è¯¯éƒ½å­˜å‚¨äºerrnoä¸­ï¼Œerrnoç”±æ“ä½œç³»ç»Ÿç»´æŠ¤ï¼Œå­˜å‚¨å°±è¿‘å‘ç”Ÿçš„é”™è¯¯ï¼Œå³ä¸‹ä¸€æ¬¡çš„é”™è¯¯ç ä¼šè¦†ç›–æ‰ä¸Šä¸€æ¬¡çš„é”™è¯¯ã€‚\n\nå¯¹errnoçš„æµ‹è¯•\n\n```c\n#include<stdio.h>\nint main()\n{\n    int res = open(\"./a.txt\", O_RDONLY, 0664);\n    if(-1 == res)\n    {\n        perror(\"open()\");\n    }\n}\n-------------\n/* è¾“å‡ºç»“æœ\n * \topen(): No such file or directory\n */\nè¯´æ˜ï¼Œperroræ‹¬å·é‡Œçš„å†…å®¹åªæ˜¯é”™è¯¯ä¿¡æ¯å‰é¢çš„å¼€å¤´éƒ¨åˆ†ï¼Œåé¢çš„éƒ¨åˆ†æ‰æ˜¯åˆšåˆšå‘ç”Ÿçš„é”™è¯¯çš„errnoæ‰€å¯¹åº”çš„é”™è¯¯ä¿¡æ¯å†…å®¹ã€‚\n```\n\nçœ‹opençš„å¸®åŠ©æ‰‹å†Œï¼Œåœ¨return valueéƒ¨åˆ†ï¼Œæ‰‹å†Œå†™åˆ°ï¼š\n`open(), openat(), and creat() return the new file descriptor, or -1 if an error occurred (in which case, errno is set appropriately).`\n\nå¯è§ï¼Œè¿”å›å€¼å’Œerrnoæ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œè¿”å›å€¼ä¸º-1è¯´æ˜æ­¤ç³»ç»Ÿè°ƒç”¨å‡ºé”™ï¼Œè€Œå…·ä½“çš„é”™è¯¯ç±»å‹éœ€è¦ç”¨errnoæ¥æ ‡è¯†ï¼Œç”±å†…æ ¸æ ‡è¯†ã€‚\n\n### perrorå’Œstrerror\n\n* perror\n\næ‰‹å†Œä¸­å¯¹perrorçš„æè¿°(`man 3 perror`)\n`The perror() function produces a message on standard error describing the last error encountered during a call to a system or library function.`\n\nå…³é”®ä¿¡æ¯ï¼šperroræè¿°çš„æ˜¯æœ€åä¸€æ¬¡é”™è¯¯ï¼Œæ˜¯ç”±ç³»ç»Ÿè°ƒç”¨äº§ç”Ÿçš„é”™è¯¯ï¼Œå°†è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯è¾“å‡ºä¸­ã€‚\n\n* strerror\n\næˆ‘ä»¬æƒ³è¦çš„æ•ˆæœæ˜¯ï¼šé€šè¿‡errnoæ‰¾åˆ°å¯¹åº”çš„msgæ¶ˆæ¯ã€‚è¿™ä¸ªå·¥ä½œå¯ä»¥é€šè¿‡strerroræ‰¾åˆ°ã€‚\n\n```cpp\n#include<string.h>\nint main()\n{\n    int res = open(\"./a.txt\", O_RDONLY, 0664);\n    if(-1 == res)\n    {\n        LOG_ERROR << strerror(errno);\n    }\n}\n```\n\n### errnoä¸Loggerç±»çš„ç»“åˆä½¿ç”¨\n\n```cpp\nint main()\n{\n    int res = open(\"./a.txt\", O_RDONLY, 0664);\n    if(-1 == res)\n    {\n        LOG_ERROR << strerror(errno);\n    }\n}\n```\n\n### ç³»ç»Ÿä¸­errnoçš„ä½ç½®åŠå«ä¹‰\n\næŸ¥çœ‹ç³»ç»Ÿä¸­æ‰€æœ‰çš„errnoæ‰€ä»£è¡¨çš„å«ä¹‰ï¼Œå¯ä»¥é‡‡ç”¨å¦‚ä¸‹çš„ä»£ç ï¼š\n\n```c\n#include <stdio.h>\n#include <string.h>     //for strerror()\n//#include <errno.h>\nint main()\n{\n    for(int tmp = 0; tmp <=256; tmp++)\n    {\n        printf(\"errno: %2d\\t%s\\n\", tmp, strerror(tmp));\n    }\n    return 0;\n}\n/* æœ€åçš„æ•ˆæœ\n * \t[2022/04/17 09:42:40][ERROR][logger.cc][main][61]: No such file or directory\n */\n```\n\nLinuxä¸­ï¼Œåœ¨å¤´æ–‡ä»¶ `/usr/include/asm-generic/errno-base.h` å¯¹åŸºç¡€å¸¸ç”¨errnoè¿›è¡Œäº†å®å®šä¹‰ï¼š\n\n```c\nifndef _ASM_GENERIC_ERRNO_BASE_H\n#define _ASM_GENERIC_ERRNO_BASE_H\n\n#define EPERM            1      /* Operation not permitted */\n#define ENOENT           2      /* No such file or directory */\n#define ESRCH            3      /* No such process */\n#define EINTR            4      /* Interrupted system call */\n#define EIO              5      /* I/O error */\n#define ENXIO            6      /* No such device or address */\n#define E2BIG            7      /* Argument list too long */\n#define ENOEXEC          8      /* Exec format error */\n#define EBADF            9      /* Bad file number */\n#define ECHILD          10      /* No child processes */\n#define EAGAIN          11      /* Try again */\n#define ENOMEM          12      /* Out of memory */\n#define EACCES          13      /* Permission denied */\n#define EFAULT          14      /* Bad address */\n#define ENOTBLK         15      /* Block device required */\n#define EBUSY           16      /* Device or resource busy */\n#define EEXIST          17      /* File exists */\n#define EXDEV           18      /* Cross-device link */\n#define ENODEV          19      /* No such device */\n#define ENOTDIR         20      /* Not a directory */\n#define EISDIR          21      /* Is a directory */\n#define EINVAL          22      /* Invalid argument */\n#define ENFILE          23      /* File table overflow */\n#define EMFILE          24      /* Too many open files */\n#define ENOTTY          25      /* Not a typewriter */\n#define ETXTBSY         26      /* Text file busy */\n#define EFBIG           27      /* File too large */\n#define ENOSPC          28      /* No space left on device */\n#define ESPIPE          29      /* Illegal seek */\n#define EROFS           30      /* Read-only file system */\n#define EMLINK          31      /* Too many links */\n#define EPIPE           32      /* Broken pipe */\n#define EDOM            33      /* Math argument out of domain of func */\n#define ERANGE          34      /* Math result not representable */\n\n#endif\n```\n\nå…¶ä»–é”™è¯¯ç å®šä¹‰åœ¨ `/usr/include/asm-generic/errno.h`ä¸­ã€‚\n\n```c\n#ifndef _ASM_GENERIC_ERRNO_H\n#define _ASM_GENERIC_ERRNO_H\n\n#include <asm-generic/errno-base.h>\n\n#define\tEDEADLK\t\t35\t/* Resource deadlock would occur */\n#define\tENAMETOOLONG\t36\t/* File name too long */\n#define\tENOLCK\t\t37\t/* No record locks available */\n#define\tENOSYS\t\t38\t/* Function not implemented */\n#define\tENOTEMPTY\t39\t/* Directory not empty */\n#define\tELOOP\t\t40\t/* Too many symbolic links encountered */\n#define\tEWOULDBLOCK\tEAGAIN\t/* Operation would block */\n#define\tENOMSG\t\t42\t/* No message of desired type */\n#define\tEIDRM\t\t43\t/* Identifier removed */\n#define\tECHRNG\t\t44\t/* Channel number out of range */\n#define\tEL2NSYNC\t45\t/* Level 2 not synchronized */\n#define\tEL3HLT\t\t46\t/* Level 3 halted */\n#define\tEL3RST\t\t47\t/* Level 3 reset */\n#define\tELNRNG\t\t48\t/* Link number out of range */\n#define\tEUNATCH\t\t49\t/* Protocol driver not attached */\n#define\tENOCSI\t\t50\t/* No CSI structure available */\n#define\tEL2HLT\t\t51\t/* Level 2 halted */\n#define\tEBADE\t\t52\t/* Invalid exchange */\n#define\tEBADR\t\t53\t/* Invalid request descriptor */\n#define\tEXFULL\t\t54\t/* Exchange full */\n#define\tENOANO\t\t55\t/* No anode */\n#define\tEBADRQC\t\t56\t/* Invalid request code */\n#define\tEBADSLT\t\t57\t/* Invalid slot */\n\n#define\tEDEADLOCK\tEDEADLK\n\n#define\tEBFONT\t\t59\t/* Bad font file format */\n#define\tENOSTR\t\t60\t/* Device not a stream */\n#define\tENODATA\t\t61\t/* No data available */\n#define\tETIME\t\t62\t/* Timer expired */\n#define\tENOSR\t\t63\t/* Out of streams resources */\n#define\tENONET\t\t64\t/* Machine is not on the network */\n#define\tENOPKG\t\t65\t/* Package not installed */\n#define\tEREMOTE\t\t66\t/* Object is remote */\n#define\tENOLINK\t\t67\t/* Link has been severed */\n#define\tEADV\t\t68\t/* Advertise error */\n#define\tESRMNT\t\t69\t/* Srmount error */\n#define\tECOMM\t\t70\t/* Communication error on send */\n#define\tEPROTO\t\t71\t/* Protocol error */\n#define\tEMULTIHOP\t72\t/* Multihop attempted */\n#define\tEDOTDOT\t\t73\t/* RFS specific error */\n#define\tEBADMSG\t\t74\t/* Not a data message */\n#define\tEOVERFLOW\t75\t/* Value too large for defined data type */\n#define\tENOTUNIQ\t76\t/* Name not unique on network */\n#define\tEBADFD\t\t77\t/* File descriptor in bad state */\n#define\tEREMCHG\t\t78\t/* Remote address changed */\n#define\tELIBACC\t\t79\t/* Can not access a needed shared library */\n#define\tELIBBAD\t\t80\t/* Accessing a corrupted shared library */\n#define\tELIBSCN\t\t81\t/* .lib section in a.out corrupted */\n#define\tELIBMAX\t\t82\t/* Attempting to link in too many shared libraries */\n#define\tELIBEXEC\t83\t/* Cannot exec a shared library directly */\n#define\tEILSEQ\t\t84\t/* Illegal byte sequence */\n#define\tERESTART\t85\t/* Interrupted system call should be restarted */\n#define\tESTRPIPE\t86\t/* Streams pipe error */\n#define\tEUSERS\t\t87\t/* Too many users */\n#define\tENOTSOCK\t88\t/* Socket operation on non-socket */\n#define\tEDESTADDRREQ\t89\t/* Destination address required */\n#define\tEMSGSIZE\t90\t/* Message too long */\n#define\tEPROTOTYPE\t91\t/* Protocol wrong type for socket */\n#define\tENOPROTOOPT\t92\t/* Protocol not available */\n#define\tEPROTONOSUPPORT\t93\t/* Protocol not supported */\n#define\tESOCKTNOSUPPORT\t94\t/* Socket type not supported */\n#define\tEOPNOTSUPP\t95\t/* Operation not supported on transport endpoint */\n#define\tEPFNOSUPPORT\t96\t/* Protocol family not supported */\n#define\tEAFNOSUPPORT\t97\t/* Address family not supported by protocol */\n#define\tEADDRINUSE\t98\t/* Address already in use */\n#define\tEADDRNOTAVAIL\t99\t/* Cannot assign requested address */\n#define\tENETDOWN\t100\t/* Network is down */\n#define\tENETUNREACH\t101\t/* Network is unreachable */\n#define\tENETRESET\t102\t/* Network dropped connection because of reset */\n#define\tECONNABORTED\t103\t/* Software caused connection abort */\n#define\tECONNRESET\t104\t/* Connection reset by peer */\n#define\tENOBUFS\t\t105\t/* No buffer space available */\n#define\tEISCONN\t\t106\t/* Transport endpoint is already connected */\n#define\tENOTCONN\t107\t/* Transport endpoint is not connected */\n#define\tESHUTDOWN\t108\t/* Cannot send after transport endpoint shutdown */\n#define\tETOOMANYREFS\t109\t/* Too many references: cannot splice */\n#define\tETIMEDOUT\t110\t/* Connection timed out */\n#define\tECONNREFUSED\t111\t/* Connection refused */\n#define\tEHOSTDOWN\t112\t/* Host is down */\n#define\tEHOSTUNREACH\t113\t/* No route to host */\n#define\tEALREADY\t114\t/* Operation already in progress */\n#define\tEINPROGRESS\t115\t/* Operation now in progress */\n#define\tESTALE\t\t116\t/* Stale file handle */\n#define\tEUCLEAN\t\t117\t/* Structure needs cleaning */\n#define\tENOTNAM\t\t118\t/* Not a XENIX named type file */\n#define\tENAVAIL\t\t119\t/* No XENIX semaphores available */\n#define\tEISNAM\t\t120\t/* Is a named type file */\n#define\tEREMOTEIO\t121\t/* Remote I/O error */\n#define\tEDQUOT\t\t122\t/* Quota exceeded */\n\n#define\tENOMEDIUM\t123\t/* No medium found */\n#define\tEMEDIUMTYPE\t124\t/* Wrong medium type */\n#define\tECANCELED\t125\t/* Operation Canceled */\n#define\tENOKEY\t\t126\t/* Required key not available */\n#define\tEKEYEXPIRED\t127\t/* Key has expired */\n#define\tEKEYREVOKED\t128\t/* Key has been revoked */\n#define\tEKEYREJECTED\t129\t/* Key was rejected by service */\n\n/* for robust mutexes */\n#define\tEOWNERDEAD\t130\t/* Owner died */\n#define\tENOTRECOVERABLE\t131\t/* State not recoverable */\n\n#define ERFKILL\t\t132\t/* Operation not possible due to RF-kill */\n#define EHWPOISON\t133\t/* Memory page has hardware error */\n\n#endif\n```\n\n# TcpC/S\n\nTcpClient/TcpServerç±»å¯¹èµ„æºçš„åˆ©ç”¨ä¸€å®šè¦éµå¾ªRAIIè§„åˆ™ã€‚å³æ„é€ æ—¶ç”³è¯·ç³»ç»Ÿèµ„æºï¼Œææ„æ—¶å½’è¿˜ç³»ç»Ÿèµ„æºã€‚\n\n## TcpClient\n\n```mermaid\nclassDiagram\nclass TcpClient{\n\t-m_sfd : int //serverfd\n\t+TcpClient(const IpAddressPort &)\n\t+~TcpClient()\n\t+SendMsg(const string& msg) int\n\t+RecvMsg() Msg\n}\n```\n\n## TcpServer\n\n```mermaid\nclassDiagram\nclass TcpServer{\n\t-m_lfd : int //listenfd\n\t+TcpServer(const IpAddressPort&)\n\t+~TcpServer()\n\t+SendMsg(const string& msg) int\n\t+RecvMsg() Msg\n\t+GetLfd() int\n}\n```\n\n\n\n### RAII\n\nRAII: Resource Acquisition is Initializationã€‚\n\nå¸Œæœ›C++å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå’Œèµ„æºçš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸€è‡´çš„ã€‚\n\nå †å†…å­˜ï¼šæ˜“å¤±æ€§\n\n# ä¸šåŠ¡å±‚ - MVCæ¨¡å¼\n\n## View\n\n```cpp\n#include<string>\n/* æ¥å£ç±» */\nclass View\n{\npublic:\n    virtual void process(int fd, std::string &data) = 0;\n};\nclass LoginView : public View\n{\npublic:\n    void process(int fd, std::string &data)\n    {\n        \n    }\n}\n```\n\n\n\n## Controller\n\n```cpp\n#include<unordered_map>\n#include<view.h>\nclass Controller\n{\nprivate:\n    std::unordered_map<BIZTYPE, View*> bizTypeMap = \n\npublic:\n    Controller();\n    ~Controller();\n    void ControllerProcess(int fd, std::string &data)\n    {\n        /* string -> json */\n        bizTypeMap[data[\"biztype\"]]\n    }\n};\n```\n\n```cpp\n# public.h\nenum BIZTYPE\n{\n    \n};\n```\n\n# MySQL\n\n```cpp\n// mysqldb.h\n#ifndef __MYSQLDB_H__\n#define __MYSQLDB_H__\n#include <mysql/mysql.h>\n#include <string>\n// è®¾è®¡æˆä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„mysqlå•ä¾‹ç±»   å› ä¸ºmysqlæ˜¯å¯ä»¥è¢«å¤šçº¿ç¨‹çœ‹åˆ°çš„\n// raii\nclass MySQLDB\n{\nprivate:\n    MYSQL* m_mysqlClient;\n    MySQLDB();\npublic:\n    static MySQLDB* GetInstance();\n    // mysql -h x.x.x.x -P 3307 -u root -p\n    void Connect(const std::string& ip,\n                 unsigned short port,\n                 const std::string& user,\n                 const std::string& password,\n                 const std::string& db);\n    int Query(std::string&& sql);\n    bool Insert(std::string&& sql);\n    ~MySQLDB();\n};\n#endif\n```\n\n\n\n```cpp\nMySQLDB::MySQLDB()\n{\n    m_mysqlClient = NULL;\n}\nMySQLDB::~MySQLDB()\n{\n    if(m_mysqlClient != nullptr)\n    {\n        mysql_close(m_mysqlClient);\n    }\n}\nMySQLDB::MySQLDB* GetInstance()\n{\n    static MySQLDB res;\n    return &res;\n}\nvoid MySQLDB::Connect(const std::string & ip,\n             unsigned short port,\n             const std::string& user,\n             const std::string& password,\n             const std::string& db)\n{\n    if(!mysql_real_connect(m_mysqlClient,\n                           ip.c_str(), user.c_str(), password.c_str(), db.c_str(), 3306, nullptr, 0))\n    {\n        LOG_ERROR << \"mysql_real_connect() failed!\";\n    }\n    LOG_INFO << \"mysql connect success!\";\n}\nint MySQLDB::Query(std::string&& sql)\n{\n    LOG_INFO << \"sql:\" << sql;\n    if(mysql_query(m_mysqlClient, sql.c_str()))\n    {\n        LOG_ERROR << mysql_error(m_mysqlClient);\n        return 0;\n    }\n    return mysql_num_rows(mysql_store_result(m_mysqlClient));\n}\nbool MySQLDB::Insert(std::string&& sql)\n{\n    LOG_INFO << \"sql:\" << sql;\n    if(mysql_query(m_mysqlClient, sql.c_str()))\n    {\n        LOG_ERROR << mysql_error(m_mysqlClient);\n        return false;\n    }\n    return true;\n}\n```\n\n# Redis\n\n## å®‰è£…\n\n```bash\nwget https://github.com/redis/hiredis/archive/refs/tags/v1.0.2.tar.gz\ntar -zxvf v1.0.2.tar.gz\ncd hiredis-1.0.2\nmake\nmake install\nldconfig\n```\n\n","categories":["Cpp","é¡¹ç›®","é›†ç¾¤"]},{"title":"Linux_å®ˆæŠ¤è¿›ç¨‹","url":"/Linux/Linux_å®ˆæŠ¤è¿›ç¨‹/","content":"\n# å†…å®¹\n\næœ¬èŠ‚å°†è¯´æ˜å®ˆæŠ¤è¿›ç¨‹ç»“æ„ï¼Œä»¥åŠå¦‚ä½•ç¼–å†™å®ˆæŠ¤è¿›ç¨‹ç¨‹åºã€‚å› ä¸ºå®ˆæŠ¤è¿›ç¨‹æ²¡æœ‰æ§åˆ¶ç»ˆç«¯ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£åœ¨å‡ºç°é—®é¢˜æ—¶ï¼Œå®ˆæŠ¤è¿›ç¨‹å¦‚ä½•æŠ¥å‘Šå‡ºé”™æƒ…å†µã€‚\n\n1. å®ˆæŠ¤è¿›ç¨‹çš„ç‰¹ç‚¹\n2. è¿›ç¨‹ç»„ã€æ§åˆ¶ç»ˆç«¯ã€ä¼šè¯\n3. å®ˆæŠ¤è¿›ç¨‹ç¼–ç¨‹æµç¨‹\n\n# å®ˆæŠ¤è¿›ç¨‹\n\nå®ˆæŠ¤è¿›ç¨‹(daemon)æ˜¯ç”Ÿå­˜æœŸé•¿çš„ä¸€ç§è¿›ç¨‹ã€‚å¸¸å¸¸åœ¨ç³»ç»Ÿå¼•å¯¼è£…å…¥æ—¶å¯åŠ¨ï¼Œä»…åœ¨ç³»ç»Ÿå…³é—­æ—¶æ‰ç»ˆæ­¢ã€‚å› ä¸ºå®ƒä»¬æ²¡æœ‰æ§åˆ¶ç»ˆç«¯ï¼Œæ‰€ä»¥è¯´å®ƒä»¬æ˜¯åœ¨åå°è¿è¡Œçš„ã€‚UNIXç³»ç»Ÿæœ‰å¾ˆå¤šå®ˆæŠ¤è¿›ç¨‹ï¼Œå®ƒä»¬æ‰§è¡Œæ—¥å¸¸äº‹åŠ¡æ´»åŠ¨ã€‚\n\nåœ¨åŸºäºBSDçš„ç³»ç»Ÿä¸‹æ‰§è¡Œ`ps -axj`ï¼š\n\né€‰é¡¹`-a`æ˜¾ç¤ºç”±å…¶ä»–ç”¨æˆ·æ‰€æ‹¥æœ‰çš„è¿›ç¨‹çš„çŠ¶æ€ï¼Œ`-x`æ˜¾ç¤ºæ²¡æœ‰æ§åˆ¶ç»ˆç«¯çš„è¿›ç¨‹çŠ¶æ€ï¼Œ`-j`æ˜¾ç¤ºä¸ä½œä¸šæœ‰å…³çš„ä¿¡æ¯ï¼šä¼šè¯IDã€è¿›ç¨‹ç»„IDã€æ§åˆ¶ç»ˆç«¯ä»¥åŠç»ˆç«¯è¿›ç¨‹ç»„IDã€‚\n\nç±»ä¼¼çš„å‘½ä»¤ï¼Œåœ¨åŸºäºSystem Vçš„ç³»ç»Ÿä¸­ï¼Œä¸æ­¤ç›¸ç±»ä¼¼çš„å‘½ä»¤æ˜¯`ps -efj`ï¼ˆä¸ºäº†æé«˜å®‰å…¨æ€§ï¼ŒæŸäº›UNIXç³»ç»Ÿä¸å…è®¸ç”¨æˆ·ä½¿ç”¨`ps`å‘½ä»¤æŸ¥çœ‹ä¸å±äºè‡ªå·±çš„è¿›ç¨‹ï¼‰ã€‚\n\næœ‰ä»¥ä¸‹æ¯”è¾ƒå…³é”®çš„åˆ—ï¼šUIDï¼ˆç”¨æˆ·IDï¼‰ã€PIDï¼ˆè¿›ç¨‹IDï¼‰ã€PPIDï¼ˆçˆ¶è¿›ç¨‹IDï¼‰ã€PGIDï¼ˆè¿›ç¨‹ç»„IDï¼‰ã€SIDï¼ˆsession ID, ä¼šè¯IDï¼‰ã€ç»ˆç«¯åç§°ï¼ˆTTYï¼‰ã€å‘½ä»¤å­—ç¬¦ä¸²ï¼ˆCMDï¼‰ã€‚\n\næ­¤`ps`å‘½ä»¤åœ¨æ”¯æŒä¼šè¯IDçš„ç³»ç»Ÿä¸Šè¿è¡Œï¼ˆLinux 3.2.0ï¼‰ï¼Œ`setsid`å‡½æ•°ä¸­çš„sidå³ä¼šè¯IDã€‚ç®€å•åœ°è¯´ï¼Œå®ƒå°±æ˜¯ä¼šè¯é¦–è¿›ç¨‹çš„è¿›ç¨‹IDã€‚\n\n> ç³»ç»Ÿè¿›ç¨‹å†ç¨‹\n>\n> ç³»ç»Ÿè¿›ç¨‹ä¾èµ–äºæ“ä½œç³»ç»Ÿå®ç°ã€‚çˆ¶è¿›ç¨‹IDä¸º0çš„å„è¿›ç¨‹é€šå¸¸æ˜¯å†…æ ¸è¿›ç¨‹ï¼Œå®ƒä»¬ä½œä¸ºç³»ç»Ÿå¼•å¯¼è£…å…¥è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†è€Œå¯åŠ¨ã€‚ï¼ˆ`init`æ˜¯ä¸ªä¾‹å¤–ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”±å†…æ ¸åœ¨å¼•å¯¼è£…å…¥æ—¶å¯åŠ¨çš„ç”¨æˆ·å±‚æ¬¡çš„å‘½ä»¤ã€‚ï¼‰å†…æ ¸è¿›ç¨‹æ˜¯ç‰¹æ®Šçš„ï¼Œé€šå¸¸å­˜åœ¨äºç³»ç»Ÿçš„æ•´ä¸ªç”Ÿå‘½æœŸä¸­ã€‚å®ƒä»¬ä»¥è¶…çº§ç”¨æˆ·ç‰¹æƒè¿è¡Œï¼Œæ— æ§åˆ¶ç»ˆç«¯ï¼Œæ— å‘½ä»¤è¡Œã€‚\n\nåœ¨`ps`çš„è¾“å‡ºå®ä¾‹ä¸­ï¼Œå†…æ ¸å®ˆæŠ¤è¿›ç¨‹çš„åå­—å‡ºç°åœ¨æ–¹æ‹¬å·ä¸­ï¼Œå¦‚`[sshd]`è¯¥ç‰ˆæœ¬çš„Linuxä½¿ç”¨ä¸€ä¸ªåä¸ºkthreaddçš„ç‰¹æ®Šå†…æ ¸è¿›ç¨‹æ¥åˆ›å»ºå…¶ä»–å†…æ ¸è¿›ç¨‹ï¼Œæ‰€ä»¥kthreaddè¡¨ç°ä¸ºå…¶ä»–å†…æ ¸è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ã€‚å¯¹äºéœ€è¦åœ¨è¿›ç¨‹ä¸Šä¸‹æ–‡æ‰§è¡Œå·¥ä½œä½†å´ä¸è¢«ç”¨æˆ·å±‚è¿›ç¨‹ä¸Šä¸‹æ–‡è°ƒç”¨çš„æ¯ä¸€ä¸ªå†…æ ¸ç»„ä»¶ï¼Œé€šå¸¸æœ‰å®ƒè‡ªå·±çš„å†…æ ¸å®ˆæŠ¤è¿›ç¨‹ã€‚ä¾‹å¦‚ï¼Œåœ¨Linuxä¸­ï¼š\n\n1. `kswapd`å®ˆæŠ¤è¿›ç¨‹ï¼Œå†…å­˜æ¢é¡µå®ˆæŠ¤è¿›ç¨‹ã€‚å®ƒæ”¯æŒè™šæ‹Ÿå†…å­˜å­ç³»ç»Ÿåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´åå°†è„é¡µé¢æ…¢æ…¢åœ°å†™å›ç£ç›˜æ¥å›æ”¶è¿™äº›é¡µé¢ã€‚\n2. `flush`å®ˆæŠ¤è¿›ç¨‹åœ¨å¯ç”¨å†…å­˜è¾¾åˆ°è®¾ç½®çš„æœ€å°é˜ˆå€¼æ—¶å°†è„é¡µé¢å†²æ´—è‡³ç£ç›˜ã€‚å®ƒä¹Ÿå®šæœŸåœ°å°†è„é¡µé¢å†²æ´—å›ç£ç›˜æ¥å‡å°‘åœ¨ç³»ç»Ÿå‡ºç°æ•…éšœæ—¶å‘ç”Ÿçš„æ•°æ®ä¸¢å¤±ã€‚å¤šä¸ªå†²æ´—å®ˆæŠ¤è¿›ç¨‹å¯ä»¥åŒæ—¶å­˜åœ¨ï¼Œæ¯ä¸ªå†™å›çš„è®¾å¤‡éƒ½æœ‰ä¸€ä¸ªå†²æ´—å®ˆæŠ¤è¿›ç¨‹ã€‚æ¯”å¦‚ä¸€ä¸ªåä¸º`flush-8:0`çš„å†²æ´—å®ˆæŠ¤è¿›ç¨‹ã€‚ä»åå­—ä¸­å¯ä»¥çœ‹å‡ºï¼Œå†™å›è®¾å¤‡æ˜¯é€šè¿‡ä¸»è®¾å¤‡å·ï¼ˆ8ï¼‰å’Œå‰¯è®¾å¤‡å·ï¼ˆ0ï¼‰æ¥è¯†åˆ«çš„ã€‚\n3. `sync_supers`å®ˆæŠ¤è¿›ç¨‹å®šæœŸå°†æ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®å†²æ´—è‡³ç£ç›˜ã€‚\n4. `jbd`å®ˆæŠ¤è¿›ç¨‹å¸®åŠ©å®ç°äº†`ext4`æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ—¥å¿—åŠŸèƒ½ã€‚\n\nè¿›ç¨‹1é€šå¸¸æ˜¯`init`ï¼Œå®ƒæ˜¯ä¸€ä¸ªç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹ï¼Œé™¤äº†å…¶ä»–å·¥ä½œå¤–ï¼Œä¸»è¦è´Ÿè´£å¯åŠ¨å„è¿è¡Œå±‚æ¬¡ç‰¹å®šçš„ç³»ç»ŸæœåŠ¡ã€‚è¿™äº›æœåŠ¡é€šå¸¸æ˜¯åœ¨å®ƒä»¬è‡ªå·±æ‹¥æœ‰çš„å®ˆæŠ¤è¿›ç¨‹çš„å¸®åŠ©ä¸‹å®ç°çš„ã€‚\n\n`netd`å®ˆæŠ¤è¿›ç¨‹ã€‚å®ƒä¾¦å¬ç³»ç»Ÿç½‘ç»œæ¥å£ï¼Œä»¥ä¾¿å–å¾—æ¥è‡ªç½‘ç»œçš„å¯¹å„ç§ç½‘ç»œæœåŠ¡è¿›ç¨‹çš„è¯·æ±‚ã€‚`nfsd`ã€`nfsiod`ã€`lockd`ã€`rpciod`ã€`rpe.idmapd`ã€`rpc.statd`å’Œ`rpc.mountd`å®ˆæŠ¤è¿›ç¨‹æä¾›å¯¹ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ˆNetwork File Systemï¼ŒNFSï¼‰çš„æ”¯æŒã€‚æ³¨æ„ï¼Œå‰4ä¸ªæ˜¯å†…æ ¸å®ˆæŠ¤è¿›ç¨‹ï¼Œå3ä¸ªæ˜¯ç”¨æˆ·çº§å®ˆæŠ¤è¿›ç¨‹ã€‚\n\næ³¨æ„ï¼Œå¤§å¤šæ•°å®ˆæŠ¤è¿›ç¨‹éƒ½ä»¥è¶…çº§ç”¨æˆ·ï¼ˆrootï¼‰ç‰¹æƒè¿è¡Œã€‚æ‰€æœ‰çš„å®ˆæŠ¤è¿›ç¨‹éƒ½æ²¡æœ‰æ§åˆ¶ç»ˆç«¯ï¼Œå…¶ç»ˆç«¯åè®¾ç½®ä¸º**é—®å·**ã€‚**å†…æ ¸å®ˆæŠ¤è¿›ç¨‹**ä»¥æ— æ§åˆ¶ç»ˆç«¯æ–¹å¼å¯åŠ¨ã€‚**ç”¨æˆ·å±‚å®ˆæŠ¤è¿›ç¨‹**ç¼ºå°‘æ§åˆ¶ç»ˆç«¯å¯èƒ½æ˜¯å®ˆæŠ¤è¿›ç¨‹è°ƒç”¨äº†`setsid`çš„ç»“æœã€‚**å¤§å¤šæ•°ç”¨æˆ·å±‚å®ˆæŠ¤è¿›ç¨‹éƒ½æ˜¯è¿›ç¨‹ç»„çš„ç»„é•¿è¿›ç¨‹ä»¥åŠä¼šè¯çš„é¦–è¿›ç¨‹**ï¼Œè€Œä¸”**æ˜¯è¿™äº›è¿›ç¨‹ç»„å’Œä¼šè¯ä¸­çš„å”¯ä¸€è¿›ç¨‹**ï¼ˆ`rsyslogd`æ˜¯ä¸€ä¸ªä¾‹å¤–ï¼‰ã€‚æœ€åï¼Œåº”å½“å¼•èµ·æ³¨æ„çš„æ˜¯ç”¨æˆ·å±‚å®ˆæŠ¤è¿›ç¨‹çš„çˆ¶è¿›ç¨‹æ˜¯`init`è¿›ç¨‹ã€‚\n\n# ç‰¹ç‚¹\n\nè¿è¡Œå‘¨æœŸé•¿ï¼Œåœ¨åå°æ‰§è¡Œï¼Œä¸éœ€è¦å’Œç”¨æˆ·äº¤äº’ã€‚\n\n# æ¦‚å¿µ\n\n1. ä¼šè¯ï¼šæ¯å½“æ‰“å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œå°±ç›¸å½“äºå’Œå†…æ ¸å»ºç«‹äº†ä¸€ä¸ªä¼šè¯ã€‚å†æ‰“å¼€ä¸€ä¸ªç»ˆç«¯å°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°ä¼šè¯ï¼Œä¸ç¬¬ä¸€ä¸ªä¼šè¯ä¸åŒã€‚å³ä¼šè¯æ˜¯ä¼´éšç»ˆç«¯çš„æ‰“å¼€è€Œå»ºç«‹çš„ã€‚ç”¨**ä¼šè¯é¦–è¿›ç¨‹çš„pid**æ¥ä½œä¸ºæ•´ä¸ªä¼šè¯çš„sidã€‚å³ä½¿è¯¥è¿›ç¨‹ç»“æŸäº†ï¼Œä¼šè¯idä¾ç„¶ä¸å˜ã€‚\n2. ä¼šè¯é¦–è¿›ç¨‹ï¼šåœ¨è¯¥ä¼šè¯ä¸­è¿è¡Œçš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ã€‚ä¸€èˆ¬æ¥è®²ä¼šè¯é¦–è¿›ç¨‹å°±æ˜¯bashã€‚\n3. è¿›ç¨‹ç»„ï¼šåœ¨ä¼šè¯ä¸­æ¯è¿è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œæ¯”å¦‚æ‰§è¡Œlsï¼Œä¼šåˆ›å»ºä¸€ä¸ªè¿›ç¨‹ç»„ï¼ŒåŒæ—¶ä¼šåˆ›å»ºä¸€ä¸ªè¿›ç¨‹ã€‚ç”¨è¯¥è¿›ç¨‹ç»„çš„é¦–è¿›ç¨‹pidä½œä¸ºæ•´ä¸ªè¿›ç¨‹ç»„çš„pgidï¼Œå³ç»„é•¿è¿›ç¨‹ã€‚è¿›ç¨‹ç»„ä¸­æœ‰å¯èƒ½ä¼šæœ‰å¤šä¸ªè¿›ç¨‹ï¼Œæ˜¯ç»„å†…è¿›ç¨‹forkäº§ç”Ÿçš„ã€‚å¦‚æœçˆ¶è¿›ç¨‹ï¼ˆç»„é•¿è¿›ç¨‹ï¼‰ç»“æŸäº†ï¼Œpgidä¸ä¼šæ”¹å˜ã€‚åªæœ‰è¿›ç¨‹ç»„ä¸­ä¸€ä¸ªè¿›ç¨‹éƒ½æ²¡æœ‰æ—¶è¯¥è¿›ç¨‹ç»„æ‰æ¶ˆå¤±ã€‚è¿›ç¨‹ç»„å¯ä»¥ä¾¿äºç³»ç»Ÿè¿›è¡Œç®¡ç†ï¼Œæ¯”å¦‚ç»™ç»„é•¿è¿›ç¨‹å‘ä¸€ä¸ªä¿¡å·ï¼Œå…¶ä»–äººéƒ½å¯ä»¥æ”¶åˆ°ã€‚\n4. ç»„é•¿è¿›ç¨‹\n\nå¦‚æœå…³é—­ç»ˆç«¯ï¼Œåˆ™ä¼šè¯é‡Œçš„è¿›ç¨‹ä¼šå…¨éƒ¨ç»“æŸã€‚\n\næˆ‘ä»¬è¦æƒ³åŠæ³•ä½¿ä¼šè¯ä¸­çš„è¿›ç¨‹ä¸ç»ˆç«¯æ–­ç»å…³ç³»ï¼Œç‹¬ç«‹èµ·æ¥ã€‚\n\næ€è·¯ï¼šå¯ä»¥æ–°å»ºå¦ä¸€ä¸ªä¼šè¯ï¼ŒæŠŠç»ˆç«¯ä¸­çš„è¿›ç¨‹ç»„æŒªå‡ºæ¥åˆ°è¿™ä¸ªä¼šè¯é‡Œï¼Œç„¶åå°±å¯ä»¥æ”¾å¿ƒåœ°å…³é—­ç»ˆç«¯äº†ã€‚è¿™å°±å«åšå®ˆæŠ¤è¿›ç¨‹ã€‚\n\nåˆ›å»ºæ–°ä¼šè¯å¯è°ƒç”¨`setsid`ã€‚ä½†æ˜¯æ˜¯æœ‰æ¡ä»¶çš„ï¼Œè°ƒç”¨è¯¥å‡½æ•°çš„è¿›ç¨‹ä¸èƒ½æ˜¯ä¸€ä¸ªç»„é•¿è¿›ç¨‹ï¼Œå› ä¸ºè¿™ä¼šå¼•èµ·ç»„é•¿idå†²çªã€‚å³å¿…é¡»æ˜¯éç»„é•¿æ‰å¯åˆ›å»ºæ–°ä¼šè¯ã€‚\n\n# ç¼–ç¨‹æµç¨‹\n\n1. `fork()`ï¼šçˆ¶è¿›ç¨‹åˆ›å»ºå­è¿›ç¨‹ï¼Œé€€å‡ºçˆ¶è¿›ç¨‹ï¼Œè¿™æ ·å°±ä¿è¯äº†å­è¿›ç¨‹ä¸æ˜¯ç»„é•¿idã€‚\n2. `setsid()`\n3. `fork()`ï¼šå­è¿›ç¨‹å†åˆ›å»ºå­™å­è¿›ç¨‹ï¼Œä¿è¯å­™å­è¿›ç¨‹ä¸æ˜¯ç»„é•¿idï¼Œä¿è¯ä¸å’Œç»ˆç«¯å†å…³è”ã€‚ä½†ä¸å¿…è¦ã€‚\n4. `chdir(\"/\")`ï¼šæŠŠå·¥ä½œç›®å½•æ”¹å˜åˆ°æ ¹ç›®å½•ï¼Œä¿é™©ï¼Œä¸ºé•¿æ—¶é—´çš„è¿è¡Œåšå¥½å‡†å¤‡ã€‚ä½†ä¸ä¸€å®šèƒ½ç”¨çš„åˆ°ã€‚è¿™ä¹ˆåšæ˜¯é˜²æ­¢è¢«å¸è½½ã€‚\n5. `unmask()`ï¼šæ¸…ç©ºæ©ç ï¼Œä¿è¯åˆ›å»ºæ–‡ä»¶æ—¶åˆ›å»ºå‡ºåº”æœ‰çš„æƒé™ã€‚\n6. `close()`ï¼šå…³é—­ç”¨ä¸åˆ°çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚0ã€1ã€2\n7. å¦‚æœå¯èƒ½äº§ç”Ÿå­è¿›ç¨‹ï¼Œè¿˜éœ€è¦æ³¨æ„å¤„ç†åƒµæ­»è¿›ç¨‹ã€‚\n\nåœ¨ç¼–å†™å®ˆæŠ¤è¿›ç¨‹ç¨‹åºæ—¶éœ€éµå¾ªä¸€äº›åŸºæœ¬è§„åˆ™ï¼Œä»¥é˜²æ­¢äº§ç”Ÿä¸å¿…è¦çš„äº¤äº’ä½œç”¨ã€‚ ä¸‹é¢å…ˆè¯´æ˜è¿™äº›è§„åˆ™ï¼Œç„¶åç»™å‡ºä¸€ä¸ªæŒ‰ç…§è¿™äº›è§„åˆ™ç¼–å†™çš„å‡½æ•°`daemonize`ã€‚\n\n1. é¦–å…ˆè¦åšçš„æ˜¯è°ƒç”¨`umask`å°†æ–‡ä»¶æ¨¡å¼åˆ›å»ºå±è”½å­—è®¾ç½®ä¸ºä¸€ä¸ªå·²çŸ¥å€¼ï¼ˆé€šå¸¸æ˜¯0ï¼‰ã€‚ç”±ç»§æ‰¿å¾—æ¥çš„æ–‡ä»¶æ¨¡å¼åˆ›å»ºå±è”½å­—å¯èƒ½ä¼šè¢«è®¾ç½®ä¸ºæ‹’ç»æŸäº›æƒé™ã€‚å¦‚æœå®ˆæŠ¤è¿›ç¨‹è¦åˆ›å»ºæ–‡ä»¶ï¼Œé‚£ä¹ˆå®ƒå¯èƒ½è¦è®¾ç½®ç‰¹å®šçš„æƒé™ã€‚ä¾‹å¦‚ï¼Œè‹¥å®ˆæŠ¤è¿›ç¨‹è¦åˆ›å»ºç»„å¯è¯»ã€ç»„å¯å†™çš„æ–‡ä»¶ï¼Œç»§æ‰¿çš„æ–‡ä»¶æ¨¡å¼åˆ›å»ºå±è”½å­—å¯èƒ½ä¼šå±è”½ä¸Šè¿°ä¸¤ç§æƒé™ä¸­çš„ä¸€ç§ï¼Œè€Œä½¿å…¶æ— æ³•å‘æŒ¥ä½œç”¨ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœå®ˆæŠ¤è¿›ç¨‹è°ƒç”¨çš„åº“å‡½æ•°åˆ›å»ºäº†æ–‡ä»¶ï¼Œé‚£ä¹ˆå°†æ–‡ä»¶æ¨¡å¼åˆ›å»ºå±è”½å­—è®¾ç½®ä¸ºä¸€ä¸ªé™åˆ¶æ€§æ›´å¼ºçš„å€¼ï¼ˆå¦‚007ï¼‰å¯èƒ½ä¼šæ›´æ˜æ™ºï¼Œå› ä¸ºåº“å‡½æ•°å¯èƒ½ä¸å…è®¸è°ƒç”¨è€…é€šè¿‡ä¸€ä¸ªæ˜¾å¼çš„å‡½æ•°å‚æ•°æ¥è®¾ç½®æƒé™ã€‚\n\n2. è°ƒç”¨forkï¼Œç„¶åä½¿çˆ¶è¿›ç¨‹exitã€‚è¿™æ ·åšå®ç°äº†ä¸‹é¢å‡ ç‚¹ã€‚ç¬¬ä¸€ï¼Œå¦‚æœè¯¥å®ˆæŠ¤è¿›ç¨‹æ˜¯ä½œä¸ºä¸€æ¡ç®€å•çš„shellå‘½ä»¤å¯åŠ¨çš„ï¼Œé‚£ä¹ˆçˆ¶è¿›ç¨‹ç»ˆæ­¢ä¼šè®©shellè®¤ä¸ºè¿™æ¡å‘½ä»¤å·²ç»æ‰§è¡Œå®Œæ¯•ã€‚ç¬¬äºŒï¼Œè™½ç„¶å­è¿›ç¨‹ç»§æ‰¿äº†çˆ¶è¿›ç¨‹çš„è¿›ç¨‹ç»„IDï¼Œä½†è·å¾—äº†ä¸€ä¸ªæ–°çš„è¿›ç¨‹IDï¼Œè¿™å°±ä¿è¯äº†å­è¿›ç¨‹ä¸æ˜¯ä¸€ä¸ªè¿›ç¨‹ç»„çš„ç»„é•¿è¿›ç¨‹ã€‚è¿™æ˜¯ä¸‹é¢å°†è¦è¿›è¡Œçš„`setsid`è°ƒç”¨çš„å…ˆå†³æ¡ä»¶ã€‚\n\n3. è°ƒç”¨`setsid`åˆ›å»ºä¸€ä¸ªæ–°ä¼šè¯ã€‚ç„¶åæ‰§è¡Œ9.5èŠ‚ä¸­åˆ—å‡ºçš„3ä¸ªæ­¥éª¤ï¼Œä½¿è°ƒç”¨è¿›ç¨‹âˆ¶ï¼ˆaï¼‰æˆä¸ºæ–°ä¼šè¯çš„é¦–è¿›ç¨‹ï¼Œï¼ˆbï¼‰æˆä¸ºä¸€ä¸ªæ–°è¿›ç¨‹ç»„çš„ç»„é•¿è¿›ç¨‹ï¼Œï¼ˆcï¼‰æ²¡æœ‰æ§åˆ¶ç»ˆç«¯ã€‚\n   >åœ¨åŸºäºSystem Vçš„ç³»ç»Ÿä¸­ï¼Œæœ‰äº›äººå»ºè®®åœ¨æ­¤æ—¶å†æ¬¡è°ƒç”¨forkï¼Œç»ˆæ­¢çˆ¶è¿›ç¨‹ï¼Œç»§ç»­ä½¿ç”¨å­è¿›ç¨‹ä¸­çš„å®ˆæŠ¤è¿›ç¨‹ã€‚è¿™å°±ä¿è¯äº†è¯¥å®ˆæŠ¤è¿›ç¨‹ä¸æ˜¯ä¼šè¯é¦–è¿›ç¨‹ï¼Œäºæ˜¯æŒ‰ç…§System Vè§„åˆ™ï¼ˆè§UNIXç¯å¢ƒé«˜çº§ç¼–ç¨‹9.6èŠ‚ï¼‰å¯ä»¥é˜²æ­¢å®ƒå–å¾—æ§åˆ¶ç»ˆç«¯ã€‚ä¸ºäº†é¿å…å–å¾—æ§åˆ¶ç»ˆç«¯çš„å¦ä¸€ç§æ–¹æ³•æ˜¯ï¼Œæ— è®ºä½•æ—¶æ‰“å¼€ä¸€ä¸ªç»ˆç«¯è®¾å¤‡ï¼Œéƒ½ä¸€å®šè¦æŒ‡å®š`O_NOCTTY`ã€‚\n\n4. å°†å½“å‰å·¥ä½œç›®å½•æ›´æ”¹ä¸ºæ ¹æ—¥å½•ã€‚ä»çˆ¶è¿›ç¨‹å¤„ç»§æ‰¿è¿‡æ¥çš„å½“å‰å·¥ä½œç›®å½•å¯èƒ½åœ¨ä¸€ä¸ªæŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚å› ä¸ºå®ˆæŠ¤è¿›ç¨‹é€šå¸¸åœ¨ç³»ç»Ÿå†å¼•å¯¼ä¹‹å‰æ˜¯ä¸€ç›´å­˜åœ¨çš„ï¼Œæ‰€ä»¥å¦‚æœå®ˆæŠ¤è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•åœ¨ä¸€ä¸ªæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œé‚£ä¹ˆè¯¥æ–‡ä»¶ç³»ç»Ÿå°±ä¸èƒ½è¢«å¸è½½ã€‚æˆ–è€…ï¼ŒæŸäº›å®ˆæŠ¤è¿›ç¨‹è¿˜å¯èƒ½ä¼šæŠŠå½“å‰å·¥ä½œç›®å½•æ›´æ”¹åˆ°æŸä¸ªæŒ‡å®šä½ç½®ï¼Œå¹¶åœ¨æ­¤ä½ç½®è¿›è¡Œå®ƒä»¬çš„å…¨éƒ¨å·¥ä½œã€‚ä¾‹å¦‚ï¼Œè¡Œå¼æ‰“å°æœºå‡è„±æœºå®ˆæŠ¤è¿›ç¨‹å°±å¯èƒ½å°†å…¶å·¥ä½œç›®å½•æ›´æ”¹åˆ°å®ƒä»¬çš„spoolç›®å½•ä¸Šã€‚\n\n5. å…³é—­ä¸å†éœ€è¦çš„æ–‡ä»¶æè¿°ç¬¦ã€‚è¿™ä½¿å®ˆæŠ¤è¿›ç¨‹ä¸å†æŒæœ‰ä»å…¶çˆ¶è¿›ç¨‹ç»§æ‰¿æ¥çš„ä»»ä½•æ–‡ä»¶æè¿°ç¬¦ï¼ˆçˆ¶è¿›ç¨‹å¯èƒ½æ˜¯shellè¿›ç¨‹ï¼Œæˆ–æŸä¸ªå…¶ä»–è¿›ç¨‹ï¼‰ã€‚å¯ä»¥ä½¿ç”¨`open_max`å‡½æ•°ï¼ˆè§2.17èŠ‚ï¼‰æˆ–`getrlimit`å‡½æ•°ï¼ˆè§ 7.11èŠ‚ï¼‰æ¥åˆ¤å®šæœ€é«˜æ–‡ä»¶æè¿°ç¬¦å€¼ï¼Œå¹¶å…³é—­ç›´åˆ°è¯¥å€¼çš„æ‰€æœ‰æè¿°ç¬¦ã€‚\n\n6. æŸäº›å®ˆæŠ¤è¿›ç¨‹æ‰“å¼€`/dev/null`ä½¿å…¶å…·æœ‰æ–‡ä»¶æè¿°ç¬¦0ã€1å’Œ2ï¼Œè¿™æ ·ï¼Œä»»ä½•ä¸€ä¸ªè¯•å›¾è¯»æ ‡å‡†è¾“å…¥ã€å†™æ ‡å‡†è¾“å‡ºæˆ–æ ‡å‡†é”™è¯¯çš„åº“ä¾‹ç¨‹éƒ½ä¸ä¼šäº§ç”Ÿä»»ä½•æ•ˆæœã€‚å› ä¸ºå®ˆæŠ¤è¿›ç¨‹å¹¶ä¸ä¸ç»ˆç«¯è®¾å¤‡ç›¸å…³è”ï¼Œæ‰€ä»¥å…¶è¾“å‡ºæ— å¤„æ˜¾ç¤ºï¼Œä¹Ÿæ— å¤„ä»äº¤äº’å¼ç”¨æˆ·é‚£é‡Œæ¥æ”¶è¾“å…¥ã€‚å³ä½¿å®ˆæŠ¤è®²ç¨‹æ˜¯ä»äº¤äº’å¼ä¼šè¯å¯åŠ¨çš„ï¼Œä½†æ˜¯å®ˆæŠ¤è¿›ç¨‹æ˜¯åœ¨åå°è¿è¡Œçš„ï¼Œæ‰€ä»¥ç™»å½•ä¼šè¯çš„ç»ˆæ­¢å¹¶ä¸å½±å“å®ˆæŠ¤è¿›ç¨‹ã€‚å¦‚æœå…¶ä»–ç”¨æˆ·åœ¨åŒä¸€ç»ˆç«¯è®¾å¤‡ä¸Šç™»å½•ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›åœ¨è¯¥ç»ˆç«¯ä¸Šè§åˆ°å®ˆæŠ¤è¿›ç¨‹çš„è¾“å‡ºï¼Œç”¨æˆ·ä¹Ÿä¸æœŸæœ›ä»–ä»¬åœ¨ç»ˆç«¯ä¸Šçš„è¾“å…¥è¢«å®ˆæŠ¤è¿›ç¨‹è¯»å–ã€‚\n\n# å®ä¾‹\n\n```cpp\n#include\"apue.h\"\n#include<syslog.h>\n#include<fcntl.h>\n#include<sys/resource.h>\nvoid daemonize(const char * cmd)\n{\n    int              i, fd0, fd1, fd2;\n    pid_t            pid;\n    struct rlimit    rl;\n    struct sigaction sa;\n    \n    /* Clear file creation mask. */\n    umask(0);\n    \n    /* Get maximum number of file descriptions. */\n    if(getrlimit(RLIMIT_NOFILE, &rl) < 0)\n    {\n        err_quit(\"%s: can't get file limit\", cmd);\n    }\n    /* Become a session leader to lose controlling TTY. */\n    if((pid = fork()) < 0)\n    {\n        err_quit(\"%s: can't fork\", cmd);\n    }\n    else if(pid != 0)//parent\n    {\n        exit(0);\n    }\n    setsid();\n    /* Ensure future opens won't allocate controlling TTYs. */\n    sa.sa_handler = SIG_IGN;\n    sigemptyset(&sa.sa_mask);\n    sa.sa_flags = 0;\n    if(sigaction(SIGHUP, &sa, NULL) < 0)\n    {\n        err_quit(\"%s: can't ignore SIGHUP\", cmd);\n    }\n    if((pid = fork()) < 0)\n    {\n        err_quit(\"%s: can't fork\", cmd);\n    }\n    else if(pid != 0)//parent\n    {\n        exit(0);\n    }\n    /* change the current working directory to the root, \n    so we won't prevent file systems from being unmounted. */\n    if(chdir(\"/\") < 0)\n    {\n        err_quit(\"%s: can't change directory to /\", cmd);\n    }\n    /* close all open file descriptors */\n    if(rl.rlim_max == RLIM_INFINTY)\n    {\n        rl.rlim_max = 1024;\n    }\n    for(i = 0; i < rl.rlim_max; ++i)\n    {\n        close(i);\n    }\n    /* attach file descriptors 0, 1, and 2 to /dev/null */\n    fd0 = open(\"/dev/null\", O_RDWR);\n    fd1 = dup(0);\n    fd2 = dup(0);\n    /* initialize the log file. */\n    openlog(cmd, LOG_CONS, LOG_DAEMON);\n    if(fd0 != 0 || fd1 != 1 || fd2 != 2)\n    {\n        syslog(LOG_ERR, \"unexpected file descriptors %d %d %d\", fd0, fd1, fd2);\n        exit(1);\n    }\n}\n```\n\nè‹¥`daemonize`å‡½æ•°ç”±`main`ç¨‹åºè°ƒç”¨ï¼Œç„¶å`main`ç¨‹åºè¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨`ps`å‘½ä»¤æ£€æŸ¥è¯¥å®ˆæŠ¤è¿›ç¨‹çš„çŠ¶æ€ï¼š\n\n```\n$ ./a.out\n$ ps -efj\nUID    PID  PPID  PGID   SID TTY CMD\nsar 13800      1 13799 13799  ?  ./a.out\n$ ps -efj | grep 13799\nsar 13800      1 13799 13799  ?  ./a.out\n```\n\næˆ‘ä»¬ä¹Ÿå¯ç”¨`ps`å‘½ä»¤éªŒè¯ï¼Œæ²¡æœ‰æ´»åŠ¨è¿›ç¨‹å­˜åœ¨çš„IDæ˜¯`13799`ã€‚è¿™æ„å‘³ç€ï¼Œå®ˆæŠ¤è¿›ç¨‹åœ¨ä¸€ä¸ªå­¤å„¿è¿›ç¨‹ç»„ä¸­ï¼ˆè§9.10èŠ‚ï¼‰ï¼Œå®ƒä¸æ˜¯ä¼šè¯é¦–è¿›ç¨‹ï¼Œå› æ­¤æ²¡æœ‰æœºä¼šè¢«åˆ†é…åˆ°ä¸€ä¸ªæ§åˆ¶ç»ˆç«¯ã€‚è¿™ä¸€ç»“æœæ˜¯åœ¨`daemonize`å‡½æ•°ä¸­æ‰§è¡Œç¬¬äºŒä¸ª`fork`é€ æˆçš„ã€‚å¯ä»¥çœ‹å‡ºï¼Œå®ˆæŠ¤è¿›ç¨‹å·²ç»è¢«æ­£ç¡®åœ°åˆå§‹åŒ–äº†ã€‚\n\n","categories":["Linux"]},{"title":"æ•°æ®åº“ç†è®º_äº‹åŠ¡","url":"/æ•°æ®åº“/æ•°æ®åº“ç†è®º_äº‹åŠ¡/","content":"äº‹åŠ¡å°±åƒæ˜¯æ‰¹å¤„ç†ä¸€æ ·ï¼Œå¯ä»¥æœ‰å¤šæ¡SQLè¯­å¥ã€å‡½æ•°ç­‰ç­‰ï¼ŒæŒ‰ç…§æµç¨‹è¿›è¡Œæ“ä½œã€‚æ¯”å¦‚å…¬å¸å¼•è¿›ä¸€ä¸ªæ–°äººï¼Œäº‹åŠ¡ä¸ä»…æ˜¯ç®€å•çš„æ’å…¥ä¸€ä¸ªè¡¨ï¼Œè€Œæ˜¯æ’å…¥å­˜åœ¨ä¾èµ–å…³ç³»çš„éƒ¨é—¨å‘˜å·¥è¡¨ã€å·¥èµ„è¡¨ã€äººäº‹è¡¨ç­‰ç­‰ã€‚äº‹åŠ¡å®Œæˆåï¼Œæ‰å®Œæˆäº†æ•°æ®çš„æŒä¹…åŒ–ã€‚å¦‚æœä¸­é—´é™¤äº†é—®é¢˜ï¼Œå¯ä»¥è¿›è¡Œé€‰æ‹©æ€§çš„å›é€€ã€æˆ–å®Œå…¨å›é€€ã€‚\n\nå®é™…ä¸Šäº‹åŠ¡ä¸€ç›´éƒ½æœ‰ï¼Œæ¯æ¬¡æˆ‘ä»¬æäº¤SQLè¯­å¥æ—¶ï¼Œæ•°æ®åº“å°±é»˜è®¤æäº¤äº†ä¸€ä¸ªäº‹åŠ¡ã€‚\n\n# å…³é”®å­—\n\n## Transaction\nTransaction(Read, Write, Commit, Abort)\näº‹åŠ¡ï¼ˆè¯»å–ã€å†™å…¥ã€æäº¤ã€ä¸­æ­¢ï¼‰\n\nä»ç¨‹åºè§’åº¦æ¥è¯´ï¼Œäº‹åŠ¡å°±æ˜¯ä¸€ç»„åŸå­æ€§çš„SQLè¯­å¥ï¼Œæˆ–è€…è¯´æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å·¥ä½œå•å…ƒã€‚å¦‚æœæ•°æ®åº“å¼•æ“èƒ½å¤ŸæˆåŠŸåœ°å¯¹æ•°æ®åº“åº”ç”¨è¯¥è¯­å¥ï¼Œé‚£ä¹ˆå°±æ‰§è¡Œï¼›å¦‚æœå…¶ä¸­æœ‰ä»»ä½•ä¸€æ¡è¯­å¥å› ä¸ºå´©æºƒæˆ–å…¶ä»–åŸå› æ— æ³•æ‰§è¡Œï¼Œé‚£ä¹ˆæ‰€æœ‰çš„è¯­å¥éƒ½ä¸ä¼šæ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œäº‹åŠ¡å†…çš„è¯­å¥è¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œå¤±è´¥ã€‚\n\näº‹åŠ¡å¹¶éæ€»èƒ½æˆåŠŸåœ°æ‰§è¡Œå®Œæˆã€‚è¿™ç§äº‹åŠ¡ç§°ä¸º**ä¸­æ­¢(aborted)**ã€‚æˆ‘ä»¬å¦‚æœè¦ç¡®ä¿åŸå­æ€§ï¼Œä¸­æ­¢äº‹åŠ¡å¿…é¡»å¯¹æ•°æ®åº“çš„çŠ¶æ€ä¸é€ æˆå½±å“ã€‚å› æ­¤ï¼Œä¸­æ­¢äº‹åŠ¡å¯¹æ•°æ®åº“æ‰€åšçš„ä»»ä½•æ”¹å˜å¿…é¡»æ’¤é”€ã€‚ä¸€æ—¦ä¸­æ­¢äº‹åŠ¡é€ æˆçš„å˜æ›´è¢«æ’¤é”€ï¼Œæˆ‘ä»¬å°±è¯´äº‹åŠ¡**å·²å›æ»š(rolledback)**ã€‚æ¢å¤æœºåˆ¶è´Ÿè´£ç®¡ç†äº‹åŠ¡ä¸­æ­¢ã€‚å…¸å‹çš„æ–¹æ³•æ˜¯ç»´æŠ¤ä¸€ä¸ªæ—¥å¿—(log)ã€‚æ¯ä¸ªäº‹åŠ¡å¯¹æ•°æ®åº“çš„ä¿®æ”¹éƒ½é¦–å…ˆä¼šè®°å½•åˆ°æ—¥å¿—ä¸­ã€‚æˆ‘ä»¬è®°å½•æ‰§è¡Œä¿®æ”¹çš„äº‹åŠ¡æ ‡è¯†ç¬¦ã€ä¿®æ”¹çš„æ•°æ®é¡¹æ ‡è¯†ç¬¦ä»¥åŠæ•°æ®é¡¹çš„æ—§å€¼ï¼ˆä¿®æ”¹å‰çš„ï¼‰å’Œæ–°å€¼ï¼ˆä¿®æ”¹åçš„ï¼‰ã€‚ç„¶åæ•°æ®åº“æ‰ä¼šä¿®æ”¹ã€‚ç»´æŠ¤æ—¥å¿—æä¾›äº†é‡åšä¿®æ”¹ä»¥ä¿è¯åŸå­æ€§å’ŒæŒä¹…æ€§çš„å¯èƒ½ï¼Œä»¥åŠæ’¤é”€ä¿®æ”¹ä»¥ä¿è¯åœ¨äº‹åŠ¡æ‰§è¡Œå‘ç”Ÿæ•…éšœæ—¶çš„åŸå­æ€§çš„å¯èƒ½ã€‚\n\næˆåŠŸå®Œæˆæ‰§è¡Œçš„äº‹åŠ¡ç§°ä¸º**å·²æäº¤(committed)**ã€‚ä¸€ä¸ªå¯¹æ•°æ®åº“è¿›è¡Œè¿‡æ›´æ–°çš„å·²æäº¤äº‹åŠ¡ä½¿æ•°æ®åº“**è¿›å…¥ä¸€ä¸ªæ–°çš„ä¸€è‡´çŠ¶æ€**ï¼Œå³ä½¿å‡ºç°ç³»ç»Ÿæ•…éšœï¼Œè¿™ä¸ªçŠ¶æ€ä¹Ÿå¿…é¡»ä¿æŒã€‚\n\nä¸€æ—¦äº‹åŠ¡å·²æäº¤ï¼Œæˆ‘ä»¬ä¸èƒ½é€šè¿‡ä¸­æ­¢å®ƒæ¥æ’¤é”€å…¶é€ æˆçš„å½±å“ã€‚æ’¤é”€å·²æäº¤äº‹åŠ¡æ‰€é€ æˆå½±å“çš„å”¯æ–¹æ³•æ˜¯æ‰§è¡Œä¸€ä¸ª**è¡¥å¿äº‹åŠ¡(compensating transaction)**ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªäº‹åŠ¡ç»™ä¸€ä¸ªè´¦æˆ·åŠ ä¸Šäº†`$20`ï¼Œå…¶è¡¥å¿äº‹åŠ¡åº”å½“ä»è¯¥è´¦æˆ·å‡å»`$20`ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä¸æ€»æ˜¯èƒ½å¤Ÿåˆ›å»ºè¿™æ ·çš„è¡¥å¿äº‹åŠ¡ã€‚å› æ­¤ï¼Œä¹¦å†™å’Œæ‰§è¡Œä¸€ä¸ªè¡¥å¿äº‹åŠ¡çš„è´£ä»»å°±ç•™ç»™äº†ç”¨æˆ·ï¼Œè€Œä¸æ˜¯é€šè¿‡æ•°æ®åº“ç³»ç»Ÿæ¥å¤„ç†ã€‚\n\næˆ‘ä»¬éœ€è¦æ›´å‡†ç¡®åœ°å®šä¹‰ä¸€ä¸ªäº‹åŠ¡æˆåŠŸå®Œæˆçš„å«ä¹‰ã€‚ä¸ºæ­¤æˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ªç®€å•çš„æŠ½è±¡äº‹åŠ¡æ¨¡å‹ã€‚äº‹åŠ¡å¿…é¡»å¤„äºä»¥ä¸‹çŠ¶æ€ä¹‹ä¸€ã€‚\n\n1. æ´»åŠ¨çš„(active)ï¼šåˆå§‹çŠ¶æ€ï¼Œäº‹åŠ¡æ‰§è¡Œæ—¶å¤„äºè¿™ä¸ªçŠ¶æ€ã€‚\n2. éƒ¨åˆ†æäº¤çš„(partially committed)ï¼šæœ€åä¸€æ¡è¯­å¥æ‰§è¡Œåã€‚\n3. å¤±è´¥çš„(failed)ï¼šå‘ç°æ­£å¸¸çš„æ‰§è¡Œä¸èƒ½ç»§ç»­åã€‚\n4. ä¸­æ­¢çš„(aborted)ï¼šäº‹åŠ¡å›æ»šå¹¶ä¸”æ•°æ®åº“å·²æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹æ‰§è¡Œå‰çš„çŠ¶æ€åã€‚\n5. æäº¤çš„(committed)ï¼šæˆåŠŸå®Œæˆåã€‚\n\näº‹åŠ¡ç›¸åº”çš„çŠ¶æ€å›¾å¦‚å›¾æ‰€ç¤ºã€‚åªæœ‰åœ¨äº‹åŠ¡å·²è¿›å…¥æäº¤çŠ¶æ€åï¼Œæˆ‘ä»¬æ‰è¯´äº‹åŠ¡å·²æäº¤ã€‚ç±»ä¼¼åœ°ï¼Œä»…å½“äº‹åŠ¡å·²è¿›å…¥ä¸­æ­¢çŠ¶æ€ï¼Œæˆ‘ä»¬æ‰è¯´äº‹åŠ¡å·²ä¸­æ­¢ã€‚å¦‚æœäº‹åŠ¡æ˜¯æäº¤çš„æˆ–ä¸­æ­¢çš„ï¼Œå®ƒç§°ä¸ºå·²ç»ç»“æŸçš„(terminated)ã€‚\n\n![image-20220724215039732](../../images/æ•°æ®åº“ç†è®º_äº‹åŠ¡/image-20220724215039732.png)\n\näº‹åŠ¡ä»æ´»åŠ¨çŠ¶æ€å¼€å§‹ã€‚**å½“äº‹åŠ¡å®Œæˆå®ƒçš„æœ€åä¸€æ¡è¯­å¥åå°±è¿›å…¥äº†éƒ¨åˆ†æäº¤çŠ¶æ€ã€‚æ­¤åˆ»ï¼Œäº‹åŠ¡å·²ç»å®Œæˆæ‰§è¡Œï¼Œä½†ç”±äºå®é™…è¾“å‡ºå¯èƒ½ä»ä¸´æ—¶é©»ç•™åœ¨ä¸»å­˜ä¸­ï¼Œå› æ­¤ä¸€ä¸ªç¡¬ä»¶æ•…éšœå¯èƒ½é˜»æ­¢å…¶æˆåŠŸå®Œæˆï¼Œäºæ˜¯äº‹åŠ¡ä»æœ‰å¯èƒ½ä¸å¾—ä¸ä¸­æ­¢ã€‚**\n\næ¥ç€æ•°æ®åº“ç³»ç»Ÿå¾€ç£ç›˜ä¸Š**å†™å…¥**(write)è¶³å¤Ÿçš„ä¿¡æ¯ï¼Œç¡®ä¿å³ä½¿å‡ºç°æ•…éšœæ—¶äº‹åŠ¡æ‰€åšçš„æ›´æ–°ä¹Ÿèƒ½åœ¨ç³»ç»Ÿé‡å¯åé‡æ–°åˆ›å»ºã€‚å½“æœ€åä¸€æ¡è¿™æ ·çš„ä¿¡æ¯å†™å®Œåï¼Œäº‹åŠ¡å°±è¿›å…¥æäº¤çŠ¶æ€ã€‚\n\nç³»ç»Ÿåˆ¤å®šäº‹åŠ¡ä¸èƒ½ç»§ç»­æ­£å¸¸æ‰§è¡Œåï¼ˆä¾‹å¦‚ï¼Œç”±äºç¡¬ä»¶æˆ–é€»è¾‘é”™è¯¯ï¼‰ï¼Œäº‹åŠ¡å°±è¿›å…¥å¤±è´¥çŠ¶æ€ã€‚è¿™ç§äº‹åŠ¡å¿…é¡»å›æ»šã€‚è¿™æ ·ï¼Œäº‹åŠ¡å°±è¿›äººä¸­æ­¢çŠ¶æ€ã€‚æ­¤åˆ»ï¼Œç³»ç»Ÿæœ‰ä¸¤ç§é€‰æ‹©ã€‚\n\n1. å®ƒå¯ä»¥é‡å¯(restart)äº‹åŠ¡ï¼Œä½†ä»…å½“å¼•èµ·äº‹åŠ¡ä¸­æ­¢çš„æ˜¯ç¡¬ä»¶é”™è¯¯æˆ–ä¸æ˜¯ç”±äº‹åŠ¡çš„å†…éƒ¨é€»è¾‘æ‰€äº§ç”Ÿçš„è½¯ä»¶é”™è¯¯æ—¶ã€‚é‡å¯çš„äº‹åŠ¡è¢«çœ‹æˆæ˜¯ä¸€ä¸ªæ–°äº‹åŠ¡ã€‚\n2. å®ƒå¯ä»¥æ€æ­»(kill)äº‹åŠ¡ï¼Œè¿™æ ·åšé€šå¸¸æ˜¯ç”±äºäº‹åŠ¡çš„å†…éƒ¨é€»è¾‘é€ æˆçš„é”™è¯¯ï¼Œåªæœ‰é‡å†™åº”ç”¨ç¨‹åºæ‰èƒ½æ”¹æ­£ï¼Œæˆ–è€…ç”±äºè¾“å…¥é”™è¯¯ï¼Œæˆ–æ‰€éœ€æ•°æ®åœ¨æ•°æ®åº“ä¸­æ²¡æœ‰æ‰¾åˆ°ã€‚\n\nåœ¨å¤„ç†å¯è§çš„å¤–éƒ¨å†™(observable external write)ï¼Œæ¯”å¦‚å†™åˆ°ç”¨æˆ·å±å¹•ï¼Œæˆ–è€…å‘é€ç”µå­é‚®ä»¶æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»è¦å°å¿ƒã€‚ç”±äºå†™çš„ç»“æœå¯èƒ½å·²ç»åœ¨æ•°æ®åº“ç³»ç»Ÿä¹‹å¤–çœ‹åˆ°ï¼Œå› æ­¤ä¸€æ—¦å‘ç”Ÿè¿™ç§å†™æ“ä½œï¼Œå°±ä¸èƒ½å†æŠ¹å»ã€‚å¤§å¤šæ•°ç³»ç»Ÿåªå…è®¸è¿™ç§å†™æ“ä½œåœ¨äº‹åŠ¡è¿›å…¥æäº¤çŠ¶æ€åå‘ç”Ÿã€‚å®ç°è¿™ç§æ¨¡å¼çš„ä¸€ç§æ–¹æ³•æ˜¯åœ¨éæ˜“å¤±æ€§å­˜å‚¨è®¾å¤‡ä¸­ä¸´æ—¶å†™ä¸‹ä¸å¤–éƒ¨å†™ç›¸å…³çš„æ‰€æœ‰æ•°æ®ï¼Œç„¶ååœ¨äº‹åŠ¡è¿›å…¥æäº¤çŠ¶æ€åå†æ‰§è¡ŒçœŸæ­£çš„å†™æ“ä½œã€‚\n\nå¦‚æœåœ¨äº‹åŠ¡å·²è¿›å…¥æäº¤çŠ¶æ€è€Œå¤–éƒ¨å†™æ“ä½œå°šæœªå®Œæˆä¹‹æ—¶ï¼Œç³»ç»Ÿå‡ºç°äº†æ•…éšœï¼Œæ•°æ®åº“ç³»ç»Ÿå°±å¯ä»¥åœ¨é‡å¯åï¼ˆç”¨å­˜å‚¨åœ¨éæ˜“å¤±æ€§è®¾å¤‡ä¸­çš„æ•°æ®ï¼‰æ‰§è¡Œå¤–éƒ¨å†™æ“ä½œã€‚\n\nåœ¨æŸäº›æƒ…å†µä¸‹å¤„ç†å¤–éƒ¨å†™æ“ä½œä¼šæ›´å¤æ‚ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬å‡è®¾å¤–éƒ¨åŠ¨ä½œæ˜¯åœ¨è‡ªåŠ¨å–æ¬¾æœºä¸Šæ”¯ä»˜ç°é‡‘ï¼Œå¹¶ä¸”ç³»ç»Ÿæ°å¥½åœ¨æ”¯ä»˜ç°é‡‘ä¹‹å‰å‘ç”Ÿæ•…éšœï¼ˆæˆ‘ä»¬å‡å®šç°é‡‘èƒ½è‡ªåŠ¨æ”¯ä»˜ï¼‰ï¼Œå½“ç³»ç»Ÿé‡æ–°å¯åŠ¨æ—¶å†æ‰§è¡Œç°é‡‘æ”¯ä»˜å°†æ¯«æ— æ„ä¹‰ï¼Œå› ä¸ºç”¨æˆ·å¯èƒ½å·²ç»ç¦»å¼€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé‡æ–°å¯åŠ¨æ—¶ç³»ç»Ÿåº”è¯¥æ‰§è¡Œä¸€ä¸ªè¡¥å¿äº‹åŠ¡ï¼Œæ¯”å¦‚å°†ç°é‡‘å­˜å›ç”¨æˆ·çš„è´¦æˆ·ã€‚\n\n## Serializability\n\nå¦‚æœå¹¶å‘æ‰§è¡Œçš„æ§åˆ¶å®Œå…¨ç”±æ“ä½œç³»ç»Ÿè´Ÿè´£ï¼Œè®¸å¤šè°ƒåº¦éƒ½æ˜¯å¯èƒ½çš„ï¼ŒåŒ…æ‹¬åƒä¸Šè¿°è°ƒåº¦é‚£æ ·ä½¿æ•°æ®åº“å¤„äºä¸ä¸€è‡´çŠ¶æ€çš„è°ƒåº¦ã€‚ä¿è¯æ‰€æ‰§è¡Œçš„ä»»ä½•è°ƒåº¦éƒ½èƒ½ä½¿æ•°æ®åº“å¤„äºä¸€è‡´çŠ¶æ€ï¼Œè¿™æ˜¯æ•°æ®åº“ç³»ç»Ÿçš„ä»»åŠ¡ï¼Œæ•°æ®åº“ç³»ç»Ÿä¸­è´Ÿè´£å®Œæˆæ­¤ä»»åŠ¡çš„æ˜¯å¹¶å‘æ§åˆ¶(concurrency-control)éƒ¨ä»¶ã€‚\n\nåœ¨å¹¶å‘æ‰§è¡Œä¸­ï¼Œ**é€šè¿‡ä¿è¯æ‰€æ‰§è¡Œçš„ä»»ä½•è°ƒåº¦çš„æ•ˆæœéƒ½ä¸æ²¡æœ‰å¹¶å‘æ‰§è¡Œçš„è°ƒåº¦æ•ˆæœä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿æ•°æ®åº“çš„ä¸€è‡´æ€§**ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè°ƒåº¦åº”è¯¥åœ¨æŸç§æ„ä¹‰ä¸Šç­‰ä»·äºä¸€ä¸ªä¸²è¡Œè°ƒåº¦ã€‚è¿™ç§è°ƒåº¦ç§°ä¸º**å¯ä¸²è¡ŒåŒ–**(serializable)è°ƒåº¦ã€‚\n\näº‹åŠ¡å¤„ç†ç³»ç»Ÿé€šå¸¸å…è®¸å¤šä¸ªäº‹åŠ¡å¹¶å‘åœ°æ‰§è¡Œã€‚æ­£å¦‚æˆ‘ä»¬å…ˆå‰çœ‹åˆ°çš„ï¼Œå…è®¸å¤šä¸ªäº‹åŠ¡å¹¶å‘æ›´æ–°æ•°æ®å¼•èµ·è®¸å¤šæ•°æ®ä¸€è‡´æ€§çš„å¤æ‚é—®é¢˜ã€‚åœ¨å­˜åœ¨äº‹åŠ¡å¹¶å‘æ‰§è¡Œçš„æƒ…å†µä¸‹ä¿è¯ä¸€è‡´æ€§éœ€è¿›è¡Œé¢å¤–å·¥ä½œï¼›å¦‚æœæˆ‘ä»¬å¼ºåˆ¶äº‹åŠ¡ä¸²è¡Œåœ°(serially)æ‰§è¡Œå°†ç®€å•å¾—å¤šæ¬¡æ‰§è¡Œä¸€ä¸ªäº‹åŠ¡ï¼Œæ¯ä¸ªäº‹åŠ¡ä»…å½“å‰ä¸€äº‹åŠ¡æ‰§è¡Œå®Œåæ‰å¼€å§‹ã€‚\n\nåœ¨æˆ‘ä»¬è€ƒè™‘æ•°æ®åº“ç³»ç»Ÿå¹¶å‘æ§åˆ¶éƒ¨ä»¶å¦‚ä½•ä¿è¯ä¸²è¡ŒåŒ–ä¹‹å‰ï¼Œæˆ‘ä»¬è€ƒè™‘å¦‚ä½•ç¡®å®šä¸€ä¸ªè°ƒåº¦æ˜¯å¯ä¸²è¡ŒåŒ–çš„ã€‚æ˜¾ç„¶ï¼Œä¸²è¡Œè°ƒåº¦æ˜¯å¯ä¸²è¡ŒåŒ–çš„ï¼Œä½†æ˜¯å¦‚æœè®¸å¤šäº‹åŠ¡çš„æ­¥éª¤äº¤é”™æ‰§è¡Œï¼Œåˆ™å¾ˆéš¾ç¡®å®šä¸€ä¸ªè°ƒåº¦æ˜¯å¦æ˜¯å¯ä¸²è¡ŒåŒ–çš„ã€‚ç”±äºäº‹åŠ¡å°±æ˜¯ç¨‹åºï¼Œå› æ­¤è¦ç¡®å®šä¸€ä¸ªäº‹åŠ¡æœ‰å“ªäº›æ“ä½œã€å¤šä¸ªäº‹åŠ¡çš„æ“ä½œå¦‚ä½•ç›¸äº’ä½œç”¨æ˜¯æœ‰å›°éš¾çš„ã€‚ç”±äºè¿™ä¸ªç¼˜æ•…ï¼Œæˆ‘ä»¬å°†ä¸ä¼šè€ƒè™‘ä¸€ä¸ªäº‹åŠ¡å¯¹æŸä¸€æ•°æ®é¡¹å¯æ‰§è¡Œçš„å„ç§ä¸åŒç±»å‹çš„æ“ä½œï¼Œ è€Œåªè€ƒè™‘ä¸¤ç§æ“ä½œï¼š**readå’Œwrite**ã€‚\n\næˆ‘ä»¬è¿™æ ·å‡è®¾ï¼Œ åœ¨æ•°æ®é¡¹Qä¸Šçš„read(Q)å’Œwrite(Q)æŒ‡ä»¤ä¹‹é—´ï¼Œäº‹åŠ¡å¯ä»¥å¯¹é©»ç•™åœ¨äº‹åŠ¡å±€éƒ¨ç¼“å†²åŒºä¸­çš„Qçš„æ‹·è´æ‰§è¡Œä»»æ„æ“ä½œåºåˆ—ã€‚æŒ‰è¿™ç§æ¨¡å¼ï¼Œ ä»è°ƒåº¦çš„è§’åº¦æ¥çœ‹ï¼Œ äº‹åŠ¡å”¯ä¸€é‡è¦çš„æ“ä½œæ˜¯readä¸writeæŒ‡ä»¤ã€‚commitæ“ä½œå°½ç®¡ç›¸å…³ï¼Œ ä½†æ˜¯æˆ‘ä»¬åé¢æ‰è€ƒè™‘å®ƒã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨è°ƒåº¦ä¸­é€šå¸¸åªæ˜¾ç¤ºreadä¸writeæŒ‡ä»¤ï¼Œæ­£å¦‚å›¾æ‰€ç¤ºã€‚\n\n![image-20220724223733635](../../images/æ•°æ®åº“ç†è®º_äº‹åŠ¡/image-20220724223733635.png)\n\n## History\n\n## Schedule\n\næ‰§è¡Œé¡ºåºç§°ä¸ºè°ƒåº¦(schedule)ã€‚å®ƒä»¬è¡¨ç¤ºæŒ‡ä»¤åœ¨ç³»ç»Ÿä¸­æ‰§è¡Œçš„æ—¶é—´é¡ºåºã€‚æ˜¾ç„¶ï¼Œä¸€ç»„äº‹åŠ¡çš„ä¸€ä¸ª**è°ƒåº¦å¿…é¡»åŒ…å«è¿™ä¸€ç»„äº‹åŠ¡çš„å…¨éƒ¨æŒ‡ä»¤**ï¼Œå¹¶ä¸”å¿…é¡»ä¿æŒæŒ‡ä»¤åœ¨å„ä¸ªäº‹åŠ¡ä¸­å‡ºç°çš„é¡ºåºã€‚ä¾‹å¦‚ï¼Œåœ¨ä»»ä½•ä¸€ä¸ªæœ‰æ•ˆçš„è°ƒåº¦ä¸­ï¼Œäº‹åŠ¡T1ä¸­æŒ‡ä»¤write(A)å¿…é¡»åœ¨æŒ‡ä»¤read(B)ä¹‹å‰å‡ºç°ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨è°ƒåº¦ä¸­åŒ…æ‹¬äº†commitæ“ä½œæ¥è¡¨ç¤ºäº‹åŠ¡å·²ç»è¿›å…¥æäº¤çŠ¶æ€ã€‚åœ¨ä¸‹é¢çš„è®¨è®ºä¸­ï¼Œæˆ‘ä»¬å°†ç§°ç¬¬ä¸€ç§æ‰§è¡Œé¡ºåºä¸ºè°ƒåº¦1ï¼ˆT2è·Ÿåœ¨T1ä¹‹åï¼‰ï¼Œç§°ç¬¬äºŒç§æ‰§è¡Œé¡ºåºä¸ºè°ƒåº¦2ï¼ˆT1è·Ÿåœ¨T2ä¹‹åï¼‰ã€‚\n\n![image-20220724223100988](../../images/æ•°æ®åº“ç†è®º_äº‹åŠ¡/image-20220724223100988.png)\n\nè¿™ä¸¤ä¸ªè°ƒåº¦æ˜¯ä¸²è¡Œçš„(serial)ã€‚æ¯ä¸ªä¸²è¡Œè°ƒåº¦ç”±æ¥è‡ªå„äº‹åŠ¡çš„æŒ‡ä»¤åºåˆ—ç»„æˆï¼Œå…¶ä¸­å±äºåŒä¸€äº‹åŠ¡çš„æŒ‡ä»¤åœ¨è°ƒåº¦ä¸­ç´§æŒ¨åœ¨ä¸€èµ·ã€‚å›é¡¾ç»„åˆæ•°å­¦ä¸­ä¸€ä¸ªä¼—æ‰€å‘¨çŸ¥çš„é˜¶ä¹˜å…¬å¼ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äºæœ‰nä¸ªäº‹åŠ¡çš„äº‹åŠ¡ç»„ï¼Œå…±æœ‰`n!`ä¸ªä¸åŒçš„æœ‰æ•ˆä¸²è¡Œè°ƒåº¦ã€‚\n\n## Conflict graph\nConflict graph(WW, WR, RW)\n\nä¸ºç¡®å®šä¸€ä¸ªè°ƒåº¦æ˜¯å¦å†²çªå¯ä¸²è¡ŒåŒ–ï¼Œæˆ‘ä»¬è¿™é‡Œç»™å‡ºäº†ä¸€ä¸ªç®€å•æœ‰æ•ˆçš„ç­‰ä»·çš„ä¸€ä¸ªä¸²è¡Œè°ƒåº¦æ–¹æ³•ã€‚è®¾Sæ˜¯ä¸€ä¸ªè°ƒåº¦ï¼Œæˆ‘ä»¬ç”±Sæ„é€ ä¸€ä¸ªæœ‰å‘å›¾ï¼Œç§°ä¸º**ä¼˜å…ˆå›¾**(precedence graph)ã€‚è¯¥å›¾ç”±ä¸¤éƒ¨åˆ†ç»„æˆ`G=(V,E)`ï¼Œå…¶ä¸­Væ˜¯é¡¶ç‚¹é›†ï¼ŒEæ˜¯è¾¹é›†ï¼Œé¡¶ç‚¹é›†ç”±æ‰€æœ‰å‚ä¸è°ƒåº¦çš„äº‹åŠ¡ç»„æˆï¼Œè¾¹é›†ç”±æ»¡è¶³ä¸‹åˆ—ä¸‰ä¸ªæ¡ä»¶ä¹‹ä¸€çš„è¾¹`Ti -> Tj`ç»„æˆã€‚\n\n1. åœ¨Tjæ‰§è¡Œread(Q)ä¹‹å‰ï¼ŒTiæ‰§è¡Œwrite(Q)ã€‚\n2. åœ¨Tjæ‰§è¡Œwrite(Q)ä¹‹å‰ï¼ŒTiæ‰§è¡Œread(Q)ã€‚\n3. åœ¨Tjæ‰§è¡Œwrite(Q)ä¹‹å‰ï¼ŒTiæ‰§è¡Œwrite(Q)ã€‚\n\n## Isolation levels\nIsolation levels(Serializable, Snapshot Isolation, Repeatable Read, Read Committed, Read Uncommitted)\n\nå¯ä¸²è¡Œæ€§æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„æ¦‚å¿µï¼Œå› ä¸ºå½“ç¨‹åºå‘˜å¯¹äº‹åŠ¡ç¼–ç æ—¶ï¼Œå®ƒå…è®¸ç¨‹åºå‘˜å¿½ç•¥ä¸å¹¶å‘æ€§ç›¸å…³çš„é—®é¢˜ã€‚å¦‚æœäº‹åŠ¡åœ¨ç‹¬ç«‹æ‰§è¡Œæ—¶ä¿è¯æ•°æ®åº“ä¸€è‡´æ€§ï¼Œé‚£ä¹ˆå¯ä¸²è¡Œæ€§å°±èƒ½ç¡®ä¿å¹¶å‘æ‰§è¡Œæ—¶ä¹Ÿå…·æœ‰ä¸€è‡´æ€§ã€‚ç„¶è€Œï¼Œå¯¹äºæŸäº›åº”ç”¨ï¼Œä¿è¯å¯ä¸²è¡Œæ€§çš„é‚£äº›åè®®å¯èƒ½åªå…è®¸æå°çš„å¹¶å‘åº¦ã€‚\n\nåœ¨è¿™ç§æƒ…å†µä¸‹,æˆ‘ä»¬é‡‡ç”¨è¾ƒå¼±çº§åˆ«çš„ä¸€è‡´æ€§ã€‚ä¸ºäº†ä¿è¯æ•°æ®åº“çš„æ­£ç¡®æ€§ï¼Œä½¿ç”¨è¾ƒå¼±çº§åˆ«ä¸€è‡´æ€§ç»™ç¨‹åºå‘˜å¢åŠ äº†é¢å¤–è´Ÿæ‹…ã€‚\n\nSQLæ ‡å‡†ä¹Ÿå…è®¸ä¸€ä¸ªäº‹åŠ¡è¿™æ ·è§„å®šï¼šå®ƒå¯ä»¥ä»¥ä¸€ç§ä¸å…¶ä»–äº‹åŠ¡ä¸å¯ä¸²è¡ŒåŒ–çš„æ–¹å¼æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªäº‹åŠ¡å¯èƒ½åœ¨æœªæäº¤è¯»çº§åˆ«ä¸Šæ“ä½œï¼Œè¿™é‡Œå…è®¸äº‹åŠ¡è¯»å–ç”šè‡³è¿˜æœªæäº¤çš„è®°å½•ã€‚SQLä¸ºé‚£äº›ä¸è¦æ±‚ç²¾ç¡®ç»“æœçš„é•¿äº‹åŠ¡æä¾›è¿™ç§ç‰¹å¾ã€‚å¦‚æœè¿™äº›äº‹åŠ¡è¦åœ¨å¯ä¸²è¡ŒåŒ–çš„æ–¹å¼ä¸‹æ‰§è¡Œï¼Œå®ƒä»¬å°±ä¼šå¹²æ‰°å…¶ä»–äº‹åŠ¡ï¼Œé€ æˆå…¶ä»–äº‹åŠ¡æ‰§è¡Œçš„å»¶è¿Ÿã€‚\nSQLæ ‡å‡†è§„å®šçš„éš”ç¦»æ€§çº§åˆ«å¦‚ä¸‹ã€‚\n\n1. **å¯ä¸²è¡ŒåŒ–(serializable)**ï¼šé€šå¸¸ä¿è¯å¯ä¸²è¡ŒåŒ–è°ƒåº¦ã€‚ç„¶è€Œï¼Œæ­£å¦‚æˆ‘ä»¬å°†è¦è§£é‡Šçš„ï¼Œä¸€äº›æ•°æ®åº“ç³»ç»Ÿå¯¹è¯¥éš”ç¦»æ€§çº§åˆ«çš„å®ç°åœ¨æŸäº›æƒ…å†µä¸‹å…è®¸éå¯ä¸²è¡ŒåŒ–æ‰§è¡Œã€‚\n2. **å¯é‡å¤è¯»(repeatable read)**ï¼šåªå…è®¸è¯»å–å·²æäº¤æ•°æ®ï¼Œ è€Œä¸”åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸¤æ¬¡è¯»å–ä¸€ä¸ªæ•°æ®é¡¹æœŸé—´ï¼Œå…¶ä»–äº‹åŠ¡ä¸å¾—æ›´æ–°è¯¥æ•°æ®ã€‚ä½†è¯¥äº‹åŠ¡ä¸è¦æ±‚ä¸å…¶ä»–äº‹åŠ¡å¯ä¸²è¡ŒåŒ–ã€‚ä¾‹å¦‚ï¼šå½“ä¸€ä¸ªäº‹åŠ¡åœ¨æŸ¥æ‰¾æ»¡è¶³æŸäº›æ¡ä»¶çš„æ•°æ®æ—¶ï¼Œå®ƒå¯èƒ½æ‰¾åˆ°ä¸€ä¸ªå·²æäº¤äº‹åŠ¡æ’å…¥çš„ä¸€äº›æ•°æ®ï¼Œä½†å¯èƒ½æ‰¾ä¸åˆ°è¯¥äº‹åŠ¡æ’å…¥çš„å…¶ä»–æ•°æ®ã€‚\n3. **å·²æäº¤è¯»(read committed)**ï¼šåªå…è®¸è¯»å–å·²æäº¤æ•°æ®ï¼Œ ä½†ä¸è¦æ±‚å¯é‡å¤è¯»ã€‚æ¯”å¦‚ï¼Œ åœ¨äº‹åŠ¡ä¸¤æ¬¡è¯»å–ä¸€ä¸ªæ•°æ®é¡¹æœŸé—´ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡æ›´æ–°äº†è¯¥æ•°æ®å¹¶æäº¤ã€‚\n4. **æœªæäº¤è¯»(read uncommitted)**ï¼šå…è®¸è¯»å–æœªæäº¤æ•°æ®ã€‚è¿™æ˜¯SQLå…è®¸çš„æœ€ä½ä¸€è‡´æ€§çº§åˆ«ã€‚\n\nè®¸å¤šæ•°æ®åº“ç³»ç»Ÿè¿è¡Œæ—¶çš„é»˜è®¤éš”ç¦»æ€§çº§åˆ«æ˜¯å·²æäº¤è¯»ã€‚\n\n## Anomalies\nAnomalies(Dirty Write, Dirty Read, Non-repeatable Read, Phantom Read)\n\nä»¥ä¸Šæ‰€æœ‰éš”ç¦»æ€§çº§åˆ«éƒ½ä¸å…è®¸**è„å†™(dirty write)**ï¼Œå³å¦‚æœä¸€ä¸ªæ•°æ®é¡¹å·²ç»è¢«å¦å¤–ä¸€ä¸ªå°šæœªæäº¤æˆ–ä¸­æ­¢çš„äº‹åŠ¡å†™äººï¼Œåˆ™ä¸å…è®¸å¯¹è¯¥æ•°æ®é¡¹æ‰§è¡Œå†™æ“ä½œã€‚\n\næ ¹æ®è¿åå¯ä¸²è¡ŒåŒ–çš„ä¸‰ç§ç°è±¡ï¼ŒSQLæ ‡å‡†å®šä¹‰äº†ä¸åŒçš„éš”ç¦»æ€§çº§åˆ«ã€‚è¿™ä¸‰ç§ç°è±¡ç§°ä½œï¼šè¯»è„æ•°æ®ä¸å¯é‡å¤è¯»å’Œè¯»å¹»è±¡ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š\n\n1. **è¯»è„æ•°æ®(dirty read)**ã€‚äº‹åŠ¡è¯»äº†ç”±å¦ä¸€ä¸ªå°šæœªæäº¤äº‹åŠ¡æ‰€å†™çš„å€¼ã€‚\n2. **ä¸å¯é‡å¤è¯»(non-repeatable read)**ã€‚ä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¯¹åŒä¸€å¯¹è±¡è¯»äº†ä¸¤æ¬¡ï¼Œç¬¬äºŒæ¬¡å¾—åˆ°äº†ä¸åŒçš„å€¼ï¼Œå°½ç®¡åœ¨æ­¤æœŸé—´è¯¥äº‹åŠ¡å¹¶æ²¡æœ‰æ”¹å˜å…¶å€¼ã€‚\n3. **è¯»å¹»è±¡(phantom read)**ã€‚äº‹åŠ¡é‡æ–°æ‰§è¡Œè¿”å›ç»“æœä¸ºæ»¡è¶³æŸæœç´¢æ¡ä»¶çš„è¡Œé›†åˆçš„æŸ¥è¯¢ï¼Œå‘ç°æ»¡è¶³æ¡ä»¶çš„è¡Œé›†åˆå·²ç»æ”¹å˜ï¼Œè¿™æ˜¯ç”±äºå¦ä¸€ä¸ªäº‹åŠ¡æœ€è¿‘æäº¤äº†ã€‚\n\nå¾ˆæ˜¾ç„¶ä¸Šè¿°æ¯ç§ç°è±¡éƒ½ç ´åäº†äº‹åŠ¡çš„éš”ç¦»æ€§ï¼Œå› æ­¤è¿åäº†å¯ä¸²è¡ŒåŒ–ã€‚\n# ACIDåŸåˆ™\nSQL Transaction\nè¿™äº›åŸåˆ™åªæ˜¯æŒ‡å¯¼æ€§æ„è§ã€‚è€Œä¸æ˜¯å¼ºåˆ¶ã€å®é™…çš„ã€‚è¿™æ˜¯ç»™ç¨‹åºå‘˜éµå¾ªçš„ï¼Œè€Œä¸æ˜¯æ•°æ®åº“æœ¬èº«çš„èƒ½åŠ›ã€‚\n\nAtomicity ensures that all operations within the work unit are completed successfully. Otherwise, the transaction is aborted at the point of failure and all the previous\noperations are rolled back to their former state.\nè¦ä¹ˆæ˜¯æ“ä½œå®Œæ¯•çš„ï¼Œè¦ä¹ˆæ˜¯æ²¡åŠ¨è¿‡çš„ï¼ˆæ¢å¤åŸæ ·çš„ï¼‰ã€‚\n\nConsistency ensures that the database properly changes states upon a successfully committed transaction.\nåœ¨äº‹åŠ¡æäº¤åï¼Œæ•°æ®åº“è¦æœ‰åˆç†åœ°æ”¹å˜ã€‚ï¼ˆä¸­æ–‡ç¿»è¯‘ä¸ºä¸€è‡´æ€§ï¼Œæ¯”è‹±æ–‡çš„å®šä¹‰è¦ç‹­ä¹‰ï¼‰\n\nIsolation **enables** transactions to operate independently of and transparent to each other.\näº‹åŠ¡å½¼æ­¤ç‹¬ç«‹ã€é€æ˜ã€‚å³è¦è¾¾åˆ°å¯ä»¥åŒæ—¶æ‰§è¡Œï¼Œå¦‚æœæœ‰äººè¯»ï¼Œæœ‰äººå†™ï¼Œè¦è¾¾åˆ°éš”ç¦»ï¼Œå°±è¦ç”¨é”æ¥åŒæ­¥ã€‚\n\nDurability ensures that the result or effect of a committed transaction persists in case of a system failure.\nä»¥é˜²ç³»ç»Ÿå´©æºƒï¼Œæäº¤äº‹åŠ¡ä¹‹åçš„ç»“æœåº”è¯¥æŒä¹…åœ°ä¿å­˜ä¸‹æ¥ã€‚\n\n\nSQLè¯­å¥ã€å­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°ç­‰é‚£ä¹ˆæ­»æ¿çš„è¯­æ³•ï¼Œç†Ÿç»ƒäº†å°±ä¼šäº†ã€‚\nè€Œæ•°æ®åº“å¼€å‘çš„éš¾ç‚¹ï¼Œå°±åœ¨äºï¼ŒACIDåŸåˆ™è¿™4ä¸ªåŸåˆ™ä¸‹ï¼Œå¦‚ä½•åœ¨ä¸åŒçš„åº”ç”¨åœºæ™¯å»è®¾è®¡ã€å¹³è¡¡ã€‚\n# äº‹åŠ¡ SQLæ“ä½œ\n![](../../images/æ•°æ®åº“ç†è®º_äº‹åŠ¡/image-20250730195325800.png)\nå¼€å¯äº‹åŠ¡\n```mysql\nbegin;\n```\n![](../../images/æ•°æ®åº“ç†è®º_äº‹åŠ¡/image-20250730195415786.png)\nSQLæ“ä½œ\n```mysql\ninsert into score values(3, 3, 56);\n```\n![](../../images/æ•°æ®åº“ç†è®º_äº‹åŠ¡/image-20250730195502555.png)\n\n![](../../images/æ•°æ®åº“ç†è®º_äº‹åŠ¡/image-20250730195532002.png)\nå›æ»šäº‹åŠ¡æ“ä½œ\n```mysql\nrollback;\n```\n![](../../images/æ•°æ®åº“ç†è®º_äº‹åŠ¡/image-20250730195547285.png)\n![](../../images/æ•°æ®åº“ç†è®º_äº‹åŠ¡/image-20250730195620999.png)\nç»“æŸäº‹åŠ¡\n```mysql\ncommit;\n```\n\näº‹åŠ¡ä¸»è¦æ˜¯è®°å½•äº†ä¸­é—´çš„æ“ä½œæ­¥éª¤ï¼Œç›¸å½“äºå¯ä»¥doã€undoã€‚\n\näº‹åŠ¡å…¼å®¹äº†æ€§èƒ½å’Œå…³é”®çš„æ“ä½œã€‚\n\näº‹åŠ¡è¿˜èƒ½ç”Ÿæˆå­ä»»åŠ¡ï¼Œåœ¨beginä¹‹åå¯ä»¥å»ºç«‹è¿˜åŸç‚¹ï¼Œè€Œä¸æ˜¯å›æ»šå…¨éƒ¨æ“ä½œã€‚\n# äº‹åŠ¡å¹¶å‘å­˜åœ¨çš„é—®é¢˜\näº‹åŠ¡å¤„ç†ä¸ç»éš”ç¦»ï¼Œå¹¶å‘æ‰§è¡Œäº‹åŠ¡æ—¶é€šå¸¸ä¼šå‘ç”Ÿä»¥ä¸‹çš„é—®é¢˜ï¼š\n## è„è¯»ï¼ˆDirty Readï¼‰\nä¸€ä¸ªäº‹åŠ¡è¯»å–äº†å¦ä¸€ä¸ªäº‹åŠ¡æœªæäº¤çš„æ•°æ®ã€‚\nä¾‹å¦‚å½“äº‹åŠ¡Aå’Œäº‹åŠ¡Bå¹¶å‘æ‰§è¡Œæ—¶ï¼Œå½“äº‹åŠ¡Aæ›´æ–°åï¼Œäº‹åŠ¡BæŸ¥è¯¢è¯»å–åˆ°Aå°šæœªæäº¤çš„æ•°æ®ï¼Œæ­¤æ—¶äº‹åŠ¡Aå›æ»šï¼Œåˆ™äº‹åŠ¡Bè¯»åˆ°çš„æ•°æ®å°±æ˜¯æ— æ•ˆçš„è„æ•°æ®ã€‚\nï¼ˆäº‹åŠ¡Bè¯»å–äº†äº‹åŠ¡Aå°šæœªæäº¤çš„æ•°æ®ï¼‰\n\n## ä¸å¯é‡å¤è¯»ï¼ˆNonRepeatable Readï¼‰\nä¸€ä¸ªäº‹åŠ¡çš„æ“ä½œå¯¼è‡´å¦ä¸€ä¸ªäº‹åŠ¡å‰åä¸¤æ¬¡è¯»å–åˆ°ä¸åŒçš„æ•°æ®ã€‚\nä¾‹å¦‚å½“äº‹åŠ¡Aå’Œäº‹åŠ¡Bå¹¶å‘æ‰§è¡Œæ—¶ï¼Œå½“äº‹åŠ¡BæŸ¥è¯¢è¯»å–æ•°æ®åï¼Œäº‹åŠ¡Aæ›´æ”¹äº‹åŠ¡BæŸ¥è¯¢åˆ°çš„æ•°æ®ï¼Œæ­¤æ—¶äº‹åŠ¡Bå†æ¬¡å»è¯»è¯¥æ•°æ®ï¼Œå‘ç°å‰åä¸¤æ¬¡è¯»çš„æ•°æ®ä¸ä¸€æ ·ã€‚\nï¼ˆäº‹åŠ¡Bè¯»å–äº†äº‹åŠ¡Aå·²æäº¤çš„æ•°æ®ï¼‰\n\n## å¹»è¯»ï¼ˆPhantom Readï¼‰ï¼ˆè™šè¯»ï¼‰\nä¸€ä¸ªäº‹åŠ¡çš„æ“ä½œå¯¼è‡´å¦ä¸€ä¸ªäº‹åŠ¡å‰åä¸¤æ¬¡æŸ¥è¯¢çš„ç»“æœæ•°æ®é‡ä¸åŒã€‚\nä¾‹å¦‚å½“äº‹åŠ¡Aå’Œäº‹åŠ¡Bå¹¶å‘æ‰§è¡Œæ—¶ï¼Œå½“äº‹åŠ¡BæŸ¥è¯¢è¯»å–æ•°æ®åï¼Œäº‹åŠ¡Aæ–°å¢æˆ–è€…åˆ é™¤äº†ä¸€æ¡æ»¡è¶³äº‹åŠ¡BæŸ¥è¯¢æ¡ä»¶çš„è®°å½•ï¼Œæ­¤æ—¶äº‹åŠ¡Bå†å»æŸ¥è¯¢ï¼Œå‘ç°æŸ¥è¯¢åˆ°å‰ä¸€æ¬¡ä¸å­˜åœ¨çš„è®°å½•ï¼Œæˆ–è€…å‰ä¸€æ¬¡æŸ¥è¯¢çš„ä¸€äº›è®°å½•ä¸è§äº†ã€‚\nï¼ˆäº‹åŠ¡Bè¯»å–äº†äº‹åŠ¡Aæ–°å¢åŠ çš„æ•°æ®æˆ–è€…è¯»ä¸åˆ°äº‹åŠ¡Aåˆ é™¤çš„æ•°æ®ï¼‰\n# äº‹åŠ¡çš„éš”ç¦»çº§åˆ«\nMySQLæ”¯æŒçš„å››ç§éš”ç¦»çº§åˆ«æ˜¯ï¼š\n1. TRANSACTION_READ_UNCOMMITTEDã€‚æœªæäº¤è¯»ã€‚è¯´æ˜åœ¨æäº¤å‰ä¸€ä¸ªäº‹åŠ¡å¯ä»¥çœ‹åˆ°å¦ä¸€ä¸ªäº‹åŠ¡çš„å˜åŒ–ã€‚è¿™æ ·ä¼šè¯»åˆ°è„æ•°æ®ï¼Œä¸å¯é‡å¤è¯»å’Œå¹»è¯»éƒ½æ˜¯è¢«å…è®¸çš„ã€‚\n2. TRANSACTION_READ_COMMITTEDã€‚å·²æäº¤è¯»ã€‚è¯´æ˜è¯»å–æœªæäº¤çš„æ•°æ®æ˜¯ä¸å…è®¸çš„ã€‚ä¸ä¼šè¯»åˆ°è„æ•°æ®ï¼Œä½†è¿™ä¸ªçº§åˆ«ä»ç„¶å…è®¸ä¸å¯é‡å¤è¯»å’Œå¹»è¯»äº§ç”Ÿã€‚\n3. TRANSACTION_REPEATABLE_READã€‚**å¯é‡å¤è¯»**ã€‚ä¿è¯èƒ½å¤Ÿå†æ¬¡è¯»å–ç›¸åŒçš„æ•°æ®è€Œä¸ä¼šå¤±è´¥ï¼Œä½†å¹»è¯»ä»ç„¶ä¼šå‡ºç°ã€‚\n4. TRANSACTION_SERIALIZABLEã€‚ä¸²è¡ŒåŒ–ã€‚æœ€é«˜çš„äº‹åŠ¡çº§åˆ«ï¼Œé˜²æ­¢è¯»è„æ•°æ®ï¼Œé˜²æ­¢ä¸å¯é‡å¤è¯»ï¼Œé˜²æ­¢å¹»è¯»ã€‚\n\näº‹åŠ¡éš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œä¸ºé¿å…å†²çªæ‰€èŠ±è´¹çš„æ€§èƒ½ä¹Ÿå°±è¶Šå¤šã€‚\nOracleé»˜è®¤å·¥ä½œåœ¨â€œå·²æäº¤è¯»â€çº§åˆ«ã€‚\nMySQLé»˜è®¤å·¥ä½œåœ¨\"å¯é‡å¤è¯»\"çº§åˆ«ï¼Œå®é™…ä¸Šå¯ä»¥è§£å†³éƒ¨åˆ†çš„å¹»è¯»é—®é¢˜ï¼Œä½†æ˜¯ä¸èƒ½é˜²æ­¢updateæ›´æ–°äº§ç”Ÿçš„å¹»è¯»é—®é¢˜ï¼Œè¦ç¦æ­¢è™šè¯»äº§ç”Ÿï¼Œè¿˜æ˜¯éœ€è¦è®¾ç½®ä¸²è¡ŒåŒ–éš”ç¦»çº§åˆ«ã€‚\n","categories":["æ•°æ®åº“","ç†è®º"]},{"title":"Cpp_æµ…è°ˆå½¢å‚ä¸­constå’Œå¼•ç”¨çš„ä½œç”¨","url":"/Cpp/Cpp_æµ…è°ˆå½¢å‚ä¸­constå’Œå¼•ç”¨çš„ä½œç”¨/","content":"\n1ã€å¯ä»¥ç¡®å®šçš„æ˜¯ï¼Œå¦‚æœä½ æƒ³ä¿®æ”¹ä¼ å…¥çš„å¼•ç”¨å¯¹è±¡ï¼Œä¸å¯ä»¥åŠ constä¿®é¥°ã€‚ä¸ç®¡æ˜¯æŒ‡é’ˆè¿˜æ˜¯å¼•ç”¨ï¼Œå‰é¢åŠ constä¹‹åï¼Œæ¯”å¦‚`const A *`æˆ–`const A &`ï¼Œéƒ½ä¼šå¯¼è‡´Aåªå¯è¯»ã€åªèƒ½è°ƒç”¨å…¶å¸¸æ–¹æ³•ï¼Œå¸¸æ–¹æ³•ä¸€èˆ¬ä¸å¯ä»¥ä¿®æ”¹å…¶æˆå‘˜å±æ€§ã€‚\nå› æ­¤ï¼Œé’ˆå¯¹äºã€Šæµç±»å¯¹è±¡ã€‹ï¼Œ99%çš„æƒ…å†µä¸‹ä¸åŠ constã€‚\n2ã€constçš„ç›®çš„åœ¨äºä¸¤æ–¹é¢ï¼Œå­—é¢æ„æ€æ˜¯ä¿®é¥°å…¶ä¸å¯ä¿®æ”¹ï¼Œè¿˜æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„ç›®çš„åœ¨äºä½¿å¯æ¥æ”¶çš„å¯¹è±¡å±æ€§èŒƒå›´æ›´å¤§ã€‚å¦‚æœå½¢å‚å®šä¹‰ä¸ºconstå±æ€§ï¼Œæ—¢å¯æ¥æ”¶â€œéconstå¯¹è±¡â€ï¼Œä¹Ÿå¯æ¥æ”¶â€œconstå¯¹è±¡â€ã€‚æ‰€ä»¥ï¼Œå¦‚æœåœ¨å‡½æ•°ä¸­ä¸æ¶‰åŠåˆ°å¯¹ä¼ å…¥çš„å¯¹è±¡è¿›è¡Œä¿®æ”¹æ—¶ï¼Œéƒ½å°½é‡åŠ constã€‚\næ¯”å¦‚ï¼Œå½¢å‚æ˜¯`const string str`ã€‚å¦‚æœå¤–éƒ¨ä¼ å…¥çš„æ˜¯å­—ç¬¦ä¸²å¸¸é‡`\"aaa\"`ï¼Œç…§å¸¸æ¥æ”¶ï¼Œå¦‚æœå½¢å‚æ˜¯`string str`ï¼Œæ— æ³•æ¥æ”¶ï¼Œå®å‚çš„é€šç”¨æ€§æ”¶åˆ°é™åˆ¶ã€‚\n3ã€æ¥ä¸‹æ¥å°±æ˜¯å¯Œå«äº‰è®®çš„å¼•ç”¨ä¿®é¥°äº†ã€‚\nåœ¨C++ä¸­ï¼Œè¯­ä¹‰ä¸Šï¼Œå¼•ç”¨æ˜¯ä¸€ä¸ªå˜é‡çš„åˆ«åï¼›è°ƒç”¨æ•ˆæœä¸Šï¼Œå¦‚æœæ˜¯æŒ‰å¼•ç”¨ä¼ é€’ï¼Œåˆ™è¢«è°ƒç”¨è€…å’Œè°ƒç”¨è€…æ“ä½œçš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚\nåœ¨è¯­æ³•ä¸Šï¼ŒC++çš„æ™®é€šå¼•ç”¨æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªâ€œæŒ‡é’ˆæŒ‡å‘çš„åœ°å€ä¿¡æ¯ä¸å¯å˜ï¼Œè€ŒæŒ‡å‘çš„å†…å®¹å¯å˜â€ã€‚\n\n```cpp\nTypename t;\n\t\t Typename & p = t;\n    <==> Typename * const p = &t;\n```\n\nåœ¨ç¨‹åºä¸­ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å¤„ç†å¯¹å…¶è¿›è¡Œè§£å¼•ç”¨ã€‚\n\nç”¨åœ¨å‚æ•°ä¼ é€’ä¸­ï¼Œå¦‚æœè¦ä¿®æ”¹å¯¹è±¡ï¼Œå¯è§†ä¸ºè¯­æ³•ç³–ï¼Œéšå«äº†æŒ‡é’ˆçš„è§£å¼•ç”¨æ“ä½œã€‚\nå¦‚æœç”¨åœ¨å‚æ•°ä¼ é€’ä¸­ï¼Œå´ä¸æ¶‰åŠåˆ°ä¿®æ”¹å¯¹è±¡ï¼Œå¼•ç”¨æœ‰æ—¶å¯è§†ä¸ºå¯¹æ€§èƒ½çš„ä¼˜åŒ–ï¼Œæœ‰æ—¶å¯ä»¥é¿å…å¯¹è±¡åœ¨ä¼ é€’è¿‡ç¨‹ä¸­äº§ç”Ÿä¸å¿…è¦çš„ä¸´æ—¶å¯¹è±¡æ‹·è´ã€ææ„ã€‚ä½†æ˜¯ï¼Œåœ¨å®é™…ç”Ÿäº§é¡¹ç›®ä¸­ï¼Œæ­¤ä¸¾å°šéœ€è¦è®ºè¯å…¶å¿…è¦æ€§ã€‚å› ä¸ºæœ‰æ—¶å³ä½¿ä½ æ˜¯æŒ‰å¼•ç”¨ä¼ é€’çš„ï¼Œä½†æ˜¯é¿å…ä¸äº†ä¼šå‡ºç°éšå¼æ„é€ ä¸´æ—¶å¯¹è±¡ã€‚æ¯”å¦‚å­—ç¬¦ä¸²å¸¸é‡\"aaa\"ä¼ ç»™ä¸€ä¸ªconst string & strã€‚\n\nè¦æ³¨æ„çš„æ˜¯ï¼Œä¼ é€’å¼•ç”¨æ˜¯æœ‰é£é™©çš„ï¼Œç¨‹åºå‘˜å¿…é¡»æ˜ç¡®å¯¹è±¡åœ¨ç¨‹åºä¸­å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸï¼Œéœ€è¦ä¿è¯è¢«å¼•ç”¨çš„å¯¹è±¡çš„ç”Ÿå‘½æœŸè¦é•¿äºå‡½æ•°çš„è°ƒç”¨ç‚¹ã€‚è¦æ˜ç¡®å¯¹è±¡åœ¨å †æ ˆä¸Šçš„äº§ç”Ÿæ—¶æœºã€ææ„æ—¶æœºï¼Œæ‰èƒ½å®‰å…¨åœ°ä¼ é€’å¼•ç”¨ã€‚\n\nå¦‚æœä»ä»£ç è§„èŒƒä¸Šè§’åº¦æ¥è€ƒè™‘ï¼Œå°½é‡å‘å®‰å…¨ã€ç»Ÿä¸€çš„å½¢å¼é æ‹¢ï¼Œå³ç»Ÿä¸€çš„æŒ‰å€¼ä¼ é€’ã€‚è¿™ä¹Ÿæ˜¯Javaè§„èŒƒæŒ‰å€¼ä¼ é€’çš„ä¸€å¤§ä¼˜åŠ¿ï¼Œé¿å…äº†C++ç¨‹åºè®¾è®¡çš„å¤æ‚æ€§ï¼Œä½†æ˜¯æŸæ—¶ä¼šæœ‰ä¸€å®šçš„æ€§èƒ½æŸè€—ã€‚\n\næ€»ä¹‹ï¼Œå‡½æ•°æ¥æ”¶å‚æ•°çš„ç±»å‹è®¾è®¡æ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€çš„æ–¹æ³•è®ºï¼Œè¦è®¾è®¡å‡ºä¸€ä¸ªä¼˜ç§€çš„ä»£ç ç¨‹åºï¼Œä½ å¿…é¡»æ¸…æ¥šä½ æ•´ä¸ªç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸåŠå…¶æ‰€å­˜åœ¨çš„é£é™©ï¼Œè¦æ—¶åˆ»ææ¸…æ¥šä½ çš„ä»£ç ä¸­ä¼ å‚çš„ç›®çš„æ˜¯ä»€ä¹ˆã€‚æœ€ååœ¨æ­¤åŸºç¡€ä¸Šï¼Œåœ¨ä»£ç è§„èŒƒå’Œæ€§èƒ½è°ƒä¼˜ä¸Šåšå‡ºå¹³è¡¡ã€‚","categories":["Cpp"]},{"title":"Android_Activity","url":"/Android/Android_Activity/","content":"\n# ç®€ä»‹\n\n`Activity`ç±»æ˜¯Androidåº”ç”¨çš„å…³é”®ç»„ä»¶ï¼Œè€ŒActivityçš„å¯åŠ¨å’Œç»„åˆæ–¹å¼åˆ™æ˜¯è¯¥å¹³å°åº”ç”¨æ¨¡å‹çš„åŸºæœ¬ç»„æˆéƒ¨åˆ†ã€‚åœ¨ç¼–ç¨‹èŒƒå¼ä¸­ï¼Œåº”ç”¨æ˜¯é€šè¿‡`main()`æ–¹æ³•å¯åŠ¨çš„ï¼Œè€ŒAndroidç³»ç»Ÿä¸æ­¤ä¸åŒï¼Œå®ƒä¼šè°ƒç”¨ä¸å…¶ç”Ÿå‘½å‘¨æœŸç‰¹å®šé˜¶æ®µç›¸å¯¹åº”çš„ç‰¹å®šå›è°ƒæ–¹æ³•æ¥å¯åŠ¨`Activity`å®ä¾‹ä¸­çš„ä»£ç ã€‚\n\n# Activityçš„æ¦‚å¿µ\n\nç§»åŠ¨åº”ç”¨ä½“éªŒä¸æ¡Œé¢ä½“éªŒä¸åŒä¹‹å¤„åœ¨äºï¼Œç”¨æˆ·ä¸åº”ç”¨çš„äº’åŠ¨å¹¶ä¸æ€»æ˜¯åœ¨åŒä¸€ä½ç½®å¼€å§‹ï¼Œè€Œæ˜¯ç»å¸¸ä»¥ä¸ç¡®å®šçš„æ–¹å¼å¼€å§‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä»ä¸»å±å¹•æ‰“å¼€ç”µå­é‚®ä»¶åº”ç”¨ï¼Œå¯èƒ½ä¼šçœ‹åˆ°ç”µå­é‚®ä»¶åˆ—è¡¨ï¼Œå¦‚æœé€šè¿‡ç¤¾äº¤åª’ä½“åº”ç”¨å¯åŠ¨ç”µå­é‚®ä»¶åº”ç”¨ï¼Œåˆ™å¯èƒ½ä¼šç›´æ¥è¿›å…¥ç”µå­é‚®ä»¶åº”ç”¨çš„é‚®ä»¶æ’°å†™ç•Œé¢ã€‚\n\n`Activity`ç±»çš„ç›®çš„å°±æ˜¯ä¿ƒè¿›è¿™ç§èŒƒå¼çš„å®ç°ã€‚å½“ä¸€ä¸ªåº”ç”¨è°ƒç”¨å¦ä¸€ä¸ªåº”ç”¨æ—¶ï¼Œè°ƒç”¨æ–¹åº”ç”¨ä¼šè°ƒç”¨å¦ä¸€ä¸ªåº”ç”¨ä¸­çš„Activityï¼Œè€Œä¸æ˜¯æ•´ä¸ªåº”ç”¨ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒActivityå……å½“äº†åº”ç”¨ä¸ç”¨æˆ·äº’åŠ¨çš„å…¥å£ç‚¹ã€‚å¯ä»¥å°†Activityå®ç°ä¸º`Activity`ç±»çš„å­ç±»ã€‚\n\nActivityæä¾›çª—å£ä¾›åº”ç”¨åœ¨å…¶ä¸­ç»˜åˆ¶ç•Œé¢ã€‚æ­¤çª—å£é€šå¸¸ä¼šå¡«æ»¡å±å¹•ï¼Œä½†ä¹Ÿå¯èƒ½æ¯”å±å¹•å°ï¼Œå¹¶æµ®åŠ¨åœ¨å…¶ä»–çª—å£ä¸Šé¢ã€‚é€šå¸¸ï¼Œä¸€ä¸ªActivityå®ç°åº”ç”¨ä¸­çš„ä¸€ä¸ªå±å¹•ã€‚ä¾‹å¦‚ï¼Œåº”ç”¨ä¸­çš„ä¸€ä¸ªActivityå®ç°â€œåå¥½è®¾ç½®â€å±å¹•ï¼Œè€Œå¦ä¸€ä¸ªActivityå®ç°â€œé€‰æ‹©ç…§ç‰‡â€å±å¹•ã€‚\n\nå¤§å¤šæ•°åº”ç”¨åŒ…å«å¤šä¸ªå±å¹•ï¼Œè¿™æ„å‘³ç€å®ƒä»¬åŒ…å«å¤šä¸ªActivityã€‚é€šå¸¸ï¼Œåº”ç”¨ä¸­çš„ä¸€ä¸ªActivityä¼šè¢«æŒ‡å®šä¸º**ä¸»Activityï¼Œè¿™æ˜¯ç”¨æˆ·å¯åŠ¨åº”ç”¨æ—¶å‡ºç°çš„ç¬¬ä¸€ä¸ªå±å¹•**ã€‚ç„¶åï¼Œ**æ¯ä¸ªActivityå¯ä»¥å¯åŠ¨å¦ä¸€ä¸ªActivityï¼Œä»¥æ‰§è¡Œä¸åŒçš„æ“ä½œ**ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç®€å•çš„ç”µå­é‚®ä»¶åº”ç”¨ä¸­çš„ä¸»Activityå¯èƒ½ä¼šæä¾›æ˜¾ç¤ºç”µå­é‚®ä»¶æ”¶ä»¶ç®±çš„å±å¹•ã€‚ä¸»Activityå¯èƒ½ä¼šä»è¯¥å±å¹•å¯åŠ¨å…¶ä»–Activityï¼Œä»¥æä¾›æ‰§è¡Œå†™é‚®ä»¶å’Œæ‰“å¼€é‚®ä»¶è¿™ç±»ä»»åŠ¡çš„å±å¹•ã€‚\n\nè™½ç„¶åº”ç”¨ä¸­çš„å„ä¸ªActivityååŒå·¥ä½œå½¢æˆå‡èšçš„ç”¨æˆ·ä½“éªŒï¼Œä½†æ¯ä¸ªActivityä¸å…¶ä»–Activityä¹‹é—´åªå­˜åœ¨æ¾æ•£çš„å…³è”ï¼Œåº”ç”¨å†…ä¸åŒActivityä¹‹é—´çš„ä¾èµ–å…³ç³»é€šå¸¸å¾ˆå°ã€‚äº‹å®ä¸Šï¼ŒActivityç»å¸¸ä¼šå¯åŠ¨å±äºå…¶ä»–åº”ç”¨çš„Activityã€‚ä¾‹å¦‚ï¼Œæµè§ˆå™¨åº”ç”¨å¯èƒ½ä¼šå¯åŠ¨ç¤¾äº¤åª’ä½“åº”ç”¨çš„â€œåˆ†äº«â€Activityã€‚\n\nè¦åœ¨åº”ç”¨ä¸­ä½¿ç”¨Activityï¼Œæ‚¨å¿…é¡»åœ¨åº”ç”¨çš„æ¸…å•ä¸­æ³¨å†Œå…³äºActivityçš„ä¿¡æ¯ï¼Œå¹¶ä¸”å¿…é¡»é€‚å½“åœ°ç®¡ç†Activityçš„ç”Ÿå‘½å‘¨æœŸã€‚\n\n# é…ç½®æ¸…å•\n\nè¦ä½¿åº”ç”¨èƒ½å¤Ÿä½¿ç”¨Activityï¼Œå¿…é¡»åœ¨æ¸…å•ä¸­å£°æ˜ActivityåŠå…¶ç‰¹å®šå±æ€§ã€‚\n\n## å£°æ˜Activity\n\nè¦å£°æ˜Activityï¼Œè¯·æ‰“å¼€æ¸…å•æ–‡ä»¶ï¼Œå¹¶æ·»åŠ `<activity>`å…ƒç´ ä½œä¸º`<application>`å…ƒç´ çš„å­å…ƒç´ ã€‚ä¾‹å¦‚ï¼š\n\n```xml\n    <manifest ... >\n      <application ... >\n          <activity android:name=\".ExampleActivity\" />\n          ...\n      </application ... >\n      ...\n    </manifest >\n```\n\næ­¤å…ƒç´ å”¯ä¸€çš„å¿…è¦å±æ€§æ˜¯`android:name`ï¼Œè¯¥å±æ€§ç”¨äºæŒ‡å®šActivityçš„ç±»åç§°ã€‚é™¤äº†nameï¼Œè¿˜å¯ä»¥æ·»åŠ ç”¨äºå®šä¹‰æ ‡ç­¾ã€å›¾æ ‡æˆ–ç•Œé¢ä¸»é¢˜ç­‰Activityç‰¹å¾çš„å±æ€§ã€‚\n\n>æ³¨æ„ï¼šå‘å¸ƒåº”ç”¨åï¼Œå°±ä¸åº”å†æ›´æ”¹ Activity åç§°ï¼Œå¦åˆ™å¯èƒ½ä¼šç ´åæŸäº›åŠŸèƒ½ï¼Œä¾‹å¦‚åº”ç”¨å¿«æ·æ–¹å¼ã€‚å¦‚éœ€è¯¦ç»†äº†è§£å‘å¸ƒååº”é¿å…çš„æ›´æ”¹ï¼Œå‚é˜…[ä¸å¯æ›´æ”¹çš„å†…å®¹](http://android-developers.blogspot.com/2011/06/things-that-cannot-change.html)ã€‚\n\n## å£°æ˜intentè¿‡æ»¤å™¨\n\nIntentè¿‡æ»¤å™¨æ˜¯Androidå¹³å°çš„ä¸€é¡¹éå¸¸å¼ºå¤§çš„åŠŸèƒ½ã€‚å€ŸåŠ©è¿™é¡¹åŠŸèƒ½ï¼Œä¸ä½†å¯ä»¥æ ¹æ®æ˜¾å¼è¯·æ±‚å¯åŠ¨Activityï¼Œè¿˜å¯ä»¥æ ¹æ®éšå¼è¯·æ±‚å¯åŠ¨Activityã€‚ä¾‹å¦‚ï¼Œæ˜¾å¼è¯·æ±‚å¯èƒ½ä¼šå‘Šè¯‰ç³»ç»Ÿâ€œåœ¨Gmailåº”ç”¨ä¸­å¯åŠ¨`å‘é€ç”µå­é‚®ä»¶Activity`â€ï¼›è€Œéšå¼è¯·æ±‚å¯èƒ½ä¼šå‘Šè¯‰ç³»ç»Ÿâ€œåœ¨ä»»ä½•èƒ½å¤Ÿå®Œæˆæ­¤å·¥ä½œçš„Activityä¸­å¯åŠ¨`å‘é€ç”µå­é‚®ä»¶å±å¹•`â€ã€‚å½“**ç³»ç»Ÿç•Œé¢è¯¢é—®ç”¨æˆ·ä½¿ç”¨å“ªä¸ªåº”ç”¨æ¥æ‰§è¡Œä»»åŠ¡**æ—¶ï¼Œè¿™å°±æ˜¯intentè¿‡æ»¤å™¨åœ¨èµ·ä½œç”¨ã€‚\n\nè¦ä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œéœ€è¦åœ¨`<activity>`å…ƒç´ ä¸­å£°æ˜`<intent-filter>`å±æ€§ã€‚æ­¤å…ƒç´ çš„å®šä¹‰åŒ…æ‹¬`<action>`å…ƒç´ ï¼Œä»¥åŠå¯é€‰çš„`<category>`å…ƒç´ å’Œ/æˆ–`<data>`å…ƒç´ ã€‚è¿™äº›å…ƒç´ ç»„åˆåœ¨ä¸€èµ·ï¼Œå¯ä»¥æŒ‡å®š`Activity`èƒ½å¤Ÿå“åº”çš„`intent`ç±»å‹ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç æ®µå±•ç¤ºäº†å¦‚ä½•é…ç½®ä¸€ä¸ªå‘é€æ–‡æœ¬æ•°æ®å¹¶æ¥æ”¶å…¶ä»–Activityçš„æ–‡æœ¬æ•°æ®å‘é€è¯·æ±‚çš„Activityï¼š\n\n```xml\n    <activity android:name=\".ExampleActivity\" android:icon=\"@drawable/app_icon\">\n        <intent-filter>\n            <action android:name=\"android.intent.action.SEND\" />\n            <category android:name=\"android.intent.category.DEFAULT\" />\n            <data android:mimeType=\"text/plain\" />\n        </intent-filter>\n    </activity>\n```\n\nåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ`<action>`å…ƒç´ æŒ‡å®šè¯¥Activityä¼šå‘é€æ•°æ®ã€‚å°†`<category>`å…ƒç´ å£°æ˜ä¸º`DEFAULT`å¯ä½¿`Activity`èƒ½å¤Ÿæ¥æ”¶å¯åŠ¨è¯·æ±‚ã€‚`<data>`å…ƒç´ æŒ‡å®šæ­¤Activityå¯ä»¥å‘é€çš„æ•°æ®ç±»å‹ã€‚ä»¥ä¸‹ä»£ç æ®µå±•ç¤ºäº†å¦‚ä½•è°ƒç”¨ä¸Šè¿°`Activity`ï¼š\n\n```java\n    // Create the text message with a string\n    Intent sendIntent = new Intent();\n    sendIntent.setAction(Intent.ACTION_SEND);\n    sendIntent.setType(\"text/plain\");\n    sendIntent.putExtra(Intent.EXTRA_TEXT, textMessage);\n    // Start the activity\n    startActivity(sendIntent);\n```\n\nå¦‚æœæ‰“ç®—æ„å»ºä¸€ä¸ªç‹¬ç«‹çš„åº”ç”¨ï¼Œä¸å…è®¸å…¶ä»–åº”ç”¨æ¿€æ´»å…¶Activityï¼Œåˆ™ä¸éœ€è¦ä»»ä½•å…¶ä»–intentè¿‡æ»¤å™¨ã€‚ä¸æƒ³è®©å…¶ä»–åº”ç”¨è®¿é—®çš„Activityä¸åº”åŒ…å«intentè¿‡æ»¤å™¨ï¼Œå¯ä»¥è‡ªå·±ä½¿ç”¨æ˜¾å¼intentå¯åŠ¨å®ƒä»¬ã€‚\n\n## å£°æ˜æƒé™\n\næ‚¨å¯ä»¥ä½¿ç”¨æ¸…å•çš„`<activity>`æ ‡è®°æ¥æ§åˆ¶å“ªäº›åº”ç”¨å¯ä»¥å¯åŠ¨æŸä¸ªActivityã€‚**çˆ¶Activityå’Œå­Activityå¿…é¡»åœ¨å…¶æ¸…å•ä¸­å…·æœ‰ç›¸åŒçš„æƒé™ï¼Œå‰è€…æ‰èƒ½å¯åŠ¨åè€…**ã€‚å¦‚æœæ‚¨ä¸ºçˆ¶Activityå£°æ˜äº†`<uses-permission>`å…ƒç´ ï¼Œåˆ™æ¯ä¸ªå­Activityéƒ½å¿…é¡»å…·æœ‰åŒ¹é…çš„`<uses-permission>`å…ƒç´ ã€‚\n\nä¾‹å¦‚ï¼Œå‡è®¾æ‚¨çš„åº”ç”¨æƒ³è¦ä½¿ç”¨ä¸€ä¸ªåä¸º`SocialApp`çš„åº”ç”¨åœ¨ç¤¾äº¤åª’ä½“ä¸Šåˆ†äº«æ–‡ç« ï¼Œåˆ™SocialAppæœ¬èº«å¿…é¡»å®šä¹‰è°ƒç”¨å®ƒçš„åº”ç”¨æ‰€éœ€å…·å¤‡çš„æƒé™ï¼š\n\n```xml\n    <manifest>\n    <activity android:name=\"....\"\n       android:permission=â€com.google.socialapp.permission.SHARE_POSTâ€\n\n    />\n```\n\nç„¶åï¼Œä¸ºäº†èƒ½å¤Ÿè°ƒç”¨SocialAppï¼Œåº”ç”¨å¿…é¡»åŒ¹é…SocialAppæ¸…å•ä¸­è®¾ç½®çš„æƒé™ï¼š\n\n```xml\n    <manifest>\n       <uses-permission android:name=\"com.google.socialapp.permission.SHARE_POST\" />\n    </manifest>\n```\n\n# Activityç”Ÿå‘½å‘¨æœŸ\n\nä¸€ä¸ªActivityåœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­ä¼šç»å†å¤šç§çŠ¶æ€ã€‚å¯ä»¥ä½¿ç”¨ä¸€ç³»åˆ—å›è°ƒæ¥å¤„ç†çŠ¶æ€ä¹‹é—´çš„è½¬æ¢ã€‚ä¸‹é¢å°†ä»‹ç»è¿™äº›å›è°ƒã€‚\n\n![Activityç”Ÿå‘½å‘¨æœŸçš„ç®€åŒ–å›¾ç¤º](https://developer.android.com/guide/components/images/activity_lifecycle.png)\n\n## è¿”å›æ ˆ\n\nAndroidä¸­çš„æ´»åŠ¨æ˜¯å¯ä»¥å±‚å çš„ã€‚æ¯å¯åŠ¨ä¸€ä¸ªæ–°çš„æ´»åŠ¨ï¼Œå°±ä¼šè¦†ç›–åœ¨åŸæ´»åŠ¨ä¹‹ä¸Šï¼Œç‚¹å‡»Backé”®ä¼šé”€æ¯æœ€ä¸Šé¢çš„æ´»åŠ¨ï¼Œä¸‹é¢çš„ä¸€ä¸ªæ´»åŠ¨å°±ä¼šé‡æ–°æ˜¾ç¤ºå‡ºæ¥ã€‚\n\nå…¶å®Androidæ˜¯ä½¿ç”¨ä»»åŠ¡ï¼ˆTaskï¼‰æ¥ç®¡ç†æ´»åŠ¨çš„ï¼Œä¸€ä¸ªä»»åŠ¡å°±æ˜¯ä¸€ç»„å­˜æ”¾åœ¨æ ˆé‡Œçš„æ´»åŠ¨çš„é›†åˆï¼Œè¿™ä¸ªæ ˆä¹Ÿè¢«ç§°ä½œè¿”å›æ ˆï¼ˆBack Stackï¼‰ã€‚æ ˆæ˜¯ä¸€ç§åè¿›å…ˆå‡ºçš„æ•°æ®ç»“æ„ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯å½“æˆ‘ä»¬å¯åŠ¨äº†ä¸€ä¸ªæ–°çš„æ´»åŠ¨ï¼Œå®ƒä¼šåœ¨è¿”å›æ ˆä¸­å…¥æ ˆï¼Œå¹¶å¤„äºæ ˆé¡¶çš„ä½ç½®ã€‚è€Œæ¯å½“æˆ‘ä»¬æŒ‰ä¸‹Backé”®æˆ–è°ƒç”¨finishæ–¹æ³•å»é”€æ¯ä¸€ä¸ªæ´»åŠ¨æ—¶ï¼Œå¤„äºæ ˆé¡¶çš„æ´»åŠ¨ä¼šå‡ºæ ˆï¼Œè¿™æ—¶å‰ä¸€ä¸ªå…¥æ ˆçš„æ´»åŠ¨å°±ä¼šé‡æ–°å¤„äºæ ˆé¡¶çš„ä½ç½®ã€‚ç³»ç»Ÿæ€»æ˜¯ä¼šæ˜¾ç¤ºå¤„äºæ ˆé¡¶çš„æ´»åŠ¨ç»™ç”¨æˆ·ã€‚\n\n## onCreate()\n\nå¿…é¡»å®ç°æ­¤å›è°ƒï¼Œå®ƒä¼šåœ¨ç³»ç»Ÿåˆ›å»ºActivityæ—¶è§¦å‘ã€‚\n\nActivityä¼šåœ¨åˆ›å»ºåè¿›å…¥â€œ**å·²åˆ›å»º**â€çŠ¶æ€ã€‚åœ¨`onCreate()`æ–¹æ³•ä¸­ï¼Œéœ€æ‰§è¡ŒåŸºæœ¬åº”ç”¨å¯åŠ¨é€»è¾‘ï¼Œè¯¥é€»è¾‘åœ¨Activityçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­åªåº”å‘ç”Ÿä¸€æ¬¡ã€‚ä¾‹å¦‚ï¼Œ`onCreate()`çš„å®ç°å¯èƒ½ä¼šå°†æ•°æ®ç»‘å®šåˆ°åˆ—è¡¨ï¼Œå°†Activityä¸ViewModelç›¸å…³è”ï¼Œå¹¶å®ä¾‹åŒ–æŸäº›ç±»ä½œç”¨åŸŸå˜é‡ã€‚æ­¤æ–¹æ³•ä¼šæ¥æ”¶`savedInstanceState`å‚æ•°ï¼Œåè€…æ˜¯åŒ…å«Activityå…ˆå‰ä¿å­˜çŠ¶æ€çš„`Bundle`å¯¹è±¡ã€‚å¦‚æœActivityæ­¤å‰æœªæ›¾å­˜åœ¨ï¼Œ`Bundle`å¯¹è±¡çš„å€¼ä¸ºnullã€‚\n\nå¦‚æœæœ‰ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥å‹ç»„ä»¶ä¸Activityç”Ÿå‘½å‘¨æœŸç›¸å…³è”ï¼Œè¯¥ç»„ä»¶å°†æ”¶åˆ°`ON_CREATE`äº‹ä»¶ã€‚ç³»ç»Ÿå°†è°ƒç”¨å¸¦æœ‰`@OnLifecycleEvent`æ³¨é‡Šçš„æ–¹æ³•ï¼Œä»¥ä½¿ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥å‹ç»„ä»¶å¯ä»¥æ‰§è¡Œå·²åˆ›å»ºçŠ¶æ€æ‰€éœ€çš„ä»»ä½•è®¾ç½®ä»£ç ã€‚\n\nåº”è¯¥åˆå§‹åŒ–Activityçš„åŸºæœ¬ç»„ä»¶ï¼šä¾‹å¦‚ï¼Œåº”ç”¨åº”è¯¥åœ¨æ­¤å¤„åˆ›å»ºè§†å›¾å¹¶å°†æ•°æ®ç»‘å®šåˆ°åˆ—è¡¨ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œå¿…é¡»åœ¨æ­¤å¤„è°ƒç”¨`setContentView()`æ¥å®šä¹‰Activityç•Œé¢çš„å¸ƒå±€ã€‚\n\n`onCreate()`æ–¹æ³•çš„ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºæ‰§è¡ŒActivityæŸäº›åŸºæœ¬è®¾ç½®çš„ä¸€äº›ä»£ç ï¼Œä¾‹å¦‚å£°æ˜ç•Œé¢ï¼ˆåœ¨XMLå¸ƒå±€æ–‡ä»¶ä¸­å®šä¹‰ï¼‰ã€å®šä¹‰æˆå‘˜å˜é‡ï¼Œä»¥åŠé…ç½®æŸäº›ç•Œé¢ã€‚åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œç³»ç»Ÿé€šè¿‡å°†æ–‡ä»¶çš„èµ„æºID`R.layout.main_activity`ä¼ é€’ç»™`setContentView()`æ¥æŒ‡å®šXMLå¸ƒå±€æ–‡ä»¶ã€‚\n\n```java\nTextView textView;\n// some transient state for the activity instance\nString gameState;\n@Override\npublic void onCreate(Bundle savedInstanceState) {\n    // call the super class onCreate to complete the creation of activity like\n    // the view hierarchy\n    super.onCreate(savedInstanceState);\n    // recovering the instance state\n    if (savedInstanceState != null) {\n        gameState = savedInstanceState.getString(GAME_STATE_KEY);\n    }\n    // set the user interface layout for this activity\n    // the layout file is defined in the project res/layout/main_activity.xml file\n    setContentView(R.layout.main_activity);\n    // initialize member TextView so we can manipulate it later\n    textView = (TextView) findViewById(R.id.text_view);\n}\n// This callback is called only when there is a saved instance that is previously saved by using\n// onSaveInstanceState(). We restore some state in onCreate(), while we can optionally restore\n// other state here, possibly usable after onStart() has completed.\n// The savedInstanceState Bundle is same as the one used in onCreate().\n@Override\npublic void onRestoreInstanceState(Bundle savedInstanceState) {\n    textView.setText(savedInstanceState.getString(TEXT_VIEW_KEY));\n}\n// invoked when the activity may be temporarily destroyed, save the instance state here\n@Override\npublic void onSaveInstanceState(Bundle outState) {\n    outState.putString(GAME_STATE_KEY, gameState);\n    outState.putString(TEXT_VIEW_KEY, textView.getText());\n    // call superclass to save any view hierarchy\n    super.onSaveInstanceState(outState);\n}\n```\n\né™¤äº†å®šä¹‰XMLæ–‡ä»¶ï¼Œç„¶åå°†å…¶ä¼ é€’ç»™`setContentView()`ï¼Œè¿˜å¯ä»¥åœ¨Activityä»£ç ä¸­æ–°å»ºViewå¯¹è±¡ï¼Œå¹¶å°†æ–°å»ºçš„Viewæ’å…¥åˆ°`ViewGroup`ä¸­ï¼Œä»¥æ„å»ºè§†å›¾å±‚æ¬¡ç»“æ„ã€‚ç„¶åï¼Œå°†æ ¹`ViewGroup`ä¼ é€’ç»™`setContentView()`ä»¥ä½¿ç”¨è¯¥å¸ƒå±€ã€‚\n\nActivityå¹¶æœªå¤„äºâ€œå·²åˆ›å»ºâ€çŠ¶æ€ã€‚`onCreate()`æ–¹æ³•å®Œæˆæ‰§è¡Œåï¼ŒActivityè¿›å…¥â€œ**å·²å¼€å§‹**â€çŠ¶æ€ï¼Œç³»ç»Ÿä¼šç›¸ç»§è°ƒç”¨`onStart()`å’Œ`onResume()`æ–¹æ³•ã€‚\n\n`onCreate()`å®Œæˆåï¼Œä¸‹ä¸€ä¸ªå›è°ƒå°†æ˜¯`onStart()`ã€‚\n\n## onStart()\n\n`onCreate()`é€€å‡ºåï¼ŒActivityå°†è¿›å…¥â€œ**å·²å¼€å§‹**â€çŠ¶æ€ï¼ˆStarted stateï¼‰ï¼Œå¹¶å¯¹ç”¨æˆ·å¯è§ã€‚æ­¤å›è°ƒåŒ…å«**Activityè¿›å…¥å‰å°ä¸ç”¨æˆ·è¿›è¡Œäº’åŠ¨ä¹‹å‰çš„æœ€åå‡†å¤‡å·¥ä½œ**ã€‚\n\nå½“Activityè¿›å…¥â€œ**å·²å¼€å§‹**â€çŠ¶æ€æ—¶ï¼Œç³»ç»Ÿä¼šè°ƒç”¨æ­¤å›è°ƒã€‚`onStart()`è°ƒç”¨ä½¿Activityå¯¹ç”¨æˆ·å¯è§ï¼Œå› ä¸ºåº”ç”¨ä¼šä¸ºActivityè¿›å…¥å‰å°å¹¶æ”¯æŒäº’åŠ¨åšå‡†å¤‡ã€‚ä¾‹å¦‚ï¼Œåº”ç”¨é€šè¿‡æ­¤æ–¹æ³•æ¥åˆå§‹åŒ–ä¿æŒç•Œé¢çš„ä»£ç ã€‚ï¼ˆinitializes the code that maintains the UI.ï¼‰\n\nå½“Activityè¿›å…¥å·²å¼€å§‹çŠ¶æ€æ—¶ï¼Œä¸Activityç”Ÿå‘½å‘¨æœŸç›¸å…³è”çš„æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥å‹ç»„ä»¶éƒ½å°†æ”¶åˆ°`ON_START`äº‹ä»¶ã€‚\n\n`onStart()`æ–¹æ³•ä¼šéå¸¸å¿«é€Ÿåœ°å®Œæˆã€‚ä¸€æ—¦æ­¤å›è°ƒç»“æŸï¼ŒActivityä¾¿ä¼šè¿›å…¥â€œ**å·²æ¢å¤**â€çŠ¶æ€ï¼ˆResumed stateï¼‰ï¼Œç³»ç»Ÿå°†è°ƒç”¨`onResume()`æ–¹æ³•ã€‚\n\n## onResume()\n\nç³»ç»Ÿä¼šåœ¨Activityå¼€å§‹ä¸ç”¨æˆ·äº’åŠ¨ä¹‹å‰è°ƒç”¨æ­¤å›è°ƒã€‚æ­¤æ—¶ï¼Œè¯¥Activityä½äºActivityå †æ ˆçš„é¡¶éƒ¨ï¼Œå¹¶ä¼š**æ•è·æ‰€æœ‰ç”¨æˆ·è¾“å…¥**ã€‚åº”ç”¨çš„å¤§éƒ¨åˆ†æ ¸å¿ƒåŠŸèƒ½éƒ½æ˜¯åœ¨`onResume()`æ–¹æ³•ä¸­å®ç°çš„ã€‚\n\n`onResume()`å›è°ƒåé¢æ€»æ˜¯è·Ÿç€`onPause()`å›è°ƒã€‚\n\nActivityä¼šåœ¨è¿›å…¥â€œå·²æ¢å¤â€çŠ¶æ€æ—¶æ¥åˆ°å‰å°ï¼Œç„¶åç³»ç»Ÿè°ƒç”¨`onResume()`å›è°ƒã€‚è¿™æ˜¯åº”ç”¨ä¸ç”¨æˆ·äº’åŠ¨çš„çŠ¶æ€ã€‚åº”ç”¨ä¼šä¸€ç›´ä¿æŒè¿™ç§çŠ¶æ€ï¼Œç›´åˆ°æŸäº›äº‹ä»¶å¯¼è‡´ç„¦ç‚¹è¿œç¦»åº”ç”¨ï¼Œæ­¤ç±»äº‹ä»¶åŒ…æ‹¬æ¥åˆ°æ¥ç”µã€ç”¨æˆ·å¯¼èˆªåˆ°å¦ä¸€ä¸ªActivityï¼Œæˆ–è®¾å¤‡å±å¹•å…³é—­ã€‚\n\nå½“Activityè¿›å…¥å·²æ¢å¤çŠ¶æ€æ—¶ï¼Œä¸Activityç”Ÿå‘½å‘¨æœŸç›¸å…³è”çš„æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥å‹ç»„ä»¶éƒ½å°†æ”¶åˆ° `ON_RESUME`äº‹ä»¶ã€‚è¿™æ—¶ï¼Œç”Ÿå‘½å‘¨æœŸç»„ä»¶å¯ä»¥å¯ç”¨åœ¨ç»„ä»¶å¯è§ä¸”ä½äºå‰å°æ—¶éœ€è¦è¿è¡Œçš„ä»»ä½•åŠŸèƒ½ï¼Œä¾‹å¦‚å¯åŠ¨ç›¸æœºé¢„è§ˆã€‚\n\nå½“å‘ç”Ÿä¸­æ–­äº‹ä»¶æ—¶ï¼ŒActivityè¿›å…¥â€œ**å·²æš‚åœ**â€çŠ¶æ€ï¼Œç³»ç»Ÿè°ƒç”¨`onPause()`å›è°ƒã€‚\n\nå¦‚æœActivityä»â€œå·²æš‚åœâ€çŠ¶æ€è¿”å›â€œå·²æ¢å¤â€çŠ¶æ€ï¼Œç³»ç»Ÿå°†å†æ¬¡è°ƒç”¨`onResume()`æ–¹æ³•ã€‚å› æ­¤ï¼Œ`onResume()`è´Ÿè´£åˆå§‹åŒ–åœ¨`onPause()`æœŸé—´é‡Šæ”¾çš„ç»„ä»¶ï¼Œå¹¶æ‰§è¡Œæ¯æ¬¡Activityè¿›å…¥â€œå·²æ¢å¤â€çŠ¶æ€æ—¶å¿…é¡»å®Œæˆçš„ä»»ä½•å…¶ä»–åˆå§‹åŒ–æ“ä½œã€‚\n\nä»¥ä¸‹æ˜¯ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥å‹ç»„ä»¶çš„ç¤ºä¾‹ï¼Œè¯¥ç»„ä»¶åœ¨æ”¶åˆ°`ON_RESUME`äº‹ä»¶æ—¶è®¿é—®ç›¸æœºï¼š\n\n```java\npublic class CameraComponent implements LifecycleObserver {\n    ...\n    @OnLifecycleEvent(Lifecycle.Event.ON_RESUME)\n    public void initializeCamera() {\n        if (camera == null) {\n            getCamera();\n        }\n    }\n    ...\n}\n```\n\n`LifecycleObserver`æ”¶åˆ°`ON_RESUME`äº‹ä»¶åï¼Œä¸Šè¿°ä»£ç ä¾¿ä¼šåˆå§‹åŒ–ç›¸æœºã€‚ç„¶è€Œï¼Œåœ¨å¤šçª—å£æ¨¡å¼ä¸‹ï¼Œå³ä½¿å¤„äºâ€œå·²æš‚åœâ€çŠ¶æ€ï¼ŒActivityä¹Ÿå¯èƒ½å®Œå…¨å¯è§ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·å¤„äºå¤šçª—å£æ¨¡å¼ï¼Œå¹¶ç‚¹æŒ‰å¦ä¸€ä¸ªä¸åŒ…å«Activityçš„çª—å£æ—¶ï¼ŒActivityå°†è¿›å…¥â€œå·²æš‚åœâ€çŠ¶æ€ã€‚å¦‚æœå¸Œæœ›ç›¸æœºä»…åœ¨åº”ç”¨å¤„äºâ€œå·²æ¢å¤â€ï¼ˆå¯è§ä¸”åœ¨å‰å°è¿è¡Œï¼‰çŠ¶æ€æ—¶å¯ç”¨ï¼Œåº”åœ¨æ”¶åˆ°ä¸Šè¿°`ON_RESUME`äº‹ä»¶ååˆå§‹åŒ–ç›¸æœºã€‚å¦‚æœå¸Œæœ›åœ¨Activity å¤„äºâ€œå·²æš‚åœâ€çŠ¶æ€ä½†å¯è§æ—¶ï¼ˆä¾‹å¦‚åœ¨å¤šçª—å£æ¨¡å¼ä¸‹ï¼‰ä¿æŒç›¸æœºå¯ç”¨ï¼Œåº”åœ¨æ”¶åˆ°`ON_START`äº‹ä»¶ååˆå§‹åŒ–ç›¸æœºã€‚ä½†æ³¨æ„ï¼Œè‹¥è¦è®©ç›¸æœºåœ¨Activityå¤„äºâ€œå·²æš‚åœâ€çŠ¶æ€æ—¶å¯ç”¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿåœ¨å¤šçª—å£æ¨¡å¼ä¸‹æ‹’ç»å…¶ä»–å¤„äºâ€œå·²æ¢å¤â€çŠ¶æ€çš„åº”ç”¨è®¿é—®ç›¸æœºã€‚æœ‰æ—¶å¯èƒ½æœ‰å¿…è¦è®©ç›¸æœºåœ¨Activityå¤„äºâ€œå·²æš‚åœâ€çŠ¶æ€æ—¶ä¿æŒå¯ç”¨ï¼Œä½†è¿™æ ·åšå®é™…å¯èƒ½ä¼šé™ä½æ•´ä½“ç”¨æˆ·ä½“éªŒã€‚ç”Ÿå‘½å‘¨æœŸçš„å“ªä¸ªé˜¶æ®µæ›´é€‚åˆåœ¨å¤šçª—å£ç¯å¢ƒä¸‹æ§åˆ¶å…±äº«ç³»ç»Ÿèµ„æºéœ€è¦ä»”ç»†è€ƒè™‘ã€‚\n\næ— è®ºé€‰æ‹©åœ¨å“ªä¸ªæ„å»ºäº‹ä»¶ä¸­æ‰§è¡Œåˆå§‹åŒ–æ“ä½œï¼Œéƒ½åŠ¡å¿…ä½¿ç”¨ç›¸åº”çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶æ¥é‡Šæ”¾èµ„æºã€‚å¦‚æœåœ¨æ”¶åˆ°`ON_START`äº‹ä»¶ååˆå§‹åŒ–æŸäº›å†…å®¹ï¼Œéœ€åœ¨æ”¶åˆ°`ON_STOP`äº‹ä»¶åé‡Šæ”¾æˆ–ç»ˆæ­¢ç›¸åº”å†…å®¹ã€‚å¦‚æœåœ¨æ”¶åˆ°`ON_RESUME`äº‹ä»¶ååˆå§‹åŒ–æŸäº›å†…å®¹ï¼Œéœ€åœ¨æ”¶åˆ°`ON_PAUSE`äº‹ä»¶åå°†å…¶é‡Šæ”¾ã€‚\n\næ³¨æ„ï¼Œä¸Šè¿°ä»£ç æ®µå°†ç›¸æœºåˆå§‹åŒ–ä»£ç æ”¾ç½®åœ¨ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥å‹ç»„ä»¶ä¸­ã€‚å¯ä»¥ç›´æ¥å°†æ­¤ä»£ç æ”¾å…¥Activityç”Ÿå‘½å‘¨æœŸå›è°ƒï¼ˆä¾‹å¦‚`onStart()`å’Œ`onStop()`ï¼‰ï¼Œä½†ä¸å»ºè®®è¿™æ ·åšã€‚é€šè¿‡å°†æ­¤é€»è¾‘æ·»åŠ åˆ°ç‹¬ç«‹çš„ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥å‹ç»„ä»¶ä¸­ï¼Œå¯ä»¥å¯¹å¤šä¸ªActivityé‡å¤ä½¿ç”¨è¯¥ç»„ä»¶ï¼Œè€Œæ— éœ€å¤åˆ¶ä»£ç ã€‚\n\n## onPause()\n\nå½“Activityå¤±å»ç„¦ç‚¹å¹¶è¿›å…¥â€œ**å·²æš‚åœ**â€çŠ¶æ€æ—¶ï¼Œç³»ç»Ÿå°±ä¼šè°ƒç”¨`onPause()`ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·ç‚¹æŒ‰â€œ`è¿”å›`â€æˆ–â€œ`æœ€è¿‘ä½¿ç”¨çš„åº”ç”¨`â€æŒ‰é’®æ—¶ï¼Œå°±ä¼šå‡ºç°æ­¤çŠ¶æ€ã€‚å½“ç³»ç»Ÿä¸ºActivityè°ƒç”¨`onPause()`æ—¶ï¼Œä»æŠ€æœ¯ä¸Šæ¥è¯´ï¼Œè¿™æ„å‘³ç€Activityä»ç„¶éƒ¨åˆ†å¯è§ï¼Œä½†å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™è¡¨æ˜ç”¨æˆ·æ­£åœ¨ç¦»å¼€è¯¥Activityï¼Œè¯¥Activityå¾ˆå¿«å°†è¿›å…¥â€œ**å·²åœæ­¢**â€æˆ–â€œ**å·²æ¢å¤**â€çŠ¶æ€ã€‚\n\nå¦‚æœç”¨æˆ·å¸Œæœ›ç•Œé¢ç»§ç»­æ›´æ–°ï¼Œåˆ™å¤„äºâ€œ**å·²æš‚åœ**â€çŠ¶æ€çš„Activityä¹Ÿå¯ä»¥ç»§ç»­æ›´æ–°ç•Œé¢ã€‚ä¾‹å¦‚ï¼Œæ˜¾ç¤ºå¯¼èˆªåœ°å›¾å±å¹•æˆ–æ’­æ”¾åª’ä½“æ’­æ”¾å™¨çš„Activityå°±å±äºæ­¤ç±»Activityã€‚å³ä½¿æ­¤ç±»Activityå¤±å»äº†ç„¦ç‚¹ï¼Œç”¨æˆ·ä»å¸Œæœ›å…¶ç•Œé¢ç»§ç»­æ›´æ–°ã€‚\n\nä¸åº”ä½¿ç”¨`onPause()`æ¥ä¿å­˜åº”ç”¨æˆ–ç”¨æˆ·æ•°æ®ã€è¿›è¡Œç½‘ç»œå‘¼å«æˆ–æ‰§è¡Œæ•°æ®åº“äº‹åŠ¡ã€‚\n\n`onPause()`æ‰§è¡Œå®Œæ¯•åï¼Œä¸‹ä¸€ä¸ªå›è°ƒä¸º`onStop()`æˆ–`onResume()`ï¼Œå…·ä½“å–å†³äºActivityè¿›å…¥â€œ**å·²æš‚åœ**â€çŠ¶æ€åå‘ç”Ÿçš„æƒ…å†µã€‚\n\n---\n\nç³»ç»Ÿå°†æ­¤æ–¹æ³•è§†ä¸ºç”¨æˆ·å°†è¦ç¦»å¼€Activityçš„ç¬¬ä¸€ä¸ªæ ‡å¿—ï¼ˆå°½ç®¡è¿™å¹¶ä¸æ€»æ˜¯æ„å‘³ç€Activityä¼šè¢«é”€æ¯ï¼‰ï¼›æ­¤æ–¹æ³•è¡¨ç¤ºActivityä¸å†ä½äºå‰å°ï¼ˆå°½ç®¡åœ¨ç”¨æˆ·å¤„äºå¤šçª—å£æ¨¡å¼æ—¶Activityä»ç„¶å¯è§ï¼‰ã€‚ä½¿ç”¨`onPause()`æ–¹æ³•ä»¥æš‚åœæˆ–è°ƒæ•´å½“`Activity`å¤„äºâ€œå·²æš‚åœâ€çŠ¶æ€æ—¶ä¸åº”ç»§ç»­ï¼ˆæˆ–åº”æœ‰èŠ‚åˆ¶åœ°ç»§ç»­ï¼‰çš„æ“ä½œï¼Œä»¥åŠä½ å¸Œæœ›å¾ˆå¿«æ¢å¤çš„æ“ä½œã€‚Activityè¿›å…¥æ­¤çŠ¶æ€çš„åŸå› æœ‰å¾ˆå¤šã€‚ä¾‹å¦‚ï¼š\n\n- å¦‚`onResume()`éƒ¨åˆ†æ‰€è¿°ï¼ŒæŸä¸ªäº‹ä»¶ä¼šä¸­æ–­åº”ç”¨æ‰§è¡Œã€‚è¿™æ˜¯æœ€å¸¸è§çš„æƒ…å†µã€‚\n- åœ¨Android 7.0ï¼ˆAPI çº§åˆ« 24ï¼‰æˆ–æ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œæœ‰å¤šä¸ªåº”ç”¨åœ¨å¤šçª—å£æ¨¡å¼ä¸‹è¿è¡Œã€‚æ— è®ºä½•æ—¶ï¼Œéƒ½åªæœ‰ä¸€ä¸ªåº”ç”¨ï¼ˆçª—å£ï¼‰å¯ä»¥æ‹¥æœ‰ç„¦ç‚¹ï¼Œå› æ­¤ç³»ç»Ÿä¼šæš‚åœæ‰€æœ‰å…¶ä»–åº”ç”¨ã€‚\n- æœ‰æ–°çš„åŠé€æ˜Activityï¼ˆä¾‹å¦‚å¯¹è¯æ¡†ï¼‰å¤„äºå¼€å¯çŠ¶æ€ã€‚åªè¦Activityä»ç„¶éƒ¨åˆ†å¯è§ä½†å¹¶æœªå¤„äºç„¦ç‚¹ä¹‹ä¸­ï¼Œå®ƒä¾¿ä¼šä¸€ç›´æš‚åœã€‚\n\nå½“Activityè¿›å…¥å·²æš‚åœçŠ¶æ€æ—¶ï¼Œä¸Activityç”Ÿå‘½å‘¨æœŸç›¸å…³è”çš„æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥å‹ç»„ä»¶éƒ½å°†æ”¶åˆ° `ON_PAUSE`äº‹ä»¶ã€‚è¿™æ—¶ï¼Œç”Ÿå‘½å‘¨æœŸç»„ä»¶å¯ä»¥åœæ­¢åœ¨ç»„ä»¶æœªä½äºå‰å°æ—¶æ— éœ€è¿è¡Œçš„ä»»ä½•åŠŸèƒ½ï¼Œä¾‹å¦‚åœæ­¢ç›¸æœºé¢„è§ˆã€‚\n\nè¿˜å¯ä»¥ä½¿ç”¨`onPause()`æ–¹æ³•é‡Šæ”¾ç³»ç»Ÿèµ„æºã€ä¼ æ„Ÿå™¨ï¼ˆä¾‹å¦‚GPSï¼‰æ‰‹æŸ„ï¼Œæˆ–å½“Activityæš‚åœä¸”ç”¨æˆ·ä¸éœ€è¦å®ƒä»¬æ—¶ä»ç„¶å¯èƒ½å½±å“ç”µæ± ç»­èˆªæ—¶é—´çš„ä»»ä½•èµ„æºã€‚ç„¶è€Œï¼Œæ­£å¦‚ä¸Šæ–‡çš„onResume()éƒ¨åˆ†æ‰€è¿°ï¼Œå¦‚æœå¤„äºå¤šçª—å£æ¨¡å¼ï¼Œâ€œå·²æš‚åœâ€çš„Activityä»å®Œå…¨å¯è§ã€‚å› æ­¤ï¼Œåº”è¯¥è€ƒè™‘ä½¿ç”¨onStop()è€ŒéonPause()æ¥å®Œå…¨é‡Šæ”¾æˆ–è°ƒæ•´ä¸ç•Œé¢ç›¸å…³çš„èµ„æºå’Œæ“ä½œï¼Œä»¥ä¾¿æ›´å¥½åœ°æ”¯æŒå¤šçª—å£æ¨¡å¼ã€‚\n\nå“åº”`ON_PAUSE`äº‹ä»¶çš„ä»¥ä¸‹`LifecycleObserver`ç¤ºä¾‹ä¸ä¸Šè¿°`ON_RESUME`äº‹ä»¶ç¤ºä¾‹ç›¸å¯¹åº”ï¼Œä¼šé‡Šæ”¾åœ¨æ”¶åˆ°`ON_RESUME`äº‹ä»¶ååˆå§‹åŒ–çš„ç›¸æœºï¼š\n```java\npublic class JavaCameraComponent implements LifecycleObserver {\n    ...\n    @OnLifecycleEvent(Lifecycle.Event.ON_PAUSE)\n    public void releaseCamera() {\n        if (camera != null) {\n            camera.release();\n            camera = null;\n        }\n    }\n    ...\n}\n```\n\nè¯·æ³¨æ„ï¼Œä¸Šè¿°ä»£ç æ®µæ˜¯åœ¨LifecycleObserveræ”¶åˆ°`ON_PAUSE`äº‹ä»¶åé‡Šæ”¾ç›¸æœºã€‚\n\n`onPause()`çš„æ‰§è¡Œéå¸¸ç®€çŸ­ï¼Œä¸ä¸€å®šæœ‰è¶³å¤Ÿçš„æ—¶é—´æ¥æ‰§è¡Œä¿å­˜æ“ä½œã€‚å› æ­¤ï¼Œä¸åº”ä½¿ç”¨ `onPause()`æ¥ä¿å­˜åº”ç”¨æˆ–ç”¨æˆ·æ•°æ®ã€è¿›è¡Œç½‘ç»œè°ƒç”¨æˆ–æ‰§è¡Œæ•°æ®åº“äº‹åŠ¡ã€‚è€Œåº”åœ¨`onStop()`æœŸé—´æ‰§è¡Œé«˜è´Ÿè½½çš„å…³é—­æ“ä½œã€‚\n\n`onPause()`æ–¹æ³•çš„å®Œæˆ**å¹¶ä¸æ„å‘³ç€Activityç¦»å¼€â€œå·²æš‚åœâ€çŠ¶æ€ã€‚ç›¸åï¼ŒActivityä¼šä¿æŒæ­¤çŠ¶æ€**ï¼Œç›´åˆ°å…¶æ¢å¤æˆ–å˜æˆå¯¹ç”¨æˆ·å®Œå…¨ä¸å¯è§ã€‚å¦‚æœActivityæ¢å¤ï¼Œç³»ç»Ÿå°†å†æ¬¡è°ƒç”¨`onResume()`å›è°ƒã€‚å¦‚æœActivityä»â€œå·²æš‚åœâ€çŠ¶æ€è¿”å›â€œå·²æ¢å¤â€çŠ¶æ€ï¼Œç³»ç»Ÿä¼šè®©Activityå®ä¾‹ç»§ç»­é©»ç•™åœ¨å†…å­˜ä¸­ï¼Œå¹¶ä¼šåœ¨ç³»ç»Ÿè°ƒç”¨`onResume()`æ—¶é‡æ–°è°ƒç”¨è¯¥å®ä¾‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ— éœ€é‡æ–°åˆå§‹åŒ–åœ¨ä»»ä½•å›è°ƒæ–¹æ³•å¯¼è‡´Activityè¿›å…¥â€œå·²æ¢å¤â€çŠ¶æ€æœŸé—´åˆ›å»ºçš„ç»„ä»¶ã€‚å¦‚æœActivityå˜ä¸ºå®Œå…¨ä¸å¯è§ï¼Œç³»ç»Ÿä¼šè°ƒç”¨`onStop()`ã€‚\n\n## onStop()\n\nå½“Activityå¯¹ç”¨æˆ·ä¸å†å¯è§æ—¶ï¼Œç³»ç»Ÿä¼šè°ƒç”¨`onStop()`ã€‚å‡ºç°è¿™ç§æƒ…å†µçš„åŸå› å¯èƒ½æ˜¯Activityè¢«é”€æ¯ï¼Œæ–°çš„Activityå¯åŠ¨ï¼Œæˆ–è€…ç°æœ‰çš„Activityæ­£åœ¨è¿›å…¥â€œ**å·²æ¢å¤**â€çŠ¶æ€å¹¶è¦†ç›–äº†å·²åœæ­¢çš„Activityã€‚åœ¨æ‰€æœ‰è¿™äº›æƒ…å†µä¸‹ï¼Œåœæ­¢çš„Activityéƒ½å°†å®Œå…¨ä¸å†å¯è§ã€‚\n\nç³»ç»Ÿè°ƒç”¨çš„ä¸‹ä¸€ä¸ªå›è°ƒå°†æ˜¯`onRestart()`ï¼ˆå¦‚æœActivityé‡æ–°ä¸ç”¨æˆ·äº’åŠ¨ï¼‰æˆ–è€…`onDestroy()`ï¼ˆå¦‚æœActivityå½»åº•ç»ˆæ­¢ï¼‰ã€‚\n\n---\n\nå¦‚æœActivityä¸å†å¯¹ç”¨æˆ·å¯è§ï¼Œè¯´æ˜å…¶å·²è¿›å…¥â€œå·²åœæ­¢â€çŠ¶æ€ï¼Œå› æ­¤ç³»ç»Ÿå°†è°ƒç”¨`onStop()`å›è°ƒã€‚ä¾‹å¦‚ï¼Œå½“æ–°å¯åŠ¨çš„Activityè¦†ç›–æ•´ä¸ªå±å¹•æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚ç³»ç»Ÿä¹Ÿå¯èƒ½åœ¨Activityå·²ç»“æŸè¿è¡Œå¹¶å³å°†ç»ˆæ­¢æ—¶è°ƒç”¨`onStop()`ã€‚\n\nå½“Activityè¿›å…¥å·²åœæ­¢çŠ¶æ€æ—¶ï¼Œä¸Activityç”Ÿå‘½å‘¨æœŸç›¸å…³è”çš„æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥å‹ç»„ä»¶éƒ½å°†æ”¶åˆ°`ON_STOP`äº‹ä»¶ã€‚è¿™æ—¶ï¼Œç”Ÿå‘½å‘¨æœŸç»„ä»¶å¯ä»¥åœæ­¢åœ¨ç»„ä»¶æœªæ˜¾ç¤ºåœ¨å±å¹•ä¸Šæ—¶æ— éœ€è¿è¡Œçš„ä»»ä½•åŠŸèƒ½ã€‚\n\nåœ¨`onStop()`æ–¹æ³•ä¸­ï¼Œåº”ç”¨åº”é‡Šæ”¾æˆ–è°ƒæ•´åœ¨åº”ç”¨å¯¹ç”¨æˆ·ä¸å¯è§æ—¶çš„æ— ç”¨èµ„æºã€‚ä¾‹å¦‚ï¼Œåº”ç”¨å¯ä»¥æš‚åœåŠ¨ç”»æ•ˆæœï¼Œæˆ–ä»ç²¾ç¡®ä½ç½®æ›´æ–°åˆ‡æ¢åˆ°ç²—ç•¥ä½ç½®æ›´æ–°ã€‚ä½¿ç”¨`onStop()`è€Œé`onPause()`å¯ç¡®ä¿ä¸ç•Œé¢ç›¸å…³çš„å·¥ä½œç»§ç»­è¿›è¡Œï¼Œå³ä½¿ç”¨æˆ·åœ¨å¤šçª—å£æ¨¡å¼ä¸‹æŸ¥çœ‹Activityä¹Ÿèƒ½å¦‚æ­¤ã€‚\n\nåº”ä½¿ç”¨`onStop()`æ‰§è¡ŒCPUç›¸å¯¹å¯†é›†çš„å…³é—­æ“ä½œã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æ— æ³•æ‰¾åˆ°æ›´åˆé€‚çš„æ—¶æœºæ¥å°†ä¿¡æ¯ä¿å­˜åˆ°æ•°æ®åº“ï¼Œå¯ä»¥åœ¨`onStop()`æœŸé—´æ‰§è¡Œæ­¤æ“ä½œã€‚ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†`onStop()`çš„å®ç°ï¼Œå®ƒå°†è‰ç¨¿ç¬”è®°å†…å®¹ä¿å­˜åˆ°æŒä¹…æ€§å­˜å‚¨ç©ºé—´ä¸­ï¼š\n\n```java\n@Override\nprotected void onStop() {\n    // call the superclass method first\n    super.onStop();\n\n    // save the note's current draft, because the activity is stopping\n    // and we want to be sure the current note progress isn't lost.\n    ContentValues values = new ContentValues();\n    values.put(NotePad.Notes.COLUMN_NAME_NOTE, getCurrentNoteText());\n    values.put(NotePad.Notes.COLUMN_NAME_TITLE, getCurrentNoteTitle());\n\n    // do this update in background on an AsyncQueryHandler or equivalent\n    asyncQueryHandler.startUpdate (\n            mToken,  // int token to correlate calls\n            null,    // cookie, not used here\n            uri,    // The URI for the note to update.\n            values,  // The map of column names and new values to apply to them.\n            null,    // No SELECT criteria are used.\n            null     // No WHERE columns are used.\n    );\n}\n```\n\næ³¨æ„ï¼Œä¸Šè¿°ä»£ç ç¤ºä¾‹ç›´æ¥ä½¿ç”¨SQLiteã€‚ä½†åº”è¯¥æ”¹ç”¨Roomï¼Œè¿™æ˜¯ä¸€ä¸ªé€šè¿‡SQLiteæä¾›æŠ½è±¡å±‚çš„æŒä¹…æ€§åº“ã€‚\n\nå½“Activityè¿›å…¥â€œå·²åœæ­¢â€çŠ¶æ€æ—¶ï¼ŒActivityå¯¹è±¡ä¼šç»§ç»­é©»ç•™åœ¨å†…å­˜ä¸­ï¼š**è¯¥å¯¹è±¡å°†ç»´æŠ¤æ‰€æœ‰çŠ¶æ€å’Œæˆå‘˜ä¿¡æ¯ï¼Œä½†ä¸ä¼šé™„åŠ åˆ°çª—å£ç®¡ç†å™¨**ï¼ˆIt maintains all state and member information, but is not attached to the window manager.ï¼‰ã€‚Activityæ¢å¤åï¼ŒActivityä¼šé‡æ–°è°ƒç”¨è¿™äº›ä¿¡æ¯ã€‚æ— éœ€é‡æ–°åˆå§‹åŒ–åœ¨ä»»ä½•å¯¼è‡´Activityè¿›å…¥â€œå·²æ¢å¤â€çŠ¶æ€çš„å›è°ƒæ–¹æ³•ä¸­åˆ›å»ºçš„ç»„ä»¶ã€‚ç³»ç»Ÿè¿˜ä¼šè¿½è¸ªå¸ƒå±€ä¸­æ¯ä¸ªViewå¯¹è±¡çš„å½“å‰çŠ¶æ€ï¼Œæ¯”å¦‚ç”¨æˆ·åœ¨`EditText`å¾®ä»¶ä¸­è¾“å…¥æ–‡æœ¬ï¼Œç³»ç»Ÿå°†ä¿ç•™æ–‡æœ¬å†…å®¹ï¼Œå› æ­¤æ— éœ€ä¿å­˜å’Œæ¢å¤æ–‡æœ¬ã€‚\n\n> æ³¨æ„ï¼šActivityåœæ­¢åï¼Œå¦‚æœç³»ç»Ÿéœ€è¦æ¢å¤ä¸€äº›å†…å­˜ï¼Œå¯èƒ½ä¼šé”€æ¯åŒ…å«è¯¥Activityçš„è¿›ç¨‹ã€‚å³ä½¿ç³»ç»Ÿåœ¨Activityåœæ­¢åé”€æ¯ç›¸åº”è¿›ç¨‹ï¼Œç³»ç»Ÿä»ä¼šä¿ç•™`Bundle`ï¼ˆé”®å€¼å¯¹çš„blobï¼‰ä¸­Viewå¯¹è±¡çš„çŠ¶æ€ï¼Œå¹¶åœ¨ç”¨æˆ·è¿”å›Activityæ—¶æ¢å¤è¿™äº›å¯¹è±¡ã€‚è¯·å‚é˜…[ä¿å­˜å’Œæ¢å¤ Activity çŠ¶æ€](https://developer.android.com/guide/components/activities/activity-lifecycle#saras)ã€‚\n\nè¿›å…¥â€œå·²åœæ­¢â€çŠ¶æ€åï¼ŒActivityè¦ä¹ˆè¿”å›ä¸ç”¨æˆ·äº’åŠ¨ï¼Œè¦ä¹ˆç»“æŸè¿è¡Œå¹¶æ¶ˆå¤±ã€‚å¦‚æœActivityè¿”å›ï¼Œç³»ç»Ÿå°†è°ƒç”¨`onRestart()`ï¼›å¦‚æœActivityç»“æŸè¿è¡Œï¼Œç³»ç»Ÿå°†è°ƒç”¨`onDestroy()`ã€‚\n\n## onRestart()\n\nå½“å¤„äºâ€œ**å·²åœæ­¢**â€çŠ¶æ€çš„Activityå³å°†é‡å¯æ—¶ï¼Œç³»ç»Ÿå°±ä¼šè°ƒç”¨æ­¤å›è°ƒã€‚`onRestart()`ä¼šä»Activityåœæ­¢æ—¶çš„çŠ¶æ€æ¢å¤Activityã€‚\n\næ­¤å›è°ƒåé¢æ€»æ˜¯è·Ÿç€`onStart()`ã€‚\n\n## onDestroy()\n\nç³»ç»Ÿä¼šåœ¨é”€æ¯Activityä¹‹å‰è°ƒç”¨æ­¤å›è°ƒã€‚\n\næ­¤å›è°ƒæ˜¯Activityæ¥æ”¶çš„æœ€åä¸€ä¸ªå›è°ƒã€‚é€šå¸¸ï¼Œå®ç°`onDestroy()`æ˜¯ä¸ºäº†ç¡®ä¿åœ¨é”€æ¯Activityæˆ–åŒ…å«è¯¥Activityçš„è¿›ç¨‹æ—¶é‡Šæ”¾è¯¥Activityçš„æ‰€æœ‰èµ„æºã€‚\n\n---\n\né”€æ¯Activityä¹‹å‰ï¼Œç³»ç»Ÿä¼šå…ˆè°ƒç”¨`onDestroy()`ã€‚ç³»ç»Ÿè°ƒç”¨æ­¤å›è°ƒçš„åŸå› æœ‰ï¼š\n\n1. Activityå³å°†ç»“æŸï¼ˆç”±äºç”¨æˆ·å½»åº•å…³é—­Activityæˆ–ç”±äºç³»ç»Ÿä¸ºActivityè°ƒç”¨`finish()`ï¼‰ï¼Œæˆ–\n2. ç”±äºé…ç½®å˜æ›´ï¼ˆä¾‹å¦‚è®¾å¤‡æ—‹è½¬æˆ–å¤šçª—å£æ¨¡å¼ï¼‰ï¼Œç³»ç»Ÿæš‚æ—¶é”€æ¯Activityã€‚\n\nå½“Activityè¿›å…¥å·²é”€æ¯çŠ¶æ€æ—¶ï¼Œä¸Activityç”Ÿå‘½å‘¨æœŸç›¸å…³è”çš„æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥å‹ç»„ä»¶éƒ½å°†æ”¶åˆ°`ON_DESTROY`äº‹ä»¶ã€‚è¿™æ—¶ï¼Œç”Ÿå‘½å‘¨æœŸç»„ä»¶å¯ä»¥åœ¨Activityè¢«é”€æ¯ä¹‹å‰æ¸…ç†æ‰€éœ€çš„ä»»ä½•æ•°æ®ã€‚\n\nåº”ä½¿ç”¨`ViewModel`å¯¹è±¡æ¥åŒ…å«Activityçš„ç›¸å…³è§†å›¾æ•°æ®ï¼Œè€Œä¸æ˜¯åœ¨Activityä¸­åŠ å…¥é€»è¾‘æ¥ç¡®å®šActivityè¢«é”€æ¯çš„åŸå› ã€‚å¦‚æœå› é…ç½®å˜æ›´è€Œé‡æ–°åˆ›å»ºActivityï¼ŒViewModelä¸å¿…æ‰§è¡Œä»»ä½•æ“ä½œï¼Œå› ä¸ºç³»ç»Ÿå°†ä¿ç•™ViewModelå¹¶å°†å…¶æä¾›ç»™ä¸‹ä¸€ä¸ªActivityå®ä¾‹ã€‚å¦‚æœä¸é‡æ–°åˆ›å»ºActivityï¼ŒViewModelå°†è°ƒç”¨`onCleared()`æ–¹æ³•ï¼Œä»¥ä¾¿åœ¨Activityè¢«é”€æ¯å‰æ¸…é™¤æ‰€éœ€çš„ä»»ä½•æ•°æ®ã€‚\n\nå¯ä»¥ä½¿ç”¨`isFinishing()`æ–¹æ³•åŒºåˆ†è¿™ä¸¤ç§æƒ…å†µã€‚\n\nå¦‚æœActivityå³å°†ç»“æŸï¼ŒonDestroy()æ˜¯Activityæ”¶åˆ°çš„æœ€åä¸€ä¸ªç”Ÿå‘½å‘¨æœŸå›è°ƒã€‚å¦‚æœç”±äºé…ç½®å˜æ›´è€Œè°ƒç”¨onDestroy()ï¼Œç³»ç»Ÿä¼šç«‹å³æ–°å»ºActivityå®ä¾‹ï¼Œç„¶ååœ¨æ–°é…ç½®ä¸­ä¸ºæ–°å®ä¾‹è°ƒç”¨`onCreate()`ã€‚\n\n`onDestroy()`å›è°ƒåº”é‡Šæ”¾å…ˆå‰çš„å›è°ƒï¼Œä¾‹å¦‚`onStop()`å°šæœªé‡Šæ”¾çš„æ‰€æœ‰èµ„æºã€‚\n\n# ActivityçŠ¶æ€å’Œä»å†…å­˜ä¸­å¼¹å‡º(ejection)\n\nç³»ç»Ÿä¼šåœ¨éœ€è¦é‡Šæ”¾RAMæ—¶ç»ˆæ­¢è¿›ç¨‹ï¼›ç³»ç»Ÿç»ˆæ­¢ç»™å®šè¿›ç¨‹çš„å¯èƒ½æ€§å–å†³äºå½“æ—¶è¿›ç¨‹çš„çŠ¶æ€ï¼Œç„¶è€Œï¼Œ**è¿›ç¨‹çŠ¶æ€å–å†³äºåœ¨è¿›ç¨‹ä¸­è¿è¡Œçš„Activityçš„çŠ¶æ€**ã€‚è¡¨1å±•ç¤ºäº†è¿›ç¨‹çŠ¶æ€ã€ActivityçŠ¶æ€ä»¥åŠç³»ç»Ÿç»ˆæ­¢è¿›ç¨‹çš„å¯èƒ½æ€§ä¹‹é—´çš„å…³ç³»ã€‚\n\n| ç³»ç»Ÿç»ˆæ­¢è¿›ç¨‹çš„å¯èƒ½æ€§ | è¿›ç¨‹çŠ¶æ€                   | ActivityçŠ¶æ€           |\n| -------------------- | -------------------------- | ---------------------- |\n| è¾ƒå°                 | å‰å°ï¼ˆæ‹¥æœ‰æˆ–å³å°†å¾—åˆ°ç„¦ç‚¹ï¼‰ | å·²åˆ›å»ºã€å·²å¼€å§‹ã€å·²æ¢å¤ |\n| è¾ƒå¤§                 | åå°ï¼ˆå¤±å»ç„¦ç‚¹ï¼‰           | å·²æš‚åœ                 |\n| æœ€å¤§                 | åå°ï¼ˆä¸å¯è§ï¼‰ã€ç©º         | å·²åœæ­¢ã€å·²é”€æ¯         |\n\nç³»ç»Ÿæ°¸è¿œä¸ä¼šç›´æ¥ç»ˆæ­¢Activityä»¥é‡Šæ”¾å†…å­˜ï¼Œè€Œæ˜¯ä¼šç»ˆæ­¢Activityæ‰€åœ¨çš„è¿›ç¨‹ã€‚ç³»ç»Ÿä¸ä»…ä¼šé”€æ¯Activityï¼Œè¿˜ä¼šé”€æ¯åœ¨è¯¥è¿›ç¨‹ä¸­è¿è¡Œçš„æ‰€æœ‰å…¶ä»–å†…å®¹ã€‚å¦‚éœ€äº†è§£å¦‚ä½•åœ¨ç³»ç»Ÿå¯åŠ¨çš„è¿›ç¨‹è¢«ç»ˆæ­¢æ—¶ä¿ç•™å’Œæ¢å¤Activityçš„ç•Œé¢çŠ¶æ€ï¼Œå‚é˜…[ä¿å­˜å’Œæ¢å¤ActivityçŠ¶æ€](https://developer.android.com/guide/components/activities/activity-lifecycle#saras)ã€‚\n\nç”¨æˆ·è¿˜å¯ä»¥ä½¿ç”¨â€œè®¾ç½®â€ä¸‹çš„â€œåº”ç”¨ç®¡ç†å™¨â€æ¥ç»ˆæ­¢è¿›ç¨‹ï¼Œä»¥ç»ˆæ­¢ç›¸åº”çš„åº”ç”¨ã€‚\n\näº†è§£ä¸€èˆ¬è¿›ç¨‹ï¼Œå‚é˜…[è¿›ç¨‹å’Œçº¿ç¨‹](https://developer.android.com/guide/components/processes-and-threads)ã€‚å¦‚éœ€è¯¦ç»†äº†è§£è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸå¦‚ä½•ä¸å…¶ä¸­Activityçš„çŠ¶æ€ç›¸å…³è”ï¼Œå‚é˜…[è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸ](https://developer.android.com/guide/components/processes-and-threads#Lifecycle)éƒ¨åˆ†ã€‚\n\n## ä¿å­˜å’Œæ¢å¤ç¬æ—¶ç•Œé¢çŠ¶æ€\n\nç”¨æˆ·æœŸæœ›Activityçš„ç•Œé¢çŠ¶æ€åœ¨æ•´ä¸ªé…ç½®å˜æ›´ï¼ˆä¾‹å¦‚æ—‹è½¬æˆ–åˆ‡æ¢åˆ°å¤šçª—å£æ¨¡å¼ï¼‰æœŸé—´ä¿æŒä¸å˜ã€‚ä½†æ˜¯ï¼Œ**é»˜è®¤æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä¼šåœ¨å‘ç”Ÿæ­¤ç±»é…ç½®æ›´æ”¹æ—¶é”€æ¯Activityï¼Œä»è€Œæ¸…é™¤å­˜å‚¨åœ¨Activityå®ä¾‹ä¸­çš„ä»»ä½•ç•Œé¢çŠ¶æ€**ã€‚åŒæ ·ï¼Œå¦‚æœç”¨æˆ·æš‚æ—¶ä»åº”ç”¨åˆ‡æ¢åˆ°å…¶ä»–åº”ç”¨ï¼Œå¹¶åœ¨ç¨åè¿”å›åº”ç”¨ï¼Œç”¨æˆ·å¸Œæœ›ç•Œé¢çŠ¶æ€ä¿æŒä¸å˜ã€‚ä½†æ˜¯ï¼Œå½“ç”¨æˆ·ç¦»å¼€åº”ç”¨ä¸”Activityåœæ­¢æ—¶ï¼Œç³»ç»Ÿå¯èƒ½ä¼šé”€æ¯è¯¥åº”ç”¨çš„è¿›ç¨‹ã€‚\n\nå½“Activityå› ç³»ç»Ÿé™åˆ¶è€Œè¢«é”€æ¯æ—¶ï¼Œåº”ç»„åˆä½¿ç”¨`ViewModel`ã€`onSaveInstanceState()`å’Œ/æˆ–æœ¬åœ°å­˜å‚¨æ¥ä¿ç•™ç”¨æˆ·çš„ç¬æ—¶ç•Œé¢çŠ¶æ€ã€‚å¯ä»¥åœ¨è¿›ä¸€æ­¥è¯¦ç»†äº†è§£ç”¨æˆ·æœŸæœ›ä¸ç³»ç»Ÿè¡Œä¸ºï¼Œä»¥åŠå¦‚ä½•åœ¨ç³»ç»Ÿå¯åŠ¨çš„Activityå’Œè¿›ç¨‹è¢«ç»ˆæ­¢åæœ€å¤§ç¨‹åº¦åœ°ä¿ç•™å¤æ‚çš„ç•Œé¢çŠ¶æ€æ•°æ®ï¼Œå‚é˜…[ä¿å­˜ç•Œé¢çŠ¶æ€](https://developer.android.com/topic/libraries/architecture/saving-states)ã€‚\n\nä¸‹é¢æ¦‚è¿°å®ä¾‹çŠ¶æ€çš„å®šä¹‰ï¼Œä»¥åŠå¦‚ä½•å®ç°onSaveInstance()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯Activityæœ¬èº«çš„å›è°ƒã€‚å¦‚æœç•Œé¢æ•°æ®ç®€å•ä¸”è½»é‡ï¼Œä¾‹å¦‚åŸå§‹æ•°æ®ç±»å‹æˆ–ç®€å•å¯¹è±¡ï¼ˆæ¯”å¦‚Stringï¼‰ï¼Œå¯ä»¥å•ç‹¬ä½¿ç”¨onSaveInstanceState()ä½¿ç•Œé¢çŠ¶æ€åœ¨é…ç½®æ›´æ”¹å’Œç³»ç»Ÿå¯åŠ¨çš„è¿›ç¨‹è¢«ç»ˆæ­¢æ—¶ä¿æŒä¸å˜ã€‚ä½†åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåº”ä½¿ç”¨ViewModelå’ŒonSaveInstanceState()ï¼ˆå¦‚[ä¿å­˜ç•Œé¢çŠ¶æ€](https://developer.android.com/topic/libraries/architecture/saving-states)ä¸­æ‰€è¿°ï¼‰ï¼Œå› ä¸º onSaveInstanceState()ä¼šäº§ç”Ÿåºåˆ—åŒ–/ååºåˆ—åŒ–è´¹ç”¨ã€‚\n\n## å®ä¾‹çŠ¶æ€\n\nåœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒActivityä¼šå› æ­£å¸¸çš„åº”ç”¨è¡Œä¸ºè€Œè¢«é”€æ¯ï¼Œä¾‹å¦‚å½“ç”¨æˆ·æŒ‰ä¸‹è¿”å›æŒ‰é’®æˆ–Activityé€šè¿‡è°ƒç”¨`finish()`æ–¹æ³•å‘å‡ºé”€æ¯ä¿¡å·æ—¶ï¼Œæ­¤æ—¶ç³»ç»Ÿå’Œç”¨æˆ·å¯¹è¯¥Activityå®ä¾‹çš„æ¦‚å¿µå°†æ°¸è¿œæ¶ˆå¤±ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œç”¨æˆ·çš„æœŸæœ›ä¸ç³»ç»Ÿè¡Œä¸ºç›¸åŒ¹é…ï¼Œæ— éœ€å®Œæˆä»»ä½•é¢å¤–å·¥ä½œã€‚\n\nä½†æ˜¯ï¼Œå¦‚æœç³»ç»Ÿå› ç³»ç»Ÿé™åˆ¶ï¼ˆä¾‹å¦‚é…ç½®å˜æ›´æˆ–å†…å­˜å‹åŠ›ï¼‰è€Œé”€æ¯Activityï¼Œè™½ç„¶å®é™…çš„Activityå®ä¾‹ä¼šæ¶ˆå¤±ï¼Œä½†ç³»ç»Ÿä¼šè®°ä½å®ƒæ›¾ç»å­˜åœ¨è¿‡ã€‚å¦‚æœç”¨æˆ·å°è¯•å›é€€åˆ°è¯¥Activityï¼Œç³»ç»Ÿå°†**ä½¿ç”¨å·²ä¿å­˜çš„ä¸€ç»„æè¿°Activityé”€æ¯æ—¶çŠ¶æ€çš„æ•°æ®**é‡å»ºè¯¥Activityå®ä¾‹ã€‚\n\nç³»ç»Ÿç”¨äºæ¢å¤å…ˆå‰çŠ¶æ€çš„å·²ä¿å­˜æ•°æ®ç§°ä¸º**å®ä¾‹çŠ¶æ€**ï¼Œæ˜¯å­˜å‚¨åœ¨**Bundleå¯¹è±¡ä¸­çš„é”®å€¼å¯¹é›†åˆ**ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä½¿ç”¨`Bundle`å®ä¾‹çŠ¶æ€æ¥ä¿å­˜**Activityå¸ƒå±€ä¸­æ¯ä¸ªViewå¯¹è±¡çš„ç›¸å…³ä¿¡æ¯**ï¼ˆä¾‹å¦‚åœ¨`EditText`å¾®ä»¶ä¸­è¾“å…¥çš„æ–‡æœ¬å€¼ï¼‰ã€‚è¿™æ ·ï¼Œå¦‚æœActivityå®ä¾‹è¢«é”€æ¯å¹¶é‡æ–°åˆ›å»ºï¼Œå¸ƒå±€ä¾¿ä¼šæ¢å¤ä¸ºå…¶å…ˆå‰çš„çŠ¶æ€ï¼Œä¸”æ— éœ€ç¼–å†™ä»£ç ã€‚ä½†æ˜¯ï¼ŒActivityå¯èƒ½åŒ…å«ä½ æƒ³è¦æ¢å¤çš„æ›´å¤šçŠ¶æ€ä¿¡æ¯ï¼Œä¾‹å¦‚è¿½è¸ªç”¨æˆ·åœ¨Activityä¸­çš„è¿›ç¨‹çš„æˆå‘˜å˜é‡ã€‚\n\n> æ³¨æ„ï¼šä¸ºäº†ä½¿Androidç³»ç»Ÿæ¢å¤Activityä¸­è§†å›¾çš„çŠ¶æ€ï¼Œæ¯ä¸ªè§†å›¾å¿…é¡»å…·æœ‰`android:id`å±æ€§æä¾›çš„å”¯ä¸€IDã€‚\n\n`Bundle`å¯¹è±¡å¹¶ä¸é€‚åˆä¿ç•™å¤§é‡æ•°æ®ï¼Œå› ä¸ºå®ƒéœ€è¦åœ¨ä¸»çº¿ç¨‹ä¸Šè¿›è¡Œåºåˆ—åŒ–å¤„ç†å¹¶å ç”¨ç³»ç»Ÿè¿›ç¨‹å†…å­˜ã€‚å¦‚éœ€ä¿å­˜å¤§é‡æ•°æ®ï¼Œåº”ç»„åˆä½¿ç”¨æŒä¹…æ€§æœ¬åœ°å­˜å‚¨ã€`onSaveInstanceState()`æ–¹æ³•å’Œ`ViewModel`ç±»æ¥ä¿å­˜æ•°æ®ï¼Œæ­£å¦‚[ä¿å­˜ç•Œé¢çŠ¶æ€](https://developer.android.com/topic/libraries/architecture/saving-states)ä¸­æ‰€è¿°ã€‚\n\n## ä½¿ç”¨onSaveInstanceState()ä¿å­˜ç®€å•è½»é‡çš„ç•Œé¢çŠ¶æ€\n\nå½“Activityå¼€å§‹åœæ­¢æ—¶ï¼Œç³»ç»Ÿä¼šè°ƒç”¨`onSaveInstanceState()`æ–¹æ³•ï¼Œä»¥ä¾¿Activityå¯ä»¥å°†çŠ¶æ€ä¿¡æ¯ä¿å­˜åˆ°å®ä¾‹çŠ¶æ€Bundleä¸­ã€‚æ­¤æ–¹æ³•çš„é»˜è®¤å®ç°ä¿å­˜æœ‰å…³Activityè§†å›¾å±‚æ¬¡ç»“æ„çŠ¶æ€çš„ç¬æ—¶ä¿¡æ¯ï¼Œä¾‹å¦‚`EditText`å¾®ä»¶ä¸­çš„æ–‡æœ¬æˆ–`ListView`å¾®ä»¶çš„æ»šåŠ¨ä½ç½®ã€‚\n\nå¦‚éœ€ä¿å­˜Activityçš„å…¶ä»–å®ä¾‹çŠ¶æ€ä¿¡æ¯ï¼Œå¿…é¡»æ›¿æ¢`onSaveInstanceState()`ï¼Œå¹¶å°†é”®å€¼å¯¹æ·»åŠ åˆ°Activityæ„å¤–é”€æ¯æ—¶äº‹ä»¶ä¸­æ‰€ä¿å­˜çš„`Bundle`å¯¹è±¡ä¸­ã€‚æ›¿æ¢onSaveInstanceState()æ—¶ï¼Œå¦‚æœå¸Œæœ›é»˜è®¤å®ç°ä¿å­˜è§†å›¾å±‚æ¬¡ç»“æ„çš„çŠ¶æ€ï¼Œå¿…é¡»è°ƒç”¨çˆ¶ç±»å®ç°ã€‚ä¾‹å¦‚ï¼š\n\n```java\nstatic final String STATE_SCORE = \"playerScore\";\nstatic final String STATE_LEVEL = \"playerLevel\";\n// ...\n@Override\npublic void onSaveInstanceState(Bundle savedInstanceState) {\n    // Save the user's current game state\n    savedInstanceState.putInt(STATE_SCORE, currentScore);\n    savedInstanceState.putInt(STATE_LEVEL, currentLevel);\n\n    // Always call the superclass so it can save the view hierarchy state\n    super.onSaveInstanceState(savedInstanceState);\n}\n```\n\n> æ³¨æ„ï¼šå½“ç”¨æˆ·æ˜¾å¼å…³é—­Activityæ—¶ï¼Œæˆ–è€…åœ¨å…¶ä»–æƒ…å†µä¸‹è°ƒç”¨`finish()`æ—¶ï¼Œç³»ç»Ÿä¸ä¼šè°ƒç”¨onSaveInstanceState()ã€‚\n\nå¦‚éœ€ä¿å­˜æŒä¹…æ€§æ•°æ®ï¼ˆä¾‹å¦‚ç”¨æˆ·é¦–é€‰é¡¹æˆ–æ•°æ®åº“ä¸­çš„æ•°æ®ï¼‰ï¼Œåº”åœ¨Activityä½äºå‰å°æ—¶æŠ“ä½åˆé€‚æœºä¼šã€‚å¦‚æœæ²¡æœ‰è¿™æ ·çš„æ—¶æœºï¼Œåº”åœ¨æ‰§è¡Œ`onStop()`æ–¹æ³•æœŸé—´ä¿å­˜æ­¤ç±»æ•°æ®ã€‚\n\n## ä½¿ç”¨ä¿å­˜çš„å®ä¾‹çŠ¶æ€æ¢å¤Activityç•Œé¢çŠ¶æ€\n\né‡å»ºå…ˆå‰è¢«é”€æ¯çš„Activityåï¼Œå¯ä»¥ä»ç³»ç»Ÿä¼ é€’ç»™Activityçš„`Bundle`ä¸­æ¢å¤ä¿å­˜çš„å®ä¾‹çŠ¶æ€ã€‚`onCreate()`å’Œ `onRestoreInstanceState()`å›è°ƒæ–¹æ³•å‡ä¼šæ”¶åˆ°åŒ…å«å®ä¾‹çŠ¶æ€ä¿¡æ¯çš„ç›¸åŒ`Bundle`ã€‚\n\nå› ä¸ºæ— è®ºç³»ç»Ÿæ˜¯æ–°å»ºActivityå®ä¾‹è¿˜æ˜¯é‡æ–°åˆ›å»ºä¹‹å‰çš„å®ä¾‹ï¼Œéƒ½ä¼šè°ƒç”¨`onCreate()`æ–¹æ³•ï¼Œæ‰€ä»¥åœ¨å°è¯•è¯»å–ä¹‹å‰ï¼Œå¿…é¡»æ£€æŸ¥çŠ¶æ€Bundleæ˜¯å¦ä¸ºnullã€‚å¦‚æœä¸ºnullï¼Œç³»ç»Ÿå°†æ–°å»ºActivityå®ä¾‹ï¼Œè€Œä¸ä¼šæ¢å¤ä¹‹å‰é”€æ¯çš„å®ä¾‹ã€‚\n\nä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç æ®µæ˜¾ç¤ºå¦‚ä½•åœ¨`onCreate()`ä¸­æ¢å¤æŸäº›çŠ¶æ€æ•°æ®ï¼š\n\n```java\n@Override\nprotected void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState); // Always call the superclass first\n\n    // Check whether we're recreating a previously destroyed instance\n    if (savedInstanceState != null) {\n        // Restore value of members from saved state\n        currentScore = savedInstanceState.getInt(STATE_SCORE);\n        currentLevel = savedInstanceState.getInt(STATE_LEVEL);\n    } else {\n        // Probably initialize members with default values for a new instance\n    }\n    // ...\n}\n```\n\nå¯ä»¥é€‰æ‹©å®ç°ç³»ç»Ÿåœ¨`onStart()`æ–¹æ³•ä¹‹åè°ƒç”¨çš„`onRestoreInstanceState()`ï¼Œè€Œä¸æ˜¯åœ¨`onCreate()`æœŸé—´æ¢å¤çŠ¶æ€ã€‚ä»…å½“å­˜åœ¨è¦æ¢å¤çš„å·²ä¿å­˜çŠ¶æ€æ—¶ï¼Œç³»ç»Ÿæ‰ä¼šè°ƒç”¨`onRestoreInstanceState()`ï¼Œå› æ­¤æ‚¨æ— éœ€æ£€æŸ¥`Bundle`æ˜¯å¦ä¸º nullï¼š\n\n```java\npublic void onRestoreInstanceState(Bundle savedInstanceState) {\n    // Always call the superclass so it can restore the view hierarchy\n    super.onRestoreInstanceState(savedInstanceState);\n\n    // Restore state members from saved instance\n    currentScore = savedInstanceState.getInt(STATE_SCORE);\n    currentLevel = savedInstanceState.getInt(STATE_LEVEL);\n}\n```\n\n>æ³¨æ„ï¼šåº”å§‹ç»ˆè°ƒç”¨`onRestoreInstanceState()`çš„çˆ¶ç±»å®ç°ï¼Œä»¥ä¾¿é»˜è®¤å®ç°å¯ä»¥æ¢å¤è§†å›¾å±‚æ¬¡ç»“æ„çš„çŠ¶æ€ã€‚\n\n# å¤„ç†ActivityçŠ¶æ€æ›´æ”¹\n\nç”¨æˆ·è§¦å‘å’Œç³»ç»Ÿè§¦å‘çš„ä¸åŒäº‹ä»¶ä¼šå¯¼è‡´Activityä»ä¸€ä¸ªçŠ¶æ€è½¬æ¢åˆ°å¦ä¸€ä¸ªçŠ¶æ€ã€‚ä¸‹é¢ä»‹ç»å‘ç”Ÿæ­¤ç±»è½¬æ¢çš„ä¸€äº›å¸¸è§æƒ…å†µï¼Œä»¥åŠå¦‚ä½•å¤„ç†è¿™äº›è½¬æ¢ã€‚\n\næœ‰å…³ActivityçŠ¶æ€çš„è¯¦æƒ…ï¼Œå‚é˜…Activityç”Ÿå‘½å‘¨æœŸã€‚è¦äº†è§£å¦‚ä½•å€ŸåŠ©ViewModelç±»æ¥ç®¡ç†Activityç”Ÿå‘½å‘¨æœŸï¼Œå‚é˜…äº†è§£ViewModelç±»ã€‚\n\n## é…ç½®å‘ç”Ÿäº†æ›´æ”¹\n\næœ‰å¾ˆå¤šäº‹ä»¶ä¼šè§¦å‘é…ç½®æ›´æ”¹ã€‚æœ€æ˜¾è‘—çš„ä¾‹å­æˆ–è®¸æ˜¯æ¨ªå±å’Œç«–å±ä¹‹é—´çš„å±å¹•æ–¹å‘å˜åŒ–ã€‚å…¶ä»–æƒ…å†µï¼Œå¦‚è¯­è¨€æˆ–è¾“å…¥è®¾å¤‡çš„æ”¹å˜ç­‰ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´é…ç½®æ›´æ”¹ã€‚\n\nå½“é…ç½®å‘ç”Ÿæ›´æ”¹æ—¶ï¼ŒActivityä¼šè¢«é”€æ¯å¹¶é‡æ–°åˆ›å»ºã€‚åŸå§‹Activityå®ä¾‹å°†è§¦å‘`onPause()`ã€`onStop()`å’Œ`onDestroy()`å›è°ƒã€‚ç³»ç»Ÿå°†åˆ›å»ºæ–°çš„Activityå®ä¾‹ï¼Œå¹¶è§¦å‘`onCreate()`ã€`onStart()`å’Œ`onResume()`å›è°ƒã€‚\n\nç»“åˆä½¿ç”¨ViewModelsã€onSaveInstanceState()æ–¹æ³•å’Œ/æˆ–æŒä¹…æ€§æœ¬åœ°å­˜å‚¨ï¼Œå¯ä½¿Activityçš„ç•Œé¢çŠ¶æ€åœ¨é…ç½®å‘ç”Ÿæ›´æ”¹åä¿æŒä¸å˜ã€‚åœ¨å†³å®šè¿™äº›é€‰é¡¹çš„ç»„åˆæ–¹å¼æ—¶ï¼Œéœ€è¦è€ƒè™‘ç•Œé¢æ•°æ®çš„å¤æ‚ç¨‹åº¦ã€åº”ç”¨çš„ç”¨ä¾‹ä»¥åŠæ£€ç´¢é€Ÿåº¦ä¸å†…å­˜ä½¿ç”¨çš„æƒè¡¡ã€‚æœ‰å…³ä¿å­˜Activityç•Œé¢çŠ¶æ€çš„è¯¦æƒ…ï¼Œè¯·å‚é˜…[ä¿å­˜ç•Œé¢çŠ¶æ€](https://developer.android.com/topic/libraries/architecture/saving-states)ã€‚\n\n## å¤„ç†å¤šçª—å£æ¨¡å¼çš„æƒ…å†µ\n\nä¸€æ—¦åº”ç”¨è¿›å…¥å¤šçª—å£æ¨¡å¼ï¼ˆé€‚ç”¨äºAndroid 7.0ï¼ˆAPIçº§åˆ«24ï¼‰åŠæ›´é«˜çº§åˆ«ï¼‰ï¼Œç³»ç»Ÿä¼šå‘å½“å‰è¿è¡Œçš„Activityå‘é€é…ç½®æ›´æ”¹é€šçŸ¥ï¼Œä»è€Œå®Œæˆä¸Šè¿°ç”Ÿå‘½å‘¨æœŸè½¬æ¢ã€‚å¦‚æœå·²ç»å¤„äºå¤šçª—å£æ¨¡å¼çš„åº”ç”¨è°ƒæ•´äº†å¤§å°ï¼Œä¹Ÿä¼šå‡ºç°è¿™ç§è¡Œä¸ºã€‚Activityå¯ä»¥è‡ªè¡Œå¤„ç†é…ç½®æ›´æ”¹ï¼Œä¹Ÿå¯ä»¥è®©ç³»ç»Ÿé”€æ¯Activityå¹¶ä½¿ç”¨æ–°ç»´åº¦é‡æ–°åˆ›å»ºã€‚\n\næœ‰å…³å¤šçª—å£æ¨¡å¼ç”Ÿå‘½å‘¨æœŸçš„è¯¦æƒ…ï¼Œå‚é˜…[å¤šçª—å£æ¨¡å¼æ”¯æŒ](https://developer.android.com/guide/topics/ui/multi-window)é¡µçš„[å¤šçª—å£æ¨¡å¼ç”Ÿå‘½å‘¨æœŸ](https://developer.android.com/guide/topics/ui/multi-window#lifecycle)éƒ¨åˆ†ã€‚\n\nåœ¨å¤šçª—å£æ¨¡å¼ä¸‹ï¼Œè™½ç„¶ç”¨æˆ·å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªåº”ç”¨ï¼Œä½†åªæœ‰ä¸ç”¨æˆ·äº¤äº’çš„åº”ç”¨ä½äºå‰å°ä¸”å…·æœ‰ç„¦ç‚¹ã€‚è¯¥Activityå¤„äºâ€œå·²æ¢å¤â€çŠ¶æ€ï¼Œè€Œå¦ä¸€ä¸ªçª—å£ä¸­çš„åº”ç”¨åˆ™å¤„äºâ€œå·²æš‚åœâ€çŠ¶æ€ã€‚\n\nå½“ç”¨æˆ·ä»åº”ç”¨Aåˆ‡æ¢åˆ°åº”ç”¨Bæ—¶ï¼Œç³»ç»Ÿä¼šå¯¹åº”ç”¨Aè°ƒç”¨`onPause()`ï¼Œå¯¹åº”ç”¨Bè°ƒç”¨`onResume()`ã€‚æ¯å½“ç”¨æˆ·åœ¨åº”ç”¨ä¹‹é—´åˆ‡æ¢æ—¶ï¼Œç³»ç»Ÿå°±ä¼šåœ¨è¿™ä¸¤ç§æ–¹æ³•ä¹‹é—´åˆ‡æ¢ã€‚\n\næœ‰å…³å¤šçª—å£æ¨¡å¼çš„è¯¦æƒ…ï¼Œå‚é˜…[å¤šçª—å£æ¨¡å¼æ”¯æŒ](https://developer.android.com/guide/topics/ui/multi-window)ã€‚\n\n## Activityæˆ–å¯¹è¯æ¡†æ˜¾ç¤ºåœ¨å‰å°\n\nå¦‚æœæœ‰æ–°çš„Activityæˆ–å¯¹è¯æ¡†å‡ºç°åœ¨å‰å°ï¼Œå¹¶ä¸”**å±€éƒ¨è¦†ç›–**äº†æ­£åœ¨è¿›è¡Œçš„Activityï¼Œåˆ™è¢«è¦†ç›–çš„Activityä¼šå¤±å»ç„¦ç‚¹å¹¶è¿›å…¥â€œå·²æš‚åœâ€çŠ¶æ€ã€‚ç„¶åï¼Œç³»ç»Ÿä¼šè°ƒç”¨`onPause()`ã€‚\n\nå½“è¢«è¦†ç›–çš„Activityè¿”å›åˆ°å‰å°å¹¶é‡æ–°è·å¾—ç„¦ç‚¹æ—¶ï¼Œä¼šè°ƒç”¨`onResume()`ã€‚\n\nå¦‚æœæœ‰æ–°çš„Activityæˆ–å¯¹è¯æ¡†å‡ºç°åœ¨å‰å°ï¼Œå¤ºå–äº†ç„¦ç‚¹ä¸”**å®Œå…¨è¦†ç›–**äº†æ­£åœ¨è¿›è¡Œçš„Activityï¼Œåˆ™è¢«è¦†ç›–çš„Activityä¼šå¤±å»ç„¦ç‚¹å¹¶è¿›å…¥â€œå·²åœæ­¢â€çŠ¶æ€ã€‚ç„¶åï¼Œç³»ç»Ÿä¼šå¿«é€Ÿåœ°æ¥è¿è°ƒç”¨`onPause()`å’Œ`onStop()`ã€‚\n\nå½“è¢«è¦†ç›–çš„Activityçš„åŒä¸€å®ä¾‹è¿”å›åˆ°å‰å°æ—¶ï¼Œç³»ç»Ÿä¼šå¯¹è¯¥Activityè°ƒç”¨`onRestart()`ã€`onStart()`å’Œ`onResume()`ã€‚å¦‚æœè¢«è¦†ç›–çš„Activityçš„æ–°å®ä¾‹è¿›å…¥åå°ï¼Œåˆ™ç³»ç»Ÿä¸ä¼šè°ƒç”¨`onRestart()`ï¼Œè€Œåªä¼šè°ƒç”¨`onStart()`å’Œ`onResume()`ã€‚\n\n>æ³¨æ„ï¼šå½“ç”¨æˆ·ç‚¹æŒ‰â€œæ¦‚è§ˆï¼ˆOverviewï¼‰â€æˆ–ä¸»å±å¹•æŒ‰é’®æ—¶ï¼Œç³»ç»Ÿçš„è¡Œä¸ºå°±å¥½åƒå½“å‰Activityå·²è¢«å®Œå…¨è¦†ç›–ä¸€æ ·ã€‚\n\n## ç”¨æˆ·ç‚¹æŒ‰â€œè¿”å›â€æŒ‰é’®\n\nå¦‚æœActivityä½äºå‰å°ï¼Œå¹¶ä¸”ç”¨æˆ·ç‚¹æŒ‰äº†è¿”å›æŒ‰é’®ï¼ŒActivityå°†ä¾æ¬¡ç»å†`onPause()`ã€`onStop()`å’Œ`onDestroy()`å›è°ƒã€‚æ´»åŠ¨ä¸ä»…ä¼šè¢«é”€æ¯ï¼Œè¿˜ä¼šä»è¿”å›å †æ ˆä¸­ç§»é™¤ã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé»˜è®¤ä¸ä¼šè§¦å‘`onSaveInstanceState()`å›è°ƒã€‚æ­¤è¡Œä¸ºåŸºäºçš„å‡è®¾æ˜¯ï¼Œç”¨æˆ·ç‚¹æŒ‰è¿”å›æŒ‰é’®æ—¶ä¸æœŸæœ›è¿”å›Activityçš„åŒä¸€å®ä¾‹ã€‚ä¸è¿‡ï¼Œå¯ä»¥é€šè¿‡æ›¿æ¢`onBackPressed()`æ–¹æ³•å®ç°æŸç§è‡ªå®šä¹‰è¡Œä¸ºï¼Œä¾‹å¦‚â€œconfirm-quitâ€å¯¹è¯æ¡†ã€‚\n\nå¦‚æœæ›¿æ¢`onBackPressed()`æ–¹æ³•ï¼Œå¼ºçƒˆå»ºè®®ä»è¢«æ›¿æ¢çš„æ–¹æ³•è°ƒç”¨`super.onBackPressed()`ã€‚å¦åˆ™ï¼Œè¿”å›æŒ‰é’®çš„è¡Œä¸ºå¯èƒ½ä¼šè®©ç”¨æˆ·æ„Ÿè§‰çªå…€ã€‚\n\n## ç³»ç»Ÿç»ˆæ­¢åº”ç”¨è¿›ç¨‹\n\nå¦‚æœæŸä¸ªåº”ç”¨å¤„äºåå°å¹¶ä¸”ç³»ç»Ÿéœ€è¦ä¸ºå‰å°åº”ç”¨é‡Šæ”¾é¢å¤–çš„å†…å­˜ï¼Œåˆ™ç³»ç»Ÿå¯èƒ½ä¼šç»ˆæ­¢åå°åº”ç”¨ä»¥é‡Šæ”¾æ›´å¤šå†…å­˜ã€‚è¦è¯¦ç»†äº†è§£ç³»ç»Ÿå¦‚ä½•ç¡®å®šè¦é”€æ¯å“ªäº›è¿›ç¨‹ï¼Œå‚é˜…[ActivityçŠ¶æ€å’Œä»å†…å­˜ä¸­å¼¹å‡º](https://developer.android.com/guide/components/activities/activity-lifecycle#asem)ä»¥åŠ[è¿›ç¨‹å’Œåº”ç”¨ç”Ÿå‘½å‘¨æœŸ](https://developer.android.com/guide/components/activities/process-lifecycle)ã€‚\n\nè¦äº†è§£å¦‚ä½•åœ¨ç³»ç»Ÿç»ˆæ­¢åº”ç”¨è¿›ç¨‹æ—¶ä¿å­˜Activityç•Œé¢çŠ¶æ€ï¼Œè¯·å‚é˜…[ä¿å­˜å’Œæ¢å¤Activity çŠ¶æ€](https://developer.android.com/guide/components/activities/activity-lifecycle#saras)ã€‚\n\n# åœ¨Activityä¹‹é—´å¯¼èˆª\n\nåœ¨åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œåº”ç”¨å¾ˆå¯èƒ½ä¼šå¤šæ¬¡è¿›å…¥å’Œé€€å‡ºActivityã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·å¯ä»¥ç‚¹æŒ‰è®¾å¤‡çš„è¿”å›æŒ‰é’®ï¼Œæˆ–è€…Activityå¯èƒ½éœ€è¦å¯åŠ¨ä¸åŒçš„Activityã€‚æœ¬éƒ¨åˆ†ä»‹ç»å¦‚ä½•å®ç°Activityè½¬æ¢ï¼ŒåŒ…æ‹¬ä»å¦ä¸€ä¸ªActivityå¯åŠ¨Activityã€ä¿å­˜ActivityçŠ¶æ€ï¼Œä»¥åŠæ¢å¤ActivityçŠ¶æ€ã€‚\n\n## ä»ä¸€ä¸ªActivityå¯åŠ¨å¦ä¸€ä¸ªActivity\n\nActivityé€šå¸¸éœ€è¦åœ¨æŸä¸ªæ—¶åˆ»å¯åŠ¨å¦ä¸€ä¸ªActivityã€‚ä¾‹å¦‚ï¼Œå½“åº”ç”¨éœ€è¦ä»å½“å‰å±å¹•ç§»åŠ¨åˆ°æ–°å±å¹•æ—¶ï¼Œå°±ä¼šå‡ºç°è¿™ç§éœ€æ±‚ã€‚\n\næ ¹æ®Activityæ˜¯å¦å¸Œæœ›ä»å³å°†å¯åŠ¨çš„æ–°Activityä¸­è·å–è¿”å›ç»“æœï¼Œå¯ä»¥ä½¿ç”¨`startActivity()`æˆ–`startActivityForResult()`æ–¹æ³•å¯åŠ¨æ–°Activityã€‚è¿™ä¸¤ç§æ–¹æ³•éƒ½éœ€è¦ä¼ å…¥ä¸€ä¸ª`Intent`å¯¹è±¡ã€‚\n\n`Intent`å¯¹è±¡æŒ‡å®šè¦å¯åŠ¨çš„å…·ä½“Activityï¼Œæˆ–æè¿°è¦æ‰§è¡Œçš„æ“ä½œç±»å‹ï¼ˆç³»ç»Ÿé€‰æ‹©ç›¸åº”çš„Activityï¼Œè¯¥Activityç”šè‡³å¯ä»¥æ¥è‡ªä¸åŒåº”ç”¨ï¼‰ã€‚`Intent`å¯¹è±¡è¿˜å¯ä»¥æºå¸¦å·²å¯åŠ¨çš„Activityçš„å°‘é‡æ•°æ®ã€‚å¦‚éœ€è¯¦ç»†äº†è§£`Intent`ç±»ï¼Œå‚é˜…[Intent å’Œ Intent è¿‡æ»¤å™¨](https://developer.android.com/guide/components/intents-filters)ã€‚\n\n> Intentå¯¹è±¡çš„ä½œç”¨ï¼š\n>\n> 1. æŒ‡å®šè¦å¯åŠ¨çš„å…·ä½“Activity\n> 2. å¯ä»¥æºå¸¦å·²å¯åŠ¨çš„Activityçš„å°‘é‡æ•°æ®\n\n## startActivity()\n\nå¦‚æœæ–°å¯åŠ¨çš„Activityä¸éœ€è¦è¿”å›ç»“æœï¼Œå½“å‰Activityå¯ä»¥é€šè¿‡è°ƒç”¨`startActivity()`æ–¹æ³•æ¥å¯åŠ¨å®ƒã€‚\n\nåœ¨è‡ªå·±çš„åº”ç”¨æœ¬èº«ä¸­å·¥ä½œæ—¶ï¼Œé€šå¸¸åªéœ€å¯åŠ¨å·²çŸ¥Activityã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç æ®µæ˜¾ç¤ºå¦‚ä½•å¯åŠ¨ä¸€ä¸ªåä¸º`SignInActivity`çš„ Activityã€‚\n\n```java\nIntent intent = new Intent(this, SignInActivity.class);\nstartActivity(intent);\n```\n\nåº”ç”¨å¯èƒ½è¿˜å¸Œæœ›ä½¿ç”¨Activityä¸­çš„æ•°æ®æ‰§è¡ŒæŸäº›æ“ä½œï¼Œä¾‹å¦‚å‘é€ç”µå­é‚®ä»¶ã€çŸ­ä¿¡æˆ–çŠ¶æ€æ›´æ–°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåº”ç”¨è‡ªèº«å¯èƒ½ä¸å…·æœ‰æ‰§è¡Œæ­¤ç±»æ“ä½œæ‰€éœ€çš„Activityï¼Œå› æ­¤å¯ä»¥æ”¹ä¸ºåˆ©ç”¨è®¾å¤‡ä¸Šå…¶ä»–åº”ç”¨æä¾›çš„Activityæ¥æ‰§è¡Œè¿™äº›æ“ä½œï¼Œè¿™ä¾¿æ˜¯intentçš„çœŸæ­£ä»·å€¼æ‰€åœ¨ã€‚å¯ä»¥åˆ›å»ºä¸€ä¸ªintentï¼Œå¯¹æƒ³æ‰§è¡Œçš„æ“ä½œè¿›è¡Œæè¿°ï¼Œç³»ç»Ÿä¼šä»å…¶ä»–åº”ç”¨å¯åŠ¨ç›¸åº”çš„Activityã€‚å¦‚æœæœ‰å¤šä¸ªActivityå¯ä»¥å¤„ç†intentï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©è¦ä½¿ç”¨å“ªä¸€ä¸ªã€‚ä¾‹å¦‚ï¼Œå¦‚æœæƒ³å…è®¸ç”¨æˆ·å‘é€ç”µå­é‚®ä»¶ï¼Œå¯ä»¥åˆ›å»ºä»¥ä¸‹intentï¼š\n\n```java\nIntent intent = new Intent(Intent.ACTION_SEND);\nintent.putExtra(Intent.EXTRA_EMAIL, recipientArray);\nstartActivity(intent);\n```\n\næ·»åŠ åˆ°intentä¸­çš„`EXTRA_EMAIL`extraæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œå…¶ä¸­åŒ…å«ç”µå­é‚®ä»¶çš„æ”¶ä»¶äººç”µå­é‚®ä»¶åœ°å€ã€‚å½“ç”µå­é‚®ä»¶åº”ç”¨å“åº”æ­¤intentæ—¶ï¼Œè¯¥åº”ç”¨ä¼šè¯»å–extraä¸­æä¾›çš„å­—ç¬¦ä¸²æ•°ç»„ï¼Œå¹¶å°†è¯¥æ•°ç»„æ”¾å…¥ç”µå­é‚®ä»¶æ’°å†™è¡¨å•çš„â€œæ”¶ä»¶äººâ€å­—æ®µã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”µå­é‚®ä»¶åº”ç”¨çš„Activityä¼šå¯åŠ¨ï¼Œå¹¶ä¸”å½“ç”¨æˆ·å®Œæˆæ“ä½œæ—¶ï¼Œä½ çš„Activityä¼šç»§ç»­è¿è¡Œã€‚\n\n## startActivityForResult()\n\næœ‰æ—¶ï¼Œå¸Œæœ›åœ¨Activityç»“æŸæ—¶ä»Activityä¸­è·å–è¿”å›ç»“æœã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å¯åŠ¨ä¸€é¡¹Activityï¼Œè®©ç”¨æˆ·åœ¨è”ç³»äººåˆ—è¡¨ä¸­é€‰æ‹©æ”¶ä»¶äººï¼›å½“Activityç»“æŸæ—¶ï¼Œç³»ç»Ÿå°†è¿”å›ç”¨æˆ·é€‰æ‹©çš„æ”¶ä»¶äººã€‚ä¸ºæ­¤ï¼Œå¯ä»¥è°ƒç”¨`startActivityForResult(Intent, int)`æ–¹æ³•ï¼Œå…¶ä¸­æ•´æ•°å‚æ•°ä¼šæ ‡è¯†è¯¥è°ƒç”¨ã€‚æ­¤æ ‡è¯†ç¬¦ç”¨äºæ¶ˆé™¤æ¥è‡ªåŒä¸€Activityçš„å¤šæ¬¡`startActivityForResult(Intent, int)`è°ƒç”¨ä¹‹é—´çš„æ­§ä¹‰ã€‚è¿™ä¸æ˜¯å…¨å±€æ ‡è¯†ç¬¦ï¼Œä¸å­˜åœ¨ä¸å…¶ä»–åº”ç”¨æˆ–Activityå†²çªçš„é£é™©ã€‚ç»“æœé€šè¿‡`onActivityResult(int, int, Intent)`æ–¹æ³•è¿”å›ã€‚\n\nå½“å­çº§Activityé€€å‡ºæ—¶ï¼Œå®ƒå¯ä»¥è°ƒç”¨`setResult(int)`å°†æ•°æ®è¿”å›åˆ°å…¶çˆ¶çº§ã€‚å­çº§Activityå¿…é¡»å§‹ç»ˆæä¾›ç»“æœä»£ç ï¼Œè¯¥ç»“æœä»£ç å¯ä»¥æ˜¯æ ‡å‡†ç»“æœ`RESULT_CANCELED`ã€`RESULT_OK`ï¼Œä¹Ÿå¯ä»¥æ˜¯ä»`RESULT_FIRST_USER`å¼€å§‹çš„ä»»ä½•è‡ªå®šä¹‰å€¼ã€‚æ­¤å¤–ï¼Œå­çº§Activityå¯ä»¥æ ¹æ®éœ€è¦è¿”å›åŒ…å«å®ƒæ‰€éœ€çš„ä»»ä½•å…¶ä»–æ•°æ®çš„`Intent`å¯¹è±¡ã€‚çˆ¶çº§Activityä½¿ç”¨`onActivityResult(int, int, Intent)`æ–¹æ³•ï¼Œä»¥åŠçˆ¶çº§Activityæœ€åˆæä¾›çš„æ•´æ•°æ ‡è¯†ç¬¦æ¥æ¥æ”¶ä¿¡æ¯ã€‚\n\nå¦‚æœå­çº§Activityç”±äºä»»ä½•åŸå› ï¼ˆä¾‹å¦‚å´©æºƒï¼‰è€Œå¤±è´¥ï¼Œçˆ¶çº§Activityå°†æ”¶åˆ°ä»£ç ä¸º`RESULT_CANCELED`çš„ç»“æœã€‚\n\n```java\npublic class MyActivity extends Activity {\n     // ...\n     static final int PICK_CONTACT_REQUEST = 0;\n     public boolean onKeyDown(int keyCode, KeyEvent event) {\n         if (keyCode == KeyEvent.KEYCODE_DPAD_CENTER) {\n             // When the user center presses, let them pick a contact.\n             startActivityForResult(\n                 new Intent(Intent.ACTION_PICK,\n                 new Uri(\"content://contacts\")),\n                 PICK_CONTACT_REQUEST);\n            return true;\n         }\n         return false;\n     }\n     protected void onActivityResult(int requestCode, int resultCode,\n             Intent data) {\n         if (requestCode == PICK_CONTACT_REQUEST) {\n             if (resultCode == RESULT_OK) {\n                 // A contact was picked.  Here we will just display it\n                 // to the user.\n                 startActivity(new Intent(Intent.ACTION_VIEW, data));\n             }\n         }\n     }\n }\n```\n\n## åè°ƒActivity\n\nå½“ä¸€ä¸ªActivityå¯åŠ¨å¦ä¸€ä¸ªActivityæ—¶ï¼Œå®ƒä»¬éƒ½ä¼šç»å†ç”Ÿå‘½å‘¨æœŸè½¬æ¢ã€‚ç¬¬ä¸€ä¸ªActivityåœæ­¢è¿è¡Œå¹¶è¿›å…¥â€œå·²æš‚åœâ€æˆ–â€œå·²åœæ­¢â€çŠ¶æ€ï¼ŒåŒæ—¶åˆ›å»ºå¦ä¸€ä¸ªActivityã€‚å¦‚æœè¿™äº›Activityå…±äº«ä¿å­˜åˆ°ç£ç›˜æˆ–å…¶ä»–ä½ç½®çš„æ•°æ®ï¼Œå¿…é¡»è¦æ˜ç¡®ç¬¬ä¸€ä¸ªActivityåœ¨åˆ›å»ºç¬¬äºŒä¸ªActivityä¹‹å‰å¹¶æœªå®Œå…¨åœæ­¢ã€‚ç›¸åï¼Œå¯åŠ¨ç¬¬äºŒä¸ªActivityçš„è¿‡ç¨‹ä¸åœæ­¢ç¬¬ä¸€ä¸ªActivityçš„è¿‡ç¨‹é‡å ã€‚\n\nç”Ÿå‘½å‘¨æœŸå›è°ƒçš„é¡ºåºå·²æœ‰æ˜ç¡®å®šä¹‰ï¼Œç‰¹åˆ«æ˜¯å½“ä¸¤ä¸ªActivityåœ¨åŒä¸€ä¸ªè¿›ç¨‹ï¼ˆåº”ç”¨ï¼‰ä¸­ï¼Œå¹¶ä¸”å…¶ä¸­ä¸€ä¸ªè¦å¯åŠ¨å¦ä¸€ä¸ªæ—¶ã€‚ä»¥ä¸‹æ˜¯Activity Aå¯åŠ¨Activity Bæ—¶çš„æ“ä½œå‘ç”Ÿé¡ºåºï¼š\n\n1. Activity Açš„`onPause()`æ–¹æ³•æ‰§è¡Œã€‚\n2. Activity Bçš„`onCreate()`ã€`onStart()`å’Œ`onResume()`æ–¹æ³•ä¾æ¬¡æ‰§è¡Œï¼ˆActivity Bç°åœ¨å…·æœ‰ç”¨æˆ·ç„¦ç‚¹ï¼‰ã€‚\n3. ç„¶åï¼Œå¦‚æœActivity Aåœ¨å±å¹•ä¸Šä¸å†æ˜¾ç¤ºï¼Œå…¶`onStop()`æ–¹æ³•æ‰§è¡Œã€‚\n\nå¯ä»¥åˆ©ç”¨è¿™ç§å¯é¢„æµ‹çš„ç”Ÿå‘½å‘¨æœŸå›è°ƒé¡ºåºç®¡ç†ä»ä¸€ä¸ªActivityåˆ°å¦ä¸€ä¸ªActivityçš„ä¿¡æ¯è½¬æ¢ã€‚\n","categories":["Android"]},{"title":"Android_ListView","url":"/Android/Android_ListView/","content":"\nListViewç§°å¾—ä¸Šæ˜¯Androidä¸­æœ€å¸¸ç”¨çš„æ§ä»¶ä¹‹ä¸€ï¼Œå‡ ä¹æ‰€æœ‰åº”ç”¨éƒ½ä¼šç”¨åˆ°å®ƒã€‚å› ä¸ºæ‰‹æœºå±å¹•ç©ºé—´æ¯”è¾ƒæœ‰é™ï¼Œå½“ç¨‹åºä¸­æœ‰å¤§é‡çš„æ•°æ®éœ€è¦å±•ç¤ºçš„æ—¶å€™ï¼Œå¯ä»¥å€ŸåŠ©ListViewæ¥å®ç°ã€‚ListViewå…è®¸ç”¨æˆ·é€šè¿‡æ‰‹æŒ‡ä¸Šä¸‹æ»‘åŠ¨çš„æ–¹å¼å°†å±å¹•å¤–çš„æ•°æ®æ»šåŠ¨åˆ°å±å¹•å†…ï¼ŒåŒæ—¶å±å¹•ä¸ŠåŸæœ‰çš„æ•°æ®åˆ™ä¼šæ»šåŠ¨å‡ºå±å¹•ã€‚\n\n# ç®€å•ç”¨æ³•\n\né¦–å…ˆæ–°å»ºä¸€ä¸ªListViewTesté¡¹ç›®ï¼Œå¹¶è®©Android Studioè‡ªåŠ¨å¸®æˆ‘ä»¬åˆ›å»ºå¥½æ´»åŠ¨ã€‚ç„¶åä¿®æ”¹`activity_main.xml`ä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```xml\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\">\n    <ListView\n        android:id=\"@+id/list_view\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\">\n    </ListView>\n</LinearLayout>\n```\n\nMainActivityä»£ç \n\n```java\npublic class MainActivity extends AppCompatActivity {\n    private String[] data = {\"Apple\", \"Banana\", \"Orange\", \"Watermelon\",\n        \"Pear\", \"Grape\", \"Pineapple\", \"Strawberry\", \"Cherry\", \"Mango\",\n        \"Apple\", \"Banana\", \"Orange\", \"Watermelon\", \"Pear\", \"Grape\",\n        \"Pineapple\", \"Strawberry\", \"Cherry\", \"Mango\"};\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        ArrayAdapter<String> adapter = new ArrayAdapter<>(\n            MainActivity.this, android.R.layout.simple_list_item_1, data);\n        ListView listView = (ListView) findViewById(R.id.list_view);\n        listView.setAdapter(adapter);\n    }\n}\n```\n\n","categories":["Android"]},{"title":"è½¯ä»¶ä½“ç³»ç»“æ„","url":"/è®¾è®¡æ¨¡å¼/è½¯ä»¶ä½“ç³»ç»“æ„/","content":"å‚è€ƒä¹¦ç±ï¼šå¼ å‹ç”Ÿç¼–è‘— - è½¯ä»¶ä½“ç³»ç»“æ„åŸç†ã€æ–¹æ³•ä¸å®è·µï¼ˆç¬¬2ç‰ˆï¼‰\n\n# ç¬¬1ç«  è½¯ä»¶ä½“ç³»ç»“æ„æ¦‚è®º\n\n## æ„ä»¶\n\nä¸€èˆ¬è®¤ä¸ºï¼Œæ„ä»¶æ˜¯æŒ‡è¯­ä¹‰å®Œæ•´ã€è¯­æ³•æ­£ç¡®å’Œæœ‰å¯é‡ç”¨ä»·å€¼çš„å•ä½è½¯ä»¶ï¼Œæ˜¯è½¯ä»¶é‡ç”¨è¿‡ç¨‹ä¸­å¯ä»¥æ˜ç¡®è¾¨è¯†çš„ç³»ç»Ÿï¼›ç»“æ„ä¸Šï¼Œå®ƒæ˜¯è¯­ä¹‰æè¿°ã€é€šä¿¡æ¥å£å’Œå®ç°ä»£ç çš„å¤åˆä½“ã€‚\n\næœ‰çš„å¯ä»¥ç‹¬ç«‹å·¥ä½œï¼Œæœ‰çš„éœ€è¦ä¸å…¶ä»–é…åˆå·¥ä½œï¼›ä½¿ç”¨å’Œå¼€å‘ç”Ÿäº§æ— å…³ï¼Œåªè¦æŒ‰ç…§æ ‡å‡†æ¥ç”Ÿäº§ï¼›\n\n## æ„ä»¶æ¨¡å‹\n\næ„ä»¶æ¨¡å‹æ˜¯å¯¹æ„ä»¶æœ¬è´¨çš„æŠ½è±¡æè¿°ï¼Œä¸»è¦æ˜¯ä¸ºæ„ä»¶çš„åˆ¶ä½œä¸æ„ä»¶çš„é‡ç”¨æä¾›ä¾æ®ã€‚\n\n### é’é¸Ÿæ„ä»¶æ¨¡å‹\n\né’é¸Ÿæ„ä»¶æ¨¡å‹ç”±å¤–éƒ¨æ¥å£å’Œå†…éƒ¨ç»“æ„ä¸¤éƒ¨åˆ†ç»„æˆï¼›\n\nå¤–éƒ¨æ¥å£è¯´æ˜äº†æ„ä»¶æ‰€æä¾›çš„æœåŠ¡ï¼ˆæ¶ˆæ¯ã€æ“ä½œã€å˜é‡ï¼‰ï¼›\n\nå†…éƒ¨ç»“æ„åˆ†ä¸ºå†…éƒ¨æˆå‘˜ä»¥åŠå†…éƒ¨æˆå‘˜ä¹‹é—´çš„å…³ç³»ã€‚å…¶ä¸­å†…éƒ¨æˆå‘˜åŒ…æ‹¬å…·ä½“æˆå‘˜ä¸è™šæ‹Ÿæˆå‘˜ï¼›è€Œæˆå‘˜å…³ç³»åŒ…æ‹¬å†…éƒ¨æˆå‘˜ä¹‹é—´çš„äº’è”ï¼Œä»¥åŠå†…éƒ¨æˆå‘˜ä¸å¤–éƒ¨æ¥å£ä¹‹é—´çš„äº’è”\n\n## æ„ä»¶è·å–\n\n1. ä»ç°æœ‰æ„ä»¶ä¸­è·å¾—ç¬¦åˆè¦æ±‚çš„æ„ä»¶ï¼Œç›´æ¥ä½¿ç”¨æˆ–ä½œé€‚åº”æ€§ä¿®æ”¹ï¼Œå¾—åˆ°å¯é‡ç”¨çš„æ„ä»¶ã€‚\n2. é€šè¿‡é—ç•™å·¥ç¨‹ï¼Œå°†å…·æœ‰æ½œåœ¨é‡ç”¨ä»·å€¼çš„æ„ä»¶æå–å‡ºæ¥ï¼Œå¾—åˆ°å¯é‡ç”¨çš„æ„ä»¶ã€‚\n3. ä»å¸‚åœºä¸Šè´­ä¹°ç°æˆçš„å•†ä¸šæ„ä»¶ï¼Œ å³COTS(Commercial Off-The-Shell)æ„ä»¶ã€‚\n4. å¼€å‘æ–°çš„ç¬¦åˆè¦æ±‚çš„æ„ä»¶ã€‚\n\n## æ„ä»¶ç®¡ç†\n\n### æ„ä»¶æè¿°\n\nä»ç®¡ç†è§’åº¦å‡ºå‘ï¼Œä¹Ÿéœ€è¦å¯¹æ„ä»¶è¿›è¡Œæè¿°ï¼Œä¾‹å¦‚ï¼šå®ç°æ–¹å¼ã€å®ç°ä½“ã€æ³¨é‡Šã€ç”Ÿäº§è€…ã€ç”Ÿäº§æ—¥æœŸã€å¤§å°ã€ä»·æ ¼ã€ç‰ˆæœ¬å’Œå…³è”æ„ä»¶ç­‰ä¿¡æ¯ï¼Œå®ƒä»¬ä¸æ„ä»¶æ¨¡å‹å…±åŒç»„æˆäº†å¯¹æ„ä»¶çš„å®Œæ•´æè¿°ã€‚\n\n### æ„ä»¶åˆ†ç±»ä¸ç»„ç»‡\n\nä¸ºäº†ç»™ç”¨æˆ·åœ¨æŸ¥è¯¢æ„ä»¶æ—¶æä¾›æ–¹ä¾¿ï¼ŒåŒæ—¶ä¹Ÿä¸ºäº†æ›´å¥½åœ°é‡ç”¨ç»„ä»¶ï¼Œå¿…é¡»å¯¹æ”¶é›†å’Œå¼€å‘çš„æ„ä»¶è¿›è¡Œåˆ†ç±»å¹¶ç½®äºæ„ä»¶åº“çš„é€‚å½“ä½ç½®ã€‚æ„ä»¶åº“çš„ç»„ç»‡åº”æ–¹ä¾¿æ„ä»¶çš„å­˜å‚¨å’Œæ£€ç´¢ï¼›\n\nå¯é‡ç”¨æŠ€æœ¯å¯¹æ„ä»¶åº“ç»„ç»‡æ–¹æ³•çš„è¦æ±‚ï¼š\n\n1. æ”¯æŒæ„ä»¶åº“çš„å„ç§ç»´æŠ¤åŠ¨ä½œï¼Œå¦‚å¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹æ„ä»¶ï¼Œå°½é‡ä¸è¦å½±å“æ„ä»¶åº“çš„ç»“æ„ã€‚\n2. ä¸ä»…æ”¯æŒç²¾ç¡®åŒ¹é…ï¼Œè¿˜è¦æ”¯æŒç›¸ä¼¼æ„ä»¶çš„æŸ¥æ‰¾ã€‚\n3. ä¸ä»…èƒ½è¿›è¡Œç®€å•çš„è¯­æ³•åŒ¹é…ï¼Œè€Œä¸”èƒ½å¤ŸæŸ¥æ‰¾åœ¨åŠŸèƒ½æˆ–è¡Œä¸ºæ–¹é¢ç­‰ä»·æˆ–ç›¸ä¼¼çš„æ„ä»¶ã€‚\n4. å¯¹åº”ç”¨é¢†åŸŸå…·æœ‰è¾ƒå¼ºçš„æè¿°èƒ½åŠ›å’Œè¾ƒå¥½çš„æè¿°ç²¾åº¦ã€‚\n5. åº“ç®¡ç†å‘˜å’Œç”¨æˆ·å®¹æ˜“ä½¿ç”¨ã€‚\n\n### æ„ä»¶åˆ†ç±»ä¸‰å¤§æ–¹æ³•\n\n1. å…³é”®å­—åˆ†ç±»æ³• - åˆ†å±‚é€æ¬¡æ ‘çŠ¶å›¾\n2. åˆ»é¢åˆ†ç±»æ³• - å®šä¹‰è‹¥å¹²ç”¨äºåˆ»ç”»æ„ä»¶ç‰¹å¾çš„\"é¢\"\n3. è¶…æ–‡æœ¬ç»„ç»‡æ–¹æ³•\n\n### äººå‘˜åŠæƒé™ç®¡ç†\n\næœ‰å¿…è¦å¯¹ä¸åŒä½¿ç”¨è€…çš„è®¿é—®æƒé™è¿›è¡Œé™åˆ¶ï¼Œä¿è¯æ•°æ®å®‰å…¨ï¼›\n\næ„ä»¶åº“ç³»ç»Ÿå¯åŒ…æ‹¬5ç±»ç”¨æˆ·ï¼Œå³æ³¨å†Œç”¨æˆ·ã€å…¬å…±ç”¨æˆ·ã€æ„ä»¶æäº¤è€…ã€ä¸€èˆ¬ç³»ç»Ÿç®¡ç†å‘˜ã€è¶…çº§ç³»ç»Ÿç®¡ç†å‘˜ã€‚\n\n## ç†è§£ä¸è¯„ä»·æ„ä»¶\n\n1. æ„ä»¶çš„åŠŸèƒ½ä¸è¡Œä¸º\n2. ç›¸å…³çš„é¢†åŸŸçŸ¥è¯†\n3. å¯é€‚åº”æ€§çº¦æŸæ¡ä»¶ä¸ä¾‹å¤–æƒ…å½¢\n4. å¯ä»¥é¢„è§çš„ä¿®æ”¹éƒ¨åˆ†åŠä¿®æ”¹æ–¹æ³•\n\nç†è§£æ„ä»¶çš„å¦ä¸€ç§é‡è¦æ‰‹æ®µï¼šé€†å‘å·¥ç¨‹ï¼Œè¯•å›¾é€šè¿‡å¯¹æ„ä»¶çš„åˆ†æï¼Œç»“åˆé¢†åŸŸçŸ¥è¯†ï¼ŒåŠè‡ªåŠ¨åœ°ç”Ÿæˆç›¸åº”çš„è®¾è®¡ä¿¡æ¯ï¼Œç„¶åå€ŸåŠ©è®¾è®¡ä¿¡æ¯å®Œæˆå¯¹æ„ä»¶çš„ç†è§£å’Œä¿®æ”¹ã€‚\n\nå¯¹æ„ä»¶å¯é‡ç”¨çš„è¯„ä»·ï¼šæ˜¯é€šè¿‡æ”¶é›†å¹¶åˆ†ææ„ä»¶çš„ç”¨æˆ·åœ¨å®é™…é‡ç”¨è¯¥æ„ä»¶çš„å†å²è¿‡ç¨‹ä¸­çš„å„ç§åé¦ˆä¿¡æ¯æ¥å®Œæˆçš„ã€‚è¿™äº›ä¿¡æ¯åŒ…æ‹¬ï¼šé‡ç”¨æˆåŠŸçš„æ¬¡æ•°ï¼Œå¯¹æ„ä»¶çš„ä¿®æ”¹é‡ï¼Œæ„ä»¶çš„å¥å£®æ€§åº¦é‡ï¼Œæ€§èƒ½åº¦é‡ç­‰ç­‰ã€‚\n\n## è½¯ä»¶ä½“ç³»ç»“æ„å«ä¹‰\n\nè½¯ä»¶ä½“ç³»ç»“æ„ä¸ºè½¯ä»¶ç³»ç»Ÿæä¾›äº†ä¸€ä¸ªç»“æ„ã€è¡Œä¸ºå’Œå±æ€§çš„é«˜çº§æŠ½è±¡ï¼Œç”±æ„æˆç³»ç»Ÿçš„å…ƒç´ çš„æè¿°ã€è¿™äº›å…ƒç´ çš„ç›¸äº’ä½œç”¨ã€æŒ‡å¯¼å…ƒç´ é›†æˆçš„æ¨¡å¼ä»¥åŠè¿™äº›æ¨¡å¼çš„çº¦æŸç»„æˆã€‚\n\nè½¯ä»¶ä½“ç³»ç»“æ„ä¸ä»…æŒ‡å®šäº†ç³»ç»Ÿçš„ç»„ç»‡ç»“æ„å’Œæ‹“æ‰‘ç»“æ„ï¼Œå¹¶ä¸”æ˜¾ç¤ºäº†ç³»ç»Ÿéœ€æ±‚å’Œæ„æˆç³»ç»Ÿçš„å…ƒç´ ä¹‹é—´çš„å¯¹åº”å…³ç³»ï¼Œæä¾›äº†ä¸€äº›è®¾è®¡å†³ç­–çš„åŸºæœ¬åŸç†ã€‚\n\n## è½¯ä»¶ä½“ç³»ç»“æ„è®¾è®¡çš„æ–¹æ³•\n\nä¸¤å¤§ç±»æ–¹æ³•ï¼šè¿‡ç¨‹é©±åŠ¨æ–¹æ³•å’Œé—®é¢˜åˆ—è¡¨é©±åŠ¨æ–¹æ³•ã€‚\n\nè¿‡ç¨‹é©±åŠ¨æ–¹æ³•åˆåˆ†ä¸ºï¼š\n\n1. é¢å‘å¯¹è±¡æ–¹æ³•ï¼Œä¸OOA/OODç›¸ä¼¼ï¼Œä½†æ›´ä¾§é‡æ¥å£ä¸äº¤äº’ã€‚\n2. â€œ4+1â€æ¨¡å‹æ–¹æ³•ã€‚\n3. åŸºäºåœºæ™¯çš„è¿­ä»£æ–¹æ³•ã€‚\n\nåŸºäºè¿‡ç¨‹é©±åŠ¨çš„ä½“ç³»ç»“æ„è®¾è®¡æ–¹æ³•é€‚ç”¨èŒƒå›´å¹¿, æ˜“äºè£å‰ª, å…·å¤‡åŠ¨æ€ç‰¹ç‚¹, é€šç”¨æ€§ä¸å®è·µæ€§å¼ºã€‚\n\né—®é¢˜åˆ—è¡¨é©±åŠ¨æ³•é€‚ç”¨äºç‰¹å®šé¢†åŸŸ, æ˜¯é™æ€çš„, å¯ä»¥å®ç°é‡åŒ–ä½“ç³»ç»“æ„è®¾è®¡ç©ºé—´ã€‚å…¶åŸºæœ¬æ€æƒ³æ˜¯æšä¸¾è®¾è®¡ç©ºé—´, å¹¶è€ƒè™‘è®¾è®¡ç»´çš„ç›¸å…³æ€§, ä»¥æ­¤æ¥é€‰æ‹©ä½“ç³»ç»“æ„çš„é£æ ¼ã€‚\n\n## è½¯ä»¶ä½“ç³»ç»“æ„å‘å±•å²\n\n1. æ— ä½“ç³»ç»“æ„è®¾è®¡é˜¶æ®µ\n   1. ä»¥æ±‡ç¼–è¯­è¨€è¿›è¡Œå°è§„æ¨¡åº”ç”¨ç¨‹åºå¼€å‘ä¸ºç‰¹å¾\n2. èŒèŠ½é˜¶æ®µ\n   1. å‡ºç°äº†ç¨‹åºç»“æ„è®¾è®¡ä¸»é¢˜ï¼Œä»¥æ§åˆ¶æµå›¾å’Œæ•°æ®æµå›¾æ„æˆè½¯ä»¶ç»“æ„ä¸ºç‰¹å¾\n3. åˆæœŸé˜¶æ®µ\n   1. å‡ºç°äº†ä»ä¸åŒä¾§é¢æè¿°ç³»ç»Ÿçš„ç»“æ„æ¨¡å‹ï¼Œä»¥UMLä¸ºå…¸å‹ä»£è¡¨ã€‚\n4. é«˜çº§é˜¶æ®µ\n   1. ä»¥æè¿°ç³»ç»Ÿçš„é«˜å±‚æŠ½è±¡ç»“æ„ä¸ºä¸­å¿ƒï¼Œä¸å…³å¿ƒå…·ä½“çš„å»ºæ¨¡ç»†èŠ‚ï¼Œåˆ’åˆ†äº†ä½“ç³»ç»“æ„æ¨¡å‹ä¸ä¼ ç»Ÿè½¯ä»¶ç»“æ„çš„ç•Œé™ï¼Œè¯¥é˜¶æ®µä»¥Kruchtenæå‡ºçš„â€œ4+1â€æ¨¡å‹ä¸ºæ ‡å¿—\n\n# ç¬¬2ç«  è½¯ä»¶ä½“ç³»ç»“æ„å»ºæ¨¡\n\n## 4+1è§†å›¾\n\n4æŒ‡çš„æ˜¯é€»è¾‘ã€å¼€å‘ã€è¿›ç¨‹ã€ç‰©ç†è§†å›¾ï¼Œ1æŒ‡çš„æ˜¯åœºæ™¯è§†å›¾ã€‚æ¯ä¸€ä¸ªè§†å›¾åªå…³å¿ƒç³»ç»Ÿçš„ä¸€ä¸ªä¾§é¢ï¼Œ5ä¸ªè§†å›¾ç»“åˆåœ¨ä¸€èµ·æ‰èƒ½åæ˜ ç³»ç»Ÿçš„è½¯ä»¶ä½“ç³»ç»“æ„çš„å…¨éƒ¨å†…å®¹ã€‚\n\n![2022-06-19_222151](../../images/è½¯ä»¶ä½“ç³»ç»“æ„/4plus1.png)\n\n### é€»è¾‘è§†å›¾\n\né€»è¾‘è§†å›¾ï¼šæ˜¯ä»æœ€ç»ˆç”¨æˆ·çš„è§’åº¦æ¥çœ‹çš„ï¼Œå…³æ³¨ç‚¹æ˜¯åŠŸèƒ½éœ€æ±‚ï¼›\n\né€»è¾‘è§†å›¾ä¸»è¦æ”¯æŒç³»ç»Ÿçš„åŠŸèƒ½éœ€æ±‚ï¼Œå³ç³»ç»Ÿæä¾›ç»™æœ€ç»ˆç”¨æˆ·çš„æœåŠ¡ã€‚\nåœ¨é€»è¾‘è§†å›¾ä¸­ï¼Œç³»ç»Ÿåˆ†è§£æˆä¸€ç³»åˆ—çš„åŠŸèƒ½æŠ½è±¡ï¼Œè¿™äº›æŠ½è±¡ä¸»è¦æ¥è‡ªé—®é¢˜é¢†åŸŸã€‚è¿™ç§åˆ†è§£ä¸ä½†å¯ä»¥ç”¨æ¥è¿›è¡ŒåŠŸèƒ½åˆ†æï¼Œè€Œä¸”å¯ç”¨ä½œæ ‡è¯†åœ¨æ•´ä¸ªç³»ç»Ÿçš„å„ä¸ªä¸åŒéƒ¨åˆ†çš„é€šç”¨æœºåˆ¶å’Œè®¾è®¡å…ƒç´ ã€‚\nåœ¨é¢å‘å¯¹è±¡æŠ€æœ¯ä¸­ï¼Œé€šè¿‡æŠ½è±¡ã€å°è£…å’Œç»§æ‰¿ï¼Œå¯ä»¥ç”¨å¯¹è±¡æ¨¡å‹æ¥ä»£è¡¨é€»è¾‘è§†å›¾ï¼Œç”¨ç±»å›¾æ¥æè¿°é€»è¾‘è§†å›¾ã€‚\n\n### å¼€å‘è§†å›¾\n\nå¼€å‘è§†å›¾ï¼ˆä¹Ÿå«æ¨¡å—è§†å›¾ï¼‰ï¼šæ˜¯ä»ç¨‹åºå‘˜çš„è§’åº¦æ¥çœ‹çš„ï¼Œä¸»è¦ä¾§é‡è½¯ä»¶æ¨¡å—çš„ç»„ç»‡å’Œç®¡ç†ï¼›\n\nå¼€å‘è§†å›¾ä¹Ÿç§°æ¨¡å—è§†å›¾ï¼Œä¸»è¦ä¾§é‡äºè½¯ä»¶æ¨¡å—çš„ç»„ç»‡å’Œç®¡ç†ã€‚\nå¼€å‘è§†å›¾è¦è€ƒè™‘è½¯ä»¶å†…éƒ¨çš„éœ€æ±‚ï¼Œå¦‚è½¯ä»¶å¼€å‘çš„å®¹æ˜“æ€§ã€è½¯ä»¶çš„é‡ç”¨å’Œè½¯ä»¶çš„é€šç”¨æ€§ï¼Œè¦å……åˆ†è€ƒè™‘ç”±äºå…·ä½“å¼€å‘å·¥å…·çš„ä¸åŒè€Œå¸¦æ¥çš„å±€é™æ€§ã€‚\nå¼€å‘è§†å›¾é€šè¿‡ç³»ç»Ÿè¾“å…¥è¾“å‡ºå…³ç³»çš„æ¨¡å‹å›¾å’Œå­ç³»ç»Ÿå›¾æ¥æè¿°ã€‚\n\n### è¿›ç¨‹è§†å›¾\n\nè¿›ç¨‹è§†å›¾ï¼ˆä¹Ÿå«å¹¶å‘è§†å›¾ï¼‰ï¼šæ˜¯ä»ç³»ç»Ÿé›†æˆäººå‘˜çš„è§’åº¦æ¥çœ‹çš„ï¼Œä¸»è¦ä¾§é‡ç³»ç»Ÿçš„è¿è¡Œç‰¹æ€§ï¼ˆéåŠŸèƒ½å‹çš„ï¼‰ï¼Œæ€§èƒ½å’Œå¯ç”¨æ€§ã€ååé‡ï¼Œæ€§èƒ½å¯æ‰©å……æ€§ã€‚\n\nè¿›ç¨‹è§†å›¾ä¾§é‡äºç³»ç»Ÿçš„è¿è¡Œç‰¹æ€§ï¼Œä¸»è¦å…³æ³¨ä¸€äº›éåŠŸèƒ½æ€§çš„éœ€æ±‚ã€‚\nè¿›ç¨‹è§†å›¾å¼ºè°ƒå¹¶å‘æ€§ã€åˆ†å¸ƒæ€§ã€ç³»ç»Ÿé›†æˆæ€§å’Œå®¹é”™èƒ½åŠ›ï¼Œä»¥åŠä»é€»è¾‘è§†å›¾ä¸­çš„ä¸»è¦æŠ½è±¡å¦‚ä½•é€‚åˆè¿›ç¨‹ç»“æ„ã€‚å®ƒä¹Ÿå®šä¹‰é€»è¾‘è§†å›¾ä¸­çš„å„ä¸ªç±»çš„æ“ä½œå…·ä½“æ˜¯åœ¨å“ªä¸€ä¸ªçº¿ç¨‹ä¸­è¢«æ‰§è¡Œçš„ã€‚\nè¿›ç¨‹è§†å›¾å¯ä»¥æè¿°æˆå¤šå±‚æŠ½è±¡ï¼Œæ¯ä¸ªçº§åˆ«åˆ†åˆ«å…³æ³¨ä¸åŒçš„æ–¹é¢ã€‚åœ¨æœ€é«˜å±‚æŠ½è±¡ä¸­ï¼Œè¿›ç¨‹ç»“æ„å¯ä»¥çœ‹ä½œæ˜¯æ„æˆä¸€ä¸ªæ‰§è¡Œå•å…ƒçš„ä¸€ç»„ä»»åŠ¡ã€‚\nå®ƒå¯çœ‹æˆä¸€ç³»åˆ—ç‹¬ç«‹çš„ï¼Œé€šè¿‡é€»è¾‘ç½‘ç»œç›¸äº’é€šä¿¡çš„ç¨‹åºã€‚å®ƒä»¬æ˜¯åˆ†å¸ƒçš„ï¼Œé€šè¿‡æ€»çº¿æˆ–å±€åŸŸç½‘ã€å¹¿åŸŸç½‘ç­‰ç¡¬ä»¶èµ„æºè¿æ¥èµ·æ¥ã€‚\n\n### ç‰©ç†è§†å›¾\n\nç‰©ç†è§†å›¾ï¼šæ˜¯ä»ç³»ç»Ÿå·¥ç¨‹äººå‘˜çš„è§’åº¦æ¥çœ‹çš„ï¼Œä¸»è¦è€ƒè™‘ç³»ç»Ÿæ‹“æ‰‘ç»“æ„ã€è®¾å¤‡å®‰è£…ã€é€šä¿¡ç­‰\n\nç‰©ç†è§†å›¾ä¸»è¦è€ƒè™‘å¦‚ä½•æŠŠè½¯ä»¶æ˜ å°„åˆ°ç¡¬ä»¶ä¸Šï¼Œå®ƒé€šå¸¸è¦è€ƒè™‘åˆ°ç³»ç»Ÿæ€§èƒ½ã€è§„æ¨¡ã€å¯é æ€§ç­‰ã€‚è§£å†³ç³»ç»Ÿæ‹“æ‰‘ç»“æ„ã€ç³»ç»Ÿå®‰è£…ã€é€šè®¯ç­‰é—®é¢˜ã€‚\nå½“è½¯ä»¶è¿è¡Œäºä¸åŒçš„èŠ‚ç‚¹ä¸Šæ—¶ï¼Œå„è§†å›¾ä¸­çš„æ„ä»¶éƒ½ç›´æ¥æˆ–é—´æ¥åœ°å¯¹åº”äºç³»ç»Ÿçš„ä¸åŒèŠ‚ç‚¹ä¸Šã€‚å› æ­¤ï¼Œä»è½¯ä»¶åˆ°èŠ‚ç‚¹çš„æ˜ å°„è¦æœ‰è¾ƒé«˜çš„çµæ´»æ€§ï¼Œå½“ç¯å¢ƒæ”¹å˜æ—¶ï¼Œå¯¹ç³»ç»Ÿå…¶ä»–è§†å›¾çš„å½±å“æœ€å°ã€‚\n\n### åœºæ™¯è§†å›¾\n\nåœºæ™¯å¯ä»¥çœ‹ä½œæ˜¯é‚£äº›é‡è¦ç³»ç»Ÿæ´»åŠ¨çš„æŠ½è±¡ï¼Œå®ƒä½¿å››ä¸ªè§†å›¾æœ‰æœºè”ç³»èµ·æ¥ï¼Œä»æŸç§æ„ä¹‰ä¸Šè¯´åœºæ™¯æ˜¯æœ€é‡è¦çš„éœ€æ±‚æŠ½è±¡ã€‚åœ¨å¼€å‘ä½“ç³»ç»“æ„æ—¶ï¼Œå®ƒå¯ä»¥å¸®åŠ©è®¾è®¡è€…æ‰¾åˆ°ä½“ç³»ç»“æ„çš„æ„ä»¶å’Œå®ƒä»¬ä¹‹é—´çš„ä½œç”¨å…³ç³»ã€‚\nåŒæ—¶ï¼Œä¹Ÿå¯ä»¥ç”¨åœºæ™¯æ¥åˆ†æä¸€ä¸ªç‰¹å®šçš„è§†å›¾ï¼Œæˆ–æè¿°ä¸åŒè§†å›¾æ„ä»¶é—´æ˜¯å¦‚ä½•ç›¸äº’ä½œç”¨çš„ã€‚\nåœºæ™¯å¯ä»¥ç”¨æ–‡æœ¬è¡¨ç¤ºï¼Œä¹Ÿå¯ä»¥ç”¨å›¾å½¢è¡¨ç¤ºã€‚\n\n## è½¯ä»¶ä½“ç³»ç»“æ„çš„æ ¸å¿ƒæ¨¡å‹\n\n![2022-06-19_222211](../../images/è½¯ä»¶ä½“ç³»ç»“æ„/core-model.png)\n\n5ä¸ªå…ƒç´ æ„æˆï¼Œé…ç½®ã€è¿æ¥ä»¶ã€æ„ä»¶ã€ç«¯å£ã€è§’è‰²ã€‚\n\nå…¶ä¸­ï¼Œé…ç½®ã€æ„ä»¶ã€è¿æ¥ä»¶æ˜¯æœ€åŸºæœ¬çš„å…ƒç´ ã€‚\n\næ„ä»¶æ˜¯å…·æœ‰æŸç§åŠŸèƒ½çš„å¯é‡ç”¨çš„è½¯ä»¶æ¨¡æ¿å•å…ƒï¼Œè¡¨ç¤ºäº†ç³»ç»Ÿä¸­ä¸»è¦çš„è®¡ç®—å…ƒç´ å’Œæ•°æ®å­˜å‚¨ã€‚æ„ä»¶æœ‰ä¸¤ç§ï¼šå¤åˆæ„ä»¶å’ŒåŸå­æ„ä»¶ã€‚å¤åˆæ„ä»¶ç”±å…¶ä»–å¤åˆæ„ä»¶å’ŒåŸå­æ„ä»¶é€šè¿‡è¿æ¥ç»„æˆã€‚\n\nè¿æ¥ä»¶è¡¨ç¤ºäº†æ„ä»¶ä¹‹é—´çš„äº¤äº’ï¼Œç®€å•çš„è¿æ¥ä»¶å¦‚ç®¡é“ã€è¿‡ç¨‹è°ƒç”¨ã€äº‹ä»¶å¹¿æ’­ç­‰ï¼Œæ›´ä¸ºå¤æ‚çš„äº¤äº’å¦‚å®¢æˆ·-æœåŠ¡å™¨é€šä¿¡åè®®ï¼Œæ•°æ®åº“å’Œåº”ç”¨ä¹‹é—´çš„SQLè¿æ¥ç­‰ã€‚\n\né…ç½®è¡¨ç¤ºæ„ä»¶å’Œè¿æ¥ä»¶çš„æ‹“æ‰‘é€»è¾‘å’Œçº¦æŸï¼›\n\næ„ä»¶çš„æ¥å£ç”±1ç»„ç«¯å£ç»„æˆï¼›æ¯ä¸ªç«¯å£è¡¨ç¤ºäº†æ„ä»¶å’Œå¤–éƒ¨ç¯å¢ƒçš„äº¤äº’ç‚¹ã€‚\n\nè¿æ¥ä»¶ä½œä¸ºå»ºæ¨¡è½¯ä»¶ä½“ç³»ç»“æ„çš„ä¸»è¦å®ä½“ï¼ŒåŒæ ·ä¹Ÿæœ‰æ¥å£ï¼Œè¿æ¥ä»¶çš„æ¥å£ç”±1ç»„è§’è‰²æ„æˆï¼›æ¯ä¸€ä¸ªè§’è‰²å®šä¹‰äº†è¯¥è¿æ¥ä»¶è¡¨ç¤ºçš„äº¤äº’çš„å‚ä¸è€…ã€‚\n\n# ç¬¬3ç«  è½¯ä»¶ä½“ç³»ç»“æ„é£æ ¼\n\n1. ç®¡é“/è¿‡æ»¤å™¨\n2. é¢å‘å¯¹è±¡é£æ ¼ï¼ˆæ•°æ®æŠ½è±¡ï¼‰\n3. åŸºäºäº‹ä»¶çš„ç³»ç»Ÿ\n4. åˆ†å±‚ç³»ç»Ÿï¼ˆå±‚æ¬¡ç»“æ„ï¼‰\n5. é»‘æ¿ç³»ç»Ÿï¼ˆä»“åº“ç³»ç»Ÿã€çŸ¥è¯†åº“ï¼‰\n6. C2ç³»ç»Ÿ\n\n## ç®¡é“/è¿‡æ»¤å™¨\n\n### ä¼˜ç‚¹\n\n1. ä½¿å¾—è½¯æ„ä»¶å…·æœ‰è‰¯å¥½çš„éšè”½æ€§å’Œé«˜å†…èšã€ä½è€¦åˆçš„ç‰¹ç‚¹ï¼›\n2. å…è®¸è®¾è®¡è€…å°†æ•´ä¸ªç³»ç»Ÿçš„è¾“å…¥/è¾“å‡ºè¡Œä¸ºçœ‹æˆæ˜¯å¤šä¸ªè¿‡æ»¤å™¨çš„è¡Œä¸ºçš„ç®€å•åˆæˆï¼›\n3. æ”¯æŒè½¯ä»¶é‡ç”¨ã€‚åªè¦æä¾›é€‚åˆåœ¨ä¸¤ä¸ªè¿‡æ»¤å™¨ä¹‹é—´ä¼ é€çš„æ•°æ®ï¼Œä»»ä½•ä¸¤ä¸ªè¿‡æ»¤å™¨éƒ½å¯è¢«è¿æ¥èµ·æ¥\n4. ç³»ç»Ÿç»´æŠ¤å’Œå¢å¼ºç³»ç»Ÿæ€§èƒ½ç®€å•ã€‚æ–°çš„è¿‡æ»¤å™¨å¯ä»¥æ·»åŠ åˆ°ç°æœ‰ç³»ç»Ÿä¸­æ¥ï¼›æ—§çš„å¯ä»¥è¢«æ”¹è¿›çš„è¿‡æ»¤å™¨æ›¿æ¢æ‰å…è®¸å¯¹ä¸€äº›å¦‚ååé‡ã€æ­»é”ç­‰å±æ€§çš„åˆ†æï¼›\n5. æ”¯æŒå¹¶è¡Œæ‰§è¡Œã€‚æ¯ä¸ªè¿‡æ»¤å™¨æ˜¯ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ä»»åŠ¡å®Œæˆï¼Œå› æ­¤å¯ä¸å…¶å®ƒä»»åŠ¡å¹¶è¡Œæ‰§è¡Œã€‚\n\n### ç¼ºç‚¹\n\n1. é€šå¸¸å¯¼è‡´è¿›ç¨‹æˆä¸ºæ‰¹å¤„ç†çš„ç»“æ„ã€‚è¿™æ˜¯å› ä¸ºè™½ç„¶è¿‡æ»¤å™¨å¯å¢é‡å¼åœ°å¤„ç†æ•°æ®ï¼Œä½†å®ƒä»¬æ˜¯ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥è®¾è®¡è€…å¿…é¡»å°†æ¯ä¸ªè¿‡æ»¤å™¨çœ‹æˆä¸€ä¸ªå®Œæ•´çš„ä»è¾“å…¥åˆ°è¾“å‡ºçš„è½¬æ¢ï¼›\n2. ä¸é€‚åˆå¤„ç†äº¤äº’çš„åº”ç”¨ã€‚å½“éœ€è¦å¢é‡åœ°æ˜¾ç¤ºæ”¹å˜æ—¶ï¼Œè¿™ä¸ªé—®é¢˜å°¤ä¸ºä¸¥é‡ï¼›\n3. å› ä¸ºåœ¨æ•°æ®ä¼ è¾“ä¸Šæ²¡æœ‰é€šç”¨çš„æ ‡å‡†ï¼Œæ¯ä¸ªè¿‡æ»¤å™¨éƒ½å¢åŠ äº†è§£æå’Œåˆæˆæ•°æ®çš„å·¥ä½œï¼Œè¿™æ ·å°±å¯¼è‡´äº†ç³»ç»Ÿæ€§èƒ½ä¸‹é™ï¼Œå¹¶å¢åŠ äº†ç¼–å†™è¿‡æ»¤å™¨çš„å¤æ‚æ€§ã€‚\n\n## æ•°æ®æŠ½è±¡å’Œé¢å‘å¯¹è±¡ç»„ç»‡\n\n### ä¼˜ç‚¹\n\n1. å› ä¸ºå¯¹è±¡å¯¹å…¶å®ƒå¯¹è±¡éšè—å®ƒçš„è¡¨ç¤ºï¼Œæ‰€ä»¥å¯ä»¥æ”¹å˜ä¸€ä¸ªå¯¹è±¡çš„è¡¨ç¤ºï¼Œè€Œä¸å½±å“å…¶å®ƒçš„å¯¹è±¡ï¼›\n2. è®¾è®¡è€…å¯å°†ä¸€äº›æ•°æ®å­˜å–æ“ä½œçš„é—®é¢˜åˆ†è§£æˆä¸€äº›äº¤äº’çš„ä»£ç†ç¨‹åºçš„é›†åˆã€‚\n\n### ç¼ºç‚¹\n\n1. ä¸ºäº†ä½¿ä¸€ä¸ªå¯¹è±¡å’Œå¦ä¸€ä¸ªå¯¹è±¡é€šè¿‡è¿‡ç¨‹è°ƒç”¨ç­‰è¿›è¡Œäº¤äº’,å¿…é¡»çŸ¥é“å¯¹è±¡çš„æ ‡è¯†ã€‚åªè¦ä¸€ä¸ªå¯¹è±¡çš„æ ‡è¯†æ”¹å˜äº†ï¼Œå°±å¿…é¡»ä¿®æ”¹æ‰€æœ‰å…¶ä»–æ˜ç¡®è°ƒç”¨å®ƒçš„å¯¹è±¡;\n2. å¿…é¡»ä¿®æ”¹æ‰€æœ‰æ˜¾å¼è°ƒç”¨å®ƒçš„å…¶å®ƒå¯¹è±¡ï¼Œå¹¶æ¶ˆé™¤ç”±æ­¤å¸¦æ¥çš„ä¸€äº›å‰¯ä½œç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœAä½¿ç”¨äº†å¯¹è±¡B,Cä¹Ÿä½¿ç”¨äº†å¯¹è±¡B,é‚£ä¹ˆ,Cå¯¹Bçš„ä½¿ç”¨æ‰€é€ æˆçš„å¯¹Açš„å½±å“å¯èƒ½æ˜¯æ–™æƒ³ä¸åˆ°çš„ã€‚\n\n## åŸºäºäº‹ä»¶çš„ç³»ç»Ÿï¼ˆéšå¼è°ƒç”¨é£æ ¼ï¼‰\n\nè¿™ç§é£æ ¼çš„ä¸»è¦ç‰¹ç‚¹æ˜¯äº‹ä»¶çš„è§¦å‘è€…å¹¶ä¸çŸ¥é“å“ªäº›æ„ä»¶ä¼šè¢«å“ªäº›äº‹ä»¶å½±å“ã€‚\n\nè¿™æ ·ä¸èƒ½å‡å®šæ„ä»¶çš„å¤„ç†é¡ºåºï¼Œç”šè‡³ä¸çŸ¥é“å“ªäº›è¿‡ç¨‹ä¼šè¢«è°ƒç”¨ï¼Œå› æ­¤ï¼Œè®¸å¤šéšå¼è°ƒç”¨çš„ç³»ç»Ÿä¹ŸåŒ…å«æ˜¾å¼è°ƒç”¨ä½œä¸ºæ„ä»¶äº¤äº’çš„è¡¥å……å½¢å¼ã€‚\n\n### ä¼˜ç‚¹\n\n1. ä¸ºè½¯ä»¶é‡ç”¨æä¾›äº†å¼ºå¤§çš„æ”¯æŒã€‚å½“éœ€è¦å°†ä¸€ä¸ªæ„ä»¶åŠ å…¥ç°å­˜ç³»ç»Ÿä¸­æ—¶ï¼Œåªéœ€å°†å®ƒæ³¨å†Œåˆ°ç³»ç»Ÿçš„äº‹ä»¶ä¸­ã€‚\n2. ä¸ºæ”¹è¿›ç³»ç»Ÿå¸¦æ¥äº†æ–¹ä¾¿ã€‚å½“ç”¨ä¸€ä¸ªæ„ä»¶ä»£æ›¿å¦ä¸€ä¸ªæ„ä»¶æ—¶ï¼Œä¸ä¼šå½±å“åˆ°å…¶å®ƒæ„ä»¶çš„æ¥å£ã€‚\n\n### ç¼ºç‚¹\n\n1. æ„ä»¶æ”¾å¼ƒäº†å¯¹ç³»ç»Ÿè®¡ç®—çš„æ§åˆ¶ã€‚ä¸€ä¸ªæ„ä»¶è§¦å‘ä¸€ä¸ªäº‹ä»¶æ—¶ï¼Œä¸èƒ½ç¡®å®šå…¶å®ƒæ„ä»¶æ˜¯å¦ä¼šå“åº”å®ƒã€‚è€Œä¸”å³ä½¿å®ƒçŸ¥é“äº‹ä»¶æ³¨å†Œäº†å“ªäº›æ„ä»¶çš„æ„æˆï¼Œå®ƒä¹Ÿä¸èƒ½ä¿è¯è¿™äº›è¿‡ç¨‹è¢«è°ƒç”¨çš„é¡ºåºã€‚\n2. æ•°æ®äº¤æ¢çš„é—®é¢˜ã€‚æœ‰æ—¶æ•°æ®å¯è¢«ä¸€ä¸ªäº‹ä»¶ä¼ é€’ï¼Œä½†å¦ä¸€äº›æƒ…å†µä¸‹åŸºäºäº‹ä»¶çš„ç³»ç»Ÿå¿…é¡»ä¾é ä¸€ä¸ªå…±äº«çš„ä»“åº“è¿›è¡Œäº¤äº’ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹å…¨å±€æ€§èƒ½å’Œèµ„æºç®¡ç†ä¾¿æˆäº†é—®é¢˜ã€‚\n3. æ—¢ç„¶è¿‡ç¨‹çš„è¯­ä¹‰å¿…é¡»ä¾èµ–äºè¢«è§¦å‘äº‹ä»¶çš„ä¸Šä¸‹æ–‡çº¦æŸï¼Œå…³äºæ­£ç¡®æ€§çš„æ¨ç†å­˜åœ¨é—®é¢˜ã€‚\n\n## åˆ†å±‚ç³»ç»Ÿ\n\nä»€ä¹ˆæ˜¯å±‚ï¼Ÿå±‚æ˜¯ä¸€ä¸ªå…·æœ‰ç›¸åŒå±æ€§çš„é›†åˆï¼›\n\nåˆ†å±‚æ˜¯ç†è§£é—®é¢˜çš„ä¸€ç§æ–¹æ³•è®ºï¼Œå¯ä»¥æŠŠå¤æ‚è½¯ä»¶ä»å¤§é—®é¢˜åˆ†ä¸ºå°é—®é¢˜ï¼Œä»è§†å›¾çš„è§’åº¦çœ‹å¯ä»¥é™ä½é—®é¢˜å¤æ‚åº¦ã€‚\n\n### ä¼˜ç‚¹\n\n1. æ”¯æŒåŸºäºæŠ½è±¡ç¨‹åº¦é€’å¢çš„ç³»ç»Ÿè®¾è®¡ï¼Œä½¿è®¾è®¡è€…å¯ä»¥æŠŠä¸€ä¸ªå¤æ‚ç³»ç»ŸæŒ‰é€’å¢çš„æ­¥éª¤è¿›è¡Œåˆ†è§£\n2. æ”¯æŒåŠŸèƒ½å¢å¼ºï¼Œå› ä¸ºæ¯ä¸€å±‚è‡³å¤šå’Œç›¸é‚»çš„ä¸Šä¸‹å±‚äº¤äº’ï¼Œå› æ­¤åŠŸèƒ½çš„æ”¹å˜æœ€å¤šå½±å“ç›¸é‚»çš„ä¸Šä¸‹å±‚ï¼›\n3. æ”¯æŒé‡ç”¨ã€‚åªè¦æä¾›çš„æœåŠ¡æ¥å£å®šä¹‰ä¸å˜ï¼ŒåŒä¸€å±‚çš„ä¸åŒå®ç°å¯ä»¥äº¤æ¢ä½¿ç”¨ã€‚è¿™æ ·ï¼Œå°±å¯ä»¥å®šä¹‰ä¸€ç»„æ ‡å‡†çš„æ¥å£ï¼Œè€Œå…è®¸å„ç§ä¸åŒçš„å®ç°æ–¹æ³•\n\n### ç¼ºç‚¹\n\n1. å¹¶ä¸æ˜¯æ¯ä¸ªç³»ç»Ÿéƒ½å¯ä»¥å¾ˆå®¹æ˜“åœ°åˆ’åˆ†ä¸ºåˆ†å±‚çš„æ¨¡å¼ï¼Œç”šè‡³å³ä½¿ä¸€ä¸ªç³»ç»Ÿçš„é€»è¾‘ç»“æ„æ˜¯å±‚æ¬¡åŒ–çš„ï¼Œå‡ºäºå¯¹ç³»ç»Ÿæ€§èƒ½çš„è€ƒè™‘ï¼Œç³»ç»Ÿè®¾è®¡å¸ˆä¸å¾—ä¸æŠŠä¸€äº›ä½çº§æˆ–é«˜çº§çš„åŠŸèƒ½ç»¼åˆèµ·æ¥ï¼›\n2. å¾ˆéš¾æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„ã€æ­£ç¡®çš„å±‚æ¬¡æŠ½è±¡æ–¹æ³•ã€‚\n\n## ä»“åº“ç³»ç»ŸåŠçŸ¥è¯†åº“\n\nåœ¨ä»“åº“ï¼ˆrepository)é£æ ¼ä¸­ï¼Œæœ‰ä¸¤ç§ä¸åŒçš„æ„ä»¶ï¼šä¸­å¤®æ•°æ®ç»“æ„è¯´æ˜å½“å‰çŠ¶æ€ï¼Œç‹¬ç«‹æ„ä»¶åœ¨ä¸­å¤®æ•°æ®å­˜å‚¨ä¸Šæ‰§è¡Œï¼Œä»“åº“ä¸å¤–æ„ä»¶é—´çš„ç›¸äº’ä½œç”¨åœ¨ç³»ç»Ÿä¸­ä¼šæœ‰å¤§çš„å˜åŒ–ã€‚\n\næ§åˆ¶åŸåˆ™çš„é€‰å–äº§ç”Ÿä¸¤ä¸ªä¸»è¦çš„å­ç±»ã€‚è‹¥è¾“å…¥æµä¸­æŸç±»æ—¶é—´è§¦å‘è¿›ç¨‹æ‰§è¡Œçš„é€‰æ‹©ï¼Œåˆ™ä»“åº“æ˜¯ä¸€ä¼ ç»Ÿå‹æ•°æ®åº“ï¼›å¦å¤–ï¼Œè‹¥ä¸­å¤®æ•°æ®ç»“æ„çš„å½“å‰çŠ¶æ€è§¦å‘è¿›ç¨‹æ‰§è¡Œçš„é€‰æ‹©ï¼Œåˆ™ä»“åº“æ˜¯ä¸€é»‘æ¿ç³»ç»Ÿã€‚\n\né»‘æ¿ç³»ç»Ÿçš„ä¼ ç»Ÿåº”ç”¨æ˜¯ä¿¡å·å¤„ç†é¢†åŸŸï¼Œå¦‚è¯­éŸ³å’Œæ¨¡å¼è¯†åˆ«ï¼Œå¦ä¸€åº”ç”¨æ˜¯æ¾è—•åˆä»£ç†æ•°æ®å…±äº«å­˜å–ã€‚\n\né»‘æ¿ç³»ç»Ÿä¸»è¦ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š\n\n1. çŸ¥è¯†æºã€‚çŸ¥è¯†æºä¸­åŒ…å«ç‹¬ç«‹çš„ã€ä¸åº”ç”¨ç¨‹åºç›¸å…³çš„çŸ¥è¯†ï¼ŒçŸ¥è¯†æºä¹‹é—´ä¸ç›´æ¥è¿›è¡Œé€šä¿¡ï¼Œå®ƒä»¬ä¹‹é—´çš„äº¤äº’åªé€šè¿‡é»‘æ¿æ¥å®Œæˆã€‚\n2. é»‘æ¿æ•°æ®ç»“æ„ã€‚é»‘æ¿æ•°æ®æ˜¯æŒ‰ç…§ä¸åº”ç”¨ç¨‹åºç›¸å…³çš„å±‚æ¬¡æ¥ç»„ç»‡çš„è§£å†³é—®é¢˜çš„æ•°æ®ï¼ŒçŸ¥è¯†æºé€šè¿‡ä¸æ–­åœ°æ”¹å˜é»‘æ¿æ•°æ®æ¥è§£å†³é—®é¢˜ã€‚\n3. æ§åˆ¶ã€‚æ§åˆ¶å®Œå…¨ç”±é»‘æ¿çš„çŠ¶æ€é©±åŠ¨ï¼Œé»‘æ¿çŠ¶æ€çš„æ”¹å˜å†³å®šä½¿ç”¨çš„ç‰¹å®šçŸ¥è¯†ã€‚\n\n## C2é£æ ¼\n\nC2ä½“ç³»ç»“æ„é£æ ¼å¯ä»¥æ¦‚æ‹¬ä¸ºï¼šé€šè¿‡è¿æ¥ä»¶ç»‘å®šåœ¨ä¸€èµ·çš„æŒ‰ç…§ä¸€ç»„è§„åˆ™è¿ä½œçš„å¹¶è¡Œæ„ä»¶ç½‘ç»œã€‚C2é£æ ¼ä¸­çš„ç³»ç»Ÿç»„ç»‡è§„åˆ™å¦‚ä¸‹ï¼š\n\n1. ç³»ç»Ÿä¸­çš„æ„ä»¶å’Œè¿æ¥ä»¶éƒ½æœ‰ä¸€ä¸ªé¡¶éƒ¨å’Œä¸€ä¸ªåº•éƒ¨ã€‚\n2. æ„ä»¶çš„é¡¶éƒ¨åº”è¿æ¥åˆ°æŸè¿æ¥ä»¶çš„åº•éƒ¨ï¼Œæ„ä»¶çš„åº•éƒ¨åˆ™åº”è¿æ¥åˆ°æŸè¿æ¥ä»¶çš„é¡¶éƒ¨ï¼Œè€Œæ„ä»¶ä¸æ„ä»¶ä¹‹é—´çš„ç›´æ¥è¿æ¥æ˜¯ä¸å…è®¸çš„ã€‚\n3. ä¸€ä¸ªè¿æ¥ä»¶å¯ä»¥å’Œä»»æ„æ•°ç›®çš„å…¶ä»–æ„ä»¶å’Œè¿æ¥ä»¶è¿æ¥ã€‚\n4. å½“ä¸¤ä¸ªè¿æ¥ä»¶è¿›è¡Œç›´æ¥è¿æ¥æ—¶ï¼Œå¿…é¡»ç”±å…¶ä¸­ä¸€ä¸ªçš„åº•éƒ¨åˆ°å¦ä¸€ä¸ªçš„é¡¶éƒ¨ã€‚\n\n### ç‰¹ç‚¹\n\n1. ç³»ç»Ÿä¸­çš„æ„ä»¶å¯å®ç°åº”ç”¨éœ€æ±‚,å¹¶èƒ½å°†ä»»æ„å¤æ‚åº¦çš„åŠŸèƒ½å°è£…åœ¨ä¸€èµ·;\n2. æ‰€æœ‰æ„ä»¶ä¹‹é—´çš„é€šè®¯æ˜¯é€šè¿‡ä»¥è¿æ¥ä»¶ä¸ºä¸­ä»‹çš„å¼‚æ­¥æ¶ˆæ¯äº¤æ¢æœºåˆ¶æ¥å®ç°çš„;\n3. æ„ä»¶ç›¸å¯¹ç‹¬ç«‹,æ„ä»¶ä¹‹é—´ä¾èµ–æ€§è¾ƒå°‘ã€‚ç³»ç»Ÿä¸­ä¸å­˜åœ¨æŸäº›æ„ä»¶å°†åœ¨åŒä¸€åœ°å€ç©ºé—´å†…æ‰§è¡Œ,æˆ–æŸäº›æ„ä»¶å…±äº«ç‰¹å®šæ§åˆ¶çº¿ç¨‹ä¹‹ç±»çš„ç›¸å…³æ€§å‡è®¾ã€‚\n\n# äºŒå±‚C/S - å®¢æˆ·/æœåŠ¡å™¨é£æ ¼\n\nC/Sè½¯ä»¶ä½“ç³»ç»“æ„æ˜¯åŸºäºèµ„æºä¸å¯¹ç­‰ï¼Œä¸”ä¸ºå®ç°å…±äº«è€Œæå‡ºæ¥çš„ï¼Œæ˜¯20ä¸–çºª90å¹´ä»£æˆç†Ÿèµ·æ¥çš„æŠ€æœ¯ï¼ŒC/Sä½“ç³»ç»“æ„å®šä¹‰äº†å·¥ä½œç«™å¦‚ä½•ä¸æœåŠ¡å™¨ç›¸è¿ï¼Œä»¥å®ç°æ•°æ®å’Œåº”ç”¨åˆ†å¸ƒåˆ°å¤šä¸ªå¤„ç†æœºä¸Šã€‚\n\nC/Sä½“ç³»ç»“æ„æœ‰ä¸‰ä¸ªä¸»è¦ç»„æˆéƒ¨åˆ†ï¼šæ•°æ®åº“æœåŠ¡å™¨ã€å®¢æˆ·åº”ç”¨ç¨‹åºå’Œç½‘ç»œã€‚\n\nå‰å°ä¸»è¦æ˜¯æ•°æ®çš„æ˜¾ç¤ºå’Œåˆ†æï¼Œå®Œæˆä¸ç”¨æˆ·çš„äº¤äº’ï¼Œåå°ä¸»è¦æ˜¯æ•°æ®çš„ç®¡ç†ã€‚\n\n## ä¸€èˆ¬å¤„ç†æµç¨‹\n\n1. åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œå³ä¸€å…±ä¸¤å±‚ï¼Œå‰å°/åå°ï¼›å‰å°å³ä¸ºå®¢æˆ·ç«¯ï¼Œåå°å³ä¸ºæœåŠ¡å™¨ç«¯ï¼›\n2. å‰å°ï¼šè¡¨ç¤ºå±‚ï¼Œå³ç•Œé¢ï¼Œè¾“å…¥æ•°æ®ï¼Œæäº¤è¯·æ±‚ï¼Œä¸šåŠ¡å¤„ç†å¼€å§‹ï¼Œæ•°æ®å­˜å–è¯·æ±‚å‘ç»™åå°ï¼›\n3. åå°ï¼šåå°çš„æ•°æ®å­˜å–ç¨‹åºæ”¶åˆ°å‰å°æäº¤çš„è¯·æ±‚ï¼Œæ•°æ®å¤„ç†å¼€å§‹ï¼Œå¯¹åå°çš„æ•°æ®å±‚è¿›è¡Œæ•°æ®å­˜å–è¯·æ±‚ï¼ŒSQLè¯·æ±‚å¼€å§‹ï¼ŒDBMSæ‰§è¡ŒSQLï¼ŒSQLè¯·æ±‚ç»“æŸï¼Œæ•°æ®å¤„ç†ç»“æŸï¼Œè¿è¡Œç»“æœè¿”å›ç»™å‰å°ï¼›\n4. å‰å°ï¼šæ¥æ”¶åˆ°è¿è¡Œç»“æœï¼Œä¸šåŠ¡å¤„ç†ç»“æŸï¼Œå¤„ç†ç»“æœè¾“å‡ºåˆ°ç•Œé¢\n\n## å®¢æˆ·ç«¯\n\n1. è¦æœ‰é€»è¾‘è®¡ç®—èƒ½åŠ›ï¼Œå³å¯¹å®¢æˆ·ç«¯çš„ç¡¬ä»¶æœ‰è¦æ±‚ï¼Œå¦‚æœå®¢æˆ·ç«¯æ•ˆç‡ä½ï¼Œä¼šå½±å“æ•´ä½“ç³»ç»Ÿæ•ˆç‡ï¼›\n\n## æœåŠ¡å™¨ç«¯\n\nåå°ä¸»è¦æ˜¯æ•°æ®çš„ç®¡ç†ã€‚è¦æœ‰æ•°æ®åº“ä»¥åŠç›¸åº”çš„æ“ä½œï¼›\n\n## ä¼˜ç‚¹\n\nä¸»è¦åœ¨äºï¼Œå®¢æˆ·åº”ç”¨ç¨‹åºå’ŒæœåŠ¡å™¨æ„ä»¶åˆ†åˆ«è¿è¡Œåœ¨ä¸åŒçš„è®¡ç®—æœºä¸Šï¼Œç³»ç»Ÿä¸­æ¯å°æœåŠ¡å™¨éƒ½å¯ä»¥é€‚åˆå„æ„ä»¶çš„è¦æ±‚ï¼Œè¿™å¯¹äºç¡¬ä»¶å’Œè½¯ä»¶çš„å˜åŒ–æ˜¾ç¤ºå‡ºæå¤§çš„é€‚åº”æ€§å’Œçµæ´»æ€§ï¼Œè€Œä¸”æ˜“äºå¯¹ç³»ç»Ÿè¿›è¡Œæ‰©å……å’Œç¼©å°ã€‚\n\nç³»ç»Ÿä¸­çš„åŠŸèƒ½æ„ä»¶å……åˆ†éš”ç¦»ï¼Œå®¢æˆ·åº”ç”¨ç¨‹åºçš„å¼€å‘é›†ä¸­äºæ•°æ®çš„æ˜¾ç¤ºå’Œåˆ†æï¼›è€Œæ•°æ®åº“æœåŠ¡å™¨çš„å¼€å‘åˆ™é›†ä¸­äºæ•°æ®çš„ç®¡ç†ï¼Œä¸å¿…åœ¨æ¯ä¸€ä¸ªæ–°çš„åº”ç”¨ç¨‹åºéƒ½è¦å¯¹ä¸€ä¸ªDBMSè¿›è¡Œç¼–ç ã€‚å°†å¤§çš„åº”ç”¨å¤„ç†ä»»åŠ¡åˆ†å¸ƒåˆ°è®¸å¤šé€šè¿‡ç½‘ç»œè¿æ¥çš„ä½æˆæœ¬è®¡ç®—æœºä¸Šï¼Œä»¥èŠ‚çº¦å¤§é‡è´¹ç”¨ã€‚\n\n## ç¼ºç‚¹\n\n1. å¼€å‘æˆæœ¬è¾ƒé«˜ã€‚å¯¹å®¢æˆ·ç«¯è½¯ç¡¬ä»¶é…ç½®è¦æ±‚è¾ƒé«˜ï¼Œå°¤å…¶æ˜¯è½¯ä»¶çš„ä¸æ–­å‡çº§ï¼Œå¯¹ç¡¬ä»¶è¦æ±‚ä¸æ–­æé«˜ï¼Œå¢åŠ äº†æ•´ä¸ªç³»ç»Ÿçš„æˆæœ¬ï¼Œå®¢æˆ·ç«¯å˜å¾—è‡ƒè‚¿ã€‚\n2. å®¢æˆ·ç«¯ç¨‹åºè®¾è®¡å¤æ‚ã€‚\n3. ä¿¡æ¯å†…å®¹å’Œå½¢å¼å•ä¸€\n4. ç”¨æˆ·ç•Œé¢é£æ ¼ä¸ä¸€ï¼Œä½¿ç”¨ç¹æ‚ï¼Œä¸åˆ©äºæ¨å¹¿ä½¿ç”¨ï¼›\n5. è½¯ä»¶ç§»æ¤å›°éš¾ï¼Œä¸åŒå¹³å°äº’ä¸å…¼å®¹ã€‚\n6. è½¯ä»¶ç»´æŠ¤å’Œå‡çº§å›°éš¾ï¼Œæ¯ä¸ªå®¢æˆ·æœºéƒ½éœ€è¦å‡çº§ã€ç»´æŠ¤ã€‚\n7. æ–°æŠ€æœ¯ä¸èƒ½è½»æ˜“åº”ç”¨ã€‚\n\n# ä¸‰å±‚C/S - å®¢æˆ·/æœåŠ¡å™¨é£æ ¼\n\nä¸äºŒå±‚çš„åŒºåˆ«å°±æ˜¯åœ¨ä¸­é—´åŠ äº†ä¸€ä¸ªåº”ç”¨æœåŠ¡å™¨ï¼ˆåŠŸèƒ½å±‚ï¼‰ï¼Œè€Œä¸æ˜¯å’Œæ•°æ®åº“æœåŠ¡å™¨ç›´æ¥ç›¸è¿ï¼›\n\nè¿™æ ·ï¼Œé™ä½äº†å®¢æˆ·æœºçš„è´Ÿæ‹…ï¼ŒæŠŠæ•°æ®çš„è®¡ç®—ä»»åŠ¡äº¤ç»™äº†ä¸­é—´çš„åŠŸèƒ½å±‚ï¼Œç°åœ¨ï¼Œå®¢æˆ·æœºçš„è¡¨ç¤ºå±‚åªæ˜¯ä½œä¸ºæ•°æ®çš„æ˜¾ç¤ºäº†ã€‚\n\n1. è¡¨ç¤ºå±‚\n   1. è¡¨ç¤ºå±‚æ˜¯åº”ç”¨çš„ç”¨æˆ·æ¥å£éƒ¨åˆ†,å®ƒæ‹…è´Ÿç€ç”¨æˆ·ä¸åº”ç”¨é—´çš„å¯¹è¯åŠŸèƒ½ã€‚å®ƒç”¨äºæ£€æŸ¥ç”¨æˆ·ä»é”®ç›˜ç­‰è¾“å…¥çš„æ•°æ®,æ˜¾ç¤ºåº”ç”¨è¾“å‡ºçš„æ•°æ®ã€‚ä¸ºä½¿ç”¨æˆ·èƒ½ç›´è§‚åœ°è¿›è¡Œæ“ä½œ,ä¸€èˆ¬è¦ä½¿ç”¨å›¾å½¢ç”¨æˆ·ç•Œé¢(Graphic User Interface,GUI),æ“ä½œç®€å•ã€æ˜“å­¦æ˜“ç”¨ã€‚åœ¨å˜æ›´ç”¨æˆ·ç•Œé¢æ—¶,åªéœ€æ”¹å†™æ˜¾ç¤ºæ§åˆ¶å’Œæ•°æ®æ£€æŸ¥ç¨‹åº,è€Œä¸å½±å“å…¶ä»–ä¸¤å±‚ã€‚æ£€æŸ¥çš„å†…å®¹ä¹Ÿåªé™äºæ•°æ®çš„å½¢å¼å’Œå–å€¼çš„èŒƒå›´,ä¸åŒ…æ‹¬æœ‰å…³ä¸šåŠ¡æœ¬èº«çš„å¤„ç†é€»è¾‘\n2. åŠŸèƒ½å±‚\n   1. åŠŸèƒ½å±‚ç›¸å½“äºåº”ç”¨çš„æœ¬ä½“,å®ƒæ˜¯å°†å…·ä½“çš„ä¸šåŠ¡å¤„ç†é€»è¾‘ç¼–äººç¨‹åºä¸­ã€‚ä¾‹å¦‚,åœ¨åˆ¶ä½œè®¢è´­åˆåŒæ—¶è¦è®¡ç®—åˆåŒé‡‘é¢,æŒ‰ç…§å®šå¥½çš„æ ¼å¼é…ç½®æ•°æ®ã€æ‰“å°è®¢è´­åˆåŒ,è€Œå¤„ç†æ‰€éœ€çš„æ•°æ®åˆ™è¦ä»è¡¨ç¤ºå±‚æˆ–æ•°æ®å±‚å–å¾—ã€‚è¡¨ç¤ºå±‚å’ŒåŠŸèƒ½å±‚ä¹‹é—´çš„æ•°æ®äº¤å¾€è¦å°½å¯èƒ½ç®€æ·ã€‚ä¾‹å¦‚,ç”¨æˆ·æ£€ç´¢æ•°æ®æ—¶,è¦è®¾æ³•å°†æœ‰å…³æ£€ç´¢è¦æ±‚çš„ä¿¡æ¯ä¸€æ¬¡æ€§åœ°ä¼ é€ç»™åŠŸèƒ½å±‚,è€Œç”±åŠŸèƒ½å±‚å¤„ç†è¿‡çš„æ£€ç´¢ç»“æœæ•°æ®ä¹Ÿä¸€æ¬¡æ€§åœ°ä¼ é€ç»™è¡¨ç¤ºå±‚ã€‚\n   2. é€šå¸¸,åœ¨åŠŸèƒ½å±‚ä¸­åŒ…å«ç¡®è®¤ç”¨æˆ·å¯¹åº”ç”¨å’Œæ•°æ®åº“å­˜å–æƒé™çš„åŠŸèƒ½ä»¥åŠè®°å½•ç³»ç»Ÿå¤„ç†æ—¥å¿—çš„åŠŸèƒ½ã€‚åŠŸèƒ½å±‚çš„ç¨‹åºå¤šåŠæ˜¯ç”¨å¯è§†åŒ–ç¼–ç¨‹å·¥å…·å¼€å‘çš„,ä¹Ÿæœ‰ä½¿ç”¨COBOLå’ŒCè¯­è¨€çš„\n3. æ•°æ®å±‚\n   1. æ•°æ®å±‚å°±æ˜¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ,è´Ÿè´£ç®¡ç†å¯¹æ•°æ®åº“æ•°æ®çš„è¯»å†™ã€‚æ•°æ®åº“ç®¡ç†ç³»ç»Ÿå¿…é¡»èƒ½è¿…é€Ÿæ‰§è¡Œå¤§é‡æ•°æ®çš„æ›´æ–°å’Œæ£€ç´¢ã€‚ç°åœ¨çš„ä¸»æµæ˜¯å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ(RDBMS),å› æ­¤,èˆ¬ä»åŠŸèƒ½å±‚ä¼ é€åˆ°æ•°æ®å±‚çš„è¦æ±‚å¤§éƒ½ä½¿ç”¨SQLã€‚\n   2. ä¸‰å±‚C/Sçš„è§£å†³æ–¹æ¡ˆæ˜¯:å¯¹è¿™ä¸‰å±‚è¿›è¡Œæ˜ç¡®åˆ†å‰²,å¹¶åœ¨é€»è¾‘ä¸Šä½¿å…¶ç‹¬ç«‹ã€‚åŸæ¥çš„æ•°æ®å±‚ä½œä¸ºæ•°æ®åº“ç®¡ç†ç³»ç»Ÿå·²ç»ç‹¬ç«‹å‡ºæ¥,æ‰€ä»¥,å…³é”®æ˜¯è¦å°†è¡¨ç¤ºå±‚å’ŒåŠŸèƒ½å±‚åˆ†ç¦»æˆå„è‡ªç‹¬ç«‹çš„ç¨‹åº,å¹¶ä¸”è¿˜è¦ä½¿è¿™ä¸¤å±‚é—´çš„æ¥å£ç®€æ´æ˜äº†ã€‚\n\n## ä¼˜ç‚¹\n\næ ¹æ®ä¸‰å±‚C/Sçš„æ¦‚å¿µåŠä½¿ç”¨å®ä¾‹å¯ä»¥çœ‹å‡ºï¼Œä¸ä¸¤å±‚C/Sç»“æ„ç›¸æ¯”ï¼Œä¸‰å±‚C/Sç»“æ„å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š\n\n1. å…è®¸åˆç†åœ°åˆ’åˆ†ä¸‰å±‚ç»“æ„çš„åŠŸèƒ½ï¼Œä½¿ä¹‹åœ¨é€»è¾‘ä¸Šä¿æŒç›¸å¯¹ç‹¬ç«‹æ€§ï¼Œä»è€Œä½¿æ•´ä¸ªç³»ç»Ÿçš„é€»è¾‘ç»“æ„æ›´ä¸ºæ¸…æ™°ï¼Œèƒ½æé«˜ç³»ç»Ÿå’Œè½¯ä»¶çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚\n2. å…è®¸æ›´çµæ´»æœ‰æ•ˆåœ°é€‰ç”¨ç›¸åº”çš„å¹³å°å’Œç¡¬ä»¶ç³»ç»Ÿï¼Œä½¿ä¹‹åœ¨å¤„ç†è´Ÿè·èƒ½åŠ›ä¸Šä¸å¤„ç†ç‰¹æ€§ä¸Šåˆ†åˆ«é€‚åº”äºç»“æ„æ¸…æ™°çš„ä¸‰å±‚ï¼›å¹¶ä¸”è¿™äº›å¹³å°å’Œå„ä¸ªç»„æˆéƒ¨åˆ†å¯ä»¥å…·æœ‰è‰¯å¥½çš„å¯å‡çº§æ€§å’Œå¼€æ”¾æ€§ã€‚ä¾‹å¦‚ï¼Œæœ€åˆç”¨ä¸€å°UNIXå·¥ä½œç«™ä½œä¸ºæœåŠ¡å™¨ï¼Œå°†æ•°æ®å±‚å’ŒåŠŸèƒ½å±‚éƒ½é…ç½®åœ¨è¿™å°æœåŠ¡å™¨ä¸Šã€‚éšç€ä¸šåŠ¡çš„å‘å±•ï¼Œç”¨æˆ·æ•°å’Œæ•°æ®é‡é€æ¸å¢åŠ ï¼Œè¿™æ—¶ï¼Œå°±å¯ä»¥å°†UNIXå·¥ä½œç«™ä½œä¸ºåŠŸèƒ½å±‚çš„ä¸“ç”¨æœåŠ¡å™¨ï¼Œå¦å¤–è¿½åŠ ä¸€å°ä¸“ç”¨äºæ•°æ®å±‚çš„æœåŠ¡å™¨ã€‚è‹¥ä¸šåŠ¡è¿›ä¸€æ­¥æ‰©å¤§ï¼Œç”¨æˆ·æ•°è¿›ä¸€æ­¥å¢åŠ ï¼Œåˆ™å¯ä»¥ç»§ç»­å¢åŠ åŠŸèƒ½å±‚çš„æœåŠ¡å™¨æ•°ç›®ï¼Œç”¨ä»¥åˆ†å‰²æ•°æ®åº“ã€‚æ¸…æ™°ã€åˆç†åœ°åˆ†å‰²ä¸‰å±‚ç»“æ„å¹¶ä½¿å…¶ç‹¬ç«‹ï¼Œå¯ä»¥ä½¿ç³»ç»Ÿæ„æˆçš„å˜æ›´éå¸¸ç®€å•ã€‚å› æ­¤ï¼Œè¢«åˆ†æˆä¸‰å±‚çš„åº”ç”¨åŸºæœ¬ä¸Šä¸éœ€è¦ä¿®æ­£ã€‚\n3. ä¸‰å±‚C/Sç»“æ„ä¸­ï¼Œåº”ç”¨çš„å„å±‚å¯ä»¥å¹¶è¡Œå¼€å‘ï¼Œå„å±‚ä¹Ÿå¯ä»¥é€‰æ‹©å„è‡ªæœ€é€‚åˆçš„å¼€å‘è¯­è¨€ã€‚ä½¿ä¹‹èƒ½å¹¶è¡Œåœ°è€Œä¸”æ˜¯é«˜æ•ˆåœ°è¿›è¡Œå¼€å‘ï¼Œè¾¾åˆ°è¾ƒé«˜çš„æ€§èƒ½ä»·æ ¼æ¯”ï¼›å¯¹æ¯ä¸€å±‚çš„å¤„ç†é€»è¾‘çš„å¼€å‘å’Œç»´æŠ¤ä¹Ÿä¼šæ›´å®¹æ˜“äº›ã€‚\n4. å…è®¸å……åˆ†åˆ©ç”¨åŠŸèƒ½å±‚æœ‰æ•ˆåœ°éš”ç¦»å¼€è¡¨ç¤ºå±‚ä¸æ•°æ®å±‚ï¼Œæœªæˆæƒçš„ç”¨æˆ·éš¾ä»¥ç»•è¿‡åŠŸèƒ½å±‚è€Œåˆ©ç”¨æ•°æ®åº“å·¥å…·æˆ–é»‘å®¢æ‰‹æ®µå»éæ³•åœ°è®¿é—®æ•°æ®å±‚ï¼Œè¿™å°±ä¸ºä¸¥æ ¼çš„å®‰å…¨ç®¡ç†å¥ å®šäº†åšå®çš„åŸºç¡€ï¼›æ•´ä¸ªç³»ç»Ÿçš„ç®¡ç†å±‚æ¬¡ä¹Ÿæ›´åŠ åˆç†å’Œå¯æ§åˆ¶ã€‚\n\n# B/S - æµè§ˆ/æœåŠ¡å™¨é£æ ¼\n\næ˜¯ä»ä¸‰å±‚C/Sä½“ç³»ç»“æ„å˜åŒ–è€Œæ¥ï¼Œä½†ä¸æ˜¯C/Sçš„åŠ å¼ºç‰ˆï¼Œè€Œæ˜¯ä¸€ç§æ–°çš„ä½“ç³»ç»“æ„ã€‚\n\nç»„æˆï¼šæµè§ˆå™¨/WebæœåŠ¡å™¨/æ•°æ®åº“æœåŠ¡å™¨\n\n## ä¼˜ç‚¹\n\nB/Sä½“ç³»ç»“æ„ä¸»è¦æ˜¯åˆ©ç”¨ä¸æ–­æˆç†Ÿçš„WWWæµè§ˆå™¨æŠ€æœ¯ï¼Œç»“åˆæµè§ˆå™¨çš„å¤šç§è„šæœ¬è¯­è¨€ï¼Œç”¨é€šç”¨æµè§ˆå™¨å°±å®ç°äº†åŸæ¥éœ€è¦å¤æ‚çš„ä¸“ç”¨è½¯ä»¶æ‰èƒ½å®ç°çš„å¼ºå¤§åŠŸèƒ½ï¼Œå¹¶èŠ‚çº¦äº†å¼€å‘æˆæœ¬ã€‚ä»æŸç§ç¨‹åº¦ä¸Šæ¥è¯´ï¼ŒB/Sç»“æ„æ˜¯ä¸€ç§å…¨æ–°çš„è½¯ä»¶ä½“ç³»ç»“æ„ã€‚\n\nåœ¨B/Sç»“æ„ä¸­ï¼Œ é™¤äº†æ•°æ®åº“æœåŠ¡å™¨å¤–ï¼Œåº”ç”¨ç¨‹åºä»¥ç½‘é¡µå½¢å¼å­˜æ”¾äºWebæœåŠ¡å™¨ä¸Šï¼Œç”¨æˆ·è¿è¡ŒæŸä¸ªåº”ç”¨ç¨‹åºæ—¶åªé¡»åœ¨å®¢æˆ·ç«¯ä¸Šçš„æµè§ˆå™¨ä¸­è¾“äººç›¸åº”çš„ç½‘å€ï¼Œè°ƒç”¨WebæœåŠ¡å™¨ä¸Šçš„åº”ç”¨ç¨‹åºå¹¶å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œå®Œæˆç›¸åº”çš„æ•°æ®å¤„ç†å·¥ä½œï¼Œæœ€åå°†ç»“æœé€šè¿‡æµè§ˆå™¨æ˜¾ç¤ºç»™ç”¨æˆ·ã€‚å¯ä»¥è¯´ï¼Œåœ¨B/Sæ¨¡å¼çš„è®¡ç®—æœºåº”ç”¨ç³»ç»Ÿä¸­ï¼Œåº”ç”¨(ç¨‹åº)åœ¨ä¸€å®šç¨‹åº¦ä¸Šå…·æœ‰é›†ä¸­ç‰¹å¾åŸºäºB/Sä½“ç³»ç»“æ„çš„è½¯ä»¶ï¼Œç³»ç»Ÿå®‰è£…ã€ä¿®æ”¹å’Œç»´æŠ¤å…¨åœ¨æœåŠ¡å™¨ç«¯è§£å†³ã€‚ç”¨æˆ·åœ¨ä½¿ç”¨ç³»ç»Ÿæ—¶ï¼Œä»…éœ€è¦ä¸€ä¸ªæµè§ˆå™¨å°±å¯è¿è¡Œå…¨éƒ¨çš„æ¨¡å—ï¼ŒçœŸæ­£è¾¾åˆ°äº†â€œé›¶å®¢æˆ·ç«¯â€çš„åŠŸèƒ½ï¼Œå¾ˆå®¹æ˜“åœ¨è¿è¡Œæ—¶è‡ªåŠ¨å‡çº§ã€‚B/Sä½“ç³»ç»“æ„è¿˜æä¾›äº†å¼‚ç§æœºã€å¼‚ç§ç½‘ã€å¼‚ç§åº”ç”¨æœåŠ¡çš„è”æœºã€è”ç½‘ã€ç»Ÿä¸€æœåŠ¡çš„æœ€ç°å®çš„å¼€æ”¾æ€§åŸºç¡€ã€‚\n\n## ç¼ºç‚¹\n\nä¸C/Sä½“ç³»ç»“æ„ç›¸æ¯”ï¼ŒB/Sä½“ç³»ç»“æ„ä¹Ÿæœ‰è®¸å¤šä¸è¶³ä¹‹å¤„ï¼Œä¾‹å¦‚ï¼š\n\n1. B/Sä½“ç³»ç»“æ„ç¼ºä¹å¯¹åŠ¨æ€é¡µé¢çš„æ”¯æŒèƒ½åŠ›ï¼Œæ²¡æœ‰é›†æˆæœ‰æ•ˆçš„æ•°æ®åº“å¤„ç†åŠŸèƒ½ã€‚\n2. B/Sä½“ç³»ç»“æ„çš„ç³»ç»Ÿæ‰©å±•èƒ½åŠ›å·®ï¼Œå®‰å…¨æ€§éš¾ä»¥æ§åˆ¶ã€‚\n3. é‡‡ç”¨B/Sä½“ç³»ç»“æ„çš„åº”ç”¨ç³»ç»Ÿï¼Œåœ¨æ•°æ®æŸ¥è¯¢ç­‰å“åº”é€Ÿåº¦ä¸Šï¼Œè¦è¿œè¿œä½äºC/Sä½“ç³»ç»“æ„\n4. B/Sä½“ç³»ç»“æ„çš„æ•°æ®æäº¤ä¸€èˆ¬ä»¥é¡µé¢ä¸ºå•ä½ï¼Œæ•°æ®çš„åŠ¨æ€äº¤äº’æ€§ä¸å¼ºï¼Œä¸åˆ©äºåœ¨çº¿äº‹åŠ¡å¤„ç†(OnLine Transaction Processing,OLTP)åº”ç”¨ã€‚\n\nå› æ­¤ï¼Œè™½ç„¶B/Sç»“æ„çš„è®¡ç®—æœºåº”ç”¨ç³»ç»Ÿæœ‰å¦‚æ­¤å¤šçš„ä¼˜è¶Šæ€§ï¼Œä½†ç”±äºC/Sç»“æ„çš„æˆç†Ÿæ€§ä¸”C/Sç»“æ„çš„è®¡ç®—æœºåº”ç”¨ç³»ç»Ÿç½‘ç»œè´Ÿè½½è¾ƒå°ï¼Œå› æ­¤ï¼Œæœªæ¥ä¸€æ®µæ—¶é—´å†…ï¼Œå°†æ˜¯B/Sç»“æ„å’ŒC/Sç»“æ„å…±å­˜çš„æƒ…å†µã€‚ä½†æ˜¯ï¼Œå¾ˆæ˜¾ç„¶ï¼Œè®¡ç®—æœºåº”ç”¨ç³»ç»Ÿè®¡ç®—æ¨¡å¼çš„å‘å±•è¶‹åŠ¿æ˜¯å‘B/Sç»“æ„è½¬å˜ã€‚\n\n# æ­£äº¤è½¯ä»¶ä½“ç³»ç»“æ„\n\nä»€ä¹ˆæ˜¯æ­£äº¤ï¼Ÿåœ¨çº¿æ€§ä»£æ•°ä¸­è¡¨ç¤ºå†…ç§¯ä¸º0ã€‚åœ¨è½¯ä»¶ä¸­è¡¨ç¤ºçš„æ˜¯ä¸¤è€…ç‹¬ç«‹æ€§é«˜ï¼Œç›¸äº’çš„å½±å“æœ€å°ã€‚ç›¸æ¯”äºä½è€¦åˆçš„æ¦‚å¿µï¼Œæ›´åŠ ä½è€¦åˆï¼Œç”šè‡³äºé›¶è€¦åˆã€‚\n\n## æ¦‚å¿µ\n\næ­£äº¤è½¯ä»¶ä½“ç³»ç»“æ„ç”±ç»„ç»‡å±‚å’Œçº¿ç´¢çš„æ„ä»¶æ„æˆã€‚å±‚æ˜¯ç”±ä¸€ç»„å…·æœ‰ç›¸åŒæŠ½è±¡çº§åˆ«çš„æ„ä»¶æ„æˆã€‚çº¿ç´¢æ˜¯å­ç³»ç»Ÿçš„ç‰¹ä¾‹,å®ƒæ˜¯ç”±å®Œæˆä¸åŒå±‚æ¬¡åŠŸèƒ½çš„æ„ä»¶ç»„æˆ(é€šè¿‡ç›¸äº’è°ƒç”¨æ¥å…³è”),æ¯ä¸€æ¡çº¿ç´¢å®Œæˆæ•´ä¸ªç³»ç»Ÿä¸­ç›¸å¯¹ç‹¬ç«‹çš„ä¸€éƒ¨åˆ†åŠŸèƒ½ã€‚æ¯ä¸€æ¡çº¿ç´¢çš„å®ç°ä¸å…¶ä»–çº¿ç´¢çš„å®ç°æ— å…³æˆ–å…³è”å¾ˆå°‘,åœ¨åŒä¸€å±‚ä¸­çš„æ„ä»¶ä¹‹é—´æ˜¯ä¸å­˜åœ¨ç›¸äº’è°ƒç”¨çš„ã€‚\n\nå¦‚æœçº¿ç´¢æ˜¯ç›¸äº’ç‹¬ç«‹çš„,å³ä¸åŒçº¿ç´¢ä¸­çš„æ„ä»¶ä¹‹é—´æ²¡æœ‰ç›¸äº’è°ƒç”¨,é‚£ä¹ˆè¿™ä¸ªç»“æ„å°±æ˜¯å®Œå…¨æ­£äº¤çš„ã€‚\n\n## ç‰¹å¾\n\n1. æ­£äº¤è½¯ä»¶ä½“ç³»ç»“æ„ç”±å®Œæˆä¸åŒåŠŸèƒ½çš„n(n>1)ä¸ªçº¿ç´¢ï¼ˆå­ç³»ç»Ÿï¼‰ç»„æˆï¼›\n2. ç³»ç»Ÿå…·æœ‰m(m&gt;1)ä¸ªä¸åŒæŠ½è±¡çº§åˆ«çš„å±‚ï¼›\n3. çº¿ç´¢ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼ˆæ­£äº¤çš„ï¼‰;\n4. ç³»ç»Ÿæœ‰ä¸€ä¸ªå…¬å…±é©±åŠ¨å±‚ï¼ˆä¸€èˆ¬ä¸ºæœ€é«˜å±‚ï¼‰å’Œå…¬å…±æ•°æ®ç»“æ„ï¼ˆä¸€èˆ¬ä¸ºæœ€ä½å±‚ï¼‰ã€‚\n\n## ä¼˜ç‚¹\n\n1. ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç†è§£\n2. æ˜“ä¿®æ”¹ï¼Œå¯ç»´æŠ¤æ€§å¼º\n3. å¯ç§»æ¤æ€§å¼ºï¼Œé‡ç”¨ç²’åº¦å¤§\n\n# åŸºäºå±‚æ¬¡æ¶ˆæ¯æ€»çº¿çš„ä½“ç³»ç»“æ„é£æ ¼ï¼ˆHMBï¼‰\n\næ˜¯ä¸ªå¤åˆä½“ç³»ç»“æ„ï¼Œç”¨åˆ°äº†å‰é¢çš„6ç§ç»å…¸ä½“ç³»ç»“æ„é£æ ¼ï¼Œè¿›è¡Œäº†ä¸€ä¸ªç»„åˆã€‚\n\né¦–å…ˆï¼Œå®ƒæ˜¯ä¸ª**åˆ†å±‚ç³»ç»Ÿ**ã€‚\n\nå…¶æ¬¡ï¼Œå®ƒç”¨åˆ°äº†**C2é£æ ¼**ã€‚é€šè¿‡è¿æ¥ä»¶æŠŠè‹¥å¹²æ„ä»¶ç»‘å®šåœ¨ä¸€èµ·ï¼ŒæŒ‰ç…§ä¸€ç»„è§„åˆ™è¿è¡Œï¼Œæ˜¯ä¸€ç»„å¹¶è¡Œçš„æ„ä»¶ç½‘ç»œã€‚\n\nç³»ç»Ÿé‡Œçš„æ„ä»¶å’Œè¿æ¥ä»¶ï¼Œéƒ½æœ‰ä¸€ä¸ªé¡¶éƒ¨å’Œåº•éƒ¨ã€‚æ„ä»¶å’Œæ„ä»¶ä¹‹é—´çš„ç›´æ¥è¿æ¥æ˜¯ä¸å…è®¸çš„ï¼Œåªèƒ½æ˜¯æ„ä»¶çš„é¡¶éƒ¨è¿æ¥åˆ°è¿æ¥ä»¶çš„åº•éƒ¨ï¼Œæˆ–æ„ä»¶çš„åº•éƒ¨è¿æ¥åˆ°è¿æ¥ä»¶çš„é¡¶éƒ¨ã€‚è¿æ¥ä»¶å¯ä»¥å’Œä»»ä½•æ•°ç›®çš„å…¶ä»–æ„ä»¶è¿æ¥ã€‚\n\nç¬¬ä¸‰ï¼Œç”¨åˆ°äº†**æ•°æ®æŠ½è±¡/é¢å‘å¯¹è±¡**ã€‚è¿æ¥çš„æ„ä»¶éƒ½æ˜¯é€šè¿‡æ¥å£å»è¿›è¡Œè¿æ¥çš„ï¼Œæ„ä»¶çš„å†…éƒ¨å¯¹äºå¤–éƒ¨æ˜¯ä¸å¯è§çš„ã€‚å¤–éƒ¨åªèƒ½çœ‹åˆ°æ¥å£è€Œçœ‹ä¸åˆ°å†…éƒ¨ã€‚\n\n## æµç¨‹\n\n1. HMBé£æ ¼çš„æ„ä»¶æ¥å£æ˜¯ä¸€ç§åŸºäºæ¶ˆæ¯çš„äº’è”æ¥å£ï¼Œå¯ä»¥è¾ƒå¥½åœ°æ”¯æŒä½“ç³»ç»“æ„è®¾è®¡ã€‚æ„ä»¶ä¹‹é—´é€šè¿‡æ¶ˆæ¯è¿›è¡Œé€šè®¯ï¼Œæ¥å£å®šä¹‰äº†æ„ä»¶å‘å‡ºå’Œæ¥æ”¶çš„æ¶ˆæ¯é›†åˆã€‚\n2. å½“æŸä¸ªäº‹ä»¶å‘ç”Ÿåï¼Œç³»ç»Ÿæˆ–æ„ä»¶å‘å‡ºç›¸åº”çš„æ¶ˆæ¯ï¼Œæ¶ˆæ¯æ€»çº¿è´Ÿè´£æŠŠè¯¥æ¶ˆæ¯ä¼ é€’åˆ°æ­¤æ¶ˆæ¯æ„Ÿå…´è¶£çš„æ„ä»¶ã€‚\n3. æŒ‰ç…§å“åº”æ–¹å¼çš„ä¸åŒï¼Œæ¶ˆæ¯å¯åˆ†ä¸ºåŒæ­¥æ¶ˆæ¯å’Œå¼‚æ­¥æ¶ˆæ¯ã€‚\n\n# å¼‚æ„ç»“æ„é£æ ¼\n\nä¸€å¥è¯ï¼šå¤šé‡‡ç”¨äº†ä¸åŒä½“ç³»é£æ ¼çš„ä¼˜ç‚¹ï¼Œæ·¡åŒ–äº†è¿™äº›ä½“ç³»é£æ ¼çš„ç¼ºç‚¹ã€‚\n\nå†…å¤–æœ‰åˆ«ï¼šå¤–ç½‘ä½¿ç”¨B/Sï¼Œå†…ç½‘ä½¿ç”¨C/Sã€‚å¤–éƒ¨æä¾›ç»™ç”¨æˆ·B/Sï¼Œé€‚åˆå¤„ç†ç®€å•çš„æ˜¾ç¤ºè¾“å‡ºã€äº¤äº’å°‘åœºæ™¯ï¼Œè€Œä¸”è½¯ä»¶å‡çº§æ—¶ç›´æ¥åœ¨webæœåŠ¡å™¨å‡çº§å³å¯ã€‚åœ¨å†…éƒ¨å¤šæ˜¯å¯¹æ•°æ®åº“è¿›è¡Œä¿®æ”¹ï¼Œç›´æ¥ç”¨äºŒå±‚C/Sæ‰§è¡Œé€Ÿåº¦å¿«ã€‚\n\næŸ¥æ”¹æœ‰åˆ«ï¼šç»´æŠ¤å’Œä¿®æ”¹ - C/Sç»“æ„ï¼›æŸ¥è¯¢å’Œæµè§ˆ - B/Sç»“æ„ã€‚\n\n# ç¬¬8ç«  åŸºäºæœåŠ¡çš„ä½“ç³»ç»“æ„ï¼ˆSOAï¼‰\n\nSOAæ˜¯ä¸€ç§æ¶æ„æ¨¡å‹å’Œä¸€å¥—è®¾è®¡æ–¹æ³•å­¦ï¼Œå…¶ç›®çš„æ˜¯æœ€å¤§é™åº¦åœ°é‡ç”¨åº”ç”¨ç¨‹åºä¸­ç«‹å‹çš„æœåŠ¡ä»¥æé«˜ITé€‚åº”æ€§å’Œæ•ˆç‡ã€‚å®ƒå¯ä»¥æ ¹æ®éœ€æ±‚é€šè¿‡ç½‘ç»œå¯¹æ¾æ•£è€¦åˆçš„ç²—ç²’åº¦åº”ç”¨ç»„ä»¶(ç»†ç²’åº¦å¯¹åº”çš„æ˜¯ç±»ã€å‡½æ•°)è¿›è¡Œåˆ†å¸ƒå¼éƒ¨ç½²ã€ç»„åˆå’Œä½¿ç”¨ã€‚\n\næœåŠ¡å±‚æ˜¯SOAçš„åŸºç¡€ï¼Œå¯ä»¥ç›´æ¥è¢«åº”ç”¨è°ƒç”¨ï¼Œä»è€Œæœ‰æ•ˆæ§åˆ¶ç³»ç»Ÿä¸­ä¸è½¯ä»¶ä»£ç†äº¤äº’çš„äººä¸ºä¾èµ–æ€§ã€‚\n\nW3Cå°†æœåŠ¡å®šä¹‰ä¸º: â€œæœåŠ¡æä¾›è€…å®Œæˆä¸€ç»„å·¥ä½œ, ä¸ºæœåŠ¡ä½¿ç”¨è€…äº¤ä»˜æ‰€éœ€çš„æœ€ç»ˆç»“æœã€‚æœ€ç»ˆç»“æœé€šå¸¸ä¼šä½¿ä½¿ç”¨è€…çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–, ä½†ä¹Ÿå¯èƒ½ä½¿æä¾›è€…çš„çŠ¶æ€æ”¹å˜, æˆ–è€…åŒæ–¹éƒ½äº§ç”Ÿå˜åŒ–â€ã€‚\n\nSOAä¸æ˜¯ä¸€ç§è¯­è¨€, ä¹Ÿä¸æ˜¯ä¸€ç§å…·ä½“çš„æŠ€æœ¯è€Œæ˜¯ç§è½¯ä»¶ç³»ç»Ÿæ¶æ„, å®ƒå°è¯•ç»™å‡ºåœ¨ç‰¹å®šç¯å¢ƒä¸‹æ¨èé‡‡\nç”¨çš„ä¸€ç§æ¶æ„, ä»è¿™ä¸ªè§’åº¦ä¸Šæ¥è¯´, å®ƒæ›´åƒä¸€ç§æ¨¡å¼ã€‚\n\nSOAæ˜¯é¢å‘æœåŠ¡çš„ä½“ç³»ç»“æ„ï¼Œä»–å®é™…ä¸Šæ˜¯ç»„ä»¶çš„æ¨¡å‹ï¼ŒæŠŠåº”ç”¨ç¨‹åºä¸åŒçš„åŠŸèƒ½å•å…ƒå¯ç§°ä½œæœåŠ¡ï¼Œå¯ä»¥é€šè¿‡å®šä¹‰æœåŠ¡ä¸æœåŠ¡ä¹‹é—´è‰¯å¥½çš„æ¥å£å’Œå¥‘çº¦ï¼Œå¾ˆå¥½åœ°æŠŠå®ƒä»¬è”ç³»èµ·æ¥ã€‚å› ä¸ºæ˜¯ä¸€ç§æ¾è€¦åˆçš„ç†å¿µï¼Œæ˜¯ä¸€ç§å¯ä»¥æ›¿ä»£ä¼ ç»Ÿçš„é¢å‘å¯¹è±¡æ¨¡å‹çš„æ¨¡å‹ã€‚ä½†ä¸æ˜¯è¯´æ²¡æœ‰é¢å‘å¯¹è±¡äº†ï¼Œå•ä¸ªæœåŠ¡å†…éƒ¨ä»éœ€è¦ç”¨é¢å‘å¯¹è±¡æ¥è®¾è®¡ã€‚\n\n## SOAçš„ç‰¹å¾\n\n1. **æ¾æ•£è€¦åˆ**ï¼ŒæœåŠ¡æ˜¯ä½ç½®é€æ˜çš„\n2. **ç²—ç²’åº¦æœåŠ¡**\n3. æœåŠ¡æ˜¯å°è£…çš„ï¼Œé€šè¿‡**æ ‡å‡†åŒ–æ¥å£**äº¤äº’ï¼ŒæœåŠ¡æ˜¯è‡ªæ²»çš„åŠŸèƒ½å®ä½“ï¼Œè‡ªåŒ…å«å’Œæ¨¡å—åŒ–\n4. æœåŠ¡çš„é‡ç”¨\n5. æœåŠ¡çš„äº’æ“ä½œæ€§ã€å…¼å®¹æ€§\n\n## SOAçš„æ¦‚å¿µ\n\nW3Cï¼šSOAæ˜¯ä¸€ç§åº”ç”¨ç¨‹åºä½“ç³»ç»“æ„ï¼Œåœ¨è¿™ç§ä½“ç³»ç»“æ„ä¸­ï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½å®šä¹‰ä¸ºç‹¬ç«‹çš„æœåŠ¡ï¼Œè¿™äº›æœåŠ¡å¸¦æœ‰å®šä¹‰æ˜ç¡®çš„å¯è°ƒç”¨æ¥å£ï¼Œèƒ½å¤Ÿä»¥å®šä¹‰å¥½çš„é¡ºåºè°ƒç”¨è¿™äº›æœåŠ¡æ¥å½¢æˆä¸šåŠ¡æµç¨‹ã€‚\n\nService-architecture.comï¼šæœåŠ¡æ˜¯ç²¾ç¡®å®šä¹‰ã€å°è£…å®Œæ•´ã€ç‹¬ç«‹äºå…¶å®ƒæœåŠ¡æ‰€å¤„ç¯å¢ƒå’ŒçŠ¶æ€çš„å‡½æ•°ã€‚SO Aæœ¬è´¨ä¸Šæ˜¯æœåŠ¡çš„é›†åˆï¼Œ æœåŠ¡ä¹‹é—´å½¼æ­¤é€šä¿¡ï¼Œè¿™ç§é€šä¿¡å¯èƒ½æ˜¯ç®€å•çš„æ•°æ®ä¼ é€ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸¤ä¸ªæˆ–æ›´å¤šçš„æœåŠ¡åè°ƒè¿›è¡ŒæŸäº›æ´»åŠ¨ã€‚æœåŠ¡ä¹‹é—´éœ€è¦æŸäº›æ–¹æ³•è¿›è¡Œè¿æ¥ã€‚\n\nGartnerï¼šSOAæ˜¯ä¸€ç§C/Sä½“ç³»ç»“æ„çš„è½¯ä»¶è®¾è®¡æ–¹æ³•ï¼Œåº”ç”¨ç”±æœåŠ¡å’ŒæœåŠ¡ä½¿ç”¨è€…ç»„æˆï¼Œ SO Aä¸å¤§å¤šæ•°é€šç”¨çš„C/Sä½“ç³»ç»“æ„æ¨¡å‹ä¸åŒä¹‹å¤„ï¼Œ åœ¨äºå®ƒç€é‡å¼ºè°ƒæ„ä»¶çš„æ¾æ•£è€¦åˆï¼Œå¹¶ä½¿ç”¨ç‹¬ç«‹çš„æ ‡å‡†æ¥å£ã€‚\n\n## SOAçš„å…³é”®æŠ€æœ¯\n\n![2022-06-19_221030](../../images/è½¯ä»¶ä½“ç³»ç»“æ„/soa-key-tech.png)\n\n## SOAçš„å®ç°æ–¹æ³•1 -WebService\n\nèƒ½å¤Ÿåœ¨ä¸€ä¸ªåˆ†å¸ƒå¼çš„è®¡ç®—ç¯å¢ƒä¸­åŠ¨æ€åœ°æè¿°ã€å‘å¸ƒã€å‘ç°å’Œè°ƒç”¨æœåŠ¡Webä¸Šçš„å¯¹è±¡è®¿é—®æŠ€æœ¯ã€‚\n\nåœ¨WebServiceçš„è§£å†³æ–¹æ¡ˆä¸­ï¼Œä¸€å…±æœ‰ä¸‰ç§å·¥ä½œè§’è‰²ï¼Œå…¶ä¸­æœåŠ¡æä¾›è€…å’ŒæœåŠ¡è¯·æ±‚è€…æ˜¯å¿…éœ€çš„ï¼ŒæœåŠ¡æ³¨å†Œä¸­å¿ƒæ˜¯ä¸€ä¸ªå¯é€‰çš„è§’è‰²ã€‚å®ƒä»¬ä¹‹é—´çš„äº¤äº’å’Œæ“ä½œæ„æˆäº†SOAçš„ä¸€ç§å®ç°ä½“ç³»ç»“æ„ã€‚\n\n![2022-06-19_221721](../../images/è½¯ä»¶ä½“ç³»ç»“æ„/webservice.png)\n\n1. æœåŠ¡æä¾›è€…ã€‚æœåŠ¡æä¾›è€…æ˜¯æœåŠ¡çš„æ‰€æœ‰è€…ï¼Œè¯¥è§’è‰²è´Ÿè´£å®šä¹‰å¹¶å®ç°æœåŠ¡ï¼Œä½¿ç”¨WSDLå¯¹æœåŠ¡è¿›è¡Œè¯¦ç»†ã€å‡†ç¡®ã€è§„èŒƒçš„æè¿°ï¼Œå¹¶å°†è¯¥æè¿°å‘å¸ƒåˆ°æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œä¾›æœåŠ¡è¯·æ±‚è€…æŸ¥æ‰¾å¹¶ç»‘å®šä½¿ç”¨ã€‚\n2. æœåŠ¡è¯·æ±‚è€…ã€‚æœåŠ¡è¯·æ±‚è€…æ˜¯æœåŠ¡çš„ä½¿ç”¨è€…ï¼Œè™½ç„¶æœåŠ¡é¢å‘çš„æ˜¯ç¨‹åºï¼Œä½†ç¨‹åºçš„æœ€ç»ˆä½¿ç”¨è€…ä»ç„¶æ˜¯ç”¨æˆ·ã€‚ä»ä½“ç³»ç»“æ„çš„è§’åº¦çœ‹,æœåŠ¡è¯·æ±‚è€…æ˜¯æŸ¥æ‰¾ã€ç»‘å®šå¹¶è°ƒç”¨æœåŠ¡,æˆ–ä¸æœåŠ¡è¿›è¡Œäº¤äº’çš„åº”ç”¨ç¨‹åºã€‚æœåŠ¡è¯·æ±‚è€…è§’è‰²å¯ä»¥ç”±æµè§ˆå™¨æ¥æ‹…å½“,ç”±äººæˆ–ç¨‹åº(ä¾‹å¦‚,å¦å¤–ä¸€ä¸ªæœåŠ¡)æ¥æ§åˆ¶\n3. æœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚æœåŠ¡æ³¨å†Œä¸­å¿ƒæ˜¯è¿æ¥æœåŠ¡æä¾›è€…å’ŒæœåŠ¡è¯·æ±‚è€…çš„çº½å¸¦,æœåŠ¡æä¾›è€…åœ¨æ­¤å‘å¸ƒä»–ä»¬çš„æœåŠ¡æè¿°,è€ŒæœåŠ¡è¯·æ±‚è€…åœ¨æœåŠ¡æ³¨å†Œä¸­å¿ƒæŸ¥æ‰¾ä»–ä»¬éœ€è¦çš„æœåŠ¡ã€‚ä¸è¿‡,åœ¨æŸäº›æƒ…å†µä¸‹,æœåŠ¡æ³¨å†Œä¸­å¿ƒæ˜¯æ•´ä¸ªæ¨¡å‹ä¸­çš„å¯é€‰è§’è‰²ã€‚ä¾‹å¦‚,å¦‚æœä½¿ç”¨é™æ€ç»‘å®šçš„æœåŠ¡,æœåŠ¡æä¾›è€…åˆ™å¯ä»¥æŠŠæè¿°ç›´æ¥å‘é€ç»™æœåŠ¡è¯·æ±‚è€…ã€‚\n\nWeb Serviceæ¨¡å‹ä¸­çš„æ“ä½œåŒ…æ‹¬**å‘å¸ƒã€æŸ¥æ‰¾å’Œç»‘å®š**ï¼Œè¿™äº›æ“ä½œå¯ä»¥å•æ¬¡æˆ–åå¤å‡ºç°ã€‚\n\n1. å‘å¸ƒã€‚ä¸ºäº†ä½¿ç”¨æˆ·èƒ½å¤Ÿè®¿é—®æœåŠ¡ï¼ŒæœåŠ¡æä¾›è€…éœ€è¦å‘å¸ƒæœåŠ¡æè¿°ï¼Œä»¥ä¾¿æœåŠ¡è¯·æ±‚è€…å¯ä»¥æŸ¥æ‰¾å®ƒã€‚\n2. æŸ¥æ‰¾ã€‚åœ¨æŸ¥æ‰¾æ“ä½œä¸­,æœåŠ¡è¯·æ±‚è€…ç›´æ¥æ£€ç´¢æœåŠ¡æè¿°æˆ–åœ¨æœåŠ¡æ³¨å†Œä¸­å¿ƒæŸ¥è¯¢æ‰€è¦æ±‚çš„æœåŠ¡ç±»å‹ã€‚å¯¹æœåŠ¡è¯·æ±‚è€…è€Œè¨€ï¼Œå¯èƒ½ä¼šåœ¨ç”Ÿå‘½å‘¨æœŸçš„ä¸¤ä¸ªä¸åŒé˜¶æ®µä¸­æ¶‰åŠæŸ¥æ‰¾æ“ä½œ,é¦–å…ˆæ˜¯åœ¨è®¾è®¡é˜¶æ®µï¼Œä¸ºäº†ç¨‹åºå¼€å‘è€ŒæŸ¥æ‰¾æœåŠ¡çš„æ¥å£æè¿°ï¼›å…¶æ¬¡æ˜¯åœ¨è¿è¡Œé˜¶æ®µï¼Œä¸ºäº†è°ƒç”¨è€ŒæŸ¥æ‰¾æœåŠ¡çš„ä½ç½®æè¿°ã€‚\n3. ç»‘å®šã€‚åœ¨ç»‘å®šæ“ä½œä¸­ï¼ŒæœåŠ¡è¯·æ±‚è€…ä½¿ç”¨æœåŠ¡æè¿°ä¸­çš„ç»‘å®šç»†èŠ‚æ¥å®šä½ã€è”ç³»å¹¶è°ƒç”¨æœåŠ¡ï¼Œä»è€Œåœ¨è¿è¡Œæ—¶ä¸æœåŠ¡è¿›è¡Œäº¤äº’ã€‚ç»‘å®šå¯ä»¥åˆ†ä¸ºåŠ¨æ€ç»‘å®šå’Œé™æ€ç»‘å®šã€‚åœ¨åŠ¨æ€ç»‘å®šä¸­æœåŠ¡è¯·æ±‚è€…é€šè¿‡æœåŠ¡æ³¨å†Œä¸­å¿ƒæŸ¥æ‰¾æœåŠ¡æè¿°ï¼Œå¹¶åŠ¨æ€åœ°ä¸æœåŠ¡äº¤äº’ï¼›åœ¨é™æ€ç»‘å®šä¸­ï¼ŒæœåŠ¡è¯·æ±‚è€…å·²ç»ä¸æœåŠ¡æä¾›è€…è¾¾æˆé»˜å¥‘,é€šè¿‡æœ¬åœ°æ–‡ä»¶æˆ–å…¶ä»–æ–¹å¼ç›´æ¥ä¸æœåŠ¡è¿›è¡Œç»‘å®šã€‚\n\nåœ¨é‡‡ç”¨Web Serviceä½œä¸ºSOAçš„å®ç°æŠ€æœ¯æ—¶,åº”ç”¨ç³»ç»Ÿå¤§è‡´å¯ä»¥åˆ†ä¸º6ä¸ªå±‚æ¬¡ï¼Œåˆ†åˆ«æ˜¯åº•å±‚ä¼ è¾“å±‚ã€æœåŠ¡é€šä¿¡åè®®å±‚ã€æœåŠ¡æè¿°å±‚ã€æœåŠ¡å±‚ã€ä¸šåŠ¡æµç¨‹å±‚å’ŒæœåŠ¡æ³¨å†Œå±‚ã€‚\n\n## SOAçš„å®ç°æ–¹æ³•2 - æœåŠ¡æ³¨å†Œè¡¨\n\næœåŠ¡æ³¨å†Œè¡¨ï¼ˆservice registryï¼‰è™½ç„¶ä¹Ÿå…·æœ‰è¿è¡Œæ—¶çš„åŠŸèƒ½ï¼Œä½†ä¸»è¦åœ¨SOAè®¾è®¡æ—¶ä½¿ç”¨ã€‚\n\nå®ƒæä¾›ä¸€ä¸ªç­–ç•¥æ‰§è¡Œç‚¹ï¼ˆPolicy Enforcement Pointï¼ŒPEP)ï¼Œåœ¨è¿™ä¸ªç‚¹ä¸Šï¼ŒæœåŠ¡å¯ä»¥åœ¨SOAä¸­æ³¨å†Œï¼Œä»è€Œå¯ä»¥è¢«å‘ç°å’Œä½¿ç”¨ã€‚æœåŠ¡æ³¨å†Œè¡¨å¯ä»¥åŒ…æ‹¬æœ‰å…³æœåŠ¡å’Œç›¸å…³æ„ä»¶çš„é…ç½®ã€ä¾ä»æ€§å’Œçº¦æŸæ–‡ä»¶ã€‚ä»ç†è®ºä¸Šæ¥è¯´ï¼Œä»»ä½•å¸®åŠ©æœåŠ¡æ³¨å†Œã€å‘ç°å’ŒæŸ¥æ‰¾æœåŠ¡åˆçº¦ã€å…ƒæ•°æ®å’Œç­–ç•¥çš„ä¿¡æ¯åº“ã€æ•°æ®åº“ã€ç›®å½•æˆ–å…¶ä»–ç»“ç‚¹éƒ½å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæ³¨å†Œè¡¨ã€‚å¤§å¤šæ•°å•†ç”¨æœåŠ¡æ³¨å†Œäº§å“æ”¯æŒæœåŠ¡æ³¨å†Œã€æœåŠ¡ä½ç½®å’ŒæœåŠ¡ç»‘å®šåŠŸèƒ½ã€‚\n\n## SOAçš„å®ç°æ–¹æ³•3 - ä¼ä¸šæœåŠ¡æ€»çº¿ï¼ˆESBï¼‰\n\nESBçš„æ¦‚å¿µæ˜¯ä»SOAå‘å±•è€Œæ¥çš„ï¼Œå®ƒæ˜¯ä¸€ç§ä¸ºè¿›è¡Œè¿æ¥æœåŠ¡æä¾›çš„æ ‡å‡†åŒ–çš„é€šä¿¡åŸºç¡€ç»“æ„ï¼ŒåŸºäºå¼€æ”¾çš„æ ‡å‡†ï¼Œä¸ºåº”ç”¨æä¾›äº†ä¸€ä¸ªå¯é çš„ã€å¯åº¦é‡çš„å’Œé«˜åº¦å®‰å…¨çš„ç¯å¢ƒï¼Œå¹¶å¯å¸®åŠ©ä¼ä¸šå¯¹ä¸šåŠ¡æµç¨‹è¿›è¡Œè®¾è®¡å’Œæ¨¡æ‹Ÿï¼Œå¯¹æ¯ä¸ªä¸šåŠ¡æµç¨‹å®æ–½æ§åˆ¶å’Œè·Ÿè¸ªã€åˆ†æå¹¶æ”¹è¿›æµç¨‹å’Œæ€§èƒ½ã€‚\n\nä¼ä¸šæœåŠ¡æ€»çº¿ï¼ˆEnterprise Service Busï¼ŒESBï¼‰ å®ƒä½¿ç”¨è®¸å¤šå¯èƒ½çš„æ¶ˆæ¯ä¼ é€’åè®®æ¥è´Ÿè´£é€‚å½“çš„æ§åˆ¶ã€æµç”šè‡³è¿˜å¯èƒ½æ˜¯æœåŠ¡ä¹‹é—´æ‰€æœ‰æ¶ˆæ¯çš„ä¼ è¾“ã€‚\n\nESBæœ¬èº«å¯ä»¥æ˜¯å•ä¸ªå¼•æ“ï¼Œç”šè‡³è¿˜å¯ä»¥æ˜¯ç”±è®¸å¤šåŒçº§å’Œä¸‹çº§ESBç»„æˆåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œè¿™äº›ESBä¸€èµ·å·¥ä½œï¼Œä»¥ä¿æŒSOAç³»ç»Ÿçš„è¿è¡Œã€‚\n\n## æœåŠ¡æè¿°è¯­è¨€ - WSDL\n\nWSDLæ˜¯å¯¹æœåŠ¡è¿›è¡Œæè¿°çš„è¯­è¨€,å®ƒæœ‰ä¸€å¥—åŸºäºXMLçš„è¯­æ³•å®šä¹‰ã€‚WSDLæè¿°çš„é‡ç‚¹æ˜¯æœåŠ¡, å®ƒåŒ…å« Service Implementation Definition(æœåŠ¡å®ç°å®šä¹‰)å’Œ Service interface Definition(æœåŠ¡æ¥å£å®šä¹‰)\n\n## ç»Ÿä¸€æè¿°ã€å‘ç°å’Œé›†æˆåè®®ï¼ˆUDDIï¼‰\n\nUDDIæ˜¯ä¸€ç§ç”¨äºæè¿°ã€å‘ç°ã€é›†æˆWebæœåŠ¡çš„æŠ€æœ¯ï¼Œå®ƒæ˜¯WebæœåŠ¡åè®®æ ˆçš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†ã€‚é€šè¿‡UDDIï¼Œä¼ä¸šå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦åŠ¨æ€æŸ¥æ‰¾å¹¶ä½¿ç”¨WebæœåŠ¡ï¼Œä¹Ÿå¯ä»¥å°†è‡ªå·±çš„WebæœåŠ¡åŠ¨æ€åœ°å‘å¸ƒåˆ°UDDIæ³¨å†Œä¸­å¿ƒï¼Œä¾›å…¶ä»–ç”¨æˆ·ä½¿ç”¨ã€‚\n\n## æ¶ˆæ¯å°è£…åè®® - ç®€å•å¯¹è±¡è®¿é—®åè®® - SOAP\n\nSOAPæ˜¯åœ¨åˆ†æ•£æˆ–åˆ†å¸ƒç¯å¢ƒä¸­ä»¥XMLå½¢å¼æä¾›çš„ä¸€ä¸ªç®€å•ã€è½»é‡çš„**äº¤æ¢ç»“æ„åŒ–å’Œç±»å‹ä¿¡æ¯**çš„æœºåˆ¶ã€‚\n\nSOAPæœ¬èº«å¹¶æ²¡æœ‰å®šä¹‰ä»»ä½•åº”ç”¨ç¨‹åºè¯­ä¹‰ï¼ˆå¦‚ç¼–ç¨‹æ¨¡å‹æˆ–ç‰¹å®šè¯­ä¹‰çš„å®ç°ï¼‰ï¼Œå®é™…ä¸Šï¼Œå®ƒé€šè¿‡æä¾›ä¸€ä¸ªæœ‰æ ‡å‡†æ„ä»¶çš„åŒ…æ¨¡å‹å’Œåœ¨æ¨¡å—ä¸­ç¼–ç æ•°æ®çš„æœºåˆ¶ï¼Œå®šä¹‰äº†ä¸€ä¸ªç®€å•çš„è¡¨ç¤ºåº”ç”¨ç¨‹åºè¯­ä¹‰çš„æœºåˆ¶ã€‚è¿™ä½¿SOAPèƒ½å¤Ÿè¢«ç”¨äºä»æ¶ˆæ¯ä¼ é€’åˆ°RPCçš„å„ç§ç³»ç»Ÿã€‚","categories":["è®¾è®¡æ¨¡å¼"]},{"title":"é«˜çº§æ•°æ®ç»“æ„_2-3-4æ ‘","url":"/é«˜çº§æ•°æ®ç»“æ„/é«˜çº§æ•°æ®ç»“æ„_2-3-4æ ‘/","content":"# å†…å®¹\n\n# 2-3-4æ ‘\n\nåœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œ2-3-4 æ ‘ï¼ˆä¹Ÿç§°ä¸º 2-4 æ ‘ï¼‰æ˜¯ä¸€ç§å¯ç”¨äºå®ç°å­—å…¸çš„è‡ªå¹³è¡¡æ•°æ®ç»“æ„ã€‚ è¿™äº›æ•°å­—(2/3/4)è¡¨ç¤ºçš„æ˜¯ä¸€æ£µæ ‘ä¸­: æ¯ä¸ªæœ‰1ä¸ª/2ä¸ª/3ä¸ªå…ƒç´ çš„èŠ‚ç‚¹åˆ†åˆ«æœ‰2ä¸ª/3ä¸ª/4ä¸ªå­èŠ‚ç‚¹ï¼š\n\n- a 2-node has one data element, and if internal has two child nodes;\n  ![2-3-4-tree-2-node](../../images/é«˜çº§æ•°æ®ç»“æ„_2-3-4æ ‘/2-3-4-tree-2-node.svg)\n- a 3-node has two data elements, and if internal has three child nodes;\n  ![2-3-4-tree-3-node](../../images/é«˜çº§æ•°æ®ç»“æ„_2-3-4æ ‘/2-3-4-tree-3-node.svg)\n- a 4-node has three data elements, and if internal has four child nodes;\n  ![2-3-4-tree-4-node](../../images/é«˜çº§æ•°æ®ç»“æ„_2-3-4æ ‘/2-3-4-tree-4-node.svg)\n\n## ä¸Bæ ‘çš„å…³ç³»\n\n1. 2-3-4æ ‘æ˜¯4é˜¶çš„Bæ ‘ï¼›\n2. å’Œä¸€èˆ¬çš„Bæ ‘ä¸€æ ·ï¼Œå®ƒä»¬å¯ä»¥åœ¨$O(\\log n)$æ—¶é—´å†…æœç´¢ã€æ’å…¥å’Œåˆ é™¤ã€‚ \n3. 2-3-4æ ‘çš„ä¸€ä¸ªç‰¹æ€§æ˜¯æ‰€æœ‰å¤–éƒ¨èŠ‚ç‚¹éƒ½å¤„äºç›¸åŒçš„æ·±åº¦ã€‚\n\n## ä¸çº¢é»‘æ ‘çš„å…³ç³»\n\n2-3-4æ ‘ä¸çº¢é»‘æ ‘åŒæ„ï¼Œè¿™æ„å‘³ç€å®ƒä»¬æ˜¯ç­‰æ•ˆçš„æ•°æ®ç»“æ„ã€‚æ¢è¨€ä¹‹ï¼Œå¯¹äºæ¯æ£µ2-3-4æ ‘ï¼Œè‡³å°‘å­˜åœ¨ä¸€æ£µæ•°æ®å…ƒç´ é¡ºåºç›¸åŒçš„çº¢é»‘æ ‘ã€‚æ­¤å¤–ï¼Œå¯¹2-3-4æ ‘çš„æ’å…¥å’Œåˆ é™¤æ“ä½œä¼šå¯¼è‡´èŠ‚ç‚¹æ‰©å±•ã€æ‹†åˆ†å’Œåˆå¹¶ï¼Œç›¸å½“äºçº¢é»‘æ ‘ä¸­çš„é¢œè‰²ç¿»è½¬å’Œæ—‹è½¬ã€‚\n\nçº¢é»‘æ ‘çš„ä»‹ç»é€šå¸¸é¦–å…ˆä»‹ç»2-3-4æ ‘ï¼Œå› ä¸ºå®ƒä»¬åœ¨æ¦‚å¿µä¸Šæ›´ç®€å•ã€‚ç„¶è€Œï¼Œ2-3-4 æ ‘åœ¨å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ä¸­å¯èƒ½éš¾ä»¥å®ç°ï¼Œå› ä¸ºæ ‘ä¸Šçš„æ“ä½œæ¶‰åŠå¤§é‡ç‰¹æ®Šæƒ…å†µã€‚ çº¢é»‘æ ‘æ›´å®¹æ˜“å®ç°ï¼Œå› æ­¤å€¾å‘äºä½¿ç”¨ã€‚\n\n# æ€§è´¨\n\n1. å¶èŠ‚ç‚¹, æ¯ä¸ªå­èŠ‚ç‚¹éƒ½æ˜¯2èŠ‚ç‚¹ã€3èŠ‚ç‚¹æˆ–4èŠ‚ç‚¹ï¼Œçˆ¶èŠ‚ç‚¹åˆ†åˆ«ä¿å­˜ä¸€ä¸ªã€ä¸¤ä¸ªæˆ–ä¸‰ä¸ªæ•°æ®å…ƒç´ ã€‚\n2. æ‰€æœ‰å¶å­éƒ½åœ¨ç›¸åŒçš„æ·±åº¦ï¼ˆåº•å±‚ï¼‰ã€‚\n3. æ‰€æœ‰æ•°æ®éƒ½æŒ‰æ’åºé¡ºåºä¿å­˜ã€‚\n","categories":["é«˜çº§æ•°æ®ç»“æ„","æ ‘"]},{"title":"é«˜çº§æ•°æ®ç»“æ„_Bplusæ ‘","url":"/é«˜çº§æ•°æ®ç»“æ„/é«˜çº§æ•°æ®ç»“æ„_Bplusæ ‘/","content":"\n# B+\n\nB+æ ‘å¯ä»¥çœ‹ä½œæ˜¯Bæ ‘çš„ä¸€ç§å˜å½¢ï¼Œåœ¨å®ç°æ–‡ä»¶ç´¢å¼•ç»“æ„æ–¹é¢æ¯”Bæ ‘ä½¿ç”¨å¾—æ›´æ™®éã€‚\n\n## B+æ ‘ä¸Bæ ‘åŒºåˆ«\n\nmé˜¶`B+`æ ‘ä¸mé˜¶Bæ ‘åŒºåˆ«: \n\n1. æ‰€æœ‰å¶å­èŠ‚ç‚¹åŒ…å«å…¨éƒ¨å…³é”®å­—ä¿¡æ¯, åŠæŒ‡å‘å«æœ‰è¿™äº›å…³é”®å­—è®°å½•çš„æŒ‡é’ˆ, ä¸”å¶å­èŠ‚ç‚¹ä¸­å…³é”®å­—è¿›è¡Œæœ‰åºé“¾æ¥; \n2. éå¶å­èŠ‚ç‚¹ç›¸å½“äºæ˜¯å¶å­èŠ‚ç‚¹çš„ç´¢å¼•, å¶å­èŠ‚ç‚¹ç›¸å½“äºæ˜¯å­˜å‚¨(å…³é”®å­—)æ•°æ®çš„æ•°æ®å±‚; \n\n## B+æ ‘\n\nä¸€æ£µmé˜¶B+æ ‘å¯ä»¥å®šä¹‰å¦‚ä¸‹ï¼š\n\n* æ ‘ä¸­æ¯ä¸ªéå¶ç»“ç‚¹æœ€å¤šæœ‰mæ£µå­æ ‘;\n* æ ¹ç»“ç‚¹ï¼ˆéå¶ç»“ç‚¹ï¼‰è‡³å°‘æœ‰2æ£µå­æ ‘ã€‚é™¤æ ¹ç»“ç‚¹å¤–ï¼Œå…¶å®ƒçš„éå¶ç»“ç‚¹è‡³å°‘æœ‰${\\lceil}m/2{\\rceil}$æ£µå­æ ‘;æœ‰næ£µå­æ ‘çš„éå¶ç»“ç‚¹æœ‰n-1ä¸ªå…³é”®ç ã€‚\n* æ‰€æœ‰çš„å¶ç»“ç‚¹éƒ½å¤„äºåŒä¸€å±‚æ¬¡ä¸Šï¼ŒåŒ…å«äº†å…¨éƒ¨å…³é”®ç åŠæŒ‡å‘ç›¸åº”æ•°æ®å¯¹è±¡å­˜æ”¾åœ°å€çš„æŒ‡é’ˆï¼Œä¸”å¶ç»“ç‚¹æœ¬èº«æŒ‰å…³é”®ç ä»å°åˆ°å¤§é¡ºåºé“¾æ¥;\n\n# B+æ ‘çš„ä¼˜åŠ¿\n\n## è¯»å†™ä»£ä»·æ›´ä½\n\nB+æ ‘çš„ç£ç›˜è¯»å†™ä»£ä»·æ›´ä½, B+æ ‘çš„å†…éƒ¨èŠ‚ç‚¹æ²¡æœ‰æŒ‡å‘å…·ä½“æ•°æ®çš„æŒ‡é’ˆ, å› æ­¤å†…éƒ¨èŠ‚ç‚¹ç›¸å¯¹Bæ ‘æ›´å°, å¦‚æœæŠŠåŒä¸€å†…éƒ¨èŠ‚ç‚¹çš„å…³é”®å­—æ”¾åœ¨åŒä¸€å—ç£ç›˜ä¸­, ç›˜å—æ‰€èƒ½å®¹çº³çš„å…³é”®å­—æ•°é‡ä¹Ÿå°±è¶Šå¤š, ä¸€æ¬¡æ€§è¯»å…¥å†…å­˜ä¸­çš„éœ€è¦æŸ¥æ‰¾çš„å…³é”®å­—ä¹Ÿå°±è¶Šå¤š, ç›¸å¯¹IOè¯»å†™æ¬¡æ•°å‡å°‘, æ€§èƒ½æ›´é«˜;\n\n## æŸ¥è¯¢æ•ˆç‡æ›´åŠ ç¨³å®š\n\néå¶èŠ‚ç‚¹å¹¶ä¸æ˜¯æœ€ç»ˆæŒ‡å‘æ–‡ä»¶å†…å®¹çš„èŠ‚ç‚¹, åªä½œä¸ºå¶å­èŠ‚ç‚¹ä¸­å…³é”®å­—çš„ç´¢å¼•; æ‰€ä»¥ä»»ä½•å…³é”®å­—çš„æŸ¥æ‰¾å¿…é¡»èµ°ä¸€æ¡ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯; æ‰€æœ‰å…³é”®å­—æŸ¥è¯¢çš„è·¯å¾„é•¿åº¦ç›¸åŒ, äºæ˜¯æ¯ä¸€ä¸ªæ•°æ®çš„æŸ¥è¯¢æ•ˆç‡åŸºæœ¬ç­‰åŒ; \n\n## ç»Ÿè®¡æ•°æ®æ‰‹æ®µæ›´çµæ´»\n\nç”±äºB+æ ‘æŠŠæ•°æ®éƒ½æ”¾åˆ°äº†æœ€åº•ä¸€å±‚, å¯ä»¥å¾ˆæ–¹ä¾¿çš„æŠŠè¿™äº›æ•°æ®ä¸€ä¸ªä¸ªé“¾æ¥èµ·æ¥å½¢æˆé“¾è¡¨, åŠ ä¸ŠB+æ ‘æ•°æ®æœ¬æ¥å°±æ˜¯æŒ‰åºå­˜æ”¾çš„, è¿™æ ·çš„è¯æœ‰åˆ©äºæ•´è¡¨æœç´¢æˆ–åŒºé—´æŸ¥æ‰¾, æ¯”Bæ ‘çš„åŒºé—´æœç´¢å¿«å¾ˆå¤š;\n\n## ä¸¾ä¸ªä¾‹å­\n\nå‡è®¾ç£ç›˜ä¸­çš„ä¸€ä¸ªç›˜å—å®¹çº³16bytes, è€Œä¸€ä¸ªå…³é”®å­—2bytes, ä¸€ä¸ªå…³é”®å­—å…·ä½“ä¿¡æ¯æŒ‡é’ˆ2bytes; ä¸€æ£µ9é˜¶BTreeçš„å†…éƒ¨èŠ‚ç‚¹éœ€è¦2ä¸ªç›˜å—; è€ŒB+Treeå†…éƒ¨èŠ‚ç‚¹åªéœ€è¦1ä¸ªç›˜å—, å½“éœ€è¦æŠŠå†…éƒ¨èŠ‚ç‚¹è¯»å…¥å†…å­˜çš„æ—¶å€™, Bæ ‘å°±æ¯”B+æ ‘å¤šä¸€æ¬¡ç›˜å—æŸ¥æ‰¾æ—¶é—´, åœ¨ç£ç›˜ä¸­å°±æ˜¯ç›˜ç‰‡æ—‹è½¬çš„æ—¶é—´; (è¿™å°±æ˜¯çœäº†æŒ‡é’ˆ, åªå­˜ç´¢å¼•é¡¹çš„å¥½å¤„)\n\n# B+æ ‘èŠ‚ç‚¹ç»“æ„\n\n```cpp\n#define M 5\n#define MAXSIZE (M-1)\n#define MINSIZE (M/2)\ntypedef char KeyType;\ntypedef struct Record {} Record;\ntypedef enum{BRCH = 1, LEAF = 2}NodeType;\ntypedef struct BNode\n{\n\tint num;\t\t\t\t\t//åŒ…å«å…ƒç´ çš„ä¸ªæ•°\n    BNode * parent;\n\tNodeType utype;\t\t\t\t//LEAF, BRCH\n    KeyType key[M + 1];\n/*\n    //LEAF\n    Record * recptr[M + 1];\n    BNode * prev, *next;\n    //BRCH\n    BNode * sub[M + 1];\n*/\n    union\n    {\n        struct\t//LEAF\n        {\n        \tRecord * recptr[M + 1];\n            BNode * prev, * next;\n        };\n        //BRCH\n        BNode * sub[M + 1];\n    };\n    struct BNode* parent;\t\n\tElemType data[M + 1];\n\tstruct BNode* sub[M + 1];\n}BNode;\n```\n\nB+æ ‘å’ŒBæ ‘çš„åˆ†æ”¯ç»“æ„ä¸€æ ·ï¼Œä½†å¶å­ç»“æ„ä¸ä¸€æ ·ã€‚\n\né™¤äº†ä¸Šè¿°ç»“æ„ã€‚è¿˜æœ‰ä¸€äº›è§„å®š\n\n```cpp\n#define BRCHMAX (M-1)\n#define BRCHMIN (M/2)\n#define LEAFMAX (M)\n#define LEAFMIN (M/2+1)\n```\n\n# B+æ ‘çš„Insert\n\n```cpp\n#include<iostream>\nusing namespace std;\n#define M 5\n#define BRCHMAX (M-1)\n#define BRCHMIN (M/2)\n#define LEAFMAX (M)\n#define LEAFMIN (M/2+1)\ntypedef char KeyType;\ntypedef struct Record {} Record;\ntypedef enum{BRCH = 1, LEAF = 2}NodeType;\ntypedef struct BNode\n{\n\tint num;\t\t\t\t\t//åŒ…å«å…ƒç´ çš„ä¸ªæ•°\n    BNode * parent;\n\tNodeType utype;\t\t\t\t//LEAF, BRCH\n    KeyType key[M + 1];\n/*\n    //LEAF\n    Record * recptr[M + 1];\n    BNode * prev, *next;\n    //BRCH\n    BNode * sub[M + 1];\n*/\n    union\n    {\n        struct\t//LEAF\n        {\n        \tRecord * recptr[M + 1];\n            BNode * prev, * next;\n        };\n        //BRCH\n        BNode * sub[M + 1];\n    };\n    struct BNode* parent;\t\n\tElemType data[M + 1];\n\tstruct BNode* sub[M + 1];\n}BNode;\n\nBNode* Buynode()\n{\n\tBNode* s = (BNode*)malloc(sizeof(BNode));\n\tif (nullptr == s)exit(1);\n\tmemset(s, 0, sizeof(BNode));\n\treturn s;\n}\nBNode* BuyLeaf()\n{\n    BNode * s = Buynode();\n    s->parent = nullptr;\n    s->utype = LEAF;\n    return s;\n}\nvoid Init_BTree(BTree& tree)\n{\n\ttree.root = nullptr;\n    tree.first = nullptr;\n\ttree.cursize = 0;\n}\nResult FindRoot(BNode * ptr, KeyType kx)\n{\n    Result res = {nullptr, -1, false};\n    BNode * p = ptr;\n    while(p!=nullptr&&p->utype==BRCH)\n    {\n        p->key[0] = kx;\n        int i = p->num;\n        while(kx < p->key[i]) --i;\n        p = p->sub[i];\n    }\n    res = FindLeaf(p, kx);\n    return res;\n}\nResult FindLeaf(BNode * ptr, KeyType kx)\n{\n    Result res = {nullptr, -1, false};\n    BNode * p = ptr;\n    while(p!=nullptr&&p->next!=nullptr && kx > p->key[p->num -1])\n    {\n        p = p->next;\n    }\n    if(p == nullptr)return res;\n    int pos = p->num -1;\n    while(pos >= 0 && kx < p->key[pos])\n    {\n        --pos;\n    }\n    res.pnode = p;\n    res.index = pos;\n    if(pos < 0 && p->prev != nullptr)\n    {\n        res.pnode = p->prev;\n        res.index = p->prev->num -1;\n    }else if(pos >= 0 && kx == p->key[pos])\n    {\n        res.tag = true;\n    }\n    return res;\n}\nResult FindKey(BTree& tree, KeyType kx)\n{\n\tResult res = { nullptr, -1,false };\n\tstruct BNode* ptr = tree.root;\n\twhile (ptr != nullptr)\n\t{\n\t\tptr->data[0].key = kx;\n\t\tint i = ptr->num;\n\t\twhile (i>=0 && ptr->data[i].key)\n\t\t{\n\t\t\t--i;\n\t\t}\n\t\tres.pnode = ptr;\n\t\tres.index = i;\n\t\tif (i > 0 && kx == ptr->data[i].key) \n\t\t{ \n\t\t\tres.tag = true;\n\t\t\tbreak;\n\t\t}\n\t\tptr = ptr->sub[i];\n\t}\n\treturn res;\n}\nBNode* MakeRoot(const KeyType kx, BNode* left, BNode* right)\n{\n\tBNode* s = Buynode();\n\ts->num = 1;\n\ts->parent = nullptr;\n\ts->key[1] = kx;\t\t//\n\ts->sub[0] = left;\n\tif (left != nullptr)left->parent = s;\n\ts->sub[1] = right;\n\tif (right != nullptr)right->parent = s;\n\treturn s;\n}\nvoid Insert_Item(BNode* ptr, int pos, const ElemType& item, BNode* right)\n{\n\tfor (int i = ptr->num; i > pos; --i)\n\t{\n\t\tptr->data[i + 1] = ptr->data[i];\n\t\tptr->sub[i + 1] = ptr->sub[i];\n\t}\n\tptr->data[pos + 1] = item;\t//?\n\tptr->sub[pos + 1] = right;\t//?\n\tptr->num += 1;\n}\nElemType Move_Item(BNode* s, BNode* ptr, int pos)\n{\n\tfor (int i = 0, j = pos + 1; j <= ptr->num; ++i, ++j)\n\t{\n\t\ts->data[i] = ptr->data[j];\n\t\ts->sub[i] = ptr->sub[j];\n\t\tif (s->sub[i] != nullptr)\n\t\t{\n\t\t\ts->sub[i]->parent = s;\n\t\t}\n\t}\n\ts->num = MINSIZE;\n\tptr->num = MINSIZE;\n\ts->parent = ptr->parent;\n\treturn s->data[0];\n}\nBNode* Splice(BNode* ptr)\n{\n\tBNode* s = Buynode();\n\tElemType item = Move_Item(s, ptr, MINSIZE);\n\tif (ptr->parent == nullptr)\n\t{\n\t\treturn MakeRoot(item, ptr, s);\n\t}\n\tBNode* pa = ptr->parent;\n\tint pos = pa->num;\n\tpa->data[0] = item;\n\twhile (pos > 0 && item.key < pa->data[pos].key) { --pos; }\n\tInsert_Item(pa, pos, item, s);\n\tif (pa->num > MAXSIZE)\n\t{\n\t\treturn Splice(pa);\n\t}\n\telse\n\t{\n\t\treturn nullptr;\n\t}\n}\nvoid Insert_Leaf_Item(BNode * ptr, int pos, KeyType kx, Record *rec)\n{\n    for(int i = ptr->num-1; i>pos; --i)\n    {\n        ptr->key[i+1] = ptr->key[i];\n        ptr->recptr[i+1] = ptr->recptr[i];\n    }\n    ptr->key[pos+1] = kx;\n    ptr->recptr[pos+1] = rec;\n    ptr->num+=1;\n}\nKeyType Move_Leaf_Item(BNode *s, BNode* ptr)\n{\n    for(int i = 0;j = LEAFMIN;j<ptr->num;++i,++j)\n    {\n        s->key[i] = key[j];\n        s->recptr[i] = ptr->recptr[j];\n    }\n    s->num = LEAFMIN;\n    ptr->num = LEAFMIN;\n    s->parent = ptr->parent;\n    s->next = ptr->next;\n    s->prev = ptr;\n    ptr->next = s;\n    if(s->next != nullptr)\n    {\n        s->next->prev = s;\n    }\n    return s->key[0];\n}\nBNode* Splice_Leaf(BNode * ptr)\n{\n    BNode * s = BuyLeaf();\n    KeyType kx = Move_Leaf_Item(s, ptr);\n    if(ptr->parent == nullptr)\n    {\n        return MakeRoot(kx, ptr, s);\n    }\n    //\n}\nbool Insert(BTree& tree, KeyType kx, Record * rec)\n{\n\tif (tree.root == nullptr)\n\t{\n\t\tBNode *s = BuyLeaf();\n\t\ts->key[0] = kx;\n        s->recptr[0] = rec;\n        s->num = 1;\n        tree.root = tree.first = s;\n        return true;\n\t}\n\t//ä¸ä¸ºç©º\n\tResult resr = FindRoot(tree.root, kx);\n\tResult resf = FindLeaf(tree.first, kx);\n\tif(resf.pnode == nullptr){cout << \"BTree struct err\"<<endl;return false;}\n    if (resf.tag){cout << \"exist\"<<endl;return false;}\n\t//åœ¨res.pnodeå¤„æ’å…¥\n\tBNode* ptr = resf.pnode;\n\tint pos = resf.index;\n\tInsert_Leaf_Item(ptr, pos, kx, rec);\n\t\n\tif (ptr->num > LEAFMAX)\n\t{\n\t\tBNode* newroot = Splice_Leaf(ptr);\t//åˆ†è£‚\n\t\tif (newroot != nullptr)\n\t\t{\n\t\t\ttree.root = newroot;\n\t\t}\n\t}\n\ttree.cursize += 1;\n\treturn true;\n}\n\nint main()\n{\n\tBTree myt;\n\tInit_BTree(myt);\n\tchar ch[] = { \"qwertyuiopasdfghjklzxcvbnm\" };\n\tint i = 0;\n\twhile (ch[i] != '\\0')\n\t{\n\t\tElemType item = { ch[i],nullptr };\n\t\tcout << Insert(myt, item);\n\t\ti++;\n\t}\n\tcout << endl;\n}\n```\n\n# æ€»ç»“\n\nBæ ‘çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹, å­˜äº†å…³é”®å­—å’Œå¯¹åº”çš„æ•°æ®åœ°å€, è€ŒB+æ ‘çš„éå¶å­èŠ‚ç‚¹åªå­˜å…³é”®å­—, ä¸å­˜æ•°æ®åœ°å€ã€‚å› æ­¤B+æ ‘çš„æ¯ä¸€ä¸ªéå¶å­èŠ‚ç‚¹å­˜å‚¨çš„å…³é”®å­—æ˜¯è¿œè¿œå¤šäºBæ ‘çš„; B+æ ‘çš„å¶å­èŠ‚ç‚¹å­˜æ”¾å…³é”®å­—å’Œæ•°æ®, å› æ­¤ä»æ ‘çš„é«˜åº¦ä¸Šæ¥è¯´B+æ ‘çš„é«˜åº¦è¦å°äºBæ ‘, ä½¿ç”¨çš„ç£ç›˜IOæ¬¡æ•°å°‘, å› æ­¤æŸ¥è¯¢ä¼šæ›´å¿«ä¸€äº›ã€‚\n\nç”±äºBæ ‘æ¯ä¸ªèŠ‚ç‚¹éƒ½å­˜å‚¨å…³é”®å­—å’Œæ•°æ®, å› æ­¤ç¦»æ ¹èŠ‚ç‚¹è¿‘çš„æ•°æ®, æŸ¥è¯¢çš„å°±å¿«, ç¦»æ ¹èŠ‚ç‚¹è¿œçš„æ•°æ®, æŸ¥è¯¢çš„å°±æ…¢; B+æ ‘æ‰€æœ‰çš„æ•°æ®éƒ½å­˜åœ¨å¶å­èŠ‚ç‚¹ä¸Š, å› æ­¤åœ¨B+æ ‘ä¸Šæœç´¢å…³é”®å­—, æ‰¾åˆ°å¯¹åº”æ•°æ®çš„æ—¶é—´æ˜¯æ¯”è¾ƒå¹³å‡çš„, æ²¡æœ‰å¿«æ…¢ä¹‹åˆ†ã€‚\n\nå¦‚æœåœ¨Bæ ‘ä¸ŠåšåŒºé—´æŸ¥æ‰¾, éå†çš„èŠ‚ç‚¹æ˜¯éå¸¸å¤šçš„; B+æ ‘æ‰€æœ‰å¶å­èŠ‚ç‚¹è¢«è¿æ¥æˆäº†æœ‰åºé“¾è¡¨ç»“æ„, å› æ­¤åšæ•´è¡¨éå†å’ŒåŒºé—´æŸ¥æ‰¾æ˜¯éå¸¸å®¹æ˜“çš„ã€‚","categories":["é«˜çº§æ•°æ®ç»“æ„","æ ‘"]},{"title":"é«˜çº§æ•°æ®ç»“æ„_Bstaræ ‘","url":"/é«˜çº§æ•°æ®ç»“æ„/é«˜çº§æ•°æ®ç»“æ„_Bstaræ ‘/","content":"# `B*`\n\næ˜¯B+æ ‘çš„å˜ç§, åœ¨B+æ ‘çš„éæ ¹å’Œéå¶å­ç»“ç‚¹å†å¢åŠ æŒ‡å‘å…„å¼ŸèŠ‚ç‚¹çš„æŒ‡é’ˆã€‚\n\n# å®šä¹‰\n\n`B*`æ ‘å®šä¹‰äº†éå¶å­èŠ‚ç‚¹å…³é”®å­—ä¸ªæ•°è‡³å°‘ä¸º$(2/3)*M$, å³å—çš„æœ€ä½ä½¿ç”¨ç‡ä¸º$2/3$, ä»£æ›¿äº†B+æ ‘çš„$1/2$; \n\n# `B*`å’Œ`B+`èŠ‚ç‚¹åˆ†è£‚çš„å¯¹æ¯”\n\n## B+\n\nå½“ä¸€ä¸ªç»“ç‚¹æ»¡æ—¶ï¼Œåˆ†é…ä¸€ä¸ªæ–°çš„ç»“ç‚¹ï¼Œå¹¶å°†åŸç»“ç‚¹ä¸­$1/2$çš„æ•°æ®å¤åˆ¶åˆ°æ–°ç»“ç‚¹ï¼Œæœ€ååœ¨çˆ¶ç»“ç‚¹ä¸­å¢åŠ æ–°ç»“ç‚¹çš„æŒ‡é’ˆï¼›B+æ ‘çš„åˆ†è£‚åªå½±å“åŸç»“ç‚¹å’Œçˆ¶ç»“ç‚¹ï¼Œè€Œä¸ä¼šå½±å“å…„å¼Ÿç»“ç‚¹ï¼Œæ‰€ä»¥å®ƒä¸éœ€è¦æŒ‡å‘å…„å¼Ÿçš„æŒ‡é’ˆ; \n\n## `B*`\n\n`B*`æ ‘çš„åˆ†è£‚å½“ä¸€ä¸ªç»“ç‚¹æ»¡æ—¶ï¼Œå¦‚æœå®ƒçš„ä¸‹ä¸€ä¸ªå…„å¼Ÿç»“ç‚¹æœªæ»¡ï¼Œé‚£ä¹ˆå°†ä¸€éƒ¨åˆ†æ•°æ®ç§»åˆ°å…„å¼Ÿç»“ç‚¹ä¸­ï¼Œå†åœ¨åŸç»“ç‚¹æ’å…¥å…³é”®å­—ï¼Œæœ€åä¿®æ”¹çˆ¶ç»“ç‚¹ä¸­å…„å¼Ÿç»“ç‚¹çš„å…³é”®å­—ï¼ˆå› ä¸ºå…„å¼Ÿç»“ç‚¹çš„å…³é”®å­—èŒƒå›´æ”¹å˜äº†ï¼‰ï¼›å¦‚æœå…„å¼Ÿä¹Ÿæ»¡äº†ï¼Œåˆ™åœ¨åŸç»“ç‚¹ä¸å…„å¼Ÿç»“ç‚¹ä¹‹é—´å¢åŠ æ–°ç»“ç‚¹ï¼Œå¹¶å„å¤åˆ¶$1/3$çš„æ•°æ®åˆ°æ–°ç»“ç‚¹ï¼Œæœ€ååœ¨çˆ¶ç»“ç‚¹å¢åŠ æ–°ç»“ç‚¹çš„æŒ‡é’ˆ;\n\næ‰€ä»¥ï¼Œ`B*`æ ‘åˆ†é…æ–°ç»“ç‚¹çš„æ¦‚ç‡æ¯”`B+`æ ‘è¦ä½ï¼Œç©ºé—´ä½¿ç”¨ç‡æ›´é«˜ï¼Œåœ¨`B+`æ ‘åŸºç¡€ä¸Šï¼Œä¸ºéå¶å­ç»“ç‚¹ä¹Ÿå¢åŠ é“¾è¡¨æŒ‡é’ˆï¼Œå°†ç»“ç‚¹çš„æœ€ä½åˆ©ç”¨ç‡ä»$1/2$æé«˜åˆ°$2/3$ã€‚","categories":["é«˜çº§æ•°æ®ç»“æ„","æ ‘"]},{"title":"32ä½å’Œ64ä½åŒºåˆ«","url":"/è®¡ç®—æœºçŸ¥è¯†ä½“ç³»/32ä½å’Œ64ä½åŒºåˆ«/","content":"# èŒƒå½¬\n\né“¾æ¥ï¼šhttps://www.zhihu.com/question/23408154/answer/24499675\n\n64bitè½¯ä»¶å’Œ32bitè½¯ä»¶æœ€å¤§çš„åŒºåˆ«æ˜¯64bitçš„è½¯ä»¶å¯ä»¥åŒæ—¶æ“ä½œå¤§äº4GBçš„å†…å­˜ã€‚æ³¨æ„è¿™é‡Œçš„å†…å­˜æŒ‡çš„æ˜¯åœ°å€ç©ºé—´ï¼Œè€Œä¸æ˜¯ç‰©ç†å†…å­˜ã€‚æ¯”å¦‚ç°åœ¨æœ‰ä¸€ä¸ª10GBçš„æ•°æ®åº“éœ€è¦è¿›è¡Œæ’åºã€‚64bitçš„è½¯ä»¶å¯ä»¥mallocä¸€ä¸ª10GBçš„ç©ºé—´æŠŠæ•´ä¸ªæ•°æ®åº“â€œæ”¾è¿›â€å†…å­˜ç„¶åä½¿ç”¨ä»»æ„ç»å…¸æ’åºç®—æ³•ï¼Œè€Œ32bitçš„è½¯ä»¶åœ¨mallocæ—¶å°±ä¼šå´©æºƒï¼ˆout-of-memoryï¼‰ã€‚æ‰€ä»¥32ä½è½¯ä»¶çš„ç¨‹åºå‘˜åªèƒ½ä½¿ç”¨å¤æ‚çš„ç®—æ³•æ˜¾å¼çš„åˆ†å—è¯»å…¥ï¼Œå±€éƒ¨æ’åºï¼Œå†™å›æ•°æ®åº“ï¼Œç„¶åé‡å¤ã€‚è¿™æ ·ä¸ä»…ç¨‹åºå¤æ‚éš¾å†™ï¼Œç¨‹åºå‘˜swapå†…å­˜å’Œæ–‡ä»¶çš„ç®—æ³•æ•ˆç‡å¯èƒ½ä¹Ÿä¸å¦‚OSè‡ªåŠ¨å¤„ç†æ¥çš„é«˜æ•ˆã€‚\n\nå¦ä¸€æ–¹é¢ï¼Œ64bitè½¯ä»¶å·¨å¤§çš„å†…å­˜ç©ºé—´ä¹Ÿå¯èƒ½åŠ é€Ÿç‰©ç†å†…å­˜çš„æ¶ˆè€—ï¼Œå¢åŠ å¯»å€çš„å¼€é”€ï¼Œå› æ­¤æœªå¿…æ€»æ˜¯èƒ½å¤Ÿæé«˜æ€§èƒ½ã€‚\n\nå½“ç„¶æœ€ç»ˆç³»ç»Ÿçš„æ•ˆç‡è¿˜æ˜¯å–å†³äºç‰©ç†å†…å­˜çš„å¤§å°ï¼Œ64bitåªæ˜¯è§£å†³äº†åœ°å€ç©ºé—´çš„ç“¶é¢ˆã€‚\n\n# è¡¥ä½³æ—çš„å›ç­”\n\n64 ä½è½¯ä»¶å’Œ 32 ä½æœ‰ä»€ä¹ˆå…·ä½“åŒºåˆ«ï¼Ÿ - è¡¥ä½³æ—çš„å›ç­” - çŸ¥ä¹ https://www.zhihu.com/question/23408154/answer/24537270\n\næˆ‘æ¥è¯´ä¸ªä¸å¥½çš„åœ°æ–¹ï¼Œ64ä½ä¸‹æŒ‡é’ˆå˜æˆ8å­—èŠ‚ï¼Œå¾ˆå¤šcç»“æ„ä½“å ç”¨ç©ºé—´åŠ å¤§ï¼Œç›¸å½“äºcpuçš„ç¼“å­˜å˜å°äº†ã€‚\n\n# gggxxx\n\né“¾æ¥ï¼šhttps://www.zhihu.com/question/23408154/answer/24527239\n\né™¤äº†å†…å­˜è®¿é—®æ›´é‡è¦çš„è¿˜æœ‰64ä½æŒ‡ä»¤é›†è¿ç®—ã€‚ç†è®ºä¸Š64ä½è¿ç®—å¼ºäº32ä½è¿ç®—ï¼Œä½†æ˜¯è¿™ä¾èµ–äºä»£ç ä¼˜åŒ–ã€‚\n\nå¯¹æ™®é€šç”¨æˆ·æ¥è¯´æœ‰2ç‚¹ã€‚\n\n1. ç°åœ¨ä¸»æµçš„æ¯”è¾ƒæ–°çš„æ¡Œé¢æ“ä½œç³»ç»Ÿéƒ½æ˜¯åŒæ—¶å…¼å®¹64ä½ç¨‹åºå’Œ32ä½ç¨‹åºï¼ŒåŒ…æ‹¬iosä¹Ÿæ˜¯åŒæ—¶å…¼å®¹32ä½å’Œ64ä½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·ä¸ç®¡å®‰è£…32ä½è¿˜æ˜¯64ä½ç¨‹åºéƒ½æ²¡æœ‰é—®é¢˜ã€‚\n\n2. è½¯ä»¶ç¼–è¯‘æˆ64ä½åå¹¶ä¸ä¸€å®šæ¯”32ä½ç¨‹åºè¿è¡Œé€Ÿåº¦å¿«ï¼Œå¾ˆå¤šæ—¶å€™64ä½ç¨‹åºéƒ½æ…¢äº32ä½ç¨‹åºã€‚äº‹å®ä¸Šå¾ˆå¤šå¼€å‘è€…æŠŠç¨‹åºä»32ä½è½¬åŒ–æˆ64ä½ï¼Œåªæ˜¯åšå…¼å®¹64ä½è€Œå·²ï¼Œæ ¹æœ¬æ²¡æœ‰é’ˆå¯¹64ä½ç‰¹æ€§åšä¼˜åŒ–ã€‚\n\nå¾ˆå¤šæµè¡Œè½¯ä»¶çš„32ä½ç‰ˆæœ¬å…¶å®æ›´åŠ ç¨³å®šå’Œé€Ÿåº¦å¿«ã€‚\n\n# åŒ¿åç”¨æˆ·\n\né“¾æ¥ï¼šhttps://www.zhihu.com/question/23408154/answer/30793420\n\nå¤šå°‘ä½æ˜¯æŒ‡cpuçš„å¯„å­˜å™¨å®½åº¦ä¸åŒï¼Œæ¯”å¦‚16ä½é€šç”¨å¯„å­˜å™¨æœ‰ä¸€ä¸ªå«axï¼Œè¿™æ„å‘³ç€axå¯„å­˜å™¨èƒ½å­˜å‚¨16bitæ•°æ®, åœ¨32ä½ä¸­è¿™ä¸ªå¯„å­˜å™¨æ˜¯eaxï¼Œèƒ½å­˜å‚¨32bitæ•°æ®ã€‚64ä½ä¸­å«raxã€‚\n\nå¯»å€èƒ½åŠ›æ˜¯æŒ‡cpuå¯»å€æ€»çº¿çš„å®½åº¦ã€‚æ¯”å¦‚16ä½çš„x86çš„uå¯»å€èƒ½åŠ›æ˜¯20ä½ï¼Œå› ä¸ºå¯„å­˜å™¨åªæœ‰16ä½ï¼Œæ‰€ä»¥ç”¨seg x16 + offsetçš„æ–¹å¼è¡¨ç¤ºï¼Œè¿™å°±æ˜¯æ•™ç§‘ä¹¦ä¸Šæ‰€è¯´çš„é€»è¾‘åœ°å€ã€‚å®é™…ä¸Šé€»è¾‘åœ°å€å¯èƒ½äº§ç”Ÿ21ä½çš„åœ°å€ï¼Œä½†æ˜¯å› ä¸ºå¯»å€æ€»çº¿çš„å®½åº¦åªæœ‰20æ‰€ä»¥æº¢å‡ºçš„ä¸€ä½éƒ½ä¼šè¢«æŠ›å¼ƒã€‚åœ¨è®¡ç®—æœºå¼€æœºçš„è¿‡ç¨‹ä¸­ï¼Œbootloaderå°±ä¼šè¯»å†™keyboard controllerçš„60å’Œ64ç«¯å£åˆ¤æ–­æ˜¯å¦å¼€å¯å¤§äº20ä½çš„å¯»å€æ¨¡å¼ã€‚\n\n# å‘¨å…¨\n\n64 ä½è½¯ä»¶å’Œ 32 ä½æœ‰ä»€ä¹ˆå…·ä½“åŒºåˆ«ï¼Ÿ - å‘¨å…¨çš„å›ç­” - çŸ¥ä¹ https://www.zhihu.com/question/23408154/answer/24542634\n\n1ã€å¯¹osæ¥è¯´ï¼Œ64ä½å’Œ32ä½æŒ‡è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œ32ä½æœ€å¤§4GBï¼Œ64ä½ç†è®ºä¸Š16TBï¼Œä¸”ç›®å‰æœ‰16TBçš„\n\n2ã€å¯¹ç¡¬ä»¶æ¥è¯´ï¼Œ64ä½å’Œ32ä½æŒ‡æ•°æ®å®½åº¦ï¼Œ64ä½ä¸€æ¬¡å–8å­—èŠ‚ï¼Œ32å–4å­—èŠ‚\n\n3ã€å¯¹åº”ç”¨ç¨‹åºæ¥è¯´ï¼ŒæŒ‡ä½¿ç”¨çš„æŒ‡ä»¤å®½åº¦ï¼ŒåŸºäºOSå’Œç¡¬ä»¶\n","categories":["æ“ä½œç³»ç»Ÿ","è®¡ç®—æœºçŸ¥è¯†ä½“ç³»"]},{"title":"MySQLæ•°æ®åº“è¿æ¥æ± ","url":"/é¡¹ç›®/MySQLæ•°æ®åº“è¿æ¥æ± /","content":"\n# å†…å®¹\n\nC++å®ç°çš„å°å‹é¡¹ç›®, MySQLæ•°æ®åº“è¿æ¥æ± , å±äºå¸¸ç”¨ç»„ä»¶;\n\nçº¦400åˆ°500è¡Œä»£ç , ä»£ç ä¸å¤š, éº»é›€è™½å°, äº”è„ä¿±å…¨: \n\n1. æ¶‰åŠåˆ°æ•°æ®åº“ç¼–ç¨‹;\n2. å•ä¾‹æ¨¡å¼\n3. queueé˜Ÿåˆ—å®¹å™¨\n4. `C++11`å¤šçº¿ç¨‹ç¼–ç¨‹, çº¿ç¨‹äº’æ–¥, çº¿ç¨‹åŒæ­¥é€šä¿¡, `unique_lock`\n5. åŸºäºCASçš„åŸå­ç±»å‹\n6. æ™ºèƒ½æŒ‡é’ˆ`shared_ptr`\n7. lambdaè¡¨è¾¾å¼\n8. ç”Ÿäº§è€…-æ¶ˆè´¹è€…çº¿ç¨‹æ¨¡å‹\n\n# é¡¹ç›®èƒŒæ™¯\n\nä¸ºäº†æé«˜MySQLæ•°æ®åº“ï¼ˆéœ€è¦ç‰¹åˆ«æ³¨æ„çš„, å®ƒæ˜¯åŸºäºC/Sè®¾è®¡çš„ï¼‰çš„è®¿é—®ç“¶é¢ˆï¼Œé™¤äº†åœ¨æœåŠ¡å™¨ç«¯å¢åŠ ç¼“å­˜æœåŠ¡å™¨ç¼“å­˜å¸¸ç”¨çš„æ•°æ®ä¹‹å¤–ï¼ˆä¾‹å¦‚Redisï¼‰ï¼Œè¿˜å¯ä»¥å¢åŠ è¿æ¥æ± ï¼Œæ¥æé«˜MySQL Serverçš„è®¿é—®æ•ˆç‡ï¼Œåœ¨é«˜å¹¶å‘æƒ…å†µä¸‹ï¼Œå¤§é‡çš„TCPä¸‰æ¬¡æ¡æ‰‹ã€MySQL Serverè¿æ¥è®¤è¯ã€MySQL Serverå…³é—­è¿æ¥å›æ”¶èµ„æºå’ŒTCPå››æ¬¡æŒ¥æ‰‹æ‰€è€—è´¹çš„æ€§èƒ½æ—¶é—´ä¹Ÿæ˜¯å¾ˆæ˜æ˜¾çš„ï¼Œå¢åŠ è¿æ¥æ± å°±æ˜¯ä¸ºäº†å‡å°‘è¿™ä¸€éƒ¨åˆ†çš„æ€§èƒ½æŸè€—ã€‚\n\nåœ¨å¸‚åœºä¸Šæ¯”è¾ƒæµè¡Œçš„è¿æ¥æ± åŒ…æ‹¬é˜¿é‡Œçš„druidï¼Œc3p0ä»¥åŠapache dbcpè¿æ¥æ± ï¼Œå®ƒä»¬å¯¹äºçŸ­æ—¶é—´å†…å¤§é‡çš„æ•°æ®åº“å¢åˆ æ”¹æŸ¥æ“ä½œæ€§èƒ½çš„æå‡æ˜¯å¾ˆæ˜æ˜¾çš„ï¼Œä½†æ˜¯å®ƒä»¬å…¨éƒ¨ç”±Javaå®ç°ã€‚é‚£ä¹ˆæœ¬é¡¹ç›®å°±æ˜¯ä¸ºäº†åœ¨`C/C++`è¯­è¨€ä¸‹ï¼Œæä¾›MySQL Serverçš„è®¿é—®æ•ˆç‡ï¼Œå®ç°åŸºäº`C++`ä»£ç çš„æ•°æ®åº“è¿æ¥æ± æ¨¡å—ã€‚\n\n# è¿æ¥æ± åŠŸèƒ½ä»‹ç»\n\nè¯¥é¡¹ç›®æ˜¯åŸºäºC++è¯­è¨€å®ç°çš„è¿æ¥æ± ï¼Œä¸»è¦å®ç°è‹¥å¹²ä¸ªé€šç”¨åŸºç¡€åŠŸèƒ½ã€‚\n\nè¿æ¥æ± ä¸€èˆ¬åŒ…å«äº†æ•°æ®åº“è¿æ¥æ‰€ç”¨çš„ipåœ°å€ã€portç«¯å£å·ã€ç”¨æˆ·åå’Œå¯†ç ä»¥åŠå…¶å®ƒçš„æ€§èƒ½å‚æ•°ï¼Œä¾‹å¦‚åˆ\nå§‹è¿æ¥é‡ï¼Œæœ€å¤§è¿æ¥é‡ï¼Œæœ€å¤§ç©ºé—²æ—¶é—´ã€è¿æ¥è¶…æ—¶æ—¶é—´ç­‰;\n\n1. **åˆå§‹è¿æ¥é‡(initSize)**\n    1. è¡¨ç¤ºè¿æ¥æ± äº‹å…ˆä¼šå’ŒMySQL Serveråˆ›å»ºinitSizeä¸ªæ•°çš„connectionè¿æ¥;\n    2. å½“åº”ç”¨å‘èµ·MySQLè®¿é—®æ—¶ï¼Œä¸ç”¨å†åˆ›å»ºå’ŒMySQL Serveræ–°çš„è¿æ¥ï¼Œç›´æ¥ä»è¿æ¥æ± ä¸­è·å–ä¸€ä¸ªå¯ç”¨çš„è¿æ¥å°±å¯ä»¥;\n    3. ä½¿ç”¨å®Œæˆåï¼Œå¹¶ä¸å»é‡Šæ”¾connectionï¼Œè€Œæ˜¯æŠŠå½“å‰connectionå†å½’è¿˜åˆ°è¿æ¥æ± å½“ä¸­ã€‚\n2. **æœ€å¤§è¿æ¥é‡(maxSize)**\n    1. æ€»çš„è¿æ¥æ•°é‡ä¸Šé™æ˜¯maxSize;\n    2. å½“å¹¶å‘è®¿é—®MySQL Serverçš„è¯·æ±‚å¢å¤šæ—¶ï¼Œåˆå§‹è¿æ¥é‡å·²ç»ä¸å¤Ÿä½¿ç”¨äº†ï¼Œæ­¤æ—¶ä¼šæ ¹æ®æ–°çš„è¯·æ±‚æ•°é‡å»åˆ›å»ºæ›´å¤šçš„è¿æ¥ç»™åº”ç”¨å»ä½¿ç”¨;\n    3. ä½†æ˜¯ï¼Œä¸èƒ½æ— é™åˆ¶çš„åˆ›å»ºè¿æ¥ï¼Œå› ä¸ºæ¯ä¸€ä¸ªè¿æ¥éƒ½ä¼šå ç”¨ä¸€ä¸ªsocketèµ„æºï¼Œä¸€èˆ¬è¿æ¥æ± å’ŒæœåŠ¡å™¨ç¨‹åºæ˜¯éƒ¨ç½²åœ¨ä¸€å°ä¸»æœºä¸Šçš„ï¼Œå¦‚æœè¿æ¥æ± å ç”¨è¿‡å¤šçš„socketèµ„æºï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±ä¸èƒ½æ¥æ”¶å¤ªå¤šçš„å®¢æˆ·ç«¯è¯·æ±‚äº†;\n    4. å½“è¿™äº›è¿æ¥ä½¿ç”¨å®Œæˆåï¼Œå†æ¬¡å½’è¿˜åˆ°è¿æ¥æ± å½“ä¸­æ¥ç»´æŠ¤ã€‚\n3. **æœ€å¤§ç©ºé—²æ—¶é—´(maxIdleTime)**\n    1. å½“è®¿é—®MySQLçš„å¹¶å‘è¯·æ±‚å¤šäº†ä»¥åï¼Œè¿æ¥æ± é‡Œé¢çš„è¿æ¥æ•°é‡ä¼šåŠ¨æ€å¢åŠ ï¼Œä¸Šé™æ˜¯maxSizeä¸ª;\n    2. å½“è¿™äº›è¿æ¥ç”¨å®Œå†æ¬¡å½’è¿˜åˆ°è¿æ¥æ± å½“ä¸­;\n    3. å¦‚æœåœ¨æŒ‡å®šçš„maxIdleTimeé‡Œé¢ï¼Œè¿™äº›æ–°å¢åŠ çš„è¿æ¥éƒ½æ²¡æœ‰è¢«å†æ¬¡ä½¿ç”¨è¿‡ï¼Œé‚£ä¹ˆæ–°å¢åŠ çš„è¿™äº›è¿æ¥èµ„æºå°±è¦è¢«å›æ”¶æ‰ï¼Œåªéœ€è¦ä¿æŒåˆå§‹è¿æ¥é‡initSizeä¸ªè¿æ¥å°±å¯ä»¥äº†ã€‚\n4. **è¿æ¥è¶…æ—¶æ—¶é—´(connectionTimeout)**\n    1. å½“MySQLçš„å¹¶å‘è¯·æ±‚é‡è¿‡å¤§ï¼Œè¿æ¥æ± ä¸­çš„è¿æ¥æ•°é‡å·²ç»åˆ°è¾¾maxSizeäº†ï¼Œè€Œæ­¤æ—¶æ²¡æœ‰ç©ºé—²çš„è¿æ¥å¯ä¾›ä½¿ç”¨ï¼Œé‚£ä¹ˆæ­¤æ—¶åº”ç”¨ä»è¿æ¥æ± è·å–è¿æ¥éœ€è¦é€šè¿‡é˜»å¡çš„æ–¹å¼è·å–è¿æ¥;\n    2. é˜»å¡æ—¶é—´å¦‚æœè¶…è¿‡connectionTimeoutæ—¶é—´ï¼Œé‚£ä¹ˆè·å–è¿æ¥å¤±è´¥ï¼Œæ— æ³•è®¿é—®æ•°æ®åº“;\n\nè¯¥é¡¹ç›®ä¸»è¦å®ç°ä¸Šè¿°çš„è¿æ¥æ± å››å¤§åŠŸèƒ½ï¼Œå…¶ä½™è¿æ¥æ± æ›´å¤šçš„æ‰©å±•åŠŸèƒ½ï¼Œå¯ä»¥åœ¨è¯¥æ¡†æ¶çš„åŸºç¡€ä¸Šè¿›è¡Œå¾ˆå¥½çš„æ‹“å±•;\n\n# è®¾è®¡æ€è·¯\n\n1. éœ€è¦æŠ½è±¡å‡ºä¸¤ä¸ªç±»\n    1. ConnectionPool - è¿æ¥æ± \n    2. Connection - å°è£…æ•°æ®åº“æ“ä½œ, å¢åˆ æ”¹æŸ¥\n2. è¿æ¥æ± åªéœ€è¦ä¸€ä¸ªå®ä¾‹, åˆ™ConnectionPoolè®¾è®¡ä¸ºå•ä¾‹æ¨¡å¼\n3. ConnectionPooléœ€è¦æä¾›è·å–MySQLè¿æ¥Connectionçš„æ¥å£\n4. ç©ºé—²è¿æ¥Connectionå…¨éƒ¨ç»´æŠ¤åœ¨ä¸€ä¸ªConnectioné˜Ÿåˆ—ä¸­, ä½¿ç”¨äº’æ–¥é”ä¿è¯é˜Ÿåˆ—çš„çº¿ç¨‹å®‰å…¨\n5. å¦‚æœåœ¨è·å–è¿æ¥æ—¶å‘ç°ç©ºé—²è¿æ¥é˜Ÿåˆ—ç©º, åˆ™éœ€è¦åŠ¨æ€åˆ›å»ºæ–°è¿æ¥, ä½†æ˜¯ä¸Šé™æ•°é‡æ˜¯maxSize, åœ¨åˆ›å»ºæ–°è¿æ¥çš„è¿‡ç¨‹ä¸­, æ¶ˆè´¹è€…çº¿ç¨‹éœ€è¦**å¿™ç­‰å¾…**connectionTimeoutæ—¶é•¿, ç›´åˆ°é˜Ÿåˆ—ä¸­ä¸ç©º; è‹¥æ—¶é•¿ä¸€åˆ°ä»è·å–æœªæœåˆ™è®¤å®šä¸ºè¿æ¥å¤±è´¥; å¯ä»¥ä½¿ç”¨å¸¦è¶…æ—¶æ—¶é—´çš„mutexäº’æ–¥é”æ¥å®ç°è¿æ¥è¶…æ—¶æ—¶é—´;\n6. ä½¿ç”¨é‡ä¸‹é™å, å¦‚æœé˜Ÿåˆ—ä¸­çš„ç©ºé—²è¿æ¥ä¿æŒç©ºé—²è¶…è¿‡maxIdleTime, éœ€è¦é‡Šæ”¾è¿æ¥, ç›´åˆ°å‡å°‘åˆ°initSizeä¸ªè¿æ¥; è¿™ä¸ªé‡Šæ”¾çš„è¿‡ç¨‹éœ€è¦æ”¾åœ¨ç‹¬ç«‹çº¿ç¨‹åš - **å®šæ—¶çº¿ç¨‹**, æ¸…ç†é˜Ÿåˆ—å¤šä½™çš„ç©ºé—²è¿æ¥;\n7. ç”¨æˆ·è·å–çš„è¿æ¥ç”¨`shared_ptr`æ™ºèƒ½æŒ‡é’ˆæ¥ç®¡ç†ï¼Œç”¨lambdaè¡¨è¾¾å¼å®šåˆ¶è¿æ¥é‡Šæ”¾çš„åŠŸèƒ½ï¼ˆä¸çœŸæ­£é‡Šæ”¾è¿æ¥ï¼Œè€Œæ˜¯æŠŠè¿æ¥å½’è¿˜åˆ°è¿æ¥æ± ä¸­ï¼‰\n8. è¿æ¥çš„ç”Ÿäº§å’Œè¿æ¥çš„æ¶ˆè´¹é‡‡ç”¨`ç”Ÿäº§è€…-æ¶ˆè´¹è€…`çº¿ç¨‹æ¨¡å‹æ¥è®¾è®¡ï¼Œä½¿ç”¨äº†çº¿ç¨‹é—´çš„åŒæ­¥é€šä¿¡æœºåˆ¶æ¡ä»¶å˜é‡å’Œäº’æ–¥é”;\n\n# MySQLæ•°æ®åº“ç¼–ç¨‹\n\n## å…¬å…±ä»£ç \nç®€æ˜“æ—¥å¿—å·¥å…· - å‘æ ‡å‡†è¾“å‡ºè®¾å¤‡è¾“å‡º\n\n```cpp\n#include<iostream>\n#define LOG(str)                                            \\\n    do {                                                    \\\n    std::cout << __FILE__ << \":\" << __LINE__ << \":\"         \\\n              << __TIMESTAMP__ << \":\" << str << std::endl;  \\\n    } while(0)\n```\n\n## MySQLConnection - å°è£…MySQLæ•°æ®åº“æ“ä½œ\n\n### æˆå‘˜å˜é‡\n\n`MYSQL *m_conn` - è®°å½•MYSQLç±»å‹çš„æŒ‡é’ˆ, ä»¥è·å–è¿™ä¸ªmysqlè¿æ¥\n\n```cpp\nprivate:\n    MYSQL *m_conn;\n```\n\n### æˆå‘˜å‡½æ•°\n\n1. æ„é€ /ææ„ - åˆå§‹åŒ–/é‡Šæ”¾æ•°æ®åº“è¿æ¥\n\n```cpp\npublic:\n    /* åˆå§‹åŒ–æ•°æ®åº“è¿æ¥ */\n    MySQLConnection();\n    /* é‡Šæ”¾æ•°æ®åº“è¿æ¥èµ„æº */\n    ~MySQLConnection();\n```\n\n2. getConnection - è·å–è¿æ¥, å³è·å–æˆå‘˜`m_conn`\n\n```cpp\npublic:\n    /* è·å–è¿æ¥ */\n    MYSQL * getConnection();\n```\n\n3. connect - è¿æ¥æ•°æ®åº“, è¿”å›å€¼ä¸ºbool, è¯´æ˜è¿æ¥æˆåŠŸä¸å¦\n\n```cpp\npublic:\n    /* è¿æ¥æ•°æ®åº“ */\n    bool connect(std::string ip, unsigned short port,\n                std::string user, std::string password, std::string dbname);\n```\n\n4. query - æŸ¥è¯¢æ“ä½œ, å‚æ•°æ˜¯stringç±»å‹çš„sqlè¯­å¥, è¿”å›å€¼ä¸º`MYSQL_RES`, å³MySQLç»“æœé›†ç±»å‹\n\n```cpp\npublic:\n    /* æŸ¥è¯¢æ“ä½œ */\n    MYSQL_RES * query(std::string sql);\n```\n\n5. update - æ›´æ–°æ“ä½œ, å‚æ•°æ˜¯stringç±»å‹çš„sqlè¯­å¥, è¿”å›å€¼ä¸ºbool, è¯´æ˜æ›´æ–°æˆåŠŸä¸å¦\n\n```cpp\npublic:\n    /* æ›´æ–°æ“ä½œ */\n    bool update(std::string sql);\n```\n\n### ä»£ç å®ç°\n\n1. æ„é€  - è°ƒç”¨`mysql_init`, å®é™…ä¸Šåªæ˜¯å¯¹mysqlè¿æ¥è¿›è¡Œç©ºé—´èµ„æºçš„å¼€è¾Ÿ, è¿”å›ä¸€ä¸ªæŒ‡é’ˆèµ‹ç»™`m_conn`æˆå‘˜, æ²¡æœ‰çœŸæ­£è¿æ¥, å› æ­¤ä¼ å…¥nullptr\n\n```cpp\n/* åˆå§‹åŒ–æ•°æ®åº“è¿æ¥ */\nMySQLConnection::MySQLConnection()\n{\n    m_conn = mysql_init(nullptr);\n}\n```\n\n2. ææ„ - è°ƒç”¨`mysql_close(m_conn)`, å¯¹MySQLè¿æ¥èµ„æºè¿›è¡Œé‡Šæ”¾\n\n```cpp\n/* é‡Šæ”¾æ•°æ®åº“è¿æ¥èµ„æº */\nMySQLConnection::~MySQLConnection()\n{\n    if(m_conn != nullptr)\n    {\n       mysql_close(m_conn);\n    }\n}\n```\n\n3. connect - è¿æ¥æ•°æ®åº“, å†…éƒ¨è°ƒç”¨`mysql_real_connect`, ä¼ å…¥`m_conn`, ä»¥åŠserver ipåœ°å€, userå·, å¯†ç , è¦è¿æ¥çš„æ•°æ®åº“name, æœåŠ¡å™¨ç«¯å£;\n\n```cpp\n/* è¿æ¥æ•°æ®åº“ */\nbool MySQLConnection::connect(std::string ip, unsigned short port,\n                              std::string user, std::string password,\n                              std::string dbname)\n{\n    MYSQL *p = mysql_real_connect(m_conn, ip.c_str(), user.c_str(),\n                                  password.c_str(), dbname.c_str(),\n                                  port, nullptr, 0);\n    if(p != nullptr)\n    {\n        /**\n         * C/C++ä»£ç é»˜è®¤çš„ç¼–ç å­—ç¬¦æ˜¯ASCII, \n         * å¦‚æœä¸è®¾ç½®, åˆ™ä»MySQLä¸Šæ‹‰ä¸‹æ¥çš„ä¸­æ–‡æ— æ³•æ­£å¸¸æ˜¾ç¤º\n         */\n        mysql_query(m_conn, \"set name gbk\");\n        LOG(\"connect mysql success!\");\n    }\n    else\n    {\n       LOG(\"connect mysql failed!\");\n    }\n    return p != nullptr;\n}\n```\n\n4. query - æŸ¥è¯¢æ“ä½œ\n    1. å†…éƒ¨è°ƒç”¨`mysql_query`, ä¼ å…¥`m_conn`, `sql-string`çš„Cé£æ ¼å­—ç¬¦ä¸²é¦–å€;\n        1. `mysql_query`çš„è¿”å›å€¼:\n            1. å¦‚æœæŸ¥è¯¢æˆåŠŸï¼Œè¿”å›0;\n            2. å¦‚æœå‡ºç°é”™è¯¯ï¼Œè¿”å›é0å€¼ã€‚\n    2. è¿”å›å€¼éœ€è¦è°ƒç”¨`mysql_use_result(m_conn)`è·å–ç»“æœé›†, å†return;\n\n```cpp\n/* æŸ¥è¯¢æ“ä½œ */\nMYSQL_RES * MySQLConnection::query(std::string sql)\n{\n    if(mysql_query(m_conn, sql.c_str()) == 0)\n    {\n        LOG(\"select failed: \" + sql);\n        return nullptr;\n    }\n    return mysql_use_result(m_conn);\n}\n```\n\n7. update - æ›´æ–°æ“ä½œ\n    1. å†…éƒ¨è°ƒç”¨`mysql_query`, ä¼ å…¥`m_conn`, `sql-string`çš„cé£æ ¼å­—ç¬¦ä¸²é¦–å€;\n    2. åˆ¤æ–­`mysql_query`çš„è¿”å›å€¼, è‹¥ä¸ºé0åˆ™æ›´æ–°å¤±è´¥; è‹¥ä¸º0åˆ™æ›´æ–°æˆåŠŸ;\n\n```cpp\n/* æ›´æ–°æ“ä½œ */\nbool MySQLConnection::update(std::string sql)\n{\n    if(mysql_query(m_conn, sql.c_str()) == 0)\n    {\n        LOG(\"update failed: \" + sql);\n        return false;\n    }\n    return true;\n}\n```\n\n# è¿æ¥æ± \n\n## MySQLConnectionPool\n\n### æˆå‘˜å˜é‡\n\n### æˆå‘˜å‡½æ•°\ngetConnection\n```cpp\n/* è·å–è¿æ¥ */\nMYSQL * MySQLConnection::getConnection()\n{\n    return m_conn;\n}\n```\n### ä»£ç å®ç°\n# å‹åŠ›æµ‹è¯•\n\nå»ºä¸ªè¡¨\n\n```mysql\nCREATE TABLE user(\n    id INT UNSIGNED PRIMARY KEY NOT NULL AUTO_INCREMENT,\n    name VARCHAR(50) NOT NULL,\n    age TINYINT NOT NULL,\n    sex ENUM('male', 'female') NOT NULL\n)ENGINE=INNODB DEFAULT CHARSET=utf8;\n```\n","categories":["é¡¹ç›®","æ•°æ®åº“","è¿æ¥æ± "]},{"title":"é‡å†™muduoåº“","url":"/é¡¹ç›®-muduo/é‡å†™muduoåº“/","content":"# å†…å®¹\n1. muduoåº“çš„ä¸»è¦æ¿å—\n    1. baseï¼šå…¬å…±çš„ä»£ç æ–‡ä»¶\n    2. netï¼šç½‘ç»œç›¸å…³çš„ï¼Œå¦‚TcpServerã€EventLoopã€pollerã€protobufã€protorpcç­‰ç­‰\n        1. æˆ‘ä»¬ä¸»è¦å†™ç½‘ç»œæ¨¡å—\n# ç›®æ ‡\nä¸»è¦ç¼–å†™muduoåº“çš„ç½‘ç»œæ¨¡å—ä»£ç ï¼Œä»¥åŠæ”¹è¿›muduoåº“åœ¨ä½¿ç”¨ä¸Šçš„ä¸ä¾¿ã€‚\nmuduoåº“åŸæœ¬å±äºé™æ€åº“ï¼Œä¸”éœ€è¦ä¾èµ–booståº“ã€‚æˆ‘ä»¬æ”¹è¿›å®ƒï¼Œä½¿ä»–ä¸åŸç”ŸC++æ ‡å‡†åº“ç»“åˆï¼Œå¹¶æŠŠå®ƒç”Ÿæˆä¸º`.so`åŠ¨æ€åº“ã€‚\n# muduoåº“æ ¸å¿ƒç»„ä»¶èŒè´£ä¸å…³ç³»\n## Reactoræ¨¡å¼çš„æ ¸å¿ƒ\n1. EventLoopäº‹ä»¶å¾ªç¯\n    1. èŒè´£ï¼šæ¯ä¸ªçº¿ç¨‹ä¸€ä¸ªEventLoopã€‚ä¸æ–­åœ°â€è¯¢é—® - å¤„ç†â€œäº‹ä»¶\n    2. å…³ç³»ï¼š\n        1. æ‹¥æœ‰ä¸€ä¸ª`Poller`ï¼šEventLoopé€šè¿‡Polleræ¥è·å–å½“å‰æ´»è·ƒçš„äº‹ä»¶\n        2. æ‹¥æœ‰ä¸€ä¸ª`Channel`ï¼šEventLoopç®¡ç†æ‰€æœ‰åœ¨å…¶ä¸Šæ³¨å†Œçš„Channel\n2. Pollerï¼šI/Oå¤šè·¯å¤ç”¨æ¥å£\n    1. èŒè´£ï¼šé˜»å¡åœ°ç­‰å¾…æ–‡ä»¶æè¿°ç¬¦ä¸Šçš„äº‹ä»¶ï¼Œå¹¶å°†æ´»è·ƒçš„äº‹ä»¶è¿”å›ç»™EventLoop\n    2. å…·ä½“å®ç°æ˜¯`EPollPoller`ã€‚æ˜¯Linuxä¸‹åŸºäºepollçš„å…·ä½“å®ç°ã€‚é€šè¿‡`epoll_wait`è¿”å›æ´»è·ƒçš„äº‹ä»¶ã€‚\n3. Channelï¼šé€šé“\n    1. èŒè´£ï¼šæ˜¯äº‹ä»¶åˆ†å‘å™¨ã€‚æ¯ä¸ªChannelè´Ÿè´£ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚\n    2. å†…éƒ¨ä¿å­˜äº†è¯¥fdå…³æ³¨çš„äº‹ä»¶ï¼Œä»¥åŠå¯¹åº”çš„å›è°ƒå‡½æ•°\n    3. å…³ç³»ï¼š\n        1. æ˜¯Pollerå’Œå›è°ƒä¹‹é—´çš„æ¡¥æ¢ã€‚Pollerè¿”å›ä¸€ä¸ªäº‹ä»¶ï¼ŒEventLoopæ‰¾åˆ°å¯¹åº”çš„Channelï¼Œè°ƒç”¨Channelçš„`handleEvent()`æ–¹æ³•\n## æ¥å—æ–°è¿æ¥ï¼šAcceptor\n1. èŒè´£ï¼šAcceptoræ˜¯ä¸€ä¸ªç‰¹æ®Šçš„Channelã€‚ä¸“é—¨è´Ÿè´£å¤„ç†ç›‘å¬å¥—æ¥å­—ï¼ˆlistening socketï¼‰ä¸Šçš„å¯è¯»äº‹ä»¶ï¼Œå³æ–°è¿æ¥ã€‚\n2. å…³ç³»ï¼š\n    1. ç»§æ‰¿è‡ªChannelã€‚åŒæ ·éœ€è¦å‘EventLoopæ³¨å†Œã€‚\n    2. è¢«TcpServeræ‹¥æœ‰ï¼šTcpServeråœ¨åˆå§‹åŒ–æ—¶ä¼šåˆ›å»ºAcceptor\n    3. æŒæœ‰newConnectionCallbackï¼šå½“æœ‰æ–°è¿æ¥åˆ°æ¥æ—¶ï¼Œæœ€ç»ˆä¼šè°ƒç”¨TcpServeré¢„å…ˆè®¾ç½®å¥½çš„å›è°ƒå‡½æ•°\n## è¡¨ç¤ºè¿æ¥ï¼šTcpConnection\n1. èŒè´£ï¼šä»£è¡¨äº†ä¸€ä¸ªå·²å»ºç«‹çš„TCPè¿æ¥ã€‚æ•´ä¸ªè¿æ¥çš„ç”Ÿå‘½å‘¨æœŸï¼ˆå»ºç«‹ã€æ–­å¼€ã€æ”¶å‘æ•°æ®ï¼‰éƒ½ç”±è¯¥å¯¹è±¡ç®¡ç†ã€‚\n2. å…³ç³»ï¼š\n    1. æ¯ä¸ªTcpConnectionå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„Channelã€‚ç”¨äºç›‘æ§å…¶æè¿°ç¬¦ä¸Šçš„äº‹ä»¶ã€‚\n    2. è¢«TcpServerç®¡ç†ï¼šè®°å½•åœ¨TcpServerçš„mapè¡¨ä¸­ã€‚\n    3. æŒæœ‰å„ç§ç”¨æˆ·å›è°ƒï¼šå¦‚è¿æ¥å»ºç«‹å›è°ƒ`ConnectionCallback`ï¼Œæ¶ˆæ¯åˆ°è¾¾å›è°ƒ`MessageCallback`ã€‚è¿™äº›æ˜¯ç”±ç”¨æˆ·é€šè¿‡`TcpServer`è®¾ç½®çš„ã€‚\n    4. éš¶å±äºæŸä¸ªEventLoopã€‚æ¯ä¸ªTcpConnectionå¯¹è±¡éƒ½åªå±äºä¸€ä¸ªç‰¹å®šçš„`EventLoop`çº¿ç¨‹ã€‚å…¶æ‰€æœ‰IOæ“ä½œéƒ½åœ¨è¿™ä¸ªçº¿ç¨‹ä¸­è¿›è¡Œã€‚ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚\n## æœåŠ¡å™¨é—¨é¢ï¼šTcpServer\n1. èŒè´£ï¼šæä¾›ç»™ç”¨æˆ·ä½¿ç”¨çš„ã€æ˜“äºç†è§£çš„**æœåŠ¡å™¨ç±»**ã€‚ç”¨æˆ·åªéœ€å…³æ³¨å…¶æä¾›çš„å‡ ä¸ªå›è°ƒå‡½æ•°ï¼ˆå¦‚è¿æ¥å›è°ƒã€æ¶ˆæ¯å›è°ƒï¼‰å³å¯ç¼–å†™ç½‘ç»œç¨‹åºã€‚\n2. å…³ç³»ï¼š\n    - **æ‹¥æœ‰ä¸€ä¸ªÂ `Acceptor`**ï¼šç”¨äºæ¥å—æ–°è¿æ¥ã€‚\n    - **æ‹¥æœ‰ä¸€ä¸ªÂ `TcpConnection`Â çš„æ˜ å°„è¡¨**ï¼šç®¡ç†æ‰€æœ‰æ´»è·ƒçš„è¿æ¥ã€‚\n    - **æ‹¥æœ‰ä¸€ä¸ªÂ `EventLoopThreadPool`**ï¼šç®¡ç†çº¿ç¨‹æ± ã€‚\n    - **è®¾ç½®å›è°ƒ**ï¼šç”¨æˆ·é€šè¿‡Â `TcpServer`Â è®¾ç½®çš„å„ç§å›è°ƒï¼ˆ`onConnection`,Â `onMessage`ï¼‰ï¼Œæœ€ç»ˆä¼šâ€œä¼ é€’â€ç»™æ¯ä¸€ä¸ªæ–°åˆ›å»ºçš„Â `TcpConnection`Â å¯¹è±¡ã€‚\n## çº¿ç¨‹æ¨¡å‹ï¼š`EventLoopThread`å’Œ`EventLoopThreadPool`\n- **`EventLoopThread`Â (IO çº¿ç¨‹)ï¼š\n    - **èŒè´£**ï¼šå°è£…äº†ä¸€ä¸ªçº¿ç¨‹ï¼ˆ`std::thread`ï¼‰ï¼Œè¯¥çº¿ç¨‹çš„**å”¯ä¸€å·¥ä½œ**å°±æ˜¯è¿è¡Œä¸€ä¸ªÂ `EventLoop::loop()`ã€‚**â€œone loop per threadâ€**Â çš„ç†å¿µåœ¨æ­¤ä½“ç°ã€‚\n    - **å…³ç³»**ï¼šå®ƒ**åˆ›å»ºå¹¶æ‹¥æœ‰**ä¸€ä¸ªÂ `EventLoop`Â å¯¹è±¡ï¼ˆåœ¨å…¶å†…éƒ¨çº¿ç¨‹ä¸­ï¼‰ã€‚\n- **`EventLoopThreadPool`Â (çº¿ç¨‹æ± )ï¼š\n    - **èŒè´£**ï¼šç®¡ç†å¤šä¸ªÂ `EventLoopThread`ï¼Œå³ç®¡ç†ä¸€ä¸ªÂ `EventLoop`Â æ± å­ã€‚å®ƒæä¾›äº†ä¸€ç§è½®è¯¢ï¼ˆround-robinï¼‰ç®—æ³•æ¥ä¸ºæ–°çš„Â `TcpConnection`Â åˆ†é…ä¸€ä¸ªÂ `EventLoop`ã€‚\n    - **å…³ç³»**ï¼š\n        - **è¢«Â `TcpServer`Â æ‰€æ‹¥æœ‰**ï¼š`TcpServer`Â é€šè¿‡çº¿ç¨‹æ± æ¥å®ç°å¤šçº¿ç¨‹ Reactorã€‚\n        - **æ‹¥æœ‰å¤šä¸ªÂ `EventLoopThread`**ï¼šç®¡ç†ç€å¤šä¸ª IO çº¿ç¨‹ã€‚\n        - **ä¸ºÂ `Acceptor`Â æä¾›Â `getNextLoop()`**ï¼šå½“Â `Acceptor`Â æ¥å—åˆ°ä¸€ä¸ªæ–°è¿æ¥æ—¶ï¼Œå®ƒä¼šä»çº¿ç¨‹æ± ä¸­å–å‡ºä¸‹ä¸€ä¸ªÂ `EventLoop`ï¼Œå°†è¿™ä¸ªæ–°è¿æ¥åˆ†é…ç»™è¿™ä¸ªÂ `EventLoop`Â æ¥ç›‘æ§å’Œå¤„ç†ã€‚\n\n# cmake\n```cmake\ncmake_minimum_required(VERSION 2.5)\nproject(mymuduo)\n\n#mymuduo æœ€ç»ˆç¼–è¯‘æˆsoåŠ¨æ€åº“ï¼Œè®¾ç½®åŠ¨æ€åº“çš„è·¯å¾„\nset(LIBRARY_OUTPUT_PATH ${PROJECT_SOURCE_DIR}/lib)#æ³¨æ„ä¸æ˜¯OUTPUT_DIRECTORY.è¿™ä¸¤è€…æœ‰åŒºåˆ«\n#è®¾ç½®ä¸ºè°ƒè¯•æ¨¡å¼ ä»¥åŠ å£°æ˜C++11è¯­è¨€æ ‡å‡†\nset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -g -std=c++11 -fPIC\")#åœ¨è¾ƒæ–°çš„ç¼–è¯‘å™¨åéœ€è¦åŠ -fPICï¼Œä»¥ç¤ºç”Ÿæˆçš„æ˜¯åŠ¨æ€åº“\n#å®šä¹‰å‚ä¸ç¼–è¯‘çš„æºæ–‡ä»¶ èµ·ä¸€ä¸ªåˆ«å\naux_source_directory(. SRC_LIST)\n#ç¼–è¯‘ç”ŸæˆåŠ¨æ€åº“mymuduo\nadd_library(mymuduo SHARED ${SRC_LIST})\n```\n# è¾…åŠ©ç±»\n## noncopyable\n```cpp\n// noncopyable.h\n#pragma once\n/**\n * noncopyable è¢«ç»§æ‰¿ä»¥åï¼Œ\n * æ´¾ç”Ÿç±»å¯¹è±¡æ— æ³•æ‹·è´æ„é€ ã€ç›¸äº’èµ‹å€¼ã€‚\n * æ— å‚æ„é€ ã€ææ„æ˜¯é»˜è®¤å¤„ç†ã€‚\n */\nclass noncopyable\n{\npublic:\n    noncopyable(const noncopyable&) = delete;\n    noncopyable & operator=(const noncopyable &) = delete;\nprotected:\n    noncopyable() = default;\n    ~noncopyable() = default;\n};\n```\n## copyable\n\n```cpp\nclass copyable\n{\nprotected:\n    copyable() = default;\n    ~copyable() = default;\n};\n```\n# TcpServeræ¦‚è§ˆ\néœ€è¦å°è£…ä»¥ä¸‹å±æ€§ï¼š\n1. `EventLoop`å¯¹è±¡æŒ‡é’ˆï¼šå¤šè·¯åˆ†å‘å™¨ï¼Œç›¸å½“äºepoll\n2. `InetAddress`ï¼šæ‰“åŒ…IPåœ°å€å’Œç«¯å£å·\n## InetAddress\n1. å…è®¸æ‹·è´\n2. æˆå‘˜å˜é‡æ˜¯`sockaddr_in m_addr`ï¼Œä¹Ÿå¯é€‰æ‹©æ”¯æŒIPv6çš„`sockaddr_in6 m_addr6`ã€‚å¯ç”¨è”åˆä½“è¡¨ç¤ºã€‚åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œåªä½¿ç”¨IPv4çš„`m_addr`ã€‚\n\n```cpp\n#include<netinet/in.h>\t\t//sockaddr_in / sockaddr_in6éƒ½åœ¨æ­¤æ–‡ä»¶ä¸‹å®šä¹‰\nunion\n{\n    struct sockaddr_in  m_addr;\n    struct sockaddr_in6 m_addr6;\n};\n```\n## EventLoopæ¦‚è§ˆ\n1. ä¸å…è®¸æ‹·è´\n2. ä¸»è¦åŒ…å«çš„æˆå‘˜\n    1. pollerï¼ˆç›¸å½“äºepollï¼‰ï¼Œå­˜å‚¨äº†ä¸€ä¸ªunorderedMapï¼Œæœ‰sockfdåŠå…¶ä¸Šé¢ç»‘å®šçš„äº‹ä»¶\n    2. channelï¼Œå±æ€§æœ‰fdã€eventsã€reventsç­‰ç­‰\n\nEventLoopå°±æ˜¯è¦å®Œæˆäº‹ä»¶å¾ªç¯ï¼Œäº‹ä»¶å¾ªç¯æœ€é‡è¦çš„å‡ ä¸ªåŠ¨ä½œï¼šepollï¼ˆ**ç”±pollerè´Ÿè´£**ï¼‰ã€epollç›‘å¬çš„fdåŠæ„Ÿå…´è¶£çš„äº‹ä»¶ã€å®é™…`epoll_wait`åå‘ç”Ÿçš„äº‹ä»¶ã€‚\nè¿™äº›sockfdã€æ„Ÿå…´è¶£çš„äº‹ä»¶ã€å‘ç”Ÿçš„äº‹ä»¶éƒ½**è®°å½•åœ¨channelä¸­**ã€‚\n\nè¦å†™EventLoopå°±è¦ç†æ¸…æ¥šEventLoopã€Channelã€Pollerä¹‹é—´çš„å…³ç³»ã€‚Reactoræ¨¡å‹ä¸­ï¼Œè¿™ä¸‰ä¸ªç»„ä»¶æ•´ä½“å¯¹åº”ç€Demultiplexã€‚\n## Channel\né€šé“ï¼Œå°è£…äº†sockfdå’Œå…¶æ„Ÿå…´è¶£çš„eventï¼Œå¦‚EPOLLINã€EPOLLOUTäº‹ä»¶ã€‚è¿˜ç»‘å®šäº†pollerè¿”å›çš„å…·ä½“äº‹ä»¶ã€‚\n### å…¬æœ‰åˆ«å\nå®šä¹‰é€šç”¨äº‹ä»¶å›è°ƒå‡½æ•°ã€åªè¯»äº‹ä»¶å›è°ƒå‡½æ•°çš„å‡½æ•°å¯¹è±¡ç±»å‹åˆ«åã€‚\n```cpp\nclass Channel : noncopyable\n{\npublic:\n    using EventCallback = std::function<void()>;\n    using ReadEventCallback = std::function<void(Timestamp)>;\n}\n```\n### æˆå‘˜å‡½æ•°\n#### æ„é€  / ææ„å‡½æ•°\n```cpp\npublic:\n    Channel(EventLoop * loop, int fd);\n    ~Channel();\n```\n#### `handleEvent`\nfdå¾—åˆ°pollerçš„é€šçŸ¥åï¼Œå¤„ç†äº‹ä»¶\n```cpp\npublic:\n    void handleEvent(Timestamp receiveTime);\n```\n#### `setXxxCallback(EventCallback cb)`\nå¯¹å¤–æä¾›çš„è®¾ç½®å›è°ƒå‡½æ•°å¯¹è±¡çš„æ¥å£\n```cpp\npublic:\n    void setReadCallback(ReadEventCallback cb)\n    {\n        m_readCallback = std::move(cb);\n    }\n    void setWriteCallback(EventCallback cb)\n    {\n        m_writeCallback = std::move(cb);\n    }\n    void setCloseCallback(EventCallback cb)\n    {\n        m_closeCallback = std::move(cb);\n    }\n    void setErrorCallback(EventCallback cb)\n    {\n        m_errorCallback = std::move(cb);\n    }\n```\n#### `void tie(const std::shared_ptr<void>&)`\né˜²æ­¢channelè¢«æ‰‹åŠ¨removeåï¼Œè¿˜åœ¨æ‰§è¡Œå›è°ƒæ“ä½œ\n```cpp\npublic:\n    void tie(const std::shared_ptr<void>&);\n```\n#### `fd`ã€`events`ã€`revents`ç›¸å…³\n1. `int fd()`\n2. `int events()`\n3. `void set_revents(int revt)`ï¼šå‘polleræä¾›çš„è®¾ç½®reventsçš„æ¥å£\n\n```cpp\npublic:\n    int fd() const { return m_fd; }\n    int events() const { return m_events; }\n    int set_revents(int revt)\n    {\n        m_revents = revt;\n    }\n```\n#### åˆ¤æ–­å‡½æ•°ï¼šåˆ¤æ–­æœ‰æ²¡æœ‰æ³¨å†Œäº‹ä»¶ç­‰ç­‰\n```cpp\npublic:\n    bool isNoneEvent() const\n    {\n        return m_events == kNoneEvent;\n    }\n    bool isWriting() const\n    {\n        return m_events & kWriteEvent;\n    }\n    bool isReading() const\n    {\n        return m_events & kReadEvent;\n    }\n```\n#### ä½¿èƒ½ã€ä½¿ä¸èƒ½å‡½æ•°\nè®¾ç½®fdç›¸åº”çš„äº‹ä»¶çŠ¶æ€\nå¯¹`m_events`è¿›è¡Œä½æ“ä½œä¹‹åè°ƒç”¨`update()`ï¼Œå³`epoll_ctl`ã€‚\n```cpp\npublic:\n    void enableReading()\n    {\n        m_events |= kReadEvent;\n        update();\n    }\n    void disableReading()\n    {\n        m_events &= ~kReadEvent;\n        update();\n    }\n    void enableWriting()\n    {\n        m_events |= kWriteEvent;\n        update();\n    }\n    void disableWriting()\n    {\n        m_events &= ~kWriteEvent;\n    }\n    void disableAll()\n    {\n        m_events = kNoneEvent;\n        update();\n    }\n```\n#### ä¸EventLoopç›¸å…³\nè·å–æ‰€å±çš„Loop\n```cpp\npublic:\n    EventLoop * ownerLoop() {return m_loop;}\n```\n#### åˆ é™¤ï¼šremove()\n```cpp\npublic:\n    void remove();\n```\n#### update()ï¼šç›¸å½“äºè°ƒç”¨`epoll_ctl`\n```cpp\nprivate:\n    void update();\n```\n#### handleEventWithGuard\nå—ä¿æŠ¤åœ°å¤„ç†äº‹ä»¶\n```cpp\nprivate:\n    void HandleEventWithGuard(Timestamp receiveTime);\n```\n#### for pollerçš„index\n```cpp\npublic:\n    int index() {return m_index;}\n    void set_index(int idx) {m_index = idx;}\n```\n### æˆå‘˜å˜é‡\n1. `kXxxEvent`ï¼šä»¥ä¸‹ä¸‰ä¸ªå˜é‡æè¿°å½“å‰fdçš„çŠ¶æ€ï¼Œæ²¡æœ‰æ„Ÿå…´è¶£çš„äº‹ä»¶orå¯¹è¯»äº‹ä»¶æ„Ÿå…´è¶£orå¯¹å†™äº‹ä»¶æ„Ÿå…´è¶£ï¼Ÿ\n\n```cpp\nprivate:\n    static const int kNoneEvent;\n    static const int kReadEvent;\n    static const int kWriteEvent;\n```\n\n2. `m_xxxCallback`ï¼šå››ä¸ªå‡½æ•°å¯¹è±¡ï¼Œå¯ä»¥ç»‘å®šå¤–éƒ¨ä¼ å…¥çš„ç›¸å…³æ“ä½œã€‚å› ä¸ºchannelçŸ¥é“å‘ç”Ÿäº†å“ªäº›äº‹æƒ…ï¼ˆreventsè®°å½•ï¼‰ï¼Œæ‰€ä»¥channelè´Ÿè´£è°ƒç”¨å…·ä½“äº‹ä»¶çš„å›è°ƒå‡½æ•°ã€‚\n\n```cpp\nprivate:\n    ReadEventCallback m_readCallback;\n    EventCallback\t  m_writeCallback;\n    EventCallback\t  m_closeCallback;\n    EventCallback\t  m_errorCallback;\n```\n\n3. `EventLoop *m_loop`ï¼šäº‹ä»¶å¾ªç¯\n4. `m_fd`ï¼šfdï¼Œå³Pollerç›‘å¬çš„å¯¹è±¡\n5. `m_events`ï¼šfdæ„Ÿå…´è¶£çš„äº‹ä»¶æ³¨å†Œä¿¡æ¯\n6. `m_revents`ï¼šPolleræ“ä½œçš„fdä¸Šå…·ä½“å‘ç”Ÿçš„äº‹ä»¶\n7. `m_index`ï¼šï¼Ÿ\n8. `std::weak_ptr<void> m_tie`ï¼šé˜²æ­¢æ‰‹åŠ¨è°ƒç”¨remove channelåä»ä½¿ç”¨æ­¤channelï¼Œç”¨äºç›‘å¬è·¨çº¿ç¨‹çš„å¯¹è±¡ç”Ÿå­˜çŠ¶æ€ã€‚\n    1. `shared_ptr`å’Œ`weak_ptr`é…åˆä½¿ç”¨å¯ä»¥å‘æŒ¥ä¸¤ä¸ªèƒ½åŠ›ï¼š\n        1. è§£å†³shread_ptrå¾ªç¯å¼•ç”¨é—®é¢˜\n        2. weak_ptråœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­å¯ç›‘å¬èµ„æºçš„ç”Ÿå­˜çŠ¶æ€ï¼Œæ–¹æ³•æ˜¯å°è¯•æå‡ä¸ºå¼ºæŒ‡é’ˆï¼Œè‹¥æå‡æˆåŠŸï¼Œåˆ™å¯ä»¥è®¿é—®ï¼›è‹¥æå‡å¤±è´¥è¯´æ˜åˆ™èµ„æºè¢«é‡Šæ”¾æ‰äº†ã€‚\n    2. tieçš„æ„æ€æ˜¯ç»‘å®šï¼Œé‚£ä¹ˆm_tieè¦å’Œè°ç»‘å®šå‘¢ï¼Ÿâ€”â€”è‡ªå·±ã€‚\n    3. ç»‘å®šè‡ªå·±çš„å·¥å…·è¿˜å¯ä»¥ç”¨å¦ä¸€ä¸ªå·¥å…·ï¼Œ`shared_from_this`ï¼Œå¯ä»¥å°è¯•å¾—åˆ°å½“å‰å¯¹è±¡çš„å¼ºæ™ºèƒ½æŒ‡é’ˆã€‚\n9. `bool m_tied`ï¼šé…åˆ`m_tie`ä½¿ç”¨\n## Poller\n### æˆå‘˜å˜é‡\næˆå‘˜å˜é‡ä¸­åŒ…å«ä¸€ä¸ªå­˜å‚¨`<int, Channel*>`çš„mapã€‚\n\n>pollerç›‘å¬çš„channelä»ä½•è€Œæ¥ï¼ŸEventLoopä¸­æœ‰ChannelListä»¥åŠPollerï¼Œåˆ™pollerç›‘å¬çš„è‚¯å®šæ˜¯EventLoopä¸­æ‰€ä¿å­˜çš„channelã€‚å³è¿™äº›channelåœ¨pollerä¸­ä¹Ÿè¢«ä¿å­˜äº†ã€‚\n\n```cpp\nprotected:\n    using ChannelMap = std::unordered_map<int, Channel*>;\n    ChannelMap m_channels;\n```\nè¿˜æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œ`m_ownerLoop`ï¼ŒæŒ‡æ˜äº†ä»å±äºå“ªä¸ªloopã€‚\n```cpp\nprivate:\n    EventLoop * m_ownerLoop;\n```\n### æˆå‘˜å‡½æ•°\n#### æ„é€  / ææ„å‡½æ•°\n```cpp\npublic:\n    Poller(EventLoop *loop);\n    virtual ~Poller() = default;\n```\n#### `poll`ï¼šæä¾›ç»™ç³»ç»Ÿçš„ç»Ÿä¸€çš„ä¸€ä¸ªIOå¤ç”¨æ¥å£\n```cpp\npublic:\n    using ChannelList = std::vector<Channel*>;\n    virtual Timestamp poll(int timeoutMs, ChannelList * activeChannels) = 0;\n```\nå‚æ•°ï¼š\n1. timeoutMsï¼šè¶…æ—¶æ—¶é—´ï¼Œæ¯«ç§’ä¸ºå•ä½\n2. activeChannelsï¼šå½“å‰æ¿€æ´»çš„ã€å¯¹äº‹ä»¶æ³¨å†Œå¥½çš„channelåˆ—è¡¨\n#### ä¸äº‹ä»¶çš„æ³¨å†Œã€æ³¨é”€æœ‰å…³çš„\n```cpp\npublic:\n    /* å½“fdæ³¨å†Œçš„äº‹ä»¶æœ‰å˜æ›´æ—¶, channelè°ƒç”¨update, å‡½æ•°å†…åŒ…å«updateChannel(this) */\n    virtual void updateChannel(Channel * channel) = 0;\n    /* å½“fdæ³¨å†Œçš„äº‹ä»¶è¦æ³¨é”€æ—¶ï¼Œchannelè°ƒç”¨removeï¼Œå‡½æ•°å†…åŒ…å«removeChannel(this) */\n    virtual void removeChannel(Channel * channel) = 0;\n```\nå‚æ•°ï¼šchannel å‡ä¸º`å¤–éƒ¨channelä¼ å…¥çš„thisæŒ‡é’ˆ`\n#### `newDefaultPoller(EventLoop * loop)`\næä¾›ç»™EventLoopçš„æ¥å£ï¼Œä»¥è·å–é»˜è®¤çš„IOå¤ç”¨å…·ä½“å®ç°ã€‚\n\n>æ³¨æ„ï¼šæˆ‘ä»¬æœ€å¥½ä¸è¦å®ç°åˆ°`poller.cc`æ–‡ä»¶ä¸­ï¼Œä¸å¤§å¦¥å½“ã€‚å› ä¸º`Poller`ç±»æ˜¯åŸºç±»ï¼Œè€ŒæŠŠè·å–å…·ä½“å®ç°å†™åˆ°æŠ½è±¡ç±»æ–‡ä»¶å®ç°ä¸­æ˜¯ä¸å¥½çš„ã€‚å¯ä»¥å•ç‹¬æŠŠå®ç°ä»£ç å†™åˆ°`defaultpoller.cc`ä¸­ã€‚\n\n```cpp\npublic:\n    static Poller* newDefaultPoller(EventLoop *loop);\n```\n#### `hasChannel`\nåˆ¤æ–­polleræ˜¯å¦æ‹¥æœ‰æŸä¸€channel\n```cpp\npublic:\n    virtual bool hasChannel(Channel * channel) const;\n```\n## EpollPoller\næ˜¯PolleræŠ½è±¡åŸºç±»çš„ä¸€ä¸ªå…·ä½“å®ç°ç±»ã€‚\n### æˆå‘˜å‡½æ•°\n#### æ„é€ /ææ„\næ„é€ ç›¸å½“äº`epoll_create`ï¼Œè®°å½•åœ¨`m_epollfd`æˆå‘˜å˜é‡ä¸­ã€‚ææ„æ—¶closeè¯¥fdã€‚\n```cpp\npublic:\n    EpollPoller(EventLoop *loop);\n    ~EpollPoller() override;\n```\n#### `poll`ï¼šé‡å†™PolleråŸºç±»æ–¹æ³•ï¼Œç›¸å½“äº`epoll_wait`\n```cpp\npublic:\n    Timestamp poll(int timeoutMs, ChannelList *activeChannels) override;\n```\n#### `update/removeChannel`ï¼šé‡å†™PolleråŸºç±»æ–¹æ³•ï¼Œç›¸å½“äº`epoll_ctl add/mod/del`\n```cpp\npublic:\n    void updateChannel(Channel *channel) override;\n    void removeChannel(Channel *channel) override;\n```\n#### `fillActiveChannels`ï¼šå¡«å†™æ´»è·ƒçš„channelsè¿æ¥\n```cpp\nprivate:\n    void fillActiveChannels(int numEvents, ChannelList *activeChannels) const;\n```\n#### `update`ï¼šæ›´æ–°channelé€šé“\n```cpp\nprivate:\n    void update(int operation, Channel * channel);\n```\n### æˆå‘˜å±æ€§\n1. `m_epollfd` - epollç›¸å…³çš„æ–¹æ³•éƒ½éœ€è¦ç”¨åˆ°fdï¼Œé€šè¿‡epoll_createæ¥åˆ›å»ºã€‚æ˜ å°„çš„æ˜¯epollåº•å±‚çš„æ–‡ä»¶ç³»ç»Ÿçº¢é»‘æ ‘ã€‚\n2. `m_events` - æ˜¯ä¸€ä¸ª`vector<struct epoll_event`å®¹å™¨ã€‚\n\n```cpp\nprivate:\n    int m_epollfd;\n    using std::vector<struct epoll_event> EventList;\n    EventList m_events;\n```\n\n3. `kInitEventListSize` - `EventList`åˆå§‹çš„é•¿åº¦ã€‚\n\n```cpp\nprivate:\n    static const int kInitEventListSize = 16;\n```\n\n4. ä»Pollerç»§æ‰¿è€Œæ¥ï¼Œæ‹¥æœ‰polleråŒ…å«çš„`ChannelMap m_channels`ã€‚\n\n```cpp\nclass Poller\n{\n// ...\nprotected:\n    using ChannelMap = std::unordered_map<int, Channel*>;\n    ChannelMap m_channels;\n// ...\n}\n```\n### å®ç°ä»£ç \né¦–å…ˆå£°æ˜äº†ä¸‰ä¸ªå…¨å±€å¸¸é‡ï¼Œè¡¨ç¤ºchannelçš„çŠ¶æ€\n```cpp\nconst int kNew      = -1;    //ä»æœªæ·»åŠ åˆ°epollçš„channel\nconst int kAdded    = 1;     //å·²ç»æ·»åŠ åˆ°epollçš„channel\nconst int kDeleted  = 2;     //å·²æŠŠè¯¥channelä»epollä¸­åˆ é™¤\n```\n#### æ„é€ å‡½æ•°\n```cpp\n#include\"logger.h\"      //LOG_FATAL\n#include<errno.h>       //errno\n#include<sys/epoll.h>\n\nEpollPoller::EpollPoller(EventLoop * loop)\n  : Poller(loop),\n    m_epollfd(epoll_create1(EPOLL_CLOEXEC)),\t// epoll_create\n    m_events(kInitEventListSize)  // vector<epoll_event>\n{\n    if(m_epollfd < 0)\n    {\n        LOG_FATAL(\"epoll_create error: %d\\n\", errno);\n    }\n}\n```\n#### ææ„\n```cpp\n#include<unistd.h>      //close\nEpollPoller::~EpollPoller()\n{\n    close(m_epollfd);\n}\n```\n## CurrentThreadï¼šä¸»è¦ç”¨äºè·å–tid\n`__thread`ç›¸å½“äºC++11æ ‡å‡†ä¸­çš„`thread_local`ä¿®é¥°ç¬¦ã€‚ç”¨äºä¿®é¥°å…¨å±€å˜é‡ã€‚\nä¿®é¥°ä¹‹å‰ï¼Œå…¨å±€å˜é‡åªèƒ½è¢«è‹¥å¹²çº¿ç¨‹å…±äº«ã€‚ä¿®é¥°ä¹‹åï¼Œæ­¤å…¨å±€å˜é‡å˜æˆæ¯ä¸ªçº¿ç¨‹ä¸“æœ‰çš„å±æ€§ã€‚\n```cpp\n#pragma once\n#include<unistd.h>          //pid_t  syscall\n#include<sys/syscall.h>     //SYS_gettid\nnamespace CurrentThread\n{\n    /**\n     * @brief æ­¤å˜é‡è¢«__threadä¿®é¥°, ç›¸å½“äºC++11æ ‡å‡†ä¸­çš„thread_localä¿®é¥°ç¬¦, \n     * ç”¨äºä¿®é¥°å…¨å±€å˜é‡ã€‚ä¿®é¥°ä¹‹å‰, å…¨å±€å˜é‡åªèƒ½è¢«è‹¥å¹²çº¿ç¨‹å…±äº«; \n     * ä¿®é¥°ä¹‹å, æ­¤å…¨å±€å˜é‡å˜æˆæ¯ä¸ªçº¿ç¨‹ä¸“æœ‰çš„å±æ€§ã€‚\n     */\n    extern __thread int t_cachedTid;\n    /* é€šè¿‡Linuxç³»ç»Ÿè°ƒç”¨SYS_gettid, åŠ è½½å½“å‰çº¿ç¨‹çš„tidå€¼åˆ°t_cachedTid */\n    void cacheTid()\n    {\n        if(t_cachedTid == 0)\n        {\n            t_cachedTid = static_cast<pid_t>(syscall(SYS_gettid));\n        }\n    }\n    /* è¿”å›å½“å‰çº¿ç¨‹çš„tid, è‹¥åŠ è½½è¿‡åˆ™ç›´æ¥è¿”å›å­˜å‚¨è¿‡çš„å€¼ */\n    inline int tid()\n    {\n        /* è‹¥t_cachedTidä¸º0è¯´æ˜æ˜¯ç¬¬ä¸€æ¬¡åŠ è½½, éœ€è¦è°ƒç”¨cacheTid */\n        if(__builtin_expect(t_cachedTid == 0, 0))\n        {\n            cacheTid();\n        }\n        return t_cachedTid;\n    }\n}\n```\n# EventLoop\nå‰é¢çš„EventLoopæ¦‚è§ˆä¸­æåˆ°ï¼š\n1. ä¸å…è®¸æ‹·è´\n2. ä¸»è¦åŒ…å«çš„æˆå‘˜ä¹‹ä¸€ï¼špollerï¼ˆç›¸å½“äºepollï¼‰ï¼Œå±æ€§æœ‰sockfdåŠå…¶ä¸Šé¢ç»‘å®šçš„äº‹ä»¶\n3. å¦ä¸€ä¸ªä¸»è¦çš„æˆå‘˜æ˜¯channelï¼Œå±æ€§æœ‰fdã€eventsã€reventsç­‰ç­‰\n\nEventLoopå°±æ˜¯è¦å®Œæˆäº‹ä»¶å¾ªç¯ï¼Œäº‹ä»¶å¾ªç¯æœ€é‡è¦çš„å‡ ä¸ªåŠ¨ä½œï¼šepollï¼ˆ**ç”±pollerè´Ÿè´£**ï¼‰ã€epollç›‘å¬çš„fdåŠæ„Ÿå…´è¶£çš„äº‹ä»¶ã€å®é™…`epoll_wait`åå‘ç”Ÿçš„äº‹ä»¶ã€‚\nè¿™äº›sockfdã€æ„Ÿå…´è¶£çš„äº‹ä»¶ã€å‘ç”Ÿçš„äº‹ä»¶éƒ½**è®°å½•åœ¨channelä¸­**ã€‚\nè¦å†™EventLoopå°±è¦ç†æ¸…æ¥šEventLoopã€Channelã€Pollerä¹‹é—´çš„å…³ç³»ã€‚Reactoræ¨¡å‹ä¸­ï¼Œè¿™ä¸‰ä¸ªç»„ä»¶æ•´ä½“å¯¹åº”ç€Demultiplexã€‚\n\nç”±ä¸Šè¿°çº¦æŸï¼Œåœ¨`.h`æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é¦–å…ˆå†™å‡ºï¼š\n\n```cpp\n#pragma once\n#include\"noncopyable.h\"\nclass Channel;\nclass Poller;\nclass EventLoop : noncopyable\n{\npublic:\nprivate:\n}\n```\n\nè¦ç”¨åˆ°å‡½æ•°å¯¹è±¡ã€‚\n```cpp\n#include<functional>\npublic:\n    using Functor = std::function<void()>;\n```\n\n## æˆå‘˜å˜é‡\n\n1. `ChannelList m_activeChannels` - EventLoopç®¡ç†çš„æ‰€æœ‰çš„Channelçš„Listï¼›\n   `Channel * m_currentActiveChannel` - ä¸»è¦ç”¨äºæ–­è¨€\n\n   ```cpp\n   private:\n       using ChannelList = std::vector<Channel*>;\n       ChannelList m_activeChannels;\n   \n       Channel * m_currentActiveChannel;\n   ```\n\n2. æ ‡å¿—(æœ€å¥½ä¸ºatomic)\n\n   1. `m_looping` - äº‹ä»¶å¾ªç¯çŠ¶æ€æ ‡å¿— - çœŸåˆ™æ­£åœ¨å¾ªç¯ï¼Œå‡åˆ™å°†è¦é€€å‡ºå¾ªç¯\n\n   2. `m_quit` - æ ‡è¯†é€€å‡ºloopå¾ªç¯\n\n   3. `m_eventHandling` - \n\n   4. `m_callingPendingFunctors` - æ ‡è¯†å½“å‰loopå½“å‰æ˜¯å¦æœ‰éœ€è¦æ‰§è¡Œçš„å›è°ƒæ“ä½œ\n\n      ```cpp\n      private:\n          std::atomic_bool m_looping;\n          std::atomic_bool m_quit;\n          std::atomic_bool m_callingPendingFunctors;\n      ```\n\n3. `m_threadId` - è®°å½•å½“å‰Loopæ‰€åœ¨çº¿ç¨‹çš„ID\n\n   ```cpp\n   private:\n       const pid_t m_threadId;\n   ```\n\n4. `std::unique<Poller> m_poller` - EventLoopæ‰€ç®¡ç†çš„pollerï¼Œå»è½®è¯¢ç›‘å¬channelsä¸Šå‘ç”Ÿçš„äº‹ä»¶ã€‚ç”¨`std::unique_ptr`ç®¡ç†\n\n   ```cpp\n   private:\n       std::unique_ptr<Poller> m_poller;\n   ```\n\n5. `Timestamp m_pollReturnTime` - pollerè¿”å›å‘ç”Ÿäº‹ä»¶çš„channelsçš„æ—¶é—´ç‚¹\n\n   ```cpp\n   private:\n       Timestamp m_pollReturnTime;\n   ```\n\n6. `int m_wakeupFd` - mainLoopè·å–åˆ°ä¸€ä¸ªæ–°ç”¨æˆ·çš„channelåï¼Œæ­é…è½®è¯¢ç®—æ³•é€‰æ‹©ä¸€ä¸ªç­‰å¾…ä»»åŠ¡çš„subLoopï¼Œé€šè¿‡wakeupFdå¯¹å…¶è¿›è¡Œå”¤é†’æ¥å¤„ç†channelã€‚ç”¨`eventfd`åˆ›å»ºã€‚`eventfd`ä½¿ç”¨çº¿ç¨‹é—´çš„`wait/notify`äº‹ä»¶é€šçŸ¥æœºåˆ¶ï¼Œç›´æ¥åœ¨å†…æ ¸å”¤é†’ï¼Œæ•ˆç‡è¾ƒé«˜ã€‚ä¸æ­¤å¤„ç†ç›¸ä¼¼çš„æ˜¯ï¼Œ`libevent`ä½¿ç”¨çš„æ˜¯`socketpair`çš„åŒå‘é€šä¿¡æœºåˆ¶ï¼Œç›¸å½“äºç½‘ç»œé€šä¿¡å±‚é¢çš„æœºåˆ¶ï¼Œæ•ˆç‡è¾ƒä½ã€‚\n\n   ```cpp\n   private:\n       int m_wakeupFd;\n   ```\n\n7. `std::unique_ptr<Channel> m_wakeupChannel` - æŠŠwakeupFdå°è£…èµ·æ¥å’Œå…¶Channelå…³è”ï¼Œå› ä¸ºæ“ä½œçš„å¾€å¾€ä¸æ˜¯fdè€Œæ˜¯å…¶channel\n\n   ```cpp\n   private:\n       std::unique_ptr<Channel> m_wakeupChannel;\n   ```\n\n8. `std::vector<Functor> m_pendingFunctors` - å­˜å‚¨loopéœ€è¦æ‰§è¡Œçš„æ‰€æœ‰çš„å›è°ƒæ“ä½œã€‚ä¸`callingPendingFunctors`æ ‡è¯†ç»“åˆä½¿ç”¨ï¼Œå¦‚æœæ­¤æ ‡è¯†æ˜¾ç¤ºå½“å‰loopæœ‰éœ€è¦æ‰§è¡Œçš„å›è°ƒæ“ä½œï¼Œåˆ™è¿™äº›å›è°ƒæ“ä½œå°†åœ¨æ­¤vectorå®¹å™¨ä¸­å­˜æ”¾ã€‚**éœ€è¦ç”¨mutexä¿æŠ¤å…¶çº¿ç¨‹å®‰å…¨**ã€‚\n\n   ```cpp\n   private:\n       std::vector<Functor> m_pendingFunctors;\n       mutable std::mutex m_mutex;\n   ```\n\n## æˆå‘˜å‡½æ•°\n\n1. æ„é€ /ææ„\n   ```cpp\n   public:\n       EventLoop();\n       ~EventLoop();\n   ```\n\n2. `loop`/`quit` - å¼€å§‹/ç»“æŸäº‹ä»¶å¾ªç¯\n\n   ```cpp\n   public:\n       void loop();\n       void quit();\n   ```\n\n3. `Timestamp pollReturnTime() const`\n\n   ```cpp\n   public:\n       Timestamp pollReturnTime() const\n       {\n           return m_pollReturnTime;\n       }\n   ```\n\n4. `runInLoop` - åœ¨å½“å‰loopä¸­æ‰§è¡Œcb\n\n   ```cpp\n   public:\n       void runInLoop(Functor cb);\n   ```\n\n5. `queueInLoop` - æŠŠcbæ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œå”¤é†’loopæ‰€åœ¨çš„çº¿ç¨‹ï¼Œæ‰§è¡Œcb\n\n   ```cpp\n   public:\n       void queueInLoop(Functor cb);\n   ```\n\n6. `wakeup` - mainLoopå”¤é†’subLoopæ‰€åœ¨çš„çº¿ç¨‹\n\n   ```cpp\n   public:\n       void wakeup();\n   ```\n\n7. æ›´æ–°Channelç›¸å…³ - EventLoopçš„æ–¹æ³•è°ƒç”¨Pollerçš„æ–¹æ³•\n   ```cpp\n   public:\n       void updateChannel(Channel *channel);\n       void removeChannel(Channel *channel);\n       bool hasChannel(Channel *channel);\n   ```\n\n8. `isInLoopThread` - åˆ¤æ–­EventLoopå¯¹è±¡æ˜¯å¦åœ¨è‡ªå·±çš„çº¿ç¨‹é‡Œé¢\n\n   ```cpp\n   #include\"currentthread.h\"\n   public:\n       bool isInLoopThread() const\n       {\n           return m_threadId == CurrentThread::tid();\n       }\n   ```\n\n9. handleRead - å¤„ç†wakeupå”¤é†’ç›¸å…³çš„é€»è¾‘\n   ```cpp\n   private:\n       void handleRead();\n   ```\n\n10. doPendingFunctors - æ‰§è¡Œå›è°ƒ\n    ```cpp\n    private:\n        void doPendingFunctors();\n    ```\n\n## å®ç°ä»£ç \n\n### å…¨å±€å˜é‡\n\n1. é˜²æ­¢ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºå¤šä¸ªloop\n   ```cpp\n   //__threadä¿®é¥°è¡¨ç¤ºè¿™ä¸ªå…¨å±€å˜é‡è½¬ä¸ºäº†æ¯ä¸ªçº¿ç¨‹ç§æœ‰çš„å±æ€§\n   __thread EventLoop *t_loopInThisThread = nullptr;\n   ```\n\n2. é»˜è®¤çš„è¶…æ—¶æ—¶é—´\n   ```cpp\n   const int kPollTimeMs = 10000;\n   ```\n\n### å…¨å±€å‡½æ•°\n\n1. createEventfd() - åˆ›å»ºwakeupfdï¼Œç”¨æ¥é€šçŸ¥ç­‰å¾…ä»»åŠ¡çš„subLoopï¼Œå¤„ç†æ–°çš„Channeläº‹ä»¶ã€‚\n\n   ```cpp\n   #include<sys/eventfd.h>\n   int createEventfd()\n   {\n       int evtfd = eventfd(0, EFD_NONBLOCK | EFD_CLOEXEC);\n       if(evtfd < 0)\n       {\n           LOG_FATAL(\"Failed in eventfd: %d\\n\", errno);\n       }\n       return evtfd;\n   }\n   ```\n\n\n# EventLoopThread\n\nEventLoopç»„ä»¶åŠå…¶å†…éƒ¨çš„Chennelã€Pollerå·²ç»åœ¨ä¸Šæ–‡è®¨è®ºã€‚è¦å’Œthreadç»“åˆè¾¾æˆæœ€ç»ˆçš„\"one loop per thread\"æ¨¡å‹ï¼Œè¾ƒå¥½çš„åŠæ³•å°±æ˜¯å°†EventLoopä¸threadç»„åˆå°è£…ã€‚\n## Thread\n\n```cpp\nclass Thread : noncopyable\n```\n\n### çº¿ç¨‹å‡½æ•°\nçº¿ç¨‹æœ€ä¸»è¦çš„ç»„æˆéƒ¨åˆ†å°±æ˜¯çº¿ç¨‹å‡½æ•°ã€‚\n```cpp\npublic:\n    using ThreadFunc = std::function<void()>;\n```\n\n> ä½¿ç”¨æ— è¿”å›å€¼+æ— å‚æ•°æ˜¯ä¸ºäº†ä¾¿äºç»Ÿä¸€çº¿ç¨‹å‡½æ•°çš„å½¢å¼ï¼Œå…·ä½“ç»‘å®šå›è°ƒåˆ™ä½¿ç”¨å‡½æ•°å¯¹è±¡ç»‘å®šå™¨ã€‚\n### æˆå‘˜å˜é‡\nç”¨C++çº¿ç¨‹åº“ã€æ™ºèƒ½æŒ‡é’ˆã€‚\nThreadå¯¹è±¡åˆšåˆ›å»ºä¸ä¼šæ‰§è¡Œçº¿ç¨‹å‡½æ•°ï¼Œè€Œæ˜¯åœ¨æˆå‘˜å‡½æ•°`start()`è¢«è°ƒç”¨æ—¶ï¼Œç”¨æ™ºèƒ½æŒ‡é’ˆåˆ›å»ºC++ 11çš„threadçº¿ç¨‹æ‰å¼€å§‹çœŸæ­£æ‰§è¡Œã€‚\n1. `m_started` - è¡¨ç¤º\n2. `m_joined`\n3. `std::shared_ptr<std::thread> m_thread`\n4. `pid_t m_tid`\n5. `ThreadFunc m_func` - å­˜å‚¨çº¿ç¨‹å‡½æ•°\n6. `std::string m_name`\n7. `static std::atomic_int m_numCreated` - ç›®å‰äº§ç”Ÿäº†çº¿ç¨‹å¯¹è±¡çš„è®¡æ•°å€¼\n### æˆå‘˜æ–¹æ³•\n#### setDefaultName\næ„é€ å‡½æ•°ä¸­å¦‚æœæ²¡æœ‰ä¼ å…¥nameåˆ™èµ‹\"Thread %d \"ï¼Œ%dä¸ºå·²åˆ›å»ºçš„çº¿ç¨‹å¯¹è±¡æ•°ç›®ã€‚\n```cpp\nprivate:\n    void setDefaultName();\n```\n#### æ„é€  / ææ„å‡½æ•°\n```cpp\npublic:\n    explicit Thread(ThreadFunc, const std::string & name = std::string());\n    ~Thread();\n```\n#### start\n```cpp\npublic:\n    void start();\n```\n#### join\n```cpp\npublic:\n    void join();\n```\n#### è·å–çº¿ç¨‹çŠ¶æ€ç›¸å…³çš„æ ‡å¿—ã€ä¿¡æ¯\n1. started\n2. tid\n3. name\n4. numCreated\n\n```cpp\npublic:\n    bool started() const {return m_started;}\n    pid_t tid() const {return m_tid;}\n    const std::string & name() const {return m_name;}\n    static int numCreated() {return m_numCreated;}\n```\n### ä»£ç å®ç°\n```cpp\n#include\"thread.h\"\n#include\"currentthread.h\"\n#include<semaphore.h>\nstd::atomic_int Thread::m_numCreated(0);\nvoid Thread::setDefaultName(int numCreated)\n{\n    char buf[32] = {0};\n    snprintf(buf, sizeof buf, \"Thread%d\", numCreated);\n    m_name = buf;\n}\nThread::Thread(ThreadFunc func, const std::string & name)\n    : m_started(false), m_joined(false), m_tid(0),\n      m_func(std::move(func)), m_name(name)\n{\n    int num = ++m_numCreated;\n    if(m_name.empty())\n    {\n        setDefaultName(num);\n    }\n}\nThread::~Thread()\n{\n    /* çº¿ç¨‹è¦ä¹ˆjoin, è¦ä¹ˆdetach */\n    if(m_started && !m_joined)\n    {\n        m_thread->detach();\n    }\n}\nvoid Thread::start()\n{\n    m_started = true;\n    /* ä¸ºäº†tidåˆå§‹åŒ–æ—¶æœŸçš„çº¿ç¨‹å®‰å…¨, ä¿è¯tidæœ‰æ•ˆ */\n    sem_t sem;\n    sem_init(&sem, false, 0);   //åœ°å€, æ˜¯å¦è¿›ç¨‹é—´å…±äº«, åˆå§‹å€¼0\n    //ä¸‹é¢è¿™å¥æ‰æ˜¯çœŸæ­£å»åˆ›å»ºä¸€ä¸ªç«‹å³æ‰§è¡Œçš„å­çº¿ç¨‹ã€‚è€Œä¸”ä¸‹é¢è¿™ä¸ªè¯­å¥æ˜¯å­çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚\n    //ä»åˆ›å»ºå®Œm_threadåä¸»çº¿ç¨‹ã€å­çº¿ç¨‹åˆ†ç¦», ä¸»çº¿ç¨‹éœ€è¦ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•, å¯ä»¥ç”¨ä¿¡å·é‡æ¥æ§åˆ¶ã€‚\n    m_thread = std::make_shared<std::thread>([&](){\n        m_tid = CurrentThread::tid();\n        \n        sem_post(&sem);\n        \n        m_func();\n    });\n\t//è¿™é‡Œæ˜¯ä¸»çº¿ç¨‹çš„ä»£ç ï¼Œåªæœ‰semçš„å€¼å˜ä¸º>0æ—¶æ‰èƒ½å¾€ä¸‹èµ°ã€‚\n    sem_wait(&sem);\n}\nvoid Thread::join()\n{\n    m_joined = true;\n    m_thread->join();\n}\n```\n## EventLoopThread\n```cpp\nclass EventLoopThread : noncopyable\n```\nå°è£…çš„ç›®æ ‡ï¼šåœ¨threadçº¿ç¨‹å¯¹è±¡ä¸Šè¿è¡Œä¸€ä¸ªloopã€‚\n### çº¿ç¨‹åˆå§‹åŒ–æ—¶å›è°ƒå‡½æ•°\n```cpp\npublic:\n    using ThreadInitCallback = std::function<void(EventLoop*)>;\n```\n### æˆå‘˜å˜é‡\n1. `m_loop` - å­˜å‚¨Eventloopå¯¹è±¡æŒ‡é’ˆ\n\n```cpp\nprivate:\n    EventLoop * m_loop;\n```\n\n2. `m_thread` - å­˜å‚¨çº¿ç¨‹å¯¹è±¡\n\n```cpp\nprivate:\n    Thread m_thread;\n```\n\n3. `bool m_exiting` - çº¿ç¨‹æ­£åœ¨é€€å‡ºçš„æ ‡å¿—\n\n```cpp\nprivate:\n    bool m_exiting;\n```\n\n4. `ThreadInitCallback m_callback` - çº¿ç¨‹åˆå§‹åŒ–è°ƒç”¨çš„å›è°ƒæ“ä½œï¼Œåœ¨EventLoopThreadæ„é€ æ—¶åœ¨ç¬¬1ä¸ªå‚æ•°ä¼ å…¥ï¼Œé»˜è®¤æ˜¯ä¸€ä¸ªç©ºæ“ä½œã€‚\n\n```cpp\nprivate:\n    ThreadInitCallback m_callback;\n```\n### æˆå‘˜å‡½æ•°\n#### æ„é€  / ææ„å‡½æ•°\næ„é€ å‡½æ•°å‚æ•°ï¼šå¯ä»¥ä¼ å…¥ä¸€ä¸ªçº¿ç¨‹åˆå§‹åŒ–å›è°ƒå‡½æ•°å¯¹è±¡ï¼›è¿˜æœ‰nameã€‚å…¶ä¸­ï¼Œå›è°ƒå‡½æ•°å¯¹è±¡é»˜è®¤æ„é€ ä¸ºç©ºæ“ä½œã€‚\n```cpp\npublic:\nEventLoopThread(const ThreadInitCallback &cb = ThreadInitCallback(),\n                const std::string & name = std::string());\n~EventLoopThread();\n```\n#### startLoop - å¼€å¯å¾ªç¯\n```cpp\npublic:\n    EventLoop * startLoop();\n```\n#### threadFunc - çº¿ç¨‹å‡½æ•°\n```cpp\nprivate:\n    void threadFunc();\n```\n### ä»£ç å®ç°\n1. æ„é€ å‡½æ•°\n    1. ä¸»è¦çš„å·¥ä½œå°±æ˜¯æ„é€ EventLoopThreadä¸­çš„Threadå¯¹è±¡å³`m_thread`æˆå‘˜ã€‚Threadå¯¹è±¡`m_thread`ç»‘å®šçš„çº¿ç¨‹å‡½æ•°æ˜¯ç”¨`std::bind`ç»‘å®šçš„å‡½æ•°ï¼Œç”¨çš„æ˜¯EventLoopThreadç±»ä¸­çš„threadFuncå‡½æ•°ï¼Œå¹¶ä¸”ç»‘å®šäº†å…¶thisæŒ‡é’ˆã€‚EventLoopThreadæ„é€ å‡½æ•°çš„ç¬¬2ä¸ªå‚æ•°nameå°†ä½œä¸º`m_thread`çš„åå­—ã€‚\n    2. ç¬¬1ä¸ªå‚æ•°æŒ‡å®šçš„æ˜¯`çº¿ç¨‹åˆå§‹åŒ–æ—¶çš„å›è°ƒå‡½æ•°`ï¼Œ**ä¸çº¿ç¨‹startåæ‰§è¡Œçš„çº¿ç¨‹å‡½æ•°æ— å…³**ã€‚ç¬¬1ä¸ªå‚æ•°çš„é»˜è®¤å€¼å’Œç¬¬2ä¸ªå‚æ•°çš„é»˜è®¤å€¼åœ¨`.h`æ–‡ä»¶ä¸­å·²æŒ‡å‡ºã€‚`ThreadInitCallback()`æ˜¯æŒ‡åˆ›å»ºä¸€ä¸ªé»˜è®¤å‡½æ•°å¯¹è±¡ï¼Œå‡½æ•°æ‰§è¡Œç©ºæ“ä½œã€‚\n    3. Threadå¯¹è±¡æ„é€ å®Œæˆåï¼Œä¸ä¼šç«‹å³æ‰§è¡Œ`çº¿ç¨‹å‡½æ•°threadFunc`ï¼Œå› ä¸ºThreadæ„é€ å¹¶ä¸æ„å‘³ç€C++11æ ‡å‡†åº“çš„threadåˆ›å»ºå®Œæ¯•ã€‚åªæœ‰è°ƒç”¨`m_thread.start()`æ‰ä¼šçœŸæ­£æ‰§è¡Œ`çº¿ç¨‹å‡½æ•°threadFunc`ã€‚\n    4. æ„é€ å‡½æ•°è¿˜æŠŠä¼ å…¥çš„`çº¿ç¨‹åˆå§‹åŒ–æ—¶å›è°ƒå‡½æ•°cb`ä¿å­˜åˆ°äº†`m_callback`æˆå‘˜ã€‚\n\n```cpp\n#include\"eventloopthread.h\"\n#include\"eventloop.h\"\nEventLoopThread::EventLoopThread(const ThreadInitCallback &cb,\n                const std::string &name)\n  : m_loop(nullptr), m_exiting(false),\n    m_thread(std::bind(&EventLoopThread::threadFunc, this), name),\n    m_mutex(), m_cond(), m_callback(cb)\n{\n\n}\nEventLoopThread::~EventLoopThread()\n{\n    m_exiting = true;\n    if(m_loop != nullptr)\n    {\n        m_loop->quit();\n        m_thread.join();\n    }\n}\nEventLoop * EventLoopThread::startLoop()\n{\n    m_thread.start();   //å¯åŠ¨åº•å±‚æ–°çº¿ç¨‹ï¼Œæ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œ\n    \n    EventLoop * loop = nullptr;\n    {/* ä¸´ç•ŒåŒºm_loop */\n        std::unique_lock<std::mutex> lock(m_mutex);\n        while(m_loop == nullptr)\n        {\n            m_cond.wait(lock);\n        }\n        loop = m_loop;\n    }/* ä¸´ç•ŒåŒºm_loop */\n    return loop;\n}\n/**\n* @brief Threadå¯¹è±¡å®é™…æ‰§è¡Œçš„çº¿ç¨‹å‡½æ•°ï¼Œåœ¨å•ç‹¬çš„å­çº¿ç¨‹ä¸­æ‰§è¡Œ\n*/\nvoid EventLoopThread::threadFunc()\n{\n    EventLoop loop; //æ„é€ ä¸€ä¸ªç‹¬ç«‹çš„eventloop, å’Œm_threadä¸€å¯¹ä¸€, one loop per threadçš„è¯æ®\n    if(m_callback)\t//å¦‚æœm_callback(å³ThreadInitCallback)ä¸ä¸ºç©ºåˆ™æ‰§è¡Œæ­¤å‡½æ•°\n    {\n        m_callback(&loop);\n    }\n    {/* ä¸´ç•ŒåŒºm_loop */\n        std::unique_lock<std::mutex> lock(m_mutex);\n        m_loop = &loop;\n        m_cond.notify_one();\t//é€šçŸ¥ä¸»çº¿ç¨‹çš„startLoop(), loopå·²ç»åœ¨å­çº¿ç¨‹åˆ›å»ºå¥½äº†ã€‚\n    }/* ä¸´ç•ŒåŒºm_loop */\n    loop.loop();    //EventLoop loop => Poller.poll\n    \n    /* æ‰§è¡Œåˆ°æ­¤å¤„è¯´æ˜loopå·²ç»ç»“æŸ é€€å‡ºå¾ªç¯ */\n    std::unique_lock<std::mutex> lock(m_mutex);\n    m_loop = nullptr;\n}\n```\n# EventLoopThreadPool\n```cpp\nclass EventLoopThreadPool : noncopyable\n```\n## çº¿ç¨‹åˆå§‹åŒ–æ—¶å›è°ƒå‡½æ•°\n\n```cpp\npublic:\n    using ThreadInitCallback = std::function<void(EventLoop*)>;\n```\n## æˆå‘˜å˜é‡\n1. `m_baseLoop` - ç”¨æˆ·æœ€å¼€å§‹åˆ›å»ºçš„loop\n2. æ ‡å¿—ç›¸å…³\n    1. `std::string m_name`\n    2. `bool m_started`\n    3. `int m_numThreads`\n    4. `int m_next`\n3. `std::vector<std::unique_ptr<EventLoopThread>> m_threads` - åŒ…å«äº†æ‰€æœ‰åˆ›å»ºçš„çº¿ç¨‹\n4. `std::vector<EventLoop*> m_loops` - åŒ…å«äº†æ‰€æœ‰ç®¡ç†ç€çš„loopçš„æŒ‡é’ˆï¼Œé€šè¿‡`m_threads`ä¸­çš„æŸä¸ªthreadè¿›è¡Œ`startLoop()`è¿”å›loopçš„æŒ‡é’ˆã€‚\n## æˆå‘˜å‡½æ•°\n### æ„é€ /ææ„å‡½æ•°\n```cpp\npublic:\n    EventLoopThreadPool(EventLoop * baseLoop, const std::string &nameArg);\n    ~EventLoopThreadPool();\n```\n#### `setThreadNum(int)` - ä¾›TcpServerè°ƒç”¨\n```cpp\npublic:\n    void setThreadNum(int numThreads)\n    {\n        m_numThreads = numThreads;\n    }\n```\n#### `start` - å¼€å¯äº‹ä»¶å¾ªç¯çº¿ç¨‹\n```cpp\npublic:\n    void start(const ThreadInitCallback &cb = ThreadInitCallback());\n```\n#### `getNextLoop` - å¦‚æœå·¥ä½œåœ¨å¤šçº¿ç¨‹ä¸­ï¼ŒbaseLoopé»˜è®¤ä»¥è½®è¯¢çš„æ–¹å¼åˆ†é…channelç»™subLoop\n```cpp\npublic:\n    EventLoop * getNextLoop();\n```\n#### `getAllLoops` - è·å–æ‰€æœ‰ç®¡ç†ç€çš„loopï¼Œå­˜åˆ°vectorä¸­ï¼Œç›¸å½“äºæ‹·è´äº†`m_loops`\n\n```cpp\npublic:\n    std::vector<EventLoop*> getAllLoops();\n```\n#### è·å–å„ç§çŠ¶æ€ã€ä¿¡æ¯\n1. started\n2. name\n\n```cpp\npublic:\n    bool started() const {return m_started;}\n    const std::string name() const {return m_name;}\n```\n## ä»£ç å®ç°\n```cpp\n#include\"eventloopthreadpool.h\"\n#include\"eventloopthread.h\"\nEventLoopThreadPool::EventLoopThreadPool(EventLoop *baseLoop, const std::string &nameArg)\n    : m_baseLoop(baseLoop),\n      m_name(nameArg),\n      m_started(false),\n      m_numThreads(0),\n      m_next(0)\n{\n\n}\nEventLoopThreadPool::~EventLoopThreadPool()\n{\n    /**\n     * nothing to do, bacause evey loop is on the thread stack,\n     * that will destruct automatically.\n     */\n}\nvoid EventLoopThreadPool::start(const ThreadInitCallback &cb)\n{\n    m_started = true;\n    for(int i = 0; i < m_numThreads; ++i)\n    {\n        char buf[m_name.size() + 32];\n        /* ä»¥çº¿ç¨‹æ± name + ä¸‹æ ‡åºåˆ—å· ä½œä¸ºthreadçº¿ç¨‹çš„åå­— */\n        snprintf(buf, sizeof buf, \"%s%d\", m_name.c_str(), i);\n        std::string threadName(buf);\n        m_threads.push_back(std::make_unique<EventLoopThread>(cb, threadName));\n        m_loops.push_back(m_threads.back()->startLoop());\n    }\n    /* m_numThreads == 0æ—¶, ä¸Šé¢forå¾ªç¯ä¸ä¼šæ‰§è¡Œ, æ‰§è¡Œä¸‹é¢çš„æ“ä½œ */\n    if(m_numThreads == 0 && cb != nullptr)\n    {\n        cb(m_baseLoop);\n    }\n}\n/* ä½“ç°äº†å¯¹subLoopçš„è½®è¯¢ç®—æ³• */\nEventLoop* EventLoopThreadPool::getNextLoop()\n{\n    EventLoop * loop = m_baseLoop;\n    if(!m_loops.empty())\n    {\n        loop = m_loops[m_next];\n        ++m_next;\n        if(m_next >= m_loops.size())\n        {\n            m_next = 0;\n        }\n    }\n    return loop;\n}\nstd::vector<EventLoop*> EventLoopThreadPool::getAllLoops()\n{\n    if(m_loops.empty())\n    {\n        return std::vector<EventLoop*>(1, m_baseLoop);\n    }\n    else\n    {\n        return m_loops;\n    }\n}\n```\n# Acceptor\nmainReactorä¸»è¦çš„å·¥ä½œæ˜¯å¤„ç†å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼Œç„¶åæŠŠsockfdè½®è¯¢åˆ†é…ç»™subReactorsã€‚\n\nè¿™ä¸ªå·¥ä½œç”±mainReactorä¸­çš„acceptorå¤„ç†ã€‚å¤„ç†çš„æµç¨‹å’ŒTCP socketç¼–ç¨‹æµç¨‹åŸºæœ¬ä¸€è‡´ã€‚éœ€è¦æœ‰ä¸€ä¸ªlistenfdï¼Œå³ç›‘å¬å¥—æ¥å­—ï¼Œå»å…¶ä¸­çš„ç›‘å¬é˜Ÿåˆ—å–å¯ç”¨çš„è¿æ¥ã€‚å³Acceptorä¸»è¦å°±æ˜¯å¯¹è‹¥å¹²sockfdçš„å°è£…ã€‚\n## socket\n### .hæ–‡ä»¶\n\n```cpp\n#pragma once\n#include\"noncopyable.h\"\nclass InetAddress;\nclass Socket : noncopyable\n{\npublic:\n    explicit Socket(int sockfd)\n        : m_sockfd(sockfd)\n    {\n\n    }\n    ~Socket();\n    int fd() const {return m_sockfd;}\n    void bindAddress(const InetAddress &localAddr);\n    void listen();\n    int accept(InetAddress *peerAddr);\npublic:\n    void shutdownWrite();\n    /* æ›´æ”¹TCPé€‰é¡¹, ç›´æ¥äº¤ä»˜, ä¸è¿›è¡Œç¼“å­˜ */\n    void setTcpNoDelay(bool on);\n    /* æ›´æ”¹TCPé€‰é¡¹ */\n    void setReuseAddr(bool on);\n    /* æ›´æ”¹TCPé€‰é¡¹ */\n    void setReusePort(bool on);\n    /* æ›´æ”¹TCPé€‰é¡¹ */\n    void setKeepAlive(bool on);\nprivate:\n    const int m_sockfd;\n};\n```\n### .ccæ–‡ä»¶\n```cpp\n#include\"socket.h\"\n#include\"logger.h\"\n#include\"inetaddress.h\"\n#include<unistd.h>  //close\n#include<sys/socket.h>  //bind\n#include<strings.h> //bzero\n#include<netinet/tcp.h> //TCP_NODELAY\nSocket::~Socket()\n{\n    close(m_sockfd);\n}\nvoid Socket::bindAddress(const InetAddress &localAddr)\n{\n    /* bind return 0 when success */\n    if(0 != ::bind(m_sockfd, (sockaddr*)localAddr.getSockAddr(), sizeof(sockaddr_in)))\n    {\n        LOG_FATAL(\"bind sockfd: %d fail, createNonblocking or Die\\n\", m_sockfd);\n    }\n}\nvoid Socket::listen()\n{\n    if(0 != ::listen(m_sockfd, 1024))\n    {\n        LOG_FATAL(\"listen sockfd: %d fail\\n\", m_sockfd);\n    }\n}\nint Socket::accept(InetAddress * peerAddr)\n{\n    struct sockaddr_in addr;\n    socklen_t len;\n    bzero(&addr, sizeof addr);\n    int connfd = ::accept(m_sockfd, (sockaddr*)&addr, &len);\n    if(connfd >= 0)\n    {\n        peerAddr->setSockAddr(addr);\n    }\n    return connfd;\n}\nvoid Socket::shutdownWrite()\n{\n    if(::shutdown(m_sockfd, SHUT_WR) < 0)\n    {\n        LOG_ERROR(\"shutdown Write error\\n\");\n    }\n}\nvoid Socket::setTcpNoDelay(bool on)\n{\n    int optval = on ? 1 : 0;\n    ::setsockopt(m_sockfd, IPPROTO_TCP, TCP_NODELAY, &optval, sizeof optval);\n}\nvoid Socket::setReuseAddr(bool on)\n{\n    int optval = on ? 1 : 0;\n    ::setsockopt(m_sockfd, SOL_SOCKET, SO_REUSEADDR, &optval, sizeof optval);\n}\nvoid Socket::setTcpNoDelay(bool on)\n{\n    int optval = on ? 1 : 0;\n    ::setsockopt(m_sockfd, SOL_SOCKET, SO_REUSEPORT, &optval, sizeof optval);\n}\nvoid Socket::setKeepAlive(bool on)\n{\n    int optval = on ? 1 : 0;\n    ::setsockopt(m_sockfd, SOL_SOCKET, SO_KEEPALIVE, &optval, sizeof optval);\n}\n```\n## Acceptor\n```cpp\nclass Acceptor : noncopyable\n```\n### æ”¶åˆ°æ–°è¿æ¥æ—¶çš„å›è°ƒ\n\n```cpp\npublic:\n    using NewConnectionCallback = std::function<void(int fd, const InetAddress&)>;\n```\n### æˆå‘˜å˜é‡\n1. `m_loop`\n2. `m_acceptSocket`\n3. `m_acceptChannel`\n4. `m_newConnectionCallback` - æŠŠfdæ‰“åŒ…ä¸ºchannelï¼ŒgetNextLoopå”¤é†’ä¸€ä¸ªsubLoopï¼ŒæŠŠchannelåˆ†å‘ç»™subLoopã€‚\n5. `m_listening`\n```cpp\nprivate:\n    EventLoop * m_loop;\n    Socket m_acceptSocket;\n    Channel m_acceptChannel;\n    NewConnectionCallback m_newConnectionCallback;\n    bool m_listenning;\n```\n### æˆå‘˜å‡½æ•°\n#### æ„é€ /ææ„\n```cpp\npublic:\n    /* æ­¤æ„é€ çš„ä¸‰ä¸ªå‚æ•°æœ¬èº«ä¹Ÿæ˜¯TcpServerçš„ä¸‰ä¸ªå‚æ•° */\n    Acceptor(EventLoop * loop, const InetAddress & listenAddr, bool reusePort);\n    ~Acceptor();\n```\n#### listen\n```cpp\npublic:\n    void listen();\n```\n#### get/set\n1. setNewConnectionCallback\n2. listening\n\n```cpp\npublic:\n    void setNewConnectionCallback(const NewConnectionCallback &cb)\n    {\n        m_newConnectionCallback = cb;\n    }\n    bool listenning() const {return m_listenning;}\n```\n#### handleRead\n```cpp\nprivate:\n    void handleRead();\n```\n### ä»£ç å®ç°\n#### æ„é€ \n1. ç”±ä¼ å…¥çš„`loop`å¯¹`m_loop`åˆå§‹åŒ–ï¼›åˆ›å»ºä¸€ä¸ªNonBlockçš„Tcp socketfdå¹¶ç”¨äºæ„é€ `m_acceptSocket`ï¼›æŠŠloopå’Œåˆšæ‰åˆ›å»ºå¥½çš„socketfdæ‰“åŒ…æ„é€ `m_acceptChannel`ï¼›è®¾ç½®å„ç§æ ‡å¿—ã€‚\n2. æ ¹æ®ä¼ å…¥çš„ç¬¬2ä¸ªå‚æ•°`listenAddr`ï¼Œ`bindAddress`ç»‘å®šåœ°å€åˆ°socketä¸Šã€‚\n3. TcpServerè°ƒç”¨start()åï¼Œæ„å‘³ç€acceptorè¦å¯¹listen sockfdè¿›è¡Œlistenã€‚å¦‚æœæ¥æ”¶åˆ°äº†æ–°ç”¨æˆ·çš„è¿æ¥ï¼Œéœ€è¦æ‰§è¡Œä¸€ä¸ªå›è°ƒï¼ˆå…·ä½“æ“ä½œæ˜¯æŠŠconnfd->channel->subloopï¼‰ã€‚æ‰€ä»¥è¿˜è¦è®¾ç½®ä¸€ä¸ªReadCallbackã€‚\n\n```cpp\nstatic int createNonblockingSocket()\n{\n    int sockfd = ::socket(AF_INET, SOCK_STREAM | SOCK_NONBLOCK | SOCK_CLOEXEC, IPPROTO_TCP);\n    if(sockfd < 0)\n    {\n        LOG_FATAL(\"%s:%s:%d listen socketfd create err: %d\\n\", __FILE__, __FUNCTION__, __LINE__, errno);\n    }\n    return sockfd;\n}\nAcceptor::Acceptor(EventLoop *loop, const InetAddress &listenAddr, bool reusePort)\n  : m_loop(loop),\n    m_acceptSocket(createNonblockingSocket()),    //create socket\n    m_acceptChannel(loop, m_acceptSocket.fd()),\n    m_listenning(false)\n{\n    m_acceptSocket.setReuseAddr(true);\n    m_acceptSocket.setReusePort(true);\n    m_acceptSocket.bindAddress(listenAddr);         //bind addr to socket\n    // TcpServer::start() Acceptor::listen(), å¦‚æœæœ‰æ–°è¿æ¥éœ€è¦æ‰§è¡Œå›è°ƒ connfd->channel->subloop\n    //baseLoop -> m_acceptChannel(listenfd) -> \n    m_acceptChannel.setReadCallback(std::bind(&Acceptor::handleRead, this));\n}\n```\n\n#### handleRead - listenfdæœ‰äº‹ä»¶å‘ç”Ÿ, å³æœ‰æ–°ç”¨æˆ·é“¾æ¥æ—¶çš„å›è°ƒæ“ä½œ\n\n#### acceptä¸€ä¸ªconnfd\næŠŠfdå’ŒpeerAddräº¤ç»™newConnectionCallbackå¤„ç†ã€‚newConnectionCallbackæ˜¯TcpServerä¸­ç¼–å†™çš„ã€‚ä¸»è¦å·¥ä½œæ˜¯**è½®è¯¢æ‰¾åˆ°subLoop, å”¤é†’, åˆ†é…å½“å‰æ–°å®¢æˆ·ç«¯çš„channel**ã€‚\n\n```cpp\n/* listenfdæœ‰äº‹ä»¶å‘ç”Ÿ, å³æœ‰æ–°è¿æ¥ */\nvoid Acceptor::handleRead()\n{\n   InetAddress peerAddr;\n   int connfd = m_acceptSocket.accept(&peerAddr);\n   if(connfd > 0)\n   {\n       if(m_newConnectionCallback)\n       {\n           /* è½®è¯¢æ‰¾åˆ°subLoop, å”¤é†’, åˆ†é…å½“å‰æ–°å®¢æˆ·ç«¯çš„channel */\n           m_newConnectionCallback(connfd, peerAddr);\n       }\n       else\n       {\n           close(connfd);\n       }\n   }\n   else\n   {\n       LOG_ERROR(\"%s:%s:%d accept err: %d\", __FILE__, __FUNCTION__, __LINE__, errno);\n       if(errno == EMFILE)\n       {\n           LOG_ERROR(\"(sockfd reached max limit)\");\n       }\n       LOG_ERROR(\"\\n\");\n   }\n}\n```\n#### ææ„\n```cpp\nAcceptor::~Acceptor()\n{\n    m_acceptChannel.disableAll();\n    m_acceptChannel.remove();\n}\n```\n#### listen\n1. è®¾ç½®listenningæ ‡å¿—\n2. è°ƒç”¨`m_acceptSocket`çš„listen\n3. è°ƒç”¨`m_acceptChannel`çš„enableReadingï¼Œå³æŠŠ`m_acceptChannel`æ³¨å†Œåˆ°Pollerä¸­ã€‚\n\n```cpp\nvoid Acceptor::listen()\n{\n    m_listenning = true;\n    m_acceptSocket.listen();                        //listen\n    m_acceptChannel.enableReading();                //m_acceptChannel -> poller\n}\n```\n# TcpServer\n\nè€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼šç”¨æˆ·ä½¿ç”¨muduoåº“ç¼–å†™æœåŠ¡å™¨ç¨‹åºæ—¶ï¼Œä¸ºäº†é¿å…ç”¨æˆ·å†å»å›°æƒ‘å¼•å…¥å“ªäº›å¤´æ–‡ä»¶ï¼Œæˆ‘ä»¬åœ¨tcpserver.hä¸­æŠŠè¯¥å¼•å…¥çš„å¤´æ–‡ä»¶å…¨å¼•å…¥è¿›å»ï¼Œè€Œä¸å†åªæ˜¯å¯¹ç±»å‰ç½®å£°æ˜äº†ã€‚\n```cpp\n#pragma once\n#include\"eventloop.h\"\n#include\"acceptor.h\"\n#include\"inetaddress.h\"\n#include\"noncopyable.h\"\nclass TcpServer : noncopyable\n```\n## å›è°ƒ\n\næ‰€æœ‰çš„å›è°ƒï¼Œéƒ½æ˜¯ç”¨æˆ·è®¾ç½®åˆ°TcpServeråï¼ŒTcpServerå†è‡ªå·±è®¾ç½®åˆ°EventLoopä¸­çš„ã€‚\n\nä»¥ä¸‹æ˜¯TcpServerç±»ä¸­åŒ…å«çš„å›è°ƒæ“ä½œå±æ€§ã€‚ï¼ˆæˆå‘˜å˜é‡ï¼‰\n\n```cpp\nprivate:\n    ThreadInitCallback\t    m_threadInitCallback;\n    ConnectionCallback \t    m_connectionCallback;\n    MessageCallback\t        m_messageCallback;\n    WriteCompleteCallback   m_writeCompleteCallback;\n    HighWaterMarkCallback   m_highWaterMarkCallback;\n```\n\n### çº¿ç¨‹åˆå§‹åŒ–æ—¶çš„å›è°ƒ\nç›´æ¥å£°æ˜åœ¨TcpServer classä¸­ã€‚\n```cpp\npublic:\n    using ThreadInitCallback = std::function<void(EventLoop*)>;\n```\n\n### è¿æ¥ã€è¯»å†™äº‹ä»¶çš„å›è°ƒ - å•ç‹¬å†™åˆ°callbacks.hæ–‡ä»¶ä¸­\n\n>ä¸ºäº†å¯¹å„ç§å›è°ƒå‡½æ•°è¿›è¡Œç®¡ç†ï¼Œå†™åˆ°å•ç‹¬çš„å¤´æ–‡ä»¶`callbacks.h`ä¸­ã€‚\n\n1. ConnectionCallback - æœ‰å…³è¿æ¥çš„å›è°ƒã€‚\n2. CloseCallback - å…³é—­è¿æ¥çš„å›è°ƒ\n3. WriteCompleteCallback - æ¶ˆæ¯å‘é€å®Œæˆåçš„å›è°ƒ\n4. MessageCallback - å·²è¿æ¥ç”¨æˆ·æœ‰è¯»å†™äº‹ä»¶å‘ç”Ÿæ—¶çš„å›è°ƒ\n5. HighWaterMarkCallback - é«˜æ°´ä½å›è°ƒï¼Œä¸ºäº†æ§åˆ¶æ”¶å‘æµé‡ç¨³å®š\n\n```cpp\n#pragma once\n#include<memory>\n#include<functional>\nclass Buffer;\nclass TcpConnection;\n\nusing TcpConnectionPtr = std::shared_ptr<TcpConnection>;\n\nusing ConnectionCallback = std::function<void(const TcpConnectionPtr&)>;\nusing CloseCallback = std::function<void(const TcpConnectionPtr&)>;\nusing WriteCompleteCallback = std::function<void(const TcpConnectionPtr&)>;\nusing HighWaterMarkCallback = std::function<void(const TcpConnectionPtr&, size_t)>;\n\nusing MessageCallback = std::function<void(const TcpConnectionPtr &,\n                                           Buffer *, Timestamp)>;\n```\n\n## æšä¸¾å£°æ˜\n\nOptionæšä¸¾ç±»ï¼Œç›´æ¥å£°æ˜åœ¨TcpServerç±»ä¸­ã€‚\n\n`Option.kReusePort`/`Option.kNoReusePort`è¡¨ç¤ºç«¯å£æ˜¯å¦å¯é‡ç”¨ã€‚\n\n```cpp\npublic:\n    enum Option\n    {\n        kNoReusePort,\n        kReusePort\n    };\n```\n\n## æˆå‘˜å˜é‡\n\nå…¶ä¸­ï¼Œå›è°ƒå‡½æ•°å±æ€§å·²ç»åœ¨ä¸Šé¢ç»™å‡ºã€‚\n1. `ConnectionMap m_connections` - ä¿å­˜æ‰€æœ‰çš„è¿æ¥\n\n   ```cpp\n   private:\n       using ConnectionMap = std::unoredered_map<std::string, TcpConnectionPtr>;\n       ConnectionMap m_connections;\n   ```\n\n2. `EventLoop *m_loop` - ç”¨æˆ·å®ç°å®šä¹‰çš„baseLoop\n\n   ```cpp\n   private:\n       EventLoop * m_loop;\n   ```\n\n3. `m_IPport` - å­˜å‚¨IPå’Œç«¯å£çš„å­—ç¬¦ä¸²\n\n   ```cpp\n   private:\n       const std::string m_IPport;\n   ```\n\n4. `std::unique_ptr<Acceptor> m_acceptor` - è¿è¡Œåœ¨mainLoopï¼Œä»»åŠ¡æ˜¯ç›‘å¬æ–°è¿æ¥äº‹ä»¶ã€‚\n\n5. `std::unique_ptr<EventLoopThreadPool> m_threadPool` - \n\n6. æ ‡è¯†\n\n   1. `std::string m_name` - TcpServerçš„æ˜“è®°å¿†åå­—\n   2. `atomic_bool started` - æ˜¯å¦å·²å¯åŠ¨\n\n   ```cpp\n   private:\n       std::string m_name;\n       atomic_bool started;\n   ```\n\n7. `m_nextConnId`\n\n   ```cpp\n   private:\n       int m_connId;\n   ```\n\n\n## æˆå‘˜å‡½æ•°\n\n1. æ„é€ /ææ„\n\n   ```cpp\n   public:\n       TcpServer(EventLoop * loop, const InetAddress &listenAddr,\n                 const std::string &nameArg, Option option = kNoReusePort);\n       ~TcpServer();\n   ```\n\n2. è®¾ç½®å›è°ƒ\n   ```cpp\n   public:\n       void setThreadInitCallback(const ThreadInitCallback &cb)\n       {\n           m_threadInitCallback = cb;\n       }\n       void setConnectionCallback(const ConnectionCallback &cb)\n       {\n           m_connectionCallback = cb;\n       }\n       void setMessageCallback(const MessageCallback &cb)\n       {\n           m_messageCallback = cb;\n       }\n       void setWriteCompleteCallback(const WriteCompleteCallback &cb)\n       {\n           m_writeCompleteCallback = cb;\n       }\n   ```\n\n3. start - å¼€å¯æœåŠ¡å™¨ç›‘å¬ï¼Œå³mainLoopçš„acceptorçš„listen\n   ```cpp\n   public:\n       void start();\n   ```\n\n4. å…³äºConnection\n   ```cpp\n   private:\n       void newConnection(int sockfd, const InetAddress& peerAddr);\n       void removeConnection(const TcpConnectionPtr& conn);\n       void removeConnectionInLoop(const TcpConnectionPtr& conn);\n   ```\n\n## ä»£ç å®ç°\n\n1. æ„é€ ï¼Œæœ‰ä¸‰ä¸ªå‚æ•°ï¼ŒloopæŒ‡é’ˆï¼ŒInetAddressï¼Œæ ‡è¯†åç§°nameï¼Œç«¯å£æ˜¯å¦é‡ç”¨Option\n\n   1. å¯¹`m_loop`è¿›è¡Œèµ‹å€¼ï¼Œéœ€è¦åšéç©ºæ£€æŸ¥\n\n      ```cpp\n      EventLoop* CheckLoopNotNull(EventLoop* loop)\n      {\n          if(loop == nullptr)\n          {\n              LOG_FATAL(\"%s:%s:%d mainLoop is null\\n\", __FILE__, __FUNCTION__, __LINE__);\n          }\n          return loop;\n      }\n      ```\n\n   2. å¯¹`m_IPport`è¿›è¡Œèµ‹å€¼ï¼Œå€¼æ˜¯è°ƒç”¨å‚æ•°`listenAddr`ä¸­çš„å‡½æ•°`toIPport()`è·å¾—çš„\n\n   3. å¯¹`m_name`èµ‹å€¼\n\n   4. å¯¹`m_acceptor`è¿›è¡Œæ„é€ (unique_ptr)ã€‚ä¼ å…¥å‚æ•°`loop`ï¼Œ`listenAddr`ï¼Œ`option`\n\n      1. åˆ›å»ºsocket\n      2. socketçš„fdå’ŒloopæŒ‡é’ˆå°è£…ä¸ºChannel - `m_acceptChannel(loop, m_acceptSocket.fd())`\n      3. è®¾ç½®channelçš„ReadCallbackå›è°ƒ\n      4. å½“TcpServerè°ƒç”¨startæ—¶ï¼Œacceptorå°†ä¼šè°ƒç”¨listenï¼Œå°†è°ƒç”¨`m_acceptChannel`çš„`enableReading()`å‡½æ•°ï¼Œå¾€å…¶ç›¸åº”çš„loopä¸­è¿›è€Œåœ¨pollerä¸­æ³¨å†Œäº‹ä»¶ã€‚\n      5. loopç­‰å¾…äº‹ä»¶ï¼Œå¦‚æœå‘ç”Ÿäº‹ä»¶ï¼Œè°ƒç”¨channelçš„handleEventï¼Œè¿›è€Œæ‰§è¡ŒreadCallBackã€‚acceptorçš„readCallBackåœ¨æ„é€ æ—¶ç»‘å®šä¸ºhandleReadï¼Œå·¥ä½œæ˜¯å¯¹channelçš„socketè¿›è¡Œacceptã€‚\n\n   5. å¯¹`m_threadPool`è¿›è¡Œæ„é€ (shared_ptr)ã€‚ä¼ å…¥å‚æ•°`loop`ï¼Œ`m_name`\n\n   6. è®¾ç½®å›è°ƒ\n\n      1. `m_connectionCallBack`\n      2. `m_messageCallBack`\n\n   7. `m_nextConnId`\n\n   ```cpp\n   #include<functional>\n   using namespace std::placeholders;\n   \n   TcpServer::TcpServer(EventLoop *loop, const InetAddress &listenAddr,\n                        const std::string &nameArg, Option option = kNoReusePort)\n       : m_loop(CheckLoopNotNull(loop)),\n         m_IPport(listenAddr.toIPport()),\n         m_name(nameArg),\n         m_acceptor(new Acceptor(loop, listenAddr, option == kReusePort)),\n         m_threadPool(new EventLoopThreadPool(loop, m_name)),\n         m_connectionCallback(),\n         m_messageCallback(),\n         m_nextConnId(1)\n   {\n       m_acceptor->setNewConnectionCallback(std::bind(&TcpServer::newConnection,\n                                                      this, _1, _2));//connfd, peerAddr\n   }\n   ```\n\n2. newConnection - è¿è¡Œåœ¨ä¸»çº¿ç¨‹å½“ä¸­ï¼Œä¸»çº¿ç¨‹çš„mainLoopè°ƒç”¨æ­¤å‡½æ•°ï¼Œé€‰æ‹©äº†ä¸€ä¸ªioLoopï¼Œ**åœ¨éå­loopçš„çº¿ç¨‹ä¸­ï¼ˆå³å½“å‰æ˜¯åœ¨mainThreadï¼‰æ‰§è¡Œcbï¼Œå°±éœ€è¦å”¤é†’å­loopæ‰€åœ¨çº¿ç¨‹ï¼ˆsubThreadï¼‰ï¼Œæ‰§è¡Œcb**ï¼Œå³è°ƒç”¨subLoopçš„`queueInLoop(cb)`ã€‚\n\n   1. æ ¹æ®è½®è¯¢ç®—æ³•é€‰æ‹©ä¸€ä¸ªsubLoopï¼Œå³è°ƒç”¨`m_threadPool->getNextLoop()`\n   2. å”¤é†’subLoop\n   3. æŠŠå½“å‰connfdå°è£…æˆchannelåˆ†å‘ç»™subloop\n\n3. setThreadNum - è®¾ç½®åº•å±‚subLoopçš„ä¸ªæ•°\n   ```cpp\n   void TcpServer::setThreadNum(int numThreads)\n   {\n       m_threadPool->setThreadNum(numThreads);\n   }\n   ```\n\n4. start - å¼€å¯æœåŠ¡å™¨ç›‘å¬\n   ```cpp\n   void TcpServer::start()\n   {\n       //é˜²æ­¢ä¸€ä¸ªTcpServerå¯¹è±¡è¢«startå¤šæ¬¡;\n       if(m_started++ == 0)//å³ä½¿boolä¸º1ï¼Œbool++åçš„å€¼ä¹Ÿè¿˜æ˜¯1\n       {\n           m_threadPool->start(m_threadInitCallback);\n           m_loop->runInLoop(std::bind(&Acceptor::listen, m_acceptor.get()));\n       }\n   }\n   ```\n\n\n# TcpConnection\n\né¡¾åæ€ä¹‰ï¼Œæ­¤ç±»å¯¹è±¡è¡¨ç¤ºçš„æ˜¯tcpé€šä¿¡ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´æˆåŠŸå»ºç«‹çš„ä¸€æ¡è¿æ¥ã€‚ä¸»è¦å°è£…ç”¨æˆ·åœ¨æœåŠ¡ç«¯çš„æ•°æ®ã€‚\n\n1. mainLoopé€šè¿‡acceptoræ¥æ”¶åˆ°æ–°çš„è¿æ¥æ—¶ï¼Œå°†ä¼šæŠŠfdå’Œloopå°è£…åˆ°channelï¼Œç»§è€Œå°è£…åˆ°TcpConnectionä¸­ï¼Œå†é€šè¿‡è½®è¯¢ç®—æ³•äº¤ç»™subLoopã€‚\n2. æ›´é‡è¦çš„æ˜¯ï¼ŒTcpConnectionä¸­å­˜å‚¨äº†ä¸€äº›è¿æ¥äº‹ä»¶ã€è¯»å†™äº‹ä»¶å‘ç”Ÿæ—¶çš„å›è°ƒã€‚\n3. æœ€åï¼ŒTcpConnectionè¿˜è¿˜å°è£…äº†Bufferã€‚\n\n## Buffer\n\nåŸºäºéé˜»å¡IOçš„æœåŠ¡ç«¯ç¼–ç¨‹ï¼ŒBufferæ˜¯å¿…ä¸å¯å°‘çš„ã€‚æ¯”å¦‚è§£å†³TCPç²˜åŒ…é—®é¢˜ã€‚\n\n### æˆå‘˜å˜é‡\n\n1. `std::vector<char> m_buffer` - æ•°æ®æ•°ç»„ã€‚\n2. `size_t m_readerIndex` - æ•°æ®å¯è¯»çš„ä½ç½®ä¸‹æ ‡\n3. `size_t m_writerIndex` - æ•°æ®å¯å†™çš„ä½ç½®ä¸‹æ ‡\n\n```cpp\nprivate:\n    std::vector<char> m_buffer;\n    size_t m_readerIndex;\n\tsize_t m_writerIndex;\n```\n\né™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸¤ä¸ªé™æ€å¸¸é‡ã€‚\n\n1. `kCheapPrepend` - è®°å½•æ•°æ®åŒ…çš„é•¿åº¦\n2. `kInitialSize` - æ•°æ®åŒ…çš„åˆå§‹å¤§å°å€¼ã€‚\n\n```cpp\npublic:\n    static const size_t kCheapPrepend = 8;\n    static const size_t kInitialSize = 1024;\n```\n\n### æˆå‘˜å‡½æ•°\n\n1. æ„é€ /ææ„\n   ```cpp\n   public:\n       explicit Buffer(size_t initialSize = kInitialSize)\n           : m_buffer(kCheapPrepend + initialSize),\n             m_readerIndex(kCheapPrepend),\n             m_writerIndex(kCheapPrepend)\n       {\n       }\n       ~Buffer() = default;\n   ```\n\n2. readableBytesã€writableBytesã€prependableBytes\n   ```cpp\n   public:\n       size_t readableBytes() const\n       {\n           return m_writerIndex - m_readerIndex;\n       }\n       size_t writableBytes() const\n       {\n           return m_buffer.size() - m_writerIndex;\n       }\n       size_t prependableBytes() const\n       {\n           return m_readerIndex;\n       }\n   ```\n\n3. è¿”å›æŒ‡é’ˆ\n\n   1. begin - è·å–bufferå®é™…é¦–éƒ¨æŒ‡é’ˆ\n   2. peek - è¿”å›ç¼“å†²åŒºæ•°æ®åŒ…ä¸­å¯è¯»æ•°æ®èµ·å§‹ä½ç½®\n   3. beginWrite - è¿”å›å¯å†™çš„æ•°æ®èµ·å§‹ä½ç½®\n\n   ```cpp\n   private:\n       char * begin()\n       {\n           return &*m_buffer.begin();\n       }\n       const char * begin() const\n       {\n           return &*m_buffer.begin();\n       }\n   public:\n       const char * peek() const\n       {\n           return begin() + m_readerIndex;\n       }\n       char * beginWrite()\n       {\n           return begin() + m_writerIndex;\n       }\n       const char * beginWrite() const\n       {\n           return begin() + m_writerIndex;\n       }\n   ```\n\n4. `retrieve`/`retrieveAll`/`retrieveAsString`/`retrieveAllAsString` - åä¸¤ä¸ªæ˜¯æŠŠbufferä¸­çš„æ•°æ®è½¬ä¸ºstringç±»å‹ï¼Œå¤šä¸onMessageé…åˆä½¿ç”¨ï¼›å‰ä¸¤ä¸ªæ˜¯å°†`m_readerIndex`å’Œ`m_writerIndex`è°ƒæ•´ä½ç½®ã€‚\n\n   ```cpp\n   public:\n       void retrieve(size_t len)\n       {\n           if(len < readableBytes())//åªè¯»å–äº†å¯è¯»ç¼“å†²åŒºæ•°æ®çš„ä¸€éƒ¨åˆ†\n           {\n               m_readerIndex += len;\n           }\n           else\n           {\n               retrieveAll();\n           }\n       }\n       void retrieveAll()\n       {\n           m_readerIndex = m_writerIndex = kCheapPrepend;\n       }\n       std::string retrieveAsString(size_t len)\n       {\n           std::string result(peek(), len);\n           retrieve(len);\n           return result;\n       }\n       std::string retrieveAllAsString()\n       {\n           return retrieveAsString(readableBytes());\n       }\n   ```\n\n5. ensureWritableByte - ç¡®ä¿bufferå¯å†™ç©ºé—´å¤§å°è¶³å¤Ÿlenï¼Œä¸è¶³åˆ™æ‰©å®¹\n   ```cpp\n   public:\n       void ensureWritableBytes(size_t len)\n       {\n           if(writableBytes() < len)\n           {\n               makeSpace(len);\n           }\n       }\n   ```\n\n6. makeSpace - æ‰©å®¹\n   ```cpp\n   private:\n       void makeSpace(size_t len)\n       {\n           if(writableBytes()+prependableBytes()-kCheapPrepend < len)\n           {\n               m_buffer.resize(m_writerIndex + len);\n           }\n           else//move readable data to the front to make space\n           {\n               size_t readable = readableBytes();\n               //å°†m_readerIndexåˆ°m_writerIndexçš„å†…å®¹å¤åˆ¶åˆ°kCheapPrependå¤„\n               std::copy(begin() + m_readerIndex, begin() + m_writerIndex, begin() + kCheapPrepend);\n               m_readerIndex = kCheapPrepend;\n               m_writerIndex = m_readerIndex + readable;\n           }\n       }\n   ```\n\n7. append\n   ```cpp\n   public:\n       void append(const char * data, size_t len)\n       {\n           ensureWritableBytes(len);\n           std::copy(data, data+len, beginWrite());\n           m_writerIndex += len;\n       }\n   ```\n\n8. readFd - ä»fdä¸Šè¯»å–æ•°æ®\n   ```cpp\n   public:\n       ssize_t readFd(int fd, int * saveErrno);\t//åœ¨.ccæ–‡ä»¶ä¸­å®ç°\n   ```\n   \n\n### ä»£ç å®ç°\n\n1. readFd - ä»fdä¸Šè¯»å–æ•°æ®\n\n   1. Polleré»˜è®¤å·¥ä½œåœ¨LTæ¨¡å¼\n\n   2. Bufferç¼“å†²åŒºæ˜¯æœ‰å¤§å°çš„ï¼Œä½†ä»fdä¸Šè¯»æ•°æ®å´ä¸æ¸…æ¥šæ•°æ®æœ‰å¤šå°‘ã€‚\n\n   3. æ­¤å‡½æ•°ä½¿ç”¨äº†ç³»ç»Ÿè°ƒç”¨`readv`ã€‚\n\n   4. struct iovecç»“æ„ - `iov_base`æŒ‡å‘ç¼“å†²åŒºé¦–å€ï¼›`iov_len`æ˜¯ç¼“å†²åŒºçš„é•¿åº¦ã€‚ç½‘ç»œç¼–ç¨‹ä¸­å¯ä»¥ä½¿ç”¨æ­¤å·¥å…·ï¼Œåˆ›å»ºä¸€ä¸ª`struct iovec iov[2]`ï¼Œç¬¬ä¸€ä¸ªçš„`iov_base`æŒ‡å‘tcpè¿æ¥åº•å±‚çš„ç¼“å†²åŒºï¼Œç¬¬äºŒä¸ªçš„`iov_base`æŒ‡å‘é¢å¤–çš„ç¼“å†²åŒºï¼Œä»¥å¤‡ä½¿ç”¨ã€‚å¦‚æœä½¿ç”¨åˆ°é¢å¤–çš„ç¼“å†²åŒºï¼Œåœ¨readvå®Œæ¯•åï¼ŒæŠŠé¢å¤–ç¼“å†²åŒºå†…å®¹æ‹¼æ¥åˆ°tcpåº•å±‚ç¼“å†²åŒºå°¾éƒ¨å³å¯ã€‚\n      ```cpp\n      struct iovec\n      {\n          void * iov_base;\n          size_t iov_len;\n      }\n      ```\n\n   \n   ```cpp\n   #include\"buffer.h\"\n   #include<sys/uio.h>\n   ssize_t Buffer::readFd(int fd, int * savedErrno)\n   {\n       char extrabuf[65536] = {0};\t//æ ˆä¸Šå†…å­˜ç©ºé—´\n       struct iovec iov[2];\n       const size_t writable = writableBytes();//bufferåº•å±‚ç¼“å†²åŒºå‰©ä½™çš„å¯å†™ç©ºé—´å¤§å°\n       iov[0].iov_base = begin() + m_writerIndex;\n       iov[0].iov_len = writable;\n       iov[1].iov_base = extrabuf;\n       iov[1].iov_len = sizeof extrabuf;\n       const int iovcnt = (writable < sizeof extrabuf) ? 2 : 1;\n       //å¦‚æœå¯å†™ç©ºé—´å¤§å°å°‘äº64kbåˆ™å¯ä»¥æŒ‰éœ€å†™åˆ°vec[0]/vec[1];\n       //å¦‚æœå¯å†™ç©ºé—´å¤§å°å¤§äºç­‰äº64kbåˆ™åªèƒ½å†™åˆ°vec[0]ã€‚\n       //è¯´æ˜, å¯æ”¶åˆ°çš„æ•°æ®å¤§å°é™åˆ¶è‡³å°‘ä¸º64kbã€‚\n       const ssize_t n = ::readv(fd, iov, iovcnt);\n       if(n < 0)\n       {\n           *savedErrno = errno;\n       }\n       else if(n <= writable)\n       {\n           m_writerIndex += n;\n       }\n       else// n > writable, éœ€è¦æ‹¼æ¥extrabuf\n       {\n           m_writerIndex = m_buffer.size();\n           append(extrabuf, n-writable);\n       }\n       return n;\n   }\n   ```\n   \n\n## TcpConnection\n\n```cpp\nclass TcpConnection : noncopyable, public std::enable_shared_from_this<TcpConnection>\n```\n\n### æˆå‘˜å˜é‡\n\n1. `m_loop` - subLoop\n\n   ```cpp\n   private:\n       EventLoop *m_loop;\n   ```\n\n2. `m_socket`/`m_channel` - `unique_ptr`ç®¡ç†\n\n   ```cpp\n   private:\n       std::unique_ptr<Socket>  m_socket;\n       std::unique_ptr<Channel> m_channel;\n   ```\n\n3. `m_localAddr`/`m_peerAddr` - æœ¬åœ°/å¯¹ç«¯åœ°å€ä¿¡æ¯\n\n   ```cpp\n   private:\n       const InetAddress m_localAddr;\n       const InetAddress m_peerAddr;\n   ```\n\n4. `m_inputBuffer`/`m_outputBuffer` - è¯»å†™ç¼“å†²åŒº\n\n   ```cpp\n   private:\n       Buffer m_inputBuffer;\n       Buffer m_outputBuffer;\n   ```\n\n5. å„ç§æ ‡å¿—\n\n   1. `m_name`\n   2. `m_state` - atomicï¼Œç”¨æšä¸¾ç±»å˜é‡èµ‹å€¼\n   3. `m_reading`\n   4. `m_highWaterMark` - é«˜æ°´ä½é˜ˆå€¼\n\n   ```cpp\n   private:\n       const std::string m_name;\n       \n       enum StateE {kDisconnected, kConnecting, kConnected, kDisconnecting};\n       std::atomic_int m_state;\n       \n       bool m_reading;\n       \n       size_t m_highWaterMark;\n   ```\n\n6. å„ç§å›è°ƒ\n   ```cpp\n   private:\n       ConnectionCallback\t    m_connectionCallback;\n       MessageCallback\t        m_messageCallback;\n       WriteCompleteCallback   m_writeCompleteCallback;\n       HighWaterMarkCallback   m_highWaterMarkCallback;\n       CloseCallback           m_closeCallback;\n   ```\n\n\n### æˆå‘˜å‡½æ•°\n\n1. æ„é€ /ææ„\n   ```cpp\n   public:\n       TcpConnection(EventLoop *loop, const std::string& name, int sockfd,\n                     const InetAddress& localAddr, const InetAddress& peerAddr);\n       ~TcpConnection();\n   ```\n\n2. å»ºç«‹/é”€æ¯è¿æ¥\n   ```cpp\n   public:\n       void connectEstablished();\n       void connectDestoryed();\n   ```\n\n3. send - å‘é€æ•°æ®\n\n   ```cpp\n   private:\n       void send(const std::string &buf);\n       void send(const void * data, int len);\n   ```\n\n4. shutdown - å…³é—­è¿æ¥\n   ```cpp\n   public:\n       void shutdown();\n   private:\n       void shutdownInLoop();\n   ```\n   \n5. è®¾ç½®å›è°ƒ\n   ```cpp\n   public:\n       void setConnectionCallback(const ConnectionCallback & cb)\n       {\n           m_connectionCallback = cb;\n       }\n       void setMessageCallback(const MessageCallback & cb)\n       {\n           m_messageCallback = cb;\n       }\n       void setWriteCompleteCallback(const WriteCompleteCallback & cb)\n       {\n           m_writeCompleteCallback = cb;\n       }\n       void setCloseCallback(const CloseCallback &cb)\n       {\n           m_closeCallback = cb;\n       }\n       void setHighWaterMarkCallback(const HighWaterMarkCallback & cb, size_t highWaterMark)\n       {\n           m_highWaterMarkCallback = cb;\n           m_highWaterMark = highWaterMark;\n       }\n   ```\n   \n6. è®¾ç½®ã€åˆ¤æ–­æ ‡å¿—\n\n   ```cpp\n   public:\n       bool connected() const {return m_state == kConnected;}\n       void setState(StateE state) {m_state = state;}\n   ```\n\n7. è·å–å±æ€§\n\n   ```cpp\n   public:\n       EventLoop * getLoop() const {return m_loop;}\n       const std::string& name() const {return m_name;}\n       const InetAddress& localAddress() const {return m_localAddr;}\n       const InetAddress& peerAddress() const {return m_peerAddr;}\n   ```\n\n8. handleRead/handleWrite/handleClose/handleError\n   ```cpp\n   private:\n       void handleRead(Timestamp receiveTime);\n       void handleWrite();\n       void handleClose();\n       void handleError();\n   ```\n\n\n### ä»£ç å®ç°\n\n1. æ„é€ ï¼šé‡è¦å‚æ•° - loopã€sockfdã€localAddrã€peerAddr\n\n   1. ç»™loopèµ‹å€¼ï¼Œnameèµ·åå­—\n   2. èµ‹stateä¸º`kConnecting`ã€readingä¸º`true`\n   3. ä»¥sockfdä¸ºå‚æ•°æ„é€ socketï¼Œnewåèµ‹ç»™æ™ºèƒ½æŒ‡é’ˆ`m_socket`\n   4. ä»¥loopã€sockfdä¸ºå‚æ•°æ„é€ channelï¼Œnewåèµ‹ç»™æ™ºèƒ½æŒ‡é’ˆ`m_channel`\n   5. èµ‹å€¼localAddrã€peerAddr\n   6. èµ‹é«˜æ°´ä½é˜ˆå€¼`m_highWaterMark`ä¸º`64*1024*1024`(64M)\n   7. ç»™`m_channel`è®¾ç½®ç›¸åº”çš„å›è°ƒï¼Œå½“pollerç»™channelé€šçŸ¥æ„Ÿå…´è¶£çš„äº‹ä»¶å‘ç”Ÿï¼Œåˆ™channelä¼šå›è°ƒç›¸åº”çš„æ“ä½œå‡½æ•°\n   8. å¯¹`m_socket`è°ƒç”¨`setKeepAlive`ï¼Œä½¿TCPå¯åŠ¨ä¿æ´»æœºåˆ¶\n\n   ```cpp\n   /* å†™ä¸ºstaticï¼Œé˜²æ­¢å‡½æ•°åå­—å†²çª */\n   static EventLoop* CheckLoopNotNull(EventLoop* loop)\n   {\n       if(loop == nullptr)\n       {\n           LOG_FATAL(\"%s:%s:%d mainLoop is null\\n\", __FILE__, __FUNCTION__, __LINE__);\n       }\n       return loop;\n   }\n   TcpConnection::TcpConnection(EventLoop* loop, const std::string &nameArg, int sockfd,\n                                const InetAddress &localAddr, const InetAddress &peerAddr)\n       : m_loop(CheckLoopNotNull(loop)), m_name(nameArg),\n         m_state(kConnecting), m_reading(true),\n         m_socket(new Socket(sockfd)),\n         m_channel(new Channel(loop, sockfd)),\n         m_localAddr(localAddr), m_peerAddr(peerAddr),\n         m_highWaterMark(64*1024*1024) //64M\n   {\n       m_channel->setReadCallback(std::bind(&TcpConnection::handleRead, this, _1));\n       m_channel->setWriteCallback(std::bind(&TcpConnection::handleWrite, this));\n       m_channel->setCloseCallback(std::bind(&TcpConnection::handleClose, this));\n       m_channel->setErrorCallback(std::bind(&TcpConnection::handleError, this));\n       LOG_INFO(\"%s [%s] at fd = %d\\n\", __FUNCTION__, m_name.c_str(), sockfd);\n       m_socket->setKeepAlive(true);   //å¯åŠ¨TCPä¿æ´»æœºåˆ¶\n   }\n   ```\n\n2. ææ„\n   ```cpp\n   TcpConnection::~TcpConnection()\n   {\n       LOG_INFO(\"%s [%s] at fd = %d, state = %d\\n\",\n                 __FUNCTION__, m_name.c_str(), m_channel->fd(), m_state.load());\n   }\n   ```\n\n3. handleRead - è°ƒç”¨`m_inputBuffer`çš„`readFd`, è¯»å–channelä¸Šçš„æ¶ˆæ¯; å¦‚æœæœ‰æ•°æ®åˆ™è°ƒç”¨`m_messageCallback`; å¦‚æœè¿”å›å€¼ä¸º0è¯´æ˜å®¢æˆ·ç«¯æ–­å¼€, è°ƒç”¨`handleClose`; å¦‚æœå‡ºé”™åˆ™`handleError`;\n   ```cpp\n   void TcpConnection::handleRead(Timestamp receiveTime)\n   {\n       int savedErrno = 0;\n       ssize_t n = m_inputBuffer.readFd(m_channel->fd(), &savedErrno);\n       if(n > 0)\n       {\n           //å·²å»ºç«‹è¿æ¥çš„ç”¨æˆ·ï¼Œæœ‰å¯è¯»äº‹ä»¶å‘ç”Ÿäº†ï¼Œè°ƒç”¨ç”¨æˆ·ä¼ å…¥çš„å›è°ƒæ“ä½œonMessage\n           m_messageCallback(shared_from_this(), &m_inputBuffer, receiveTime);\n       }\n       else if(n == 0) //å®¢æˆ·ç«¯æ–­å¼€\n       {\n           handleClose();\n       }\n       else\n       {\n           errno = savedErrno;\n           LOG_ERROR(\"%s\\n\", __FUNCTION__);\n           handleError();\n       }\n   }\n   ```\n\n4. handleWrite - è°ƒç”¨`m_outputBuffer`çš„`writeFd`, å†™åˆ°channelä¸Šå¯¹åº”fdçš„ç¼“å†²åŒº(è°ƒç”¨`peek`, æ‰¾åˆ°ç¼“å†²åŒºæ•°æ®åŒ…ä¸­å¯è¯»æ•°æ®èµ·å§‹ä½ç½®, æŠŠä»æ­¤ä½ç½®èµ·å…±`readableBytes()`æ•°æ®å†™åˆ°fd); å¦‚æœæˆåŠŸåˆ™è°ƒç”¨`m_loop->queueInLoop(std::bind(m_writeCompleteCallback, shared_from_this()))`; æœ€å, åˆ¤æ–­è¿æ¥çš„çŠ¶æ€å¦‚æœæ˜¯`Disconnecting`åˆ™`shutdownInLoop`\n   ```cpp\n   void TcpConnection::handleWrite()\n   {\n       if(m_channel->isWriting())\n       {\n           int savedErrno = 0;\n           ssize_t n = m_outputBuffer.writeFd(m_channel->fd(), &savedErrno);\n           if(n > 0)\n           {\n               m_outputBuffer.retrieve(n);\n               if(m_outputBuffer.readableBytes() == 0)\n               {\n                   m_channel->disableWriting();\n                   if(m_writeCompleteCallback)\n                   {\n                       /* å”¤é†’loopå¯¹åº”çš„threadçº¿ç¨‹, æ‰§è¡Œå›è°ƒ */\n                       m_loop->queueInLoop(std::bind(m_writeCompleteCallback,\n                                                     shared_from_this()));\n                   }\n                   if(m_state == kDisconnecting)\n                   {\n                       shutdownInLoop();\n                   }\n               }\n           }\n           else\n           {\n               LOG_ERROR(\"%s\\n\", __FUNCTION__);\n           }\n       }\n       else\n       {\n           LOG_ERROR(\"%s: connection fd = %d is down, no more writing.\\n\",\n                      __FUNCTION__, m_channel->fd());\n       }\n   }\n   ```\n\n5. handleClose - è°ƒç”¨`setState(kDisconnected)`, `m_channel->disableAll()`, `m_connectionCallback`, `m_closeCallback`\n   ```cpp\n   void TcpConnection::handleClose()\n   {\n       LOG_INFO(\"%s: fd = %d, state: %d\\n\", __FUNCTION__, m_channel->fd(), m_state.load());\n       setState(kDisconnected);\n       m_channel->disableAll();\n   \n       TcpConnectionPtr connPtr(shared_from_this());\n       m_connectionCallback(connPtr);\n       m_closeCallback(connPtr);\n   }\n   ```\n\n6. handleError - è°ƒç”¨`getsockopt`, è°ƒæŸ¥fdçš„é”™è¯¯, å¦‚æœè¿getsockoptä¹Ÿå¤±è´¥åˆ™å­˜å‚¨å…¨å±€errno\n\n   * `int getsockopt(int sockfd, int level, int optname, void *optval, socklen_t *optlen)`: æ“ä½œå¥—æ¥å­—é€‰é¡¹æ—¶ï¼Œå¿…é¡»æŒ‡å®šé€‰é¡¹æ‰€åœ¨çš„çº§åˆ«å’Œé€‰é¡¹çš„åç§°, `SOL_SOCKET`è¡¨ç¤ºåœ¨å¥—æ¥å­—APIçº§åˆ«, å‚è§`getprotoent(3)`; å‚æ•°`optval`å’Œ`optlen`å¯¹äºgetsockopt(), æ ‡è¯†ä¸€ä¸ªç¼“å†²åŒºï¼Œè¯·æ±‚é€‰é¡¹çš„å€¼å°†åœ¨å…¶ä¸­è¿”å›ã€‚`optlen`æ˜¯ä¸€ä¸ªå€¼ç»“æœå‚æ•°ï¼Œæœ€åˆåŒ…å«`optval`æŒ‡å‘çš„ç¼“å†²åŒºçš„å¤§å°ï¼Œå¹¶åœ¨è¿”å›æ—¶ä¿®æ”¹ä»¥æŒ‡ç¤ºè¿”å›å€¼çš„å®é™…å¤§å°ã€‚ å¦‚æœä¸æä¾›æˆ–è¿”å›é€‰é¡¹å€¼ï¼Œåˆ™`optval`å¯èƒ½ä¸ºNULLã€‚\n\n   ```cpp\n   void TcpConnection::handleError()\n   {\n       int optval;\n       socklen_t optlen = sizeof optval;\n       int err = 0;\n       if(::getsockopt(m_channel->fd(), SOL_SOCKET, SO_ERROR, &optval, &optlen) < 0)\n       {\n           err = errno;\n       }\n       else\n       {\n           err = optval;\n       }\n       LOG_ERROR(\"%s name: %s - SO_ERROR: %d\\n\", __FUNCTION__, m_name.c_str(), err);\n   }\n   ```\n\n7. send - ç”¨æˆ·ä¼šç»™TcpServeræ³¨å†ŒonMessageCallback, å·²å»ºç«‹è¿æ¥çš„ç”¨æˆ·æœ‰è¯»å†™äº‹ä»¶æ—¶, å°¤å…¶æ˜¯è¯»äº‹ä»¶, onMessageä¼šå“åº”; å¤„ç†å®Œå®¢æˆ·ç«¯å‘æ¥çš„äº‹ä»¶å(onMessageCallback), æœåŠ¡ç«¯ä¼šsendç»™å®¢æˆ·ç«¯å›å‘æ¶ˆæ¯; \n\n   > åœ¨TcpConnectionçš„æˆå‘˜ä¸­, æœ‰ä¸¤ä¸ªBufferæˆå‘˜; \n   >\n   > 1. inputBuffer - æ¥æ”¶æ•°æ®çš„ç¼“å†²åŒº - å³recvæ“ä½œéœ€è¦æš‚å­˜çš„åŒºåŸŸ\n   > 2. outputBuffer - å‘é€æ•°æ®çš„ç¼“å†²åŒº - å³sendæ“ä½œéœ€è¦æš‚å­˜çš„åŒºåŸŸ\n   >\n   > å…¶ä¸­, outputBufferå­˜åœ¨çš„æ„ä¹‰?\n   >\n   > 1. åº”ç”¨å±‚å¯èƒ½éœ€è¦å¤„ç†å¾ˆå¤šæ•°æ®, æ•°æ®ä»ä¼ è¾“å±‚åˆ°ç½‘ç»œå±‚åˆ°æ•°æ®é“¾è·¯å±‚çš„ä¼ è¾“å¾€å¾€æ¯”åº”ç”¨å±‚å‘é€å¾—å¿«; éœ€è¦ç”¨ç¼“å†²åŒºæš‚å­˜; \n   > 2. ä¸ºäº†é˜²æ­¢åº”ç”¨å±‚ä¸åº•å±‚ä¼ è¾“çš„æ•°æ®é‡å·®è·æ‚¬æ®Šå¯¼è‡´æ•°æ®ä¸¢å¤±, è®¾ç½®äº†ä¸€ä¸ªé«˜æ°´ä½é˜ˆå€¼; \n\n   > æ”¶å‘æ•°æ®çš„æ–¹å¼: æœ¬é¡¹ç›®çš„æ•°æ®æ”¶å‘ç»Ÿä¸€ä½¿ç”¨jsonæˆ–protobufæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²è¿›è¡Œ, æ‰€ä»¥æ­¤sendå‡½æ•°çš„å‚æ•°ä¸ºäº†æ–¹ä¾¿èµ·è§, ç›´æ¥è§„å®šä¸ºstringç±»å‹; \n\n   1. åˆ¤æ–­å½“å‰è¿æ¥çš„çŠ¶æ€æ˜¯å¦ä¸ºconnected; \n   2. åˆ¤æ–­æ­¤loopæ˜¯å¦åœ¨æœ¬threadä¸­, å¦‚æœæ˜¯åˆ™è°ƒç”¨sendInLoop; å¦åˆ™runInLoop, ç»‘å®šçš„å‡½æ•°ä¹Ÿæ˜¯sendInLoop; \n\n   ```cpp\n   void TcpConnection::send(const std::string &buf)\n   {\n       if(m_state == kConnected)\n       {\n           if(m_loop->isInLoopThread())\n           {\n               sendInLoop(buf.c_str(), buf.size());\n           }\n           else\n           {\n               m_loop->runInLoop(std::bind(&TcpConnection::sendInLoop,\n                                 this, buf.c_str(), buf.size()));\n           }\n       }\n   }\n   ```\n\n8. sendInLoop - å†™æ•°æ®æ“ä½œ, ç»“åˆäº†sendInLoopå’ŒhandleWrite\n   ```cpp\n   void TcpConnection::sendInLoop(const void * data, size_t len)\n   {\n       ssize_t nwrote = 0;\n       size_t remaining = len;\n       bool faultError = false;\t//è®°å½•æ˜¯å¦äº§ç”Ÿé”™è¯¯\n       if(m_state == kDisconnected)\n       {\n           LOG_ERROR(\"Disconnected, give up writing!\");\n           return;\n       }\n       /** \n        * m_channel->isWriting()ä¸ºfalseè¡¨ç¤ºchannelç¬¬ä¸€æ¬¡å¼€å§‹å†™æ•°æ®, \n        * readableBytes()ä¸º0è¯´æ˜ç¼“å†²åŒºæ²¡æœ‰å¾…å‘é€æ•°æ®; \n        */\n       if(!m_channel->isWriting() && m_outputBuffer.readableBytes() == 0)\n       {\n           nwrote = ::write(m_channel->fd(), data, len);\n           if(nwrote >= 0)\n           {\n               remaining = len - nwrote;\n               if(remaining == 0 && m_writeCompleteCallback)\n               {\n                   //å¦‚æœæ­¤æ—¶æ•°æ®å…¨éƒ¨å‘é€å®Œæ¯•, ä¸ç”¨å†ç»™channelè®¾ç½®epolloutäº‹ä»¶\n                   m_loop->queueInLoop(std::bind(m_writeCompleteCallback, shared_from_this()));\n               }\n           }\n           else //nwrote < 0\n           {\n               nwrote = 0;\n               if(errno != EWOULDBLOCK)\n               {\n                   LOG_ERROR(\"%s\\n\", __FUNCTION__);\n                   if(errno == EPIPE || errno == ECONNRESET)// SIGPIPE or RESET\n                   {\n                       faultError = true;\n                   }\n               }\n           }\n       }\n       if(!faultError && remaining > 0)//æ²¡æœ‰å‡ºé”™, æ²¡æœ‰å‘é€å®Œæ¯•, å‰©ä½™æ•°æ®éœ€è¦å­˜åˆ°ç¼“å†²åŒº, ç„¶åç»™channelæ³¨å†Œepolloutäº‹ä»¶, LTæ¨¡å¼, pollerå‘ç°tcpçš„å‘é€ç¼“å†²åŒºæœ‰ç©ºé—´, ä¼šé€šçŸ¥ç›¸åº”çš„sock->channel, è°ƒç”¨writeCallbackæ–¹æ³•, å³è°ƒç”¨handleWrite, ç›´åˆ°æŠŠå‘é€ç¼“å†²åŒºä¸­æ•°æ®å…¨éƒ¨å‘é€\n       {\n           size_t oldlen = m_outputBuffer.readableBytes();\n           if(oldlen + remaining >= m_highWaterMark && oldlen < m_highWaterMark && m_highWaterMarkCallback)\n           {\n               m_loop->queueInLoop(std::bind(m_highWaterMarkCallback, shared_from_this(), oldlen+remaining));\n           }\n           m_outputBuffer.append((char*)data+nwrote, remaining);//data+nworteå³å‰©ä½™çš„ä½ç½®\n           if(!m_channel->isWriting())//m_channel->isWriting()ä¸ºfalseè¡¨ç¤ºchannelç¬¬ä¸€æ¬¡å¼€å§‹å†™æ•°æ®, ä¹‹å‰æ²¡æœ‰æ³¨å†Œepollout, ç°åœ¨éœ€è¦æ³¨å†Œ\n           {\n               m_channel->enableWriting();\n           }\n       }\n   }\n   ```\n\n9. connectEstablished\n\n   1. setStateä¸ºkConnected;\n   2. è°ƒç”¨`m_channel->tie`, è®©`m_channel`ç»‘å®šä¸€ä¸ªTcpConnection, æ–¹ä¾¿åæœŸè§‚å¯ŸTcpConnectionæ˜¯å¦è¿˜æœ‰æ•ˆ, è‹¥å·²å¤±æ•ˆå°†ä¸è¿›è¡Œç›¸åº”çš„æ“ä½œ, å·²ç„¶æ— æ„ä¹‰;\n\n   ```cpp\n   void TcpConnection::connectEstablished()\n   {\n       setState(kConnected);\n       m_channel->tie(shared_from_this());\n       m_channel->enableReading();\t//å‘polleræ³¨å†Œchannelçš„epollinäº‹ä»¶\n       //æœ‰æ–°è¿æ¥å»ºç«‹, è°ƒç”¨connectionCallback\n       m_connectionCallback(shared_from_this());\n   }\n   ```\n\n10. connectDestroyed\n\n    1. åˆ¤æ–­stateæ˜¯å¦ä¸ºconnected, è‹¥æ˜¯åˆ™setStateä¸ºkDisconnected, å¹¶è°ƒç”¨`m_channel->disableAll()`, è°ƒç”¨`connectionCallback`\n    2. æœ€å`m_channel->remove()`, æŠŠchannelä»pollerä¸­åˆ é™¤æ‰\n\n    ```cpp\n    void TcpConnection::connectDestoryed()\n    {\n        if(m_state == kConnected)\n        {\n            setState(kDisconnected);\n            m_channel->disableAll();\n            m_connectionCallback(shared_from_this());\n        }\n        m_channel->remove();\n    }\n    ```\n\n11. shutdown/shutdownInLoop\n\n    * å…³é—­å†™ç«¯, å°†ä¼šè§¦å‘epollhup, è°ƒç”¨closeCallback, å³TcpConnectionä¸­çš„handleCloseæ–¹æ³•,\n      1. setState(kDisconnected)\n      2. m_channel->disableAll()\n      3. connectionCallback, closeCallback\n\n    ```cpp\n    void TcpConnection::shutdown()\n    {\n        if(m_state == kConnected)\n        {\n            setState(kDisconnecting);\n            m_loop->runInLoop(std::bind(&TcpConnection::shutdownInLoop, this));\n        }\n    }\n    /**\n     * å…³é—­å†™ç«¯, å°†ä¼šè§¦å‘epollhup, \n     * ä¼šè°ƒç”¨closeCallback, \n     * å³TcpConnectionä¸­çš„handleCloseæ–¹æ³•,\n     * handleCloseå°†ä¼š: \n     *  1. setState(kDisconnected);\n     *  2. m_channel->disableAll();\n     *  3. connectionCallback, closeCallback\n     */\n    void TcpConnection::shutdownInLoop()\n    {\n        if(!m_channel->isWriting())//è¯´æ˜outputBufferä¸­çš„æ•°æ®å·²ç»å…¨éƒ¨å‘é€å®Œæˆ\n        {\n            m_socket->shutdownWrite();//å…³é—­å†™ç«¯, å°†ä¼šè§¦å‘epollhup, ä¼šè°ƒç”¨closeCallback, å³TcpConnectionä¸­çš„handleCloseæ–¹æ³•\n        }\n    }\n    ```\n\n# TcpServeræ”¶å°¾\n\n1. newConnection - è¿è¡Œåœ¨ä¸»çº¿ç¨‹å½“ä¸­ï¼Œä¸»çº¿ç¨‹çš„mainLoopè°ƒç”¨æ­¤å‡½æ•°ï¼Œé€‰æ‹©äº†ä¸€ä¸ªioLoopï¼Œ**åœ¨éå­loopçš„çº¿ç¨‹ä¸­ï¼ˆå³å½“å‰æ˜¯åœ¨mainThreadï¼‰æ‰§è¡Œcbï¼Œå°±éœ€è¦å”¤é†’å­loopæ‰€åœ¨çº¿ç¨‹ï¼ˆsubThreadï¼‰ï¼Œæ‰§è¡Œcb**ï¼Œå³è°ƒç”¨subLoopçš„`queueInLoop(cb)`ã€‚\n\n   1. æ ¹æ®è½®è¯¢ç®—æ³•é€‰æ‹©ä¸€ä¸ªsubLoopï¼Œå³è°ƒç”¨`m_threadPool->getNextLoop()`\n   2. å”¤é†’subLoop\n   3. æŠŠå½“å‰connfdå°è£…æˆchannelåˆ†å‘ç»™subloop\n\n   ```cpp\n   void TcpServer::newConnection(int sockfd, const InetAddress &peerAddr)\n   {\n       EventLoop *ioLoop = m_threadPool->getNextLoop();\n       char buf[64] = {0};\n       snprintf(buf, sizeof buf, \"-%s#%d\", m_IPport.c_str(), m_nextConnId)\n   }\n   ```\n\n2. removeConnection/removeConnectionInLoop\n   ```cpp\n   void TcpServer::removeConnection(const TcpConnectionPtr &conn)\n   {\n       m_loop->runInLoop(std::bind(&TcpServer::removeConnectionInLoop, this, conn));\n   }\n   void TcpServer::removeConnectionInLoop(const TcpConnectionPtr &conn)\n   {\n       LOG_INFO(\"%s [%s] - connection %s\\n\",\n                __FUNCTION__, m_name.c_str(), conn->name().c_str());\n       m_connections.erase(conn->name());\n       EventLoop *ioLoop = conn->getLoop();\n       ioLoop->queueInLoop(std::bind(&TcpConnection::connectDestoryed, conn));\n   }\n   ```\n\n\n# æµç¨‹\n\n1. TcpServer -> Acceptor -> æœ‰ä¸€ä¸ªæ–°ç”¨æˆ·è¿æ¥ï¼Œé€šè¿‡acceptå‡½æ•°å¾—åˆ°connfd\n2. ç”¨æˆ·ç»™TcpServerè®¾ç½®å›è°ƒ -> TcpServerç»™TcpConnectionè®¾ç½®å›è°ƒ -> TcpConnectionæŠŠå›è°ƒä¼ ç»™Channel -> Channelæ³¨å†Œåˆ°Pollerä¸­ -> Polleré€šçŸ¥Channelè°ƒç”¨å›è°ƒ\n3. mainLoopä¸­çš„acceptoræ˜¯ä¸€ä¸ªç‰¹æ®Šçš„socketfd, å®ƒåªæœ‰ä¸€ä¸ªå›è°ƒ`ReadCallback`, è´Ÿè´£ç›‘å¬æ–°ç”¨æˆ·çš„è¿æ¥, è¿”å›socket, å°†è¿™ä¸ªsocketæ‰“åŒ…æˆTcpConnection, å†æ³¨å†Œç›¸åº”çš„å›è°ƒ; \n","categories":["é¡¹ç›®","muduo"]},{"title":"CAS_åŸå­æ“ä½œ","url":"/å¤šçº¿ç¨‹/CAS_åŸå­æ“ä½œ/","content":"# å†…å®¹\n\n1. CASåŸç†\n2. åŸå­æ“ä½œ\n3. æ ˆ\n4. æ±‡ç¼–å±‚é¢\n# CAS\n\nCAS(compare And Swap)ä¹Ÿå«æ¯”è¾ƒäº¤æ¢ï¼Œæ˜¯ä¸€ç§æ— é”åŸå­ç®—æ³•ï¼Œæ˜ å°„åˆ°æ“ä½œç³»ç»Ÿå°±æ˜¯ä¸€æ¡cmpxchgç¡¬ä»¶æ±‡ç¼–æŒ‡ä»¤(**ä¿è¯åŸå­æ€§**)ï¼Œå…¶ä½œç”¨æ˜¯è®©CPUå°†å†…å­˜å€¼æ›´æ–°ä¸ºæ–°å€¼ï¼Œä½†æ˜¯æœ‰ä¸ªæ¡ä»¶ï¼Œå†…å­˜å€¼å¿…é¡»ä¸æœŸæœ›å€¼ç›¸åŒï¼Œå¹¶ä¸”CASæ“ä½œ**æ— éœ€ç”¨æˆ·æ€ä¸å†…æ ¸æ€åˆ‡æ¢ï¼Œç›´æ¥åœ¨ç”¨æˆ·æ€å¯¹å†…å­˜è¿›è¡Œè¯»å†™**æ“ä½œ(æ„å‘³ç€ä¸ä¼šé˜»å¡/çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢)ã€‚\n\nå®ƒåŒ…å«3ä¸ªå‚æ•°CAS(Vï¼ŒEï¼ŒN) ï¼Œ**Vè¡¨ç¤ºå¾…æ›´æ–°çš„å†…å­˜å€¼ï¼ŒEè¡¨ç¤ºé¢„æœŸå€¼**ï¼ŒNè¡¨ç¤ºæ–°å€¼ï¼Œå½“Vå€¼ç­‰äºEå€¼æ—¶ï¼Œæ‰ä¼šå°†Vå€¼æ›´æ–°æˆNå€¼ï¼Œå¦‚æœVå€¼å’ŒEå€¼ä¸ç­‰ï¼Œä¸åšæ›´æ–°ï¼Œè¿™å°±æ˜¯ä¸€æ¬¡CASçš„æ“ä½œã€‚\n\n![image-20220527162619434](../../images/åŸå­æ“ä½œ/image-20220527162619434.png)\n\n# é“¾æ ˆ\n\n```cpp\n#include<mutex>\n#include<thread>\ntemplate<class T>\nclass Stack\n{\nprivate:\nstruct StackNode\n{\n\tT data;\n\tStackNode* next;\n};\nStackNode* Buynode()\n{\n\tStackNode* s = (StackNode*)malloc(sizeof(StackNode));\n\tif (NULL == s)exit(1);\n\tmemset(s, 0, sizeof(StackNode));\n\treturn s;\n}\nvoid Freenode(StackNode* pnode)\n{\n\tfree(pnode);\n}\nprivate:\n\tStackNode* base;\n\tsize_t cursize;\n\t//mutable std::mutex mtx;\n\tmutable std::recursive_mutex mtx;\n\tStack(const Stack&) = delete;\n\tStack& operator=(const Stack&) = delete;\npublic:\n\tStack()\n\t\t:base(nullptr), cursize(0)\n\t{\n\n\t}\n\t~Stack()\n\t{\n\t\tclear();\n\t}\n\tvoid clear()\n\t{\n\t\tstd::lock_guard<std::recursive_mutex> locker(mtx);\n\t\twhile (base != nullptr)\n\t\t{\n\t\t\tStackNode* q = base;\n\t\t\tbase = q->next;\n\t\t\t(&(q->data))->~T();\n\t\t\tFreenode(q);\n\t\t\tcursize -= 1;\n\t\t}\n\t}\n\tvoid push(const T& x)\n\t{\n\t\tstd::lock_guard<std::recursive_mutex> locker(mtx);\n\t\tStackNode* s = Buynode();\n\t\tnew(&(s->data)) T(x);\t//å®šä½newæ„é€ å¯¹è±¡\n\t\ts->next = base;\n\t\tbase = s;\n\t\tcursize += 1;\n\t}\n\tconst T& top() const\n\t{\n\t\tstd::lock_guard<std::recursive_mutex> locker(mtx);\n\t\treturn base->data;\n\t}\n\tT& top()\n\t{\n\t\tstd::lock_guard<std::recursive_mutex> locker(mtx);\n\t\treturn base->data;\n\t}\n\tvoid pop()\n\t{\n\t\tstd::lock_guard<std::recursive_mutex> locker(mtx);\n\t\tif (base != nullptr)\n\t\t{\n\t\t\tStackNode* q = base;\n\t\t\tbase = q->next;\n\t\t\t(&(q->data))->~T();\t//å®šä½ææ„\n\t\t\tFreenode(q);\n\t\t\tcursize -= 1;\n\t\t}\n\t}\npublic:\n\tsize_t get_size() const\n\t{\n\t\tstd::lock_guard<std::recursive_mutex> locker(mtx);\n\t\treturn cursize;\n\t}\n\tbool is_empty() const\n\t{\n\t\tstd::lock_guard<std::recursive_mutex> locker(mtx);\n\t\treturn get_size() == 0;\n\t}\n};\n#define _TEST1\n#ifdef _TEST1\n#include<iostream>\n#include<thread>\nvoid thread_funa(Stack<int>& s)\n{\n\tfor (int i = 1; i <= 10; i += 2)\n\t{\n\t\tstd::cout << i << std::endl;\n\t\ts.push(i);\n\t}\n}\nvoid thread_funb(Stack<int>& s)\n{\n\tfor (int i = 2; i <= 10; i += 2)\n\t{\n\t\tstd::cout << i << std::endl;\n\t\ts.push(i);\n\t}\n}\nint main()\n{\n\tStack<int> ist;\n\tstd::thread tha(thread_funa, std::ref(ist));\n\tstd::thread thb(thread_funb, std::ref(ist));\n\n\ttha.join();\n\tthb.join();\n\tstd::cout << \"push over.\" << std::endl;\n\twhile (!ist.is_empty())\n\t{\n\t\tint val = ist.top();\n\t\tstd::cout << val << std::endl;\n\t\tist.pop();\n\t}\n}\n#endif\n```\n\nç»“æœ\n\n```\n12\n\n43\n\n65\n\n87\n\n109\n\npush over.\n9\n10\n7\n8\n5\n6\n3\n4\n1\n2\n```\n\n# æ ‡å‡†åº“åŸå­æ“ä½œAPI\n\n## æ„é€ å‡½æ•°\n\nåŸå‹ï¼š`std::atomic<T>::atomic`\n\n```cpp\natomic() noexcept = default;\nconstexpr atomic() = noexcept(std::is_nothrow_default_constructible_v<T>);\nconstexpr atomic(T desired) noexcept;\natomic(const atomic&) = delete;\n```\n\næœ‰é»˜è®¤æ— å‚æ„é€ ï¼›æ‹·è´æ„é€ åˆ é™¤ã€‚\n\n## operator=\n\n```cpp\nT operator=(T desired) noexcept;\nT operator=(T desired) volatile noexcept;\natomic& operator=(const atomic&) = delete;\natomic& operator=(const atomic&) volatile = delete;\n```\n\nä¸¤ä¸ªåŸå­å¯¹è±¡ä¹‹é—´ä¸å¯ç›¸äº’èµ‹å€¼ã€‚\n\n### ä»£ç ç¤ºä¾‹\n\n```cpp\n#include<atomic>\nint main()\n{\n    atomic<int> iat;\n    atomic<int> iat2;\n    //iat = iat2; //error\n    iat = 10;\n}\n```\n\n## load\n\nåŸå­åœ°åŠ è½½å¹¶è¿”å›åŸå­å¯¹è±¡çš„å½“å‰å€¼ã€‚å®‰è£…orderçš„å€¼å½±å“å†…å­˜ã€‚\n\n```cpp\nT load(std::memory_order order = std::memory_order_seq_cst) const noexcept;\nT load(std::memory_order order = std::memory_order_seq_cst) const volatile noexcept;\nå‚æ•°ï¼š\n    order\t- å¼ºåˆ¶çš„å†…å­˜é¡ºæ•°\nè¿”å›å€¼ï¼š\n    åŸå­å˜é‡çš„å½“å‰å€¼\n```\n\n\n\n```cpp\n#include<atomic>\nint main()\n{\n    atomic<int> iat;\n    atomic<int> iat2;\n    iat = 10;\n    int val = iat.load();\n}\n```\n\nå­˜åœ¨çš„é—®é¢˜ï¼š\n\nè¯­ä¹‰æ˜¯è·å–åŸå­å¯¹è±¡çš„å€¼æ²¡é”™ï¼Œä½†æ˜¯è·å–çš„æ­¤å€¼åªä½œä¸ºå½“æ—¶çš„ç¬æ—¶å€¼ã€‚\n\nåœ¨å¤šçº¿ç¨‹ä¸­ï¼Œå¯èƒ½è·å¾—çš„æ˜¯è„æ•°æ®ã€‚\n\n## compare_exchange\n\næœ‰ä¸¤ä¸ªå‡½æ•°ã€‚`compare_exchange_weak`ã€`compare_exchange_strong`ã€‚\n\nåŸå­åœ°æ¯”è¾ƒåŸå­å¯¹è±¡ä¸çš„éåŸå­å‚æ•°çš„å€¼ï¼Œè‹¥ç›¸ç­‰è¿›è¡Œäº¤æ¢ï¼Œè‹¥ä¸ç›¸ç­‰åˆ™è¿›è¡ŒåŠ è½½ã€‚\n\n```cpp\nbool compare_exchange_weak(T & expected, T desired, std::memory_order order = std::memory_order_seq_cst) noexcept;\nå‚æ•°ï¼š\n\texpected - åˆ°æœŸå¾…åœ¨åŸå­å¯¹è±¡ä¸­æ‰¾åˆ°çš„å€¼çš„å¼•ç”¨ã€‚è‹¥æ¯”è¾ƒå¤±è´¥åˆ™è¢«å­˜å‚¨*thisçš„å®é™…å€¼ã€‚\n\tdesired  - è‹¥ç¬¦åˆæœŸå¾…åˆ™å­˜å‚¨äºåŸå­å¯¹è±¡çš„å€¼\n\tsuccess  - è‹¥æ¯”è¾ƒæˆåŠŸ,åˆ™è¯»ä¿®æ”¹å†™æ“ä½œæ‰€ç”¨çš„å†…å­˜åŒæ­¥é¡ºåºã€‚å®¹è®¸æ‰€æœ‰å€¼ã€‚\n\tfailure  - è‹¥æ¯”è¾ƒå¤±è´¥,åˆ™åŠ è½½æ“ä½œæ‰€ç”¨çš„å†…å­˜åŒæ­¥é¡ºåºã€‚ä¸èƒ½ä¸ºstd::memory_order_releaseæˆ–std::memory_order_acq_relï¼Œä¸”ä¸èƒ½æŒ‡å®šå¼ºäºsuccess çš„é¡ºåº(C++17å‰)\n    order \t - ä¸¤ä¸ªæ“ä½œæ‰€ç”¨çš„å†…å­˜åŒæ­¥é¡ºåº\nè¿”å›å€¼ï¼š\n\tè‹¥æˆåŠŸæ›´æ”¹åº•å±‚åŸå­å€¼åˆ™ä¸ºtrueï¼Œå¦åˆ™ä¸ºfalse\n```\n\nåŸå­åœ°æ¯”è¾ƒ`*this`åŸå­å¯¹è±¡ä¸`expected`çš„`å¯¹è±¡è¡¨ç¤º(C++20å‰) | å€¼è¡¨ç¤º(C++20èµ·)`ï¼Œè€Œè‹¥å®ƒä»¬é€ä½ç›¸ç­‰åˆ™ä»¥`desired`æ›¿æ¢å‰è€…ï¼ˆè¿›è¡Œè¯»ä¿®æ”¹å†™æ“ä½œï¼‰ã€‚å¦åˆ™ï¼Œå°†`*this`ä¸­çš„å®é™…å€¼åŠ è½½è¿›`expected`ï¼ˆè¿›è¡ŒåŠ è½½æ“ä½œï¼‰ã€‚\n\nè¯»ä¿®æ”¹å†™å’ŒåŠ è½½æ“ä½œçš„å†…å­˜æ¨¡å‹åˆ†åˆ«ä¸º`success`å’Œ`failure`ã€‚åœ¨ä¸Šé¢è¿™ä¸ªå‡½æ•°ä¸­ï¼Œorderç”¨äºè¯»ä¿®æ”¹å†™æ“ä½œå’ŒåŠ è½½æ“ä½œï¼Œé™¤äº†è‹¥`order == std::memory_order_acq_rel`æˆ–`order== std::memory_order_release`ï¼Œåˆ™åŠ è½½æ“ä½œåˆ†åˆ«ä½¿ç”¨`std::memory_order_acquire`å’Œ`std::memory_order_relaxed`ã€‚\n\n# æ”¹å†™é“¾æ ˆ\n\n```cpp\n#include<mutex>\n#include<thread>\ntemplate<class T>\nclass Stack\n{\nprivate:\nstruct StackNode\n{\n\tT data;\n\tStackNode* next;\n};\nStackNode* Buynode()\n{\n\tStackNode* s = (StackNode*)malloc(sizeof(StackNode));\n\tif (NULL == s)exit(1);\n\tmemset(s, 0, sizeof(StackNode));\n\treturn s;\n}\nvoid Freenode(StackNode* pnode)\n{\n\tfree(pnode);\n}\nprivate:\n\tmutable std::atomic<StackNode*> pHead;\n\tStack(const Stack&) = delete;\n\tStack& operator=(const Stack&) = delete;\npublic:\n\tStack()\n\t\t:pHead(nullptr)\n\t{\n\n\t}\n\t~Stack()\n\t{\n\t\t\n\t}\n    void push(const T& val)\n    {\n        StackNode * newnode = Buynode();\n        new(&(newnode->data)) T(val);\n        newnode->next = pHead;\n        pHead = newnode;\n    }\n};\nint main()\n{\n    Stack<int> ist;\n    \n}\n```\n\nå¯¹`newnode->next = pHead; pHead = newnode;`è¿›è¡ŒåŸå­åŒ–ã€‚\nå³è½¬ä¸ºï¼š`while(!pHead.compare_exchange_weak(newnode->next, newnode));`\n\n```cpp\n    void push(const T& val)\n    {\n        StackNode * newnode = Buynode();\n        new(&(newnode->data)) T(val);\n        \n        newnode->next = pHead.load();\n        while(!pHead.compare_exchange_weak(newnode->next, newnode));\n    }\n```\n\nåˆ¤æ–­`pHead`æ˜¯å¦ç­‰äº`newnode->next`ï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™æŠŠ`newnode`èµ‹å€¼ç»™`pHead`ã€‚\n","categories":["æ“ä½œç³»ç»Ÿ","å¤šçº¿ç¨‹","Cpp","Modern"]},{"title":"Linuxçº¿ç¨‹è°ƒåº¦ç­–ç•¥","url":"/å¤šçº¿ç¨‹/Linuxçº¿ç¨‹è°ƒåº¦ç­–ç•¥/","content":"# å†…å®¹\n\n1. å…ˆæ¥å…ˆæœåŠ¡ï¼ˆFIFOï¼‰è°ƒåº¦ç­–ç•¥\n2. æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç­–ç•¥\n3. åˆ†æ—¶è°ƒåº¦ç­–ç•¥\n# Linuxå†…æ ¸çº¿ç¨‹çš„ä¸‰ç§è°ƒåº¦ç­–ç•¥\n\nå‡½æ•°`pthread_attr_setschedpolicy`å’Œ`pthread_attr_getschedpolicy`åˆ†åˆ«ç”¨æ¥è®¾ç½®ã€è·å–çº¿ç¨‹çš„è°ƒåº¦ç­–ç•¥ã€‚\n\n```c\nint pthread_attr_setschedpolicy(pthread_attr_t *, int policy);\nint pthread_attr_getschedpolicy(const pthread_attr_t *, int policy);\nå‚æ•°ï¼š\n    attr \t- çº¿ç¨‹å±æ€§å˜é‡\n    policy\t- è°ƒåº¦ç­–ç•¥\nè¿”å›å€¼\n    æˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›-1\n```\n\n1. `SCHED_OTHER`ï¼šåˆ†æ—¶è°ƒåº¦ç­–ç•¥ï¼Œéå®æ—¶ã€‚ä¸æ”¯æŒä¼˜å…ˆçº§ã€‚\n2. `SCHED_FIFO`ï¼šå…ˆåˆ°å…ˆæœåŠ¡ï¼Œå®æ—¶ã€‚ä¸€æ—¦å ç”¨cpuåˆ™ä¸€ç›´è¿è¡Œã€‚ç›´åˆ°æœ‰æ›´é«˜ä¼˜å…ˆçº§ä»»åŠ¡æˆ–ä¸»åŠ¨æ”¾å¼ƒcpuã€‚\n3. `SCHED_RR`ï¼šæ—¶é—´ç‰‡è½®è½¬ï¼Œå®æ—¶ã€‚å½“è¿›ç¨‹çš„æ—¶é—´ç‰‡ç”¨å®Œï¼Œé‡æ–°åˆ†é…æ—¶é—´ç‰‡é•¿åº¦ï¼Œç½®äºå°±ç»ªé˜Ÿåˆ—å°¾ã€‚å¯ä»¥çœ‹ä½œæ˜¯FIFOçš„å»¶ä¼¸ã€‚\n\n# å…ˆåˆ°å…ˆæœåŠ¡ç­–ç•¥\n\n1. åˆ›å»ºè¿›ç¨‹æ—¶æŒ‡å®šé‡‡ç”¨FIFOï¼Œå¹¶è®¾ç½®**å®æ—¶ä¼˜å…ˆçº§**`rt_priority`(1-99)ã€‚\n2. å¦‚æœæ²¡æœ‰ç­‰å¾…èµ„æºï¼Œåˆ™å°†è¯¥ä»»åŠ¡åŠ å…¥åˆ°å°±ç»ªé˜Ÿåˆ—ä¸­ã€‚\n3. è°ƒåº¦ç¨‹åºéå†å°±ç»ªé˜Ÿåˆ—ï¼Œæ ¹æ®**å®æ—¶ä¼˜å…ˆçº§**è®¡ç®—è°ƒåº¦æƒå€¼(`1000+rt_priority`)ï¼Œé€‰æ‹©æƒå€¼æœ€é«˜çš„ä»»åŠ¡ä½¿ç”¨cpuï¼Œ**è¯¥FIFOä»»åŠ¡å°†ä¸€ç›´å æœ‰cpuç›´åˆ°æœ‰ä¼˜å…ˆçº§æ›´é«˜çš„ä»»åŠ¡å°±ç»ª**(å³ä½¿ä¼˜å…ˆçº§ç›¸åŒä¹Ÿä¸è¡Œ)**æˆ–è€…ä¸»åŠ¨æ”¾å¼ƒ(ç­‰å¾…èµ„æº)**ã€‚\n4. è°ƒåº¦ç¨‹åºå‘ç°æœ‰ä¼˜å…ˆçº§æ›´é«˜çš„ä»»åŠ¡åˆ°è¾¾(é«˜ä¼˜å…ˆçº§ä»»åŠ¡å¯èƒ½è¢«ä¸­æ–­æˆ–å®šæ—¶å™¨ä»»åŠ¡å”¤é†’ï¼Œå†æˆ–è¢«å½“å‰è¿è¡Œçš„ä»»åŠ¡å”¤é†’ç­‰ç­‰)ï¼Œåˆ™è°ƒåº¦ç¨‹åºç«‹å³åœ¨å½“å‰ä»»åŠ¡å †æ ˆä¸­ä¿å­˜å½“å‰cpuå¯„å­˜å™¨çš„æ‰€æœ‰æ•°æ®ï¼Œé‡æ–°ä»é«˜ä¼˜å…ˆçº§ä»»åŠ¡çš„å †æ ˆä¸­åŠ è½½å¯„å­˜å™¨æ•°æ®åˆ°cpuï¼Œæ­¤æ—¶é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡å¼€å§‹è¿è¡Œã€‚é‡å¤ç¬¬3æ­¥ã€‚\n5. å¦‚æœå½“å‰ä»»åŠ¡å› ç­‰å¾…èµ„æºè€Œä¸»åŠ¨æ”¾å¼ƒcpuä½¿ç”¨æƒï¼Œåˆ™è¯¥ä»»åŠ¡å°†ä»å°±ç»ªé˜Ÿåˆ—ä¸­åˆ é™¤ï¼ŒåŠ å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œæ­¤æ—¶é‡å¤ç¬¬3æ­¥ã€‚\n\n# æ—¶é—´ç‰‡è½®è½¬ç­–ç•¥\n\næ‰€æœ‰ä»»åŠ¡éƒ½é‡‡ç”¨RRè°ƒåº¦ç­–ç•¥æ—¶ï¼š\n\n1. åˆ›å»ºä»»åŠ¡æ—¶æŒ‡å®šè°ƒåº¦å‚æ•°ä¸ºRRï¼Œå¹¶è®¾ç½®ä»»åŠ¡çš„**å®æ—¶ä¼˜å…ˆçº§**å’Œ**niceå€¼**(niceå€¼å°†ä¼šè½¬æ¢ä¸ºè¯¥ä»»åŠ¡çš„æ—¶é—´ç‰‡çš„é•¿åº¦)ã€‚\n\n   > å¯è§ï¼Œç›¸æ¯”äºFIFOï¼Œæ—¶é—´ç‰‡è½®è½¬æ³•å¤šäº†ä¸€ä¸ªniceå€¼ï¼Œç”¨äºè®¡ç®—æ—¶é—´ç‰‡é•¿åº¦ã€‚\n\n2. å¦‚æœæ²¡æœ‰ç­‰å¾…èµ„æºï¼Œåˆ™å°†è¯¥ä»»åŠ¡åŠ å…¥åˆ°å°±ç»ªé˜Ÿåˆ—ä¸­ã€‚\n\n3. è°ƒåº¦ç¨‹åºéå†å°±ç»ªé˜Ÿåˆ—ï¼Œæ ¹æ®**å®æ—¶ä¼˜å…ˆçº§**è®¡ç®—è°ƒåº¦æƒå€¼(`1000+rt_priority`)ï¼Œ**é€‰æ‹©æƒå€¼æœ€é«˜**çš„ä»»åŠ¡ä½¿ç”¨cpuã€‚\n\n   > ç›¸æ¯”äºFIFOï¼ŒFIFOä¼šä¸€ç›´å ç”¨CPUï¼Œç›´åˆ°æ›´é«˜ä¼˜å…ˆçº§çº¿ç¨‹åˆ°è¾¾ã€‚\n\n4. å¦‚æœå°±ç»ªé˜Ÿåˆ—ä¸­çš„RRä»»åŠ¡**æ—¶é—´ç‰‡ä¸º0ï¼Œåˆ™ä¼šæ ¹æ®niceå€¼è®¾ç½®è¯¥ä»»åŠ¡çš„æ—¶é—´ç‰‡ï¼ŒåŒæ—¶å°†è¯¥ä»»åŠ¡æ”¾å…¥å°±ç»ªé˜Ÿåˆ—çš„æœ«å°¾**ã€‚é‡å¤æ­¥éª¤3ã€‚\n\n5. å½“å‰ä»»åŠ¡ç”±äºç­‰å¾…èµ„æºè€Œä¸»åŠ¨é€€å‡ºcpuï¼Œåˆ™å…¶åŠ å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚é‡å¤æ­¥éª¤3ã€‚\n\n# åˆ†æ—¶è°ƒåº¦ç­–ç•¥\n\næ‰€æœ‰ä»»åŠ¡éƒ½é‡‡ç”¨Linuxåˆ†æ—¶è°ƒåº¦ç­–ç•¥æ—¶ï¼š\n\n1. åˆ›å»ºä»»åŠ¡æŒ‡å®šé‡‡ç”¨åˆ†æ—¶è°ƒåº¦ç­–ç•¥ï¼Œå¹¶æŒ‡å®šniceå€¼(`-20~19`, å¯ä»¥è®¤ä¸ºå€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜)ã€‚\n\n   > ç›¸æ¯”äºFIFOï¼Œæ²¡æœ‰**å®æ—¶ä¼˜å…ˆçº§**æ•°å€¼å±æ€§(1~99)\n\n2. å°†**æ ¹æ®æ¯ä¸ªä»»åŠ¡çš„niceå€¼ç¡®å®šåœ¨cpuä¸Šçš„æ‰§è¡Œæ—¶é—´**(counter)ã€‚\n\n3. å¦‚æœæ²¡æœ‰ç­‰å¾…èµ„æºï¼Œåˆ™å°†è¯¥ä»»åŠ¡**åŠ å…¥åˆ°å°±ç»ªé˜Ÿåˆ—**ä¸­ã€‚\n\n4. è°ƒåº¦ç¨‹åº**éå†å°±ç»ªé˜Ÿåˆ—**ä¸­çš„ä»»åŠ¡ï¼Œé€šè¿‡å¯¹æ¯ä¸ªä»»åŠ¡åŠ¨æ€ä¼˜å…ˆçº§çš„è®¡ç®—æƒå€¼(`counter+20-nice`)ç»“æœï¼Œé€‰æ‹©è®¡ç®—ç»“æœæœ€å¤§çš„ä¸€ä¸ªå»è¿è¡Œï¼Œå½“è¿™ä¸ªæ—¶é—´ç‰‡ç”¨å®Œå(`counterå‡è‡³0`)æˆ–è€…ä¸»åŠ¨æ”¾å¼ƒcpuæ—¶ï¼Œè¯¥ä»»åŠ¡å°†è¢«æ”¾åœ¨å°±ç»ªé˜Ÿåˆ—æœ«å°¾(æ—¶é—´ç‰‡ç”¨å®Œ)æˆ–ç­‰å¾…é˜Ÿåˆ—(å› ç­‰å¾…èµ„æºè€Œæ”¾å¼ƒcpu)ä¸­ã€‚\n\n5. æ­¤æ—¶è°ƒåº¦ç¨‹åºé‡å¤ä¸Šé¢è®¡ç®—è¿‡ç¨‹ï¼Œè½¬åˆ°ç¬¬4æ­¥ã€‚\n\n6. å½“è°ƒåº¦ç¨‹åºå‘ç°æ‰€æœ‰å°±ç»ªä»»åŠ¡è®¡ç®—æ‰€å¾—çš„æƒå€¼éƒ½`ä¸å¤§äº0æ—¶`ï¼Œé‡å¤ç¬¬2æ­¥ã€‚\n\n# åŒºåˆ«\n\nç³»ç»Ÿä¸­æ—¢æœ‰åˆ†æ—¶è°ƒåº¦ï¼Œåˆæœ‰æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦å’Œå…ˆè¿›å…ˆå‡ºè°ƒåº¦ï¼š\n\n1. RRè°ƒåº¦å’ŒFIFOè°ƒåº¦çš„è¿›ç¨‹å±äºå®æ—¶è¿›ç¨‹ï¼Œä»¥åˆ†æ—¶è°ƒåº¦çš„è¿›ç¨‹æ˜¯éå®æ—¶è¿›ç¨‹ã€‚\n2. å½“å®æ—¶è¿›ç¨‹å‡†å¤‡å°±ç»ªåï¼Œå¦‚æœå½“å‰cpuæ­£åœ¨è¿è¡Œéå®æ—¶è¿›ç¨‹ï¼Œåˆ™å®æ—¶è¿›ç¨‹ç«‹å³æŠ¢å éå®æ—¶è¿›ç¨‹ã€‚\n3. RRè¿›ç¨‹å’ŒFIFOè¿›ç¨‹**éƒ½é‡‡ç”¨å®æ—¶ä¼˜å…ˆçº§**åšä¸ºè°ƒåº¦çš„**æƒå€¼æ ‡å‡†**ï¼ŒRRæ˜¯FIFOçš„ä¸€ä¸ªå»¶ä¼¸ã€‚\n4. FIFOæ—¶ï¼Œå¦‚æœä¸¤ä¸ªè¿›ç¨‹çš„ä¼˜å…ˆçº§ä¸€æ ·ï¼Œåˆ™è¿™ä¸¤ä¸ªä¼˜å…ˆçº§ä¸€æ ·çš„è¿›ç¨‹å…·ä½“æ‰§è¡Œå“ªä¸€ä¸ªæ˜¯ç”±å…¶åœ¨é˜Ÿåˆ—ä¸­çš„æœªçŸ¥å†³å®šçš„ï¼Œè¿™æ ·å¯¼è‡´ä¸€äº›ä¸å…¬æ­£æ€§ï¼ˆä¼˜å…ˆçº§æ˜¯ä¸€æ ·çš„ï¼Œä¸ºä»€ä¹ˆè¦è®©ä½ ä¸€ç›´è¿è¡Œï¼Ÿï¼‰ï¼Œå¦‚æœå°†ä¸¤ä¸ªä¼˜å…ˆçº§ä¸€æ ·çš„ä»»åŠ¡çš„è°ƒåº¦ç­–ç•¥éƒ½è®¾ä¸ºRRï¼Œåˆ™ä¿è¯äº†è¿™ä¸¤ä¸ªä»»åŠ¡å¯ä»¥å¾ªç¯æ‰§è¡Œï¼Œä¿è¯äº†å…¬å¹³ã€‚","categories":["æ“ä½œç³»ç»Ÿ","å¤šçº¿ç¨‹","Linux"]},{"title":"Linux_IOå¤ç”¨_epoll","url":"/Linux/Linux_IOå¤ç”¨_epoll/","content":"\n# å†…å®¹\n\n1. åŸºæœ¬æ¦‚å¿µ\n6. epoll\n\n# epoll\n\nepollæ˜¯Linuxç‰¹æœ‰çš„I/Oå¤ç”¨å‡½æ•°ã€‚\n\nepollçš„ä½¿ç”¨å®é™…ä¸Šä¸æ˜¯å•ç‹¬çš„APIï¼Œè€Œæ˜¯æœ‰ä¸€ç»„å‡½æ•°æ¥å®Œæˆã€‚ä¸‰ä¸ªå‡½æ•°ã€‚\n\n## API\n\n```c\n#include<sys/epoll.h>\nint epoll_create(int size);\t//åˆ›å»ºå†…æ ¸æ—¶é—´è¡¨ï¼Œç”¨äºå­˜æ”¾æè¿°ç¬¦å’Œäº‹ä»¶\nint epoll_ctl(int epfd, int op, int fd, struct epoll_event *event);\nint epoll_wait(int epfd, struct epoll_event* events, int maxevents, int timeout);\n```\n\n1. epoll\\_create()ï¼šåˆ›å»ºå†…æ ¸äº‹ä»¶è¡¨ï¼Œå­˜æ”¾æè¿°ç¬¦å’Œäº‹ä»¶ï¼Œçº¢é»‘æ ‘ã€‚\n2. epoll\\_ctl()ï¼šæ·»åŠ ã€ç§»é™¤æè¿°ç¬¦ï¼Œæ¯ä¸ªæè¿°ç¬¦åªéœ€è¦æ·»åŠ ä¸€æ¬¡ã€‚\n3. epoll\\_wait()ï¼šè·å–å·²å°±ç»ªçš„æè¿°ç¬¦ï¼Œå¤æ‚åº¦`O(1)`\n\nå†…æ ¸æ€ä¹ˆæ ·å®ç°`O(1)`ï¼Ÿï¼šæ³¨å†Œå›è°ƒå‡½æ•°çš„æ–¹å¼\n\n## epoll_create\n\nepollæŠŠç”¨æˆ·å…³å¿ƒçš„æ–‡ä»¶æè¿°ç¬¦ä¸Šçš„äº‹ä»¶æ”¾åœ¨å†…æ ¸é‡Œçš„ä¸€ä¸ªäº‹ä»¶è¡¨ä¸­ï¼Œä»è€Œæ— é¡»åƒselectå’Œpollé‚£æ ·æ¯æ¬¡è°ƒç”¨éƒ½è¦é‡å¤ä¼ æè¿°ç¬¦é›†æˆ–äº‹ä»¶é›†ã€‚\n\nä½†epolléœ€è¦ä½¿ç”¨ä¸€ä¸ªé¢å¤–çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ¥å”¯ä¸€æ ‡è¯†å†…æ ¸ä¸­çš„è¿™ä¸ªäº‹ä»¶è¡¨ã€‚\n\nè¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦å°±æ˜¯ä½¿ç”¨`epoll_create`å‡½æ•°æ¥åˆ›å»ºã€‚\n\n```c\nint epoll_create(int size);\n```\n\nåªæœ‰ä¸€ä¸ªå‚æ•°`size`ï¼Œä½†æ˜¯å®é™…ä¸Šè¿™ä¸ªå‚æ•°å¹¶ä¸èµ·ä½œç”¨ï¼Œåªæ˜¯ç»™å†…æ ¸ä¸€ä¸ªæç¤ºï¼Œå‘Šè¯‰ä»–äº‹ä»¶è¡¨å¤§æ¦‚éœ€è¦å¤šå¤§ã€‚\n\nå‡½æ•°è¿”å›å€¼ä¸ºå¯¹åº”è¿™ä¸ªäº‹ä»¶è¡¨çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚å…¶ä»–æ‰€æœ‰epollç³»ç»Ÿè°ƒç”¨çš„ç¬¬ä¸€ä¸ªå‚æ•°å°†ä½¿ç”¨è¯¥è¿”å›å€¼ï¼Œä»¥æŒ‡å®šè¦è®¿é—®çš„å†…æ ¸äº‹ä»¶è¡¨ã€‚\n\n## epoll_ctl\n\n```c\nint epoll_ctl(int epfd, int op, int fd, struct epoll_event *event);\n// epoll_ctlæˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥åˆ™è¿”å›-1å¹¶è®¾ç½®errnoã€‚\n```\n\n1. å‚æ•°`epfd`æ˜¯`epoll_create`è¿”å›å€¼ã€‚\n\n2. å‚æ•°`op`æŒ‡å®šæ“ä½œç±»å‹ã€‚æ“ä½œç±»å‹æœ‰å¦‚ä¸‹3ç§ï¼š\n\n   1. `EPOLL_CTL_ADD`ï¼Œå¾€äº‹ä»¶è¡¨ä¸­æ³¨å†Œfdä¸Šçš„äº‹ä»¶ï¼›\n   2. `EPOLL_CTL_MOD`ï¼Œä¿®æ”¹fdä¸Šçš„æ³¨å†Œäº‹ä»¶ï¼›\n   3. `EPOLL_CTL_DEL`ï¼Œåˆ é™¤fdä¸Šçš„æ³¨å†Œäº‹ä»¶ï¼›\n\n3. å‚æ•°`fd`æ˜¯è¦æ“ä½œçš„æ–‡ä»¶æè¿°ç¬¦\n\n4. å‚æ•°`event`æŒ‡å®šäº‹ä»¶ï¼Œå®ƒæ˜¯`epoll_event`ç»“æ„æŒ‡é’ˆç±»å‹\n\n   1. `epoll_event`çš„å®šä¹‰å¦‚ä¸‹\n\n      ```c\n      struct epoll_event\n      {\n          __uint32_t events;\t/* epolläº‹ä»¶, å’Œpollç±»ä¼¼ï¼Œå‰åŠ E*/\n          epoll_data_t data;\t/* ç”¨æˆ·æ•°æ® */\n      }\n      ```\n\n      1. ç»“æ„ä½“ä¸­æˆå‘˜`events`æè¿°äº‹ä»¶ç±»å‹ã€‚epollæ”¯æŒçš„äº‹ä»¶ç±»å‹ä¸pollåŸºæœ¬ç›¸åŒã€‚è¡¨ç¤ºepolläº‹ä»¶ç±»å‹çš„å®æ˜¯åœ¨pollå¯¹åº”çš„å®å‰åŠ ä¸Š\"E\"ï¼Œæ¯”å¦‚æ•°æ®å¯è¯»äº‹ä»¶æ˜¯`EPOLLIN`ã€‚ä½†epollæœ‰ä¸¤ä¸ªé¢å¤–çš„äº‹ä»¶ç±»å‹â€”â€”`EPOLLET`å’Œ`EPOLLONESHOT`ï¼Œè¿™ä¿©äº‹ä»¶å¾€å¾€å¯¹åº”epollçš„é«˜æ•ˆè¿ä½œæ¨¡å¼ã€‚\n\n      2. dataæˆå‘˜ç”¨äºå­˜å‚¨ç”¨æˆ·æ•°æ®ã€‚å…¶ç±»å‹`epoll_data_t`çš„å®šä¹‰å¦‚ä¸‹ï¼š\n         ```c\n         typedef union epoll_data\n         {\n             void * ptr;\n             int fd;\n             uint32_t u32;\n             uint64_t u64;\n         }epoll_data_t;\n         ```\n\n         `epoll_data_t`æ˜¯ä¸€ä¸ªè”åˆä½“ï¼Œå…¶4ä¸ªæˆå‘˜ä¸­ï¼š\n\n         1. ä½¿ç”¨æœ€å¤šçš„æ˜¯`fd`ï¼Œå®ƒæŒ‡å®šäº‹ä»¶æ‰€ä»å±çš„ç›®æ ‡æ–‡ä»¶æè¿°ç¬¦ã€‚\n         2. æˆå‘˜`ptr`å¯ç”¨æ¥æŒ‡å®šä¸`fd`ç›¸å…³çš„ç”¨æˆ·æ•°æ®ã€‚ä½†ç”±äº`epoll_data_t`æ˜¯ä¸€ä¸ªè”åˆä½“ï¼Œä¸å¯åŒæ—¶ä½¿ç”¨`ptr`å’Œ`fd`ï¼Œå› æ­¤ï¼Œå¦‚æœè¦å°†æ–‡ä»¶æè¿°ç¬¦å’Œç”¨æˆ·æ•°æ®å…³è”èµ·æ¥ä»¥å®ç°å¿«é€Ÿçš„æ•°æ®è®¿é—®çš„è¯ï¼Œåªèƒ½ä½¿ç”¨å…¶ä»–æ‰‹æ®µã€‚æ¯”å¦‚æ”¾å¼ƒä½¿ç”¨`fd`æˆå‘˜ï¼Œè€Œåœ¨`ptr`æŒ‡å‘çš„ç”¨æˆ·æ•°æ®ä¸­åŒ…å«`fd`ã€‚\n\n## epoll_wait\n\nåœ¨ä¸€æ®µè¶…æ—¶æ—¶é—´å†…ç­‰å¾…ä¸€ç»„æ–‡ä»¶æè¿°ç¬¦ä¸Šçš„äº‹ä»¶ã€‚\n\n```c\nint epoll_wait(int epfd, struct epoll_event* events, int maxevents, int timeout);\n// æˆåŠŸè¿”å›å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦çš„ä¸ªæ•°ï¼Œå¤±è´¥åˆ™è¿”å›-1å¹¶è®¾ç½®errno\n```\n\n`epoll_wait`å‡½æ•°å¦‚æœæ£€æµ‹åˆ°äº‹ä»¶ï¼Œå°±å°†æ‰€æœ‰å°±ç»ªçš„äº‹ä»¶ä»å†…æ ¸äº‹ä»¶è¡¨ï¼ˆç”±epfdå‚æ•°æŒ‡å‡ºï¼‰ä¸­å¤åˆ¶åˆ°å®ƒçš„ç¬¬äºŒä¸ªå‚æ•°`events`æŒ‡å‘çš„æ•°ç»„ä¸­ã€‚è¿™ä¸ªæ•°ç»„åªç”¨äºç”¨æˆ·æ¥æ”¶å†…æ ¸æ£€æµ‹åˆ°çš„å°±ç»ªäº‹ä»¶ï¼Œè€Œä¸åƒselect/pollçš„æ•°ç»„å‚æ•°é‚£æ ·æ‹·è´æ¥æ‹·è´å»ã€‚æå¤§åœ°æé«˜äº†åº”ç”¨ç¨‹åºç´¢å¼•å°±ç»ªæ–‡ä»¶æè¿°ç¬¦çš„æ•ˆç‡ã€‚\n\nå‚æ•°`maxevents`æŒ‡å®šæœ€å¤šç›‘å¬å¤šå°‘ä¸ªäº‹ä»¶ï¼Œå¿…é¡»å¤§äº0ã€‚\n\nå‚æ•°`timeout`å«ä¹‰ä¸`poll`æ¥å£çš„`timeout`å‚æ•°ç›¸åŒï¼Œéƒ½æ˜¯æŒ‡å®šè¶…æ—¶å€¼ï¼Œå•ä½æ˜¯`æ¯«ç§’`ã€‚å½“è®¾ç½®ä¸º`-1`æ—¶ï¼Œ`poll`è°ƒç”¨è®²æ°¸è¿œé˜»å¡ç›´åˆ°æŸä¸ªäº‹ä»¶å‘ç”Ÿï¼›å½“è®¾ç½®ä¸º`0`æ—¶`poll`è°ƒç”¨å°†ç«‹å³è¿”å›ã€‚\n\n### ä¸pollçš„ä»£ç å·®å¼‚\n\n```c\nint ret = poll(fds, MAX_EVENT_NUMBER, -1);\nfor(int i = 0; i<MAX_EVENT_NUMBER, ++i)\n{\n    if(fds[i].revents & POLLIN)\n    {\n        int sockfd = fds[i].fd;\n        /* å¤„ç†sockfd */\n    }\n}\n//ä»¥ä¸Šä¸ºpoll\n-----------------------------------------------------\n//ä»¥ä¸‹ä¸ºepoll\nint ret = epoll_wait(epollfd, events, MAX_EVENT_NUMBER, -1);\nfor(int i = 0; i < ret; ++i)\n{\n    int sockfd = events[i].data.fd;\n    /* sockfdè‚¯å®šå°±ç»ªï¼Œç›´æ¥å¤„ç† */\n}\n```\n\n# å†…æ ¸äº‹ä»¶è¡¨\n\nepollçš„æœ€å¤§ä¼˜åŠ¿åœ¨äºå¤„ç†æè¿°ç¬¦ç‰¹åˆ«å¤šçš„æƒ…å†µï¼Œç›¸æ¯”è½®è¯¢æ–¹å¼ï¼š\n\n1. å¦‚æœç”¨ä¼ ç»Ÿçš„selectã€pollå•çº¯çš„é¡ºåºè½®è¯¢æ–¹æ³•ç›‘æµ‹å°±ç»ªçš„æè¿°ç¬¦ï¼Œé‚£ä¹ˆæ€§èƒ½ä¼šå¾ˆä½ä¸‹çš„ã€‚\n2. è€Œä¸”è™½ç„¶selectã€pollèƒ½é¡ºåˆ©æŸ¥å‡ºæœ‰å‡ ä¸ªæè¿°ç¬¦ä¸Šæœ‰äº‹ä»¶äº§ç”Ÿï¼Œä½†æ˜¯æ˜¯å“ªä¸ªæè¿°ç¬¦ï¼Ÿå¹¶æ²¡æœ‰å‘Šè¯‰æˆ‘ä»¬ï¼Œæ‰€ä»¥åˆå¾—æµªè´¹ä¸€è½®æ—¶é—´æ¥æŸ¥æ‰¾äº§ç”Ÿæ—¶é—´æ˜¯å“ªä¸ªæè¿°ç¬¦ã€‚\n\n## æ•°æ®ç»“æ„\n\næœ¬è´¨ä¸Šï¼Œæ˜¯ä¸€æ£µçº¢é»‘æ ‘ã€‚\n\n# æ€è·¯çš„è½¬å˜\n\nç›¸è¾ƒäºselect/pollï¼Œæˆ‘ä»¬æ‰€å…³å¿ƒçš„äº‹ä»¶ï¼ˆæè¿°ç¬¦ï¼‰è¡¨ï¼Œç›´æ¥åˆ›å»ºäºå†…æ ¸æ€ã€‚\n\n# LT/ETæ¨¡å¼\n\nepollå¯¹æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œæœ‰ä¸¤ç§æ¨¡å¼ï¼šLT (Level Trigger, ç”µå¹³è§¦å‘)æ¨¡å¼å’ŒET (Edge Trigger, è¾¹æ²¿è§¦å‘)æ¨¡å¼ã€‚\n\n* LTï¼šæœ‰äº‹ä»¶å°±ç»ªåï¼Œç”¨æˆ·ä¸ç”¨ç«‹å³å¤„ç†ï¼›ç”¨æˆ·å¦‚æœæ²¡æœ‰å¤„ç†å®Œï¼Œè¿˜ä¼šç»§ç»­æé†’\n* ETï¼šæœ‰äº‹ä»¶å°±ç»ªï¼Œåªæé†’ç”¨æˆ·ä¸€æ¬¡ã€‚ä¸‹æ¬¡å°±æ²¡äº†ã€‚\n\n## LT\n\nLTæ¨¡å¼æ˜¯é»˜è®¤çš„å·¥ä½œæ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼ä¸‹epollç›¸å½“äºä¸€ä¸ªæ•ˆç‡è¾ƒé«˜çš„pollã€‚\n\nå¯¹äºé‡‡ç”¨LTå·¥ä½œæ¨¡å¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå½“`epoll_wait`æ£€æµ‹åˆ°å…¶ä¸Šæœ‰äº‹ä»¶å‘ç”Ÿå¹¶å°†æ­¤äº‹ä»¶é€šçŸ¥åº”ç”¨ç¨‹åºåï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä¸ç«‹å³å¤„ç†è¯¥äº‹ä»¶ã€‚è¿™æ ·ï¼Œå½“åº”ç”¨ç¨‹åºä¸‹ä¸€æ¬¡è°ƒç”¨`epoll_wait`æ—¶ï¼Œ`epoll_wait`è¿˜ä¼šå†æ¬¡å‘åº”ç”¨ç¨‹åºé€šå‘Šæ­¤äº‹ä»¶ï¼Œç›´åˆ°è¯¥äº‹ä»¶è¢«å¤„ç†ã€‚\n\n## ET\n\nå½“å¾€epollå†…æ ¸äº‹ä»¶è¡¨ä¸­æ³¨å†Œä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸Šçš„`EPOLLET`äº‹ä»¶æ—¶ï¼Œepollå°†ä»¥ETæ¨¡å¼æ¥æ“ä½œè¯¥æ–‡ä»¶æè¿°ç¬¦ã€‚ETæ¨¡å¼æ˜¯epollçš„é«˜æ•ˆå·¥ä½œæ¨¡å¼ã€‚\n\nè€Œå¯¹äºé‡‡ç”¨ETå·¥ä½œæ¨¡å¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå½“`epoll_wait`æ£€æµ‹åˆ°å…¶ä¸Šæœ‰äº‹ä»¶å‘ç”Ÿå¹¶å°†æ­¤äº‹ä»¶é€šçŸ¥åº”ç”¨ç¨‹åºåï¼Œåº”ç”¨ç¨‹åºå¿…é¡»ç«‹å³å¤„ç†è¯¥äº‹ä»¶ï¼Œå› ä¸ºåç»­çš„`epoll_wait`è°ƒç”¨å°†ä¸å†å‘åº”ç”¨ç¨‹åºé€šçŸ¥è¿™ä¸€äº‹ä»¶ã€‚å¯è§ï¼ŒETæ¨¡å¼åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šé™ä½äº†åŒä¸€ä¸ªepolläº‹ä»¶è¢«é‡å¤è§¦å‘çš„æ¬¡æ•°ï¼Œå› æ­¤æ•ˆç‡è¦æ¯”LTæ¨¡å¼é«˜ã€‚\n\n# LT - ä»£ç ç¤ºä¾‹\n\n```c\n#include<string.h>\n#include<assert.h>\n#include<sys/socket.h>\n#incldue<netinet/in.h>\n#include<arpa/inet.h>\n\n#include<sys/epoll.h>\n\n#define MAX 10\nint socket_init();\nint epoll_add(int epfd, int fd)\n{\n    struct epoll_event ev;\n    ev.data.fd = fd;\n    ev.events = EPOLLIN;//ev.events = EPOLLIN | EPOLLET; è¿™æ ·å¯å·¥ä½œåœ¨ETæ¨¡å¼\n    \n    if(epoll_ctl(epfd, EPOLL_CTL_ADD, fd, &ev) == -1)\n    {\n        perror(\"epoll ctl add err\\n\");\n    }\n}\nvoid epoll_del(int epfd, int fd)\n{\n    if(epoll_ctl(epfd, EPOLL_CTL_DEL, fd, NULL) == -1)\n    {\n        perror(\"epoll ctl del err\\n\");\n    }\n}\nint main()\n{\n    int sockfd = socket_init();\n    assert(sockfd != -1);\n    int epfd = epoll_create(MAX);\n    assert(epfd != -1);\n    \n    epoll_add(epfd, sockfd);//å°†ç›‘å¬å¥—æ¥å­—æ·»åŠ åˆ°å†…æ ¸äº‹ä»¶è¡¨\n    struct epoll_event evs[MAX];\n    while(1)\n    {\n        int n = epoll_wait(epfd, evs, MAX, 5000);\t//5000ms\n        if(n == -1)\n        {\n            perror(\"epoll wait err\\n\");\n        }\n        else if(n == 0)\n        {\n            printf(\"time out\\n\");\n        }\n        else\n        {\n            for(int i = 0; i < n; ++i)//æ¯ä¸ªäº‹ä»¶å‡ä¸ºå°±ç»ªçŠ¶æ€\n            {\n                int fd = evs[i].data.fd;\n                if(evs[i].events & EPOLLIN)\n                {\n                    if(fd == sockfd)//ç›‘å¬å¥—æ¥å­—\n                    {\n                        struct sockaddr_in caddr;\n                        int len = sizeof(caddr);\n                        int c = accept(sockfd, (struct sockaddr*)&caddr, &len);\n                        if(c < 0)\n                        {\n                            continue;\n                        }\n                        printf(\"accept c = %d\\n\", c);\n                        \n                        epoll_add(epfd, c);\n                    }\n                    else\t//è¿æ¥å¥—æ¥å­—\n                    {\n                        char buff[128] = {0};\n                        int num = recv(fd, buff, 127, 0);\n                        if(num <= 0)//å¯¹æ–¹å…³é—­ æˆ–å¼‚å¸¸ï¼Œéœ€è¦ç§»é™¤\n                        {\n                            //æ³¨æ„ä¸è¦å…ˆcloseï¼Œå› ä¸ºepoll_deléœ€è¦ç”¨åˆ°fdæè¿°ç¬¦ã€‚\n                            epoll_del(epfd, fd);\n                            close(fd);\n                            printf(\"client close\\n\");\n                        }\n                        else\n                        {\n                            printf(\"recv(%d)=%s\\n\", fd, buff);\n                            send(fd, \"ok\", 2, 0);\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n```\n\n# ET - ä»£ç ç¤ºä¾‹\n\nä¸»è¦è§£å†³çš„é—®é¢˜ï¼šæ€ä¹ˆä¸€æ¬¡æ€§æŠŠæè¿°ç¬¦ä¸Šçš„æ•°æ®æ¥æ”¶å®Œï¼Ÿ\n\n1. æè¿°ç¬¦è®¾ç½®æˆéé˜»å¡\n   ```c\n   #include<fcntl.h>\n   int fcntl(int fd, int cmd, ... /* arg */);\n   /* fcntl()å¯ä»¥é‡‡ç”¨å¯é€‰çš„ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚æ˜¯å¦éœ€è¦è¿™ä¸ªå‚æ•°ç”± cmd å†³å®šã€‚\n   æ‰€éœ€çš„å‚æ•°ç±»å‹åœ¨æ¯ä¸ª cmd åç§°åé¢çš„æ‹¬å·ä¸­æŒ‡ç¤ºï¼ˆåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ‰€éœ€çš„ç±»å‹æ˜¯ intï¼Œæˆ‘ä»¬ä½¿ç”¨åç§° arg æ¥æ ‡è¯†å‚æ•°ï¼‰ï¼Œå¦‚æœä¸éœ€è¦å‚æ•°ï¼Œåˆ™æŒ‡å®š voidã€‚\n   åªæœ‰ç‰¹å®šçš„ Linux å†…æ ¸ç‰ˆæœ¬æ‰æ”¯æŒæŸäº› cmd æ“ä½œã€‚æ£€æŸ¥ä¸»æœºå†…æ ¸æ˜¯å¦æ”¯æŒç‰¹å®šæ“ä½œçš„é¦–é€‰æ–¹æ³•æ˜¯ä½¿ç”¨æ‰€éœ€çš„ cmd å€¼è°ƒç”¨ fcntl()ï¼Œç„¶åæµ‹è¯•è°ƒç”¨æ˜¯å¦ä»¥ EINVAL å¤±è´¥ï¼Œè¡¨æ˜å†…æ ¸æ— æ³•è¯†åˆ«è¯¥å€¼ã€‚*/\n   /*\n   For a successful call, the return value depends on the operation:\n   \tF_DUPFD  \tThe new file descriptor.\n   \tF_GETFD  \tValue of file descriptor flags.\n   \tF_GETFL  \tValue of file status flags.\n   \tF_GETSIG \tValue of signal sent when read or write becomes possible, or zero for traditional SIGIO behavior.\n   \t\n   All other commands : Zero.\n   On error, -1 is returned, and errno is set appropriately.\n   */\n   å¯é€‰çš„cmdæ“ä½œï¼ˆå…¶ä¸­ä¹‹äºŒï¼‰ï¼š\n   F_GETFL(void)//get file access mode and the file status flags\n   F_SETFL(int)//set file status flags to the value by arg. File access mode and file creation flags in arg are ignored. On Linux, this command can only change the O_APPEND, O_ASYNC, O_DIRECT, O_NOATIME, O_NONBLOCK flags. It's not possible to change the O_DSYNC, O_SYNC flags.\n   ```\n\n2. å¾ªç¯å¤„ç†ï¼ˆè¯»å–ï¼‰\n   éœ€è¦åˆ¤æ–­recvè¿”å›å€¼ä¸º`-1`æ—¶çš„é”™è¯¯ç±»å‹ï¼ˆæ²¡æ•°æ®æ—¶ï¼Œéé˜»å¡æƒ…å†µä¸‹ç«‹å³è¿”å›`-1`ï¼‰\n\n   ```\n   è¿”å›å€¼\n   å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™è¿”å›-1ï¼Œè®¾ç½®errnoä»¥æŒ‡ç¤ºé”™è¯¯ã€‚\n   å½“æµå¥—æ¥å­—å¯¹ç­‰ç‚¹æ‰§è¡Œäº†æœ‰åºå…³é—­æ—¶ï¼Œè¿”å›å€¼å°†ä¸º0ï¼ˆä¼ ç»Ÿçš„â€œæ–‡ä»¶ç»“æŸâ€è¿”å›ï¼‰ã€‚\n   æˆåŠŸåˆ™è¿”å›æ¥æ”¶åˆ°çš„å­—èŠ‚æ•°ï¼›\n   \n   å„ç§åŸŸï¼ˆä¾‹å¦‚ï¼ŒUNIX å’Œ Internet åŸŸï¼‰ä¸­çš„æ•°æ®æŠ¥å¥—æ¥å­—å…è®¸é›¶é•¿åº¦æ•°æ®æŠ¥ã€‚å½“æ¥æ”¶åˆ°è¿™æ ·çš„æ•°æ®æŠ¥æ—¶ï¼Œè¿”å›å€¼ä¸º 0ã€‚\n   å¦‚æœä»æµå¥—æ¥å­—æ¥æ”¶çš„è¯·æ±‚å­—èŠ‚æ•°ä¸º 0ï¼Œåˆ™ä¹Ÿå¯èƒ½è¿”å›å€¼ 0ã€‚\n   \n   é”™è¯¯\n   è¿™äº›æ˜¯å¥—æ¥å­—å±‚äº§ç”Ÿçš„ä¸€äº›æ ‡å‡†é”™è¯¯ã€‚åº•å±‚åè®®æ¨¡å—å¯èƒ½ä¼šäº§ç”Ÿå’Œè¿”å›é¢å¤–çš„é”™è¯¯ï¼›æŸ¥çœ‹ä»–ä»¬çš„æ‰‹å†Œé¡µã€‚\n   \n   EAGAIN æˆ– EWOULDBLOCK\n   å¥—æ¥å­—è¢«æ ‡è®°ä¸ºéé˜»å¡å¹¶ä¸”æ¥æ”¶æ“ä½œå°†é˜»å¡ï¼Œæˆ–è€…å·²è®¾ç½®æ¥æ”¶è¶…æ—¶å¹¶ä¸”åœ¨æ¥æ”¶æ•°æ®ä¹‹å‰è¶…æ—¶å·²è¿‡æœŸã€‚POSIX.1å…è®¸åœ¨è¿™ç§æƒ…å†µä¸‹è¿”å›ä»»ä¸€é”™è¯¯ï¼Œå¹¶ä¸”ä¸è¦æ±‚è¿™äº›å¸¸é‡å…·æœ‰ç›¸åŒçš„å€¼ï¼Œå› æ­¤å¯ç§»æ¤åº”ç”¨ç¨‹åºåº”æ£€æŸ¥è¿™ä¸¤ç§å¯èƒ½æ€§ã€‚\n   \n   EBADF\n   å‚æ•° sockfd æ˜¯æ— æ•ˆçš„æ–‡ä»¶æè¿°ç¬¦ã€‚\n   ECONNREFUSED\n   è¿œç¨‹ä¸»æœºæ‹’ç»å…è®¸ç½‘ç»œè¿æ¥ï¼ˆé€šå¸¸æ˜¯å› ä¸ºå®ƒæ²¡æœ‰è¿è¡Œè¯·æ±‚çš„æœåŠ¡ï¼‰ã€‚\n   EFAULT\n   æ¥æ”¶ç¼“å†²åŒºæŒ‡é’ˆæŒ‡å‘è¿›ç¨‹åœ°å€ç©ºé—´ä¹‹å¤–ã€‚\n   EINTR\n   åœ¨ä»»ä½•æ•°æ®å¯ç”¨ä¹‹å‰ï¼Œæ¥æ”¶è¢«ä¿¡å·ä¼ é€’ä¸­æ–­ï¼›è§signal(7)ã€‚\n   EINVAL\n   ä¼ é€’äº†æ— æ•ˆçš„å‚æ•°ã€‚\n   ENOMEM\n   æ— æ³•ä¸º recvmsg() åˆ†é…å†…å­˜ã€‚\n   ENOTCONN\n   å¥—æ¥å­—ä¸é¢å‘è¿æ¥çš„åè®®ç›¸å…³è”ï¼Œå¹¶ä¸”å°šæœªè¿æ¥ï¼ˆè¯·å‚é˜…connect(2)å’Œ accept(2)ï¼‰\n   ENOTSOCK\n   æ–‡ä»¶æè¿°ç¬¦ sockfd ä¸å¼•ç”¨å¥—æ¥å­—ã€‚\n   ```\n\n* è®¾ç½®ä¸ºéé˜»å¡\n\n```c\nvoid setnonblock(int fd)\n{\n    int oldfilestatusflags = fcntl(fd, F_GETFL);\n    int newfilestatusflags = oldfilestatusflags | O_NONBLOCK;\n    if(fcntl(fd, F_SETFL, newfilestatusflags) == -1)\n    {\n        perror(\"fcntl setfl err\\n\");\n    }\n}\nvoid epoll_add(int epfd, int fd)\n{\n    struct epoll_event ev;\n    ev.data.fd = fd;\n    ev.events = EPOLLIN | EPOLLET;\n    if(epoll_ctl(epfd, EPOLL_CTL_ADD, fd, &ev) == -1)\n    {\n        perror(\"epoll ctl add err\\n\");\n    }\n    setnonblock(fd);\t//è¿™ä¸ªæ“ä½œæ”¾åœ¨å‰åä¸å½±å“ï¼Œä¸epoll_ctlç‹¬ç«‹ã€‚\n}\n```\n\n* å¾ªç¯å¤„ç†\n\n```c\n#include<errno.h>\nelse\n{\n    while(1)\n    {\n        char buff[128] = {0};\n        int num = recv(fd, buff, 1, 0);\t//1æ¬¡è¯»1ä¸ªå­—èŠ‚\n        if(num == -1)\n        {\n            if(errno == EAGAIN || errno == EWOULDBLOCK)//æ²¡æœ‰æ•°æ®äº†\n            {\n                send(fd, \"ok\", 2, 0);\n            }\n            else\t\n            {\n                perror(\"recv err\");\n            }\n            break;\n        }\n        else if(num == 0)//å¯¹æ–¹å…³é—­äº†\n        {\n            epoll_del(epfd, fd);\n            close(fd);\n            printf(\"client close\\n\");\n            break;\n        }\n        else\t//è¿™ä¸€æ¬¡çš„recvæœ‰æ•°æ®\n        {\n            printf(\"buff=%s\\n\", buff);\n        }\n    }\n}\n```\n\n","categories":["Linux","ç½‘ç»œ"]},{"title":"é˜»å¡_éé˜»å¡_åŒæ­¥_å¼‚æ­¥","url":"/é¡¹ç›®/é˜»å¡_éé˜»å¡_åŒæ­¥_å¼‚æ­¥/","content":"\n# å†…å®¹\n\n1. é˜»å¡\n1. éé˜»å¡\n1. åŒæ­¥\n1. å¼‚æ­¥\n\né¦–å…ˆåº”è¯¥é˜æ˜çš„æ˜¯ï¼šé˜»å¡ã€éé˜»å¡ã€åŒæ­¥ã€å¼‚æ­¥æè¿°çš„éƒ½æ˜¯IOçš„çŠ¶æ€ã€‚ç„¶åä»IOçš„ä¸¤ä¸ªé˜¶æ®µè°ˆã€‚\n\n5. äº”ç§IOæ¨¡å‹\n\n# å…¸å‹IOçš„ä¸¤ä¸ªé˜¶æ®µ\n\næ•°æ®å‡†å¤‡ - æ•°æ®è¯»å†™\n\n## ä¾‹å­\n\nrecvï¼Œä¼ sockfdã€bufã€lenã€‚æ•°æ®å‡†å¤‡å³è§‚å¯Ÿæ¥æ”¶ç¼“å†²åŒºæ˜¯å¦æœ‰æ•°æ®å¯è¯»ã€‚\n\n* æ•°æ®æœªå°±ç»ª - é˜»å¡ã€éé˜»å¡\n\nå½“sockfdå·¥ä½œåœ¨é˜»å¡æ¨¡å¼ä¸‹ï¼Œè°ƒç”¨recvï¼Œå¦‚æœæ²¡æœ‰æ•°æ®å°±ç»ªï¼Œåˆ™ä¼šé˜»å¡ï¼›è‹¥sockfdå·¥ä½œåœ¨éé˜»å¡æ¨¡å¼ä¸‹ï¼Œå¦‚æœæ²¡æœ‰æ•°æ®å°±ç»ªï¼Œåˆ™ç«‹å³è¿”å›ã€‚\n\nå¦‚ä½•åˆ¤æ–­è¿”å›çš„åŸå› ï¼Ÿçœ‹è¿”å›å€¼ã€‚ä»¥åˆ¤æ–­æ˜¯å¦æ­£å¸¸è¿”å›ã€‚\n\n* æ•°æ®å°±ç»ª - åŒæ­¥ã€å¼‚æ­¥\n\nåº”ç”¨ç¨‹åºè®²å†…æ ¸ç¼“å†²åŒºä¸­å‡†å¤‡å¥½çš„æ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ä¸­çš„bufç¼“å­˜åŒºã€‚è¿™ä¸ªæ‹·è´çš„è¿‡ç¨‹æ˜¯éœ€è¦ç­‰å¾…çš„ï¼Œç­‰å¾…æ‹·è´å®Œæ¯•åº”ç”¨ç¨‹åºæ‰å¯ä»¥ç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚\n\nå¼‚æ­¥å’ŒåŒæ­¥çš„æ–¹å¼ä¸ä¸€æ ·ï¼Œéœ€è¦è°ƒç”¨linuxæä¾›çš„å¼‚æ­¥ioæ¥å£ï¼Œ`aio_read`ã€`aio_write`ã€‚éœ€è¦ä¼ é€’`sockfd`ã€`buf`ã€`sigioä¿¡å·(é€šçŸ¥æ–¹å¼)`ã€‚ä¹‹ååº”ç”¨ç¨‹åºåˆ™ç«‹å³å¾€åæ‰§è¡Œå…¶ä»–ä¸šåŠ¡ï¼Œç›´åˆ°è¢«é€šçŸ¥bufçš„æ•°æ®å·²ç»å‡†å¤‡å¥½äº†ï¼Œåˆ™è°ƒç”¨å®ç°ç»‘å®šçš„å›è°ƒå‡½æ•°è¿›è¡Œå¤„ç†ã€‚\n\n# åŒæ­¥/å¼‚æ­¥\n\nåœ¨ä¸¤ä¸ªæ–¹é¢éƒ½æ¶‰åŠåŒæ­¥/å¼‚æ­¥ã€‚ä¸€ä¸ªæ–¹é¢æ˜¯**IOåŒæ­¥/å¼‚æ­¥**ï¼Œå±äºä¸Šé¢è°ˆåˆ°çš„ã€‚\n\nå¦ä¸€ä¸ªæ–¹é¢æ˜¯**ä¸šåŠ¡å±‚é¢çš„åŒæ­¥/å¼‚æ­¥**ã€‚\n\nä¸¤ä¸ªæ–¹é¢ï¼Œè§’åº¦ä¸åŒï¼Œä½†æ€è·¯æ˜¯ä¸€æ ·çš„ï¼ŒåŒæ­¥æ˜¯éœ€è¦è‡ªå·±æ“å¿ƒï¼›å¼‚æ­¥æ˜¯çº¦å®šå¥½å¤„ç†æ–¹å¼ï¼Œå…ˆå»å¿™åˆ«çš„ã€‚\n\n**åŒæ­¥**è¡¨ç¤ºAï¼ˆåº”ç”¨ç¨‹åºï¼‰å‘Bï¼ˆæ“ä½œç³»ç»Ÿï¼‰è¯·æ±‚è°ƒç”¨ä¸€ä¸ªç½‘ç»œIOæ¥å£æ—¶ï¼ˆæˆ–è€…è°ƒç”¨æŸä¸ªä¸šåŠ¡é€»è¾‘APIæ¥å£æ—¶ï¼‰ï¼Œæ•°æ®çš„è¯»å†™éƒ½æ˜¯ç”±è¯·æ±‚æ–¹Aè‡ªå·±æ¥å®Œæˆçš„ï¼ˆä¸ç®¡æ˜¯é˜»å¡è¿˜æ˜¯éé˜»å¡ï¼ˆéé˜»å¡çš„åŒæ­¥ç±»ä¼¼äºå¿™ç­‰å¾…ï¼‰ï¼‰ï¼›**å¼‚æ­¥**è¡¨ç¤ºAå‘Bè¯·æ±‚è°ƒç”¨ä¸€ä¸ªç½‘ç»œIOæ¥å£æ—¶ï¼ˆæˆ–è€…è°ƒç”¨æŸä¸ªä¸šåŠ¡é€»è¾‘APIæ¥å£æ—¶ï¼‰ï¼Œå‘Bä¼ å…¥è¯·æ±‚çš„äº‹ä»¶ä»¥åŠäº‹ä»¶å‘ç”Ÿæ—¶é€šçŸ¥çš„æ–¹å¼ï¼ŒAå°±å¯ä»¥å¤„ç†å…¶å®ƒé€»è¾‘äº†ï¼Œå½“Bç›‘å¬åˆ°äº‹ä»¶å¤„ç†å®Œæˆåï¼Œä¼šç”¨äº‹å…ˆçº¦å®šå¥½çš„é€šçŸ¥æ–¹å¼ï¼Œé€šçŸ¥Aå¤„ç†ç»“æœã€‚\n\n# äº”ç§IOæ¨¡å‹\n\nè¿™é‡Œè°ˆçš„IOæ˜¯æŒ‡ç½‘ç»œIOã€‚\n\n## åŒæ­¥é˜»å¡IO\n\n![image-20220522194427303](../../images/é˜»å¡_éé˜»å¡_åŒæ­¥_å¼‚æ­¥/image-20220522194427303.png)\n\né˜»å¡æŒ‡ä¸ŠåŠæ®µç­‰å¾…å‡†å¤‡å¥½æ•°æ®ï¼›åŒæ­¥æŒ‡éœ€è¦èŠ±è´¹ç”¨æˆ·åº”ç”¨ç¨‹åºçš„æ—¶é—´å»æ‹·è´æ•°æ®ã€å¤„ç†æ•°æ®ã€‚\n\n## åŒæ­¥éé˜»å¡IO\n\n![image-20220522194949186](../../images/é˜»å¡_éé˜»å¡_åŒæ­¥_å¼‚æ­¥/image-20220522194949186.png)\n\néé˜»å¡æŒ‡ä¸ŠåŠæ®µä¸ç®¡æ•°æ®æ˜¯å¦å‡†å¤‡å¥½ï¼Œç«‹å³è¿”å›ï¼›åŒæ­¥æŒ‡éœ€è¦èŠ±è´¹ç”¨æˆ·åº”ç”¨ç¨‹åºçš„æ—¶é—´å»æ‹·è´æ•°æ®ã€å¤„ç†æ•°æ®ã€‚\n\n## IOå¤ç”¨\n\n![image-20220522200137240](../../images/é˜»å¡_éé˜»å¡_åŒæ­¥_å¼‚æ­¥/image-20220522200137240.png)\n\nä¸‰ç§æ¥å£éƒ½æ˜¯åŒæ­¥é˜»å¡IOã€‚ä¸ä¸Šé¢çš„åŒºåˆ«æ˜¯ï¼Œä¸€ä¸ªçº¿ç¨‹å¯ä»¥ç®¡ç†å¤šä¸ªsocketã€‚\n\n## ä¿¡å·é©±åŠ¨\n\n![image-20220522201543844](../../images/é˜»å¡_éé˜»å¡_åŒæ­¥_å¼‚æ­¥/image-20220522201543844.png)\n\nç­‰å¾…æ•°æ®æ˜¯å¼‚æ­¥çš„è¿‡ç¨‹ã€‚åœ¨æ•°æ®å°±ç»ªå‰ï¼Œç”¨æˆ·åº”ç”¨ç¨‹åºæ‰§è¡Œå…¶ä»–é€»è¾‘ï¼›ä½†æ˜¯æ•°æ®å‡†å¤‡å¥½åï¼Œè¿˜æ˜¯å¾—éœ€è¦ç”¨æˆ·åº”ç”¨ç¨‹åºè‡ªå·±å¤„ç†ã€‚ä»æ˜¯åŒæ­¥è¿‡ç¨‹ã€‚\n\nä¼˜ç‚¹æ˜¯æä¾›äº†æ¶ˆæ¯é€šçŸ¥æœºåˆ¶ï¼Œå‡å°‘äº†ç³»ç»Ÿè°ƒç”¨çš„æ¬¡æ•°ï¼ˆç›¸æ¯”äºåŒæ­¥éé˜»å¡çš„åå¤è°ƒç”¨EAGAINï¼‰\n\n## å¼‚æ­¥IO\n\n![image-20220522202459276](../../images/é˜»å¡_éé˜»å¡_åŒæ­¥_å¼‚æ­¥/image-20220522202459276.png)\n\n```c\nstruct aiocb\n{\n    int \t\t\taio_fildes;\n    off_t \t\t\taio_offset;\n    volatile void *\taio_buf;\n    size_t \t\t\taio_nbytes;\n    int \t\t\taio_reqprio;\n    struct \t\t\tsigevent aio_sigevent;\n    int\t\t\t\taio_lio_opcode;\n}\n```\n\n","categories":["é¡¹ç›®","Linux","ç½‘ç»œ"]},{"title":"é«˜çº§æ•°æ®ç»“æ„_BST","url":"/é«˜çº§æ•°æ®ç»“æ„/é«˜çº§æ•°æ®ç»“æ„_BST/","content":"\n# äºŒå‰æ ‘ç›¸å…³æ¦‚å¿µ\n\n1. æ ¹èŠ‚ç‚¹\n2. å·¦å­©å­ã€å³å­©å­\n3. åŒäº²èŠ‚ç‚¹ï¼ˆçˆ¶èŠ‚ç‚¹ï¼‰\n4. ç¥–å…ˆèŠ‚ç‚¹\n5. å…„å¼ŸèŠ‚ç‚¹\n6. å”å”èŠ‚ç‚¹ï¼ˆç¥–å…ˆèŠ‚ç‚¹çš„å¦ä¸€ä¸ªå­èŠ‚ç‚¹ï¼‰\n7. å¶å­èŠ‚ç‚¹\n8. å·¦å­æ ‘ã€å³å­æ ‘\n9. äºŒå‰æ ‘çš„é«˜åº¦/å±‚æ•°\n\n# BST - äºŒå‰æœç´¢æ ‘\n\nå¯¹äºä¸€æ£µäºŒå‰æ ‘ï¼Œä¸Šçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹å¦‚æœæ»¡è¶³`å·¦å­©å­çš„å€¼ < çˆ¶èŠ‚ç‚¹çš„å€¼ < å³å­©å­çš„å€¼`ï¼Œåˆ™ç§°ä½œ`BST(Binary Search/Sort Tree)`æ ‘ï¼Œå³äºŒå‰æœç´¢æ ‘ï¼ˆäºŒå‰æ’åºæ ‘ï¼‰ã€‚\n\n# äºŒå‰æœç´¢æ ‘èŠ‚ç‚¹çš„ç»“æ„\n\n```cpp\ntypedef int KeyType;\ntypedef struct BstNode\n{\n    KeyType key;\n    BstNode * lchild;\n    BstNode * parent;\t//ä¸å¿…è¦, ä½†å¯ä»¥å¤§å¤§ç®€åŒ–ä»£ç \n    BstNode * rchild;\n}BstNode, * BSTree;\n```\n\n# äºŒå‰æœç´¢æ ‘çš„æ’å…¥\n\n1. BSTå¦‚æœä¸ºç©ºï¼Œå»ºæ ¹ã€‚\n2. BSTä¸ä¸ºç©ºï¼Œä»æ ¹èŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒï¼Œæ‰¾åˆ°åˆé€‚ä½ç½®ï¼Œç”Ÿæˆæ–°èŠ‚ç‚¹ï¼Œæ–°èŠ‚ç‚¹çš„åœ°å€èµ‹ç»™çˆ¶èŠ‚ç‚¹çš„`leftchild/rightchild`ã€‚\n\n```cpp\n#include<functional>\t//less<T>\nusing namespace std;\n\ntemplate<typename T, typename Compare=less<T>>\nclass BSTree\n{\nprivate:\n    //èŠ‚ç‚¹å®šä¹‰\n    struct Node\n    {\n        Node(T data = T())\n            : data_(data), left_(nullptr), right_(nullptr)\n        {}\n        T data_;\t\t//æ•°æ®åŸŸ\n        Node *left_;\t//å·¦å­©å­åŸŸ\n        Node *right_;\t//å³å­©å­åŸŸ\n    };\n    Node *root_;\t\t//æŒ‡å‘BSTæ ‘çš„æ ¹èŠ‚ç‚¹\npublic:\n    BSTree()\n        : root_(nullptr)\n    {\n    }\n    ~BSTree()\n    {\n    }\n    //éé€’å½’æ’å…¥æ“ä½œ\n    void n_insert(const T &val)\n    {\n        if(root_ == nullptr)\n        {\n            root_ = new Node(val);\n            return;\n        }\n        \n        Node * parent = nullptr;\n        Node * cur = root_;\n        while(cur != nullptr)\n        {\n            if(val < cur->data_)\n            {\n                parent = cur;\n                cur = cur->left_;\n            }\n            else if(val > cur->data_)\n            {\n                parent = cur;\n                cur = cur->right_;\n            }\n            else //val == cur->data_\n            {\n                //ä¸æ’å…¥å€¼ç›¸åŒçš„å…ƒç´ \n                return;\n            }\n        }\n        //æŠŠæ–°èŠ‚ç‚¹æ’å…¥åˆ°parentèŠ‚ç‚¹ä¸‹\n        if(val < parent->data_)\n        {\n            parent->left_ = new Node(val);\n        }\n        else\n        {\n            parent->right_ = new Node(val);\n        }\n    }\n};\n```\n\næµ‹è¯•\n\n```cpp\nint main()\n{\n    int ar[] = {58, 24, 67, 0, 34, 62, 69, 5, 41, 64, 78};\n    BSTree<int> bst;\n    for(int val : ar)\n    {\n        bst.n_insert(val);\n    }\n    bst.n_insert(12);\n    return 0;\n}\n```\n\n## æ›´ç®€æ´çš„å†™æ³•\n\n```cpp\nbool Insert(AVLNode *& tree, KeyType kx)\n{\n    if(tree == nullptr)\n    {\n        tree = MakeRoot(val);\n        return true;\n    }\n    AVLNode * pa = nullptr;\n    AVLNode * p = tree;\n    while(p != nullptr && p->key != kx)\n    {\n        pa = p;\n        p = kx < p->key ? p->leftchild : p->rightchild;\n    }\n    if(p != nullptr && p->key == kx) //å·²å­˜åœ¨é‡å¤å€¼\n        return false;\n\n    //æŠŠæ–°èŠ‚ç‚¹æ’å…¥åˆ°paä¸‹\n    if(val < pa->key)\n    {\n        pa->leftchild = new Node(val);\n    }\n    else\n    {\n        pa->rightchild = new Node(val);\n    }\n    \n}\n```\n\n","categories":["é«˜çº§æ•°æ®ç»“æ„","æ ‘"]},{"title":"é«˜çº§æ•°æ®ç»“æ„_äºŒå‰æ ‘","url":"/é«˜çº§æ•°æ®ç»“æ„/é«˜çº§æ•°æ®ç»“æ„_äºŒå‰æ ‘/","content":"\n# å†…å®¹\n\n1. æ ‘ç›¸å…³æ¦‚å¿µ\n\n## è€ƒç‚¹\n\n1. CreateBinaryTree\n2. `NicePreOrder` - å‰åºéå†ã€`NiceInOrder` - ä¸­åºéå†ã€`NicePostOrder` - ååºéå†\n3. äºŒå‰æ ‘æ˜¯å¦æ˜¯å®Œå…¨äºŒå‰æ ‘ã€æ»¡äºŒå‰æ ‘ã€äºŒå‰æœç´¢æ ‘ã€å¹³è¡¡äºŒå‰æ ‘\n\n## ç›¸å…³æœ¯è¯­åŠç¿»è¯‘\n\n| æœ¯è¯­     | è‹±è¯‘                |\n| -------- | ------------------- |\n| å…ˆåºéå† | PreOrder Traversal  |\n| ä¸­åºéå† | InOrder Traversal   |\n| ååºéå† | PostOrder Traversal |\n\n# æ ‘ç›¸å…³æ¦‚å¿µ\n\nä¸‰ä¸ªå­—æ¥æ€»ç»“ï¼šä¸€å¯¹å¤šã€‚\n\næ ‘æ˜¯ç”±`n(n>=0)`ä¸ªç»“ç‚¹ç»„æˆçš„æœ‰é™é›†åˆã€‚\nå¦‚æœ`n=0`ï¼Œç§°ä¸ºç©ºæ ‘ï¼›\nå¦‚æœ`n>0`ï¼Œåˆ™æœ‰ä¸€ä¸ªç‰¹å®šçš„ç§°ä¹‹ä¸ºæ ¹`(root)`çš„ç»“ç‚¹ï¼Œ å®ƒåªæœ‰ç›´æ¥åç»§ï¼Œ ä½†æ²¡æœ‰ç›´æ¥å‰é©±ï¼›\né™¤æ ¹ä»¥å¤–çš„å…¶å®ƒç»“ç‚¹åˆ’åˆ†ä¸º`m(m>=0)`ä¸ªäº’ä¸ç›¸äº¤çš„æœ‰é™é›†åˆ$T_0, T_1, T_{m-1}$ï¼Œæ¯ä¸ªé›†åˆåˆæ˜¯ä¸€æ£µæ ‘ï¼Œå¹¶ä¸”ç§°ä¹‹ä¸ºæ ¹çš„**å­æ ‘(subTree)** ã€‚**æ¯æ£µå­æ ‘çš„æ ¹ç»“ç‚¹æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªç›´æ¥å‰é©±**ï¼Œ ä½†å¯ä»¥æœ‰0ä¸ªæˆ–å¤šä¸ªç›´æ¥åç»§ã€‚\n\n1. èŠ‚ç‚¹çš„åº¦ï¼šä¸€ä¸ªèŠ‚ç‚¹å«æœ‰çš„å­æ ‘çš„ä¸ªæ•°ï¼ˆç›´æ¥åç»§èŠ‚ç‚¹ï¼‰ã€‚\n2. æ ‘çš„åº¦ï¼šä¸€æ£µæ ‘ä¸­ï¼Œæ‰€æœ‰èŠ‚ç‚¹çš„åº¦ä¸­çš„æœ€å¤§å€¼ã€‚\n3. å¶èŠ‚ç‚¹ï¼ˆç»ˆç«¯èŠ‚ç‚¹ï¼‰ï¼šåº¦ä¸º0çš„èŠ‚ç‚¹ã€‚\n4. éå¶èŠ‚ç‚¹ï¼ˆåˆ†æ”¯èŠ‚ç‚¹ï¼‰ï¼šåº¦ä¸ä¸º0çš„èŠ‚ç‚¹ã€‚\n5. çˆ¶èŠ‚ç‚¹ï¼ˆåŒäº²ï¼‰ï¼šè‹¥ä¸€ä¸ªèŠ‚ç‚¹å«æœ‰å­èŠ‚ç‚¹ï¼Œåˆ™æ˜¯å…¶å­èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼›æŸèŠ‚ç‚¹çš„ç›´æ¥å‰é©±èŠ‚ç‚¹ã€‚\n6. å­èŠ‚ç‚¹ï¼ˆå­©å­ï¼‰ï¼šä¸€ä¸ªèŠ‚ç‚¹çš„å­—æ ‘çš„æ ¹èŠ‚ç‚¹ï¼ˆæˆ–ç›´æ¥åç»§èŠ‚ç‚¹ï¼‰ã€‚\n7. å…„å¼ŸèŠ‚ç‚¹ï¼šæœ‰ç›¸åŒçˆ¶èŠ‚ç‚¹çš„èŠ‚ç‚¹äº’ç§°ä¸ºå…„å¼ŸèŠ‚ç‚¹ã€‚\n8. èŠ‚ç‚¹çš„å±‚æ¬¡ï¼šä»æ ¹å¼€å§‹å®šä¹‰èµ·ï¼Œ**æ ¹ä¸ºç¬¬1å±‚**ï¼Œæ ¹çš„å­èŠ‚ç‚¹ä¸ºç¬¬2å±‚ï¼Œä»¥æ­¤ç±»æ¨ã€‚\n9. æ·±åº¦ï¼šå³ä»æ ¹ï¼ˆç¬¬1å±‚ï¼‰åˆ°ç¬¬nå±‚çš„è·¯å¾„é•¿ï¼Œæ ¹çš„æ·±åº¦ä¸º0ã€‚å³`å±‚æ¬¡æ•°-1`ã€‚â€”â€”åå‘äºå±‚\n10. é«˜åº¦ï¼šä»æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„ã€‚å½“åªæœ‰æ ¹èŠ‚ç‚¹æ—¶ï¼Œè·¯å¾„ä¸º0å³é«˜åº¦ä¸º0ã€‚â€”â€”åå‘äºä¸€æ¡è·¯å¾„\n11. å ‚å…„å¼ŸèŠ‚ç‚¹ï¼šå®ƒä»¬çš„çˆ¶èŠ‚ç‚¹ä¸åŒï¼Œä½†å®ƒä»¬çš„çˆ¶èŠ‚ç‚¹åœ¨åŒä¸€å±‚çš„èŠ‚ç‚¹ï¼Œäº’ä¸ºå ‚å…„å¼Ÿã€‚\n12. ç¥–å…ˆèŠ‚ç‚¹ï¼šä»æ ¹åˆ°è¯¥èŠ‚ç‚¹è·¯å¾„ä¸Šæ‰€ç»è¿‡çš„æ‰€æœ‰èŠ‚ç‚¹ï¼›æœ‰çš„è§£é‡Šä¸ºçˆ·çˆ·èŠ‚ç‚¹ã€‚\n\n# äºŒå‰æ ‘æ¦‚å¿µ\n\näºŒå‰æ ‘çš„å®šä¹‰ï¼šä¸€æ£µäºŒå‰æ ‘æ˜¯èŠ‚ç‚¹çš„ä¸€ä¸ªæœ‰é™é›†åˆï¼Œè¯¥é›†åˆæˆ–ä¸ºç©ºï¼Œæˆ–ä¸ºç”±ä¸€ä¸ªæ ¹èŠ‚ç‚¹åŠ ä¸Šä¸¤æ£µåˆ†åˆ«ç§°ä¸ºå·¦å­æ ‘å’Œå³å­æ ‘çš„äº’ä¸ç›¸äº¤çš„äºŒå‰æ ‘ç»„æˆã€‚\n\n> ä»å®šä¹‰å¯ä»¥çœ‹å‡ºï¼Œâ€œäºŒå‰æ ‘æ˜¯ç”±äºŒå‰æ ‘ç»„æˆçš„â€ï¼Œå±äºé€’å½’å¼å®šä¹‰ã€‚å¦‚æœæŸä»¶äº‹ç‰©çš„æœ¬è´¨æ˜¯é€’å½’çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬è§£å†³æ­¤ç±»äº‹ç‰©çš„æ–¹æ³•å¾€å¾€ä¹Ÿæ˜¯é€’å½’å¼çš„ã€‚\n\n## äºŒå‰æ ‘çš„æ€§è´¨\n\n1. è‹¥äºŒå‰æ ‘çš„å±‚æ¬¡ä»$0$å¼€å§‹ï¼Œåˆ™ç¬¬$i$å±‚æœ€å¤šæœ‰$2^i$ä¸ªèŠ‚ç‚¹$(i\\ge0)$ã€‚å¯ç”¨æ•°å­¦å½’çº³æ³•è¯æ˜ã€‚\n2. é«˜åº¦ä¸º$k$çš„äºŒå‰æ ‘æœ€å¤šæœ‰$2^{k+1}-1$ä¸ªèŠ‚ç‚¹$(k\\ge0)$ã€‚å¯ç”¨ç­‰æ¯”æ•°åˆ—æ±‚å’Œå…¬å¼å¾—å‡ºã€‚\n3. å¯¹äºä»»ä½•ä¸€æ£µäºŒå‰æ ‘ï¼Œå¦‚æœå¶èŠ‚ç‚¹ä¸ªæ•°ä¸º$n_0$ï¼ˆ$n$çš„ä¸‹æ ‡è¡¨ç¤ºåº¦æ•°ï¼‰ï¼Œåº¦ä¸º2çš„éå¶èŠ‚ç‚¹ä¸ªæ•°ä¸º$n_2$ï¼Œåˆ™æœ‰$n_0=n_2+1$ã€‚\n\n## ç‰¹æ®Šçš„äºŒå‰æ ‘\n\n### æ»¡äºŒå‰æ ‘ - Full Binary Tree\n\näºŒå‰æ ‘çš„æ¯ä¸€å±‚çš„èŠ‚ç‚¹æ•°éƒ½è¾¾åˆ°æœ€å¤§å€¼ã€‚\n\n![image-20220520153714340](../../images/é«˜çº§æ•°æ®ç»“æ„_äºŒå‰æ ‘/image-20220520153714340.png)\n\n### å®Œå…¨äºŒå‰æ ‘ - Complete Binary Tree\n\nè‹¥äºŒå‰æ ‘çš„é«˜åº¦ä¸º$h$ï¼Œåˆ™å…±æœ‰$h+1$å±‚ã€‚é™¤ç¬¬$h$å±‚å¤–ï¼Œå…¶ä»–å„å±‚`(0 ~ h-1)`çš„èŠ‚ç‚¹æ•°éƒ½è¾¾åˆ°æœ€å¤§ä¸ªæ•°ï¼Œç¬¬$h$å±‚ä»å³å‘å·¦**è¿ç»­ç¼º**0ä¸ªæˆ–è‹¥å¹²ä¸ªèŠ‚ç‚¹ã€‚æ»¡äºŒå‰æ ‘æ˜¯ä¸€ç§ç‰¹æ®Šçš„å®Œå…¨äºŒå‰æ ‘ã€‚\n\nå…·æœ‰$n$ä¸ªèŠ‚ç‚¹çš„å®Œå…¨äºŒå‰æ ‘çš„é«˜åº¦ä¸º$\\lceil\\log_2(n+1)\\rceil-1$ã€‚æ³¨æ„ï¼Œåªé€‚äºå®Œå…¨äºŒå‰æ ‘ï¼Œä¸é€‚äºä¸€èˆ¬çš„äºŒå‰æ ‘ã€‚\n\n> è¯æ˜ï¼šè®¾å®Œå…¨äºŒå‰æ ‘çš„é«˜åº¦ä¸º$h$ï¼Œåˆ™æœ‰\n> $$\n> \\begin{flalign}\n> &~~~~~~2^h-1<n\\le2^{h+1}-1\\\\\n> &\\Leftrightarrow 2^h<n+1\\le2^{h+1}\\\\\n> å–å¯¹æ•°&\\Leftrightarrow h<\\log_2(n+1)\\le h+1&\n> \\end{flalign}\n> $$\n\n![image-20220520154516885](../../images/é«˜çº§æ•°æ®ç»“æ„_äºŒå‰æ ‘/image-20220520154516885.png)\n\n# ä¸­åº+å‰åº/ååºåºåˆ—å»ºç«‹äºŒå‰æ ‘\n\n| éå†æ–¹å¼ | æ­¥éª¤                                           |\n| -------- | ---------------------------------------------- |\n| å…ˆåºéå† | å…ˆæ“ä½œæ ¹èŠ‚ç‚¹ï¼Œå†éå†å·¦å­æ ‘ï¼Œå†éå†å³å­æ ‘       |\n| ä¸­åºéå† | å…ˆéå†å·¦å­æ ‘ï¼Œè¿”å›åå†æ“ä½œæ ¹èŠ‚ç‚¹ï¼Œå†éå†å³å­æ ‘ |\n| ååºéå† | å…ˆéå†å·¦å­æ ‘ï¼Œå†éå†å³å­æ ‘ï¼Œå†æ“ä½œæ ¹èŠ‚ç‚¹ã€‚     |\n\n\n\n![image-20220520163512650](../../images/é«˜çº§æ•°æ®ç»“æ„_äºŒå‰æ ‘/image-20220520163512650.png)\n\nå¦‚æ­¤ä¸€æ£µäºŒå‰æ ‘ã€‚æ‰‹å†™å‡ºä¸‰ç§æ–¹å¼éå†çš„åºåˆ—ï¼š\n\n```\nå…ˆåºéå†ï¼šABCDEFGH\nä¸­åºéå†ï¼šCBEDFAGH\nååºéå†ï¼šCEFDBHGA\n```\n\næˆ‘ä»¬è§‚å¯Ÿæ‰‹å†™å‡ºæ¥çš„å…ˆåºéå†åºåˆ—å’Œä¸­åºéå†åºåˆ—ï¼Œå‘ç°è§„å¾‹ã€‚\n\nåœ¨å…ˆåºéå†ä¸­å¯ä»¥çœ‹å‡ºï¼ŒAä¸ºæ ¹èŠ‚ç‚¹ï¼Œä»¥Aä¸ºåŸºå‡†ï¼Œå†æŠŠç›®å…‰è½¬å‘ä¸­åºéå†ï¼Œåˆ™å¯ä»¥çœ‹å‡ºä»¥Aåˆ’åˆ†å‡ºäº†`CBEDF`å’Œ`GH`ï¼Œè€Œè¿™ä¹Ÿåˆ†åˆ«å¯¹åº”AèŠ‚ç‚¹çš„å·¦å­æ ‘å’Œå³å­æ ‘ã€‚\næŒ‰ç…§è¿™ä¸ªè§„å¾‹ï¼Œå†çœ‹å…ˆåºéå†ï¼ŒAåé¢ä¸€ä¸ªæ˜¯Bï¼Œä»¥Bä¸ºåŸºå‡†ï¼Œå†æŠŠç›®å…‰è½¬å‘ä¸­åºéå†ï¼Œåˆ™å¯ä»¥çœ‹å‡ºä»¥Båˆ’åˆ†å‡ºäº†`C`å’Œ`EDF`ï¼Œè€Œè¿™ä¹Ÿåˆ†åˆ«å¯¹åº”BèŠ‚ç‚¹çš„å·¦å­æ ‘å’Œå³å­æ ‘ã€‚\n......\nå› æ­¤å¯ä»¥æ ¹æ®ä¸­åºéå†åºåˆ—å’Œå…ˆåº/ååºéå†åºåˆ—çš„å…¶ä¸­ä¸€ç§æ¥å¤ç”»äºŒå‰æ ‘é€»è¾‘ç»“æ„ã€‚\n\nç”±æ­¤ï¼Œç›¸åº”åœ°ï¼Œæˆ‘ä»¬çš„ä»£ç é€»è¾‘ä¹Ÿæµ®äºæ°´é¢ã€‚å…ˆæ¥çœ‹æ ¹æ®å‰åºã€ä¸­åºåºåˆ—æ¥åˆ›å»ºäºŒå‰æ ‘ä»£ç ã€‚\n\n```cpp\nBtNode* CreatePreIn(const char * pre_str, const char * in_str, int len)\n{\n    BtNode * s = NULL;\n    if(len >= 1)\n    {\n        s = Buynode();\n        s->data = pre_str[0];\n        int pos = FindInStr(in_str, len, pre_str[0]);\n        if(pos == -1)\n        {\n            exit(1);\n        }\n        s->left  = CreatePreIn(pre_str+1, in_str, pos);\t//å·¦å­æ ‘\n        s->right = CreatePreIn(pre_str+pos+1, in_str+pos+1, len-pos-1);//å³å­æ ‘\n    }\n    return s;\n}\n```\n\næµ‹è¯•\n\n```cpp\n#include<iostream>\n#include<cassert>\n#include<cstring>\nusing namespace std;\ntypedef char ElemType;\ntypedef struct BtNode\n{\n    BtNode * left;\n    BtNode * right;\n    ElemType data;\n}BtNode, *BinaryTree;\nBtNode* Buynode()\n{\n    BtNode * s = (BtNode*)malloc(sizeof(BtNode));\n    if(s == NULL)\n    {\n        exit(1);\n    }\n    return s;\n}\nint FindInStr(const char * in_str, int len, char ch)\n{\n    assert(in_str != NULL);\n    int pos = -1;\n    int i = 0;\n    while(i < len)\n    {\n        if(in_str[i]==ch)\n        {\n            pos = i;\n            break;\n        }\n        ++i;\n    }\n    return pos;\n}\nBtNode* CreatePreIn(const char * pre_str, const char * in_str, int len)\n{\n    BtNode * s = NULL;\n    if(len >= 1)\n    {\n        s = Buynode();\n        s->data = pre_str[0];\n        int pos = FindInStr(in_str, len, pre_str[0]);\n        if(pos == -1)\n        {\n            exit(1);\n        }\n        s->left  = CreatePreIn(pre_str+1, in_str, pos);\t//å·¦å­æ ‘\n        s->right = CreatePreIn(pre_str+pos+1, in_str+pos+1, len-pos-1);//å³å­æ ‘\n    }\n    return s;\n}\nBtNode* CreateTreePreIn(const char * pre_str, const char * in_str)\n{\n    if(pre_str == NULL || in_str == NULL)return NULL;\n    int pre_len = strlen(pre_str);\n    int in_len = strlen(in_str);\n    if(pre_len != in_len)return NULL;\n    return CreatePreIn(pre_str, in_str, pre_len);\n}\nvoid PrintPre(BinaryTree bt)\n{\n    if(bt == NULL)return;\n    cout << bt->data << \" \";\n    PrintPre(bt->left);\n    PrintPre(bt->right);\n}\nvoid PrintIn(BinaryTree bt)\n{\n    if(bt == NULL)return;\n    PrintIn(bt->left);\n    cout << bt->data << \" \";\n    PrintIn(bt->right);\n}\nvoid PrintPost(BinaryTree bt)\n{\n    if(bt == NULL)return;\n    PrintPost(bt->left);\n    PrintPost(bt->right);\n    cout << bt->data << \" \";\n}\nint main()\n{\n    BinaryTree root = NULL;\n    char pre_str[] = {\"ABCDEFGH\"};\n    char in_str[] = {\"CBEDFAGH\"};\n    root = CreateTreePreIn(pre_str, in_str);\n    PrintPre(root); cout << endl;\n    PrintIn(root); cout << endl;\n    PrintPost(root); cout << endl;\n    return 0;\n}\n```\n\nè¿è¡Œç»“æœ\n\n![image-20220520180445645](../../images/é«˜çº§æ•°æ®ç»“æ„_äºŒå‰æ ‘/image-20220520180445645.png)\n\nç›¸åº”åœ°ï¼Œå¯ä»¥å¾—å‡ºååºã€ä¸­åºåºåˆ—å»ºç«‹äºŒå‰æ ‘ä»£ç \n\n```cpp\n#include<iostream>\n#include<cassert>\n#include<cstring>\nusing namespace std;\ntypedef char ElemType;\ntypedef struct BtNode\n{\n    BtNode * left;\n    BtNode * right;\n    ElemType data;\n}BtNode, *BinaryTree;\nBtNode* Buynode()\n{\n    BtNode * s = (BtNode*)malloc(sizeof(BtNode));\n    if(s == NULL)\n    {\n        exit(1);\n    }\n    return s;\n}\nint FindInStr(const char * in_str, int len, char ch)\n{\n    assert(in_str != NULL);\n    int pos = -1;\n    int i = 0;\n    while(i < len)\n    {\n        if(in_str[i]==ch)\n        {\n            pos = i;\n            break;\n        }\n        ++i;\n    }\n    return pos;\n}\nBtNode* CreatePostIn(const char * post_str, const char * in_str, int len)\n{\n    BtNode * s = NULL;\n    if(len >= 1)\n    {\n        s = Buynode();\n        s->data = post_str[len-1];\n        int pos = FindInStr(in_str, len, post_str[len-1]);\n        if(pos == -1)\n        {\n            exit(1);\n        }\n        s->left  = CreatePostIn(post_str, in_str, pos);\t               //å·¦å­æ ‘\n        s->right = CreatePostIn(post_str+pos, in_str+pos+1, len-pos-1);//å³å­æ ‘\n    }\n    return s;\n}\nBtNode* CreateTreePostIn(const char * post_str, const char * in_str)\n{\n    if(post_str == NULL || in_str == NULL)return NULL;\n    int pre_len = strlen(post_str);\n    int in_len = strlen(in_str);\n    if(pre_len != in_len)return NULL;\n    return CreatePostIn(post_str, in_str, pre_len);\n}\nvoid PrintPre(BinaryTree bt)\n{\n    if(bt == NULL)return;\n    cout << bt->data << \" \";\n    PrintPre(bt->left);\n    PrintPre(bt->right);\n}\nvoid PrintIn(BinaryTree bt)\n{\n    if(bt == NULL)return;\n    PrintIn(bt->left);\n    cout << bt->data << \" \";\n    PrintIn(bt->right);\n}\nvoid PrintPost(BinaryTree bt)\n{\n    if(bt == NULL)return;\n    PrintPost(bt->left);\n    PrintPost(bt->right);\n    cout << bt->data << \" \";\n}\nint main()\n{\n    BinaryTree root = NULL;\n    char pre_str[] = {\"ABCDEFGH\"};\n    char in_str[] = {\"CBEDFAGH\"};\n    char post_str[] = {\"CEFDBHGA\"};\n    root = CreateTreePostIn(post_str, in_str);\n    PrintPre(root); cout << endl;\n    PrintIn(root); cout << endl;\n    PrintPost(root); cout << endl;\n    return 0;\n}\n```\n\n\n\n![image-20220520183237682](../../images/é«˜çº§æ•°æ®ç»“æ„_äºŒå‰æ ‘/image-20220520183237682.png)\n\n# éé€’å½’éå†é“¾å¼å­˜å‚¨äºŒå‰æ ‘\n\n## å‰åºéå†\n\nä¸€ä¸ªæ ˆï¼Œå…ˆå…¥å³ï¼Œåå…¥å·¦ã€‚\n\n```cpp\n#include<iostream>\n#include<stack>\nusing namespace std;\ntypedef struct TreeNode\n{\n    TreeNode* left;\n    TreeNode* right;\n    int val;\n}TreeNode;\nvoid preorderTraversal(TreeNode* root)\n{\n    TreeNode* cur = root;\n    stack<TreeNode*> st;\n    st.push(cur);\n    while (!st.empty())\n    {\n        cur = st.top();\n        st.pop();\n        cout << cur->val;\n        if (cur->right != nullptr)\n        {\n            st.push(cur->right);\n        }\n        if (cur->left != nullptr)\n        {\n            st.push(cur->left);\n        }\n    }\n}\n```\n\n## ä¸­åºéå†\n\nä¸€ä¸ªæ ˆã€‚\n\n1. æŒ‡é’ˆæ‰€æŒ‡èŠ‚ç‚¹çš„å·¦ä¸ä¸ºç©ºæ—¶ï¼Œå…¥æ ˆå·¦å­æ ‘\n2. å·¦ç©ºåˆ™å‡ºæ ˆå›é€€ï¼ŒæŒ‡é’ˆæŒ‡å‘å‡ºæ ˆçš„èŠ‚ç‚¹ï¼ˆçˆ¶èŠ‚ç‚¹ï¼‰\n3. æ‰“å°\n4. æŒ‡é’ˆæŒ‡å‘å³å­æ ‘\n5. å¾ªç¯\n\n```cpp\n#include<stack>\n\nvoid inorderTraversal(TreeNode* root)\n{\n    stack<TreeNode*> st;\n    TreeNode* cur = root;\n    while(!st.empty() || cur != NULL)\n    {\n        while(cur != NULL)\n        {\n            st.push(cur);\n            cur = cur->left;\n        }\n        cur = st.top();\n        st.pop();\n        cout << cur->val;\n        cur = cur->right;\n    }\n}\n```\n\nè¿˜æœ‰ä¸€ç§å†™æ³•ï¼Œåªæ˜¯å¾ªç¯çš„å½¢å¼ç¨æœ‰ä¸åŒã€‚\n\n```cpp\n#include<stack>\nvoid inorderTraversal(TreeNode* root)\n{\n    stack<TreeNode*> st;\n    TreeNode* cur = root;\n    while(!st.empty() || cur != NULL)\n    {\n        if(cur != NULL)\n        {\n            st.push(cur);\n            cur = cur->left;\n        }\n        else\n        {\n            cur = st.top();\n            st.pop();\n            cout << cur->val;\n            cur = cur->right;\n        }\n    }\n}\n```\n\n## ååºéå†\n\nä¸¤ç§æ–¹æ³•ã€‚\n\n### åŒæ ˆæ³•\n\næ¨¡ä»¿å‰åºéå†ï¼Œä½†æ˜¯éœ€è¦å¦å¤–ä¸€ä¸ªæ ˆæ¥è®°å½•ã€‚\n\n```cpp\nvoid postorderTraversal(TreeNode* root)\n{\n    TreeNode* cur = root;\n    stack<TreeNode*> st;\n    stack<int> ist;\n    st.push(cur);\n    while (!st.empty())\n    {\n        cur = st.top();\n        st.pop();\n        ist.push(cur->val);\n        if (cur->left != nullptr)\n        {\n            st.push(cur->left);\n        }\n        if (cur->right != nullptr)\n        {\n            st.push(cur->right);\n        }\n    }\n    while (!ist.empty())\n    {\n        cout << ist.top();\n        ist.pop();\n    }\n}\n```\n\n### è¿­ä»£æ³•\n\nä»æ˜¯å•æ ˆï¼Œä½†éœ€è¦ä¸€ä¸ªtagæ ‡è®°æŒ‡é’ˆæ¥è®°å½•å·²ç»è®¿é—®è¿‡å“ªä¸ªèŠ‚ç‚¹ã€‚\n\n```cpp\n#include<stack>\n#include<vector>\n#include<iostream>\nusing namespace std;\ntypedef struct TreeNode\n{\n    TreeNode* left;\n    TreeNode* right;\n    int val;\n}TreeNode;\nclass Solution {\npublic:\n    vector<int> postorderTraversal(TreeNode* root) {\n        vector<int> v;\n        stack<TreeNode*> st;\n        TreeNode* cur = root;\n        TreeNode* tag = nullptr;\n        while (cur != nullptr || !st.empty())\n        {\n            while (cur != nullptr)\n            {\n                st.push(cur);\n                cur = cur->left;\n            }\n            cur = st.top();\n            st.pop();\n            if (cur->right == nullptr || cur->right == tag)\n            {\n                tag = cur;\n                v.push_back(cur->val);\n                cout << cur->val;\n                cur = nullptr;  //ä¸æ˜“å†™å‡ºã€‚\n            }\n            else\n            {\n                st.push(cur);\n                cur = cur->right;\n            }\n        }\n        return v;\n    }\n};\nint main()\n{\n    TreeNode n3 = { nullptr, nullptr, 3 };\n    TreeNode n2 = { &n3, nullptr, 2 };\n    TreeNode n1 = { nullptr, &n2, 1 };\n    Solution s;\n    s.postorderTraversal(&n1);\n}\n```\n\n","categories":["é«˜çº§æ•°æ®ç»“æ„","æ ‘"]},{"title":"MySQL_å­˜å‚¨å¼•æ“","url":"/æ•°æ®åº“/MySQL_å­˜å‚¨å¼•æ“/","content":"# å­˜å‚¨å¼•æ“\n\nMySQLçš„ä¸€å¤§ç‰¹ç‚¹å°±æ˜¯æ”¯æŒæ’ä»¶å¼çš„å­˜å‚¨å¼•æ“ï¼Œå³å…¶å­˜å‚¨å¼•æ“æ˜¯å¯æ›´æ¢çš„ï¼Œæ”¯æŒä¸åŒçš„å­˜å‚¨å¼•æ“ã€‚\n\né‚£ä¹ˆï¼Œå­˜å‚¨å¼•æ“ä»£è¡¨çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ\n\nåœ¨åˆ›å»º/ä½¿ç”¨è¡¨æ—¶ï¼Œæœ‰ä¸‰å¤§éƒ¨åˆ†éœ€è¦ç®¡ç†ï¼š\n\n1. è¡¨çš„ç»“æ„ï¼ˆæœ‰å‡ ä¸ªå­—æ®µï¼Œå­—æ®µçš„ç±»å‹ï¼Œçº¦æŸæ¡ä»¶ï¼‰\n2. æ•°æ®\n3. ç´¢å¼•ï¼ˆæœ‰åˆ©äºåŠ é€Ÿè¡¨çš„æŸ¥è¯¢ï¼‰\n\nå­˜å‚¨å¼•æ“ç›´æ¥å½±å“ä»¥ä¸Šä¸‰å¤§éƒ¨åˆ†å†…å®¹çš„å­˜å‚¨æ–¹å¼ã€‚å³ï¼Œä¸åŒçš„å­˜å‚¨å¼•æ“ï¼Œå¯¹åº”çš„æ•°æ®åŠå…¶ç»“æ„çš„å­˜å‚¨æ–¹å¼æ˜¯ä¸ä¸€æ ·çš„ã€‚\n\n# é…ç½®æ–‡ä»¶\n\nwindowsä¸‹æ˜¯`my.ini`\n\nLinuxä¸‹æ˜¯`my.cnf`ï¼Œåœ¨`/etc`ä¸‹ã€‚\n\n# æ•°æ®åº“ã€è¡¨å¯¹åº”çš„æ–‡ä»¶\n\néƒ½å­˜åˆ°äº†`/var/lib/mysql`ä¸‹ã€‚\n\nå¯¹è¯¥ç›®å½•è¿›è¡Œè¯»å–æ—¶éœ€è¦è¿›å…¥rootç”¨æˆ·æ¨¡å¼ã€‚\n\n1. `ls`åå‘ç°ï¼Œæ¯ä¸ªæ•°æ®åº“éƒ½ä¼šæœ‰ä¸€ä¸ªåŒåçš„æ–‡ä»¶å¤¹ï¼Œé‡Œé¢å­˜æ”¾ç€åº“ä¸­çš„è¡¨ã€‚\n2. è¿›ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå‘ç°é‡Œé¢æ¯ä¸€å¼ è¡¨éƒ½å¯¹åº”æœ‰å¤šç§åç¼€åä¸åŒçš„æ–‡ä»¶ã€‚\n    1. `.frm`è¡¨ç¤ºè¡¨çš„æ¡†æ¶ä¿¡æ¯ï¼Œå³frameã€‚MyISAMå’ŒInnoDBå­˜å‚¨å¼•æ“éƒ½è¦ç”¨ã€‚\n    2. `.MYD`ã€`.MYI`æ˜¯MyISAMå­˜å‚¨å¼•æ“ä¸‹çš„æ•°æ®è¡¨çš„æ–‡ä»¶ã€‚\n        1. `.MYD`è¡¨ç¤ºä½¿ç”¨MyISAMå¼•æ“çš„è¡¨çš„æ•°æ®ä¿¡æ¯ï¼Œå³MyISAM Dataã€‚\n        2. `.MYI`è¡¨ç¤ºä½¿ç”¨MyISAMå¼•æ“çš„è¡¨çš„ç´¢å¼•ä¿¡æ¯ï¼Œå³MyISAM Indexã€‚\n    3. `.ibd`æ˜¯InnoDBå­˜å‚¨å¼•æ“ä¸‹çš„æ•°æ®è¡¨çš„æ–‡ä»¶ï¼ŒåŒæ—¶å­˜å‚¨äº†è¡¨çš„æ•°æ®ä¿¡æ¯å’Œç´¢å¼•ä¿¡æ¯ã€‚\n\n> å¯ä»¥ä»è¡¨çš„æ•°æ®æ–‡ä»¶çš„å­˜å‚¨æ–¹å¼ - å»¶ä¼¸åˆ°ç´¢å¼•ä¸Š\n\n## æ€»ç»“\n\n1. InnoDBçš„åº•å±‚æ–‡ä»¶å­˜å‚¨æ˜¯`.frm`+`.ibd`ï¼Œå…¶ä¸­`.frm`å­˜å‚¨çš„æ˜¯è¡¨çš„ç»“æ„ï¼Œ`.ibd`å­˜å‚¨çš„æ˜¯æ•°æ®+ç´¢å¼•ï¼›\n2. MyISAMçš„åº•å±‚æ–‡ä»¶ï¼Œè¡¨ç»“æ„ã€è¡¨æ•°æ®ã€è¡¨ç´¢å¼•ï¼Œå„æœ‰ä¸€ä¸ªå¯¹åº”çš„æ–‡ä»¶ã€‚\n\n# ç›¸å…³å‘½ä»¤\n\n```mysql\nSHOW engines;\n```\n\n![image-20220519140553878](../../images/MySQL_å­˜å‚¨å¼•æ“/image-20220519140553878.png)\nMyISAMä¸æ”¯æŒäº‹åŠ¡ã€‚\nInnoDBæ”¯æŒäº‹åŠ¡ã€‚\nå¦‚æœä»…ä½œæŸ¥è¯¢ï¼Œåˆ™MyISAMæ¯”InnoDBè½»é‡çº§ã€‚\n# å„å­˜å‚¨å¼•æ“åŒºåˆ«\n\n| å­˜å‚¨å¼•æ“   | é”æœºåˆ¶ | Bæ ‘ç´¢å¼• | å“ˆå¸Œç´¢å¼•   | å¤–é”®      | äº‹åŠ¡      | ç´¢å¼•ç¼“å­˜ | æ•°æ®ç¼“å­˜    |\n| ------ | --- | ---- | ------ | ------- | ------- | ---- | ------- |\n| MyISAM | è¡¨é”  | æ”¯æŒ   | ä¸æ”¯æŒ    | **ä¸æ”¯æŒ** | **ä¸æ”¯æŒ** | æ”¯æŒ   | **ä¸æ”¯æŒ** |\n| InnoDB | è¡Œé”  | æ”¯æŒ   | ä¸æ”¯æŒ    | æ”¯æŒ      | æ”¯æŒ      | æ”¯æŒ   | æ”¯æŒ      |\n| Memory | è¡¨é”  | æ”¯æŒ   | **æ”¯æŒ** | ä¸æ”¯æŒ     | ä¸æ”¯æŒ     | æ”¯æŒ   | æ”¯æŒ      |\n\n**é”æœºåˆ¶**ï¼šè¡¨ç¤ºæ•°æ®åº“åœ¨å¹¶å‘è¯·æ±‚è®¿é—®çš„æ—¶å€™ï¼Œå¤šä¸ªäº‹åŠ¡åœ¨æ“ä½œæ—¶ï¼Œå¹¶å‘æ“ä½œçš„ç²’åº¦ã€‚\n\n**Bæ ‘ç´¢å¼•ã€å“ˆå¸Œç´¢å¼•**ï¼šåŠ é€ŸSQLçš„æŸ¥è¯¢é€Ÿåº¦ã€‚\n\n**å¤–é”®**ï¼šå­è¡¨çš„å­—æ®µä¾èµ–çˆ¶è¡¨çš„ä¸»é”®ï¼Œè®¾ç½®äº†ä¸¤å¼ è¡¨çš„ä¾èµ–å…³ç³»ã€‚\n\n**äº‹åŠ¡**ï¼šå¤šä¸ªSQLè¯­å¥ï¼Œä¿è¯å®ƒä»¬å…±åŒæ‰§è¡Œçš„åŸå­æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ã€‚ä¸èƒ½åªæˆåŠŸä¸€éƒ¨åˆ†ï¼Œå¤±è´¥åéœ€è¦å›æ»šäº‹åŠ¡ã€‚\n\n**ç´¢å¼•ç¼“å­˜å’Œæ•°æ®ç¼“å­˜**ï¼šå’ŒMySQL Serverçš„æŸ¥è¯¢ç¼“å­˜ç›¸å…³ï¼Œåœ¨æ²¡æœ‰å¯¹æ•°æ®å’Œç´¢å¼•åšä¿®æ”¹ä¹‹å‰ï¼Œé‡å¤æŸ¥è¯¢å¯ä»¥ä¸ç”¨è¿›è¡Œç£ç›˜IOï¼Œè¯»å–ä¸Šä¸€æ¬¡å†…å­˜ä¸­æŸ¥è¯¢çš„ç¼“å­˜å°±å¯ä»¥äº†ï¼Œæå‡æ•°æ®åº“çš„æ€§èƒ½ã€‚\n## æ€»ç»“\nMyISAMä¸æ”¯æŒäº‹åŠ¡ã€ä¹Ÿä¸æ”¯æŒå¤–é”®ã€‚\n# æ•°æ®çš„å­˜å‚¨æ–¹å¼\n## MyISAM\nMyISAMç´¢å¼•é‡‡ç”¨**éèšé›†ç´¢å¼•**ï¼Œå…¶ä¼˜åŠ¿æ˜¯è®¿é—®çš„é€Ÿåº¦å¿«ï¼Œå¯¹äº‹åŠ¡å®Œæ•´æ€§æ²¡æœ‰è¦æ±‚ï¼Œä»¥`SELECT`ã€`INSERT`ä¸ºä¸»çš„åº”ç”¨åŸºæœ¬ä¸Šéƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªå­˜å‚¨å¼•æ“æ¥åˆ›å»ºè¡¨ã€‚\n\n**MyISAM**çš„è¡¨åœ¨ç£ç›˜ä¸Šå­˜å‚¨æˆ 3 ä¸ªæ–‡ä»¶ï¼Œå…¶æ–‡ä»¶åéƒ½å’Œè¡¨åç›¸åŒï¼Œæ‰©å±•ååˆ†åˆ«æ˜¯ï¼š\n`.frm`ï¼ˆå­˜å‚¨è¡¨å®šä¹‰ï¼‰\n`.MYD`ï¼ˆMYDataï¼Œå­˜å‚¨æ•°æ®ï¼‰\n`.MYI`ï¼ˆMYIndexï¼Œå­˜å‚¨ç´¢å¼•ï¼‰\n## InnoDB\n**InnoDB**å­˜å‚¨å¼•æ“æä¾›äº†å…·æœ‰æäº¤ã€å›æ»šå’Œå´©æºƒæ¢å¤èƒ½åŠ›çš„äº‹åŠ¡å®‰å…¨ï¼Œæ”¯æŒè‡ªåŠ¨å¢é•¿åˆ—ï¼Œå¤–é”®ç­‰åŠŸèƒ½ï¼Œç´¢å¼•é‡‡ç”¨**èšé›†ç´¢å¼•**ï¼Œç´¢å¼•å’Œæ•°æ®å­˜å‚¨åœ¨åŒä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥InnoDBçš„è¡¨åœ¨ç£ç›˜ä¸Šæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼Œå…¶æ–‡ä»¶åéƒ½å’Œè¡¨åç›¸åŒï¼Œæ‰©å±•ååˆ†åˆ«æ˜¯ï¼š\n`.frm`ï¼ˆå­˜å‚¨è¡¨çš„å®šä¹‰ï¼‰\n`.ibd`ï¼ˆå­˜å‚¨æ•°æ®å’Œç´¢å¼•ï¼‰\n![](../../images/MySQL_ç´¢å¼•/image-20250730200406795.png)\n![](../../images/MySQL_ç´¢å¼•/image-20250730200415545.png)\n## MEMORY\n**MEMORY**å­˜å‚¨å¼•æ“ä½¿ç”¨å­˜åœ¨å†…å­˜ä¸­çš„å†…å®¹æ¥åˆ›å»ºè¡¨ã€‚\næ¯ä¸ªMEMORYè¡¨å®é™…**åªå¯¹åº”ä¸€ä¸ªç£ç›˜æ–‡ä»¶ï¼Œæ ¼å¼æ˜¯.frm**ï¼ˆè¡¨ç»“æ„å®šä¹‰ï¼‰ã€‚\nMEMORYç±»å‹çš„è¡¨è®¿é—®éå¸¸å¿«ï¼Œå› ä¸ºå®ƒçš„æ•°æ®æ˜¯æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œå¹¶ä¸”é»˜è®¤ä½¿ç”¨**HASHç´¢å¼•**ï¼ˆä¸é€‚åˆåšèŒƒå›´æŸ¥è¯¢ï¼‰ï¼Œä½†æ˜¯ä¸€æ—¦æœåŠ¡å…³é—­ï¼Œè¡¨ä¸­çš„æ•°æ®å°±ä¼šä¸¢å¤±æ‰ã€‚\n\n## ç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯å¦åˆ†ç¦»é€ æˆçš„ç»“æœ\nè§[MySQL_ç´¢å¼•.md - ä¸€æ¬¡select whereè¿‡æ»¤æ¡ä»¶æŸ¥è¯¢æ‰€ç»å†çš„äº‹æƒ…](MySQL_ç´¢å¼•.md#ä¸€æ¬¡select%20whereè¿‡æ»¤æ¡ä»¶æŸ¥è¯¢æ‰€ç»å†çš„äº‹æƒ…)ã€‚","categories":["æ•°æ®åº“","MySQL"]},{"title":"MySQL_ç´¢å¼•","url":"/æ•°æ®åº“/MySQL_ç´¢å¼•/","content":"# å†…å®¹\n1. ç´¢å¼•\n2. æ€ä¹ˆåˆ›å»ºç´¢å¼•\n3. æ€ä¹ˆä¼˜åŒ–ç´¢å¼•\n4. æ€ä¹ˆåˆ†æç´¢å¼•çš„å¥½å\n5. ç´¢å¼•çš„åˆ›å»ºã€åˆ é™¤ã€ä½¿ç”¨\n6. explainåˆ†æç›¸å…³SQLè¯­å¥\n7. æ€»ç»“ - ä½¿ç”¨ç´¢å¼•æ—¶éœ€è¦æ³¨æ„çš„\n# æ•°æ®åº“æ–‡ä»¶å­˜åœ¨å“ªé‡Œï¼Ÿ\nåŒä¸€æ•°æ®åº“çš„ä¸åŒè¡¨ï¼Œå­˜æ”¾åœ¨ä¸åŒçš„æ–‡ä»¶é‡Œã€‚\nè¯¦è§ã€Š[MySQL_å­˜å‚¨å¼•æ“ - æ•°æ®çš„å­˜å‚¨æ–¹å¼](MySQL_å­˜å‚¨å¼•æ“#æ•°æ®çš„å­˜å‚¨æ–¹å¼)ã€‹\n# ä¸ºä»€ä¹ˆè¦æœ‰ç´¢å¼•\n\nå½“è¡¨ä¸­çš„æ•°æ®é‡åˆ°è¾¾å‡ åä¸‡ç”šè‡³ä¸Šç™¾ä¸‡çš„æ—¶å€™ï¼ŒSQLæŸ¥è¯¢æ‰€èŠ±è´¹çš„æ—¶é—´ä¼šå¾ˆé•¿ï¼Œå¯¼è‡´ä¸šåŠ¡è¶…æ—¶å‡ºé”™ï¼Œæ­¤æ—¶å°±éœ€è¦ç”¨ç´¢å¼•æ¥åŠ é€ŸSQLæŸ¥è¯¢ã€‚\n# ç´¢å¼•çš„æœ¬è´¨\n\nç´¢å¼•ä¹Ÿæ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ï¼ŒB+æ ‘ã€‚ä¸ç”¨çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯ä¼šå­˜åœ¨ç£ç›˜ä¸Šçš„ã€‚\n# ç´¢å¼•çš„åŒé¢æ€§\nç”±äºç´¢å¼•ä¹Ÿæ˜¯éœ€è¦å­˜å‚¨æˆç´¢å¼•æ–‡ä»¶çš„ï¼Œå› æ­¤å¯¹ç´¢å¼•çš„ä½¿ç”¨ä¹Ÿä¼šæ¶‰åŠç£ç›˜I/Oæ“ä½œã€‚å¦‚æœç´¢å¼•åˆ›å»ºè¿‡å¤šï¼Œä½¿ç”¨ä¸å½“ï¼Œä¼šé€ æˆSQLæŸ¥è¯¢æ—¶å¤§é‡æ— ç”¨çš„ç£ç›˜I/Oæ“ä½œï¼Œé™ä½äº†SQLçš„æŸ¥è¯¢æ•ˆç‡ï¼Œå°±ä¼šé€‚å¾—å…¶åï¼Œå› æ­¤æŒæ¡è‰¯å¥½çš„ç´¢å¼•åˆ›å»ºåŸåˆ™éå¸¸é‡è¦ï¼\n\né™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœè¦å¯¹æŸåˆ—å»ºç«‹ç´¢å¼•ï¼Œå­˜å‚¨å¼•æ“ä¼šå¯¹åˆ—å¯¹åº”çš„è¡Œè¿›è¡Œæ’åˆ—ï¼Œå½“æ›´æ–°è¡¨å†…å®¹æ—¶ï¼Œä¸ä»…ä»…ä¼šæ”¹å˜æ•°æ®ï¼Œç´¢å¼•çš„æ–‡ä»¶ä¹Ÿæ˜¯è¦æ”¹åŠ¨çš„ã€‚å¦‚æœç´¢å¼•æ•°ç›®è¿‡å¤šï¼Œåˆ™ç‰µæ‰¯åˆ°çš„æ”¹åŠ¨ä¹Ÿä¼šè¿‡å¤šã€‚\n# ç´¢å¼•çš„åˆ†ç±»\nä»ä¸¤ä¸ªæ–¹é¢æ¥çœ‹ï¼šç‰©ç†ä¸Š/é€»è¾‘ä¸Š\n## ç‰©ç†ä¸Š\nå¯åˆ†ä¸ºï¼šèšé›†ç´¢å¼•ã€éèšé›†ç´¢å¼•ï¼ˆæœ‰çš„é«˜å¤§ä¸Šçš„å«æ³•ä¹Ÿå«â€œèšç°‡â€ï¼‰\n## é€»è¾‘ä¸Š\nå¯åˆ†ä¸ºï¼š\n1. æ™®é€šç´¢å¼•ï¼ˆåˆç§°ä¸ºäºŒçº§ç´¢å¼•ï¼‰ï¼šä¸»åŠ¨ã€æ‰‹åŠ¨åˆ›å»ºçš„ç´¢å¼•ã€‚\n    1. æ²¡æœ‰ä»»ä½•é™åˆ¶æ¡ä»¶ï¼Œå¯ä»¥ç»™ä»»ä½•ç±»å‹çš„å­—æ®µåˆ›å»ºæ™®é€šç´¢å¼•ã€‚\n    2. å¯åœ¨åˆ›å»ºæ–°è¡¨æ—¶æŒ‡å®šå»ºç«‹ç´¢å¼•ï¼Œä¹Ÿå¯ç»™å·²åˆ›å»ºè¡¨æŒ‡å®šå»ºç«‹ç´¢å¼•\n    3. ç´¢å¼•æ•°é‡ä¸é™ï¼Œä½†æ˜¯ä¸å»ºè®®è¿‡å¤šï¼›æœ‰çš„å­˜å‚¨å¼•æ“å¯èƒ½å¯¹è¡¨çš„ç´¢å¼•æ•°é‡æœ‰é™åˆ¶ã€‚\n    4. ä¸€å¼ è¡¨çš„ä¸€æ¬¡SQLæŸ¥è¯¢åªèƒ½ç”¨1ä¸ªç´¢å¼•ï¼Œé€šå¸¸æ˜¯ç”¨whereçš„è¿‡æ»¤æ¡ä»¶ä¸­çš„æŸä¸ªå­—æ®µã€‚\n2. å”¯ä¸€æ€§ç´¢å¼•\n    1. ä½¿ç”¨UNIQUEä¿®é¥°çš„å­—æ®µï¼Œå€¼ä¸èƒ½é‡å¤ï¼Œä¸»é”®ç´¢å¼•ä¹Ÿå±äºå”¯ä¸€æ€§ç´¢å¼•ã€‚\n3. **ä¸»é”®ç´¢å¼•ï¼ˆè‡ªåŠ¨åˆ›å»ºç´¢å¼•ï¼‰**\n    1. ä½¿ç”¨Primary Keyä¿®é¥°çš„å­—æ®µä¼šè‡ªåŠ¨åˆ›å»ºç´¢å¼•\n    2. è¦æ³¨æ„ä¸»é”®å’Œä¸»é”®ç´¢å¼•çš„åŒºåˆ†ï¼ŒMyISAMå­˜å‚¨å¼•æ“ä¸‹ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ä¸»é”®ï¼Œä¹Ÿä¸ä¼šè‡ªåŠ¨æ·»åŠ ä¸€åˆ—ä¸»é”®åˆ—ã€‚åªæœ‰ä¸»åŠ¨è®¾ç½®ä¸»é”®æ‰ä¼šæœ‰ä¸»é”®å­˜å‚¨ã€‚å› ä¸ºå®ƒçš„ç´¢å¼•å’Œæ•°æ®æ˜¯åˆ†å¼€å­˜æ”¾çš„ï¼›ä½†åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸‹ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ä¸»é”®ï¼Œä¼šé»˜è®¤æ·»åŠ ä¸€åˆ—æ•´å‹å­—æ®µçš„åˆ—ï¼Œä½œä¸ºä¸»é”®ã€‚å› ä¸ºæ•°æ®å’Œç´¢å¼•æ˜¯å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶`.idb`ä¸­çš„ï¼Œå¦‚æœæ²¡æœ‰ç´¢å¼•æ ‘ï¼Œæ•°æ®æ— å¤„å­˜æ”¾ã€‚\n4. å•åˆ—ç´¢å¼•\n    1. åœ¨ä¸€ä¸ªå­—æ®µä¸Šåˆ›å»ºçš„ç´¢å¼•\n5. å¤šåˆ—ç´¢å¼•ï¼ˆè”åˆç´¢å¼•ï¼‰\n    1. åœ¨è¡¨çš„å¤šä¸ªå­—æ®µä¸Šåˆ›å»ºçš„ç´¢å¼•ï¼Œå¸¸å‡ºç°äºè”åˆä¸»é”®ä¸Šã€‚\n    2. ä¹Ÿå¯ä»¥ç”¨åœ¨æ™®é€šå­—æ®µã€‚\n6. å…¨æ–‡ç´¢å¼•\n    1. ä¸»è¦ç”¨äºå­—ç¬¦ä¸²æœç´¢\n    2. ä½¿ç”¨`FULLTEXT`å‚æ•°å¯ä»¥è®¾ç½®å…¨æ–‡ç´¢å¼•ï¼Œåªæ”¯æŒ`CHAR`ã€`VARCHAR`å’Œ`TEXT`ç±»å‹çš„å­—æ®µä¸Šï¼Œå¸¸ç”¨äºæ•°æ®é‡è¾ƒå¤§çš„å­—ç¬¦ä¸²ç±»å‹ä¸Šï¼Œå¯ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚\n    3. ä½†æ˜¯ä¸€èˆ¬ä¸åœ¨æœ¬åœ°æ•°æ®åº“ä¸­ä½¿ç”¨å…¨æ–‡ç´¢å¼•ï¼Œè€Œæ˜¯ç»™åå°æœåŠ¡å™¨å¦å¤–å¢è®¾ä¸“é—¨çš„æœç´¢å¼•æ“æ¨¡å—ï¼Œå¦‚`elasticSearch, ES`ã€‚\n# ç´¢å¼•çš„åˆ›å»ºä¸åˆ é™¤\n\n## åˆ›å»ºè¡¨çš„æ—¶å€™æŒ‡å®šç´¢å¼•å­—æ®µ\n\n```mysql\nCREATE TABLE user(\n    id INT,\n    name VARCHAR(20),\n    sex ENUM('male', 'female'),\n    INDEX(id)\n);\n```\n\n## åœ¨å·²åˆ›å»ºçš„è¡¨ä¸Šæ·»åŠ ç´¢å¼•\n\n```mysql\nCREATE [UNIQUE] INDEX [ç´¢å¼•å]\nON è¡¨å (å­—æ®µå(é•¿åº¦) [ASC | DESC]);\n```\n\n## åˆ é™¤ç´¢å¼•\n\n```mysql\nDROP INDEX ç´¢å¼•å ON è¡¨å;\n```\n# ä¸€æ¬¡select whereè¿‡æ»¤æ¡ä»¶æŸ¥è¯¢æ‰€ç»å†çš„äº‹æƒ…\n```mysql\nSELECT * from student WHERE uid = 5;\n```\nUIDä¸ºä¸»é”®ï¼Œé»˜è®¤æœ‰ç´¢å¼•ã€‚\næŸ¥è¯¢ä¸€æ¬¡çš„å…¨æµç¨‹ï¼š\n1. å­˜å‚¨å¼•æ“å¯åŠ¨\n2. kernel space\n3. ç£ç›˜IOï¼ˆè¯»å–ç´¢å¼•æ–‡ä»¶ï¼‰\n4. å†…å­˜ä¸Šï¼Œç”¨ç´¢å¼•çš„æ•°æ®æ„å»ºBæ ‘\n5. æŸ¥æ‰¾æ•°æ®ï¼Œå†…å­˜ä¸ŠäºŒåˆ†æ‰¾åˆ°ç´¢å¼•èŠ‚ç‚¹ï¼Œ**valueä¸ºä¸€è¡Œè®°å½•çš„æ–‡ä»¶æŒ‡é’ˆæˆ–è€…ä¸€è¡Œè®°å½•çš„æ•°æ®ï¼ˆæ ¹æ®ä¸åŒå­˜å‚¨å¼•æ“å®ç°ï¼‰**ã€‚\n    1. MyISAMçš„ç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†ç¦»çš„ï¼Œå› æ­¤ç´¢å¼•èŠ‚ç‚¹çš„valueä¸ºä¸€è¡Œè®°å½•çš„æ–‡ä»¶æŒ‡é’ˆï¼Œéœ€è¦å»ç£ç›˜ä¸­è¯»å–ã€‚\n    2. InnoDBçš„ç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯ä¸€èµ·çš„ï¼Œå› æ­¤ä»¥åŠæŠŠç´¢å¼•çš„æ•°æ®æå‰è¯»å–åˆ°äº†å†…å­˜ä¸­ï¼Œæ‰€ä»¥valueå€¼ç›´æ¥æ˜¯ä¸€è¡Œè®°å½•çš„æ•°æ®ã€‚\n6. kernel space\n7. ç£ç›˜IOè¿”å›å†…å­˜ã€‚\n# å®æ“æ¢ç´¢ç´¢å¼•\n\né¦–å…ˆ`su root` + `netstat -natp | grep mysqld`æŸ¥çœ‹mysqlå®ˆæŠ¤è¿›ç¨‹æ˜¯å¦æ­£åœ¨è¿è¡Œï¼Œé»˜è®¤å·¥ä½œåœ¨3306ç«¯å£ã€‚\n\næˆ‘ä»¬å…ˆæ‹¿å°è¡¨æ¥æ¢ç´¢ã€‚\n\n![image-20220519170152517](../../images/MySQL_ç´¢å¼•/image-20220519170152517.png)\n## æŸ¥çœ‹è¡¨çš„ç»“æ„ - çœ‹ä¸»é”®ç´¢å¼•\n```mysql\nSHOW CREATE TABLE student\\G #æŸ¥çœ‹è¡¨çš„ç»“æ„\n```\n\n![image-20220519174256317](../../images/MySQL_ç´¢å¼•/image-20220519174256317.png)\n\nå‘ç°æ­¤è¡¨åªæœ‰ä¸€ä¸ªuidä¸»é”®ç´¢å¼•ã€‚\n## explainå‘½ä»¤æŸ¥çœ‹select whereçš„æ€§èƒ½åˆ†æ\n```mysql\nEXPLAIN SELECT * FROM student WHERE uid = 3;\n```\n\n![image-20220519174431412](../../images/MySQL_ç´¢å¼•/image-20220519174431412.png)\n\nç”±äºuidä¸Šæœ‰ä¸»é”®ç´¢å¼•ï¼Œæ‰€ä»¥ä¸ç®¡æ­¤è¡¨ä¸­æœ‰å¤šå°‘æ•°æ®ï¼Œåªè¦æ˜¯æŒ‰ç…§uidè¿‡æ»¤æ¡ä»¶æ¥æŸ¥æ‰¾ï¼Œç›´æ¥å°±å¯ä»¥æ‰¾åˆ°ï¼Œä¸å—æŸ¥æ‰¾çš„æ•°æ®çš„ä½ç½®çš„å½±å“ï¼ˆä¸ä¼šåœ¨åé¢å°±æ‰¾å¾—æ…¢ï¼Œåœ¨å‰é¢å°±æ‰¾å¾—å¿«ï¼‰ã€‚\n\nexplainç»“æœä¸­**typeä¸ºconstè¡¨ç¤ºå¸¸é‡æ—¶é—´**ï¼Œ`key_len`ä¸º4ï¼Œå¯¹åº”äº†uidçš„intå‹çš„4å­—èŠ‚å¤§å°ã€‚\n\n```mysql\nEXPLAIN SELECT * FROM student WHERE name = 'linfeng';\n```\n\n![image-20220519174825252](../../images/MySQL_ç´¢å¼•/image-20220519174825252.png)\n\nç”±äº`name`æ²¡æœ‰ç´¢å¼•ï¼Œæ‰€ä»¥explainåˆ†æå‡ºçš„æ€§èƒ½æ˜¾ç¤º`type`å­—æ®µä¸º`ALL`ã€‚\né€šè¿‡nameè¿›è¡ŒæŸ¥æ‰¾åªèƒ½è¿›è¡Œå…¨è¡¨æ£€ç´¢ï¼Œæ•ˆç‡è¾ƒä½ã€‚\n## éä¸»é”®å­—æ®µåˆ›å»ºç´¢å¼•ï¼Œå‰ååŒºåˆ«\næˆ‘ä»¬ç»™nameå­—æ®µå»ºç«‹ä¸€ä¸ªç´¢å¼•ã€‚\n\n```mysql\nCREATE INDEX nameidx ON student(name);\nSHOW CREATE TABLE student\\G\n```\n\n![image-20220519175233259](../../images/MySQL_ç´¢å¼•/image-20220519175233259.png)\n\nå‘ç°ï¼Œä¸‹é¢å¤šäº†ä¸€ä¸ª`KEY nameidx(name)`ã€‚\nä½†æ˜¯ï¼Œ**å»ºç«‹äº†ç´¢å¼•ä¹‹åï¼Œä¸ä¸€å®šä¼šç”¨åˆ°ç´¢å¼•ï¼Œ\nMySQLä¼šè¿›è¡Œæ€§èƒ½åˆ†æï¼Œå¦‚æœä½¿ç”¨ç´¢å¼•åéœ€è¦æœç´¢çš„æ•°ç›®å’Œæ•´è¡¨æœç´¢çš„æ•°ç›®å·®ä¸å¤šçš„è¯ï¼Œå°±ä¸ä¼šä½¿ç”¨ç´¢å¼•**ï¼Œ\nå› ä¸ºé€šè¿‡ç´¢å¼•æ¥æ£€ç´¢ä¹Ÿæ˜¯éœ€è¦æ¶ˆè€—ç£ç›˜IOçš„ï¼Œæä¼šé€‚å¾—å…¶åã€‚\n\nå¯¹nameåŠ å®Œç´¢å¼•ä¹‹åï¼Œå†æ¥åˆ†ææŒ‰`name`æœç´¢çš„æ€§èƒ½ï¼š\n\n```mysql\nEXPLAIN SELECT * FROM student WHERE name='zhangsan';\n```\n\n![image-20220519175732865](../../images/MySQL_ç´¢å¼•/image-20220519175732865.png)\n\nè¿™é‡Œæˆ‘ä»¬çœ‹åˆ°ï¼ŒåŠ äº†ç´¢å¼•åï¼Œ`type`çš„å†…å®¹å˜ä¸º`ref`ã€‚\n\nè¿˜æœ‰ä¸€ä¸ªå¯ä»¥ä¼˜åŒ–çš„ç‚¹ï¼Œæˆ‘ä»¬å‘ç°ï¼Œ`key_len`ä¸º152ï¼Œè¿™ä¸ªå€¼æ˜¯ç´¢å¼•çš„å­—é•¿ã€‚\n\næˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºç´¢å¼•æ—¶åœ¨å­—æ®µååŠ ä¸€ä¸ª`(é•¿åº¦)`ï¼Œä»¥é™åˆ¶ç´¢å¼•çš„å­—é•¿ã€‚\n**é€šè¿‡æ§åˆ¶ç´¢å¼•çš„å­—é•¿ï¼Œé¿å…ç´¢å¼•é•¿åº¦è¿‡å¤§ï¼Œæ¥æé«˜æœç´¢æ•ˆç‡**ã€‚\n\né€šå¸¸å¯¹å­—ç¬¦ä¸²ç´¢å¼•è¿›è¡Œæ§åˆ¶ã€‚\n### éä¸»é”®ç´¢å¼•ï¼ˆæ™®é€šç´¢å¼•/äºŒçº§ç´¢å¼•ï¼‰çš„ç»“æ„ - å›è¡¨\nä»¥ä¸‹è®¨è®ºçš„æ˜¯InnoDBå­˜å‚¨å¼•æ“çš„æƒ…å†µã€‚\n\nåˆ›å»ºæ™®é€šå­—æ®µç´¢å¼•çš„å®ç°åŸç†æ˜¯ï¼Œæ™®é€šå­—æ®µï¼ˆå¦‚nameï¼‰å……å½“keyï¼Œvalueå˜æˆuidã€‚\n\nå›è¡¨æ˜¯æŒ‡ï¼ŒæŸ¥åˆ°nameç´¢å¼•æ ‘ä¸­linfengå¯¹åº”çš„uidåï¼Œå»ä¸»é”®ç´¢å¼•æ ‘å†æ‰¾uidå¯¹åº”çš„ä¸€æ•´è¡Œè®°å½•ã€‚\n![](../../images/MySQL_ç´¢å¼•/image-20250731001703762.png)\næ¶‰åŠåˆ°å›è¡¨æ—¶ï¼Œç£ç›˜IOä¼šå¢åŠ ï¼Œæ•ˆç‡é™ä½ã€‚\n## æµ‹è¯•InnoDBçš„æ•°æ®ç¼“å­˜\n\nç°åœ¨æ¥æµ‹è¯•`t_user`è¡¨ï¼Œæ­¤è¡¨ä¸­æœ‰2000000æ¡æ•°æ®ã€‚\n\nç°åœ¨æµ‹è¯•æŸ¥æ‰¾åŒä¸€ä¸ªpasswordçš„ç”¨æˆ·ã€‚ï¼ˆæ³¨æ„ï¼Œæˆ‘ä»¬ç”¨çš„æ˜¯æ•´å‹çš„1000000ï¼‰\n\n```mysql\nSELECT * FROM t_user WHERE password = 1000000;\n```\n\n![image-20220519194908928](../../images/MySQL_ç´¢å¼•/image-20220519194908928.png)\n\nå†è¿è¡Œä¸€æ¬¡ç›¸åŒçš„SQLã€‚ï¼ˆæµ‹è¯•InnoDBçš„æ•°æ®ç¼“å­˜ï¼‰\n\n```mysql\nSELECT * FROM t_user WHERE password = 1000000;\n```\n\n![image-20220519195157521](../../images/MySQL_ç´¢å¼•/image-20220519195157521.png)\n\næˆ‘ä»¬å‘ç°ï¼Œç”±äºä¸¤æ¬¡ç›¸åŒçš„æŸ¥æ‰¾ä¹‹é—´æ²¡æœ‰å¯¹æ•°æ®åº“è¡¨è¿›è¡Œä¿®æ”¹ã€æ·»åŠ ã€åˆ é™¤æ“ä½œï¼Œåˆ©ç”¨äº†å­˜å‚¨å¼•æ“çš„ç¼“å­˜æœºåˆ¶ï¼Œæ¯”ç¬¬ä¸€æ¬¡æŸ¥æ‰¾å‡ºçš„æ—¶é—´å¿«äº†ï¼Œå› ä¸ºä¸ç”¨èŠ±è´¹ç£ç›˜IOã€‚\n## æµ‹è¯•æœ‰æ— ç´¢å¼•çš„æ€§èƒ½åŒºåˆ«ï¼ˆæ¶‰åŠåˆ°ç±»å‹è½¬æ¢æ—¶ç´¢å¼•å¤±æ•ˆçš„é—®é¢˜ï¼‰\nç°åœ¨ç»™passwordå­—æ®µæ·»åŠ ä¸ªç´¢å¼•ã€‚\n\n```mysql\nCREATE INDEX pwdidx ON t_user(password);\nSHOW CREATE TABLE t_user\\G\n```\n\n![image-20220519195427490](../../images/MySQL_ç´¢å¼•/image-20220519195427490.png)\n\nç°åœ¨å†æ¥è¯•è¯•æŸ¥passwordã€‚ï¼ˆæ•…æ„å†™æˆæ•´å‹ï¼‰\n\n```mysql\nSELECT * FROM t_user WHERE password = 1000000;\n```\n\n![image-20220519195537622](../../images/MySQL_ç´¢å¼•/image-20220519195537622.png)\n\næ„Ÿè§‰æ€§èƒ½å¹¶æœªå¤§å¹…æå‡ï¼è¿™æ˜¯ä¸ºå•¥å‘¢ï¼Ÿ\n\n```mysql\nEXPLAIN SELECT * FROM t_user WHERE password = 1000000;\n```\n\n![image-20220519195807298](../../images/MySQL_ç´¢å¼•/image-20220519195807298.png)\n\nExplainå‘ç°ï¼š`key`å€¼ä¸º`NULL`ï¼Œæ„æ€å°±æ˜¯ï¼šåœ¨æ‰§è¡ŒSELECT whereè¿‡æ»¤passwordå­—æ®µæ—¶ï¼Œç´¢å¼•å¤±æ•ˆï¼\n\nåŸå› æ˜¯å› ä¸ºåœ¨æŸ¥è¯¢è¿‡ç¨‹çš„è¿‡æ»¤è¿‡ç¨‹ä¸­ï¼Œæ¶‰åŠåˆ°äº†ä¸€ä¸ª**ç±»å‹è½¬æ¢æ“ä½œ**ã€‚\nï¼ˆæ•°æ®è¡¨åŸæœ¬è®¾è®¡passwordæ˜¯å­—ç¬¦ä¸²ï¼Œè€Œæˆ‘ä»¬æ˜¯ç”¨æ•´å‹å€¼ä¼ é€’çš„æŸ¥è¯¢å‘½ä»¤ï¼‰ï¼Œå¦‚æ­¤å°±ä¼šè®©ç´¢å¼•å¤±æ•ˆã€‚\n\næˆ‘ä»¬æŠŠå®ƒå†™æ­£ç¡®ï¼š\n\n```mysql\nSELECT * FROM t_user WHERE password = '1000000';\n```\n\n![image-20220519200232453](../../images/MySQL_ç´¢å¼•/image-20220519200232453.png)\n\n```mysql\nEXPLAIN SELECT * FROM t_user WHERE password = '1000000';\n```\n\n![image-20220519200158653](../../images/MySQL_ç´¢å¼•/image-20220519200158653.png)\n\nå¯ä»¥å‘ç°ï¼Œå¦‚æœæ²¡æœ‰ç±»å‹å¼ºè½¬ï¼Œåˆ™ä¸€åˆ‡æ¢å¤æ­£å¸¸ï¼Œç´¢å¼•å‘æŒ¥äº†å®ƒåŸæœ‰çš„åŠŸåŠ›â€”â€”å³ä½¿æ˜¯åœ¨ç™¾ä¸‡æ•°æ®é›†ä¸­ï¼Œä¹Ÿèƒ½ç¬é—´æ‰¾åˆ°è¦æ‰¾çš„è®°å½•ã€‚\n## æµ‹è¯•åˆ é™¤ç´¢å¼•\n\næœ€åæˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹åˆ é™¤ç´¢å¼•\n\n```mysql\nDROP INDEX pwdidx ON t_user;\nSHOW CREATE TABLE t_user\\G\n```\n\n![image-20220519200416678](../../images/MySQL_ç´¢å¼•/image-20220519200416678.png)\n# å¤šåˆ—ç´¢å¼•ï¼ˆè”åˆç´¢å¼•ï¼‰\nä¸€æ¬¡SQLæŸ¥è¯¢ä¸­ï¼Œä¸€å¼ è¡¨åªèƒ½ä½¿ç”¨ä¸€æ¬¡ç´¢å¼•ã€‚å¦åˆ™ä½¿ç”¨å¤šä¸ªç´¢å¼•ä¼šè€—è´¹æˆå€çš„ç£ç›˜IOã€‚\n```mysql\nexplain select * from student where age = 20 order by name;\n```\nåˆ›å»ºå¤šåˆ—ç´¢å¼•ï¼Œç”¨åœ¨è¿™ç§åœºæ™¯ï¼šè¿‡æ»¤æ¡ä»¶ä¸ºéä¸»é”®ï¼Œæ’åºæ¡ä»¶ä¸ºéä¸»é”®ã€‚\nå¦‚æœåªå»ºç«‹äº†ä¸¤ä¸ªç‹¬ç«‹çš„å•åˆ—ageã€nameç´¢å¼•ï¼Œé‚£ä¹ˆï¼š\n![](../../images/MySQL_ç´¢å¼•/image-20250731002838480.png)\nè™½ç„¶ç”¨åˆ°äº†ageç´¢å¼•ï¼Œä½†æ˜¯ä¾ç„¶ä¼šå‡ºç°using filesortï¼Œè¿™æ˜¯ç”±äºnameç´¢å¼•å¤±æ•ˆçš„é—®é¢˜ã€‚\næˆ‘ä»¬å¯ä»¥åˆ›å»ºageã€nameçš„è”åˆç´¢å¼•ã€‚å®é™…çš„å®ç°åŸç†æ˜¯ï¼Œç´¢å¼•èŠ‚ç‚¹çš„keyæ˜¯ageï¼ŒvalueåŸŸä¸€èµ·ç»‘å®šäº†nameã€uidã€‚\né‚£ä¹ˆï¼Œæœ€ç»ˆçš„æ•ˆæœå°±æ˜¯ï¼šå…ˆæŒ‰ageæ’åºï¼Œå†æŒ‰nameæ’åºï¼›ageç›¸åŒï¼ŒæŒ‰nameæ’åºã€‚\n\n```mysql\ncreate index name_age_idx on student(age, name);\n```\n![](../../images/MySQL_ç´¢å¼•/image-20250731003138392.png)\n![](../../images/MySQL_ç´¢å¼•/image-20250731003209295.png)\n\nä½†æ˜¯ï¼Œå¦‚æœåªæœ‰ageã€nameçš„è”åˆç´¢å¼•ï¼Œå½“æˆ‘ä»¬ç”¨nameè¿‡æ»¤æ¡ä»¶æŸ¥è¯¢æ—¶ï¼Œageã€nameçš„è”åˆç´¢å¼•ä¼šå¤±æ•ˆã€‚\n![](../../images/MySQL_ç´¢å¼•/image-20250731003647042.png)\nè¿™æ˜¯å› ä¸ºageæ’åœ¨ageã€nameçš„å‰é¢ï¼Œageå……å½“ç´¢å¼•çš„keyã€‚\n# èšé›†ç´¢å¼•ï¼ˆèšç°‡ç´¢å¼•ï¼‰\nèšé›†ç´¢å¼•æŒ‡çš„æ˜¯ï¼Œç´¢å¼•å’Œæ•°æ®åœ¨ä¸€èµ·ã€‚ï¼ˆæ¯”å¦‚InnoDBï¼‰\néèšé›†ç´¢å¼•æŒ‡çš„æ˜¯ï¼Œç´¢å¼•å’Œæ•°æ®æ˜¯åˆ†å¼€çš„ï¼Œç´¢å¼•çš„valueä¿å­˜çš„æ˜¯æ•°æ®çš„æ–‡ä»¶åœ°å€ã€‚ï¼ˆæ¯”å¦‚MyISAMï¼‰\n\nå› æ­¤ï¼ŒMyISAMäºŒçº§ç´¢å¼•æ ‘ï¼ŒæŸ¥è¯¢å…¶ä»–éç´¢å¼•å­—æ®µæ—¶ï¼Œä¸ç”¨è¿›è¡Œå›è¡¨æ“ä½œï¼Œå› ä¸ºå¯ä»¥ç›´æ¥è®¿é—®æ•°æ®åœ°å€ã€‚\n![](../../images/MySQL_ç´¢å¼•/image-20250731004540466.png)\n# åˆ›å»ºç´¢å¼•æ—¶æŒ‡å®šç´¢å¼•ç»“æ„\n```mysql\ncreate index nameidx on student(name) using hash;\n```\n![](../../images/MySQL_ç´¢å¼•/image-20250731005319197.png)\nè™½ç„¶æŒ‡å®šäº†ä½¿ç”¨å“ˆå¸Œç´¢å¼•ï¼Œå¹¶ä¸”è¡¨ç»“æ„ä¹Ÿæ˜¾ç¤ºUSING HASHï¼Œä½†å®é™…ä¸Šç”¨çš„ä»€ä¹ˆç´¢å¼•ç»“æ„æ˜¯ä¸ç¡®å®šçš„ã€‚\néœ€è¦æŸ¥çœ‹ï¼š\n```mysql\nshow indexes drom student;\n```\n![](../../images/MySQL_ç´¢å¼•/image-20250731005526111.png)\n\nå¯ä»¥çœ‹åˆ°ï¼Œå®é™…ä¸Šï¼Œåˆšæ‰åˆ›å»ºçš„nameidxä¾ç„¶ä¸ºBTREEç´¢å¼•ç»“æ„ã€‚\n# å“ˆå¸Œç´¢å¼•\nmemoryå­˜å‚¨å¼•æ“æ”¯æŒå“ˆå¸Œç´¢å¼•ã€‚\nmemoryå­˜å‚¨å¼•æ“æ˜¯åŸºäºå†…å­˜çš„ï¼Œæ‰ç”µæ•°æ®ä¼šä¸¢å¤±ã€‚\n\nè™½ç„¶æŸ¥è¯¢çš„æ•ˆç‡å¾ˆé«˜ï¼Œä¸º`O(1)`ï¼Œä½†æ˜¯ï¼šå“ˆå¸Œè¡¨ä¸­çš„å…ƒç´ æ²¡æœ‰ä»»ä½•é¡ºåºå¯è¨€ï¼Œåªé€‚åˆç­‰å€¼æ¯”è¾ƒã€‚\n```mysql\nselect * from student where name = 'zhangsan';\n```\nå¦‚æœä¸€æ—¦æ¶‰åŠï¼šèŒƒå›´æŸ¥æ‰¾ï¼Œæˆ–è€…å‰ç¼€æŸ¥æ‰¾ï¼Œæˆ–è€…order byæ’åºï¼Œåˆ™æ•ˆç‡ä¸é«˜ï¼Œåªèƒ½éå†æœç´¢å“ˆå¸Œè¡¨äº†ã€‚\nzhangsanã€zhangyangã€zhangchengï¼Œå¤§æ¦‚ç‡ä¸åœ¨ä¸€ä¸ªæ¡¶ä¸­ã€‚\n```mysql\nselect * from student where name like 'zhang%';\n```\nè€Œä¸”ï¼Œå“ˆå¸Œè¡¨çš„ç»“æ„å¾ˆåˆ†æ•£ï¼Œæ— æ³•åˆ©ç”¨è®¡ç®—æœºå­˜å‚¨ç»“æ„çš„å±€éƒ¨æ€§åŸç†ã€‚ç£ç›˜IOä¼šå¾ˆé¢‘ç¹ã€‚\n\nå› æ­¤å“ˆå¸Œç´¢å¼•çš„åœºæ™¯ï¼šåªé€‚åˆæŠŠç´¢å¼•å’Œæ•°æ®å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸Šã€‚å¹¶ä¸”åªåšç­‰å€¼æ¯”è¾ƒæŸ¥è¯¢ã€‚\n## InnoDBè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•\nInnoDBå­˜å‚¨å¼•æ“ä¼šç›‘æµ‹ï¼šå¦‚æœåŒæ ·çš„äºŒçº§ç´¢å¼•ä¸æ–­è¢«ä½¿ç”¨ï¼Œé‚£ä¹ˆå®ƒä¼šæ ¹æ®è¿™ä¸ªäºŒçº§ç´¢å¼•ï¼Œåœ¨å†…å­˜ä¸Šæ ¹æ®äºŒçº§ç´¢å¼•æ ‘ï¼ˆB+æ ‘ï¼‰ä¸Šçš„äºŒçº§ç´¢å¼•å€¼ï¼Œåœ¨å†…å­˜ä¸Šæ„å»ºä¸€ä¸ªå“ˆå¸Œç´¢å¼•ï¼Œæ¥åŠ ç´¢æœç´¢ã€‚\n![](../../images/MySQL_ç´¢å¼•/image-20250731011638213.png)\n\nè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•æœ¬èº«çš„æ•°æ®ç»´æŠ¤ä¹Ÿæ˜¯è¦è€—è´¹æ€§èƒ½çš„ï¼Œå¹¶ä¸æ˜¯è¯´è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¼šæå‡äºŒçº§ç´¢å¼•çš„æŸ¥è¯¢æ€§èƒ½ã€‚\néœ€è¦æ ¹æ®å‚æ•°æŒ‡æ ‡ï¼Œæ¥å…·ä½“åˆ†ææ˜¯å¦æ‰“å¼€æˆ–è€…å…³é—­è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ã€‚\n\nä»¥ä¸‹å‘½ä»¤èƒ½çœ‹åˆ°ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„ä¿¡æ¯ï¼š\n1. RW-latchç­‰å¾…çš„çº¿ç¨‹æ•°é‡ï¼ˆè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•é»˜è®¤åˆ†é…äº†8ä¸ªåˆ†åŒºï¼‰ï¼Œ\n2. èµ°è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•æœç´¢çš„é¢‘ç‡ï¼ˆä½ï¼‰å’ŒäºŒçº§ç´¢å¼•æ ‘æœç´¢çš„é¢‘ç‡ï¼ˆé«˜ï¼‰\n\n```mysql\nshow engine innodb status\\G \n```\nå¦‚æœè§‚å¯Ÿåˆ°åŒä¸€ä¸ªåˆ†åŒºç­‰å¾…çš„çº¿ç¨‹æ•°é‡è¿‡å¤šï¼Œèµ°å“ˆå¸Œç´¢å¼•æœç´¢é¢‘ç‡ä½ã€äºŒçº§ç´¢å¼•æ ‘é¢‘ç‡é«˜ï¼Œåˆ™æœ€å¥½å…³æ‰è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ã€‚\n# æ€»ç»“ - ç´¢å¼•è¦æ³¨æ„çš„ç‚¹\n1. ç»å¸¸ä½œä¸ºwhereæ¡ä»¶è¿‡æ»¤çš„å­—æ®µè€ƒè™‘æ·»åŠ ç´¢å¼•\n2. é’ˆå¯¹å­—ç¬¦ä¸²åˆ—åˆ›å»ºç´¢å¼•æ—¶ï¼Œå°½é‡è§„å®šç´¢å¼•çš„é•¿åº¦ï¼Œé¿å…ç´¢å¼•å€¼çš„é•¿åº¦`key_len`è¿‡é•¿\n3. ç´¢å¼•å­—æ®µæ¶‰åŠç±»å‹å¼ºè½¬ã€mysqlå‡½æ•°è°ƒç”¨ã€è¡¨è¾¾å¼è®¡ç®—ç­‰ï¼Œç´¢å¼•å°±å¤±æ•ˆäº†ã€‚","categories":["æ•°æ®åº“","MySQL"]},{"title":"å®‰è£…Nginx","url":"/é¡¹ç›®/å®‰è£…nginx/","content":"# å†…å®¹\n\nå®‰è£…nginxåŠå…¶ä¾èµ–ã€‚\n\nå¯èƒ½éœ€è¦çš„å‘½ä»¤ï¼š\n\n1. Linuxä¸‹`*.tar.gz`æ–‡ä»¶è§£å‹ç¼©å‘½ä»¤ï¼š`tar -zxvf å‹ç¼©æ–‡ä»¶å.tar.gz`\n2. `chown -R` : å¤„ç†æŒ‡å®šç›®å½•ä»¥åŠå…¶å­ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶\n\nå‚è€ƒæ–‡ç« \n\n1. [Hexoéƒ¨ç½²è‡³æœåŠ¡å™¨ï¼ˆUbuntu 20.04ï¼‰](https://cloud.tencent.com/developer/article/1945550)\n2. [ubuntu nginxæºä»£ç å®‰è£…](https://www.jianshu.com/p/8af24b0adaf6)\n3. [Ubuntu20.04å®‰è£…openssl-1.1.1k](https://zhuanlan.zhihu.com/p/387379400)\n4. [linuxä¸­ln -s å‘½ä»¤è¯¦è§£](https://blog.csdn.net/liangtianmeng/article/details/86736761)\n5. [è§£å†³ï¼šLinux8æ•´åˆNginxè¿‡ç¨‹ä¸­æŠ¥é”™ï¼šsrc/os/unix/ngx_user.c: åœ¨å‡½æ•°â€˜ngx_libc_cryptâ€™ä¸­: src/os/unix/ngx_user.c:36:7](https://blog.csdn.net/weixin_48033662/article/details/122004967)\n6. [OpenSSL library is not used](https://blog.csdn.net/beagreatprogrammer/article/details/78369638)\n7. [è®¾ç½®Nginxåœ¨linuxæœåŠ¡å™¨ï¼ˆUbuntuï¼‰å¼€æœºå¯åŠ¨](http://t.zoukankan.com/hoaprox-p-12416624.html)\n8. [Unable to locate package sysv-rc-conf](https://blog.csdn.net/hancc_824/article/details/109181317)\n9. https://blog.csdn.net/weixin_45837693/article/details/107675339\n\n# å®‰è£…å…¶ä¾èµ–\n\nnginxä¾èµ–pcreã€opensslã€zlib\n\nå®‰è£…pcre\n\n```bash\nsudo apt install libpcre3 libpcre3-dev\n```\n\nå®‰è£…zlib\n\nä¸‹è½½åœ°å€:http://www.zlib.net\n\n```bash\ntar -xvf zlib-<version>.tar.gz \ncd zlib-<version>/\n./configure\nmake\nmake install\n```\n\n","categories":["é¡¹ç›®"]},{"title":"MySQL_åˆ†ç»„_æ’åº","url":"/æ•°æ®åº“/MySQL_åˆ†ç»„_æ’åº/","content":"\n# å†…å®¹\n\n1. æ’åº - order by\n   1. å‡åº - asc (é»˜è®¤)\n   2. é™åº - desc\n2. åˆ†ç»„ - group by\n\n# æ’åº\n\næ ¼å¼å¦‚ä¸‹ï¼š\n\n```mysql\nSELECT * FROM tablename ORDER BY å­—æ®µ1,å­—æ®µ2,... [ASC(default) | DESC];\n```\n\nå…¶ä¸­ï¼Œ`ORDER BY`åé¢çš„æ¡ä»¶æ˜¯ä¼˜å…ˆçº§è§„åˆ™ã€‚å…ˆæ¯”ç…§`å­—æ®µ1`ï¼Œè‹¥ç›¸åŒåˆ™æ¯”ç…§`å­—æ®µ2`ï¼Œä»¥æ­¤ç±»æ¨ï¼›å…¶æ¬¡ï¼Œåé¢çš„`ASC`è¡¨ç¤ºå‡åºæ’åˆ—ï¼Œæ˜¯é»˜è®¤é€‰é¡¹ï¼Œå¦‚æœæ¬²æŒ‰ç…§é™åºæ’åˆ—åˆ™éœ€æŒ‡æ˜`DESC`ã€‚\n\n## æ’åºæŸ¥è¯¢æ€§èƒ½åˆ†æ\n\n```mysql\nSELECT * FROM user ORDER BY age;\nEXPLAIN SELECT * FROM user ORDER BY age;\n```\n\n![image-20220518085532824](../../images/MySQL_åˆ†ç»„&æ’åº/image-20220518085532824.png)\n\n![image-20220518085549904](../../images/MySQL_åˆ†ç»„&æ’åº/image-20220518085549904.png)\n\nexplainä¹‹åå‘ç°`rows=5`ï¼Œå¦‚æœå•çº¯åœ°è¿›è¡Œæ’åºè€Œä¸åŠ ä»»ä½•æ¡ä»¶ï¼Œå°†ä¼šè¿›è¡Œæ•´è¡¨æŸ¥è¯¢ã€‚\n\n`type`ä¸º`ALL`ï¼Œæ„ä¸ºæ•´è¡¨æŸ¥è¯¢ï¼Œä»¥å‰æˆ‘ä»¬ç”¨å¸¦ç´¢å¼•çš„æŸ¥è¯¢æ­¤å¤„ä¸º`const`ï¼Œè¡¨ç¤ºå¸¸é‡æ—¶é—´ï¼Œæ­¤å¤„çš„`ALL`åˆ™ä»£è¡¨å¤æ‚åº¦è¾ƒé«˜ï¼›`Extra`ä¸º`Using filesort`ï¼Œè¿™ä¸ªæ ‡å¿—æ„å‘³ç€ï¼Œæ­¤æŸ¥è¯¢æ¶‰åŠåˆ°ç£ç›˜IOå’Œå¤–æ’åºï¼Œå°†ä¸¥é‡å½±å“æ€§èƒ½ã€‚\n\nå¤–æ’åºçš„æ„æ€å°±æ˜¯ï¼Œæœ‰æ—¶ç£ç›˜çš„æ•°æ®é‡å¾ˆå¤§ï¼Œæ— æ³•å…¨éƒ¨è£…åˆ°å†…å­˜ä¸­å¤„ç†ï¼Œä¸€èˆ¬ä¼šé‡‡ç”¨nè·¯å½’å¹¶æ’åºæ€æƒ³ï¼Œè¿™å°†ä¼šæ¶‰åŠå¾ˆå¤šç£ç›˜IOï¼Œæ•ˆç‡ä½ä¸‹ã€‚\n\nå†æ¥çœ‹ä¸€ä¸ªã€‚\n\n```mysql\nEXPLAIN SELECT * FROM user ORDER BY name;\n```\n\n![image-20220518090603207](../../images/MySQL_åˆ†ç»„&æ’åº/image-20220518090603207.png)\n\nexplainå‘ç°å³ä½¿æŒ‰ç…§å­—æ®µ`name`æ’åºï¼Œç»“æœè¿˜æ˜¯ä¸ä¸Šé¢çš„æ•ˆæœä¸€è‡´ã€‚\n\nå†æ¥ä¸€ä¸ªã€‚\n\n```mysql\nEXPLAIN SELECT name FROM user ORDER BY name;\n```\n\nè¿™æ¬¡æˆ‘ä»¬æ²¡æœ‰æŸ¥æŒ‰nameæ’åºç»“æœåçš„æ‰€æœ‰å­—æ®µï¼Œè€Œæ˜¯åªæŸ¥äº†å­—æ®µ`name`ã€‚\n\n![image-20220518090847761](../../images/MySQL_åˆ†ç»„&æ’åº/image-20220518090847761.png)\n\nexplainå‘ç°ï¼Œå˜åŒ–æ˜¾è‘—ã€‚\n\né¦–å…ˆ`type`å˜ä¸º`index`ï¼›`key`å˜ä¸º`name`ï¼›æœ€åï¼Œ`Extra`å˜ä¸º`Using index`ã€‚\n\nå†è¯•ä¸€ä¸ªã€‚\n\n```mysql\nEXPLAIN SELECT age FROM user ORDER BY age;\n```\n\n![image-20220518091136751](../../images/MySQL_åˆ†ç»„&æ’åº/image-20220518091136751.png)\n\nexplainå‘ç°ï¼Œå¹¶ä¸æ˜¯è¯´æŒ‰å•¥æ’åºå¹¶ä¸”åªæŸ¥å•¥çš„è¯æ€§èƒ½å°±é«˜ã€‚æˆ‘ä»¬å‘ç°æŒ‰ageæ’åºï¼ŒåªæŸ¥ageçš„è¯Extraä»æ˜¯`Using filesort`ã€‚\n\nç»“è®ºå°±æ˜¯ï¼šorder byçš„æ€§èƒ½ä¸ä»…ä¸å¾…æ’åºçš„å­—æ®µæ˜¯å¦æœ‰ç´¢å¼•æœ‰å…³ï¼Œè¿˜ä¸selecté€‰æ‹©çš„åˆ—å­—æ®µæœ‰å…³ç³»ã€‚è¿™ä¸ä¸»ç´¢å¼•æ ‘ã€è¾…åŠ©ç´¢å¼•æ ‘æœ‰å…³ï¼Œä¹Ÿå°±æ˜¯èšé›†ç´¢å¼•å’Œéèšé›†ç´¢å¼•çš„æœç´¢è¿‡ç¨‹æœ‰å…³ï¼Œä¹Ÿæ¶‰åŠåˆ°å›è¡¨é—®é¢˜ã€‚\n\n# åˆ†ç»„\n\næŒ‰ç…§å­—æ®µåˆ†ç»„ï¼Œå­—æ®µå†…å®¹ç›¸åŒçš„æ”¾åœ¨ä¸€ç»„ã€‚\n\n```mysql\nSELECT * FROM user;\n```\n\n![image-20220518092546416](../../images/MySQL_åˆ†ç»„&æ’åº/image-20220518092546416.png)\n\n```mysql\nSELECT DISTINCT age FROM user;\n```\n\n![image-20220518092624988](../../images/MySQL_åˆ†ç»„&æ’åº/image-20220518092624988.png)\n\n```mysql\nSELECT age FROM user GROUP BY age;\n```\n\n![image-20220518092651495](../../images/MySQL_åˆ†ç»„&æ’åº/image-20220518092651495.png)\n\n## å¸¸ç”¨è¯­å¥\n\n### åˆ†ç»„å¹¶æ˜¾ç¤ºè¯¥ç»„è®°å½•çš„æ¡æ•°\n\n```mysql\nSELECT age,COUNT(age) AS number FROM user GROUP BY age;#ASå¯çœç•¥\n```\n\n### åˆ†ç»„åæ¡ä»¶ç­›é€‰ - HAVING\n\n```mysql\nSELECT age,COUNT(age) number FROM user GROUP BY age HAVING age>20;\n```\n\nä¹Ÿå¯ä»¥åˆ†ç»„å‰æ¡ä»¶ç­›é€‰ - where\n\n```mysql\nSELECT age,COUNT(age) number FROM user WHERE age>20 GROUP BY age;\n```\n\n### å¤šå­—æ®µåˆ†ç»„\n\n```mysql\nSELECT age,sex FROM user GROUP BY age,sex;\n```\n\nè¿™ä¸ªè¯­å¥å°†ä¼šæŠŠageå’ŒsexåŒæ—¶ä¸€æ ·çš„è®°å½•åˆ†ç»„ã€‚\n\n![image-20220518094730869](../../images/MySQL_åˆ†ç»„&æ’åº/image-20220518094730869.png)\n\n```mysql\nSELECT age,sex,COUNT(*) FROM user GROUP BY age,sex;\n```\n\n![image-20220518094828414](../../images/MySQL_åˆ†ç»„&æ’åº/image-20220518094828414.png)\n\n`count(*)`ç›¸å½“äºæ±‚çš„æ˜¯è®°å½•çš„è¡Œæ•°ã€‚\n\n### ä¸æ’åºç»“åˆ\n\n```mysql\nSELECT age,sex,COUNT(*) FROM user GROUP BY age,sex ORDER BY age;\n```\n\n![image-20220518095349412](../../images/MySQL_åˆ†ç»„&æ’åº/image-20220518095349412.png)\n\n## æ€§èƒ½åˆ†æ\n\né¦–å…ˆæˆ‘ä»¬å…ˆç¡®å®šä¸€ä¸‹æ­¤è¡¨çš„ç»“æ„å±æ€§ã€‚å†ç”¨Explainè¿›è¡Œæ€§èƒ½åˆ†æã€‚\n\n```mysql\nDESC user;\nEXPLAIN SELECT age FROM user GROUP BY age;\n```\n\n![image-20220518095647124](../../images/MySQL_åˆ†ç»„&æ’åº/image-20220518095647124.png)\n\ndescå‘ç°ï¼Œidæœ‰ä¸»é”®ç´¢å¼•ï¼Œnameæœ‰å”¯ä¸€æ€§ç´¢å¼•ã€‚å…¶ä»–çš„ageã€sexæ— ç´¢å¼•ã€‚\n\nexplainå‘ç°ï¼Œ`Extra`ä¸­ä¸º`Using temporary; Using filesort`ã€‚è¯´æ˜æ­¤åˆ†ç»„æŸ¥è¯¢éœ€è¦ï¼šäº§ç”Ÿä¸´æ—¶è¡¨+ä½¿ç”¨å¤–æ’åºã€‚æ•ˆç‡æå·®ã€‚\n\nå®é™…ä¸Šgroup byä¹Ÿä¼šè¿›è¡Œç±»ä¼¼order byçš„æ’åºã€‚åˆ†ç»„æŸ¥è¯¢æ˜¯å…ˆæŠŠåˆ†ç»„ä»¥åçš„æ•°æ®æ”¾åˆ°ä¸´æ—¶è¡¨ä¸­ï¼Œç„¶ååœ¨ä¸´æ—¶è¡¨ä¸­è¿›è¡Œæ’åºã€‚ç”±äºageæ²¡æœ‰ç´¢å¼•ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨å¤–æ’åºã€‚\n\nè¯•è¯•æŒ‰nameåˆ†ç»„ã€‚\n\n```mysql\nEXPLAIN SELECT name FROM user GROUP BY name;\n```\n\n![image-20220518100614162](../../images/MySQL_åˆ†ç»„&æ’åº/image-20220518100614162.png)\n\nexplainå‘ç°ï¼Œ`Extra`ä¸º`Using index`ã€‚å˜åŒ–æ˜¯å¾ˆæ˜¾è‘—çš„ã€‚æ‰€ä»¥GROUP BYåé¢åŠ ç´¢å¼•ä¹Ÿæ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚\n\n# ç»ƒä¹ \n\næŸé“¶è¡Œä»£ç¼´è¯è´¹ä¸»æµæ°´è¡¨ï¼ˆ`bank_bill`ï¼‰ç»“æ„ï¼š\n\n| å­—æ®µå | æè¿°     |\n| ------ | -------- |\n| serno  | æµæ°´å·   |\n| date   | äº¤æ˜“æ—¥æœŸ |\n| accno  | è´¦å·     |\n| name   | å§“å     |\n| amount | é‡‘é¢     |\n| brno   | ç¼´è´¹ç½‘ç‚¹ |\n\né¢˜ç›®ï¼š1ï¼‰ç»Ÿè®¡è¡¨ä¸­ç¼´è´¹çš„æ€»ç¬”æ•°å’Œæ€»é‡‘é¢ï¼›2ï¼‰ç»™å‡ºä¸€ä¸ªSQLï¼ŒæŒ‰ç½‘ç‚¹å’Œæ—¥æœŸç»Ÿè®¡æ¯ä¸ªç½‘ç‚¹æ¯å¤©çš„è¥ä¸šé¢ï¼Œå¹¶æŒ‰ç…§è¥ä¸šé¢è¿›è¡Œå€’åºæ’åºã€‚\n\n```mysql\nCREATE TABLE bank_bill(\n    serno BIGINT UNSIGNED PRIMARY KEY NOT NULL AUTO_INCREMENT,\n    date DATE NOT NULL,\n    accno VARCHAR(100) NOT NULL,\n    name VARCHAR(50) NOT NULL,\n    amount DECIMAL(10,1) NOT NULL,\n    brno VARCHAR(150) NOT NULL\n);\nINSERT INTO bank_bill VALUES\n('101000','2022-3-1','111','zhang',100,'é«˜æ–°åŒºæ”¯è¡Œ'),\n('101001','2022-3-1','222','liu',200,'ç¢‘æ—åŒºæ”¯è¡Œ'),\n('101002','2022-3-1','333','gao',300,'é«˜æ–°åŒºæ”¯è¡Œ'),\n('101003','2022-3-1','444','lian',150,'é›å¡”åŒºæ”¯è¡Œ'),\n('101004','2022-3-1','555','lan',360,'é›å¡”åŒºæ”¯è¡Œ'),\n('101005','2022-3-1','666','wang',300,'ç¢‘æ—åŒºæ”¯è¡Œ'),\n('101006','2022-3-2','777','wei',500,'ç¢‘æ—åŒºæ”¯è¡Œ'),\n('101007','2022-3-2','888','yao',50,'ç¢‘æ—åŒºæ”¯è¡Œ'),\n('101008','2022-3-2','111','zhang',100,'é«˜æ–°åŒºæ”¯è¡Œ'),\n('101009','2022-3-2','222','liu',200,'é›å¡”åŒºæ”¯è¡Œ'),\n('101010','2022-3-3','333','gao',300,'é«˜æ–°åŒºæ”¯è¡Œ'),\n('101011','2022-3-3','444','lian',150,'é›å¡”åŒºæ”¯è¡Œ'),\n('101012','2022-3-3','555','lan',360,'é›å¡”åŒºæ”¯è¡Œ'),\n('101013','2022-3-3','666','wang',300,'ç¢‘æ—åŒºæ”¯è¡Œ');\n```\n\n1ï¼‰æ€»ç¬”æ•°ã€æ€»é‡‘é¢ï¼š\n\n```mysql\nSELECT COUNT(serno),SUM(amount) FROM bank_bill;\n```\n\n![image-20220518102653368](../../images/MySQL_åˆ†ç»„&æ’åº/image-20220518102653368.png)\n\n2ï¼‰æŒ‰ç½‘ç‚¹å’Œæ—¥æœŸç»Ÿè®¡æ¯å¤©è¥ä¸šé¢ï¼Œå€’åºã€‚\n\n```mysql\nSELECT brno,date,sum(amount) AS total FROM bank_bill GROUP BY brno,date ORDER BY brno,total DESC;\n```\n\n![image-20220518105904641](../../images/MySQL_åˆ†ç»„&æ’åº/image-20220518105904641.png)","categories":["æ•°æ®åº“","MySQL"]},{"title":"åˆ·é¢˜_æ‰“å®¶åŠ«èˆ","url":"/ç®—æ³•/åˆ·é¢˜_æ‰“å®¶åŠ«èˆ/","content":"\n# æ‰“å®¶åŠ«èˆ\n\nä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å°å·ï¼Œè®¡åˆ’å·çªƒæ²¿è¡—çš„æˆ¿å±‹ã€‚æ¯é—´æˆ¿å†…éƒ½è—æœ‰ä¸€å®šçš„ç°é‡‘ï¼Œå½±å“ä½ å·çªƒçš„å”¯ä¸€åˆ¶çº¦å› ç´ å°±æ˜¯ç›¸é‚»çš„æˆ¿å±‹è£…æœ‰ç›¸äº’è¿é€šçš„é˜²ç›—ç³»ç»Ÿï¼Œ**å¦‚æœä¸¤é—´ç›¸é‚»çš„æˆ¿å±‹åœ¨åŒä¸€æ™šä¸Šè¢«å°å·é—¯å…¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŠ¥è­¦**ã€‚\n\nç»™å®šä¸€ä¸ªä»£è¡¨æ¯ä¸ªæˆ¿å±‹å­˜æ”¾é‡‘é¢çš„éè´Ÿæ•´æ•°æ•°ç»„ï¼Œè®¡ç®—ä½ **ä¸è§¦åŠ¨è­¦æŠ¥è£…ç½®çš„æƒ…å†µä¸‹** ï¼Œä¸€å¤œä¹‹å†…èƒ½å¤Ÿå·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ã€‚\n\nç¤ºä¾‹ 1ï¼š\n\n```\nè¾“å…¥ï¼š[1,2,3,1]\nè¾“å‡ºï¼š4\nè§£é‡Šï¼šå·çªƒ 1 å·æˆ¿å±‹ (é‡‘é¢ = 1) ï¼Œç„¶åå·çªƒ 3 å·æˆ¿å±‹ (é‡‘é¢ = 3)ã€‚\n     å·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ = 1 + 3 = 4 ã€‚\n```\n\n\nç¤ºä¾‹ 2ï¼š\n\n```\nè¾“å…¥ï¼š[2,7,9,3,1]\nè¾“å‡ºï¼š12\nè§£é‡Šï¼š\n    å·çªƒ1å·æˆ¿å±‹(é‡‘é¢=2),å·çªƒ3å·æˆ¿å±‹(é‡‘é¢=9)ï¼Œæ¥ç€å·çªƒ5å·æˆ¿å±‹(é‡‘é¢=1)ã€‚\n    å·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ = 2 + 9 + 1 = 12 ã€‚\n```\n\næç¤ºï¼š\n\n```\n1 <= nums.length <= 100\n0 <= nums[i] <= 400\n```\n\n## ä»£ç \n\n```cpp\nclass Solution {\npublic:\n    int rob(vector<int>& nums) {\n        vector<int> ar;\n        ar.reserve(nums.size()+1);\n        ar[0] = 0;\n        ar[1] = nums[0];\n        int max = ar[1];\n        for(int i = 2; i<=nums.size(); ++i)\n        {\n            ar[i] = std::max(ar[i-2]+nums[i-1],ar[i-1]);\n            if(ar[i]>max)max = ar[i];\n        }\n        return max;\n    }\n};\n```\n\n# æ‰“å®¶åŠ«èˆ2\n\nä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å°å·ï¼Œè®¡åˆ’å·çªƒæ²¿è¡—çš„æˆ¿å±‹ï¼Œæ¯é—´æˆ¿å†…éƒ½è—æœ‰ä¸€å®šçš„ç°é‡‘ã€‚è¿™ä¸ªåœ°æ–¹æ‰€æœ‰çš„æˆ¿å±‹éƒ½**å›´æˆä¸€åœˆ**ï¼Œè¿™æ„å‘³ç€**ç¬¬ä¸€ä¸ªæˆ¿å±‹å’Œæœ€åä¸€ä¸ªæˆ¿å±‹æ˜¯ç´§æŒ¨ç€**çš„ã€‚åŒæ—¶ï¼Œç›¸é‚»çš„æˆ¿å±‹è£…æœ‰ç›¸äº’è¿é€šçš„é˜²ç›—ç³»ç»Ÿï¼Œ**å¦‚æœä¸¤é—´ç›¸é‚»çš„æˆ¿å±‹åœ¨åŒä¸€æ™šä¸Šè¢«å°å·é—¯å…¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŠ¥è­¦**ã€‚\n\nç»™å®šä¸€ä¸ªä»£è¡¨æ¯ä¸ªæˆ¿å±‹å­˜æ”¾é‡‘é¢çš„éè´Ÿæ•´æ•°æ•°ç»„ï¼Œè®¡ç®—ä½ **åœ¨ä¸è§¦åŠ¨è­¦æŠ¥è£…ç½®çš„æƒ…å†µä¸‹** ï¼Œä»Šæ™šèƒ½å¤Ÿå·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ã€‚\n\nç¤ºä¾‹ 1ï¼š\n\n```\nè¾“å…¥ï¼šnums = [2,3,2]\nè¾“å‡ºï¼š3\nè§£é‡Šï¼šä½ ä¸èƒ½å…ˆå·çªƒ 1 å·æˆ¿å±‹ï¼ˆé‡‘é¢ = 2ï¼‰ï¼Œç„¶åå·çªƒ 3 å·æˆ¿å±‹ï¼ˆé‡‘é¢ = 2ï¼‰, å› ä¸ºä»–ä»¬æ˜¯ç›¸é‚»çš„ã€‚\n```\n\n\nç¤ºä¾‹ 2ï¼š\n\n```\nè¾“å…¥ï¼šnums = [1,2,3,1]\nè¾“å‡ºï¼š4\nè§£é‡Šï¼šä½ å¯ä»¥å…ˆå·çªƒ 1 å·æˆ¿å±‹ï¼ˆé‡‘é¢ = 1ï¼‰ï¼Œç„¶åå·çªƒ 3 å·æˆ¿å±‹ï¼ˆé‡‘é¢ = 3ï¼‰ã€‚\n     å·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ = 1 + 3 = 4 ã€‚\n```\n\nç¤ºä¾‹ 3ï¼š\n\n```\nè¾“å…¥ï¼šnums = [1,2,3]\nè¾“å‡ºï¼š3\n```\n\næç¤ºï¼š\n\n```\n1 <= nums.length <= 100\n0 <= nums[i] <= 1000\n```\n\n## é¢˜è§£\n\nè¿™é“é¢˜æ˜¯**æ‰“å®¶åŠ«èˆ**çš„è¿›é˜¶ï¼Œå’Œåˆçº§ç‰ˆçš„ä¸åŒä¹‹å¤„æ˜¯ï¼Œè¿™é“é¢˜ä¸­çš„æˆ¿å±‹æ˜¯é¦–å°¾ç›¸è¿çš„ï¼Œç¬¬ä¸€é—´æˆ¿å±‹å’Œæœ€åä¸€é—´æˆ¿å±‹ç›¸é‚»ï¼Œå› æ­¤ç¬¬ä¸€é—´æˆ¿å±‹å’Œæœ€åä¸€é—´æˆ¿å±‹ä¸èƒ½åœ¨åŒä¸€æ™šä¸Šå·çªƒã€‚\n\nå’Œå…¶ç›¸ä¼¼ï¼Œè¿™é“é¢˜ä¹Ÿå¯ä»¥ä½¿ç”¨åŠ¨æ€è§„åˆ’è§£å†³ã€‚å»ºè®®é¦–å…ˆäº†è§£åŠ¨æ€è§„åˆ’çš„æ€æƒ³ã€‚\n\n---\n\né¦–å…ˆè€ƒè™‘æœ€ç®€å•çš„æƒ…å†µã€‚å¦‚æœåªæœ‰ä¸€é—´æˆ¿å±‹ï¼Œåˆ™å·çªƒè¯¥æˆ¿å±‹ï¼Œå¯ä»¥å·çªƒåˆ°æœ€é«˜æ€»é‡‘é¢ã€‚å¦‚æœåªæœ‰ä¸¤é—´æˆ¿å±‹ï¼Œåˆ™ç”±äºä¸¤é—´æˆ¿å±‹ç›¸é‚»ï¼Œä¸èƒ½åŒæ—¶å·çªƒï¼Œåªèƒ½å·çªƒå…¶ä¸­çš„ä¸€é—´æˆ¿å±‹ï¼Œå› æ­¤é€‰æ‹©å…¶ä¸­é‡‘é¢è¾ƒé«˜çš„æˆ¿å±‹è¿›è¡Œå·çªƒï¼Œå¯ä»¥å·çªƒåˆ°æœ€é«˜æ€»é‡‘é¢ã€‚\n\næ³¨æ„åˆ°å½“æˆ¿å±‹æ•°é‡ä¸è¶…è¿‡ä¸¤é—´æ—¶ï¼Œæœ€å¤šåªèƒ½å·çªƒä¸€é—´æˆ¿å±‹ï¼Œå› æ­¤ä¸éœ€è¦è€ƒè™‘é¦–å°¾ç›¸è¿çš„é—®é¢˜ã€‚å¦‚æœæˆ¿å±‹æ•°é‡å¤§äºä¸¤é—´ï¼Œå°±å¿…é¡»è€ƒè™‘é¦–å°¾ç›¸è¿çš„é—®é¢˜ï¼Œç¬¬ä¸€é—´æˆ¿å±‹å’Œæœ€åä¸€é—´æˆ¿å±‹ä¸èƒ½åŒæ—¶å·çªƒã€‚\n\nå¦‚ä½•æ‰èƒ½ä¿è¯ç¬¬ä¸€é—´æˆ¿å±‹å’Œæœ€åä¸€é—´æˆ¿å±‹ä¸åŒæ—¶å·çªƒå‘¢ï¼Ÿå¦‚æœå·çªƒäº†ç¬¬ä¸€é—´æˆ¿å±‹ï¼Œåˆ™ä¸èƒ½å·çªƒæœ€åä¸€é—´æˆ¿å±‹ï¼Œå› æ­¤å·çªƒæˆ¿å±‹çš„èŒƒå›´æ˜¯ç¬¬ä¸€é—´æˆ¿å±‹åˆ°æœ€åç¬¬äºŒé—´æˆ¿å±‹ï¼›å¦‚æœå·çªƒäº†æœ€åä¸€é—´æˆ¿å±‹ï¼Œåˆ™ä¸èƒ½å·çªƒç¬¬ä¸€é—´æˆ¿å±‹ï¼Œå› æ­¤å·çªƒæˆ¿å±‹çš„èŒƒå›´æ˜¯ç¬¬äºŒé—´æˆ¿å±‹åˆ°æœ€åä¸€é—´æˆ¿å±‹ã€‚\n\nå‡è®¾æ•°ç»„$nums$çš„é•¿åº¦ä¸º$n$ã€‚å¦‚æœä¸å·çªƒæœ€åä¸€é—´æˆ¿å±‹ï¼Œåˆ™å·çªƒæˆ¿å±‹çš„ä¸‹æ ‡èŒƒå›´æ˜¯$[0, n-2]$ï¼›å¦‚æœä¸å·çªƒç¬¬ä¸€é—´æˆ¿å±‹ï¼Œåˆ™å·çªƒæˆ¿å±‹çš„ä¸‹æ ‡èŒƒå›´æ˜¯$[1,nâˆ’1]$ã€‚åœ¨ç¡®å®šå·çªƒæˆ¿å±‹çš„ä¸‹æ ‡èŒƒå›´ä¹‹åï¼Œå³å¯ç”¨ç¬¬1é¢˜çš„æ–¹æ³•è§£å†³ã€‚å¯¹äºä¸¤æ®µä¸‹æ ‡èŒƒå›´åˆ†åˆ«è®¡ç®—å¯ä»¥å·çªƒåˆ°çš„æœ€é«˜æ€»é‡‘é¢ï¼Œå…¶ä¸­çš„æœ€å¤§å€¼å³ä¸ºåœ¨$n$é—´æˆ¿å±‹ä¸­å¯ä»¥å·çªƒåˆ°çš„æœ€é«˜æ€»é‡‘é¢ã€‚\n\nå‡è®¾å·çªƒæˆ¿å±‹çš„ä¸‹æ ‡èŒƒå›´æ˜¯$[start,end]$ï¼Œç”¨$dp[i]$è¡¨ç¤ºåœ¨ä¸‹æ ‡èŒƒå›´$[start,i]$å†…å¯ä»¥å·çªƒåˆ°çš„æœ€é«˜æ€»é‡‘é¢ï¼Œé‚£ä¹ˆå°±æœ‰å¦‚ä¸‹çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š\n\n$dp[i]=max(dp[iâˆ’2]+nums[i],dp[iâˆ’1])$\n\nè¾¹ç•Œæ¡ä»¶ä¸ºï¼š\n\n$$\n\\begin{cases} \\textit{dp}[\\textit{start}] = \\textit{nums}[\\textit{start}] & åªæœ‰ä¸€é—´æˆ¿å±‹ï¼Œåˆ™å·çªƒè¯¥æˆ¿å±‹ \\\\ \\textit{dp}[\\textit{start}+1] = \\max(\\textit{nums}[\\textit{start}], \\textit{nums}[\\textit{start}+1]) & åªæœ‰ä¸¤é—´æˆ¿å±‹ï¼Œå·çªƒå…¶ä¸­é‡‘é¢è¾ƒé«˜çš„æˆ¿å±‹ \\end{cases}\n$$\n è®¡ç®—å¾—åˆ°$dp[end]$å³ä¸ºä¸‹æ ‡èŒƒå›´$[start,end]$å†…å¯ä»¥å·çªƒåˆ°çš„æœ€é«˜æ€»é‡‘é¢ã€‚\n\nåˆ†åˆ«å–$(start,end)=(0,nâˆ’2)$å’Œ$(start,end)=(1,nâˆ’1)$è¿›è¡Œè®¡ç®—ï¼Œå–ä¸¤ä¸ª$dp[end]$ä¸­çš„æœ€å¤§å€¼ï¼Œå³å¯å¾—åˆ°æœ€ç»ˆç»“æœã€‚\n\næ ¹æ®ä¸Šè¿°æ€è·¯ï¼Œå¯ä»¥å¾—åˆ°æ—¶é—´å¤æ‚åº¦$O(n)$å’Œç©ºé—´å¤æ‚åº¦$O(n)$çš„å®ç°ã€‚\n\nè€ƒè™‘åˆ°æ¯é—´æˆ¿å±‹çš„æœ€é«˜æ€»é‡‘é¢åªå’Œè¯¥æˆ¿å±‹çš„å‰ä¸¤é—´æˆ¿å±‹çš„æœ€é«˜æ€»é‡‘é¢ç›¸å…³ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨æ»šåŠ¨æ•°ç»„ï¼Œåœ¨æ¯ä¸ªæ—¶åˆ»åªéœ€è¦å­˜å‚¨å‰ä¸¤é—´æˆ¿å±‹çš„æœ€é«˜æ€»é‡‘é¢ï¼Œå°†ç©ºé—´å¤æ‚åº¦é™åˆ°$O(1)$ã€‚\n\n```cpp\nclass Solution {\npublic:\n    int robRange(vector<int>& nums, int start, int end) {\n        int first = nums[start], second = max(nums[start], nums[start + 1]);\n        for (int i = start + 2; i <= end; i++) {\n            int temp = second;\n            second = max(first + nums[i], second);\n            first = temp;\n        }\n        return second;\n    }\n\n    int rob(vector<int>& nums) {\n        int length = nums.size();\n        if (length == 1) {\n            return nums[0];\n        } else if (length == 2) {\n            return max(nums[0], nums[1]);\n        }\n        return max(robRange(nums, 0, length - 2), robRange(nums, 1, length - 1));\n    }\n};\n```\n\n# æ‰“å®¶åŠ«èˆ3\n\nå°å·åˆå‘ç°äº†ä¸€ä¸ªæ–°çš„å¯è¡Œçªƒçš„åœ°åŒºã€‚è¿™ä¸ªåœ°åŒºåªæœ‰ä¸€ä¸ªå…¥å£ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º`root`ã€‚\n\né™¤äº†`root`ä¹‹å¤–ï¼Œæ¯æ ‹æˆ¿å­æœ‰ä¸”åªæœ‰ä¸€ä¸ªâ€œçˆ¶â€œæˆ¿å­ä¸ä¹‹ç›¸è¿ã€‚ä¸€ç•ªä¾¦å¯Ÿä¹‹åï¼Œèªæ˜çš„å°å·æ„è¯†åˆ°â€œè¿™ä¸ªåœ°æ–¹çš„æ‰€æœ‰æˆ¿å±‹çš„æ’åˆ—ç±»ä¼¼äºä¸€æ£µäºŒå‰æ ‘â€ã€‚ å¦‚æœ**ä¸¤ä¸ªç›´æ¥ç›¸è¿çš„æˆ¿å­åœ¨åŒä¸€å¤©æ™šä¸Šè¢«æ‰“åŠ«**ï¼Œæˆ¿å±‹å°†è‡ªåŠ¨æŠ¥è­¦ã€‚\n\nç»™å®šäºŒå‰æ ‘çš„`root`ã€‚è¿”å›**åœ¨ä¸è§¦åŠ¨è­¦æŠ¥çš„æƒ…å†µä¸‹**ï¼Œå°å·èƒ½å¤Ÿç›—å–çš„æœ€é«˜é‡‘é¢ ã€‚\n\n**ç¤ºä¾‹ 1:**\n\n![image-20220518184546102](../../images/åˆ·é¢˜_æ‰“å®¶åŠ«èˆ/image-20220518184546102.png)\n\n```\nè¾“å…¥: root = [3,2,3,null,3,null,1]\nè¾“å‡º: 7 \nè§£é‡Š: å°å·ä¸€æ™šèƒ½å¤Ÿç›—å–çš„æœ€é«˜é‡‘é¢ 3 + 3 + 1 = 7\n```\n\n**ç¤ºä¾‹ 2:**\n\n![image-20220518184621752](../../images/åˆ·é¢˜_æ‰“å®¶åŠ«èˆ/image-20220518184621752.png)\n\n```\nè¾“å…¥: root = [3,4,5,1,3,null,1]\nè¾“å‡º: 9\nè§£é‡Š: å°å·ä¸€æ™šèƒ½å¤Ÿç›—å–çš„æœ€é«˜é‡‘é¢ 4 + 5 = 9\n```\n\n**æç¤ºï¼š**\n\n- æ ‘çš„èŠ‚ç‚¹æ•°åœ¨ `[1, 104]` èŒƒå›´å†…\n- `0 <= Node.val <= 104`\n\n## é¢˜è§£\n\næ€è·¯ä¸ç®—æ³•\n\nç®€åŒ–ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼šä¸€æ£µäºŒå‰æ ‘ï¼Œæ ‘ä¸Šçš„æ¯ä¸ªç‚¹éƒ½æœ‰å¯¹åº”çš„æƒå€¼ï¼Œæ¯ä¸ªç‚¹æœ‰ä¸¤ç§çŠ¶æ€ï¼ˆé€‰ä¸­å’Œä¸é€‰ä¸­ï¼‰ï¼Œé—®åœ¨ä¸èƒ½åŒæ—¶é€‰ä¸­æœ‰çˆ¶å­å…³ç³»çš„ç‚¹çš„æƒ…å†µä¸‹ï¼Œèƒ½é€‰ä¸­çš„ç‚¹çš„æœ€å¤§æƒå€¼å’Œæ˜¯å¤šå°‘ã€‚\n\næˆ‘ä»¬å¯ä»¥ç”¨$f(o)$è¡¨ç¤ºé€‰æ‹©$o$èŠ‚ç‚¹çš„æƒ…å†µä¸‹ï¼Œ$o$èŠ‚ç‚¹çš„å­æ ‘ä¸Šè¢«é€‰æ‹©çš„èŠ‚ç‚¹çš„æœ€å¤§æƒå€¼å’Œï¼›$g(o)$è¡¨ç¤ºä¸é€‰æ‹©$o$èŠ‚ç‚¹çš„æƒ…å†µä¸‹ï¼Œ$o$èŠ‚ç‚¹çš„å­æ ‘ä¸Šè¢«é€‰æ‹©çš„èŠ‚ç‚¹çš„æœ€å¤§æƒå€¼å’Œï¼›$l$å’Œ$r$ä»£è¡¨$o$çš„å·¦å³å­©å­ã€‚\n\n* å½“$o$è¢«é€‰ä¸­æ—¶ï¼Œ$o$çš„å·¦å³å­©å­éƒ½ä¸èƒ½è¢«é€‰ä¸­ï¼Œæ•…$o$è¢«é€‰ä¸­æƒ…å†µä¸‹å­æ ‘ä¸Šè¢«é€‰ä¸­ç‚¹çš„æœ€å¤§æƒå€¼å’Œä¸º$l$å’Œ$r$ä¸è¢«é€‰ä¸­çš„æœ€å¤§æƒå€¼å’Œç›¸åŠ ï¼Œå³$f(o)=g(l)+g(r)$ã€‚\n* å½“$o$ä¸è¢«é€‰ä¸­æ—¶ï¼Œ$o$çš„å·¦å³å­©å­å¯ä»¥è¢«é€‰ä¸­ï¼Œä¹Ÿå¯ä»¥ä¸è¢«é€‰ä¸­ã€‚å¯¹äº$o$çš„æŸä¸ªå…·ä½“çš„å­©å­$x$ï¼Œå®ƒå¯¹$o$çš„è´¡çŒ®æ˜¯$x$è¢«é€‰ä¸­å’Œä¸è¢«é€‰ä¸­æƒ…å†µä¸‹æƒå€¼å’Œçš„è¾ƒå¤§å€¼ã€‚æ•…$g(o)=max\\{f(l),g(l)\\}+max\\{f(r),g(r)\\}$ã€‚\n\nè‡³æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å“ˆå¸Œè¡¨æ¥å­˜$f$å’Œ$g$çš„å‡½æ•°å€¼ï¼Œç”¨æ·±åº¦ä¼˜å…ˆæœç´¢çš„åŠæ³•ååºéå†è¿™æ£µäºŒå‰æ ‘ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„$f$å’Œ$g$ã€‚æ ¹èŠ‚ç‚¹çš„$f$å’Œ$g$çš„æœ€å¤§å€¼å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ç­”æ¡ˆã€‚\n\næˆ‘ä»¬ä¸éš¾ç»™å‡ºè¿™æ ·çš„å®ç°ï¼š\n\n```cpp\nclass Solution {\npublic:\n    unordered_map <TreeNode*, int> f, g;\n\n    void dfs(TreeNode* node) {\n        if (!node) {\n            return;\n        }\n        dfs(node->left);\n        dfs(node->right);\n        f[node] = node->val + g[node->left] + g[node->right];\n        g[node] = max(f[node->left], g[node->left]) + max(f[node->right], g[node->right]);\n    }\n\n    int rob(TreeNode* root) {\n        dfs(root);\n        return max(f[root], g[root]);\n    }\n};\n```\n\nå‡è®¾äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°ä¸º$n$ã€‚\n\næˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œä»¥ä¸Šçš„ç®—æ³•å¯¹äºŒå‰æ ‘åšäº†ä¸€æ¬¡ååºéå†ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯$O(n)$ï¼›ç”±äºé€’å½’ä¼šä½¿ç”¨åˆ°æ ˆç©ºé—´ï¼Œç©ºé—´ä»£ä»·æ˜¯$O(n)$ï¼Œå“ˆå¸Œè¡¨çš„ç©ºé—´ä»£ä»·ä¹Ÿæ˜¯$O(n)$ï¼Œæ•…ç©ºé—´å¤æ‚åº¦ä¹Ÿæ˜¯$O(n)$ã€‚\n\næˆ‘ä»¬å¯ä»¥åšä¸€ä¸ªå°å°çš„ä¼˜åŒ–ï¼Œæˆ‘ä»¬å‘ç°æ— è®ºæ˜¯$f(o)$è¿˜æ˜¯$g(o)$ï¼Œä»–ä»¬æœ€ç»ˆçš„å€¼åªå’Œ$f(l)$ã€$g(l)$ã€$f(r)$ã€$g(r)$æœ‰å…³ï¼Œæ‰€ä»¥å¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬åªå…³å¿ƒå®ƒçš„å­©å­èŠ‚ç‚¹ä»¬çš„$f$å’Œ$g$æ˜¯å¤šå°‘ã€‚æˆ‘ä»¬å¯ä»¥è®¾è®¡ä¸€ä¸ªç»“æ„ï¼Œè¡¨ç¤ºæŸä¸ªèŠ‚ç‚¹çš„$f$å’Œ$g$å€¼ï¼Œåœ¨æ¯æ¬¡é€’å½’è¿”å›çš„æ—¶å€™ï¼Œéƒ½æŠŠè¿™ä¸ªç‚¹å¯¹åº”çš„$f$å’Œ$g$è¿”å›ç»™ä¸Šä¸€çº§è°ƒç”¨ï¼Œè¿™æ ·å¯ä»¥çœå»å“ˆå¸Œè¡¨çš„ç©ºé—´ã€‚\n\nä»£ç å¦‚ä¸‹ã€‚\n\n```cpp\nstruct SubtreeStatus {\n    int selected;\n    int notSelected;\n};\n\nclass Solution {\npublic:\n    SubtreeStatus dfs(TreeNode* node) {\n        if (!node) {\n            return {0, 0};\n        }\n        auto l = dfs(node->left);\n        auto r = dfs(node->right);\n        int selected = node->val + l.notSelected + r.notSelected;\n        int notSelected = max(l.selected, l.notSelected) + max(r.selected, r.notSelected);\n        return {selected, notSelected};\n    }\n\n    int rob(TreeNode* root) {\n        auto rootStatus = dfs(root);\n        return max(rootStatus.selected, rootStatus.notSelected);\n    }\n};\n```\n\nå¤æ‚åº¦åˆ†æ\n\næ—¶é—´å¤æ‚åº¦ï¼š$O(n)$ã€‚ä¸Šæ–‡ä¸­å·²åˆ†æã€‚\n\nç©ºé—´å¤æ‚åº¦ï¼š$O(n)$ã€‚è™½ç„¶ä¼˜åŒ–è¿‡çš„ç‰ˆæœ¬çœå»äº†å“ˆå¸Œè¡¨çš„ç©ºé—´ï¼Œä½†æ˜¯æ ˆç©ºé—´çš„ä½¿ç”¨ä»£ä»·ä¾æ—§æ˜¯$O(n)$ï¼Œæ•…ç©ºé—´å¤æ‚åº¦ä¸å˜ã€‚\n","categories":["ç®—æ³•","åˆ·é¢˜"]},{"title":"MySQL_SQL","url":"/æ•°æ®åº“/MySQL_SQL/","content":"\n# å†…å®¹\n\n1. SQL(Structure Query Language, ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€)\n2. SQLåˆ’åˆ†ä¸º3ä¸ªç±»åˆ«ï¼ŒDD(Definition)Lã€DM(Manipulation)Lã€DC(Control)L\n3. åº“æ“ä½œ\n4. è¡¨æ“ä½œ\n5. CRUD\n6. SQLè¯­å¥å’Œç´¢å¼•çš„å…³ç³»\n\n# SQL\n\nSQLå³Structure Query Languageï¼Œç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ã€‚å®ƒæ˜¯å…³ç³»å‹æ•°æ®åº“çš„é€šç”¨è¯­è¨€ã€‚\n\nSQLå¯åˆ’åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§ç±»åˆ«ï¼š\n\n1. DDL(Data Definition Language)\n   * æ•°æ®å®šä¹‰è¯­è¨€ï¼Œä¸æ•°æ®åº“ã€è¡¨ã€åˆ—ã€ç´¢å¼•ç­‰æ•°æ®åº“å¯¹è±¡çš„å®šä¹‰æœ‰å…³ã€‚\n   * å¸¸ç”¨çš„è¯­å¥å…³é”®å­—ä¸»è¦åŒ…æ‹¬`create`ã€`drop`ã€`alter`ç­‰ã€‚\n2. DML(Data Manipulation Language)\n   * æ•°æ®æ“çºµè¯­å¥ï¼Œç”¨äºæ·»åŠ ã€åˆ é™¤ã€æ›´æ–°å’ŒæŸ¥è¯¢æ•°æ®åº“è®°å½•ï¼Œå¹¶æ£€æŸ¥æ•°æ®å®Œæ•´æ€§ã€‚\n   * å¸¸ç”¨çš„è¯­å¥å…³é”®å­—ä¸»è¦åŒ…æ‹¬`insert`ã€`delete`ã€`update`ã€`select`ç­‰ã€‚\n3. DCL(Data Control Language)\n   * æ•°æ®æ§åˆ¶è¯­å¥ï¼Œç”¨äºæ§åˆ¶ä¸åŒçš„è®¸å¯å’Œè®¿é—®çº§åˆ«çš„è¯­å¥ã€‚ä¸æ•°æ®åº“ã€è¡¨ã€å­—æ®µã€ç”¨æˆ·çš„è®¿é—®æƒé™å’Œå®‰å…¨çº§åˆ«æœ‰å…³ã€‚\n   * ä¸»è¦çš„è¯­å¥å…³é”®å­—åŒ…æ‹¬`grant`ã€`revoke`ã€‚\n\n# åº“æ“ä½œ\n\næŸ¥è¯¢æ•°æ®åº“ï¼š`show databases;`\n\nåˆ›å»ºæ•°æ®åº“ï¼š`create database dbname;`\n\nåˆ é™¤æ•°æ®åº“ï¼š`drop database dbname;`\n\né€‰æ‹©æ•°æ®åº“ï¼š`use dbname;`\n\næˆ‘ä»¬ä¸‹é¢ä»¥å­¦æ ¡çš„æ•°æ®åº“ä¸ºä¾‹ï¼Œåˆ›å»ºåº“è¡¨ã€‚\n\n```mysql\nCREATE DATABASE school;\nUSE school;\n```\n\n# è¡¨æ“ä½œ\n\nè¡¨çš„è®¾è®¡è¦ç´ ï¼š\n\n1. å­—æ®µçš„æ•°æ®ç±»å‹\n2. å®Œæ•´æ€§çº¦æŸæ¡ä»¶çš„è§„èŒƒ\n3. ä¸€å¯¹ä¸€/ä¸€å¯¹å¤š/å¤šå¯¹å¤šå®ä½“å…³ç³»å¯¹åº”çš„è¡¨è®¾è®¡åŸåˆ™\n\n* åˆ›å»ºè¡¨\n\n```mysql\nCREATE TABLE user(\n    id INT UNSIGNED PRIMARY KEY NOT NULL AUTO_INCREMENT,\n    name VARCHAR(50) UNIQUE NOT NULL,\n    age TINTINT NOT NULL,\n    sex ENUM('M', 'W') NOT NULL\n)ENGINE=INNODB DEFAULT CHARSET=utf8;\n```\n\n> å¯¹äºå­˜å‚¨å¼•æ“ä»¥åŠé»˜è®¤å­—ç¬¦é›†çš„é…ç½®æ–‡ä»¶ï¼Œ\n> åœ¨windowsä¸‹ä¸ºmysqlå®‰è£…ç›®å½•ä¸‹çš„`my.ini`ï¼›\n> linuxä¸‹ä¸º`/etc/my.cnf`ã€‚\n> é…ç½®å­—æ®µä¸º`[mysqld]`\n\n* æŸ¥çœ‹è¡¨\n\n```mysql\nshow tables;\n```\n\n![image-20220517103024114](../../images/MySQL_SQL/image-20220517103024114.png)\n\n* æŸ¥çœ‹è¡¨çš„æè¿°ä¿¡æ¯\n\n```mysql\nDESC user;\ndescribe user; # å…¨æ‹¼\n```\n\n![image-20220517103053213](../../images/MySQL_SQL/image-20220517103053213.png)\n\n* è¡¨å·²åˆ›å»ºåï¼ŒæŸ¥çœ‹è¡¨çš„åˆ›å»ºè¯­å¥\n\n```mysql\nSHOW CREATE TABLE user;\nSHOW CREATE TABLE user\\G # \\Gç»“å°¾å’Œ;ç»“å°¾çš„åŒºåˆ«åœ¨äºæ˜¾ç¤ºæ–¹å¼ä¸åŒ\n```\n\n![image-20220517103908450](../../images/MySQL_SQL/image-20220517103908450.png)\n\n* åˆ é™¤è¡¨ - drop (ä¸å…‰æ˜¯è¡¨çš„å†…å®¹ï¼Œæ•´ä¸ªè¡¨çš„ç»“æ„éƒ½æ²¡äº†)\n\n```mysql\nDROP TABLE user;\n```\n# ä¸å¸¸ç”¨çš„æ“ä½œ\n## Viewï¼ˆè§†å›¾ï¼‰\nåœ¨æ•°æ®åº“ä¸­ï¼Œå·¦è¾¹æ ï¼Œå­˜åœ¨ä¸€ä¸ªviewï¼Œå¯ä»¥å­˜æ”¾ä¸€ä¸ªè¡¨ä¸­çš„å¤šä¸ªå­—æ®µçš„æŸ¥è¯¢ç»“æœï¼Œä¹Ÿå¯ä»¥å­˜æ”¾å¤šä¸ªè¡¨è¿æ¥ä¹‹åçš„ä¸´æ—¶ç»“æœã€‚\n![](../../images/MySQL_SQL/image-20250730182642168.png)\n\nå®é™…ç”¨é€”ä¸­ï¼Œè§†å›¾å¯ä»¥ç”¨äºå±è”½ä¸å®é™…æ•°æ®åº“çš„å·®å¼‚ï¼Œæ¯”å¦‚æ•°æ®åº“çš„å®é™…å­—æ®µå¯èƒ½ä¸æ˜¯ç”¨æˆ·è¯·æ±‚çš„å­—æ®µï¼Œè§†å›¾èµ·äº†ä¸ªåˆ«åã€‚\nä¹Ÿå¯ä»¥ç”¨äºéšè—ä¸€äº›ç»†èŠ‚ã€‚æŠŠå®é™…æ•°æ®åº“ä¸­çš„å†…å®¹æå–å‡ºæ¥çš„ä¸æ•æ„Ÿçš„éƒ¨åˆ†æ”¾åˆ°è§†å›¾é‡Œï¼Œå»ºç«‹è™šæ‹Ÿçš„å­—æ®µï¼Œä¾›ç”¨æˆ·ä½¿ç”¨ã€‚\n## å­˜å‚¨è¿‡ç¨‹\nç±»ä¼¼äºæ‰¹å¤„ç†è„šæœ¬ã€‚å¯ä»¥æ²¡æœ‰è¿”å›å€¼ã€‚\n## å‡½æ•°\nå°è£…æ“ä½œè¿‡ç¨‹ï¼Œå¯ä»¥å®šä¹‰å˜é‡ï¼Œå¯ä»¥æœ‰æ§åˆ¶è¯­å¥ã€å¾ªç¯è¯­å¥ç­‰ã€‚å¿…é¡»æœ‰è¿”å›å€¼ã€‚\n## è§¦å‘å™¨\nè§¦å‘å™¨çš„ä½œç”¨ï¼šæ¯”å¦‚æ’å…¥ã€åˆ é™¤ä¸€æ¡è®°å½•ç­‰ç­‰æ“ä½œï¼Œå¯ä»¥è¿›è¡Œç›¸åº”çš„å›è°ƒã€‚\nè§¦å‘å™¨æ˜¯åŸºäºè¡Œçš„ï¼Œå³åŸºäºè®°å½•çš„ã€‚å½“æ“ä½œå¾ˆå¤šè¡Œæ—¶ï¼Œä¸å»ºè®®ä½¿ç”¨è§¦å‘å™¨ã€‚\n## æ€»ç»“\nå­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°ä¸€èˆ¬æ˜¯ä¸“é—¨æ“ä½œæ•°æ®åº“çš„åç«¯äººå‘˜è´Ÿè´£çš„ã€‚å®é™…ä¸Šï¼Œå­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°çš„æ“ä½œï¼Œå®Œå…¨å¯ä»¥åœ¨ä¸Šå±‚æœåŠ¡ç”¨é«˜çº§è¯­è¨€ï¼ˆ`C++`ç­‰ï¼‰å®Œæˆã€‚æ•°æ®åº“å¯ä»¥åªè´Ÿè´£ç®€å•çš„è®¡ç®—ã€‚\n# CRUD\n\n## Create - æ’å…¥\n\n```mysql\nINSERT INTO user VALUES(1, 'zhangsan', 20, 'M'); #å¦‚æœä¸æŒ‡æ˜æ’å…¥çš„å±æ€§ï¼Œåˆ™å¿…é¡»æŒ‰ç…§å­—æ®µçš„é¡ºåºå…¨éƒ¨å¡«å…¥\nINSERT INTO user(name,age,sex) VALUES('lisi', 22, 'W'); #æŒ‡æ˜æ’å…¥çš„å±æ€§ï¼Œç”±äºidè®¾ç½®ä¸ºè‡ªå¢æ€§ï¼Œæ‰€ä»¥ä¸ç”¨å¡«å†™ã€‚\n```\n\n* æ¯æ¬¡æ·»åŠ ä¸€ä¸ª\n\n```mysql\nINSERT INTO user(name,age,sex) VALUES('zhangsan', 20, 'M');\nINSERT INTO user(name,age,sex) VALUES('gaoyang', 22, 'W');\nINSERT INTO user(name,age,sex) VALUES('chenwei', 20, 'M');\nINSERT INTO user(name,age,sex) VALUES('zhangfan', 21, 'W');\nINSERT INTO user(name,age,sex) VALUES('zhanglan', 21, 'W');\n```\n\n* æ‰¹é‡å¢åŠ \n\n```mysql\nINSERT INTO user(name,age,sex) VALUES\n('zhangsan', 20, 'M'),\n('gaoyang', 22, 'W'),\n('chenwei', 20, 'M'),\n('zhangfan', 21, 'W'),\n('zhanglan', 21, 'W');\n```\n\n### æœ€ç»ˆè¡¨ä¸­å­˜æ”¾çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚æœ‰å•¥åŒºåˆ«ï¼Ÿ\n\næˆ‘ä»¬ä½¿ç”¨sqlï¼Œç›¸å½“äºmysql serverçš„ä¸€ä¸ªclientã€‚\n\næ¯æ¬¡æ·»åŠ ä¸€ä¸ªï¼š\n\n1. clientå’Œserverè¿›è¡Œtcpä¸‰æ¬¡æ¡æ‰‹ï¼Œå»ºç«‹é€šä¿¡é“¾è·¯ï¼›\n2. clientå‘é€sqlè¯­å¥åˆ°serverä¸Šæ¥æ”¶å¹¶å¤„ç†ï¼Œè¿”å›å¤„ç†ç»“æœï¼›\n3. serverå’Œclientæ–­å¼€è¿æ¥ï¼Œtcpå››æ¬¡æŒ¥æ‰‹ï¼Œé‡Šæ”¾é€šä¿¡é“¾è·¯ã€‚\n\næŠŠæ¯æ¬¡æ·»åŠ ä¸€æ¡è®°å½•çš„æ“ä½œæŠ½è±¡ä¸º3æ¬¡æ­¥éª¤ã€‚åˆ™æ€»å…±éœ€è¦`3*n`ä¸ªæ­¥éª¤ã€‚\n\nè€Œå¦‚æœæ˜¯æ‰¹é‡æ·»åŠ ï¼š\n\n1. clientå’Œserverè¿›è¡Œtcpä¸‰æ¬¡æ¡æ‰‹ï¼Œå»ºç«‹é€šä¿¡é“¾è·¯ï¼›\n2. clientå‘é€sqlè¯­å¥åˆ°serverä¸Šæ¥æ”¶å¹¶å¤„ç†ï¼Œè¿”å›å¤„ç†ç»“æœï¼›\n3. serverå’Œclientæ–­å¼€è¿æ¥ï¼Œtcpå››æ¬¡æŒ¥æ‰‹ï¼Œé‡Šæ”¾é€šä¿¡é“¾è·¯ã€‚\n\nåˆ™æ€»å…±ä»…éœ€`3`ä¸ªæ­¥éª¤ï¼Œå³å¯å…¨éƒ¨æ’å…¥ã€‚\n\n## Delete - åˆ é™¤\n\n```mysql\nDELETE FROM user;\t\t\t\t#åˆ é™¤è¡¨ä¸­æ‰€æœ‰æ•°æ®\nDELETE FROM user WHERE id=1; \t#åªåˆ é™¤idä¸º1çš„è®°å½•\n```\n\n## Update - æ›´æ–°\n\n```mysql\nUPDATE user SET age=age+1 WHERE name='gaoyang';\t#è°ƒæ­£gaoyangçš„å¹´é¾„+1\n```\n\n## Retrieve - æŸ¥è¯¢\n\nåœ¨è¿™é‡Œæˆ‘ä»¬ç¤ºä¾‹ä¸€äº›ç®€å•çš„æŸ¥è¯¢è¯­å¥ã€‚\n\n* æ— æ¡ä»¶æŸ¥è¯¢å…¨éƒ¨å­—æ®µ\n\n```mysql\nSELECT * FROM user;\t#ä¸æ¨èï¼Œæœ€å¥½è¿˜æ˜¯è€è€å®å®åœ°å†™å‡ºæ‰€æœ‰å­—æ®µåç§°ï¼Œå› ä¸ºè¡¨çš„ç»“æ„ä¹‹åå¯èƒ½ä¼šå˜æ›´ï¼Œå¯èƒ½ä¼šå½±å“ä¸šåŠ¡ä»£ç ã€‚\n```\n\n* æ¡ä»¶æŸ¥è¯¢æŒ‡å®šå­—æ®µ\n\n```mysql\nSELECT name,age,sex FROM user WHERE age>=21;\nSELECT name,age,sex FROM user WHERE age>20 AND age<22;\nSELECT name,age,sex FROM user WHERE BETWEEN 20 AND 22;#é—­åŒºé—´\n```\n\n```mysql\n# ä»¥ä¸‹ä¸¤ä¸ªsqlè¯­å¥æ•ˆæœä¸€è‡´ã€‚\nSELECT name,age,sex FROM user WHERE age=20 OR age=21;\nSELECT name,age,sex FROM user WHERE age IN (20,21);\n```\n\n* ä½¿ç”¨é€šé…ç¬¦æŸ¥è¯¢\n\n```mysql\nSELECT name,age,sex FROM user WHERE name LIKE \"zhang%\";#å¿…é¡»ç”¨LIKEï¼Œä¸èƒ½ç”¨=ç­‰å·ï¼Œå¦åˆ™ä¼šæŠŠ%é€šé…ç¬¦çœ‹ä½œå®é™…å­—ç¬¦ã€‚\n```\n\n* åˆ¤æ–­ä¸ºç©ºä¸ç”¨`=`ï¼Œè€Œç”¨`IS NULL`\n\n```mysql\nSELECT name,age,sex FROM user WHERE name IS NULL;\nSELECT name,age,sex FROM user WHERE name IS NOT NULL;\n```\n\n### å»é‡\n\næœ‰ä¸¤ç§å»é‡çš„æ–¹å¼\n\n1. `distinct` - ç®€å•åœ°å»é‡\n2. `group by` - åŠŸèƒ½å¼ºå¤§ï¼Œè€—æ—¶\n\n```mysql\nSELECT DISTINCT age FROM user;\n```\n\n![image-20220517114906800](../../images/MySQL_SQL/image-20220517114906800.png)\n\n### åˆå¹¶æŸ¥è¯¢ - union\n\næ ¼å¼å¦‚ä¸‹\n\n```\nSELECT expression1, expression2, ..., expression\nFROM table1 [WHERE conditions]\nUNION [ALL | DISTINCT(default)]\nSELECT expression1, expression2, ..., expression\nFROM table2 [WHERE conditions];\n# unioné»˜è®¤ä¸ºdistinctå»é‡ï¼Œallè¡¨ç¤ºæ˜¾ç¤ºé‡å¤çš„è®°å½•é¡¹\n```\n\n```mysql\nSELECT name,age,sex\nFROM user WHERE age>=21\nUNION ALL\nSELECT name,age,sex\nFROM user WHERE sex='M';\n```\n\n![image-20220517163204447](../../images/MySQL_SQL/image-20220517163204447.png)\n\n# SQLè¯­å¥å’Œç´¢å¼•çš„å…³ç³»\n\n```mysql\nSELECT name,age,sex FROM user WHERE age=20 OR age=21;\n```\n\né€šå¸¸éƒ½è¯´å¸¦`é€»è¾‘ä¸`çš„SQLè¯­å¥ä¼šç”¨åˆ°ç´¢å¼•ï¼Œå¸¦`é€»è¾‘æˆ–`çš„SQLè¯­å¥ä¸ä¼šç”¨åˆ°ç´¢å¼•ã€‚æ¯”å¦‚ä¸Šé¢è¿™å¥å¸¦`é€»è¾‘æˆ–`çš„SQLè¯­å¥ä¸ä¼šç”¨åˆ°ç´¢å¼•å—ï¼Ÿé”™è¯¯ã€‚\n\nå¦‚æœä»…ä»…æ˜¯å¯¹äºè¿™ä¸ªSQLè¯­å¥çš„è¡¨è±¡æ¥è¯´ï¼Œæ˜¯ä¸ä¼šç”¨åˆ°ç´¢å¼•çš„ã€‚ä½†æ˜¯MySQLå®é™…è¿è¡Œè¿‡ç¨‹ä¸­æ˜¯ä¼šå¯¹ç”¨æˆ·æäº¤çš„SQLè¯­å¥è¿›è¡Œä¼˜åŒ–çš„ã€‚\n\n`OR`çš„è¯­ä¹‰æ˜¯ï¼š`è¦ä¹ˆ..., è¦ä¹ˆ...`ã€‚å¯¹äºé€»è¾‘æˆ–è¯­å¥ï¼ŒMySQLæœ‰å¯èƒ½å°†å…¶è½¬åŒ–ä¸º`union`åˆå¹¶æŸ¥è¯¢ï¼Œå³å‰ååˆ†åˆ«æ‰§è¡Œä¸¤ä¸ªä¸åŒçš„ä¸å¸¦é€»è¾‘æˆ–çš„SQLè¯­å¥ï¼Œè¿™æ ·çš„SQLè¯­å¥æ˜¯å®Œå…¨å¯ä»¥ç”¨ä¸åˆ°ç´¢å¼•çš„ã€‚\n\nç±»ä¼¼åœ°ï¼Œå¸¦`in`çš„SQLè¯­å¥ï¼Œè¡¨é¢ä¸Šæ˜¯èƒ½ç”¨åˆ°ç´¢å¼•ï¼›å¸¦`not in`çš„SQLè¯­å¥ï¼Œè¡¨é¢ä¸Šç”¨ä¸åˆ°ç´¢å¼•ã€‚å¸¦ä»…ä»…é™äºMySQLä¸åšä¼˜åŒ–çš„æƒ…å†µã€‚\n\næ‰€ä»¥ï¼Œä¼šä¸ä¼šç”¨åˆ°ç´¢å¼•ä¸èƒ½åªçœ‹è¡¨é¢çš„SQLè¯­å¥ï¼Œè€Œè¦çœ‹MySQLå®é™…å¦‚ä½•ä¼˜åŒ–ã€‚\n\n# è¿æ¥æŸ¥è¯¢\n\nè¡¨1ï¼šEmployees\n\n|EmployeeID|Name|DepartmentID|\n|---|---|---|\n|1|å¼ ä¸‰|101|\n|2|æå››|102|\n|3|ç‹äº”|102|\n|4|èµµå…­|103|\n|â€‹**â€‹5â€‹**â€‹|â€‹**â€‹é’±ä¸ƒâ€‹**â€‹|â€‹**â€‹NULLâ€‹**|\n\nè¡¨2ï¼šDepartments\n\n| DepartmentID | DepartmentName |\n| ------------ | -------------- |\n| 101          | äººäº‹éƒ¨            |\n| 102          | æŠ€æœ¯éƒ¨            |\n| 104          | è´¢åŠ¡éƒ¨            |\n## ç¬›å¡å°”ç§¯ï¼ˆäº¤å‰æŸ¥è¯¢ï¼‰\n```mysql\nSELECT\n    e.EmployeeID AS EmpID,\n    e.Name AS EmpName,\n    e.DepartmentID AS A_DeptID,\n    d.DepartmentID AS B_DeptID,\n    d.DepartmentName AS DeptName\nFROM Employees e -- ç»™è¡¨èµ·åˆ«å 'e'\nCROSS JOIN Departments d; -- ç»™è¡¨èµ·åˆ«å 'd'\n-- æ²¡æœ‰ ON å­å¥ï¼\n```\n\n| EmpID | EmpName | A_DeptID | B_DeptID | DeptName |\n| ----- | ------- | -------- | -------- | -------- |\n| â€‹â€‹1â€‹â€‹ | å¼ ä¸‰      | 101      | â€‹â€‹101â€‹â€‹  | äººäº‹éƒ¨      |\n| â€‹â€‹1â€‹â€‹ | å¼ ä¸‰      | 101      | â€‹â€‹102â€‹â€‹  | æŠ€æœ¯éƒ¨      |\n| â€‹â€‹1â€‹â€‹ | å¼ ä¸‰      | 101      | â€‹â€‹104â€‹â€‹  | è´¢åŠ¡éƒ¨      |\n| â€‹â€‹2â€‹â€‹ | æå››      | 102      | â€‹â€‹101â€‹â€‹  | äººäº‹éƒ¨      |\n| â€‹â€‹2â€‹â€‹ | æå››      | 102      | â€‹â€‹102â€‹â€‹  | æŠ€æœ¯éƒ¨      |\n| â€‹â€‹2â€‹â€‹ | æå››      | 102      | â€‹â€‹104â€‹â€‹  | è´¢åŠ¡éƒ¨      |\n| â€‹â€‹3â€‹â€‹ | ç‹äº”      | 102      | â€‹â€‹101â€‹â€‹  | äººäº‹éƒ¨      |\n| â€‹â€‹3â€‹â€‹ | ç‹äº”      | 102      | â€‹â€‹102â€‹â€‹  | æŠ€æœ¯éƒ¨      |\n| â€‹â€‹3â€‹â€‹ | ç‹äº”      | 102      | â€‹â€‹104â€‹â€‹  | è´¢åŠ¡éƒ¨      |\n| â€‹â€‹4â€‹â€‹ | èµµå…­      | 103      | â€‹â€‹101â€‹â€‹  | äººäº‹éƒ¨      |\n| â€‹â€‹4â€‹â€‹ | èµµå…­      | 103      | â€‹â€‹102â€‹â€‹  | æŠ€æœ¯éƒ¨      |\n| â€‹â€‹4â€‹â€‹ | èµµå…­      | 103      | â€‹â€‹104â€‹â€‹  | è´¢åŠ¡éƒ¨      |\n| 5     | é’±ä¸ƒ      | NULL     | 101      | äººäº‹éƒ¨      |\n| 5     | é’±ä¸ƒ      | NULL     | 102      | æŠ€æœ¯éƒ¨      |\n| 5     | é’±ä¸ƒ      | NULL     | 104      | è´¢åŠ¡éƒ¨      |\n## å†…è¿æ¥ (INNER JOIN / JOIN)\n![](../../images/MySQL_SQL/image-20250729014631298.png)\n\n\n**é€šä¿—è§£é‡Šï¼šåªä¿ç•™â€œä¸¤å¤´éƒ½èƒ½é…ä¸Šå¯¹â€çš„æ•°æ®ã€‚â€‹**â€‹ ä¸¤è¾¹éƒ½æœ‰è®°å½•çš„æ‰æ˜¾ç¤ºå‡ºæ¥ã€‚\n\n```mysql\nSELECT Employees.EmployeeID, Employees.Name, Departments.DepartmentName\nFROM Employees\nINNER JOIN Departments\nON Employees.DepartmentID = Departments.DepartmentID;\n```\n\nç»“æœï¼š\n\n|EmployeeID|Name|DepartmentName|\n|---|---|---|\n|1|å¼ ä¸‰|äººäº‹éƒ¨|\n|2|æå››|æŠ€æœ¯éƒ¨|\n|3|ç‹äº”|æŠ€æœ¯éƒ¨|\n\n- `èµµå…­`(å‘˜å·¥ID4) çš„éƒ¨é—¨IDæ˜¯103ï¼Œè€Œéƒ¨é—¨è¡¨é‡Œæ²¡æœ‰103å·éƒ¨é—¨ï¼Œæ‰€ä»¥è¢«â€‹**â€‹è¿‡æ»¤æ‰â€‹**â€‹äº†ã€‚\n- `è´¢åŠ¡éƒ¨`(éƒ¨é—¨ID 104) æ²¡æœ‰ä»»ä½•å‘˜å·¥ï¼Œä¹Ÿâ€‹**â€‹æ²¡å‡ºç°â€‹**â€‹ã€‚\n\n## å·¦è¿æ¥ (LEFT JOIN / LEFT OUTER JOIN)\n![](../../images/MySQL_SQL/image-20250729014650883.png)\n\n\n**é€šä¿—è§£é‡Šï¼šâ€œå·¦è¾¹è¡¨å…¨ä¿ï¼Œå³è¾¹è¡¨å°½é‡é…â€ã€‚â€‹**â€‹ å·¦è¡¨æ‰€æœ‰è®°å½•éƒ½æ˜¾ç¤ºï¼Œå³è¡¨æœ‰åŒ¹é…çš„ä¹Ÿæ˜¾ç¤ºå‡ºæ¥ï¼Œâ€‹**â€‹æ²¡åŒ¹é…çš„è¡¥ç©ºå€¼ï¼ˆNULLï¼‰â€‹**â€‹ã€‚\n\n**åœºæ™¯ï¼šâ€‹**â€‹ åˆ—å‡ºâ€‹**â€‹æ‰€æœ‰å‘˜å·¥â€‹**â€‹ï¼ˆä¸ç®¡æœ‰æ²¡æœ‰éƒ¨é—¨ï¼‰ï¼Œâ€‹**â€‹åŒæ—¶â€‹**â€‹å¦‚æœå‘˜å·¥æœ‰éƒ¨é—¨ï¼Œå°±æ˜¾ç¤ºéƒ¨é—¨åç§°ï¼ˆæ²¡æœ‰éƒ¨é—¨çš„å‘˜å·¥ï¼Œéƒ¨é—¨åç§°æ˜¾ç¤ºä¸ºç©ºï¼‰ã€‚\n\n```mysql\nSELECT Employees.EmployeeID, Employees.Name, Departments.DepartmentName\nFROM Employees\nLEFT JOIN Departments\nON Employees.DepartmentID = Departments.DepartmentID;\n```\n\nç»“æœï¼š\n\n| EmployeeID | Name | DepartmentName | DepartmentID |\n| ---------- | ---- | -------------- | ------------ |\n| 1          | å¼ ä¸‰   | äººäº‹éƒ¨            | 101          |\n| 2          | æå››   | æŠ€æœ¯éƒ¨            | 102          |\n| 3          | ç‹äº”   | æŠ€æœ¯éƒ¨            | 102          |\n| 4          | èµµå…­   | â€‹**â€‹NULLâ€‹**    | 103          |\n| 5          | é’±ä¸ƒ   | **NULL**       | **NULL**     |\n\n- å·¦è¾¹å‘˜å·¥è¡¨ (`Employees`) çš„ 5 æ¡è®°å½•â€‹**â€‹å…¨éƒ¨ä¿ç•™â€‹**â€‹ã€‚\n- `å¼ ä¸‰`ã€`æå››`ã€`ç‹äº”`Â åœ¨éƒ¨é—¨è¡¨é‡Œæ‰¾åˆ°äº†åŒ¹é… (`101`,Â `102`)ï¼Œæ‰€ä»¥æ˜¾ç¤ºéƒ¨é—¨åç§°ã€‚\n- `èµµå…­`(éƒ¨é—¨ID `103`) åœ¨éƒ¨é—¨è¡¨é‡Œæ²¡æ‰¾åˆ°å¯¹åº”çš„åå­—ï¼Œæ‰€ä»¥éƒ¨é—¨åç§°æ˜¾ç¤ºä¸º â€‹**â€‹`NULL`â€‹**â€‹ã€‚\n- `é’±ä¸ƒ`ï¼ˆå‘˜å·¥ID `5`ï¼‰çš„éƒ¨é—¨ ID æœ¬æ¥å°±æ˜¯ NULLï¼Œæ‰€ä»¥æ— æ³•æŸ¥è¯¢ï¼Œæ˜¾ç¤º NULLã€‚\n- éƒ¨é—¨è¡¨ä¸­å­¤ç«‹çš„Â `è´¢åŠ¡éƒ¨`(`104`) â€‹**â€‹æ²¡å‡ºç°â€‹**â€‹ã€‚\n### å¦‚ä½•ç­›é€‰å‡ºAè¡¨ä¸­å¤–é”®ä¸ºNULLçš„è®°å½•\n![](../../images/MySQL_SQL/image-20250729015124124.png)\nå¦‚æ­¤æŸ¥è¯¢ï¼Œä¾¿èƒ½ç­›é€‰å‡ºé’±ä¸ƒã€‚\nè¿™ä¸ªå›¾çš„æ„æ€æ˜¯ï¼šåœ¨å¤–é¢çš„çº¢è‰²éƒ¨åˆ†ï¼Œä¸Bæ²¡æœ‰äº¤é›†ï¼Œæ„æ€å°±æ˜¯è¯´ï¼Œå¤–é¢è¿™éƒ¨åˆ†æ²¡æœ‰è®°å½•æ¥è‡ªBçš„å¤–é”®ä¿¡æ¯ï¼Œä¸Bæ— å…³è”ã€‚\n\n## å³è¿æ¥ (RIGHT JOIN / RIGHT OUTER JOIN)\nï¼ˆå…¶å®ç›¸å½“äºå·¦è¿æ¥çš„é•œåƒï¼Œå·¦è¿æ¥æ—¶ï¼ŒAå’ŒBè¡¨äº¤æ¢ä¹¦å†™ä½ç½®å°±æ˜¯ä»–ä»¬çš„å³è¿æ¥ï¼‰\n\n**é€šä¿—è§£é‡Šï¼šâ€œå³è¾¹è¡¨å…¨ä¿ï¼Œå·¦è¾¹è¡¨å°½é‡é…â€ã€‚â€‹**â€‹ å³è¡¨æ‰€æœ‰è®°å½•éƒ½æ˜¾ç¤ºï¼Œå·¦è¡¨æœ‰åŒ¹é…çš„ä¹Ÿæ˜¾ç¤ºå‡ºæ¥ï¼Œâ€‹**â€‹æ²¡åŒ¹é…çš„è¡¥ç©ºå€¼ï¼ˆNULLï¼‰â€‹**â€‹ã€‚â€‹**â€‹ï¼ˆå’Œå·¦è¿æ¥æ–¹å‘ç›¸åï¼‰â€‹**\nâ€‹\n**â€‹åœºæ™¯ï¼šâ€‹**â€‹ åˆ—å‡ºâ€‹**â€‹æ‰€æœ‰éƒ¨é—¨â€‹**â€‹ï¼ˆä¸ç®¡æœ‰æ²¡æœ‰å‘˜å·¥ï¼‰ï¼Œâ€‹**â€‹åŒæ—¶â€‹**â€‹å¦‚æœéƒ¨é—¨ä¸‹æœ‰å‘˜å·¥ï¼Œå°±åˆ—å‡ºå‘˜å·¥å§“åï¼›æ²¡äººçš„éƒ¨é—¨ï¼Œå‘˜å·¥ä¿¡æ¯æ˜¾ç¤ºä¸ºç©ºã€‚\n\n```mysql\nSELECT Employees.EmployeeID, Employees.Name, Departments.DepartmentName\nFROM Employees\nRIGHT JOIN Departments\nON Employees.DepartmentID = Departments.DepartmentID;\n```\n\nç»“æœï¼š\n\n| EmployeeID   | Name         | DepartmentName |\n| ------------ | ------------ | -------------- |\n| 1            | å¼ ä¸‰           | äººäº‹éƒ¨ï¼ˆ101ï¼‰       |\n| 2            | æå››           | æŠ€æœ¯éƒ¨ï¼ˆ102ï¼‰       |\n| 3            | ç‹äº”           | æŠ€æœ¯éƒ¨ï¼ˆ102ï¼‰       |\n| â€‹**â€‹NULLâ€‹**â€‹ | â€‹**â€‹NULLâ€‹**â€‹ | è´¢åŠ¡éƒ¨ï¼ˆ104ï¼‰       |\n- å³è¾¹éƒ¨é—¨è¡¨ (`Departments`) çš„ 3 æ¡è®°å½•(`101`,`102`,`104`)â€‹**â€‹å…¨éƒ¨ä¿ç•™â€‹**â€‹ã€‚\n- `äººäº‹éƒ¨`(`101`)ã€`æŠ€æœ¯éƒ¨`(`102`) æ‰¾åˆ°äº†å‘˜å·¥ (`å¼ ä¸‰`Â /Â `æå››`,Â `ç‹äº”`)ï¼Œæ˜¾ç¤ºå§“åã€‚\n- `è´¢åŠ¡éƒ¨`(`104`) åœ¨å‘˜å·¥è¡¨é‡Œæ²¡ä»»ä½•å‘˜å·¥ï¼Œæ‰€ä»¥å‘˜å·¥IDå’Œå§“åéƒ½æ˜¯ â€‹**â€‹`NULL`â€‹**â€‹ã€‚\n- å‘˜å·¥Â `èµµå…­`Â (éƒ¨é—¨ID `103`)ã€`é’±ä¸ƒ`ï¼ˆå‘˜å·¥ID `5`ï¼Œéƒ¨é—¨ID `NULL`ï¼‰ â€‹**â€‹æ²¡å‡ºç°â€‹**â€‹ï¼ˆå› ä¸ºå®ƒçš„éƒ¨é—¨103åœ¨éƒ¨é—¨è¡¨é‡Œä¸å­˜åœ¨ï¼Œä¸å±äºå³è¡¨ä¿ç•™èŒƒå›´ï¼‰ã€‚\n\n## å…¨è¿æ¥ (FULL JOIN / FULL OUTER JOIN)\n![](../../images/MySQL_SQL/image-20250729015251762.png)\n\n\n**é€šä¿—è§£é‡Šï¼šâ€œä¸¤ä¸ªè¡¨æˆ‘éƒ½å…¨è¦ï¼ç®¡ä½ é…ä¸é…å¾—ä¸Šï¼â€â€‹**â€‹ ä¸¤ä¸ªè¡¨çš„æ‰€æœ‰è®°å½•éƒ½ä¿ç•™ã€‚èƒ½é…ä¸Šå¯¹çš„å°±åˆå¹¶æˆä¸€è¡Œæ˜¾ç¤ºã€‚é…ä¸ä¸Šå¯¹çš„ï¼Œå„è‡ªé‚£è¾¹çš„ç©ºç¼ºå°±ç”¨ â€‹**â€‹`NULL`â€‹**â€‹ å¡«å……ã€‚\n\n**â€‹åœºæ™¯ï¼šâ€‹**â€‹ æƒ³åšä¸€ä¸ªâ€‹**â€‹å®Œæ•´çš„ç»„ç»‡ç»“æ„/èŠ±åå†Œå¿«ç…§â€‹**â€‹ï¼Œæ—¢è¦çœ‹åˆ°æ‰€æœ‰å‘˜å·¥ï¼ˆåŒ…æ‹¬æ²¡éƒ¨é—¨çš„ï¼‰ï¼Œä¹Ÿè¦çœ‹åˆ°æ‰€æœ‰éƒ¨é—¨ï¼ˆåŒ…æ‹¬æ²¡å‘˜å·¥çš„ï¼‰ã€‚ä¿¡æ¯é½å…¨ï¼\n\n```mysql\nSELECT Employees.EmployeeID, Employees.Name, Departments.DepartmentName\nFROM Employees\nFULL JOIN Departments\nON Employees.DepartmentID = Departments.DepartmentID;\n```\nç»“æœï¼š\n\n| EmployeeID   | Name         | DepartmentName | DepartmentID |\n| ------------ | ------------ | -------------- | ------------ |\n| 1            | å¼ ä¸‰           | äººäº‹éƒ¨            | 101          |\n| 2            | æå››           | æŠ€æœ¯éƒ¨            | 102          |\n| 3            | ç‹äº”           | æŠ€æœ¯éƒ¨            | 102          |\n| 4            | èµµå…­           | â€‹**â€‹NULLâ€‹**â€‹   | 103          |\n| 5            | é’±ä¸ƒ           | **NULL**       | NULL         |\n| â€‹**â€‹NULLâ€‹**â€‹ | â€‹**â€‹NULLâ€‹**â€‹ | è´¢åŠ¡éƒ¨            | 104          |\n- â€‹**â€‹å…¨éƒ¨ 6 ç§æƒ…å†µéƒ½å±•ç¤ºå‡ºæ¥äº†ï¼šâ€‹**â€‹\n    1. æœ‰å‘˜å·¥æœ‰éƒ¨é—¨ (`å¼ ä¸‰-äººäº‹éƒ¨`,Â `æå››-æŠ€æœ¯éƒ¨`,Â `ç‹äº”-æŠ€æœ¯éƒ¨`)ã€‚\n    2. æœ‰å‘˜å·¥â€‹**â€‹æ²¡â€‹**â€‹(åŒ¹é…çš„)éƒ¨é—¨ (`èµµå…­`ã€`é’±ä¸ƒ`)ã€‚\n    3. æœ‰éƒ¨é—¨â€‹**â€‹æ²¡â€‹**â€‹(åŒ¹é…çš„)å‘˜å·¥ (`è´¢åŠ¡éƒ¨`)ã€‚\n### å¦‚ä½•ç­›é€‰å‡ºAè¡¨æˆ–Bè¡¨çš„å¤–é”®ä¸ºNULLçš„è®°å½•\n![](../../images/MySQL_SQL/image-20250729015440879.png)\n\nå¦‚æ­¤æŸ¥è¯¢ï¼Œä¾¿èƒ½ç­›é€‰å‡ºé’±ä¸ƒã€‚\n\nç”±äºæœ¬ä¾‹ä¸­Bè¡¨æ²¡æœ‰å¤–é”®ï¼Œå› æ­¤æ— æ³•ä½“ç°Bè¡¨ä¸­æ²¡æœ‰å¤–é”®çš„è®°å½•ã€‚\n\n\n## è¿æ¥æŸ¥è¯¢ï¼ˆJoinï¼‰å’Œè”åˆæŸ¥è¯¢ï¼ˆUnionï¼‰çš„åŒºåˆ«\nâ€‹**â€‹è”åˆæŸ¥è¯¢ï¼ˆUnion Queryï¼‰ï¼šâ€‹**â€‹ è¿™ä¸ªæ¦‚å¿µå®¹æ˜“å’Œè¿æ¥æ··æ·†ã€‚\n- â€‹**â€‹é€šä¿—è§£é‡Šï¼šâ€‹**â€‹ æŠŠä¸¤å¼ ç»“æ„_ç›¸ä¼¼_çš„è¡¨ â€‹**â€‹ä¸Šä¸‹æ‹¼èµ·æ¥â€‹**â€‹ã€‚å°±åƒæŠŠã€Šç•ªèŒ„ä¾›åº”å•†åå•ã€‹å’Œã€Šé¸¡è›‹ä¾›åº”å•†åå•ã€‹æ‘åœ¨ä¸€èµ·ï¼Œå˜æˆã€Šé£Ÿæä¾›åº”å•†æ€»åå•ã€‹ã€‚æ³¨æ„ï¼šæ˜¯å‚ç›´å åŠ ï¼\n- â€‹**â€‹æ ¸å¿ƒè¦æ±‚ï¼šâ€‹**â€‹\n    - ä¸¤å¼ è¡¨æŸ¥è¯¢ç»“æœçš„â€‹**â€‹åˆ—æ•°å¿…é¡»ä¸€æ ·â€‹**â€‹ã€‚\n    - å¯¹åº”åˆ—çš„æ•°æ®ç±»å‹è¦â€‹**â€‹å…¼å®¹â€‹**â€‹ï¼ˆæ¯”å¦‚æ•°å­—å¯¹æ•°å­—ï¼Œå­—ç¬¦ä¸²å¯¹å­—ç¬¦ä¸²ï¼‰ã€‚\n\n```mysql\nSELECT EmployeeID, Name FROM Employees -- æŸ¥å‘˜å·¥IDå’Œåå­—\nUNION -- æˆ–è€… UNION ALL (åŒ…å«é‡å¤è¡Œ)\nSELECT DepartmentID, DepartmentName FROM Departments; -- æŸ¥éƒ¨é—¨IDå’Œåå­—\n```\n\n| EmployeeID/DepartmentID | Name/DepartmentName |\n| ----------------------- | ------------------- |\n| 1                       | å¼ ä¸‰                  |\n| 2                       | æå››                  |\n| 3                       | ç‹äº”                  |\n| 4                       | èµµå…­                  |\n| 5                       | é’±ä¸ƒ                  |\n| 101                     | äººäº‹éƒ¨                 |\n| 102                     | æŠ€æœ¯éƒ¨                 |\n| 104                     | è´¢åŠ¡éƒ¨                 |\næ³¨æ„ï¼šè¿™ä¸ªä¾‹å­ä¸å¸¸ç”¨ï¼Œåªæ˜¯ä¸ºäº†å±•ç¤ºUNIONæ•ˆæœã€‚UNIONæ›´å¸¸ç”¨äºåˆå¹¶åŒç±»å‹æ•°æ®ï¼Œæ¯”å¦‚ä¸åŒå¹´ä»½çš„é”€å”®è®°å½•è¡¨\n\n## `SELECT ... FROM A, B WHERE ...`å’Œ`SELECT ... FROM A JOIN B ON ...`çš„åŒºåˆ«\nè¿™ä¸¤è€…â€‹**â€‹åŠŸèƒ½ä¸Šå¯¹äºå†…è¿æ¥(INNER JOIN)æ˜¯ç­‰æ•ˆçš„â€‹**â€‹ï¼Œä½†å­˜åœ¨å…³é”®åŒºåˆ«ï¼šâ€‹**â€‹è¯­æ³•æ ‡å‡†ã€å¯è¯»æ€§ã€ç»´æŠ¤æ€§ä»¥åŠé”™è¯¯é¢„é˜²èƒ½åŠ›â€‹**â€‹ã€‚\n\n| ç‰¹æ€§                | `SELECT ... FROM A, B WHERE ...`Â (éšå¼è¿æ¥)      | `SELECT ... FROM A JOIN B ON ...`Â (æ˜¾å¼è¿æ¥)      |\n| ----------------- | -------------------------------------------- | --------------------------------------------- |\n| â€‹**â€‹è¯­æ³•æœ¬è´¨â€‹**â€‹      | è€å¼SQLæ ‡å‡†ï¼ŒFROMå­å¥ç”¨é€—å·åˆ†éš”è¡¨ï¼ŒWHEREå®šä¹‰æ¡ä»¶å’Œè¿æ¥            | æ–°å¼SQL-92æ ‡å‡†ï¼Œç”¨JOINå…³é”®å­—æ˜ç¡®æŒ‡å®šè¿æ¥ç±»å‹å’Œæ¡ä»¶                |\n| â€‹**â€‹è¿æ¥ç±»å‹â€‹**â€‹      | é»˜è®¤æ˜¯â€‹**â€‹äº¤å‰è¿æ¥(CROSS JOIN)â€‹**â€‹ï¼Œéœ€è¦WHEREè¿‡æ»¤æ‰èƒ½å˜æˆå†…è¿æ¥ | â€‹**â€‹æ˜ç¡®æŒ‡å‡ºè¿æ¥ç±»å‹â€‹**â€‹ (INNER/LEFT/RIGHT/FULL JOIN) |\n| â€‹**â€‹è¿æ¥æ¡ä»¶ä½ç½®â€‹**â€‹    | å’Œè¿‡æ»¤æ¡ä»¶â€‹**â€‹æ··åœ¨WHEREå­å¥ä¸­â€‹**â€‹                      | è¿æ¥æ¡ä»¶åœ¨â€‹**â€‹ç‹¬ç«‹çš„ONå­å¥â€‹**â€‹ï¼Œè¿‡æ»¤æ¡ä»¶åœ¨WHEREï¼ˆé€»è¾‘åˆ†ç¦»ï¼‰         |\n| â€‹**â€‹å¯è¯»æ€§ & ç»´æŠ¤æ€§â€‹**â€‹ | å·®ï¼ˆå¤æ‚æŸ¥è¯¢æ—¶æ¡ä»¶æ··ä¹±ï¼‰                                 | ä¼˜ï¼ˆæ¸…æ™°åŒºåˆ†è¿æ¥æ¡ä»¶å’Œè¿‡æ»¤é€»è¾‘ï¼‰                              |\n| â€‹**â€‹é˜²æ­¢ç¬›å¡å°”ç§¯é”™è¯¯â€‹**â€‹  | å¼±ï¼ˆå¿˜è®°WHEREä¼šå¯¼è‡´å…¨ç»„åˆï¼‰                             | å¼ºï¼ˆJOINå¿…é¡»é…ONæˆ–USINGï¼Œå¦åˆ™è¯­æ³•é”™è¯¯ï¼‰                     |\n| â€‹**â€‹æ”¯æŒå¤–è¿æ¥â€‹**â€‹     | éƒ¨åˆ†æ•°æ®åº“ä¸æ”¯æŒï¼ˆå¦‚Oracleè€è¯­æ³•ç”¨`(+)`ï¼‰                   | â€‹**â€‹æ‰€æœ‰æ•°æ®åº“éƒ½æ”¯æŒâ€‹**â€‹æ ‡å‡†å¤–è¿æ¥å†™æ³•(LEFT/RIGHT/FULL JOIN) |\n| â€‹**â€‹ç°ä»£æ¨èåº¦â€‹**â€‹     | âš ï¸ ä¸æ¨èï¼ˆå°¤å…¶å¤æ‚æŸ¥è¯¢ï¼‰                               | âœ… â€‹**â€‹å¼ºçƒˆæ¨èâ€‹**                                 |\n# ç»ƒä¹ \n![](../../images/MySQL_SQL/image-20250728231556591.png)\n\næŸ¥è¯¢å¹³å‡æˆç»©å¤§äº60åˆ†çš„åŒå­¦çš„å­¦å·å’Œå¹³å‡æˆç»©ã€‚\n```mysql\nselect s_id, avg(sc_score)\nfrom score\ngroup by s_id\nhaving avg(sc_score)>60\n```\n![](../../images/MySQL_SQL/image-20250729034259743.png)\n\n\n\næŸ¥è¯¢æ‰€æœ‰åŒå­¦çš„å­¦å·ã€å§“åã€é€‰è¯¾æ€»æ•°ã€æ€»æˆç»©ã€‚\n```mysql\nselect s_id, s_name, count(c_id), sum(sc_score) from student left join score on student.s_id = score.s_id;\n```\nä¹Ÿå¯ä»¥è¿™ä¹ˆå†™ï¼ŒåµŒå¥—selectï¼š\n```mysql\nselect student.s_id, student.s_name, count_id as XKS, sum_id as ZCJ\nfrom student\nleft join\n(select s_id, count(c_id), as count_id, sum(sc_score) as sum_id from score group by s_id) as ss\non student.s_id = ss.s_id;\n```\n![](../../images/MySQL_SQL/image-20250729034241165.png)\n\næŸ¥è¯¢æ²¡æœ‰é€‰å…¨éƒ¨è¯¾çš„åŒå­¦çš„å­¦å·ã€å§“åã€‚\n```mysql\nselect student.s_id, student.s_name from student, score\nwhere student.s_id = score.s_id\ngroup by student.s_id\nhaving count(score.c_id) < (select count(c_id) from course);\n```\n\nå…ˆè®©scoreè¡¨è¡¥å……ä¸€åˆ—å­¦ç”Ÿçš„å§“åã€‚\nå†è®©æ­¤ä¸´æ—¶è¡¨ï¼ŒæŒ‰å­¦å·ï¼ˆç¡®å®š1äººï¼‰åˆ†ç»„ï¼Œæ¯ä¸€ç»„çš„`s_id`æ•°å°±æ˜¯è¿™ä¸ªäººé€‰çš„è¯¾ç¨‹æ•°ã€‚\n\nç»“æœ\n![](../../images/MySQL_SQL/image-20250729040128046.png)\n\nåˆ é™¤`Kim`è€å¸ˆè¯¾çš„Scoreè¡¨è®°å½•\nä¸ºäº†çœ‹åˆ°æ•ˆæœï¼Œä¸´æ—¶å¢åŠ ä¸€æ¡æˆç»©ã€‚\n![](../../images/MySQL_SQL/image-20250729040422771.png)\n\n```mysql\ndelete from score\nwhere c_id in\n(select course.c_id from course inner join teacher on course.t_id = teacher.t_id where teacher.t_name = 'Kim');\n```\nåé¢çš„selectï¼Œå…ˆè®©courseè¡¨è¡¥å……ä¸€åˆ—è€å¸ˆçš„åå­—ï¼Œä¹‹åç­›é€‰å‡ºè€å¸ˆåå­—æ˜¯Kimçš„courseï¼›\ninç”¨äºæ‰¹é‡å¤„ç†ã€‚\n\nç»“æœï¼š\n![](../../images/MySQL_SQL/image-20250729040946803.png)\n\n","categories":["æ•°æ®åº“","MySQL"]},{"title":"MySQL_æŸ¥è¯¢ä¸“é¢˜","url":"/æ•°æ®åº“/MySQL_æŸ¥è¯¢ä¸“é¢˜/","content":"\n# å†…å®¹\n\n1. ç®€å•çš„æŸ¥è¯¢è¯­å¥\n2. åˆ†é¡µæŸ¥è¯¢ - limit\n3. æ’åºã€åˆ†ç»„\n4. è¿æ¥æŸ¥è¯¢ï¼ˆå¤šè¡¨æŸ¥è¯¢ï¼‰\n\n# å­˜å‚¨è¿‡ç¨‹\n\nä¸ºäº†æ¨¡æ‹Ÿå®é™…ä¸­çš„å¤§æ•°æ®åœºæ™¯ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª`t_user`æ•°æ®åº“ï¼Œ`t_user`è¡¨ï¼Œå‘å…¶ä¸­æ·»åŠ 200ä¸‡æ¡è®°å½•ã€‚\n\nè¡¨çš„åˆ›å»ºï¼š\n\n```mysql\ncreate table t_user(\n    id int(11) NOT NULL AUTO_INCREMENT,\n    email varchar(255) DEFAULT NULL,\n    password varchar(255) DEFAULT NULL,\n    PRIMARY KEY(id)\n)engine=InnoDB AUTO_INCREMENT=1000001 DEFAULT CHARSET=utf8;\n```\n\n\n\néœ€è¦ç”¨åˆ°å­˜å‚¨è¿‡ç¨‹ã€‚\n\n1. é¦–å…ˆæ”¹å˜åˆ†éš”ç¬¦`delimiter $`\n2. åˆ›å»ºå­˜å‚¨è¿‡ç¨‹\n\n```mysql\nCreate Procedure add_t_user(IN n INT)\nBEGIN\nDECLARE i INT;\nSET i=0;\n\nWHILE i<n DO\nINSERT INTO t_user VALUES(NULL, CONCAT(i+1,'@xcg.com'),i+1);\nSET i=i+1;\nEND WHILE;\nEND$\n```\n\nåˆ›å»ºå¥½åï¼Œå¯ä»¥`show create procedure add_t_user\\G`æŸ¥çœ‹æ­¤å­˜å‚¨è¿‡ç¨‹ã€‚\n\n![image-20220517201206028](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220517201206028.png)\n\n3. æ”¹å›åˆ†éš”ç¬¦`delimiter ;`\n4. è°ƒç”¨å­˜å‚¨è¿‡ç¨‹`call add_t_user(2000000);`ï¼Œæ‹¬å·å†…çš„å‚æ•°ä¸ºè¦æ·»åŠ çš„è®°å½•æ•°ã€‚\n\næ’å…¥æ•°æ®æˆåŠŸåï¼Œå¯ä»¥å¯¹å…¶æµ‹è¯•\n\n```mysql\nSELECT COUNT(*) FROM t_user;\t#åº”ä¸º2000000\n```\n\n```mysql\nSELECT * FROM t_user LIMIT 10;\n```\n\n```mysql\nSELECT * FROM t_user WHERE email='1@xcg.com';\nEXPLAIN SELECT * FROM t_user WHERE email='1@xcg.com';\n```\n\n# ç®€å•çš„æŸ¥è¯¢è¯­å¥\n\nåœ¨è¿™é‡Œæˆ‘ä»¬ç¤ºä¾‹ä¸€äº›ç®€å•çš„æŸ¥è¯¢è¯­å¥ã€‚\n\n* æ— æ¡ä»¶æŸ¥è¯¢å…¨éƒ¨å­—æ®µ\n\n```mysql\nSELECT * FROM user;\t#ä¸æ¨èï¼Œæœ€å¥½è¿˜æ˜¯è€è€å®å®åœ°å†™å‡ºæ‰€æœ‰å­—æ®µåç§°ï¼Œå› ä¸ºè¡¨çš„ç»“æ„ä¹‹åå¯èƒ½ä¼šå˜æ›´ï¼Œå¯èƒ½ä¼šå½±å“ä¸šåŠ¡ä»£ç ã€‚\n```\n\n* æ¡ä»¶æŸ¥è¯¢æŒ‡å®šå­—æ®µ\n\n```mysql\nSELECT name,age,sex FROM user WHERE age>=21;\nSELECT name,age,sex FROM user WHERE age>20 AND age<22;\nSELECT name,age,sex FROM user WHERE BETWEEN 20 AND 22;#é—­åŒºé—´\n```\n\n```mysql\n# ä»¥ä¸‹ä¸¤ä¸ªsqlè¯­å¥æ•ˆæœä¸€è‡´ã€‚\nSELECT name,age,sex FROM user WHERE age=20 OR age=21;\nSELECT name,age,sex FROM user WHERE age IN (20,21);\n```\n\n* ä½¿ç”¨é€šé…ç¬¦æŸ¥è¯¢\n\n```mysql\nSELECT name,age,sex FROM user WHERE name LIKE \"zhang%\";#å¿…é¡»ç”¨LIKEï¼Œä¸èƒ½ç”¨=ç­‰å·ï¼Œå¦åˆ™ä¼šæŠŠ%é€šé…ç¬¦çœ‹ä½œå®é™…å­—ç¬¦ã€‚\n```\n\n* åˆ¤æ–­ä¸ºç©ºä¸ç”¨`=`ï¼Œè€Œç”¨`IS NULL`\n\n```mysql\nSELECT name,age,sex FROM user WHERE name IS NULL;\nSELECT name,age,sex FROM user WHERE name IS NOT NULL;\n```\n\n## å»é‡\n\næœ‰ä¸¤ç§å»é‡çš„æ–¹å¼\n\n1. `distinct` - ç®€å•åœ°å»é‡\n2. `group by` - åŠŸèƒ½å¼ºå¤§ï¼Œè€—æ—¶\n\n```mysql\nSELECT DISTINCT age FROM user;\n```\n\n![image-20220517114906800](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220517114906800.png)\n\n## åˆå¹¶æŸ¥è¯¢ - union\n\næ ¼å¼å¦‚ä¸‹\n\n```\nSELECT expression1, expression2, ..., expression\nFROM table1 [WHERE conditions]\nUNION [ALL | DISTINCT(default)]\nSELECT expression1, expression2, ..., expression\nFROM table2 [WHERE conditions];\n# unioné»˜è®¤ä¸ºdistinctå»é‡ï¼Œallè¡¨ç¤ºæ˜¾ç¤ºé‡å¤çš„è®°å½•é¡¹\n```\n\n```mysql\nSELECT name,age,sex\nFROM user WHERE age>=21\nUNION ALL\nSELECT name,age,sex\nFROM user WHERE sex='M';\n```\n\n![image-20220517163204447](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220517163204447.png)\n\n# åˆ†é¡µæŸ¥è¯¢ - limit\n\néœ€è¦æŒæ¡çš„å†…å®¹ï¼š\n\n1. limitåˆ†é¡µæŸ¥è¯¢çš„è¯­æ³•\n2. `explain`å¯ä»¥æŸ¥çœ‹SQLè¯­å¥å¤§è‡´çš„æ‰§è¡Œè®¡åˆ’\n3. limitåœ¨ä½•ç§æƒ…å†µä¸‹èƒ½å¤Ÿæå‡æŸ¥è¯¢æ•ˆç‡ï¼Œä½¿ç”¨limitéœ€è¦æ³¨æ„å“ªäº›\n4. é¡¹ç›®ä¸­ç”¨åˆ°åˆ†é¡µå¤„ç†æ—¶ï¼Œå¦‚ä½•ç¼–å†™ç›¸åº”çš„SQLè¯­å¥\n\n## è¯­æ³•\n\n### limit M,N - limit N\n\n```mysql\nSELECT * FROM user LIMIT N;\t\t#è¡¨ç¤ºå–userè¡¨ç¬¬0~Næ¡è®°å½•çš„æ‰€æœ‰å­—æ®µï¼Œç›¸å½“äºå–å‰Næ¡\nSELECT * FROM user LIMIT M,N;\t#è¡¨ç¤ºå–userè¡¨ç¬¬M~(M+N)æ¡è®°å½•çš„æ‰€æœ‰å­—æ®µï¼Œç›¸å½“äºå…ˆåç§»Mæ¡ï¼Œå†å–Næ¡ã€‚\nSELECT * FROM user LIMIT N OFFSET M;\t#åŒLIMIT M,N\n```\n\nlimitåªæ˜¯æ”¹å˜äº†æ•°æ®æ˜¾ç¤ºçš„æ•ˆæœå—ï¼Ÿå¯¹æŸ¥è¯¢çš„æ•ˆç‡æœ‰æ²¡æœ‰æå‡å‘¢ï¼Ÿå…ˆå¼•å…¥ä¸€ä¸ªå…³é”®å­—`explain`ã€‚\n\n>explainæ˜¯ä¸€ä¸ªå…³é”®å­—ï¼Œæ˜¯å®šä½SQLã€ç´¢å¼•æ€§èƒ½çš„æœ‰åˆ©å·¥å…·ã€‚\n>\n>ä½¿ç”¨å®ƒåŠ è½½SQLè¯­å¥å¼€å¤´ï¼Œå¯ä»¥æŸ¥çœ‹SQLè¯­å¥çš„æ‰§è¡Œè®¡åˆ’ã€‚\n>\n>explainå±•ç¤ºçš„å­—æ®µï¼š\n>\n>1. id: ç¼–å·\n>2. `select_type`: å¦‚`SIMPLE`ï¼Œè¡¨ç¤ºæŸ¥è¯¢è¯­å¥çš„å¤æ‚ç¨‹åº¦ç±»å‹\n>3. table: å¦‚`user`ï¼Œå½“å‰è¡¨\n>4. partitions: NULL\n>5. type: const\n>6. `possible_keys`: nameï¼Œå¯èƒ½ç”¨åˆ°çš„ç´¢å¼•\n>7. key: nameï¼Œå®é™…ç”¨åˆ°çš„ç´¢å¼•\n>8. `key_len`: 152\n>9. ref: const\n>10. rows: 1ï¼ŒæŸ¥è¯¢è¯­å¥å¯èƒ½éœ€è¦æ‰«æçš„è¡Œæ•°ã€‚\n>11. filtered: 100.00\n>12. Extra: NULL\n\n```mysql\nEXPLAIN SELECT * FROM user WHERE name='zhangsan';\n```\n\n![image-20220517192840144](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220517192840144.png)\n\næˆ‘ä»¬å‘ç°ï¼Œæœç´¢\"zhangsan\"åªæ‰«äº†1è¡Œã€‚å¯èƒ½ä½ ä¼šçŒœæµ‹æ˜¯å› ä¸ºä»–åœ¨è¡¨çš„ç¬¬ä¸€è¡Œï¼Œé‚£ä¹ˆè¯•è¯•æŸ¥æ‰¾å…¶ä»–äººæ‰«æå‡ è¡Œå‘¢ï¼Ÿ\n\n```mysql\nEXPLAIN SELECT * FROM user WHERE name='chenwei';\nEXPLAIN SELECT * FROM user WHERE name='zhanglan';\n```\n\n![image-20220517193136218](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220517193136218.png)\n\nå‘ç°ä»æ˜¯`row=1`ã€‚\n\nè¿™æ˜¯å› ä¸ºnameæœ‰ç´¢å¼•ã€‚\n\næˆ‘ä»¬å†è¯•è¯•ä¸ageæœ‰å…³çš„æŸ¥è¯¢è¯­å¥ã€‚\n\n```mysql\nEXPLAIN SELECT * FROM user WHERE age=20;\n```\n\n![image-20220517193519105](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220517193519105.png)\n\næˆ‘ä»¬å‘ç°ç°åœ¨çš„rowä¸º5ã€‚ç›¸å½“äºæŠŠuserè¡¨è¿›è¡Œäº†å…¨è¡¨æœç´¢ã€‚\n\nç›¸æ¯”äºä¸nameæœ‰å…³çš„æŸ¥è¯¢è¯­å¥ï¼Œç”±äºageæ²¡æœ‰ç´¢å¼•ï¼ŒæŸ¥è¯¢çš„æ•ˆç‡å°±å¾ˆä½ã€‚\n\næ€ä¹ˆå°½å¯èƒ½æé«˜æ•ˆç‡å‘¢ï¼Ÿ\n\nå¦‚æœæˆ‘ä»¬åªæƒ³å¾—åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨limitã€‚\n\n```mysql\nSELECT * FROM user WHERE age=20 LIMIT 1;\n```\n\nç†è®ºä¸Šï¼ŒEXPLAINæ­¤è¯­å¥çš„rowsåº”è¾ƒå°ï¼Œä½†å®é™…ä¸Šrowsè¿˜æ˜¯5ã€‚\n\n```mysql\nEXPLAIN SELECT * FROM user WHERE age=20 LIMIT 1;\n```\n\n![image-20220517194317756](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220517194317756.png)\n\nè¯´æ˜EXPLAINä¸èƒ½çœ‹åˆ°limitçš„ä½œç”¨ã€‚\n\n---\n\næˆ‘ä»¬ç°åœ¨å¯¹æ‹¥æœ‰200wæ¡è®°å½•çš„`t_user`è¡¨è¿›è¡Œæµ‹è¯•ã€‚\n\n```mysql\nSELECT * FROM t_user WHERE email='1@xcg.com';\t\t#çº¦0.44s\nEXPLAIN SELECT * FROM t_user WHERE email='1@xcg.com';\nSELECT * FROM t_user WHERE email='1@xcg.com' LIMIT 1;#çº¦0.00s\n```\n\n```mysql\nSELECT * FROM t_user LIMIT 1000000, 1;#çº¦0.20sï¼Œè¯´æ˜åç§»ä¹Ÿå¾ˆè´¹æ—¶\nSELECT * FROM t_user WHERE email='1000001@xcg.com';\t#çº¦0.44s\nSELECT * FROM t_user WHERE email='1000001@xcg.com' LIMIT 1;\t#çº¦0.23s\n```\n\n## åˆ†é¡µéœ€è¦æ³¨æ„çš„äº‹æƒ…\n\né¦–å…ˆéœ€è¦æ˜ç™½åˆ†é¡µçš„å‚æ•°`pagenum=20`ï¼Œè¡¨ç¤ºæ¯é¡µæ˜¾ç¤ºçš„è®°å½•æ•°ä¸º20ï¼›`pageno`è¡¨ç¤ºå½“å‰çš„é¡µç ã€‚\n\né‚£ä¹ˆï¼Œæ ¹æ®LIMITçš„`M,N`è§„åˆ™ï¼Œè®¡ç®—å‡ºä¸‹é¢çš„è¯­å¥å…¬å¼ï¼š\n\n```mysql\nSELECT * FROM user LIMIT (pageno-1)*pagenum, pagenum;\n```\n\nè¿™æ ·å°±å®ç°äº†æ¯ä¸€é¡µæ˜¾ç¤ºå¯¹åº”ä½ç½®çš„20æ¡è®°å½•ã€‚\n\nä½†æ˜¯ï¼Œæœ‰ä¸ªå¾ˆç°å®çš„æ€§èƒ½é—®é¢˜ï¼Œæˆ‘ä»¬æ€»ä¸èƒ½è®©è¶Šå¾€åçš„é¡µæ•°æŸ¥å‡ºæ¥çš„æ—¶é—´è¶Šä¹…å§ï¼Ÿå› ä¸ºLIMIT M,Né»˜è®¤æ˜¯å…¨è¡¨é¡ºåºæŸ¥è¯¢ï¼ŒæŸ¥åé¢çš„æ•°æ®æ—¶ï¼Œä¼šåœ¨å‰é¢æŸ¥å¾ˆå¤šå†—ä½™çš„ä¿¡æ¯ï¼Œæµªè´¹äº†æ—¶é—´ã€‚\n\n```mysql\nSELECT * FROM t_user LIMIT 0, 20;\t#0.00s\nSELECT * FROM t_user LIMIT 1000000, 20;\t#0.23s\n```\n\nå¯ä»¥ç”¨ä¸€ä¸ªæ€æƒ³æ¥ä¼˜åŒ–æ€§èƒ½â€”â€”è¿‡æ»¤ã€‚\n\næˆ‘ä»¬çŸ¥é“ï¼Œå…¶ä¸»é”®idæ˜¯æœ‰è§„å¾‹çš„ï¼Œå¯æ ¹æ®å¯¹idçš„é™åˆ¶æ¥è¿›è¡Œè¿‡æ»¤ã€‚\n\n```mysql\nSELECT * FROM t_user WHERE id>2000000 LIMIT 0, 20;#0.00s\n```\n\nä¸Šé¢çš„è¯­å¥å’Œ`SELECT * FROM t_user LIMIT 1000000, 20;`æŸ¥è¯¢å‡ºæ¥çš„ç»“æœä¸€æ ·ã€‚ä½†æ˜¯æ€§èƒ½å´å¤§å¤§æå‡ã€‚\n\nå³\n\n```mysql\nSELECT * FROM user WHERE id>ä¸Šä¸€é¡µæœ€åä¸€æ¡æ•°æ®çš„idå€¼ LIMIT 0, 20;\n```\n\nä½†æ˜¯ï¼Œä¸æ˜¯æ¯ä¸ªåˆ†é¡µéƒ½é€šè¿‡idæ¥è§£å†³ï¼Œå…·ä½“é—®é¢˜å…·ä½“åˆ†æï¼Œé€‰æ‹©åˆé€‚çš„ç´¢å¼•å»è¿‡æ»¤ï¼Œä¸ä¸€å®šéè¦é€‰idã€‚\n\nLIMITå¯ä»¥å¾ˆå¥½åœ°å¸®åŠ©æˆ‘ä»¬åœ¨æ²¡æœ‰ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œä»¥ç›¸åº”çš„åˆ—ä½œä¸ºè¿‡æ»¤æ¡ä»¶æ—¶ï¼Œæé«˜æ•ˆç‡ã€‚\n\n# è¿æ¥æŸ¥è¯¢\n\nåˆ†ä¸ºä¸¤ç§\n\n1. å†…è¿æ¥æŸ¥è¯¢\n2. å¤–è¿æ¥æŸ¥è¯¢\n    1. leftè¿æ¥æŸ¥è¯¢\n    2. rightè¿æ¥æŸ¥è¯¢\n\n![image-20220518111035278](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220518111035278.png)\n\n## å†…è¿æ¥\n\nåœºæ™¯åˆ†æï¼šå­¦ç”Ÿã€è¯¾ç¨‹ã€è€ƒè¯•ç»“æœ\n\nstudent: `uidã€nameã€ageã€sex`\n\ncourse: `cidã€cnameã€credit`\n\nexam: `uidã€cidã€timeã€score`\n\n```mysql\nCREATE TABLE student(\n    uid INT UNSIGNED PRIMARY KEY NOT NULL AUTO_INCREMENT,\n    name VARCHAR(50) NOT NULL,\n    age TINYINT UNSIGNED NOT NULL,\n    sex ENUM('M', 'W') NOT NULL\n);\nCREATE TABLE course(\n    cid INT UNSIGNED PRIMARY KEY NOT NULL AUTO_INCREMENT,\n    cname VARCHAR(50) NOT NULL,\n    credit TINYINT UNSIGNED NOT NULL\n);\nCREATE TABLE exam(\n    uid INT UNSIGNED NOT NULL,\n    cid INT UNSIGNED NOT NULL,\n    time DATE NOT NULL,\n    score FLOAT NOT NULL\n    PRIMARY KEY(uid,cid) #è”åˆä¸»é”®\n);\nDESC student;\nDESC course;\nDESC exam;\nINSERT INTO student(name,age,sex) VALUES\n('zhangsan', 18, 'M'),\n('gaoyang', 20, 'W'),\n('chenwei', 22, 'M'),\n('liufeng', 21, 'W'),\n('liuxiang', 19, 'W');\nINSERT INTO course(cname,credit) VALUES\n('C++åŸºç¡€è¯¾ç¨‹', 5),\n('C++é«˜çº§è¯¾ç¨‹', 10),\n('C++é¡¹ç›®å¼€å‘', 8),\n('C++ç®—æ³•è¯¾ç¨‹', 12),\nINSERT INTO exam(uid,cid,time,score) VALUES\n(1, 1, '2022-04-09', 99.0),\n(1, 2, '2022-04-10', 90.0),\n(2, 2, '2022-04-10', 90.0),\n(2, 3, '2022-04-12', 85.0),\n(3, 1, '2022-04-09', 56.0),\n(3, 2, '2022-04-10', 93.0),\n(3, 3, '2022-04-12', 89.0),\n(3, 4, '2022-04-11', 100.0),\n(4, 4, '2022-04-11', 99.0),\n(5, 2, '2022-04-10', 59.0),\n(5, 3, '2022-04-12', 94.0),\n(5, 4, '2022-04-11', 95.0);\n```\n\nzhangsanåŒå­¦æŸé—¨è¯¾çš„è€ƒè¯•æˆç»©ï¼Œå‡è®¾çŸ¥é“é¢„ç½®æ¡ä»¶ï¼šå­¦å·uid: 1ã€è¯¾ç¨‹å·cid: 2\n\n```mysql\nSELECT score FROM exam WHERE uid=1 AND cid=2;\n```\n\n![image-20220518113024474](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220518113024474.png)\n\næŒ‰ä¸Šé¢è¿™æ ·æŸ¥ï¼Œåªèƒ½æŸ¥å‡ºscore: 80ã€‚å…¶ä»–çš„ä¿¡æ¯æ²¡æœ‰ï¼Œè¿™æ ·ç»™å‡ºçš„ä¿¡æ¯è¿‡å°‘ã€‚\n\næ€ä¹ˆè¿›è¡Œå†…è¿æ¥æŸ¥è¯¢ï¼Œä»¥è·å–æ›´å¤šä¿¡æ¯å‘¢ï¼Ÿ\n\nå…ˆæŸ¥å­¦ç”Ÿè¡¨å’Œè€ƒè¯•åˆ›å»ºè¡¨ï¼šç”±äºå­¦ç”Ÿä¸­è¦æ ¹æ®uidï¼Œè€ƒè¯•æˆç»©ä¸­ä¹Ÿæ˜¯è¦æ ¹æ®uidï¼Œæ‰€ä»¥å±äºå…¬æœ‰çš„å†…å®¹ï¼Œå±äºå†…è¿æ¥ã€‚\n\nä¸‹é¢æ˜¯ä¸¤ä¸ªè¡¨å•ç‹¬çš„SQLï¼š\n\n```mysql\nSELECT uid,name,age,sex FROM student WHERE uid=1;\nSELECT score FROM exam WHERE uid=1 AND cid=2;\n```\n\næˆ‘ä»¬æŠŠå®ƒæƒ³åŠæ³•åˆå¹¶ï¼š\n\nå„è¡¨ä¸­å¯èƒ½æœ‰é‡å¤çš„å­—æ®µåï¼Œæ‰€ä»¥éœ€è¦ç»™è¡¨èµ·åˆ«å\n\n```mysql\nSELECT S.uid,S.name,S.age,S.sex FROM student S WHERE S.uid=1;\n\nSELECT E.score FROM exam E WHERE E.uid=1 AND E.cid=2;\n```\n\næˆ‘ä»¬å‘ç°ï¼Œä¸¤ä¸ªSQLè¯­å¥çš„å…±åŒç‚¹æ˜¯uidä¸º1ã€‚åˆ™æ˜¯æŒ‰uidæ¥è¿›è¡Œå…³è”çš„ã€‚\n\n```mysql\nSELECT S.uid,S.name,S.age,S.sex,E.score FROM student S\nINNER JOIN exam E\nON S.uid=E.uid\t#æ‹¿ä»€ä¹ˆæ¥å…³è”\nWHERE E.uid=1 AND E.cid=2;\t#è¿‡æ»¤çš„æ¡ä»¶ï¼Œå³1ã€æŸ¥çš„æ˜¯æŸä¸ªäººï¼›2ã€æŸ¥çš„æ˜¯æŸé—¨è¯¾\n```\n\n![image-20220518144857264](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220518144857264.png)\n\nè¿æ¥æŸ¥è¯¢çš„æ€§èƒ½åˆ†æï¼š\n\n`on S.uid=E.uid`æŒ‰ç…§è¡¨ä¸­è®°å½•çš„æ•°ç›®æ¥åŒºåˆ†å¤§è¡¨å’Œå°è¡¨ï¼Œå°è¡¨æ°¸è¿œæ˜¯æ•´è¡¨æ‰«æï¼Œç„¶åå»å¤§è¡¨æœç´¢ã€‚å³ä»`student`å°è¡¨ä¸­å–å‡ºæ‰€æœ‰çš„`S.uid`ï¼Œç„¶åæ‹¿ç€è¿™äº›`uid`å»`exam`å¤§è¡¨ä¸­æœç´¢ã€‚\n\nç»§ç»­ï¼šç°åœ¨åªæœ‰å­¦ç”Ÿä¿¡æ¯ã€åˆ†æ•°ï¼Œä½†æ˜¯æ²¡æœ‰è¯¾ç¨‹ä¿¡æ¯ã€‚\n\nç°åœ¨æˆ‘ä»¬å‘ç°ï¼Œå¦‚æœåŸºäº`select ... from student`çš„è¯ï¼Œæ— æ³•ä¸courseè¡¨è¿›è¡Œå…³è”ã€‚å› ä¸ºstudentè¡¨ä¸­æ— cidã€‚è€Œå¦‚æœåŸºäºeaxmæŸ¥çš„è¯ï¼Œå°±å¾ˆé¡ºåˆ©ï¼Œå› ä¸ºexamè¡¨æ—¢æœ‰uidåˆæœ‰cidï¼Œæ—¢å¯ä¸studentè¡¨å…³è”ï¼Œåˆå¯ä¸courseè¡¨å…³è”ã€‚\n\näºæ˜¯æˆ‘ä»¬å°±éœ€è¦æ”¹é€ selectè¯­å¥çš„ç¬¬ä¸€å¥ä¸­çš„`FROM ...`ã€‚æŠŠ`FROM student`æ”¹ä¸º`FROM exam`ã€‚\n\n```mysql\nSELECT S.uid,S.name,S.age,S.sex,E.score FROM eaxm E\nINNER JOIN student S\nON S.uid=E.uid\n...\n```\n\nç„¶åï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯å†å»å†…è¿æ¥courseè¡¨ï¼Œä»¥äº§ç”Ÿexamä¸å…¶çš„å…³è”ã€‚å…ˆå†™å‡ºè¦æŸ¥courseè¡¨ä¿¡æ¯çš„å•ç‹¬çš„SQLè¯­å¥ï¼š\n\n```mysql\nSELECT cid,cname,credit FROM course C WHERE C.cid=2;\n```\n\nç„¶åå†åŠ å…¥åˆ°å†…è¿æ¥è¯­å¥ä¸­å»ï¼š\n\n```mysql\nSELECT  S.uid,S.name,S.age,S.sex,\n\t\tC.cid,C.cname,C.credit,\n\t\tE.score FROM eaxm E\nINNER JOIN student S ON E.uid=S.uid\nINNER JOIN course C ON E.cid=C.cid\nWHERE E.uid=1 AND E.cid=2;\n```\n\nä»¥ä¸Šå°±æ˜¯ä¸‰è¡¨å†…è¿æ¥æŸ¥è¯¢çš„æ ‡å‡†å†™æ³•ã€‚\n\n## å†…è¿æ¥çš„åº”ç”¨ - ä¸åˆ†é¡µç»“åˆæå‡æ€§èƒ½\n\nå‰é¢æˆ‘ä»¬ç ”ç©¶è¿‡äº†ï¼Œå¦‚æœç›´æ¥æŒ‰LIMIT M,Nè¿›è¡Œå…ˆåç§»åæŸ¥è¯¢çš„æ–¹æ³•æ¥è¿›è¡Œçš„è¯ï¼Œè¶Šå¾€åæ€§èƒ½è¶Šå·®ã€‚\n\nåˆ†é¡µ - ç¬¬ä¸€ä¸ªæ–¹æ¡ˆï¼Œæœ€å·®ï¼š\n\n![image-20220518163625400](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220518163625400.png)\n\nåŒæ—¶æˆ‘ä»¬ä¹Ÿå‘ç°ï¼ŒæŸ¥è¯¢çš„æ•ˆç‡ä¹Ÿä¸æŸ¥è¯¢çš„å­—æ®µä¸ªæ•°æœ‰å…³ç³»ï¼Œæ¯”å¦‚åªæŸ¥idçš„è¯ï¼Œæ€§èƒ½å°±ä¼šæœ‰æ‰€æå‡ã€‚\n\nåˆ†é¡µ - ç¬¬äºŒä¸ªæ–¹æ¡ˆï¼Œé€‚ä¸­ï¼Œä½†æ˜¯ä¿¡æ¯å°‘ï¼š\n\n![image-20220518163818854](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220518163818854.png)\n\næœ€æè‡´æ€§èƒ½çš„åŠæ³•ï¼Œä½†æ˜¯å¸¸å¸¸ä¸é€šç”¨â€”â€”å…ˆè¿‡æ»¤idï¼Œç›´æ¥ä»è¿‡æ»¤å®Œçš„ä½ç½®LIMITæŸ¥è¯¢Næ¡è®°å½•ã€‚ä½†æ˜¯è¿™è¦æ±‚æˆ‘ä»¬çŸ¥é“å½“å‰çš„idå€¼åŠå…¶æ¡ä»¶ï¼Œé€šå¸¸æƒ…å†µä¸‹ä¸èƒ½å®ç°ï¼Œæˆ‘ä»¬åªæ¸…æ¥šç›®å‰åç§»åˆ°äº†å¤šå°‘ä½ç½®ï¼Œä¸€æ¬¡å–å¤šå°‘æ¡ã€‚\n\nåˆ†é¡µ - ç¬¬ä¸‰ä¸ªæ–¹æ¡ˆï¼Œæè‡´ï¼Œä½†æ˜¯å¾€å¾€ä¸èƒ½å®ç°ï¼š\n\n![image-20220518164026806](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220518164026806.png)\n\næˆ‘ä»¬å†æŠŠç›®å…‰è½¬åˆ°ç¬¬äºŒä¸ªæ–¹æ¡ˆ - å³åªæŸ¥idã€‚\n\nä¸ºäº†å°½å¯èƒ½æé«˜æ€§èƒ½ï¼Œæˆ‘ä»¬åªæŸ¥å‡ºäº†idè¿™ä¸€åˆ—ã€‚ç›®å‰çš„ä¿¡æ¯é‡è¿‡å°‘ã€‚ä½†æ˜¯**æˆ‘ä»¬å´å¯ä»¥åˆ©ç”¨æŸ¥å‡ºçš„idæ•°æ®ï¼Œä¸è‡ªå·±çš„åŸè¡¨è¿›è¡Œå†…è¿æ¥**ã€‚è¿™æ˜¯åŸºæœ¬æ€æƒ³ã€‚\n\n```mysql\nSELECT U.id,U.email,U.password FROM t_user U\nINNER JOIN (SELECT id FROM t_user LIMIT 1500000,10) temp ON U.id=temp.id;\n```\n\nå¦‚æ­¤ä¸ä»…ä»…å¯ä»¥å¾—åˆ°æ›´å¤šä¿¡æ¯ï¼Œè€Œä¸”æ•ˆç‡å’ŒåªæŸ¥idè¿™ä¸€åˆ—ä¸€è‡´ã€‚\n\n![image-20220518164514376](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220518164514376.png)\n\nexplainæ­¤è¯­å¥çš„ç»“æœï¼š\n\n![image-20220518164909106](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220518164909106.png)\n\n### æ€»ç»“ - å†…è¿æ¥çš„è¿‡ç¨‹\n\n> åœ¨åšå®éªŒä¹‹å‰ï¼Œå…ˆå£°æ˜ä¸€ä¸‹è¡¨ä¸­çš„æœ€æ–°å†…å®¹\n> ![image-20220519082805106](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220519082805106.png)\n\n```mysql\nSELECT S.*,E.* FROM student S\nINNER JOIN exam E ON S.uid=E.uid;\n```\n\n![image-20220519083428353](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220519083428353.png)\n\n```mysql\nEXPLAIN\nSELECT S.*,E.* FROM student S\nINNER JOIN exam E ON S.uid=E.uid;\n```\n\n![image-20220519084255059](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220519084255059.png)\n\nå¦‚æœæˆ‘ä»¬é€šè¿‡whereè¿‡æ»¤æ¡ä»¶ä½¿Examä»å¤§è¡¨å˜å°è¡¨å‘¢ï¼Ÿ\n\n```mysql\nSELECT S.*,E.* FROM student S\nINNER JOIN exam E ON S.uid=E.uid\nWHERE E.cid=3;\n```\n\n![image-20220519090035026](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220519090035026.png)\n\næˆ‘ä»¬çœ‹åˆ°ï¼Œåœ¨Eè¡¨è¿›è¡Œå†…è¿æ¥æ—¶ï¼Œéœ€è¦å…ˆè¿‡æ»¤ï¼Œå³Eéœ€è¦è¿›è¡Œå…¨è¡¨æ‰«æï¼Œç„¶åEæˆä¸ºå°è¡¨ï¼ˆç›¸æ¯”äºSè¡¨ï¼‰ï¼Œç„¶åï¼Œå†æ‹¿å‰©ä¸‹çš„è®°å½•ä¸Sè¡¨æ¯”å¯¹ã€‚\n\nEè¡¨æ²¡æœ‰ç”¨åˆ°cidçš„ç´¢å¼•ï¼Œå› ä¸ºuidå’Œcidæ˜¯è”åˆç´¢å¼•ï¼Œåªæœ‰å…ˆç”¨uidç´¢å¼•ï¼Œcidæ‰æœ‰æ•ˆã€‚\n\nå†çœ‹ä¸€ä¸ª - æŠŠwhereçš„è¿‡æ»¤æ¡ä»¶æ”¹åˆ°onä¸­ã€‚å’Œä¸Šé¢æœ‰åŒºåˆ«å—ï¼Ÿ\n\n```mysql\nSELECT S.*,E.* FROM student S\nINNER JOIN exam E ON S.uid=E.uid and E.cid=3;\n```\n\n![image-20220519091420259](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220519091420259.png)\n\nå‘ç°ï¼Œå¯¹äº`inner join`å†…è¿æ¥ï¼Œè¿‡æ»¤æ¡ä»¶ä¸ç®¡å†™åœ¨whereçš„åé¢å’Œonè¿æ¥æ¡ä»¶é‡Œé¢ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚è€Œä¸”extraé‡Œå†™æ˜ç¬¬ä¸€ä¸ªæ˜¯`Using where`ï¼Œè¯´æ˜mysqlä¸ºæˆ‘ä»¬åšäº†ä¼˜åŒ–ï¼Œæ”¹æˆäº†whereè¿‡æ»¤ï¼Œå› ä¸ºwhereè¿‡æ»¤åå†æŸ¥è¯¢çš„æ•ˆç‡ä¼šæ›´å¥½ã€‚\n\n## å¤–è¿æ¥\n\næ ¼å¼ï¼š\n\n```\n#å·¦è¿æ¥æŸ¥è¯¢\n#æ˜¾ç¤ºleftè¡¨æ‰€æœ‰æ•°æ®ï¼Œå³è¡¨ä¸­å¦‚æœä¸å­˜åœ¨ç›¸åº”æ•°æ®åˆ™æ˜¾ç¤ºNULL\nSELECT a.å±æ€§ååˆ—è¡¨, b.å±æ€§ååˆ—è¡¨ FROM table_a a\nLEFT [OUTER] JOIN table_b b ON a.id=b.id;\n\n#å³è¿æ¥æŸ¥è¯¢\n#æ˜¾ç¤ºrightè¡¨æ‰€æœ‰æ•°æ®ï¼Œå·¦è¡¨ä¸­å¦‚æœä¸å­˜åœ¨ç›¸åº”æ•°æ®åˆ™æ˜¾ç¤ºNULL\nSELECT a.å±æ€§ååˆ—è¡¨, b.å±æ€§ååˆ—è¡¨ FROM table_a a\nRIGHT [OUTER] JOIN table_b b ON a.id=b.id;\n```\n\n\n\n```mysql\nSELECT S.*,E.* FROM student S\nLEFT JOIN exam E ON S.uid=E.uid;\n```\n\n![image-20220519094125697](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220519094125697.png)\n\n```mysql\nSELECT S.*,E.* FROM student S\nRIGHT JOIN exam E ON S.uid=E.uid;\n```\n\n![image-20220519094314249](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220519094314249.png)\n\n```mysql\nEXPLAIN SELECT S.*,E.* FROM student S\nINNER JOIN exam E ON S.uid=E.uid;\n\nEXPLAIN SELECT S.*,E.* FROM student S\nLEFT JOIN exam E ON S.uid=E.uid;\n\nEXPLAIN SELECT S.*,E.* FROM student S\nRIGHT JOIN exam E ON S.uid=E.uid;\n```\n\n![image-20220519100936236](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220519100936236.png)\n\n---\n\nå®é™…çš„é—®é¢˜ï¼šèƒ½ä¸èƒ½æŸ¥å‡ºæ¥è°æ²¡å‚åŠ è€ƒè¯•ï¼Ÿ\n\n```mysql\nSELECT * FROM student WHERE uid NOT IN (SELECT DISTINCT uid FROM exam);\n```\n\nä¸Šé¢è¿™ä¸ªSQLè™½ç„¶å¯ä»¥å®Œæˆï¼Œä½†æ˜¯NOT INæ˜¯å¦èƒ½å¤Ÿç”¨åˆ°ç´¢å¼•æ˜¯ä¸å®¹æ˜“ç¡®å®šçš„ã€‚å¦å¤–ï¼Œå­æŸ¥è¯¢çš„ç»“æœå¯èƒ½ä¼šç”Ÿæˆä¸´æ—¶è¡¨ã€‚\n\nç”¨å¤–è¿æ¥æ¥è§£å†³ï¼š\n\n```mysql\nSELECT S.* FROM student S\nLEFT JOIN exam E ON S.uid=E.uid\nWHERE E.cid IS NULL;\n```\n\n![image-20220519101959096](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220519101959096.png)\n\nExplainæŸ¥çœ‹æŸ¥è¯¢æµç¨‹ï¼š\n\n![image-20220519102456318](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220519102456318.png)\n\næ‹¿studentè¡¨æ‰€æœ‰æ•°æ®ä¸examè¡¨å¯¹æ¯”ã€‚examè¡¨ä¸­çš„uidå’Œcidæ˜¯è”åˆä¸»é”®ï¼Œå› ä¸ºuidæ˜¯ç¬¬ä¸€åˆ—ç´¢å¼•ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨uidç´¢å¼•ã€‚\n\n---\n\n## å¤–è¿æ¥å’Œå†…è¿æ¥çš„åŒºåˆ«\n\nå‚åŠ è¿‡æŸä¸€é—¨è€ƒè¯•çš„äºº\n\nå…ˆç”¨å†…è¿æ¥æ¥å†™ï¼š\n\n```mysql\nSELECT S.* FROM student S\nINNER JOIN exam E ON S.uid=E.uid\nWHERE E.cid=3;\n```\n\n![image-20220519103001353](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220519103001353.png)\n\næ²¡æœ‰å‚åŠ cidä¸º3çš„è€ƒè¯•çš„äºº\n\n```mysql\nSELECT S.* FROM student S\nLEFT JOIN exam E\nON S.uid=E.uid\nWHERE E.uid=3\nAND E.cid IS NULL;\n```\n\n```mysql\nSELECT S.* FROM student S\nLEFT JOIN exam E\nON S.uid=E.uid\nWHERE E.uid=3;\n```\n\n```mysql\nSELECT S.* FROM student S\nLEFT JOIN exam E\nON S.uid=E.uid AND E.cid=3;\n```\n\n![image-20220519103539550](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220519103539550.png)\n\n```mysql\nSELECT S.* FROM student S\nLEFT JOIN exam E\nON S.uid=E.uid AND E.cid=3\nWHERE E.cid IS NULL;\n```\n\n![image-20220519103820392](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220519103820392.png)\n\næˆ‘ä»¬å‘ç°ï¼Œwhereæ¡ä»¶å’Œonæ¡ä»¶åœ¨å†…å¤–è¿æ¥ä¸Šéœ€è¦æ–Ÿé…Œã€‚\n\n---\n\nexplainåˆ†æ\n\n![image-20220519104015360](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220519104015360.png)\n\n![image-20220519104102999](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220519104102999.png)\n\nè¿™æ ·å†™å†…è¿æ¥å’Œå¤–è¿æ¥æ— åŒºåˆ«ã€‚éƒ½æ˜¯å…ˆä½¿ç”¨whereè¿‡æ»¤ï¼Œç„¶åexamå˜ä¸ºå°è¡¨ã€‚æ‹¿examå…¨éƒ¨æ•°æ®ï¼ˆä¸»é”®ï¼‰å»studentæœç´¢ã€‚è¿™æ ·çš„å¤–è¿æ¥æ˜¯ä¸æ­£ç¡®çš„ã€‚\n\n```mysql\nEXPLAIN SELECT S.* FROM student S\nLEFT JOIN exam E ON S.uid=E.uid AND E.uid=3;\n```\n\n![image-20220519112753295](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220519112753295.png)\n\næŠŠ`E.uid=3`æ”¾åœ¨onåé¢æ‰ä¼šå¯¹studentè¡¨è¿›è¡Œå…¨è¡¨æ‰«æã€‚è¿›è€Œå»examè¡¨ä¸­åŒ¹é…ã€‚\n\nç„¶åæˆ‘ä»¬å†åœ¨è¿™ä¸ªæ­£ç¡®å¤–è¿æ¥åçš„åŸºç¡€ä¸Šï¼Œå†åŠ `WHERE E.cid IS NULL`ï¼Œè¿™æ‰èƒ½æ­£ç¡®æ˜¾ç¤ºæœªå‚åŠ cidä¸ºçš„è€ƒè¯•çš„å­¦ç”Ÿã€‚\n\n```mysql\nSELECT S.* FROM student S\nLEFT JOIN exam E ON S.uid=E.uid AND E.uid=3\nWHERE E.cid IS NULL;\n```\n\n![image-20220519113227107](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20220519113227107.png)\n\nå› æ­¤æˆ‘ä»¬æ€»ç»“å‡ºäº†ä¸€æ¡ç»éªŒï¼šå¤–è¿æ¥ä¸­ï¼Œè¿æ¥æ—¶çš„é™åˆ¶æ¡ä»¶è¦æ”¾åˆ°ONåé¢ï¼Œç„¶åæŠŠNULLçš„è¿‡æ»¤æ¡ä»¶æ”¾åˆ°æœ€åçš„whereä¸­ã€‚\n# è¿æ¥æŸ¥è¯¢ä¸­çš„ç´¢å¼•å½±å“æ€§èƒ½\n![](../../images/MySQL_æŸ¥è¯¢ä¸“é¢˜/image-20250731013505045.png)\n\nå°è¡¨å†³å®šå¾ªç¯çš„æ¬¡æ•°ï¼Œå¤§è¡¨å†³å®šæ¯æ¬¡å¾ªç¯çš„æŸ¥è¯¢æ—¶é—´ã€‚","categories":["æ•°æ®åº“","MySQL"]},{"title":"MySQL_èŒƒå¼è®¾è®¡","url":"/æ•°æ®åº“/MySQL_èŒƒå¼è®¾è®¡/","content":"# å†…å®¹\n\n1. å…³ç³»å‹æ•°æ®åº“èŒƒå¼\n2. åº”ç”¨èŒƒå¼çš„å¥½å¤„\n3. ç¬¬ä¸€èŒƒå¼\n4. ç¬¬äºŒèŒƒå¼\n5. ç¬¬ä¸‰èŒƒå¼\n6. BCèŒƒå¼\n7. ç¬¬å››èŒƒå¼\n\n# åº”ç”¨èŒƒå¼çš„å¥½å¤„\n\nèŒƒå¼å’Œè¡¨çš„è®¾è®¡æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿå¯ä»¥è¯´æ˜¯æ¯æ¯ç›¸å…³ï¼Œè¡¨è®¾è®¡è¿‡ç¨‹ä¸­éœ€è¦çŸ¥é“çš„è§„åˆ™ï¼Œåœ¨èŒƒå¼è®¾è®¡ä¸­ï¼Œéƒ½ä¼šæœ‰æ‰€æåŠã€‚å¯ä»¥è¯´ï¼ŒèŒƒå¼æ˜¯è¡¨è®¾è®¡åŸåˆ™çš„æç‚¼ã€‚\n\nè¡¨è®¾è®¡åŸåˆ™æ˜¯å‘Šè¯‰æˆ‘ä»¬æ€ä¹ˆè®¾è®¡è¡¨ä¹‹é—´çš„å…³è”ï¼Œå¹¶ä¸”å°½é‡å‡å°‘æ•°æ®å†—ä½™ã€‚\n\nè€Œåº”ç”¨èŒƒå¼æœ€é‡è¦çš„å¥½å¤„ä¹Ÿæ˜¯**å‡å°‘æ•°æ®å†—ä½™**ã€‚ç”±æ­¤å¸¦æ¥çš„å¥½å¤„æœ‰ï¼š\n\n1. æ¶ˆé™¤å¼‚å¸¸ï¼ˆæ’å…¥å¼‚å¸¸ã€æ›´æ–°å¼‚å¸¸ã€åˆ é™¤å¼‚å¸¸ï¼‰\n2. è®©æ•°æ®ç»„ç»‡åœ°æ›´åŠ å’Œè°\n\n# ç¬¬ä¸€èŒƒå¼\n\n> 1. æ¯ä¸€åˆ—ä¿æŒåŸå­ç‰¹æ€§\n> 2. ä¸ç¬¦åˆç¬¬ä¸€èŒƒå¼åˆ™ä¸èƒ½ç§°ä½œå…³ç³»å‹æ•°æ®åº“ã€‚æ¯”å¦‚key-valueï¼Œå› ä¸ºkeyå¯¹åº”çš„valueå¯èƒ½åŒ…å«äº†å„ç§æ‚ä¹±çš„ä¿¡æ¯ï¼Œä¾‹å¦‚jsonæ•°æ®ã€‚\n\nåˆ—éƒ½æ˜¯åŸºæœ¬æ•°æ®é¡¹ï¼Œä¸èƒ½å†è¿›è¡Œåˆ†å‰²ï¼Œå¦åˆ™è®¾è®¡æˆä¸€å¯¹å¤šçš„å®ä½“å…³ç³»ã€‚\n\nä¾‹å¦‚è¡¨ä¸­çš„åœ°å€å­—æ®µï¼Œå¯ä»¥å†ç»†åˆ†ä¸ºçœã€å¸‚ã€åŒºç­‰ä¸å¯å†åˆ†å‰²çš„å­—æ®µã€‚\n\n![image-20220516163422062](../../images/MySQL_èŒƒå¼è®¾è®¡/image-20220516163422062.png)\n\nä¸Šå›¾çš„Employeeè¡¨ä¸­çš„Addresså­—æ®µï¼Œå°±æ²¡æœ‰éµå¾ªç¬¬ä¸€èŒƒå¼ã€‚å³åœ°å€ä¿¡æ¯å¯ä»¥ç»†åˆ†ä¸ºå¾ˆå¤šè¯¦ç»†çš„åœ°å€ã€‚å¦‚æœæ²¡æœ‰å»è§„èŒƒåœ°å€çš„åˆ†ç±»ï¼Œåˆ™å°±ä¼šé€ æˆåœ°å€æ•°æ®ç²’åº¦å¤ªç²—ã€‚å¦‚æœæˆ‘ä»¬è¦æŸ¥è¯¢æŸä¸€ç‰¹å®šåœ°å€çš„é›‡å‘˜ä¿¡æ¯ï¼Œè¿˜è¦ä»åœ°å€å­—ç¬¦ä¸²ä¸­æå–ç›¸å…³ä¿¡æ¯ï¼Œè¿‡äºéº»çƒ¦ã€‚\n\n![image-20220516163314051](../../images/MySQL_èŒƒå¼è®¾è®¡/image-20220516163314051.png)\n\næˆ‘ä»¬ç°åœ¨å°†AddressæŠ½å–å‡ºæ¥ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„è¡¨ï¼Œè®©åœ°å€å­—æ®µåˆ†æˆæ›´è¯¦ç»†çš„cityã€countryã€streetä¸‰ä¸ªå­—æ®µã€‚å†è®©Employeeè¡¨ä¸å…¶å…³è”ï¼Œåˆ™å¯è§£å†³Addressç²’åº¦è¿‡ç²—çš„é—®é¢˜ã€‚\n\næŸ¥è¯¢æŒ‡å®šEmployeeIDçš„èŒå‘˜çš„åœ°å€ä¿¡æ¯ã€‚\n\n```mysql\n# æ–¹æ³•ä¸€ï¼šå¸¦inçš„å­æŸ¥è¯¢ï¼Œå­æŸ¥è¯¢æ•ˆç‡è¾ƒä½\nselect * from EmployeeAddress where addressID in (select AddressID from Employee where EmployeeID=1);\n# ç”¨è¿æ¥æŸ¥è¯¢æ•ˆç‡é«˜ä¸€äº›ã€‚\n```\n\n# ç¬¬äºŒèŒƒå¼\n\n> å±æ€§å®Œå…¨ä¾èµ–äºä¸»é”® - ä¸»è¦é’ˆå¯¹è”åˆä¸»é”®\n\néä¸»å±æ€§ï¼ˆä¸æ˜¯ä¸»é”®çš„å­—æ®µï¼‰å¿…é¡»å®Œå…¨ä¾èµ–ä¸»å…³é”®å­—ï¼ˆåŒ…æ‹¬è”åˆä¸»é”®çš„æ¯ä¸€åˆ—ï¼‰ï¼Œå¦‚æœä¸æ˜¯å®Œå…¨ä¾èµ–ä¸»é”®ï¼Œåº”è¯¥æ‹†åˆ†æˆæ–°çš„å®ä½“ï¼Œè®¾è®¡æˆä¸€å¯¹å¤šçš„å®ä½“å…³ç³»ã€‚\n\nä¾‹å¦‚æ•™åŠ¡ç³»ç»Ÿä¸­çš„é€‰è¯¾ï¼š\né€‰è¯¾å…³ç³»è¡¨ä¸º`SelectCourse(å­¦å·, å§“å, å¹´é¾„, è¯¾ç¨‹åç§°, æˆç»©, å­¦åˆ†)`ã€‚\nåˆ™`(å­¦å·, è¯¾ç¨‹åç§°)`æ˜¯è”åˆä¸»é”®ï¼Œ\nä½†æ˜¯**å­¦åˆ†å­—æ®µåªä¸è¯¾ç¨‹åç§°æœ‰å…³ï¼Œä¸å­¦å·æ— å…³**ï¼Œç›¸å½“äºåªä¾èµ–è”åˆä¸»é”®çš„å…¶ä¸­ä¸€ä¸ªå­—æ®µ - `è¯¾ç¨‹åç§°`ï¼Œä¸ç¬¦åˆç¬¬äºŒèŒƒå¼ã€‚\nå§“åã€å¹´é¾„åªå’Œå­¦å·æœ‰å…³ï¼Œä¸è¯¾ç¨‹åç§°æ— å…³ã€‚åªä¾èµ–è”åˆä¸»é”®çš„å…¶ä¸­ä¸€ä¸ªå­—æ®µ - `å­¦å·`ï¼Œä¸ç¬¦åˆç¬¬äºŒèŒƒå¼ã€‚\n\næ€»ä¹‹ï¼Œå­¦åˆ†åœ¨æ­¤è¡¨ä¸­å±äºå†—ä½™å­˜å‚¨ã€‚`å§“å`å’Œ`å¹´é¾„`å­—æ®µä¹Ÿå±äºå†—ä½™å­˜å‚¨ã€‚\n\nå­¦ç”Ÿå’Œè¯¾ç¨‹ä¹‹é—´ï¼Œå±äºå¤šå¯¹å¤šçš„å…³ç³»ã€‚\n\nå­¦ç”Ÿè¡¨ï¼š\n\n| å­¦å·  | å§“å  | å¹´é¾„  |\n| --- | --- | --- |\n\nè¯¾ç¨‹è¡¨ï¼š\n\n| è¯¾ç¨‹id | è¯¾ç¨‹åç§° | å­¦åˆ† |\n| ------ | -------- | ---- |\n\né€‰è¯¾æƒ…å†µï¼ˆä¸­é—´è¡¨ï¼‰ï¼š\n\n| å­¦å· | è¯¾ç¨‹id | æˆç»© |\n| ---- | ------ | ---- |\n\n---\n\nå†ä¾‹å¦‚ï¼Œä¸Šé¢çš„Employeeè¡¨ã€‚ç»å†äº†ç¬¬ä¸€èŒƒå¼ä¹‹åï¼Œä»å­˜åœ¨é—®é¢˜ã€‚\n\nè¯¥è¡¨å­˜åœ¨è”åˆä¸»é”®`(EmployeeID, departmentName)`ã€‚è¡¨ä¸­`Name`å­—æ®µæ˜æ˜¾ä¸`departmentName`ä¸å­˜åœ¨å…³ç³»ã€‚å› æ­¤ä¸ç¬¦åˆç¬¬äºŒèŒƒå¼ã€‚\n\nåˆ™æŠŠdepartmentæœ‰å…³ä¿¡æ¯\n\n![image-20220516202334294](../../images/MySQL_èŒƒå¼è®¾è®¡/image-20220516202334294.png)\n\n# ç¬¬ä¸‰èŒƒå¼\n\n> å±æ€§ä¸ä¾èµ–äºå…¶ä»–éä¸»å±æ€§ã€‚\n>\n> ä¸€èˆ¬çš„å…³ç³»å‹æ•°æ®åº“æ»¡è¶³ç¬¬ä¸‰èŒƒå¼å°±è¶³å¤Ÿäº†ã€‚\n\nè¦æ±‚ä¸€ä¸ªæ•°æ®è¡¨ä¸­ä¸åŒ…å«å·²åœ¨å…¶ä»–è¡¨ä¸­å·²åŒ…å«çš„éä¸»å…³é”®å­—ä¿¡æ¯ã€‚\n\nç¤ºä¾‹ï¼š\nå­¦ç”Ÿå…³ç³»è¡¨ä¸º`Student(å­¦å·, å§“å, å¹´é¾„, æ‰€åœ¨å­¦é™¢, å­¦é™¢åœ°ç‚¹, å­¦é™¢ç”µè¯)`ï¼Œ\nå­—æ®µ`å­¦å·`æ˜¯ä¸»é”®ã€‚\nä½†æ˜¯ï¼Œå­—æ®µ`å­¦é™¢åœ°ç‚¹`ã€`å­¦é™¢ç”µè¯`ä¾èµ–äºéä¸»å±æ€§`æ‰€åœ¨å­¦é™¢`ï¼Œå¹¶ä¸ä¾èµ–äºä¸»é”®`å­¦å·`ã€‚\nå› æ­¤è¯¥è®¾è®¡ä¸ç¬¦åˆç¬¬ä¸‰èŒƒå¼ã€‚\nåº”è¯¥æŠŠå­¦é™¢å•ç‹¬è®¾è®¡æˆä¸€å¼ è¡¨ï¼Œå­¦é™¢å’Œå­¦ç”Ÿæ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚\n\n---\n\nå†å¦‚Employeeè¡¨ä¸­çš„é—®é¢˜ï¼Œå‘ç°å­—æ®µ`jobDescription`å¹¶ä¸ä¾èµ–äºä¸»é”®`EmployeeID`ï¼Œè€Œæ˜¯ä¾èµ–éä¸»å±æ€§`job`ã€‚ä¸ç¬¦åˆç¬¬ä¸‰èŒƒå¼ã€‚å› æ­¤æŠŠ`job`æœ‰å…³çš„å±æ€§æŠ½å–å‡ºæ¥å•ç‹¬ä½œä¸º`job`è¡¨ã€‚å·¥ä½œå’Œé›‡å‘˜ä¹Ÿæ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚\n\n![image-20220517082159583](../../images/MySQL_èŒƒå¼è®¾è®¡/image-20220517082159583.png)\n\n# BCèŒƒå¼\n\n> æ¯ä¸ªè¡¨ä¸­åªæœ‰ä¸€ä¸ªå€™é€‰é”®\n\nBCèŒƒå¼æ˜¯åœ¨ç¬¬ä¸‰èŒƒå¼çš„åŸºç¡€ä¸Šçš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå³æ¯ä¸ªè¡¨ä¸­åªæœ‰ä¸€ä¸ª**å€™é€‰é”®**ï¼ˆåœ¨ä¸€ä¸ªæ•°æ®åº“ä¸­ï¼Œæ¯è¡Œçš„å€¼éƒ½ä¸ç›¸åŒï¼Œåˆ™å¯ç§°ä¸ºå€™é€‰é”®ï¼‰ã€‚Employeeè¡¨ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ¯ä¸€ä¸ªå‘˜å·¥çš„`email`éƒ½æ˜¯å”¯ä¸€çš„ï¼ˆé€»è¾‘ä¸Šæ¥è¯´ï¼Œé‚®ç®±æ˜¯å•äººå•ç”¨ï¼‰ï¼Œåˆ™ä¸Šè¡¨ä¸ç¬¦åˆBCèŒƒå¼ã€‚\n\nåº”æŠŠé‚®ç®±å•ç‹¬æŠ½å‡ºä½œä¸ºä¸€å¼ è¡¨ã€‚é‚®ç®±ä¸é›‡å‘˜å±äºä¸€å¯¹ä¸€çš„å…³ç³»ã€‚\n\n![image-20220517084229658](../../images/MySQL_èŒƒå¼è®¾è®¡/image-20220517084229658.png)\n\n# ç¬¬å››èŒƒå¼\n\n> æ¶ˆé™¤è¡¨ä¸­çš„å¤šå€¼ä¾èµ–\n\nç®€å•æ¥è¯´ï¼Œç¬¬å››èŒƒå¼å°±æ˜¯è¦æ¶ˆé™¤è¡¨ä¸­çš„å¤šå€¼ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥å‡å°‘æ•°æ®ä¸€è‡´æ€§çš„å·¥ä½œã€‚æ¯”å¦‚Employeeè¡¨ä¸­çš„å­—æ®µ`skill`ï¼Œæœ‰çš„äººæ˜¯`\"java, mysql\"`ï¼Œæœ‰çš„äººæ˜¯`\"Java, MySQL\"`ï¼Œè¿™æ ·æ•°æ®å°±ä¸ä¸€è‡´äº†ã€‚\n\nè§£å†³æ–¹æ¡ˆå°±æ˜¯å°†å¤šå€¼å±æ€§æ”¾å…¥ä¸€ä¸ªæ–°è¡¨ã€‚Employeeè¡¨åˆ™æ˜¯æŠŠ`skill`æŠ½å‡ºä½œä¸ºä¸€å¼ è¡¨ã€‚é›‡å‘˜å’ŒæŠ€èƒ½æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚\n\n![image-20220517085547889](../../images/MySQL_èŒƒå¼è®¾è®¡/image-20220517085547889.png)\n\n| skill  | EmployeeID |\n| ------ | ---------- |\n| C++    | 1000       |\n| Java   | 1000       |\n| MySQL  | 2000       |\n| Golang | 2000       |\n| Rust   | 1000       |\n| C++    | 2000       |\n\n# æ€»ç»“\n\n* èŒƒå¼å«ä¹‰\n* å¥½å¤„ï¼šåº”ç”¨æ•°æ®åº“èŒƒå¼å¯ä»¥å¸¦æ¥è®¸å¤šå¥½å¤„,ä½†æ˜¯æœ€é‡è¦çš„å¥½å¤„å½’ç»“ä¸ºä¸‰ç‚¹ï¼š\n    1. å‡å°‘æ•°æ®æ²‰ä½™(è¿™æ˜¯æœ€ä¸»è¦çš„å¥½å¤„ï¼Œå…¶ä»–å¥½å¤„éƒ½æ˜¯ç”±æ­¤è€Œé™„å¸¦çš„)\n    2. æ¶ˆé™¤å¼‚å¸¸(æ’å…¥å¼‚å¸¸ã€æ›´æ–°å¼‚å¸¸ã€åˆ é™¤å¼‚å¸¸\n    3. è®©æ•°æ®ç»„ç»‡çš„æ›´åŠ å’Œè°\n* ç¼ºç‚¹ï¼šä½†æ˜¯æ•°æ®åº“èŒƒå¼ç»å¯¹ä¸æ˜¯è¶Šé«˜è¶Šå¥½ï¼ŒèŒƒå¼è¶Šé«˜ï¼Œæ„å‘³ç€è¡¨è¶Šå¤šï¼Œå¤šè¡¨è”åˆæŸ¥è¯¢çš„æœºç‡å°±è¶Šå¤§ï¼ŒSQLçš„æ•ˆç‡å°±å˜ä½ã€‚","categories":["æ•°æ®åº“","MySQL"]},{"title":"Linux_exit","url":"/Linux/Linux_exit/","content":"\n# å†…å®¹\n\n1. \n2. `exit`\n3. åƒµæ­»è¿›ç¨‹\n\n# è¿›ç¨‹ç»ˆæ­¢æ–¹å¼\n\n![image-20220515093901952](../../images/Linux_exit/image-20220515093901952.png)\n\n## è¿›ç¨‹5ç§æ­£å¸¸ç»ˆæ­¢æ–¹å¼\n\n1. ä»mainè¿”å›ï¼Œå³åœ¨mainå‡½æ•°å†…æ‰§è¡Œ`return`è¯­å¥ï¼Œç­‰æ•ˆäºè°ƒç”¨`exit`ã€‚\n2. è°ƒç”¨`exit`å‡½æ•°ã€‚æ­¤å‡½æ•°ç”±`ISO C`å®šä¹‰ï¼Œå…¶æ“ä½œåŒ…æ‹¬è°ƒç”¨å„ç»ˆæ­¢å¤„ç†ç¨‹åºï¼ˆç»ˆæ­¢å¤„ç†ç¨‹åºåœ¨è°ƒç”¨`atexit`å‡½æ•°æ—¶ç™»è®°ï¼‰ï¼Œç„¶åå…³é—­æ‰€æœ‰æ ‡å‡†I/Oæµç­‰ã€‚å› ä¸º`ISO C`å¹¶ä¸å¤„ç†æ–‡ä»¶æè¿°ç¬¦ã€å¤šè¿›ç¨‹ï¼ˆçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ï¼‰ä»¥åŠä½œä¸šæ§åˆ¶ï¼Œæ‰€ä»¥è¿™ä¸€å®šä¹‰å¯¹UNIXç³»ç»Ÿè€Œè¨€æ˜¯ä¸å®Œæ•´çš„ã€‚\n3. è°ƒç”¨`_exit`æˆ–`_Exit`å‡½æ•°ã€‚`ISO C`å®šä¹‰`_Exit`ï¼Œå…¶ç›®çš„æ˜¯ä¸ºè¿›ç¨‹æä¾›ä¸€ç§æ— éœ€è¿è¡Œç»ˆæ­¢å¤„ç†ç¨‹åºæˆ–ä¿¡å·å¤„ç†ç¨‹åºè€Œç»ˆæ­¢çš„æ–¹æ³•ã€‚å¯¹æ ‡å‡†I/Oæµæ˜¯å¦è¿›è¡Œå†²æ´—å–å†³äºå®ç°æ–¹å¼ã€‚åœ¨UNIXç³»ç»Ÿä¸­ï¼Œ`_Exit`å’Œ`_exit`æ˜¯åŒä¹‰çš„ï¼Œå¹¶ä¸å†²æ´—æ ‡å‡†I/Oæµã€‚`_exit`å‡½æ•°ç”±`exit`è°ƒç”¨ï¼Œå®ƒå¤„ç†UNIXç³»ç»Ÿç‰¹å®šçš„ç»†èŠ‚ã€‚`_exit`æ˜¯ç”±`POSIX.1`è¯´æ˜çš„ã€‚\n\n   > åœ¨å¤§å¤šæ•°UNIXç³»ç»Ÿå®ç°ä¸­ï¼Œ`exit(3)`æ˜¯æ ‡å‡†Cåº“ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œè€Œ`_exit(2)`åˆ™æ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ã€‚\n4. æœ€åä¸€ä¸ªçº¿ç¨‹ä»å…¶å¯åŠ¨ä¾‹ç¨‹è¿”å›ä¸­æ‰§è¡Œreturnè¯­å¥ã€‚ä½†æ˜¯è¯¥çº¿ç¨‹çš„è¿”å›å€¼ä¸ç”¨ä½œè¿›ç¨‹çš„è¿”å›å€¼ã€‚å½“æœ€åä¸€ä¸ªçº¿ç¨‹ä»å…¶å¯åŠ¨ä¾‹ç¨‹è¿”å›æ—¶ï¼Œè¯¥è¿›ç¨‹ä»¥ç»ˆæ­¢çŠ¶æ€0è¿”å›ã€‚\n5. ä»æœ€åä¸€ä¸ªçº¿ç¨‹è°ƒç”¨`pthread_exit`å‡½æ•°ã€‚å¦‚åŒå‰é¢ä¸€æ ·ï¼Œåœ¨è¿™ç§æƒ…å†µä¸­ï¼Œè¿›ç¨‹ç»ˆæ­¢çŠ¶æ€æ€»æ˜¯0ï¼Œè¿™ä¸ä¼ é€ç»™`pthread_exit`çš„å‚æ•°æ— å…³ã€‚\n\n## è¿›ç¨‹3ç§å¼‚å¸¸ç»ˆæ­¢æ–¹å¼\n\n1. è°ƒç”¨abortã€‚äº§ç”Ÿ`SIGABRT`ä¿¡å·ï¼Œè¿™æ˜¯ä¸‹ä¸€ç§å¼‚å¸¸ç»ˆæ­¢çš„ä¸€ç§ç‰¹ä¾‹ã€‚\n2. å½“è¿›ç¨‹æ¥æ”¶åˆ°æŸäº›ä¿¡å·æ—¶ã€‚ä¿¡å·å¯ç”±è¿›ç¨‹è‡ªèº«ï¼ˆå¦‚è°ƒç”¨`abort`å‡½æ•°ï¼‰ã€å…¶ä»–è¿›ç¨‹æˆ–å†…æ ¸äº§ç”Ÿã€‚ä¾‹å¦‚ï¼Œè‹¥è¿›ç¨‹å¼•ç”¨åœ°å€ç©ºé—´ä¹‹å¤–çš„å­˜å‚¨å•å…ƒã€æˆ–è€…é™¤ä»¥0ï¼Œå†…æ ¸å°±ä¼šä¸ºè¯¥è¿›ç¨‹äº§ç”Ÿç›¸åº”çš„ä¿¡å·ã€‚\n3. æœ€åä¸€ä¸ªçº¿ç¨‹å¯¹å–æ¶ˆ(cancellation)è¯·æ±‚åšå‡ºå“åº”ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œâ€œå–æ¶ˆâ€ä»¥å»¶è¿Ÿæ–¹å¼å‘ç”Ÿï¼šä¸€ä¸ªçº¿ç¨‹è¦æ±‚å–æ¶ˆå¦ä¸€ä¸ªçº¿ç¨‹ï¼Œè‹¥å¹²æ—¶é—´ä¹‹åï¼Œç›®æ ‡çº¿ç¨‹ç»ˆæ­¢ã€‚\n\n## æ€»ç»“\n\nä¸ç®¡è¿›ç¨‹å¦‚ä½•ç»ˆæ­¢ï¼Œæœ€åéƒ½ä¼šæ‰§è¡Œå†…æ ¸ä¸­çš„åŒä¸€æ®µä»£ç ã€‚è¿™æ®µä»£ç ä¸ºç›¸åº”è¿›ç¨‹å…³é—­æ‰€æœ‰æ‰“å¼€æè¿°ç¬¦ï¼Œé‡Šæ”¾å®ƒæ‰€ä½¿ç”¨çš„å­˜å‚¨å™¨ç­‰ã€‚\n\nå¯¹ä¸Šè¿°ä»»æ„ä¸€ç§ç»ˆæ­¢æƒ…å½¢ï¼Œæˆ‘ä»¬éƒ½å¸Œæœ›ç»ˆæ­¢è¿›ç¨‹èƒ½å¤Ÿé€šçŸ¥å…¶çˆ¶è¿›ç¨‹å®ƒæ˜¯å¦‚ä½•ç»ˆæ­¢çš„ã€‚å¯¹äº3ä¸ªç»ˆæ­¢å‡½æ•°(`exit`ã€`_exit`å’Œ`_Exit`)ï¼Œå®ç°è¿™ä¸€ç‚¹çš„æ–¹æ³•æ˜¯å°†å…¶é€€å‡ºçŠ¶æ€(`exit status`)ä½œä¸ºå‚æ•°ä¼ é€ç»™å‡½æ•°ã€‚åœ¨å¼‚å¸¸ç»ˆæ­¢æƒ…å†µï¼Œå†…æ ¸(ä¸æ˜¯è¿›ç¨‹æœ¬èº«)äº§ç”Ÿä¸€ä¸ªæŒ‡ç¤ºå…¶å¼‚å¸¸ç»ˆæ­¢åŸå› çš„ç»ˆæ­¢çŠ¶æ€(`termination status`)ã€‚åœ¨ä»»æ„ä¸€ç§æƒ…å†µä¸‹ï¼Œè¯¥ç»ˆæ­¢è¿›ç¨‹çš„çˆ¶è¿›ç¨‹éƒ½èƒ½ç”¨`wait`æˆ–`waitpid`å‡½æ•°å–å¾—å…¶ç»ˆæ­¢çŠ¶æ€ã€‚\n\næ³¨æ„ï¼Œè¿™é‡Œä½¿ç”¨äº†â€œ**é€€å‡ºçŠ¶æ€**â€(å®ƒæ˜¯ä¼ é€’ç»™å‘3ä¸ªç»ˆæ­¢å‡½æ•°çš„å‚æ•°ï¼Œæˆ–`main`çš„è¿”å›å€¼)å’Œâ€œ**ç»ˆæ­¢çŠ¶æ€**â€ä¸¤ä¸ªæœ¯è¯­ï¼Œä»¥è¡¨ç¤ºæœ‰æ‰€åŒºåˆ«ã€‚åœ¨æœ€åè°ƒç”¨`_exit`æ—¶ï¼Œå†…æ ¸å°†é€€å‡ºçŠ¶æ€è½¬æ¢æˆç»ˆæ­¢çŠ¶æ€ã€‚\n\nçˆ¶è¿›ç¨‹æ£€æŸ¥å­è¿›ç¨‹ç»ˆæ­¢çŠ¶æ€çš„æ–¹æ³•æœ‰å¾ˆå¤šã€‚å¦‚æœå­è¿›ç¨‹æ­£å¸¸ç»ˆæ­¢ï¼Œåˆ™çˆ¶è¿›ç¨‹å¯ä»¥è·å¾—å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ã€‚\n\n# çˆ¶å­è¿›ç¨‹ç»ˆæ­¢é—®é¢˜\n\n## å­¤å„¿è¿›ç¨‹\n\nåœ¨è¯´æ˜`fork`å‡½æ•°æ—¶ï¼Œæ˜¾è€Œæ˜“è§ï¼Œå­è¿›ç¨‹æ˜¯åœ¨çˆ¶è¿›ç¨‹è°ƒç”¨forkåç”Ÿæˆçš„ã€‚ä¸Šé¢åˆè¯´æ˜äº†å­è¿›ç¨‹å°†å…¶ç»ˆæ­¢çŠ¶æ€è¿”å›ç»™çˆ¶è¿›ç¨‹ã€‚ä½†æ˜¯å¦‚æœçˆ¶è¿›ç¨‹åœ¨å­è¿›ç¨‹ä¹‹å‰ç»ˆæ­¢ï¼Œåˆå°†å¦‚ä½•å‘¢ï¼Ÿå…¶å›ç­”æ˜¯ï¼š\n\nå¦‚æœæŸè¿›ç¨‹çš„çˆ¶è¿›ç¨‹å·²ç»ç»ˆæ­¢ï¼Œå®ƒä»¬çš„çˆ¶è¿›ç¨‹éƒ½æ”¹å˜ä¸º`init`è¿›ç¨‹ã€‚æˆ‘ä»¬ç§°è¿™äº›è¿›ç¨‹ç”±`init`è¿›ç¨‹æ”¶å…»ã€‚å…¶æ“ä½œè¿‡ç¨‹å¤§è‡´æ˜¯ï¼šåœ¨ä¸€ä¸ªè¿›ç¨‹ç»ˆæ­¢æ—¶ï¼Œå†…æ ¸é€ä¸ªæ£€æŸ¥æ‰€æœ‰æ´»åŠ¨è¿›ç¨‹ï¼Œä»¥åˆ¤æ–­å®ƒæ˜¯å¦æ˜¯æ­£è¦ç»ˆæ­¢è¿›ç¨‹çš„å­è¿›ç¨‹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ›´æ”¹è¯¥è¿›ç¨‹çš„çˆ¶è¿›ç¨‹IDä¸º1 (`init`è¿›ç¨‹çš„ID)ã€‚è¿™ç§å¤„ç†æ–¹æ³•ä¿è¯äº†æ¯ä¸ªè¿›ç¨‹æœ‰ä¸€ä¸ªçˆ¶è¿›ç¨‹ã€‚\n\n## åƒµæ­»è¿›ç¨‹\n\nå¦ä¸€ä¸ªæˆ‘ä»¬å…³å¿ƒçš„æƒ…å†µæ˜¯ï¼Œå¦‚æœå­è¿›ç¨‹åœ¨çˆ¶è¿›ç¨‹ä¹‹å‰ç»ˆæ­¢ï¼Œé‚£ä¹ˆçˆ¶è¿›ç¨‹åˆå¦‚ä½•èƒ½åœ¨åšç›¸åº”æ£€æŸ¥æ—¶å¾—åˆ°å­è¿›ç¨‹çš„ç»ˆæ­¢çŠ¶æ€å‘¢ï¼Ÿå¦‚æœå­è¿›ç¨‹å®Œå…¨æ¶ˆå¤±äº†ï¼Œçˆ¶è¿›ç¨‹åœ¨æœ€ç»ˆå‡†å¤‡å¥½æ£€æŸ¥å­è¿›ç¨‹æ˜¯å¦ç»ˆæ­¢æ—¶æ˜¯æ— æ³•è·å–å®ƒçš„ç»ˆæ­¢çŠ¶æ€çš„ã€‚å†…æ ¸ä¸ºæ¯ä¸ªç»ˆæ­¢å­è¿›ç¨‹ä¿å­˜äº†ä¸€å®šé‡çš„ä¿¡æ¯ï¼Œæ‰€ä»¥å½“ç»ˆæ­¢è¿›ç¨‹çš„çˆ¶è¿›ç¨‹è°ƒç”¨`wait`æˆ–`waitpid`æ—¶å¯ä»¥å¾—åˆ°è¿™äº›ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯è‡³å°‘åŒ…æ‹¬è¿›ç¨‹IDã€è¯¥è¿›ç¨‹çš„ç»ˆæ­¢çŠ¶æ€ä»¥åŠè¯¥è¿›ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´æ€»é‡ã€‚\n\nå†…æ ¸å¯ä»¥é‡Šæ”¾ç»ˆæ­¢è¿›ç¨‹æ‰€ä½¿ç”¨çš„æ‰€æœ‰å­˜å‚¨åŒºï¼Œå…³é—­å…¶æ‰€æœ‰æ‰“å¼€æ–‡ä»¶ã€‚åœ¨UNIXæœ¯è¯­ä¸­ï¼Œä¸€ä¸ªå·²ç»ç»ˆæ­¢ã€ä½†æ˜¯å…¶çˆ¶è¿›ç¨‹å°šæœªå¯¹å…¶è¿›è¡Œå–„åå¤„ç†(è·å–ç»ˆæ­¢å­è¿›ç¨‹çš„æœ‰å…³ä¿¡æ¯ã€é‡Šæ”¾å®ƒä»å ç”¨çš„èµ„æº)çš„è¿›ç¨‹è¢«ç§°ä¸º**åƒµæ­»è¿›ç¨‹(zombie)**ã€‚`ps(1)`å‘½ä»¤å°†åƒµæ­»è¿›ç¨‹çš„çŠ¶æ€æ‰“å°ä¸º`Z`ã€‚å¦‚æœç¼–å†™ä¸€ä¸ªé•¿æœŸè¿è¡Œçš„ç¨‹åºï¼Œå®ƒforkäº†å¾ˆå¤šå­è¿›ç¨‹ï¼Œé‚£ä¹ˆé™¤éçˆ¶è¿›ç¨‹ç­‰å¾…å–å¾—å­è¿›ç¨‹çš„ç»ˆæ­¢çŠ¶æ€ï¼Œä¸ç„¶è¿™äº›å­è¿›ç¨‹ç»ˆæ­¢åå°±ä¼šå˜æˆåƒµæ­»è¿›ç¨‹ã€‚\n\n> æœ€åä¸€ä¸ªè¦è€ƒè™‘çš„é—®é¢˜æ˜¯ï¼šä¸€ä¸ªç”±`init`è¿›ç¨‹æ”¶å…»çš„è¿›ç¨‹ç»ˆæ­¢æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿå®ƒä¼šä¸ä¼šå˜æˆä¸€ä¸ªåƒµæ­»è¿›ç¨‹ï¼Ÿ\n>\n> å¯¹æ­¤é—®é¢˜çš„å›ç­”æ˜¯â€œå¦â€ï¼Œå› ä¸º`init`è¢«ç¼–å†™æˆæ— è®ºä½•æ—¶åªè¦æœ‰ä¸€ä¸ªå­è¿›ç¨‹ç»ˆæ­¢ï¼Œinitå°±ä¼šè°ƒç”¨ä¸€ä¸ª`wait`å‡½æ•°å–å¾—å…¶ç»ˆæ­¢çŠ¶æ€ã€‚è¿™æ ·ä¹Ÿå°±é˜²æ­¢äº†åœ¨ç³»ç»Ÿä¸­å¡æ»¡åƒµæ­»è¿›ç¨‹ã€‚\n>\n> å½“æåŠâ€œä¸€ä¸ª`init`çš„å­è¿›ç¨‹â€æ—¶ï¼Œè¿™æŒ‡çš„å¯èƒ½æ˜¯`init`ç›´æ¥äº§ç”Ÿçš„è¿›ç¨‹ï¼ˆå¦‚gettyè¿›ç¨‹ï¼‰ï¼Œä¹Ÿå¯èƒ½æ˜¯å…¶çˆ¶è¿›ç¨‹å·²ç»ˆæ­¢ï¼Œç”±`init`æ”¶å…»çš„è¿›ç¨‹ã€‚\n\n# é€€å‡ºå‡½æ•°\n\n3ä¸ªå‡½æ•°ç”¨äºæ­£å¸¸ç»ˆæ­¢ä¸€ä¸ªç¨‹åºï¼š`_exit`å’Œ`_Exit`ç«‹å³è¿›å…¥å†…æ ¸ï¼Œ`exit`åˆ™å…ˆæ‰§è¡Œä¸€äº›æ¸…ç†å¤„ç†ï¼Œç„¶åè¿”å›å†…æ ¸ã€‚\n\n```c\n#include<stdlib.h>\nvoid exit(int status);\nvoid _Exit(int status);\n#include<unistd.h>\nvoid _exit(int status);\n```\n\nè°ƒç”¨è¿™ä¸‰ä¸ªå‡½æ•°çš„è¿›ç¨‹å¯¹å…¶ä»–è¿›ç¨‹æœ‰ä¸€å®šå½±å“ï¼ˆå¦‚å…¶çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ï¼‰ã€‚\n\n> ä½¿ç”¨ä¸åŒå¤´æ–‡ä»¶çš„åŸå› æ˜¯`exit`å’Œ`_Exit`æ˜¯ç”±`ISO C`è¯´æ˜çš„ï¼Œè€Œ`_exit`æ˜¯ç”±`POSIX.1`è¯´æ˜çš„ã€‚\n\nç”±äºå†å²åŸå› ï¼Œ`exit`å‡½æ•°æ€»æ˜¯æ‰§è¡Œä¸€ä¸ªæ ‡å‡†I/Oåº“çš„æ¸…ç†å…³é—­æ“ä½œï¼šå¯¹äºæ‰€æœ‰æ‰“å¼€æµè°ƒç”¨`fclose`å‡½æ•°ï¼Œè¿™é€ æˆè¾“å‡ºç¼“å†²ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½è¢«å†²æ´—ï¼ˆå†™åˆ°æ–‡ä»¶ä¸Šï¼‰ã€‚\n\n3ä¸ªé€€å‡ºå‡½æ•°éƒ½å¸¦ä¸€ä¸ªæ•´å‹å‚æ•°ï¼Œç§°ä¸º**ç»ˆæ­¢çŠ¶æ€**ï¼ˆæˆ–é€€å‡ºçŠ¶æ€ï¼Œ`exit status`)ã€‚å¤§å¤šæ•°UNIXç³»ç»Ÿshelléƒ½æä¾›æ£€æŸ¥è¿›ç¨‹ç»ˆæ­¢çŠ¶æ€çš„æ–¹æ³•ã€‚å¦‚æœ(a)è°ƒç”¨è¿™äº›å‡½æ•°æ—¶ä¸å¸¦ç»ˆæ­¢çŠ¶æ€ï¼Œæˆ–`(b)main`æ‰§è¡Œäº†ä¸€ä¸ªæ— è¿”å›å€¼çš„`return`è¯­å¥ï¼Œæˆ–`(c)main`æ²¡æœ‰å£°æ˜è¿”å›ç±»å‹ä¸ºæ•´å‹ï¼Œåˆ™è¯¥è¿›ç¨‹çš„ç»ˆæ­¢çŠ¶æ€æ˜¯æœªå®šä¹‰çš„ã€‚ä½†æ˜¯ï¼Œè‹¥mainçš„è¿”å›ç±»å‹æ˜¯æ•´å‹ï¼Œå¹¶ä¸”mainæ‰§è¡Œåˆ°æœ€åä¸€æ¡è¯­å¥æ—¶è¿”å›ï¼ˆéšå¼è¿”å›ï¼‰ï¼Œé‚£ä¹ˆè¯¥è¿›ç¨‹çš„ç»ˆæ­¢çŠ¶æ€æ˜¯0ã€‚\n\n> è¿™ç§å¤„ç†æ˜¯ISO Cæ ‡å‡†1999ç‰ˆå¼•å…¥çš„ã€‚å†å²ä¸Šï¼Œè‹¥mainå‡½æ•°ç»ˆæ­¢æ—¶æ²¡æœ‰æ˜¾å¼ä½¿ç”¨returnè¯­å¥æˆ–è°ƒç”¨exitå‡½æ•°ï¼Œé‚£ä¹ˆè¿›ç¨‹ç»ˆæ­¢çŠ¶æ€æ˜¯æœªå®šä¹‰çš„ã€‚\n>\n> æ¯”å¦‚ä»¥ä¸‹ç¨‹åºï¼š\n> ```c\n> #include<stdio.h>\n> main()\n> {\n>     printf(\"hello, world!\\n\");\n> }\n> ```\n>\n> å¯¹è¯¥ç¨‹åºè¿›è¡Œç¼–è¯‘ï¼Œç„¶åè¿è¡Œï¼Œåˆ™å¯è§åˆ°å…¶ç»ˆæ­¢ç æ˜¯éšæœºçš„ã€‚å¦‚æœåœ¨ä¸åŒçš„ç³»ç»Ÿä¸Šç¼–è¯‘è¯¥ç¨‹åºï¼Œæˆ‘ä»¬å¾ˆå¯èƒ½å¾—åˆ°ä¸åŒçš„ç»ˆæ­¢ç ï¼Œè¿™**å–å†³äºmainå‡½æ•°è¿”å›æ—¶æ ˆå’Œå¯„å­˜å™¨çš„å†…å®¹**\n>\n> ```bash\n> $ gcc hello.c\n> $ ./a.out\n> hello,world\n> $ echo $?\t# $? ä¸ºç»ˆæ­¢çŠ¶æ€ç \n> 13\n> ```\n>\n> ç°åœ¨ï¼Œæˆ‘ä»¬å¯ç”¨1999 ISO Cç¼–è¯‘å™¨æ‰©å±•ï¼Œåˆ™å¯è§åˆ°ç»ˆæ­¢ç æ”¹å˜äº†ï¼š\n>\n> ```bash\n> $ gcc -std=c99 hello.c\t# å¯ç”¨gccçš„1999 ISO Cæ‰©å±•\n> hello.c:4: warning: return type defaults to 'int'\n> $ ./a.out\n> hello,world\n> $ echo $?\t# $? ä¸ºç»ˆæ­¢çŠ¶æ€ç \n> 0\t\t\t# æ­¤å¤„å¤„ç†ä¸º0\n> ```\n\nmainå‡½æ•°è¿”å›ä¸€ä¸ªæ•´å‹å€¼ä¸ç”¨è¯¥å€¼è°ƒç”¨`exit`æ˜¯ç­‰ä»·çš„ã€‚äºæ˜¯åœ¨mainå‡½æ•°ä¸­`exit(0);`ç­‰ä»·äº`return(0);`ã€‚\n\n# wait\n\nå½“ä¸€ä¸ªè¿›ç¨‹æ­£å¸¸æˆ–å¼‚å¸¸ç»ˆæ­¢æ—¶ï¼Œå†…æ ¸å°±å‘å…¶çˆ¶è¿›ç¨‹å‘é€`SIGCHLD`ä¿¡å·ã€‚å› ä¸ºå­è¿›ç¨‹ç»ˆæ­¢æ˜¯ä¸ªå¼‚æ­¥äº‹ä»¶(è¿™å¯ä»¥åœ¨çˆ¶è¿›ç¨‹è¿è¡Œçš„ä»»ä½•æ—¶å€™å‘ç”Ÿ)ï¼Œæ‰€ä»¥è¿™ç§ä¿¡å·ä¹Ÿæ˜¯å†…æ ¸å‘çˆ¶è¿›ç¨‹å‘çš„å¼‚æ­¥é€šçŸ¥ã€‚\n\nçˆ¶è¿›ç¨‹å¯ä»¥é€‰æ‹©å¿½ç•¥è¯¥ä¿¡å·ï¼Œæˆ–è€…æä¾›ä¸€ä¸ªè¯¥ä¿¡å·å‘ç”Ÿæ—¶å³è¢«è°ƒç”¨æ‰§è¡Œçš„å‡½æ•°(ä¿¡å·å¤„ç†ç¨‹åº)ã€‚å¯¹äºè¿™ç§ä¿¡å·çš„ç³»ç»Ÿé»˜è®¤åŠ¨ä½œæ˜¯å¿½ç•¥å®ƒã€‚\n\nç°åœ¨éœ€è¦çŸ¥é“çš„æ˜¯è°ƒç”¨`wait`æˆ–`waitpid`çš„è¿›ç¨‹å¯èƒ½ä¼šå‘ç”Ÿä»€ä¹ˆã€‚\n\n* å¦‚æœå…¶æ‰€æœ‰å­è¿›ç¨‹éƒ½è¿˜åœ¨è¿è¡Œï¼Œåˆ™é˜»å¡ã€‚\n* å¦‚æœ**ä¸€ä¸ª**å­è¿›ç¨‹å·²ç»ˆæ­¢ï¼Œæ­£ç­‰å¾…çˆ¶è¿›ç¨‹è·å–å…¶ç»ˆæ­¢çŠ¶æ€ï¼Œåˆ™å–å¾—è¯¥å­è¿›ç¨‹çš„ç»ˆæ­¢çŠ¶æ€ç«‹å³è¿”å›ã€‚\n* å¦‚æœå®ƒæ²¡æœ‰ä»»ä½•å­è¿›ç¨‹ï¼Œåˆ™ç«‹å³å‡ºé”™è¿”å›ã€‚\n\nå¦‚æœè¿›ç¨‹ç”±äºæ¥æ”¶åˆ°`SIGCHLD`ä¿¡å·è€Œè°ƒç”¨`wait`ï¼Œ æˆ‘ä»¬æœŸæœ›`wait`ä¼šç«‹å³è¿”å›ã€‚ä½†æ˜¯å¦‚æœåœ¨éšæœºæ—¶é—´ç‚¹è°ƒç”¨`wait`ï¼Œ åˆ™è¿›ç¨‹å¯èƒ½ä¼šé˜»å¡ã€‚\n\n## api\n\n```c\n#include<sys/wait.h>\npid_t wait(int * statloc);\npid_t waitpid(pid_t pid, int * statloc, int options);\n//ä¸¤ä¸ªå‡½æ•°è¿”å›å€¼ï¼šè‹¥æˆåŠŸï¼Œè¿”å›è¿›ç¨‹IDï¼›è‹¥å‡ºé”™ï¼Œè¿”å›0æˆ–-1\n```\n\nè¿™ä¸¤ä¸ªå‡½æ•°çš„åŒºåˆ«å¦‚ä¸‹ã€‚\n\n* åœ¨ä¸€ä¸ªå­è¿›ç¨‹ç»ˆæ­¢å‰ï¼Œ`wait`ä½¿å…¶è°ƒç”¨è€…é˜»å¡ï¼›è€Œ`waitpid`æœ‰ä¸€é€‰é¡¹ï¼Œå¯ä½¿è°ƒç”¨è€…ä¸é˜»å¡ã€‚\n* `waitpid`å¹¶ä¸ç­‰å¾…åœ¨å…¶è°ƒç”¨ä¹‹åçš„ç¬¬ä¸€ä¸ªç»ˆæ­¢å­è¿›ç¨‹ï¼Œå®ƒæœ‰è‹¥å¹²ä¸ªé€‰é¡¹ï¼Œå¯ä»¥æ§åˆ¶å®ƒæ‰€ç­‰å¾…çš„è¿›ç¨‹ã€‚\n\nå¦‚æœå­è¿›ç¨‹å·²ç»ç»ˆæ­¢ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªåƒµæ­»è¿›ç¨‹ï¼Œåˆ™`wait`ç«‹å³è¿”å›å¹¶å–å¾—è¯¥å­è¿›ç¨‹çš„çŠ¶æ€ï¼›å¦åˆ™`wait`ä½¿å…¶è°ƒç”¨è€…é˜»å¡ï¼Œç›´åˆ°ä¸€ä¸ªå­è¿›ç¨‹ç»ˆæ­¢ã€‚å¦‚è°ƒç”¨è€…é˜»å¡è€Œä¸”å®ƒæœ‰å¤šä¸ªå­è¿›ç¨‹ï¼Œåˆ™åœ¨å…¶æŸä¸€å­è¿›ç¨‹ç»ˆæ­¢æ—¶ï¼Œ`wait`å°±ç«‹å³è¿”å›ã€‚å› ä¸º`wait`è¿”å›ç»ˆæ­¢å­è¿›ç¨‹çš„è¿›ç¨‹IDï¼Œæ‰€ä»¥å®ƒæ€»èƒ½äº†è§£æ˜¯å“ªä¸€ä¸ªå­è¿›ç¨‹ç»ˆæ­¢äº†ã€‚\n\nè¿™ä¸¤ä¸ªå‡½æ•°çš„å‚æ•°`statloc`æ˜¯ä¸€ä¸ªæ•´å‹æŒ‡é’ˆã€‚å¦‚æœ`statloc`ä¸æ˜¯ä¸€ä¸ªç©ºæŒ‡é’ˆï¼Œåˆ™ç»ˆæ­¢è¿›ç¨‹çš„**ç»ˆæ­¢çŠ¶æ€å°±å­˜æ”¾åœ¨å®ƒæ‰€æŒ‡å‘çš„å•å…ƒ**å†…ã€‚å¦‚æœä¸å…³å¿ƒç»ˆæ­¢çŠ¶æ€ï¼Œåˆ™å¯å°†è¯¥å‚æ•°æŒ‡å®šä¸ºç©ºæŒ‡é’ˆã€‚\n\nä¾æ®ä¼ ç»Ÿï¼Œè¿™ä¸¤ä¸ªå‡½æ•°è¿”å›çš„æ•´å‹çŠ¶æ€å­—æ˜¯ç”±å®ç°å®šä¹‰çš„ã€‚å…¶ä¸­æŸäº›ä½è¡¨ç¤ºé€€å‡ºçŠ¶æ€ï¼ˆæ­£å¸¸è¿”å›ï¼‰ï¼Œå…¶ä»–ä½åˆ™æŒ‡ç¤ºä¿¡å·ç¼–å·ï¼ˆå¼‚å¸¸è¿”å›ï¼‰ï¼Œæœ‰ä¸€ä½æŒ‡ç¤ºæ˜¯å¦äº§ç”Ÿäº†`core`æ–‡ä»¶ç­‰ã€‚`POSIX.1`è§„å®šï¼Œç»ˆæ­¢çŠ¶æ€ç”¨å®šä¹‰åœ¨`<sys/wait.h>`ä¸­çš„å„ä¸ªå®æ¥æŸ¥çœ‹ã€‚æœ‰4ä¸ªäº’æ–¥çš„å®å¯ç”¨æ¥å–å¾—è¿›ç¨‹ç»ˆæ­¢çš„åŸå› ï¼Œå®ƒä»¬çš„åå­—éƒ½ä»¥`WIF`å¼€å§‹ã€‚åŸºäºè¿™4ä¸ªå®ä¸­å“ªä¸€ä¸ªå€¼ä¸ºçœŸï¼Œå°±å¯é€‰ç”¨å…¶ä»–å®æ¥å–å¾—é€€å‡ºçŠ¶æ€ã€ä¿¡å·ç¼–å·ç­‰ã€‚\n\n![image-20220515100404070](../../images/Linux_exit/image-20220515100404070.png)\n\næ­£å¦‚å‰é¢æ‰€è¿°ï¼Œå¦‚æœä¸€ä¸ªè¿›ç¨‹æœ‰å‡ ä¸ªå­è¿›ç¨‹ï¼Œé‚£ä¹ˆåªè¦æœ‰ä¸€ä¸ªå­è¿›ç¨‹ç»ˆæ­¢ï¼Œwaitå°±è¿”å›ã€‚\n\nå¦‚æœè¦ç­‰å¾…ä¸€ä¸ªæŒ‡å®šçš„è¿›ç¨‹ç»ˆæ­¢ï¼ˆå¦‚æœçŸ¥é“è¦ç­‰å¾…è¿›ç¨‹çš„IDï¼‰ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•åšå‘¢ï¼Ÿåœ¨æ—©æœŸçš„UNIXç‰ˆæœ¬ä¸­ï¼Œå¿…é¡»è°ƒç”¨`wait`ï¼Œç„¶åå°†å…¶è¿”å›çš„è¿›ç¨‹IDå’Œæ‰€æœŸæœ›çš„è¿›ç¨‹IDç›¸æ¯”è¾ƒã€‚å¦‚æœç»ˆæ­¢è¿›ç¨‹ä¸æ˜¯æ‰€æœŸæœ›çš„ï¼Œåˆ™å°†è¯¥è¿›ç¨‹IDå’Œç»ˆæ­¢çŠ¶æ€ä¿å­˜èµ·æ¥ï¼Œç„¶åå†æ¬¡è°ƒç”¨`wait`ã€‚åå¤è¿™æ ·åšï¼Œç›´åˆ°æ‰€æœŸæœ›çš„è¿›ç¨‹ç»ˆæ­¢ã€‚ä¸‹ä¸€æ¬¡åˆæƒ³ç­‰å¾…ä¸€ä¸ªç‰¹å®šè¿›ç¨‹æ—¶ï¼Œå…ˆæŸ¥çœ‹å·²ç»ˆæ­¢çš„è¿›ç¨‹åˆ—è¡¨ï¼Œè‹¥å…¶ä¸­å·²æœ‰è¦ç­‰å¾…çš„è¿›ç¨‹ï¼Œåˆ™è·å–ç›¸å…³ä¿¡æ¯ï¼›å¦åˆ™è°ƒç”¨`wait`ã€‚å…¶å®ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯ç­‰å¾…ä¸€ä¸ªç‰¹å®šè¿›ç¨‹çš„å‡½æ•°ã€‚POSIXå®šä¹‰äº†`waitpid`å‡½æ•°ä»¥æä¾›è¿™ç§åŠŸèƒ½ï¼ˆä»¥åŠå…¶ä»–ä¸€äº›åŠŸèƒ½ï¼‰ã€‚\nå¯¹äº`waitpid`å‡½æ•°ä¸­`pid`å‚æ•°çš„ä½œç”¨è§£é‡Šå¦‚ä¸‹ã€‚\n\n| å‚æ•°å€¼    | ä½œç”¨                                                |\n| --------- | --------------------------------------------------- |\n| `pid==-1` | ç­‰å¾…ä»»ä¸€å­è¿›ç¨‹ã€‚æ­¤ç§æƒ…å†µä¸‹ï¼Œ`waitpid`ä¸`wait`ç­‰æ•ˆã€‚ |\n| `pid>0`   | ç­‰å¾…è¿›ç¨‹IDä¸pidç›¸ç­‰çš„å­è¿›ç¨‹ã€‚                       |\n| `pid==0`  | ç­‰å¾…**ç»„ID**ç­‰äºè°ƒç”¨è¿›ç¨‹ç»„IDçš„ä»»ä¸€å­è¿›ç¨‹ã€‚          |\n| `pid<-1`  | ç­‰å¾…**ç»„ID**ç­‰äºpidç»å¯¹å€¼çš„ä»»ä¸€å­è¿›ç¨‹ã€‚             |\n\n`waitpid`å‡½æ•°è¿”å›ç»ˆæ­¢å­è¿›ç¨‹çš„è¿›ç¨‹IDï¼Œå¹¶å°†è¯¥å­è¿›ç¨‹çš„ç»ˆæ­¢çŠ¶æ€å­˜æ”¾åœ¨ç”±`statloc`æŒ‡å‘çš„å­˜å‚¨å•å…ƒä¸­ã€‚\n\nå¯¹äº`wait`ï¼Œå…¶å”¯ä¸€çš„å‡ºé”™æ˜¯è°ƒç”¨è¿›ç¨‹æ²¡æœ‰å­è¿›ç¨‹ï¼ˆå‡½æ•°è°ƒç”¨è¢«ä¸€ä¸ªä¿¡å·ä¸­æ–­æ—¶ï¼Œä¹Ÿå¯èƒ½è¿”å›å¦ä¸€ç§å‡ºé”™ï¼‰ã€‚ä½†æ˜¯å¯¹äº`waitpid`ï¼Œå¦‚æœæŒ‡å®šçš„è¿›ç¨‹æˆ–è¿›ç¨‹ç»„ä¸å­˜åœ¨ï¼Œæˆ–è€…å‚æ•°`pid`æŒ‡å®šçš„è¿›ç¨‹ä¸æ˜¯è°ƒç”¨è¿›ç¨‹çš„å­è¿›ç¨‹ï¼Œéƒ½å¯èƒ½å‡ºé”™ã€‚\n\noptionså‚æ•°ä½¿æˆ‘ä»¬èƒ½è¿›ä¸€æ­¥æ§åˆ¶`waitpid`çš„æ“ä½œã€‚æ­¤å‚æ•°æˆ–è€…æ˜¯0ï¼Œæˆ–è€…æ˜¯ä¸‹è¡¨ä¸­å¸¸é‡æŒ‰ä½æˆ–è¿ç®—çš„ç»“æœã€‚\n\n![image-20220515101143654](../../images/Linux_exit/image-20220515101143654.png)\n\nwaitpidå‡½æ•°æä¾›äº†waitå‡½æ•°æ²¡æœ‰æä¾›çš„3ä¸ªåŠŸèƒ½ã€‚\n\n1. `waitpid`å¯ç­‰å¾…ä¸€ä¸ªç‰¹å®šçš„è¿›ç¨‹ï¼›è€Œ`wait`åˆ™è¿”å›ä»»ä¸€ç»ˆæ­¢å­è¿›ç¨‹çš„çŠ¶æ€ã€‚åœ¨è®¨è®º`popen`å‡½æ•°æ—¶ä¼šå†è¯´æ˜è¿™ä¸€åŠŸèƒ½ã€‚\n2. `waitpid`æä¾›äº†ä¸€ä¸ª`wait`çš„éé˜»å¡ç‰ˆæœ¬ã€‚æœ‰æ—¶å¸Œæœ›è·å–ä¸€ä¸ªå­è¿›ç¨‹çš„çŠ¶æ€ï¼Œä½†ä¸æƒ³é˜»å¡ã€‚\n3. `waitpid`é€šè¿‡`WUNTRACED`å’Œ`WCONTINUED`é€‰é¡¹æ”¯æŒä½œä¸šæ§åˆ¶ã€‚\n\n# é¿å…åƒµæ­»è¿›ç¨‹çš„æ–¹æ³•\n\nå›å¿†æœ‰å…³åƒµæ­»è¿›ç¨‹çš„è®¨è®ºã€‚å¦‚æœä¸€ä¸ªè¿›ç¨‹forkä¸€ä¸ªå­è¿›ç¨‹ï¼Œä½†ä¸è¦å®ƒç­‰å¾…å­è¿›ç¨‹ç»ˆæ­¢ï¼Œä¹Ÿä¸å¸Œæœ›å­è¿›ç¨‹å¤„äºåƒµæ­»çŠ¶æ€ç›´åˆ°çˆ¶è¿›ç¨‹ç»ˆæ­¢ï¼Œå®ç°è¿™ä¸€è¦æ±‚çš„è¯€çªæ˜¯è°ƒç”¨forkä¸¤æ¬¡ã€‚\n\n```c\n#include<sys/wait.h>\nint main(void)\n{\n    pid_t pid;\n    if((pid = fork()) < 0)\n    {\n        err_sys(\"fork error\");\n    }\n    else if(pid == 0)\t//ç¬¬ä¸€ä¸ªå­è¿›ç¨‹\n    {\n        if((pid = fork()) < 0)\t//å­è¿›ç¨‹å†æ¬¡fork\n        {\n            err_sys(\"fork error\");\n        }\n        else if(pid > 0)\t\t//å­è¿›ç¨‹é€€å‡º\n        {\n            exit(0);\n        }\n        sleep(2);\n        printf(\"child's child, parent pid = %ld\\n\", (long)getppid());\n        exit(0);\n    }\n    if(waitpid(pid, NULL, 0) != pid)\n    {\n        err_sys(\"waitpid error\");\n    }\n    exit(0);\n}\n```\n\nåœ¨forkä¹‹åï¼Œå¦‚æœä¸ä½¿ç¬¬äºŒä¸ªå­è¿›ç¨‹ä¼‘çœ ï¼Œé‚£ä¹ˆå®ƒå¯èƒ½æ¯”å…¶çˆ¶è¿›ç¨‹å…ˆæ‰§è¡Œï¼Œäºæ˜¯å®ƒæ‰“å°çš„çˆ¶è¿›ç¨‹IDå°†æ˜¯åˆ›å»ºå®ƒçš„çˆ¶è¿›ç¨‹ï¼Œè€Œä¸æ˜¯`init`è¿›ç¨‹ï¼ˆè¿›ç¨‹ID 1ï¼‰ã€‚ç¬¬äºŒä¸ªå­è¿›ç¨‹è°ƒç”¨sleepä»¥ä¿è¯åœ¨æ‰“å°çˆ¶è¿›ç¨‹IDæ—¶ç¬¬ä¸€ä¸ªå­è¿›ç¨‹å·²ç»ˆæ­¢ã€‚\n\næ‰§è¡Œç¨‹åºå¾—åˆ°ï¼š\n\n```\n$ ./a.out\n$ child's child, parent pid = 1\n```\n\næ³¨æ„ï¼Œå½“åŸå…ˆçš„è¿›ç¨‹ï¼ˆä¹Ÿå°±æ˜¯execæœ¬ç¨‹åºçš„è¿›ç¨‹ï¼‰ç»ˆæ­¢æ—¶ï¼Œshellæ‰“å°å…¶æç¤ºç¬¦ï¼Œè¿™åœ¨ç¬¬äºŒä¸ªå­è¿›ç¨‹æ‰“å°å…¶çˆ¶è¿›ç¨‹IDä¹‹å‰ã€‚\n\n# ç«äº‰æ¡ä»¶\n\nå½“å¤šä¸ªè¿›ç¨‹éƒ½ä¼å›¾å¯¹å…±äº«æ•°æ®è¿›è¡ŒæŸç§å¤„ç†ï¼Œè€Œæœ€åçš„ç»“æœåˆå–å†³äºè¿›ç¨‹è¿è¡Œçš„é¡ºåºæ—¶ï¼Œæˆ‘ä»¬è®¤ä¸ºå‘ç”Ÿäº†**ç«äº‰æ¡ä»¶(race condition)**ã€‚å¦‚æœåœ¨forkä¹‹åçš„æŸç§é€»è¾‘æ˜¾å¼æˆ–éšå¼åœ°ä¾èµ–äºåœ¨forkä¹‹åæ˜¯çˆ¶è¿›ç¨‹å…ˆè¿è¡Œè¿˜æ˜¯å­è¿›ç¨‹å…ˆè¿è¡Œï¼Œé‚£ä¹ˆforkå‡½æ•°å°±ä¼šæ˜¯ç«äº‰æ¡ä»¶æ´»è·ƒçš„æ»‹ç”Ÿåœ°ã€‚\n\né€šå¸¸ï¼Œæˆ‘ä»¬ä¸èƒ½é¢„æ–™å“ªä¸€ä¸ªè¿›ç¨‹å…ˆè¿è¡Œã€‚å³ä½¿æˆ‘ä»¬çŸ¥é“å“ªä¸€ä¸ªè¿›ç¨‹å…ˆè¿è¡Œï¼Œåœ¨è¯¥è¿›ç¨‹å¼€å§‹è¿è¡Œåæ‰€å‘ç”Ÿçš„äº‹æƒ…ä¹Ÿä¾èµ–äºç³»ç»Ÿè´Ÿè½½ä»¥åŠå†…æ ¸çš„è°ƒåº¦ç®—æ³•ã€‚\n\nåœ¨ä¸Šä¸ªç¨‹åºä¸­ï¼Œå½“ç¬¬äºŒä¸ªå­è¿›ç¨‹æ‰“å°å…¶çˆ¶è¿›ç¨‹IDæ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸€ä¸ªæ½œåœ¨çš„ç«äº‰æ¡ä»¶ã€‚å¦‚æœç¬¬äºŒä¸ªå­è¿›ç¨‹åœ¨ç¬¬ä¸€ä¸ªå­è¿›ç¨‹ä¹‹å‰è¿è¡Œï¼Œåˆ™æœ€ç»ˆå…¶çˆ¶è¿›ç¨‹å°†ä¼šæ˜¯ç¬¬ä¸€ä¸ªå­è¿›ç¨‹ï¼Œåˆ™å°±ä¼šæˆä¸ºåƒµæ­»è¿›ç¨‹ã€‚ä½†æ˜¯ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå­è¿›ç¨‹å…ˆè¿è¡Œï¼Œå¹¶æœ‰è¶³å¤Ÿçš„æ—¶é—´åˆ°è¾¾å¹¶æ‰§è¡Œ`exit`ï¼ˆæœ€å…³é”®æ˜¯åœ¨ç¬¬äºŒä¸ªå­è¿›ç¨‹é€€å‡ºå‰ï¼Œç¬¬ä¸€ä¸ªå­è¿›ç¨‹é€€å‡ºï¼Œä½¿ç¬¬äºŒä¸ªå­è¿›ç¨‹å˜ä¸ºå­¤å„¿è¿›ç¨‹ï¼‰ï¼Œåˆ™ç¬¬äºŒä¸ªå­è¿›ç¨‹çš„çˆ¶è¿›ç¨‹å°±æ˜¯`init`ã€‚å³ä½¿åœ¨ç¨‹åºä¸­è°ƒç”¨`sleep`ï¼Œä¹Ÿä¸èƒ½ä¿è¯ä»€ä¹ˆã€‚å¦‚æœç³»ç»Ÿè´Ÿè½½å¾ˆé‡ï¼Œé‚£ä¹ˆåœ¨`sleep`è¿”å›ä¹‹åã€ç¬¬ä¸€ä¸ªå­è¿›ç¨‹å¾—åˆ°æœºä¼šè¿è¡Œä¹‹å‰ï¼Œç¬¬äºŒä¸ªå­è¿›ç¨‹å¯èƒ½æ¢å¤è¿è¡Œã€‚è¿™ç§å½¢å¼çš„é—®é¢˜å¾ˆéš¾è°ƒè¯•ï¼Œå› ä¸ºåœ¨å¤§éƒ¨åˆ†æ—¶é—´ï¼Œè¿™ç§é—®é¢˜å¹¶ä¸å‡ºç°ã€‚\n\nå¦‚æœä¸€ä¸ªè¿›ç¨‹å¸Œæœ›ç­‰å¾…ä¸€ä¸ªå­è¿›ç¨‹ç»ˆæ­¢ï¼Œåˆ™å®ƒå¿…é¡»è°ƒç”¨`wait`å‡½æ•°ä¸­çš„ä¸€ä¸ªï¼›åè¿‡æ¥ï¼Œå¦‚æœä¸€ä¸ªè¿›ç¨‹è¦ç­‰å¾…å…¶çˆ¶è¿›ç¨‹ç»ˆæ­¢ï¼Œåˆ™å¯ä½¿ç”¨ä¸‹åˆ—å½¢å¼çš„å¾ªç¯ï¼š\n\n```c\nwhile(getppid()!=1)\n\tsleep(1)ï¼›\n```\n\nè¿™ç§å½¢å¼çš„å¾ªç¯ç§°ä¸ºè½®è¯¢(polling)ï¼Œå®ƒçš„é—®é¢˜æ˜¯æµªè´¹äº†CPUæ—¶é—´ï¼Œå› ä¸ºè°ƒç”¨è€…æ¯éš”1séƒ½è¢«å”¤é†’ï¼Œç„¶åè¿›è¡Œæ¡ä»¶æµ‹è¯•ã€‚\n\nä¸ºäº†é¿å…ç«äº‰æ¡ä»¶å’Œè½®è¯¢ï¼Œåœ¨å¤šä¸ªè¿›ç¨‹ä¹‹é—´éœ€è¦æœ‰æŸç§å½¢å¼çš„ä¿¡å·å‘é€å’Œæ¥æ”¶çš„æ–¹æ³•ã€‚åœ¨UNIXä¸­å¯ä»¥ä½¿ç”¨ä¿¡å·æœºåˆ¶ä½œä¸ºè§£å†³æ­¤æ–¹é¢é—®é¢˜çš„ä¸€ç§ç”¨æ³•ã€‚å„ç§å½¢å¼çš„è¿›ç¨‹é—´é€šä¿¡(IPC)ä¹Ÿå¯è§£å†³æ­¤é—®é¢˜ã€‚\n\nåœ¨çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹çš„å…³ç³»ä¸­ï¼Œå¸¸å¸¸å‡ºç°ä¸‹è¿°æƒ…å†µã€‚åœ¨forkä¹‹åï¼Œçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹éƒ½æœ‰ä¸€äº›äº‹æƒ…è¦åšã€‚ä¾‹å¦‚ï¼Œçˆ¶è¿›ç¨‹å¯èƒ½è¦ç”¨å­è¿›ç¨‹IDæ›´æ–°æ—¥å¿—æ–‡ä»¶ä¸­çš„ä¸€ä¸ªè®°å½•ï¼Œè€Œå­è¿›ç¨‹åˆ™å¯èƒ½è¦ä¸ºçˆ¶è¿›ç¨‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œè¦æ±‚æ¯ä¸ªè¿›ç¨‹åœ¨æ‰§è¡Œå®Œå®ƒçš„ä¸€å¥—åˆå§‹åŒ–æ“ä½œåè¦é€šçŸ¥å¯¹æ–¹ï¼Œå¹¶ä¸”åœ¨ç»§ç»­è¿è¡Œä¹‹å‰ï¼Œè¦ç­‰å¾…å¦ä¸€æ–¹å®Œæˆå…¶åˆå§‹åŒ–æ“ä½œã€‚è¿™ç§æƒ…å†µå¯ä»¥ç”¨ä»£ç æè¿°å¦‚ä¸‹ï¼š\n\n```c\n#include\"apue.h\"\nTELL_WAIT();\nif((pid = fork()) < 0)\n{\n    errsys(\"fork error\");\n}\nelse if(pid == 0)\n{\n    TELL_PARENT(getppid());\n    WAIT_PARENT();\n    exit(0);\n}\nTELL_CHILD(pid);\nWAIT_CHILD();\nexit(0);\n```\n\nå‡å®šåœ¨å¤´æ–‡ä»¶`apue.h`ä¸­å®šä¹‰äº†éœ€è¦ä½¿ç”¨çš„å„ä¸ªå˜é‡ã€‚\n\n5ä¸ªä¾‹ç¨‹`TELL_WAIT`ã€`TELL_PARENT`ã€`TELL_CHILD`ã€`WAIT_PARENT`ä»¥åŠ`WAIT_CHILD`å¯ä»¥æ˜¯å®ï¼Œä¹Ÿå¯ä»¥æ˜¯å‡½æ•°ã€‚\n\nå®ç°è¿™äº›TELLå’ŒWAITä¾‹ç¨‹çš„ä¸åŒæ–¹æ³•ï¼šä½¿ç”¨ä¿¡å·çš„ä¸€ç§å®ç°ï¼›ä½¿ç”¨ç®¡é“çš„ä¸€ç§å®ç°ã€‚\n\nä»¥ä¸‹ç¨‹åºï¼Œå­è¿›ç¨‹ã€çˆ¶è¿›ç¨‹åˆ†åˆ«è¾“å‡ºä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œå› ä¸ºè¾“å‡ºä¾èµ–äºå†…æ ¸ä½¿è¿™ä¸¤ä¸ªè¿›ç¨‹è¿è¡Œçš„é¡ºåºåŠæ¯ä¸ªè¿›ç¨‹è¿è¡Œçš„æ—¶é—´é•¿åº¦ï¼Œæ‰€ä»¥è¯¥ç¨‹åºåŒ…å«äº†ä¸€ä¸ªç«äº‰æ¡ä»¶ã€‚\n\n```c\n#include\"apue.h\"\nstatic void charatatime(char *);\nint main(void)\n{\n    pid_t pid;\n    if((pid = fork()) < 0)\n    {\n        err_sys(\"fork error\");\n    }\n    else if(pid == 0)\n    {\n        charatatime(\"output from child\\n\");\n    }\n    else\n    {\n        charatatime(\"output from parent\\n\");\n    }\n    exit(0);\n}\nstatic void charatatime(chat * str)\n{\n    char * ptr;\n    int c;\n    setbuf(stdout, NULL);\t//set unbuffered\n    for(ptr = str; (c = *ptr++) != 0; )\t//èµ‹å€¼è¯­å¥çš„è¿”å›å€¼æ˜¯æ‰€èµ‹çš„å€¼ï¼Œå³*ptr\n    {\n        putc(c, stdout);\n    }\n}\n```\n\nåœ¨ç¨‹åºä¸­å°†æ ‡å‡†è¾“å‡ºè®¾ç½®ä¸ºä¸å¸¦ç¼“å†²çš„ï¼Œäºæ˜¯æ¯ä¸ªå­—ç¬¦è¾“å‡ºéƒ½éœ€è°ƒç”¨ä¸€æ¬¡`write`ã€‚æœ¬ä¾‹çš„ç›®çš„æ˜¯ä½¿å†…æ ¸èƒ½å°½å¯èƒ½å¤šæ¬¡åœ°åœ¨ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´è¿›è¡Œåˆ‡æ¢ï¼Œä»¥ä¾¿æ¼”ç¤ºç«äº‰æ¡ä»¶ã€‚ï¼ˆå¦‚æœä¸è¿™æ ·åšï¼Œå¯èƒ½ä¹Ÿå°±å†³ä¸ä¼šè§åˆ°ä¸‹é¢æ‰€ç¤ºçš„è¾“å‡ºã€‚æ²¡æœ‰çœ‹åˆ°å…·æœ‰é”™è¯¯çš„è¾“å‡ºå¹¶ä¸æ„å‘³ç€ç«äº‰æ¡ä»¶ä¸å­˜åœ¨ï¼Œè¿™åªæ˜¯æ„å‘³ç€åœ¨æ­¤ç‰¹å®šçš„ç³»ç»Ÿä¸Šæœªèƒ½è§åˆ°å®ƒã€‚)ä¸‹é¢çš„å®é™…è¾“å‡ºè¯´æ˜è¯¥ç¨‹åºçš„è¿è¡Œç»“æœæ˜¯ä¼šæ”¹å˜çš„ã€‚\n\n![image-20220515173120942](../../images/Linux_exit/image-20220515173120942.png)\n\nä¿®æ”¹è¿™ä¸ªç¨‹åºï¼Œä½¿å…¶ä½¿ç”¨`TELL`å’Œ`WAIT`å‡½æ•°ï¼Œäºæ˜¯å½¢æˆäº†ä»¥ä¸‹ç¨‹åºã€‚è¡Œé¦–æ ‡ä»¥`+`å·çš„è¡Œæ˜¯æ–°å¢åŠ çš„è¡Œã€‚\n\n```c\n    #include\"apue.h\"\n    static void charatatime(char *);\n    int main(void)\n    {\n        pid_t pid;\n+       TELL_WAIT();\n        if((pid = fork()) < 0)\n        {\n            err_sys(\"fork error\");\n        }\n        else if(pid == 0)\n        {\n+           WAIT_PARENT();\t//parent goes first\n            charatatime(\"output from child\\n\");\n        }\n        else\n        {\n            charatatime(\"output from parent\\n\");\n+           TELL_CHILD(pid);\n        }\n        exit(0);\n    }\n    static void charatatime(chat * str)\n    {\n        char * ptr;\n        int c;\n        setbuf(stdout, NULL);\t//set unbuffered\n        for(ptr = str; (c = *ptr++) != 0; )\t//èµ‹å€¼è¯­å¥çš„è¿”å›å€¼æ˜¯æ‰€èµ‹çš„å€¼ï¼Œå³*ptr\n        {\n            putc(c, stdout);\n        }\n    }\n```\n\nè¿è¡Œæ­¤ç¨‹åºåˆ™èƒ½å¾—åˆ°æ‰€é¢„æœŸçš„ä¸¤ä¸ªè¿›ç¨‹çš„è¾“å‡ºä¸å†äº¤å‰æ··åˆï¼Œä¸”çˆ¶è¿›ç¨‹å…ˆè¾“å‡ºã€‚\n\nå¦‚æœå°†forkä¹‹åçš„è¡Œæ”¹æˆä»¥ä¸‹ä»£ç ï¼Œåˆ™å­è¿›ç¨‹å…ˆè¾“å‡ºï¼š\n```c\nelse if(pid == 0)\n{\n    charatatime(\"output from child\\n\");\n    TELL_PARENT(getppid());\n}\nelse\n{\n    WAIT_CHILD();\t//child goes first\n    charatatime(\"output from parent\\n\");\n}\n```\n\n\n\n","categories":["Linux"]},{"title":"Linux_gcc_gdb","url":"/Linux/Linux_gcc_gdb/","content":"# å†…å®¹\n\n1. gcc\n2. gdb\n# gccçš„æ–‡ä»¶ç±»å‹çº¦å®šè§„åˆ™\n![](../../images/Linux_gcc_gdb/image-20250717221711701.png)\n# gccå¸¸ç”¨é€‰é¡¹\n![](../../images/Linux_gcc_gdb/image-20250717221742017.png)\n\n\n# gdb - è°ƒè¯•å·¥å…·\n\n* è°ƒè¯•çš„å¯¹è±¡ï¼šå¯æ‰§è¡Œç¨‹åº\n* ç¼–è¯‘æ—¶éœ€è¦å¢åŠ è°ƒè¯•ä¿¡æ¯`-g`\n\n## å¸¸ç”¨å‘½ä»¤\n\n| å‘½ä»¤æ ‡è¯†                   | å«ä¹‰                     |\n| -------------------------- | ------------------------ |\n| `l`                        | æ˜¾ç¤ºä»£ç                  |\n| `Enterï¼ˆå›è½¦é”®ï¼‰`          | é‡å¤ä¸Šä¸€æ¡å‘½ä»¤           |\n| `b è¡Œå·`                   | ä¸ºæŸè¡Œæ·»åŠ æ–­ç‚¹           |\n| info break                 | æŸ¥çœ‹æ–­ç‚¹ä¿¡æ¯             |\n| `r`ã€`run`                 | å¯åŠ¨ç¨‹åº                 |\n| `n`ã€`next`                | å•æ­¥æ‰§è¡Œ                 |\n| `p å˜é‡å`ã€`print å˜é‡å` | æ‰“å°å˜é‡åå†…å®¹           |\n| `q`                        | é€€å‡ºè°ƒè¯•                 |\n| `s`ã€`step`                | è¿›å…¥å‡½æ•°                 |\n| `f`ã€`finish`              | è·³å‡ºå‡½æ•°                 |\n| `continue`                 | ç»§ç»­ç¨‹åºï¼ˆåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹ï¼‰ |\n\n![](../../images/Linux_gcc_gdb/image-20250717223939391.png)\n\n","categories":["Linux"]},{"title":"makefile","url":"/é¡¹ç›®/makefile/","content":"# å†…å®¹\n\n1. makefileçš„ç¼–å†™\n2. å‘½ä»¤\n# ç¤ºä¾‹\n\nç¤ºä¾‹æ‰€ç”¨åˆ°çš„ä»£ç å†…å®¹ï¼š\n\n```c\n//main.c\n#include<stdio.h>\nint main()\n{\n    int a = 2;\n    int b = 3;\n    printf(\"a+b = %d\\n\",add(a,b));\n    printf(\"Max = %d\\n\",max(a,b));\n    return 0;\n}\n```\n\n```c\n//add.c\nint add(int x, int y)\n{\n    return x+y;\n}\n```\n\n```c\n//max.c\nint max(int x, int y)\n{\n    return x > y ? x : y;\n}\n```\n\n# makefileç¼–å†™\n\n```bash\n# Makefile\nall : main\n\nmain : main.o add.o max.o\n\tgcc -o main main.o add.o max.o\n\t\nmain.o : main.c\n\tgcc -c main.c\n\nadd.o : add.c\n\tgcc -c add.c\n\t\nmax.o : max.c\n\tgcc -c max.c\n\t\nclean:\n\trm -f *.o main\n```\n\n# å‘½ä»¤\n\n```bash\nmake makefile\t#makeå‘½ä»¤--è¯»å–makefileæ–‡ä»¶\n```\n\n","categories":["é¡¹ç›®","Linux"]},{"title":"å¤–è§‚æ¨¡å¼","url":"/è®¾è®¡æ¨¡å¼/å¤–è§‚æ¨¡å¼/","content":"\nå¤–è§‚æ¨¡å¼æ˜¯ä¸€ç§ä½¿ç”¨é¢‘ç‡éå¸¸é«˜çš„**ç»“æ„å‹è®¾è®¡æ¨¡å¼**ï¼Œå®ƒé€šè¿‡å¼•å…¥ä¸€ä¸ªå¤–è§‚è§’è‰²æ¥ç®€åŒ–å®¢æˆ·ç«¯ä¸å­ç³»ç»Ÿä¹‹é—´çš„äº¤äº’ï¼Œ**ä¸ºå¤æ‚çš„å­ç³»ç»Ÿè°ƒç”¨æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£ï¼Œé™ä½å­ç³»ç»Ÿä¸å®¢æˆ·ç«¯çš„è€¦åˆåº¦**ï¼Œä¸”å®¢æˆ·ç«¯è°ƒç”¨éå¸¸æ–¹ä¾¿ã€‚\n\n# å¼•ä¾‹\n\nä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰æ¯”è¾ƒè¿‡è‡ªå·±æ³¡èŒ¶å’Œå»èŒ¶é¦†å–èŒ¶çš„åŒºåˆ«ï¼Œå¦‚æœæ˜¯è‡ªå·±æ³¡èŒ¶éœ€è¦è‡ªè¡Œå‡†å¤‡èŒ¶å¶ã€èŒ¶å…·å’Œå¼€æ°´ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚\n![image-20220509175118569](../../images/å¤–è§‚æ¨¡å¼/image-20220509175118569.png)\n\nè€Œå»èŒ¶é¦†å–èŒ¶ï¼Œæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯è·ŸèŒ¶é¦†æœåŠ¡å‘˜è¯´æƒ³è¦ä¸€æ¯ä»€ä¹ˆæ ·çš„èŒ¶ã€‚æ­£å› ä¸ºèŒ¶é¦†æœ‰æœåŠ¡å‘˜ï¼Œé¡¾å®¢æ— é¡»ç›´æ¥å’ŒèŒ¶å¶ã€èŒ¶å…·ã€å¼€æ°´ç­‰äº¤äº’ï¼Œæ•´ä¸ªæ³¡èŒ¶è¿‡ç¨‹ç”±æœåŠ¡å‘˜æ¥å®Œæˆï¼Œé¡¾å®¢åªéœ€ä¸æœåŠ¡å‘˜äº¤äº’å³å¯ï¼Œæ•´ä¸ªè¿‡ç¨‹éå¸¸ç®€å•çœäº‹ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚\n![image-20220509175152669](../../images/å¤–è§‚æ¨¡å¼/image-20220509175152669.png)\n\nåœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œæœ‰æ—¶å€™ä¸ºäº†å®Œæˆä¸€é¡¹è¾ƒä¸ºå¤æ‚çš„åŠŸèƒ½ï¼Œä¸€ä¸ªå®¢æˆ·ç±»éœ€è¦å’Œå¤šä¸ªä¸šåŠ¡ç±»äº¤äº’ï¼Œè€Œè¿™äº›éœ€è¦äº¤äº’çš„ä¸šåŠ¡ç±»ç»å¸¸ä¼šä½œä¸ºä¸€ä¸ªæ•´ä½“å‡ºç°ï¼Œç”±äºæ¶‰åŠåˆ°çš„ç±»æ¯”è¾ƒå¤šï¼Œå¯¼è‡´ä½¿ç”¨æ—¶ä»£ç è¾ƒä¸ºå¤æ‚ï¼Œæ­¤æ—¶ï¼Œç‰¹åˆ«**éœ€è¦ä¸€ä¸ªç±»ä¼¼æœåŠ¡å‘˜ä¸€æ ·çš„è§’è‰²ï¼Œç”±å®ƒæ¥è´Ÿè´£å’Œå¤šä¸ªä¸šåŠ¡ç±»è¿›è¡Œäº¤äº’ï¼Œè€Œå®¢æˆ·ç±»åªéœ€ä¸è¯¥ç±»äº¤äº’**ã€‚\n\nå¤–è§‚æ¨¡å¼é€šè¿‡å¼•å…¥ä¸€ä¸ª**å¤–è§‚ç±»(Facade)**æ¥å®ç°è¯¥åŠŸèƒ½ï¼Œå¤–è§‚ç±»å……å½“äº†è½¯ä»¶ç³»ç»Ÿä¸­çš„â€œæœåŠ¡å‘˜â€ï¼Œå®ƒä¸ºå¤šä¸ªä¸šåŠ¡ç±»çš„è°ƒç”¨æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£ï¼Œç®€åŒ–äº†ç±»ä¸ç±»ä¹‹é—´çš„äº¤äº’ã€‚\n\nåœ¨å¤–è§‚æ¨¡å¼ä¸­ï¼Œé‚£äº›**éœ€è¦äº¤äº’çš„ä¸šåŠ¡ç±»è¢«ç§°ä¸ºå­ç³»ç»Ÿ(Subsystem)**ã€‚å¦‚æœæ²¡æœ‰å¤–è§‚ç±»ï¼Œé‚£ä¹ˆæ¯ä¸ªå®¢æˆ·ç±»éœ€è¦å’Œå¤šä¸ªå­ç³»ç»Ÿä¹‹é—´è¿›è¡Œå¤æ‚çš„äº¤äº’ï¼Œç³»ç»Ÿçš„è€¦åˆåº¦å°†å¾ˆå¤§ã€‚è€Œå¼•å…¥å¤–è§‚ç±»ä¹‹åï¼Œå®¢æˆ·ç±»åªéœ€è¦ç›´æ¥ä¸å¤–è§‚ç±»äº¤äº’ï¼Œå®¢æˆ·ç±»ä¸å­ç³»ç»Ÿä¹‹é—´åŸæœ‰çš„å¤æ‚å¼•ç”¨å…³ç³»ç”±å¤–è§‚ç±»æ¥å®ç°ï¼Œä»è€Œé™ä½äº†ç³»ç»Ÿçš„è€¦åˆåº¦ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚\n![image-20220509175402273](../../images/å¤–è§‚æ¨¡å¼/image-20220509175402273.png)\n\n# å¤–è§‚æ¨¡å¼\n\nå¤–è§‚æ¨¡å¼ä¸­ï¼Œä¸€ä¸ªå­ç³»ç»Ÿçš„å¤–éƒ¨ä¸å…¶å†…éƒ¨çš„é€šä¿¡é€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„å¤–è§‚ç±»è¿›è¡Œï¼Œå¤–è§‚ç±»å°†å®¢æˆ·ç±»ä¸å­ç³»ç»Ÿçš„å†…éƒ¨å¤æ‚æ€§åˆ†éš”å¼€ï¼Œä½¿å¾—å®¢æˆ·ç±»åªéœ€è¦ä¸å¤–è§‚è§’è‰²æ‰“äº¤é“ï¼Œè€Œä¸éœ€è¦ä¸å­ç³»ç»Ÿå†…éƒ¨çš„å¾ˆå¤šå¯¹è±¡æ‰“äº¤é“ã€‚\n\n* å®šä¹‰\n\nå¤–è§‚æ¨¡å¼ï¼šä¸ºå­ç³»ç»Ÿä¸­çš„ä¸€ç»„æ¥å£æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£ã€‚å¤–è§‚æ¨¡å¼å®šä¹‰äº†ä¸€ä¸ªé«˜å±‚æ¥å£ï¼Œè¿™ä¸ªæ¥å£ä½¿å¾—è¿™ä¸€å­ç³»ç»Ÿæ›´åŠ å®¹æ˜“ä½¿ç”¨ã€‚\nFacade Pattern: Provide a unified interface to a set of interfaces in a subsystem. Facade defines a higher-level interface that makes the subsystem easier to use.\n\nå¤–è§‚æ¨¡å¼åˆç§°ä¸ºé—¨é¢æ¨¡å¼ï¼Œå®ƒæ˜¯ä¸€ç§å¯¹è±¡ç»“æ„å‹æ¨¡å¼ã€‚å¤–è§‚æ¨¡å¼**æ˜¯è¿ªç±³ç‰¹æ³•åˆ™çš„ä¸€ç§å…·ä½“å®ç°**ï¼Œé€šè¿‡å¼•å…¥ä¸€ä¸ªæ–°çš„å¤–è§‚è§’è‰²å¯ä»¥é™ä½åŸæœ‰ç³»ç»Ÿçš„å¤æ‚åº¦ï¼ŒåŒæ—¶é™ä½å®¢æˆ·ç±»ä¸å­ç³»ç»Ÿçš„è€¦åˆåº¦ã€‚\n\n# å¤–è§‚æ¨¡å¼ç»“æ„ä¸å®ç°\n\n## æ¨¡å¼ç»“æ„\n\nå¤–è§‚æ¨¡å¼æ²¡æœ‰ä¸€ä¸ªä¸€èˆ¬åŒ–çš„ç±»å›¾æè¿°ã€‚ä¸‹å›¾å¯ä»¥ç®€å•åœ°æè¿°å¤–è§‚æ¨¡å¼çš„ç»“æ„ï¼š\n![image-20220509185718460](../../images/å¤–è§‚æ¨¡å¼/image-20220509185718460.png)\n\nå¤–è§‚æ¨¡å¼åŒ…å«å¦‚ä¸‹ä¸¤ä¸ªè§’è‰²ï¼š\n\n* **Facadeï¼ˆå¤–è§‚è§’è‰²ï¼‰**\n  * åœ¨å®¢æˆ·ç«¯å¯ä»¥è°ƒç”¨å®ƒçš„æ–¹æ³•\n  * åœ¨å¤–è§‚è§’è‰²ä¸­å¯ä»¥çŸ¥é“ç›¸å…³çš„ï¼ˆä¸€ä¸ªæˆ–è€…å¤šä¸ªï¼‰å­ç³»ç»Ÿçš„åŠŸèƒ½å’Œè´£ä»»ï¼›\n  * åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œå®ƒå°†æ‰€æœ‰ä»å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚å§”æ´¾åˆ°ç›¸åº”çš„å­ç³»ç»Ÿå»ï¼Œä¼ é€’ç»™ç›¸åº”çš„å­ç³»ç»Ÿå¯¹è±¡å¤„ç†ã€‚\n\n* **SubSystemï¼ˆå­ç³»ç»Ÿè§’è‰²ï¼‰**\n  * åœ¨è½¯ä»¶ç³»ç»Ÿä¸­å¯ä»¥æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªå­ç³»ç»Ÿè§’è‰²ï¼Œæ¯ä¸€ä¸ªå­ç³»ç»Ÿå¯ä»¥ä¸æ˜¯ä¸€ä¸ªå•ç‹¬çš„ç±»ï¼Œè€Œæ˜¯ä¸€ä¸ªç±»çš„é›†åˆï¼Œå®ƒå®ç°å­ç³»ç»Ÿçš„åŠŸèƒ½ï¼›\n  * æ¯ä¸€ä¸ªå­ç³»ç»Ÿéƒ½å¯ä»¥è¢«å®¢æˆ·ç«¯ç›´æ¥è°ƒç”¨ï¼Œæˆ–è€…è¢«å¤–è§‚è§’è‰²è°ƒç”¨ï¼Œå®ƒå¤„ç†ç”±å¤–è§‚ç±»ä¼ è¿‡æ¥çš„è¯·æ±‚ï¼›\n  * å­ç³»ç»Ÿå¹¶ä¸çŸ¥é“å¤–è§‚çš„å­˜åœ¨ï¼Œ**å¯¹äºå­ç³»ç»Ÿè€Œè¨€ï¼Œå¤–è§‚è§’è‰²ä»…ä»…æ˜¯å¦å¤–ä¸€ä¸ªå®¢æˆ·ç«¯**è€Œå·²ã€‚\n## æ¨¡å¼å®ç°\n\nå¤–è§‚æ¨¡å¼çš„ä¸»è¦ç›®çš„åœ¨äºé™ä½ç³»ç»Ÿçš„å¤æ‚ç¨‹åº¦ï¼Œåœ¨é¢å‘å¯¹è±¡è½¯ä»¶ç³»ç»Ÿä¸­ï¼Œç±»ä¸ç±»ä¹‹é—´çš„å…³ç³»è¶Šå¤šï¼Œä¸èƒ½è¡¨ç¤ºç³»ç»Ÿè®¾è®¡å¾—è¶Šå¥½ï¼Œåè€Œè¡¨ç¤ºç³»ç»Ÿä¸­ç±»ä¹‹é—´çš„è€¦åˆåº¦å¤ªå¤§ï¼Œè¿™æ ·çš„ç³»ç»Ÿåœ¨ç»´æŠ¤å’Œä¿®æ”¹æ—¶éƒ½ç¼ºä¹çµæ´»æ€§ï¼Œå› ä¸ºä¸€ä¸ªç±»çš„æ”¹åŠ¨ä¼šå¯¼è‡´å¤šä¸ªç±»å‘ç”Ÿå˜åŒ–ã€‚\n\nè€Œå¤–è§‚æ¨¡å¼çš„å¼•å…¥åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šé™ä½äº†ç±»ä¸ç±»ä¹‹é—´çš„è€¦åˆå…³ç³»ï¼Œå¢åŠ æ–°çš„å­ç³»ç»Ÿæˆ–è€…ç§»é™¤å­ç³»ç»Ÿéƒ½éå¸¸æ–¹ä¾¿ï¼Œå®¢æˆ·ç±»æ— é¡»è¿›è¡Œä¿®æ”¹ï¼ˆæˆ–è€…æå°‘çš„ä¿®æ”¹ï¼‰ï¼Œåªéœ€è¦åœ¨å¤–è§‚ç±»ä¸­å¢åŠ æˆ–ç§»é™¤å¯¹å­ç³»ç»Ÿçš„å¼•ç”¨å³å¯ã€‚ä»è¿™ä¸€ç‚¹æ¥è¯´ï¼Œå¤–è§‚æ¨¡å¼åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¹¶ä¸ç¬¦åˆå¼€é—­åŸåˆ™ï¼Œå¢åŠ æ–°çš„å­ç³»ç»Ÿéœ€è¦å¯¹åŸæœ‰ç³»ç»Ÿè¿›è¡Œä¸€å®šçš„ä¿®æ”¹ï¼Œè™½ç„¶è¿™ä¸ªä¿®æ”¹å·¥ä½œé‡ä¸å¤§ã€‚\n\n### å­ç³»ç»Ÿ\n\nå¤–è§‚æ¨¡å¼ä¸­æ‰€æŒ‡çš„å­ç³»ç»Ÿæ˜¯ä¸€ä¸ªå¹¿ä¹‰çš„æ¦‚å¿µï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªç±»ã€ä¸€ä¸ªåŠŸèƒ½æ¨¡å—ã€ç³»ç»Ÿçš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†æˆ–è€…ä¸€ä¸ªå®Œæ•´çš„ç³»ç»Ÿã€‚å­ç³»ç»Ÿç±»é€šå¸¸æ˜¯ä¸€äº›ä¸šåŠ¡ç±»ï¼Œå®ç°äº†ä¸€äº›å…·ä½“çš„ã€ç‹¬ç«‹çš„ä¸šåŠ¡åŠŸèƒ½ï¼Œå…¶å…¸å‹ä»£ç å¦‚ä¸‹ï¼š\n\n```cpp\nclass SubSystemA\n{\npublic:\n    void MethodA()\n    {\n        //ä¸šåŠ¡å®ç°ä»£ç \n    }\n};\nclass SubSystemB\n{\npublic:\n    void MethodB()\n    {\n        //ä¸šåŠ¡å®ç°ä»£ç \n    }\n};\nclass SubSystemC\n{\npublic:\n    void MethodC()\n    {\n        //ä¸šåŠ¡å®ç°ä»£ç \n    }\n};\n```\n\n### å¤–è§‚ç±»\n\n åœ¨å¼•å…¥å¤–è§‚ç±»ä¹‹åï¼Œä¸å­ç³»ç»Ÿä¸šåŠ¡ç±»ä¹‹é—´çš„äº¤äº’ç»Ÿä¸€ç”±å¤–è§‚ç±»æ¥å®Œæˆï¼Œåœ¨å¤–è§‚ç±»ä¸­é€šå¸¸å­˜åœ¨å¦‚ä¸‹ä»£ç ï¼š\n\n```cpp\nclass Facade\n{\nprivate:\n    SubSystemA * obja;\n\tSubSystemB * objb;\n\tSubSystemC * objc;\npublic:\n    Facade()\n    {\n        obja = new SubSystemA();\n        objb = new SubSystemB();\n        objc = new SubSystemC();\n    }\n    void Method()\n    {\n        obja->MethodA();\n        objb->MethodB();\n        objc->MethodC();\n    }\n};\n```\n\n### å®¢æˆ·ç«¯\n\nç”±äºåœ¨å¤–è§‚ç±»ä¸­ç»´æŒäº†å¯¹å­ç³»ç»Ÿå¯¹è±¡çš„å¼•ç”¨ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡å¤–è§‚ç±»æ¥é—´æ¥è°ƒç”¨å­ç³»ç»Ÿå¯¹è±¡çš„ä¸šåŠ¡æ–¹æ³•ï¼Œè€Œæ— é¡»ä¸å­ç³»ç»Ÿå¯¹è±¡ç›´æ¥äº¤äº’ã€‚å¼•å…¥å¤–è§‚ç±»åï¼Œå®¢æˆ·ç«¯ä»£ç å˜å¾—éå¸¸ç®€å•ï¼Œå…¸å‹ä»£ç å¦‚ä¸‹ï¼š\n\n```cpp\nint main()\n{\n\tFacade facade = new Facade();\n    facade->Method();\n}\n```\n\n# å¤–è§‚æ¨¡å¼åº”ç”¨å®ä¾‹\n\nä¸‹é¢é€šè¿‡ä¸€ä¸ªåº”ç”¨å®ä¾‹æ¥è¿›ä¸€æ­¥å­¦ä¹ å’Œç†è§£å¤–è§‚æ¨¡å¼ã€‚\n\næŸè½¯ä»¶å…¬å¸æ¬²å¼€å‘ä¸€ä¸ªå¯åº”ç”¨äºå¤šä¸ªè½¯ä»¶çš„æ–‡ä»¶åŠ å¯†æ¨¡å—ï¼Œè¯¥æ¨¡å—å¯ä»¥å¯¹æ–‡ä»¶ä¸­çš„æ•°æ®è¿›è¡ŒåŠ å¯†å¹¶å°†åŠ å¯†ä¹‹åçš„æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªæ–°æ–‡ä»¶ä¸­ï¼Œå…·ä½“çš„æµç¨‹åŒ…æ‹¬ä¸‰ä¸ªéƒ¨åˆ†ï¼š**è¯»å–æºæ–‡ä»¶ã€åŠ å¯†ã€ä¿å­˜åŠ å¯†ä¹‹åçš„æ–‡ä»¶**ã€‚å…¶ä¸­ï¼Œè¯»å–æ–‡ä»¶å’Œä¿å­˜æ–‡ä»¶ä½¿ç”¨æµæ¥å®ç°ï¼ŒåŠ å¯†æ“ä½œé€šè¿‡æ±‚æ¨¡è¿ç®—å®ç°ã€‚è¿™ä¸‰ä¸ªæ“ä½œç›¸å¯¹ç‹¬ç«‹ï¼Œä¸ºäº†å®ç°ä»£ç çš„ç‹¬ç«‹é‡ç”¨ï¼Œè®©è®¾è®¡æ›´ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ï¼Œè¿™ä¸‰ä¸ªæ“ä½œçš„ä¸šåŠ¡ä»£ç å°è£…åœ¨ä¸‰ä¸ªä¸åŒçš„ç±»ä¸­ã€‚\n\nç°ä½¿ç”¨å¤–è§‚æ¨¡å¼è®¾è®¡è¯¥æ–‡ä»¶åŠ å¯†æ¨¡å—ã€‚\n\n## å®ä¾‹ç±»å›¾\n\né€šè¿‡åˆ†æï¼Œæœ¬å®ä¾‹ç»“æ„å›¾å¦‚ä¸‹ã€‚\n\n![image-20220509200434876](../../images/å¤–è§‚æ¨¡å¼/image-20220509200434876.png)\n\nå›¾ä¸­ï¼ŒEncryptFacadeå……å½“å¤–è§‚ç±»ï¼ŒFileReaderã€CipherMachineå’ŒFileWriterå……å½“å­ç³»ç»Ÿç±»ã€‚\n\n## ç¤ºä¾‹ä»£ç \n\n### FileReader\n\næ–‡ä»¶è¯»å–ç±»ï¼Œå……å½“å­ç³»ç»Ÿç±»ã€‚\n\n```cpp\n#ifndef FILEREADER_H\n#define FILEREADER_H\n#include<iostream>\n#include<fstream>\n#include<sstream>\nusing namespace std;\nclass FileReader\n{\npublic:\n    string Read(const string & fileNameSrc)\n    {\n        cout << \"è¯»å–æ–‡ä»¶ï¼Œè·å–æ˜æ–‡ã€‚\" << endl;\n        fstream fs(fileNameSrc.c_str(), ios_base::in);\n        stringstream ss;\n        string s;\n        if(fs.is_open())\n        {\n            while(fs >> s)\n            {\n                ss << s;\n            }\n        }\n        else\n        {\n            cout << \"ä¸èƒ½æ‰“å¼€æ–‡ä»¶ï¼\" << endl;\n        }\n        return ss.str();\n    }\n};\n#endif\n```\n\n### CipherMachine\n\næ•°æ®åŠ å¯†ç±»ï¼Œå……å½“å­ç³»ç»Ÿç±»ã€‚\n\n```cpp\n#ifndef CIPHERMACHINE_H\n#define CIPHERMACHINE_H\n#include<iostream>\n#include<string>\n#include<vector>\nusing namespace std;\nclass CipherMachine\n{\npublic:\n    string Encrypt(const string & plainText)\n    {\n        cout << \"æ•°æ®åŠ å¯†ï¼Œå°†æ˜æ–‡è½¬æ¢ä¸ºå¯†æ–‡ï¼\" << endl;\n        string es = \"\";\n        vector<char> vc(plainText.begin(), plainText.end());\n        for(auto & c : vc)\n        {\n            es += (c % 36) + 65;\n        }\n        cout << es << endl;\n        return es;\n    }\n};\n#endif\n```\n\n### FileWriter\n\næ–‡ä»¶ä¿å­˜ç±»ï¼Œå……å½“å­ç³»ç»Ÿç±»ã€‚\n\n```cpp\n#ifndef FILEWRITER_H\n#define FILEWRITER_H\n#include<fstream>\n#include<iostream>\n#include<sstream>\nusing namespace std;\nclass FileWriter\n{\npublic:\n    void Write(const string & encryptStr, const string& fileNameDes)\n    {\n        cout << \"ä¿å­˜å¯†ç ï¼Œå†™å…¥æ–‡ä»¶ã€‚\" << endl;\n        fstream fs(fileNameDes, ios_base::out);\n        if(fs.is_open())\n        {\n            fs.write(encryptStr.c_str(), encryptStr.size());\n        }\n        else\n        {\n            cout << \"æ–‡ä»¶å†™å…¥å¤±è´¥ï¼\" << endl;\n        }\n    }\n};\n#endif\n```\n\n### EncryptFacade\n\nåŠ å¯†å¤–è§‚ç±»ï¼Œå……å½“å¤–è§‚ç±»ã€‚\n\n```cpp\n#ifndef ENCRYPTFACADE_H\n#define ENCRYPTFACADE_H\n#include\"ciphermachine.h\"\n#include\"filereader.h\"\n#include\"filewriter.h\"\n#include<memory>\nclass EncryptFacade\n{\nprivate:\n    shared_ptr<FileReader> reader;\n    shared_ptr<FileWriter> writer;\n    shared_ptr<CipherMachine> cipher;\npublic:\n    EncryptFacade()\n    {\n        reader = make_shared<FileReader>();\n        cipher = make_shared<CipherMachine>();\n        writer = make_shared<FileWriter>();\n    }\n    void FileEncrypt(const string & fileNameSrc, const string & fileNameDes)\n    {\n        string plainStr = reader->Read(fileNameSrc);\n        string encryptStr = cipher->Encrypt(plainStr);\n        writer->Write(encryptStr, fileNameDes);\n    }\n};\n#endif\n```\n\n## å®¢æˆ·ç«¯ä»£ç \n\n```cpp\n#include\"encryptfacade.h\"\nint main()\n{\n    unique_ptr<EncryptFacade> ef = make_unique<EncryptFacade>();\n    ef->FileEncrypt(\"./file.txt\", \"./code.txt\");\n}\n```\n\n## è¿è¡Œç»“æœ\n\n```\nè¯»å–æ–‡ä»¶ï¼Œè·å–æ˜æ–‡ã€‚(19060212119ChenggongXing)\næ•°æ®åŠ å¯†ï¼Œå°†æ˜æ–‡è½¬æ¢ä¸ºå¯†æ–‡ï¼\nNVMSMNONNV`a^C``DC`QbC`\nä¿å­˜å¯†ç ï¼Œå†™å…¥æ–‡ä»¶ã€‚\n```\n\nå‘ç°ï¼Œç›®å½•ä¸‹å¤šäº†ä¸€ä¸ªcode.txtï¼Œé‡Œé¢å­˜æ”¾çš„æ˜¯å¯†æ–‡ã€‚\n\n# æŠ½è±¡å¤–è§‚ç±»\n\nåœ¨æ ‡å‡†çš„å¤–è§‚æ¨¡å¼ç»“æ„å›¾ä¸­ï¼Œå¦‚æœéœ€è¦å¢åŠ ã€åˆ é™¤æˆ–æ›´æ¢ä¸å¤–è§‚ç±»äº¤äº’çš„å­ç³»ç»Ÿç±»ï¼Œå¿…é¡»ä¿®æ”¹å¤–è§‚ç±»æˆ–å®¢æˆ·ç«¯çš„æºä»£ç ï¼Œè¿™å°†è¿èƒŒå¼€é—­åŸåˆ™ï¼Œå› æ­¤å¯ä»¥é€šè¿‡å¼•å…¥æŠ½è±¡å¤–è§‚ç±»æ¥å¯¹ç³»ç»Ÿè¿›è¡Œæ”¹è¿›ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥è§£å†³è¯¥é—®é¢˜ã€‚\n\nåœ¨å¼•å…¥æŠ½è±¡å¤–è§‚ç±»ä¹‹åï¼Œå®¢æˆ·ç«¯å¯ä»¥é’ˆå¯¹æŠ½è±¡å¤–è§‚ç±»è¿›è¡Œç¼–ç¨‹ï¼Œ**å¯¹äºæ–°çš„ä¸šåŠ¡éœ€æ±‚ï¼Œä¸éœ€è¦ä¿®æ”¹åŸæœ‰å¤–è§‚ç±»**ï¼Œè€Œæ˜¯**å¢åŠ ä¸€ä¸ªæ–°çš„å…·ä½“å¤–è§‚ç±»**ï¼Œç”±æ–°çš„å…·ä½“å¤–è§‚ç±»æ¥å…³è”æ–°çš„å­ç³»ç»Ÿå¯¹è±¡ï¼ŒåŒæ—¶**é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶æ¥è¾¾åˆ°ä¸ä¿®æ”¹ä»»ä½•æºä»£ç å¹¶æ›´æ¢å¤–è§‚ç±»**çš„ç›®çš„ã€‚\n\n## å®ä¾‹åˆ†æ\n\nä¸‹é¢é€šè¿‡ä¸€ä¸ªå…·ä½“å®ä¾‹æ¥å­¦ä¹ å¦‚ä½•ä½¿ç”¨æŠ½è±¡å¤–è§‚ç±»ï¼šå¦‚æœåœ¨åº”ç”¨å®ä¾‹â€œæ–‡ä»¶åŠ å¯†æ¨¡å—â€ä¸­éœ€è¦æ›´æ¢ä¸€ä¸ªåŠ å¯†ç±»ï¼Œä¸å†ä½¿ç”¨åŸæœ‰çš„åŸºäºæ±‚æ¨¡è¿ç®—çš„åŠ å¯†ç±»CipherMachineï¼Œè€Œæ”¹ä¸ºæ–°åŠ å¯†ç±»NewCipherMachineï¼Œå…¶ä»£ç å¦‚ä¸‹ï¼š\n\n```cpp\n#ifndef NEWCIPHERMACHINE_H\n#define NEWCIPHERMACHINE_H\n#include<iostream>\n#include<string>\n#include<vector>\nusing namespace std;\nclass NewCipherMachine\n{\npublic:\n    string Encrypt(const string & plainText)\n    {\n        cout << \"æ•°æ®åŠ å¯†ï¼Œå°†æ˜æ–‡è½¬æ¢ä¸ºå¯†æ–‡ï¼\" << endl;\n        string es = \"\";\n        vector<char> vc(plainText.begin(), plainText.end());\n        for(auto & c : vc)\n        {\n            es += (c % 36) + 60;\t//ç”±åŸæ¥çš„+65å˜ä¸º+60\n        }\n        cout << es << endl;\n        return es;\n    }\n};\n#endif\n```\n\nå¦‚æœä¸å¢åŠ æ–°çš„å¤–è§‚ç±»ï¼Œåªèƒ½é€šè¿‡ä¿®æ”¹åŸæœ‰å¤–è§‚ç±»EncryptFacadeçš„æºä»£ç æ¥å®ç°åŠ å¯†ç±»çš„æ›´æ¢ï¼Œå°†åŸæœ‰çš„å¯¹CipherMachineç±»å‹å¯¹è±¡çš„å¼•ç”¨æ”¹ä¸ºå¯¹NewCipherMachineç±»å‹å¯¹è±¡çš„å¼•ç”¨ï¼Œè¿™è¿èƒŒäº†å¼€é—­åŸåˆ™ï¼Œå› æ­¤éœ€è¦é€šè¿‡å¢åŠ æ–°çš„å¤–è§‚ç±»æ¥å®ç°å¯¹å­ç³»ç»Ÿå¯¹è±¡å¼•ç”¨çš„æ”¹å˜ã€‚\n\n## è§£å†³æ–¹æ¡ˆ\n\nå¦‚æœå¢åŠ ä¸€ä¸ªæ–°çš„å¤–è§‚ç±»NewEncryptFacadeæ¥ä¸FileReaderç±»ã€FileWriterç±»ä»¥åŠæ–°å¢åŠ çš„NewCipherMachineç±»è¿›è¡Œäº¤äº’ï¼Œè™½ç„¶åŸæœ‰ç³»ç»Ÿç±»åº“æ— é¡»åšä»»ä½•ä¿®æ”¹ï¼Œä½†æ˜¯å› ä¸ºå®¢æˆ·ç«¯ä»£ç ä¸­åŸæ¥é’ˆå¯¹EncryptFacadeç±»è¿›è¡Œç¼–ç¨‹ï¼Œç°åœ¨éœ€è¦æ”¹ä¸ºNewEncryptFacadeç±»ï¼Œå› æ­¤éœ€è¦ä¿®æ”¹å®¢æˆ·ç«¯æºä»£ç ã€‚\n\nå¦‚ä½•åœ¨ä¸ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç çš„å‰æä¸‹ä½¿ç”¨æ–°çš„å¤–è§‚ç±»å‘¢ï¼Ÿ\n\nè§£å†³æ–¹æ³•ä¹‹ä¸€æ˜¯ï¼šå¼•å…¥ä¸€ä¸ªæŠ½è±¡å¤–è§‚ç±»ï¼Œå®¢æˆ·ç«¯é’ˆå¯¹æŠ½è±¡å¤–è§‚ç±»ç¼–ç¨‹ï¼Œè€Œåœ¨è¿è¡Œæ—¶å†ç¡®å®šå…·ä½“å¤–è§‚ç±»ï¼Œå¼•å…¥æŠ½è±¡å¤–è§‚ç±»ä¹‹åçš„æ–‡ä»¶åŠ å¯†æ¨¡å—ç»“æ„å›¾å¦‚å›¾æ‰€ç¤ºï¼š\n\n![image-20220510085052559](../../images/å¤–è§‚æ¨¡å¼/image-20220510085052559.png)\n\n## ä»£ç å®ç°\n\n* æŠ½è±¡å¤–è§‚ç±»AbstractEncryptFacade\n\n```cpp\n#ifndef ABSTRACTENCRYPTFACADE_H\n#define ABSTRACTENCRYPTFACADE_H\nclass AbstractEncryptFacade\n{\npublic:\n    virtual void FileEncrypt(const string & fileNameSrc, const string & fileNameDes) = 0;\n};\n#endif\n```\n\n* æ–°å¢å…·ä½“åŠ å¯†å¤–è§‚ç±»NewEncryptFacadeä»£ç å¦‚ä¸‹ï¼š\n\n```cpp\n#ifndef NEWENCRYPTFACADE_H\n#define NEWENCRYPTFACADE_H\n#include\"abstractencryptfacade.h\"\n#include\"newciphermachine.h\"\n#include\"filereader.h\"\n#include\"filewriter.h\"\n#include<memory>\nclass NewEncryptFacade : public AbstractEncryptFacade\n{\nprivate:\n    shared_ptr<FileReader> reader;\n    shared_ptr<FileWriter> writer;\n    shared_ptr<NewCipherMachine> cipher;\t//new\npublic:\n    NewEncryptFacade()\n    {\n        reader = make_shared<FileReader>();\n        cipher = make_shared<NewCipherMachine>();\n        writer = make_shared<FileWriter>();\n    }\n    /* å®ç°æŠ½è±¡å‡½æ•° */\n    void FileEncrypt(const string & fileNameSrc, const string & fileNameDes)\n    {\n        string plainStr = reader->Read(fileNameSrc);\n        string encryptStr = cipher->Encrypt(plainStr);\n        writer->Write(encryptStr, fileNameDes);\n    }\n};\n#endif\n```\n\n## å¼•å…¥é…ç½®æ–‡ä»¶\n\næˆ‘ä»¬çš„é…ç½®æ–‡ä»¶ä½¿ç”¨jsonæ¥å¤„ç†ï¼Œå¼•å…¥ä¸€ä¸ªé€‚ç”¨äºcppçš„jsonç¬¬ä¸‰æ–¹åº“ï¼Œä½¿ç”¨json.hppã€‚\n\n```json\n{\n    \"cipher\": \"new\"\n}\n```\n\nè¿˜éœ€è¦å†™å¯¹åº”é…å¥—çš„mapæ˜ å°„ç”Ÿæˆå…·ä½“ä½¿ç”¨çš„å¯¹è±¡ã€‚\n\n```cpp\n#ifndef PUBLIC_H\n#define PUBLIC_H\n#include<unordered_map>\n#include<string>\n#include\"abstractencryptfacade.h\"\n#include\"encryptfacade.h\"\n#include\"newencryptfacade.h\"\n#include\"functional\"\nusing namespace std;\nunordered_map<string, function<unique_ptr<AbstractEncryptFacade>()>> s_facade_map = \n{\n    { \"old\", []()->unique_ptr<AbstractEncryptFacade> {return make_unique<EncryptFacade>();}},\n    { \"new\", []()->unique_ptr<AbstractEncryptFacade> {return make_unique<NewEncryptFacade>();}}\n};\n#endif\n```\n\n## å®¢æˆ·ç«¯æ”¹å†™\n\n```cpp\n#include\"encryptfacade.h\"\n#include\"json.hpp\"\n#include\"public.h\"\n#include<fstream>\nusing json = nlohmann::json;\nint main()\n{\n    json j;\n    ifstream jfile(\"../config.json\");\n    jfile >> j;\n    jfile.close();\n    \n    unique_ptr<AbstractEncryptFacade> ef = s_facade_map[j.at(\"cipher\")]();\n    ef->FileEncrypt(\"../file.txt\", \"../code.txt\");\n}\n```\n\n```\nè¯»å–æ–‡ä»¶ï¼Œè·å–æ˜æ–‡ã€‚\næ•°æ®åŠ å¯†ï¼Œå°†æ˜æ–‡è½¬æ¢ä¸ºå¯†æ–‡ï¼\nIQHNHIJIIQ[\\Y>[[?>[L]>[\nä¿å­˜å¯†ç ï¼Œå†™å…¥æ–‡ä»¶ã€‚\n```\n\nåŸæœ‰å¤–è§‚ç±»EncryptFacadeä¹Ÿéœ€ä½œä¸ºæŠ½è±¡å¤–è§‚ç±»AbstractEncryptFacadeç±»çš„å­ç±»ï¼Œæ›´æ¢å…·ä½“å¤–è§‚ç±»æ—¶åªéœ€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæ— é¡»ä¿®æ”¹æºä»£ç ï¼Œç¬¦åˆå¼€é—­åŸåˆ™ã€‚\n\n# æ€»ç»“\n\nå¤–è§‚æ¨¡å¼æ˜¯ä¸€ç§ä½¿ç”¨é¢‘ç‡éå¸¸é«˜çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒé€šè¿‡å¼•å…¥ä¸€ä¸ªå¤–è§‚è§’è‰²æ¥ç®€åŒ–å®¢æˆ·ç«¯ä¸å­ç³»ç»Ÿä¹‹é—´çš„äº¤äº’ï¼Œä¸ºå¤æ‚çš„å­ç³»ç»Ÿè°ƒç”¨æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£ï¼Œä½¿å­ç³»ç»Ÿä¸å®¢æˆ·ç«¯çš„è€¦åˆåº¦é™ä½ï¼Œä¸”å®¢æˆ·ç«¯è°ƒç”¨éå¸¸æ–¹ä¾¿ã€‚å¤–è§‚æ¨¡å¼å¹¶ä¸ç»™ç³»ç»Ÿå¢åŠ ä»»ä½•æ–°åŠŸèƒ½ï¼Œå®ƒä»…ä»…æ˜¯ç®€åŒ–è°ƒç”¨æ¥å£ã€‚\n\nåœ¨å‡ ä¹æ‰€æœ‰çš„è½¯ä»¶ä¸­éƒ½èƒ½å¤Ÿæ‰¾åˆ°å¤–è§‚æ¨¡å¼çš„åº”ç”¨ï¼Œå¦‚ç»å¤§å¤šæ•°B/Sç³»ç»Ÿéƒ½æœ‰ä¸€ä¸ªé¦–é¡µæˆ–è€…å¯¼èˆªé¡µé¢ï¼Œå¤§éƒ¨åˆ†C/Sç³»ç»Ÿéƒ½æä¾›äº†èœå•æˆ–è€…å·¥å…·æ ï¼Œåœ¨è¿™é‡Œï¼Œé¦–é¡µå’Œå¯¼èˆªé¡µé¢å°±æ˜¯B/Sç³»ç»Ÿçš„å¤–è§‚è§’è‰²ï¼Œè€Œèœå•å’Œå·¥å…·æ å°±æ˜¯C/Sç³»ç»Ÿçš„å¤–è§‚è§’è‰²ï¼Œé€šè¿‡å®ƒä»¬ç”¨æˆ·å¯ä»¥å¿«é€Ÿè®¿é—®å­ç³»ç»Ÿï¼Œé™ä½äº†ç³»ç»Ÿçš„å¤æ‚ç¨‹åº¦ã€‚æ‰€æœ‰æ¶‰åŠåˆ°ä¸å¤šä¸ªä¸šåŠ¡å¯¹è±¡äº¤äº’çš„åœºæ™¯éƒ½å¯ä»¥è€ƒè™‘ä½¿ç”¨å¤–è§‚æ¨¡å¼è¿›è¡Œé‡æ„ã€‚\n\n## ä¼˜ç‚¹\n\n1. å®ƒå¯¹å®¢æˆ·ç«¯å±è”½äº†å­ç³»ç»Ÿç»„ä»¶ï¼Œå‡å°‘äº†å®¢æˆ·ç«¯æ‰€éœ€å¤„ç†çš„å¯¹è±¡æ•°ç›®ï¼Œå¹¶ä½¿å¾—å­ç³»ç»Ÿä½¿ç”¨èµ·æ¥æ›´åŠ å®¹æ˜“ã€‚é€šè¿‡å¼•å…¥å¤–è§‚æ¨¡å¼ï¼Œå®¢æˆ·ç«¯ä»£ç å°†å˜å¾—å¾ˆç®€å•ï¼Œä¸ä¹‹å…³è”çš„å¯¹è±¡ä¹Ÿå¾ˆå°‘ã€‚\n2. å®ƒå®ç°äº†å­ç³»ç»Ÿä¸å®¢æˆ·ç«¯ä¹‹é—´çš„æ¾è€¦åˆå…³ç³»ï¼Œè¿™ä½¿å¾—å­ç³»ç»Ÿçš„å˜åŒ–ä¸ä¼šå½±å“åˆ°è°ƒç”¨å®ƒçš„å®¢æˆ·ç«¯ï¼Œåªéœ€è¦è°ƒæ•´å¤–è§‚ç±»å³å¯ã€‚\n3. ä¸€ä¸ªå­ç³»ç»Ÿçš„ä¿®æ”¹å¯¹å…¶ä»–å­ç³»ç»Ÿæ²¡æœ‰ä»»ä½•å½±å“ï¼Œè€Œä¸”å­ç³»ç»Ÿå†…éƒ¨å˜åŒ–ä¹Ÿä¸ä¼šå½±å“åˆ°å¤–è§‚å¯¹è±¡ã€‚\n\n## ç¼ºç‚¹\n\n1. ä¸èƒ½å¾ˆå¥½åœ°é™åˆ¶å®¢æˆ·ç«¯ç›´æ¥ä½¿ç”¨å­ç³»ç»Ÿç±»ï¼Œå¦‚æœå¯¹å®¢æˆ·ç«¯è®¿é—®å­ç³»ç»Ÿç±»åšå¤ªå¤šçš„é™åˆ¶åˆ™å‡å°‘äº†å¯å˜æ€§å’Œçµæ´»æ€§ã€‚\n2. å¦‚æœè®¾è®¡ä¸å½“ï¼Œå¢åŠ æ–°çš„å­ç³»ç»Ÿå¯èƒ½éœ€è¦ä¿®æ”¹å¤–è§‚ç±»çš„æºä»£ç ï¼Œè¿èƒŒäº†å¼€é—­åŸåˆ™ã€‚\n\n## é€‚ç”¨åœºæ™¯\n\nåœ¨ä»¥ä¸‹æƒ…å†µä¸‹å¯ä»¥è€ƒè™‘ä½¿ç”¨å¤–è§‚æ¨¡å¼ï¼š\n\n1. å½“è¦ä¸ºè®¿é—®ä¸€ç³»åˆ—å¤æ‚çš„å­ç³»ç»Ÿæä¾›ä¸€ä¸ªç®€å•å…¥å£æ—¶å¯ä»¥ä½¿ç”¨å¤–è§‚æ¨¡å¼ã€‚\n2. å®¢æˆ·ç«¯ç¨‹åºä¸å¤šä¸ªå­ç³»ç»Ÿä¹‹é—´å­˜åœ¨å¾ˆå¤§çš„ä¾èµ–æ€§ã€‚å¼•å…¥å¤–è§‚ç±»å¯ä»¥å°†å­ç³»ç»Ÿä¸å®¢æˆ·ç«¯è§£è€¦ï¼Œä»è€Œæé«˜å­ç³»ç»Ÿçš„ç‹¬ç«‹æ€§å’Œå¯ç§»æ¤æ€§ã€‚\n3. åœ¨å±‚æ¬¡åŒ–ç»“æ„ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¤–è§‚æ¨¡å¼å®šä¹‰ç³»ç»Ÿä¸­æ¯ä¸€å±‚çš„å…¥å£ï¼Œå±‚ä¸å±‚ä¹‹é—´ä¸ç›´æ¥äº§ç”Ÿè”ç³»ï¼Œè€Œé€šè¿‡å¤–è§‚ç±»å»ºç«‹è”ç³»ï¼Œé™ä½å±‚ä¹‹é—´çš„è€¦åˆåº¦ã€‚\n","categories":["è®¾è®¡æ¨¡å¼","ç»“æ„å‹æ¨¡å¼"]},{"title":"Linux_åº“","url":"/Linux/Linux_åº“/","content":"# å†…å®¹\n\n1. åº“æ–‡ä»¶\n2. é™æ€åº“\n3. å…±äº«åº“ï¼ˆåŠ¨æ€é“¾æ¥åº“ï¼‰\n\n# ä¸€æ®µä»£ç \n\n```c\n#include<stdio.h>\nint main()\n{\n    printf(\"hello, world!\");\n    return 0;\n}\n```\n\nä¼—æ‰€å‘¨çŸ¥ï¼Œå¼•å…¥çš„`.h`æ–‡ä»¶åªæ˜¯å¼•å…¥äº†ä¸€å †å‡½æ•°çš„å£°æ˜ï¼Œåœ¨è¿™ä¸ªæºä»£ç å’Œ`.h`æ–‡ä»¶ä¸­å¹¶æ²¡æœ‰å®ç°è¿™äº›å‡½æ•°ã€‚é‚£ä¹ˆ`printf`è°å¸®æˆ‘ä»¬å®ç°çš„å‘¢ï¼Ÿ\n\nç­”æ¡ˆå°±æ˜¯ï¼Œcç¨‹åºè‡ªåŠ¨é“¾æ¥äº†`libc.so`åº“æ–‡ä»¶ã€‚\n\n# ä¸¾ä¾‹\n\nCè¯­è¨€ç¼–ç¨‹ä¸­ç»å¸¸ä½¿ç”¨çš„`printf()`ï¼Œæ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬è‡ªå·±å®ç°çš„ï¼Œå®ƒæ˜¯åœ¨cæ ‡å‡†åº“ä¸­å®ç°çš„ã€‚cæ ‡å‡†åº“å³`libc.so`ï¼ˆåé¢å¸¦`.6`è¡¨ç¤ºç‰ˆæœ¬å·ï¼Œå¦‚`libc.so.6`ï¼‰ï¼Œæ­¤åº“æ–‡ä»¶åœ¨ç³»ç»Ÿä¸­å……å½“å…±äº«åº“ã€‚\n\nåº“ä¸­å­˜æ”¾çš„æ˜¯ä»€ä¹ˆï¼Ÿâ€”â€”é¢„å…ˆç¼–è¯‘å¥½çš„æ–¹æ³•ï¼ŒæŠŠè¿™äº›æ–¹æ³•æ‰“åŒ…ä¸ºä¸€ä¸ªé›†åˆï¼Œå°±æ˜¯åº“æ–‡ä»¶ã€‚\n\næ¯”å¦‚ï¼Œ`add.c`ã€`max.c`åˆ†åˆ«ç¼–è¯‘ä¸º`add.o`ã€`max.o`ï¼ŒæŠŠç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶æ‰“åŒ…åˆ°`libfoo.a`æˆ–`libfoo.so`ã€‚ä»¥åæˆ‘ä»¬è¦æ˜¯æƒ³ä½¿ç”¨`add.o`æˆ–`max.o`ä¸­çš„æ–¹æ³•æ—¶ï¼Œé“¾æ¥`libfoo`åº“å³å¯æˆåŠŸè°ƒç”¨ã€‚ä¸ºäº†æ–¹ä¾¿ä»–äººä½¿ç”¨ï¼Œå¾€å¾€ä¼šç»™è°ƒç”¨æ–¹å†æä¾›ä¸€ä¸ªå¤´æ–‡ä»¶`foo.h`ï¼Œä»¥å£°æ˜æ­¤åº“ä¸­åŒ…å«å“ªäº›æ¥å£ã€‚\n\n# åº“æ–‡ä»¶\n\né¢„å…ˆç¼–è¯‘å¥½çš„æ–¹æ³•ï¼ˆå‡½æ•°ï¼‰çš„é›†åˆã€‚\n\nåº“æ–‡ä»¶é€šå¸¸å­˜æ”¾åˆ°`/lib`ã€`/usr/lib`ä¸‹ã€‚\n\nå¤´æ–‡ä»¶é€šå¸¸å­˜æ”¾åˆ°`/usr/include`ä¸‹ã€‚\n\n## åº“æ–‡ä»¶ä½¿ç¼–è¯‘é“¾æ¥æ–¹ä¾¿äº†\n\n* æˆ‘ä»¬ç¼–å†™ç¬¬ä¸€ä¸ªç‰ˆæœ¬çš„ä»£ç ï¼Œåªæœ‰ä¸€ä¸ªæ–‡ä»¶`main.c`\n\n```c\n#include<stdio.h>\nint add(int a, int b);\nint main()\n{\n    int a = 10;\n    int b = 20;\n    int c = add(a, b);\n    printf(\"a + b = %d\\n\", c);\n    return 0;\n}\nint add(int a, int b)\n{\n    return a + b;\n}\n```\n\næ­¤ç‰ˆæœ¬æˆ‘ä»¬æŠŠ`add`å‡½æ•°çš„å£°æ˜ã€å®ç°å…¨éƒ¨å†™åˆ°äº†æ­¤æ–‡ä»¶ä¸­ã€‚\n\næµ‹è¯•ç¼–è¯‘é“¾æ¥â€”â€”å•æ–‡ä»¶çš„ç¼–è¯‘é“¾æ¥å¾ˆæ–¹ä¾¿ã€‚\n\n```bash\ngcc -o main main.c\n```\n\næŒ‰ä¸Šé¢è¯­å¥ç¼–è¯‘å³å¯æˆåŠŸã€‚\n\n* æˆ‘ä»¬ç¼–å†™ç¬¬äºŒä¸ªç‰ˆæœ¬çš„ä»£ç ï¼ŒæŠŠaddå‡½æ•°æŠ½å‡ºæ¥å†™åˆ°ç¬¬äºŒä¸ªæ–‡ä»¶ä¸­ã€‚\n\n```c\nint add(int a, int b)\n{\n    return a + b;\n}\n```\n\næ”¹å†™main.cï¼Œå¯¹äºaddå‡½æ•°åªåœ¨æ­¤æ–‡ä»¶ä¸­å£°æ˜\n\n```c\n#include<stdio.h>\nint add(int a, int b);\nint main()\n{\n    int a = 10;\n    int b = 20;\n    int c = add(a, b);\n    printf(\"a + b = %d\\n\", c);\n    return 0;\n}\n```\n\næ­¤æ—¶å¦‚æœå†åƒç¬¬ä¸€æ¬¡é‚£æ ·ç¼–è¯‘å°±è¡Œä¸é€šäº†`gcc -o main main.c`ï¼ŒæŠ¥é”™ï¼š\n\n![image-20220507200930308](../../images/Linux_åº“/image-20220507200930308.png)\n\nè¿™æ—¶ï¼Œå°±å¾—è¿™æ ·ç¼–è¯‘é“¾æ¥æ‰èƒ½é€šè¿‡ï¼š\n\n```bash\ngcc -o main main.c add.c\n```\n\nåé¢å¾—åŠ ä¸ª`add.c`æ‰è¡Œã€‚\n\n**è¿™æ—¶ï¼Œå°±å¾ˆæœ‰å¯èƒ½å‡ºç°äº†ä¸€ä¸ªç°è±¡ï¼šå¥½å¤šäººå¯èƒ½éƒ½éœ€è¦è°ƒç”¨`add.c`é‡Œé¢çš„å‡½æ•°**ã€‚\n\næ­¤æ—¶å‡ºç°äº†è¯¸å¤šé—®é¢˜ï¼š\n\n1. å¦‚æœç›´æ¥ç»™ä½ add.cï¼Œè¿™ä¸ªæºç å°±è¦æš´éœ²ç»™æ‰€æœ‰äººäº†ï¼Œä¸åˆ©äºéšè—ä»£ç å®ç°ç»†èŠ‚ã€‚\n2. å®é™…ä¸Šï¼Œ`gcc -o main main.c add.c`ä¸æ˜¯ä¸€æ­¥åˆ°ä½ç”Ÿæˆmainçš„ï¼Œè€Œæ˜¯éšè—äº†å¥½å¤šè¿‡ç¨‹ï¼Œå¦‚æœå¤§å®¶éƒ½è¦ç”¨add.cé‚£ä¹ˆå¤§å®¶åœ¨æ¯ä¸€æ¬¡ç”Ÿæˆmainä¹‹å‰ï¼Œéƒ½éœ€è¦å¦å¤–å…ˆç¼–è¯‘å¥½add.cï¼Œæ‰èƒ½ä¸main.oé“¾æ¥ç”Ÿæˆmainã€‚è¿™æ ·é‡å¤çš„å·¥ä½œæˆ‘ä»¬æ˜¯è¦æƒ³åŠæ³•é¿å…çš„ï¼Œå³ç›´æ¥ç»™ä½ ç¼–è¯‘å¥½çš„`.o`æ–‡ä»¶ã€‚\n\né’ˆå¯¹ä»¥ä¸Šé—®é¢˜ï¼Œæˆ‘ä»¬`gcc -c add.c`ç¼–è¯‘add.cæ–‡ä»¶ä¸º.oæ–‡ä»¶ã€‚ç›´æ¥ç»™ç”¨æˆ·ç¼–è¯‘å¥½çš„`.o`æ–‡ä»¶ï¼Œå³å¯è§£å†³æ­¤é—®é¢˜ã€‚\n\næ­¤æ—¶ï¼Œæˆ‘ä»¬è¦æƒ³é€šè¿‡`main.c`å’Œ`add.o`ç”Ÿæˆ`main`å¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œå¯ä»¥å¦‚æ­¤ï¼š\n\n```bash\ngcc -o main main.c add.o\n```\n\nç”Ÿæˆ`.o`æ–‡ä»¶è§£å†³äº†ä¸¤ä¸ªé—®é¢˜ï¼Œæ¥ä¸‹æ¥çš„é—®é¢˜ï¼š**ä»¥åæˆ‘ä»¬å¯èƒ½ä¸æ­¢æœ‰`add.o`ï¼Œè¿˜å¯èƒ½æœ‰å¾ˆå¤šå…¶ä»–çš„`.o`æ–‡ä»¶ï¼Œæ¯”å¦‚`max.o`ã€‚èƒ½ä¸èƒ½æ‰“åŒ…ä¸ºä¸€ä¸ªæ–‡ä»¶å‘¢ï¼Ÿè¿™æ ·å°±å¾ˆæ–¹ä¾¿äº†ã€‚â€”â€”è¿™å°±æ˜¯åº“æ–‡ä»¶**ã€‚\n\n# é™æ€åº“\n\n`libxx.a`ã€‚\n\nç¼–è¯‘é“¾æ¥æ—¶ï¼ŒæŠŠè¢«é“¾æ¥çš„åº“ç¨‹åºçš„ä¸€éƒ¨åˆ†åŒ…å«åˆ°è¦ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚\n\n## å¦‚ä½•ç”Ÿäº§é™æ€åº“ï¼Ÿarå‘½ä»¤\n\næˆ‘ä»¬æŠŠ`add.c`å’Œ`max.c`åšæˆä¸€ä¸ªé™æ€åº“ã€‚\n\nadd.cæ–‡ä»¶å†…å®¹ç•¥ã€‚\n\nmax.cæ–‡ä»¶ï¼š\n\n```c\nint max(int a, int b)\n{\n    return a > b ? a : b;\n}\n```\n\næŠŠä¸¤ä¸ª.cæ–‡ä»¶åˆ†åˆ«`gcc -c add.c max.c`ç”Ÿæˆäº†ä¸¤ä¸ª.oæ–‡ä»¶ã€‚\n\nç„¶åï¼Œä½¿ç”¨arå‘½ä»¤å°†æŒ‡å‡ºçš„.oæ–‡ä»¶ç”Ÿæˆé™æ€åº“ã€‚\n\n> ä¸ºä»€ä¹ˆæ˜¯arå‘¢ï¼Ÿå› ä¸ºé™æ€åº“çš„è‹±æ–‡æ˜¯archiveã€‚\n\narå‘½ä»¤æ ¼å¼ï¼š`ar [é€‰é¡¹] åº“å è‹¥å¹².oæ–‡ä»¶`\n\n| arå‘½ä»¤çš„é€‰é¡¹å‚æ•° | æ„ä¹‰       |\n| --------- | -------- |\n| c         | åˆ›å»ºåº“      |\n| r         | å°†æ–¹æ³•æ·»åŠ åˆ°åº“ä¸­ |\n| v         | æ˜¾ç¤ºè¿‡ç¨‹     |\n\nåˆ™ç”¨ä»¥ä¸‹å‘½ä»¤å³å¯æŠŠadd.oã€max.oæ‰“åŒ…ä¸ºä¸€ä¸ªé™æ€åº“æ–‡ä»¶`libfoo.a`\n\n```bash\nar crv libfoo.a add.o max.o\n```\n\næ‰§è¡Œç»“æœï¼š![image-20220507204616204](../../images/Linux_åº“/image-20220507204616204.png)\n\n## é“¾æ¥é™æ€åº“\n\næˆ‘ä»¬å½“å‰ç›®å½•ä¸‹åªæœ‰`libfoo.a`ã€`main.c`ã€‚\n\né¦–å…ˆï¼Œ`gcc -o main main.c`è‚¯å®šæ˜¯ä¸èƒ½ç¼–è¯‘é€šè¿‡çš„ã€‚\n\nå…¶æ¬¡ï¼Œ`gcc -o main main.c libfoo.a`æ˜¯å¯ä»¥ç¼–è¯‘é€šè¿‡çš„ã€‚ä½†æ˜¯è¿™ä¸æ˜¯ä¸€ä¸ªå¥½çš„åŠæ³•ï¼Œè¿™æ ·åšçš„è¯æ¯æ¬¡é“¾æ¥éœ€è¦æŠŠåº“æ–‡ä»¶æ‹·è´åˆ°å½“å‰ç›®å½•ï¼Œè€Œä¸”è¿˜éœ€è¦æ‰“å‡ºåº“çš„å…¨åã€‚\n\n* æ ‡å‡†çš„åšæ³•ï¼š`-L`æŒ‡æ˜åº“æ‰€åœ¨çš„ç›®å½•ï¼Œ`-l`æŒ‡æ˜ä½ è¦é“¾æ¥çš„åº“åã€‚\n  * åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œåº“æ‰€åœ¨çš„ç›®å½•æ˜¯`.`ï¼›åº“åä¸º`foo`ï¼Œå³`\"lib\"`çš„ååŠéƒ¨åˆ†ï¼Œä¸å¸¦`.a`ã€‚\n\n```bash\ngcc -o main main.c -L. -lfoo\n```\n\n## åº“æ–‡ä»¶åŠå…¶å¤´æ–‡ä»¶æ ‡å‡†ç›®å½•\n\næˆ‘ä»¬ä¸ºäº†ç»™è°ƒç”¨è€…å£°æ˜å®ƒå¯ä»¥é€šè¿‡æŸåº“æ–‡ä»¶è°ƒç”¨å“ªäº›å‡½æ•°ï¼Œéœ€è¦å¦å¤–ç¼–å†™ä¸€ä¸ª`foo.h`å¤´æ–‡ä»¶ã€‚\n\n**æ³¨æ„ï¼Œåœ¨ç¼–å†™`.c`æ–‡ä»¶æ—¶ï¼Œéœ€è¦`#include<foo.h>`**ï¼Œå¦‚æ­¤å°±ä¸ç”¨ä¸€ä¸ªä¸ªè‡ªå·±å£°æ˜å‡½æ•°äº†ã€‚\n\nfoo.hæ–‡ä»¶\n\n```c\nint add(int a, int b);\nint max(int a, int b);\n```\n\næ”¹å†™main.cæ–‡ä»¶\n\n```c\n#include<stdio.h>\n#include<foo.h>\nint main()\n{\n    int a = 10;\n    int b = 20;\n    int c = add(a, b);\t// addå‡½æ•°å·²ç»å£°æ˜äºfoo.h\n    printf(\"a + b = %d\\n\", c);\n    return 0;\n}\n```\n\n* æ ‡å‡†ç›®å½•\n\næ ‡å‡†çš„ä½ç½®ï¼ŒåŒæ—¶æ˜¯`gcc`ç¨‹åºé“¾æ¥æ—¶é»˜è®¤æ‰«æçš„ä½ç½®æ˜¯`/usr/include`ã€‚\n\nç›¸åº”çš„åº“æ–‡ä»¶çš„é»˜è®¤æ‰«æä½ç½®ï¼Œ`/lib`ã€`/usr/lib`ã€‚\n\næˆ‘ä»¬æŠŠæˆ‘ä»¬è‡ªå·±ç¼–å†™çš„`foo.h`å’Œ`libfoo.a`ç§»åˆ°æ ‡å‡†ç›®å½•ã€‚\n\n```bash\nsu root\nmv foo.h /usr/include\nmv libfoo.a /usr/lib\n```\n\nç°åœ¨çš„ç¼–è¯‘é“¾æ¥è¿‡ç¨‹ï¼Œç”±äºå¤´æ–‡ä»¶ã€åº“æ–‡ä»¶éƒ½åœ¨æ ‡å‡†ç›®å½•åº•ä¸‹ï¼Œå¯ä»¥ä¸åŠ `-L`å‚æ•°ï¼Œä½†æ˜¯ä»ç„¶å¿…é¡»åœ¨åé¢æŒ‡å®š`-låº“å`ï¼Œå³`-lfoo`ï¼Œä¾¿å¯ç¼–è¯‘é“¾æ¥æˆåŠŸã€‚\n\n**æ³¨æ„ï¼šé™¤äº†é“¾æ¥`libc.so`cæ ‡å‡†åº“ï¼Œ`-l`é€šå¸¸ä¸å¯çœç•¥ï¼Œè¿™å°±ç›¸å½“äºcæ ‡å‡†åº“æ˜¯ç³»ç»Ÿäº²ç”Ÿçš„ï¼Œç”¨å¾—å¾ˆå¤šï¼Œå°±é»˜è®¤å¯ä»¥çœç•¥ã€‚**\n\n```bash\ngcc -o main main.c -lfoo\n```\n\n\n\n# åŠ¨æ€åº“\n\n`libxx.so`ã€‚\n\nç¼–è¯‘é“¾æ¥æ—¶ï¼Œä¸ä¼šæŠŠè¢«é“¾æ¥çš„åº“ç¨‹åºçš„ä¸€éƒ¨åˆ†åŒ…å«åˆ°è¦ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚åªåšä¸€ä¸ªæ ‡è®°ï¼ŒåªéªŒè¯é“¾æ¥çš„åº“æœ‰æ²¡æœ‰é—®é¢˜ã€‚ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°åŠ è½½åŠ¨æ€åº“å»è¿è¡Œï¼Œæ‰€ä»¥åŠ¨æ€åº“ä¸€æ—¦åˆ é™¤åˆ™æ— æ³•è¿è¡Œã€‚\n\nå†å›åˆ°é‚£ä¸ªä¼—äººçš†çŸ¥çš„ä»£ç ã€‚\n\n```c\n#include<stdio.h>\nint main()\n{\n    printf(\"hello, world!\");\n    return 0;\n}\n```\n\næˆ‘ä»¬ç¼–è¯‘å®ƒã€‚\n\n```bash\ngcc -o main main.c\n```\n\næ€ä¹ˆè¯æ˜`main`ç¨‹åºé“¾æ¥äº†`libc.so`åº“æ–‡ä»¶å‘¢ï¼Ÿ\n\n## lddå‘½ä»¤\n\n`ldd`å‘½ä»¤å¯ä»¥æŸ¥çœ‹ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶ç¨‹åºéœ€è¦é“¾æ¥çš„åº“æ–‡ä»¶ä¿¡æ¯ã€‚\n\n```bash\nldd main\n```\n\næˆ‘ä»¬çš„mainç¨‹åºä½¿ç”¨åˆ°äº†`printf`çš„åº“ï¼Œå³`libc.so`ï¼Œbashä¸‹è¾“å…¥`ldd main`çš„ç»“æœæ˜¯ï¼š\n\n![image-20220507194717251](../../images/Linux_åº“/image-20220507194717251.png)\n\n## å¦‚ä½•ç”Ÿäº§åŠ¨æ€åº“ï¼Ÿ\n\næˆ‘ä»¬æŠŠ`add.o`å’Œ`max.o`åšæˆä¸€ä¸ªåŠ¨æ€åº“ã€‚\n\nç”ŸæˆåŠ¨æ€åº“ï¼Œä½¿ç”¨çš„æ˜¯gccå‘½ä»¤ã€‚\n\n```bash\ngcc -shared -fPIC -o libfoo.so add.o max.o\n```\n\nå…¶ä¸­ï¼Œ`-shared`å‚æ•°è¡¨ç¤ºäº§ç”Ÿå…±äº«å¯¹è±¡ï¼Œ`-fPIC`ï¼š\n\n## é“¾æ¥åŠ¨æ€åº“\n\næš‚ä¸”å¦‚ä¸‹ç¼–è¯‘é“¾æ¥main.cç¨‹åº\n\n```bash\ngcc -o main main.c ./libfoo.so\n```\n\nè¿™æ ·å¾—åˆ°äº†ä¸€ä¸ªç¨‹åº`main`ï¼Œæ­¤ç¨‹åºä½¿ç”¨äº†`libfoo.so`é‡Œé¢çš„`add`å‡½æ•°ã€‚ä»`main.c`çš„è§’åº¦çœ‹ï¼Œè‡ªå·±è¢«é“¾æ¥æˆä¸ºå¯æ‰§è¡Œæ–‡ä»¶çš„è¿™ä¸€æ­¥ï¼Œåœ¨ä¹‹å‰çš„é™æ€é“¾æ¥ä¸­ä¼šæŠŠ`main.o`å’Œ`libfoo.so`ç»“åˆåˆ°ä¸€èµ·ã€‚ä½†æ˜¯åœ¨åŠ¨æ€é“¾æ¥é‡Œï¼Œ`libfoo.so`æ²¡æœ‰è¢«é“¾æ¥è¿›æ¥ï¼Œé“¾æ¥çš„è¾“å…¥ç›®æ ‡æ–‡ä»¶åªæœ‰`main.o`ï¼ˆå½“ç„¶è¿˜æœ‰Cè¯­è¨€è¿è¡Œåº“ï¼Œæˆ‘ä»¬è¿™é‡Œæš‚æ—¶å¿½ç•¥ï¼‰ã€‚ä½†æ˜¯ä¸Šé¢gccçš„å‘½ä»¤è¡Œä¸­ï¼Œåé¢ä¹ŸåŠ ä¸Šäº†`./libfoo.so`è¿™æ˜¯å’‹å›äº‹ï¼Ÿ\n\n> **å…³äºæ¨¡å—**\n>\n> åœ¨é™æ€é“¾æ¥æ—¶ï¼Œæ•´ä¸ªç¨‹åºæœ€ç»ˆåªæœ‰ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ•´ä½“ï¼›\n>\n> ä½†åœ¨åŠ¨æ€é“¾æ¥ä¸‹ï¼Œä¸€ä¸ªç¨‹åºè¢«åˆ†æˆäº†è‹¥å¹²ä¸ªæ–‡ä»¶ï¼Œæœ‰ç¨‹åºçš„ä¸»è¦éƒ¨åˆ†ï¼Œå³å¯æ‰§è¡Œæ–‡ä»¶`main`å’Œç¨‹åºæ‰€ä¾èµ–çš„å…±äº«å¯¹è±¡`libfoo.so`ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬æŠŠè¿™äº›éƒ¨åˆ†ç§°ä¸ºæ¨¡å—ï¼Œå³åŠ¨æ€é“¾æ¥ä¸‹çš„å¯æ‰§è¡Œæ–‡ä»¶å’Œå…±äº«å¯¹è±¡éƒ½å¯çœ‹ä½œæ˜¯ç¨‹åºçš„æ¨¡å—ã€‚\n\n## åŠ¨æ€é“¾æ¥çš„åŸç†ç»†èŠ‚\n\nè°ˆè°ˆåŠ¨æ€é“¾æ¥çš„æœºåˆ¶ï¼Œå½“ç¨‹åºæ¨¡å—`main.c`è¢«ç¼–è¯‘æˆä¸º`main.o`æ—¶ï¼Œç¼–è¯‘å™¨è¿˜ä¸çŸ¥é“`add`å‡½æ•°çš„åœ°å€ã€‚å½“é“¾æ¥å™¨å°†`main.o`é“¾æ¥æˆå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œè¿™æ—¶å€™**é“¾æ¥å™¨å¿…é¡»ç¡®å®š`main.o`ä¸­æ‰€å¼•ç”¨çš„`add`å‡½æ•°çš„æ€§è´¨**ï¼š\n\n1. å¦‚æœ`add`æ˜¯ä¸€ä¸ªå®šä¹‰äºå…¶ä»–é™æ€ç›®æ ‡æ¨¡å—ä¸­çš„å‡½æ•°ï¼Œé‚£ä¹ˆé“¾æ¥å™¨å°†ä¼šæŒ‰ç…§é™æ€é“¾æ¥çš„è§„åˆ™ï¼Œå°†`main.o`ä¸­çš„`add`åœ°å€å¼•ç”¨**é‡å®šä½**ï¼›\n2. å¦‚æœ`add`æ˜¯ä¸€ä¸ªå®šä¹‰åœ¨æŸä¸ªåŠ¨æ€å…±äº«å¯¹è±¡ä¸­çš„å‡½æ•°ï¼Œ**é‚£ä¹ˆé“¾æ¥å™¨å°±ä¼šå°†è¿™ä¸ªç¬¦å·çš„å¼•ç”¨æ ‡è®°ä¸ºä¸€ä¸ªåŠ¨æ€é“¾æ¥çš„ç¬¦å·ï¼Œä¸å¯¹å®ƒè¿›è¡Œåœ°å€é‡å®šä½ï¼ŒæŠŠè¿™ä¸ªè¿‡ç¨‹ç•™åˆ°è£…è½½æ—¶å†è¿›è¡Œ**ã€‚\n\né‚£ä¹ˆè¿™é‡Œå°±æœ‰ä¸ªé—®é¢˜ï¼Œé“¾æ¥å™¨å¦‚ä½•çŸ¥é“`add`çš„å¼•ç”¨æ˜¯ä¸€ä¸ªé™æ€ç¬¦å·è¿˜æ˜¯ä¸€ä¸ªåŠ¨æ€ç¬¦å·ï¼Ÿè¿™å®é™…ä¸Šå°±æ˜¯æˆ‘ä»¬çš„gccå‘½ä»¤åé¢è¦å†™`libfoo.so`çš„åŸå› ã€‚`libfoo.so`ä¸­ä¿å­˜äº†å®Œæ•´çš„ç¬¦å·ä¿¡æ¯ï¼ˆå› ä¸ºè¿è¡Œæ—¶è¿›è¡ŒåŠ¨æ€é“¾æ¥è¿˜é¡»ä½¿ç”¨ç¬¦å·ä¿¡æ¯)ï¼ŒæŠŠ`libfoo.so`ä¹Ÿä½œä¸ºé“¾æ¥çš„è¾“å…¥æ–‡ä»¶ä¹‹ä¸€ï¼Œé“¾æ¥å™¨åœ¨è§£æç¬¦å·æ—¶å°±å¯ä»¥çŸ¥é“ï¼š`add`æ˜¯ä¸€ä¸ªå®šä¹‰åœ¨`libfoo.so`çš„åŠ¨æ€ç¬¦å·ã€‚è¿™æ ·é“¾æ¥å™¨å°±å¯ä»¥å¯¹`add`çš„å¼•ç”¨åšç‰¹æ®Šçš„å¤„ç†ï¼Œä½¿å®ƒæˆä¸ºä¸€ä¸ªå¯¹åŠ¨æ€ç¬¦å·çš„å¼•ç”¨ã€‚\n\n## åŠ¨æ€é“¾æ¥ç¨‹åºè¿è¡Œæ—¶åœ°å€ç©ºé—´åˆ†å¸ƒ\n\nå¯¹äºé™æ€é“¾æ¥çš„å¯æ‰§è¡Œæ–‡ä»¶æ¥è¯´ï¼Œæ•´ä¸ªè¿›ç¨‹åªæœ‰ä¸€ä¸ªæ–‡ä»¶è¦è¢«æ˜ å°„ï¼Œé‚£å°±æ˜¯å¯æ‰§è¡Œæ–‡ä»¶æœ¬èº«ï¼Œé™æ€é“¾æ¥ä¸‹çš„è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´çš„åˆ†å¸ƒå¾ˆæ¸…æ™°æ˜äº†ã€‚ä½†æ˜¯å¯¹äºåŠ¨æ€é“¾æ¥æ¥è¯´ï¼Œé™¤äº†å¯æ‰§è¡Œæ–‡ä»¶æœ¬èº«ä¹‹å¤–ï¼Œè¿˜æœ‰å®ƒæ‰€ä¾èµ–çš„å…±äº«ç›®æ ‡æ–‡ä»¶ã€‚é‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹ï¼Œè¿›ç¨‹çš„åœ°å€ç©ºé—´åˆ†å¸ƒåˆä¼šæ€æ ·å‘¢ï¼Ÿ\n\næˆ‘ä»¬è¿˜æ˜¯ä»¥ä¸Šé¢çš„ç¨‹åºä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯¹ç¨‹åºåšé€‚å½“çš„ä¿®æ”¹ï¼Œåœ¨`main.c`ä¸­é‡Œé¢è°ƒç”¨`sleep`å‡½æ•°ã€‚\n\n```bash\nxcg@instance-bkdrtyrm:~/ld-learn$ ./main &\n[1] 764261\nxcg@instance-bkdrtyrm:~/ld-learn$ 10 + 20 = 30\ncat /proc/764261/maps \n55f2437e2000-55f2437e3000 r--p 00000000 fc:01 1201223            /home/xcg/ld-learn/main\n55f2437e3000-55f2437e4000 r-xp 00001000 fc:01 1201223            /home/xcg/ld-learn/main\n55f2437e4000-55f2437e5000 r--p 00002000 fc:01 1201223            /home/xcg/ld-learn/main\n55f2437e5000-55f2437e6000 r--p 00002000 fc:01 1201223            /home/xcg/ld-learn/main\n55f2437e6000-55f2437e7000 rw-p 00003000 fc:01 1201223            /home/xcg/ld-learn/main\n55f244377000-55f244398000 rw-p 00000000 00:00 0                  [heap]\n7f814f30e000-7f814f311000 rw-p 00000000 00:00 0 \n7f814f311000-7f814f333000 r--p 00000000 fc:01 394589             /usr/lib/x86_64-linux-gnu/libc-2.31.so\n7f814f333000-7f814f4ab000 r-xp 00022000 fc:01 394589             /usr/lib/x86_64-linux-gnu/libc-2.31.so\n7f814f4ab000-7f814f4f9000 r--p 0019a000 fc:01 394589             /usr/lib/x86_64-linux-gnu/libc-2.31.so\n7f814f4f9000-7f814f4fd000 r--p 001e7000 fc:01 394589             /usr/lib/x86_64-linux-gnu/libc-2.31.so\n7f814f4fd000-7f814f4ff000 rw-p 001eb000 fc:01 394589             /usr/lib/x86_64-linux-gnu/libc-2.31.so\n7f814f4ff000-7f814f503000 rw-p 00000000 00:00 0 \n7f814f50b000-7f814f50c000 r--p 00000000 fc:01 1201222            /home/xcg/ld-learn/libfoo.so\n7f814f50c000-7f814f50d000 r-xp 00001000 fc:01 1201222            /home/xcg/ld-learn/libfoo.so\n7f814f50d000-7f814f50e000 r--p 00002000 fc:01 1201222            /home/xcg/ld-learn/libfoo.so\n7f814f50e000-7f814f50f000 r--p 00002000 fc:01 1201222            /home/xcg/ld-learn/libfoo.so\n7f814f50f000-7f814f510000 rw-p 00003000 fc:01 1201222            /home/xcg/ld-learn/libfoo.so\n7f814f510000-7f814f512000 rw-p 00000000 00:00 0 \n7f814f512000-7f814f513000 r--p 00000000 fc:01 394574             /usr/lib/x86_64-linux-gnu/ld-2.31.so\n7f814f513000-7f814f536000 r-xp 00001000 fc:01 394574             /usr/lib/x86_64-linux-gnu/ld-2.31.so\n7f814f536000-7f814f53e000 r--p 00024000 fc:01 394574             /usr/lib/x86_64-linux-gnu/ld-2.31.so\n7f814f53f000-7f814f540000 r--p 0002c000 fc:01 394574             /usr/lib/x86_64-linux-gnu/ld-2.31.so\n7f814f540000-7f814f541000 rw-p 0002d000 fc:01 394574             /usr/lib/x86_64-linux-gnu/ld-2.31.so\n7f814f541000-7f814f542000 rw-p 00000000 00:00 0 \n7ffc5ff25000-7ffc5ff46000 rw-p 00000000 00:00 0                  [stack]\n7ffc5fff5000-7ffc5fff8000 r--p 00000000 00:00 0                  [vvar]\n7ffc5fff8000-7ffc5fff9000 r-xp 00000000 00:00 0                  [vdso]\nffffffffff600000-ffffffffff601000 --xp 00000000 00:00 0          [vsyscall]\n```\n\næˆ‘ä»¬çœ‹åˆ°ï¼Œæ•´ä¸ªè¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ï¼Œå¤šå‡ºäº†å‡ ä¸ªæ–‡ä»¶çš„æ˜ å°„ï¼š\n\n1. `libfoo.so`ä¸`main`ä¸€æ ·ï¼Œå®ƒä»¬éƒ½æ˜¯è¢«æ“ä½œç³»ç»Ÿç”¨åŒæ ·çš„æ–¹æ³•æ˜ å°„è‡³è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œåªæ˜¯**å®ƒä»¬å æ®çš„è™šæ‹Ÿåœ°å€å’Œé•¿åº¦ä¸åŒ**ã€‚\n2. `main`é™¤äº†ä½¿ç”¨`libfoo.so`ä»¥å¤–ï¼Œå®ƒè¿˜ç”¨åˆ°äº†åŠ¨æ€é“¾æ¥å½¢å¼çš„Cè¯­è¨€è¿è¡Œåº“`libc-2.31.so`ã€‚\n\n3. å¦å¤–è¿˜æœ‰ä¸€ä¸ªå¾ˆå€¼å¾—å…³æ³¨çš„å…±äº«å¯¹è±¡å°±æ˜¯`ld-2.31.so`ï¼Œå®ƒå®é™…ä¸Šæ˜¯Linuxä¸‹çš„åŠ¨æ€é“¾æ¥å™¨ã€‚åŠ¨æ€é“¾æ¥å™¨ä¸æ™®é€šå…±äº«å¯¹è±¡ä¸€æ ·è¢«æ˜ å°„åˆ°äº†è¿›ç¨‹çš„åœ°å€ç©ºé—´ã€‚\n\nåœ¨ç³»ç»Ÿå¼€å§‹è¿è¡Œ`main`ä¹‹å‰ï¼Œé¦–å…ˆä¼šæŠŠæ§åˆ¶æƒäº¤ç»™åŠ¨æ€é“¾æ¥å™¨ï¼Œç”±å®ƒå®Œæˆæ‰€æœ‰çš„åŠ¨æ€é“¾æ¥å·¥ä½œä»¥åå†æŠŠæ§åˆ¶æƒäº¤ç»™`main`ï¼Œç„¶åå¼€å§‹æ‰§è¡Œã€‚\n\næˆ‘ä»¬é€šè¿‡readelfå·¥å…·æ¥æŸ¥çœ‹`libfoo.so`çš„è£…è½½å±æ€§ï¼Œå°±å¦‚æˆ‘ä»¬åœ¨å‰é¢æŸ¥çœ‹æ™®é€šç¨‹åºä¸€æ ·ï¼š\n\n```bash\nreadelf -l libfoo.so\n```\n\n```bash\nxcg@instance-bkdrtyrm:~/ld-learn$ readelf -l libfoo.so \n\nElf file type is DYN (Shared object file)\nEntry point 0x1040\nThere are 11 program headers, starting at offset 64\n\nProgram Headers:\n  Type           Offset             VirtAddr           PhysAddr\n                 FileSiz            MemSiz              Flags  Align\n  LOAD           0x0000000000000000 0x0000000000000000 0x0000000000000000\n                 0x00000000000004c8 0x00000000000004c8  R      0x1000\n  LOAD           0x0000000000001000 0x0000000000001000 0x0000000000001000\n                 0x0000000000000139 0x0000000000000139  R E    0x1000\n  LOAD           0x0000000000002000 0x0000000000002000 0x0000000000002000\n                 0x00000000000000cc 0x00000000000000cc  R      0x1000\n  LOAD           0x0000000000002e80 0x0000000000003e80 0x0000000000003e80\n                 0x00000000000001a0 0x00000000000001a8  RW     0x1000\n  DYNAMIC        0x0000000000002e90 0x0000000000003e90 0x0000000000003e90\n                 0x0000000000000150 0x0000000000000150  RW     0x8\n  NOTE           0x00000000000002a8 0x00000000000002a8 0x00000000000002a8\n                 0x0000000000000020 0x0000000000000020  R      0x8\n  NOTE           0x00000000000002c8 0x00000000000002c8 0x00000000000002c8\n                 0x0000000000000024 0x0000000000000024  R      0x4\n  GNU_PROPERTY   0x00000000000002a8 0x00000000000002a8 0x00000000000002a8\n                 0x0000000000000020 0x0000000000000020  R      0x8\n  GNU_EH_FRAME   0x0000000000002000 0x0000000000002000 0x0000000000002000\n                 0x000000000000002c 0x000000000000002c  R      0x4\n  GNU_STACK      0x0000000000000000 0x0000000000000000 0x0000000000000000\n                 0x0000000000000000 0x0000000000000000  RW     0x10\n  GNU_RELRO      0x0000000000002e80 0x0000000000003e80 0x0000000000003e80\n                 0x0000000000000180 0x0000000000000180  R      0x1\n\n Section to Segment mapping:\n  Segment Sections...\n   00     .note.gnu.property .note.gnu.build-id .gnu.hash .dynsym .dynstr .rela.dyn \n   01     .init .plt .plt.got .text .fini \n   02     .eh_frame_hdr .eh_frame \n   03     .init_array .fini_array .dynamic .got .got.plt .data .bss \n   04     .dynamic \n   05     .note.gnu.property \n   06     .note.gnu.build-id \n   07     .note.gnu.property \n   08     .eh_frame_hdr \n   09     \n   10     .init_array .fini_array .dynamic .got\n```\n\nåŠ¨æ€åº“æ–‡ä»¶é™¤äº†æ–‡ä»¶çš„ç±»å‹ä¸æ™®é€šç¨‹åºä¸åŒä»¥å¤–ï¼Œå…¶ä»–å‡ ä¹ä¸æ™®é€šç¨‹åºä¸€æ ·ã€‚æœ‰ä¸€ç‚¹æ¯”è¾ƒä¸åŒçš„æ˜¯ï¼Œ**åŠ¨æ€é“¾æ¥æ¨¡å—çš„è£…è½½åœ°å€æ˜¯ä»åœ°å€`0x00000000`å¼€å§‹çš„**ã€‚æˆ‘ä»¬çŸ¥é“è¿™ä¸ªåœ°å€æ˜¯æ— æ•ˆåœ°å€ï¼Œå¹¶ä¸”ä»**ä¸Šé¢çš„è¿›ç¨‹è™šæ‹Ÿç©ºé—´åˆ†å¸ƒçœ‹åˆ°ï¼Œ`libfoo.so`çš„æœ€ç»ˆè£…è½½åœ°å€å¹¶ä¸æ˜¯`0x00000000`ï¼Œè€Œæ˜¯å…¶ä»–å…·ä½“å€¼**ã€‚ä»è¿™ä¸€ç‚¹æˆ‘ä»¬å¯ä»¥æ¨æ–­ï¼Œ**å…±äº«å¯¹è±¡çš„æœ€ç»ˆè£…è½½åœ°å€åœ¨ç¼–è¯‘æ—¶æ˜¯ä¸ç¡®å®šçš„**ï¼Œè€Œ**æ˜¯åœ¨è£…è½½æ—¶ï¼Œè£…è½½å™¨æ ¹æ®å½“å‰åœ°å€ç©ºé—´çš„ç©ºé—²æƒ…å†µï¼ŒåŠ¨æ€åˆ†é…ä¸€å—è¶³å¤Ÿå¤§å°çš„è™šæ‹Ÿåœ°å€ç©ºé—´ç»™ç›¸åº”çš„å…±äº«å¯¹è±¡**ã€‚\n\nå½“ç„¶ï¼Œè¿™ä»…ä»…æ˜¯ä¸€ä¸ªæ¨æ–­ï¼Œè‡³äºä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Œä¸ºä»€ä¹ˆä¸å°†æ¯ä¸ªå…±äº«å¯¹è±¡åœ¨è¿›ç¨‹ä¸­çš„åœ°å€å›ºå®šï¼Œæˆ–è€…åœ¨çœŸæ­£çš„ç³»ç»Ÿä¸­æ˜¯æ€ä¹ˆè¿ä½œçš„ï¼Ÿ\n\n## è£…è½½åœ°å€\n\næˆ‘ä»¬è®¾æƒ³æ˜¯å¦å¯ä»¥è®©å…±äº«å¯¹è±¡åœ¨ä»»æ„åœ°å€åŠ è½½ï¼Ÿè¿™ä¸ªé—®é¢˜å¦ä¸€ç§è¡¨è¿°æ–¹æ³•å°±æ˜¯ï¼šå…±äº«å¯¹è±¡åœ¨ç¼–è¯‘æ—¶ä¸èƒ½å‡è®¾è‡ªå·±åœ¨è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„ä½ç½®ã€‚ä¸æ­¤ä¸åŒçš„æ˜¯ï¼Œå¯æ‰§è¡Œæ–‡ä»¶åŸºæœ¬å¯ä»¥ç¡®å®šè‡ªå·±åœ¨è¿›ç¨‹è™šæ‹Ÿç©ºé—´ä¸­çš„èµ·å§‹ä½ç½®ï¼Œå› ä¸ºå¯æ‰§è¡Œæ–‡ä»¶å¾€å¾€æ˜¯ç¬¬ä¸€ä¸ªè¢«åŠ è½½çš„æ–‡ä»¶ï¼Œå®ƒå¯ä»¥é€‰æ‹©ä¸€ä¸ªå›ºå®šç©ºé—²çš„åœ°å€ï¼Œæ¯”å¦‚Linuxä¸‹ä¸€èˆ¬éƒ½æ˜¯0x08040000ï¼ŒWindowsä¸‹ä¸€èˆ¬éƒ½æ˜¯0x0040000ã€‚\n\n### è£…è½½æ—¶é‡å®šä½\n\nä¸ºäº†èƒ½å¤Ÿä½¿å…±äº«å¯¹è±¡åœ¨ä»»æ„åœ°å€è£…è½½ï¼Œæˆ‘ä»¬é¦–å…ˆèƒ½æƒ³åˆ°çš„æ–¹æ³•å°±æ˜¯é™æ€é“¾æ¥ä¸­çš„é‡å®šä½ã€‚è¿™ä¸ªæƒ³æ³•çš„åŸºæœ¬æ€è·¯æ˜¯åœ¨é“¾æ¥æ—¶ï¼Œå¯¹æ‰€æœ‰ç»å¯¹åœ°å€çš„å¼•ç”¨ä¸ä½œé‡å®šä½ï¼Œè€ŒæŠŠè¿™ä¸€æ­¥æ¨è¿Ÿåˆ°è£…è½½æ—¶å†å®Œæˆã€‚ä¸€æ—¦æ¨¡å—è£…è½½åœ°å€ç¡®å®šï¼Œå³ç›®æ ‡åœ°å€ç¡®å®šï¼Œé‚£ä¹ˆç³»ç»Ÿå°±å¯¹ç¨‹åºä¸­æ‰€æœ‰çš„ç»å¯¹åœ°å€å¼•ç”¨è¿›è¡Œé‡å®šä½ã€‚å‡è®¾å‡½æ•°`add`ç›¸å¯¹äºä»£ç æ®µçš„èµ·å§‹åœ°å€æ˜¯0x100ï¼Œå½“æ¨¡å—è¢«è£…è½½åˆ°0x10000000æ—¶ï¼Œæˆ‘ä»¬å‡è®¾ä»£ç æ®µä½äºæ¨¡å—çš„æœ€å¼€å§‹ï¼Œå³ä»£ç æ®µçš„è£…è½½åœ°å€ä¹Ÿæ˜¯0x10000000ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç¡®å®š`add`çš„åœ°å€ä¸º0x10000100ã€‚è¿™æ—¶å€™ï¼Œç³»ç»Ÿéå†æ¨¡å—ä¸­çš„é‡å®šä½è¡¨ï¼ŒæŠŠæ‰€æœ‰å¯¹`add`çš„åœ°å€å¼•ç”¨éƒ½é‡å®šä½è‡³0x10000100ã€‚\n\näº‹å®ä¸Šï¼Œç±»ä¼¼çš„æ–¹æ³•åœ¨å¾ˆæ—©ä»¥å‰å°±å­˜åœ¨ã€‚æ—©åœ¨æ²¡æœ‰è™šæ‹Ÿå­˜å‚¨æ¦‚å¿µçš„æƒ…å†µä¸‹ï¼Œç¨‹åºæ˜¯ç›´æ¥è¢«è£…è½½è¿›ç‰©ç†å†…å­˜çš„ã€‚å½“åŒæ—¶æœ‰å¤šä¸ªç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿæ ¹æ®å½“æ—¶å†…å­˜ç©ºé—²æƒ…å†µï¼ŒåŠ¨æ€åˆ†é…ä¸€å—å¤§å°åˆé€‚çš„ç‰©ç†å†…å­˜ç»™ç¨‹åºï¼Œæ‰€ä»¥ç¨‹åºè¢«è£…è½½çš„åœ°å€æ˜¯ä¸ç¡®å®šçš„ã€‚ç³»ç»Ÿåœ¨è£…è½½ç¨‹åºçš„æ—¶å€™éœ€è¦å¯¹ç¨‹åºçš„æŒ‡ä»¤å’Œæ•°æ®ä¸­å¯¹ç»å¯¹åœ°å€çš„å¼•ç”¨è¿›è¡Œé‡å®šä½ã€‚ä½†è¿™ç§é‡å®šä½æ¯”å‰é¢æåˆ°è¿‡çš„é™æ€é“¾æ¥ä¸­çš„é‡å®šä½è¦ç®€å•å¾—å¤šï¼Œå› ä¸ºæ•´ä¸ªç¨‹åºæ˜¯æŒ‰ç…§ä¸€ä¸ªæ•´ä½“è¢«åŠ è½½çš„ï¼Œç¨‹åºä¸­æŒ‡ä»¤å’Œæ•°æ®çš„ç›¸å¯¹ä½ç½®æ˜¯ä¸ä¼šæ”¹å˜çš„ã€‚æ¯”å¦‚ä¸€ä¸ªç¨‹åºåœ¨ç¼–è¯‘æ—¶å‡è®¾è¢«è£…è½½çš„ç›®æ ‡åœ°å€ä¸º0x1000ï¼Œä½†æ˜¯åœ¨è£…è½½æ—¶æ“ä½œç³»ç»Ÿå‘ç°0x1000è¿™ä¸ªåœ°å€å·²ç»è¢«åˆ«çš„ç¨‹åºä½¿ç”¨äº†ï¼Œä»0x4000å¼€å§‹æœ‰ä¸€å—è¶³å¤Ÿå¤§çš„ç©ºé—´å¯ä»¥å®¹çº³è¯¥ç¨‹åºï¼Œé‚£ä¹ˆè¯¥ç¨‹åºå°±å¯ä»¥è¢«è£…è½½è‡³0x4000ï¼Œç¨‹åºæŒ‡ä»¤æˆ–æ•°æ®ä¸­çš„æ‰€æœ‰ç»å¯¹å¼•ç”¨åªè¦éƒ½åŠ ä¸Š0x3000çš„åç§»é‡å°±å¯ä»¥äº†ã€‚\n\næˆ‘ä»¬å‰é¢åœ¨é™æ€é“¾æ¥æ—¶æåˆ°è¿‡é‡å®šä½ï¼Œé‚£æ—¶çš„é‡å®šä½å«åš**é“¾æ¥æ—¶é‡å®šä½**(Link Time Relocation)ï¼Œè€Œç°åœ¨è¿™ç§æƒ…å†µç»å¸¸è¢«ç§°ä¸º**è£…è½½æ—¶é‡å®šä½**(Load Time Relocation)ã€‚åœ¨Windowsä¸­ï¼Œè¿™ç§è£…è½½æ—¶é‡å®šä½åˆè¢«å«åš**åŸºå€é‡ç½®**(Rebasing)ã€‚\n\nè¿™ç§æƒ…å†µä¸æˆ‘ä»¬ç¢°åˆ°çš„é—®é¢˜å¾ˆç›¸ä¼¼ï¼Œ**éƒ½æ˜¯ç¨‹åºæ¨¡å—åœ¨ç¼–è¯‘æ—¶ç›®æ ‡åœ°å€ä¸ç¡®å®šè€Œéœ€è¦åœ¨è£…è½½æ—¶å°†æ¨¡å—é‡å®šä½**ã€‚ä½†æ˜¯è£…è½½æ—¶é‡å®šä½çš„æ–¹æ³•å¹¶ä¸é€‚åˆç”¨æ¥è§£å†³ä¸Šé¢çš„å…±äº«å¯¹è±¡ä¸­æ‰€å­˜åœ¨çš„é—®é¢˜ã€‚å¯ä»¥æƒ³è±¡ï¼ŒåŠ¨æ€é“¾æ¥æ¨¡å—è¢«è£…è½½æ˜ å°„è‡³è™šæ‹Ÿç©ºé—´åï¼ŒæŒ‡ä»¤éƒ¨åˆ†æ˜¯åœ¨å¤šä¸ªè¿›ç¨‹ä¹‹é—´å…±äº«çš„ï¼Œ**ç”±äºè£…è½½æ—¶é‡å®šä½çš„æ–¹æ³•éœ€è¦ä¿®æ”¹æŒ‡ä»¤ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•åšåˆ°åŒä¸€ä»½æŒ‡ä»¤è¢«å¤šä¸ªè¿›ç¨‹å…±äº«ï¼Œå› ä¸ºæŒ‡ä»¤è¢«é‡å®šä½åå¯¹äºæ¯ä¸ªè¿›ç¨‹æ¥è®²æ˜¯ä¸åŒçš„**ã€‚å½“ç„¶ï¼ŒåŠ¨æ€è¿æ¥åº“ä¸­çš„å¯ä¿®æ”¹æ•°æ®éƒ¨åˆ†å¯¹äºä¸åŒçš„è¿›ç¨‹æ¥è¯´æœ‰å¤šä¸ªå‰¯æœ¬ï¼Œæ‰€ä»¥å®ƒä»¬å¯ä»¥é‡‡ç”¨è£…è½½æ—¶é‡å®šä½çš„æ–¹æ³•æ¥è§£å†³ã€‚\n\nLiuxå’ŒGCCæ”¯æŒè¿™ç§è£…è½½æ—¶é‡å®šä½çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å‰é¢åœ¨äº§ç”Ÿå…±äº«å¯¹è±¡æ—¶ï¼Œä½¿ç”¨äº†ä¸¤ä¸ªGCCå‚æ•°`-shared`å’Œ`-fPIC`ï¼Œå¦‚æœåªä½¿ç”¨`-shared`ï¼Œé‚£ä¹ˆè¾“å‡ºçš„å…±äº«å¯¹è±¡å°±æ˜¯ä½¿ç”¨è£…è½½æ—¶é‡å®šä½çš„æ–¹æ³•ã€‚\n\n### åœ°å€æ— å…³ä»£ç \n\né‚£ä¹ˆä»€ä¹ˆæ˜¯`-fPIC`å‘¢ï¼Ÿä½¿ç”¨è¿™ä¸ªå‚æ•°ä¼šæœ‰ä»€ä¹ˆæ•ˆæœå‘¢ï¼Ÿ\n\nè£…è½½æ—¶é‡å®šä½æ˜¯**è§£å†³åŠ¨æ€æ¨¡å—ä¸­æœ‰ç»å¯¹åœ°å€å¼•ç”¨**çš„åŠæ³•ä¹‹ä¸€ï¼Œä½†æ˜¯å®ƒæœ‰ä¸€ä¸ªå¾ˆå¤§çš„**ç¼ºç‚¹æ˜¯æŒ‡ä»¤éƒ¨åˆ†æ— æ³•åœ¨å¤šä¸ªè¿›ç¨‹ä¹‹é—´å…±äº«ï¼Œè¿™æ ·å°±å¤±å»äº†åŠ¨æ€é“¾æ¥èŠ‚çœå†…å­˜çš„ä¸€å¤§ä¼˜åŠ¿**ã€‚æˆ‘ä»¬è¿˜éœ€è¦æœ‰ä¸€ç§æ›´å¥½çš„æ–¹æ³•è§£å†³å…±äº«å¯¹è±¡æŒ‡ä»¤ä¸­å¯¹ç»å¯¹åœ°å€çš„é‡å®šä½é—®é¢˜ã€‚å…¶å®æˆ‘ä»¬çš„ç›®çš„å¾ˆç®€å•ï¼Œ**å¸Œæœ›ç¨‹åºæ¨¡å—ä¸­å…±äº«çš„æŒ‡ä»¤éƒ¨åˆ†åœ¨è£…è½½æ—¶ä¸éœ€è¦å› ä¸ºè£…è½½åœ°å€çš„æ”¹å˜è€Œæ”¹å˜**ï¼Œæ‰€ä»¥å®ç°çš„åŸºæœ¬æƒ³æ³•å°±æ˜¯**æŠŠæŒ‡ä»¤ä¸­é‚£äº›éœ€è¦è¢«ä¿®æ”¹çš„éƒ¨åˆ†åˆ†ç¦»å‡ºæ¥**ï¼Œ**è·Ÿæ•°æ®éƒ¨åˆ†æ”¾åœ¨ä¸€èµ·**ï¼Œè¿™æ ·æŒ‡ä»¤éƒ¨åˆ†å°±å¯ä»¥ä¿æŒä¸å˜ï¼Œè€Œæ•°æ®éƒ¨åˆ†å¯ä»¥åœ¨æ¯ä¸ªè¿›ç¨‹ä¸­æ‹¥æœ‰ä¸€ä¸ªå‰¯æœ¬ã€‚è¿™ç§æ–¹æ¡ˆå°±æ˜¯ç›®å‰è¢«ç§°ä¸º**åœ°å€æ— å…³ä»£ç (PIC, Position-independent Code)çš„æŠ€æœ¯**ã€‚\n\nå¯¹äºç°ä»£çš„æœºå™¨æ¥è¯´ï¼Œäº§ç”Ÿåœ°å€æ— å…³çš„ä»£ç å¹¶ä¸éº»çƒ¦ã€‚æˆ‘ä»¬å…ˆæ¥åˆ†ææ¨¡å—ä¸­å„ç§ç±»å‹çš„åœ°å€å¼•ç”¨æ–¹å¼ã€‚\n\n#### æ¨¡å—ä¸­å„ç§ç±»å‹çš„åœ°å€å¼•ç”¨æ–¹å¼\n\n1. **æŠŠå…±äº«å¯¹è±¡æ¨¡å—ä¸­çš„åœ°å€å¼•ç”¨æŒ‰ç…§æ˜¯å¦ä¸ºè·¨æ¨¡å—åˆ†æˆä¸¤ç±»**ï¼šæ¨¡å—å†…éƒ¨å¼•ç”¨å’Œæ¨¡å—å¤–éƒ¨å¼•ç”¨ï¼›\n2. **æŒ‰ç…§ä¸åŒçš„å¼•ç”¨æ–¹å¼**åˆå¯ä»¥åˆ†ä¸ºæŒ‡ä»¤å¼•ç”¨ï¼ˆå‡½æ•°ï¼‰å’Œæ•°æ®è®¿é—®ã€‚\n\nåˆ™å¾—åˆ°äº†4ç§æƒ…å†µã€‚\n\n1. æ¨¡å—å†…éƒ¨çš„å‡½æ•°è°ƒç”¨ã€è·³è½¬ç­‰ã€‚\n2. æ¨¡å—å†…éƒ¨çš„æ•°æ®è®¿é—®ï¼Œæ¯”å¦‚æ¨¡å—ä¸­å®šä¹‰çš„å…¨å±€å˜é‡ã€é™æ€å˜é‡ã€‚\n3. æ˜¯æ¨¡å—å¤–éƒ¨çš„å‡½æ•°è°ƒç”¨ã€è·³è½¬ç­‰ã€‚\n4. æ˜¯æ¨¡å—å¤–éƒ¨çš„æ•°æ®è®¿é—®ï¼Œæ¯”å¦‚å…¶ä»–æ¨¡å—ä¸­å®šä¹‰çš„å…¨å±€å˜é‡ã€‚\n\n```c\nstatic int a;\nextern int b;\nextern void ext();\nvoid bar()\n{\n    a = 1;\t//case 2, inner-module data\n    b = 2;\t//case 4, inter-module data\n}\nvoid foo()\n{\n    bar();\t//case 1, inner-module function\n    ext();\t//case 3, inter-module function\n}\n```\n\n> **å…³äºæ¨¡å—å†…éƒ¨å’Œæ¨¡å—å¤–éƒ¨**\n>\n> å½“ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ï¼Œå®ƒå®é™…ä¸Šå¹¶ä¸èƒ½ç¡®å®šå˜é‡bå’Œå‡½æ•°ext()æ˜¯æ¨¡å—å¤–éƒ¨çš„è¿˜æ˜¯æ¨¡å—å†…éƒ¨çš„ï¼Œå› ä¸ºå®ƒä»¬æœ‰å¯èƒ½è¢«å®šä¹‰åœ¨åŒä¸€ä¸ªå…±äº«å¯¹è±¡çš„å…¶ä»–ç›®æ ‡æ–‡ä»¶ä¸­ã€‚ç”±äºæ²¡æ³•ç¡®å®šï¼Œç¼–è¯‘å™¨åªèƒ½æŠŠå®ƒä»¬éƒ½å½“ä½œæ¨¡å—å¤–éƒ¨çš„å‡½æ•°å’Œå˜é‡æ¥å¤„ç†ã€‚MSVCç¼–è¯‘å™¨æä¾›äº†`__declspec(dllimport)`ç¼–è¯‘å™¨æ‰©å±•æ¥è¡¨ç¤ºä¸€ä¸ªç¬¦å·æ˜¯æ¨¡å—å†…éƒ¨çš„è¿˜æ˜¯æ¨¡å—å¤–éƒ¨çš„ã€‚\n\n* æ¨¡å—å†…éƒ¨è°ƒç”¨æˆ–è·³è½¬\n\nè¿™4ç§æƒ…å†µä¸­ï¼Œç¬¬ä¸€ç§ç±»å‹åº”è¯¥æ˜¯æœ€ç®€å•çš„ï¼Œé‚£å°±æ˜¯æ¨¡å—å†…éƒ¨è°ƒç”¨ã€‚å› ä¸ºè¢«è°ƒç”¨çš„å‡½æ•°ä¸è°ƒç”¨è€…éƒ½å¤„äºåŒä¸€ä¸ªæ¨¡å—ï¼Œå®ƒä»¬ä¹‹é—´çš„ç›¸å¯¹ä½ç½®æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µæ¯”è¾ƒç®€å•ã€‚å¯¹äºç°ä»£çš„ç³»ç»Ÿæ¥è®²ï¼Œæ¨¡å—å†…éƒ¨çš„è·³è½¬ã€å‡½æ•°è°ƒç”¨éƒ½å¯ä»¥æ˜¯ç›¸å¯¹åœ°å€è°ƒç”¨ï¼Œæˆ–è€…æ˜¯åŸºäºå¯„å­˜å™¨çš„ç›¸å¯¹è°ƒç”¨ï¼Œæ‰€ä»¥å¯¹äºè¿™ç§æŒ‡ä»¤æ˜¯ä¸éœ€è¦é‡å®šä½çš„ã€‚æ¯”å¦‚ä¸Šé¢ä¾‹å­ä¸­fooå¯¹barçš„è°ƒç”¨å¯èƒ½äº§ç”Ÿå¦‚ä¸‹ä»£ç ï¼š\n\n![image-20220509112233608](../../images/Linux_åº“/image-20220509112233608.png)\n\nfooä¸­å¯¹barçš„è°ƒç”¨çš„é‚£æ¡æŒ‡ä»¤å®é™…ä¸Šæ˜¯ä¸€æ¡ç›¸å¯¹åœ°å€è°ƒç”¨æŒ‡ä»¤ï¼Œç›¸å¯¹åç§»è°ƒç”¨æŒ‡ä»¤å¦‚å›¾ã€‚\n![image-20220509151553766](../../images/Linux_åº“/image-20220509151553766.png)\n\nè¿™æ¡æŒ‡ä»¤ä¸­çš„å4ä¸ªå­—èŠ‚æ˜¯ç›®çš„åœ°å€ç›¸å¯¹äºå½“å‰æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åç§»ï¼Œå³`0xFFFFFFE8`ï¼ˆå°ç«¯ï¼‰ã€‚`0xFFFFFFE8`æ˜¯`-24`çš„è¡¥ç å½¢å¼ï¼Œå³`bar`çš„åœ°å€ä¸º`0x804835c+(-24)=0x8048344`ã€‚é‚£ä¹ˆåªè¦barå’Œfooçš„ç›¸å¯¹ä½ç½®ä¸å˜ï¼Œè¿™æ¡æŒ‡ä»¤æ˜¯åœ°å€æ— å…³çš„ã€‚å³æ— è®ºæ¨¡å—è¢«è£…è½½åˆ°å“ªä¸ªä½ç½®ï¼Œè¿™æ¡æŒ‡ä»¤éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚è¿™ç§ç›¸å¯¹åœ°å€çš„æ–¹å¼å¯¹äºjmpæŒ‡ä»¤ä¹Ÿæœ‰æ•ˆã€‚\n\nè¿™æ ·çœ‹èµ·æ¥ç¬¬ä¸€ä¸ªæ¨¡å—å†…éƒ¨è°ƒç”¨æˆ–è·³è½¬å¾ˆå®¹æ˜“è§£å†³ï¼Œä½†å®é™…ä¸Šè¿™ç§æ–¹å¼è¿˜æœ‰ä¸€å®šçš„é—®é¢˜ï¼Œè¿™é‡Œå­˜åœ¨ä¸€ä¸ªå«åš**å…±äº«å¯¹è±¡å…¨å±€ç¬¦å·ä»‹å…¥(Global Symbol Interposition)é—®é¢˜**ï¼Œä½†åœ¨è¿™é‡Œï¼Œå¯ä»¥ç®€å•åœ°æŠŠå®ƒå½“ä½œç›¸å¯¹åœ°å€è°ƒç”¨/è·³è½¬ã€‚\n\n* æ¨¡å—å†…éƒ¨æ•°æ®è®¿é—®\n\næ¥ç€æ¥çœ‹çœ‹ç¬¬äºŒç§ç±»å‹ï¼Œæ¨¡å—å†…éƒ¨çš„æ•°æ®è®¿é—®ã€‚å¾ˆæ˜æ˜¾ï¼ŒæŒ‡ä»¤ä¸­ä¸èƒ½ç›´æ¥åŒ…å«æ•°æ®çš„ç»å¯¹åœ°å€ï¼Œé‚£ä¹ˆå”¯ä¸€çš„åŠæ³•å°±æ˜¯**ç›¸å¯¹å¯»å€**ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªæ¨¡å—å‰é¢ä¸€èˆ¬æ˜¯è‹¥å¹²ä¸ªé¡µçš„ä»£ç ï¼Œåé¢ç´§è·Ÿç€è‹¥åƒä¸ªé¡µçš„æ•°æ®ï¼Œè¿™äº›é¡µä¹‹é—´çš„ç›¸å¯¹ä½ç½®æ˜¯å›ºå®šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ**ä»»ä½•ä¸€æ¡æŒ‡ä»¤ä¸å®ƒéœ€è¦è®¿é—®çš„æ¨¡å—å†…éƒ¨æ•°æ®ä¹‹é—´çš„ç›¸å¯¹ä½ç½®æ˜¯å›ºå®šçš„**ï¼Œé‚£ä¹ˆ**åªéœ€è¦ç›¸å¯¹äºå½“å‰æŒ‡ä»¤åŠ ä¸Šå›ºå®šçš„åç§»é‡å°±å¯ä»¥è®¿é—®æ¨¡å—å†…éƒ¨æ•°æ®**äº†ã€‚\n\nç°ä»£çš„ä½“ç³»ç»“æ„ä¸­ï¼Œæ•°æ®çš„ç›¸å¯¹å¯»å€å¾€å¾€æ²¡æœ‰ç›¸å¯¹ä¸å½“å‰æŒ‡ä»¤åœ°å€ï¼ˆPCï¼‰çš„å¯»å€æ–¹å¼ï¼Œæ‰€ä»¥ELFç”¨äº†ä¸€ä¸ªå¾ˆå·§å¦™çš„åŠæ³•æ¥å¾—åˆ°å½“å‰çš„PCå€¼ï¼Œç„¶åå†åŠ ä¸Šä¸€ä¸ªåç§»é‡å°±å¯ä»¥è¾¾åˆ°è®¿é—®ç›¸åº”å˜é‡çš„ç›®çš„äº†ã€‚å¾—åˆ°PCå€¼çš„æ–¹æ³•å¾ˆå¤šï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æœ€å¸¸ç”¨çš„ä¸€ç§ï¼Œä¹Ÿæ˜¯ç°åœ¨ELFçš„å…±äº«å¯¹è±¡é‡Œé¢ç”¨çš„ä¸€ç§æ–¹æ³•ï¼š\n\n![image-20220509141654740](../../images/Linux_åº“/image-20220509141654740.png)\n\nè¿™æ˜¯å¯¹ä¸Šé¢çš„ä¾‹å­ä¸­çš„ä»£ç å…ˆç¼–è¯‘æˆå…±äº«å¯¹è±¡ç„¶ååæ±‡ç¼–çš„ç»“æœã€‚ç”¨ç²—ä½“è¡¨ç¤ºçš„æ˜¯`bar()`å‡½æ•°ä¸­è®¿é—®æ¨¡å—å†…éƒ¨å˜é‡`a`çš„ç›¸åº”ä»£ç ã€‚\n\nä»ä¸Šé¢çš„æŒ‡ä»¤ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå®ƒå…ˆè°ƒç”¨äº†ä¸€ä¸ªå«`__i686.get_pc_thunk.cx`çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„ä½œç”¨å°±æ˜¯æŠŠè¿”å›åœ°å€çš„å€¼æ”¾åˆ°ecxå¯„å­˜å™¨ï¼Œå³æŠŠcallçš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€æ”¾åˆ°ecxå¯„å­˜å™¨ã€‚\n\n>æˆ‘ä»¬çŸ¥é“å½“å¤„ç†å™¨æ‰§è¡ŒcallæŒ‡ä»¤ä»¥åï¼Œä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ä¼šè¢«å‹åˆ°æ ˆé¡¶ï¼Œè€Œespå¯„å­˜å™¨å°±æ˜¯å§‹ç»ˆæŒ‡å‘æ ˆé¡¶çš„ï¼Œé‚£ä¹ˆå½“`__i686.get_pc_thunk.cx`æ‰§è¡Œ`mov(%esp), %ecx`çš„æ—¶å€™ï¼Œè¿”å›åœ°å€å°±è¢«èµ‹å€¼åˆ°ecxå¯„å­˜å™¨äº†ã€‚\n\næ¥ç€æ‰§è¡Œä¸€æ¡addæŒ‡ä»¤å’Œä¸€æ¡movæŒ‡ä»¤ï¼Œå¯ä»¥çœ‹åˆ°å˜é‡`a`çš„åœ°å€æ˜¯addæŒ‡ä»¤åœ°å€ï¼ˆä¿å­˜åœ¨ecxå¯„å­˜å™¨ï¼‰åŠ ä¸Šä¸¤ä¸ªåç§»é‡`0x118c`å’Œ`0x28`ï¼ˆ`0x28(%ecx)`ç›¸å½“äº`%ecx+0x28`ï¼‰ï¼Œå³å¦‚æœæ¨¡å—è¢«è£…è½½åˆ°`0x10000000`è¿™ä¸ªåœ°å€çš„è¯ï¼Œé‚£ä¹ˆå˜é‡açš„å®é™…åœ°å€å°†æ˜¯`0x10000000+0x454+0x118c+0x28=0x10001608`ã€‚\n\n![image-20220509151732270](../../images/Linux_åº“/image-20220509151732270.png)\n\n* æ¨¡å—é—´æ•°æ®è®¿é—®\n\næ¨¡å—é—´çš„æ•°æ®è®¿é—®æ¯”æ¨¡å—å†…éƒ¨ç¨å¾®éº»çƒ¦ä¸€ç‚¹ï¼Œå› ä¸ºæ¨¡å—é—´çš„æ•°æ®è®¿é—®ç›®æ ‡åœ°å€è¦ç­‰åˆ°è£…è½½æ—¶æ‰å†³å®šï¼Œæ¯”å¦‚ä¸Šé¢ä¾‹å­ä¸­çš„å˜é‡bï¼Œå®ƒè¢«å®šä¹‰åœ¨å…¶ä»–æ¨¡å—ä¸­ï¼Œå¹¶ä¸”è¯¥åœ°å€åœ¨è£…è½½æ—¶æ‰èƒ½ç¡®å®šã€‚æˆ‘ä»¬å‰é¢æåˆ°è¦ä½¿å¾—ä»£ç åœ°å€æ— å…³ï¼ŒåŸºæœ¬çš„æ€æƒ³å°±æ˜¯æŠŠè·Ÿåœ°å€ç›¸å…³çš„éƒ¨åˆ†æ”¾åˆ°æ•°æ®æ®µé‡Œé¢ï¼Œå¾ˆæ˜æ˜¾ï¼Œè¿™äº›å…¶ä»–æ¨¡å—çš„å…¨å±€å˜é‡çš„åœ°å€æ˜¯è·Ÿæ¨¡å—è£…è½½åœ°å€æœ‰å…³çš„ã€‚**ELFçš„åšæ³•æ˜¯åœ¨æ•°æ®æ®µé‡Œé¢å»ºç«‹ä¸€ä¸ªæŒ‡å‘è¿™äº›å˜é‡çš„æŒ‡é’ˆæ•°ç»„ï¼Œä¹Ÿè¢«ç§°ä¸ºå…¨å±€åç§»è¡¨**(GlobalOffset Table, GOT)ï¼Œå½“ä»£ç éœ€è¦å¼•ç”¨è¯¥å…¨å±€å˜é‡æ—¶ï¼Œå¯ä»¥é€šè¿‡GOTä¸­ç›¸å¯¹åº”çš„é¡¹é—´æ¥å¼•ç”¨ï¼Œå®ƒçš„åŸºæœ¬æœºåˆ¶å¦‚å›¾æ‰€ç¤ºã€‚\n![image-20220509153306467](../../images/Linux_åº“/image-20220509153306467.png)\n\nå½“æŒ‡ä»¤ä¸­éœ€è¦è®¿é—®å˜é‡bæ—¶ï¼Œç¨‹åºä¼šå…ˆæ‰¾åˆ°GOTï¼Œç„¶åæ ¹æ®GOTä¸­å˜é‡æ‰€å¯¹åº”çš„é¡¹æ‰¾åˆ°å˜é‡çš„ç›®æ ‡åœ°å€ã€‚æ¯ä¸ªå˜é‡éƒ½å¯¹åº”ä¸€ä¸ª4ä¸ªå­—èŠ‚çš„åœ°å€ï¼Œé“¾æ¥å™¨åœ¨è£…è½½æ¨¡å—çš„æ—¶å€™ä¼šæŸ¥æ‰¾æ¯ä¸ªå˜é‡æ‰€åœ¨çš„åœ°å€ï¼Œç„¶åå¡«å……GOTä¸­çš„å„ä¸ªé¡¹ï¼Œä»¥ç¡®ä¿æ¯ä¸ªæŒ‡é’ˆæ‰€æŒ‡å‘çš„åœ°å€æ­£ç¡®ã€‚ç”±äºGOTæœ¬èº«æ˜¯æ”¾åœ¨æ•°æ®æ®µçš„ï¼Œæ‰€ä»¥å®ƒå¯ä»¥åœ¨æ¨¡å—è£…è½½æ—¶è¢«ä¿®æ”¹ï¼Œå¹¶ä¸”æ¯ä¸ªè¿›ç¨‹éƒ½å¯ä»¥æœ‰ç‹¬ç«‹çš„å‰¯æœ¬ï¼Œç›¸äº’ä¸å—å½±å“ã€‚\n\næˆ‘ä»¬æ¥çœ‹çœ‹GOTå¦‚ä½•åšåˆ°æŒ‡ä»¤çš„åœ°å€æ— å…³æ€§ã€‚ä»ç¬¬äºŒç§ç±»å‹çš„æ•°æ®è®¿é—®æˆ‘ä»¬äº†è§£åˆ°ï¼Œæ¨¡å—åœ¨ç¼–è¯‘æ—¶å¯ä»¥ç¡®å®šæ¨¡å—å†…éƒ¨å˜é‡ç›¸å¯¹ä¸å½“å‰æŒ‡ä»¤çš„åç§»ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥**åœ¨ç¼–è¯‘æ—¶ç¡®å®šGOTç›¸å¯¹äºå½“å‰æŒ‡ä»¤çš„åç§»**ã€‚ç¡®å®šGOTçš„ä½ç½®è·Ÿä¸Šé¢çš„è®¿é—®å˜é‡açš„æ–¹æ³•åŸºæœ¬ä¸€æ ·ï¼Œé€šè¿‡å¾—åˆ°PCå€¼ç„¶ååŠ ä¸Šä¸€ä¸ªåç§»é‡ï¼Œå°±å¯ä»¥å¾—åˆ°GOTçš„ä½ç½®ã€‚ç„¶åæˆ‘ä»¬æ ¹æ®å˜é‡åœ°å€åœ¨GOTä¸­çš„åç§»å°±å¯ä»¥å¾—åˆ°å˜é‡çš„åœ°å€ï¼Œå½“ç„¶GOTä¸­æ¯ä¸ªåœ°å€å¯¹åº”äºå“ªä¸ªå˜é‡æ˜¯ç”±ç¼–è¯‘å™¨å†³å®šçš„ï¼Œæ¯”å¦‚ç¬¬ä¸€ä¸ªåœ°å€å¯¹åº”å˜é‡bï¼Œç¬¬äºŒä¸ªå¯¹åº”å˜é‡cç­‰ã€‚\n\nè®©æˆ‘ä»¬å†å›é¡¾åˆšæ‰å‡½æ•°`bar()`çš„åæ±‡ç¼–ä»£ç ã€‚ä¸ºè®¿é—®å˜é‡bï¼Œæˆ‘ä»¬çš„ç¨‹åºé¦–å…ˆè®¡ç®—å‡ºå˜é‡bçš„åœ°å€åœ¨GOTä¸­çš„ä½ç½®ï¼Œå³`0x10000000+0x454+0x118c+(-8)=0x100015d8`ï¼ˆ`0xfffffff8`ä¸º`-8`çš„è¡¥ç è¡¨ç¤ºï¼‰ï¼Œç„¶åä½¿ç”¨å¯„å­˜å™¨é—´æ¥å¯»å€æ–¹å¼ç»™å˜é‡bèµ‹å€¼2ã€‚\n\n![image-20220509141654740](../../images/Linux_åº“/image-20220509141654740.png)\n\næˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨objdumpæ¥æŸ¥çœ‹GOTçš„ä½ç½®ï¼š\n\n![image-20220509154001142](../../images/Linux_åº“/image-20220509154001142.png)\n\nå¯ä»¥çœ‹åˆ°GOTåœ¨æ–‡ä»¶ä¸­çš„åç§»æ˜¯`0x15d0`ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹`pic.so`çš„éœ€è¦åœ¨åŠ¨æ€é“¾æ¥æ—¶é‡å®šä½é¡¹ï¼š\n\n![image-20220509154033873](../../images/Linux_åº“/image-20220509154033873.png)\n\nå¯ä»¥çœ‹åˆ°å˜é‡bçš„åœ°å€éœ€è¦é‡å®šä½ï¼Œå®ƒä½äº`0x15d8`ï¼Œä¹Ÿå°±æ˜¯GOTä¸­åç§»8ï¼Œç›¸å½“äºæ˜¯GOTä¸­çš„ç¬¬ä¸‰é¡¹(æ¯å››ä¸ªå­—èŠ‚ä¸€é¡¹) ã€‚ä»ä¸Šé¢é‡å®šä½é¡¹ä¸­çœ‹åˆ°ï¼Œå˜é‡bçš„åœ°å€çš„åç§»ä¸º`0x15d8`ï¼Œæ­£å¥½å¯¹åº”äº†æˆ‘ä»¬å‰é¢é€šè¿‡æŒ‡ä»¤è®¡ç®—å‡ºæ¥çš„åç§»å€¼ï¼Œå³`0x100015d8-0x10000000=0x15d8`ã€‚\n\n* æ¨¡å—é—´è°ƒç”¨ã€è·³è½¬\n\nå¯¹äºæ¨¡å—é—´è°ƒç”¨å’Œè·³è½¬ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é‡‡ç”¨ä¸Šé¢çš„æ–¹æ³•æ¥è§£å†³ã€‚ä¸ä¸Šé¢çš„ç±»å‹æœ‰æ‰€ä¸åŒçš„æ˜¯ï¼ŒGOTä¸­ç›¸åº”çš„é¡¹ä¿å­˜çš„æ˜¯ç›®æ ‡å‡½æ•°çš„åœ°å€ï¼Œå½“æ¨¡å—éœ€è¦è°ƒç”¨ç›®æ ‡å‡½æ•°æ—¶ï¼Œå¯ä»¥é€šè¿‡GOTä¸­çš„é¡¹è¿›è¡Œé—´æ¥è·³è½¬ï¼ŒåŸºæœ¬çš„åŸç†å¦‚å›¾æ‰€ç¤ºã€‚\n![image-20220509154400584](../../images/Linux_åº“/image-20220509154400584.png)\n\nè°ƒç”¨`ext()`å‡½æ•°çš„æ–¹æ³•ä¸ä¸Šé¢è®¿é—®å˜é‡bçš„æ–¹æ³•åŸºæœ¬ç±»ä¼¼ï¼Œå…ˆå¾—åˆ°å½“å‰æŒ‡ä»¤åœ°å€PCï¼Œç„¶ååŠ ä¸Šä¸€ä¸ªåç§»å¾—åˆ°å‡½æ•°åœ°å€åœ¨GOTä¸­çš„åç§»ï¼Œç„¶åä¸€ä¸ªé—´æ¥è°ƒç”¨ã€‚\n\n![image-20220509154449640](../../images/Linux_åº“/image-20220509154449640.png)\n\n* å°ç»“\n\n4ç§åœ°å€å¼•ç”¨æ–¹å¼åœ¨ç†è®ºä¸Šéƒ½å®ç°äº†åœ°å€æ— å…³æ€§ï¼Œå°†å®ƒä»¬æ€»ç»“ä¸€ä¸‹ï¼Œå¦‚è¡¨ã€‚\n\n![image-20220509154617511](../../images/Linux_åº“/image-20220509154617511.png)\n\n## -fPIC\n\nç”ŸæˆåŠ¨æ€åº“ç”¨åˆ°çš„å‚æ•°`fPIC`å³æ˜¯æŒ‡æ˜GCCäº§ç”Ÿåœ°å€æ— å…³ä»£ç ã€‚å®é™…ä¸ŠGCCè¿˜æä¾›äº†å¦å¤–ä¸€ä¸ªç±»ä¼¼çš„å‚æ•°å«åš`-fpic`ï¼Œå³`PIC`3ä¸ªå­—æ¯å°å†™ã€‚è¿™ä¸¤ä¸ªå‚æ•°ä»åŠŸèƒ½ä¸Šæ¥è®²å®Œå…¨ä¸€æ ·ï¼Œéƒ½æ˜¯æŒ‡ç¤ºGCCäº§ç”Ÿåœ°å€æ— å…³ä»£ç ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œ`-fPIC`äº§ç”Ÿçš„ä»£ç è¦å¤§ï¼Œè€Œ`-fpic`äº§ç”Ÿçš„ä»£ç ç›¸å¯¹è¾ƒå°ï¼Œè€Œä¸”è¾ƒå¿«ã€‚\n\né‚£ä¹ˆæˆ‘ä»¬ä¸ºä»€ä¹ˆä¸ä½¿ç”¨`-fpic`è€Œè¦ä½¿ç”¨`-fPIC`å‘¢ï¼ŸåŸå› æ˜¯ï¼Œç”±äºåœ°å€æ— å…³ä»£ç éƒ½æ˜¯è·Ÿç¡¬ä»¶å¹³å°ç›¸å…³çš„ï¼Œä¸åŒçš„å¹³å°æœ‰ç€ä¸åŒçš„å®ç°ï¼Œ `-fpic`åœ¨æŸäº›å¹³å°ä¸Šä¼šæœ‰ä¸€äº›é™åˆ¶ï¼Œæ¯”å¦‚å…¨å±€ç¬¦å·çš„æ•°é‡æˆ–è€…ä»£ç çš„é•¿åº¦ç­‰ï¼Œè€Œ`-fPIC`åˆ™æ²¡æœ‰è¿™æ ·çš„é™åˆ¶ã€‚æ‰€ä»¥ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹æˆ‘ä»¬éƒ½ä½¿ç”¨`-fPIC`å‚æ•°æ¥äº§ç”Ÿåœ°å€æ— å…³ä»£ç ã€‚\n\n* å¦‚ä½•åŒºåˆ†ä¸€ä¸ªDSO(Dynamic Shared Object, åŠ¨æ€å…±äº«å¯¹è±¡)æ˜¯å¦ä¸ºPICï¼Ÿ\n\n```bash\nreadelf -d foo.so | grep TEXTREL\n```\n\nå¦‚æœä¸Šé¢çš„å‘½ä»¤æœ‰ä»»ä½•è¾“å‡ºé‚£ä¹ˆ`foo.so`å°±ä¸æ˜¯PICçš„ï¼Œå¦åˆ™ä¸ºPICçš„ã€‚å› ä¸ºPICçš„DSOæ˜¯ä¸ä¼šåŒ…å«ä»»ä½•ä»£ç æ®µé‡å®šä½è¡¨çš„ï¼ŒTEXTRELè¡¨ç¤ºä»£ç æ®µé‡å®šä½è¡¨åœ°å€ã€‚\n\n* PICä¸PIE\n\nåœ°å€æ— å…³ä»£ç æŠ€æœ¯é™¤äº†å¯ä»¥ç”¨åœ¨å…±äº«å¯¹è±¡ä¸Šé¢ï¼Œå®ƒä¹Ÿå¯ä»¥ç”¨äºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¸€ä¸ªä»¥åœ°å€æ— å…³æ–¹å¼ç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶è¢«ç§°ä½œåœ°å€æ— å…³å¯æ‰§è¡Œæ–‡ä»¶(PIE, Position-Independent Executable)ã€‚ä¸GCCçš„`-fPIC`å’Œ`-fpic`å‚æ•°ç±»ä¼¼ï¼Œäº§ç”ŸPIEçš„å‚æ•°ä¸º`-fPIE`æˆ–`-f pie`ã€‚\n\n## å…±äº«æ¨¡å—çš„å…¨å±€å˜é‡é—®é¢˜\n\nåœ¨è°ˆåˆ°åŠ¨æ€åº“çš„è£…è½½åœ°å€æ—¶ï¼Œè¯´åˆ°äº†åœ°å€æ— å…³æ€§é—®é¢˜ã€‚åœ°å€æ— å…³æ€§é—®é¢˜å°±è¿™ä¹ˆè§£å†³äº†å—ï¼Ÿçœ‹èµ·æ¥å¥½åƒæ˜¯çš„ã€‚ä½†ä»”ç»†çœ‹çœ‹å‰é¢çš„4ç§åœ°å€å¼•ç”¨æ–¹å¼çš„åˆ†ç±»ï¼Œä¼šæœ‰ä¸€ä¸ªå°é—®é¢˜ï¼šæˆ‘ä»¬ä¸Šé¢çš„æƒ…å†µä¸­æ²¡æœ‰åŒ…å«**å®šä¹‰åœ¨æ¨¡å—å†…éƒ¨çš„å…¨å±€å˜é‡**çš„æƒ…å†µã€‚æŠŠå®ƒè·Ÿæ¨¡å—å†…éƒ¨çš„é™æ€å˜é‡ä¸€æ ·å¤„ç†å¯ä»¥å—ï¼Ÿçš„ç¡®ï¼Œç²—ç•¥ä¸€çœ‹æ¨¡å—å†…éƒ¨çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡çš„åœ°å€éƒ½å¯ä»¥é€šè¿‡ä¸Šé¢æ‰€åˆ—å‡ºçš„ç±»å‹ä¸¤ç§æ–¹æ³•æ¥è§£å†³ã€‚ä½†æ˜¯æœ‰ä¸€ç§æƒ…å†µå¾ˆç‰¹æ®Šï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä¼šäº§ç”Ÿä»€ä¹ˆé—®é¢˜ã€‚\n\næœ‰ä¸€ç§å¾ˆç‰¹æ®Šçš„æƒ…å†µæ˜¯ï¼Œå½“**ä¸€ä¸ªæ¨¡å—å¼•ç”¨äº†ä¸€ä¸ªå®šä¹‰åœ¨å…±äº«å¯¹è±¡çš„å…¨å±€å˜é‡**çš„æ—¶å€™ï¼Œæ¯”å¦‚ä¸€ä¸ªå…±äº«å¯¹è±¡å®šä¹‰äº†ä¸€ä¸ªå…¨å±€å˜é‡globalï¼Œè€Œæ¨¡å—module.cä¸­æ˜¯è¿™ä¹ˆå¼•ç”¨çš„ï¼š\n\n```c\nextern int global;\t//å®šä¹‰åœ¨ä¸€ä¸ªå…±äº«å¯¹è±¡\nint foo()\n{\n    global = 1;\n}\n```\n\nå½“ç¼–è¯‘å™¨ç¼–è¯‘module.cæ—¶ï¼Œå®ƒ**æ— æ³•æ ¹æ®è¿™ä¸ªä¸Šä¸‹æ–‡åˆ¤æ–­globalæ˜¯å®šä¹‰åœ¨åŒä¸€ä¸ªæ¨¡å—çš„çš„å…¶ä»–ç›®æ ‡æ–‡ä»¶è¿˜æ˜¯å®šä¹‰åœ¨å¦å¤–ä¸€ä¸ªå…±äº«å¯¹è±¡ä¹‹ä¸­**ï¼Œå³**æ— æ³•åˆ¤æ–­æ˜¯å¦ä¸ºè·¨æ¨¡å—é—´çš„è°ƒç”¨**ã€‚\nå‡è®¾module.cæ˜¯ç¨‹åºå¯æ‰§è¡Œæ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”±äºç¨‹åºä¸»æ¨¡å—çš„ä»£ç å¹¶ä¸æ˜¯åœ°å€æ— å…³ä»£ç ï¼Œä¹Ÿå°±æ˜¯è¯´ä»£ç ä¸ä¼šä½¿ç”¨è¿™ç§ç±»ä¼¼äºPICçš„æœºåˆ¶ï¼Œå®ƒå¼•ç”¨è¿™ä¸ªå…¨å±€å˜é‡çš„æ–¹å¼è·Ÿæ™®é€šæ•°æ®è®¿é—®æ–¹å¼ä¸€æ ·ï¼Œç¼–è¯‘å™¨ä¼šäº§ç”Ÿè¿™æ ·çš„ä»£ç ï¼š\n`movl $0x1, xxxxxxxx`\n\n`XXXXXXXX`å°±æ˜¯globalçš„åœ°å€ã€‚ç”±äºå¯æ‰§è¡Œæ–‡ä»¶åœ¨è¿è¡Œæ—¶å¹¶ä¸è¿›è¡Œä»£ç é‡å®šä½ï¼Œæ‰€ä»¥å˜é‡çš„åœ°å€å¿…é¡»åœ¨é“¾æ¥è¿‡ç¨‹ä¸­ç¡®å®šä¸‹æ¥ã€‚ä¸ºäº†èƒ½å¤Ÿä½¿å¾—é“¾æ¥è¿‡ç¨‹æ­£å¸¸è¿›è¡Œï¼Œé“¾æ¥å™¨ä¼šåœ¨åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œåœ¨å®ƒçš„â€œ.bssâ€æ®µåˆ›å»ºä¸€ä¸ªglobalå˜é‡çš„å‰¯æœ¬ã€‚é‚£ä¹ˆé—®é¢˜å°±å¾ˆæ˜æ˜¾äº†ï¼Œç°åœ¨globalå˜é‡å®šä¹‰åœ¨åŸå…ˆçš„å…±äº«å¯¹è±¡ä¸­ï¼Œè€Œåœ¨å¯æ‰§è¡Œæ–‡ä»¶çš„â€œ.bssâ€æ®µè¿˜æœ‰ä¸€ä¸ªå‰¯æœ¬ã€‚å¦‚æœåŒä¸€ä¸ªå˜é‡åŒæ—¶å­˜åœ¨äºå¤šä¸ªä½ç½®ä¸­ï¼Œè¿™åœ¨ç¨‹åºå®é™…è¿è¡Œè¿‡ç¨‹ä¸­è‚¯å®šæ˜¯ä¸å¯è¡Œçš„ã€‚\n\näºæ˜¯è§£å†³çš„åŠæ³•åªæœ‰ä¸€ä¸ªï¼Œé‚£å°±æ˜¯æ‰€æœ‰çš„ä½¿ç”¨è¿™ä¸ªå˜é‡çš„æŒ‡ä»¤éƒ½æŒ‡å‘ä½äºå¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„é‚£ä¸ªå‰¯æœ¬ã€‚**ELFå…±äº«åº“åœ¨ç¼–è¯‘æ—¶ï¼Œé»˜è®¤éƒ½æŠŠå®šä¹‰åœ¨æ¨¡å—å†…éƒ¨çš„å…¨å±€å˜é‡å½“ä½œå®šä¹‰åœ¨å…¶ä»–æ¨¡å—çš„å…¨å±€å˜é‡**ï¼Œä¹Ÿå°±æ˜¯è¯´å½“ä½œå‰é¢çš„ç±»å‹å››ï¼Œé€šè¿‡GOTæ¥å®ç°å˜é‡çš„è®¿é—®ã€‚å½“å…±äº«æ¨¡å—è¢«è£…è½½æ—¶ï¼Œå¦‚æœæŸä¸ªå…¨å±€å˜é‡åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­æ‹¥æœ‰å‰¯æœ¬ï¼Œé‚£ä¹ˆåŠ¨æ€é“¾æ¥å™¨å°±ä¼šæŠŠGOTä¸­çš„ç›¸åº”åœ°å€æŒ‡å‘è¯¥å‰¯æœ¬ï¼Œè¿™æ ·è¯¥å˜é‡åœ¨è¿è¡Œæ—¶å®é™…ä¸Šæœ€ç»ˆå°±åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚å¦‚æœå˜é‡åœ¨å…±äº«æ¨¡å—ä¸­è¢«åˆå§‹åŒ–ï¼Œé‚£ä¹ˆåŠ¨æ€é“¾æ¥å™¨è¿˜éœ€è¦å°†è¯¥åˆå§‹åŒ–å€¼å¤åˆ¶åˆ°ç¨‹åºä¸»æ¨¡å—ä¸­çš„å˜é‡å‰¯æœ¬ï¼›å¦‚æœè¯¥å…¨å±€å˜é‡åœ¨ç¨‹åºä¸»æ¨¡å—ä¸­æ²¡æœ‰å‰¯æœ¬ï¼Œ é‚£ä¹ˆGOTä¸­çš„ç›¸åº”åœ°å€å°±æŒ‡å‘æ¨¡å—å†…éƒ¨çš„è¯¥å˜é‡å‰¯æœ¬ã€‚\n\nå‡è®¾module.cæ˜¯ä¸€ä¸ªå…±äº«å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆGCCç¼–è¯‘å™¨åœ¨`-fPIC`çš„æƒ…å†µä¸‹ï¼Œå°±ä¼šæŠŠå¯¹globalçš„è°ƒç”¨æŒ‰ç…§è·¨æ¨¡å—æ¨¡å¼äº§ç”Ÿä»£ç ã€‚åŸå› ä¹Ÿå¾ˆç®€å•ï¼š**ç¼–è¯‘å™¨æ— æ³•ç¡®å®šå¯¹globalçš„å¼•ç”¨æ˜¯è·¨æ¨¡å—çš„è¿˜æ˜¯æ¨¡å—å†…éƒ¨çš„**ã€‚**å³ä½¿æ˜¯æ¨¡å—å†…éƒ¨çš„ï¼Œå³æ¨¡å—å†…éƒ¨çš„å…¨å±€å˜é‡çš„å¼•ç”¨ï¼ŒæŒ‰ç…§ä¸Šé¢çš„ç»“è®ºï¼Œè¿˜æ˜¯ä¼šäº§ç”Ÿè·¨æ¨¡å—ä»£ç ï¼Œå› ä¸ºglobalå¯èƒ½è¢«å¯æ‰§è¡Œæ–‡ä»¶å¼•ç”¨**ï¼Œä»è€Œä½¿å¾—å…±äº«æ¨¡å—ä¸­å¯¹globalçš„å¼•ç”¨è¦æ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„globalå‰¯æœ¬ã€‚\n\n> Q&A\n>\n> Qï¼šå¦‚æœä¸€ä¸ªå…±äº«å¯¹è±¡`lib.so`ä¸­å®šä¹‰äº†ä¸€ä¸ªå…¨å±€å˜é‡`G`ï¼Œè€Œè¿›ç¨‹Aå’Œè¿›ç¨‹Béƒ½ä½¿ç”¨äº†`lib.so`ï¼Œé‚£ä¹ˆå½“è¿›ç¨‹Aæ”¹å˜è¿™ä¸ªå…¨å±€å˜é‡`G`çš„å€¼æ—¶ï¼Œè¿›ç¨‹Bä¸­çš„Gä¼šå—åˆ°å½±å“å—ï¼Ÿ\n> Aï¼šä¸ä¼šã€‚å› ä¸ºå½“`lib.so`è¢«ä¸¤ä¸ªè¿›ç¨‹åŠ è½½æ—¶ï¼Œå®ƒçš„æ•°æ®æ®µéƒ¨åˆ†åœ¨æ¯ä¸ªè¿›ç¨‹ä¸­éƒ½æœ‰ç‹¬ç«‹çš„å‰¯æœ¬ï¼Œä»è¿™ä¸ªè§’åº¦çœ‹ï¼Œ**å…±äº«å¯¹è±¡ä¸­çš„å…¨å±€å˜é‡å®é™…ä¸Šå’Œå®šä¹‰åœ¨ç¨‹åºå†…éƒ¨çš„å…¨å±€å˜é‡æ²¡ä»€ä¹ˆåŒºåˆ«**ã€‚ä»»ä½•ä¸€ä¸ªè¿›ç¨‹è®¿é—®çš„åªæ˜¯è‡ªå·±çš„é‚£ä¸ªå‰¯æœ¬ï¼Œè€Œä¸ä¼šå½±å“å…¶ä»–è¿›ç¨‹ã€‚\n>\n> Qï¼šé‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬æŠŠè¿™ä¸ªé—®é¢˜çš„æ¡ä»¶æ”¹æˆåŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹Aå’Œçº¿ç¨‹Bï¼Œå®ƒä»¬æ˜¯å¦çœ‹å¾—åˆ°å¯¹æ–¹å¯¹`lib.so`ä¸­çš„å…¨å±€å˜é‡Gçš„ä¿®æ”¹å‘¢ï¼Ÿ\n> Aï¼šå¯¹äºåŒä¸€ä¸ªè¿›ç¨‹çš„ä¸¤ä¸ªçº¿ç¨‹æ¥è¯´ï¼Œå®ƒä»¬è®¿é—®çš„æ˜¯åŒä¸€ä¸ªè¿›ç¨‹åœ°å€ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯åŒä¸€ä¸ª`lib.so`çš„å‰¯æœ¬ï¼Œæ‰€ä»¥å®ƒä»¬å¯¹Gçš„ä¿®æ”¹ï¼Œå¯¹æ–¹éƒ½æ˜¯çœ‹å¾—åˆ°çš„ã€‚\n>\n> Qï¼šé‚£ä¹ˆæˆ‘ä»¬å¯ä¸å¯ä»¥åšåˆ°è·Ÿå‰é¢ç­”æ¡ˆç›¸åçš„æƒ…å†µå‘¢ï¼Ÿæ¯”å¦‚è¦æ±‚**ä¸¤ä¸ªè¿›ç¨‹å…±äº«ä¸€ä¸ªå…±äº«å¯¹è±¡çš„å‰¯æœ¬**æˆ–è¦æ±‚**ä¸¤ä¸ªçº¿ç¨‹è®¿é—®å…¨å±€å˜é‡çš„ä¸åŒå‰¯æœ¬**ï¼Œè¿™ä¸¤ç§éœ€æ±‚éƒ½æ˜¯å­˜åœ¨çš„ï¼Œæ¯”å¦‚å¤šä¸ªè¿›ç¨‹å¯ä»¥å…±äº«åŒä¸€ä¸ªå…¨å±€å˜é‡å°±å¯ä»¥ç”¨æ¥å®ç°è¿›ç¨‹é—´é€šä¿¡ï¼›è€Œå¤šä¸ªçº¿ç¨‹è®¿é—®å…¨å±€å˜é‡çš„ä¸åŒå‰¯æœ¬å¯ä»¥é˜²æ­¢ä¸åŒçº¿ç¨‹ä¹‹é—´å¯¹å…¨å±€å˜é‡çš„å¹²æ‰°ï¼Œæ¯”å¦‚Cè¯­è¨€è¿è¡Œåº“çš„erronå…¨å±€å˜é‡ã€‚\n> Aï¼šå®é™…ä¸Šè¿™ä¸¤ç§éœ€æ±‚éƒ½æ˜¯æœ‰ç›¸åº”çš„è§£å†³æ–¹æ³•çš„ï¼Œ**å¤šè¿›ç¨‹å…±äº«å…¨å±€å˜é‡åˆå«åšâ€œå…±äº«æ•°æ®æ®µâ€**ï¼Œåœ¨ä»‹ç»Windows DLLçš„æ—¶å€™ä¼šç¢°åˆ°å®ƒã€‚è€Œ**å¤šä¸ªçº¿ç¨‹è®¿é—®ä¸åŒçš„å…¨å±€å˜é‡å‰¯æœ¬åˆè¢«å«åšâ€œçº¿ç¨‹ç§æœ‰å­˜å‚¨â€**(Thread Local Storage)ã€‚\n\n## æ•°æ®æ®µåœ°å€æ— å…³æ€§\n\né€šè¿‡ä¸Šé¢çš„æ–¹æ³•ï¼Œæˆ‘ä»¬èƒ½å¤Ÿä¿è¯å…±äº«å¯¹è±¡ä¸­çš„ä»£ç éƒ¨åˆ†åœ°å€æ— å…³ï¼Œä½†æ˜¯æ•°æ®éƒ¨åˆ†æ˜¯ä¸æ˜¯ä¹Ÿæœ‰ç»å¯¹åœ°å€å¼•ç”¨çš„é—®é¢˜å‘¢ï¼Ÿè®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™æ ·ä¸€æ®µä»£ç ï¼š\n```c\nstatic int a;\nstatic int * p = &a;\n```\n\nå¦‚æœæŸä¸ªå…±äº«å¯¹è±¡é‡Œé¢æœ‰è¿™æ ·ä¸€æ®µä»£ç çš„è¯ï¼Œé‚£ä¹ˆæŒ‡é’ˆpçš„åœ°å€å°±æ˜¯ä¸€ä¸ªç»å¯¹åœ°å€ï¼Œå®ƒæŒ‡å‘å˜é‡aï¼Œè€Œå˜é‡açš„åœ°å€ä¼šéšç€å…±äº«å¯¹è±¡çš„è£…è½½åœ°å€æ”¹å˜è€Œæ”¹å˜ã€‚é‚£ä¹ˆæœ‰ä»€ä¹ˆåŠæ³•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ\n\n**å¯¹äºæ•°æ®æ®µæ¥è¯´ï¼Œå®ƒåœ¨æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä»½ç‹¬ç«‹çš„å‰¯æœ¬**ï¼Œæ‰€ä»¥å¹¶ä¸æ‹…å¿ƒè¢«è¿›ç¨‹æ”¹å˜ã€‚ä»è¿™ç‚¹æ¥çœ‹ï¼Œæˆ‘ä»¬**å¯ä»¥é€‰æ‹©è£…è½½æ—¶é‡å®šä½**çš„æ–¹æ³•æ¥è§£å†³æ•°æ®æ®µä¸­ç»å¯¹åœ°å€å¼•ç”¨é—®é¢˜ã€‚**å¯¹äºå…±äº«å¯¹è±¡æ¥è¯´ï¼Œå¦‚æœæ•°æ®æ®µä¸­æœ‰ç»å¯¹åœ°å€å¼•ç”¨ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å’Œé“¾æ¥å™¨å°±ä¼šäº§ç”Ÿä¸€ä¸ªé‡å®šä½è¡¨**ï¼Œè¿™ä¸ªé‡å®šä½è¡¨é‡Œé¢åŒ…å«äº†`R_386_RELATIVE`ç±»å‹çš„é‡å®šä½å…¥å£ï¼Œç”¨äºè§£å†³ä¸Šè¿°é—®é¢˜ã€‚å½“åŠ¨æ€é“¾æ¥å™¨è£…è½½å…±äº«å¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°è¯¥å…±äº«å¯¹è±¡æœ‰è¿™æ ·çš„é‡å®šä½å…¥å£ï¼Œé‚£ä¹ˆåŠ¨æ€é“¾æ¥å™¨å°±ä¼šå¯¹è¯¥å…±äº«å¯¹è±¡è¿›è¡Œé‡å®šä½ã€‚\n\nå®é™…ä¸Šï¼Œæˆ‘ä»¬**ç”šè‡³å¯ä»¥è®©ä»£ç æ®µä¹Ÿä½¿ç”¨è¿™ç§è£…è½½æ—¶é‡å®šä½çš„æ–¹æ³•ï¼Œè€Œä¸ä½¿ç”¨åœ°å€æ— å…³ä»£ç **ã€‚ä»å‰é¢çš„ä¾‹å­ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨ç¼–è¯‘å…±äº«å¯¹è±¡æ—¶ä½¿ç”¨äº†`-fPIC`å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°è¡¨ç¤ºäº§ç”Ÿåœ°å€æ— å…³çš„ä»£ç æ®µã€‚å¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨è¿™ä¸ªå‚æ•°æ¥äº§ç”Ÿå…±äº«å¯¹è±¡åˆä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ\n\n```bash\ngcc -shared -o pic.so pic.c\n```\n\nä¸Šé¢è¿™ä¸ªå‘½ä»¤å°±ä¼šäº§ç”Ÿä¸€ä¸ªä¸ä½¿ç”¨åœ°å€æ— å…³ä»£ç è€Œä½¿ç”¨è£…è½½æ—¶é‡å®šä½çš„å…±äº«å¯¹è±¡ã€‚ä½†æ­£å¦‚æˆ‘ä»¬å‰é¢åˆ†æè¿‡çš„ä¸€æ ·ï¼Œå¦‚æœä»£ç ä¸æ˜¯åœ°å€æ— å…³çš„ï¼Œå®ƒå°±ä¸èƒ½è¢«å¤šä¸ªè¿›ç¨‹ä¹‹é—´å…±äº«ï¼Œäºæ˜¯ä¹Ÿå°±å¤±å»äº†èŠ‚çœå†…å­˜çš„ä¼˜ç‚¹ã€‚ä½†æ˜¯è£…è½½æ—¶é‡å®šä½çš„å…±äº«å¯¹è±¡çš„è¿è¡Œé€Ÿåº¦è¦æ¯”ä½¿ç”¨åœ°å€æ— å…³ä»£ç çš„å…±äº«å¯¹è±¡å¿«ï¼Œå› ä¸ºå®ƒ**çœå»äº†åœ°å€æ— å…³ä»£ç ä¸­æ¯æ¬¡è®¿é—®å…¨å±€æ•°æ®å’Œå‡½æ•°æ—¶éœ€è¦åšä¸€æ¬¡è®¡ç®—å½“å‰åœ°å€ä»¥åŠé—´æ¥åœ°å€å¯»å€çš„è¿‡ç¨‹**ã€‚\n\nå¯¹äºå¯æ‰§è¡Œæ–‡ä»¶æ¥è¯´ï¼Œ**é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœå¯æ‰§è¡Œæ–‡ä»¶æ˜¯åŠ¨æ€é“¾æ¥çš„ï¼Œé‚£ä¹ˆGCCä¼šä½¿ç”¨PICçš„æ–¹æ³•æ¥äº§ç”Ÿå¯æ‰§è¡Œæ–‡ä»¶çš„ä»£ç æ®µéƒ¨åˆ†**ï¼Œä»¥ä¾¿äºä¸åŒçš„è¿›ç¨‹èƒ½å¤Ÿå…±äº«ä»£ç æ®µï¼ŒèŠ‚çœå†…å­˜ã€‚\n\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒåŠ¨æ€é“¾æ¥çš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­å­˜åœ¨â€œ.gotâ€è¿™æ ·çš„æ®µã€‚\n\n# å»¶è¿Ÿç»‘å®š\n\nåŠ¨æ€é“¾æ¥çš„ç¡®æœ‰å¾ˆå¤šä¼˜åŠ¿ï¼Œæ¯”é™æ€é“¾æ¥è¦çµæ´»å¾—å¤šï¼Œä½†å®ƒæ˜¯ä»¥ç‰ºç‰²ä¸€éƒ¨åˆ†æ€§èƒ½ä¸ºä»£ä»·çš„ã€‚æ®ç»Ÿè®¡ELFç¨‹åºåœ¨é™æ€é“¾æ¥ä¸‹è¦æ¯”åŠ¨æ€åº“ç¨å¾®å¿«ç‚¹ï¼Œå¤§çº¦ä¸º`1%~5%`ï¼Œå½“ç„¶è¿™å–å†³äºç¨‹åºæœ¬èº«çš„ç‰¹æ€§åŠè¿è¡Œç¯å¢ƒç­‰ã€‚\n\nåŠ¨æ€é“¾æ¥æ¯”é™æ€é“¾æ¥æ…¢çš„ä¸»è¦åŸå› æ˜¯ï¼š\n\n1. åŠ¨æ€é“¾æ¥ä¸‹å¯¹äºå…¨å±€å’Œé™æ€çš„æ•°æ®è®¿é—®éƒ½è¦è¿›è¡Œå¤æ‚çš„GOTå®šä½ï¼Œç„¶åé—´æ¥å¯»å€ï¼›å¯¹äºæ¨¡å—é—´çš„è°ƒç”¨ä¹Ÿè¦å…ˆå®šä½GOTï¼Œç„¶åå†è¿›è¡Œé—´æ¥è·³è½¬ï¼Œå¦‚æ­¤ä¸€æ¥ï¼Œç¨‹åºçš„è¿è¡Œé€Ÿåº¦å¿…å®šä¼šå‡æ…¢ã€‚\n2. å¦å¤–ä¸€ä¸ªå‡æ…¢è¿è¡Œé€Ÿåº¦çš„åŸå› æ˜¯åŠ¨æ€é“¾æ¥çš„é“¾æ¥å·¥ä½œåœ¨è¿è¡Œæ—¶å®Œæˆï¼Œå³ç¨‹åºå¼€å§‹æ‰§è¡Œæ—¶ï¼ŒåŠ¨æ€é“¾æ¥å™¨éƒ½è¦è¿›è¡Œä¸€æ¬¡é“¾æ¥å·¥ä½œï¼Œæ­£å¦‚æˆ‘ä»¬ä¸Šé¢æåˆ°çš„ï¼ŒåŠ¨æ€é“¾æ¥å™¨ä¼šå¯»æ‰¾å¹¶è£…è½½æ‰€éœ€è¦çš„å…±äº«å¯¹è±¡ï¼Œç„¶åè¿›è¡Œç¬¦å·æŸ¥æ‰¾åœ°å€é‡å®šä½ç­‰å·¥ä½œï¼Œè¿™äº›å·¥ä½œåŠ¿å¿…å‡æ…¢ç¨‹åºçš„å¯åŠ¨é€Ÿåº¦ã€‚\n\nè¿™æ˜¯å½±å“åŠ¨æ€é“¾æ¥æ€§èƒ½çš„ä¸¤ä¸ªä¸»è¦é—®é¢˜ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¼˜åŒ–åŠ¨æ€é“¾æ¥æ€§èƒ½çš„ä¸€äº›æ–¹æ³•ã€‚\n\n## ä¼˜åŒ–çš„çªç ´å£\n\nåœ¨åŠ¨æ€é“¾æ¥ä¸‹ï¼Œç¨‹åºæ¨¡å—ä¹‹é—´åŒ…å«äº†å¤§é‡çš„å‡½æ•°å¼•ç”¨ï¼ˆå…¨å±€å˜é‡å¾€å¾€æ¯”è¾ƒå°‘ï¼Œå› ä¸ºå¤§é‡çš„å…¨å±€å˜é‡ä¼šå¯¼è‡´æ¨¡å—ä¹‹é—´è€¦åˆåº¦å˜å¤§ï¼‰ã€‚æ‰€ä»¥åœ¨ç¨‹åºå¼€å§‹æ‰§è¡Œå‰ï¼ŒåŠ¨æ€é“¾æ¥ä¼šè€—è´¹ä¸å°‘æ—¶é—´ç”¨äºè§£å†³æ¨¡å—ä¹‹é—´çš„å‡½æ•°å¼•ç”¨çš„ç¬¦å·æŸ¥æ‰¾ä»¥åŠé‡å®šä½ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¸Šé¢æåˆ°çš„å‡æ…¢åŠ¨æ€é“¾æ¥æ€§èƒ½çš„ç¬¬äºŒä¸ªåŸå› ã€‚\n\nä¸è¿‡å¯ä»¥æƒ³è±¡ï¼Œåœ¨ä¸€ä¸ª**ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½å¾ˆå¤šå‡½æ•°åœ¨ç¨‹åºæ‰§è¡Œå®Œæ—¶éƒ½ä¸ä¼šè¢«ç”¨åˆ°ï¼Œæ¯”å¦‚ä¸€äº›é”™è¯¯å¤„ç†å‡½æ•°æˆ–è€…æ˜¯ä¸€äº›ç”¨æˆ·å¾ˆå°‘ç”¨åˆ°çš„åŠŸèƒ½æ¨¡å—ç­‰ï¼Œå¦‚æœä¸€å¼€å§‹å°±æŠŠæ‰€æœ‰å‡½æ•°éƒ½é“¾æ¥å¥½å®é™…ä¸Šæ˜¯ä¸€ç§æµªè´¹**ã€‚æ‰€ä»¥ELFé‡‡ç”¨äº†ä¸€ç§å«åš**å»¶è¿Ÿç»‘å®š(Lazy Binding)**çš„åšæ³•ï¼Œ**åŸºæœ¬çš„æ€æƒ³å°±æ˜¯å½“å‡½æ•°ç¬¬ä¸€æ¬¡è¢«ç”¨åˆ°æ—¶æ‰ç”±åŠ¨æ€é“¾æ¥å™¨è¿›è¡Œç»‘å®šï¼ˆç¬¦å·æŸ¥æ‰¾ã€é‡å®šä½ç­‰ï¼‰**ï¼Œå¦‚æœæ²¡æœ‰ç”¨åˆ°åˆ™ä¸è¿›è¡Œç»‘å®šã€‚è¿™æ ·çš„åšæ³•å¯ä»¥å¤§å¤§åŠ å¿«ç¨‹åºçš„å¯åŠ¨é€Ÿåº¦ï¼Œç‰¹åˆ«æœ‰åˆ©äºä¸€äº›æœ‰å¤§é‡å‡½æ•°å¼•ç”¨å’Œå¤§é‡æ¨¡å—çš„ç¨‹åºã€‚\n\n## å»¶è¿Ÿç»‘å®šå®ç°\n\nELFä½¿ç”¨**PLT**(Procedure Linkage Table)çš„æ–¹æ³•æ¥å®ç°ï¼Œè¿™ç§æ–¹æ³•ä½¿ç”¨äº†ä¸€äº›å¾ˆç²¾å·§çš„æŒ‡ä»¤åºåˆ—æ¥å®Œæˆã€‚\n\nåœ¨å¼€å§‹è¯¦ç»†ä»‹ç»PLTä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆä»åŠ¨æ€é“¾æ¥å™¨çš„è§’åº¦è®¾æƒ³ä¸€ä¸‹ï¼š\n\nå‡è®¾`liba.so`éœ€è¦è°ƒç”¨`libc.so`ä¸­çš„`bar()`å‡½æ•°ï¼Œé‚£ä¹ˆå½“`liba.so`ä¸­ç¬¬ä¸€æ¬¡è°ƒç”¨`bar()`æ—¶ï¼Œè¿™æ—¶å€™å°±éœ€è¦**è°ƒç”¨åŠ¨æ€é“¾æ¥å™¨ä¸­çš„æŸä¸ªå‡½æ•°æ¥å®Œæˆåœ°å€ç»‘å®šå·¥ä½œ**ï¼Œæˆ‘ä»¬å‡è®¾è¿™ä¸ªå‡½æ•°å«åš`lookup()`ï¼Œé‚£ä¹ˆ`lookup()`éœ€è¦çŸ¥é“å“ªäº›å¿…è¦çš„ä¿¡æ¯æ‰èƒ½å®Œæˆè¿™ä¸ªå‡½æ•°åœ°å€ç»‘å®šå·¥ä½œå‘¢ï¼Ÿç­”æ¡ˆå¾ˆæ˜æ˜¾ï¼Œ**`lookup()`è‡³å°‘éœ€è¦çŸ¥é“è¿™ä¸ªåœ°å€ç»‘å®šå‘ç”Ÿåœ¨å“ªä¸ªæ¨¡å—ï¼Œå“ªä¸ªå‡½æ•°**ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å‡è®¾`lookup`çš„åŸå‹ä¸º`lookup(module, function)`ï¼Œè¿™ä¸¤ä¸ªå‚æ•°çš„å€¼åœ¨æˆ‘ä»¬è¿™ä¸ªä¾‹å­ä¸­åˆ†åˆ«ä¸º`liba.so`å’Œ`bar()`ã€‚\n\nåœ¨`Glibc`ä¸­ï¼Œæˆ‘ä»¬è¿™é‡Œçš„`lookup()`å‡½æ•°çœŸæ­£çš„åå­—å«`_dl_runtime_resolve()`ã€‚\n\nå½“æˆ‘ä»¬è°ƒç”¨æŸä¸ªå¤–éƒ¨æ¨¡å—çš„å‡½æ•°æ—¶ï¼Œå¦‚æœæŒ‰ç…§é€šå¸¸çš„åšæ³•åº”è¯¥æ˜¯é€šè¿‡GOTä¸­ç›¸åº”çš„é¡¹è¿›è¡Œé—´æ¥è·³è½¬ã€‚**PLTä¸ºäº†å®ç°å»¶è¿Ÿç»‘å®šï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­é—´åˆå¢åŠ äº†ä¸€å±‚é—´æ¥è·³è½¬**ã€‚è°ƒç”¨å‡½æ•°å¹¶**ä¸ç›´æ¥é€šè¿‡GOTè·³è½¬ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªå«ä½œPLTé¡¹çš„ç»“æ„æ¥è¿›è¡Œè·³è½¬**ã€‚æ¯ä¸ªå¤–éƒ¨å‡½æ•°åœ¨PLTä¸­éƒ½æœ‰ä¸€ä¸ªç›¸åº”çš„é¡¹ï¼Œæ¯”å¦‚`bar()`å‡½æ•°åœ¨PLTä¸­çš„é¡¹çš„åœ°å€æˆ‘ä»¬ç§°ä¹‹ä¸º`bar@plt`ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹bar@pltçš„å®ç°ï¼š\n\n```x86asm\nbar@plt:\njmp *(bar@GOT)\npush n\npush moduleID\njump _dl_runtime_resolve\n```\n\n`bar@plt`çš„ç¬¬ä¸€æ¡æŒ‡ä»¤æ˜¯ä¸€æ¡é€šè¿‡GOTé—´æ¥è·³è½¬çš„æŒ‡ä»¤ã€‚`bar@GOT`è¡¨ç¤ºGOTä¸­ä¿å­˜`bar()`è¿™ä¸ªå‡½æ•°ç›¸åº”çš„é¡¹ã€‚å¦‚æœé“¾æ¥å™¨åœ¨åˆå§‹åŒ–é˜¶æ®µå·²ç»åˆå§‹åŒ–è¯¥é¡¹ï¼Œå¹¶ä¸”å°†`bar()`çš„åœ°å€å¡«å…¥è¯¥é¡¹ï¼Œé‚£ä¹ˆè¿™ä¸ªè·³è½¬æŒ‡ä»¤çš„ç»“æœå°±æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„ï¼Œè·³è½¬åˆ°`bar()`ï¼Œå®ç°å‡½æ•°æ­£ç¡®è°ƒç”¨ã€‚\n\nä½†æ˜¯ä¸ºäº†å®ç°å»¶è¿Ÿç»‘å®šï¼Œé“¾æ¥å™¨åœ¨åˆå§‹åŒ–é˜¶æ®µå¹¶æ²¡æœ‰å°†`bar()`çš„åœ°å€å¡«å…¥åˆ°è¯¥é¡¹ï¼Œè€Œæ˜¯å°†ä¸Šé¢ä»£ç ä¸­ç¬¬äºŒæ¡æŒ‡ä»¤`push n`çš„åœ°å€å¡«å…¥åˆ°`bar@GOT`ä¸­ï¼Œè¿™ä¸ªæ­¥éª¤ä¸éœ€è¦æŸ¥æ‰¾ä»»ä½•ç¬¦å·ï¼Œæ‰€ä»¥ä»£ä»·å¾ˆä½ã€‚å¾ˆæ˜æ˜¾ï¼Œç¬¬ä¸€æ¡æŒ‡ä»¤çš„æ•ˆæœæ˜¯è·³è½¬åˆ°ç¬¬äºŒæ¡æŒ‡ä»¤ï¼Œç›¸å½“äºæ²¡æœ‰è¿›è¡Œä»»ä½•æ“ä½œã€‚\n\nç¬¬äºŒæ¡æŒ‡ä»¤å°†ä¸€ä¸ªæ•°å­—nå‹å…¥å †æ ˆä¸­ï¼Œè¿™ä¸ªæ•°å­—æ˜¯barè¿™ä¸ªç¬¦å·å¼•ç”¨åœ¨é‡å®šä½è¡¨`.rel.plt`ä¸­çš„ä¸‹æ ‡ï¼Œæ¥ç€åˆæ˜¯ä¸€æ¡`push`æŒ‡ä»¤å°†æ¨¡å—çš„IDå‹å…¥åˆ°å †æ ˆï¼Œç„¶åè·³è½¬åˆ°`_dl_runtime_resolve`ã€‚è¿™å®é™…ä¸Šå°±æ˜¯åœ¨å®ç°æˆ‘ä»¬å‰é¢æåˆ°çš„`lookup(module, function)`è¿™ä¸ªå‡½æ•°çš„è°ƒç”¨ï¼šå…ˆå°†æ‰€éœ€è¦å†³è®®ç¬¦å·çš„ä¸‹æ ‡å‹å…¥å †æ ˆï¼Œå†å°†æ¨¡å—IDå‹å…¥å †æ ˆï¼Œç„¶åè°ƒç”¨åŠ¨æ€é“¾æ¥å™¨çš„`_dl_runtime_resolve()`å‡½æ•°æ¥å®Œæˆç¬¦å·è§£æå’Œé‡å®šä½å·¥ä½œã€‚`_dl_runtime_resolve()`åœ¨è¿›è¡Œä¸€ç³»åˆ—å·¥ä½œä»¥åå°†`bar()`çš„çœŸæ­£åœ°å€å¡«å…¥åˆ°`bar@GOT`ä¸­ã€‚\n\nä¸€æ—¦`bar()`è¿™ä¸ªå‡½æ•°è¢«è§£æå®Œæ¯•ï¼Œå½“æˆ‘ä»¬å†æ¬¡è°ƒç”¨`bar@plt`æ—¶ï¼Œç¬¬ä¸€æ¡`jmp`æŒ‡ä»¤å°±èƒ½å¤Ÿè·³è½¬åˆ°çœŸæ­£çš„`bar()`å‡½æ•°ä¸­ï¼Œ`bar()`å‡½æ•°è¿”å›çš„æ—¶å€™ä¼šæ ¹æ®å †æ ˆé‡Œé¢ä¿å­˜çš„`EIP`ç›´æ¥è¿”å›åˆ°è°ƒç”¨è€…ï¼Œè€Œä¸ä¼šå†ç»§ç»­æ‰§è¡Œ`bar@plt`ä¸­ç¬¬äºŒæ¡æŒ‡ä»¤å¼€å§‹çš„é‚£æ®µä»£ç ï¼Œé‚£æ®µä»£ç åªä¼šåœ¨ç¬¦å·æœªè¢«è§£ææ—¶æ‰§è¡Œä¸€æ¬¡ã€‚\n\nä¸Šé¢æˆ‘ä»¬æè¿°çš„æ˜¯PLTçš„åŸºæœ¬åŸç†ï¼ŒPLTçœŸæ­£çš„å®ç°è¦æ¯”å®ƒçš„ç»“æ„ç¨å¾®å¤æ‚ä¸€äº›ã€‚ELFå°†GOTæ‹†åˆ†æˆäº†ä¸¤ä¸ªè¡¨å«åš`.got`å’Œ`.got.plt`ã€‚å…¶ä¸­`.got`ç”¨æ¥ä¿å­˜å…¨å±€å˜é‡å¼•ç”¨çš„åœ°å€ï¼Œ`.got.plt`ç”¨æ¥ä¿å­˜å‡½æ•°å¼•ç”¨çš„åœ°å€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰å¯¹äºå¤–éƒ¨å‡½æ•°çš„å¼•ç”¨å…¨éƒ¨è¢«åˆ†ç¦»å‡ºæ¥æ”¾åˆ°äº†`.got.plt`ä¸­ã€‚å¦å¤–`.got.plt`è¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„åœ°æ–¹æ˜¯å®ƒçš„å‰ä¸‰é¡¹æ˜¯æœ‰ç‰¹æ®Šæ„ä¹‰çš„ï¼Œåˆ†åˆ«å«ä¹‰å¦‚ä¸‹ï¼š\n\n1. ç¬¬ä¸€é¡¹ä¿å­˜çš„æ˜¯`.dynamic`æ®µçš„åœ°å€ï¼Œè¿™ä¸ªæ®µæè¿°äº†æœ¬æ¨¡å—åŠ¨æ€é“¾æ¥ç›¸å…³çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬åœ¨åé¢è¿˜ä¼šä»‹ç»`.dynamic`æ®µã€‚\n2. ç¬¬äºŒé¡¹ä¿å­˜çš„æ˜¯æœ¬æ¨¡å—çš„IDã€‚\n3. ç¬¬ä¸‰é¡¹ä¿å­˜çš„æ˜¯`_dl_runtime_resolve()`çš„åœ°å€ã€‚\n\nå…¶ä¸­ç¬¬äºŒé¡¹å’Œç¬¬ä¸‰é¡¹ç”±åŠ¨æ€é“¾æ¥å™¨åœ¨è£…è½½å…±äº«æ¨¡å—çš„æ—¶å€™è´Ÿè´£å°†å®ƒä»¬åˆå§‹åŒ–ã€‚`.got.plt`çš„å…¶ä½™é¡¹åˆ†åˆ«å¯¹åº”æ¯ä¸ªå¤–éƒ¨å‡½æ•°çš„å¼•ç”¨ã€‚PLTçš„ç»“æ„ä¹Ÿä¸æˆ‘ä»¬ç¤ºä¾‹ä¸­çš„PLTç¨æœ‰ä¸åŒï¼Œä¸ºäº†å‡å°‘ä»£ç çš„é‡å¤ï¼ŒELFæŠŠä¸Šé¢ä¾‹å­ä¸­çš„æœ€åä¸¤æ¡æŒ‡ä»¤æ”¾åˆ°PLTä¸­çš„ç¬¬ä¸€é¡¹ã€‚å¹¶ä¸”è§„å®šæ¯ä¸€é¡¹çš„é•¿åº¦æ˜¯16ä¸ªå­—èŠ‚ï¼Œåˆšå¥½ç”¨æ¥å­˜æ”¾3æ¡æŒ‡ä»¤ï¼Œå®é™…çš„PLTåŸºæœ¬ç»“æ„å¦‚å›¾æ‰€ç¤ºã€‚\n![image-20220509165057010](../../images/Linux_åº“/image-20220509165057010.png)\n\nå®é™…çš„PLTåŸºæœ¬ç»“æ„ä»£ç å¦‚ä¸‹ï¼š\n\n```x86asm\nPLT0:\npush *(GOT + 4)\njump *(GOT + 8)\n...\n\nbar@plt:\njmp *(bar@GOT)\npush n\njump PLT0\n```\n\nPLTåœ¨ELFæ–‡ä»¶ä¸­ä»¥ç‹¬ç«‹çš„æ®µå­˜æ”¾ï¼Œæ®µåé€šå¸¸å«åš`.plt`ï¼Œå› ä¸ºå®ƒæœ¬èº«æ˜¯ä¸€äº›åœ°å€æ— å…³çš„ä»£ç ï¼Œæ‰€ä»¥å¯ä»¥è·Ÿä»£ç æ®µç­‰ä¸€èµ·åˆå¹¶æˆåŒä¸€ä¸ªå¯è¯»å¯æ‰§è¡Œçš„`Segment`è¢«è£…è½½å…¥å†…å­˜ã€‚\n\n# æ€»ç»“\n\næˆ‘ä»¬åˆ†æäº†ä½¿ç”¨åŠ¨æ€é“¾æ¥æŠ€æœ¯çš„åŸå› ï¼Œå³ä½¿ç”¨åŠ¨æ€é“¾æ¥å¯ä»¥æ›´åŠ æœ‰æ•ˆåœ°åˆ©ç”¨å†…å­˜å’Œç£ç›˜èµ„æºï¼Œå¯ä»¥æ›´åŠ æ–¹ä¾¿åœ°ç»´æŠ¤å‡çº§ç¨‹åºï¼Œå¯ä»¥è®©ç¨‹åºçš„é‡ç”¨å˜å¾—æ›´åŠ å¯è¡Œå’Œæœ‰æ•ˆã€‚\n\næ¥ç€æˆ‘ä»¬ä»‹ç»äº†åŠ¨æ€é“¾æ¥çš„åŸºæœ¬ä¾‹å­ï¼Œåˆ†æäº†åŠ¨æ€é“¾æ¥ä¸­è£…è½½åœ°å€ä¸ç¡®å®šæ—¶å¦‚ä½•è§£å†³ç»å¯¹åœ°å€å¼•ç”¨çš„é—®é¢˜ã€‚\n\n**è£…è½½æ—¶é‡å®šä½**å’Œ**åœ°å€æ— å…³ä»£ç **æ˜¯è§£å†³ç»å¯¹åœ°å€å¼•ç”¨é—®é¢˜çš„ä¸¤ä¸ªæ–¹æ³•ã€‚\n\n1. è£…è½½æ—¶é‡å®šä½çš„ç¼ºç‚¹æ˜¯**æ— æ³•å…±äº«ä»£ç æ®µï¼Œä½†æ˜¯å®ƒçš„è¿è¡Œé€Ÿåº¦è¾ƒå¿«**ï¼›\n2. åœ°å€æ— å…³ä»£ç çš„ç¼ºç‚¹æ˜¯**è¿è¡Œé€Ÿåº¦ç¨æ…¢ï¼Œä½†å®ƒå¯ä»¥å®ç°ä»£ç æ®µåœ¨å„ä¸ªè¿›ç¨‹ä¹‹é—´çš„å…±äº«**ã€‚\n","categories":["Linux"]},{"title":"å‡½æ•°è°ƒç”¨å †æ ˆè¿‡ç¨‹","url":"/è®¡ç®—æœºçŸ¥è¯†ä½“ç³»/å‡½æ•°è°ƒç”¨å †æ ˆè¿‡ç¨‹/","content":"# ä¸€æ®µä»£ç \n\n```cpp\nint sum(int a, int b)\n{\n    int temp = 0;\n    temp = a + b;\n    return temp;\n}\nint main()\n{\n    int a = 10;\n    int b = 20;\n    int res = sum(a, b);\n    cout << \"res:\" << res << endl;\n    return 0;\n}\n```\n\né—®é¢˜1ï¼šmainå‡½æ•°è°ƒç”¨sumï¼Œsumæ‰§è¡Œå®Œåï¼Œæ€ä¹ˆçŸ¥é“å›åˆ°å“ªä¸ªå‡½æ•°ä¸­ï¼Ÿ\n\né—®é¢˜2ï¼šsumå‡½æ•°æ‰§è¡Œå®Œåï¼Œå›åˆ°mainåï¼Œæ€ä¹ˆçŸ¥é“ä¸‹ä¸€æ¡æŒ‡ä»¤åœ¨å“ªï¼Ÿ\n\n# æ ˆå¸§\n\næœ‰ä¸¤ä¸ªä¸æ ˆåº•ã€æ ˆé¡¶åœ°å€æœ‰å…³çš„å¯„å­˜å™¨ã€‚\n\n`ebp`å…¨ç§°`Extended Base Pointer`ï¼Œæ‰©å±•åŸºå€æŒ‡é’ˆå¯„å­˜å™¨ï¼Œç”¨äºå­˜æ”¾å‡½æ•°æ ˆåº•æŒ‡é’ˆã€‚\n\n`esp`å…¨ç§°`Extended Stack Pointer`ï¼Œæ‰©å±•æ ˆæŒ‡é’ˆå¯„å­˜å™¨ï¼Œç”¨äºå­˜æ”¾å‡½æ•°æ ˆé¡¶æŒ‡é’ˆï¼ŒæŒ‡å‘æ ˆçš„æ ˆé¡¶ï¼ˆä¸‹ä¸€ä¸ªå‹å…¥æ ˆçš„æ´»åŠ¨è®°å½•çš„é¡¶éƒ¨ï¼‰ã€‚\n\nå…ˆåˆ†æmainå‡½æ•°çš„æ ˆå¸§ã€‚\n\n```x86asm\nmov dword ptr[ebp-4], 0Ah\t# int a = 10;\nmov dword ptr[ebp-8], 14h\t# int b = 20;\n```\n\n","categories":["è®¡ç®—æœºçŸ¥è¯†ä½“ç³»"]},{"title":"è¿›ç¨‹åœ°å€ç©ºé—´ä½“ç³»","url":"/è®¡ç®—æœºçŸ¥è¯†ä½“ç³»/è¿›ç¨‹åœ°å€ç©ºé—´ä½“ç³»/","content":"# è¿›ç¨‹åœ°å€ç©ºé—´ä½“ç³»å›¾\n\n![image-20220507094939651](../../images/åœ°å€ç©ºé—´ä½“ç³»/image-20220507094939651.png)\n\nå¯¹äº32ä½X86æ¶æ„ä¸Šè¿è¡Œçš„Linuxè€Œè¨€ï¼Œ å…¶è™šæ‹Ÿåœ°å€ç©ºé—´çš„å¯»å€èŒƒå›´ä»`0 ~ 4G`ï¼Œå†…æ ¸å°†è¿™å—ç©ºé—´åˆ’åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œå°†æœ€é«˜çš„**1G**å­—èŠ‚`0xC0000000 ~ 0xFFFFFFFF`ç§°ä¸º**â€œå†…æ ¸ç©ºé—´â€**ï¼Œ é¡¾åæ€ä¹‰æ˜¯æä¾›ç»™å†…æ ¸ä½¿ç”¨ï¼›è€Œå°†è¾ƒä½**3G**å­—èŠ‚`0x00000000 ~ 0xBFFFFFFF`ç§°ä¸º**â€œç”¨æˆ·ç©ºé—´â€**ï¼Œå³æä¾›ç»™å„ä¸ªè¿è¡Œçš„è¿›ç¨‹ä½¿ç”¨ã€‚\n\nç†è®ºä¸Šï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æ˜¯å¯ä»¥è®¿é—®å…¨éƒ¨èƒ½å¯»å€çš„4Gè™šæ‹Ÿå†…å­˜ç©ºé—´çš„ï¼Œä½†æ˜¯ç³»ç»Ÿä¸ºäº†é˜²æ­¢å†…æ ¸ç©ºé—´è¢«ç”¨æˆ·è¿›ç¨‹æœ‰æ„æˆ–æ— æ„çš„ç ´åï¼Œæ‰€ä»¥é‡‡ç”¨äº†åˆ†çº§ä¿æŠ¤æªæ–½ï¼š å°†å†…æ ¸å®šä¸º0çº§ï¼Œå°†ç”¨æˆ·è¿›ç¨‹å®šä¸º3çº§ï¼Œ **è¿™æ ·ç”¨æˆ·è¿›ç¨‹ä¾¿æ— æ³•ç›´æ¥è®¿é—®å†…æ ¸çš„è™šæ‹Ÿå†…å­˜ç©ºé—´ï¼Œä»…èƒ½é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ¥è¿›å…¥å†…æ ¸æ€ï¼Œä»è€Œæ¥è®¿é—®è¢«é™å®šçš„éƒ¨åˆ†å†…æ ¸ç©ºé—´åœ°å€**ã€‚åŒæ—¶ï¼Œç”±äºè®¿é—®æƒé™çš„æœºåˆ¶ï¼Œä¸åŒçš„è¿›ç¨‹é—´ä¹Ÿéƒ½æ‹¥æœ‰ç‹¬ç«‹çš„ç”¨æˆ·ç©ºé—´ã€‚è¿™æ ·éå¯¹ç§°çš„è®¿é—®æœºåˆ¶ä½¿å¾—Linuxç³»ç»Ÿè¿è¡Œæ›´åŠ çš„å®‰å…¨ç¨³å®šã€‚\n\nå¦å¤–ï¼Œ**ç”¨æˆ·è¿›ç¨‹æ˜¯æ— æ³•è®¿é—®`0x00000000 ~ 0x08048000`è¿™ä¸€æ®µè™šæ‹Ÿå†…å­˜åœ°å€çš„**ï¼Œåœ¨è¿™æ®µåœ°å€ä¸Šæœ‰è¯¸å¤šä¾‹å¦‚Cåº“ï¼ŒåŠ¨æ€åŠ è½½å™¨å¦‚ld.soå’ŒVDSOç­‰çš„æ˜ å°„åœ°å€ã€‚ å¦‚æœç”¨æˆ·è¿›ç¨‹è®¿é—®åˆ°è¯¥åŒºé—´ä¼šè¿”å›æ®µé”™è¯¯ã€‚\n\n# å†…æ ¸ç©ºé—´\n\næ¯ä¸€ä¸ªè¿›ç¨‹çš„ç”¨æˆ·ç©ºé—´æ˜¯ç§æœ‰çš„ï¼Œä½†æ˜¯æ‰€æœ‰è¿›ç¨‹å…±äº«ç”¨ä¸€ä¸ªå†…æ ¸ç©ºé—´ã€‚\n\næ‰€ä»¥ï¼Œè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æ–¹å¼ä¸­çš„åŒ¿åç®¡é“é€šä¿¡å°±åº”ç”¨äºæ­¤ã€‚\n\n## ZONE_HIGHMEM\n\né«˜ç«¯å†…å­˜ã€‚åœ¨32ä½Linuxç³»ç»Ÿï¼Œå†…æ ¸ç©ºé—´åªæœ‰1Gï¼Œåœ¨å†…æ ¸ä¸­æ˜ å°„é«˜äº1Gçš„ç‰©ç†å†…å­˜æ—¶ï¼Œä¼šä½¿ç”¨åˆ°é«˜ç«¯å†…å­˜ã€‚64ä½ä¸å­˜åœ¨é«˜ç«¯å†…å­˜ï¼Œå› ä¸º64ä½ç³»ç»Ÿçš„å†…æ ¸ç©ºé—´æœ‰512Gã€‚\n\n## ZONE_NORMAL\n\nå†…æ ¸å¸¸ç”¨çš„éƒ¨åˆ†ã€æœ€é‡è¦çš„éƒ¨åˆ†ã€‚\n\n## ZONE_DMA\n\nç›´æ¥å†…å­˜è®¿é—®ã€‚åŠ å¿«ç£ç›˜å’Œå†…å­˜äº¤æ¢æ•°æ®ã€‚é¿å…äº†ç»è¿‡CPUå¯„å­˜å™¨çš„è¿‡ç¨‹ï¼Œå› æ­¤å¯ä»¥é¿å…æµªè´¹CPUèµ„æºã€‚\n\n# å‘½ä»¤è¡Œå‚æ•°å’Œç¯å¢ƒå˜é‡\n\nmainå‡½æ•°çš„åŸå‹å°±æ˜¯ä¸€ä¸ªä¾‹å­ã€‚\n\n```\nint main(int argc, char ** argv, char ** environ)\n```\n\nargcè®°å½•äº†å‘½ä»¤è¡Œå‚æ•°çš„ä¸ªæ•°ã€‚\n\nargvå­˜çš„æ˜¯å‘½ä»¤è¡Œå‚æ•°ã€‚\n\nenvironå­˜çš„æ˜¯ç¯å¢ƒå˜é‡ã€‚\n\næˆ‘ä»¬ç®€å•åœ°å¼•å…¥ä¸€ä¸ªstdio.hå¤´æ–‡ä»¶ï¼Œå°±èƒ½ä½¿ç”¨Cè¯­è¨€åº“å‡½æ•°äº†ï¼Œè¿™ä¸ªå¤´æ–‡ä»¶å¹¶æ²¡æœ‰åœ¨æœ¬åœ°ï¼Œè¿™æ˜¯å› ä¸ºç¯å¢ƒå˜é‡æŒ‡å‡ºäº†åº“æ–‡ä»¶å­˜åœ¨å“ªäº›ä½ç½®ï¼Œç¨‹åºç¼–è¯‘é“¾æ¥æ—¶åŠ è½½äº†ç¯å¢ƒå˜é‡ã€‚\n\nè¿™é‡Œæ¶‰åŠçš„å‘½ä»¤è¡Œå‚æ•°ã€ç¯å¢ƒå˜é‡éƒ½æ˜¯å­˜åœ¨äºæ ˆçš„é«˜å†…å­˜åœ°å€ç©ºé—´çš„ã€‚\n\n# æ ˆ\n\nä¸ºä½•è¦æœ‰æ ˆï¼Ÿç¨‹åºè¿è¡Œæ—¶ï¼Œæ€»è¦æœ‰ä¸€ä¸ªä¸»å…¥å£ï¼Œå³\n\n**è¿›ç¨‹ä¸­çš„æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰å±äºè‡ªå·±çš„æ ˆ**ã€‚\n\nç”¨æˆ·ç©ºé—´ä¸­åœ°å€æœ€é«˜çš„æ®µå«åšæ ˆï¼Œä»–è¢«**ç”¨äºå­˜æ”¾å‡½æ•°å‚æ•°å’ŒåŠ¨æ€å±€éƒ¨å˜é‡**ã€‚è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æˆ–å‡½æ•°ä¼šå°†ä¸€ä¸ªæ–°çš„æ ˆå¸§ï¼ˆstack frameï¼‰å‹å…¥åˆ°æ ˆä¸­ï¼Œè¿™ä¸ªæ ˆå¸§ä¼šåœ¨å‡½æ•°è¿”å›æ—¶è¢«æ¸…ç†æ‰ã€‚\n\nåœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œè¿›ç¨‹é€šè¿‡å‡½æ•°çš„è°ƒç”¨å’Œè¿”å›ä½¿å¾—æ§åˆ¶æƒåœ¨å„ä¸ªå‡½æ•°é—´è½¬ç§»ï¼Œåœ¨æ–°å‡½æ•°è°ƒç”¨æ—¶ï¼ŒåŸå‡½æ•°çš„æ ˆå¸§çŠ¶æ€ä¿æŒä¸å˜ï¼Œå¹¶ä¸ºæ–°çš„å‡½æ•°å¼€è¾Ÿå…¶æ‰€éœ€çš„å¸§ç©ºé—´ï¼›å½“è°ƒç”¨å‡½æ•°è¿”å›æ—¶ï¼Œè¯¥å‡½æ•°çš„è¿è¡Œç©ºé—´éšç€æ ˆå¸§è¢«å¼¹å‡ºè€Œæ¸…ç©ºï¼Œè¿™æ¬¡è¿›ç¨‹å›åˆ°åŸå‡½æ•°çš„æ ˆå¸§ç¯å¢ƒä¸­ç»§ç»­æ‰§è¡Œã€‚\n\n>é€šè¿‡ä¸æ–­å‘æ ˆä¸­å‹å…¥æ•°æ®ï¼Œè¶…å‡ºå…¶å®¹é‡å°±ä¼šè€—å°½æ ˆæ‰€å¯¹åº”çš„å†…å­˜åŒºåŸŸï¼Œè¿™å°†è§¦å‘ä¸€ä¸ªé¡µæ•…éšœï¼ˆpage faultï¼‰ï¼Œè€Œè¢«Linuxçš„`expand_stack()`å¤„ç†ï¼Œå®ƒä¼šè°ƒç”¨`acct_stack_growth()`æ¥æ£€æŸ¥æ˜¯å¦è¿˜æœ‰åˆé€‚çš„åœ°æ–¹ç”¨äºæ ˆçš„å¢é•¿ã€‚\n>\n>å¦‚æœæ ˆçš„å¤§å°ä½äº`RLIMIT_STACK`ï¼ˆé€šå¸¸ä¸º8MBï¼‰ï¼Œé‚£ä¹ˆä¸€èˆ¬æƒ…å†µä¸‹æ ˆä¼šè¢«åŠ é•¿ï¼Œç¨‹åºç»§ç»­æ‰§è¡Œï¼Œæ„Ÿè§‰ä¸åˆ°å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…ã€‚è¿™æ˜¯ä¸€ç§å°†æ ˆæ‰©å±•åˆ°æ‰€éœ€å¤§å°çš„å¸¸è§„æœºåˆ¶ï¼›\n>\n>ç„¶è€Œï¼Œå¦‚æœè¾¾åˆ°äº†æœ€å¤§æ ˆç©ºé—´çš„å¤§å°ï¼Œå°±ä¼šæ ˆæº¢å‡º(stack overflow)ï¼Œç¨‹åºæ”¶åˆ°ä¸€ä¸ªæ®µé”™è¯¯(segmentation fault)ã€‚\n>\n>* åŠ¨æ€æ ˆå¢é•¿æ˜¯å”¯ä¸€ä¸€ç§è®¿é—®æœªæ˜ å°„å†…å­˜åŒºåŸŸè€Œè¢«å…è®¸çš„æƒ…å½¢ï¼Œå…¶ä»–ä»»ä½•å¯¹æœªæ˜ å°„å†…å­˜åŒºåŸŸçš„è®¿é—®éƒ½ä¼šè§¦å‘é¡µé”™è¯¯ï¼Œä»è€Œå¯¼è‡´æ®µé”™è¯¯ã€‚ä¸€äº›è¢«æ˜ å°„çš„åŒºåŸŸæ˜¯åªè¯»çš„ï¼Œå› æ­¤ä¼å›¾å†™è¿™äº›åŒºåŸŸä¹Ÿä¼šå¯¼è‡´æ®µé”™è¯¯ã€‚\n\n# å…±äº«åº“å†…å­˜æ®µ\n\nåœ¨æ ˆå’Œå †ä¹‹é—´ï¼Œæœ‰ä¸€æ®µæ˜¯ç”¨æ¥å­˜æ”¾å…±äº«åº“çš„ã€‚\n\n# mmapæ®µ\n\nmmapæ®µï¼Œå³Memory Mapping Segmentã€‚\n\n> File mappings (including dynamic libraries) and anonymous mappings. Example: `/lib/libc.so`\n\nåœ¨æ ˆæ®µçš„ä½ä¸€æ®µä¾¿æ˜¯mmapæ®µï¼Œmmapæ˜¯ä¸€ç§é«˜æ•ˆä¾¿æ·çš„æ–‡ä»¶I/Oæ–¹å¼ï¼Œ**å†…æ ¸å°†æ–‡ä»¶å†…å®¹æ˜ å°„åœ¨æ­¤æ®µå†…å­˜ä¸­ï¼Œå¸¸è§æƒ…å½¢ä¾¿æ˜¯åŠ è½½åŠ¨æ€é“¾æ¥åº“**ã€‚å¦å¤–ï¼Œåœ¨Linuxä¸­ï¼Œå¦‚æœä½ é€šè¿‡`malloc`ç”³è¯·ä¸€å—å¤§äº`MMAP_THRESHOLD`(é€šå¸¸é»˜è®¤ä¸º128KBï¼Œ å¯ç”¨`mallopt()`ä¿®æ”¹)å¤§å°çš„å †ç©ºé—´æ—¶ï¼Œ glibcä¼šè¿”å›ä¸€å—åŒ¿åçš„mmapå†…å­˜å—è€Œéä¸€å—å †å†…å­˜ã€‚\n\n# å †\n\nåœ¨mmapæ®µä¸‹é¢ä¾¿æ˜¯å †æ®µäº†ï¼Œå †æ®µåŒæ ˆæ®µä¸€æ ·ï¼Œéƒ½æ˜¯ä¸ºè¿›ç¨‹è¿è¡Œæä¾›åŠ¨æ€çš„å†…å­˜åˆ†é…ï¼Œ**ä½†æ˜¯å…¶å’Œæ ˆçš„åŒºåˆ«åœ¨äºå †ä¸Šå†…å­˜çš„ç”Ÿå‘½æœŸå’Œæ‰§è¡Œåˆ†é…çš„å‡½æ•°çš„ç”Ÿå‘½æœŸä¸ä¸€è‡´ï¼Œå †ä¸Šåˆ†é…çš„å†…å­˜åªæœ‰åœ¨å¯¹åº”è¿›ç¨‹é€šè¿‡ç³»ç»Ÿè°ƒç”¨ä¸»åŠ¨é‡Šæ”¾æˆ–è¿›ç¨‹ç»“æŸåæ‰ä¼šé‡Šæ”¾**ã€‚æ‰€ä»¥ï¼Œå†…å­˜æ³„éœ²è¿™ä¸ªç»å…¸çš„é—®é¢˜ä¾¿ç”±æ­¤äº§ç”Ÿã€‚\n\nå¦å¤–ï¼Œ ç”±äºå †å†…å­˜çš„åå¤ç”³è¯·å’Œé‡Šæ”¾ï¼Œä¹Ÿä¸å¯é¿å…çš„ä¼šé€ æˆå †æ®µç¢ç‰‡åŒ–ã€‚è¿™ç§æƒ…å†µå¯ä»¥ä½¿ç”¨â€œå¯¹è±¡æ± â€çš„è®¾è®¡æ‰‹æ®µæ¥é¿å…ã€‚\n\n# é™æ€å†…å­˜åŒºåŸŸï¼ˆæ•°æ®æ®µï¼‰--bssæ®µå’Œdataæ®µ\n\nå †æ®µå†å¾€ä¸‹ä¾¿æ˜¯**BSSæ®µ**å’Œ**DATAæ®µ**è¿™ä¸¤ä¸ªé™æ€å†…å­˜åŒºåŸŸï¼Œè¿™ä¸¤æ®µéƒ½æ˜¯ç”¨æ¥å­˜å‚¨é™æ€å±€éƒ¨æˆ–é™æ€å…¨å±€å˜é‡ï¼Œå…¶åœ¨ç¼–è¯‘æœŸé—´ä¾¿å†³å®šäº†è™šæ‹Ÿå†…å­˜çš„æ¶ˆè€—ã€‚\n\n**åŒºåˆ«æ˜¯DATAæ®µå­˜æ”¾çš„æ˜¯å·²ç»åˆå§‹åŒ–çš„å˜é‡ï¼Œå…¶æ˜ å°„è‡ªç¨‹åºé•œåƒä¸­åŒ…å«å¯¹åº”é™æ€å˜é‡çš„æ–‡ä»¶ï¼›è€ŒBSSæ®µåˆ™å­˜æ”¾çš„æ˜¯æœªåˆå§‹åŒ–çš„å˜é‡ï¼Œå®ƒä¸æ˜ å°„è‡ªä»»ä½•ä¸€ä¸ªæ‰§è¡Œæ–‡ä»¶**ã€‚\n\næ ¹æ®Cè¯­è¨€æ ‡å‡†è§„å®šï¼Œæœªåˆå§‹åŒ–çš„é™æ€æˆå‘˜å˜é‡çš„åˆå§‹å€¼å¿…é¡»ä¸º0ï¼Œæ‰€ä»¥å†…æ ¸åœ¨åŠ è½½äºŒè¿›åˆ¶æ–‡ä»¶åæ‰§è¡Œç¨‹åºå‰ä¼šå°†BSSæ®µæ¸…0ã€‚\n\n# ä»£ç æ®µ\n\nBSSå’ŒDATAæ®µä¸‹æ˜¯**ä»£ç æ®µ**(TEXT)ï¼Œæ­¤æ®µå­˜æœ‰ç¨‹åºçš„æŒ‡ä»¤ä»£ç ã€‚Textæ®µæ˜¯é€šè¿‡åªè¯»çš„æ–¹å¼åŠ è½½åˆ°å†…å­˜ä¸­çš„ï¼Œåœ¨å¤šä¸ªè¿›ç¨‹ä¸­å¯ä»¥è¢«å®‰å…¨å…±äº«ã€‚\n\n# æ•°æ®å­˜æ”¾äºå“ªä¸ªæ®µï¼Ÿ\n\n```cpp\nint gdata1 = 10;\nint gdata2 = 0;\nint gdata3;\n\nstatic int gdata4 = 11;\nstatic int gdata5 = 0;\nstatic int gdata6;\n\nint main()\n{\n    int a = 12;\n    int b = 0;\n    int c;\n    \n    static int d = 13;\n    static int e = 0;\n    static int f;\n    \n    return 0;\n}\n```\n\nå…¨éƒ¨çš„æŒ‡ä»¤éƒ½å­˜æ”¾åœ¨ä»£ç æ®µï¼Œè€Œä¸€ä¸ªç¨‹åºé™¤äº†æ•°æ®å°±æ˜¯æŒ‡ä»¤ï¼Œå› æ­¤ï¼Œå‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡`int a = 12; int b = 0; int c;`å‡ä¸ºæŒ‡ä»¤ã€‚å…¶ä½™çš„é™æ€å˜é‡ã€å…¨å±€å˜é‡éƒ½ä¸ºæ•°æ®ã€‚\n\n## å¯¹äºå…¨å±€å˜é‡\n\nå…¨å±€å˜é‡éƒ½æ˜¯æ•°æ®ã€‚åˆ™`gdata1~gdata6`éƒ½æ˜¯æ•°æ®ï¼Œéƒ½ä¼šç”Ÿæˆå¯¹åº”çš„ç¬¦å·ã€‚\n\nç„¶è€Œï¼Œå¦‚æœæœªåˆå§‹åŒ–æˆ–è€…åˆå§‹åŒ–ä¸º0ï¼Œå‡è§†ä¸ºæœªåˆå§‹åŒ–ï¼Œå¦‚`gdata2`ã€`gdata3`ã€`gdata5`ã€`gdata6`é¢„ç•™åœ¨`.bss`æ®µã€‚\n\n> æœªåˆå§‹åŒ–å’Œåˆå§‹åŒ–ä¸º0æ˜¯ä¸åŒçš„æ¦‚å¿µã€åŠ¨ä½œï¼å³ä½¿æœ€ç»ˆçš„ç»“æœéƒ½æ˜¯æŠŠintæ•°æ®ç½®0ä¸”å­˜åˆ°bssæ®µã€‚ä½†æ˜¯æ˜¾å¼åˆå§‹åŒ–åœ¨Cè¯­è¨€ä¸­ä¼šç”Ÿæˆå¼ºç¬¦å·ï¼Œæ²¡æœ‰è¿›è¡Œåˆå§‹åŒ–çš„ï¼ˆå³æ²¡æœ‰=0ï¼‰ä¼šç”Ÿæˆå¼±ç¬¦å·ï¼\n\n`gdata1`ã€`gdata4`åˆ†é…åˆ°`.data`æ®µã€‚\n\n## å¯¹äºå±€éƒ¨å˜é‡\n\nå¯¹äºéé™æ€é‡ï¼Œå³`a`ã€`b`ã€`c`æ¥è¯´ï¼Œå·²ç»ä¸å†å±äºæ•°æ®ï¼Œå› ä¸ºä¸ä¼šç”Ÿæˆç›¸åº”çš„ç¬¦å·ã€‚\n\nè€Œæ˜¯å±äºæŒ‡ä»¤çš„èŒƒç•´ã€‚å®é™…ç¿»è¯‘è¿‡æ¥çš„æŒ‡ä»¤å«ä¹‰å¦‚ä¸‹ã€‚\n\n```x86asm\nmov dword ptr[a], 0Ch\t# wordä¸º2å­—èŠ‚ï¼Œdwordè¡¨ç¤ºdouble wordï¼Œå³4å­—èŠ‚æ•°æ®\n```\n\nå³æŠŠ`0Ch`ç§»åˆ°açš„å†…å­˜ä¸­ã€‚\n\nè¿™äº›æŒ‡ä»¤äº§ç”Ÿåï¼Œåœ¨`.data`ä»£ç æ®µå­˜æ”¾ã€‚\n\nå¯¹äºé™æ€é‡ï¼Œå³`d`ã€`e`ã€`f`æ¥è¯´ï¼Œä¾æ—§å½“ä½œæ•°æ®å¤„ç†ï¼Œç”Ÿæˆç¬¦å·ï¼Œå¦‚æœæœªåˆå§‹åŒ–æˆ–è€…åˆå§‹åŒ–ä¸º0ï¼Œå‡è§†ä¸ºæœªåˆå§‹åŒ–ï¼Œå¦‚`e`ã€`f`é¢„ç•™åœ¨`.bss`æ®µã€‚\n\n`d`åˆ†é…åˆ°`.data`æ®µã€‚\n\n# è™šæ‹Ÿåœ°å€çš„å®ç°åŸç†\n\nå®ƒå­˜åœ¨ï¼Œä½ èƒ½çœ‹å¾—è§ï¼Œè¿™æ˜¯ç‰©ç†çš„ï¼›\nå®ƒå­˜åœ¨ï¼Œä½ çœ‹ä¸è§ï¼Œè¿™æ˜¯é€æ˜çš„ï¼›\nå®ƒä¸å­˜åœ¨ï¼Œä½ å´çœ‹å¾—è§ï¼Œè¿™æ˜¯è™šæ‹Ÿçš„ï¼›\nå®ƒä¸å­˜åœ¨ï¼Œä½ ä¹Ÿçœ‹ä¸è§ï¼Œè¿™æ˜¯åˆ é™¤çš„ã€‚\n\n---\n\næ¯ä¸ªè¿›ç¨‹éƒ½è¿è¡Œåœ¨ä¸€ä¸ªå±äºè‡ªå·±çš„å†…å­˜æ²™ç›’é‡Œï¼Œè¿™ä¸ªæ²™ç›’å³è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œè¿™äº›è™šæ‹Ÿåœ°å€å†é€šè¿‡é¡µè¡¨(page table)æ¥æ˜ å°„åˆ°ç‰©ç†å†…å­˜ä¸Šï¼Œé¡µè¡¨ç”±æ“ä½œç³»ç»Ÿç»´æŠ¤å¹¶è¢«CPUæ‰€å¼•ç”¨ã€‚æ‰€ä»¥ç”¨æˆ·ç©ºé—´åœ°å€çš„æ˜ å°„æ˜¯åŠ¨æ€å˜åŒ–çš„ï¼›è€Œå†…æ ¸ç©ºé—´åˆ™æ˜¯æŒç»­å­˜åœ¨çš„ï¼Œåœ¨æ¯ä¸ªè¿›ç¨‹ä¸­éƒ½æ˜ å°„åˆ°ç›¸åŒçš„ç‰©ç†å†…å­˜ä¸­ï¼Œè¿™æ ·ä¾¿äºå¯»å€ä»¥åº”å¯¹éšæ—¶å‡ºç°çš„ä¸­æ–­å’Œç³»ç»Ÿè°ƒç”¨ã€‚\n","categories":["è®¡ç®—æœºçŸ¥è¯†ä½“ç³»"]},{"title":"MySQL_å®Œæ•´æ€§çº¦æŸ","url":"/æ•°æ®åº“/MySQL_å®Œæ•´æ€§çº¦æŸ/","content":"\n# å†…å®¹\n\n1. ä¸»é”®çº¦æŸ\n1. è‡ªå¢é”®çº¦æŸ\n1. å”¯ä¸€é”®çº¦æŸ\n1. éç©ºçº¦æŸ\n1. é»˜è®¤å€¼çº¦æŸ\n1. å¤–é”®çº¦æŸ\n\n# ä¸»é”®çº¦æŸ\n\n`PRIMARY KEY`\n\nåªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ã€‚\n\n```mysql\ncreate table user(\n\tid INT UNSIGNED PRIMARY KEY AUTO_INCREMENT comment 'ç”¨æˆ·çš„ä¸»é”®id',\n\tusername VARCHAR(50) UNIQUE NOT NULL COMMENT 'ç”¨æˆ·å',\n\tage TINYINT UNSIGNED NOT NULL default 18,\n\tsex ENUM('male','demale')\n);\n# commit + â€™...â€˜ å¯ä»¥å¯¹æœ¬å±æ€§è¿›è¡Œå¤‡æ³¨æ³¨é‡Šè¯´æ˜\n```\n\nåˆ›å»ºè¡¨åï¼Œå¯ä»¥é€šè¿‡`desc user\\G`ï¼Œæˆ–è€…`desc user;`æ¥æŸ¥çœ‹å­—æ®µçš„è¯¦ç»†ä¿¡æ¯ã€‚å‰è€…æ˜¯å±•å¼€åˆ—è¡¨å½¢å¼ï¼Œåè€…æ˜¯äºŒç»´è¡¨æ ¼å½¢å¼ã€‚\n\n# è‡ªå¢é”®çº¦æŸ\n\n`AUTO_INCREMENT`\n\n# å”¯ä¸€é”®çº¦æŸ\n\n`UNIQUE`\n\nå¯ä»¥æœ‰å¤šä¸ªå”¯ä¸€é”®ï¼Œè€Œä¸”å¯ä»¥ä¸ºç©ºã€‚\n\n# éç©ºçº¦æŸ\n\n`NOT NULL`\n\n# é»˜è®¤å€¼çº¦æŸ\n\n`DEFAULT`\n\n# å¤–é”®çº¦æŸ\n\n`FOREIGN KEY`\n\næ‹¿å­¦ç”Ÿä¿¡æ¯è¡¨ã€è€ƒè¯•ä¿¡æ¯è¡¨æ¥ä¸¾ä¾‹å­ã€‚ä¸¤å¼ è¡¨ä¸­çš„ä¿¡æ¯æ˜¯æœ‰å…³è”çš„ï¼Œä¸æ˜¯ç‹¬ç«‹çš„ã€‚\n\nå­¦ç”Ÿä¿¡æ¯è¡¨ä¸­æœ‰å¼ ä¸‰ï¼Œé‚£ä¹ˆè€ƒè¯•ä¿¡æ¯è¡¨é‡Œå°±å¯èƒ½æœ‰ä¾èµ–å¼ ä¸‰çš„ä¿¡æ¯ã€‚\n\nå¦‚æœæˆ‘ä»¬è¦åˆ é™¤å¼ ä¸‰ï¼Œé‚£ä¹ˆéœ€è¦æŠŠå¦ä¸€ä¸ªè¡¨ä¸­ä¾èµ–å¼ ä¸‰çš„ä¿¡æ¯ä¹Ÿåˆ æ‰ã€‚å¦åˆ™å°±ä¼šå‡ºç°æ— æ•ˆå†—ä½™æ•°æ®ã€‚\n\nå¤–é”®ã€å­˜å‚¨å‡½æ•°ã€å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ï¼Œåœ¨ç°å¦‚ä»Šçš„åå°å¼€å‘ä¸­å‡ ä¹ä¸ç›´æ¥ç”¨åœ¨mysqlç«¯äº†ã€‚\n\nè€Œæ˜¯å°½é‡æŠŠè¿™ä¸ªè¿‡ç¨‹æ”¾åœ¨ä¸šåŠ¡é€»è¾‘ä¸Šæå‰å¤„ç†å¥½ï¼Œè®©æ•°æ®åº“æŒä¹…å±‚ä¸“äºåšå¢åˆ æ”¹æŸ¥ï¼Œæœ‰åˆ©äºæé«˜æ•ˆç‡ã€‚\n","categories":["æ•°æ®åº“","MySQL"]},{"title":"MySQL_æ•°æ®ç±»å‹","url":"/æ•°æ®åº“/MySQL_æ•°æ®ç±»å‹/","content":"# å†…å®¹\n\n1. æ•°å€¼ç±»å‹\n2. å­—ç¬¦ä¸²ç±»å‹\n3. æ—¥æœŸå’Œæ—¶é—´ç±»å‹\n4. enumå’Œset\n\n# è®¾è®¡æ•°æ®ç±»å‹çš„é‡è¦æ€§\n\nä¸šåŠ¡å±‚æ˜¯å·¥ä½œåœ¨å†…å­˜ä¸Šçš„ï¼Œé€Ÿåº¦å¾ˆå¿«ã€‚\n\nè€Œæœ€å…ˆè¾¾åˆ°æ€§èƒ½ç“¶é¢ˆçš„ä¸€èˆ¬éƒ½æ˜¯æ•°æ®åº“ï¼Œå› ä¸ºæ•°æ®åº“æ¶‰åŠåˆ°ç£ç›˜IOã€‚ç£ç›˜IOæ˜¯å¾ˆæ…¢çš„ã€‚\n\næ‰€ä»¥æˆ‘ä»¬å®šä¹‰æ•°æ®è¡¨æ—¶ï¼Œæ¯ä¸€ä¸ªå­—æ®µçš„æ•°æ®ç±»å‹éƒ½è¦å¥½å¥½å»æ–Ÿé…Œã€‚\n\nMySQL serverè™½ç„¶å·¥ä½œåœ¨å†…å­˜ä¸Šï¼Œä½†æ˜¯å®ƒè¦è¯»å–æ•°æ®ã€ç´¢å¼•æ—¶ï¼Œå°±è¦è¿›è¡Œç£ç›˜IOã€‚ç£ç›˜IOæ¬¡æ•°è¶Šå°‘ï¼Œåˆ™æ€§èƒ½è¶Šé«˜ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å°½åŠ›å‡å°‘ç£ç›˜IOæ¬¡æ•°ã€‚\n\nMySQLæ•°æ®ç±»å‹å®šä¹‰äº†æ•°æ®çš„å¤§å°èŒƒå›´ï¼Œå› æ­¤ä½¿ç”¨æ—¶é€‰æ‹©åˆé€‚çš„ç±»å‹ï¼Œä¸ä»…ä¼šé™ä½è¡¨å ç”¨çš„ç£ç›˜ç©ºé—´ï¼Œè¿˜èƒ½é—´æ¥å‡å°‘ç£ç›˜IOçš„æ¬¡æ•°ï¼Œæé«˜äº†è¡¨çš„è®¿é—®æ•ˆç‡ï¼›ä¸ä»…å¦‚æ­¤ï¼Œç´¢å¼•çš„æ•ˆç‡ä¹Ÿå’Œæ•°æ®ç±»å‹æ¯æ¯ç›¸å…³ã€‚\n\n# æ•°å€¼ç±»å‹\n\n| æ•´æ•°ç±»å‹            | å­—èŠ‚  | æœ€å°å€¼                            | æœ€å¤§å€¼                                            |\n| --------------- | --- | ------------------------------ | ---------------------------------------------- |\n| `TINYINT`       | 1   | æœ‰ç¬¦å·`-128`ï¼›æ— ç¬¦å·0                 | æœ‰ç¬¦å·127ï¼›æ— ç¬¦å·255                                  |\n| `SMALLINT`      | 2   | æœ‰ç¬¦å·`-32768`ï¼›æ— ç¬¦å·0               | æœ‰ç¬¦å·32767ï¼›æ— ç¬¦å·65535                              |\n| `MEDIUMINT`     | 3   | æœ‰ç¬¦å·`-8388608`ï¼›æ— ç¬¦å·0             | æœ‰ç¬¦å·8388607ï¼›æ— ç¬¦å·1677215                          |\n| `INT`ã€`INTEGER` | 4   | æœ‰ç¬¦å·`-2147483648`ï¼›æ— ç¬¦å·0          | æœ‰ç¬¦å·2147483647ï¼›æ— ç¬¦å·4294967295                    |\n| `BIGINT`        | 8   | æœ‰ç¬¦å·`-9223372036854775808`ï¼›æ— ç¬¦å·0 | æœ‰ç¬¦å·9223372036854775807ï¼›æ— ç¬¦å·18446744073709551615 |\n\n| æµ®ç‚¹æ•°ç±»å‹ | å­—èŠ‚ | æœ€å°å€¼                        | æœ€å¤§å€¼                        |\n| ---------- | ---- | ----------------------------- | ----------------------------- |\n| `FLOAT`    | 4    | $\\pm 1.175494351E-38$         | $\\pm 3.402823466E+38$         |\n| `DOUBLE`   | 8    | $\\pm 2.2250738585072014E-308$ | $\\pm 1.7976931348623517E+308$ |\n\nå…¶ä¸­æµ®ç‚¹ç±»å‹æ¨èä½¿ç”¨`decimal`ç±»å‹ï¼ˆä¿å­˜ä¸ºå­—ç¬¦ä¸²æ ¼å¼ï¼‰ã€‚æ•°æ®ç²¾åº¦èŒƒå›´å¾ˆå¤§ï¼Œçº¦28ä½ï¼Œè€Œä¸”è®¡ç®—æ—¶ï¼Œè¶Šç•Œã€æº¢å‡ºä¼šæŠ¥é”™ï¼Œè€Œæ™®é€šæ•´æ•°ã€æµ®ç‚¹åªæ˜¯æˆªæ–­ã€‚\n\n* æ³¨æ„\n    * `age INT(9)`è¿™ä¸æ˜¯æ„å‘³ç€å®šä¹‰äº†ä¸€ä¸ªé•¿åº¦ä¸º9å­—èŠ‚çš„æ•´å‹ã€‚æ•°å€¼ç±»å‹å ç”¨å†…å­˜çš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œå’Œå…·ä½“çš„ç±»å‹æ˜¯å¼ºç›¸å…³çš„ï¼Œæ‹¬å·å†…çš„æ•°ç›®åªæ˜¯ä»£è¡¨å®ƒæ˜¾ç¤ºçš„å®½åº¦ã€‚\n\n## ç¤ºä¾‹\n\n```mysql\ncreate table user(age TINYINT unsigned NOT NULL default 0)\n```\n\n# å­—ç¬¦ä¸²ç±»å‹\n\n| å­—ç¬¦ä¸²ç±»å‹          | å­—èŠ‚  | æè¿°åŠå­˜å‚¨éœ€æ±‚                       |\n| -------------- | --- | ----------------------------- |\n| `CHAR(M)`      | M   | Mä¸º`0~255`ä¹‹é—´çš„æ•´æ•°ã€‚å ç”¨ç©ºé—´Må­—èŠ‚ã€‚       |\n| `VARCHAR(M)`   |     | Mä¸º`0~65535`ä¹‹é—´çš„æ•´æ•°ï¼Œå€¼çš„é•¿åº¦+1ä¸ªå­—èŠ‚    |\n| `TINYBLOB`     |     | å…è®¸é•¿åº¦`0~255`å­—èŠ‚ï¼Œå€¼çš„é•¿åº¦+1å­—èŠ‚        |\n| `BLOB`         |     | å…è®¸é•¿åº¦`0~65535`å­—èŠ‚ï¼Œå€¼çš„é•¿åº¦+2å­—èŠ‚      |\n| `MEDIUMBLOB`   |     | å…è®¸é•¿åº¦`0~167772150`å­—èŠ‚ï¼Œå€¼çš„é•¿åº¦+3å­—èŠ‚  |\n| `LONGBLOB`     |     | å…è®¸é•¿åº¦`0~4294967295`å­—èŠ‚ï¼Œå€¼çš„é•¿åº¦+4å­—èŠ‚ |\n| `TINYTEXT`     |     | å…è®¸é•¿åº¦`0~255`å­—èŠ‚ï¼Œå€¼çš„é•¿åº¦+2å­—èŠ‚        |\n| `TEXT`         |     | å…è®¸é•¿åº¦`0~65535`å­—èŠ‚ï¼Œå€¼çš„é•¿åº¦+2å­—èŠ‚      |\n| `MEDIUMTEXT`   |     | å…è®¸é•¿åº¦`0~167772150`å­—èŠ‚ï¼Œå€¼çš„é•¿åº¦+3å­—èŠ‚  |\n| `LONGTEXT`     |     | å…è®¸é•¿åº¦`0~4294967295`å­—èŠ‚ï¼Œå€¼çš„é•¿åº¦+4å­—èŠ‚ |\n| `VARBINARY(M)` |     | å…è®¸é•¿åº¦`0~M`ä¸ªå­—èŠ‚çš„å˜é•¿å­—èŠ‚å­—ç¬¦ä¸²ï¼Œå€¼çš„é•¿åº¦+1å­—èŠ‚ |\n| `BINARY(M)`    | M   | å…è®¸é•¿åº¦`0~M`ä¸ªå­—èŠ‚çš„å®šé•¿å­—èŠ‚å­—ç¬¦ä¸²          |\n\n* `CHAR(12)`å’Œ`VARCHAR(12)`çš„åŒºåˆ«åœ¨äºï¼Œå¦‚æœå®é™…çš„å­—ç¬¦ä¸²é•¿åº¦ä¸å¤Ÿ12ï¼Œ`VARCHAR`å¤§å°åˆ™ä¸ºå®é™…çš„é•¿åº¦ï¼Œè€Œ`CHAR`çš„å¤§å°åˆ™ä¾æ—§æ˜¯12å­—èŠ‚ï¼›å…±åŒç‚¹ï¼šå¦‚æœæ•°æ®è¶…è¿‡12åˆ™éƒ½ä¼šäº§ç”Ÿæˆªæ–­ã€‚\n* BLOBä¸€èˆ¬ç”¨äºå­˜å‚¨äºŒè¿›åˆ¶æ ¼å¼çš„å›¾ç‰‡ã€éŸ³é¢‘ã€‚\n* TEXTçš„åº”ç”¨ï¼šç•™è¨€æ¿ï¼Œå•†å“çš„å¤‡æ³¨è¯´æ˜ï¼ŒèŠå¤©ä¿¡æ¯çš„å­˜å‚¨ã€‚ä¸€äº›å¤§æ–‡æœ¬ã€‚\n\nåˆæœŸè®¾è®¡æ—¶ï¼Œå¯èƒ½ä½ä¼°äº†å°†æ¥çš„æ•°æ®é‡ï¼Œå¯èƒ½ä¼šè¶…è¿‡è®¾è®¡çš„èŒƒå›´ã€‚\n\næ•°æ®åº“ä¸­å­—ç¬¦ä¸²ä»¥å•å¼•å·åŒ…è£¹ã€‚\n* SQLæ³¨å…¥å¼æ”»å‡»â€”â€”å­—ç¬¦ä¸²æ‹¼æ¥å¯¼è‡´çš„é—®é¢˜ã€‚\n\n# æ—¥æœŸå’Œæ—¶é—´ç±»å‹\n\n| æ—¥æœŸå’Œæ—¶é—´ç±»å‹ | å­—èŠ‚ | æœ€å°å€¼                | æœ€å¤§å€¼                |\n| -------------- | ---- | --------------------- | --------------------- |\n| `DATE`         | 4    | `1000-01-01`          | `9999-12-31`          |\n| `DATETIME`     | 8    | `1000-01-01 00:00:00` | `9999-12-31 23:59:59` |\n| `TIMESTAMP`    | 4    | `19700101080001`      | 2038å¹´çš„æŸä¸ªæ—¶åˆ»      |\n| `TIME`         | 3    | `-838:59:59`          | `838:59:59`           |\n| `YEAR`         | 1    | `1901`                | `2155`                |\n\n* æ—¥æœŸç±»å‹æ˜¯åšé¡¹ç›®è¿‡ç¨‹ä¸­ç»å¸¸ä½¿ç”¨çš„ç±»å‹ä¿¡æ¯ï¼Œå°¤å…¶æ˜¯`TIMESTAMP`å’Œ`DATETIME`ä¸¤ä¸ªç±»å‹ï¼›\n* æ³¨æ„`TIMESTAMP`ä¼šè‡ªåŠ¨æ›´æ–°æ—¶é—´ï¼Œéå¸¸é€‚åˆéœ€è¦è®°å½•æœ€æ–°æ›´æ–°æ—¶é—´çš„åœºæ™¯ï¼Œå¯¹åº”çš„å‡½æ•°æ˜¯`unix_timestamp(now())`ï¼›è€Œ`DATETIME`éœ€è¦æ‰‹åŠ¨æ›´æ–°ã€‚\n* è¿™é‡Œè™½ç„¶ä»‹ç»äº†MySQLçš„æ—¶é—´ç±»å‹ï¼Œä½†æ˜¯ç°ä»£çš„åç«¯å¼€å‘ï¼ŒMySQLåŸºæœ¬å·²ç»å¾ˆå°‘ä½¿ç”¨è‡ªèº«çš„å­˜å‚¨è¿‡ç¨‹ã€å­˜å‚¨å‡½æ•°ã€è§¦å‘å™¨ã€å¤–é”®è®¾ç½®äº†ï¼Œå°½é‡æŠŠå¤æ‚çš„ä¸šåŠ¡åœ¨ä¸šåŠ¡å±‚å¤„ç†ã€‚æ¶‰åŠçš„æ—¶é—´æ“ä½œä¹Ÿæ˜¯åŒç†ã€‚åº”è¯¥è®©MySQLèšç„¦åœ¨æ ¸å¿ƒçš„å¢åˆ æ”¹æŸ¥æ“ä½œä¸Šã€‚\n## æ—¶é—´æˆ³ç¤ºä¾‹\n\n```mysql\nselect now();\t\t\t\t\t# 2022-04-28 19:30:11\nselect unix_timestamp(now());\t# 1617683855\n```\n`unix_timestamp(now());`ç”¨äºç”ŸæˆUNIXçš„æ—¶é—´æˆ³ï¼Œæ•°å€¼å«ä¹‰æ˜¯è‡ª1970å¹´èµ·çš„ç§’æ•°ã€‚ç”¨æ•´å‹å­˜å‚¨ã€‚\n# æšä¸¾å’Œé›†åˆï¼ˆenumå’Œsetï¼‰\n\n* è¿™ä¸¤ç§ç±»å‹éƒ½æ˜¯é™åˆ¶è¯¥å­—æ®µåªèƒ½å–é¢„å®šä¹‰çš„å›ºå®šçš„æŸäº›å€¼ã€‚æ¯”å¦‚æ€§åˆ«â€”â€”åªèƒ½ç”·æˆ–å¥³ã€‚\n* æšä¸¾å­—æ®µåªèƒ½å–ä¸€ä¸ªå”¯ä¸€çš„å€¼ã€‚\n* é›†åˆå­—æ®µå¯ä»¥å–ä»»æ„ä¸ªå€¼ã€‚\n## ç¤ºä¾‹\n\n```mysql\nsex enum('M','W') default 'M'\n```\n\n","categories":["æ•°æ®åº“","MySQL"]},{"title":"MySQL_è¡¨è®¾è®¡åŸåˆ™","url":"/æ•°æ®åº“/MySQL_è¡¨è®¾è®¡åŸåˆ™/","content":"\n# å†…å®¹\n\n1. ç»™ä½ ä¸€ä¸ªåœºæ™¯ï¼Œè®©ä½ è®¾è®¡è¡¨ã€‚\n1. å…³ç³»å‹æ•°æ®åº“çš„èŒƒå¼è®¾è®¡ã€‚\n1. ä¸€å¯¹ä¸€/ä¸€å¯¹å¤šå®ä½“å…³ç³»çš„è¡¨è®¾è®¡åŸåˆ™\n1. å¤šå¯¹å¤šå®ä½“å…³ç³»çš„è¡¨è®¾è®¡åŸåˆ™\n1. æ€»ç»“ - è¡¨è®¾è®¡ä¸‰è¦ç´ \n\n# è¡¨é—´çš„å…³ç³»\n\nç°å®ä¸­ï¼Œè¡¨ä¸è¡¨ä¹‹é—´çš„å…³ç³»æ— éå°±ä¸‰ç§ï¼šä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹å¤šã€‚\n\nå¦‚ä½•è®¾è®¡è¡¨ä¹‹é—´çš„å…³è”å…³ç³»ï¼Ÿ\n\n# ä¸€å¯¹ä¸€\n\nä¸¾ä¸ªä¾‹å­ï¼šç”¨æˆ·Userå’Œèº«ä»½ä¿¡æ¯Infoçš„å…³ç³»ï¼Œä¸€ä¸ªç”¨æˆ·å¯¹åº”ä¸€ä¸ªèº«ä»½ä¿¡æ¯ã€‚ä¸¤å¼ è¡¨æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ã€‚\n\n* ç”¨æˆ·User\n\n| uid(ä¸»é”®ã€è‡ªå¢) | name  | age  | sex  |\n| --------------- | ----- | ---- | ---- |\n| 1000            | zhang | 20   | M    |\n| 1020            | liu   | 21   | W    |\n| 2010            | wang  | 22   | M    |\n\n* èº«ä»½ä¿¡æ¯Info\n\n| cardid | addrinfo |\n| ------ | -------- |\n| 112233 | china    |\n| 334455 | japan    |\n| 556677 | canada   |\n\nç›®å‰æ¥çœ‹ï¼Œèº«ä»½ä¿¡æ¯è¡¨å’Œç”¨æˆ·è¡¨å®Œå…¨å¯¹åº”ä¸ä¸Šã€‚\n\n**éœ€è¦åœ¨èº«ä»½ä¿¡æ¯è¡¨åŠ ä¸€ä¸ªå…³è”çˆ¶è¡¨ä¸»é”®çš„å­—æ®µuidï¼Œæ‰èƒ½å’Œç”¨æˆ·è¡¨å¯¹åº”ä¸Š**ã€‚\n\n| uid  | cardid | addrinfo |\n| ---- | ------ | -------- |\n| 1000 | 112233 | china    |\n| 1020 | 334455 | japan    |\n| 2010 | 556677 | canada   |\n\nç°åœ¨ï¼Œä¸¤ä¸ªè¡¨ä¹‹é—´çš„å…³è”å°±æ˜¯é Infoè¡¨çš„uidå»ºç«‹èµ·æ¥çš„ï¼Œå³**Infoè¡¨çš„uidå­—æ®µå…³è”äº†çˆ¶è¡¨çš„ä¸»é”®**ï¼ŒInfoè¡¨çš„uidåœ¨é€»è¾‘ä¸Šå®é™…ä¸Šå°±æ˜¯**å¤–é”®**ï¼ŒInfoå«åš**å­è¡¨**ï¼ŒUserå«åš**çˆ¶è¡¨**ã€‚å­è¡¨çš„å¤–é”®å’Œçˆ¶è¡¨çš„ä¸»é”®çš„æ•°æ®ç±»å‹å¿…é¡»ä¸€è‡´ï¼Œå­—æ®µåæ— æ‰€è°“ã€‚\n\n> mysqlçš„æ€§èƒ½ç“¶é¢ˆä¸»è¦é›†ä¸­åœ¨ç£ç›˜IOï¼Œå‡ºäºå¯¹æ€§èƒ½çš„ä¼˜åŒ–è€ƒè™‘ï¼Œæˆ‘ä»¬ç°åœ¨ä¸ä¼šåœ¨sqlå±‚æ˜ç¡®æŒ‡å‡ºè¿™æ˜¯ä¸€ä¸ªå¤–é”®ï¼Œä¸ä¼šæŠŠå¤–é”®çš„çº¦æŸå·¥ä½œåˆ†é…ç»™mysqlã€‚è€Œæ˜¯æŠŠå¤–é”®çš„å¤„ç†æˆ‘ä»¬æ”¾åˆ°åº”ç”¨å±‚ä»£ç ã€‚ä»¥è®©sqlå¤„ç†æ›´æ ¸å¿ƒçš„ä¸šåŠ¡ã€‚\n\nä½¿è¡¨ä¹‹é—´èƒ½å¤Ÿä¸€å¯¹ä¸€å…³è”èµ·æ¥çš„åšæ³•ï¼šåœ¨å­è¡¨ä¸­**å¢åŠ ä¸€åˆ—**ï¼Œä¸çˆ¶è¡¨çš„ä¸»é”®å…³è”ã€‚\n\n```mysql\nselect * from info where uid=2010;\t#å¦‚æ­¤å°±ç›¸å½“äºé—´æ¥æŸ¥åˆ°â€œç‹â€çš„èº«ä»½ä¿¡æ¯\n```\n\n# ä¸€å¯¹å¤š/å¤šå¯¹å¤š\n\nä¸¾ä¸ªä¾‹å­ï¼šç”µå•†å¹³å°ã€‚æœ‰ä¸‰ä¸ªå®ä½“ï¼šç”¨æˆ·Userã€å•†å“Productã€è®¢å•Orderã€‚\n\n## åˆ†æ\n\n* ç”¨æˆ· - å•†å“ï¼šåœ¨ç”¨æˆ·è´­ä¹°å•†å“ä¹‹å‰ï¼Œå®ƒä»¬ä¹‹é—´æ²¡æœ‰ç›´æ¥çš„å…³è”å…³ç³»\n* ç”¨æˆ· - è®¢å•ï¼šä¸€å¯¹å¤šçš„å…³ç³»\n* å•†å“ - è®¢å•ï¼šå¤šå¯¹å¤šçš„å…³ç³»\n\n## è¡¨è®¾è®¡\n\n* ç”¨æˆ·Userè¡¨\n\n| uid  | name  | age  | sex  |\n| ---- | ----- | ---- | ---- |\n| 1000 | zhang | 20   | M    |\n| 1020 | liu   | 21   | W    |\n| 2010 | wang  | 22   | M    |\n\n* å•†å“Productè¡¨\n\n| pid  | pname   | price  | amount |\n| ---- | ------- | ------ | ------ |\n| 1    | phone   | 600.0  | 100    |\n| 2    | laptop  | 2000.0 | 50     |\n| 3    | battery | 10.0   | 200    |\n\n* è®¢å•Orderè¡¨\n\n| orderid | pid  | number | money  | totalprice | addrinfo     |\n| ------- | ---- | ------ | ------ | ---------- | ------------ |\n| O1000   | 1    | 1      | 600.0  | 4640.0     | è¥¿å®‰å·¥ä¸šå¤§å­¦ |\n| O1000   | 2    | 2      | 4000.0 | 4640.0     | è¥¿å®‰å·¥ä¸šå¤§å­¦ |\n| O1000   | 3    | 4      | 40.0   | 4640.0     | è¥¿å®‰å·¥ä¸šå¤§å­¦ |\n| O2000   | 2    | 1      | 2000.0 | 2000.0     | é™•è¥¿ç§‘æŠ€å¤§å­¦ |\n\n## ç”¨æˆ·å’Œè®¢å• - ä¸€å¯¹å¤š\n\nè®¢å•ä¸­æ²¡æœ‰ç”¨æˆ·çš„ä¿¡æ¯ï¼Œå¯¹åº”ä¸ä¸Šæ˜¯å“ªä¸ªç”¨æˆ·çš„è®¢å•ã€‚\n\nåˆ™éœ€è¦ç»™è®¢å•åŠ ä¸€ä¸ªç”¨æˆ·idå­—æ®µï¼Œéœ€ä¸ä¸»è¡¨çš„ä¸»é”®å…³è”ï¼Œç±»å‹å¿…é¡»ä¸€è‡´ã€‚å³å¯ä¸ç”¨æˆ·å¯¹åº”ã€‚\n\n| orderid | uid  | pid  | number | money  | totalprice | addrinfo     |\n| ------- | ---- | ---- | ------ | ------ | ---------- | ------------ |\n| O1000   | 1000 | 1    | 1      | 600.0  | 4640.0     | è¥¿å®‰å·¥ä¸šå¤§å­¦ |\n| O1000   | 1000 | 2    | 2      | 4000.0 | 4640.0     | è¥¿å®‰å·¥ä¸šå¤§å­¦ |\n| O1000   | 1000 | 3    | 4      | 40.0   | 4640.0     | è¥¿å®‰å·¥ä¸šå¤§å­¦ |\n| O2000   | 2010 | 2    | 1      | 2000.0 | 2000.0     | é™•è¥¿ç§‘æŠ€å¤§å­¦ |\n\n## å•†å“å’Œè®¢å• - å¤šå¯¹å¤š\n\nç›®å‰çš„è®¢å•è¡¨çš„è®¾è®¡æ˜¯æœ‰å¾ˆå¤šé—®é¢˜çš„ï¼Œä¿¡æ¯å†—ä½™è¿‡å¤šã€‚å¦‚æœæŸç”¨æˆ·åœ¨åŒä¸€è®¢å•ä¸­è´­ä¹°äº†å¤šç§å•†å“ï¼Œåˆ™orderidã€uidã€totalpriceå’Œaddrinfoéƒ½æ˜¯ä¸€è‡´çš„ï¼Œä¸ºæ¯ä¸€ç§å•†å“éƒ½å•åˆ—ä¸€æ¡è®°å½•ï¼Œå†—ä½™è¿‡å¤šã€‚\n\nå†—ä½™å¸¦æ¥çš„é—®é¢˜æœ‰å¾ˆå¤šï¼Œå…¶ä¸­æœ€å¤§çš„é—®é¢˜æ˜¯ï¼Œå¦‚æœç”¨æˆ·å¯¹è®¢å•è¿›è¡Œå¢åˆ æ”¹æŸ¥ï¼Œåˆ™æœ‰å¯èƒ½å½±å“æ•´ä¸ªæœ‰å…³æ­¤è®¢å•çš„æ‰€æœ‰è®°å½•ï¼Œä¿®æ”¹ä»£ä»·é«˜ã€‚\n\nå¦‚æœè®¢å•(Order)è¡¨åƒä¸‹é¢è¿™æ ·ï¼Œå°±å¾ˆç®€æ´äº†ã€‚è¿™å°±ä¸å­˜åœ¨å†—ä½™äº†ã€‚å¦‚æœéœ€è¦æ›´æ”¹è®¢å•ï¼Œä¸ç”¨åˆ é™¤å¤šè¡Œè®°å½•ï¼Œåªéœ€ä¿®æ”¹ä¸€æ¬¡ã€‚\n\n| orderid | uid  | totalprice | addrinfo     |\n| ------- | ---- | ---------- | ------------ |\n| O1000   | 1000 | 4640.0     | è¥¿å®‰å·¥ä¸šå¤§å­¦ |\n| O2000   | 2010 | 2000.0     | é™•è¥¿ç§‘æŠ€å¤§å­¦ |\n\nä½†æ˜¯è¿˜è¦çŸ¥é“è®¢å•çš„å†…å®¹ï¼Œéœ€è¦ä¸€ä¸ªä¸­é—´è¡¨ - è®¢å•å†…å®¹OrderListã€‚\n\n| orderid | pid  | number | money  |\n| ------- | ---- | ------ | ------ |\n| O1000   | 1    | 1      | 600.0  |\n| O1000   | 2    | 2      | 4000.0 |\n| O1000   | 3    | 4      | 40.0   |\n| O2000   | 2    | 1      | 2000.0 |\n\nç”±æ­¤è®¾è®¡ï¼Œå•†å“è¡¨å’Œè®¢å•è¡¨åˆ™ä¸ä¼šå‡ºç°æ•°æ®å†—ä½™ã€‚\n\n# æ€»ç»“\n\nåœ¨è¿›è¡Œè¡¨çš„è®¾è®¡æ—¶ï¼Œè€ƒè™‘ä¸‰ä¸ªé—®é¢˜\n\n1. è¡¨å­—æ®µæ•°æ®ç±»å‹çš„æ–Ÿé…Œ\n2. å®Œæ•´æ€§çº¦æŸæ¡ä»¶çš„è§„èŒƒ\n3. å®ä½“å…³ç³»å¯¹åº”çš„è¡¨è®¾è®¡åŸåˆ™\n\nå®ä½“ä¹‹é—´çš„å…³ç³»ï¼Œæ— éæ˜¯ä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹å¤šã€‚\n\nä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šä¸­ï¼Œå­è¡¨å’Œçˆ¶è¡¨çš„å…³è”å¯ç”±å­è¡¨å¢åŠ ä¸€åˆ—å­—æ®µæ¥å…³è”çˆ¶è¡¨çš„ä¸»é”®ã€‚\n\nè€Œå¤šå¯¹å¤šå…³ç³»ä¸­ï¼Œé™¤äº†å¢åŠ ä¸€åˆ—å­—æ®µæ¥å…³è”çˆ¶è¡¨ï¼Œè¿˜éœ€è¦å¢åŠ ä¸€ä¸ªä¸­é—´è¡¨æ¥æ¶ˆé™¤å†—ä½™ã€‚\n\n","categories":["æ•°æ®åº“","MySQL"]},{"title":"MySQL_è¿ç®—ç¬¦","url":"/æ•°æ®åº“/MySQL_è¿ç®—ç¬¦/","content":"\n# å†…å®¹\n\n1. ç®—æ•°è¿ç®—ç¬¦\n1. é€»è¾‘è¿ç®—ç¬¦\n1. æ¯”è¾ƒè¿ç®—ç¬¦\n\n# ç®—æœ¯è¿ç®—ç¬¦\n\n| è¿ç®—ç¬¦     | ä½œç”¨           |\n| ---------- | -------------- |\n| `+`        | åŠ æ³•           |\n| `-`        | å‡æ³•           |\n| `*`        | ä¹˜æ³•           |\n| `/`ã€`DIV` | é™¤æ³•ï¼Œè¿”å›å•†   |\n| `%`ã€`MOD` | é™¤æ³•ï¼Œè¿”å›ä½™æ•° |\n\n* æ³¨æ„\n  * è®¡ç®—æ—¶ï¼Œéœ€è¦æ³¨æ„å½“æ—¶çš„æ•°æ®ç±»å‹å–å€¼èŒƒå›´æ˜¯å¦åˆé€‚ï¼Œä»¥å…è¶Šç•Œå¯¼è‡´ä¸šåŠ¡å‡ºé”™\n\n## ç¤ºä¾‹\n\n```mysql\nupdate user set age=age+1;\n```\n\n# é€»è¾‘è¿ç®—ç¬¦\n\n| è¿ç®—ç¬¦      | ä½œç”¨   |\n| ----------- | ------ |\n| `NOT`æˆ–`!`  | é€»è¾‘é |\n| `AND`æˆ–`&&` | é€»è¾‘ä¸ |\n| `OR`æˆ–`||`  | é€»è¾‘æˆ– |\n\n# æ¯”è¾ƒè¿ç®—ç¬¦\n\n| è¿ç®—ç¬¦     | ä½œç”¨                             |\n| ---------- | -------------------------------- |\n| `=`        | ç­‰äº                             |\n| `<>`æˆ–`!=` | ä¸ç­‰äºï¼ˆ`<>`åœ¨æœªæ¥å¯èƒ½ä¼šè¢«æ·˜æ±°ï¼‰ |\n| `<=>`      | NULLå®‰å…¨çš„ç­‰äº(NULL-safe)        |\n| <          | å°äº                             |\n| <=         | å°äºç­‰äº                         |\n| >          | å¤§äº                             |\n| >=         | å¤§äºç­‰äº                         |\n\n| è¿ç®—ç¬¦            | ä½œç”¨           |\n| ----------------- | -------------- |\n| `BETWEEN`         | å­˜åœ¨äºæŒ‡å®šèŒƒå›´ |\n| `IN`              | å­˜åœ¨äºæŒ‡å®šé›†åˆ |\n| `IS NULL`         | ä¸ºNULL         |\n| `IS NOT NULL`     | ä¸ä¸ºNULL       |\n| `LIKE`            | é€šé…ç¬¦åŒ¹é…     |\n| `REGEXP`æˆ–`RLIKE` | æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… |\n\n* æ³¨æ„\n  * åˆ¤ç©ºä¸è¦å†™`=NULL`ï¼Œè€Œæ˜¯è¦å†™`IS NOT NULL`æˆ–`IS NULL`ï¼›åˆ¤ç©ºç»å¸¸å‡ºç°åœ¨å·¦è¿æ¥ã€å³è¿æ¥ä¸­çš„å¤–é”®æŸ¥è¯¢ã€‚\n  * é€šé…ç¬¦ä¸ç´¢å¼•çš„å…³ç³»ï¼Ÿ\n    * `LIKE`é€šé…ç¬¦ä¸ä¸€å®šä¼šç”¨åˆ°ç´¢å¼•ï¼Œéœ€è¦çœ‹é€šé…ç¬¦åŠ çš„åœ°æ–¹ï¼Œå¦‚æœé€šé…ç¬¦åœ¨ä¸­é—´ã€æœ«å°¾åˆ™èƒ½ç”¨åˆ°ï¼›ä½†æ˜¯å¦‚æœåŠ åˆ°æœ€å¼€å§‹åˆ™ä¸ä¼šç”¨åˆ°ã€‚\n\n## ç¤ºä¾‹\n\n```mysql\nselect * from user where age between 20 and 22;\nselect * from user where score in (99.0, 100.0);\n```\n\n```mysql\nselect * from user where score IS NOT NULL;\n```\n\n```mysql\nselect * from user where name like 'zhang%';\t#zhangå¼€å¤´çš„ä»»ä½•å­—ç¬¦ä¸²\nselect * from user where name like 'zhang_';\t#ä¸‹åˆ’çº¿æ˜¯å ä½é€šé…ç¬¦ï¼Œåªèƒ½åŒ¹é…åé¢åªæœ‰ä¸€ä¸ªå­—ç¬¦çš„\n```\n\n\n\n\n\n# ç»¼åˆç¤ºä¾‹\n\nä¸‹é¢è¿™ä¸ªæŸ¥è¯¢è¯­å¥ç”¨åˆ°äº†å¤šä¸ªè¿ç®—ç¬¦ï¼š`sex='M'`ã€`and`ã€`score>=90.0`\n\n```mysql\nselect * from where sex='M' and score>=90.0;\n```\n\n","categories":["æ•°æ®åº“","MySQL"]},{"title":"ç±»ä¹‹é—´çš„å…³ç³»","url":"/è®¾è®¡æ¨¡å¼/ç±»ä¹‹é—´çš„å…³ç³»/","content":"# å†…å®¹\n\nåœ¨è½¯ä»¶ç³»ç»Ÿä¸­ï¼Œç±»ä¸æ˜¯å­¤ç«‹å­˜åœ¨çš„ï¼Œç±»ä¸ç±»ä¹‹é—´å­˜åœ¨ç›¸äº’å…³ç³»ï¼Œå› æ­¤éœ€è¦é€šè¿‡UMLæ¥æè¿°è¿™äº›ç±»ä¹‹é—´çš„å…³ç³»ã€‚ç±»ä¹‹é—´å…·æœ‰å¦‚ä¸‹å‡ ç§å…³ç³»ã€‚\n\n1. å…³è”å…³ç³»\n    1. åŒå‘å…³è”\n    2. å•å‘å…³è”\n    3. è‡ªå…³è”\n    4. å¤šé‡æ€§å…³è”\n    5. èšåˆå…³ç³»\n    6. ç»„åˆå…³ç³»\n2. ä¾èµ–å…³ç³»\n3. æ³›åŒ–å…³ç³»ï¼ˆç»§æ‰¿å…³ç³»ï¼‰\n4. æ¥å£ä¸å®ç°å…³ç³»\nä»¥ä¸Šæ˜¯æŒ‰ç…§åˆ˜ä¼Ÿçš„åˆ†ç±»æ–¹å¼æ¥è¯´çš„ã€‚\n\næ›´æ˜“ç†è§£ã€ç¬¦åˆåå­—å®šä¹‰çš„åˆ†ç±»æ–¹å¼å¦‚ä¸‹ï¼š\n\n1. ç»§æ‰¿å…³ç³»ï¼ˆå³æ³›åŒ–å…³ç³»ï¼Œå°†æ¥å£ä¸å®ç°å…³ç³»ä¹ŸåŒ…å«åœ¨å†…ï¼‰\n2. ç»„åˆå…³ç³»\n3. èšåˆå…³ç³»\n4. ä¾èµ–å…³ç³»\n5. å…³è”å…³ç³»\n# å…³è”å…³ç³»\n\nå…³è”å…³ç³»ï¼ˆAssociationï¼‰æ˜¯ç±»ä¸ç±»ä¹‹é—´æœ€å¸¸ç”¨çš„ä¸€ç§å…³ç³»ï¼Œå®ƒæ˜¯ä¸€ç§**ç»“æ„åŒ–å…³ç³»**ï¼Œç”¨äºè¡¨ç¤ºä¸€ç±»å¯¹è±¡ä¸å¦ä¸€ç±»å¯¹è±¡ä¹‹é—´æœ‰è”ç³»ï¼Œå¦‚æ±½è½¦å’Œè½®èƒã€å¸ˆå‚…å’Œå¾’å¼Ÿã€ç­çº§å’Œå­¦ç”Ÿç­‰ã€‚\n\n**åœ¨UMLç±»å›¾ä¸­ï¼Œç”¨å®çº¿è¿æ¥æœ‰å…³è”çš„å¯¹è±¡æ‰€å¯¹åº”çš„ç±»**ï¼Œåœ¨ä½¿ç”¨Javaã€`C#`å’Œ`C++`ç­‰ç¼–ç¨‹è¯­è¨€**å®ç°å…³è”å…³ç³»æ—¶ï¼Œé€šå¸¸å°†ä¸€ä¸ªç±»çš„å¯¹è±¡ä½œä¸ºå¦ä¸€ä¸ªç±»çš„å±æ€§**ã€‚\n\n* è¦ç‚¹\n    * åœ¨ä½¿ç”¨ç±»å›¾è¡¨ç¤ºå…³è”å…³ç³»æ—¶å¯ä»¥åœ¨å…³è”çº¿ä¸Šæ ‡æ³¨è§’è‰²åï¼Œ**ä¸€èˆ¬ä½¿ç”¨ä¸€ä¸ªè¡¨ç¤ºä¸¤è€…ä¹‹é—´å…³ç³»çš„åŠ¨è¯æˆ–è€…åè¯è¡¨ç¤ºè§’è‰²å(æœ‰æ—¶è¯¥åè¯ä¸ºå®ä¾‹å¯¹è±¡å)**\n    * å…³ç³»çš„ä¸¤ç«¯ä»£è¡¨ä¸åŒçš„ä¸¤ç§è§’è‰²ï¼Œå› æ­¤åœ¨ä¸€ä¸ªå…³è”å…³ç³»ä¸­å¯ä»¥åŒ…å«ä¸¤ä¸ªè§’è‰²åã€‚\n    * è§’è‰²åä¸æ˜¯å¿…éœ€çš„ï¼Œå¯ä»¥æ ¹æ®éœ€è¦å¢åŠ ï¼Œå…¶ç›®çš„æ˜¯ä½¿ç±»ä¹‹é—´çš„å…³ç³»æ›´åŠ æ˜ç¡®ã€‚\n\nä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªç™»å½•ç•Œé¢ç±»Login Formä¸­åŒ…å«ä¸€ä¸ªJButtonç±»å‹çš„æ³¨å†ŒæŒ‰é’®login Buttonï¼Œå®ƒä»¬ä¹‹é—´å¯ä»¥è¡¨ç¤ºä¸ºå…³è”å…³ç³»ï¼Œä»£ç å®ç°æ—¶å¯ä»¥åœ¨Login Formä¸­å®šä¹‰ä¸€ä¸ªåä¸ºlogin Buttonçš„å±æ€§å¯¹è±¡ï¼Œå…¶ç±»å‹ä¸ºJButtonï¼Œå¦‚å›¾æ‰€ç¤ºã€‚\n\n![image-20220427152626763](../../images/ç±»ä¹‹é—´çš„å…³ç³»/image-20220427152626763.png)\n\nå…³è”å…³ç³»å¯ä»¥ç»†åˆ†ä¸º6ç§ã€‚\n\n## åŒå‘å…³è”\n\né»˜è®¤æƒ…å†µä¸‹ï¼Œå…³è”æ˜¯åŒå‘çš„ã€‚ä¾‹å¦‚ï¼Œé¡¾å®¢(Customer)è´­ä¹°å•†å“(Product)å¹¶æ‹¥æœ‰å•†å“ï¼›åä¹‹ï¼Œå–å‡ºçš„å•†å“æ€»æœ‰æŸä¸ªé¡¾å®¢ä¸ä¹‹ç›¸å…³è”ã€‚å› æ­¤ï¼Œ`Customer`ç±»å’Œ`Product`ç±»ä¹‹é—´å…·æœ‰åŒå‘å…³è”å…³ç³»ï¼Œ**ç”¨ç›´çº¿è¡¨ç¤º**ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚\n\n![ç±»ä¹‹é—´å…³ç³»2](../../images/ç±»ä¹‹é—´çš„å…³ç³»/ç±»ä¹‹é—´å…³ç³»2.png)\n\n## å•å‘å…³è”\n\nç±»çš„å…³è”å…³ç³»ä¹Ÿå¯ä»¥æ˜¯å•å‘çš„ï¼Œå•å‘å…³è”ç”¨å¸¦ç®­å¤´çš„å®çº¿è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼Œé¡¾å®¢(Customer)æ‹¥æœ‰åœ°å€(Address),åˆ™Customerç±»ä¸Addressç±»å…·æœ‰å•å‘å…³è”å…³ç³»ã€‚ä¸ç¬¬ä¸€ä¸ªå›¾`LoginForm - JButton`çš„å…³ç³»ä¸€æ ·ã€‚**ç”¨ç›´çº¿åŠ ç®­å¤´è¡¨ç¤º**ã€‚\n\n## è‡ªå…³è”\n\nåœ¨ç³»ç»Ÿä¸­å¯èƒ½å­˜åœ¨ä¸€äº›ç±»çš„å±æ€§å¯¹è±¡ç±»å‹ä¸ºè¯¥ç±»æœ¬èº«ï¼Œè¿™ç§ç‰¹æ®Šçš„å…³è”å…³ç³»ç§°ä¸ºè‡ªå…³è”ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªèŠ‚ç‚¹ç±»(Node)çš„æˆå‘˜åˆæ˜¯èŠ‚ç‚¹å¯¹è±¡ï¼Œå¦‚å›¾ã€‚\n\n![image-20220427154807115](../../images/ç±»ä¹‹é—´çš„å…³ç³»/image-20220427154807115.png)\n\n## å¤šé‡æ€§å…³è”\n\nåˆç§°ä¸ºé‡æ•°æ€§å…³è”å…³ç³»ï¼ˆMultiplicityï¼‰ï¼Œè¡¨ç¤ºä¸€ä¸ªç±»çš„å¯¹è±¡ä¸å¦ä¸€ä¸ªç±»çš„å¯¹è±¡è¿æ¥çš„ä¸ªæ•°ã€‚\n\nåœ¨UMLä¸­å¤šé‡æ€§å…³è”å…³ç³»å¯ä»¥ç›´æ¥**åœ¨å…³è”ç›´çº¿ä¸Šå¢åŠ ä¸€ä¸ªæ•°å­—è¡¨ç¤ºä¸ä¹‹å¯¹åº”çš„å¦ä¸€ä¸ªç±»çš„å¯¹è±¡çš„ä¸ªæ•°**ã€‚\n\n* ä¸‹è¡¨ï¼šå¤šé‡æ€§è¡¨ç¤ºæ–¹å¼åˆ—è¡¨\n\n| è¡¨ç¤ºæ–¹å¼ | å¤šé‡æ€§è¯´æ˜                                                   |\n| -------- | ------------------------------------------------------------ |\n| `1..1`   | è¡¨ç¤ºå¦ä¸€ä¸ªç±»çš„1ä¸ªå¯¹è±¡**åªä¸1ä¸ª**è¯¥ç±»å¯¹è±¡æœ‰å…³ç³»               |\n| `0..*`   | è¡¨ç¤ºå¦ä¸€ä¸ªç±»çš„1ä¸ªå¯¹è±¡ä¸**0ä¸ªæˆ–å¤šä¸ª**è¯¥ç±»å¯¹è±¡æœ‰å…³ç³»           |\n| `1..*`   | è¡¨ç¤ºå¦ä¸€ä¸ªç±»çš„1ä¸ªå¯¹è±¡ä¸**1ä¸ªæˆ–å¤šä¸ª**è¯¥ç±»å¯¹è±¡æœ‰å…³ç³»           |\n| `0..1`   | è¡¨ç¤ºå¦ä¸€ä¸ªç±»çš„1ä¸ªå¯¹è±¡**æ²¡æœ‰æˆ–åªä¸1ä¸ª**è¯¥ç±»å¯¹è±¡æœ‰å…³ç³»         |\n| `m..n`   | è¡¨ç¤ºå¦ä¸€ä¸ªç±»çš„1ä¸ªå¯¹è±¡ä¸æœ€å°‘mã€æœ€å¤šnä¸ªè¯¥ç±»å¯¹è±¡æœ‰å…³ç³»$(m\\le n)$ |\n\nä¾‹å¦‚ï¼Œä¸€ä¸ªç•Œé¢(Form)å¯ä»¥æ‹¥æœ‰0ä¸ªæˆ–å¤šä¸ªæŒ‰é’®(Button)ï¼Œä½†æ˜¯ä¸€ä¸ªæŒ‰é’®åªèƒ½å±äºä¸€ä¸ªç•Œé¢ã€‚å› æ­¤ï¼Œä¸€ä¸ªFormç±»çš„å¯¹è±¡å¯ä»¥ä¸0ä¸ªæˆ–å¤šä¸ªButtonç±»çš„å¯¹è±¡ç›¸å…³è”ï¼Œä½†ä¸€ä¸ªButtonç±»çš„å¯¹è±¡åªèƒ½ä¸ä¸€ä¸ªFormç±»çš„å¯¹è±¡å…³è”ï¼Œå¦‚å›¾ã€‚\n\n![image-20220427160905246](../../images/ç±»ä¹‹é—´çš„å…³ç³»/image-20220427160905246.png)\n\n## èšåˆå…³ç³»\n\nèšåˆå…³ç³»ï¼ˆAggregationï¼‰**è¡¨ç¤ºä¸€ä¸ªæ•´ä½“ä¸éƒ¨åˆ†**çš„å…³ç³»ã€‚é€šå¸¸åœ¨å®šä¹‰ä¸€ä¸ªæ•´ä½“ç±»åï¼Œå†å»åˆ†æè¿™ä¸ªæ•´ä½“ç±»çš„ç»„æˆç»“æ„ï¼Œä»è€Œæ‰¾å‡ºä¸€äº›æˆå‘˜ç±»ï¼Œè¯¥æ•´ä½“ç±»å’Œæˆå‘˜ç±»ä¹‹é—´å°±å½¢æˆäº†èšåˆå…³ç³»ã€‚å¦‚ä¸€å°è®¡ç®—æœºåŒ…å«æ˜¾ç¤ºå™¨ã€ä¸»æœºã€é”®ç›˜ã€é¼ æ ‡ç­‰éƒ¨åˆ†ï¼Œå°±å¯ä»¥ä½¿ç”¨èšåˆå…³ç³»æ¥æè¿°æ•´ä½“ä¸éƒ¨åˆ†ä¹‹é—´çš„å…³ç³»ã€‚\n\nåœ¨èšåˆå…³ç³»ä¸­ï¼Œæˆå‘˜ç±»æ˜¯æ•´ä½“ç±»çš„ä¸€éƒ¨åˆ†ï¼Œå³æˆå‘˜å¯¹è±¡æ˜¯æ•´ä½“å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯æˆå‘˜å¯¹è±¡å¯ä»¥è„±ç¦»æ•´ä½“å¯¹è±¡ç‹¬ç«‹å­˜åœ¨ã€‚åœ¨UMLä¸­ï¼Œèšåˆå…³ç³»ç”¨å¸¦ç©ºå¿ƒè±å½¢çš„ç›´çº¿è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼Œæ±½è½¦å‘åŠ¨æœº(Engine)æ˜¯æ±½è½¦(Car)çš„ç»„æˆéƒ¨åˆ†ï¼Œä½†æ˜¯æ±½è½¦å‘åŠ¨æœºå¯ä»¥ç‹¬ç«‹å­˜åœ¨ï¼Œå› æ­¤æ±½è½¦å’Œå‘åŠ¨æœºæ˜¯èšåˆå…³ç³»ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚\n\n![image-20220427162037062](../../images/ç±»ä¹‹é—´çš„å…³ç³»/image-20220427162037062.png)\n\nCarä¸­å®šä¹‰äº†ä¸€ä¸ªEngineç±»å‹çš„æˆå‘˜å˜é‡ï¼Œä»è¯­ä¹‰ä¸Šæ¥è¯´ï¼ŒEngineæ˜¯Carçš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯Engineå¯¹è±¡å¯ä»¥è„±ç¦»Carå•ç‹¬å­˜åœ¨ã€‚å› æ­¤ï¼Œ**åœ¨ç±»Carä¸­å¹¶ä¸ç›´æ¥å®ä¾‹åŒ–Engineï¼Œè€Œæ˜¯é€šè¿‡æ„é€ å‡½æ•°æˆ–è€…setterè®¾å€¼å°†åœ¨ç±»å¤–éƒ¨å®ä¾‹åŒ–å¥½çš„Engineå¯¹è±¡ä»¥å‚æ•°å½¢å¼ä¼ å…¥Carä¸­**ï¼Œè¿™ç§ä¼ å…¥æ–¹å¼ç§°ä¸º**æ³¨å…¥ï¼ˆInjectionï¼‰**ã€‚æ­£å› ä¸ºCarå’ŒEngineçš„å®ä¾‹åŒ–æ—¶åˆ»ä¸ç›¸åŒï¼Œå› æ­¤**å®ƒä»¬ä¹‹é—´ä¸å­˜åœ¨ç”Ÿå‘½å‘¨æœŸçš„åˆ¶çº¦å…³ç³»**ï¼Œè€Œ**ä»…ä»…åªæ˜¯æ•´ä½“ä¸éƒ¨åˆ†ä¹‹é—´çš„å…³ç³»**è€Œå·²ã€‚\n\n## ç»„åˆå…³ç³»\n\nç»„åˆå…³ç³»ï¼ˆCompositionï¼‰ä¹Ÿè¡¨ç¤ºç±»ä¹‹é—´æ•´ä½“å’Œéƒ¨åˆ†çš„å…³ç³»ï¼Œä½†æ˜¯ç»„åˆå…³ç³»ä¸­**éƒ¨åˆ†å’Œæ•´ä½“å…·æœ‰ç»Ÿä¸€çš„ç”Ÿå­˜æœŸ**ã€‚**ä¸€æ—¦æ•´ä½“å¯¹è±¡ä¸å­˜åœ¨ï¼Œéƒ¨åˆ†å¯¹è±¡ä¹Ÿå°†ä¸å­˜åœ¨**ï¼Œéƒ¨åˆ†å¯¹è±¡ä¸æ•´ä½“å¯¹è±¡ä¹‹é—´å…·æœ‰**åŒç”Ÿå…±æ­»**çš„å…³ç³»ã€‚ä¾‹å¦‚ä¸€ä¸ªç•Œé¢å¯¹è±¡ä¸å…¶åŒ…å«çš„æŒ‰é’®ã€æ–‡æœ¬æ¡†ã€é™æ€æ–‡æœ¬ç­‰æˆå‘˜å¯¹è±¡ï¼Œå¦‚æœç•Œé¢å¯¹è±¡åœ¨å†…å­˜ä¸­è¢«é”€æ¯ï¼Œåˆ™æ‰€æœ‰æˆå‘˜å‡è¢«é”€æ¯ã€‚\n\nåœ¨ç»„åˆå…³ç³»ä¸­ï¼Œæˆå‘˜ç±»æ˜¯æ•´ä½“ç±»çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸”æ•´ä½“ç±»å¯ä»¥æ§åˆ¶æˆå‘˜ç±»çš„ç”Ÿå‘½å‘¨æœŸï¼Œå³æˆå‘˜ç±»çš„å­˜åœ¨ä¾èµ–äºæ•´ä½“ç±»ã€‚\n\nåœ¨UMLä¸­ï¼Œç»„åˆå…³ç³»ç”¨å¸¦**å®å¿ƒè±å½¢**çš„ç›´çº¿è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼Œäººçš„å¤´(Head)ä¸å˜´å·´(Mouth)ï¼Œå˜´å·´æ˜¯å¤´çš„ç»„æˆéƒ¨åˆ†ä¹‹ä¸€ï¼Œè€Œä¸”å¦‚æœå¤´æ²¡äº†ï¼Œåˆ™å˜´å·´ä¹Ÿå°±æ²¡äº†ï¼Œå› æ­¤å¤´å’Œå˜´å·´æ˜¯ç»„åˆå…³ç³»ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚\n\n![image-20220427162715751](../../images/ç±»ä¹‹é—´çš„å…³ç³»/image-20220427162715751.png)\n\nHeadä¸­å®šä¹‰äº†ä¸€ä¸ªMouthç±»å‹çš„æˆå‘˜ï¼Œè€Œä¸”åœ¨Headçš„æ„é€ å‡½æ•°ä¸­å®ä¾‹åŒ–Mouthå¯¹è±¡ï¼Œå› æ­¤åœ¨åˆ›å»ºHeadå¯¹è±¡çš„åŒæ—¶å°†åˆ›å»ºMouthå¯¹è±¡ï¼Œåœ¨é”€æ¯Headå¯¹è±¡çš„åŒæ—¶é”€æ¯Mouthå¯¹è±¡ã€‚**å®ƒä»¬ä¹‹é—´ä¸ä»…ä»…åªæ˜¯æ•´ä½“ä¸éƒ¨åˆ†ä¹‹é—´çš„å…³ç³»ï¼Œè€Œä¸”æ•´ä½“è¿˜å¯ä»¥æ§åˆ¶éƒ¨åˆ†çš„ç”Ÿå‘½å‘¨æœŸ**ã€‚\n\n* èšåˆå’Œç»„åˆçš„å¯¹æ¯”\n    * èšåˆå…³ç³»è¡¨ç¤ºæ•´ä½“ä¸éƒ¨åˆ†çš„å…³ç³»æ¯”è¾ƒå¼±ï¼Œè€Œç»„åˆå…³ç³»æ¯”è¾ƒå¼ºï¼›\n    * èšåˆå…³ç³»ä¸­ä»£è¡¨éƒ¨åˆ†äº‹ç‰©çš„å¯¹è±¡ä¸ä»£è¡¨æ•´ä½“äº‹ç‰©çš„å¯¹è±¡çš„ç”Ÿå­˜æœŸæ— å…³ï¼Œåˆ é™¤æ•´ä½“å¯¹è±¡å¹¶ä¸è¡¨ç¤ºéƒ¨åˆ†å¯¹è±¡è¢«åˆ é™¤ã€‚\n    * ä»ä»£ç å®ç°çš„è§’åº¦æ¥çœ‹ä¹Ÿç•¥æœ‰åŒºåˆ«ï¼Œèšåˆå…³ç³»é€šè¿‡å¯¹è±¡æ³¨å…¥çš„æ–¹å¼æ¥å®ç°ï¼Œè€Œç»„åˆå…³ç³»é€šè¿‡åœ¨æ•´ä½“ç±»çš„æ„é€ å‡½æ•°ä¸­å®ä¾‹åŒ–æˆå‘˜ç±»æ¥å®ç°ã€‚\n    * ä½†æ˜¯å®ƒä»¬çš„**å…±åŒç‚¹æ˜¯ä¸€ä¸ªç±»çš„å®ä¾‹ä¸ºå¦ä¸€ä¸ªç±»çš„æˆå‘˜å¯¹è±¡**ã€‚\n\nèšåˆå…³ç³»å’Œç»„åˆå…³ç³»ä¸æ™®é€šçš„å…³è”å…³ç³»ä¸»è¦æ˜¯è¯­ä¹‰ä¸Šçš„åŒºåˆ«ï¼Œå¦‚è¡¨ç¤ºå®¢æˆ·ç±»ä¸äº§å“ç±»çš„å…³ç³»å°±ä¸èƒ½ç”¨èšåˆå’Œç»„åˆï¼Œå› ä¸ºäº§å“å¹¶ä¸æ˜¯å®¢æˆ·çš„ä¸€éƒ¨åˆ†ï¼Œä¸å­˜åœ¨æ•´ä½“ä¸éƒ¨åˆ†å…³ç³»ï¼Œåªèƒ½ç”¨æ™®é€šçš„å…³è”å…³ç³»ã€‚\n# ä¾èµ–å…³ç³»\n\nä¾èµ–å…³ç³»ï¼ˆDependencyï¼‰**æ˜¯ä¸€ç§ä½¿ç”¨å…³ç³»**ï¼Œè¢«ä½¿ç”¨è€…çš„æ”¹å˜æœ‰å¯èƒ½ä¼šå½±å“åˆ°ä½¿ç”¨è€…ï¼Œåœ¨éœ€è¦**è¡¨ç¤ºä¸€ä¸ªäº‹ç‰©ä½¿ç”¨å¦ä¸€ä¸ªäº‹ç‰©**æ—¶ä½¿ç”¨ä¾èµ–å…³ç³»ã€‚\n\nå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¾èµ–å…³ç³»**ä½“ç°åœ¨æŸä¸ªç±»çš„æ–¹æ³•ä½¿ç”¨å¦ä¸€ä¸ªç±»çš„å¯¹è±¡ä½œä¸ºå‚æ•°**ã€‚\n\nåœ¨UMLä¸­ï¼Œä¾èµ–å…³ç³»**ç”¨å¸¦ç®­å¤´çš„è™šçº¿**è¡¨ç¤ºï¼Œç”±ä¾èµ–çš„ä¸€æ–¹æŒ‡å‘è¢«ä¾èµ–çš„ä¸€æ–¹ã€‚ä¾‹å¦‚ï¼Œé©¾é©¶å‘˜å¼€è½¦ï¼Œåœ¨`Driver`ç±»çš„`drive()`æ–¹æ³•ä¸­å°†`Car`ç±»å‹çš„å¯¹è±¡`car`ä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ é€’ï¼Œä»¥ä¾¿åœ¨`drive()`æ–¹æ³•ä¸­èƒ½å¤Ÿè°ƒç”¨`car`çš„`move()`æ–¹æ³•ï¼Œä¸”é©¾é©¶å‘˜çš„`drive()`æ–¹æ³•ä¾èµ–è½¦çš„`move()`æ–¹æ³•ï¼Œå› æ­¤ç±»`Driver`ä¾èµ–ç±»`Car`ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚\n\n![image-20220427164758961](../../images/ç±»ä¹‹é—´çš„å…³ç³»/image-20220427164758961.png)\n\nåœ¨å…·ä½“å®ç°æ—¶ï¼š\n\n1. å¦‚æœåœ¨ä¸€ä¸ªç±»çš„æ–¹æ³•ä¸­è°ƒç”¨äº†å¦ä¸€ä¸ªç±»çš„é™æ€æ–¹æ³•ï¼›æˆ–ï¼š\n2. åœ¨ä¸€ä¸ªç±»çš„å‡½æ•°ä¸­å®šä¹‰äº†å¦ä¸€ä¸ªç±»çš„å¯¹è±¡ä½œä¸ºå…¶å±€éƒ¨å˜é‡\n\nä¹Ÿæ˜¯ä¾èµ–å…³ç³»çš„è¡¨ç°å½¢å¼ï¼Œä½†æ˜¯è¿™ä¸ªå…³ç³»éœ€è¦åœ¨å®ç°é˜¶æ®µæ…¢æ…¢æµ®ç°å‡ºæ¥ï¼Œåœ¨åˆ†æè®¾è®¡é˜¶æ®µå¯ä»¥æš‚æ—¶ä¸äºˆè€ƒè™‘ã€‚\n\n# æ³›åŒ–å…³ç³»\n\næ³›åŒ–å…³ç³»ï¼ˆGeneralizationï¼‰ä¹Ÿå°±æ˜¯ç»§æ‰¿å…³ç³»ï¼Œ**ä¹Ÿç§°ä¸ºâ€œis-a-kind-ofâ€å…³ç³»**ã€‚\n\næ³›åŒ–å…³ç³»ç”¨äº**æè¿°çˆ¶ç±»ä¸å­ç±»**ä¹‹é—´çš„å…³ç³»ï¼Œçˆ¶ç±»åˆç§°ä½œåŸºç±»æˆ–è¶…ç±»ï¼Œå­ç±»åˆç§°ä½œæ´¾ç”Ÿç±»ã€‚\n\nåœ¨UMLä¸­ï¼Œ**æ³›åŒ–å…³ç³»ç”¨å¸¦ç©ºå¿ƒä¸‰è§’å½¢çš„ç›´çº¿**æ¥è¡¨ç¤ºã€‚\n\nåœ¨ä»£ç å®ç°æ—¶ï¼Œ**ä½¿ç”¨é¢å‘å¯¹è±¡çš„ç»§æ‰¿æœºåˆ¶æ¥å®ç°æ³›åŒ–å…³ç³»**ï¼Œå¦‚åœ¨Javaè¯­è¨€ä¸­ä½¿ç”¨extendså…³é”®å­—ï¼Œåœ¨`C++/C#`ä¸­ä½¿ç”¨å†’å·`:`æ¥å®ç°ã€‚ä¾‹å¦‚ï¼ŒStudentç±»å’ŒTeacherç±»éƒ½æ˜¯Personç±»çš„å­ç±»ï¼ŒStudentç±»å’ŒTeacherç±»ç»§æ‰¿äº†Personç±»çš„å±æ€§å’Œæ–¹æ³•ï¼ŒPersonç±»çš„å±æ€§åŒ…å«å§“å(name)å’Œå¹´é¾„(age)ï¼Œæ¯ä¸€ä¸ªStudentå’ŒTeacherä¹Ÿéƒ½å…·æœ‰è¿™ä¸¤ä¸ªå±æ€§ï¼Œå¦å¤–Studentç±»å¢åŠ äº†å±æ€§å­¦å·`(studentNo)`ï¼ŒTeacherç±»å¢åŠ äº†å±æ€§æ•™å¸ˆç¼–å·`(teacherNo)`ï¼ŒPersonç±»çš„æ–¹æ³•åŒ…æ‹¬è¡Œèµ°`move()`å’Œè¯´è¯`say()`ï¼ŒStudentç±»å’ŒTeacherç±»ç»§æ‰¿äº†è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œè€Œä¸”Studentç±»è¿˜æ–°å¢æ–¹æ³•`study()`ï¼ŒTeacherç±»è¿˜æ–°å¢æ–¹æ³•`teach()`ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚\n\n![image-20220427171305290](../../images/ç±»ä¹‹é—´çš„å…³ç³»/image-20220427171305290.png)\n\n# æ¥å£ä¸å®ç°å…³ç³»\n\nåœ¨å¾ˆå¤šé¢å‘å¯¹è±¡è¯­è¨€ä¸­éƒ½å¼•å…¥äº†æ¥å£çš„æ¦‚å¿µï¼Œå¦‚Javaã€`C#`ç­‰ã€‚åœ¨æ¥å£ä¸­ï¼Œä¸€èˆ¬æ²¡æœ‰å±æ€§ï¼Œè€Œä¸”æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯æŠ½è±¡çš„ï¼Œåªæœ‰æ“ä½œçš„å£°æ˜ï¼Œæ²¡æœ‰æ“ä½œçš„å®ç°ã€‚\n\nUMLä¸­ç”¨ä¸ç±»çš„è¡¨ç¤ºæ³•ç±»ä¼¼çš„æ–¹å¼è¡¨ç¤ºæ¥å£ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚\n\n![image-20220427173357890](../../images/ç±»ä¹‹é—´çš„å…³ç³»/image-20220427173357890.png)\n\næ¥å£ä¹‹é—´ä¹Ÿå¯ä»¥æœ‰ä¸ç±»ä¹‹é—´å…³ç³»ç±»ä¼¼çš„ç»§æ‰¿å…³ç³»å’Œä¾èµ–å…³ç³»ï¼Œä½†æ˜¯æ¥å£å’Œç±»ä¹‹é—´è¿˜å­˜åœ¨ä¸€ç§**å®ç°å…³ç³»ï¼ˆRealizationï¼‰**ã€‚åœ¨è¿™ç§å…³ç³»ä¸­ï¼Œç±»å®ç°äº†æ¥å£ï¼Œç±»ä¸­çš„æ“ä½œå®ç°äº†æ¥å£ä¸­æ‰€å£°æ˜çš„æ“ä½œã€‚\n\nåœ¨UMLä¸­ï¼Œ**ç±»ä¸æ¥å£ä¹‹é—´çš„å®ç°å…³ç³»ç”¨å¸¦ç©ºå¿ƒä¸‰è§’å½¢çš„è™šçº¿æ¥è¡¨ç¤º**ã€‚ä¾‹å¦‚ï¼Œå®šä¹‰äº†ä¸€ä¸ªäº¤é€šå·¥å…·æ¥å£`Vehicle`ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæŠ½è±¡æ“ä½œ`move()`ï¼Œåœ¨ç±»`Ship`å’Œç±»`Car`ä¸­éƒ½å®ç°äº†è¯¥`move()`æ“ä½œï¼Œä¸è¿‡å…·ä½“çš„å®ç°ç»†èŠ‚å°†ä¼šä¸ä¸€æ ·ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚\n\n![image-20220427173447055](../../images/ç±»ä¹‹é—´çš„å…³ç³»/image-20220427173447055.png)\n\nå®ç°å…³ç³»åœ¨ç”¨ä»£ç å®ç°æ—¶ï¼Œä¸åŒçš„é¢å‘å¯¹è±¡è¯­è¨€ä¹Ÿæä¾›äº†ä¸åŒçš„è¯­æ³•ï¼Œå¦‚åœ¨Javaè¯­è¨€ä¸­ä½¿ç”¨`implements`å…³é”®å­—ï¼Œåœ¨`C++/C#`ä¸­ä½¿ç”¨å†’å·`:`æ¥å®ç°ã€‚\n\n# å‚è€ƒæ–‡çŒ®\n\n```\n[1] åˆ˜ä¼Ÿ. è®¾è®¡æ¨¡å¼.\n```\n","categories":["è®¾è®¡æ¨¡å¼"]},{"title":"å»ºé€ è€…æ¨¡å¼","url":"/è®¾è®¡æ¨¡å¼/å»ºé€ è€…æ¨¡å¼/","content":"\n# å†…å®¹\n\n1. å¼•è¿°\n1. å»ºé€ è€…æ¨¡å¼æ¦‚è¿°\n2. å¼•å…¥æŠ½è±¡å·¥å‚\n2. æŠ½è±¡å·¥å‚æ¨¡å¼æ¦‚è¿°\n2. è§£å†³æ–¹æ¡ˆ\n\n# å¼•è¿°\n\næ²¡æœ‰äººä¹°è½¦ä¼šåªä¹°ä¸€ä¸ªè½®èƒæˆ–è€…æ–¹å‘ç›˜ï¼Œå¤§å®¶ä¹°çš„éƒ½æ˜¯ä¸€è¾†åŒ…å«è½®èƒã€æ–¹å‘ç›˜å’Œå‘åŠ¨æœºç­‰å¤šä¸ªéƒ¨ä»¶çš„å®Œæ•´æ±½è½¦ã€‚**å¦‚ä½•å°†è¿™äº›éƒ¨ä»¶ç»„è£…æˆä¸€è¾†å®Œæ•´çš„æ±½è½¦å¹¶è¿”å›ç»™ç”¨æˆ·ï¼Œè¿™æ˜¯å»ºé€ è€…æ¨¡å¼éœ€è¦è§£å†³çš„é—®é¢˜**ã€‚å»ºé€ è€…æ¨¡å¼**åˆç§°ä¸ºç”Ÿæˆå™¨æ¨¡å¼**ï¼Œå®ƒæ˜¯ä¸€ç§è¾ƒä¸ºå¤æ‚ã€ä½¿ç”¨é¢‘ç‡ä¹Ÿç›¸å¯¹è¾ƒä½çš„åˆ›å»ºå‹æ¨¡å¼ã€‚å»ºé€ è€…æ¨¡å¼ä¸ºå®¢æˆ·ç«¯è¿”å›çš„ä¸æ˜¯ä¸€ä¸ªç®€å•çš„äº§å“ï¼Œè€Œæ˜¯ä¸€ä¸ªç”±å¤šä¸ªéƒ¨ä»¶ç»„æˆçš„å¤æ‚äº§å“ã€‚\n\n## æ¡ˆä¾‹-æ¸¸æˆè§’è‰²è®¾è®¡\n\nè¯¥è½¯ä»¶å…¬å¸æ¸¸æˆå¼€å‘å°ç»„å†³å®šå¼€å‘ä¸€æ¬¾åä¸ºã€Šä»™é­”ç¾¤ä¾ ä¼ ã€‹çš„ç½‘ç»œæ¸¸æˆï¼Œè¯¥æ¸¸æˆé‡‡ç”¨ä¸»æµçš„RPG(Role Playing Game,è§’è‰²æ‰®æ¼”æ¸¸æˆ)æ¨¡å¼ï¼Œç©å®¶å¯ä»¥åœ¨æ¸¸æˆä¸­æ‰®æ¼”è™šæ‹Ÿä¸–ç•Œä¸­çš„ä¸€ä¸ªç‰¹å®šè§’è‰²ï¼Œè§’è‰²æ ¹æ®ä¸åŒçš„æ¸¸æˆæƒ…èŠ‚å’Œç»Ÿè®¡æ•°æ®ï¼ˆå¦‚åŠ›é‡ã€é­”æ³•ã€æŠ€èƒ½ç­‰ï¼‰å…·æœ‰ä¸åŒçš„èƒ½åŠ›ï¼Œè§’è‰²ä¹Ÿä¼šéšç€ä¸æ–­å‡çº§è€Œæ‹¥æœ‰æ›´åŠ å¼ºå¤§çš„èƒ½åŠ›ã€‚\n\nä½œä¸ºRPGæ¸¸æˆçš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ï¼Œ**éœ€è¦å¯¹æ¸¸æˆè§’è‰²è¿›è¡Œè®¾è®¡ï¼Œè€Œä¸”éšç€è¯¥æ¸¸æˆçš„å‡çº§å°†ä¸æ–­å¢åŠ æ–°çš„è§’è‰²ã€‚ä¸åŒç±»å‹çš„æ¸¸æˆè§’è‰²ï¼Œå…¶æ€§åˆ«ã€è„¸å‹ã€æœè£…ã€å‘å‹ç­‰å¤–éƒ¨ç‰¹æ€§éƒ½æœ‰æ‰€å·®å¼‚**ï¼Œä¾‹å¦‚â€œå¤©ä½¿â€æ‹¥æœ‰ç¾ä¸½çš„é¢å®¹å’ŒæŠ«è‚©çš„é•¿å‘ï¼Œå¹¶èº«ç©¿ä¸€è¢­ç™½è£™ï¼›è€Œâ€œæ¶é­”â€æå…¶ä¸‘é™‹ï¼Œç•™ç€å…‰å¤´å¹¶ç©¿ä¸€ä»¶åˆºçœ¼çš„é»‘è¡£ã€‚\n\nè¯¥å…¬å¸å†³å®š**å¼€å‘ä¸€ä¸ªå°å·¥å…·æ¥åˆ›å»ºæ¸¸æˆè§’è‰²ï¼Œå¯ä»¥åˆ›å»ºä¸åŒç±»å‹çš„è§’è‰²å¹¶å¯ä»¥çµæ´»å¢åŠ æ–°çš„è§’è‰²**ã€‚\n\nè¯¥å¸çš„å¼€å‘äººå‘˜é€šè¿‡åˆ†æå‘ç°ï¼Œæ¸¸æˆè§’è‰²æ˜¯ä¸€ä¸ªå¤æ‚å¯¹è±¡ï¼Œå®ƒåŒ…å«æ€§åˆ«ã€è„¸å‹ç­‰å¤šä¸ªç»„æˆéƒ¨åˆ†ï¼Œä¸åŒçš„æ¸¸æˆè§’è‰²å…¶ç»„æˆéƒ¨åˆ†æœ‰æ‰€å·®å¼‚ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š\n\n![image-20220426115229892](../../images/å»ºé€ è€…æ¨¡å¼/image-20220426115229892.png)\n\næ— è®ºæ˜¯ä½•ç§é€ å‹çš„æ¸¸æˆè§’è‰²ï¼Œå®ƒçš„åˆ›å»ºæ­¥éª¤éƒ½å¤§åŒå°å¼‚ï¼Œéƒ½éœ€è¦é€æ­¥åˆ›å»ºå…¶ç»„æˆéƒ¨åˆ†ï¼Œå†å°†å„ç»„æˆéƒ¨åˆ†è£…é…æˆä¸€ä¸ªå®Œæ•´çš„æ¸¸æˆè§’è‰²ã€‚**å¦‚ä½•ä¸€æ­¥æ­¥åˆ›å»ºä¸€ä¸ªåŒ…å«å¤šä¸ªç»„æˆéƒ¨åˆ†çš„å¤æ‚å¯¹è±¡**ï¼Œå»ºé€ è€…æ¨¡å¼ä¸ºè§£å†³æ­¤ç±»é—®é¢˜è€Œè¯ç”Ÿã€‚\n\n# å»ºé€ è€…æ¨¡å¼æ¦‚è¿°\n\nå»ºé€ è€…æ¨¡å¼æ˜¯è¾ƒä¸ºå¤æ‚çš„åˆ›å»ºå‹æ¨¡å¼ï¼Œå®ƒå°†å®¢æˆ·ç«¯ä¸åŒ…å«å¤šä¸ªç»„æˆéƒ¨åˆ†ï¼ˆæˆ–éƒ¨ä»¶ï¼‰çš„å¤æ‚å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹åˆ†ç¦»ï¼Œ**å®¢æˆ·ç«¯æ— é¡»çŸ¥é“å¤æ‚å¯¹è±¡çš„å†…éƒ¨ç»„æˆéƒ¨åˆ†ä¸è£…é…æ–¹å¼ï¼Œåªéœ€è¦çŸ¥é“æ‰€éœ€å»ºé€ è€…çš„ç±»å‹å³å¯**ã€‚å®ƒå…³æ³¨å¦‚ä½•ä¸€æ­¥ä¸€æ­¥åˆ›å»ºä¸€ä¸ªçš„å¤æ‚å¯¹è±¡ï¼Œä¸åŒçš„å…·ä½“å»ºé€ è€…å®šä¹‰äº†ä¸åŒçš„åˆ›å»ºè¿‡ç¨‹ï¼Œä¸”å…·ä½“å»ºé€ è€…ç›¸äº’ç‹¬ç«‹ï¼Œå¢åŠ æ–°çš„å»ºé€ è€…éå¸¸æ–¹ä¾¿ï¼Œæ— é¡»ä¿®æ”¹å·²æœ‰ä»£ç ï¼Œç³»ç»Ÿå…·æœ‰è¾ƒå¥½çš„æ‰©å±•æ€§ã€‚\n\n## å®šä¹‰\n\nå»ºé€ è€…æ¨¡å¼(Builder Pattern)ï¼šå°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºä¸å®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚å»ºé€ è€…æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡åˆ›å»ºå‹æ¨¡å¼ã€‚\n\n## ç»“æ„\n\nå»ºé€ è€…æ¨¡å¼ä¸€æ­¥ä¸€æ­¥åˆ›å»ºä¸€ä¸ªå¤æ‚çš„å¯¹è±¡ï¼Œå®ƒå…è®¸ç”¨æˆ·åªé€šè¿‡æŒ‡å®šå¤æ‚å¯¹è±¡çš„ç±»å‹å’Œå†…å®¹å°±å¯ä»¥æ„å»ºå®ƒä»¬ï¼Œç”¨æˆ·ä¸éœ€è¦çŸ¥é“å†…éƒ¨çš„å…·ä½“æ„å»ºç»†èŠ‚ã€‚å»ºé€ è€…æ¨¡å¼ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼š\n\n![image-20220426115426800](../../images/å»ºé€ è€…æ¨¡å¼/image-20220426115426800.png)\n\n## è§’è‰²\n\nåœ¨å»ºé€ è€…æ¨¡å¼ç»“æ„å›¾ä¸­åŒ…å«å¦‚ä¸‹å‡ ä¸ªè§’è‰²ï¼š\n\n* Builderï¼ˆæŠ½è±¡å»ºé€ è€…ï¼‰ï¼šBuilderæ—¢å¯ä»¥æ˜¯æŠ½è±¡ç±»ï¼Œä¹Ÿå¯ä»¥æ˜¯æ¥å£ã€‚å®ƒä¸ºåˆ›å»ºä¸€ä¸ªäº§å“Productå¯¹è±¡çš„å„ä¸ªéƒ¨ä»¶æŒ‡å®šæŠ½è±¡æ¥å£ã€‚åœ¨è¯¥æ¥å£ä¸­ä¸€èˆ¬å£°æ˜ä¸¤ç±»æ–¹æ³•ã€‚\n  * ä¸€ç±»æ–¹æ³•æ˜¯buildPartX()ï¼Œå®ƒä»¬ç”¨äºåˆ›å»ºå¤æ‚å¯¹è±¡çš„å„ä¸ªéƒ¨ä»¶\n  * å¦ä¸€ç±»æ–¹æ³•æ˜¯getResult()ï¼Œå®ƒä»¬ç”¨äºè¿”å›å¤æ‚å¯¹è±¡ã€‚\n* ConcreteBuilderï¼ˆå…·ä½“å»ºé€ è€…ï¼‰\n  * å®ƒå®ç°äº†Builderæ¥å£ï¼Œå®ç°å„ä¸ªéƒ¨ä»¶çš„å…·ä½“æ„é€ å’Œè£…é…æ–¹æ³•ï¼Œå®šä¹‰å¹¶æ˜ç¡®å®ƒæ‰€åˆ›å»ºçš„å¤æ‚å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æä¾›ä¸€ä¸ªæ–¹æ³•è¿”å›åˆ›å»ºå¥½çš„å¤æ‚äº§å“å¯¹è±¡ã€‚\n* Productï¼ˆäº§å“è§’è‰²ï¼‰\n  * å®ƒæ˜¯è¢«æ„å»ºçš„å¤æ‚å¯¹è±¡ï¼ŒåŒ…å«å¤šä¸ªç»„æˆéƒ¨ä»¶ï¼Œå…·ä½“å»ºé€ è€…åˆ›å»ºè¯¥äº§å“çš„å†…éƒ¨è¡¨ç¤ºå¹¶å®šä¹‰å®ƒçš„è£…é…è¿‡ç¨‹ã€‚\n* Directorï¼ˆæŒ‡æŒ¥è€…ï¼‰ï¼šæŒ‡æŒ¥è€…åˆç§°ä¸ºå¯¼æ¼”ç±»ï¼Œå®ƒè´Ÿè´£å®‰æ’å¤æ‚å¯¹è±¡çš„å»ºé€ æ¬¡åºã€‚\n  * æŒ‡æŒ¥è€…ä¸æŠ½è±¡å»ºé€ è€…ä¹‹é—´å­˜åœ¨å…³è”å…³ç³»ï¼Œå¯ä»¥åœ¨å…¶construct()å»ºé€ æ–¹æ³•ä¸­è°ƒç”¨å»ºé€ è€…å¯¹è±¡çš„éƒ¨ä»¶æ„é€ ä¸è£…é…æ–¹æ³•ï¼Œå®Œæˆå¤æ‚å¯¹è±¡çš„å»ºé€ ã€‚\n  * å®¢æˆ·ç«¯ä¸€èˆ¬åªéœ€è¦ä¸æŒ‡æŒ¥è€…è¿›è¡Œäº¤äº’ï¼Œåœ¨å®¢æˆ·ç«¯ç¡®å®šå…·ä½“å»ºé€ è€…çš„ç±»å‹ï¼Œå¹¶å®ä¾‹åŒ–å…·ä½“å»ºé€ è€…å¯¹è±¡ï¼ˆä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶å’Œåå°„æœºåˆ¶ï¼‰ï¼Œç„¶åé€šè¿‡æŒ‡æŒ¥è€…ç±»çš„æ„é€ å‡½æ•°æˆ–è€…Setteræ–¹æ³•å°†è¯¥å¯¹è±¡ä¼ å…¥æŒ‡æŒ¥è€…ç±»ä¸­ã€‚\n\n## ä»£ç \n\n* äº§å“ç±»\n\nåœ¨å»ºé€ è€…æ¨¡å¼çš„å®šä¹‰ä¸­æåˆ°äº†**å¤æ‚å¯¹è±¡**ï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯å¤æ‚å¯¹è±¡ï¼Ÿç®€å•æ¥è¯´ï¼Œå¤æ‚å¯¹è±¡æ˜¯æŒ‡é‚£äº›åŒ…å«å¤šä¸ªæˆå‘˜å±æ€§çš„å¯¹è±¡ï¼Œè¿™äº›æˆå‘˜å±æ€§ä¹Ÿç§°ä¸ºéƒ¨ä»¶æˆ–é›¶ä»¶ï¼Œå¦‚æ±½è½¦åŒ…æ‹¬æ–¹å‘ç›˜ã€å‘åŠ¨æœºã€è½®èƒç­‰éƒ¨ä»¶ï¼Œç”µå­é‚®ä»¶åŒ…æ‹¬å‘ä»¶äººã€æ”¶ä»¶äººã€ä¸»é¢˜ã€å†…å®¹ã€é™„ä»¶ç­‰éƒ¨ä»¶ï¼Œä¸€ä¸ªå…¸å‹çš„å¤æ‚å¯¹è±¡ç±»ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n```cpp\nclass Product  \n{\nprivate:\n    String partA; //å®šä¹‰éƒ¨ä»¶ï¼Œéƒ¨ä»¶å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼ŒåŒ…æ‹¬å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹\n    String partB;\n    String partC;\n    //partAçš„Getteræ–¹æ³•å’ŒSetteræ–¹æ³•çœç•¥\n    //partBçš„Getteræ–¹æ³•å’ŒSetteræ–¹æ³•çœç•¥\n    //partCçš„Getteræ–¹æ³•å’ŒSetteræ–¹æ³•çœç•¥\n};\n```\n\n* æŠ½è±¡å»ºé€ è€…ç±»\n\nåœ¨æŠ½è±¡å»ºé€ è€…ç±»ä¸­å®šä¹‰äº†äº§å“çš„åˆ›å»ºæ–¹æ³•å’Œè¿”å›æ–¹æ³•ï¼Œå…¶å…¸å‹ä»£ç å¦‚ä¸‹\n\n```cpp\nclass Builder\n{\nprotected:\n    //åˆ›å»ºäº§å“å¯¹è±¡\n    Product * product;//Product product=new Product();\npublic:\n    void buildPartA() = 0;\n    void buildPartB() = 0;\n    void buildPartC() = 0;\n    //è¿”å›äº§å“å¯¹è±¡\n\tProduct* getResult()\n    {\n        return product;\n    }\n};\n```\n\nåœ¨æŠ½è±¡ç±»`Builder`ä¸­å£°æ˜äº†ä¸€ç³»åˆ—æŠ½è±¡çš„`buildPartX()`æ–¹æ³•ç”¨äºåˆ›å»ºå¤æ‚äº§å“çš„å„ä¸ªéƒ¨ä»¶ï¼Œå…·ä½“å»ºé€ è¿‡ç¨‹åœ¨`ConcreteBuilder`ä¸­å®ç°ï¼Œæ­¤å¤–è¿˜æä¾›äº†å·¥å‚æ–¹æ³•`getResult()`ï¼Œç”¨äºè¿”å›ä¸€ä¸ªå»ºé€ å¥½çš„å®Œæ•´äº§å“ã€‚\n\n* å…·ä½“å»ºé€ è€…ç±»\n\nåœ¨`ConcreteBuilder`ä¸­å®ç°äº†`buildPartX()`æ–¹æ³•ï¼Œé€šè¿‡è°ƒç”¨`Product`çš„`setPartX()`æ–¹æ³•å¯ä»¥ç»™äº§å“å¯¹è±¡çš„æˆå‘˜å±æ€§è®¾å€¼ã€‚ä¸åŒçš„å…·ä½“å»ºé€ è€…åœ¨å®ç°`buildPartX()`æ–¹æ³•æ—¶å°†æœ‰æ‰€åŒºåˆ«ï¼Œå¦‚`setPartX()`æ–¹æ³•çš„å‚æ•°å¯èƒ½ä¸ä¸€æ ·ï¼Œåœ¨æœ‰äº›å…·ä½“å»ºé€ è€…ç±»ä¸­æŸäº›`setPartX()`æ–¹æ³•æ— é¡»å®ç°ï¼ˆæä¾›ä¸€ä¸ªç©ºå®ç°ï¼‰ã€‚è€Œè¿™äº›å¯¹äºå®¢æˆ·ç«¯æ¥è¯´éƒ½æ— é¡»å…³å¿ƒï¼Œå®¢æˆ·ç«¯åªéœ€çŸ¥é“å…·ä½“å»ºé€ è€…ç±»å‹å³å¯ã€‚\n\n* æŒ‡æŒ¥è€…ç±»\n\nåœ¨å»ºé€ è€…æ¨¡å¼çš„ç»“æ„ä¸­è¿˜å¼•å…¥äº†ä¸€ä¸ªæŒ‡æŒ¥è€…ç±»Directorï¼Œè¯¥ç±»ä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨ï¼šä¸€æ–¹é¢å®ƒéš”ç¦»äº†å®¢æˆ·ä¸åˆ›å»ºè¿‡ç¨‹ï¼›å¦ä¸€æ–¹é¢å®ƒæ§åˆ¶äº§å“çš„åˆ›å»ºè¿‡ç¨‹ï¼ŒåŒ…æ‹¬æŸä¸ªbuildPartX()æ–¹æ³•æ˜¯å¦è¢«è°ƒç”¨ä»¥åŠå¤šä¸ªbuildPartX()æ–¹æ³•è°ƒç”¨çš„å…ˆåæ¬¡åºç­‰ã€‚æŒ‡æŒ¥è€…é’ˆå¯¹æŠ½è±¡å»ºé€ è€…ç¼–ç¨‹ï¼Œå®¢æˆ·ç«¯åªéœ€è¦çŸ¥é“å…·ä½“å»ºé€ è€…çš„ç±»å‹ï¼Œå³å¯é€šè¿‡æŒ‡æŒ¥è€…ç±»è°ƒç”¨å»ºé€ è€…çš„ç›¸å…³æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªå®Œæ•´çš„äº§å“å¯¹è±¡ã€‚åœ¨å®é™…ç”Ÿæ´»ä¸­ä¹Ÿå­˜åœ¨ç±»ä¼¼æŒ‡æŒ¥è€…ä¸€æ ·çš„è§’è‰²ï¼Œå¦‚ä¸€ä¸ªå®¢æˆ·å»è´­ä¹°ç”µè„‘ï¼Œç”µè„‘é”€å”®äººå‘˜ç›¸å½“äºæŒ‡æŒ¥è€…ï¼Œåªè¦å®¢æˆ·ç¡®å®šç”µè„‘çš„ç±»å‹ï¼Œç”µè„‘é”€å”®äººå‘˜å¯ä»¥é€šçŸ¥ç”µè„‘ç»„è£…äººå‘˜ç»™å®¢æˆ·ç»„è£…ä¸€å°ç”µè„‘ã€‚æŒ‡æŒ¥è€…ç±»çš„ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n```cpp\nclass Director\n{\nprivate:\n    Builder * builder;\npublic:\n    Director(Builder* builder)\n    {\n    \tthis.builder = builder;\n    }\n    void setBuilder(Builder* builder)\n    {\n    \tthis.builder = builer;\n    }\n    //äº§å“æ„å»ºä¸ç»„è£…æ–¹æ³•\n    Product* construct()\n    {\n        builder->buildPartA();\n        builder->buildPartB();\n        builder->buildPartC();\n        return builder->getResult();\n    }\n};\n```\n\nåœ¨æŒ‡æŒ¥è€…ç±»ä¸­å¯ä»¥æ³¨å…¥ä¸€ä¸ªæŠ½è±¡å»ºé€ è€…ç±»å‹çš„å¯¹è±¡ï¼Œå…¶æ ¸å¿ƒåœ¨äºæä¾›äº†ä¸€ä¸ªå»ºé€ æ–¹æ³•construct()ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­è°ƒç”¨äº†builderå¯¹è±¡çš„æ„é€ éƒ¨ä»¶çš„æ–¹æ³•ï¼Œæœ€åè¿”å›ä¸€ä¸ªäº§å“å¯¹è±¡ã€‚\n\n* å®¢æˆ·ç«¯\n\nå¯¹äºå®¢æˆ·ç«¯è€Œè¨€ï¼Œåªéœ€å…³å¿ƒå…·ä½“çš„å»ºé€ è€…å³å¯ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯ç±»ä»£ç ç‰‡æ®µå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```cpp\nBuilder* builder = new ConcreteBuilder(); //å¯é€šè¿‡é…ç½®æ–‡ä»¶å®ç°\nDirector* director = new Director(builder);\nProduct* product = director->construct();\n```\n\nå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æ¥å­˜å‚¨å…·ä½“å»ºé€ è€…ç±»`ConcreteBuilder`çš„ç±»åï¼Œä½¿å¾—æ›´æ¢æ–°çš„å»ºé€ è€…æ—¶æ— é¡»ä¿®æ”¹æºä»£ç ï¼Œç³»ç»Ÿæ‰©å±•æ›´ä¸ºæ–¹ä¾¿ã€‚åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ï¼Œæ— é¡»å…³å¿ƒäº§å“å¯¹è±¡çš„å…·ä½“ç»„è£…è¿‡ç¨‹ï¼Œåªéœ€æŒ‡å®šå…·ä½“å»ºé€ è€…çš„ç±»å‹å³å¯ã€‚\n\n## ä¸æŠ½è±¡å·¥å‚æ¨¡å¼çš„å¯¹æ¯”\n\nå»ºé€ è€…æ¨¡å¼ä¸æŠ½è±¡å·¥å‚æ¨¡å¼æœ‰ç‚¹ç›¸ä¼¼ï¼Œä½†æ˜¯\n\n* **å»ºé€ è€…æ¨¡å¼è¿”å›ä¸€ä¸ªå®Œæ•´çš„å¤æ‚äº§å“**ï¼Œè€Œ**æŠ½è±¡å·¥å‚æ¨¡å¼è¿”å›ä¸€ç³»åˆ—ç›¸å…³çš„äº§å“**ï¼›\n* åœ¨æŠ½è±¡å·¥å‚æ¨¡å¼ä¸­ï¼Œå®¢æˆ·ç«¯é€šè¿‡é€‰æ‹©å…·ä½“å·¥å‚æ¥ç”Ÿæˆæ‰€éœ€å¯¹è±¡ï¼Œè€Œ**åœ¨å»ºé€ è€…æ¨¡å¼ä¸­ï¼Œå®¢æˆ·ç«¯é€šè¿‡æŒ‡å®šå…·ä½“å»ºé€ è€…ç±»å‹å¹¶æŒ‡å¯¼Directorç±»å¦‚ä½•å»ç”Ÿæˆå¯¹è±¡**ï¼Œä¾§é‡äºä¸€æ­¥æ­¥æ„é€ ä¸€ä¸ªå¤æ‚å¯¹è±¡ï¼Œç„¶åå°†ç»“æœè¿”å›ã€‚\n* å¦‚æœå°†**æŠ½è±¡å·¥å‚æ¨¡å¼çœ‹æˆä¸€ä¸ªæ±½è½¦é…ä»¶ç”Ÿäº§å‚**ï¼Œç”Ÿæˆä¸åŒç±»å‹çš„æ±½è½¦é…ä»¶ï¼Œé‚£ä¹ˆ**å»ºé€ è€…æ¨¡å¼å°±æ˜¯ä¸€ä¸ªæ±½è½¦ç»„è£…å‚**ï¼Œé€šè¿‡å¯¹é…ä»¶è¿›è¡Œç»„è£…è¿”å›ä¸€è¾†å®Œæ•´çš„æ±½è½¦ã€‚\n\n# å®Œæ•´è§£å†³æ–¹æ¡ˆ\n\nè¯¥å…¬å¸å¼€å‘äººå‘˜å†³å®šä½¿ç”¨å»ºé€ è€…æ¨¡å¼æ¥å®ç°æ¸¸æˆè§’è‰²çš„åˆ›å»ºï¼Œå…¶åŸºæœ¬ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼š\n\n![image-20220427191321266](../../images/å»ºé€ è€…æ¨¡å¼/image-20220427191321266.png)\n\nåœ¨å›¾ä¸­ï¼ŒActorControllerå……å½“æŒ‡æŒ¥è€…ï¼ŒActorBuilderå……å½“æŠ½è±¡å»ºé€ è€…ï¼ŒHeroBuilderã€AngelBuilderå’ŒDevilBuilderå……å½“å…·ä½“å»ºé€ è€…ï¼ŒActorå……å½“å¤æ‚äº§å“ã€‚\n\næŒ‡æŒ¥è€…ç±»ActorControlleréœ€è¦å®šä¹‰`construct()`æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ‹¥æœ‰ä¸€ä¸ªæŠ½è±¡å»ºé€ è€…`ActorBuilder`ç±»å‹çš„å‚æ•°ï¼Œåœ¨è¯¥æ–¹æ³•å†…éƒ¨å®ç°äº†æ¸¸æˆè§’è‰²å¯¹è±¡çš„é€æ­¥æ„å»ºã€‚\n\nä¸ºäº†æé«˜ç³»ç»Ÿçš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ï¼Œæœ€å¥½å°†å…·ä½“å»ºé€ è€…ç±»çš„ç±»åå­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå¹¶é€šè¿‡æŸä¸ªå·¥å…·ç±»Utilæ¥è¯»å–é…ç½®æ–‡ä»¶å¹¶åå°„ç”Ÿæˆå¯¹è±¡ã€‚\n\n# æ€»ç»“\n\nå»ºé€ è€…æ¨¡å¼çš„æ ¸å¿ƒåœ¨äºå¦‚ä½•ä¸€æ­¥æ­¥æ„å»ºä¸€ä¸ªåŒ…å«å¤šä¸ªç»„æˆéƒ¨ä»¶çš„å®Œæ•´å¯¹è±¡ï¼Œä½¿ç”¨ç›¸åŒçš„æ„å»ºè¿‡ç¨‹æ„å»ºä¸åŒçš„äº§å“ï¼Œåœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦åˆ›å»ºå¤æ‚å¯¹è±¡å¹¶å¸Œæœ›ç³»ç»Ÿå…·å¤‡å¾ˆå¥½çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§å¯ä»¥è€ƒè™‘ä½¿ç”¨å»ºé€ è€…æ¨¡å¼ã€‚\n\n## ä¸»è¦ä¼˜ç‚¹\n\n* åœ¨å»ºé€ è€…æ¨¡å¼ä¸­ï¼Œå®¢æˆ·ç«¯ä¸å¿…çŸ¥é“äº§å“å†…éƒ¨ç»„æˆçš„ç»†èŠ‚ï¼Œå°†äº§å“æœ¬èº«ä¸äº§å“çš„åˆ›å»ºè¿‡ç¨‹è§£è€¦ï¼Œä½¿å¾—ç›¸åŒçš„åˆ›å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„äº§å“å¯¹è±¡ã€‚\n* æ¯ä¸€ä¸ªå…·ä½“å»ºé€ è€…éƒ½ç›¸å¯¹ç‹¬ç«‹ï¼Œè€Œä¸å…¶ä»–çš„å…·ä½“å»ºé€ è€…æ— å…³ï¼Œå› æ­¤å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ›¿æ¢å…·ä½“å»ºé€ è€…æˆ–å¢åŠ æ–°çš„å…·ä½“å»ºé€ è€…ï¼Œç”¨æˆ·ä½¿ç”¨ä¸åŒçš„å…·ä½“å»ºé€ è€…å³å¯å¾—åˆ°ä¸åŒçš„äº§å“å¯¹è±¡ã€‚ç”±äºæŒ‡æŒ¥è€…ç±»é’ˆå¯¹æŠ½è±¡å»ºé€ è€…ç¼–ç¨‹ï¼Œå¢åŠ æ–°çš„å…·ä½“å»ºé€ è€…æ— é¡»ä¿®æ”¹åŸæœ‰ç±»åº“çš„ä»£ç ï¼Œç³»ç»Ÿæ‰©å±•æ–¹ä¾¿ï¼Œç¬¦åˆâ€œå¼€é—­åŸåˆ™â€\n* å¯ä»¥æ›´åŠ ç²¾ç»†åœ°æ§åˆ¶äº§å“çš„åˆ›å»ºè¿‡ç¨‹ã€‚å°†å¤æ‚äº§å“çš„åˆ›å»ºæ­¥éª¤åˆ†è§£åœ¨ä¸åŒçš„æ–¹æ³•ä¸­ï¼Œä½¿å¾—åˆ›å»ºè¿‡ç¨‹æ›´åŠ æ¸…æ™°ï¼Œä¹Ÿæ›´æ–¹ä¾¿ä½¿ç”¨ç¨‹åºæ¥æ§åˆ¶åˆ›å»ºè¿‡ç¨‹ã€‚\n\n## ä¸»è¦ç¼ºç‚¹\n\n* å»ºé€ è€…æ¨¡å¼æ‰€åˆ›å»ºçš„äº§å“ä¸€èˆ¬å…·æœ‰è¾ƒå¤šçš„å…±åŒç‚¹ï¼Œå…¶ç»„æˆéƒ¨åˆ†ç›¸ä¼¼ï¼Œå¦‚æœäº§å“ä¹‹é—´çš„å·®å¼‚æ€§å¾ˆå¤§ï¼Œä¾‹å¦‚å¾ˆå¤šç»„æˆéƒ¨åˆ†éƒ½ä¸ç›¸åŒï¼Œä¸é€‚åˆä½¿ç”¨å»ºé€ è€…æ¨¡å¼ï¼Œå› æ­¤å…¶ä½¿ç”¨èŒƒå›´å—åˆ°ä¸€å®šçš„é™åˆ¶ã€‚\n* å¦‚æœäº§å“çš„å†…éƒ¨å˜åŒ–å¤æ‚ï¼Œå¯èƒ½ä¼šå¯¼è‡´éœ€è¦å®šä¹‰å¾ˆå¤šå…·ä½“å»ºé€ è€…ç±»æ¥å®ç°è¿™ç§å˜åŒ–ï¼Œå¯¼è‡´ç³»ç»Ÿå˜å¾—å¾ˆåºå¤§ï¼Œå¢åŠ ç³»ç»Ÿçš„ç†è§£éš¾åº¦å’Œè¿è¡Œæˆæœ¬ã€‚\n\n## é€‚ç”¨åœºæ™¯\n\n* éœ€è¦ç”Ÿæˆçš„äº§å“å¯¹è±¡æœ‰å¤æ‚çš„å†…éƒ¨ç»“æ„ï¼Œè¿™äº›äº§å“å¯¹è±¡é€šå¸¸åŒ…å«å¤šä¸ªæˆå‘˜å±æ€§ã€‚\n* éœ€è¦ç”Ÿæˆçš„äº§å“å¯¹è±¡çš„å±æ€§ç›¸äº’ä¾èµ–ï¼Œéœ€è¦æŒ‡å®šå…¶ç”Ÿæˆé¡ºåºã€‚\n* å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ç‹¬ç«‹äºåˆ›å»ºè¯¥å¯¹è±¡çš„ç±»ã€‚åœ¨å»ºé€ è€…æ¨¡å¼ä¸­é€šè¿‡å¼•å…¥äº†æŒ‡æŒ¥è€…ç±»ï¼Œå°†åˆ›å»ºè¿‡ç¨‹å°è£…åœ¨æŒ‡æŒ¥è€…ç±»ä¸­ï¼Œè€Œä¸åœ¨å»ºé€ è€…ç±»å’Œå®¢æˆ·ç±»ä¸­ã€‚\n* éš”ç¦»å¤æ‚å¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨ï¼Œå¹¶ä½¿å¾—ç›¸åŒçš„åˆ›å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„äº§å“ã€‚\n\nåœ¨å»ºé€ è€…æ¨¡å¼ä¸­ï¼Œ**å®¢æˆ·ç«¯åªéœ€å®ä¾‹åŒ–æŒ‡æŒ¥è€…ç±»**ï¼ŒæŒ‡æŒ¥è€…ç±»é’ˆå¯¹æŠ½è±¡å»ºé€ è€…ç¼–ç¨‹ï¼Œå®¢æˆ·ç«¯æ ¹æ®éœ€è¦ä¼ å…¥å…·ä½“çš„å»ºé€ è€…ç±»å‹ï¼ŒæŒ‡æŒ¥è€…å°†æŒ‡å¯¼å…·ä½“å»ºé€ è€…ä¸€æ­¥ä¸€æ­¥æ„é€ ä¸€ä¸ªå®Œæ•´çš„äº§å“ï¼ˆé€æ­¥è°ƒç”¨å…·ä½“å»ºé€ è€…çš„buildX()æ–¹æ³•ï¼‰ï¼Œç›¸åŒçš„æ„é€ è¿‡ç¨‹å¯ä»¥åˆ›å»ºå®Œå…¨ä¸åŒçš„äº§å“ã€‚\n\nåœ¨æ¸¸æˆè§’è‰²å®ä¾‹ä¸­ï¼Œå¦‚æœéœ€è¦æ›´æ¢è§’è‰²ï¼Œåªéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæ›´æ¢å…·ä½“è§’è‰²å»ºé€ è€…ç±»å³å¯ï¼›\n\nå¦‚æœéœ€è¦å¢åŠ æ–°è§’è‰²ï¼Œå¯ä»¥å¢åŠ ä¸€ä¸ªæ–°çš„å…·ä½“è§’è‰²å»ºé€ è€…ç±»ä½œä¸ºæŠ½è±¡è§’è‰²å»ºé€ è€…çš„å­ç±»ï¼Œå†ä¿®æ”¹é…ç½®æ–‡ä»¶å³å¯ï¼ŒåŸæœ‰ä»£ç æ— é¡»ä¿®æ”¹ï¼Œå®Œå…¨ç¬¦åˆâ€œå¼€é—­åŸåˆ™â€ã€‚\n\n# å‚è€ƒæ–‡çŒ®\n\n```\n[1] åˆ˜ä¼Ÿ. è®¾è®¡æ¨¡å¼.\n```\n","categories":["è®¾è®¡æ¨¡å¼","åˆ›å»ºå‹æ¨¡å¼"]},{"title":"æŠ½è±¡å·¥å‚æ¨¡å¼","url":"/è®¾è®¡æ¨¡å¼/æŠ½è±¡å·¥å‚æ¨¡å¼/","content":"\n# å†…å®¹\n\n1. æŠ½è±¡å·¥å‚æ¨¡å¼ä¹‹å‰\n2. å¼•å…¥æŠ½è±¡å·¥å‚\n2. æŠ½è±¡å·¥å‚æ¨¡å¼æ¦‚è¿°\n2. è§£å†³æ–¹æ¡ˆ\n\n# æŠ½è±¡å·¥å‚æ¨¡å¼ä¹‹å‰\n\nå·¥å‚æ–¹æ³•æ¨¡å¼é€šè¿‡å¼•å…¥å·¥å‚ç­‰çº§ç»“æ„ï¼Œè§£å†³äº†ç®€å•å·¥å‚æ¨¡å¼ä¸­å·¥å‚ç±»èŒè´£å¤ªé‡çš„é—®é¢˜ã€‚\nä½†ç”±äºå·¥å‚æ–¹æ³•æ¨¡å¼ä¸­çš„æ¯ä¸ªå·¥å‚åªç”Ÿäº§ä¸€ç±»äº§å“ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿä¸­å­˜åœ¨å¤§é‡çš„å·¥å‚ç±»ï¼ŒåŠ¿å¿…ä¼šå¢åŠ ç³»ç»Ÿçš„å¼€é”€ã€‚\næ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘**å°†ä¸€äº›ç›¸å…³çš„äº§å“ç»„æˆä¸€ä¸ªâ€œäº§å“æ—â€**ï¼Œç”±åŒä¸€ä¸ªå·¥å‚æ¥ç»Ÿä¸€ç”Ÿäº§ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æœ¬æ–‡å°†è¦å­¦ä¹ çš„æŠ½è±¡å·¥å‚æ¨¡å¼çš„åŸºæœ¬æ€æƒ³ã€‚\n\n## æ¡ˆä¾‹-ç•Œé¢çš®è‚¤åº“çš„åˆå§‹è®¾è®¡\n\næŸè½¯ä»¶å…¬å¸æ¬²å¼€å‘ä¸€å¥—ç•Œé¢çš®è‚¤åº“ï¼Œå¯ä»¥å¯¹Javaæ¡Œé¢è½¯ä»¶è¿›è¡Œç•Œé¢ç¾åŒ–ã€‚ä¸ºäº†ä¿æŠ¤ç‰ˆæƒï¼Œè¯¥çš®è‚¤åº“æºä»£ç ä¸æ‰“ç®—å…¬å¼€ï¼Œè€Œåªå‘ç”¨æˆ·æä¾›å·²æ‰“åŒ…ä¸ºjaræ–‡ä»¶çš„classå­—èŠ‚ç æ–‡ä»¶ã€‚ç”¨æˆ·åœ¨ä½¿ç”¨æ—¶å¯ä»¥é€šè¿‡èœå•æ¥é€‰æ‹©çš®è‚¤ï¼Œä¸åŒçš„çš®è‚¤å°†æä¾›è§†è§‰æ•ˆæœä¸åŒçš„æŒ‰é’®ã€æ–‡æœ¬æ¡†ã€ç»„åˆæ¡†ç­‰ç•Œé¢å…ƒç´ ï¼Œå…¶ç»“æ„ç¤ºæ„å›¾å¦‚å›¾ã€‚\n\n![image-20220426083347741](../../images/æŠ½è±¡å·¥å‚æ¨¡å¼/image-20220426083347741.png)\n\nè¯¥çš®è‚¤åº“éœ€è¦å…·å¤‡è‰¯å¥½çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ï¼Œç”¨æˆ·å¯ä»¥è‡ªç”±é€‰æ‹©ä¸åŒçš„çš®è‚¤ï¼Œå¼€å‘äººå‘˜å¯ä»¥åœ¨ä¸ä¿®æ”¹æ—¢æœ‰ä»£ç çš„åŸºç¡€ä¸Šå¢åŠ æ–°çš„çš®è‚¤ã€‚\n\nè¯¥è½¯ä»¶å…¬å¸çš„å¼€å‘äººå‘˜é’ˆå¯¹ä¸Šè¿°è¦æ±‚ï¼Œå†³å®šä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼è¿›è¡Œç³»ç»Ÿçš„è®¾è®¡ï¼Œä¸ºäº†ä¿è¯ç³»ç»Ÿçš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ï¼Œæä¾›ä¸€ç³»åˆ—å…·ä½“å·¥å‚æ¥åˆ›å»ºæŒ‰é’®ã€æ–‡æœ¬æ¡†ã€ç»„åˆæ¡†ç­‰ç•Œé¢å…ƒç´ ï¼Œå®¢æˆ·ç«¯é’ˆå¯¹æŠ½è±¡å·¥å‚ç¼–ç¨‹ï¼Œåˆå§‹ç»“æ„å¦‚å›¾æ‰€ç¤ºã€‚\n\n![img](../../images/æŠ½è±¡å·¥å‚æ¨¡å¼/image-20220426083347742.png)\n\n* åœ¨å›¾ä¸­ï¼Œæä¾›äº†å¤§é‡å·¥å‚æ¥åˆ›å»ºå…·ä½“çš„ç•Œé¢ç»„ä»¶ï¼Œå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æ›´æ¢å…·ä½“ç•Œé¢ç»„ä»¶ä»è€Œæ”¹å˜ç•Œé¢é£æ ¼ã€‚ä½†æ˜¯ï¼Œæ­¤è®¾è®¡æ–¹æ¡ˆå­˜åœ¨å¦‚ä¸‹é—®é¢˜ï¼š\n  * å½“éœ€è¦å¢åŠ æ–°çš„çš®è‚¤æ—¶ï¼Œè™½ç„¶ä¸è¦ä¿®æ”¹ç°æœ‰ä»£ç ï¼Œ**ä½†æ˜¯éœ€è¦å¢åŠ å¤§é‡ç±»**ï¼Œé’ˆå¯¹æ¯ä¸€ä¸ªæ–°å¢å…·ä½“ç»„ä»¶éƒ½éœ€è¦å¢åŠ ä¸€ä¸ªå…·ä½“å·¥å‚ï¼Œ**ç±»çš„ä¸ªæ•°æˆå¯¹å¢åŠ ï¼Œè¿™æ— ç–‘ä¼šå¯¼è‡´ç³»ç»Ÿè¶Šæ¥è¶Šåºå¤§**ï¼Œå¢åŠ ç³»ç»Ÿçš„ç»´æŠ¤æˆæœ¬å’Œè¿è¡Œå¼€é”€ï¼›\n  * ç”±äºåŒä¸€ç§é£æ ¼çš„å…·ä½“ç•Œé¢ç»„ä»¶é€šå¸¸è¦ä¸€èµ·æ˜¾ç¤ºï¼Œå› æ­¤éœ€è¦ä¸ºæ¯ä¸ªç»„ä»¶éƒ½é€‰æ‹©ä¸€ä¸ªå…·ä½“å·¥å‚ï¼Œç”¨æˆ·åœ¨ä½¿ç”¨æ—¶å¿…é¡»é€ä¸ªè¿›è¡Œè®¾ç½®ï¼Œå¦‚æœæŸä¸ªå…·ä½“å·¥å‚é€‰æ‹©å¤±è¯¯å°†ä¼šå¯¼è‡´ç•Œé¢æ˜¾ç¤ºæ··ä¹±ï¼Œè™½ç„¶æˆ‘ä»¬å¯ä»¥é€‚å½“å¢åŠ ä¸€äº›çº¦æŸè¯­å¥ï¼Œä½†å®¢æˆ·ç«¯ä»£ç å’Œé…ç½®æ–‡ä»¶éƒ½è¾ƒä¸ºå¤æ‚ã€‚\n\nå¦‚ä½•å‡å°‘ç³»ç»Ÿä¸­ç±»çš„ä¸ªæ•°å¹¶ä¿è¯å®¢æˆ·ç«¯æ¯æ¬¡å§‹ç»ˆåªä½¿ç”¨æŸä¸€ç§é£æ ¼çš„å…·ä½“ç•Œé¢ç»„ä»¶ï¼Ÿè¿™æ˜¯è¯¥å…¬å¸å¼€å‘äººå‘˜æ‰€é¢ä¸´çš„ä¸¤ä¸ªé—®é¢˜ï¼Œæ˜¾ç„¶ï¼Œå·¥å‚æ–¹æ³•æ¨¡å¼æ— æ³•è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œåˆ«ç€æ€¥ï¼Œå°†è¦ä»‹ç»çš„æŠ½è±¡å·¥å‚æ¨¡å¼å¯ä»¥è®©è¿™äº›é—®é¢˜è¿åˆƒè€Œè§£ã€‚\n\n# å¼•å…¥æŠ½è±¡å·¥å‚\n\nåœ¨å·¥å‚æ–¹æ³•æ¨¡å¼ä¸­å…·ä½“å·¥å‚è´Ÿè´£ç”Ÿäº§å…·ä½“çš„äº§å“ï¼Œæ¯ä¸€ä¸ªå…·ä½“å·¥å‚å¯¹åº”ä¸€ç§å…·ä½“äº§å“ï¼Œå·¥å‚æ–¹æ³•å…·æœ‰å”¯ä¸€æ€§ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå…·ä½“å·¥å‚ä¸­åªæœ‰ä¸€ä¸ªæˆ–è€…ä¸€ç»„é‡è½½çš„å·¥å‚æ–¹æ³•ã€‚ä½†æ˜¯**æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›ä¸€ä¸ªå·¥å‚å¯ä»¥æä¾›å¤šä¸ªäº§å“å¯¹è±¡ï¼Œè€Œä¸æ˜¯å•ä¸€çš„äº§å“å¯¹è±¡ï¼Œå¦‚ä¸€ä¸ªç”µå™¨å·¥å‚ï¼Œå®ƒå¯ä»¥ç”Ÿäº§ç”µè§†æœºã€ç”µå†°ç®±ã€ç©ºè°ƒç­‰å¤šç§ç”µå™¨**ï¼Œè€Œä¸æ˜¯åªç”Ÿäº§æŸä¸€ç§ç”µå™¨ã€‚ä¸ºäº†æ›´å¥½åœ°ç†è§£æŠ½è±¡å·¥å‚æ¨¡å¼ï¼Œæˆ‘ä»¬å…ˆå¼•å…¥ä¸¤ä¸ªæ¦‚å¿µï¼š\n\n* **äº§å“ç­‰çº§ç»“æ„**ï¼šäº§å“ç­‰çº§ç»“æ„å³**äº§å“çš„ç»§æ‰¿ç»“æ„**ï¼Œå¦‚ä¸€ä¸ªæŠ½è±¡ç±»æ˜¯ç”µè§†æœºï¼Œå…¶å­ç±»æœ‰æµ·å°”ç”µè§†æœºã€æµ·ä¿¡ç”µè§†æœºã€TCLç”µè§†æœºï¼Œåˆ™æŠ½è±¡ç”µè§†æœºä¸å…·ä½“å“ç‰Œçš„ç”µè§†æœºä¹‹é—´æ„æˆäº†ä¸€ä¸ªäº§å“ç­‰çº§ç»“æ„ï¼ŒæŠ½è±¡ç”µè§†æœºæ˜¯çˆ¶ç±»ï¼Œè€Œå…·ä½“å“ç‰Œçš„ç”µè§†æœºæ˜¯å…¶å­ç±»ã€‚\n* **äº§å“æ—**ï¼šåœ¨æŠ½è±¡å·¥å‚æ¨¡å¼ä¸­ï¼Œ**äº§å“æ—æ˜¯æŒ‡ç”±åŒä¸€ä¸ªå·¥å‚ç”Ÿäº§çš„ï¼Œä½äºä¸åŒäº§å“ç­‰çº§ç»“æ„ä¸­çš„ä¸€ç»„äº§å“**ï¼Œå¦‚æµ·å°”ç”µå™¨å·¥å‚ç”Ÿäº§çš„æµ·å°”ç”µè§†æœºã€æµ·å°”ç”µå†°ç®±ï¼Œæµ·å°”ç”µè§†æœºä½äºç”µè§†æœºäº§å“ç­‰çº§ç»“æ„ä¸­ï¼Œæµ·å°”ç”µå†°ç®±ä½äºç”µå†°ç®±äº§å“ç­‰çº§ç»“æ„ä¸­ï¼Œæµ·å°”ç”µè§†æœºã€æµ·å°”ç”µå†°ç®±æ„æˆäº†ä¸€ä¸ªäº§å“æ—ã€‚\n\näº§å“ç­‰çº§ç»“æ„ä¸äº§å“æ—ç¤ºæ„å›¾å¦‚å›¾æ‰€ç¤ºï¼š\n\n![img](../../images/æŠ½è±¡å·¥å‚æ¨¡å¼/image-20220426083347743.png)\n\nåœ¨å›¾ä¸­ï¼Œä¸åŒé¢œè‰²çš„å¤šä¸ªæ­£æ–¹å½¢ã€åœ†å½¢å’Œæ¤­åœ†å½¢åˆ†åˆ«æ„æˆäº†ä¸‰ä¸ªä¸åŒçš„äº§å“ç­‰çº§ç»“æ„ï¼Œè€Œç›¸åŒé¢œè‰²çš„æ­£æ–¹å½¢ã€åœ†å½¢å’Œæ¤­åœ†å½¢æ„æˆäº†ä¸€ä¸ªäº§å“æ—ï¼Œæ¯ä¸€ä¸ªå½¢çŠ¶å¯¹è±¡éƒ½ä½äºæŸä¸ªäº§å“æ—ï¼Œå¹¶å±äºæŸä¸ªäº§å“ç­‰çº§ç»“æ„ã€‚å›¾ä¸­ä¸€å…±æœ‰äº”ä¸ªäº§å“æ—ï¼Œåˆ†å±äºä¸‰ä¸ªä¸åŒçš„äº§å“ç­‰çº§ç»“æ„ã€‚æˆ‘ä»¬åªè¦æŒ‡æ˜ä¸€ä¸ªäº§å“æ‰€å¤„çš„äº§å“æ—ä»¥åŠå®ƒæ‰€å±çš„ç­‰çº§ç»“æ„ï¼Œå°±å¯ä»¥å”¯ä¸€ç¡®å®šè¿™ä¸ªäº§å“ã€‚\n\n**å½“ç³»ç»Ÿæ‰€æä¾›çš„å·¥å‚ç”Ÿäº§çš„å…·ä½“äº§å“å¹¶ä¸æ˜¯ä¸€ä¸ªç®€å•çš„å¯¹è±¡ï¼Œè€Œæ˜¯å¤šä¸ªä½äºä¸åŒäº§å“ç­‰çº§ç»“æ„ã€å±äºä¸åŒç±»å‹çš„å…·ä½“äº§å“æ—¶å°±å¯ä»¥ä½¿ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼**ã€‚æŠ½è±¡å·¥å‚æ¨¡å¼æ˜¯æ‰€æœ‰å½¢å¼çš„å·¥å‚æ¨¡å¼ä¸­æœ€ä¸ºæŠ½è±¡å’Œæœ€å…·ä¸€èˆ¬æ€§çš„ä¸€ç§å½¢å¼ã€‚**æŠ½è±¡å·¥å‚æ¨¡å¼ä¸å·¥å‚æ–¹æ³•æ¨¡å¼æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼Œå·¥å‚æ–¹æ³•æ¨¡å¼é’ˆå¯¹çš„æ˜¯ä¸€ä¸ªäº§å“ç­‰çº§ç»“æ„ï¼Œè€ŒæŠ½è±¡å·¥å‚æ¨¡å¼éœ€è¦é¢å¯¹å¤šä¸ªäº§å“ç­‰çº§ç»“æ„ï¼Œä¸€ä¸ªå·¥å‚ç­‰çº§ç»“æ„å¯ä»¥è´Ÿè´£å¤šä¸ªä¸åŒäº§å“ç­‰çº§ç»“æ„ä¸­çš„äº§å“å¯¹è±¡çš„åˆ›å»º**ã€‚å½“ä¸€ä¸ªå·¥å‚ç­‰çº§ç»“æ„å¯ä»¥åˆ›å»ºå‡ºåˆ†å±äºä¸åŒäº§å“ç­‰çº§ç»“æ„çš„ä¸€ä¸ªäº§å“æ—ä¸­çš„æ‰€æœ‰å¯¹è±¡æ—¶ï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼æ¯”å·¥å‚æ–¹æ³•æ¨¡å¼æ›´ä¸ºç®€å•ã€æ›´æœ‰æ•ˆç‡ã€‚æŠ½è±¡å·¥å‚æ¨¡å¼ç¤ºæ„å›¾å¦‚å›¾æ‰€ç¤ºï¼š\n\n![image-20220426084423742](../../images/æŠ½è±¡å·¥å‚æ¨¡å¼/image-20220426084423742.png)\n\nåœ¨å›¾ä¸­ï¼Œæ¯ä¸€ä¸ªå…·ä½“å·¥å‚å¯ä»¥ç”Ÿäº§å±äºä¸€ä¸ªäº§å“æ—çš„æ‰€æœ‰äº§å“ï¼Œä¾‹å¦‚ç”Ÿäº§é¢œè‰²ç›¸åŒçš„æ­£æ–¹å½¢ã€åœ†å½¢å’Œæ¤­åœ†å½¢ï¼Œæ‰€ç”Ÿäº§çš„äº§å“åˆä½äºä¸åŒçš„äº§å“ç­‰çº§ç»“æ„ä¸­ã€‚å¦‚æœä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œå›¾æ‰€ç¤ºç»“æ„éœ€è¦æä¾›15ä¸ªå…·ä½“å·¥å‚ï¼Œè€Œä½¿ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼åªéœ€è¦æä¾›5ä¸ªå…·ä½“å·¥å‚ï¼Œæå¤§å‡å°‘äº†ç³»ç»Ÿä¸­ç±»çš„ä¸ªæ•°ã€‚\n\n# æŠ½è±¡å·¥å‚æ¨¡å¼æ¦‚è¿°\n\næŠ½è±¡å·¥å‚æ¨¡å¼ä¸ºåˆ›å»ºä¸€ç»„å¯¹è±¡æä¾›äº†ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚**ä¸å·¥å‚æ–¹æ³•æ¨¡å¼ç›¸æ¯”ï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼ä¸­çš„å…·ä½“å·¥å‚ä¸åªæ˜¯åˆ›å»ºä¸€ç§äº§å“ï¼Œå®ƒè´Ÿè´£åˆ›å»ºä¸€æ—äº§å“**ã€‚æŠ½è±¡å·¥å‚æ¨¡å¼å®šä¹‰å¦‚ä¸‹ï¼š\n\n> æŠ½è±¡å·¥å‚æ¨¡å¼(Abstract Factory Pattern)ï¼šæä¾›ä¸€ä¸ªåˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ç›¸äº’ä¾èµ–å¯¹è±¡çš„æ¥å£ï¼Œè€Œæ— é¡»æŒ‡å®šå®ƒä»¬å…·ä½“çš„ç±»ã€‚æŠ½è±¡å·¥å‚æ¨¡å¼åˆç§°ä¸ºKitæ¨¡å¼ï¼Œå®ƒæ˜¯ä¸€ç§å¯¹è±¡åˆ›å»ºå‹æ¨¡å¼ã€‚\n\nåœ¨æŠ½è±¡å·¥å‚æ¨¡å¼ä¸­ï¼Œæ¯ä¸€ä¸ªå…·ä½“å·¥å‚éƒ½æä¾›äº†å¤šä¸ªå·¥å‚æ–¹æ³•ç”¨äºäº§ç”Ÿå¤šç§ä¸åŒç±»å‹çš„äº§å“ï¼Œè¿™äº›äº§å“æ„æˆäº†ä¸€ä¸ªäº§å“æ—ï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼ç»“æ„å¦‚å›¾\n\n![image-20220426090141713](../../images/æŠ½è±¡å·¥å‚æ¨¡å¼/image-20220426090141713.png)\n\n## è¯¥æ¨¡å¼åŒ…å«çš„è§’è‰²\n\n1. **AbstractFactoryï¼ˆæŠ½è±¡å·¥å‚ï¼‰**\n   * å®ƒå£°æ˜äº†ä¸€ç»„ç”¨äºåˆ›å»ºä¸€æ—äº§å“çš„æ–¹æ³•ï¼Œæ¯ä¸€ä¸ªæ–¹æ³•å¯¹åº”ä¸€ç§äº§å“ã€‚\n2. **ConcreteFactoryï¼ˆå…·ä½“å·¥å‚ï¼‰**\n   * å®ƒå®ç°äº†åœ¨æŠ½è±¡å·¥å‚ä¸­å£°æ˜çš„åˆ›å»ºäº§å“çš„æ–¹æ³•ï¼Œç”Ÿæˆä¸€ç»„å…·ä½“äº§å“ï¼Œè¿™äº›äº§å“æ„æˆäº†ä¸€ä¸ªäº§å“æ—ï¼Œæ¯ä¸€ä¸ªäº§å“éƒ½ä½äºæŸä¸ªäº§å“ç­‰çº§ç»“æ„ä¸­ã€‚\n3. **AbstractProductï¼ˆæŠ½è±¡äº§å“ï¼‰**\n   * å®ƒä¸ºæ¯ç§äº§å“å£°æ˜æ¥å£ï¼Œåœ¨æŠ½è±¡äº§å“ä¸­å£°æ˜äº†äº§å“æ‰€å…·æœ‰çš„ä¸šåŠ¡æ–¹æ³•ã€‚\n4. **ConcreteProductï¼ˆå…·ä½“äº§å“è§’è‰²ï¼‰**\n   * å®ƒå®šä¹‰å…·ä½“å·¥å‚ç”Ÿäº§çš„å…·ä½“äº§å“å¯¹è±¡ï¼Œå®ç°æŠ½è±¡äº§å“æ¥å£ä¸­å£°æ˜çš„ä¸šåŠ¡æ–¹æ³•ã€‚\n\n## å…¸å‹ä»£ç \n\nåœ¨æŠ½è±¡å·¥å‚ä¸­å£°æ˜äº†å¤šä¸ªå·¥å‚æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºä¸åŒç±»å‹çš„äº§å“ï¼ŒæŠ½è±¡å·¥å‚å¯ä»¥æ˜¯æ¥å£ï¼Œä¹Ÿå¯ä»¥æ˜¯æŠ½è±¡ç±»æˆ–è€…å…·ä½“ç±»ï¼Œå…¶å…¸å‹ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```c++\nclass AbstractFactory\n{\npublic:\n    AbstractProductA createProductA() = 0;\t//å·¥å‚æ–¹æ³•ä¸€\n\tAbstractProductB createProductB() = 0;\t//å·¥å‚æ–¹æ³•äºŒ\n}\n```\n\nå…·ä½“å·¥å‚å®ç°äº†æŠ½è±¡å·¥å‚ï¼Œæ¯ä¸€ä¸ªå…·ä½“çš„å·¥å‚æ–¹æ³•å¯ä»¥è¿”å›ä¸€ä¸ªç‰¹å®šçš„äº§å“å¯¹è±¡ï¼Œè€ŒåŒä¸€ä¸ªå…·ä½“å·¥å‚æ‰€åˆ›å»ºçš„äº§å“å¯¹è±¡æ„æˆäº†ä¸€ä¸ªäº§å“æ—ã€‚å¯¹äºæ¯ä¸€ä¸ªå…·ä½“å·¥å‚ç±»ï¼Œå…¶å…¸å‹ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```c++\nclass ConcreteFactory1 : public AbstractFactory\n{\npublic:\n    //å·¥å‚æ–¹æ³•ä¸€\n    AbstractProductA createProductA()\n    {\n    \treturn new ConcreteProductA1();\n    }\n\t//å·¥å‚æ–¹æ³•äºŒ\n\tAbstractProductB createProductB()\n    {\n    \treturn new ConcreteProductB1();\n\t}\n}\n```\n\n# å‰æ–‡æ¡ˆä¾‹å®Œæ•´è§£å†³æ–¹æ¡ˆ\n\nè¯¥å…¬å¸å¼€å‘äººå‘˜ä½¿ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼æ¥é‡æ„ç•Œé¢çš®è‚¤åº“çš„è®¾è®¡ï¼Œå…¶åŸºæœ¬ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼š\n\n![image-20220426091002353](../../images/æŠ½è±¡å·¥å‚æ¨¡å¼/image-20220426091002353.png)\n\nåœ¨å›¾ä¸­ï¼Œ`SkinFactory`æ¥å£å……å½“æŠ½è±¡å·¥å‚ï¼Œå…¶å­ç±»`SpringSkinFactory`å’Œ`SummerSkinFactory`å……å½“å…·ä½“å·¥å‚ï¼Œæ¥å£`Button`ã€`TextField`å’Œ`ComboBox`å……å½“æŠ½è±¡äº§å“ï¼Œå…¶å­ç±»`SpringButton`ã€`SpringTextField`ã€`SpringComboBox`å’Œ`SummerButton`ã€`SummerTextField`ã€`SummerComboBox`å……å½“å…·ä½“äº§å“ã€‚å®Œæ•´ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```cpp\n//åœ¨æœ¬å®ä¾‹ä¸­å¯¹ä»£ç è¿›è¡Œäº†å¤§é‡ç®€åŒ–ï¼Œå®é™…ä½¿ç”¨æ—¶ï¼Œç•Œé¢ç»„ä»¶çš„åˆå§‹åŒ–ä»£ç è¾ƒä¸ºå¤æ‚ï¼Œä¸ºäº†çªå‡ºæ ¸å¿ƒä»£ç ï¼Œåœ¨æ­¤åªæä¾›æ¡†æ¶ä»£ç å’Œæ¼”ç¤ºè¾“å‡ºã€‚\n//æŒ‰é’®æ¥å£ï¼šæŠ½è±¡äº§å“\nclass Button\n{\npublic:\n\tvirtual void display() = 0;\n};\n//SpringæŒ‰é’®ç±»ï¼šå…·ä½“äº§å“\nclass SpringButton : public Button\n{\npublic:\n\tvoid display()\n\t{\n\t\tcout << \"æ˜¾ç¤ºæµ…ç»¿è‰²æŒ‰é’®ã€‚\" << endl;\n\t}\n};\n//SummeræŒ‰é’®ç±»ï¼šå…·ä½“äº§å“\nclass SummerButton : public Button\n{\npublic:\n\tvoid display()\n\t{\n\t\tcout << \"æ˜¾ç¤ºæµ…è“è‰²æŒ‰é’®ã€‚\" << endl;\n\t}\n};\n//æ–‡æœ¬æ¡†æ¥å£ï¼šæŠ½è±¡äº§å“\nclass TextField\n{\npublic:\n\tvirtual void display() = 0;\n};\n//Springæ–‡æœ¬æ¡†ç±»ï¼šå…·ä½“äº§å“\nclass SpringTextField : public TextField\n{\npublic:\n\tvoid display()\n\t{\n\t\tcout << \"æ˜¾ç¤ºç»¿è‰²è¾¹æ¡†æ–‡æœ¬æ¡†ã€‚\" << endl;\n\t}\n};\n//Summeræ–‡æœ¬æ¡†ç±»ï¼šå…·ä½“äº§å“\nclass SummerTextField : public TextField\n{\npublic:\n\tvoid display()\n\t{\n\t\tcout << \"æ˜¾ç¤ºè“è‰²è¾¹æ¡†æ–‡æœ¬æ¡†ã€‚\" << endl;\n\t}\n};\n//ç»„åˆæ¡†æ¥å£ï¼šæŠ½è±¡äº§å“\nclass ComboBox\n{\npublic:\n\tvirtual void display() = 0;\n};\n//Springç»„åˆæ¡†ç±»ï¼šå…·ä½“äº§å“\nclass SpringComboBox : public ComboBox\n{\npublic:\n\tvoid display()\n\t{\n\t\tcout << \"æ˜¾ç¤ºç»¿è‰²è¾¹æ¡†ç»„åˆæ¡†ã€‚\" << endl;\n\t}\n};\n//Summerç»„åˆæ¡†ç±»ï¼šå…·ä½“äº§å“\nclass SummerComboBox : public ComboBox\n{\npublic:\n\tvoid display()\n\t{\n\t\tcout << \"æ˜¾ç¤ºè“è‰²è¾¹æ¡†ç»„åˆæ¡†ã€‚\" << endl;\n\t}\n};\n//ç•Œé¢çš®è‚¤å·¥å‚æ¥å£ï¼šæŠ½è±¡å·¥å‚\nclass SkinFactory\n{\npublic:\n\tvirtual Button* createButton() = 0;\n\tvirtual TextField* createTextField() = 0;\n\tvirtual ComboBox* createComboBox() = 0;\n};\n//Springçš®è‚¤å·¥å‚ï¼šå…·ä½“å·¥å‚\nclass SpringSkinFactory : public SkinFactory\n{\npublic:\n\tButton* createButton()\n\t{\n\t\treturn new SpringButton();\n\t}\n\tTextField* createTextField()\n\t{\n\t\treturn new SpringTextField();\n\t}\n\tComboBox* createComboBox()\n\t{\n\t\treturn new SpringComboBox();\n\t}\n};\n//Summerçš®è‚¤å·¥å‚ï¼šå…·ä½“å·¥å‚\nclass SummerSkinFactory : public SkinFactory\n{\npublic:\n\tButton* createButton()\n\t{\n\t\treturn new SummerButton();\n\t}\n\tTextField* createTextField()\n\t{\n\t\treturn new SummerTextField();\n\t}\n\tComboBox* createComboBox()\n\t{\n\t\treturn new SummerComboBox();\n\t}\n};\n```\n\n## å®¢æˆ·ç«¯\n\nç¼–å†™å¦‚ä¸‹å®¢æˆ·ç«¯æµ‹è¯•ä»£ç \n\n```cpp\n#include<iostream>\nusing namespace std;\nint main()\n{\n\t//ä½¿ç”¨æŠ½è±¡å±‚å®šä¹‰\n\tSkinFactory* factory;\n\tButton* bt;\n\tTextField* tf;\n\tComboBox* cb;\n\tfactory = new SpringSkinFactory;\n\tbt = factory->createButton();\n\ttf = factory->createTextField();\n\tcb = factory->createComboBox();\n\tbt->display();\n\ttf->display();\n\tcb->display();\n}\n```\n\nç¼–è¯‘å¹¶è¿è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹\n\n```\næ˜¾ç¤ºæµ…ç»¿è‰²æŒ‰é’®ã€‚\næ˜¾ç¤ºç»¿è‰²è¾¹æ¡†æ–‡æœ¬æ¡†ã€‚\næ˜¾ç¤ºç»¿è‰²è¾¹æ¡†ç»„åˆæ¡†ã€‚\n```\n\n# é—®é¢˜\n\nè¯¥å…¬å¸ä½¿ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼è®¾è®¡äº†ç•Œé¢çš®è‚¤åº“ï¼Œè¯¥çš®è‚¤åº“å¯ä»¥è¾ƒä¸ºæ–¹ä¾¿åœ°å¢åŠ æ–°çš„çš®è‚¤ï¼Œä½†æ˜¯ç°åœ¨é‡åˆ°ä¸€ä¸ªéå¸¸ä¸¥é‡çš„é—®é¢˜ï¼šç”±äºè®¾è®¡æ—¶è€ƒè™‘ä¸å…¨é¢ï¼Œå¿˜è®°ä¸ºå•é€‰æŒ‰é’®(RadioButton)æä¾›ä¸åŒçš®è‚¤çš„é£æ ¼åŒ–æ˜¾ç¤ºï¼Œå¯¼è‡´æ— è®ºé€‰æ‹©å“ªç§çš®è‚¤ï¼Œå•é€‰æŒ‰é’®éƒ½æ˜¾å¾—é‚£ä¹ˆâ€œæ ¼æ ¼ä¸å…¥â€ã€‚è¯¥å…¬å¸çš„è®¾è®¡äººå‘˜å†³å®šå‘ç³»ç»Ÿä¸­å¢åŠ å•é€‰æŒ‰é’®ï¼Œä½†æ˜¯å‘ç°åŸæœ‰ç³»ç»Ÿå±…ç„¶ä¸èƒ½å¤Ÿåœ¨ç¬¦åˆâ€œå¼€é—­åŸåˆ™â€çš„å‰æä¸‹å¢åŠ æ–°çš„ç»„ä»¶ï¼ŒåŸå› æ˜¯æŠ½è±¡å·¥å‚SkinFactoryä¸­æ ¹æœ¬æ²¡æœ‰æä¾›åˆ›å»ºå•é€‰æŒ‰é’®çš„æ–¹æ³•ï¼Œå¦‚æœéœ€è¦å¢åŠ å•é€‰æŒ‰é’®ï¼Œé¦–å…ˆéœ€è¦ä¿®æ”¹æŠ½è±¡å·¥å‚æ¥å£SkinFactoryï¼Œåœ¨å…¶ä¸­æ–°å¢å£°æ˜åˆ›å»ºå•é€‰æŒ‰é’®çš„æ–¹æ³•ï¼Œç„¶åé€ä¸ªä¿®æ”¹å…·ä½“å·¥å‚ç±»ï¼Œå¢åŠ ç›¸åº”æ–¹æ³•ä»¥å®ç°åœ¨ä¸åŒçš„çš®è‚¤ä¸­åˆ›å»ºå•é€‰æŒ‰é’®ï¼Œæ­¤å¤–è¿˜éœ€è¦ä¿®æ”¹å®¢æˆ·ç«¯ï¼Œå¦åˆ™å•é€‰æŒ‰é’®æ— æ³•åº”ç”¨äºç°æœ‰ç³»ç»Ÿã€‚\n\næ€ä¹ˆåŠï¼Ÿç­”æ¡ˆæ˜¯æŠ½è±¡å·¥å‚æ¨¡å¼æ— æ³•è§£å†³è¯¥é—®é¢˜ï¼Œè¿™ä¹Ÿæ˜¯æŠ½è±¡å·¥å‚æ¨¡å¼æœ€å¤§çš„ç¼ºç‚¹ã€‚åœ¨æŠ½è±¡å·¥å‚æ¨¡å¼ä¸­ï¼Œ**å¢åŠ æ–°çš„äº§å“æ—å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯å¢åŠ æ–°çš„äº§å“ç­‰çº§ç»“æ„å¾ˆéº»çƒ¦**ã€‚\n\næŠ½è±¡å·¥å‚æ¨¡å¼çš„è¿™ç§æ€§è´¨ç§°ä¸º**â€œå¼€é—­åŸåˆ™â€çš„å€¾æ–œæ€§**ã€‚â€œå¼€é—­åŸåˆ™â€è¦æ±‚ç³»ç»Ÿå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­ï¼Œé€šè¿‡æ‰©å±•è¾¾åˆ°å¢å¼ºå…¶åŠŸèƒ½çš„ç›®çš„ï¼Œå¯¹äºæ¶‰åŠåˆ°å¤šä¸ªäº§å“æ—ä¸å¤šä¸ªäº§å“ç­‰çº§ç»“æ„çš„ç³»ç»Ÿï¼Œå…¶åŠŸèƒ½å¢å¼ºåŒ…æ‹¬ä¸¤æ–¹é¢ï¼š\n\n* å¢åŠ äº§å“æ—ï¼šå¯¹äºå¢åŠ æ–°çš„äº§å“æ—ï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼å¾ˆå¥½åœ°æ”¯æŒäº†â€œå¼€é—­åŸåˆ™â€ï¼Œåªéœ€è¦å¢åŠ å…·ä½“äº§å“å¹¶å¯¹åº”å¢åŠ ä¸€ä¸ªæ–°çš„å…·ä½“å·¥å‚ï¼Œå¯¹å·²æœ‰ä»£ç æ— é¡»åšä»»ä½•ä¿®æ”¹ã€‚\n* å¢åŠ æ–°çš„äº§å“ç­‰çº§ç»“æ„ï¼šå¯¹äºå¢åŠ æ–°çš„äº§å“ç­‰çº§ç»“æ„ï¼Œéœ€è¦ä¿®æ”¹æ‰€æœ‰çš„å·¥å‚è§’è‰²ï¼ŒåŒ…æ‹¬æŠ½è±¡å·¥å‚ç±»ï¼Œåœ¨æ‰€æœ‰çš„å·¥å‚ç±»ä¸­éƒ½éœ€è¦å¢åŠ ç”Ÿäº§æ–°äº§å“çš„æ–¹æ³•ï¼Œè¿èƒŒäº†â€œå¼€é—­åŸåˆ™â€ã€‚\n\næ­£å› ä¸ºæŠ½è±¡å·¥å‚æ¨¡å¼å­˜åœ¨â€œå¼€é—­åŸåˆ™â€çš„å€¾æ–œæ€§ï¼Œå®ƒä»¥ä¸€ç§å€¾æ–œçš„æ–¹å¼æ¥æ»¡è¶³â€œå¼€é—­åŸåˆ™â€ï¼Œä¸ºå¢åŠ æ–°äº§å“æ—æä¾›æ–¹ä¾¿ï¼Œä½†ä¸èƒ½ä¸ºå¢åŠ æ–°äº§å“ç»“æ„æä¾›è¿™æ ·çš„æ–¹ä¾¿ï¼Œ**å› æ­¤è¦æ±‚è®¾è®¡äººå‘˜åœ¨è®¾è®¡ä¹‹åˆå°±èƒ½å¤Ÿå…¨é¢è€ƒè™‘ï¼Œä¸ä¼šåœ¨è®¾è®¡å®Œæˆä¹‹åå‘ç³»ç»Ÿä¸­å¢åŠ æ–°çš„äº§å“ç­‰çº§ç»“æ„ï¼Œä¹Ÿä¸ä¼šåˆ é™¤å·²æœ‰çš„äº§å“ç­‰çº§ç»“æ„ï¼Œå¦åˆ™å°†ä¼šå¯¼è‡´ç³»ç»Ÿå‡ºç°è¾ƒå¤§çš„ä¿®æ”¹**ï¼Œä¸ºåç»­ç»´æŠ¤å·¥ä½œå¸¦æ¥è¯¸å¤šéº»çƒ¦ã€‚\n\n# æ€»ç»“\n\næŠ½è±¡å·¥å‚æ¨¡å¼æ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼çš„è¿›ä¸€æ­¥å»¶ä¼¸ï¼Œç”±äºå®ƒæä¾›äº†åŠŸèƒ½æ›´ä¸ºå¼ºå¤§çš„å·¥å‚ç±»å¹¶ä¸”å…·å¤‡è¾ƒå¥½çš„å¯æ‰©å±•æ€§ï¼Œåœ¨è½¯ä»¶å¼€å‘ä¸­å¾—ä»¥å¹¿æ³›åº”ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨ä¸€äº›æ¡†æ¶å’ŒAPIç±»åº“çš„è®¾è®¡ä¸­ï¼Œä¾‹å¦‚åœ¨Javaè¯­è¨€çš„AWTï¼ˆæŠ½è±¡çª—å£å·¥å…·åŒ…ï¼‰ä¸­å°±ä½¿ç”¨äº†æŠ½è±¡å·¥å‚æ¨¡å¼ï¼Œå®ƒä½¿ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼æ¥å®ç°åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸­åº”ç”¨ç¨‹åºå‘ˆç°ä¸æ‰€åœ¨æ“ä½œç³»ç»Ÿä¸€è‡´çš„å¤–è§‚ç•Œé¢ã€‚æŠ½è±¡å·¥å‚æ¨¡å¼ä¹Ÿæ˜¯åœ¨è½¯ä»¶å¼€å‘ä¸­æœ€å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚\n\n* ä¼˜ç‚¹\n  * æŠ½è±¡å·¥å‚æ¨¡å¼éš”ç¦»äº†å…·ä½“ç±»çš„ç”Ÿæˆï¼Œä½¿å¾—å®¢æˆ·å¹¶ä¸éœ€è¦çŸ¥é“ä»€ä¹ˆè¢«åˆ›å»ºã€‚ç”±äºè¿™ç§éš”ç¦»ï¼Œæ›´æ¢ä¸€ä¸ªå…·ä½“å·¥å‚å°±å˜å¾—ç›¸å¯¹å®¹æ˜“ï¼Œæ‰€æœ‰çš„å…·ä½“å·¥å‚éƒ½å®ç°äº†æŠ½è±¡å·¥å‚ä¸­å®šä¹‰çš„é‚£äº›å…¬å…±æ¥å£ï¼Œå› æ­¤åªéœ€æ”¹å˜å…·ä½“å·¥å‚çš„å®ä¾‹ï¼Œå°±å¯ä»¥åœ¨æŸç§ç¨‹åº¦ä¸Šæ”¹å˜æ•´ä¸ªè½¯ä»¶ç³»ç»Ÿçš„è¡Œä¸ºã€‚\n  * å½“ä¸€ä¸ªäº§å“æ—ä¸­çš„å¤šä¸ªå¯¹è±¡è¢«è®¾è®¡æˆä¸€èµ·å·¥ä½œæ—¶ï¼Œå®ƒèƒ½å¤Ÿä¿è¯å®¢æˆ·ç«¯å§‹ç»ˆåªä½¿ç”¨åŒä¸€ä¸ªäº§å“æ—ä¸­çš„å¯¹è±¡ã€‚\n  * å¯¹äºå¢åŠ æ–°çš„äº§å“æ—â€”â€”å¾ˆæ–¹ä¾¿ï¼Œæ— é¡»ä¿®æ”¹å·²æœ‰ç³»ç»Ÿï¼Œç¬¦åˆâ€œå¼€é—­åŸåˆ™â€ã€‚\n* ç¼ºç‚¹\n  * å¯¹äºå¢åŠ æ–°çš„äº§å“ç­‰çº§ç»“æ„â€”â€”å¾ˆéº»çƒ¦ï¼Œéœ€è¦å¯¹åŸæœ‰ç³»ç»Ÿè¿›è¡Œè¾ƒå¤§çš„ä¿®æ”¹ï¼Œç”šè‡³éœ€è¦ä¿®æ”¹æŠ½è±¡å±‚ä»£ç ï¼Œè¿™æ˜¾ç„¶ä¼šå¸¦æ¥è¾ƒå¤§çš„ä¸ä¾¿ï¼Œè¿èƒŒäº†â€œå¼€é—­åŸåˆ™â€ã€‚\n* é€‚ç”¨åœºæ™¯\n  * ä¸€ä¸ªç³»ç»Ÿ**ä¸åº”å½“ä¾èµ–äºäº§å“ç±»å®ä¾‹å¦‚ä½•è¢«åˆ›å»ºã€ç»„åˆå’Œè¡¨è¾¾çš„ç»†èŠ‚**ï¼Œè¿™å¯¹äºæ‰€æœ‰ç±»å‹çš„å·¥å‚æ¨¡å¼éƒ½æ˜¯å¾ˆé‡è¦çš„ï¼Œç”¨æˆ·æ— é¡»å…³å¿ƒå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼Œ**å°†å¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨è§£è€¦**ã€‚\n  * ç³»ç»Ÿä¸­æœ‰å¤šäºä¸€ä¸ªçš„äº§å“æ—ï¼Œè€Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­æŸä¸€äº§å“æ—ã€‚å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶ç­‰æ–¹å¼æ¥ä½¿å¾—ç”¨æˆ·å¯ä»¥åŠ¨æ€æ”¹å˜äº§å“æ—ï¼Œä¹Ÿå¯ä»¥**å¾ˆæ–¹ä¾¿åœ°å¢åŠ æ–°çš„äº§å“æ—**ã€‚\n  * å±äºåŒä¸€ä¸ªäº§å“æ—çš„äº§å“å°†åœ¨ä¸€èµ·ä½¿ç”¨ï¼Œè¿™ä¸€çº¦æŸå¿…é¡»åœ¨ç³»ç»Ÿçš„è®¾è®¡ä¸­ä½“ç°å‡ºæ¥ã€‚**åŒä¸€ä¸ªäº§å“æ—ä¸­çš„äº§å“å¯ä»¥æ˜¯æ²¡æœ‰ä»»ä½•å…³ç³»çš„å¯¹è±¡ï¼Œä½†æ˜¯å®ƒä»¬éƒ½å…·æœ‰ä¸€äº›å…±åŒçš„çº¦æŸ**ï¼Œå¦‚åŒä¸€æ“ä½œç³»ç»Ÿä¸‹çš„æŒ‰é’®å’Œæ–‡æœ¬æ¡†ï¼ŒæŒ‰é’®ä¸æ–‡æœ¬æ¡†ä¹‹é—´æ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œä½†å®ƒä»¬éƒ½æ˜¯å±äºæŸä¸€æ“ä½œç³»ç»Ÿçš„ï¼Œæ­¤æ—¶å…·æœ‰ä¸€ä¸ªå…±åŒçš„çº¦æŸæ¡ä»¶ï¼šæ“ä½œç³»ç»Ÿçš„ç±»å‹ã€‚\n  * äº§å“ç­‰çº§ç»“æ„è¦æ±‚ä¿æŒç¨³å®šï¼Œè®¾è®¡å®Œæˆä¹‹åï¼Œä¸ä¼šå‘ç³»ç»Ÿä¸­å¢åŠ æ–°çš„äº§å“ç­‰çº§ç»“æ„æˆ–è€…åˆ é™¤å·²æœ‰çš„äº§å“ç­‰çº§ç»“æ„ã€‚\n\n# å‚è€ƒæ–‡çŒ®\n\n```\n[1] åˆ˜ä¼Ÿ. è®¾è®¡æ¨¡å¼.\n```\n","categories":["è®¾è®¡æ¨¡å¼","åˆ›å»ºå‹æ¨¡å¼"]},{"title":"è¯»muduoæœ‰æ„Ÿ_çº¿ç¨‹å®‰å…¨çš„å¯¹è±¡ç”Ÿå‘½æœŸç®¡ç†","url":"/å¤šçº¿ç¨‹/è¯»muduoæœ‰æ„Ÿ_çº¿ç¨‹å®‰å…¨çš„å¯¹è±¡ç”Ÿå‘½æœŸç®¡ç†/","content":"# å†…å®¹\n\n1. çº¿ç¨‹å®‰å…¨çš„å®šä¹‰\n2. å¯¹è±¡çš„åˆ›å»º\n3. å¯¹è±¡çš„é”€æ¯\n4. çº¿ç¨‹å®‰å…¨çš„Observer\n5. è§£å†³æ–¹æ¡ˆ\n6. é™·é˜±\n# çº¿ç¨‹å®‰å…¨çš„å®šä¹‰\n\nä¾æ®`[JCP]`ï¼Œä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„classåº”å½“æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶ï¼š\n\n* å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®æ—¶ï¼Œå…¶è¡¨ç°å‡ºæ­£ç¡®çš„è¡Œä¸ºã€‚\n* æ— è®ºæ“ä½œç³»ç»Ÿå¦‚ä½•è°ƒåº¦è¿™äº›çº¿ç¨‹ï¼Œæ— è®ºè¿™äº›çº¿ç¨‹çš„æ‰§è¡Œé¡ºåºå¦‚ä½•äº¤ç»‡ã€‚\n* è°ƒç”¨ç«¯ä»£ç æ— é¡»é¢å¤–çš„åŒæ­¥æˆ–å…¶ä»–åè°ƒåŠ¨ä½œã€‚\n\nä¾æ®è¿™ä¸ªå®šä¹‰ï¼ŒC++æ ‡å‡†åº“é‡Œçš„å¤§å¤šæ•°classéƒ½ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒåŒ…æ‹¬`std::string`ã€`std::vector`ã€`std::map`ç­‰ã€‚è¿™äº›classé€šå¸¸éœ€è¦åœ¨å¤–éƒ¨åŠ é”æ‰èƒ½ä¾›å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ã€‚\n\n## ä»¥Counterä¸ºä¾‹è¯´æ˜é—®é¢˜\n\n```cpp\nclass Counter : boost::nocopyable\n{\npublic:\n    Counter() : value_(0)\n    {}\n    int64_t value() const;\n    int64_t getAndIncrease();\nprivate:\n    int64_t value_;\n    mutable MutexLock mutex_;\n    \n};\nint64_t Counter::value() const\n{\n    MutexLockGuard lock(mutex_);\n    int64_t ret = value_++;\n    return ret;\n}\n```\n\nè¿™ä¸ªclasså¾ˆç›´ç™½ï¼Œä¸€çœ‹å°±æ˜ç™½ï¼Œä¹Ÿå®¹æ˜“éªŒè¯å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚æ¯ä¸ªCounterå¯¹è±¡æœ‰è‡ªå·±çš„`mutex_`ï¼Œå› æ­¤ä¸åŒå¯¹è±¡ä¹‹é—´ä¸æ„æˆ**é”äº‰ç”¨(lock contention)**ã€‚å¦‚æœæ˜¯åŒä¸€ä¸ªCounterå¯¹è±¡åˆ™ä¸å¯åŒæ—¶è®¿é—®`value_++`ã€‚\n\næ³¨æ„åˆ°ï¼Œå…¶`mutex_`æˆå‘˜æ˜¯`mutable`çš„ï¼Œæ„å‘³ç€`const`æˆå‘˜å‡½æ•°å¦‚`Counter::value()`ä¹Ÿèƒ½ç›´æ¥ä½¿ç”¨`non-const`çš„`mutex_`ã€‚\n\nå°½ç®¡è¿™ä¸ª`Counter`æ¯«æ— ç–‘é—®æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯å¦‚æœ`Counter`æ˜¯åŠ¨æ€åˆ›å»ºçš„ï¼Œå¹¶é€šè¿‡æŒ‡é’ˆæ¥è®¿é—®ï¼Œåˆ™å¯¹è±¡é”€æ¯çš„**ç«æ€æ¡ä»¶(race condition)**ä»ç„¶å­˜åœ¨ã€‚\n\n### å½“ææ„å‡½æ•°é‡åˆ°å¤šçº¿ç¨‹\n\nä¸å…¶ä»–é¢å‘å¯¹è±¡è¯­è¨€ä¸åŒï¼ŒCppè¦æ±‚ç¨‹åºå‘˜è‡ªå·±ç®¡ç†å¯¹è±¡çš„ç”Ÿå‘½æœŸï¼Œè¿™åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ˜¾å¾—å°¤ä¸ºå›°éš¾ã€‚\n\n**å½“ä¸€ä¸ªå¯¹è±¡èƒ½è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶çœ‹åˆ°æ—¶ï¼Œé‚£ä¹ˆå¯¹è±¡çš„é”€æ¯æ—¶æœºå°±å˜å¾—æ¨¡ç³Šä¸æ¸…ï¼Œå¯èƒ½å‡ºç°å¤šç§ç«æ€æ¡ä»¶**ã€‚\n\n* åœ¨å³å°†ææ„ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä»ä½•è€ŒçŸ¥æ­¤åˆ»æ˜¯å¦æœ‰åˆ«çš„çº¿ç¨‹æ­£åœ¨æ‰§è¡Œè¯¥å¯¹è±¡çš„æˆå‘˜å‡½æ•°ï¼Ÿ\n* å¦‚ä½•ä¿è¯åœ¨æ‰§è¡Œæˆå‘˜å‡½æ•°æœŸé—´ï¼Œå¯¹è±¡ä¸ä¼šåœ¨å¦ä¸€ä¸ªçº¿ç¨‹è¢«ææ„ï¼Ÿ\n* åœ¨è°ƒç”¨æŸä¸ªå¯¹è±¡çš„æˆå‘˜å‡½æ•°ä¹‹å‰ï¼Œå¦‚ä½•å¾—çŸ¥è¿™ä¸ªå¯¹è±¡è¿˜æ´»ç€ï¼Ÿå®ƒçš„ææ„å‡½æ•°ä¼šä¸ä¼šç¢°å·§æ‰§è¡Œåˆ°ä¸€åŠï¼Ÿ\n\nè¿™äº›ç«æ€æ¡ä»¶é—®é¢˜æ˜¯C++å¤šçº¿ç¨‹ç¼–ç¨‹é¢ä¸´çš„åŸºæœ¬é—®é¢˜ã€‚\n\n# å¯¹è±¡çš„åˆ›å»º\n\nå¯¹è±¡æ„é€ è¦åšåˆ°çº¿ç¨‹å®‰å…¨ï¼Œå”¯ä¸€çš„è¦æ±‚æ˜¯åœ¨æ„é€ æœŸé—´ä¸è¦ç»™å…¶ä»–å¯¹è±¡æ³„éœ²thisæŒ‡é’ˆï¼ˆå…¶è‡ªèº«åˆ›å»ºçš„å­å¯¹è±¡é™¤å¤–ï¼‰ã€‚å³ï¼š\n\n* ä¸è¦åœ¨æ„é€ å‡½æ•°ä¸­æ³¨å†Œä»»ä½•å›è°ƒï¼›\n* ä¸è¦åœ¨æ„é€ å‡½æ•°ä¸­æŠŠthisä¼ ç»™è·¨çº¿ç¨‹çš„å¯¹è±¡ï¼›\n* å³ä¾¿åœ¨æ„é€ å‡½æ•°çš„æœ€åä¸€è¡Œä¹Ÿä¸è¡Œã€‚\n\nä¹‹æ‰€ä»¥è¿™æ ·è§„å®šï¼Œæ˜¯å› ä¸ºåœ¨æ„é€ å‡½æ•°æ‰§è¡ŒæœŸé—´ï¼Œå¯¹è±¡è¿˜æ²¡æœ‰å®Œæˆåˆå§‹åŒ–å·¥ä½œï¼Œå¦‚æœè¿™æ—¶thisæ³„éœ²ç»™äº†å…¶ä»–å¯¹è±¡ï¼ˆå…¶è‡ªèº«åˆ›å»ºçš„å­å¯¹è±¡é™¤å¤–ï¼‰ï¼Œé‚£ä¹ˆåˆ«çš„çº¿ç¨‹æœ‰å¯èƒ½è®¿é—®è¿™ä¸ªåŠæˆå“å¯¹è±¡ï¼Œè¿™ä¼šé€ æˆéš¾ä»¥é¢„æ–™çš„åæœã€‚\n\n```cpp\n#include <algorithm>\n#include <vector>\n#include <stdio.h>\n\nclass Observable;\n\nclass Observer\n{\n public:\n  virtual ~Observer();\n  virtual void update() = 0;\n\n  void observe(Observable* s);\n\n protected:\n  Observable* subject_;\n};\n\nclass Observable\n{\n public:\n  void register_(Observer* x);\n  void unregister(Observer* x);\n\n  void notifyObservers()\n  {\n    for (size_t i = 0; i < observers_.size(); ++i)\n    {\n      Observer* x = observers_[i];\n      if (x) {\n        x->update(); // (3)\n      }\n    }\n  }\n\n private:\n  std::vector<Observer*> observers_;\n};\n\nObserver::~Observer()\n{\n  subject_->unregister(this);\n}\n\nvoid Observer::observe(Observable* s)\n{\n  s->register_(this);\n  subject_ = s;\n}\n\nvoid Observable::register_(Observer* x)\n{\n  observers_.push_back(x);\n}\n\nvoid Observable::unregister(Observer* x)\n{\n  std::vector<Observer*>::iterator it = std::find(observers_.begin(), observers_.end(), x);\n  if (it != observers_.end())\n  {\n    std::swap(*it, observers_.back());\n    observers_.pop_back();\n  }\n}\n```\n\n```cpp\n/* é”™è¯¯ */\nclass Foo : public Observer\n{\npublic:\n    Foo(Observer * s)\n    {\n        s->register_(this);\n    }\n    virtual void update();\n};\n```\n\n```cpp\n/* æ­£ç¡® */\nclass Foo : public Observer\n{\npublic:\n    Foo();\n    virtual void update();\n    void observe(Observer * s)\n    {\n        s->register_(this);\n    }\n};\nFoo* pFoo = new Foo;\nObserver * s = getSubject();\npFoo->observer(s);\t//äºŒæ®µå¼æ„é€ ï¼Œæˆ–è€…ç›´æ¥å†™s->register_(pFoo);\n```\n\näºŒæ®µå¼æ„é€ â€”â€”å³æ„é€ å‡½æ•°+initialize()â€”â€”æœ‰æ—¶ä¼šæ˜¯å¥½åŠæ³•ï¼Œè¿™è™½ç„¶ä¸ç¬¦åˆC++æ•™æ¡ï¼Œä½†æ˜¯å¤šçº¿ç¨‹ä¸‹åˆ«æ— é€‰æ‹©ã€‚\n\nå¦å¤–ï¼Œæ—¢ç„¶å…è®¸äºŒæ®µå¼æ„é€ ï¼Œé‚£ä¹ˆæ„é€ å‡½æ•°ä¸å¿…ä¸»åŠ¨æŠ›å¼‚å¸¸ï¼Œè°ƒç”¨æ–¹é initialize()çš„è¿”å›å€¼æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦æ„é€ æˆåŠŸï¼Œè¿™èƒ½ç®€åŒ–é”™è¯¯å¤„ç†ã€‚\n\nå³ä½¿æ˜¯æ„é€ å‡½æ•°çš„æœ€åä¸€è¡Œï¼Œä¹Ÿä¸è¦æ³„éœ²thisæŒ‡é’ˆï¼Œå› ä¸ºFooæœ‰å¯èƒ½æ˜¯ä¸ªåŸºç±»ï¼ŒåŸºç±»å…ˆäºæ´¾ç”Ÿç±»æ„é€ ï¼Œæ‰§è¡Œå®Œ`Foo::Foo()`çš„æœ€åä¸€è¡Œä»£ç è¿˜ä¼šç»§ç»­æ‰§è¡Œæ´¾ç”Ÿç±»çš„æ„é€ å‡½æ•°ï¼Œè¿™æ—¶`most-derived class`çš„å¯¹è±¡è¿˜å¤„äºæ„é€ ä¸­ï¼Œä»ç„¶ä¸å®‰å…¨ã€‚\n\n# å¯¹è±¡çš„é”€æ¯\n\nå¯¹è±¡çš„ææ„ï¼Œåœ¨å•çº¿ç¨‹é‡Œä¸æ„æˆé—®é¢˜ï¼Œæœ€å¤šéœ€è¦æ³¨æ„é¿å…ç©ºæ‚¬æŒ‡é’ˆå’Œé‡æŒ‡é’ˆã€‚\n\nè€Œåœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­ï¼Œå­˜åœ¨äº†å¤ªå¤šçš„ç«æ€æ¡ä»¶ã€‚å¯¹**ä¸€èˆ¬æˆå‘˜å‡½æ•°**è€Œè¨€ï¼Œåšåˆ°çº¿ç¨‹å®‰å…¨çš„åŠæ³•æ˜¯è®©å®ƒä»¬é¡ºæ¬¡æ‰§è¡Œï¼Œè€Œä¸è¦å¹¶å‘æ‰§è¡Œï¼ˆå…³é”®æ˜¯ä¸è¦åŒæ—¶è¯»å†™å…±äº«çŠ¶æ€ï¼‰ï¼Œä¹Ÿå°±æ˜¯è®©æ¯ä¸ªæˆå‘˜å‡½æ•°çš„ä¸´ç•ŒåŒºä¸é‡å ã€‚è¿™æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œä¸è¿‡æœ‰ä¸€ä¸ªéšå«æ¡ä»¶æˆ–è®¸ä¸æ˜¯æ¯ä¸ªäººéƒ½èƒ½ç«‹åˆ»æƒ³åˆ°ï¼šæˆå‘˜å‡½æ•°ç”¨æ¥ä¿æŠ¤ä¸´ç•ŒåŒºçš„**äº’æ–¥å™¨æœ¬èº«å¿…é¡»æ˜¯æœ‰æ•ˆçš„ã€‚è€Œææ„å‡½æ•°ç ´åäº†è¿™ä¸€å‡è®¾ï¼Œå®ƒä¼šæŠŠmutexæˆå‘˜å˜é‡é”€æ¯æ‰**ã€‚æ‚²å‰§å•Šï¼\n\n* mutexä¸æ˜¯åŠæ³•ã€‚\n\nmutexåªèƒ½ä¿è¯å‡½æ•°ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æ‰§è¡Œï¼Œè€ƒè™‘ä¸‹é¢ä¸¤ä¸ªä»£ç ï¼ˆå¹¶è¡Œï¼‰ï¼Œå®ƒè¯•å›¾ç”¨äº’æ–¥é”æ¥ä¿æŠ¤ææ„å‡½æ•°ï¼š\n\n![image-20220425141301184](../../images/è¯»muduoæœ‰æ„Ÿ_çº¿ç¨‹å®‰å…¨çš„å¯¹è±¡ç”Ÿå‘½æœŸç®¡ç†/image-20220425141301184.png)\n\næ­¤æ—¶ï¼Œæœ‰Aã€Bä¸¤ä¸ªçº¿ç¨‹éƒ½èƒ½çœ‹åˆ°Fooå¯¹è±¡xï¼Œçº¿ç¨‹Aå³å°†é”€æ¯xï¼Œè€Œçº¿ç¨‹Bæ­£å‡†å¤‡è°ƒç”¨`x->update()`ã€‚\n\n![image-20220425141415894](../../images/è¯»muduoæœ‰æ„Ÿ_çº¿ç¨‹å®‰å…¨çš„å¯¹è±¡ç”Ÿå‘½æœŸç®¡ç†/image-20220425141415894.png)\n\nå°½ç®¡çº¿ç¨‹Aåœ¨é”€æ¯å¯¹è±¡ä¹‹åæŠŠæŒ‡é’ˆç½®ä¸ºäº†`NULL`ï¼Œå°½ç®¡çº¿ç¨‹Båœ¨è°ƒç”¨xçš„æˆå‘˜å‡½æ•°ä¹‹å‰æ£€æŸ¥äº†æŒ‡é’ˆxçš„å€¼ï¼Œä½†è¿˜æ˜¯æ— æ³•é¿å…ä¸€ç§ç«æ€æ¡ä»¶ï¼š\n\n1. çº¿ç¨‹Aæ‰§è¡Œåˆ°äº†ææ„å‡½æ•°çš„`(1)`å¤„ï¼Œå·²ç»æŒæœ‰äº†äº’æ–¥é”ï¼Œå³å°†ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚\n2. çº¿ç¨‹Bé€šè¿‡äº†`if(x)`æ£€æµ‹ï¼Œé˜»å¡åœ¨`(2)`å¤„ã€‚\n\næ¥ä¸‹æ¥ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œåªæœ‰å¤©æ™“å¾—ã€‚å› ä¸ºææ„å‡½æ•°ä¼šæŠŠ`mutex_`é”€æ¯ï¼Œé‚£ä¹ˆ`(2)`å¤„æœ‰å¯èƒ½æ°¸è¿œé˜»å¡ä¸‹å»ï¼Œæœ‰å¯èƒ½è¿›å…¥â€œä¸´ç•ŒåŒºâ€ï¼Œç„¶å`core dump`ï¼Œæˆ–è€…å‘ç”Ÿå…¶ä»–æ›´ç³Ÿç³•çš„æƒ…å†µã€‚\n\nè¿™ä¸ªä¾‹å­è‡³å°‘è¯´æ˜`delete`å¯¹è±¡ä¹‹åæŠŠæŒ‡é’ˆç½®ä¸º`NULL`æ ¹æœ¬æ²¡ç”¨ï¼Œå¦‚æœä¸€ä¸ªç¨‹åºè¦é è¿™ä¸ªæ¥é˜²æ­¢äºŒæ¬¡é‡Šæ”¾ï¼Œè¯´æ˜ä»£ç é€»è¾‘å‡ºäº†é—®é¢˜ã€‚\n\n* ä½œä¸ºæ•°æ®æˆå‘˜çš„mutexä¸èƒ½ä¿æŠ¤ææ„\n\nå‰é¢çš„ä¾‹å­è¯´æ˜ï¼Œä½œä¸ºclassæ•°æ®æˆå‘˜çš„`MutexLock`åªèƒ½ç”¨äºåŒæ­¥æœ¬classçš„å…¶ä»–æ•°æ®æˆå‘˜çš„è¯»å’Œå†™ï¼Œå®ƒä¸èƒ½ä¿æŠ¤å®‰å…¨åœ°ææ„ã€‚å› ä¸º`MutexLock`æˆå‘˜çš„ç”Ÿå‘½æœŸæœ€å¤šä¸å¯¹è±¡ä¸€æ ·é•¿ï¼Œè€Œææ„åŠ¨ä½œå¯è¯´æ˜¯å‘ç”Ÿåœ¨å¯¹è±¡æ­»äº¡ä¹‹åï¼ˆæˆ–è€…è¯´æ­»äº¡ä¹‹æ—¶ï¼‰ã€‚å¦å¤–ï¼Œå¯¹äºåŸºç±»å¯¹è±¡ï¼Œè°ƒç”¨åˆ°åŸºç±»ææ„å‡½æ•°çš„æ—¶å€™ï¼Œæ´¾ç”Ÿç±»å¯¹è±¡çš„é‚£éƒ¨åˆ†å·²ç»ææ„å®Œæ¯•äº†ï¼Œé‚£ä¹ˆåŸºç±»å¯¹è±¡æ‹¥æœ‰çš„`MutexLock`ä¸èƒ½ä¿æŠ¤æ•´ä¸ªææ„è¿‡ç¨‹ã€‚\n\nå…¶å®ï¼Œææ„è¿‡ç¨‹æœ¬æ¥ä¹Ÿä¸éœ€è¦ä¿æŠ¤ï¼Œå› ä¸ºåªæœ‰åˆ«çš„çº¿ç¨‹éƒ½è®¿é—®ä¸åˆ°è¿™ä¸ªå¯¹è±¡æ—¶ï¼Œææ„æ‰æ˜¯å®‰å…¨çš„ï¼Œå¦åˆ™ä¼šæœ‰ç«æ€æ¡ä»¶å‘ç”Ÿã€‚\n\n## æ­»é”\n\nå¦‚æœè¦åŒæ—¶è¯»å†™ä¸€ä¸ªclassçš„ä¸¤ä¸ªå¯¹è±¡ï¼Œæœ‰æ½œåœ¨çš„æ­»é”å¯èƒ½ã€‚æ¯”æ–¹è¯´æœ‰`swap()`è¿™ä¸ªå‡½æ•°ã€‚\n\n```cpp\nvoid swap(Counter & a, Counter & b)\n{\n    MutexLockGuard aLock(a.mutex_);\n    MutexLockGuard bLock(b.mutex_);\n    int64_t value = a.value_;\n    a.value_ = b.value_;\n    b.value_ = value;\n}\n```\n\nå¦‚æœçº¿ç¨‹Aæ‰§è¡Œ`swap(a, b);`è€ŒåŒæ—¶çº¿ç¨‹Bæ‰§è¡Œ`swap(b, a);`ï¼Œå°±æœ‰å¯èƒ½æ­»é”ã€‚`operator=()`ä¹Ÿæ˜¯ç±»ä¼¼çš„é“ç†ã€‚\n\n```cpp\nCounter& Counter::operator=(const Counter& rhs)\n{\n    if(this == &rhs)return *this;\n    MutexLockGuard myLock(mutex_);\n    MutexLockGuard itsLock(rhs.mutex_);\n    /* ä¸è¦å†™æˆ value_ = rhs.value()ï¼Œä¼šæ­»é”ï¼› \n     * rhs.value() --> \n     *\t\tMutexLockGuard lock(mutex_);\n     *\t\tint64_t ret = value_++;\n     *\t\treturn ret;\n     */\n    value_ = rhs.value_;\n    return *this;\n}\n```\n\nä¸€ä¸ªå‡½æ•°å¦‚æœè¦é”ä½ç›¸åŒç±»å‹çš„å¤šä¸ªå¯¹è±¡ï¼Œä¸ºäº†ä¿è¯å§‹ç»ˆæŒ‰ç›¸åŒçš„é¡ºåºåŠ é”ï¼Œæˆ‘ä»¬å¯ä»¥æ¯”è¾ƒmutexå¯¹è±¡çš„åœ°å€ï¼Œå§‹ç»ˆå…ˆåŠ é”åœ°å€è¾ƒå°çš„mutexã€‚ï¼Ÿï¼Ÿï¼Ÿ\n\n# çº¿ç¨‹å®‰å…¨çš„Observer\n\nä¸€ä¸ªåŠ¨æ€åˆ›å»ºçš„å¯¹è±¡æ˜¯å¦è¿˜æ´»ç€ï¼Œå…‰çœ‹æŒ‡é’ˆï¼ˆæˆ–å¼•ç”¨ï¼‰çœ‹ä¸å‡ºæ¥ã€‚æŒ‡é’ˆå°±æ˜¯æŒ‡å‘äº†ä¸€å—å†…å­˜ï¼Œè¿™å—å†…å­˜ä¸Šçš„å¯¹è±¡å¦‚æœå·²ç»é”€æ¯ï¼Œé‚£ä¹ˆæ ¹æœ¬å°±ä¸èƒ½è®¿é—®ï¼ˆå°±åƒ`free(3)`ä¹‹åçš„åœ°å€ä¸èƒ½è®¿é—®ä¸€æ ·ï¼‰ï¼Œæ—¢ç„¶ä¸èƒ½è®¿é—®åˆå¦‚ä½•çŸ¥é“å¯¹è±¡çš„çŠ¶æ€ï¼Ÿæ¢å¥è¯è¯´ï¼Œ**æ²¡æœ‰é«˜æ•ˆçš„åŠæ³•åˆ¤æ–­ä¸€ä¸ªæŒ‡é’ˆæ˜¯å¦æ˜¯åˆæ³•æŒ‡é’ˆï¼Œè¿™æ˜¯C/C++æŒ‡é’ˆé—®é¢˜çš„æ ¹æº**ã€‚ï¼ˆä¸‡ä¸€åŸå€åˆåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡å‘¢ï¼Ÿå†ä¸‡ä¸€è¿™ä¸ªæ–°çš„å¯¹è±¡çš„ç±»å‹å¼‚äºè€çš„å¯¹è±¡å‘¢ï¼Ÿï¼‰\n\n## å¯¹è±¡ä¹‹é—´å…³ç³»çš„ä¸‰ç§ä¸»è¦ç±»å‹\n\n`composition`ï¼ˆç»„åˆ/å¤åˆï¼‰ã€`aggregation`ï¼ˆèšåˆï¼‰ã€`association`ï¼ˆå…³è”ï¼‰ã€‚\n\n* ç»„åˆå…³ç³»\n\nç»„åˆå…³ç³»åœ¨å¤šçº¿ç¨‹é‡Œä¸ä¼šé‡åˆ°ä»€ä¹ˆéº»çƒ¦ï¼Œå› ä¸ºå¯¹è±¡xçš„ç”Ÿå‘½æœŸç”±å…¶å”¯ä¸€çš„æ‹¥æœ‰è€…owneræ§åˆ¶ï¼Œownerææ„çš„æ—¶å€™ä¼šæŠŠxä¹Ÿææ„æ‰ã€‚ä»å½¢å¼ä¸Šçœ‹ï¼Œxæ˜¯ownerçš„ç›´æ¥æ•°æ®æˆå‘˜ï¼Œæˆ–è€…`scoped_ptr/unique_ptr`æˆå‘˜ï¼ŒæŠ‘æˆ–owneræŒæœ‰çš„å®¹å™¨çš„å…ƒç´ ã€‚\n\nåä¸¤ç§å…³ç³»åœ¨C++é‡Œæ¯”è¾ƒéš¾åŠï¼Œå¤„ç†ä¸å¥½å°±ä¼šé€ æˆå†…å­˜æ³„éœ²æˆ–è€…é‡å¤é‡Šæ”¾ã€‚\n\n* å…³è”å…³ç³»\n\nå…³è”æ˜¯ä¸€ç§å¾ˆå®½æ³›çš„å…³ç³»ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªå¯¹è±¡aç”¨åˆ°äº†å¦ä¸€ä¸ªå¯¹è±¡bï¼Œè°ƒç”¨äº†åè€…çš„æˆå‘˜å‡½æ•°ã€‚ä»ä»£ç å½¢å¼ä¸Šçœ‹ï¼Œ**aæŒæœ‰bçš„æŒ‡é’ˆæˆ–å¼•ç”¨ï¼Œä½†æ˜¯bçš„ç”Ÿå‘½æœŸä¸ç”±aå•ç‹¬æ§åˆ¶**ã€‚\n\n* èšåˆå…³ç³»\n\nèšåˆå…³ç³»ä»å½¢å¼ä¸Šçœ‹ä¸å…³è”å…³ç³»ç›¸åŒï¼Œé™¤äº†aå’Œbæœ‰é€»è¾‘ä¸Šçš„æ•´ä½“ä¸éƒ¨åˆ†çš„å…³ç³»ã€‚å¦‚æœbæ˜¯åŠ¨æ€åˆ›å»ºçš„å¹¶åœ¨æ•´ä¸ªç¨‹åºç»“æŸå‰æœ‰å¯èƒ½è¢«é‡Šæ”¾ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°å‰æ–‡æåˆ°çš„ç«æ€æ¡ä»¶ã€‚\n\n## å¦‚ä½•é¿å…è®¿é—®å¤±æ•ˆå¯¹è±¡\n\nä¼¼ä¹æœ‰ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ³•ï¼šåªåˆ›å»ºä¸é”€æ¯ã€‚ç¨‹åºä½¿ç”¨ä¸€ä¸ªå¯¹è±¡æ± æ¥æš‚å­˜ç”¨è¿‡çš„å¯¹è±¡ï¼Œä¸‹æ¬¡ç”³è¯·æ–°å¯¹è±¡æ—¶ï¼Œå¦‚æœå¯¹è±¡æ± é‡Œæœ‰å­˜è´§å°±æ‹¿ä¸€ä¸ªåˆ©ç”¨ï¼Œå¦åˆ™å°±æ–°å»ºä¸€ä¸ªï¼›å¯¹è±¡ç”¨å®Œä¹‹åä¸æ˜¯ç›´æ¥é‡Šæ”¾æ‰è€Œæ˜¯æ”¾å›æ± å­é‡Œã€‚è¿™ä¸ªåŠæ³•è™½ç„¶æœ‰å¾ˆå¤šç¼ºç‚¹ï¼Œä½†æ˜¯å´èƒ½é¿å…è®¿é—®å¤±æ•ˆå¯¹è±¡çš„æƒ…å†µå‘ç”Ÿã€‚\n\nç¼ºç‚¹å’Œé—®é¢˜ï¼š\n\n* å¯¹è±¡æ± çš„çº¿ç¨‹å®‰å…¨ï¼Œå¦‚ä½•å®‰å…¨åœ°ã€å®Œæ•´åœ°æŠŠå¯¹è±¡æ”¾å›æ± å­é‡Œï¼Œé˜²æ­¢å‡ºç°â€œéƒ¨åˆ†æ”¾å›â€çš„ç«æ€ï¼Ÿï¼ˆçº¿ç¨‹Aä»»åŠ¡å¯¹è±¡xå·²ç»æ”¾å›äº†ï¼Œè€Œçº¿ç¨‹Bä»¥ä¸ºå¯¹è±¡xè¿˜æ´»ç€ã€‚ï¼‰\n* å…¨å±€å…±äº«æ•°æ®å¼•å‘çš„lock contentionï¼Œè¿™ä¸ªé›†ä¸­åŒ–çš„å¯¹è±¡æ± å¯èƒ½ä¼šæŠŠå¤šçº¿ç¨‹å¹¶å‘æ“ä½œé€€åŒ–ä¸ºä¸²è¡Œã€‚\n* å¦‚æœå…±äº«å¯¹è±¡çš„ç±»å‹ä¸æ­¢ä¸€ç§ï¼Œé‚£ä¹ˆæ˜¯é‡å¤å®ç°å¯¹è±¡æ± è¿˜æ˜¯ä½¿ç”¨ç±»æ¨¡æ¿å‘¢ï¼Ÿ\n* ä¼šä¸ä¼šé€ æˆå†…å­˜æ³„æ¼ä¸åˆ†ç‰‡ï¼Ÿå› ä¸ºå¯¹è±¡æ± å ç”¨çš„å†…å­˜åªå¢ä¸å‡ï¼Œè€Œä¸”å¤šä¸ªå¯¹è±¡æ± ä¸èƒ½å…±äº«å†…å­˜ã€‚\n\n## Observeræ¨¡å¼\n\nå›åˆ°æ­£é¢˜ä¸Šæ¥ï¼Œå¦‚æœå¯¹è±¡xæ³¨å†Œäº†ä»»ä½•éé™æ€æˆå‘˜å‡½æ•°å›è°ƒï¼Œé‚£ä¹ˆå¿…ç„¶åœ¨æŸå¤„æŒæœ‰äº†æŒ‡å‘xçš„æŒ‡é’ˆï¼Œè¿™å°±æš´éœ²åœ¨äº†ç«æ€æ¡ä»¶ä¸‹ã€‚\n\nä¸€ä¸ªå…¸å‹çš„åœºæ™¯æ˜¯Observeræ¨¡å¼ã€‚\n\n```cpp\n/* è§‚å¯Ÿè€… */\nclass Observer //: boost::noncopyable\n{\npublic:\n    virtual ~Observer();\n    virtual void update() = 0;\n    /* ... */\n};\n/* è§‚å¯Ÿç›®æ ‡ */\nclass Observable //: boost::noncopyable\n{\npublic:\n    void register_(Observer * x);\t//å› ä¸ºå’Œå…³é”®å­—å†²çªäº†ï¼Œæ‰€ä»¥åŠ ä¸ª_\n    void unregister(Observer * x);\n    void notifyObservers()\n    {\n        for(Observer * x : observers_)\n        {\n            x->update();\n        }\n    }\nprivate:\n    std::vector<Observer*> observers_;\n}\n```\n\nå½“Observableé€šçŸ¥æ¯ä¸€ä¸ªObserveræ—¶ï¼ˆ`x->update();`ï¼‰ï¼Œå®ƒä»ä½•å¾—çŸ¥Observerå¯¹è±¡xè¿˜æ´»ç€ï¼Ÿè¦ä¸è¯•è¯•åœ¨Observerçš„ææ„å‡½æ•°é‡Œè°ƒç”¨`unregister()`æ¥è§£æ³¨å†Œï¼Ÿæéš¾å¥æ•ˆã€‚\n\n```cpp\nclass Observer //: boost::noncopyable\n{\npublic:\n    // åŒå‰\n    void observe(Observable * s)\n    {\n        s->register_(this);\n        subject_ = s;\n    }\n    virtual ~Observer()\n    {\n        subject_->unregister(this);\n    }\n    Observable* subject_;\n    /* ... */\n};\n```\n\næˆ‘ä»¬è¯•ç€è®©Observerçš„ææ„å‡½æ•°å»è°ƒç”¨`unregister(this)`ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªç«æ€æ¡ä»¶ã€‚å…¶ä¸€ï¼š`subject_->unregister(this)`ä¸­å¦‚ä½•å¾—çŸ¥`subject_`è¿˜æ´»ç€ï¼Ÿå…¶äºŒï¼šå°±ç®—`subject_`æŒ‡å‘æŸä¸ªæ°¸ä¹…å­˜åœ¨çš„å¯¹è±¡ï¼Œé‚£ä¹ˆè¿˜æ˜¯é™©è±¡ç¯ç”Ÿï¼š\n\n1. çº¿ç¨‹Aæ‰§è¡Œåˆ°`subject_->unregister(this)`ä¹‹å‰ï¼Œè¿˜æ²¡æœ‰æ¥å¾—åŠ`unregister`æœ¬å¯¹è±¡ã€‚\n2. çº¿ç¨‹Bæ‰§è¡Œåˆ°`x->update();`ï¼Œxæ­£å¥½æŒ‡å‘æ˜¯`subject_->unregister(this)`æ­£åœ¨ææ„çš„å¯¹è±¡ã€‚\n\nè¿™æ—¶æ‚²å‰§åˆå‘ç”Ÿäº†ï¼Œæ—¢ç„¶xæ‰€æŒ‡çš„Observerå¯¹è±¡æ­£åœ¨ææ„ï¼Œè°ƒç”¨å®ƒçš„ä»»ä½•éé™æ€æˆå‘˜å‡½æ•°éƒ½æ˜¯ä¸å®‰å…¨çš„ï¼Œä½•å†µæ˜¯è™šå‡½æ•°ï¼ˆC++æ ‡å‡†å¯¹åœ¨æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ä¸­è°ƒç”¨è™šå‡½æ•°çš„è¡Œä¸ºæœ‰æ˜ç¡®è§„å®šï¼Œä½†æ˜¯æ²¡æœ‰è€ƒè™‘å¹¶å‘è°ƒç”¨çš„æƒ…å†µã€‚ï¼‰ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼ŒObserveræ˜¯ä¸ªåŸºç±»ï¼Œæ‰§è¡Œåˆ°`subject_->unregister(this)`æ—¶ï¼Œæ´¾ç”Ÿç±»å¯¹è±¡å·²ç»ææ„æ‰äº†ï¼Œè¿™æ—¶å€™æ•´ä¸ªå¯¹è±¡å¤„äºå°†æ­»æœªæ­»çš„çŠ¶æ€ï¼Œ`core dump`ææ€•æ˜¯æœ€å¹¸è¿çš„ç»“æœã€‚\n\nè¿™äº›ç«æ€æ¡ä»¶ä¼¼ä¹å¯ä»¥é€šè¿‡åŠ é”æ¥è§£å†³ï¼Œä½†åœ¨å“ªå„¿åŠ é”ï¼Ÿè°æŒæœ‰è¿™äº›äº’æ–¥é”ï¼Ÿä¼¼ä¹ä¸æ˜¯é‚£ä¹ˆæ˜¾è€Œæ˜“è§ã€‚è¦æ˜¯æœ‰ä¸€ä¸ªæ´»ç€çš„å¯¹è±¡èƒ½å¸®å¸®æˆ‘ä»¬å°±å¥½äº†ï¼Œè¿™ä¸ªå¯¹è±¡éœ€è¦æä¾›ä¸€ä¸ª`isAlive()`ä¹‹ç±»çš„ç¨‹åºå‡½æ•°ï¼Œå‘Šè¯‰æˆ‘ä»¬æŸä¸ªå¯¹è±¡è¿˜åœ¨ä¸åœ¨ã€‚å¯æƒœæŒ‡é’ˆå’Œå¼•ç”¨éƒ½ä¸æ˜¯å¯¹è±¡ï¼Œå®ƒä»¬æ˜¯å†…å»ºç±»å‹ã€‚ï¼ˆè¿™æ—¶å€™å°±è¦å¼•å‡ºæ¥æ™ºèƒ½æŒ‡é’ˆäº†ï¼‰\n\n## ä¸è¦ä½¿ç”¨åŸå§‹æŒ‡é’ˆ\n\næŒ‡å‘å¯¹è±¡çš„åŸå§‹æŒ‡é’ˆ(raw pointer)æ˜¯åçš„ï¼Œå°¤å…¶å½“æš´éœ²ç»™åˆ«çš„çº¿ç¨‹æ—¶ã€‚Observableåº”å½“ä¿å­˜çš„ä¸æ˜¯åŸå§‹çš„`Observer*`ï¼Œè€Œæ˜¯ä¸€ä¸ªèƒ½å¤Ÿåˆ†è¾¨Observerå¯¹è±¡æ˜¯å¦å­˜æ´»çš„ä¸œè¥¿ã€‚ç±»ä¼¼åœ°ï¼Œå¦‚æœObserverè¦åœ¨ææ„å‡½æ•°é‡Œè§£æ³¨å†Œï¼ˆè¿™è™½ç„¶ä¸èƒ½è§£å†³å‰é¢æåˆ°çš„ç«æ€æ¡ä»¶ï¼Œä½†æ˜¯åœ¨ææ„å‡½æ•°ä¸­æ‰“æ‰«æˆ˜åœºè¿˜æ˜¯åº”è¯¥çš„ï¼‰ï¼Œé‚£ä¹ˆ`subject_`çš„ç±»å‹ä¹Ÿä¸èƒ½æ˜¯åŸå§‹çš„`Observable*`ï¼ˆå› ä¸ºè§£æ³¨å†Œç”¨åˆ°äº†`Obervable`ï¼Œå®ƒçš„`unregister`æˆå‘˜å‡½æ•°ï¼‰ã€‚\n\nå¯ä»¥**ä½¿ç”¨å¼•ç”¨è®¡æ•°å‹æ™ºèƒ½æŒ‡é’ˆ**ï¼Œå³`shared_ptr`ã€‚ç”¨ä¸€å±‚é—´æ¥æ€§ï¼ˆäºŒçº§æŒ‡é’ˆï¼‰ä¿è¯äº†é¿å…é‡Šæ”¾ç©ºæ‚¬æŒ‡é’ˆï¼Œä¹Ÿé€šè¿‡å¼•ç”¨è®¡æ•°è§£å†³äº†é‡Šæ”¾å¯¹è±¡æœŸé—´çš„ç«æ€æ¡ä»¶é—®é¢˜ã€‚\n\n## ä¸€ä¸ªä¸‡èƒ½çš„è§£å†³æ–¹æ¡ˆ\n\nå¼•å¦‚å¦å¤–ä¸€å±‚é—´æ¥æ€§ï¼Œç”¨å¯¹è±¡æ¥ç®¡ç†å…±äº«èµ„æºï¼Œäº¦å³`handle/body`æƒ¯ç”¨æŠ€æ³•ã€‚ç”¨æ ‡å‡†åº“ä¸­çš„ä¸€å¯¹â€œç¥å…µåˆ©å™¨â€å¯åŠ©æˆ‘ä»¬å®Œç¾è§£å†³åŸå§‹æŒ‡é’ˆçš„é—®é¢˜ã€‚\n\nå³`share_ptr`+`weak_ptr`ã€‚\n\n* `shared_ptr`æ§åˆ¶å¯¹è±¡çš„ç”Ÿå‘½æœŸã€‚\n  * `shared_ptr`æ˜¯å¼ºå¼•ç”¨(æƒ³è±¡æˆç”¨é“ä¸ç»‘ä½å †ä¸Šçš„å¯¹è±¡)ï¼Œåªè¦æœ‰ä¸€ä¸ªæŒ‡å‘xå¯¹è±¡çš„`shared_ptr`å­˜åœ¨ï¼Œè¯¥xå¯¹è±¡å°±ä¸ä¼šææ„ã€‚\n  * å½“æŒ‡å‘å¯¹è±¡xçš„æœ€åä¸€ä¸ª`shared_ptr`ææ„æˆ–`reset()`çš„æ—¶å€™ï¼Œxä¿è¯ä¼šè¢«é”€æ¯ã€‚\n* `weak_ptr`ä¸æ§åˆ¶å¯¹è±¡çš„ç”Ÿå‘½æœŸï¼Œä½†æ˜¯å®ƒçŸ¥é“å¯¹è±¡æ˜¯å¦è¿˜æ´»ç€(æƒ³è±¡æˆç”¨æ£‰çº¿è½»è½»æ‹´ä½å †ä¸Šçš„å¯¹è±¡)ã€‚\n  * å¦‚æœå¯¹è±¡è¿˜æ´»ç€,é‚£ä¹ˆå®ƒå¯ä»¥æå‡ä¸ºæœ‰æ•ˆçš„`shared_ptr`ï¼›\n  * å¦‚æœå¯¹è±¡å·²ç»æ­»äº†ï¼Œæå‡ä¼šå¤±è´¥ï¼Œè¿”å›ä¸€ä¸ªç©ºçš„`shared_ptr`ã€‚æå‡`lock()`è¡Œä¸ºæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚\n* `shared_ptr`/`weak_ptr`çš„â€œè®¡æ•°â€åœ¨ä¸»æµå¹³å°ä¸Šæ˜¯åŸå­æ“ä½œï¼Œæ²¡æœ‰ç”¨é”ï¼Œæ€§èƒ½ä¸ä¿—ã€‚\n* `shared_ptr`/`weak_ptr`çš„çº¿ç¨‹å®‰å…¨çº§åˆ«ä¸`std::string`å’ŒSTLå®¹å™¨ä¸€æ ·ã€‚\n\nå­Ÿå²©åœ¨ã€Šåƒåœ¾æ”¶é›†æœºåˆ¶æ‰¹åˆ¤ã€‹ä¸­ä¸€é’ˆè§è¡€åœ°ç‚¹å‡ºæ™ºèƒ½æŒ‡é’ˆçš„ä¼˜åŠ¿ï¼šâ€œC++åˆ©ç”¨æ™ºèƒ½æŒ‡é’ˆè¾¾æˆçš„æ•ˆæœæ˜¯ï¼šä¸€æ—¦æŸå¯¹è±¡ä¸å†è¢«å¼•ç”¨ï¼Œç³»ç»Ÿåˆ»ä¸å®¹ç¼“ï¼Œç«‹åˆ»å›æ”¶å†…å­˜ã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨å…³é”®ä»»åŠ¡å®Œæˆåçš„æ¸…ç†æ—¶æœŸï¼Œä¸ä¼šå½±å“å…³é”®ä»»åŠ¡çš„å®æ—¶æ€§ï¼ŒåŒæ—¶ï¼Œå†…å­˜é‡Œæ‰€æœ‰çš„å¯¹è±¡éƒ½æ˜¯æœ‰ç”¨çš„ï¼Œç»å¯¹æ²¡æœ‰åƒåœ¾ç©ºå å†…å­˜ã€‚â€\n\n# C++çš„å†…å­˜é—®é¢˜å¾ˆå®¹æ˜“è§£å†³\n\nC++é‡Œå¯èƒ½å‡ºç°çš„å†…å­˜é—®é¢˜å¤§è‡´æœ‰è¿™ä¹ˆå‡ ä¸ªæ–¹é¢ï¼š\n\n1. ç¼“å†²åŒºæº¢å‡º(buffer overrun)\n2. ç©ºæ‚¬æŒ‡é’ˆ/é‡æŒ‡é’ˆ\n3. é‡å¤é‡Šæ”¾(double delete)\n4. å†…å­˜æ³„æ¼(memory leak)\n5. ä¸é…å¯¹çš„`new[]/delete`\n6. å†…å­˜ç¢ç‰‡(memory fragmentation)\n\nåœ¨è¿™å‡ ç§é”™è¯¯é‡Œè¾¹ï¼Œå†…å­˜æ³„æ¼çš„å±å®³ç›¸å¯¹è¾ƒå°ï¼Œå› ä¸ºå®ƒåªæ˜¯å€Ÿäº†ä¸œè¥¿ä¸è¿˜ï¼Œç¨‹åºåŠŸèƒ½åœ¨ä¸€æ®µæ—¶é—´å†…è¿˜ç®—æ­£å¸¸ï¼›è€Œå…¶ä»–å¦‚ç¼“å†²åŒºæº¢å‡ºæˆ–é‡å¤é‡Šæ”¾ç­‰è‡´å‘½é”™è¯¯å¯èƒ½ä¼šé€ æˆå®‰å…¨æ€§(securityå’Œdata safety)æ–¹é¢çš„ä¸¥é‡åæœã€‚\n\næ­£ç¡®ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆèƒ½å¾ˆè½»æ˜“åœ°è§£å†³å‰é¢5ä¸ªé—®é¢˜ã€‚è§£å†³ç¬¬6ä¸ªé—®é¢˜â€”â€”å†…å­˜ç¢ç‰‡éœ€è¦åˆ«çš„æ€è·¯ã€‚\n\n* ç¼“å†²åŒºæº¢å‡º\n  * ç”¨`std::vector<char>/std::string`æˆ–è‡ªå·±ç¼–å†™`Buffer class`æ¥ç®¡ç†ç¼“å†²åŒºï¼Œè‡ªåŠ¨è®°ä½ç”¨ç¼“å†²åŒºçš„é•¿åº¦ï¼Œå¹¶é€šè¿‡æˆå‘˜å‡½æ•°è€Œä¸æ˜¯è£¸æŒ‡é’ˆæ¥ä¿®æ”¹ç¼“å†²åŒºã€‚\n* ç©ºæ‚¬æŒ‡é’ˆ/é‡æŒ‡é’ˆ\n  * ç”¨`shared_ptr/weak_ptr`\n* é‡å¤é‡Šæ”¾\n  * ç”¨`scoped_ptr`ï¼Œåªåœ¨å¯¹è±¡ææ„çš„æ—¶å€™é‡Šæ”¾ä¸€æ¬¡ã€‚\n* å†…å­˜æ³„æ¼\n  * ç”¨`scoped_ptr`ï¼Œå¯¹è±¡ææ„çš„æ—¶å€™è‡ªåŠ¨é‡Šæ”¾å†…å­˜ã€‚\n* ä¸é…å¯¹çš„`new[]/delete`\n  * æŠŠ`new[]`ç»Ÿç»Ÿæ›¿æ¢ä¸º`std::vector/scoped_array`ã€‚\n\næ³¨æ„ï¼š`scoped_ptr`ã€`shared_ptr`ã€`weak_ptr`éƒ½æ˜¯å€¼è¯­ä¹‰ã€‚è¦ä¹ˆæ˜¯æ ˆä¸Šå¯¹è±¡ï¼Œæˆ–æ˜¯å…¶ä»–å¯¹è±¡çš„ç›´æ¥æ•°æ®æˆå‘˜ï¼Œæˆ–æ˜¯æ ‡å‡†åº“å®¹å™¨é‡Œçš„å…ƒç´ ï¼Œå³ä¸ä¼šå‡ºç°ä¸‹é¢è¿™ç§å½¢å¼ï¼š`shared_ptr<Foo>* pFoo = new shared_ptr<Foo>(new Foo);`\n\nç°ä»£çš„C++ç¨‹åºä¸­ä¸€èˆ¬ä¸è¦å‡ºç°deleteè¯­å¥ï¼Œèµ„æºï¼ˆåŒ…æ‹¬å¤æ‚å¯¹è±¡æœ¬èº«ï¼‰éƒ½è¦é€šè¿‡å¯¹è±¡ï¼ˆæ™ºèƒ½æŒ‡é’ˆæˆ–å®¹å™¨ï¼‰æ¥ç®¡ç†ï¼Œä¸è¦è®©ç¨‹åºå‘˜è¿˜è¦ä¸ºæ­¤æ“å¿ƒã€‚\n\n# åº”ç”¨åˆ°Observerä¸Š\n\nObserveræ¨¡å¼çš„ç«æ€æ¡ä»¶çš„æ ¸å¿ƒé—®é¢˜æ˜¯è¢«è§‚å¯Ÿè€…å¦‚ä½•æ¢æŸ¥è§‚å¯Ÿè€…çš„ç”Ÿæ­»ï¼Œå¯ä»¥é€šè¿‡`weak_ptr`è§£å†³ï¼Œåªè¦è®©`Observable`ä¿å­˜`weak_ptr<Observer>`å³å¯ã€‚\n\n```cpp\nclass Observable\n{\npublic:\n    void register_(weak_ptr<Observer x);\t//å‚æ•°ç±»å‹å¯ç”¨const weak_ptr<Observer>&\n    // void unregister(weak_ptr<Observer> x);\t//ä¸éœ€è¦äº†ï¼Œå·²ç»æœ‰ä¸‹è¾¹çš„ä»£ç å¸®æˆ‘ä»¬è§£å†³æŠŠå¤±æ•ˆè§‚å¯Ÿè€…ä»observers_ä¸­åˆ é™¤äº†ã€‚ç›¸åº”åœ°ï¼ŒObserverçš„ææ„å‡½æ•°ä¹Ÿä¸ç”¨è°ƒç”¨Observableçš„unregisteräº†ã€‚\n    void notifyObservers();\nprivate:\n    mutable MutexLock mutex_;\n    std::vector<weak_ptr<Observer>> observers_;\n    using Iterator = std::vector<weak_ptr<Observer>>::iterator;\n};\nvoid Observable::notifyObservers()\n{\n    MutexLockGuard lock(mutex_);\n    Iterator it = observers_.begin();\n    while(it != observers_.end())\n    {\n        shared_ptr<Observer> obj(it->lock());\t//weak_ptrçš„lockå‡½æ•°ï¼Œå°è¯•æå‡ä¸ºshared_ptrï¼Œè¿™ä¸€æ­¥æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚\n        if(obj)\n        {\n            obj->update();\t//æ²¡æœ‰ç«æ€æ¡ä»¶ï¼Œå› ä¸ºobjåœ¨æ ˆä¸Šï¼Œå¯¹è±¡ä¸å¯èƒ½åœ¨æœ¬ä½œç”¨åŸŸå†…é”€æ¯ã€‚\n            ++it;\n        }\n        else\n        {\n            // è§‚å¯Ÿè€…å¯¹è±¡å·²ç»é”€æ¯ï¼Œä»å®¹å™¨ä¸­åˆ é™¤weak_ptrï¼Œå³åšäº†unregisterçš„å·¥ä½œã€‚\n            it = observers_.erase(it);\n        }\n    }\n}\n```\n\nç»è¿‡æŠŠ`Observer*`æ›¿æ¢ä¸º`weak_ptr<Observer>`ï¼Œéƒ¨åˆ†è§£å†³äº†`Observer`æ¨¡å¼çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä½†è¿˜æœ‰ä»¥ä¸‹ç–‘ç‚¹ã€‚\n\n* ä¾µå…¥æ€§\n  * å¼ºåˆ¶è¦æ±‚`Observer`å¿…é¡»ä»¥`shared_ptr`æ¥ç®¡ç†\n* ä¸æ˜¯å®Œå…¨çº¿ç¨‹å®‰å…¨\n* é”äº‰ç”¨(lock contention)\n  * å³`Observable`çš„ä¸‰ä¸ªæˆå‘˜å‡½æ•°éƒ½ç”¨äº†äº’æ–¥å™¨æ¥åŒæ­¥ï¼Œè¿™ä¼šé€ æˆ`register_`\n","categories":["æ“ä½œç³»ç»Ÿ","å¤šçº¿ç¨‹","Cpp","è®¾è®¡æ¨¡å¼"]},{"title":"è§‚å¯Ÿè€…æ¨¡å¼","url":"/è®¾è®¡æ¨¡å¼/è§‚å¯Ÿè€…æ¨¡å¼/","content":"\n# å†…å®¹\n\n1. è¡Œä¸ºå‹æ¨¡å¼\n2. è§‚å¯Ÿè€…æ¨¡å¼\n\n* è¡Œä¸ºå‹æ¨¡å¼\n  * å…³æ³¨ç³»ç»Ÿä¸­å¯¹è±¡ä¹‹é—´çš„ç›¸äº’äº¤äº’ï¼Œç ”ç©¶è¿è¡Œæ—¶å¯¹è±¡ä¹‹é—´çš„äº’ç›¸é€šä¿¡å’Œåä½œï¼Œæ˜ç¡®å¯¹è±¡èŒè´£ã€‚\n\n# è§‚å¯Ÿè€…æ¨¡å¼\n\n* æ¨¡å¼åŠ¨æœºï¼šå»ºç«‹ä¸€å¥—ä½è€¦åˆçš„æ¶ˆæ¯è§¦å‘æœºåˆ¶ã€‚\n\nå»ºç«‹ä¸€ç§å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œä¸€ä¸ªå¯¹è±¡å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå°†è‡ªåŠ¨é€šçŸ¥å…¶ä»–å¯¹è±¡ï¼Œå…¶ä»–å¯¹è±¡å°†ç›¸åº”åšå‡ºååº”ã€‚åœ¨æ­¤ï¼Œå‘ç”Ÿæ”¹å˜çš„å¯¹è±¡ç§°ä¸ºè§‚å¯Ÿç›®æ ‡ï¼Œè¢«é€šçŸ¥çš„å¯¹è±¡æˆä¸ºè§‚å¯Ÿè€…ï¼Œä¸€ä¸ªè§‚å¯Ÿç›®æ ‡å¯ä»¥å¯¹åº”å¤šä¸ªè§‚å¯Ÿè€…ï¼Œè€Œä¸”è¿™äº›è§‚å¯Ÿè€…ä¹‹é—´æ²¡æœ‰ç›¸äº’è”ç³»ï¼Œå¯ä»¥æ ¹æ®éœ€è¦å¢åŠ å’Œåˆ é™¤è§‚å¯Ÿè€…ï¼Œä½¿å¾—ç³»ç»Ÿæ›´æ˜“äºæ‰©å±•ï¼Œè¿™å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼çš„æ¨¡å¼åŠ¨æœºã€‚\n\n* è§‚å¯Ÿè€…æ¨¡å¼æ¦‚è¿°\n\nè§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚\n\nå»ºç«‹å¯¹è±¡é—´ä¸€å¯¹å¤šçš„å…³è”å…³ç³»ï¼Œå¹¶èƒ½ä½¿ä¸€ä¸ªå¯¹è±¡çš„å˜åŒ–è¢«æ‰€æœ‰å…³è”å¯¹è±¡æ„ŸçŸ¥ã€‚\n\n* å®šä¹‰\n\nè§‚å¯Ÿè€…æ¨¡å¼(Observer Pattern)ï¼šå®šä¹‰å¯¹è±¡ä¹‹é—´çš„ä¸€ç§ä¸€å¯¹å¤šä¾èµ–å…³ç³»ï¼Œä½¿å¾—æ¯å½“ä¸€ä¸ªå¯¹è±¡çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå…¶ç›¸å…³ä¾èµ–å¯¹è±¡çš†å¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°ã€‚è§‚å¯Ÿè€…æ¨¡å¼çš„åˆ«ååŒ…æ‹¬**å‘å¸ƒ-è®¢é˜…(Publish/Subscribe)æ¨¡å¼**ã€**æ¨¡å‹-è§†å›¾(Model/View)æ¨¡å¼**ã€**æº-ç›‘å¬å™¨(Source/Listenerï¼‰æ¨¡å¼**æˆ–**ä»å±è€…(Dependents)æ¨¡å¼**ã€‚\n\nè§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡è¡Œä¸ºå‹æ¨¡å¼ã€‚\n\n## ç±»ä¹‹é—´çš„å…³ç³»\n\nè§‚å¯Ÿè€…æ¨¡å¼ç»“æ„ä¸­é€šå¸¸åŒ…æ‹¬è§‚å¯Ÿç›®æ ‡å’Œè§‚å¯Ÿè€…ä¸¤ä¸ªç»§æ‰¿å±‚æ¬¡ç»“æ„ï¼Œå…¶ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼š\n\n![image-20220425091749152](../../images/è§‚å¯Ÿè€…æ¨¡å¼/image-20220425091749152.png)\n\n  åœ¨è§‚å¯Ÿè€…æ¨¡å¼ç»“æ„å›¾ä¸­åŒ…å«å¦‚ä¸‹å‡ ä¸ªè§’è‰²ï¼š\n\n* **Subjectï¼ˆç›®æ ‡ï¼‰**ï¼š**ç›®æ ‡**åˆç§°ä¸º**ä¸»é¢˜**ï¼Œå®ƒæ˜¯æŒ‡**è¢«è§‚å¯Ÿçš„å¯¹è±¡**ã€‚\n  * åœ¨ç›®æ ‡ä¸­å®šä¹‰äº†ä¸€ä¸ªè§‚å¯Ÿè€…é›†åˆï¼Œä¸€ä¸ªè§‚å¯Ÿç›®æ ‡å¯ä»¥æ¥å—ä»»æ„æ•°é‡çš„è§‚å¯Ÿè€…æ¥è§‚å¯Ÿï¼Œå®ƒæä¾›ä¸€ç³»åˆ—æ–¹æ³•æ¥å¢åŠ å’Œåˆ é™¤è§‚å¯Ÿè€…å¯¹è±¡ï¼Œå¦‚`attach(ObServer*)`ï¼Œ`detach(Observer*)`ã€‚\n  * åŒæ—¶å®ƒå®šä¹‰äº†é€šçŸ¥æ–¹æ³•notify()ã€‚ç›®æ ‡ç±»å¯ä»¥æ˜¯æ¥å£ï¼Œä¹Ÿå¯ä»¥æ˜¯æŠ½è±¡ç±»æˆ–å…·ä½“ç±»ã€‚\n* **ConcreteSubjectï¼ˆå…·ä½“ç›®æ ‡ï¼‰**ï¼šå…·ä½“ç›®æ ‡æ˜¯ç›®æ ‡ç±»çš„å­ç±»ã€‚å¦‚æœæ— é¡»æ‰©å±•ç›®æ ‡ç±»ï¼Œåˆ™å…·ä½“ç›®æ ‡ç±»å¯ä»¥çœç•¥ã€‚\n  * é€šå¸¸å®ƒåŒ…å«æœ‰ç»å¸¸å‘ç”Ÿæ”¹å˜çš„æ•°æ®ï¼Œå½“å®ƒçš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå‘å®ƒçš„å„ä¸ªè§‚å¯Ÿè€…å‘å‡ºé€šçŸ¥ï¼›\n  * åŒæ—¶å®ƒè¿˜å®ç°äº†åœ¨ç›®æ ‡ç±»ä¸­å®šä¹‰çš„æŠ½è±¡ä¸šåŠ¡é€»è¾‘æ–¹æ³•ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚\n* **Observerï¼ˆè§‚å¯Ÿè€…ï¼‰**ï¼šè§‚å¯Ÿè€…å°†å¯¹è§‚å¯Ÿç›®æ ‡çš„æ”¹å˜åšå‡ºååº”ï¼Œè§‚å¯Ÿè€…ä¸€èˆ¬å®šä¹‰ä¸ºæ¥å£ã€‚\n  * è¯¥æ¥å£å£°æ˜äº†æ›´æ–°æ•°æ®çš„æ–¹æ³•update()ï¼Œå› æ­¤åˆç§°ä¸ºæŠ½è±¡è§‚å¯Ÿè€…ã€‚\n* **ConcreteObserverï¼ˆå…·ä½“è§‚å¯Ÿè€…ï¼‰**ï¼šåœ¨å…·ä½“è§‚å¯Ÿè€…ä¸­ç»´æŠ¤ä¸€ä¸ªæŒ‡å‘å…·ä½“ç›®æ ‡å¯¹è±¡çš„å¼•ç”¨ï¼Œå®ƒå­˜å‚¨å…·ä½“è§‚å¯Ÿè€…çš„æœ‰å…³çŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€éœ€è¦å’Œå…·ä½“ç›®æ ‡çš„çŠ¶æ€ä¿æŒä¸€è‡´ï¼›å®ƒå®ç°äº†åœ¨æŠ½è±¡è§‚å¯Ÿè€…Observerä¸­å®šä¹‰çš„update()æ–¹æ³•ã€‚\n  * é€šå¸¸åœ¨å®ç°æ—¶ï¼Œå¯ä»¥è°ƒç”¨å…·ä½“ç›®æ ‡ç±»çš„attach()æ–¹æ³•å°†è‡ªå·±æ·»åŠ åˆ°ç›®æ ‡ç±»çš„é›†åˆä¸­æˆ–é€šè¿‡detach()æ–¹æ³•å°†è‡ªå·±ä»ç›®æ ‡ç±»çš„é›†åˆä¸­åˆ é™¤ã€‚\n\n## ä»£ç ç¤ºä¾‹\n\n* è§‚å¯Ÿç›®æ ‡\n\nä¸‹é¢é€šè¿‡ç¤ºæ„ä»£ç æ¥å¯¹è¯¥æ¨¡å¼è¿›è¡Œè¿›ä¸€æ­¥åˆ†æã€‚é¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæŠ½è±¡ç›®æ ‡Subjectï¼Œå…¸å‹ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\nimport java.util.*;\nabstract class Subject\n{\n    //å®šä¹‰ä¸€ä¸ªè§‚å¯Ÿè€…é›†åˆç”¨äºå­˜å‚¨æ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡\n    protected ArrayList observers<Observer> = new ArrayList();\n    \n    //æ³¨å†Œæ–¹æ³•ï¼Œç”¨äºå‘è§‚å¯Ÿè€…é›†åˆä¸­å¢åŠ ä¸€ä¸ªè§‚å¯Ÿè€…\n\tpublic void attach(Observer observer)\n    {\n    \tobservers.add(observer);\n    }\n    //æ³¨é”€æ–¹æ³•ï¼Œç”¨äºåœ¨è§‚å¯Ÿè€…é›†åˆä¸­åˆ é™¤ä¸€ä¸ªè§‚å¯Ÿè€…\n\tpublic void detach(Observer observer)\n    {\n    \tobservers.remove(observer);\n    }\n    //å£°æ˜æŠ½è±¡é€šçŸ¥æ–¹æ³•\n\tpublic abstract void notify();\n}\n```\n\nå…·ä½“ç›®æ ‡ç±»ConcreteSubjectæ˜¯å®ç°äº†æŠ½è±¡ç›®æ ‡ç±»Subjectçš„ä¸€ä¸ªå…·ä½“å­ç±»ï¼Œå…¶å…¸å‹ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\nclass ConcreteSubject extends Subject\n{\n    //å®ç°é€šçŸ¥æ–¹æ³•\n\tpublic void notify() \n    {\n        //éå†è§‚å¯Ÿè€…é›†åˆï¼Œè°ƒç”¨æ¯ä¸€ä¸ªè§‚å¯Ÿè€…çš„å“åº”æ–¹æ³•\n\t\tfor(Object obs : observers) \n        {\n\t\t\t((Observer)obs).update();\n\t\t}\n\t}\t\n}\n```\n\n* è§‚å¯Ÿè€…\n\næŠ½è±¡è§‚å¯Ÿè€…è§’è‰²ä¸€èˆ¬å®šä¹‰ä¸ºä¸€ä¸ªæ¥å£ï¼Œé€šå¸¸åªå£°æ˜ä¸€ä¸ªupdate()æ–¹æ³•ï¼Œä¸ºä¸åŒè§‚å¯Ÿè€…çš„æ›´æ–°ï¼ˆå“åº”ï¼‰è¡Œä¸ºå®šä¹‰ç›¸åŒçš„æ¥å£ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨å…¶å­ç±»ä¸­å®ç°ï¼Œä¸åŒçš„è§‚å¯Ÿè€…å…·æœ‰ä¸åŒçš„å“åº”æ–¹æ³•ã€‚æŠ½è±¡è§‚å¯Ÿè€…Observerå…¸å‹ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚\n\n```java\ninterface Observer \n{\n    //å£°æ˜å“åº”æ–¹æ³•\n\tpublic void update();\n}\n```\n\nåœ¨å…·ä½“è§‚å¯Ÿè€…ConcreteObserverä¸­å®ç°äº†update()æ–¹æ³•ï¼Œå…¶å…¸å‹ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\nclass ConcreteObserver implements Observer \n{\n    //å®ç°å“åº”æ–¹æ³•\n\tpublic void update() {\n\t\t//å…·ä½“å“åº”ä»£ç \n\t}\n}\n```\n\nåœ¨æœ‰äº›æ›´åŠ å¤æ‚çš„æƒ…å†µä¸‹ï¼Œå…·ä½“è§‚å¯Ÿè€…ç±»`ConcreteObserver`çš„`update()`æ–¹æ³•åœ¨æ‰§è¡Œæ—¶éœ€è¦ä½¿ç”¨åˆ°å…·ä½“ç›®æ ‡ç±»`ConcreteSubject`ä¸­çš„çŠ¶æ€ï¼ˆå±æ€§ï¼‰ï¼Œ**å› æ­¤åœ¨`ConcreteObserver`ä¸`ConcreteSubject`ä¹‹é—´æœ‰æ—¶å€™è¿˜å­˜åœ¨å…³è”æˆ–ä¾èµ–å…³ç³»**ï¼Œåœ¨`ConcreteObserver`ä¸­å®šä¹‰ä¸€ä¸ª`ConcreteSubject`å®ä¾‹ï¼Œé€šè¿‡è¯¥å®ä¾‹è·å–å­˜å‚¨åœ¨`ConcreteSubject`ä¸­çš„çŠ¶æ€ã€‚\n\nå¦‚æœ`ConcreteObserver`çš„`update()`æ–¹æ³•ä¸éœ€è¦ä½¿ç”¨åˆ°`ConcreteSubject`ä¸­çš„çŠ¶æ€å±æ€§ï¼Œåˆ™å¯ä»¥å¯¹è§‚å¯Ÿè€…æ¨¡å¼çš„æ ‡å‡†ç»“æ„è¿›è¡Œç®€åŒ–ï¼Œåœ¨å…·ä½“è§‚å¯Ÿè€…`ConcreteObserver`å’Œå…·ä½“ç›®æ ‡`ConcreteSubject`ä¹‹é—´æ— é¡»ç»´æŒå¯¹è±¡å¼•ç”¨ã€‚\n\n**å¦‚æœåœ¨å…·ä½“å±‚å…·æœ‰å…³è”å…³ç³»ï¼Œç³»ç»Ÿçš„æ‰©å±•æ€§å°†å—åˆ°ä¸€å®šçš„å½±å“ï¼Œå¢åŠ æ–°çš„å…·ä½“ç›®æ ‡ç±»æœ‰æ—¶å€™éœ€è¦ä¿®æ”¹åŸæœ‰è§‚å¯Ÿè€…çš„ä»£ç **ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šè¿åäº†â€œå¼€é—­åŸåˆ™â€ï¼Œä½†æ˜¯å¦‚æœåŸæœ‰è§‚å¯Ÿè€…ç±»æ— é¡»å…³è”æ–°å¢çš„å…·ä½“ç›®æ ‡ï¼Œåˆ™ç³»ç»Ÿæ‰©å±•æ€§ä¸å—å½±å“ã€‚\n\n## ä»£ç ç»ƒä¹ \n\n```cpp\nusing namespace std;\nclass Subject;\nclass Observer\n{\nprotected:\n    string name;\n    Subject * sub;\npublic:\n    Observer(string na, Subject* s)\n        : name(na), sub(s)\n    {}\n    virtual ~Observer() {}\npublic:\n    virtual void update() = 0;\n    \n};\nclass StockObserver : public Observer\n{\npublic:\n    StockObserver(string ns, Subject* sub)\n        : Observer(na, sub)\n    {}\n\tvoid update()\n    {\n        cout << name << \" æ”¶åˆ°æ¶ˆæ¯: \" << sub->event << endl;\n        if(sub->event == \"Bossæ¥äº†!\")\n        {\n            cout << \"é©¬ä¸Šå…³é—­ç‚’è‚¡è½¯ä»¶ï¼Œè£…ä½œå¾ˆè®¤çœŸå·¥ä½œçš„æ ·å­ï¼\" << endl;\n        }\n    }\n};\nclass GameObserver : public Observer\n{\npublic:\n    GameObserver(string ns, Subject* sub)\n        : Observer(na, sub)\n    {}\n\tvoid update()\n    {\n        cout << name << \" æ”¶åˆ°æ¶ˆæ¯: \" << sub->event << endl;\n        if(sub->event == \"Bossæ¥äº†!\")\n        {\n            cout << \"é©¬ä¸Šå…³é—­æ¸¸æˆï¼Œè£…ä½œå¾ˆè®¤çœŸå·¥ä½œçš„æ ·å­ï¼\" << endl;\n        }\n    }\n};\n/* é€šçŸ¥è€… */\nclass Subject\n{\nprotected:\n    list<Observer*> observers;\t//list<std::shared_ptr<Observer>> objservers;\npublic:\n    string event;\t// äº‹ä»¶\n    virtual void attach(Observer*) = 0;\n    virtual void detach(Observer*) = 0;\n    virtual void notify() = 0;\n};\n/* ç§˜ä¹¦ */\nclass Secretary : public Subject\n{\npublic:\n    void attach(Observer* obs)\n    {\n        observers.push_back(obs);\n    }\n    void detach(Observer* obs)\n    {\n        observers.remove(obs);\n    }\n    void notify()\n    {\n        for(auto & x : observers)\n        {\n            x->update();\n        }\n    }\n};\nint main()\n{\n    Subject * dwq = new Secretary();\t//\n    Observer * xiaoshuai = new GameObserver(\"å°å¸…\", dwq);\n    Observer * liming = new GameObserver(\"ææ˜\", dwq);\n    Observer * wangfang = new StockObserver(\"ç‹èŠ³\", dwq);\n    dwq->attach(xiaoshuai);\n    dwq->attach(liming);\n    dwq->attach(wangfang);\n    \n    dwq->event = \"å»åƒé¥­äº†!\";\n    dwq->notify();\n    cout << endl;\n    \n    dwq->event = \"è€æ¿æ¥äº†!\";\n    dwq->notify();\n    cout << endl;\n    return 0;\n}\n```\n\n# è§‚å¯Ÿè€…æ¨¡å¼ä¸MVC\n\nåœ¨å½“å‰æµè¡Œçš„MVC(Model-View-Controller)æ¶æ„ä¸­ä¹Ÿåº”ç”¨äº†è§‚å¯Ÿè€…æ¨¡å¼ï¼ŒMVCæ˜¯ä¸€ç§æ¶æ„æ¨¡å¼ï¼Œå®ƒåŒ…å«ä¸‰ä¸ªè§’è‰²ï¼šæ¨¡å‹(Model)ï¼Œè§†å›¾(View)å’Œæ§åˆ¶å™¨(Controller)ã€‚\n\nå…¶ä¸­**æ¨¡å‹å¯å¯¹åº”äºè§‚å¯Ÿè€…æ¨¡å¼ä¸­çš„è§‚å¯Ÿç›®æ ‡**ï¼Œè€Œ**è§†å›¾å¯¹åº”äºè§‚å¯Ÿè€…**ï¼Œæ§åˆ¶å™¨å¯å……å½“ä¸¤è€…ä¹‹é—´çš„ä¸­ä»‹è€…ã€‚å½“**æ¨¡å‹å±‚çš„æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶ï¼Œè§†å›¾å±‚å°†è‡ªåŠ¨æ”¹å˜å…¶æ˜¾ç¤ºå†…å®¹**ã€‚\n\n**æ¨¡å‹å±‚æä¾›çš„æ•°æ®æ˜¯è§†å›¾å±‚æ‰€è§‚å¯Ÿçš„å¯¹è±¡**ï¼Œåœ¨è§†å›¾å±‚ä¸­åŒ…å«ä¸¤ä¸ªç”¨äºæ˜¾ç¤ºæ•°æ®çš„å›¾è¡¨å¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯æŸ±çŠ¶å›¾ï¼Œä¸€ä¸ªæ˜¯é¥¼çŠ¶å›¾ï¼Œç›¸åŒçš„æ•°æ®æ‹¥æœ‰ä¸åŒçš„å›¾è¡¨æ˜¾ç¤ºæ–¹å¼ï¼Œå¦‚æœæ¨¡å‹å±‚çš„æ•°æ®å‘ç”Ÿæ”¹å˜ï¼Œä¸¤ä¸ªå›¾è¡¨å¯¹è±¡å°†éšä¹‹å‘ç”Ÿå˜åŒ–ï¼Œè¿™æ„å‘³ç€å›¾è¡¨å¯¹è±¡ä¾èµ–æ¨¡å‹å±‚æä¾›çš„æ•°æ®å¯¹è±¡ï¼Œå› æ­¤æ•°æ®å¯¹è±¡çš„ä»»ä½•çŠ¶æ€æ”¹å˜éƒ½åº”ç«‹å³é€šçŸ¥å®ƒä»¬ã€‚åŒæ—¶ï¼Œè¿™ä¸¤ä¸ªå›¾è¡¨ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œä¸å­˜åœ¨ä»»ä½•è”ç³»ï¼Œè€Œä¸”å›¾è¡¨å¯¹è±¡çš„ä¸ªæ•°æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦å†å¢åŠ æ–°çš„å›¾è¡¨å¯¹è±¡ï¼Œå¦‚æŠ˜çº¿å›¾ã€‚åœ¨å¢åŠ æ–°çš„å›¾è¡¨å¯¹è±¡æ—¶ï¼Œæ— é¡»ä¿®æ”¹åŸæœ‰ç±»åº“ï¼Œæ»¡è¶³â€œå¼€é—­åŸåˆ™â€ã€‚\n\n# é€‚ç”¨åœºæ™¯\n\nåœ¨ä»¥ä¸‹æƒ…å†µä¸‹å¯ä»¥è€ƒè™‘ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼ï¼š\n\n1. ä¸€ä¸ªæŠ½è±¡æ¨¡å‹æœ‰ä¸¤ä¸ªæ–¹é¢ï¼Œå…¶ä¸­ä¸€ä¸ªæ–¹é¢ä¾èµ–äºå¦ä¸€ä¸ªæ–¹é¢ï¼Œå°†è¿™ä¸¤ä¸ªæ–¹é¢å°è£…åœ¨ç‹¬ç«‹çš„å¯¹è±¡ä¸­ä½¿å®ƒä»¬å¯ä»¥å„è‡ªç‹¬ç«‹åœ°æ”¹å˜å’Œå¤ç”¨ã€‚\n2. ä¸€ä¸ªå¯¹è±¡çš„æ”¹å˜å°†å¯¼è‡´ä¸€ä¸ªæˆ–å¤šä¸ªå…¶ä»–å¯¹è±¡ä¹Ÿå‘ç”Ÿæ”¹å˜ï¼Œè€Œå¹¶ä¸çŸ¥é“å…·ä½“æœ‰å¤šå°‘å¯¹è±¡å°†å‘ç”Ÿæ”¹å˜ï¼Œä¹Ÿä¸çŸ¥é“è¿™äº›å¯¹è±¡æ˜¯è°ã€‚\n3. éœ€è¦åœ¨ç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªè§¦å‘é“¾ï¼ŒAå¯¹è±¡çš„è¡Œä¸ºå°†å½±å“Bå¯¹è±¡ï¼ŒBå¯¹è±¡çš„è¡Œä¸ºå°†å½±å“Cå¯¹è±¡â€¦â€¦ï¼Œå¯ä»¥ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼åˆ›å»ºä¸€ç§é“¾å¼è§¦å‘æœºåˆ¶ã€‚\n","categories":["è®¾è®¡æ¨¡å¼","è¡Œä¸ºå‹æ¨¡å¼"]},{"title":"ç¬”è¯•è®°å½•","url":"/ç®—æ³•/ç¬”è¯•è®°å½•/","content":"\n# 20220416ç½‘æ˜“ç¬”è¯•\n\n* è¾“å…¥nï¼Œæ‰“å°å¤§å°ä¸ºnçš„\"o\"\n\n```\nn==1æ—¶\n.**.\n*..*\n*..*\n.**,\nn==2æ—¶\n..****..\n.**..**.\n.**..**.\n\n```\n\n","categories":["ç®—æ³•","åˆ·é¢˜"]},{"title":"é›†ç¾¤æœåŠ¡å™¨","url":"/é¡¹ç›®/é›†ç¾¤æœåŠ¡å™¨æ¶æ„/","content":"# å†…å®¹\n\n1. é¡¹ç›®éœ€æ±‚åŠç›®æ ‡\n2. å¼€å‘ç¯å¢ƒ\n3. `Json`ä»‹ç»\n4. `muduo`ç½‘ç»œåº“ç¼–ç¨‹\n5. æœåŠ¡å™¨é›†ç¾¤\n6. åŸºäº`å‘å¸ƒ-è®¢é˜…`çš„`Redis`â€”â€”æœåŠ¡å™¨ä¸­é—´ä»¶\n7. æ•°æ®åº“è®¾è®¡\n\næœ¬é¡¹ç›®è¦ç”¨åˆ°çš„æŠ€æœ¯æ ˆï¼š\n\n1. `Json`åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼›\n2. `muduo`ç½‘ç»œåº“å¼€å‘ï¼›\n3. `nginx`æºç ç¼–è¯‘å®‰è£…å’Œç¯å¢ƒéƒ¨ç½²ï¼›\n4. `nginx`çš„`tcp`è´Ÿè½½å‡è¡¡å™¨é…ç½®ï¼›\n5. `redis`ç¼“å­˜æœåŠ¡å™¨ç¼–ç¨‹å®è·µï¼›\n6. åŸºäº`å‘å¸ƒ-è®¢é˜…`çš„æœåŠ¡å™¨ä¸­é—´ä»¶`redis`æ¶ˆæ¯é˜Ÿåˆ—ç¼–ç¨‹å®è·µï¼›\n7. `MySQL`æ•°æ®åº“ç¼–ç¨‹ï¼›\n8. `CMake`æ„å»ºç¼–è¯‘ç¯å¢ƒï¼›\n9. `Github`æ‰˜ç®¡é¡¹ç›®\n\næœ¬é¡¹ç›®çš„å†…å®¹åŒ…å«äº†ï¼šé€šå¸¸å¼€å‘çš„æœåŠ¡å™¨ï¼Œç½‘ç»œã€ä¸šåŠ¡ã€æ•°æ®æ¨¡å—ï¼ˆæ•°æ®åº“ã€æ•°æ®çš„æ“ä½œï¼‰ï¼Œ\né¡¹ç›®ä¸­è¦æŠŠä¸‰å¤§æ¨¡å—åŒºåˆ†å¼€ï¼Œé¡¹ç›®åˆæœŸæ—¶ä»¥ç™»å½•æ¨¡å—ä¸ºä¸»çº¿ï¼Œåˆ†ä¸‰å¤§å—æ¨è¿›ã€‚\n\n# é¡¹ç›®éœ€æ±‚åŠç›®æ ‡\n* é¡¹ç›®éœ€æ±‚\n    1. å®¢æˆ·ç«¯æ–°ç”¨æˆ·æ³¨å†Œ\n    2. å®¢æˆ·ç«¯ç”¨æˆ·ç™»å½•\n    3. æ·»åŠ å¥½å‹å’Œæ·»åŠ ç¾¤ç»„\n    4. å¥½å‹èŠå¤©å’Œç¾¤ç»„èŠå¤©\n    5. `nginx`é…ç½®`tcp`è´Ÿè½½å‡è¡¡\n    6. é›†ç¾¤èŠå¤©ç³»ç»Ÿæ”¯æŒå®¢æˆ·ç«¯è·¨æœåŠ¡å™¨é€šä¿¡\n* é¡¹ç›®ç›®æ ‡\n    1. æŒæ¡æœåŠ¡å™¨çš„ç½‘ç»œ`I/O`æ¨¡å—ï¼Œä¸šåŠ¡æ¨¡å—ï¼Œæ•°æ®æ¨¡å—åˆ†å±‚çš„è®¾è®¡æ€æƒ³\n    2. æŒæ¡`C++` `muduo`ç½‘ç»œåº“çš„ç¼–ç¨‹ä»¥åŠå®ç°åŸç†\n    3. æŒæ¡`Json`çš„ç¼–ç¨‹åº”ç”¨\n    4. æŒæ¡`nginx`é…ç½®éƒ¨ç½²`tcp`è´Ÿè½½å‡è¡¡å™¨çš„åŸç†åŠåº”ç”¨\n    5. æŒæ¡æœåŠ¡å™¨ä¸­é—´ä»¶çš„åº”ç”¨åœºæ™¯å’ŒåŸºäº`å‘å¸ƒ-è®¢é˜…`çš„`redis`ç¼–ç¨‹å®è·µä»¥åŠåº”ç”¨åŸç†\n    6. æŒæ¡`CMake`æ„å»ºè‡ªåŠ¨åŒ–ç¼–ç¨‹ç¯å¢ƒ\n# å¼€å‘ç¯å¢ƒ\nmuduoåº“åŸºäºbooståº“ï¼Œéœ€è¦å…ˆå®‰è£…boostã€‚\n```sh\ntar -zxvf boost_1_69_0.tar.gz\ncd boost_1_69_0/\n./bootstrap.sh #è¿è¡Œbootstrap.shå·¥ç¨‹ç¼–è¯‘æ„å»ºç¨‹åº\n./b2 #æºç æ ¹ç›®å½•ä¸‹ç”Ÿæˆäº†b2ç¨‹åºï¼Œè¿è¡Œb2ç¨‹åº\n#ç¼–è¯‘å®Œæˆåï¼Œä¼šæœ‰å¦‚ä¸‹æ‰“å°: The Boost C++ Libraries were successfully built!\nsudo ./b2 install #æŠŠä¸Šé¢çš„booståº“å¤´æ–‡ä»¶å’Œlibåº“æ–‡ä»¶å®‰è£…åœ¨é»˜è®¤çš„Linuxç³»ç»Ÿå¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶çš„æœç´¢è·¯å¾„ä¸‹\n```\n## å·¥ç¨‹ç›®å½•\n\n```\nincludeç›®å½•æ˜¯å¤´æ–‡ä»¶æ”¾çš„ä½ç½®ã€‚\n\nserverå’Œclientçš„ä»£ç åœ¨åŒä¸€å·¥ç¨‹ä¸­ï¼Œæœ€åç”Ÿæˆæ—¶å¯ä»¥æŠŠC/Såˆ†å¼€ç”Ÿæˆåˆ°binç›®å½•ä¸‹ã€‚\nå¯æŒ‰serverå’Œclientåˆ†ç±»ï¼Œ\næ¯”å¦‚ç”Ÿæˆä»£ç æ‰€éœ€ç”¨åˆ°çš„å¤´æ–‡ä»¶å¯ä»¥åˆ†åˆ«æ”¾åœ¨/include/serverå’Œ/include/clientï¼Œ\nè€Œserverå’Œclientå…±éœ€çš„å¤´æ–‡ä»¶ç›´æ¥æ”¾åˆ°/includeä¸‹ã€‚æ¯”å¦‚æ¶ˆæ¯çš„idã€‚\n\nsrcæ”¾æºç ã€‚\n\nthirdpartyæ˜¯ç¬¬ä¸‰æ–¹åº“æ–‡ä»¶å¤¹ï¼Œæ¯”å¦‚æ”¾json.hppã€‚\n\næœ¬é¡¹ç›®æ²¡æœ‰ç”Ÿæˆlibåº“(.a/.so)ï¼Œæ‰€ä»¥æ²¡æœ‰libæ–‡ä»¶å¤¹ã€‚\n```\n# CMakeLists.txtç¼–å†™\n## æ ¹ç›®å½•\n```cmake\ncmake_minimum_required(VERSION 3.0.0)\nproject(chat)\n# é…ç½®ç¼–è¯‘é€‰é¡¹\nset(CMAKE_CXX_FLAGS ${CMAKE_CXX_FLAGS} -g)\n# é…ç½®æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶è¾“å‡ºçš„è·¯å¾„\nset(EXECUTABLE_OUTPUT_PATH ${PROJECT_SOURCE_DIR}/bin)\n# é…ç½®å¤´æ–‡ä»¶çš„æœç´¢è·¯å¾„\ninclude_directories(${PROJECT_SOURCE_DIR}/include)\ninclude_directories(${PROJECT_SOURCE_DIR}/include/server)\n# åŠ è½½å­ç›®å½•\nadd_subdirectory(src)\n```\n## `/src`\n```cmake\nadd_subdirectory(server)\n```\n## `/src/server`\n```cmake\n# å®šä¹‰äº†ä¸€ä¸ªSRC_LISTå˜é‡ï¼ŒåŒ…å«äº†è¯¥ç›®å½•ä¸‹æ‰€æœ‰çš„æºæ–‡ä»¶\naux_source_directory(. SRC_LIST)\n# æŒ‡å®šç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶\nadd_executable(ChatServer ${SRC_LIST})\n# æŒ‡å®šå¯æ‰§è¡Œæ–‡ä»¶é“¾æ¥æ—¶ éœ€è¦ä¾èµ–çš„åº“æ–‡ä»¶\ntarget_link_libraries(CharServer muduo_net muduo_base pthread)\n```\n# JSONä»‹ç»\nJSONï¼Œå…¨æ‹¼ï¼šJavaScript Object Notation\n\nJSONæ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ï¼ˆä¹Ÿå«æ•°æ®åºåˆ—åŒ–æ–¹å¼ï¼‰ã€‚\n\nJSONé‡‡ç”¨å®Œå…¨**ç‹¬ç«‹äºç¼–ç¨‹è¯­è¨€**çš„æ–‡æœ¬æ ¼å¼æ¥å­˜å‚¨å’Œè¡¨ç¤ºæ•°æ®ã€‚\n\nç®€æ´å’Œæ¸…æ™°çš„å±‚æ¬¡ç»“æ„ä½¿å¾—JSONæˆä¸ºç†æƒ³çš„æ•°æ®äº¤æ¢è¯­è¨€ã€‚\n\næ˜“äºäººé˜…è¯»å’Œç¼–å†™ï¼ŒåŒæ—¶ä¹Ÿæ˜“äºæœºå™¨è§£æå’Œç”Ÿæˆï¼Œå¹¶æœ‰æ•ˆåœ°æå‡ç½‘ç»œä¼ è¾“æ•ˆç‡ã€‚\n\nJSONçš„ç”¨å¤„å°±æ˜¯ä¸‹å›¾ï¼š\n![image-20220413164124873](../../images/é›†ç¾¤æœåŠ¡å™¨/image-20220413164124873.png)\n\n## JSONç¬¬ä¸‰æ–¹åº“\næœ¬é¡¹ç›®é€‰ç”¨çš„æ˜¯`JSON for Modern C++`ï¼Œç”±å¾·å›½äºº`nlohmann`ç¼–å†™çš„åœ¨`C++`ä¸‹ä½¿ç”¨çš„`JSON`åº“ã€‚ç‰¹ç‚¹å¦‚ä¸‹ï¼š\n1. æ•´ä¸ªä»£ç ç”±ä¸€ä¸ªå¤´æ–‡ä»¶`json.hpp`åŒ…å«ï¼Œæ²¡æœ‰ä¾èµ–å…³ç³»ï¼Œä½¿ç”¨æ–¹ä¾¿ï¼›\n2. ä½¿ç”¨C++11æ ‡å‡†ç¼–å†™ï¼›\n3. ä½¿å¾—JSONåƒSTLå®¹å™¨ä¸€æ ·ï¼Œè€Œä¸”STLå’ŒJSONå®¹å™¨ä¹‹é—´å¯ä»¥ç›¸äº’è½¬æ¢ï¼›\n4. æ‰€æœ‰ç±»éƒ½ç»è¿‡ä¸¥æ ¼çš„å•å…ƒæµ‹è¯•ï¼Œè¦†ç›–100ï¼…çš„ä»£ç ï¼ŒåŒ…æ‹¬æ‰€æœ‰ç‰¹æ®Šçš„è¡Œä¸ºã€‚æ­¤å¤–ï¼Œè¿˜æ£€æŸ¥äº†Valgrindæ˜¯å¦æœ‰å†…å­˜æ³„æ¼ã€‚ä¸ºäº†ä¿æŒé«˜è´¨é‡ï¼Œè¯¥é¡¹ç›®éµå¾ªâ€œæ ¸å¿ƒåŸºç¡€è®¾æ–½â€å€¡è®®çš„æœ€ä½³å®è·µã€‚\n## æµ‹è¯•JSON\n```cpp\n#include\"json.hpp\"\nusing json = nlohmann::json;\n#include<iostream>\n#include<vector>\n#include<map>\nusing namespace std;\n/* jsonåºåˆ—åŒ– ç¤ºä¾‹1 */\nvoid func1()\n{\n    json js;\n    js[\"msg_type\"] = 2;\n    js[\"from\"] = \"zhang san\";\n    js[\"to\"] = \"li si\";\n    js[\"msg\"] = \"hello, i'm zhang san\";\n    cout << js << endl;\n}\nint main()\n{\n    func1();\n    return 0;\n}\n\n```\nè¾“å‡ºç»“æœ\n```\n{\"from\":\"zhang san\",\"msg\":\"hello, i'm zhang san\",\"msg_type\":2,\"to\":\"li si\"}\n```\n### èƒ½ç›´æ¥æ·»åŠ äºŒç»´key - value\n```cpp\n/* JSON åºåˆ—åŒ– å®ä¾‹2 */\nvoid func2()\n{\n\tjson js;\n    js[\"id\"] = {1, 2, 3, 4, 5};\n    js[\"name\"] = \"zhang san\";\n    js[\"msg\"][\"zhang san\"] = \"i'm zhang san\";\n    js[\"msg\"][\"li si\"] = \"i'm li si\";\n    /* ä¸Šé¢ä¸¤å¥ç­‰åŒäºä¸‹é¢è¿™å¥ä¸€æ¬¡æ€§æ·»åŠ æ•°ç»„å¯¹è±¡ */\n/*  js[\"msg\"] = {{\"zhang san\", \"i'm zhang san\"}, {\"li si\", \"i'm li si\"}}; */\n\tcout << js << endl;\n}\nint main()\n{\n    func2();\n    return 0;\n}\n\n\n```\nè¾“å‡ºç»“æœ\n```\n{\"id\":[1,2,3,4,5],\"msg\":{\"li si\":\"i'm li si\",\"zhang san\":\"i'm zhang san\"},\"name\":\"zhang san\"}\n```\n### STLå®¹å™¨å†…å®¹å¯¼å…¥JSON\nè¿™ä¸ªJSONåº“å¼ºå¤§åˆ°ç›´æ¥æŠŠ`C++` `STL`ä¸­çš„å®¹å™¨å†…å®¹å¯ä»¥ç›´æ¥åºåˆ—åŒ–æˆJsonå­—ç¬¦ä¸²ï¼Œä»£ç å¦‚ä¸‹ï¼š\n\n```cpp\n/* jsonåºåˆ—åŒ– å®ä¾‹3 */\nvoid func3()\n{\n    json js;\n    vector<int> vec;\n    vec.push_back(1);\n    vec.push_back(2);\n    vec.push_back(5);\n    // ç›´æ¥åºåˆ—åŒ–ä¸€ä¸ªvectorå®¹å™¨\n    js[\"list\"] = vec;\n    map<int, string> m;\n    m.insert({1, \"é»„å±±\"});\n    m.insert({2, \"åå±±\"});\n    m.insert({3, \"æ³°å±±\"});\n    // ç›´æ¥åºåˆ—åŒ–ä¸€ä¸ªmapå®¹å™¨\n    js[\"path\"] = m;\n    cout << js << endl;\n}\n```\nè¾“å‡ºç»“æœ\n```\n{\"list\":[1,2,5],\"path\":[[1,\"é»„å±±\"],[2,\"åå±±\"],[3,\"æ³°å±±\"]]}\n```\n## API\n### dumpï¼ˆåºåˆ—åŒ–ï¼‰\nç”Ÿæˆçš„å­—ç¬¦ä¸²å†…å®¹å’Œ`<< json`çš„ä¸€æ ·ã€‚è¿”å›ä¸€ä¸ªstringå¯¹è±¡ã€‚\n\n`cout <<`èƒ½è¾“å‡º JSON å¯¹è±¡æ˜¯å› ä¸ºé‡è½½äº†`<<`è¿ç®—ç¬¦ï¼›è€Œè¦å®é™…ç”Ÿæˆ`string`å¯ç”¨`dump()`ï¼Œç”Ÿæˆçš„å­—ç¬¦ä¸²å†…å®¹å’Œ`<< json`çš„ä¸€æ ·ã€‚ä¼ è¾“æ•°æ®æ—¶ï¼Œä¸è¦ä¼ `string`å¯¹è±¡ï¼Œè€Œæ˜¯è¦ä¼ `string`å®é™…æŒ‡å‘çš„å­—ç¬¦ä¸²é¦–æŒ‡é’ˆï¼Œ`c_str()`ã€‚\n\n```cpp\nvoid func1()\n{\n    json js;\n    js[\"msg_type\"] = 2;\n    js[\"from\"] = \"zhang san\";\n    js[\"to\"] = \"li si\";\n    js[\"msg\"] = \"hello, i'm zhang san\";\n    string sendBuf = js.dump();\n    cout << sendBuf.c_str() << endl;\n}\n```\n### parseï¼ˆååºåˆ—åŒ–ä¸ºJSONå¯¹è±¡ï¼Œå¯ä»¥èµ‹å€¼ç»™STLå®¹å™¨ï¼‰\nè§£æstringç±»å‹çš„å­—ç¬¦ä¸²ï¼Œç”Ÿæˆä¸€ä¸ªJSONå¯¹è±¡ã€‚å¯ä»¥è½¬æ¢ä¸ºå®¹å™¨ã€‚\n```cpp\nvoid func1()\n{\n    json js;\n    js[\"msg_type\"] = 2;\n    js[\"from\"] = \"zhang san\";\n    js[\"to\"] = \"li si\";\n    js[\"msg\"] = \"hello, i'm zhang san\";\n    cout << js << endl;\n}\nint main()\n{\n    string recvBuf = func1();\n    json json_obj = json::parse(recvBuf);\n    cout << json_obj[\"msg_type\"] << endl;\n    cout << json_obj[\"from\"] << endl;\n    cout << json_obj[\"to\"] << endl;\n    cout << json_obj[\"msg\"] << endl;\n}\n```\nè¾“å‡ºç»“æœï¼š\n```\n2\n\"zhang san\"\n\"li si\"\n\"hello, what are you doing now?\"\n```\n\n```cpp\nvoid func2()\n{\n\tjson js;\n    js[\"id\"] = {1, 2, 3, 4, 5};\n}\nint main()\n{\n    string recvBuf = func2();\n    json json_obj = json::parse(recvBuf);\n    auto arr = json_obj[\"id\"];\n    cout << json_obj[\"id\"] << endl;\n    cout << arr[2] << endl;\n}\n```\nè¾“å‡ºç»“æœ\n```\n[1,2,3,4,5]\n3\n```\n\n```cpp\nvoid func3()\n{\n    json js;\n    vector<int> vec;\n    vec.push_back(1);\n    vec.push_back(2);\n    vec.push_back(5);\n    // ç›´æ¥åºåˆ—åŒ–ä¸€ä¸ªvectorå®¹å™¨\n    js[\"list\"] = vec;\n    map<int, string> m;\n    m.insert({1, \"é»„å±±\"});\n    m.insert({2, \"åå±±\"});\n    m.insert({3, \"æ³°å±±\"});\n    // ç›´æ¥åºåˆ—åŒ–ä¸€ä¸ªmapå®¹å™¨\n    js[\"path\"] = m;\n    cout << js << endl;\n}\nint main()\n{\n    vector<int> vec = json_obj[\"list\"];\n    for (int & v : vec)\n    {\n        cout << v << \" \";\n    }\n    cout << endl;\n\n    map<int, string> mymap = json_obj[\"path\"];\n    for (auto & p : mymap)\n    {\n        cout << p.first << \" \" << p.second << endl;\n    }\n    cout << endl;\n}\n```\nè¾“å‡ºç»“æœ\n```\n1 2 5 \n1 é»„å±±\n2 åå±±\n3 æ³°å±±\n```\n# ç½‘ç»œIOæ¨¡å—\n## mainå…¥å£ï¼ˆâ­éœ€è¦å¤„ç†æœåŠ¡å™¨ç¨‹åºå¼‚å¸¸é€€å‡ºï¼Œå¦‚SIGINTä¿¡å·ï¼‰\nè¯¸å¦‚è¢«killã€æˆ–è€…Ctrl + Cç»ˆæ­¢æœåŠ¡å™¨ä¸»ç¨‹åºæ—¶ï¼Œéœ€è¦å¤„ç†ä¿¡å·ï¼Œç»‘å®šå›è°ƒ`void resetHandler(int)`\nåœ¨ChatServiceä¸­ï¼Œè°ƒç”¨resetå‡½æ•°ã€‚\n\n```cpp\n#include\"chatserver.hpp\"\n#include<iostream>\nusing namespace std;\n\n#include<signal.h>\n#include\"chatservice.hpp\"\n#include<muduo/base/Logging.h>  // LOG_ERROR <<\nusing namespace muduo;\n\n/* å¤„ç†æœåŠ¡å™¨Ctrl+Cç»“æŸåï¼Œé‡ç½®userçŠ¶æ€ä¿¡æ¯ */\nvoid resetHandler(int)\n{\n    ChatService::instance()->reset();\n    LOG_INFO << \"æœåŠ¡å™¨å› SIGINTä¿¡å·é€€å‡ºï¼Œç”¨æˆ·çŠ¶æ€å·²é‡ç½®ã€‚\";\n    exit(0);\n}\nint main()\n{\n    signal(SIGINT, resetHandler);\n    EventLoop loop;\n    InetAddress addr(\"127.0.0.1\", 6000);\n    ChatServer server(&loop, addr, \"ChatServer\");\n    ChatService::instance()->reset();\n    server.start();\n    loop.loop();    //å¼€å¯äº‹ä»¶å¾ªç¯\n    return 0;\n}\n```\nChatServiceä¸­çš„`reset()`å‡½æ•°ï¼Œå°±æ˜¯è°ƒç”¨`_userModel`çš„`resetAllState()`æ–¹æ³•ã€‚\n```cpp\n/* ä¸šåŠ¡é‡ç½®æ–¹æ³•ï¼Œé€šå¸¸åœ¨æœåŠ¡å™¨å¼‚å¸¸é€€å‡ºæ—¶è°ƒç”¨ */\nvoid ChatService::reset()\n{\n    /* æŠŠæ‰€æœ‰onlineç”¨æˆ·çš„çŠ¶æ€ç½®ä¸ºoffline */\n    _userModel.resetAllState();\n}\n```\nå³é‡ç½®æ‰€æœ‰ç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯ï¼ŒæŠŠæ‰€æœ‰ online çš„æ”¹æˆ offline ã€‚\n```cpp\n/* é‡ç½®æ‰€æœ‰ç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯ */\nvoid UserModel::resetAllState()\n{\n    char sql[1024] = \"update user set state = 'offline' where state = 'online'\";\n    MySQL mysql;\n    if(mysql.connect())\n    {\n        mysql.update(sql);\n    }\n}\n```\n\n## ChatServer\n\n### æˆå‘˜å±æ€§\n\n1. `TcpServer m_server` - **åŸºäºäº‹ä»¶é©±åŠ¨çš„ã€IOå¤ç”¨+epoll+çº¿ç¨‹æ± **çš„æœåŠ¡å™¨ç±»ï¼Œå®Œå…¨**åŸºäºReactoræ¨¡å‹**\n2. `EventLoop *m_loop` - mainLoopçš„æŒ‡é’ˆ, ä¿å­˜äº‹ä»¶å¾ªç¯. æœ‰äº†äº‹ä»¶å¾ªç¯çš„æŒ‡é’ˆï¼Œå¯ä»¥åœ¨åˆé€‚çš„æ—¶å€™è°ƒç”¨quité€€å‡ºäº‹ä»¶å¾ªç¯ï¼›\n\n```cpp\nprivate:\n    /* ç»„åˆçš„muduoåº“ï¼Œå®ç°æœåŠ¡å™¨åŠŸèƒ½çš„ç±»å¯¹è±¡ */\n    TcpServer _server;\n    /* æŒ‡å‘äº‹ä»¶å¾ªç¯å¯¹è±¡çš„æŒ‡é’ˆ */\n    EventLoop *_loop;\n```\n\n### æˆå‘˜å‡½æ•°\n\n#### æ„é€ \nå‚æ•°ä¸º`loop`æŒ‡é’ˆ, `listenAddr`, `name`, ç”¨äºåˆå§‹åŒ–TcpServer\n```cpp\npublic:\n/* åˆå§‹åŒ–èŠå¤©æœåŠ¡å™¨å¯¹è±¡ */\nChatServer(EventLoop* loop,\n           const InetAddress& listenAddr,\n           const string& nameArg);\n```\n#### `start()`\n```cpp\npublic:\n    void start();\n```\n\n#### `onConnection`/`onMessage`\nè¿æ¥åˆ›å»º/æ–­å¼€çš„å›è°ƒå‡½æ•°\n\nè¯»å†™äº‹ä»¶å‘ç”Ÿçš„å›è°ƒå‡½æ•°\n   \n```cpp\nprivate:\n   /* ä¸ŠæŠ¥é“¾æ¥ç›¸å…³ä¿¡æ¯çš„å›è°ƒå‡½æ•°ï¼ˆè¿æ¥åˆ›å»ºï¼Œè¿æ¥æ–­å¼€ï¼‰*/\n   void onConnection(const TcpConnectionPtr&);\n   /* ä¸ŠæŠ¥è¯»å†™äº‹ä»¶ç›¸å…³ä¿¡æ¯çš„å›è°ƒå‡½æ•° */\n   void onMessage(const TcpConnectionPtr&, Buffer*, Timestamp);\n```\n### å¤´æ–‡ä»¶\n\n```cpp\n#ifndef CHATSERVER_H\n#define CHATSERVER_H\n#include <muduo/net/TcpServer.h>\n#include <muduo/net/EventLoop.h>\nusing namespace muduo;\nusing namespace muduo::net;\n/**\n * èŠå¤©æœåŠ¡å™¨çš„ä¸»ç±»;\n *\n * è¦æ³¨å†Œä¸¤ä¸ªæ–¹æ³•:\n * ç»™TcpServeræ³¨å†Œæ–°ç”¨æˆ·çš„è¿æ¥ã€è¿æ¥æ–­å¼€çš„ã€å·²è¿æ¥ç”¨æˆ·çš„å¯è¯»å†™äº‹ä»¶;\n */\nclass ChatServer\n{\npublic:\n    /* åˆå§‹åŒ–èŠå¤©æœåŠ¡å™¨å¯¹è±¡ */\n    ChatServer(EventLoop* loop,\n               const InetAddress& listenAddr,\n               const string& nameArg);\npublic:\n    /* å¯åŠ¨æœåŠ¡ */\n    void start();\n\nprivate:\n    /* ä¸ŠæŠ¥é“¾æ¥ç›¸å…³ä¿¡æ¯çš„å›è°ƒå‡½æ•°ï¼ˆè¿æ¥åˆ›å»ºï¼Œè¿æ¥æ–­å¼€ï¼‰*/\n    void onConnection(const TcpConnectionPtr&);\n    /* ä¸ŠæŠ¥è¯»å†™äº‹ä»¶ç›¸å…³ä¿¡æ¯çš„å›è°ƒå‡½æ•° */\n    void onMessage(const TcpConnectionPtr&, Buffer*, Timestamp);\n\n\nprivate:\n    /* ç»„åˆçš„muduoåº“ï¼Œå®ç°æœåŠ¡å™¨åŠŸèƒ½çš„ç±»å¯¹è±¡ */\n    TcpServer _server;\n    /* æŒ‡å‘äº‹ä»¶å¾ªç¯å¯¹è±¡çš„æŒ‡é’ˆ */\n    EventLoop *_loop;\n};\n#endif\n```\n## Reactoræ¨¡å‹\n\næœ¬é¡¹ç›®åŸºäºmuduoåº“ï¼Œæ¨¡å‹æ˜¯**åŸºäºäº‹ä»¶é©±åŠ¨çš„ã€IOå¤ç”¨+epoll+çº¿ç¨‹æ± **çš„ç½‘ç»œï¼Œå®Œå…¨**åŸºäºReactoræ¨¡å‹**ï¼Œçº¿ç¨‹æš‚æ—¶è®¾ç½®ä¸º 4 ä¸ªï¼Œæœ‰ä¸€ä¸ªä¸»Reactoræ˜¯ IO çº¿ç¨‹ï¼Œä¸»è¦è´Ÿè´£æ–°ç”¨æˆ·çš„è¿æ¥ï¼Œ3ä¸ª sub-Reactor æ˜¯å·¥ä½œçº¿ç¨‹ï¼Œä¸»è¦è´Ÿè´£å·²è¿æ¥ç”¨æˆ·çš„è¯»å†™äº‹ä»¶çš„å¤„ç†ã€‚\n## ï¼ˆâ­ï¼‰å®¢æˆ·ç«¯å¼‚å¸¸é€€å‡ºçš„ä¸šåŠ¡ä»£ç è§£å†³\néœ€è¦çŸ¥é“ï¼Œå¦‚æœå®¢æˆ·ç«¯å¼‚å¸¸æ–­ç½‘çš„è¯ï¼Œæ˜¯ä¸ä¼šå‘é€TCPæŠ¥æ–‡çš„ï¼Œæ›´ä¸ä¼šå‘é€JSONä¿¡æ¯ã€‚\nä½†æ˜¯å¥½åœ¨muduoç½‘ç»œåº“ä¸ºæˆ‘ä»¬å°è£…äº†å¤„ç†å®¢æˆ·ç«¯å¼‚å¸¸æ–­ç½‘çš„é€»è¾‘ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨onConnectionå›è°ƒé‡Œå¤„ç†å®¢æˆ·ç«¯æ–­å¼€çš„é€»è¾‘å°±å¥½äº†ã€‚\næ—¢ç„¶å®¢æˆ·ç«¯æ–­å¼€äº†ï¼Œéœ€è¦åœ¨Serviceå±‚é¢è®°å½•ç”¨æˆ·é€€å‡ºã€‚\n\n```cpp\nvoid ChatServer::onConnection(const TcpConnectionPtr& conn)\n{\n    if (!conn->connected())\n    {\n        ChatService::instance()->cloentCloseException(conn);\n        conn->shutdown();\n    }\n}\n```\n\n```cpp\nvoid ChatService::clientCloseException(const TcpConnectionPtr &conn)\n{\n    User user;\n    {\n        lock_guard<mutex> lock(_connMutex);\n        // ä» map è¡¨ä¸­æ‰¾åˆ°è¯¥ conn çš„ç”¨æˆ·ï¼Œåˆ é™¤è¿æ¥ä¿¡æ¯\n        for (auto it = _userConnMap.begin(); it != _userConnMap.end(); ++it)\n        {\n            if (it->second == conn)\n            {\n                user.setId(it->first);\n                _userConnMap.erase(it);\n                break;\n            }\n        }\n    }\n    // æ›´æ–°ç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯\n    if (user.getId() != -1)\n    {\n        user.setState(\"offline\");\n        _userModel.updateState(user);\n    }\n}\n```\n# æ•°æ®åº“è®¾è®¡\nUserè¡¨\n\n| å­—æ®µåç§°     | å­—æ®µç±»å‹                      | å­—æ®µè¯´æ˜   | çº¦æŸ                         |\n| -------- | ------------------------- | ------ | -------------------------- |\n| id       | INT                       | ç”¨æˆ·id   | PRIMARY KEYã€AUTO_INCREMENT |\n| name     | VARCHAR(50)               | ç”¨æˆ·å    | NOT NULL                   |\n| password | VARCHAR(50)               | ç”¨æˆ·å¯†ç    | NOT NULL                   |\n| state    | ENUM('online', 'offline') | å½“å‰ç™»å½•çŠ¶æ€ | DEFAULT 'offline'          |\nFriendè¡¨\n\n| å­—æ®µåç§°     | å­—æ®µç±»å‹ | å­—æ®µè¯´æ˜ | çº¦æŸ            |\n| -------- | ---- | ---- | ------------- |\n| userid   | INT  | ç”¨æˆ·id | NOT NULLã€è”åˆä¸»é”® |\n| friendid | INT  | å¥½å‹id | NOT NULLã€è”åˆä¸»é”® |\nAllGroupè¡¨\n\n| å­—æ®µåç§°      | å­—æ®µç±»å‹         | å­—æ®µè¯´æ˜ | çº¦æŸ                         |\n| --------- | ------------ | ---- | -------------------------- |\n| id        | INT          | ç¾¤ç»„id | PRIMARY KEYã€AUTO_INCREMENT |\n| groupname | VARCHAR(50)  | ç¾¤ç»„åç§° | NOT NULL                   |\n| groupdesc | VARCHAR(200) | ç¾¤ç»„æè¿° | DEFAULT ''                 |\n\nGroupUserè¡¨\n\n| å­—æ®µåç§°      | å­—æ®µç±»å‹                      | å­—æ®µè¯´æ˜   | çº¦æŸ               |\n| --------- | ------------------------- | ------ | ---------------- |\n| groupid   | INT                       | ç¾¤ç»„id   | PRIMARY KEY      |\n| userid    | INT                       | ç¾¤ç»„æˆå‘˜id | NOT NULL         |\n| grouprole | ENUM('creator', 'normal') | ç¾¤ç»„èº«ä»½   | DEFAULT 'normal' |\nOfflineMessageè¡¨\n\n| å­—æ®µåç§°    | å­—æ®µç±»å‹         | å­—æ®µè¯´æ˜          | çº¦æŸ          |\n| ------- | ------------ | ------------- | ----------- |\n| userid  | INT          | ç”¨æˆ·id          | PRIMARY KEY |\n| message | VARCHAR(500) | ç¦»çº¿æ¶ˆæ¯ï¼ˆJSONå­—ç¬¦ä¸²ï¼‰ | NOT NULL    |\n# ä¸šåŠ¡æ¨¡å—\n\n## ï¼ˆâ­ï¼‰ä¸šåŠ¡æ¨¡å—ä¸ç½‘ç»œæ¨¡å—è§£è€¦ - å›è°ƒ\n\nè€ƒè™‘é—®é¢˜ï¼š\nç½‘ç»œæ¨¡å—æ”¶åˆ°çš„æ¶ˆæ¯å¦‚ä½•æ´¾å‘åˆ°ä¸šåŠ¡æ¨¡å—ï¼Ÿ\n\nè®©ç½‘ç»œæ¨¡å—çš„ä»£ç å’Œä¸šåŠ¡æ¨¡å—çš„ä»£ç è§£è€¦ã€‚\n\nå‡è®¾æœ‰ä¸€ä¸ªç”¨æˆ·åœ¨åšç™»å½•ä¸šåŠ¡ï¼Œç™»å½•ä¸šåŠ¡åŒ…å«`messageID`ï¼Œ`name`ï¼Œ`password`ï¼Œè¦éªŒè¯ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®ã€‚\n\nè§£è€¦çš„æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š\n1. ä½¿ç”¨åŸºäºé¢å‘æ¥å£çš„ç¼–ç¨‹ã€‚ï¼ˆæŠ½è±¡åŸºç±»ï¼‰\n2. **åŸºäºå›è°ƒå‡½æ•°**çš„æ“ä½œã€‚\n## ä¸šåŠ¡ç±»å‹\n1. ç™»å½• - `LOGIN_MSG/ACK`\n2. æ³¨å†Œ - `REG_MSG/ACK`\n3. åŠ å¥½å‹ - `ADD_FRIEND_MSG`\n4. ä¸€å¯¹ä¸€èŠå¤© - `ONE_CHAT_MSG`\n5. åˆ›å»ºç¾¤ç»„ - `CREATE_GROUP_MSG`\n6. åŠ å…¥ç¾¤ç»„ - `ADD_GROUP_MSG`\n7. ç¾¤èŠ - `GROUP_CHAT_MSG`\n\n```cpp\n#ifndef PUBLIC_H\n#define PUBLIC_H\n/* serverå’Œclientçš„å…¬å…±æ–‡ä»¶ */\n\nenum EnMsgType  //Enè¡¨ç¤ºEnumæšä¸¾\n{\n    LOGIN_MSG = 1,      //ç™»å½• æ¶ˆæ¯id, ä¸chatserviceä¸­çš„loginæ–¹æ³•ç»‘å®š\n    LOGIN_MSG_ACK,      //ç™»å½•å“åº”\n\n    REG_MSG,            //æ³¨å†Œ æ¶ˆæ¯id, ä¸chatserviceä¸­çš„regæ–¹æ³•ç»‘å®š\n    REG_MSG_ACK,        //æ³¨å†Œå“åº”\n\n    ADD_FRIEND_MSG,     //æ·»åŠ å¥½å‹\n    ONE_CHAT_MSG,       //ä¸€å¯¹ä¸€èŠå¤©\n\n    CREATE_GROUP_MSG,   //åˆ›å»ºç¾¤ç»„\n    ADD_GROUP_MSG,      //åŠ å…¥ç¾¤ç»„\n    GROUP_CHAT_MSG      //ç¾¤èŠ\n};\n\nenum EnLoginErrType\n{\n    LOGIN_SUCCEESS = 0,\n    LOGIN_REPEAT = 1,\n    LOGIN_NOTFOUND = 2,\n    LOGIN_WRONGPWD = 3\n};\n#endif\n```\n### ä¸šåŠ¡æ¶ˆæ¯å¯¹åº”çš„JSONæ ¼å¼\n\n| ä¸šåŠ¡ç±»å‹         | JSONç¤ºä¾‹                                                     |\n| ---------------- | ------------------------------------------------------------ |\n| ç™»å½•è¯·æ±‚æ¶ˆæ¯     | `\"msgid\":1,\"id\":22,\"password\":\"123\"`                         |\n| ç™»å½•å“åº”æ¶ˆæ¯     | `\"msgid\":2,\"errno\":0,\"id\":22,\"name\":\"xcg\"`æˆ–`\"msgid\":2,\"errno\":1,\"errmsg\":\"this account is online!\"`æˆ–`\"msgid\":2,\"errno\":2,\"errmsg\":\"id not found!\"`æˆ–`\"msgid\":2,\"errno\":3,\"errmsg\":\"password wrong!\"` |\n| æ³¨å†Œè¯·æ±‚æ¶ˆæ¯     | `\"msgid\":3,\"name\":\"xcg\",\"password\":\"123\"`                    |\n| æ³¨å†Œå“åº”æ¶ˆæ¯     | `\"msgid\":4,\"errno\":0,\"id\":22`æˆ–`\"msgid\":4,\"errno\":1`         |\n| åŠ å¥½å‹è¯·æ±‚æ¶ˆæ¯   | `\"msgid\":5,\"friendid\":12`                                    |\n| ä¸€å¯¹ä¸€èŠå¤©æ¶ˆæ¯   | `\"msgid\":6,\"to\":12,\"msg\":\"hello!\"`                           |\n| åˆ›å»ºç¾¤ç»„è¯·æ±‚æ¶ˆæ¯ | `\"msgid\":7,\"groupname\":\"group1\",\"groupdesc\":\"this is a group.\"` |\n| åŠ å…¥ç¾¤ç»„è¯·æ±‚æ¶ˆæ¯ | `\"msgid\":8,\"id\":22,\"groupid\":10`                             |\n| ç¾¤èŠè¯·æ±‚æ¶ˆæ¯     | `\"msgid\":9,\"id\":22,\"groupid\":10,\"msg\":\"hello, everyone!\"`    |\n| æ³¨é”€è¯·æ±‚æ¶ˆæ¯     | `\"msgid\":10,\"id\":22`                                         |\n## ChatService\n\n### å‰ç½®å¤„ç†\n\n```cpp\n#include\"json.hpp\"\nusing json = nlohmann::json;\n```\n\n```cpp\n/* è¡¨ç¤ºå¤„ç†æ¶ˆæ¯çš„äº‹ä»¶å›è°ƒæ–¹æ³•ç±»å‹ */\nusing MsgHandler = std::function<void(const TcpConnectionPtr&, json&, Timestamp)>;\n```\n\n### æˆå‘˜å±æ€§\n#### `m_msgHandlerMap`\næ˜¯ä¸€ä¸ª`unordered_map<int, MsgHandler> `\n\næ˜ å°„æ¶ˆæ¯ç±»å‹id å’Œ äº‹ä»¶å›è°ƒå‡½æ•°\n\nåœ¨å¯åŠ¨ä¸šåŠ¡æœåŠ¡ä¹‹å‰ï¼Œé‡Œé¢çš„key valueéƒ½æå‰æ·»åŠ å¥½äº†ï¼Œä¸ç”¨å¤„ç†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚\n\n```cpp\nprivate:\n   /* å­˜å‚¨æ¶ˆæ¯idå’Œå…¶å¯¹åº”çš„ä¸šåŠ¡å¤„ç†æ–¹æ³• */\n   unordered_map<int, MsgHandler> m_msgHandlerMap;\n```\n\n#### `m_userConnectionMap`\næ˜¯ä¸€ä¸ª`unordered_map<int, TcpConnectionPtr>`\n\nå­˜å‚¨åœ¨çº¿ç”¨æˆ·çš„é€šä¿¡è¿æ¥çŠ¶æ€ã€‚è¿™æ˜¯èŠå¤©æœåŠ¡å™¨å®ç°**é•¿è¿æ¥çš„åŸºç¡€**ã€‚\n\néœ€è¦å¤„ç†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚\n\n```cpp\nprivate:\n   /* å­˜å‚¨åœ¨çº¿ç”¨æˆ·çš„é€šä¿¡è¿æ¥ */\n   unordered_map<int, TcpConnectionPtr> m_userConnectionMap;\n```\n\n#### `mutex m_connMutex`\nå®šä¹‰äº’æ–¥é”ï¼Œä¿è¯`m_userConnectionMap`çš„çº¿ç¨‹å®‰å…¨\n\n```cpp\nprivate:\n   /* å®šä¹‰äº’æ–¥é”ï¼Œä¿è¯m_userConnectionMapçš„çº¿ç¨‹å®‰å…¨ */\n   mutex _connMutex;\n```\n#### æ•°æ®æ“ä½œç±»å¯¹è±¡\n   1. UserModel - `m_userModel`\n   2. OfflineMsgModel - `m_offlineMsgModel`\n   3. FriendModel - `friendModel`\n   4. GroupModel - `groupModel`\n\n```cpp\nprivate:\n   UserModel       _userModel;         /* æ•°æ®æ“ä½œç±»å¯¹è±¡ */\n   OfflineMsgModel _offlineMsgModel;   /* æ•°æ®æ“ä½œç±»å¯¹è±¡ */\n   FriendModel     _friendModel;       /* æ•°æ®æ“ä½œç±»å¯¹è±¡ */\n   GroupModel      _groupModel;        /* æ•°æ®æ“ä½œç±»å¯¹è±¡ */\n```\n### æˆå‘˜å‡½æ•°\n#### æ„é€ å‡½æ•°ï¼ˆâ­å•ä¾‹ï¼‰\nç§æœ‰åŒ–, å•ä¾‹å¤„ç†\n```cpp\npublic:\n   static ChatService * instance();\nprivate:\n   ChatService();\n```\n#### ä¸šåŠ¡æ¥å£\n   1. login - ç™»é™†ä¸šåŠ¡\n   2. reg - æ³¨å†Œä¸šåŠ¡\n   3. addFriend - æ·»åŠ å¥½å‹ä¸šåŠ¡\n   4. oneChat - ä¸€å¯¹ä¸€èŠå¤©ä¸šåŠ¡\n   5. createGroup - åˆ›å»ºç¾¤ç»„ä¸šåŠ¡\n   6. addGroup - åŠ å…¥ç¾¤ç»„ä¸šåŠ¡\n   7. groupChat - ç¾¤ç»„èŠå¤©ä¸šåŠ¡\n\n```cpp\npublic:\n   /* å¤„ç†ç™»å½•ä¸šåŠ¡ */\n   void login(const TcpConnectionPtr &conn, json &js, Timestamp time);\n   /* å¤„ç†æ³¨å†Œä¸šåŠ¡ */\n   void reg(const TcpConnectionPtr &conn, json &js, Timestamp time);\n\n   /* æ·»åŠ å¥½å‹ä¸šåŠ¡ */\n   void addFriend(const TcpConnectionPtr &conn, json &js, Timestamp time);\n   /* ä¸€å¯¹ä¸€èŠå¤©ä¸šåŠ¡ */\n   void oneChat(const TcpConnectionPtr &conn, json &js, Timestamp time);\n\n   /* åˆ›å»ºç¾¤ç»„ä¸šåŠ¡ */\n   void createGroup(const TcpConnectionPtr &conn, json &js, Timestamp time);\n   /* åŠ å…¥ç¾¤ç»„ä¸šåŠ¡ */\n   void addGroup(const TcpConnectionPtr &conn, json &js, Timestamp time);\n   /* ç¾¤ç»„èŠå¤©ä¸šåŠ¡ */\n   void groupChat(const TcpConnectionPtr &conn, json &js, Timestamp time);\n   ```\n#### getHandler\nè·å–æ¶ˆæ¯å¯¹åº”çš„å¤„ç†å™¨\n```cpp\npublic:\n   /* è·å–æ¶ˆæ¯å¯¹åº”çš„å¤„ç†å™¨ */\n   MsgHandler getHandler(int msgid);\n```\n#### clientCloseException\nå¤„ç†å®¢æˆ·ç«¯å¼‚å¸¸é€€å‡º\n```cpp\npublic:\n   /* å¤„ç†å®¢æˆ·ç«¯å¼‚å¸¸é€€å‡º */\n   void clientCloseException(const TcpConnectionPtr & conn);\n```\n#### reset\nä¸šåŠ¡é‡ç½®æ–¹æ³•ï¼Œé€šå¸¸åœ¨æœåŠ¡å™¨å¼‚å¸¸é€€å‡ºæ—¶è°ƒç”¨\n   ```cpp\n   public:\n       /* ä¸šåŠ¡é‡ç½®æ–¹æ³•ï¼Œé€šå¸¸åœ¨æœåŠ¡å™¨å¼‚å¸¸é€€å‡ºæ—¶è°ƒç”¨ */\n       void reset();\n   ```\n### å¤´æ–‡ä»¶\n\n```cpp\n#ifndef CHATSERVICE_H\n#define CHATSERVICE_H\n#include<muduo/net/TcpConnection.h>\n#include<unordered_map>\n#include<functional>\n\n#include\"usermodel.hpp\"\n#include\"offlinemsgmodel.hpp\"\n#include\"friendmodel.hpp\"\n#include\"groupmodel.hpp\"\n\nusing namespace std;\nusing namespace muduo;\nusing namespace muduo::net;\n#include\"json.hpp\"\nusing json = nlohmann::json;\n\n#include<mutex>\n\n/* è¡¨ç¤ºå¤„ç†æ¶ˆæ¯çš„äº‹ä»¶å›è°ƒæ–¹æ³•ç±»å‹ */\nusing MsgHandler = std::function<void(const TcpConnectionPtr&, json&, Timestamp)>;\n/**\n * èŠå¤©æœåŠ¡å™¨ä¸šåŠ¡ç±». \n * ç”¨æ˜ å°„å…³ç³»æ¥å­˜å‚¨æ¶ˆæ¯idå’Œå…·ä½“å¤„ç†å‡½æ•°. \n * æ­¤ç±»æœ‰ä¸€ä¸ªå®ä¾‹å°±å¤Ÿäº†ï¼Œæ‰€ä»¥é‡‡ç”¨å•ä¾‹æ¨¡å¼. \n */\nclass ChatService\n{\npublic:\n    /* è·å–å•ä¾‹å¯¹è±¡çš„æ¥å£å‡½æ•° */\n    static ChatService* instance();\npublic:\n    /* å¤„ç†ç™»å½•ä¸šåŠ¡ */\n    void login(const TcpConnectionPtr &conn, json &js, Timestamp time);\n    /* å¤„ç†æ³¨å†Œä¸šåŠ¡ */\n    void reg(const TcpConnectionPtr &conn, json &js, Timestamp time);\n\n    /* æ·»åŠ å¥½å‹ä¸šåŠ¡ */\n    void addFriend(const TcpConnectionPtr &conn, json &js, Timestamp time);\n    /* ä¸€å¯¹ä¸€èŠå¤©ä¸šåŠ¡ */\n    void oneChat(const TcpConnectionPtr &conn, json &js, Timestamp time);\n\n    /* åˆ›å»ºç¾¤ç»„ä¸šåŠ¡ */\n    void createGroup(const TcpConnectionPtr &conn, json &js, Timestamp time);\n    /* åŠ å…¥ç¾¤ç»„ä¸šåŠ¡ */\n    void addGroup(const TcpConnectionPtr &conn, json &js, Timestamp time);\n    /* ç¾¤ç»„èŠå¤©ä¸šåŠ¡ */\n    void groupChat(const TcpConnectionPtr &conn, json &js, Timestamp time);\npublic:\n    /* è·å–æ¶ˆæ¯å¯¹åº”çš„å¤„ç†å™¨ */\n    MsgHandler getHandler(int msgid);\npublic:\n    /* å¤„ç†å®¢æˆ·ç«¯å¼‚å¸¸é€€å‡º */\n    void clientCloseException(const TcpConnectionPtr & conn);\npublic:\n    /* ä¸šåŠ¡é‡ç½®æ–¹æ³•ï¼Œé€šå¸¸åœ¨æœåŠ¡å™¨å¼‚å¸¸é€€å‡ºæ—¶è°ƒç”¨ */\n    void reset();\n\nprivate:\n    ChatService();\nprivate:\n    UserModel       _userModel;         /* æ•°æ®æ“ä½œç±»å¯¹è±¡ */\n    OfflineMsgModel _offlineMsgModel;   /* æ•°æ®æ“ä½œç±»å¯¹è±¡ */\n    FriendModel     _friendModel;       /* æ•°æ®æ“ä½œç±»å¯¹è±¡ */\n    GroupModel      _groupModel;        /* æ•°æ®æ“ä½œç±»å¯¹è±¡ */\nprivate:\n    /* å®šä¹‰äº’æ–¥é”ï¼Œä¿è¯m_userConnectionMapçš„çº¿ç¨‹å®‰å…¨ */\n    mutex _connMutex;\nprivate:\n    /* å­˜å‚¨æ¶ˆæ¯idå’Œå…¶å¯¹åº”çš„ä¸šåŠ¡å¤„ç†æ–¹æ³• */\n    unordered_map<int, MsgHandler> _msgHandlerMap;\n    /* å­˜å‚¨åœ¨çº¿ç”¨æˆ·çš„é€šä¿¡è¿æ¥ */\n    unordered_map<int, TcpConnectionPtr> _userConnectionMap;\n};\n#endif\n```\n## ï¼ˆâ­ï¼‰ç™»å½•ä¸šåŠ¡éœ€è¦å¤„ç†çš„é•¿è¿æ¥é—®é¢˜ã€çº¿ç¨‹å®‰å…¨é—®é¢˜\néœ€è¦ChatServiceç±»ä¸­æœ‰ä¸€ä¸ªè®°å½•ç”¨æˆ·çš„è¿æ¥çŠ¶æ€æ‰è¡Œã€‚\nå› ä¸ºèŠå¤©æœåŠ¡å™¨éœ€è¦ä¿æŒä¸€ä¸ªç»™ç”¨æˆ·æ¨é€æ¶ˆæ¯çš„çŠ¶æ€ã€‚\n```cpp\nprivate:\n    unordered_map<int, TcpConnectionPtr> _userConnMap;\n    mutex _connMutex;\n```\n\n```cpp\n/* å¤„ç†ç™»å½•ä¸šåŠ¡ */\nvoid ChatService::login(const TcpConnectionPtr &conn,\n                        json &js, Timestamp time)\n{\n    /* ä»jsonå‚æ•°è·å–è´¦å·ã€å¯†ç ä¿¡æ¯ */\n    int id = js[\"id\"].get<int>();\n    string password = js[\"password\"];\n    User user = _userModel.query(id);\n\n    json response;\n    response[\"msgid\"] = LOGIN_MSG_ACK;\n    if(user.getId() == id && user.getPassword() == password)\n    {\n        if(user.getState() == \"online\")\n        {\n            /* è¯¥ç”¨æˆ·å·²ç»ç™»å½•åœ¨çº¿ï¼Œä¸å…è®¸é‡å¤ç™»é™† */\n            response[\"errno\"] = LOGIN_REPEAT;\n            response[\"errmsg\"] = \"è¯¥ç”¨æˆ·å·²ç»ç™»å½•\";\n        }\n        else if(user.getState() == \"offline\")\n        {\n            /* ç™»é™†æˆåŠŸ */\n            {\n                /* è®°å½•ç”¨æˆ·è¿æ¥ä¿¡æ¯ */\n                lock_guard<mutex> lock(_connMutex);\n                _userConnectionMap.insert({id, conn});\n            }\n#ifdef __CLUSTER__\n            /**\n             * é›†ç¾¤ç¯å¢ƒä¸‹, å‘redisè®¢é˜…æ­¤id \n             */\n            m_redis.subscribe(id);\n#endif\n            /* æ›´æ–°ç”¨æˆ·çŠ¶æ€ä¿¡æ¯ */\n            user.setState(\"online\");\n            _userModel.updateState(user);\n\n            response[\"errno\"] = LOGIN_SUCCEESS;\n            response[\"id\"] = user.getId();\n            response[\"name\"] = user.getName();\n            /* æŸ¥è¯¢è¯¥ç”¨æˆ·æ˜¯å¦åœ¨ç¦»çº¿æ—¶æœªæ”¶åˆ°çš„æ¶ˆæ¯ */\n            vector<string> offlineMsgVec = _offlineMsgModel.query(id);\n            if(!offlineMsgVec.empty())\n            {\n                response[\"offlinemsg\"] = offlineMsgVec;\n                /* æŠŠè¯¥ç”¨æˆ·çš„æ‰€æœ‰ç¦»çº¿æ¶ˆæ¯ä»ä»æ•°æ®ä¸­åˆ é™¤æ‰ */\n                _offlineMsgModel.remove(id);\n            }\n            /* æŸ¥è¯¢è¯¥ç”¨æˆ·çš„å¥½å‹ä¿¡æ¯ï¼Œå¹¶è¿”å› */\n            vector<User> userVec = _friendModel.query(id);\n            if(!userVec.empty())\n            {\n                vector<string> friendJsonInfoVec;\n                for(User &user : userVec)\n                {\n                    json js;\n                    js[\"id\"] = user.getId();\n                    js[\"name\"] = user.getName();\n                    js[\"state\"] = user.getState();\n                    friendJsonInfoVec.push_back(js.dump());\n                }\n                response[\"friends\"] = friendJsonInfoVec;\n            }\n        }\n    }\n    else if(user.getId() != id)\n    {\n        /* ç™»å½•å¤±è´¥ï¼Œç”¨æˆ·ä¸å­˜åœ¨ */\n        response[\"errno\"] = LOGIN_NOTFOUND;\n        response[\"errmsg\"] = \"ç”¨æˆ·ä¸å­˜åœ¨\";\n    }\n    else if(user.getPassword() != password)\n    {\n        /* ç™»å½•å¤±è´¥ï¼Œå¯†ç ä¸åŒ¹é… */\n        response[\"errno\"] = LOGIN_WRONGPWD;\n        response[\"errmsg\"] = \"å¯†ç éªŒè¯å¤±è´¥\";\n    }\n    conn->send(response.dump());\n}\n```\n## ï¼ˆâ­ï¼‰ç¦»çº¿æ¶ˆæ¯çš„å¤„ç†ï¼ˆåŒ…æ‹¬é›†ç¾¤ç¯å¢ƒä¸‹ï¼‰\nç”¨OfflineMessageæ•°æ®è¡¨å­˜å‚¨ç¦»çº¿æ¶ˆæ¯ã€‚\nå½“ç”¨æˆ·ç™»é™†æ—¶ï¼ŒChatServiceå»æ•°æ®è¡¨æŸ¥è¯¢æ˜¯å¦æœ‰è¯¥ç”¨æˆ·idçš„ç¦»çº¿æ¶ˆæ¯ã€‚å¦‚æœæœ‰ï¼Œåˆ™æ¨é€ã€‚\n\nå½“å¤„äºé›†ç¾¤ç¯å¢ƒæ—¶ï¼ŒæŸä¸€å°æœåŠ¡å™¨ä¸­çš„`_userConnectionMap`åªè®°å½•äº†åœ¨è¯¥æœåŠ¡å™¨åœ¨çº¿çš„ç”¨æˆ·ï¼Œ\næ‰€ä»¥ç”¨æˆ·å¯èƒ½åœ¨æœ¬æœåŠ¡å™¨offlineï¼Œè€Œåœ¨å…¶ä»–æœåŠ¡å™¨ä¸Šonlineï¼Œ\næ‰€ä»¥çœŸå®çš„åœ¨çº¿çŠ¶æ€åº”è¯¥å»æ•°æ®åº“çš„`User`è¡¨ä¸­æŸ¥è¯¢ï¼ˆ`_userModel.query(id); user.getState() == \"online\";`ï¼‰\nå¦‚æœçœŸçš„æ˜¯offlineï¼Œåˆ™æ‰å­˜å‚¨ç¦»çº¿æ¶ˆæ¯ã€‚\n\n```cpp\n/* ä¸€å¯¹ä¸€èŠå¤©ä¸šåŠ¡ */\nvoid ChatService::oneChat(const TcpConnectionPtr &conn, json &js, Timestamp time)\n{\n    int to = js[\"to\"].get<int>();\n    {\n        lock_guard<mutex> lock(_connMutex);\n        auto it = _userConnectionMap.find(to);\n        if(it != _userConnectionMap.end())\n        {\n            /* æ¥æ”¶æ–¹åœ¨çº¿ï¼Œè½¬å‘æ¶ˆæ¯ */\n            /* æœåŠ¡å™¨ä¸»åŠ¨æ¨é€æ¶ˆæ¯ç»™æ¥æ”¶æ–¹ */\n            it->second->send(js.dump());    // it->second è¡¨ç¤º \n            return;\n        }\n    }\n#ifdef __CLUSTER__\n    /**\n     * é›†ç¾¤ç¯å¢ƒä¸‹, éœ€è¦æŸ¥è¯¢å¯¹æ–¹(to)æ˜¯å¦åœ¨çº¿;\n     * ä¸å¯é€šè¿‡æœåŠ¡å™¨connMapæŸ¥è¯¢, æ˜¯é€šè¿‡æ•°æ®åº“ä¿¡æ¯;\n     */\n    User user = _userModel.query(to);\n    if(user.getState() == \"online\")\n    {\n        m_redis.publish(to, js.dump());\n        return;\n    }\n#endif\n    /* æ¥æ”¶æ–¹ç¦»çº¿ï¼Œå­˜å‚¨ç¦»çº¿æ¶ˆæ¯ */\n    _offlineMsgModel.insert(to, js.dump());\n}\n```\n\n```cpp\n/* ç¾¤ç»„èŠå¤©ä¸šåŠ¡ */\nvoid ChatService::groupChat(const TcpConnectionPtr &conn, json &js, Timestamp time)\n{\n    int userid = js[\"id\"].get<int>();\n    int groupid = js[\"groupid\"].get<int>();\n    vector<int> useridVec = _groupModel.queryGroupUsers(userid, groupid);\n\n    bool offline = true;\n    bool reallyOffline = true;\n    for(int id : useridVec)\n    {\n        {\n            lock_guard<mutex> lock(_connMutex);\n            auto it = _userConnectionMap.find(id);\n            if(it != _userConnectionMap.end())//åœ¨æœ¬å°æœåŠ¡å™¨ä¸Šçº¿\n            {\n                offline = false;\n                reallyOffline = false;\n                it->second->send(js.dump());\n            }\n        }\n#ifdef __CLUSTER__\n        if(offline)\n        {\n            /**\n             * é›†ç¾¤ç¯å¢ƒä¸‹, éœ€è¦åˆ¤æ–­å…¶æ˜¯å¦åœ¨å…¶ä»–æœåŠ¡å™¨ä¸Šåœ¨çº¿;\n             */\n            User user = _userModel.query(id);\n            if(user.getState() == \"online\")\n            {\n                reallyOffline = false;\n                m_redis.publish(id, js.dump());\n            }\n        }\n#endif\n        if(reallyOffline)\n        {\n            _offlineMsgModel.insert(id, js.dump());\n        }\n        reallyOffline = true;\n        offline = true;\n    }\n}\n```\n\n```cpp\n/* å¤„ç†ç™»å½•ä¸šåŠ¡ */\nvoid ChatService::login(const TcpConnectionPtr &conn,\n                        json &js, Timestamp time)\n{\n    /* ä»jsonå‚æ•°è·å–è´¦å·ã€å¯†ç ä¿¡æ¯ */\n    int id = js[\"id\"].get<int>();\n    string password = js[\"password\"];\n    User user = _userModel.query(id);\n\n    json response;\n    response[\"msgid\"] = LOGIN_MSG_ACK;\n    if(user.getId() == id && user.getPassword() == password)\n    {\n        if(user.getState() == \"online\")\n        {\n            /* è¯¥ç”¨æˆ·å·²ç»ç™»å½•åœ¨çº¿ï¼Œä¸å…è®¸é‡å¤ç™»é™† */\n            response[\"errno\"] = LOGIN_REPEAT;\n            response[\"errmsg\"] = \"è¯¥ç”¨æˆ·å·²ç»ç™»å½•\";\n        }\n        else if(user.getState() == \"offline\")\n        {\n            /* ç™»é™†æˆåŠŸ */\n            {\n                /* è®°å½•ç”¨æˆ·è¿æ¥ä¿¡æ¯ */\n                lock_guard<mutex> lock(_connMutex);\n                _userConnectionMap.insert({id, conn});\n            }\n#ifdef __CLUSTER__\n            /**\n             * é›†ç¾¤ç¯å¢ƒä¸‹, å‘redisè®¢é˜…æ­¤id \n             */\n            m_redis.subscribe(id);\n#endif\n            /* æ›´æ–°ç”¨æˆ·çŠ¶æ€ä¿¡æ¯ */\n            user.setState(\"online\");\n            _userModel.updateState(user);\n\n            response[\"errno\"] = LOGIN_SUCCEESS;\n            response[\"id\"] = user.getId();\n            response[\"name\"] = user.getName();\n            /* æŸ¥è¯¢è¯¥ç”¨æˆ·æ˜¯å¦åœ¨ç¦»çº¿æ—¶æœªæ”¶åˆ°çš„æ¶ˆæ¯ */\n            vector<string> offlineMsgVec = _offlineMsgModel.query(id);\n            if(!offlineMsgVec.empty())\n            {\n                response[\"offlinemsg\"] = offlineMsgVec;\n                /* æŠŠè¯¥ç”¨æˆ·çš„æ‰€æœ‰ç¦»çº¿æ¶ˆæ¯ä»ä»æ•°æ®ä¸­åˆ é™¤æ‰ */\n                _offlineMsgModel.remove(id);\n            }\n            /* æŸ¥è¯¢è¯¥ç”¨æˆ·çš„å¥½å‹ä¿¡æ¯ï¼Œå¹¶è¿”å› */\n            vector<User> userVec = _friendModel.query(id);\n            if(!userVec.empty())\n            {\n                vector<string> friendJsonInfoVec;\n                for(User &user : userVec)\n                {\n                    json js;\n                    js[\"id\"] = user.getId();\n                    js[\"name\"] = user.getName();\n                    js[\"state\"] = user.getState();\n                    friendJsonInfoVec.push_back(js.dump());\n                }\n                response[\"friends\"] = friendJsonInfoVec;\n            }\n        }\n    }\n    else if(user.getId() != id)\n    {\n        /* ç™»å½•å¤±è´¥ï¼Œç”¨æˆ·ä¸å­˜åœ¨ */\n        response[\"errno\"] = LOGIN_NOTFOUND;\n        response[\"errmsg\"] = \"ç”¨æˆ·ä¸å­˜åœ¨\";\n    }\n    else if(user.getPassword() != password)\n    {\n        /* ç™»å½•å¤±è´¥ï¼Œå¯†ç ä¸åŒ¹é… */\n        response[\"errno\"] = LOGIN_WRONGPWD;\n        response[\"errmsg\"] = \"å¯†ç éªŒè¯å¤±è´¥\";\n    }\n    conn->send(response.dump());\n}\n```\n# æ•°æ®æ¨¡å—\n\n## ï¼ˆâ­ï¼‰ä¸šåŠ¡æ¨¡å—ä¸æ•°æ®æ¨¡å—è§£è€¦ - ORMæ¡†æ¶\n\n> Object Relation Map - å¯¹è±¡å…³ç³»æ˜ å°„ã€‚\n\nåœ¨è¿™ä¸ªæ¡†æ¶ä¸­ï¼Œä¸šåŠ¡å±‚æ“ä½œçš„éƒ½æ˜¯å¯¹è±¡ï¼Œçœ‹ä¸åˆ°å…·ä½“çš„SQLæ“ä½œã€‚\n\nåœ¨DAOå±‚ï¼ˆæ•°æ®å±‚ï¼‰ï¼Œæ‰æœ‰å…·ä½“çš„æ•°æ®åº“æ“ä½œã€‚\n\nè§£å†³äº†ç—›ç‚¹ï¼šä¸šåŠ¡æ¨¡å—ã€æ•°æ®æ¨¡å—ä¹‹é—´çš„è§£è€¦ã€‚\n\n## æ­å»ºMySQLæ•°æ®åº“ç¯å¢ƒ\n\n(ä»¥ä¸‹å‘½ä»¤åŸºäºUbuntuç¯å¢ƒ)\n\n1. å®‰è£…mysql-serverå’Œmysqlå¼€å‘åŒ…, åŒ…æ‹¬mysqlå¤´æ–‡ä»¶å’ŒåŠ¨æ€åº“æ–‡ä»¶\n\n```bash\nsudo apt-get install mysql-server\t\t#å®‰è£…æœ€æ–°ç‰ˆMySQLæœåŠ¡å™¨\nsudo apt-get install libmysqlclient-dev #å®‰è£…å¼€å‘åŒ…\n```\n\n2. åˆå§‹çš„ç”¨æˆ·åå’Œå¯†ç æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼ŒæŒ‰ä¸‹é¢æ­¥éª¤ä¿®æ”¹mysqlçš„rootç”¨æˆ·å¯†ç ä¸º123456\n\n```bash\n~$ sudo cat /etc/mysql/debian.cnf\n\n[client]\nhost = localhost\nuser = debian-sys-maint \t\t\t#åˆå§‹çš„ç”¨æˆ·å\npassword = Kk3TbShbFNvjvhpM\t\t\t#åˆå§‹çš„å¯†ç \nsocket = /var/run/mysqld/mysqld.sock\n```\n\n```bash\n# ç”¨ä¸Šé¢åˆå§‹çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œç™»å½•mysql serverï¼Œä¿®æ”¹rootç”¨æˆ·çš„å¯†ç ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š\n~$ mysql -u debian-sys-maint -pKk3TbShbFNvjvhpM\n#-uåé¢æ˜¯ä¸Šé¢æŸ¥çœ‹çš„ç”¨æˆ·å; -påé¢ç´§è·Ÿä¸Šé¢æŸ¥çœ‹çš„å¯†ç \n```\n\næ›´æ”¹å¯†ç ï¼šå‚è€ƒ https://blog.csdn.net/mrcan666/article/details/124163537?spm=1001.2014.3001.5502\n\n3. è®¾ç½®MySQLå­—ç¬¦ç¼–ç utf-8ï¼Œä»¥æ”¯æŒä¸­æ–‡æ“ä½œ\n```mysql\nmysql> show variables like \"char%\"; # å…ˆæŸ¥çœ‹MySQLé»˜è®¤çš„å­—ç¬¦ç¼–ç \n+--------------------------+----------------------------+\n| Variable_name\t\t\t   | Value\t\t\t   \t\t\t|\n+--------------------------+----------------------------+\n| character_set_client     | utf8                       |\n| character_set_connection | utf8                       |\n| character_set_database   | latin1                     |\n| character_set_filesystem | binary                     |\n| character_set_results    | utf8                       |\n| character_set_server     | latin1                     |#ä¸æ”¯æŒä¸­æ–‡ï¼ï¼ï¼\n| character_set_system     | utf8                       |\n| character_sets_dir       | /usr/share/mysql/charsets/ |\n+--------------------------+----------------------------+\n8 rows in set (0.06 sec)\n\nmysql> set character_set_server=utf8;\nQuery OK, 0 rows affected (0.00 sec)\n```\n\n4. ä¿®æ”¹è¡¨çš„å­—ç¬¦ç¼–ç ï¼š`alter table user default character set utf8;`\n5. ä¿®æ”¹å±æ€§çš„å­—ç¬¦ç¼–ç ï¼š`alter table user modify column name varchar(50) character set utf8;`\n## MySQLç±» - å°è£…MySQLæ“ä½œ\n\néœ€è¦å¼•å…¥`mysql/mysql.h`å¤´æ–‡ä»¶\n```cpp\n#include<mysql/mysql.h>\n```\n### æˆå‘˜å˜é‡\n#### `MYSQL *m_conn`\nè®°å½•MYSQLç±»å‹çš„æŒ‡é’ˆ, ä»¥è·å–è¿™ä¸ªmysqlè¿æ¥\n```cpp\nprivate:\n    MYSQL *m_conn;\n```\n### æˆå‘˜å‡½æ•°\n#### æ„é€ /ææ„\nåˆå§‹åŒ–/é‡Šæ”¾æ•°æ®åº“è¿æ¥\n```cpp\npublic:\n   /* åˆå§‹åŒ–æ•°æ®åº“è¿æ¥ */\n   MySQL();\n   /* é‡Šæ”¾æ•°æ®åº“è¿æ¥èµ„æº */\n   ~MySQL();\n```\n#### getConnection\nè·å–è¿æ¥, å³è·å–æˆå‘˜`m_conn`\n```cpp\npublic:\n   /* è·å–è¿æ¥ */\n   MYSQL * getConnection();\n```\n#### connect\nè¿æ¥æ•°æ®åº“, è¿”å›å€¼ä¸ºbool, è¯´æ˜è¿æ¥æˆåŠŸä¸å¦\n```cpp\npublic:\n   /* è¿æ¥æ•°æ®åº“ */\n   bool connect();\n```\n#### query\næŸ¥è¯¢æ“ä½œ, å‚æ•°æ˜¯stringç±»å‹çš„sqlè¯­å¥, è¿”å›å€¼ä¸º`MYSQL_RES`, å³MySQLç»“æœé›†ç±»å‹\n```cpp\npublic:\n   /* æŸ¥è¯¢æ“ä½œ */\n   MYSQL_RES * query(string sql);\n```\n#### update\næ›´æ–°æ“ä½œ, å‚æ•°æ˜¯stringç±»å‹çš„sqlè¯­å¥, è¿”å›å€¼ä¸ºbool, è¯´æ˜æ›´æ–°æˆåŠŸä¸å¦\n   ```cpp\n   public:\n       /* æ›´æ–°æ“ä½œ */\n       bool update(string sql);\n   ```\n### ä»£ç å®ç°\n\nå‰ç½®å…¨å±€å£°æ˜\n```cpp\n#include <muduo/base/Logging.h>\t//æ—¥å¿—å·¥å…·\n/* æ•°æ®åº“é…ç½®ä¿¡æ¯ */\nstatic string server = \"127.0.0.1\";\nstatic string user = \"root\";\nstatic string password = \"123\";\nstatic string dbname = \"chat\";\n```\n#### æ„é€ \nè°ƒç”¨`mysql_init`, å®é™…ä¸Šåªæ˜¯å¯¹mysqlè¿æ¥è¿›è¡Œç©ºé—´èµ„æºçš„å¼€è¾Ÿ, è¿”å›ä¸€ä¸ªæŒ‡é’ˆèµ‹ç»™`m_conn`æˆå‘˜, æ²¡æœ‰çœŸæ­£è¿æ¥, å› æ­¤ä¼ å…¥nullptr\n   ```cpp\n   /* åˆå§‹åŒ–æ•°æ®åº“è¿æ¥ */\n   MySQL::MySQL()\n   {\n       m_conn = mysql_init(nullptr);\n   }\n   ```\n#### ææ„\nè°ƒç”¨`mysql_close(m_conn)`, å¯¹MySQLè¿æ¥èµ„æºè¿›è¡Œé‡Šæ”¾\n   ```cpp\n   /* é‡Šæ”¾æ•°æ®åº“è¿æ¥èµ„æº */\n   MySQL::~MySQL()\n   {\n       if(m_conn != nullptr)\n       {\n           mysql_close(m_conn);\n       }\n   }\n   ```\n#### getConnection\nè·å–è¿æ¥, å³è¿”å›`m_conn`æˆå‘˜\n   ```cpp\n   /* è·å–è¿æ¥ */\n   MYSQL * MySQL::getConnection()\n   {\n       return m_conn;\n   }\n   ```\n#### connect\nè¿æ¥æ•°æ®åº“, å†…éƒ¨è°ƒç”¨`mysql_real_connect`, ä¼ å…¥`m_conn`, ä»¥åŠserveråœ°å€, userå·, å¯†ç , è¦è¿æ¥çš„æ•°æ®åº“name, æœåŠ¡å™¨ç«¯å£;\n   ```cpp\n   /* è¿æ¥æ•°æ®åº“ */\n   bool MySQL::connect()\n   {\n       MYSQL *p = mysql_real_connect(m_conn, server.c_str(), user.c_str(),\n                                     password.c_str(), dbname.c_str(), 3306, nullptr, 0);\n       if(p != nullptr)\n       {\n           /* C/C++ä»£ç é»˜è®¤çš„ç¼–ç å­—ç¬¦æ˜¯ASCIIï¼Œå¦‚æœä¸è®¾ç½®ï¼Œåˆ™ä»MySQLä¸Šæ‹‰ä¸‹æ¥çš„ä¸­æ–‡æ— æ³•æ­£å¸¸æ˜¾ç¤º */\n           mysql_query(m_conn, \"set name gbk\");\n           LOG_INFO << \"connect mysql success!\";\n       }\n       else\n       {\n           LOG_INFO << \"connect mysql failed!\";\n       }\n       return p;\n   }\n   ```\n#### query\næŸ¥è¯¢æ“ä½œ\n\n1. å†…éƒ¨è°ƒç”¨`mysql_query`, ä¼ å…¥`m_conn`, `sql-string`çš„Cé£æ ¼å­—ç¬¦ä¸²é¦–å€ï¼›\n    1. `mysql_query`çš„è¿”å›å€¼ï¼š\n        1. å¦‚æœæŸ¥è¯¢æˆåŠŸï¼Œè¿”å›0;\n        2. å¦‚æœå‡ºç°é”™è¯¯ï¼Œè¿”å›é0å€¼ã€‚\n        3. è¿”å›å€¼éœ€è¦è°ƒç”¨`mysql_use_result(m_conn)`è·å–ç»“æœé›†, å†return\n\n```cpp\n/* æŸ¥è¯¢æ“ä½œ */\nMYSQL_RES * MySQL::query(string sql)\n{\n    if (mysql_query(m_conn, sql.c_str()))\n    {\n        LOG_INFO << __FILE__ << \":\" << __LINE__ << \":\" << sql << \"æŸ¥è¯¢å¤±è´¥!\";\n        return nullptr;\n    }\n    return mysql_use_result(m_conn);\n}\n```\n\n2. update - æ›´æ–°æ“ä½œ\n    1. å†…éƒ¨è°ƒç”¨`mysql_query`, ä¼ å…¥`m_conn`, `sql-string`çš„Cé£æ ¼å­—ç¬¦ä¸²é¦–å€;\n    2. åˆ¤æ–­`mysql_query`çš„è¿”å›å€¼, è‹¥ä¸º**é 0 åˆ™æ›´æ–°å¤±è´¥**; è‹¥ä¸º **0 åˆ™æ›´æ–°æˆåŠŸ**;\n\n```cpp\n/* æ›´æ–°æ“ä½œ */\nbool MySQL::update(string sql)\n{\n    if (mysql_query(m_conn, sql.c_str()))\n    {\n        LOG_INFO << __FILE__ << \":\" << __LINE__ << \":\" << sql << \"æ›´æ–°å¤±è´¥!\";\n        return false;\n    }\n    return true;\n}\n```\n\n## Modelå±‚ - å¯¹ä¸šåŠ¡å±‚å°è£…åº•å±‚æ•°æ®åº“çš„æ“ä½œ\n\nä»¥Userç±»çš„æ“ä½œä¸ºä¾‹\n### Userç±»\n\n```cpp\n#ifndef USER_H\n#define USER_H\n#include<string>\nusing namespace std;\n/**\n * å±äºæ˜ å°„ç±»;\n * åŒ¹é…Userè¡¨çš„ORMç±»;\n */\nclass User\n{\npublic:\n    User(int id = -1, string name=\"\", string password=\"\", string state=\"offline\")\n        : id_(id), name_(name), password_(password), state_(state)\n    {   \n    }\npublic:\n    void setId(int id){id_ = id;}\n    void setName(string name){name_ = name;}\n    void setPassword(string password){password_ = password;}\n    void setState(string state){state_ = state;}\npublic:\n    int getId() const{return id_;}\n    string getName() const{return name_;}\n    string getPassword() const{return password_;}\n    string getState() const{return state_;}\nprivate:\n    int id_;\n    string name_;\n    string password_;\n    string state_;\n};\n#endif\n```\n### UserModelç±»\n\n1. insert - å‚æ•°ä¸ºUserçš„å¼•ç”¨, è¿”å›å€¼ä¸ºbool\n2. query - å‚æ•°ä¸ºid, è¿”å›å€¼ä¸ºUser\n3. updateState - æ›´æ–°ç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯, å‚æ•°ä¸ºUserçš„ä¸€ä¸ªä¸´æ—¶å‰¯æœ¬, è¿”å›bool\n4. resetAllState - é‡ç½®æ‰€æœ‰ç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯\n\n```cpp\n#ifndef USERMODEL_H\n#define USERMODEL_H\n#include\"user.hpp\"\n/* Userè¡¨çš„æ•°æ®æ“ä½œç±» */\nclass UserModel\n{\npublic:\n    /* Userè¡¨çš„å¢åŠ æ–¹æ³• */\n    bool insert(User &user);\npublic:\n    /* æ ¹æ®ç”¨æˆ·å·ç æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ */\n    User query(int id);\npublic:\n    /* æ›´æ–°ç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯ */\n    bool updateState(User user);\n    /* é‡ç½®æ‰€æœ‰ç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯ */\n    void resetAllState();\n};\n#endif\n```\n### ä»£ç å®ç°\n\n```cpp\n#include\"usermodel.hpp\"\n#include\"db.h\"\n#include<iostream>\nusing namespace std;\n/* Userè¡¨çš„å¢åŠ æ–¹æ³• */\nbool UserModel::insert(User &user)\n{\n    /* 1.ç»„è£…SQLè¯­å¥ */\n    char sql[1024] = {0};\n    sprintf(sql, \"insert into user(name, password, state) values('%s', '%s', '%s')\",\n        user.getName().c_str(), user.getPassword().c_str(), user.getState().c_str());\n    MySQL mysql;\n    if(mysql.connect())\n    {\n        if(mysql.update(sql))\n        {\n            /* è·å–æ’å…¥æˆåŠŸçš„ç”¨æˆ·æ•°æ®ç”Ÿæˆçš„ä¸»é”®id */\n            /* ä»¥ä¸‹çš„mysql_insert_idæ˜¯ç”Ÿæˆidçš„æ–¹æ³•ä¹‹ä¸€ */\n            user.setId(mysql_insert_id(mysql.getConnection()));\n            return true;\n        }\n    }\n    /* æ³¨å†Œå¤±è´¥ */\n    return false;\n}\n/* æ ¹æ®ç”¨æˆ·å·ç æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ */\nUser UserModel::query(int id)\n{\n    /* 1.ç»„è£…SQLè¯­å¥ */\n    char sql[1024] = {0};\n    sprintf(sql, \"select * from user where id = %d\", id);\n    MySQL mysql;\n    if(mysql.connect())\n    {\n        /* mysql.queryå†…éƒ¨ç”³è¯·äº†èµ„æºï¼Œå¤„ç†å®ŒæˆUserçš„æ„é€ åï¼Œéœ€è¦free */\n        MYSQL_RES *res = mysql.query(sql);  // æ­¤queryä¸ºMySQLçš„queryï¼Œå’ŒupdateåŒçº§ã€‚\n        if(res != nullptr)\n        {\n            MYSQL_ROW row = mysql_fetch_row(res);\n            if(row != nullptr)\n            {\n                User user;\n                user.setId(atoi(row[0]));\n                user.setName(row[1]);\n                user.setPassword(row[2]);\n                user.setState(row[3]);\n                mysql_free_result(res);\n                return user;\n            }\n        }\n    }\n    /* å¦‚æœæ²¡æœ‰æœ‰æ•ˆçš„æŸ¥è¯¢ç»“æœï¼Œè¿”å›ä¸€ä¸ªé»˜è®¤Userï¼Œidä¸º-1ï¼Œè¡¨ç¤ºå‡ºé”™ */\n    return User();\n}\n/* æ›´æ–°ç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯ */\nbool UserModel::updateState(User user)\n{\n    /* 1.ç»„è£…SQLè¯­å¥ */\n    char sql[1024] = {0};\n    sprintf(sql, \"update user set state = '%s' where id = %d\", user.getState().c_str(), user.getId());\n    MySQL mysql;\n    if(mysql.connect())\n    {\n        if(mysql.update(sql))\n        {\n            return true;\n        }\n    }\n    return false;\n}\n/* é‡ç½®æ‰€æœ‰ç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯ */\nvoid UserModel::resetAllState()\n{\n    char sql[1024] = \"update user set state = 'offline' where state = 'online'\";\n    MySQL mysql;\n    if(mysql.connect())\n    {\n        mysql.update(sql);\n    }\n}\n```\n# æµ‹è¯•\n\nç‚¹å¯¹ç‚¹èŠå¤©\n\n```bash\n./ChatServer\n```\n\nç‚¹å¯¹ç‚¹èŠå¤©çš„jsonæ ¼å¼ï¼š`{\"msgid\":5,\"from\":\"from_name\",\"to\":to_id,\"msg\":\"......\"}`\n\n```\n# æ³¨å†Œ\ntelnet 127.0.0.1 6000\n{\"msgid\":3,\"name\":\"test0511\",\"password\":\"123\"}\n```\n\n```\n#ç™»å½•åä¸€å¯¹ä¸€èŠå¤©\n{\"msgid\":1,\"id\":22,\"password\":\"123\"}\n{\"msgid\":6,\"from\":\"test0511\",\"to\":13,\"msg\":\"hello zhang san, i am test0511!\"}\n\n{\"msgid\":1,\"id\":13,\"password\":\"123456\"}\n{\"msgid\":6,\"from\":\"zhang san\",\"to\":22,\"msg\":\"hello test0511, i'm zhang san!\"}\n\n```\n\n\n```bash\n# xcg\ntelnet 127.0.0.1 6000\n{\"msgid\":1,\"id\":22,\"password\":\"123\"}\t#ç™»å½•\n{\"msgid\":5,\"from\":\"xcg\",\"to\":13,\"msg\":\"hello zhang san, i'm xcg!\"}\t#å‘é€æ¶ˆæ¯\n# å‘é€ç¦»çº¿æ¶ˆæ¯\n{\"msgid\":5,\"from\":\"xcg\",\"to\":13,\"msg\":\"hello - 1\"}\n{\"msgid\":5,\"from\":\"xcg\",\"to\":13,\"msg\":\"hello - 2\"}\n{\"msgid\":5,\"from\":\"xcg\",\"to\":13,\"msg\":\"hello - 3\"}\n\n```\n\n```bash\n# zhang san\ntelnet 127.0.0.1 6000\n{\"msgid\":1,\"id\":13,\"password\":\"123456\"}\t#ç™»å½•\n{\"msgid\":6,\"from\":\"zhang san\",\"to\":22,\"msg\":\"hello xcg, i'm zhang san!\"}#å‘é€æ¶ˆæ¯\n\n```\n# å¥½å‹ä¸šåŠ¡\n\n1. æ˜¾ç¤ºæœ‰å“ªäº›å·²æ·»åŠ çš„å¥½å‹ï¼Œid\n2. æ·»åŠ å¥½å‹\n\nä½†æ˜¯ä¸šåŠ¡å¹¶ä¸ä¸¥æ ¼ï¼Œåªè¦çŸ¥é“å…¶idå³å¯èŠå¤©ã€‚\n\næ€»ä½“ä¸šåŠ¡æµç¨‹ï¼šå‘æœåŠ¡å™¨å‘èµ·æ·»åŠ å¥½å‹çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨å°±æŠŠå…³ç³»æ·»åŠ åˆ°friendè¡¨ä¸­ï¼Œåˆç‰ˆæœ¬ä¸ç”¨å¾è¯¢å¯¹æ–¹çš„åŒæ„ã€‚\n\nfriendè¡¨å°±ä¸¤ä¸ªå­—æ®µï¼š`userid`ã€`friendid`æ˜¯è”åˆä¸»é”®ã€‚\n## æµ‹è¯•\n\næ·»åŠ å¥½å‹ã€ç™»é™†æˆåŠŸåæ˜¾ç¤ºå¥½å‹åˆ—è¡¨\n\n```bash\n./ChatServer\n```\n\næ·»åŠ å¥½å‹çš„JSONæ ¼å¼ï¼š`{\"msgid\":6,\"id\":22,\"friendid\":13}`ã€‚æ­¤è¯­å¥æ„ä¸ºï¼šidä¸º22çš„ç”¨æˆ·ä¸»åŠ¨æ·»åŠ idä¸º13çš„ç”¨æˆ·ä¸ºå¥½å‹ï¼Œå»ºç«‹åŒå‘å…³ç³»ã€‚\n\næ·»åŠ åï¼ŒæŸ¥çœ‹friendè¡¨ä¸­æ˜¯å¦æœ‰ä¿¡æ¯ï¼Œåº”æœ‰ä¸€ä¸ª`id:22 - friendid:13`ã€‚\n\n```mysql\nselect * from friend;\n```\n\n\n```bash\n# xcg\ntelnet 127.0.0.1 6000\n{\"msgid\":1,\"id\":22,\"password\":\"123\"}\t# ç™»å½•\n{\"msgid\":6,\"id\":22,\"friendid\":13}\t# æ·»åŠ id:13ä¸ºå¥½å‹\n\n# Ctrl + ] -> quit é€€å‡º\n# é‡æ–°ç™»é™†\ntelnet 127.0.0.1 6000\n{\"msgid\":1,\"id\":22,\"password\":\"123\"}\t# ç™»å½•\n# çœ‹çœ‹æ˜¯å¦è¿”å›å¥½å‹åˆ—è¡¨\n```\n\n# ç¾¤ç»„ä¸šåŠ¡\n\n1. ç®¡ç†å‘˜åˆ›å»ºç¾¤\n2. ç”¨æˆ·åŠ å…¥ç¾¤\n3. ç¾¤èŠ\n## è¡¨\n\nä¸ç¾¤ç»„ä¸šåŠ¡ç›¸å…³çš„æœ‰ä¸¤å¼ è¡¨ï¼šä¸€ä¸ªæ˜¯`AllGroup`è¡¨ï¼Œä¸€ä¸ªæ˜¯`GroupUser`è¡¨ã€‚\n\nAllGroupè¡¨æœ‰ä¸‰ä¸ªå­—æ®µï¼šidã€groupnameã€groupdesc(ç¾¤ç»„æè¿°)\n\nGroupUserè¡¨ï¼Œå› ä¸ºç¾¤å’Œæˆå‘˜ä¹‹é—´æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼Œæ‰€ä»¥éœ€è¦æ­¤ä¸­é—´è¡¨æ¥æè¿°è¿™ä¸ªå…³ç³»ã€‚æœ‰ä¸‰ä¸ªå­—æ®µï¼š`groupid`ã€`userid`ã€`grouprole`(æˆå‘˜åœ¨ç¾¤ä¸­çš„æƒé™)ã€‚\n\n`groupid`å’Œ`userid`æ˜¯è”åˆä¸»é”®ã€‚\n\nè¿™ä¸¤å¼ è¡¨éƒ½æ˜¯å¤„ç†ç¾¤ç»„ä¸šåŠ¡çš„ï¼Œæ‰€ä»¥å¯¹åº”çš„modelåªåˆ›å»ºäº†ä¸€ä¸ªã€‚\n## model\n\ngroupmodel.hpp\n\n# è´Ÿè½½å‡è¡¡\n\nè´Ÿè½½å‡è¡¡å™¨, äº¦å«åšåå‘ä»£ç†æœåŠ¡å™¨, åœ¨é›†ç¾¤æœåŠ¡å™¨æ¶æ„ä¸­, ä½œä¸ºç»Ÿä¸€æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚çš„ç«¯å£ã€‚\n\nå…¶æ ¹æ®é…ç½®æ‰€ç•Œå®šçš„è´Ÿè½½ç®—æ³•ï¼ŒæŠŠå®¢æˆ·ç«¯çš„è¯·æ±‚åˆ†å‘åˆ°ä¸šåŠ¡æœåŠ¡å™¨ä¸Šã€‚\n\nè¦åšçš„ä¸‰ä»¶äº‹æƒ…ï¼š\n\n1. æŠŠ client çš„è¯·æ±‚æŒ‰ç…§è´Ÿè½½å‡è¡¡ç®—æ³•åˆ†å‘åˆ°å…·ä½“çš„ä¸šåŠ¡æœåŠ¡å™¨ ChatServer ä¸Šé¢ï¼›\n    1. ç›¸åº”åœ°, æœåŠ¡å™¨çš„å“åº”ä¹Ÿè¦ç»è¿‡è´Ÿè½½å‡è¡¡å™¨, å‡†ç¡®åœ°è¿”å›ç»™è¿™ä¸ª client ã€‚\n    2. æœåŠ¡å™¨çš„å“åº”æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å»ºç«‹ä¸€ä¸ª IP éš§é“å®ç°ï¼Œè¾¾åˆ°ç›´æ¥è¿æ¥, è¿™æ ·çš„æ•ˆç‡æ›´å¥½; \n3. èƒ½å¤Ÿå’Œ ChatServer ä¿æŒå¿ƒè·³æœºåˆ¶ï¼Œç›‘æµ‹ ChatServer æ•…éšœï¼›\n4. èƒ½å¤Ÿå‘ç°æ–°æ·»åŠ çš„ ChatServer è®¾å¤‡ï¼Œæ–¹ä¾¿æ‰©å±•æœåŠ¡å™¨æ•°é‡ï¼Œæœ€å¥½æ˜¯èƒ½å¤Ÿå¹³æ»‘åœ°å®Œæˆè¿™ä¸ªè¿‡ç¨‹ï¼Œè€Œä¸æ˜¯éœ€è¦é‡å¯è´Ÿè½½å‡è¡¡æœåŠ¡å™¨å¯¼è‡´æœåŠ¡åœæ­¢ã€‚\n## nginxè´Ÿè½½å‡è¡¡æ¨¡å—\n\næœ¬é¡¹ç›®é€‰æ‹© Nginx çš„ TCP è´Ÿè½½å‡è¡¡æ¨¡å—ï¼Œè¦è§£å†³çš„é—®é¢˜\n\n1. å¦‚ä½•è¿›è¡Œ Nginx æºç ç¼–è¯‘ï¼ŒåŒ…å« TCP è´Ÿè½½å‡è¡¡æ¨¡å—\n2. `nginx.conf` é…ç½®æ–‡ä»¶ä¸­å¦‚ä½•é…ç½®è´Ÿè½½å‡è¡¡\n3. Nginx çš„å¹³æ»‘åŠ è½½é…ç½®æ–‡ä»¶å¯åŠ¨\n\nnginxåœ¨1.9ç‰ˆæœ¬ä¹‹å‰ï¼Œåªæ”¯æŒhttpåè®®webæœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡ï¼Œ\n**ä»1.9ç‰ˆæœ¬å¼€å§‹ä»¥åï¼ŒNginxå¼€å§‹æ”¯æŒ TCP çš„é•¿è¿æ¥è´Ÿè½½å‡è¡¡**ï¼Œ\nä½†æ˜¯ Nginx é»˜è®¤ä¸ç¼–è¯‘ TCP è´Ÿè½½å‡è¡¡æ¨¡å—ï¼Œ\nç¼–å†™å®ƒæ—¶ï¼Œéœ€è¦åŠ å…¥`--with-stream`å‚æ•°æ¥æ¿€æ´»è¿™ä¸ªæ¨¡å—ã€‚\n### ç¼–è¯‘å®‰è£…æµç¨‹ï¼ˆè®°å¾—å¸¦`--with-stream`ï¼‰\n\nä»¥`nginx-1.12.2.tar.gz`ä¸ºä¾‹;\n\nnginxç¼–è¯‘å®‰è£…éœ€è¦å…ˆå®‰è£…pcreã€opensslã€zlibç­‰åº“ã€‚\n\n```bash\nsudo apt-get install libpcre3 libpcre3-dev\n```\n\n\n>å¯¹å¼€æºäº§å“å‘è¡Œæºä»£ç çš„ç¼–è¯‘å®‰è£…, ä¸€èˆ¬éƒ½æ˜¯: \n>\n>1. å…ˆæ‰§è¡Œ`./configure`, ç”Ÿäº§ç›¸åº”çš„makefileæ–‡ä»¶;\n>2. `make`, è¿›è¡Œç¼–è¯‘\n>3. `make install`, è¿›è¡Œå®‰è£…\n\nè§£å‹`nginx-1.12.2.tar.gz`åï¼Œè¿›å…¥`nginx-1.12.2`ç›®å½•ï¼Œ\nå…ˆè¿è¡Œ`./configure --with-stream`ç”Ÿæˆ`Makefile`åï¼Œ\nè¿è¡Œ`make`ï¼Œæœ€å`make install`ã€‚\nmake installå‘½ä»¤ä¼šå‘ç³»ç»Ÿè·¯å¾„æ‹·è´æ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦åœ¨rootç”¨æˆ·ä¸‹æ‰§è¡Œã€‚\n\nç¼–è¯‘å®Œæˆåï¼Œé»˜è®¤å®‰è£…åœ¨äº†`/usr/local/nginx`ç›®å½•ã€‚\n\n`nginx`ç›®å½•ä¸‹ï¼Œå¯æ‰§è¡Œæ–‡ä»¶åœ¨`sbin`ç›®å½•é‡Œï¼Œé…ç½®æ–‡ä»¶åœ¨`conf`ç›®å½•é‡Œã€‚\n\n### é…ç½®æ–‡ä»¶\n\nå¦‚ä½•é…ç½®è´Ÿè½½å‡è¡¡?\n\n`/usr/local/nginx/conf/nginx.conf`ä¸­, å¯ä»¥çœ‹åˆ°httpå­—æ®µ, è¿™æ˜¯åŸºäºhttpçš„è´Ÿè½½å‡è¡¡é…ç½®; \n\n```nginx\n#user  nobody;\nworker_processes  1;\n\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n    sendfile        on;\n    keepalive_timeout  65;\n    server {\n        listen       80;\n        server_name  localhost;\n        location / {\n            root /var/www/hexo;\n            index  index.html index.htm;\n        }\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n    }\n}\n```\n\nè€Œæœ¬é¡¹ç›®æ˜¯ TCP æœåŠ¡å™¨, éœ€è¦å†™åˆ°`stream`ä¸‹, è¡¨ç¤ºåŸºäºTCPçš„è´Ÿè½½å‡è¡¡é…ç½®; \n1. serverå­—æ®µ\n    1. listen - nginxè´Ÿè½½å‡è¡¡å™¨å°†è¦ç›‘å¬çš„ç«¯å£å·\n    2. `proxy_pass` - æ‰€æœ‰åœ¨listenå­—æ®µç«¯å£å·ä¸Šçš„è¯·æ±‚éƒ½å°†åˆ†å‘åˆ°è¿™ä¸ªæ ‡è®°å­—æ®µæ‰€å¡«å……åˆ°ä¿¡æ¯ä¸­\n2. upstreamå­—æ®µ - å¯ç”¨äºè´Ÿè½½å‡è¡¡çš„æœåŠ¡å™¨ä¿¡æ¯\n    1. `server IP:Port weight=æƒé‡ max_fail=æœ€å¤šå¤±è´¥æ¬¡æ•° fail_timeout=æœ€é•¿ç­‰å¾…å“åº”æ—¶é—´`\n\n```nginx\n# nginx tcp loadbalance config\nstream {\n    upstream MyServer {\n        server 127.0.0.1:6000 weight=1 max_fails=3 fail_timeout=30s;\n        server 127.0.0.1:6002 weight=1 max_fails=3 fail_timeout=30s;\n    }\n    server {\n        # proxy connect timeout 1s;\n        listen     8000;\n        proxy_pass MyServer;\n    }\n}\n```\n### å¸¸ç”¨æ“ä½œ\n\n```bash\nnginx -s reload\t\t# é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼Œå¹³æ»‘å¯åŠ¨\nnginx -s stop\t\t# åœæ­¢nginxæœåŠ¡\n```\n### Nginxçš„ç½‘ç»œæ¨¡å‹è®¾è®¡ï¼ˆaccpeté”è§£å†³æƒŠç¾¤ç°è±¡ï¼‰ï¼ˆreactors in process - one loop per processï¼‰\næˆ‘ä»¬ä¸Šé¢çš„ç½‘ç»œIOæ¨¡å—çš„ muduo çš„ç½‘ç»œè®¾è®¡æ˜¯ï¼šreactors in threads - one loop per thread.\n\nè€Œ Nginx æœåŠ¡å™¨çš„ç½‘ç»œæ¨¡å—è®¾è®¡æ˜¯åŸºäºè¿›ç¨‹çš„ï¼Œé‡‡ç”¨å¤šä¸ª Reactor å……å½“ I/O è¿›ç¨‹å’Œå·¥ä½œ**è¿›ç¨‹**ï¼Œé€šè¿‡ä¸€æŠŠ accept é”å®Œç¾è§£å†³å¤šä¸ª Reactors çš„æƒŠç¾¤ç°è±¡ã€‚\nå› æ­¤NginxæœåŠ¡å™¨çš„æ¨¡å‹æ˜¯ï¼š**reactors in process - one loop per process**\n## æ›´åŠ é«˜å¹¶å‘ï¼ŸæŠŠè´Ÿè½½å‡è¡¡å™¨ä¹Ÿé›†ç¾¤ï¼ï¼ˆLVSè´Ÿè½½å‡è¡¡å™¨ï¼‰\n\nè´Ÿè½½å‡è¡¡ä¹Ÿåˆ†ä¸ºå¾ˆå¤šç§, \n\n1. å¯åˆ†ä¸ºä¸šåŠ¡å±‚è´Ÿè½½å‡è¡¡å™¨ï¼Œé€šè¿‡ä¸šåŠ¡åˆ†å‘; \n2. ä¹Ÿå¯åˆ†ä¸ºä¼ è¾“å±‚çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œé€šè¿‡UDP/TCPåˆ†å‘; \n3. ç½‘ç»œå±‚çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œé€šè¿‡IPåˆ†å‘; \n4. æ•°æ®é“¾è·¯å±‚çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œé€šè¿‡æ•°æ®å¸§åˆ†å‘; \n\nå¦‚ä½•æ›´è¿›ä¸€æ­¥æé«˜å¹¶å‘é‡?\n\nå¯ä»¥æŠŠè´Ÿè½½å‡è¡¡å™¨ä¹Ÿè¿›è¡Œé›†ç¾¤å¤„ç†, å‰ç«¯ä½¿ç”¨ä¸€ä¸ªååº•å±‚çš„ LVS è´Ÿè½½å‡è¡¡å™¨, å³, ä¸€å° LVS åŠ å¤šå° Nginx æœåŠ¡å™¨çš„æ¨¡å‹ã€‚\n\nLVSçš„å¹¶å‘é‡å¾ˆå®¹æ˜“æ‰©å±•åˆ°åå‡ ä¸‡; \n# Redisä¼˜åŒ–è·¨æœåŠ¡å™¨é€šä¿¡\n\næœ¬é¡¹ç›®ä¸­, ç”¨æˆ·é—´çš„é€šä¿¡æ¨¡å‹æ— éæœ‰ä¸¤ç§ï¼šä¸€å¯¹ä¸€èŠå¤©ã€ç¾¤èŠã€‚\n\né›†ç¾¤ç¯å¢ƒä¸­ï¼Œå³ç”¨æˆ·å¯èƒ½åˆ†å¸ƒåœ¨ä¸åŒæœåŠ¡å™¨ä¸»æœºä¸Šã€‚\n\nå¦‚æœæŒ‰ç…§ä¹‹å‰çš„ä»£ç é€»è¾‘ï¼Œæ¯å°æœåŠ¡å™¨ä¸Šçš„ä¸€ä¸ª Server éƒ½åªæœ‰ä¸€ä¸ª`m_userConnectionMap`ï¼ˆå› ä¸ºè¿™ä¸ªæ˜¯ChatServiceä¸­çš„æˆå‘˜ï¼Œè€ŒChatServiceæ˜¯å•ä¾‹æ¨¡å¼ï¼‰ã€‚\n\næ‰€ä»¥ç”¨æˆ·ç»™å¯¹æ–¹å‘æ¶ˆæ¯åï¼Œå¦‚æœæ¥æ”¶æ–¹ç”¨æˆ·ä¸åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œé‚£ä¹ˆè¯¥æ¶ˆæ¯å°±ä¼šè¢«å½“ä½œç¦»çº¿æ¶ˆæ¯ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å¯¹çš„ã€‚\n\né‚£ä¹ˆæ€ä¹ˆè§£å†³è·¨æœåŠ¡å™¨é€šä¿¡å‘¢ï¼Ÿ\n## å¤šä¸ªæœåŠ¡å™¨å¹¿æ’­é€šä¿¡ï¼ˆè™½èƒ½è§£å†³ï¼Œä½†æ˜¯å¤ªå·®ï¼‰\n**æœ€ç›´è§‚çš„æƒ³æ³•**æ˜¯è®©å„ä¸ªChatServeræœåŠ¡å™¨äº’ç›¸ä¹‹é—´ç›´æ¥å»ºç«‹TCPè¿æ¥è¿›è¡Œé€šä¿¡ï¼Œç›¸å½“äºåœ¨æœåŠ¡å™¨ç½‘ç»œä¹‹é—´è¿›è¡Œå¹¿æ’­ã€‚\n![](../../images/é›†ç¾¤æœåŠ¡å™¨æ¶æ„/image-20250803032633484.png)\nè¿™æ ·çš„è®¾è®¡ä½¿å¾—å„ä¸ªæœåŠ¡å™¨ä¹‹é—´è€¦åˆåº¦å¤ªé«˜ï¼Œä¸åˆ©äºç³»ç»Ÿæ‰©å±•ï¼Œå¹¶ä¸”ä¼šå ç”¨ç³»ç»Ÿå¤§é‡çš„ socket èµ„æºï¼Œå„æœåŠ¡å™¨ä¹‹é—´çš„å¸¦å®½å‹åŠ›å¾ˆå¤§ï¼Œä¸èƒ½å¤ŸèŠ‚çœèµ„æºç»™æ›´å¤šçš„å®¢æˆ·ç«¯æä¾›æœåŠ¡ï¼Œå› æ­¤ä¸æ˜¯ä¸€ä¸ªå¥½çš„è®¾è®¡ã€‚\n## Redis æ¶ˆæ¯é˜Ÿåˆ— è§£è€¦è®¾è®¡\né›†ç¾¤éƒ¨ç½²çš„æœåŠ¡å™¨ä¹‹é—´è¿›è¡Œé€šä¿¡ï¼Œæœ€å¥½çš„æ–¹å¼å°±æ˜¯å¼•å…¥ä¸­é—´ä»¶æ¶ˆæ¯é˜Ÿåˆ—ï¼Œ\nè§£è€¦å„ä¸ªæœåŠ¡å™¨ï¼Œä½¿æ•´ä¸ªç³»ç»Ÿæ¾è€¦åˆï¼Œæé«˜æœåŠ¡å™¨çš„å“åº”èƒ½åŠ›ï¼ŒèŠ‚çœæœåŠ¡å™¨çš„å¸¦å®½èµ„æºã€‚\n\næ‰€ä»¥ç­”æ¡ˆæ˜¯å¼•å…¥æœåŠ¡å™¨ä¸­é—´ä»¶å¦‚æ¶ˆæ¯é˜Ÿåˆ—ã€‚\n![](../../images/é›†ç¾¤æœåŠ¡å™¨æ¶æ„/image-20250803032927009.png)\n\n\nå¦‚æ­¤ä¸€æ¥, **æœåŠ¡å™¨ä»…éœ€åšçš„å·¥ä½œæ˜¯ï¼šå‘ä¸­é—´ä»¶å‘å¸ƒè®¢é˜…æ¶ˆæ¯ï¼Œä¹‹åç­‰å¾…ä¸­é—´ä»¶é€šçŸ¥å»å–æ¶ˆæ¯**ã€‚\n\nåœ¨é›†ç¾¤åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œç»å¸¸ä½¿ç”¨çš„ä¸­é—´ä»¶æ¶ˆæ¯é˜Ÿåˆ—æœ‰ ActiveMQ ã€RabbitMQ ã€Kafka ç­‰ï¼Œéƒ½æ˜¯åº”ç”¨åœºæ™¯å¹¿æ³›å¹¶ä¸”æ€§èƒ½å¾ˆå¥½çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¾›é›†ç¾¤æœåŠ¡å™¨ä¹‹é—´ï¼Œåˆ†å¸ƒå¼æœåŠ¡ä¹‹é—´è¿›è¡Œæ¶ˆæ¯é€šä¿¡ã€‚\n\né™äºæœ¬é¡¹ç›®ä¸šåŠ¡ç±»å‹å¹¶ä¸æ˜¯éå¸¸å¤æ‚ï¼Œå¯¹å¹¶å‘è¯·æ±‚é‡ä¹Ÿæ²¡æœ‰å¤ªé«˜çš„è¦æ±‚ï¼Œå› æ­¤æœ¬é¡¹ç›®ä¸­é—´ä»¶æ¶ˆæ¯é˜Ÿåˆ—é€‰å‹çš„æ˜¯ï¼šåŸºäºå‘å¸ƒ-è®¢é˜…æ¨¡å¼çš„ Redisã€‚\n## Redisç¯å¢ƒå®‰è£…å’Œé…ç½®\n\n1. Ubuntuå®‰è£…redisæœåŠ¡å‘½ä»¤\n\n```bash\nsudo apt-get install redis-server\n```\n\n2. å®‰è£…å®Œæˆåä¼šè‡ªåŠ¨å¯åŠ¨redisæœåŠ¡ï¼Œé€šè¿‡pså‘½ä»¤ç¡®è®¤; redisé»˜è®¤ç«¯å£ä¸º6379\n\n```bash\nps -ef | grep redis\n```\n## redis-cliæµ‹è¯•redis-server\n\nå¯åŠ¨redis-cliå®¢æˆ·ç«¯ï¼Œè¿æ¥redis serverä½“éªŒä¸€ä¸‹æ•°æ®ç¼“å­˜åŠŸèƒ½\n\n```bash\nredis-cli\n```\n\n```redis\n127.0.0.1:6379> set \"abc\" \"hello world\" #è®¾ç½®key-value\nOK\n127.0.0.1:6379> get \"abc\"\n\"hello world\"\n```\n### Redis è®¢é˜… / å‘å¸ƒ\n\nRedis çš„å‘å¸ƒ-è®¢é˜…æœºåˆ¶ï¼šå‘å¸ƒ-è®¢é˜…æ¨¡å¼åŒ…å«äº†ä¸¤ç§è§’è‰²ï¼Œåˆ†åˆ«æ˜¯æ¶ˆæ¯çš„å‘å¸ƒè€…å’Œæ¶ˆæ¯çš„è®¢é˜…è€…ã€‚\n\nè®¢é˜…è€…å¯ä»¥è®¢é˜…ä¸€ä¸ªæˆ–è€…å¤šä¸ªé¢‘é“ channel ï¼Œå‘å¸ƒè€…å¯ä»¥å‘æŒ‡å®šçš„é¢‘é“ channel å‘é€æ¶ˆæ¯ï¼Œæ‰€æœ‰è®¢é˜…æ­¤é¢‘é“çš„è®¢é˜…è€…éƒ½ä¼šæ”¶åˆ°æ­¤æ¶ˆæ¯ã€‚\n\nè®¢é˜…é¢‘é“çš„å‘½ä»¤æ˜¯ subscribeï¼Œå¯ä»¥åŒæ—¶è®¢é˜…å¤šä¸ªé¢‘é“ï¼Œç”¨æ³•æ˜¯`subscribe channel1 [channel2] ...`;\n\n```redis\n127.0.0.1:6379> subscribe 13\nReading messages... (press Ctrl-C to quit)\n1) \"subscribe\"\n2) \"13\"\n3) (integer) 1\n```\n\n```redis\n127.0.0.1:6379> publish 13 \"hello, 13\" #å¦ä¸€ç«¯æ¨é€æ¶ˆæ¯ç»™13\n```\n\nè®¢é˜…äº†`13`é¢‘é“ çš„ç”¨æˆ·æ”¶åˆ°çš„æ¶ˆæ¯: \n\n```redis\n1) \"message\"\n2) \"13\"\n3) \"hello, 13\"\n```\n\n## å¯¹åº”äºæœ¬é¡¹ç›®\n\nç”±äºæœåŠ¡å™¨æ˜¯é›†ç¾¤åŒ–çš„, æ‰€ä»¥ç™»å½•åˆ°æœ¬ç³»ç»Ÿçš„ç”¨æˆ·å¯èƒ½ä¸åœ¨åŒä¸€èŠå¤©æœåŠ¡å™¨ä¸Š, éœ€è¦è§‚å¯ŸRedisä¸­é—´ä»¶æ¥è·å–æ¶ˆæ¯;\n\nå³, ç”¨æˆ·æ˜¯è§‚å¯Ÿè€…, æ¶ˆæ¯é˜Ÿåˆ—æ˜¯è¢«è§‚å¯Ÿè€…;\n\næŸä¸€ç”¨æˆ·ç™»é™†åˆ°èŠå¤©ç³»ç»Ÿå, \n\n1. æœåŠ¡å™¨éœ€è¦å‘ Redis è®¢é˜…æŸä¸€é¢‘é“çš„æ¶ˆæ¯, è¿™ä¸ªé¢‘é“çš„idå·å³ä¸ºè¯¥ç”¨æˆ·çš„idå·;\n2. å½“è¯¥ç”¨æˆ·ç»™å¦ä¸€ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶, å‘ç°å…¶ä¸åœ¨æœ¬æœåŠ¡å™¨ä¸­, éœ€è¦å‘è¯¥é¢‘é“å‘å¸ƒæ¶ˆæ¯;\n\n# Rediså‘å¸ƒ-è®¢é˜…çš„å®¢æˆ·ç«¯ç¼–ç¨‹ - å°è£…ä¸ºRedisç±»\n\nredisæ”¯æŒå¤šç§ä¸åŒçš„å®¢æˆ·ç«¯ç¼–ç¨‹è¯­è¨€ï¼Œä¾‹å¦‚ Java å¯¹åº” Jedis ï¼ŒPHPå¯¹åº” phpredis ï¼Œ**C++å¯¹åº”çš„æ˜¯ hiredis**ã€‚\n## hiredis å®‰è£…æ­¥éª¤\n1. `git clone https://github.com/redis/hiredis`\n2. `make && make install`\n\n```bash\ncd hiredis\nmake\n...\nsudo make install #æ‹·è´ç”Ÿæˆçš„åŠ¨æ€åº“åˆ°/usr/local/libç›®å½•ä¸‹\n# å¦‚æœæç¤ºæ²¡æœ‰æ‰¾åˆ°hiredisåŠ¨æ€åº“ï¼Œåˆ™æ‰§è¡Œä¸‹é¢\n# sudo ldconfig /usr/local/lib\n```\n## æˆå‘˜å˜é‡\n\n1. hiredisåŒæ­¥ä¸Šä¸‹æ–‡å¯¹è±¡\n    1. ä¸€ä¸ªä¸“é—¨è´Ÿè´£publishæ¶ˆæ¯\n    2. ä¸€ä¸ªä¸“é—¨è´Ÿè´£subscribeæ¶ˆæ¯\n\n```cpp\nprivate:\n   /* hiredisåŒæ­¥ä¸Šä¸‹æ–‡å¯¹è±¡, è´Ÿè´£publishæ¶ˆæ¯ */\n   redisContext * m_publish_context;\n   /* hiredisåŒæ­¥ä¸Šä¸‹æ–‡å¯¹è±¡, è´Ÿè´£subscribeæ¶ˆæ¯ */\n   redisContext * m_subscribe_context;\n```\n\n2. å›è°ƒæ“ä½œ, æ”¶åˆ°è®¢é˜…çš„æ¶ˆæ¯, ç»™serviceå±‚ä¸ŠæŠ¥\n\n```cpp\nprivate:\n   /* å›è°ƒæ“ä½œ, æ”¶åˆ°è®¢é˜…çš„æ¶ˆæ¯, ç»™serviceå±‚ä¸ŠæŠ¥ */\n   MessageCallback m_notify_handler;\n```\n\n>1. å¯¹äº\"hiredisä¸Šä¸‹æ–‡å¯¹è±¡\"çš„ç†è§£:\n>   - ç›¸å½“äºä¸€ä¸ªredis-cli, å­˜å‚¨äº†è¿æ¥ç›¸å…³çš„ä¿¡æ¯;\n>2. ä¸ºä»€ä¹ˆè¦å†™ä¸¤ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡?\n>   - å¦‚æœä¸Šä¸‹æ–‡å¯¹è±¡æ­£åœ¨subscribeé‚£ä¹ˆå…¶å°†ä¼šé˜»å¡, æ‰€ä»¥ subscribe å’Œ publish éœ€è¦åˆ†å¼€æ“ä½œ;\n\n## æˆå‘˜å‡½æ•°\n\n### æ„é€ /ææ„\n```cpp\npublic:\n   Redis();\n   ~Redis();\n```\n### connect\nè¿æ¥RedisæœåŠ¡å™¨\n```cpp\npublic:\n   /* è¿æ¥RedisæœåŠ¡å™¨ */\n   bool connect();\n```\n### å‘å¸ƒ/è®¢é˜…æ¶ˆæ¯\n```cpp\npublic:\n   /* å‘æŒ‡å®šçš„redisé¢‘é“å‘å¸ƒæ¶ˆæ¯ */\n   bool publish(int channel, string message);\n   /* å‘æŒ‡å®šçš„redisé¢‘é“è®¢é˜…æ¶ˆæ¯ */\n   bool subscribe(int channel);\n   /* å‘æŒ‡å®šçš„redisé¢‘é“å–æ¶ˆè®¢é˜…æ¶ˆæ¯ */\n   bool unsubscribe(int channel);\n```\n### `observer_channel_message`\nåœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­æ¥æ”¶è®¢é˜…é¢‘é“ä¸­çš„æ¶ˆæ¯\n\n```cpp\npublic:\n   /* åœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­æ¥æ”¶è®¢é˜…é¢‘é“ä¸­çš„æ¶ˆæ¯ */\n   void observer_channel_message();\n```\n\n### `init_notify_handler`\nåˆå§‹åŒ–å‘ä¸šåŠ¡å±‚ä¸ŠæŠ¥é¢‘é“æ¶ˆæ¯ çš„å›è°ƒå‡½æ•°, éœ€è¦ç”¨åˆ°ä¸€ä¸ªint(é¢‘é“å·), ä¸€ä¸ªæ¶ˆæ¯å†…å®¹å­—ç¬¦ä¸²\n```cpp\npublic:\n   using MessageCallback = function<void(int, string)>;\n   /* åˆå§‹åŒ–å‘ä¸šåŠ¡å±‚ä¸ŠæŠ¥é¢‘é“æ¶ˆæ¯ çš„å›è°ƒå‡½æ•°, éœ€è¦ç”¨åˆ°int(é¢‘é“å·), æ¶ˆæ¯å†…å®¹å­—ç¬¦ä¸² */\n   void init_notify_handler(MessageCallback cb);\n```\n## ä»£ç å®ç°\n\n### æ„é€ \nåªæ˜¯å¯¹ä¸¤ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡æŒ‡é’ˆèµ‹nullptr, æ²¡æœ‰å®é™…æ„é€ \n```cpp\nRedis::Redis()\n   : m_publish_context(nullptr), m_subscribe_context(nullptr)\n{\n}\n```\n### ææ„\nè°ƒç”¨`redisFree`é‡Šæ”¾ä¸Šä¸‹æ–‡å¯¹è±¡èµ„æº\n```cpp\nRedis::~Redis()\n{\n   if(m_publish_context != nullptr)\n   {\n       redisFree(m_publish_context);\n   }\n   if(m_subscribe_context != nullptr)\n   {\n       redisFree(m_subscribe_context);\n   }\n}\n```\n### connect\n1. å¯¹contextè¿›è¡Œå®é™…çš„ç”³è¯·èµ„æº/æ„é€ , è¿”å›æŒ‡é’ˆèµ‹ç»™æˆå‘˜, åº•å±‚è°ƒç”¨`redisConnect`\n2. åˆ›å»ºçº¿ç¨‹, æ‰§è¡Œ`observer_channel_message`, å³å¾ªç¯ç­‰å¾…Redisé¢‘é“çš„reply\n\n```cpp\nbool Redis::connect()\n{\n   m_publish_context = redisConnect(\"127.0.0.1\", 6379);\n   if(nullptr == m_publish_context)\n   {\n       cerr << \"connect redis failed!\" << endl;\n       return false;\n   }\n\n   m_subscribe_context = redisConnect(\"127.0.0.1\", 6379);\n   if(nullptr == m_subscribe_context)\n   {\n       cerr << \"connect redis failed!\" << endl;\n       return false;\n   }\n\n   /**\n    * ç”±äºsubscribeæ“ä½œæ˜¯é˜»å¡çš„, \n    * åœ¨å®é™…çš„ä½¿ç”¨ç¯å¢ƒä¸‹, ä¸å¯èƒ½å› ä¸ºä¸€ä¸ªè®¢é˜…æ“ä½œå»é˜»å¡ä¸€ä¸ªæœåŠ¡å™¨, \n    * æ‰€ä»¥è¦ç”¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ¥å®Œæˆç›‘å¬é¢‘é“ä¸Šçš„äº‹ä»¶,\n    * æœ‰æ¶ˆæ¯åˆ™ç»™ä¸šåŠ¡å±‚è¿›è¡Œä¸ŠæŠ¥; \n    */\n   thread t(\n       [&]() { observer_channel_message();} );\n   t.detach();\n\n   cout << \"connect redis-server success!\" << endl;\n   return true;\n}\n```\n\n### publish\nç›¸å½“äºå‘redis-serverå‘é€å‘½ä»¤, replyæ¥æ”¶å‘½ä»¤æ‰§è¡Œç»“æœ\n```cpp\nbool Redis::publish(int channel, string message)\n{\n   /* ç›¸å½“äºå‘redis-serverå‘é€å‘½ä»¤, replyæ¥æ”¶å‘½ä»¤æ‰§è¡Œç»“æœ */\n   redisReply * reply = (redisReply*)redisCommand(\n       m_publish_context, \"PUBLISH %d %s\", channel, message.c_str());\n   if(nullptr == reply)\n   {\n       cerr << \"publish command failed!\" << endl;\n       return false;\n   }\n   freeReplyObject(reply);\n   return true;\n}\n```\n\n### subscribe\nç›¸å½“äºæŠŠredisCommandç»†åŒ–äº†, åªæ“ä½œäº†å‘å‘½ä»¤, æ¥æ”¶ç»“æœäº¤ç»™å•ç‹¬çš„çº¿ç¨‹åšäº†, è¯¦è§`observer_channel_message`\n```cpp\nbool Redis::subscribe(int channel)\n{\n   if(REDIS_ERR == redisAppendCommand(\n       m_subscribe_context, \"SUBSCRIBE %d\", channel))\n   {\n       cerr << \"subscribe command failed!\" << endl;\n       return false;\n   }\n   /* å¾ªç¯å‘é€ç¼“å†²åŒºå†…å®¹, ç›´åˆ°å‘é€å®Œæ¯• */\n   int done = 0;\n   while(!done)\n   {\n       if(REDIS_ERR == redisBufferWrite(m_subscribe_context, &done))\n       {\n           cerr << \"subscribe command failed!\" << endl;\n           return false;\n       }\n   }\n   /**\n    * è¿™é‡Œä¸åšredisReplyçš„æ“ä½œ,\n    * è¿™æ˜¯ä¸ªé˜»å¡çš„æ“ä½œ, æ”¾åœ¨observer_channel_messageä¸­åš;\n    */\n   return true;\n}\n```\n\n### unsubscribe\n```cpp\nbool Redis::unsubscribe(int channel)\n{\n   if(REDIS_ERR == redisAppendCommand(\n       m_subscribe_context, \"UNSUBSCRIBE %d\", channel))\n   {\n       cerr << \"unsubscribe command failed!\" << endl;\n       return false;\n   }\n   /* å¾ªç¯å‘é€ç¼“å†²åŒºå†…å®¹, ç›´åˆ°å‘é€å®Œæ¯• */\n   int done = 0;\n   while(!done)\n   {\n       if(REDIS_ERR == redisBufferWrite(m_subscribe_context, &done))\n       {\n           cerr << \"unsubscribe command failed!\" << endl;\n           return false;\n       }\n   }\n   /**\n    * è¿™é‡Œä¸åšredisReplyçš„æ“ä½œ,\n    * è¿™æ˜¯ä¸ªé˜»å¡çš„æ“ä½œ, æ”¾åœ¨observer_channel_messageä¸­åš;\n    */\n   return true;\n}\n```\n### `observer_channel_message`\n* Redisé¢‘é“å¦‚æœæœ‰æ¶ˆæ¯, åˆ™æœ‰ä¸‰ä¸ªå­—æ®µ, \n    1. å¯¹åº”çš„æ˜¯redisGetReplyè¿”å›çš„`reply->element[0],[1],[2]`;\n    2. æœ¬é¡¹ç›®çš„`element[1]`å¯¹åº”çš„æ˜¯é¢‘é“å·;\n    3. æœ¬é¡¹ç›®çš„`element[2]`å¯¹åº”çš„æ˜¯æ¶ˆæ¯ä½“;\n\n```cpp\nvoid Redis::observer_channel_message()\n{\n   redisReply *reply = nullptr;\n   int res = REDIS_ERR;\n   while(REDIS_OK==(res = redisGetReply(\n                               m_subscribe_context, (void**)&reply)))\n   {\n       if(reply != nullptr &&\n          reply->element[2] != nullptr &&\n          reply->element[2]->str != nullptr)\n       {\n           /* ç»™ä¸šåŠ¡å±‚ä¸ŠæŠ¥é¢‘é“ä¸Šå‘ç”Ÿçš„æ¶ˆæ¯, å³é¢‘é“å·+æ¶ˆæ¯ä½“ */\n           m_notify_handler(atoi(reply->element[1]->str),\n                            reply->element[2]->str );\n       }\n       freeReplyObject(reply);\n   }\n   if(res == REDIS_ERR)\n   {\n       cerr << \"redisGetReply err\" << endl;\n       return;\n   }\n   cerr << \"observer_channel_message quit\" << endl;\n}\n```\n### `init_notify_handler`\nè®¾ç½®`m_notify_handler`å›è°ƒ\n\n```cpp\nvoid Redis::init_notify_handler(MessageCallback cb)\n{\n   m_notify_handler = cb;\n}\n```\n\n> redisCommandå’ŒredisAppendCommandçš„åŒºåˆ«:\n>\n> 1. redisAppendCommandåªæ˜¯æŠŠå‘½ä»¤å…ˆå†™åˆ°æœ¬åœ°ç¼“å­˜ä¸­;\n> 2. å†™åˆ°ç¼“å­˜ä¹‹åè¿˜éœ€è¦è°ƒç”¨redisBufferWriteæŠŠç¼“å­˜ä¸­çš„å‘½ä»¤å‘é€åˆ°RedisæœåŠ¡å™¨;\n> 3. æœ€å, å¦‚æœè¦è·å¾—reply, è¿˜éœ€è¦è°ƒç”¨redisGetReplyè·å–ç»“æœ, è¿™ä¸ªæ“ä½œå¯¹äºsubscribeæ˜¯é˜»å¡çš„;\n> 4. ç”±äºpublishæ“ä½œä¸€èˆ¬ä¸ä¼šé˜»å¡, æ‰€ä»¥ç›´æ¥è°ƒç”¨redisCommand;\n> 5. ç”±äºsubscribeæ“ä½œæœ€åçš„redisGetReplyå°†ä¼šé˜»å¡, æ‰€ä»¥æˆ‘ä»¬æŠŠè¿™å‡ ä¸ªæ­¥éª¤å•ç‹¬å†™å‡ºæ¥, ç²’åº¦å‡å°, è¿½æ±‚æ•ˆç‡;\n\n## ChatServiceåŠ å…¥Redisç»„ä»¶\n\né¦–å…ˆ, éœ€è¦åœ¨`chatservice.hpp`ä¸­, å¼•å…¥å¤´æ–‡ä»¶`\"redis.hpp\"`; ç„¶ååœ¨`ChatService`çš„ç±»æˆå‘˜å˜é‡ä¸­å£°æ˜ä¸€ä¸ª`Redis m_redis`redisæ“ä½œå¯¹è±¡;\n```cpp\nprivate:\n   Redis m_redis;\n```\n\nåœ¨ChatServiceç±»ä¸­, æ·»åŠ ä¸€ä¸ªå¤„ç†redisä¸šåŠ¡çš„æˆå‘˜å‡½æ•°`handleRedisSubscribeMessage`\n   ```cpp\n   public:\n       void handleRedisSubscribeMessage(int channel, string message);\n   ```\n\nåœ¨`chatservice.cpp`ä¸­, ChatServiceçš„æ„é€ å‡½æ•°ä¸­, éœ€è¦æ·»åŠ è¿æ¥redisæœåŠ¡å™¨çš„æ“ä½œ; \nå¦‚æœè¿æ¥æˆåŠŸ, ç»™redisè®¾ç½®å›è°ƒå‡½æ•°ä¸º`handleRedisSubscribeMessage`, å‚æ•°ä¸ºchatserviceå¯¹è±¡æŒ‡é’ˆ, channel, message;\n```cpp\nChatService::ChatService()\n{\n   // ...\n   if(m_redis.connect())\n   {\n       m_redis.init_notify_handler(std::bind(\n           &ChatService::handleRedisSubscribeMessage, this, _1, _2));\n   }\n}\n```\n","categories":["Cpp","é¡¹ç›®","é›†ç¾¤"]},{"title":"Cpp_åŸå­ç±»å‹_æ— é”é˜Ÿåˆ—","url":"/Cpp/Cpp_åŸå­ç±»å‹_æ— é”é˜Ÿåˆ—/","content":"# çº¿ç¨‹å®‰å…¨é—®é¢˜\n\n```cpp\nint count = 0;\ncount++;\ncount--;\t/* æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ */\n```\nåç½®`++`æœ‰å¤šä¸ªåŠ¨ä½œï¼š\n1. å–å‡ºcountçš„å€¼ä¸ºtmp\n2. è®¡ç®—`count + 1`\n3. `count + 1`çš„ç»“æœèµ‹ç»™count\n4. è¿”å›tmp\n\nå¯¹åº”äºå¤šæ¡æŒ‡ä»¤ã€‚\n\nä¼ ç»Ÿåœ°è§£å†³ï¼Œå¯ä»¥ç”¨åŠ é”çš„æ–¹å¼\n```cpp\n{\n    lock_guard<std::mutex> guard(mtx);\n\tcount++;\n}\n```\nä½†æ˜¯ï¼Œäº’æ–¥é”æ˜¯æ¯”è¾ƒè€—è´¹èµ„æºçš„ï¼Œå¦‚æœä¸´ç•ŒåŒºçš„ä»£ç æ¯”è¾ƒè½»é‡çº§ï¼Œé‚£ä¹ˆä¼ ç»Ÿmutexé”ç›¸å¯¹è€Œè¨€å°±æ¯”è¾ƒå°é¢˜å¤§åšäº†ã€‚\n\nç°åœ¨æœ‰æ–°æœºåˆ¶è§£å†³ï¼šæŒ‡ä»¤çº§å¹¶å‘ã€‚\n\nå¦‚æœæƒ³è®©è¿™ä¹ˆå¤šåŠ¨ä½œåœ¨ä¸€æ¡æŒ‡ä»¤å†…åšå®Œçš„è¯ï¼Œéœ€è¦è®©å¤„ç†å™¨æ”¯æŒè¿™æ ·çš„æ“ä½œï¼Œè€Œä¸ç”¨é”æœºåˆ¶ï¼Œå› æ­¤è¿™ç§å«åšæ— é”ç»“æ„ã€‚\n# åŸå­ç±»å‹\nå®šä¹‰äº`<atomic>`\nåŸå­ç±»å‹ï¼Œå°è£…äº†ä¸€ä¸ªå€¼ï¼Œä¿è¯å…¶çš„è®¿é—®ä¸ä¼šå¯¼è‡´æ•°æ®ç«äº‰ï¼Œå¹¶ä¸”å¯ç”¨äºåŒæ­¥ä¸åŒçº¿ç¨‹ä¹‹é—´çš„å†…å­˜è®¿é—®ã€‚\n## `atomic_flag`\nåˆå§‹åŒ–å¯ä»¥èµ‹å€¼ä¸º`ATOMIC_FLAG_INIT`ï¼Œæ„ä¸ºæ— çŠ¶æ€ï¼Œå¯¹åº”falseã€‚\n1. `test_and_set()`ï¼šç½®ä½ä¸ºæœ‰çŠ¶æ€ï¼Œå¯¹åº”trueï¼Œå¹¶è¿”å›è°ƒç”¨ä¹‹å‰çš„çŠ¶æ€ã€‚è¿™æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹å¹²æ‰°ã€‚\n2. `clear()`é‡ç½®flagä¸ºæ— çŠ¶æ€\n### `atomic_flag`åšè‡ªæ—‹é”\nä»¥ä¸‹å°±æ˜¯ä¸€ä¸ªç”¨`atomic_flag`åšå¿™ç­‰å¾…çš„ä¾‹å­ï¼š\n1. åˆå§‹flagä¸ºæ— çŠ¶æ€\n2. è°ƒç”¨ä¸€æ¬¡`test_and_set()`ç½®ä½flagä¸ºæœ‰çŠ¶æ€\n3. whileä¸­ä¸€ç›´è°ƒç”¨`test_and_set()`ï¼Œæµ‹è¯•å®ƒçš„çŠ¶æ€ï¼Œç›´åˆ°ä¸ºæ— çŠ¶æ€æ—¶ï¼Œé€€å‡ºå¾ªç¯ï¼Œç»“æŸç¨‹åºã€‚\n\n```cpp\n#include <atomic>\n\nint main()\n{\n    std::atomic_flag flag = ATOMIC_FLAG_INIT;\n    flag.test_and_set();\n    while (flag.test_and_set())\n    {\n        continue;   \n    }\n    return 0;\n}\n```\n\nç»™å®šä¸€ä¸ª`atomic_flag`ï¼Œåˆå§‹ä¸ºæ— çŠ¶æ€ï¼ŒåŒæ—¶å¯åŠ¨10ä¸ªçº¿ç¨‹ï¼Œæ“ä½œä¹‹å‰ï¼Œè°ƒç”¨`test_and_set`ï¼Œå¦‚æœæµ‹è¯•ä¸ºæ— çŠ¶æ€ï¼Œè¯´æ˜æ²¡æœ‰å…¶ä»–çº¿ç¨‹åœ¨æ“ä½œï¼Œå°±å¯ä»¥è¿›è¡Œæ“ä½œã€‚\næ“ä½œå®Œæ¯•åï¼Œ`clear`é‡ç½®flagä¸ºæ— çŠ¶æ€ã€‚ä¸‹ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥æ¢æµ‹åˆ°æ— çŠ¶æ€ï¼Œå¼€å§‹å®ƒçš„æ“ä½œã€‚\n\næ­¤æ—¶ï¼Œ`atomic_flag`å°±ç›¸å½“äºè‡ªæ—‹é”çš„ä½œç”¨ã€‚\n```cpp\n\nstd::atomic_flag lock_output = ATOMIC_FLAG_INIT;\nstd::counting_semaphore<10> sema{ 0 };\nvoid worker(int v)\n{\n    // lock\n    while (lock_output.test_and_set())\n    {}\n    std::cout << \"thread #\" << v << std::endl;\n    // unlock\n    lock_output.clear();\n}\nint main()\n{\n    std::jthread t[10];\n    for (int i = 0; i < 10; ++i)\n    {\n        t[i] = std::jthread(&worker, i + 1);\n    }\n    sema.release(10);\n    using namespace std::chrono_literals;\n    std::this_thread::sleep_for(5s);\n    return 0;\n}\n```\nè¾“å‡ºï¼š\n```\nthread #1\nthread #5\nthread #4\nthread #7\nthread #2\nthread #10\nthread #6\nthread #3\nthread #9\nthread #8\n```\n## atomic\n```cpp\ntemplate <class T> struct atomic;\n```\nåŸå­å¯¹è±¡çš„ä¸»è¦ç‰¹å¾æ˜¯ï¼Œä»ä¸åŒçº¿ç¨‹è®¿é—®å€¼ä¸ä¼šå¯¼è‡´æ•°æ®ç«äº‰ï¼ˆå³ï¼Œè¿™æ ·åšæ˜¯æ˜ç¡®å®šä¹‰çš„è¡Œä¸ºï¼Œè®¿é—®é¡ºåºæ­£ç¡®ï¼‰ã€‚\né€šå¸¸ï¼Œå¯¹äºæ‰€æœ‰å…¶ä»–å¯¹è±¡ï¼Œå¦‚æœåŒæ—¶è®¿é—®åŒä¸€å¯¹è±¡è€Œå¯¼è‡´æ•°æ®äº‰ç”¨ï¼Œåˆ™è¯¥æ“ä½œå°†è¢«è§†ä¸ºæœªå®šä¹‰è¡Œä¸ºã€‚\n\nåŸå­å¯¹è±¡èƒ½å¤Ÿé€šè¿‡**æŒ‡å®šä¸åŒçš„å†…å­˜é¡ºåº**æ¥**åŒæ­¥å¯¹å…¶çº¿ç¨‹ä¸­å…¶ä»–éåŸå­å¯¹è±¡çš„è®¿é—®**ã€‚\n# Relaxed Orderingçš„é—®é¢˜\n```cpp\n// Thread 1:\nr1 = y.load(std::memory_order_relaxed); // A\nx.store(r1, std::memory_order_relaxed); // B\n// Thread 2:\nr2 = x.load(std::memory_order_relaxed); // C\ny.store(42, std::memory_order_relaxed); // D\n```\næ ‡è®°ä¸ºÂ `memory_order_relaxed` çš„åŸå­æ“ä½œä¸æ˜¯åŒæ­¥æ“ä½œã€‚å®ƒä»¬ä¸ä¼šåœ¨å¹¶å‘å†…å­˜è®¿é—®ä¸­å¼ºåŠ é¡ºåºï¼Œå®ƒä»¬åªä¿è¯åŸå­æ€§å’Œä¿®æ”¹é¡ºåºçš„ä¸€è‡´æ€§ã€‚\nä¾‹å¦‚ï¼ŒxÂ å’ŒÂ yÂ åˆå§‹ä¸ºé›¶ã€‚\nä»¥ä¸Šç¨‹åºå°±ä¼šå…è®¸äº§ç”ŸÂ `r1 == r2 == 42`ï¼Œåœ¨çº¿ç¨‹ 1 å†…ï¼ŒAÂ åœ¨ B ä¹‹å‰è¢«æ’åºï¼Œå¹¶ä¸”åœ¨çº¿ç¨‹ 2 å†…ï¼ŒCÂ åœ¨ D ä¹‹å‰è¢«æ’åºã€‚\nä½†æ˜¯æ²¡æœ‰ä»€ä¹ˆå¯ä»¥é˜»æ­¢ D åœ¨ A ä¹‹å‰ ä¿®æ”¹äº†Â yï¼Œå¹¶ä¸” B åœ¨ C ä¹‹å‰ ä¿®æ”¹ x ã€‚\nD å¯¹Â yÂ çš„å‰¯ä½œç”¨å¯¹äºçº¿ç¨‹ 1 ä¸­çš„ load A æ˜¯å¯è§çš„ï¼ŒB å¯¹Â xÂ çš„å‰¯ä½œç”¨å¯¹äºçº¿ç¨‹ 2 ä¸­çš„ load C æ˜¯å¯è§çš„ã€‚\n\nç‰¹åˆ«æ˜¯ï¼Œå¦‚æœåœ¨çº¿ç¨‹ 2 ä¸­ D åœ¨ C ä¹‹å‰å®Œæˆï¼Œè¿™å¯èƒ½ä¼šå‘ç”Ÿï¼Œè¿™å¯èƒ½æ˜¯åœ¨è¿è¡Œæ—¶å‘ç”Ÿçš„ï¼Œæˆ–è€…ç”±äºç¼–è¯‘å™¨é‡æ–°æ’åºå¯¼è‡´çš„ã€‚\n>å®é™…ä¸Šï¼ŒAã€Bæ˜¯ä¸èƒ½è°ƒæ¢çš„ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¼šçœ‹åˆ°ï¼ŒåŒåœ¨çº¿ç¨‹1ä¸­ï¼ŒBä¸­çš„ `r1` çš„å€¼ä¾èµ–äºä¸Šä¸€å¥çš„Aå¯¹ `r1` çš„æ“ä½œã€‚\n>è€ŒCã€Dä¹‹é—´å°±æ²¡æœ‰ä¾èµ–äº†ï¼Œå› ä¸º D æ“ä½œçš„æ˜¯ `42`ï¼Œæ˜¯ä¸ªå¸¸é‡ã€‚\n>æ‰€ä»¥ï¼Œç»è¿‡çº¿ç¨‹å¹¶å‘ã€å†…å­˜é‡æ’ï¼Œå¯èƒ½çš„æ‰§è¡Œé¡ºåºæœ‰ï¼š\n>A B C D  æ­¤æ—¶ xã€yã€r1ã€r2çš„å€¼ï¼š0ã€0ã€0ã€42\n>A B D C  æ­¤æ—¶ xã€yã€r1ã€r2çš„å€¼ï¼š0ã€42ã€0ã€0\n>A C D B  æ­¤æ—¶ xã€yã€r1ã€r2çš„å€¼ï¼š0ã€42ã€0ã€0\n>A D C B  æ­¤æ—¶ xã€yã€r1ã€r2çš„å€¼ï¼š0ã€42ã€0ã€0\n>C A D B  æ­¤æ—¶ xã€yã€r1ã€r2çš„å€¼ï¼š0ã€42ã€0ã€0\n>**D A C B**  æ­¤æ—¶ xã€yã€r1ã€r2çš„å€¼ï¼š**42ã€42ã€42ã€42**  => è¿™æ—¶ä¾¿å‡ºç°äº†`r1 == r2 == 42`\n>C D A B  æ­¤æ—¶ xã€yã€r1ã€r2çš„å€¼ï¼š42ã€42ã€42ã€0\n>D C A B  æ­¤æ—¶ xã€yã€r1ã€r2çš„å€¼ï¼š0ã€42ã€42ã€0\n\næ€ä¹ˆè§£å†³å‘¢ï¼Ÿ\nè§ä¸‹æ–‡\n\n# å†…å­˜é¡ºåº\nåŸå­æ“ä½œåªæ˜¯æä¾›äº†ä¸åŒçº¿ç¨‹è¯»å†™çš„åŒæ­¥ã€‚\nä½†æ˜¯**æ²¡æœ‰æä¾›æ“ä½œé¡ºåºçš„åŒæ­¥**ã€‚\n\næ¯”å¦‚ï¼šçº¿ç¨‹1ä¿®æ”¹åŸå­å€¼aï¼Œçº¿ç¨‹2è¯»å–åŸå­å€¼aã€‚\n\nä¸¤ä¸ªçº¿ç¨‹å„è‡ªçš„è¯»å†™æ“ä½œï¼Œç¡®å®æ˜¯ä¿è¯äº†ä¸ä¼šæœ‰è„å€¼ã€‚\nä½†æ˜¯çº¿ç¨‹1ã€çº¿ç¨‹2çš„é¡ºåºæ²¡æœ‰åšæ§åˆ¶ï¼Œ\nå¦‚æœçº¿ç¨‹2æƒ³è¦è¯»å‡ºæ—§å€¼ï¼Œä½†æ˜¯çº¿ç¨‹1åœ¨çº¿ç¨‹2è¯»å€¼å‰è¿›è¡Œå†™æ“ä½œï¼Œè¿˜æ˜¯ä¼šå¯¼è‡´çº¿ç¨‹2è¯»å‡ºè„å€¼ã€‚\n\nå› æ­¤éœ€è¦æä¾›å†…å­˜é¡ºåºæœºåˆ¶ã€‚\n\nä¸‹é¢ä¸¾ä¸€ä¸ªç±»ä¼¼çš„ä¾‹å­ï¼Œæ€ä¹ˆé€šè¿‡åŸå­å˜é‡+å†…å­˜é¡ºåºæ§åˆ¶ï¼Œè®©consumerç¡®ä¿produceræ‰§è¡Œå®Œæ¯•åï¼Œå† load å‡º b çš„å€¼ã€‚\n```cpp\nvoid producer(void)\n{\n    a.store(true, std::memory_order::relaxed);\n    b.store(true, std::memory_order::release);\n}\nvoid consumer(void)\n{\n    // memory_order_acquireè¡¨ç¤ºå¿…é¡»æ’åºåœ¨x storeã€y storeä¹‹å\n    while (!b.load(std::memory_order::acquire))\n    {}\n    if (a.load(std::memory_order::relaxed))\n        ++c;\n}\nint main()\n{\n    a = false;\n    b = false;\n    c = 0;\n    using namespace std::chrono::literals;\n    std::jthread th2(consumer);\n    std::this_thread::sleep_for(2s);\n    \n    std::jthread th(producer);\n\n    th.join();\n    th2.join();\n}\n```\n\n\n| ç±»å‹          | å«ä¹‰                                                                                                                                                                                  |\n| ----------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| relaxed     | CPUå’Œç¼–è¯‘å™¨å¯ä»¥é‡æ–°æ’åºå˜é‡é¡ºåºã€‚<br>è¿™æ˜¯ä¸€ç§æ¾æ•£çš„å†…å­˜é¡ºåºï¼Œä¸ä¿è¯ä¸åŒçº¿ç¨‹ä¸­çš„å†…å­˜è®¿é—®å¯¹åŸå­æ“ä½œè¿›è¡Œæ’åºã€‚                                                                                                                           |\n| consumeï¼ˆåºŸå¼ƒï¼‰ | é’ˆå¯¹æŸä¸ªåŸå­å˜é‡çš„è®¿é—®æŒ‡ä»¤ï¼ˆstoreï¼‰é‡æ’åˆ°æ­¤æŒ‡ä»¤ï¼ˆloadï¼‰å‰ã€‚**å³è‡ªå·±loadæ’åˆ°é’ˆå¯¹æŸä¸ªå˜é‡çš„releaseæ“ä½œå**ã€‚ï¼ˆåœ¨`C++26`ä¸­è¢«åºŸå¼ƒäº†ï¼Œæ¨èç”¨acquireï¼‰                                                                                         |\n| acquire     | æ‰€æœ‰è®¿é—®æŒ‡ä»¤ï¼ˆstoreï¼‰æ’åˆ°æ­¤æŒ‡ä»¤ï¼ˆloadï¼‰å‰ã€‚**å³è‡ªå·±loadæ’åˆ°æ‰€æœ‰releaseæ“ä½œå**ã€‚                                                                                                                                |\n| release     | æ‰€æœ‰è®¿é—®æŒ‡ä»¤ï¼ˆloadï¼‰æ’åˆ°æ­¤æŒ‡ä»¤ï¼ˆstoreï¼‰ä¹‹åã€‚å³è‡ªå·±storeæ’åˆ°æ‰€æœ‰consumeã€acquireæ“ä½œä¹‹å‰ã€‚<br>æ‰®æ¼”äº†ä¸€ä¸ªåŒæ­¥ç‚¹ï¼ˆsynchronization pointï¼‰çš„è§’è‰²ã€‚                                                                                  |\n| acq_rel     | The operation loadsÂ acquiringÂ and storesÂ releasingã€‚<br>è¯¥æ“ä½œå¯èƒ½æ‰®æ¼”ä¸¤ç§è§’è‰²ã€‚<br>æ¯”å¦‚`std::atomic::exchange`æ“ä½œï¼Œä¸¤ä¸ªå˜é‡äº¤æ¢ï¼š<br>éœ€è¦loadå€¼ï¼Œå¯èƒ½éœ€è¦ç­‰å¾…releaseï¼›<br>éœ€è¦storeå€¼ï¼Œå³äº§ç”Ÿreleaseï¼Œéœ€è¦ç»™å…¶ä»–acquireã€consumeé€šçŸ¥ã€‚ |\n| seq_cst     | sequentially consistentï¼Œæ„æ€æ˜¯è¯¥æ“ä½œä»¥é¡ºåºä¸€è‡´çš„æ–¹å¼æ’åºã€‚ä¸€æ—¦æ‰€æœ‰å¯èƒ½å¯¹å…¶ä»–çº¿ç¨‹äº§ç”Ÿå¯è§å‰¯ä½œç”¨çš„å†…å­˜è®¿é—®å·²ç»å‘ç”Ÿï¼Œåˆ™æ‰€æœ‰æ“ä½œä½¿ç”¨æ­¤å†…å­˜é¡ºåºã€‚<br>è¿™æ˜¯æœ€ä¸¥æ ¼çš„å†…å­˜é¡ºåºï¼Œä¿è¯äº†åœ¨éåŸå­å†…å­˜è®¿é—®ä¸­çº¿ç¨‹äº¤äº’ä¹‹é—´çš„æ„å¤–å‰¯ä½œç”¨æœ€å°ã€‚<br>å¯¹äºconsumeå’Œacquireçš„loadï¼Œé¡ºåºä¸€è‡´çš„storeæ“ä½œè¢«è®¤ä¸ºæ˜¯releaseæ“ä½œã€‚   |\n\n# lock_freeæµ‹è¯•\næµ‹è¯•ä»¥ç¡®å®šåŸå­æ¨¡æ¿åŒ…å«çš„ç±»å‹æ˜¯å¦æ”¯æŒæ— é”ã€‚\n```cpp\nint main()\n{\n    std::wcout << std::boolalpha << std::atomic<int>{}.is_lock_free() << std::endl; // true\n    std::wcout << std::boolalpha << std::atomic<int>{}.is_always_lock_free << std::endl; // true\n}\n```\nç»è¿‡æµ‹è¯•åå‘ç°ï¼Œä¸è¶…è¿‡8å­—èŠ‚ï¼ˆ64ä½ï¼‰çš„æ•°æ®ç»“æ„ï¼Œå¹¶ä¸”æ²¡æœ‰è™šå‡½æ•°è¡¨çš„æ•°æ®ç»“æ„ï¼Œæ˜¯æ”¯æŒæ— é”çš„ã€‚\n```cpp\nstruct A {int x, y; A() {}}\nstruct B {int a[2];}\nstruct C {int a[3];}\n\nint main()\n{\n    std::wcout << std::boolalpha << std::atomic<A>{}.is_lock_free() << std::endl; // true\n    std::wcout << std::boolalpha << std::atomic<B>{}.is_lock_free() << std::endl; // true\n    std::wcout << std::boolalpha << std::atomic<C>{}.is_lock_free() << std::endl; // false\n}\n```\n# æ— é”ç¼–ç¨‹çš„åŸç†\n## CASï¼ˆCompare-And-Swapï¼‰\nCASåœ¨æ‰§è¡Œäº‹åŠ¡æ—¶æŠŠæ•´ä¸ªæ•°æ®éƒ½æ‹·è´åˆ°åº”ç”¨ä¸­ï¼Œåœ¨æ•°æ®æ›´æ–°æäº¤çš„æ—¶å€™æ¯”è¾ƒæ•°æ®åº“ä¸­çš„æ•°æ®ä¸æ–°æ•°æ®ï¼Œå¦‚æœä¸¤ä¸ªæ•°æ®ä¸€æ¨¡ä¸€æ ·åˆ™è¡¨ç¤ºæ²¡æœ‰å†²çªå¯ä»¥ç›´æ¥æäº¤ï¼Œå¦‚æœæœ‰å†²çªå°±è¦äº¤ç»™ä¸šåŠ¡é€»è¾‘å»è§£å†³ã€‚ï¼ˆå…·æœ‰ABAé—®é¢˜ï¼šç”¨ç‰ˆæœ¬å·æˆ–æ—¶é—´æˆ³è§£å†³ï¼‰\n\nç°ä»£CPUæä¾›â€‹**â€‹CASï¼ˆCompare-And-Swapï¼‰â€‹**â€‹ ç­‰åŸå­æŒ‡ä»¤ï¼Œå¯åœ¨å•ä¸ªæŒ‡ä»¤å‘¨æœŸå†…å®Œæˆç±»ä¼¼ä»¥ä¸‹çš„åˆ¤æ–­å‡½æ•°ï¼š\n```c\nbool CAS(T* ptr, T old_val, T new_val)\n{\n    if (*ptr == old_val)\n    {\n        *ptr = new_val;\n        return true;\n    }\n    return false;\n}\n```\nä»¥ä¸Šç±»ä¼¼çš„æ“ä½œï¼Œå®é™…æŒ‡ä»¤æ‰§è¡ŒæœŸé—´ä¸ä¼šè¢«ä¸­æ–­ï¼Œé¿å…äº†æ•°æ®ç«äº‰ã€‚\n\næ¯”å¦‚ï¼Œç”¨è¿™ä¸ªç‰¹æ€§ï¼Œå®ç°ä¸€ä¸ªè‡ªæ—‹é”ï¼š\n```c\nint TestAndSet(int *old_ptr, int new)\n{\n    int old = *old_ptr;\n    *old_ptr = new;\n    return old;\n}\n```\n\n```c\ntypedef struct lock_t\n{\n    int flag;\n} lock_t;\nvoid init(lock_t *lock)\n{\n    lock->flag = 0;\n}\n// å½“ flag ä¸º 0 æ—¶ï¼Œå‡½æ•°è¿”å›falseï¼Œé€€å‡ºã€‚åŠ é”æˆåŠŸã€‚flagè¢«ä¿®æ”¹ä¸º 1\nvoid lock(lock_t *lock)\n{\n    while (TestAndSet(&lock->flag, 1) == 1)\n    {} // do nothing\n}\nvoid unlock(lock_t *lock)\n{\n    lock->flag = 0;\n}\n```\n## å†…å­˜é¡ºåº\n```cpp\nstd::atomic<int> flag(0);\n// çº¿ç¨‹1\ndata = 42;                                       // 1. å†™æ•°æ®\nflag.store(1, std::memory_order_release);        // 2. é‡Šæ”¾å±éšœï¼šä¿è¯ 1 ä¸€å®šåœ¨ 2 å‰å®Œæˆ\n\n// çº¿ç¨‹2\nwhile (flag.load(std::memory_order_acquire) != 1)// 3. è·å–å±éšœï¼šä¿è¯è¯»åˆ° flag = 1 æ—¶ï¼Œæ‰é€€å‡ºå¾ªç¯\n    ;                                            //    ä¸€å®šèƒ½çœ‹åˆ°data=42\nread(data);                                      // 4. å®‰å…¨è¯»å–æ•°æ®\n```\n# æ— é”æ•°æ®ç»“æ„çš„å®ç°æ¨¡å¼\n## â€è¯»-ä¿®æ”¹-å†™â€œå¾ªç¯ï¼ˆRead-Modify-Write Loopï¼‰\nè¿™æ˜¯å®ç°æ— é”çš„å…³é”®æ€ç»´ä¹‹ä¸€ï¼š**ä¹è§‚å¹¶å‘æ§åˆ¶**ï¼š**å…ˆæ‰§è¡Œæ“ä½œï¼Œæäº¤å‰ï¼ŒéªŒè¯æ•°æ®ï¼ˆtailï¼‰æœªè¢«ä¿®æ”¹ï¼Œå¦‚æœæœªè¢«ä¿®æ”¹ï¼Œå†æäº¤**\n```cpp\nbool CAS(Node* old_ptr, Node* new_ptr)\n{\n    if (this == old_ptr)\n    {\n        this = new_ptr;\n        return true;\n    }\n    return false;\n}\nvoid push(T value)\n{\n    Node* new_node = new Node(value);\n    Node* old_tail;\n    do {\n        old_tail = tail.load();              // è¯»\n        new_node->next = old_tail;           // ä¿®æ”¹\n    } while (!tail.CAS(old_tail, new_node)); // æŠŠ tail æ”¹ä¸º new_nodeï¼ˆå¤±è´¥åˆ™é‡è¯•ï¼‰\n}\n```\n## å¸®åŠ©æœºåˆ¶ï¼ˆHelping Mechanismï¼‰â€‹\n\nå½“çº¿ç¨‹Aå‘ç°çº¿ç¨‹Bçš„æ“ä½œæœªå®Œæˆæ—¶ï¼Œä¸»åŠ¨ååŠ©æ¨è¿›ï¼ˆå¦‚æ— é”é˜Ÿåˆ—ä¸­å¸®å…¶ä»–çº¿ç¨‹ç§»åŠ¨tailæŒ‡é’ˆï¼‰ã€‚\n## â€‹â€‹åˆ†ç¦»å¹¶å‘å…³æ³¨ç‚¹ï¼ˆå¦‚å¤´å°¾æŒ‡é’ˆåˆ†ç¦»ï¼‰â€‹\nå°†æ•°æ®ç»“æ„æ‹†åˆ†ä¸ºå¤šä¸ªå¯ç‹¬ç«‹æ›´æ–°çš„éƒ¨åˆ†ï¼Œå‡å°‘ç«äº‰ç‚¹ã€‚\n\nè¿™æ˜¯å®ç°æ— é”çš„å…³é”®æ€ç»´ä¹‹äºŒï¼šâ€‹**â€‹å±€éƒ¨æ€§åŸç†ï¼ˆLocality Principleï¼‰**ï¼šé€šè¿‡æ•°æ®åˆ†ç‰‡ï¼ˆå¦‚åˆ†æ§½é˜Ÿåˆ—ï¼‰å‡å°‘ç¼“å­˜è¡Œå†²çªï¼š\nå¯¹é½64ä½ã€‚\n```cpp\nstruct alignas(64) PaddedAtomic\n{ \n    std::atomic<int> count;  // ç‹¬å ç¼“å­˜è¡Œ\n};\n```\n# ABAé—®é¢˜ï¼ˆä¹è§‚é”é—®é¢˜ï¼‰\nä¹è§‚é”ä¼šå‡ºç°è¿™ç§é—®é¢˜ã€‚\n\nä¹è§‚é”æ˜¯å¯¹äºæ•°æ®å†²çªä¿æŒä¸€ç§ä¹è§‚æ€åº¦ï¼Œæ“ä½œæ•°æ®æ—¶ä¸ä¼šå¯¹æ“ä½œçš„æ•°æ®è¿›è¡ŒåŠ é”ï¼ˆè¿™ä½¿å¾—å¤šä¸ªä»»åŠ¡å¯ä»¥å¹¶è¡Œçš„å¯¹æ•°æ®è¿›è¡Œæ“ä½œï¼‰ï¼Œåªæœ‰åˆ°æ•°æ®æäº¤çš„æ—¶å€™æ‰é€šè¿‡ä¸€ç§æœºåˆ¶æ¥éªŒè¯æ•°æ®æ˜¯å¦å­˜åœ¨å†²çªï¼ˆä¸€èˆ¬å®ç°æ–¹å¼æ˜¯é€šè¿‡åŠ ç‰ˆæœ¬å·ç„¶åè¿›è¡Œç‰ˆæœ¬å·çš„å¯¹æ¯”æ–¹å¼å®ç°ï¼‰\n\nç‰¹ç‚¹ï¼šä¹è§‚é”æ˜¯ä¸€ç§å¹¶å‘ç±»å‹çš„é”ï¼Œå…¶æœ¬èº«ä¸å¯¹æ•°æ®è¿›è¡ŒåŠ é”ã€‚è€Œæ˜¯é€šè¿‡ä¸šåŠ¡å®ç°é”çš„åŠŸèƒ½ã€‚\nä¸å¯¹æ•°æ®è¿›è¡ŒåŠ é”å°±æ„å‘³ç€å…è®¸å¤šä¸ªè¯·æ±‚åŒæ—¶è®¿é—®æ•°æ®ï¼ŒåŒæ—¶ä¹Ÿçœæ‰äº†å¯¹æ•°æ®åŠ é”å’Œè§£é”çš„è¿‡ç¨‹ã€‚\nè¿™ç§æ–¹å¼èŠ‚çœäº†æ‚²è§‚é”åŠ é”çš„æ“ä½œï¼Œæ‰€ä»¥å¯ä»¥ä¸€å®šç¨‹åº¦çš„çš„æé«˜æ“ä½œçš„æ€§èƒ½ã€‚\nä¸è¿‡åœ¨å¹¶å‘éå¸¸é«˜çš„æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´å¤§é‡çš„è¯·æ±‚å†²çªï¼Œå†²çªå¯¼è‡´å¤§éƒ¨åˆ†æ“ä½œæ— åŠŸè€Œè¿”è€Œæµªè´¹èµ„æºã€‚\næ‰€ä»¥åœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œä¹è§‚é”çš„æ€§èƒ½å´åè€Œä¸å¦‚æ‚²è§‚é”ã€‚\n## é—®é¢˜åœºæ™¯\næ¯”å¦‚è¯´çº¿ç¨‹ä¸€ä»æ•°æ®åº“ä¸­å–å‡ºåº“å­˜æ•° 3ï¼Œè¿™æ—¶å€™çº¿ç¨‹äºŒä¹Ÿä»æ•°æ®åº“ä¸­å–å‡ºåº“å­˜æ•° 3ã€‚\n**çº¿ç¨‹äºŒè¿›è¡Œäº†ä¸€äº›æ“ä½œå˜æˆäº† 2**ã€‚**ä½†æ˜¯ç„¶åçº¿ç¨‹äºŒåœ¨çº¿ç¨‹ä¸€æ‹¿åˆ°æ“ä½œæƒä¹‹å‰ï¼Œåˆå°†åº“å­˜æ•°å˜æˆäº† 3**ã€‚\nè¿™æ—¶å€™ï¼šçº¿ç¨‹ä¸€è¿›è¡Œ CAS æ“ä½œå‘ç°æ•°æ®åº“ä¸­ä»ç„¶æ˜¯ 3ï¼Œç„¶åçº¿ç¨‹ä¸€æ“ä½œæˆåŠŸã€‚\nå°½ç®¡çº¿ç¨‹ä¸€çš„ CAS æ“ä½œæˆåŠŸï¼Œä½†æ˜¯ä¸ä»£è¡¨è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚\n## è§£å†³æ–¹æ¡ˆ\nä½¿ç”¨ç‰ˆæœ¬æˆ³æ¥å¯¹æ•°æ®è¿›è¡Œæ ‡è®°ï¼Œæ•°æ®æ¯å‘ç”Ÿä¸€æ¬¡ä¿®æ”¹ï¼Œç‰ˆæœ¬å·å°±å¢åŠ 1ã€‚æŸæ¡æ•°æ®åœ¨æäº¤çš„æ—¶å€™ï¼Œå¦‚æœæ•°æ®åº“ä¸­çš„ç‰ˆæœ¬å·ä¸è‡ªå·±çš„ä¸€è‡´ï¼Œå°±è¯´æ˜æ•°æ®æ²¡æœ‰å‘ç”Ÿä¿®æ”¹ï¼Œå¦åˆ™å°±è®¤ä¸ºæ˜¯è„æ•°æ®ï¼Œéœ€è¦å¤„ç†ã€‚\n\nä½¿ç”¨å¸¦ç‰ˆæœ¬å·çš„æŒ‡é’ˆï¼š\n```cpp\nstruct VersionedPtr\n{\n    Node* ptr;\n    uint64_t version;  // æ¯æ¬¡ä¿®æ”¹+1\n};\n```\n# å†…å­˜å›æ”¶æŒ‘æˆ˜\n| æ–¹æ³•                    | åŸç†                                     | é€‚ç”¨åœºæ™¯      |\n| --------------------- | -------------------------------------- | --------- |\n| Hazard Pointers       | çº¿ç¨‹æœ¬åœ°è®°å½•\"å±é™©æŒ‡é’ˆ\"ï¼ˆæœ‰çš„ä¹Ÿå«é£é™©æŒ‡é’ˆï¼‰ï¼Œå»¶è¿Ÿåˆ é™¤å…¶ä»–çº¿ç¨‹å¯èƒ½è®¿é—®çš„å†…å­˜ | Linuxå†…æ ¸å¸¸ç”¨ |\n| Epoch-Based Reclaim   | å°†å†…å­˜æ ‡è®°ä¸ºå¾…å›æ”¶ï¼Œå½“æ‰€æœ‰çº¿ç¨‹éƒ½ä¸æŒæœ‰æ—§epochæ—¶æ‰åˆ é™¤          | NVIDIAåº“å¸¸ç”¨ |\n| RCUï¼ˆRead-Copy-Updateï¼‰ | è¯»æ“ä½œæ— åŒæ­¥ï¼Œå†™æ“ä½œåˆ›å»ºå‰¯æœ¬å»¶è¿Ÿå›æ”¶                     | Linuxå†…æ ¸é“¾è¡¨ |\n# MPMCæ— é”é˜Ÿåˆ—\n## Nodeçš„è®¾è®¡ï¼ˆä¼ªå…±äº«é¢„é˜²ã€ABAé—®é¢˜è§£å†³ï¼‰\n- â€‹**â€‹ä¼ªå…±äº«é¢„é˜²â€‹**â€‹ï¼š`alignas(64)`å’Œå¡«å……ç¡®ä¿ å¤´å°¾ åœ¨ä¸åŒç¼“å­˜è¡Œ\n- **ABAé—®é¢˜é˜²æŠ¤â€‹**â€‹ï¼šé€šè¿‡`version`ç‰ˆæœ¬å·åŒºåˆ†æŒ‡é’ˆå¤ç”¨\n\n```cpp\nstruct Node\n{\n    T* data;  // æ•°æ®æŒ‡é’ˆï¼ˆé¿å…æ‹·è´å¼€é”€ï¼‰\n    std::atomic<Node*> next; // åŸå­æŒ‡é’ˆ\n    // é˜²æ­¢ä¼ªå…±äº«\n    char padding[64 - sizeof(T*) - sizeof(std::atomic<Node*>)];\n};\n\nstruct VersionedPtr\n{\n    Node* ptr;\n    uint64_t version;  // ABAé˜²æŠ¤\n};\n```\n\n```cpp\n#include <atomic>\n#include <memory>\n\ntemplate<typename T>\nclass LockFreeMPMCQueue {\nprivate:\n    // èŠ‚ç‚¹ç»“æ„ï¼šå¸¦ç¼“å­˜è¡Œå¡«å……é˜²æ­¢ä¼ªå…±äº«\n    struct Node\n    {\n        Node() : data(nullptr), next(nullptr)\n        {\n        \n        }\n        T* data;  // å­˜å‚¨å®é™…æ•°æ®æŒ‡é’ˆï¼ˆé¿å…å¯¹è±¡æ‹·è´å¼€é”€ï¼‰\n        std::atomic<Node*> next;  // ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æŒ‡é’ˆ\n        // ç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹ç‹¬å ç¼“å­˜è¡Œï¼ˆ64å­—èŠ‚ï¼‰\n        char padding[64 - sizeof(T*) - sizeof(std::atomic<Node*>)];\n    };\n\n    // å¸¦ç‰ˆæœ¬å·çš„æŒ‡é’ˆï¼ˆè§£å†³ABAé—®é¢˜ï¼‰\n    struct alignas(16) VersionedPtr\n    {\n        Node* ptr;\n        uint64_t version;\n    };\n\n    // ä¿è¯å¤´å°¾æŒ‡é’ˆä¸åœ¨åŒä¸€ç¼“å­˜è¡Œ\n    struct\n    {\n        alignas(64) std::atomic<VersionedPtr> head;\n        char padding[64];  // å¡«å……ç¡®ä¿tailåœ¨ä¸‹ä¸€ä¸ªç¼“å­˜è¡Œ\n    };\n    alignas(64) std::atomic<VersionedPtr> tail;\npublic:\n    // ...\n};\n```\n## é˜Ÿåˆ—åˆå§‹åŒ–ï¼ˆå“¨å…µdummyå¤´èŠ‚ç‚¹ï¼‰\n**ä½œç”¨â€‹**â€‹ï¼šä¿è¯éç©ºé˜Ÿåˆ—å§‹ç»ˆå­˜åœ¨å¤´èŠ‚ç‚¹ï¼Œé¿å…å¤´å°¾æŒ‡é’ˆç«æ€\n\n```cpp\n{\n// ...\npublic:\n    LockFreeMPMCQueue()\n    {\n        // åˆå§‹åŒ–å“‘å…ƒèŠ‚ç‚¹ï¼ˆdummy nodeï¼‰\n        Node* dummy = new Node();\n        \n        // å¤´å°¾æŒ‡é’ˆæŒ‡å‘åŒä¸€ä¸ªèŠ‚ç‚¹\n        VersionedPtr init = {dummy, 0};\n        head.store(init, std::memory_order_relaxed);\n        tail.store(init, std::memory_order_relaxed);\n    }\n// ...\n};\n```\n## å…¥é˜Ÿæ“ä½œ\n\n```cpp\n// ...\n    // å…¥é˜Ÿæ“ä½œï¼ˆå¤šçº¿ç¨‹å®‰å…¨ï¼‰\n    bool Enqueue(T value)\n    {\n        // 1. åˆ›å»ºæ–°èŠ‚ç‚¹å¹¶å¡«å……æ•°æ®\n        Node* new_node = new Node();\n        try\n        {\n            new_node->data = new T(std::move(value));\n        }\n        catch (...)\n        {\n            delete new_node;\n            return false;\n        }\n\n        // 2. CASå¾ªç¯ï¼šæ‰¾åˆ°çœŸæ­£çš„å°¾èŠ‚ç‚¹\n        VersionedPtr current_tail;\n        while (true)\n        {\n            // åŸå­è·å–å½“å‰å°¾æŒ‡é’ˆ\n            // current_tailæ˜¯std::atomic<VersionedPtr>ç±»å‹çš„\n            // è¿˜è¦å–å‡ºå…¶æˆå‘˜ ptrã€‚æ˜¯ Node* ç±»å‹\n            current_tail = tail.load(std::memory_order_acquire);\n            Node* real_tail = current_tail.ptr;\n            \n            // å®šä¹‰æ–°çš„ Node * nextï¼Œå…ˆè®©å®ƒæŒ‡å‘å°¾èŠ‚ç‚¹çš„ next\n            Node* next = (real_tail->next).load(std::memory_order_acquire);\n            \n            // æ£€æŸ¥æœŸé—´å°¾æŒ‡é’ˆæ˜¯å¦å˜åŒ–\n            if (current_tail.ptr != tail.load(std::memory_order_acquire).ptr)\n                continue;  // å‘ç”Ÿå˜åŒ–åˆ™å¾ªç¯é‡è¯•\n            \n            if (next == nullptr)\n            {\n                // æƒ…å†µAï¼šå°¾èŠ‚ç‚¹åæ˜¯ç©ºä½ç½®ï¼ˆç†æƒ³æƒ…å†µï¼‰\n                VersionedPtr new_ptr{new_node, current_tail.version + 1};\n                // å°è¯•å°†æ–°èŠ‚ç‚¹é“¾æ¥åˆ°å°¾èŠ‚ç‚¹åé¢\n                // å…³é”®CASï¼š\n                    // å¦‚æœæˆåŠŸï¼Œåˆ™ åŸå­æ›´æ–°å°¾èŠ‚ç‚¹çš„ next æŒ‡é’ˆï¼Œå³å°¾èŠ‚ç‚¹çš„ next æŒ‡å‘ new_node\n                    // å¦‚æœå¤±è´¥ï¼Œåˆ™ real_tail->next çš„å€¼ å†™å…¥åˆ° next ä¸­ï¼ˆè¯¦è§å‡½æ•°çš„ä½œç”¨ï¼‰\n                    // æ€»ä¹‹ä¸ä¼šé˜»å¡ã€‚\n                if (real_tail->next.compare_exchange_weak(\n                    next, new_node, \n                    std::memory_order_release,\n                    std::memory_order_relaxed)) \n                {\n                    break; // é“¾æ¥æˆåŠŸï¼Œé€€å‡ºå¾ªç¯\n                }\n            }\n            else\n            {\n                // æƒ…å†µBï¼šå‘ç°å°¾æŒ‡é’ˆæ»åï¼Œå¸®åŠ©å…¶å®ƒçº¿ç¨‹æ¨è¿›\n                // æ„æ€å°±æ˜¯è¯´ï¼Œç°åœ¨çš„ next ä¸æ˜¯ nullï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªå…¶ä»–äººå…¥é˜Ÿåˆ›å»ºçš„èŠ‚ç‚¹\n                VersionedPtr other_ptr{next, current_tail.version + 1};\n                \n                // å°è¯•æ›´æ–°å°¾æŒ‡é’ˆåˆ°åç»§èŠ‚ç‚¹ï¼ˆé¿å…ç«äº‰å¯¼è‡´çš„é˜»å¡ï¼‰\n                // å³ï¼ŒæŠŠé˜Ÿåˆ—çš„ tail æ”¹ä¸º other_ptr\n                tail.compare_exchange_strong(\n                    current_tail, other_ptr,\n                    std::memory_order_release,\n                    std::memory_order_relaxed);\n            }\n        }\n        \n        // 3. å°è¯•æ›´æ–°å…¨å±€å°¾æŒ‡é’ˆï¼ˆå…è®¸å¤±è´¥ï¼Œå› ä¸ºæœ‰å¯èƒ½æœ‰äººå¸®å¿™æ¨è¿›äº†ï¼‰\n        // å³ï¼ŒæŠŠé˜Ÿåˆ—çš„ tail æ”¹ä¸º new_tail\n        VersionedPtr new_tail{new_node, current_tail.version + 1};\n        tail.compare_exchange_strong(\n            current_tail, new_tail,\n            std::memory_order_release,\n            std::memory_order_relaxed);\n        \n        return true;\n    }\n// ...\n```\n### `compare_exchange_weak`å’Œstrong\n```cpp\nbool compare_exchange_weak(T& expected, T desired,\n                           std::memory_order success,\n                           std::memory_order failure) noexcept;\nbool compare_exchange_strong(T& expected, T desired,\n                             std::memory_order success,\n                             std::memory_order failure) noexcept;\n```\nä¸¤ä¸ªå‡½æ•°éƒ½æ˜¯ï¼š\nAtomically compares theÂ [value representation](https://en.cppreference.com/w/cpp/language/objects.html \"cpp/language/object\") (since C++20)Â ofÂ `*this`Â with that ofÂ expected. If those are bitwise-equal, replaces the former withÂ desiredÂ (performs read-modify-write operation). Otherwise, loads the actual value stored inÂ `*this`Â intoÂ expectedÂ (performs load operation).\næ¯”è¾ƒ`*this`å’Œ`expected`çš„å€¼ï¼Œè‹¥ç›¸ç­‰ï¼Œåˆ™æŠŠ`*this`æ›¿æ¢ä¸º`desired`ï¼ˆæ‰§è¡Œ`read-modify-write operation`ï¼Œå³ï¼šè¯»-ä¿®æ”¹-å†™ï¼‰ï¼Œè¿”å›çœŸã€‚å¦åˆ™ï¼ŒæŠŠ`*this`å®é™…çš„å€¼ï¼Œå­˜åˆ°`expected`ä¸­ï¼ˆæ‰§è¡Œ`load operation`ï¼‰ï¼Œè¿”å›å‡ã€‚\n\nå‚æ•°ï¼š\n`compare_exchange_weak`å’Œ`compare_exchange_strong`éƒ½åœ¨åé¢æœ‰ä¸¤ä¸ªå†…å­˜é¡ºåºçš„å‚æ•°ï¼Œç¬¬ä¸€ä¸ªå†…å­˜é¡ºåºæŒ‡çš„æ˜¯ï¼ŒæˆåŠŸæ—¶ï¼Œåš`readâ€‘modifyâ€‘writeÂ operation`çš„å†…å­˜é¡ºåºï¼›ç¬¬äºŒä¸ªå†…å­˜é¡ºåºæŒ‡çš„æ˜¯ï¼Œå¤±è´¥æ—¶ï¼Œåš`load operation`çš„å†…å­˜é¡ºåºã€‚\n\nä¸Â [compare_exchange_strong](https://legacy.cplusplus.com/atomic_compare_exchange_strong)Â ä¸åŒçš„æ˜¯ï¼Œè¿™ä¸ªå¼±ç‰ˆæœ¬å…è®¸é€šè¿‡è¿”å›Â `false`æ¥è™šå‡åœ°å¤±è´¥ï¼Œå³ä½¿`*expected`Â ç¡®å®ä¸Â objÂ ä¸­åŒ…å«çš„å€¼ç›¸ç­‰ã€‚\nå¯¹äºæŸäº›å¾ªç¯ç®—æ³•æ¥è¯´ï¼Œè¿™å¯èƒ½æ˜¯å¯æ¥å—çš„è¡Œä¸ºï¼Œå¹¶ä¸”å¯èƒ½åœ¨æŸäº›å¹³å°ä¸Šå¯¼è‡´æ˜¾è‘—æ›´å¥½çš„æ€§èƒ½ã€‚\nå¯¹äºè¿™äº›è™šå‡çš„å¤±è´¥ï¼Œå‡½æ•°è¿”å›`false`ï¼Œä½†ä¸ä¿®æ”¹é¢„æœŸã€‚\n\n## å‡ºé˜Ÿæ“ä½œ\n```cpp\n// ...\n    // å‡ºé˜Ÿæ“ä½œï¼ˆå¤šçº¿ç¨‹å®‰å…¨ï¼‰\n    bool Dequeue(T& result)\n    {\n        VersionedPtr current_head;\n        Node* real_tail;\n        Node* next;\n\n        while (true)\n        {\n            // 1. åŸå­è·å–å¤´å°¾æŒ‡é’ˆï¼ˆå…³é”®ï¼‰\n            current_head = head.load(std::memory_order_acquire);\n            Node* real_head = current_head.ptr;\n            \n            real_tail = tail.load(std::memory_order_acquire).ptr;\n            \n            next = (real_head->next).load(std::memory_order_acquire);\n\n            // ä¸€è‡´æ€§æ£€æŸ¥ï¼šé˜²æ­¢è¯»å–è¿‡ç¨‹ä¸­æ•°æ®ç»“æ„å˜åŒ–\n            if (current_head.ptr != head.load(std::memory_order_acquire).ptr)\n                continue;\n                \n            // 2. é˜Ÿåˆ—çŠ¶æ€åˆ¤æ–­\n            if (real_head == real_tail)\n            {\n                if (next == nullptr)\n                {\n                    // æƒ…å†µAï¼šé˜Ÿåˆ—ä¸ºç©º\n                    return false;\n                }\n                \n                // æƒ…å†µBï¼šå°¾æŒ‡é’ˆæ»åï¼Œå¸®åŠ©æ¨è¿›\n                VersionedPtr new_tail{next, tail.load().version + 1};\n                tail.compare_exchange_strong(\n                    tail.load(), new_tail,\n                    std::memory_order_release,\n                    std::memory_order_relaxed);\n            }\n            else\n            {\n                // æƒ…å†µCï¼šæ­£å¸¸å‡ºé˜Ÿ\n                // ç§»åŠ¨æ•°æ®å‰é¢„å…ˆåŠ è½½ï¼ˆå‡å°‘æŒæœ‰é”æ—¶é—´ï¼‰\n                // æ³¨æ„ï¼Œæˆ‘ä»¬æ˜¯æœ‰å“‘å…ƒèŠ‚ç‚¹çš„ï¼Œç°åœ¨è·å–åˆ°çš„headä¸æ˜¯çœŸå®çš„headï¼Œè€Œæ˜¯dummy\n                // dummyçš„ä¸‹ä¸€ä¸ªæ‰æ˜¯çœŸå®æœ‰æ•°æ®çš„headï¼Œå› æ­¤åœ¨è¿™é‡Œå–nextçš„data\n                T* data_ptr = next->data;\n                \n                // å°è¯•ç§»åŠ¨å¤´æŒ‡é’ˆ\n                VersionedPtr new_head{next, current_head.version + 1};\n                if (head.compare_exchange_strong(\n                    current_head, new_head,\n                    std::memory_order_release,\n                    std::memory_order_relaxed)) \n                {\n                    // å‡ºé˜ŸæˆåŠŸï¼šè½¬ç§»æ•°æ®\n                    result = std::move(*data_ptr);\n                    \n                    // å®‰å…¨åˆ é™¤æ—§å¤´èŠ‚ç‚¹ï¼ˆå·¥ä¸šå®ç°éœ€å»¶è¿Ÿå›æ”¶ï¼‰\n                    delete data_ptr;\n                    delete real_head;  // å®é™…åº”ä½¿ç”¨å±é™©æŒ‡é’ˆå›æ”¶\n                    return true;\n                }\n            }\n        }\n    }\n// ...\n```\n## ææ„\n```cpp\n// ...\n    ~LockFreeMPMCQueue()\n    {\n        // éå†åˆ é™¤æ‰€æœ‰èŠ‚ç‚¹ï¼ˆå®é™…åº”ç”¨ä¸­éœ€å¤„ç†å¹¶å‘å®‰å…¨ï¼‰\n        while (Node* node = head.load().ptr)\n        {\n            head.store({node->next, 0}, std::memory_order_relaxed);\n            delete node->data;\n            delete node;\n        }\n    }\n// ...\n```\n## å®Œæ•´ä»£ç \n```cpp\n#include <atomic>\n#include <memory>\n\ntemplate<typename T>\nclass LockFreeMPMCQueue {\nprivate:\n    // èŠ‚ç‚¹ç»“æ„ï¼šå¸¦ç¼“å­˜è¡Œå¡«å……é˜²æ­¢ä¼ªå…±äº«\n    struct Node {\n        Node() : data(nullptr), next(nullptr) {}\n        \n        T* data;  // å­˜å‚¨å®é™…æ•°æ®æŒ‡é’ˆï¼ˆé¿å…å¯¹è±¡æ‹·è´å¼€é”€ï¼‰\n        std::atomic<Node*> next;  // ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æŒ‡é’ˆ\n\n        // ç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹ç‹¬å ç¼“å­˜è¡Œï¼ˆ64å­—èŠ‚ï¼‰\n        char padding[64 - sizeof(T*) - sizeof(std::atomic<Node*>)];\n    };\n\n    // å¸¦ç‰ˆæœ¬å·çš„æŒ‡é’ˆï¼ˆè§£å†³ABAé—®é¢˜ï¼‰\n    struct alignas(16) VersionedPtr {\n        Node* ptr;\n        uint64_t version;\n    };\n\n    // ä¿è¯å¤´å°¾æŒ‡é’ˆä¸åœ¨åŒä¸€ç¼“å­˜è¡Œ\n    struct {\n        alignas(64) std::atomic<VersionedPtr> head;\n        char padding[64];  // å¡«å……ç¡®ä¿tailåœ¨ä¸‹ä¸€ä¸ªç¼“å­˜è¡Œ\n    };\n    alignas(64) std::atomic<VersionedPtr> tail;\n\npublic:\n    LockFreeMPMCQueue() {\n        // åˆå§‹åŒ–å“‘å…ƒèŠ‚ç‚¹ï¼ˆdummy nodeï¼‰\n        Node* dummy = new Node();\n        \n        // å¤´å°¾æŒ‡é’ˆæŒ‡å‘åŒä¸€ä¸ªèŠ‚ç‚¹\n        VersionedPtr init = {dummy, 0};\n        head.store(init, std::memory_order_relaxed);\n        tail.store(init, std::memory_order_relaxed);\n    }\n\n    ~LockFreeMPMCQueue() {\n        // éå†åˆ é™¤æ‰€æœ‰èŠ‚ç‚¹ï¼ˆå®é™…åº”ç”¨ä¸­éœ€å¤„ç†å¹¶å‘å®‰å…¨ï¼‰\n        while (Node* node = head.load().ptr) {\n            head.store({node->next, 0}, std::memory_order_relaxed);\n            delete node->data;\n            delete node;\n        }\n    }\n\n    // å…¥é˜Ÿæ“ä½œï¼ˆå¤šçº¿ç¨‹å®‰å…¨ï¼‰\n    bool Enqueue(T value) {\n        // 1. åˆ›å»ºæ–°èŠ‚ç‚¹å¹¶å¡«å……æ•°æ®\n        Node* new_node = new Node();\n        try {\n            new_node->data = new T(std::move(value));\n        } catch (...) {\n            delete new_node;\n            return false;\n        }\n\n        // 2. CASå¾ªç¯ï¼šæ‰¾åˆ°çœŸæ­£çš„å°¾èŠ‚ç‚¹\n        VersionedPtr current_tail;\n        while (true) {\n            // åŸå­è·å–å½“å‰å°¾æŒ‡é’ˆ\n            current_tail = tail.load(std::memory_order_acquire);\n            Node* real_tail = current_tail.ptr;\n            \n            // å°è¯•å°†æ–°èŠ‚ç‚¹é“¾æ¥åˆ°å°¾èŠ‚ç‚¹åé¢\n            Node* next = real_tail->next.load(std::memory_order_acquire);\n            \n            // æ£€æŸ¥æœŸé—´å°¾æŒ‡é’ˆæ˜¯å¦å˜åŒ–\n            if (current_tail.ptr != tail.load(std::memory_order_acquire).ptr) \n                continue;  // å‘ç”Ÿå˜åŒ–åˆ™é‡è¯•\n\n            if (next == nullptr) {\n                // æƒ…å†µAï¼šå°¾èŠ‚ç‚¹åæ˜¯ç©ºä½ç½®ï¼ˆç†æƒ³æƒ…å†µï¼‰\n                VersionedPtr new_ptr{new_node, current_tail.version + 1};\n                \n                // å…³é”®CASï¼šåŸå­æ›´æ–°å°¾èŠ‚ç‚¹çš„nextæŒ‡é’ˆ\n                if (real_tail->next.compare_exchange_weak(\n                    next, new_node, \n                    std::memory_order_release,\n                    std::memory_order_relaxed)) \n                {\n                    break; // é“¾æ¥æˆåŠŸï¼Œé€€å‡ºå¾ªç¯\n                }\n            } else {\n                // æƒ…å†µBï¼šå‘ç°å°¾æŒ‡é’ˆæ»åï¼Œå¸®åŠ©å…¶å®ƒçº¿ç¨‹æ¨è¿›\n                VersionedPtr new_ptr{next, current_tail.version + 1};\n                \n                // å°è¯•æ›´æ–°å°¾æŒ‡é’ˆåˆ°åç»§èŠ‚ç‚¹ï¼ˆé¿å…ç«äº‰å¯¼è‡´çš„é˜»å¡ï¼‰\n                tail.compare_exchange_strong(\n                    current_tail, new_ptr,\n                    std::memory_order_release,\n                    std::memory_order_relaxed);\n            }\n        }\n        \n        // 3. å°è¯•æ›´æ–°å…¨å±€å°¾æŒ‡é’ˆï¼ˆå…è®¸å¤±è´¥ï¼‰\n        VersionedPtr new_tail{new_node, current_tail.version + 1};\n        tail.compare_exchange_strong(\n            current_tail, new_tail,\n            std::memory_order_release,\n            std::memory_order_relaxed);\n        \n        return true;\n    }\n\n    // å‡ºé˜Ÿæ“ä½œï¼ˆå¤šçº¿ç¨‹å®‰å…¨ï¼‰\n    bool Dequeue(T& result) {\n        VersionedPtr current_head;\n        Node* real_tail;\n        Node* next;\n\n        while (true) {\n            // 1. åŸå­è·å–å¤´å°¾æŒ‡é’ˆï¼ˆå…³é”®ï¼‰\n            current_head = head.load(std::memory_order_acquire);\n            Node* real_head = current_head.ptr;\n            real_tail = tail.load(std::memory_order_acquire).ptr;\n            next = real_head->next.load(std::memory_order_acquire);\n\n            // ä¸€è‡´æ€§æ£€æŸ¥ï¼šé˜²æ­¢è¯»å–è¿‡ç¨‹ä¸­æ•°æ®ç»“æ„å˜åŒ–\n            if (current_head.ptr != head.load(std::memory_order_acquire).ptr)\n                continue;\n                \n            // 2. é˜Ÿåˆ—çŠ¶æ€åˆ¤æ–­\n            if (real_head == real_tail) {\n                if (next == nullptr) {\n                    // æƒ…å†µAï¼šé˜Ÿåˆ—ä¸ºç©º\n                    return false;\n                }\n                \n                // æƒ…å†µBï¼šå°¾æŒ‡é’ˆæ»åï¼Œå¸®åŠ©æ¨è¿›\n                VersionedPtr new_tail{next, tail.load().version + 1};\n                tail.compare_exchange_strong(\n                    tail.load(), new_tail,\n                    std::memory_order_release,\n                    std::memory_order_relaxed);\n            } else {\n                // æƒ…å†µCï¼šæ­£å¸¸å‡ºé˜Ÿ\n                // ç§»åŠ¨æ•°æ®å‰é¢„å…ˆåŠ è½½ï¼ˆå‡å°‘æŒæœ‰é”æ—¶é—´ï¼‰\n                T* data_ptr = next->data;\n                \n                // å°è¯•ç§»åŠ¨å¤´æŒ‡é’ˆ\n                VersionedPtr new_head{next, current_head.version + 1};\n                if (head.compare_exchange_strong(\n                    current_head, new_head,\n                    std::memory_order_release,\n                    std::memory_order_relaxed)) \n                {\n                    // å‡ºé˜ŸæˆåŠŸï¼šè½¬ç§»æ•°æ®\n                    result = std::move(*data_ptr);\n                    \n                    // å®‰å…¨åˆ é™¤æ—§å¤´èŠ‚ç‚¹ï¼ˆå·¥ä¸šå®ç°éœ€å»¶è¿Ÿå›æ”¶ï¼‰\n                    delete data_ptr;\n                    delete real_head;  // å®é™…åº”ä½¿ç”¨å±é™©æŒ‡é’ˆå›æ”¶\n                    return true;\n                }\n            }\n        }\n    }\n};\n```\n\n## å†…å­˜å›æ”¶ï¼ˆå±é™©æŒ‡é’ˆï¼‰\n```cpp\n// Hazard Pointerç®€å•å®ç°ï¼ˆçº¿ç¨‹æœ¬åœ°æ³¨å†Œï¼‰\nthread_local std::vector<Node*> hp_records(2);  // é€šå¸¸æ¯ä¸ªçº¿ç¨‹2ä¸ªè¶³å¤Ÿ\n\nvoid RetireNode(Node* old)\n{\n    // æ£€æŸ¥å…¶ä»–çº¿ç¨‹æ˜¯å¦å¼•ç”¨è¯¥èŠ‚ç‚¹\n    if (!IsPointerHazard(old))\n    {\n        delete old;\n    }\n    else\n    {\n        // åŠ å…¥å¾…åˆ é™¤åˆ—è¡¨ï¼ˆå»¶è¿Ÿå¤„ç†ï¼‰\n        retired_list.push_back(old);\n    }\n}\n```\n# æ— é”æ˜¯å¿™ç­‰å¾…å—ï¼Ÿ\næ— é”ç¼–ç¨‹å¹¶ä¸ç­‰åŒäºå¿™ç­‰å¾…ï¼ˆBusy-Waitingï¼‰ï¼Œå…¶æ ¸å¿ƒåœ¨äºã€Œéé˜»å¡ã€ï¼Œè€Œéå…·ä½“ç­‰å¾…æ–¹å¼ã€‚â€‹â€‹\n1. â€‹**â€‹ã€Œéé˜»å¡ã€çš„å®šä¹‰â€‹**\n    - _Lock-Free_ï¼šè‡³å°‘ä¸€ä¸ªçº¿ç¨‹èƒ½å‰è¿›\n    - _Wait-Free_ï¼šæ‰€æœ‰çº¿ç¨‹éƒ½èƒ½åœ¨æœ‰é™æ­¥å®Œæˆ\n2. â€‹**â€‹å»¶è¿Ÿä¸ååçš„æƒè¡¡â€‹**â€‹\n    - â€‹**â€‹å¿™ç­‰å¾…â€‹**â€‹ï¼šç‰ºç‰²CPUï¼Œä»¥é™ä½å»¶è¿Ÿï¼ˆé«˜é¢‘äº¤æ˜“ç³»ç»Ÿï¼‰\n    - â€‹**â€‹é˜»å¡ç­‰å¾…â€‹**â€‹ï¼šåŠ å¤§å»¶è¿Ÿï¼Œä»¥åŠ å¤§ååï¼ˆWebæœåŠ¡å™¨è¿æ¥æ± ï¼‰\n\næ— é”ç¼–ç¨‹å¯â€‹**â€‹æ ¹æ®ç«äº‰å¼ºåº¦åŠ¨æ€é€‰æ‹©ç­‰å¾…ç­–ç•¥â€‹**â€‹ï¼š\n1. ä½ç«äº‰æ—¶çŸ­æš‚è‡ªæ—‹ï¼ˆåˆ©ç”¨CPUæµæ°´çº¿ï¼‰\n2. ä¸­ç«äº‰æ—¶é€€é¿+ä¸»åŠ¨è®©å‡ºCPU\n3. é«˜ç«äº‰æ—¶è¿›å…¥æ“ä½œç³»ç»Ÿé˜»å¡é˜Ÿåˆ—  \n\nâ€‹**â€‹æ ¸å¿ƒç›®æ ‡æ˜¯ä»¥æœ€å°å¼€é”€ç»´æŒã€Œè‡³å°‘ä¸€ä¸ªçº¿ç¨‹å‰è¿›ã€çš„éé˜»å¡ç‰¹æ€§â€‹**â€‹ï¼Œè€Œéå¼ºåˆ¶å¿™ç­‰å¾…ã€‚\n\nå®é™…æ— é”è®¾è®¡ä¸­å¯é€šè¿‡å¤šç§ç­–ç•¥é¿å…å¿™ç­‰ï¼š\n## æ“ä½œç³»ç»Ÿçº§é˜»å¡ç­‰å¾…\n```cpp\n// C++20 å‰ï¼ˆä½¿ç”¨ futexï¼‰\nwhile (!atomic_var.compare_exchange_weak(...))\n{\n    syscall(SYS_futex, &atomic_var, FUTEX_WAIT, ...);  // ä¸»åŠ¨è®©å‡ºCPU\n}\n\n// C++20 åï¼ˆstd::atomic::waitï¼‰\natomic_var.wait(old_val, std::memory_order_relaxed);  // çº¿ç¨‹æŒ‚èµ·ç›´åˆ°å€¼å˜åŒ–\n```\n## å®šæ—¶é€€é¿ç­–ç•¥\n```cpp\nint retries = 0;\nwhile (!CAS(ptr, old_val, new_val))\n{\n    if (retries++ > MAX_SPIN)\n    {\n        std::this_thread::yield();     // æ”¾å¼ƒæ—¶é—´ç‰‡ï¼Œé€šçŸ¥è°ƒåº¦å™¨åˆ‡æ¢\n        retries = 0;\n    }\n    else\n    {\n        _mm_pause();                  // x86 è‡ªæ—‹ç­‰å¾…æŒ‡ä»¤ï¼ˆé™ä½CPUåŠŸè€—ï¼‰\n    }\n}\n```\n## é˜Ÿåˆ—åŒ–ç«äº‰æœºåˆ¶ï¼ˆæ’é˜Ÿé”ï¼‰\n```cpp\nstruct Waiter { std::atomic<Waiter*> next; };\nstd::atomic<Waiter*> tail_{nullptr};\n\nvoid lock()\n{\n    Waiter w;\n    w.next = nullptr;\n    Waiter* prev = tail_.exchange(&w, std::memory_order_acq_rel);\n    if (prev)\n    {\n        prev->next = &w;                      // æ’é˜Ÿ\n        while (w.next.load() != &w) {}       // ç­‰å¾…å‰é©±èŠ‚ç‚¹å”¤é†’\n    }\n}\n\nvoid unlock()\n{\n    Waiter* w = ...;\n    if (!w->next)\n    {                           // æ— åç»­ç­‰å¾…è€…\n        if (tail_.compare_exchange_strong(w, nullptr)) return;\n    }\n    while (!w->next.load())    // ç­‰å¾…åç»§èŠ‚ç‚¹å°±ç»ª\n    {}\n    // å”¤é†’ä¸‹ä¸€ä¸ª\n    w->next.load()->next.store(w->next.load()->next, ...); \n}\n```\n## å¯¹æ¯”\n|**ç­–ç•¥â€‹**â€‹|å®ç°æ–¹å¼|é€‚ç”¨åœºæ™¯|CPUå ç”¨|å»¶è¿Ÿ|\n|---|---|---|---|---|\n|â€‹**â€‹å¿™ç­‰å¾…â€‹**â€‹|`while(!CAS)`|æä½å»¶è¿Ÿåœºæ™¯ï¼ˆ<100nsï¼‰|100%æ ¸å¿ƒ|æä½|\n|â€‹**â€‹ä¸»åŠ¨é€€è®©â€‹**â€‹|`std::this_thread::yield()`|ç”¨æˆ·æ€ç«äº‰é€‚ä¸­|< 30%|å¾®ç§’çº§|\n|â€‹**â€‹æ“ä½œç³»ç»Ÿé˜»å¡â€‹**â€‹|`futex`Â /Â `atomic::wait`|é«˜ç«äº‰/é•¿ç­‰å¾…|~0%|æ¯«ç§’çº§|\n|â€‹**â€‹é˜Ÿåˆ—åŒ–è°ƒåº¦â€‹**â€‹|MCSé”ç­‰æ’é˜Ÿæœºåˆ¶|ä¸¥æ ¼å…¬å¹³æ€§è¦æ±‚|éšé˜Ÿåˆ—è½¬ç§»|äºšæ¯«ç§’çº§|\n## å·¥ä¸šçº§æ¡ˆä¾‹\n### Linuxå†…æ ¸Futex\n- é¦–æ¬¡CASç«äº‰å¤±è´¥åï¼Œé€šè¿‡`FUTEX_WAIT`ç³»ç»Ÿè°ƒç”¨æŒ‚èµ·çº¿ç¨‹\n- è§£é”æ—¶é€šè¿‡`FUTEX_WAKE`å”¤é†’ç­‰å¾…çº¿ç¨‹\n### â€‹â€‹Javaçš„AQSï¼ˆAbstract Queued Synchronizerï¼‰â€‹\n```java\nfinal boolean acquireQueued(...)\n{\n    for (;;)\n    {\n        if (tryAcquire(arg)) return true;  // æ— é”å°è¯•\n        if (shouldParkAfterFailedAcquire()) \n            LockSupport.park(this);       // æŒ‚èµ·çº¿ç¨‹ï¼ˆJVMå±‚é¢ï¼‰\n    }\n}\n```\n### C++20åŸå­ç­‰å¾…\n```cpp\nstd::atomic<int> flag(0);\n// æ¶ˆè´¹è€…\nwhile (!flag.wait(1, std::memory_order_seq_cst)); // é˜»å¡ç›´è‡³å€¼!=1\n// ç”Ÿäº§è€…\nflag.store(2);\nflag.notify_all();  // å”¤é†’æ‰€æœ‰ç­‰å¾…è€…\n```\n# æ€»çº¿é”å’Œç¼“å­˜é”\n## æ€»çº¿é”ï¼ˆBus Lockï¼‰\nå½“CPUæ‰§è¡Œå¸¦`LOCK`å‰ç¼€çš„æŒ‡ä»¤ï¼ˆå¦‚`CMPXCHG`ï¼‰æ—¶ï¼Œä¼šé€šè¿‡èŠ¯ç‰‡ç»„å‘å‡ºâ€‹**â€‹ç¡¬ä»¶ä¿¡å·â€‹**â€‹ï¼Œâ€‹**â€‹ç‹¬å æ•´ä¸ªå†…å­˜æ€»çº¿ï¼ˆBusï¼‰â€‹**â€‹ ã€‚æ­¤æ—¶å…¶ä»–CPUçš„æ‰€æœ‰å†…å­˜è®¿é—®è¯·æ±‚å°†è¢«é˜»å¡ï¼Œç›´åˆ°å½“å‰æ“ä½œå®Œæˆã€‚\n\n```mermaid\nsequenceDiagram\n    CPUæ ¸å¿ƒA->>å†…å­˜æ€»çº¿: LOCK#ä¿¡å·ï¼ˆæ€»çº¿é”å®šï¼‰\n    å†…å­˜æ€»çº¿->>æ‰€æœ‰CPU: é˜»å¡å…¶ä»–å†…å­˜è¯·æ±‚\n    CPUæ ¸å¿ƒA->>å†…å­˜: æ‰§è¡ŒåŸå­æ“ä½œï¼ˆå¦‚CASï¼‰\n    å†…å­˜æ€»çº¿->>æ‰€æœ‰CPU: è§£é”\n```\nç‰¹ç‚¹\n- â€‹**â€‹å…¨å±€æ€§é”å®šâ€‹**â€‹ï¼šé”å®šæœŸé—´æ‰€æœ‰å†…å­˜æ“ä½œå‡è¢«é˜»å¡ï¼ˆåŒ…æ‹¬éç«äº‰æ•°æ®ï¼‰\n- â€‹**â€‹æ€§èƒ½å¼€é”€å¤§â€‹**â€‹ï¼šåŸå­æ“ä½œä¸²è¡ŒåŒ–ï¼Œå¤šæ ¸æ€§èƒ½æ€¥å‰§ä¸‹é™\n- â€‹**â€‹å…¼å®¹æ€§å¼ºâ€‹**â€‹ï¼šæ—©æœŸx86å¤„ç†å™¨çš„å”¯ä¸€é€‰æ‹©ï¼ˆå¦‚80486ï¼‰\n## ç¼“å­˜é”ï¼ˆCache Lockingï¼‰â€”â€” MESIä¼˜åŒ–\næ ¸å¿ƒï¼šç¼“å­˜ä¸€è‡´æ€§åè®®ï¼ˆCache Coherenceï¼‰\n\nç°ä»£CPUé€šè¿‡â€‹**â€‹MESIåè®®â€‹**â€‹ï¼ˆModified/Exclusive/Shared/Invalidï¼‰ç»´æŠ¤å¤šæ ¸ç¼“å­˜ä¸€è‡´æ€§ï¼š\n\n```mermaid\ngraph LR\n    Modified -->|å†™å›| Invalid\n    Exclusive -->|å…¶ä»–æ ¸è¯»| Shared\n    Shared -->|å†™| Modified\n    Invalid -->|å†™| Exclusive\n```\n### ç¼“å­˜é”çš„è§¦å‘æ¡ä»¶ï¼ˆä»¥Intel CPUä¸ºä¾‹ï¼‰\nå½“åŸå­æ“ä½œè®¿é—®çš„æ•°æ®æ»¡è¶³ï¼š\n1. â€‹**â€‹å¯¹é½åœ¨ç¼“å­˜è¡Œå†…â€‹**â€‹ï¼ˆé€šå¸¸64å­—èŠ‚å¯¹é½ï¼‰\n2. â€‹**â€‹ç›®æ ‡åœ°å€æœªè·¨ç¼“å­˜è¡Œâ€‹**â€‹ï¼ˆNon-split Accessï¼‰\n3. â€‹**â€‹CPUæ”¯æŒç¼“å­˜é”å®šæŠ€æœ¯â€‹**â€‹ï¼ˆå‡ ä¹æ‰€æœ‰ç°ä»£å¤„ç†å™¨ï¼‰\n\n### å·¥ä½œæµç¨‹\n```cpp\n// ç¤ºä¾‹ï¼šä¸¤ä¸ªçº¿ç¨‹åœ¨æ ¸ 0 å’Œæ ¸ 1 ä¸Šæ‰§è¡ŒåŸå­æ“ä½œ\n// åˆå§‹çŠ¶æ€ï¼šå˜é‡ X è¢«æ ¸ 0 å’Œæ ¸ 1 ç¼“å­˜ï¼ˆSharedçŠ¶æ€ï¼‰\n1. æ ¸0æ‰§è¡ŒåŸå­æ“ä½œï¼ˆå¦‚X++ï¼‰:\n   - å‘å‡ºRFOï¼ˆRequest For Ownershipï¼‰æ¶ˆæ¯\n   - å…¶ä»–æ ¸å¿ƒå°†Xçš„ç¼“å­˜è¡Œç½®ä¸ºInvalid\n   - æ ¸0å°†ç¼“å­˜è¡Œç½®ä¸ºModifiedçŠ¶æ€\n   - æ‰§è¡Œä¿®æ”¹ï¼ˆæœªè§¦å‘æ€»çº¿é”ï¼‰\n2. æ ¸1å°è¯•æ“ä½œXï¼š\n   - å‘ç°ç¼“å­˜å¤±æ•ˆï¼ˆInvalidï¼‰\n   - ä»æ ¸0çš„ç¼“å­˜ä¸­è¯»å–æœ€æ–°æ•°æ®ï¼ˆç¼“å­˜è¡ŒçŠ¶æ€è½¬ä¸ºSharedï¼‰\n```\n### é¿å…ç¼“å­˜å†²çª\n#### å†…å­˜å¯¹é½é¿å…æ€»çº¿é”\n```cpp\n// é”™è¯¯ï¼šå˜é‡å¯èƒ½è·¨ç¼“å­˜è¡Œ\nstruct Unaligned\n{\n    char padding[62]; // 62å­—èŠ‚å¡«å……\n    std::atomic<int> x; // ä½äº62-66å­—èŠ‚ï¼ˆè·¨è¶Šä¸¤ä¸ªç¼“å­˜è¡Œï¼‰\n};\n\n// æ­£ç¡®ï¼šå¼ºåˆ¶ç¼“å­˜è¡Œå¯¹é½\nstruct alignas(64) Aligned\n{\n    std::atomic<int> x; // ç‹¬å ä¸€ä¸ªç¼“å­˜è¡Œ\n};\n```\n>æ£€æµ‹æ–¹æ³•ï¼šLinuxä¸‹`perf c2c`å¯æ£€æµ‹ç¼“å­˜è¡Œå†²çªï¼ˆFalse Sharingï¼‰\n\n#### å†™ç«äº‰ä¸‹çš„æ€§èƒ½å·®å¼‚â€‹\nå½“ä¸¤ä¸ªCPUæ ¸å¿ƒé¢‘ç¹å†™â€‹**â€‹åŒä¸€ç¼“å­˜è¡Œâ€‹**â€‹æ—¶ï¼š\n- â€‹**â€‹ç¼“å­˜é”åœºæ™¯â€‹**â€‹ï¼šç¼“å­˜è¡Œåœ¨`Modified`â†”`Invalid`çŠ¶æ€é—´éœ‡è¡ï¼Œäº§ç”Ÿå¤§é‡RFOæ¶ˆæ¯\n- â€‹**â€‹è§£å†³æ–¹æ¡ˆâ€‹**â€‹ï¼šâ€‹**â€‹ä¼ªå…±äº«éš”ç¦»ï¼ˆFalse Sharing Eliminationï¼‰**\n\n```cpp\n// å¤šæ ¸è®¡æ•°å™¨ä¼˜åŒ–ï¼ˆæ¯ä¸ªæ ¸ç‹¬å ç¼“å­˜è¡Œï¼‰\nstruct PerCoreCounter\n{\n    alignas(64) std::atomic<int> value;\n};\nPerCoreCounter counters[CPU_CORES]; \n```\n## ç‰¹æ®Šåœºæ™¯æ€»çº¿é”ä¸å¯é¿å…\n```asm\nLOCK XCHG [mem], reg  ; æ˜¾å¼LOCKå‰ç¼€\nCMPXCHG16B m128       ; 128ä½è·¨ç¼“å­˜è¡Œæ“ä½œ\nä¸€ä¸ªæœªå¯¹é½çš„LOCKæ“ä½œ    ; å¦‚å¯¹è·¨64å­—èŠ‚è¾¹ç•Œçš„intæ“ä½œ\n```\n## å¯¹æ¯”\n| â€‹**â€‹ç‰¹å¾â€‹**â€‹   | æ€»çº¿é”           | ç¼“å­˜é”             |\n| ------------ | ------------- | --------------- |\n| â€‹**â€‹é”å®šèŒƒå›´â€‹**â€‹ | æ•´ä¸ªå†…å­˜æ€»çº¿        | å•ä¸ªç¼“å­˜è¡Œ           |\n| â€‹**â€‹æ€§èƒ½å½±å“â€‹**â€‹ | å…¨å±€åœé¡¿ï¼Œæ€§èƒ½æŸå¤±ä¸¥é‡   | ä»…å½±å“æ¶‰åŠç‰¹å®šç¼“å­˜è¡Œçš„æ“ä½œ   |\n| â€‹**â€‹è§¦å‘æ¡ä»¶â€‹**â€‹ | `LOCK`å‰ç¼€æŒ‡ä»¤    | å†…å­˜å¯¹é½ä¸”æœªè·¨ç¼“å­˜è¡Œçš„åŸå­æ“ä½œ |\n| â€‹**â€‹å®ç°æŠ€æœ¯â€‹**â€‹ | ç¡¬ä»¶ä¿¡å·ç¡¬é˜»å¡       | MESIç¼“å­˜ä¸€è‡´æ€§åè®®     |\n| â€‹**â€‹ç°ä»£åº”ç”¨â€‹**â€‹ | ä»…ä½œå…œåº•ï¼ˆå¦‚è·¨ç¼“å­˜è¡Œæ“ä½œï¼‰ | 99%åŸå­æ“ä½œçš„é»˜è®¤å®ç°    |\n| â€‹**â€‹èƒ½è€—â€‹**â€‹   | é«˜ï¼ˆæ€»çº¿å¼€å…³ï¼‰       | ä½ï¼ˆä»…ç¼“å­˜çŠ¶æ€åˆ‡æ¢ï¼‰      |\n","categories":["æ“ä½œç³»ç»Ÿ","å¤šçº¿ç¨‹","Cpp","Modern"]},{"title":"å•ä¾‹æ¨¡å¼","url":"/è®¾è®¡æ¨¡å¼/å•ä¾‹æ¨¡å¼/","content":"# å†…å®¹\n\n1. å•ä¾‹æ¨¡å¼ç®€ä»‹\n2. é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼\n3. æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼\n4. çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼\n# å•ä¾‹æ¨¡å¼ç®€ä»‹\n\nå•ä¾‹æ¨¡å¼æŒ‡çš„æ˜¯ï¼Œæ— è®ºæ€ä¹ˆè·å–ï¼Œ**æ°¸è¿œåªèƒ½å¾—åˆ°è¯¥ç±»ç±»å‹çš„å”¯ä¸€ä¸€ä¸ªå®ä¾‹å¯¹è±¡**ï¼Œé‚£ä¹ˆè®¾è®¡ä¸€ä¸ªå•ä¾‹å°±å¿…é¡»è¦æ»¡è¶³ä¸‹é¢ä¸‰ä¸ªæ¡ä»¶ï¼š\n1. æ„é€ å‡½æ•°ç§æœ‰åŒ–ï¼Œè¿™æ ·ç”¨æˆ·å°±ä¸èƒ½ä»»æ„å®šä¹‰è¯¥ç±»å‹çš„å¯¹è±¡äº†\n2. å®šä¹‰è¯¥ç±»å‹å”¯ä¸€çš„å¯¹è±¡\n3. é€šè¿‡ä¸€ä¸ªstaticé™æ€æˆå‘˜æ–¹æ³•è¿”å›å”¯ä¸€çš„å¯¹è±¡å®ä¾‹\n# é¥¿æ±‰å¼ï¼ˆæœ¬èº«çº¿ç¨‹å®‰å…¨ï¼‰\n\n**é¥¿æ±‰å¼**å•ä¾‹æ¨¡å¼ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ç¨‹åºå¯åŠ¨æ—¶å°±å®ä¾‹åŒ–äº†è¯¥å¯¹è±¡ï¼Œå¹¶æ²¡æœ‰æ¨è¿Ÿåˆ°ç¬¬ä¸€æ¬¡ä½¿ç”¨è¯¥å¯¹è±¡æ—¶å†è¿›è¡Œå®ä¾‹åŒ–ï¼›å¦‚æœè¿è¡Œè¿‡ç¨‹ä¸­æ²¡æœ‰ä½¿ç”¨åˆ°ï¼Œè¯¥å®ä¾‹å¯¹è±¡å°±è¢«æµªè´¹æ‰äº†ã€‚\n\n```cpp\nclass CSingleton\n{\npublic:\n\tstatic CSingleton* getInstance()\n\t{\n\t\treturn &single;\n\t}\nprivate:\n\tstatic CSingleton single;\n\tCSingleton() { cout << \"CSingleton()\" << endl; }\n\t~CSingleton() { cout << \"~CSingleton()\" << endl; }\n\tCSingleton(const CSingleton&) = delete; // é˜²æ­¢å¤–éƒ¨ä½¿ç”¨æ‹·è´æ„é€ äº§ç”Ÿæ–°çš„å¯¹è±¡\n};\nCSingleton CSingleton::single;\n\nint main()\n{\n\tCSingleton *p1 = CSingleton::getInstance();\n\tCSingleton *p2 = CSingleton::getInstance();\n\tCSingleton *p3 = CSingleton::getInstance();\n\tcout << p1 << \" \" << p2 << \" \" << p3 << endl;\n\treturn 0;\n}\n\n```\næ‰“å°`0016E138 0016E138 0016E138`\nå¯ä»¥çœ‹åˆ°ï¼Œä¸‰æ¬¡è·å–çš„CSingletonå¯¹è±¡éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡å®ä¾‹ï¼Œè¿™æ˜¯ä¸€ä¸ª**é¥¿æ±‰å¼**å•ä¾‹æ¨¡å¼ã€‚\n# æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰\n\n**æ‡’æ±‰å¼**å•ä¾‹æ¨¡å¼ï¼Œé¡¾åæ€ä¹‰ï¼Œå°†å¯¹è±¡çš„å®ä¾‹åŒ–å»¶è¿Ÿåˆ°ç¬¬ä¸€æ¬¡ä½¿ç”¨å®ƒçš„æ—¶åˆ»ã€‚\n\n```cpp\nclass CSingleton\n{\npublic:\n\tstatic CSingleton* getInstance()\n\t{\n\t\tif (nullptr == single)\n\t\t{\n\t\t\tsingle = new CSingleton();\n\t\t}\n\t\treturn single;\n\t}\nprivate:\n\tstatic CSingleton *single;\n\tCSingleton() { cout << \"CSingleton()\" << endl; }\n\t~CSingleton() { cout << \"~CSingleton()\" << endl; }\n\tCSingleton(const CSingleton&) = delete;\n};\nCSingleton* CSingleton::single = nullptr;\n\nint main()\n{\n\tCSingleton *p1 = CSingleton::getInstance();\n\tCSingleton *p2 = CSingleton::getInstance();\n\tCSingleton *p3 = CSingleton::getInstance();\n\tcout << p1 << \" \" << p2 << \" \" << p3 << endl;\n\treturn 0;\n}\n\n```\n\nç¬¦åˆå•ä¾‹æ¨¡å¼çš„è¦æ±‚ï¼Œä¸‰æ¬¡è·å–çš„éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œè€Œä¸”ç¨‹åºå¯åŠ¨æ—¶ï¼Œåªå¯¹singleæŒ‡é’ˆåˆå§‹åŒ–äº†ç©ºå€¼ï¼Œç­‰ç¬¬ä¸€æ¬¡è°ƒç”¨`getInstance`å‡½æ•°æ—¶ï¼Œç”±äºsingleæŒ‡é’ˆä¸º`nullptr`ï¼Œæ‰è¿›è¡Œå¯¹è±¡çš„å®ä¾‹åŒ–ï¼Œæ‰€ä»¥æ˜¯ä¸€ä¸ª**æ‡’æ±‰å¼**å•ä¾‹æ¨¡å¼ã€‚\n# æ²¡æœ‰é‡Šæ”¾å•ä¾‹å¯¹è±¡ - å†…å­˜æ³„æ¼\nä½†æ˜¯ä¸Šé¢çš„ä»£ç æœ‰ä¸€ä¸ªé—®é¢˜ï¼šåªæœ‰newæ²¡æœ‰deleteï¼ä½œä¸º`C++`å¼€å‘è€…ï¼Œèµ„æºçš„åˆ†é…å’Œå›æ”¶ï¼Œæˆ‘ä»¬å¿…é¡»è¦è€ƒè™‘æ¸…æ¥šï¼Œä¸èƒ½ç³Šæ¶‚ã€‚\n\nè¿™ä¸ªé—®é¢˜ç¡®å®æ£˜æ‰‹ï¼Œé¦–å…ˆèµ„æºçš„é‡Šæ”¾å¦‚æœäº¤ç»™ç”¨æˆ·æ¥æ“ä½œï¼Œéš¾å…ä¼šå¿˜è®°å†™deleteï¼Œåˆæˆ–è€…å¤šæ¬¡deleteï¼Œå¯èƒ½é”™è¯¯é‡Šæ”¾é‡æŒ‡é’ˆã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨staticé™æ€å¯¹è±¡åœ¨ç¨‹åºç»“æŸæ—¶è‡ªåŠ¨ææ„è¿™ä¹ˆä¸€ä¸ªç‰¹å¾ï¼Œç»™å‡ºå¦‚ä¸‹é‡Šæ”¾èµ„æºçš„ä»£ç ï¼šåœ¨å•ä¾‹ç±»ä¸­å®šä¹‰ä¸€ä¸ªåµŒå¥—ç±»ï¼Œåœ¨åµŒå¥—ç±»çš„ææ„å‡½æ•°ä¸­ï¼Œè‡ªåŠ¨é‡Šæ”¾å¤–å±‚ç±»çš„èµ„æºã€‚\n\n```cpp\nclass CSingleton\n{\npublic:\n\tstatic CSingleton* getInstance()\n\t{\n\t\tif (nullptr == single)\n\t\t{\n\t\t\tsingle = new CSingleton();\n\t\t}\n\t\treturn single;\n\t}\nprivate:\n\tstatic CSingleton *single;\n\tCSingleton() { cout << \"CSingleton()\" << endl; }\n\t~CSingleton() { cout << \"~CSingleton()\" << endl; }\n\tCSingleton(const CSingleton&) = delete;\n\n\t// å®šä¹‰ä¸€ä¸ªåµŒå¥—ç±»ï¼Œåœ¨è¯¥ç±»çš„ææ„å‡½æ•°ä¸­ï¼Œè‡ªåŠ¨é‡Šæ”¾å¤–å±‚ç±»çš„èµ„æº\n\tclass CRelease\n\t{\n\tpublic:\n\t\t~CRelease() { delete single; }\n\t};\n\t// é€šè¿‡è¯¥é™æ€å¯¹è±¡åœ¨ç¨‹åºç»“æŸæ—¶è‡ªåŠ¨ææ„çš„ç‰¹ç‚¹ï¼Œæ¥é‡Šæ”¾å¤–å±‚ç±»çš„å¯¹è±¡èµ„æº\n\tstatic CRelease release;\n};\nCSingleton* CSingleton::single = nullptr;\nCSingleton::CRelease CSingleton::release;\n\nint main()\n{\n\tCSingleton *p1 = CSingleton::getInstance();\n\tCSingleton *p2 = CSingleton::getInstance();\n\tCSingleton *p3 = CSingleton::getInstance();\n\tcout << p1 << \" \" << p2 << \" \" << p3 << endl;\n\treturn 0;\n}\n\n```\n\n# çº¿ç¨‹å®‰å…¨çš„æ‡’æ±‰å¼ - é”\n\nåœ¨å¼€å‘æœåŠ¡å™¨ç¨‹åºçš„æ—¶å€™ï¼Œç»å¸¸ä¼šç”¨åˆ°å¤šçº¿ç¨‹ï¼Œå¤šçº¿ç¨‹è¦è€ƒè™‘ä»£ç çš„çº¿ç¨‹å®‰å…¨ç‰¹æ€§ï¼Œä¸èƒ½è®©ä»£ç åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å‡ºç°ç«æ€æ¡ä»¶ï¼Œå¦åˆ™å°±è¦è¿›è¡Œçº¿ç¨‹äº’æ–¥æ“ä½œï¼Œæˆ‘ä»¬æ¥è€ƒè™‘ä¸€ä¸‹ä¸Šé¢ä¸¤ç§å•ä¾‹æ¨¡å¼ï¼Œå¦‚æœç”¨åœ¨å¤šçº¿ç¨‹ç¯å¢ƒå½“ä¸­ï¼Œæ˜¯å¦æ˜¯çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼ã€‚\n1. é¥¿æ±‰å•ä¾‹æ¨¡å¼çš„çº¿ç¨‹å®‰å…¨ç‰¹æ€§\n    1. é¥¿æ±‰å•ä¾‹æ¨¡å¼ä¸­ï¼Œå•ä¾‹å¯¹è±¡å®šä¹‰æˆäº†ä¸€ä¸ªstaticé™æ€å¯¹è±¡ï¼Œå®ƒæ˜¯åœ¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œmainå‡½æ•°è¿è¡Œä¹‹å‰å°±åˆå§‹åŒ–å¥½çš„ï¼Œå› æ­¤ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¯ä»¥æ”¾å¿ƒåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨ã€‚\n2. æ‡’æ±‰å•ä¾‹æ¨¡å¼çš„çº¿ç¨‹å®‰å…¨ç‰¹æ€§\n    1. æ‡’æ±‰å•ä¾‹æ¨¡å¼ï¼Œè·å–å•ä¾‹å¯¹è±¡çš„æ–¹æ³•å¦‚ä¸‹ï¼š\n\n```cpp\nstatic CSingleton* getInstance()\n{\n    if (nullptr == single)\n    {\n        single = new CSingleton();\n    }\n    return single;\n}\n```\nå¾ˆæ˜æ˜¾ï¼Œè¿™ä¸ª`getInstance`æ˜¯ä¸ªä¸å¯é‡å…¥å‡½æ•°ï¼Œä¹Ÿå°±å®ƒåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­æ‰§è¡Œï¼Œä¼šå‡ºç°ç«æ€æ¡ä»¶é—®é¢˜ï¼Œé¦–å…ˆææ¸…æ¥šè¿™å¥ä»£ç ï¼Œ`single = new CSingleton()`å®ƒä¼šåšä¸‰ä»¶äº‹æƒ…ï¼Œå¼€è¾Ÿå†…å­˜ï¼Œè°ƒç”¨æ„é€ å‡½æ•°ï¼Œç»™singleæŒ‡é’ˆèµ‹å€¼ï¼Œé‚£ä¹ˆåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå°±æœ‰å¯èƒ½å‡ºç°å¦‚ä¸‹é—®é¢˜ï¼š\n1. çº¿ç¨‹Aå…ˆè°ƒç”¨getInstanceå‡½æ•°ï¼Œç”±äºsingleä¸º`nullptr`ï¼Œè¿›å…¥ifè¯­å¥\n2. newæ“ä½œå…ˆå¼€è¾Ÿå†…å­˜ï¼Œæ­¤æ—¶Açº¿ç¨‹çš„CPUæ—¶é—´ç‰‡åˆ°äº†ï¼Œåˆ‡æ¢åˆ°Bçº¿ç¨‹\n3. Bçº¿ç¨‹ç”±äºsingleä¸º`nullptr`ï¼Œä¹Ÿè¿›å…¥ifè¯­å¥äº†ï¼Œå¼€å§‹newæ“ä½œ\n\nå¾ˆæ˜æ˜¾ï¼Œä¸Šé¢ä¸¤ä¸ªçº¿ç¨‹éƒ½è¿›å…¥äº†ifè¯­å¥ï¼Œéƒ½è¯•å›¾newä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œä¸ç¬¦åˆå•ä¾‹æ¨¡å¼çš„è®¾è®¡ï¼Œé‚£è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿåº”è¯¥ä¸ºgetInstanceå‡½æ•°å†…éƒ¨åŠ é”ï¼Œåœ¨çº¿ç¨‹é—´è¿›è¡Œäº’æ–¥æ“ä½œã€‚\n```cpp\n#include <iostream>\n#include <pthread.h>\nusing namespace std;\n\nclass CSingleton\n{\npublic:\n    static CSingleton* getInstance()\n  \t{\n  \t\t// è·å–äº’æ–¥é”\n  \t\tpthread_mutex_lock(&mutex);\n  \t\tif (nullptr == single)\n  \t\t{\n  \t\t\tsingle = new CSingleton();\n  \t\t}\n  \t\t// é‡Šæ”¾äº’æ–¥é”\n  \t\tpthread_mutex_unlock(&mutex);\n  \t\treturn single;\n  \t}\nprivate:\n  \tstatic CSingleton *single;\n  \tCSingleton() { cout << \"CSingleton()\" << endl; }\n  \t~CSingleton() \n  \t{\n  \t\tpthread_mutex_destroy(&mutex); // é‡Šæ”¾é”\n  \t\tcout << \"~CSingleton()\" << endl; \n  \t}\n  \tCSingleton(const CSingleton&);\n  \n  \tclass CRelease\n  \t{\n  \tpublic:\n  \t\t~CRelease() { delete single; }\n  \t};\n  \tstatic CRelease release;\n  \t\n  \t// å®šä¹‰çº¿ç¨‹é—´çš„äº’æ–¥é”\n  \tstatic pthread_mutex_t mutex;\n};\nCSingleton* CSingleton::single = nullptr;\nCSingleton::CRelease CSingleton::release;\n// äº’æ–¥é”çš„åˆå§‹åŒ–\npthread_mutex_t CSingleton::mutex = PTHREAD_MUTEX_INITIALIZER;\n\nint main()\n{\n    CSingleton *p1 = CSingleton::getInstance();\n    CSingleton *p2 = CSingleton::getInstance();\n    CSingleton *p3 = CSingleton::getInstance();\n    return 0;\n}\n```\nä¸Šé¢çš„ä»£ç ï¼Œæ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„æ‡’æ±‰å•ä¾‹æ¨¡å¼ï¼Œä½†æ˜¯æ•ˆç‡å¤ªä½ï¼Œå› ä¸ºæ¯æ¬¡è°ƒç”¨getInstanceéƒ½éœ€è¦åŠ é”è§£é”ï¼Œé™¤äº†ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œåé¢å¯¹getInstanceå‡½æ•°æŒç»­çš„åŠ è§£é”å®åœ¨æ—¶æ²¡æœ‰å¿…è¦ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦ä½¿ç”¨`é”+åŒé‡åˆ¤æ–­`ï¼Œä¹Ÿå«**åŒé‡æ£€éªŒé”**ï¼ŒæŠŠä¸Šé¢çš„getInstanceå‡½æ•°ä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š\n```cpp\nstatic CSingleton* getInstance()\n{\n  \tif (nullptr == single)\n  \t{\n        // è·å–äº’æ–¥é”\n        pthread_mutex_lock(&mutex);\n        /* \n            è¿™é‡Œéœ€è¦å†æ·»åŠ ä¸€ä¸ªifåˆ¤æ–­ï¼Œå¦åˆ™å½“ä¸¤ä¸ª\n            çº¿ç¨‹éƒ½è¿›å…¥è¿™é‡Œï¼Œåˆä¼šå¤šæ¬¡newå¯¹è±¡ï¼Œä¸ç¬¦åˆå•ä¾‹æ¨¡å¼\n        */\n        if(nullptr == single)\n        {\n            single = new CSingleton();\n        }\n        // é‡Šæ”¾äº’æ–¥é”\n        pthread_mutex_unlock(&mutex);\n    }\n\n    return single;\n}\n```\nå¦‚æœæŠŠmutexå°è£…ä¸ºä¸€ä¸ªç±»ï¼Œé‚£ä¹ˆæ›´åŠ ç¬¦åˆé¢å‘å¯¹è±¡çš„æ€æƒ³ã€‚\n```cpp\n#include <iostream>\n#include <pthread.h>\nusing namespace std;\n\n// å¯¹äº’æ–¥é”æ“ä½œçš„å°è£…\nclass CMutex\n{\npublic:\n    CMutex(){pthread_mutex_init(&mutex, NULL);}  // åˆå§‹åŒ–é”\n    ~CMutex(){pthread_mutex_destroy(&mutex);}  // é”€æ¯é” \n    void lock(){pthread_mutex_lock(&mutex);}  // è·å–é”\n    void unlock(){pthread_mutex_unlock(&mutex);}  // é‡Šæ”¾é”\nprivate:\n    pthread_mutex_t mutex;\n};\n\nclass CSingleton\n{\npublic:\n    static CSingleton* getInstance()\n    {\n        if (nullptr == single)\n        {\n            // è·å–äº’æ–¥é”\n            mutex.lock();\n            /* \n                è¿™é‡Œéœ€è¦å†æ·»åŠ ä¸€ä¸ªifåˆ¤æ–­ï¼Œå¦åˆ™å½“ä¸¤ä¸ª\n                çº¿ç¨‹éƒ½è¿›å…¥è¿™é‡Œï¼Œåˆä¼šå¤šæ¬¡newå¯¹è±¡ï¼Œä¸ç¬¦åˆ\n                å•ä¾‹æ¨¡å¼çš„æ¶‰åŠ\n            */\n            if(nullptr == single)\n            {\n                single = new CSingleton();\n            }\n            // é‡Šæ”¾äº’æ–¥é”\n            mutex.unlock();\n        }\n\n        return single;\n    }\nprivate:\n    static CSingleton *single;\n    CSingleton() { cout << \"CSingleton()\" << endl; }\n    ~CSingleton() { cout << \"~CSingleton()\" << endl;}\n    CSingleton(const CSingleton&);\n\n    class CRelease\n    {\n    public:\n        ~CRelease() { delete single; }\n    };\n    static CRelease release;\n\n    //çº¿ç¨‹é—´çš„é™æ€äº’æ–¥é”\n    static CMutex mutex;\n};\nCSingleton* CSingleton::single = nullptr;\nCSingleton::CRelease CSingleton::release;\n// å®šä¹‰äº’æ–¥é”é™æ€å¯¹è±¡\nCMutex CSingleton::mutex;\n\nint main() \n{\n    CSingleton *p1 = CSingleton::getInstance();\n    CSingleton *p2 = CSingleton::getInstance();\n    CSingleton *p3 = CSingleton::getInstance();\n    return 0;\n}\n```\nè¾“å‡ºç»“æœï¼š\n```\nCSingleton()\n~CSingleton()\n```\n# çº¿ç¨‹å®‰å…¨çš„æ‡’æ±‰å¼ - `call_once`\n```cpp\n#include <iostream>\n#include <mutex> // call_once\nusing namespace std;\nclass CSingleton\n{\npublic:\n\tstatic CSingleton* getInstance()\n\t{\n    \t// ç¡®ä¿çº¿ç¨‹å®‰å…¨çš„åªåˆå§‹åŒ–ä¸€æ¬¡\n\t\tstd::call_once(once_flag, init);\n\t\treturn single;\n\t}\nprivate:\n\tstatic void init()\n\t{\n    \t// æ— éœ€æ£€æŸ¥ if (!single)ï¼Œå› ä¸º call_once ä¿è¯åªæ‰§è¡Œä¸€æ¬¡\n\t\tsingle = new CSingleton;\n\t}\n\tstatic CSingleton * single;\n\tstatic std::once_flag once_flag;\n\tCSingleton() { cout << \"CSingleton()\" << endl; }\n\t~CSingleton() { cout << \"~CSingleton()\" << endl; }\n\tCSingleton(const CSingleton&) = delete;\n\tCSingleton& operator=(const CSingleton&) = delete;\n\t\n\tclass CRelease\n\t{\n\tpublic:\n\t\t~CRelease() { delete single; }\n\t};\n\tstatic CRelease release;\n};\n// ç±»å¤–å®šä¹‰\nCSingleton* CSingleton::single = nullptr;\nstd::once_flag CSingleton::once_flag;\nCSingleton::CRelease CSingleton::release; // ç¨‹åºç»“æŸæ—¶è‡ªåŠ¨è°ƒç”¨ææ„\nint main()\n{\n\tCSingleton* p1 = CSingleton::getInstance();\n\tCSingleton* p2 = CSingleton::getInstance();\n\tCSingleton* p3 = CSingleton::getInstance();\n\treturn 0;\n}\n```\nè¿è¡Œç»“æœï¼š\n```\nCSingleton()\n~CSingleton()\n```\n# æ›´ç®€æ´çš„çº¿ç¨‹å®‰å…¨çš„æ‡’æ±‰å¼\n\nä¸‹é¢è¿™ä¸ªæ‡’æ±‰å•ä¾‹æ¨¡å¼æ˜¯å¦æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä»£ç å¦‚ä¸‹ï¼š\n```cpp\n#include <iostream>\nusing namespace std;\n\nclass CSingleton\n{\npublic:\n\tstatic CSingleton* getInstance()\n\t{\n\t\tstatic CSingleton single; // æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼Œå®šä¹‰å”¯ä¸€çš„å¯¹è±¡å®ä¾‹\n\t\treturn &single;\n\t}\nprivate:\n\tCSingleton() { cout << \"CSingleton()\" << endl; }\n\t~CSingleton() { cout << \"~CSingleton()\" << endl; }\n\tCSingleton(const CSingleton&) = delete;\n};\nint main()\n{\n\tCSingleton *p1 = CSingleton::getInstance();\n\tCSingleton *p2 = CSingleton::getInstance();\n\tCSingleton *p3 = CSingleton::getInstance();\n\treturn 0;\n}\n```\n\nä¸Šé¢çš„å•ä¾‹æ¨¡å¼åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨æ—¶ï¼Œä¼šä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Œçº¿ç¨‹Aç¬¬ä¸€æ¬¡è°ƒç”¨getInstanceå‡½æ•°çš„æ—¶å€™ï¼Œsingleå¯¹è±¡ç¬¬ä¸€æ¬¡åˆå§‹åŒ–ï¼Œæ­¤æ—¶çº¿ç¨‹Bä¹Ÿè°ƒç”¨getInstanceå‡½æ•°ï¼Œä¼šä¸ä¼šä¹Ÿè¿›è¡Œsingleå¯¹è±¡çš„åˆå§‹åŒ–å‘¢ï¼Œå› ä¸ºæ­¤æ—¶çº¿ç¨‹Aå¹¶æ²¡æœ‰åˆå§‹åŒ–å®Œsingleï¼Ÿ\n\nåœ¨Linuxç¯å¢ƒä¸­ï¼Œé€šè¿‡g++ç¼–è¯‘ä¸Šé¢çš„ä»£ç ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š\n`g++ -o main main.cpp -g`\nç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶mainï¼Œç”¨gdbè¿›è¡Œè°ƒè¯•ï¼Œåˆ°getInstanceå‡½æ•°ï¼Œå¹¶æ‰“å°è¯¥å‡½æ•°çš„æ±‡ç¼–æŒ‡ä»¤ï¼Œå¦‚ä¸‹ï¼š\n\n![image-20220410090711941](../../images/å•ä¾‹æ¨¡å¼/image-20220410090711941.png)\n\nå¯ä»¥çœ‹åˆ°ï¼Œ**å¯¹äºstaticé™æ€å±€éƒ¨å˜é‡çš„åˆå§‹åŒ–ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å¯¹å®ƒçš„åˆå§‹åŒ–è¿›è¡ŒåŠ é”å’Œè§£é”æ§åˆ¶ï¼Œä½¿é™æ€å±€éƒ¨å˜é‡çš„åˆå§‹åŒ–æˆä¸ºçº¿ç¨‹å®‰å…¨çš„æ“ä½œï¼Œä¸ç”¨æ‹…å¿ƒå¤šä¸ªçº¿ç¨‹éƒ½ä¼šåˆå§‹åŒ–é™æ€å±€éƒ¨å˜é‡ï¼Œå› æ­¤ä¸Šé¢çš„æ‡’æ±‰å•ä¾‹æ¨¡å¼æ˜¯çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼ï¼**\n# æ€»ç»“\n\nä¸€ä¸ªçœ‹ä¼¼å°å°çš„å•ä¾‹æ¨¡å¼ï¼Œå´å¯ä»¥ä¸²è”é¢å‘å¯¹è±¡æ€æƒ³ï¼Œåˆ°è½¯ä»¶è®¾è®¡æ€æƒ³ï¼Œåˆ°è®¾è®¡æ¨¡å¼ï¼Œå†åˆ°Linuxæ“ä½œç³»ç»Ÿçš„è¿›ç¨‹å’Œçº¿ç¨‹æ¨¡å‹ï¼Œçº¿ç¨‹é—´çš„äº’æ–¥å’Œé€šä¿¡ã€‚\n\n---\nå‚è€ƒæ–‡çŒ®ï¼š[C++è®¾è®¡æ¨¡å¼ - å•ä¾‹æ¨¡å¼_å•ä¾‹æ¨¡å¼å¤§ç§¦å‘ç‹-CSDNåšå®¢](https://blog.csdn.net/QIANGWEIYUAN/article/details/88544524?spm=1001.2014.3001.5502)","categories":["è®¾è®¡æ¨¡å¼","åˆ›å»ºå‹æ¨¡å¼"]},{"title":"cmake","url":"/é¡¹ç›®/cmake/","content":"# æ¦‚è¿°\n\næ˜¯ä¸ªç¼–è¯‘æ„å»ºå·¥å…·ï¼Œç›¸å½“äºå¯¹makefileä»¥åŠå…¶ä¹‹ä¸‹çš„g++/gccåŒ…è£…äº†ä¸€å±‚ã€‚makefileè¯­æ³•æ¯”è¾ƒéš¾è®°ï¼Œè€Œcmakeæ¯”è¾ƒå®¹æ˜“ï¼Œé€‚åˆç”¨æ¥ç¼–è¯‘å¤§å‹é¡¹ç›®ã€‚\n\n# ç¤ºä¾‹\n\n```cmake\n# ç¯å¢ƒå˜é‡ PROJECT_SOURCE_DIR\ncmake_minimum_required(VERSION 3.0.0)\n\nproject(distributed-system-framework)\nset(CMAKE_CXX_FLAGS ${CMAKE_CXX_FLAGS} -g)\n# å¯æ‰§è¡Œæ–‡ä»¶çš„è¾“å‡ºè·¯å¾„ï¼ŒPROJECT_SOURCE_DIRä¸ºé¡¹ç›®çš„æ ¹ç›®å½•\nset(EXECUTABLE_OUTPUT_PATH ${PROJECT_SOURCE_DIR}/bin)\n\ninclude_directories(${PROJECT_SOURCE_DIR}/include)\ninclude_directories(${PROJECT_SOURCE_DIR}/include/utils)\ninclude_directories(${PROJECT_SOURCE_DIR}/include/logger)\n# æŒ‡æ˜CMakelistsçš„å­ç›®å½•ä½ç½®\nadd_subdirectory(src)\n```\n\n# å°è¯•\n\né¦–å…ˆæ–‡ä»¶åæ˜¯CMakeLists.txtï¼Œä¸¥æ ¼å¤§å°å†™ã€‚\n\nå†™ä¸€ä¸ªhello worldï¼Œç”¨cmakeç¼–è¯‘ã€‚\n\n```cmake\n# ~/vscode/0411_test/CMakeLists.txt\ncmake_minimum_required(VERSION 3.0.0)\nproject(helloworld)\n# æŒ‡æ˜é¡¹ç›®ä¸‹é¢çš„æºæ–‡ä»¶éƒ½æœ‰å“ªäº›ï¼Œ\".\"æŒ‡å½“å‰ç›®å½•ï¼ŒSRCæ˜¯è‡ªå®šä¹‰çš„å˜é‡å\naux_source_directory(. SRC)\n# æŒ‡å®šäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶çš„è¾“å‡ºè·¯å¾„\nset(EXECUTABLE_OUTPUT_PATH ${PROJECT_SOURCE_DIR}/bin)\n\n# é™„åŠ ç¼–è¯‘æ—¶çš„å‚æ•°\nadd_definitions(\"-g\")\n# ç”¨${SRC}ç›®å½•ä¸‹çš„å…¨éƒ¨æºæ–‡ä»¶ç”Ÿæˆ\"helloworld\"å¯æ‰§è¡Œæ–‡ä»¶\nadd_executable(helloworld ${SRC})\n```\n\n```cpp\n// ~/vscode/0411_test/main.c\n#include<stdio.h>\nint main()\n{\n    printf(\"\\033[35mhello\\n\");\n    printf(\"\\033[36mhello\\n\");\n    printf(\"\\033[37mhello\\n\");\n    return 0;\n}\n```\n\n```bash\n# å½“å‰ç›®å½•å¤„äº~/vscode/0411_test\nmkdir build\ncd build\ncmake .. # cmakeå¯»æ‰¾ä¸Šçº§ç›®å½•ä¸­CMakeListsï¼ŒæŠŠæ„å»ºæ–‡ä»¶è¾“å‡ºåˆ°å½“å‰ç›®å½•ï¼ˆbuildç›®å½•ï¼‰\nmake # cmakeæ„å»ºåˆ°buildç›®å½•ä¸‹ä¸€ä¸ªMakefileæ–‡ä»¶ï¼Œåœ¨æ­¤ç›®å½•ä¸‹makeå³å¯ç¼–è¯‘é¡¹ç›®\n# å› ä¸ºCMakeLists.txtæŒ‡æ˜æŠŠå¯æ‰§è¡Œæ–‡ä»¶ç”Ÿæˆåˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„binç›®å½•ï¼Œæ‰€ä»¥makeä¹Ÿåˆ°bin\ncd ../bin\n./helloworld\n```\n\n# é‡å†™muduoé¡¹ç›®ä¸‹çš„cmake\n\n```cmake\ncmake_minimum_required(VERSION 2.5)\nproject(mymuduo)\n\n#mymuduo æœ€ç»ˆç¼–è¯‘æˆsoåŠ¨æ€åº“ï¼Œè®¾ç½®åŠ¨æ€åº“çš„è·¯å¾„\nset(LIBRARY_OUTPUT_PATH ${PROJECT_SOURCE_DIR}/lib)#æ³¨æ„ä¸æ˜¯OUTPUT_DIRECTORY.è¿™ä¸¤è€…æœ‰åŒºåˆ«\n#è®¾ç½®ä¸ºè°ƒè¯•æ¨¡å¼ ä»¥åŠ å£°æ˜C++11è¯­è¨€æ ‡å‡†\nset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -g -std=c++11 -fPIC\")#åœ¨è¾ƒæ–°çš„ç¼–è¯‘å™¨åéœ€è¦åŠ -fPICï¼Œä»¥ç¤ºç”Ÿæˆçš„æ˜¯åŠ¨æ€åº“\n#å®šä¹‰å‚ä¸ç¼–è¯‘çš„æºæ–‡ä»¶ èµ·ä¸€ä¸ªåˆ«å\naux_source_directory(. SRC_LIST)\n#ç¼–è¯‘ç”ŸæˆåŠ¨æ€åº“mymuduo\nadd_library(mymuduo SHARED ${SRC_LIST})\n```\n\n","categories":["é¡¹ç›®","Linux"]},{"title":"git","url":"/é¡¹ç›®/git/","content":"\n# å†…å®¹\n\n1. æ–°å»ºä»“åº“\n1. git init\n1. git remote add\n\n# å¦‚ä½•è®©æœ¬åœ°æŒ‡å‘è¿œç¨‹ä»“åº“\n\n1. åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œä½¿ç”¨git initå‘½ä»¤å°†å…¶å˜ä¸ºä¸€ä¸ªå¯ä»¥é€šè¿‡gitç®¡ç†çš„ä»“åº“\n\n   ```bash\n   1.mkdirä¸€ä¸ªç›®å½•\n   2.cd åˆ›å»ºçš„ç›®å½•\n   3.git init .\n   ```\n\n2. git remoteæ˜¯ç®¡ç†è¿œç¨‹ä»“åº“çš„å‘½ä»¤ï¼Œgit remote add \\[name\\] \\[url\\]å¯ä»¥ç»™å½“å‰ç›®å½•ä¸‹çš„gitæ·»åŠ ä¸€ä¸ªè¿œç¨‹ä»“åº“ã€‚è¿™é‡Œçš„urlæˆ‘å¡«çš„æ˜¯giteeä»“åº“çš„sshåœ°å€ã€‚\n\n   ```bash\n   git remote add mygitee git@gitee.com:mrcan/distributed-system-framework.git\n   # git remote -v å¯ä»¥æŸ¥çœ‹è¿œç¨‹ä»“åº“çš„ä¿¡æ¯\n   ```\n\n# æœ¬åœ°ã€è¿œç¨‹è¿›è¡ŒåŒæ­¥\n\n1. ç”Ÿæˆå¯†é’¥\n\n   ```bash\n   ssh-keygen -t rsa -C \"é‚®ç®±\"\n   ```\n\n2. åˆ‡æ¢åˆ°å®¶ç›®å½•ä¸‹çš„\".ssh\"æ–‡ä»¶å¤¹ï¼Œå‘ç°æœ‰id\\_rsaå’Œid\\_rsa.pubï¼Œåè€…æ˜¯å…¬é’¥ï¼Œå…¬é’¥ç»™åˆ«äººï¼Œè¿æ¥æ—¶æ ¹æ®å…¶ä»–ç”¨æˆ·è¾“å…¥çš„å…¬é’¥ç»è¿‡åŠ å¯†ç®—æ³•ä¸æœåŠ¡å™¨ä¸Šçš„ç§é’¥æ¯”å¯¹ã€‚\n\n3. cat id\\_rsa.pubï¼ŒæŠŠå…¬é’¥å†…å®¹æ‹·è´ä¸‹æ¥ï¼Œåœ¨giteeä¸Šçš„é¡¹ç›®ç®¡ç†ä¸­æ‰¾åˆ°éƒ¨ç½²å…¬é’¥ç®¡ç†ã€‚\n\n4. é…ç½®gitå…¨å±€ç”¨æˆ·åã€é‚®ç®±\n\n   ```bash\n   git config --global user.name 'xcg'\n   git config --global user.email '1933966629@qq.com'\n   ```\n\n   \n\n5. ä½¿ç”¨git branch -ræŸ¥çœ‹è¿œç¨‹çš„åˆ†æ”¯æœ‰å“ªäº›ï¼Œæˆ–è€…-aæŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯ï¼ˆåŒ…æ‹¬æœ¬åœ°åˆ†æ”¯ï¼‰\n","categories":["é¡¹ç›®","Linux","git"]},{"title":"SGI-STLå’ŒNginxå†…å­˜æ± å‰–æ","url":"/é¡¹ç›®/SGI-STLå’ŒNginxå†…å­˜æ± å‰–æ/","content":"# å†…å®¹\n\nå†…å­˜æ± æ˜¯ä¸ºäº†æ›´é«˜æ•ˆåœ°ç®¡ç†å°å—å†…å­˜çš„é¢‘ç¹å¼€è¾Ÿã€é‡Šæ”¾ã€‚\n1. `C++` STLï¼šæ ‡å‡†æ¨¡æ¿åº“ã€‚\n2. SGI STLï¼šç¬¬ä¸‰æ–¹å‚å•†å¼€å‘çš„ï¼Œåæ¥è¢«çº³å…¥`C++`æ ‡å‡†ï¼Œæˆä¸ºäº†`C++` STLä¸­ç®¡ç†å†…å­˜çš„åº•å±‚å®ç°ã€‚\n3. Nginxå†…å­˜æ± è®¾è®¡\n# `C++ STL`ç©ºé—´é…ç½®å™¨\n\nå…ˆç”¨vectorä¸¾ä¸ªä¾‹å­\n\n```cpp\ntemplate<typename T, typename _Alloc = allocator<T>>\nclass vector\n{\n    \n};\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œvectorç¬¬äºŒä¸ªæ¨¡æ¿å‚æ•°æ˜¯ä¸€ä¸ªç©ºé—´é…ç½®å™¨ã€‚\n\nä¸»è¦åŒ…å«äº†å››ä¸ªæ–¹æ³•ï¼š\n1. `allocate`ï¼šè´Ÿè´£ç»™å®¹å™¨å¼€è¾Ÿå†…å­˜ç©ºé—´=>`malloc`\n2. `deallocate`ï¼šè´Ÿè´£é‡Šæ”¾å®¹å™¨å†…å­˜ç©ºé—´=>`free`\n3. `construct`ï¼šè´Ÿè´£åœ¨å®¹å™¨ä¸­æ„é€ å¯¹è±¡=>`å®šä½new`ï¼šæ˜¯åŸºäºå·²ç»å¼€è¾Ÿå¥½äº†çš„å®¹å™¨ç©ºé—´ä¸­ç›´æ¥æ„é€ çš„ã€‚\n4. `destroy`ï¼šè´Ÿè´£ææ„å®¹å™¨ä¸­çš„å¯¹è±¡=>`p->~T()`\n\nç©ºé—´é…ç½®å™¨çš„æ ¸å¿ƒä½œç”¨ï¼š\n1. æ‹†å¼€äº†newçš„ä¸¤ä¸ªæ“ä½œâ€”â€”å¯¹è±¡çš„å†…å­˜å¼€è¾Ÿã€å¯¹è±¡æ„é€ ï¼›\n2. æ‹†å¼€äº†deleteçš„ä¸¤ä¸ªæ“ä½œâ€”â€”å¯¹è±¡çš„ææ„ï¼Œå†…å­˜çš„å†…å­˜é‡Šæ”¾ã€‚\næŠŠç©ºé—´å’Œå¯¹è±¡æœ¬èº«åˆ†å¼€ï¼Œåœ¨å®¹å™¨è¿™ä¸ªåœºæ™¯ä¸‹æ›´ä¸ºé€‚åˆã€‚\n# SGI STL çš„ä¸¤çº§ allocator\n\næä¾›äº†ä¸¤ä¸ªallocatorçš„å®ç°ï¼š\n1. ä¸€çº§allocatorï¼Œå®é™…ä¸Šå°±æ˜¯`malloc/free`ï¼›\n2. äºŒçº§allocatorï¼Œæ˜¯åŸºäºå†…å­˜æ± çš„å†…å­˜ç®¡ç†ã€‚\næœ¬æ–‡ä¸»è¦å‰–æSGIçš„äºŒçº§allocatorï¼Œå³å†…å­˜æ± çš„å®ç°ã€‚\n\né€šè¿‡é˜…è¯»æºç ï¼Œå‘ç°ï¼š\n\nSGI STLåº•å±‚å¯¹äºå®¹å™¨çš„å¯¹è±¡çš„æ„é€ ã€ææ„æ˜¯é€šè¿‡è‡ªå®šä¹‰çš„å…¨å±€æ¨¡æ¿å‡½æ•°Constructå’ŒDestroyå®Œæˆçš„ã€‚\nè€Œç‚¹è¿›å»å‘ç°æœ¬è´¨ä¸Šä»æ˜¯é€šè¿‡**å®šä½new**ã€**è°ƒç”¨å¯¹è±¡çš„ææ„**å‡½æ•°å®Œæˆçš„ã€‚è¿™äº›éƒ½æ˜¯å†…å­˜ç”³è¯·ã€é‡Šæ”¾å·¥ä½œä¹‹å¤–çš„åŠ¨ä½œã€‚\n\nå› æ­¤ï¼Œå¯ä»¥æ¨æ–­ï¼ŒSGI STLçš„ç©ºé—´é…ç½®å™¨**ä¸»è¦å·¥ä½œçš„åŒºåˆ«åœ¨äº allocate å’Œ deallocate**ï¼Œå³**å¯¹å®¹å™¨å†…å­˜ç”³è¯·ã€é‡Šæ”¾çš„ç®¡ç†**ã€‚\n# SGI STL å†…å­˜æ± çš„å®ç°\nå†…å­˜æ± çš„ç²’åº¦ä¿¡æ¯\n```cpp\nenum { _ALIGN = 8 };\nenum { _MAX_BYTES = 128 };\nenum { _NFREELISTS = 16 };\n```\næ¯ä¸€ä¸ªå†…å­˜chunkå—çš„å¤´ä¿¡æ¯\n```cpp\nunion _Obj\n{\n    union _Obj* _M_free_list_link;\n    char _M_client_data[1];\n};\n```\nç»„ç»‡æ‰€æœ‰è‡ªç”±é“¾è¡¨çš„æŒ‡é’ˆæ•°ç»„ã€‚\nè¿™æ˜¯é™æ€å˜é‡ï¼Œå¤šçº¿ç¨‹å…±äº«ï¼Œvolatileé¿å…äº†è¯»å–ç¼“å­˜çš„è„æ•°æ®ã€‚\n```cpp\nstatic _Obj* __STL_VOLATILE _S_free_list[_NFREELISTS];\n```\nå›¾ç¤ºï¼š\n![](../../images/SGI%20STLå’ŒNginxå†…å­˜æ± å‰–æ/image-20250807041312313.png)\nä¸€ä¸ªæ•°ç»„ï¼Œç¬¬ 1 ä¸ªä½ç½®å­˜æ”¾çš„æ˜¯ 8 å­—èŠ‚çš„å†…å­˜æ± ï¼Œç¬¬ 2 ä¸ªä½ç½®å­˜æ”¾çš„æ˜¯ 16 å­—èŠ‚çš„å†…å­˜æ± ï¼Œ...ï¼Œæœ€åä¸€ä¸ªä½ç½®å­˜æ”¾çš„æ˜¯ 128 å­—èŠ‚çš„å†…å­˜æ± ã€‚æ•°ç»„çš„å¤§å°å’Œæ¯ä¸ªä½ç½®å¯¹åº”çš„å­—èŠ‚æ•°ç”±**å†…å­˜æ± çš„ç²’åº¦ä¿¡æ¯**å†³å®šã€‚\n![](../../images/SGI%20STLå’ŒNginxå†…å­˜æ± å‰–æ/image-20250807041752139.png)\n## `allocate(size_t)`\nå®šä¹‰åœ¨`stl_alloc.h`ä¸­\n\nç»Ÿä¸€çš„allocateæ¥å£ã€‚å¤–éƒ¨ç”³è¯· n ä¸ªå­—èŠ‚ã€‚å¦‚æœæ˜¯å¤§å—å†…å­˜ï¼Œåˆ™æ™®é€šmallocã€‚\nå¦‚æœæ˜¯128å­—èŠ‚åŠä»¥ä¸‹çš„å†…å­˜ï¼Œåˆ™ä¼šä»å†…å­˜æ± ä¸­åˆ†é…ï¼Œè¿™å°±æ˜¯äºŒçº§ç©ºé—´é…ç½®ã€‚\n\n```cpp\n  static void* allocate(size_t __n)\n  {\n    void* __ret = 0;\n\n    if (__n > (size_t) _MAX_BYTES)\n    {\n      __ret = malloc_alloc::allocate(__n);\n    }\n    else  // æ ¸å¿ƒä»£ç \n    {\n        // è¿”å› freelist çš„æŸä¸‹æ ‡çš„æŒ‡é’ˆï¼ˆäºŒçº§æŒ‡é’ˆï¼‰\n      _Obj* __STL_VOLATILE* __my_free_list\n          = _S_free_list + _S_freelist_index(__n);\n      // Acquire the lock here with a constructor call.\n      // This ensures that it is released in exit or during stack\n      // unwinding.\n      \n#     ifndef _NOTHREADS\n      /*REFERENCED*/\n      _Lock __lock_instance;\n#     endif\n        // å»çœ‹ freelist è¿™ä¸ªä¸‹æ ‡ï¼Œæœ‰æ²¡æœ‰å·²å¼€è¾Ÿä¸”ç”±ç©ºé—²çš„å—\n      _Obj* __RESTRICT __result = *__my_free_list;\n      if (__result == nullptr)  // æ²¡æœ‰ç©ºé—²å—ï¼Œæˆ–è€…æ²¡å¼€è¾Ÿã€‚\n      {\n        __ret = _S_refill(_S_round_up(__n));\n      }\n      else                      // æœ‰ç©ºé—²å—ã€‚\n      {\n          // è®© è¿™ä¸ªä¸‹æ ‡ æŒ‡å‘ä¸‹ä¸€å—ç©ºé—²å—ã€‚ï¼ˆè§_Objè”åˆä½“å®šä¹‰ï¼‰\n        *__my_free_list = __result -> _M_free_list_link;\n          // è¿”å›çš„æ˜¯ __result è¿™ä¸ªç©ºé—²å—\n        __ret = __result;\n      }\n    }\n    return __ret;\n  };\n```\n###  `_S_freelist_index(size_t)`\nç”¨äºè¿”å›freelistçš„ä¸‹æ ‡ï¼Œ0ä¸‹æ ‡å­˜æ”¾çš„æ˜¯8å­—èŠ‚çš„å†…å­˜æ± å—ã€‚1ä¸‹æ ‡å­˜æ”¾çš„æ˜¯16å­—èŠ‚çš„å†…å­˜æ± å—ã€‚ä»¥æ­¤ç±»æ¨ã€‚\næ¯”å¦‚ï¼Œ\nå¤–éƒ¨ç”³è¯· 1 å­—èŠ‚ï¼Œåˆ™ $(1 + 8 - 1) / 8 - 1 = 1 - 1 = 0$\nå¤–éƒ¨ç”³è¯· 7 å­—èŠ‚ï¼Œåˆ™ $(7 + 8 - 1) / 8 - 1 = 1 - 1 = 0$\nå¤–éƒ¨ç”³è¯· 8 å­—èŠ‚ï¼Œåˆ™ $(8 + 8 - 1) / 8 - 1 = 1 - 1 = 0$\nå¤–éƒ¨ç”³è¯· 9 å­—èŠ‚ï¼Œåˆ™ $(9 + 8 - 1) / 8 - 1 = 2 - 1 = 1$\n```cpp\nstatic  size_t _S_freelist_index(size_t __bytes)\n{\n    return (__bytes + (size_t)_ALIGN - 1 ) / (size_t)_ALIGN      - 1;\n}\n```\n### `_S_round_up(size_t)`\nå¤–éƒ¨ç”³è¯· n å­—èŠ‚ï¼Œè¿”å›çš„æ˜¯ n å­—èŠ‚å¯¹åº”çš„åœ¨å†…å­˜æ± å—ä¸­ï¼Œä¸€å°å—çš„å®é™…å¤§å°ï¼ˆ8çš„æ•´æ•°å€ï¼‰ã€‚\nç±»ä¼¼äºå‘ä¸Šå–æ•´ï¼ˆå–8çš„æ•´å€æ•°çš„æœ€å°å€¼ï¼‰ï¼Œæ¯”å¦‚è¾“å…¥1åˆ°8ï¼Œè¾“å‡º8ã€‚è¾“å…¥9åˆ°16ï¼Œè¾“å‡º16ã€‚ï¼ˆè¾“å…¥0ï¼Œè¾“å‡º0ï¼‰\næ¯”å¦‚ï¼Œ\nå¤–éƒ¨ç”³è¯· 1 å­—èŠ‚ï¼Œåˆ™ $(1 + 8 - 1) \\& \\sim(8 - 1) = 8 \\& \\sim(7) = 1000 \\& \\sim(0111) = 1000 \\& 1000 = 8$\nå¤–éƒ¨ç”³è¯· 7 å­—èŠ‚ï¼Œåˆ™ $(7 + 8 - 1) \\& \\sim(15 - 1) = 15 \\& \\sim(7) = 1110 \\& \\sim(0111) = 1110 \\& 1000 = 8$\nå¤–éƒ¨ç”³è¯· 8 å­—èŠ‚ï¼Œåˆ™ $(8 + 8 - 1) \\& \\sim(16 - 1) = 15 \\& \\sim(7) = 1111 \\& \\sim(0111) = 1111 \\& 1000 = 8$\nå¤–éƒ¨ç”³è¯· 9 å­—èŠ‚ï¼Œåˆ™ $(9 + 8 - 1) \\& \\sim(17 - 1) = 16 \\& \\sim(7) = 10000 \\& \\sim(00111) = 10000 \\& 11000 = 16$\n```cpp\nstatic size_t\n_S_round_up(size_t __bytes) \n{\n    return (__bytes + (size_t)_ALIGN - 1) & ~((size_t)_ALIGN - 1);\n}\n```\n## `_S_refill(size_t)`\nè°ƒç”¨`_S_chunk_alloc(__n, __nobjs)`ï¼Œåœ¨å†…å­˜æ± å—ä¸­å°½é‡æ‰¾ä¸€ä¸ªåˆé€‚çš„å°å­—èŠ‚å—ã€‚\n`_S_chunk_alloc`å†…éƒ¨ä¼šå¸®ä½ å¤„ç†åº•å±‚çš„å¼€è¾Ÿå†…å­˜æ± ï¼Œå¤„ç†å†…å­˜ç¢ç‰‡ï¼Œç®¡ç†å†…å­˜æ± çš„æŒ‡ç¤ºä¿¡æ¯ç­‰ç­‰ã€‚\nç”±äº`_S_chunk_alloc`ç¬¬äºŒä¸ªå‚æ•°`__nobjs`ä¼ å…¥çš„æ˜¯å¼•ç”¨ï¼Œæœ‰å¯èƒ½`__nobjs`ä¼šè¢«æ”¹å˜ã€‚\nè°ƒç”¨ä¹‹å‰ï¼Œ`__nobjs`æ˜¯æˆ‘ä»¬æƒ³è¦ç”³è¯·çš„å°å­—èŠ‚å—çš„ä¸ªæ•°ã€‚\nè°ƒç”¨ç»“æŸåï¼Œ`__nobjs`æ›´æ–°ä¸ºäº†å®é™…åˆ†é…åˆ°çš„å°å­—èŠ‚å—çš„ä¸ªæ•°ã€‚\nå¦‚æœæ˜¯ 1 ï¼Œæ­¤æ¬¡åˆ†é…å®Œä¹‹åï¼Œè¿™ä¸ªå†…å­˜æ± å—æ­£å¥½ç”¨å®Œäº†ï¼Œä¸æ„å»ºfreelistä¸‹æ ‡çš„é“¾è¡¨ã€‚\nå…¶ä»–æƒ…å†µï¼Œæ„å»ºç›¸åº”çš„freelistä¸‹æ ‡çš„é“¾è¡¨ã€‚\nforå¾ªç¯ä¸­åšçš„æ˜¯éå†å†…å­˜æ± å¤§å—ä¸­çš„æ¯ä¸ªå•å…ƒå°å—ï¼Œè”åˆä½“`_Obj*`çš„`_M_free_list_link`æŒ‡å‘ç´§æŒ¨ç€çš„ä¸‹ä¸€ä¸ªå•å…ƒå°å—ã€‚\n```cpp\n/* Returns an object of size __n, and optionally adds to size __n free list.*/\n/* We assume that __n is properly aligned.                                */\n/* We hold the allocation lock.                                         */\ntemplate <bool __threads, int __inst>\nvoid*\n__default_alloc_template<__threads, __inst>::_S_refill(size_t __n)\n{\n    int __nobjs = 20;\n    char* __chunk = _S_chunk_alloc(__n, __nobjs);\n    \n    _Obj* __STL_VOLATILE* __my_free_list;\n    _Obj* __result;\n    _Obj* __current_obj;\n    _Obj* __next_obj;\n    int __i;\n\n    if (1 == __nobjs) return(__chunk);\n    \n    __my_free_list = _S_free_list + _S_freelist_index(__n);\n\n    /* Build free list in chunk */\n    __result = (_Obj*)__chunk;\n    *__my_free_list = __next_obj = (_Obj*)(__chunk + __n);\n    for (__i = 1; ; __i++)\n    {\n        __current_obj = __next_obj;\n        __next_obj = (_Obj*)((char*)__next_obj + __n);\n        if (__nobjs - 1 == __i)\n        {\n            __current_obj -> _M_free_list_link = 0;\n            break;\n        }\n        else\n        {\n            __current_obj -> _M_free_list_link = __next_obj;\n        }\n    }\n    return(__result);\n}\n```\nå›¾ç¤ºï¼š\n![](../../images/SGI%20STLå’ŒNginxå†…å­˜æ± å‰–æ/image-20250807041752139.png)\n## `_S_chunk_alloc(size_t, int& nobjs)`\nåœ¨å†…å­˜æ± å—ä¸­å°½é‡æ‰¾ä¸€ä¸ªåˆé€‚çš„å°å­—èŠ‚å—ã€‚\næœŸé—´ï¼Œå¯èƒ½ä¼šæ”¹å˜å¤–éƒ¨ä¼ å…¥çš„`__nobjs`ã€‚ï¼ˆå› ä¸ºæ˜¯å¼•ç”¨ï¼Œå¤–éƒ¨ä¼šå—å½±å“ï¼‰\n\n`__total_bytes`è®°å½•çš„æ˜¯æ¬²å¼€è¾Ÿçš„å†…å­˜æ± å¤§å°ï¼ˆæ ¹æ®`__nobjs`ï¼Œè¿™ä¸ªæ˜¯å°å­—èŠ‚å—æ•°ï¼‰ã€‚\n`__bytes_left`æŒ‡çš„æ˜¯`_S_end_free - _S_start_free`ï¼ŒæŒ‡ç›®å‰æœªè¢«å¼€å‘çš„å¤§å°ã€‚\n### `__bytes_left`è¿˜è¶³å¤Ÿï¼Œè¿”å›ï¼Œæ— éœ€å¼€è¾Ÿæ–°ç©ºé—´\nå¦‚æœ`__bytes_left`è¿˜è¶³å¤Ÿï¼ˆè‡³å°‘æ˜¯ 1 ä¸ªå°å­—èŠ‚å—ï¼‰ï¼Œåˆ™è¿”å›`_S_start_free`ã€‚åŒæ—¶ç§»åŠ¨`_S_start_free`åˆ°æ–°çš„ä½ç½®ã€‚\næˆåŠŸè¿”å›ã€‚æ— éœ€é¢å¤–æ“ä½œã€‚\n\n---\n### `__bytes_left`ä¸è¶³ï¼Œå¼€è¾Ÿæ–°çš„æ›´å¤§çš„å†…å­˜æ± å—\nå¦‚æœ`__bytes_left`ä¸è¶³ï¼Œåˆ™å°†è¦å¼€è¾Ÿæ–°çš„æ›´å¤§çš„å†…å­˜æ± å—ã€‚`__bytes_to_get = 2 * __total_bytes + _S_round_up(_S_heap_size >> 4)`\n#### `__bytes_left > 0`ï¼Œå¤´æ’åˆ°åˆé€‚çš„ä¸€ä¸ªé“¾è¡¨ï¼Œç®¡ç†è¿™ä¸ªå†…å­˜ç¢ç‰‡\nå¦‚æœ`__bytes_left > 0`ã€‚è¿™æ—¶ï¼Œä¸ºäº†ä¸æµªè´¹`__bytes_left`è€Œé€ æˆå†…å­˜ç¢ç‰‡ï¼ŒæŠŠè¿™éƒ¨åˆ†å°šä½™çš„å°å†…å­˜ç»™å…¶å¯¹åº”çš„freelistä¸‹æ ‡çš„é“¾å¤´æ’ã€‚æ¯”å¦‚ï¼Œå‰©ä½™ 32 å­—èŠ‚ï¼Œåˆ™æ‰¾ä¸‹æ ‡ 3 ï¼Œ**å¤´æ’**è¿›å»ã€‚ï¼ˆè§ä¸‹æ–‡å›¾ç¤ºï¼‰\n#### å¼€è¾Ÿæ–°çš„å¤§å—å†…å­˜_mallocæ­£å¸¸\nä»¥ä¸‹æ˜¯`__bytes_left`ä¸è¶³æ—¶ï¼Œéƒ½éœ€è¦åšçš„æ“ä½œï¼Œç›®çš„æ˜¯å¼€è¾Ÿæ–°çš„å¤§å—å†…å­˜ã€‚è¿”å›çš„åœ°å€èµ‹ç»™`_S_start_free`ã€‚\n\n---\nå¦‚æœmallocæ­£å¸¸ï¼ˆ`mallocè¿”å› != 0`ï¼‰ï¼Œæ›´æ–°`_S_heap_size += __bytes_to_get;`ï¼Œæ›´æ–°`_S_end_free = _S_start_free + __bytes_to_get;`ã€‚\n\nmallocæˆåŠŸï¼Œé€’å½’è°ƒç”¨`return(_S_chunk_alloc(__size, __nobjs));`ã€‚\n#### å¼€è¾Ÿæ–°çš„å¤§å—å†…å­˜_mallocå¤±è´¥ï¼šæ‰¾å†…å­˜æ± ä¸­å·²å¼€è¾Ÿçš„å¤§å•å…ƒé“¾è¡¨çš„ç©ºé—´\n---\nå¦‚æœmallocå¤±è´¥ï¼ˆ`mallocè¿”å› == 0`ï¼‰ã€‚åˆ™å¤„ç†ï¼š\néå†freelistçš„ä¸‹æ ‡å„ä¸ªå†…å­˜æ± å—ã€‚ä»`size_t __n`å¯¹åº”çš„freelistä¸‹æ ‡ï¼Œä¾æ¬¡å¾€åæ‰¾æœ‰æ²¡æœ‰è¿˜æœ‰ç©ºé—²çš„ã€‚\n\n`__i`åˆå§‹åŒ–ä¸º`__n`ï¼Œå¾ªç¯ï¼Œæ¯æ¬¡`__i += (size_t) _ALIGN`ï¼ˆå³åŠ 8ï¼‰ã€‚æ¯”å¦‚ï¼Œ`__n`ç­‰äº 40 å­—èŠ‚ï¼Œæˆ‘ä»¬ä¾æ¬¡å»æ‰¾40ã€48ã€56ç­‰ç­‰çš„freelistä¸‹æ ‡çš„å†…å­˜æ± å—ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰èƒ½åˆ†é…å‡ºæ¥ç©ºé—´çš„ã€‚\n\nå¦‚æœæœ‰ï¼Œåˆ™`_S_start_free`æŒ‡å‘ç¬¬ä¸€ä¸ªç©ºé—²å—ã€‚æ›´æ–°`_S_end_free = _S_start_free + __i;`\nå¥½äº†ï¼ŒæˆåŠŸåœ¨æ›´å¤§å•å…ƒçš„å†…å­˜æ± å—æ‰¾åˆ°ï¼Œé€’å½’è°ƒç”¨`return(_S_chunk_alloc(__size, __nobjs));`ã€‚\n#### å¼€è¾Ÿæ–°çš„å¤§å—å†…å­˜_mallocå¤±è´¥ï¼šå¼‚å¸¸å¤„ç†\n---\nå¦‚æœä»¥ä¸Šçš„forå¾ªç¯æ‰¾äº†åé¢æ›´å¤§å•å…ƒçš„å†…å­˜æ± å—ï¼Œä»æ²¡æœ‰å¯ç”¨ç©ºé—´ï¼Œåˆ™æ˜¯ç³»ç»Ÿå†…å­˜ä¸è¶³çš„è¿¹è±¡ï¼š\néœ€è¦è°ƒç”¨`malloc_alloc::allocate(__bytes_to_get);`ã€‚\nå†…éƒ¨æœ€åä¸€æ¬¡è¿›è¡Œæ™®é€šmallocçš„æŒ£æ‰ã€‚\nå¦‚æœmallocä»ç„¶è¿”å› 0 ï¼Œåˆ™è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼ˆç»‘å®šçš„å›è°ƒï¼‰ã€‚\n\n---\n\n```cpp\n/* We allocate memory in large chunks in order to avoid fragmenting     */\n/* the malloc heap too much.                                            */\n/* We assume that size is properly aligned.                             */\n/* We hold the allocation lock.                                         */\ntemplate <bool __threads, int __inst>\nchar*\n__default_alloc_template<__threads, __inst>::_S_chunk_alloc(size_t __size, \n                                                            int& __nobjs)\n{\n    char* __result;\n    size_t __total_bytes = __size * __nobjs;\n    size_t __bytes_left = _S_end_free - _S_start_free;\n\n    if (__bytes_left >= __total_bytes)\n    {\n        __result = _S_start_free;\n        _S_start_free += __total_bytes;\n        return(__result);\n    }\n    else if (__bytes_left >= __size)\n    {\n        __nobjs = (int)(__bytes_left / __size);\n        __total_bytes = __size * __nobjs;\n        __result = _S_start_free;\n        _S_start_free += __total_bytes;\n        return(__result);\n    }\n    else\n    {\n        size_t __bytes_to_get = 2 * __total_bytes + _S_round_up(_S_heap_size >> 4);\n        // Try to make use of the left-over piece.\n        if (__bytes_left > 0)\n        {\n            _Obj* __STL_VOLATILE* __my_free_list =\n                        _S_free_list + _S_freelist_index(__bytes_left);\n\n            ((_Obj*)_S_start_free) -> _M_free_list_link = *__my_free_list;\n            *__my_free_list = (_Obj*)_S_start_free;\n        }\n        _S_start_free = (char*)malloc(__bytes_to_get);\n        if (0 == _S_start_free)\n        {\n            size_t __i;\n            _Obj* __STL_VOLATILE* __my_free_list;\n            _Obj* __p;\n            // Try to make do with what we have.  That can't\n            // hurt.  We do not try smaller requests, since that tends\n            // to result in disaster on multi-process machines.\n            for (__i = __size; __i <= (size_t) _MAX_BYTES; __i += (size_t) _ALIGN)\n            {\n                __my_free_list = _S_free_list + _S_freelist_index(__i);\n                __p = *__my_free_list;\n                if (0 != __p)\n                {\n                    *__my_free_list = __p -> _M_free_list_link;\n                    _S_start_free = (char*)__p;\n                    _S_end_free = _S_start_free + __i;\n                    return(_S_chunk_alloc(__size, __nobjs));\n                    // Any leftover piece will eventually make it to the\n                    // right free list.\n                }\n            }\n            _S_end_free = 0;\t// In case of exception.\n            _S_start_free = (char*)malloc_alloc::allocate(__bytes_to_get);\n            // This should either throw an\n            // exception or remedy the situation.  Thus we assume it\n            // succeeded.\n        }\n        _S_heap_size += __bytes_to_get;\n        _S_end_free = _S_start_free + __bytes_to_get;\n        return(_S_chunk_alloc(__size, __nobjs));\n    }\n}\n```\n### å¤´æ’å°å†…å­˜ç¢ç‰‡ï¼Œå›¾ç¤º\n![](../../images/SGI%20STLå’ŒNginxå†…å­˜æ± å‰–æ/image-20250807063843813.png)\n### oomå¼‚å¸¸å¤„ç†\n```cpp\ntemplate <int __inst>\nclass __malloc_alloc_template\n{\nprivate:\n#ifndef __STL_STATIC_TEMPLATE_MEMBER_BUG\n  static void (* __malloc_alloc_oom_handler)();\n#endif\npublic:\n  static void* allocate(size_t __n)\n  {\n    void* __result = malloc(__n);\n    if (0 == __result)\n    {\n        __result = _S_oom_malloc(__n);\n    }\n    return __result;\n  }\n  // ...\n};\n```\n\n```cpp\ntemplate <int __inst>\nvoid*\n__malloc_alloc_template<__inst>::_S_oom_malloc(size_t __n)\n{\n    void (* __my_malloc_handler)();\n    void* __result;\n\n    for (;;)\n    {\n        __my_malloc_handler = __malloc_alloc_oom_handler;\n        if (0 == __my_malloc_handler)\n        {\n            __THROW_BAD_ALLOC;\n        }\n        \n        (*__my_malloc_handler)();\n        \n        __result = malloc(__n);\n        \n        if (__result)\n        {\n            return(__result);\n        }\n    }\n}\n```\n### `_S_start_free`ã€`_S_end_free`ã€`_S_heap_size`\nè¿™ä¸‰ä¸ªå˜é‡ï¼Œåªä¼šåœ¨`_S_chunk_alloc(size_t, int&)`å‡½æ•°æ‰§è¡Œä¸­æ”¹å˜ã€‚\n```cpp\ntemplate <bool __threads, int __inst>\nchar* __default_alloc_template<__threads, __inst>::_S_start_free = 0;\n\ntemplate <bool __threads, int __inst>\nchar* __default_alloc_template<__threads, __inst>::_S_end_free = 0;\n\ntemplate <bool __threads, int __inst>\nsize_t __default_alloc_template<__threads, __inst>::_S_heap_size = 0;\n```\n## `deallocate(void* p, size_t)`\nå®šä¹‰äº`stl_alloc.h`\n\nå¤´æ’å½’è¿˜ï¼Œçœ‹å›¾ç¤ºã€‚\n```cpp\ntemplate <bool threads, int inst>\nclass __default_alloc_template {\n// ...\npublic:\n// ...\n\n  /* __p may not be 0 */\n    static void deallocate(void* __p, size_t __n)\n    {\n        if (__n > (size_t) _MAX_BYTES)\n        {\n            malloc_alloc::deallocate(__p, __n);\n        }\n        else\n        {\n            _Obj* __STL_VOLATILE*  __my_free_list = \n                _S_free_list + _S_freelist_index(__n);\n            _Obj* __q = (_Obj*)__p;\n            \n            // acquire lock\n#           ifndef _NOTHREADS\n            /*REFERENCED*/\n            _Lock __lock_instance;\n#           endif /* _NOTHREADS */\n    \n            __q -> _M_free_list_link = *__my_free_list;\n            *__my_free_list = __q;\n            // lock is released here\n        }\n    }\n\n//...\n};\n```\n![](../../images/SGI%20STLå’ŒNginxå†…å­˜æ± å‰–æ/image-20250807073716103.png)\n## `reallocate(void* p, old_sz, new_sz)`\nå¯¹å·²å¼€è¾Ÿçš„å†…å­˜æ± å—çš„æ‰©å®¹ã€ç¼©å®¹ã€‚\n\n```cpp\ntemplate <bool threads, int inst>\nvoid*\n__default_alloc_template<threads, inst>::reallocate(void* __p,\n                                                    size_t __old_sz,\n                                                    size_t __new_sz)\n{\n    void* __result;\n    size_t __copy_sz;\n\n    if (__old_sz > (size_t)_MAX_BYTES && __new_sz > (size_t)_MAX_BYTES)\n    {\n        return(realloc(__p, __new_sz));\n    }\n    if (_S_round_up(__old_sz) == _S_round_up(__new_sz))\n    {\n        return(__p);\n    }\n    __result = allocate(__new_sz);\n    __copy_sz = __new_sz > __old_sz ? __old_sz : __new_sz;\n    memcpy(__result, __p, __copy_sz);\n    deallocate(__p, __old_sz);\n    return(__result);\n}\n```\n## SGI STLå†…å­˜æ± æ€»ç»“\n\nSGI STL äºŒçº§ç©ºé—´é…ç½®å™¨å†…å­˜æ± çš„å®ç°ä¼˜ç‚¹ï¼š\n1. å¯¹äºæ¯ä¸€ä¸ªå­—èŠ‚æ•°çš„chunkå—åˆ†é…ï¼Œéƒ½æ˜¯ç»™å‡ºä¸€éƒ¨åˆ†è¿›è¡Œä½¿ç”¨ï¼Œå¦ä¸€éƒ¨åˆ†ä½œä¸ºå¤‡ç”¨ï¼Œè¿™ä¸ªå¤‡ç”¨å¯ä»¥ç»™å½“å‰å­—èŠ‚æ•°ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ç»™å…¶å®ƒå­—èŠ‚æ•°ä½¿ç”¨\n2. å¯¹äºå¤‡ç”¨å†…å­˜æ± åˆ’åˆ†å®Œchunkå—ä»¥åï¼Œå¦‚æœè¿˜æœ‰å‰©ä½™çš„å¾ˆå°çš„å†…å­˜å—ï¼Œå†æ¬¡åˆ†é…çš„æ—¶å€™ï¼Œä¼šæŠŠè¿™äº›å°çš„å†…å­˜å—å†æ¬¡åˆ†é…å‡ºå»ï¼Œå¤‡ç”¨å†…å­˜æ± ä½¿ç”¨çš„å¹²å¹²å‡€å‡€ï¼é˜²æ­¢å°å—å†…å­˜é¢‘ç¹çš„åˆ†é…ï¼Œé‡Šæ”¾ï¼Œé€ æˆå†…å­˜å¾ˆå¤šçš„ç¢ç‰‡å‡ºæ¥ï¼Œå†…å­˜æ²¡æœ‰æ›´å¤šçš„è¿ç»­çš„å¤§å†…å­˜å—ã€‚æ‰€ä»¥åº”ç”¨å¯¹äºå°å—å†…å­˜çš„æ“ä½œï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨å†…å­˜æ± æ¥è¿›è¡Œç®¡ç†ã€‚\n3. mallocå†…å­˜åˆ†é…å¤±è´¥ï¼Œè¿˜ä¼šè°ƒç”¨`oom_malloc`è¿™ä¹ˆä¸€ä¸ªé¢„å…ˆè®¾ç½®å¥½çš„ä»¥åçš„å›è°ƒå‡½æ•°ï¼Œå¦‚æœæ²¡è®¾ç½®ï¼Œåˆ™`throw bad_alloc`ã€‚è®¾ç½®äº†åˆ™`for(;;)(*oom_malloc_handler)();`ã€‚\n# Nginxå†…å­˜æ± è®¾è®¡å’Œå®ç°\nåŒºåˆ†å¤§å°å†…å­˜å—çš„ç”³è¯·å’Œé‡Šæ”¾ï¼Œå¤§äºæ± å°ºå¯¸çš„å®šä¹‰ä¸ºå¤§å†…å­˜å—ï¼Œä½¿ç”¨å•ç‹¬çš„å¤§å†…å­˜å—é“¾è¡¨ä¿å­˜ï¼Œå³æ—¶åˆ†é…å’Œé‡Šæ”¾ï¼›å°äºç­‰äºæ± å°ºå¯¸çš„å®šä¹‰ä¸ºå°å†…å­˜å—ï¼Œç›´æ¥ä»é¢„å…ˆåˆ†é…çš„å†…å­˜å—ä¸­æå–ï¼Œä¸å¤Ÿå°±æ‰©å……æ± ä¸­çš„å†…å­˜ï¼Œåœ¨ç”Ÿå‘½å‘¨æœŸå†…å¯¹å°å—å†…å­˜ä¸åšé‡Šæ”¾ï¼Œç›´åˆ°æœ€åç»Ÿä¸€é”€æ¯ã€‚\n## Nginxå†…å­˜æ± ç»“æ„å›¾\n![](../../images/SGI%20STLå’ŒNginxå†…å­˜æ± å‰–æ/image-20250719234700476.png)\n## Nginxæºç \næœ¬æ¬¡åˆ†æçš„æ˜¯Nginx-release-1.13.1çš„æºç ã€‚\nsrcç›®å½•ä¸‹ï¼Œæœ‰å¥½å¤šæ¨¡å—ï¼Œå…¶ä¸­å†…å­˜æ± çš„æ¨¡å—ä½äº`/src/core`ç›®å½•ä¸‹ã€‚ä½¿ç”¨çš„æ˜¯Cè¯­è¨€ã€‚\nå¯¹äºä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œæœ‰ä¸åŒçš„å®ç°ï¼Œä½äº`/src/os/unix`å’Œ`/src/os/win32`ä¸‹ã€‚\n## æŒ‡æ ‡\n```c\n// ä½äº ngx_palloc.h\n/*\n * NGX_MAX_ALLOC_FROM_POOL should be (ngx_pagesize - 1), i.e. 4095 on x86.\n * On Windows NT it decreases a number of locked pages in a kernel.\n */\n#define NGX_MAX_ALLOC_FROM_POOL  (ngx_pagesize - 1)\n\n#define NGX_DEFAULT_POOL_SIZE    (16 * 1024)\n\n#define NGX_POOL_ALIGNMENT       16\n#define NGX_MIN_POOL_SIZE                                                     \\\n    ngx_align((sizeof(ngx_pool_t) + 2 * sizeof(ngx_pool_large_t)),            \\\n              NGX_POOL_ALIGNMENT)\n```\n1. `NGX_MAX_ALLOC_FROM_POOL`å®šä¹‰äº†å¯ä»¥ä»å†…å­˜æ± ä¸­ç”³è¯·çš„æœ€å¤§å†…å­˜ã€‚é»˜è®¤æ˜¯`Nginxé¡µé¢å¤§å°å‡1`ã€‚x86ç³»ç»Ÿä¸‹æ˜¯`4096å­—èŠ‚å‡1`ã€‚\n2. `NGX_DEFAULT_POOL_SIZE`å®šä¹‰äº†Nginxå†…å­˜æ± é»˜è®¤å¤§å°ã€‚æ˜¯`16 * 1024B` å³ `16KB`ã€‚\n3. `NGX_POOL_ALIGNMENT`ï¼Œå†…å­˜æ± ï¼Œåˆ†é…å†…å­˜æ—¶çš„å¯¹é½å¤§å°ã€‚é»˜è®¤æ˜¯16ã€‚\n4. `NGX_MIN_POOL_SIZE`å®šä¹‰äº†å†…å­˜æ± çš„æœ€å°å¤§å°ã€‚\n    1. å…¶éœ€è¦é€šè¿‡`ngx_align`è®¡ç®—ï¼Œå®šä¹‰å¦‚ä¸‹ï¼šå‘ç°å’ŒSTLçš„`round_up`ä¸€æ ·ï¼Œå‘ä¸Šå– d çš„æ•´ a å€æ•°ã€‚æ¯”å¦‚ï¼Œaç­‰äº16ã€dç­‰äº7çš„è¯ï¼Œé‚£då–æ•´åå°±æ˜¯16ï¼Œdç­‰äº17çš„è¯ï¼Œå–æ•´åå°±æ˜¯32ã€‚\n    2. å…¶ä¸­dæ˜¯`(sizeof(ngx_pool_t) + 2 * sizeof(ngx_pool_large_t))`ã€‚aæ˜¯`NGX_POOL_ALIGNMENT`ï¼Œé»˜è®¤æ˜¯16ã€‚\n\n```c\n// ä½äº ngx_config.h\n#define ngx_align(d, a) Â  Â  ( ( (d) + (a - 1) ) & ~(a - 1))\n```\n## å…³é”®æ•°æ®ç»“æ„\nå®šä¹‰äº`ngx_palloc.h`\n```c\ntypdef strcut\n{\n    u_char        *last;       // å½“å‰æ•°æ®å—ä¸­å†…å­˜åˆ†é…æŒ‡é’ˆçš„å½“å‰ä½ç½®\n    u_char        *end;        // å†…å­˜å—çš„ç»“æŸä½ç½®\n    ngx_pool_t    *next;       // å†…å­˜æ± ç”±å¤šå—å†…å­˜å—ç»„æˆï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªæ•°æ®å—çš„ä½ç½®\n    ngx_uint_t    failed;      // å½“å‰æ•°æ®å—å†…å­˜ä¸è¶³å¼•èµ·åˆ†é…å¤±è´¥çš„æ¬¡æ•°\n} ngx_pool_data_t;\n\nstruct ngx_pool_s\n{\n    ngx_pool_data_t    d;        // ä¸Šé¢é‚£ä¸ªç»“æ„ä½“ï¼šå†…å­˜æ± å½“å‰çš„æ•°æ®åŒºæŒ‡é’ˆçš„ç»“æ„ä½“\n    \n    size_t             max;      // max æŒ‡çš„æ˜¯ Nginx ä¸€æ¬¡åˆ†é…å°å—å†…å­˜å¤§å° çš„æœ€å¤§å€¼ã€‚\n    ngx_pool_t         *current; // å½“å‰æ­£åœ¨ä½¿ç”¨çš„æ•°æ®å—çš„æŒ‡é’ˆ\n    ngx_chain_t        *chain;   // æŠŠå†…å­˜æ± é“¾æ¥èµ·æ¥\n    ngx_pool_large_t   *large;   // æŒ‡å‘å¤§æ•°æ®å—çš„æŒ‡é’ˆï¼ˆå¤§æ•°æ®å—æ˜¯æŒ‡size > maxçš„æ•°æ®ï¼‰\n    ngx_pool_cleanup_t *cleanup; // ç±»ä¼¼äºææ„å‡½æ•°ï¼Œåœ¨ å†…å­˜free ä¹‹å‰ï¼Œå¯¹å†…å­˜ä¸Šçš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚é‡Šæ”¾æŒ‡é’ˆå¯¹åº”çš„å¤–éƒ¨èµ„æº\n    ngx_log_t          *log;     \n}; // in ngx_core.h: typedef struct ngx_pool_s ngx_pool_t;\n```\nåœ¨`ngx_core.h`ä¸­ï¼Œ\n```c\ntypedef struct ngx_pool_s ngx_pool_t;\n```\nå³`npx_pool_t`æ˜¯`struct ngx_pool_s`çš„åˆ«åã€‚\n\nåœ¨Nginxå†…å­˜æ± ä¸­ï¼Œ`npx_pool_t`è¿™ä¸ªç»“æ„åªå‡ºç°åœ¨ç¬¬ä¸€ä¸ªå†…å­˜æ± å—çš„å¤´éƒ¨ä¸Šï¼Œåç»­é“¾æ¥çš„å†…å­˜æ± å—å¤´éƒ¨åªæœ‰`ngx_pool_data_t`ã€‚\n\n`struct ngx_pool_s`ï¼ˆåˆ«å`ngx_pool_t`ï¼‰ç»“æ„ç¤ºæ„å›¾ï¼ˆå¤§å°ä¸º1024çš„æ± ï¼‰\n![](../../images/SGI%20STLå’ŒNginxå†…å­˜æ± å‰–æ/image-20250719235439957.png)\n\n## `npx_create_pool`åˆ›å»ºå†…å­˜æ± \nå£°æ˜äº`ngx_palloc.h`ï¼Œå®šä¹‰äº`ngx_palloc.c`ã€‚\n```c\nngx_pool_t * ngx_create_pool(size_t size, ngx_log_t *log);\n```\nè¿”å›`npx_pool_t *`ã€‚\n\nå¼€è¾ŸæŒ‡å®šå¤§å°çš„å†…å­˜æ± ã€‚æ ¹æ®ä¸åŒç³»ç»Ÿã€ä¸åŒçš„å¯¹é½æ–¹æ³•ï¼Œè°ƒç”¨ä¸åŒçš„APIã€‚\nä¸€èˆ¬æ˜¯æ™®é€šçš„mallocã€‚\n```c\nngx_pool_t * ngx_create_pool(size_t size, ngx_log_t *log)\n{\n    ngx_pool_t  *p;\n    // å¦‚æœä¸ç”¨å†…å­˜å¯¹é½ï¼Œåˆ™å®é™…å°±æ˜¯æ™®é€šçš„ malloc\n    // å¦‚æœéœ€è¦å†…å­˜å¯¹é½ï¼Œåˆ™è°ƒç”¨posix_memalign(void ** p, size_t alignment, size_t size)\n    // æˆ– memalign(size_t alignment, size_t size)\n    p = ngx_memalign(NGX_POOL_ALIGNMENT, size, log);\n    if (p == NULL)\n    {\n        return NULL;\n    }\n    // æœ€åä¸€ä¸ªå†…å­˜æ± å¤§å—ï¼ŒæŒ‡å‘è¿™ä¸ªæ–°å¼€è¾Ÿçš„å†…å­˜æ± å¤§å—çš„å¤´ä¿¡æ¯ä¹‹åã€‚\n    p->d.last = (u_char *) p + sizeof(ngx_pool_t);\n    // å†…å­˜æ± çš„ç»“æŸä½ç½®ï¼Œæ•´ä¸ªå¤§å—çš„å°¾éƒ¨ã€‚\n    p->d.end = (u_char *) p + size;\n    p->d.next = NULL;\n    p->d.failed = 0;\n\n    // size æ›´æ–°ä¸º é™¤å»å¤´ä¿¡æ¯å¤§å°çš„ å®é™…å­˜å‚¨æ•°æ®çš„å¤§å°\n    size = size - sizeof(ngx_pool_t);\n    // è‹¥ size å°äº MAX_ALLOCï¼Œåˆ™ maxä¸ºsizeï¼Œsize å¤§äº MAX_ALLOC åˆ™ max ä¸º MAX_ALLOC\n    // max æŒ‡çš„æ˜¯ Nginx ä¸€æ¬¡åˆ†é…å°å—å†…å­˜å¤§å° çš„æœ€å¤§å€¼ã€‚å¦‚æœç”¨æˆ·ç”³è¯·å¤§äºmaxï¼Œåˆ™æŒ‰å¤§å—æ•°æ®å—å¤„ç†ã€‚\n    p->max = (size < NGX_MAX_ALLOC_FROM_POOL) ? size : NGX_MAX_ALLOC_FROM_POOL;\n    // æŒ‡å‘è‡ªå·±ï¼Œé¦–åœ°å€ï¼ˆåŒ…å«å¤´ä¿¡æ¯ï¼‰\n    p->current = p;\n    p->chain = NULL;\n    p->large = NULL;\n    p->cleanup = NULL;\n    p->log = log;\n\n    return p;\n}\n```\n### `ngx_memalign(POOL_ALIGNMENT, size, log)`æˆ–`ngx_alloc(size, log)`\nè¿™æ˜¯ä¸ªå®å®šä¹‰ï¼Œå®šä¹‰äº`/src/os/unix`å’Œ`/src/os/win32`ä¸‹çš„`ngx_alloc.h`ã€‚\n\nåœ¨Unixä¸‹ï¼Œæœ‰å¯¹é½çš„åŒºåˆ«ï¼šå¦‚æœè¦åšå†…å­˜å¯¹é½ï¼Œåˆ™`size_t alignment`å‚æ•°ç”Ÿæ•ˆï¼Œå¦åˆ™å¿½ç•¥å¯¹é½å‚æ•°\n```c\n#if (NGX_HAVE_POSIX_MEMALIGN || NGX_HAVE_MEMALIGN)\nvoid *ngx_memalign(size_t alignment, size_t size, ngx_log_t *log);\n#else\n#define ngx_memalign(alignment, size, log)  ngx_alloc(size, log)\n#endif\n```\nåœ¨Win32ä¸‹ï¼Œæ²¡æœ‰å¯¹é½é™åˆ¶ã€‚`#define ngx_memalign(alignment, size, log) Â ngx_alloc(size, log)`\n\nåå­—ä¸Šï¼Œæš‚æ—¶ä¸€æ ·ã€‚ä½†æ˜¯ç›¸åº”çš„`ngx_alloc(size, log)`å‡½æ•°ï¼Œåœ¨ä¸¤ä¸ªæ“ä½œç³»ç»Ÿä¸Šå°±æ˜¯ä¸åŒçš„å®ç°äº†ã€‚\næˆ‘ä»¬çœ‹Unixçš„ï¼šå®é™…å°±æ˜¯å¥—äº†ä¸ª**æ™®é€šmalloc**ã€‚ç„¶åè¾“å‡ºäº†ä¸€äº›æ—¥å¿—ä¿¡æ¯ã€‚\nå®šä¹‰äº`/src/os/unix/ngx_alloc.c`\n```c\nvoid * ngx_alloc(size_t size, ngx_log_t *log)\n{\n    void  *p;\n\n    p = malloc(size);\n    if (p == NULL)\n    {\n        ngx_log_error(NGX_LOG_EMERG, log, ngx_errno,\n                      \"malloc(%uz) failed\", size);\n    }\n\n    ngx_log_debug2(NGX_LOG_DEBUG_ALLOC, log, 0, \"malloc: %p:%uz\", p, size);\n\n    return p;\n}\n```\n## ä»åˆ›å»ºå¥½çš„å†…å­˜æ± ä¸­ç”³è¯·å†…å­˜\nå®šä¹‰äº`ngx_palloc.c`\n3ä¸ªæ¥å£ï¼š`ngx_palloc`ã€`ngx_pnalloc`ã€`ngx_pcalloc`\n1. `ngx_palloc`å’Œ`ngx_pnalloc`çš„åŒºåˆ«åœ¨äºåœ¨ç”³è¯·**å°å—å†…å­˜**æ—¶ï¼Œ**å‰è€…è€ƒè™‘å¯¹é½**ï¼Œåè€…ä¸è€ƒè™‘å¯¹é½\n2. `ngx_pcalloc`æ˜¯è°ƒç”¨`ngx_palloc`ï¼Œä¹‹åçš„é¢å¤–æ“ä½œæ˜¯**æ¸…é›¶ç”³è¯·çš„åŒºåŸŸ**ã€‚\n### `ngx_palloc(pool, size)`\nå¦‚æœç”¨æˆ·ç”³è¯·å°äºç­‰äºpoolå¤´ä¿¡æ¯ä¸­maxå¤§å°çš„å†…å­˜ï¼Œåˆ™æŒ‰å°å—ç®¡ç†ã€‚\n```c\nvoid * ngx_palloc(ngx_pool_t *pool, size_t size)\n{\n#if !(NGX_DEBUG_PALLOC)\n    if (size <= pool->max)\n    {\n        // ç¬¬3ä¸ªå‚æ•°æ˜¯æ ‡å¿—ä½ï¼Œ1è¡¨ç¤ºè€ƒè™‘å¯¹é½ï¼Œ0è¡¨ç¤ºä¸è€ƒè™‘å¯¹é½ã€‚\n        return ngx_palloc_small(pool, size, 1);\n    }\n#endif\n    return ngx_palloc_large(pool, size);\n}\n```\n\n```c\nvoid * ngx_pnalloc(ngx_pool_t *pool, size_t size)\n{\n#if !(NGX_DEBUG_PALLOC)\n    if (size <= pool->max)\n    {\n        // ç¬¬3ä¸ªå‚æ•°æ˜¯æ ‡å¿—ä½ï¼Œ1è¡¨ç¤ºè€ƒè™‘å¯¹é½ï¼Œ0è¡¨ç¤ºä¸è€ƒè™‘å¯¹é½ã€‚\n        return ngx_palloc_small(pool, size, 0);\n    }\n#endif\n    return ngx_palloc_large(pool, size);\n}\n```\n\n```c\nvoid * ngx_pcalloc(ngx_pool_t *pool, size_t size)\n{\n    void *p;\n    p = ngx_palloc(pool, size);\n    if (p)\n    {\n        ngx_memzero(p, size);    \n    }\n    return p;\n}\n```\n### `ngx_palloc_small(pool, size, align)`\nç¬¬3ä¸ªå‚æ•°æ˜¯æ ‡å¿—ä½ï¼Œ1è¡¨ç¤ºè€ƒè™‘å¯¹é½ï¼Œ0è¡¨ç¤ºä¸è€ƒè™‘å¯¹é½ã€‚\n\næ‰¾currentï¼Œå³ä»è¯¥å†…å­˜æ± å¤§å—ä¹‹ä¸­åˆ†é…å†…å­˜ã€‚\n\n`ngx_align_ptr`ï¼Œå°†`p->d.last`æŒ‡å‘çš„å¯ç”¨æ•°æ®åœ°å€æŒ‰`NGX_ALIGNMENT`å¯¹é½åˆ°æŒ‡å®šæ•°ï¼ˆé»˜è®¤æ˜¯32ï¼‰çš„å€æ•°ï¼Œæ¯”å¦‚å¦‚æœåœ°å€æ˜¯8ï¼Œåˆ™èˆå¼ƒä¸€éƒ¨åˆ†å†…å­˜ï¼Œå¯¹é½åˆ°32ã€‚\n\n```c\nstatic ngx_inline void *\nngx_palloc_small(ngx_pool_t *pool, size_t size, ngx_uint_t align)\n{\n    u_char      *m;\n    ngx_pool_t  *p;\n    // ä» pool å¤´ä¿¡æ¯æ‰¾åˆ°å½“å‰å¯ç”¨çš„å†…å­˜æ± å¤§å—\n    p = pool->current;\n\n    do {\n        // å½“å‰æ•°æ®å—ä¸­å¯åˆ†é…çš„å†…å­˜çš„å¼€å§‹ä½ç½®\n        m = p->d.last;\n\n        if (align)\n        {\n            m = ngx_align_ptr(m, NGX_ALIGNMENT);\n        }\n        // end æ˜¯å½“å‰æ•°æ®å—ä¸­å¯åˆ†é…çš„å†…å­˜çš„ç»“æŸä½ç½®ï¼Œä¸å¼€å§‹ä½ç½®ç›¸å‡ï¼Œå¦‚æœå¤§äºç­‰äºç”¨æˆ·ç”³è¯·çš„å¤§å°\n        // åˆ™ ç›´æ¥è¿”å› m ï¼Œå³å¼€å§‹ä½ç½®ï¼ŒæŠŠ last ä½ç½® ä¸‹ç§» sizeï¼Œè¡¨ç¤ºåˆ†é…äº† size å¤§å°\n        if ((size_t) (p->d.end - m) >= size)\n        {\n            p->d.last = m + size;\n\n            return m;\n        }\n        // å¦‚æœ ç›®å‰çš„æ•°æ®å— å¤§å° ä¸å¤Ÿ sizeï¼Œåˆ™éå†æ‰¾ä¸‹ä¸€ä¸ªæ•°æ®å—ã€‚\n        p = p->d.next;\n\n    } while (p);\n    // ç›´åˆ°æ‰€æœ‰æ•°æ®å—éƒ½ä¸å¤Ÿç”¨ï¼Œåˆ™\n    return ngx_palloc_block(pool, size);\n}\n```\n#### `ngx_align_ptr(p, a)`å†…å­˜å¯¹é½\nå®šä¹‰äº`ngx_config.h`\n\nå¦‚æœæ²¡æœ‰å®šä¹‰`NGX_ALIGNMENT`ï¼Œåˆ™é»˜è®¤æ˜¯`sizeof(unsigned long)`ï¼ŒæŒ‰ç…§32ä½å¯¹é½ã€‚è¿™æ˜¯å†…å­˜å•å…ƒå¯¹é½ã€‚\n>æ³¨æ„è¦å’Œ`ngx_palloc.h`ä¸­å®šä¹‰çš„`#define NGX_POOL_ALIGNMENT 16`åŒºåˆ†ã€‚é‚£æ˜¯å†…å­˜æ± å¯¹é½ã€‚\n\nå³å‘å®šä¹‰çš„å¯¹é½å¤§å°ï¼ˆ32ï¼‰å‘ä¸Šå–æ•´32å€ã€‚\n\næ“ä½œæ˜¯ï¼šä¼ å…¥çš„æŒ‡é’ˆåœ°å€ï¼ŒåŠ ä¸ŠæŒ‡é’ˆå¤§å°32ï¼ˆ4å­—èŠ‚ï¼Œ32ä½ï¼‰å‡1ï¼Œå’Œ32å‡1å–ååï¼Œç›¸ä¸ã€‚\næ¯”å¦‚ï¼šä¼ å…¥çš„æŒ‡é’ˆåœ°å€æ˜¯8ï¼š`0000 1000`ï¼ˆå‰é¢è¡¥0ï¼‰ï¼Œåˆ™åŠ 32å‡1ï¼š`0010 1000`\n`0010 0000 - 1 = 0001 1111`å–å`1110 0000`ï¼ˆå‰é¢è¡¥1ï¼‰ã€‚`0010 1000`å’Œ`1110 0000`ç›¸ä¸åï¼š`0010 0000`ï¼Œç”±åŸå…ˆçš„8ï¼Œå¯¹é½åˆ°äº†32ã€‚\n```c\n#ifndef NGX_ALIGNMENT\n#define NGX_ALIGNMENT Â  sizeof(unsigned long) Â  Â /* platform word */\n#endif\n\n#define ngx_align_ptr(p, a)                                                   \\\n    (u_char *) (((uintptr_t) (p) + ((uintptr_t) a - 1)) & ~((uintptr_t) a - 1))\n```\n\n## `ngx_palloc_block(pool, size)`å†å¼€è¾Ÿä¸€å¤§å—å†…å­˜æ± \nä»poolçš„å¤´å—æ‰¾åˆ°`end - pool`çš„å¤§å°ï¼Œè¿™æ˜¯å†…å­˜æ± æ¯ä¸€ä¸ªå¤§å—çš„å¤§å°ï¼ˆåŒ…å«å¤´ä¿¡æ¯çš„å¤§å°ï¼‰\n\nè¿™æ˜¯ä¸ºäº†**å†å¼€è¾Ÿä¸€å¤§å—å†…å­˜æ± **åšå‡†å¤‡ã€‚\n\n`ngx_memalign`å’Œç¬¬ä¸€æ¬¡åˆ›å»ºå†…å­˜æ± ä¸€æ ·ï¼Œå¦‚æœæ²¡æœ‰å¯¹é½è¦æ±‚ï¼Œåˆ™æ™®é€šmallocã€‚\n\n\n```c\nstatic void *\nngx_palloc_block(ngx_pool_t *pool, size_t size)\n{\n    u_char      *m;\n    size_t       psize;\n    ngx_pool_t  *p, *new;\n    // ä¸€æ•´ä¸ªå†…å­˜æ± å¤§å—ï¼ˆåŒ…å«å¤´ä¿¡æ¯ï¼‰çš„å¤§å°ã€‚\n    psize = (size_t) (pool->d.end - (u_char *) pool);\n\n    m = ngx_memalign(NGX_POOL_ALIGNMENT, psize, pool->log);\n    if (m == NULL)\n    {\n        return NULL;\n    }\n\n    new = (ngx_pool_t *) m;\n    // psizeæ˜¯æ•´ä¸ªå†…å­˜æ± å—çš„å¤§å°ã€‚mæ˜¯å¼€å§‹ï¼Œåˆ™endæŒ‡å‘è¿™ä¸ªæ–°å¼€è¾Ÿçš„å†…å­˜æ± å—çš„æœ«å°¾\n    new->d.end = m + psize;\n    // nextæš‚æ—¶æŒ‡å‘NULLã€‚\n    new->d.next = NULL;\n    new->d.failed = 0;\n\n    // å­˜æ”¾æ™®é€šå†…å­˜æ± å—çš„å¤´ä¿¡æ¯\n    m += sizeof(ngx_pool_data_t);\n    // å†…å­˜å¯¹é½ m ï¼Œå­˜å‚¨å®é™…æ•°æ®çš„å¼€å§‹åœ°å€\n    m = ngx_align_ptr(m, NGX_ALIGNMENT);\n    // åˆ†é…å‡ºå» size å¤§å°çš„å†…å­˜ï¼Œlastï¼ˆä¸‹ä¸€ä¸ªç©ºé—²å†…å­˜çš„å¼€å§‹åœ°å€ï¼‰æ›´æ–°åˆ°æ–°ä½ç½®\n    new->d.last = m + size;\n    \n    // ä»æ•´ä¸ªå†…å­˜æ± çš„currentåˆ°åç»­ä¸€é•¿ä¸²ï¼Œç»™æ¯ä¸€ä¸ªå†…å­˜æ± å—çš„failedè®¡æ•°åŠ 1ã€‚\n    // å¦‚æœå‘ç°å½“å‰è¿™ä¸ªå†…å­˜æ± å—çš„failedæ˜¯4ï¼Œåˆ™currentæŒ‡å‘è¿™ä¸ªfailedæ¬¡æ•°è¿‡å¤šå†…å­˜æ± å—çš„ä¸‹ä¸€ä¸ªå†…å­˜æ± å—ã€‚ \n    for (p = pool->current; p->d.next; p = p->d.next)\n    {\n        if (p->d.failed++ > 4)\n        {\n            pool->current = p->d.next;\n        }\n    }\n    // é€€å‡ºfor å¾ªç¯åï¼Œp æ›´æ–°åˆ°äº† æœ€åä¸€ä¸ªå†…å­˜æ± å—ã€‚åŒæ—¶ï¼Œå½“å‰poolçš„currentæŒ‡å‘çš„æ˜¯ç¬¬ä¸€ä¸ªfailedä¸ä¸º4çš„å†…å­˜æ± å—\n    // å°¾æ’ã€‚é“¾æ¥èµ·æ¥æ–°å¼€è¾Ÿçš„è¿™ä¸ªå†…å­˜æ± å—ã€‚\n    p->d.next = new;\n\n    return m;\n}\n```\n## `ngx_palloc_large(pool, size)`å¤§å—å†…å­˜åˆ†é…ç®¡ç†\nç”¨æˆ·ç”³è¯·æ¯”`pool->max`å¤§çš„å†…å­˜æ—¶ï¼ŒæŒ‰å¤§å—å†…å­˜åˆ†é…ç®¡ç†ã€‚\nç”¨`ngx_alloc`åˆ†é…sizeå¤§å°çš„å†…å­˜ï¼ˆå’Œåˆ†é…å†…å­˜æ± å—çš„æ–¹æ³•ä¸€æ ·ï¼‰è§[`ngx_memalign(POOL_ALIGNMENT, size, log)`æˆ–`ngx_alloc(size, log)`](#`ngx_memalign(POOL_ALIGNMENT,%20size,%20log)`æˆ–`ngx_alloc(size,%20log)`)ã€‚\néå†æ‰¾largeé“¾çš„å‰5ä¸ªï¼Œçœ‹æ˜¯å¦æœ‰largeçš„allocä¸ºç©ºçš„ï¼Œç›´æ¥è®©allocæŒ‡å‘ä¸€å¼€å§‹mallocå¾—åˆ°çš„pã€‚\nå¦‚æœè¿ç»­æ‰¾äº†5ä¸ªï¼Œå‘ç°largeçš„allocéƒ½ä¸ä¸ºç©ºï¼Œåˆ™è·³å‡ºå¾ªç¯ï¼Œä¸å†æ‰¾äº†ã€‚\nè¿™ä¸ªforå¾ªç¯æ˜¯ä¸ºäº†å¿«é€Ÿåœ¨å‰5ä¸ªlargeä¸­ï¼Œæ‰¾åˆ°ä¸€ä¸ªä¹‹å‰å¼€è¾Ÿçš„ï¼Œä½†å·²ç»ç©ºé—²äº†çš„å¤§å†…å­˜å—å¤´ä¿¡æ¯ï¼Œå…¶allocç®¡ç†çš„å¤§å†…å­˜å—å·²ç»é‡Šæ”¾äº†ï¼Œæ‰€ä»¥ä¸ºNULLï¼Œç›´æ¥è®©allocæŒ‡å‘ä¸€å¼€å§‹mallocå¾—åˆ°çš„på³å¯ã€‚\n\nå¦‚æœæ²¡æœ‰è¿›å…¥å¾ªç¯ï¼Œè¯´æ˜largeä¸€å¼€å§‹å°±æ˜¯ç©ºçš„ï¼Œå†…å­˜æ± æ²¡æœ‰ç”³è¯·è¿‡å¤§å—å†…å­˜ï¼›æˆ–è€…æ˜¯æ‰¾äº†5ä¸ªå‘ç°largeçš„allocéƒ½ä¸ç©ºï¼šæ‰§è¡Œä¸‹é¢çš„æ“ä½œï¼ˆå¤´æ’å¤§å†…å­˜å—çš„å¤´ä¿¡æ¯åˆ°poolçš„largeé“¾ï¼‰ï¼š\n\nè®°å½•å¤§å†…å­˜å—ï¼ˆlargeç®¡ç†ï¼‰çš„ å¤´ä¿¡æ¯`ngx_pool_large_t`ï¼Œæ˜¯æŒ‰ç…§`ngx_palloc_small`æ–¹æ³•ï¼Œå­˜æ”¾åˆ°äº†å†…å­˜æ± å—çš„å°å—å†…å­˜ä¸­ã€‚\n`ngx_palloc_small`è¿”å›ç©ºè¯´æ˜ç³»ç»Ÿå†…å­˜ä¸å¤Ÿç”¨äº†ï¼Œå¤±è´¥ï¼Œé‡Šæ”¾ä¸€å¼€å§‹mallocå¾—åˆ°çš„å¤§å—å†…å­˜ï¼Œè¿”å›NULLã€‚\n\nå¦‚æœæ­£å¸¸ï¼Œåˆ™åœ¨è¿™ä¸ªå¤§å—å†…å­˜å¤´ä¿¡æ¯å¡«å†™ï¼š\n`alloc`ï¼Œå³è¿™ä¸ªå¤§å—å†…å­˜çš„åœ°å€ï¼Œä¸ºä¸€å¼€å§‹mallocå¾—åˆ°çš„åœ°å€ã€‚\n`next`ï¼ŒæŒ‡å‘poolçš„largeé“¾å¤´ï¼Œpoolçš„largeæŒ‡å‘è¿™ä¸ªæ–°å¤§å—å†…å­˜çš„å¤´ä¿¡æ¯ã€‚ç›¸å½“äºå¤´æ’ï¼åªä¸è¿‡æ’çš„æ˜¯å¤§å†…å­˜å—çš„å¤´ä¿¡æ¯ã€‚\n```c\nstatic void *\nngx_palloc_large(ngx_pool_t *pool, size_t size)\n{\n    void              *p;\n    ngx_uint_t         n;\n    ngx_pool_large_t  *large;\n\n    p = ngx_alloc(size, pool->log);\n    if (p == NULL)\n    {\n        return NULL;\n    }\n\n    n = 0;\n\n    for (large = pool->large; large; large = large->next)\n    {\n        if (large->alloc == NULL)\n        {\n            large->alloc = p;\n            return p;\n        }\n\n        if (n++ > 3)\n        {\n            break;\n        }\n    }\n    // è®°å½• å¤§å— å†…å­˜ï¼ˆlargeç®¡ç†ï¼‰çš„ å¤´ä¿¡æ¯ï¼Œå­˜æ”¾åˆ°å†…å­˜æ± å—ç®¡ç†çš„å°å—å†…å­˜ä¸­ã€‚\n    // è¿”å›ç©ºè¯´æ˜ ç³»ç»Ÿ å†…å­˜ä¸å¤Ÿç”¨äº†ï¼Œå¤±è´¥ã€‚\n    large = ngx_palloc_small(pool, sizeof(ngx_pool_large_t), 1);\n    if (large == NULL)\n    {\n        ngx_free(p);\n        return NULL;\n    }\n\n    large->alloc = p;\n    large->next = pool->large;\n    pool->large = large;\n\n    return p;\n}\n```\nå›¾ç¤ºï¼š\n![](../../images/SGI%20STLå’ŒNginxå†…å­˜æ± å‰–æ/image-20250807115333694.png)\n\nå¦‚å›¾ï¼Œå¤§å—å†…å­˜çš„å¤´ä¿¡æ¯ï¼Œæ˜¯æŒ‰å°å—å†…å­˜ç®¡ç†ï¼Œåˆ†é…åˆ°äº†å†…å­˜æ± å—ä¸­ã€‚\n\nä¸‹é¢è¦æåˆ°çš„å¤–éƒ¨èµ„æºæ‰€ç»‘å®šçš„æ¸…ç†çš„å¤´ä¿¡æ¯ï¼Œä¹Ÿåƒæ˜¯å¤§å—å†…å­˜å¤´ä¿¡æ¯ä¸€æ ·ï¼ŒæŒ‰å°å—å†…å­˜ç®¡ç†ï¼Œåˆ†é…åˆ°äº†å†…å­˜æ± å—ä¸­ã€‚\n## `ngx_pool_cleanup_add`åˆ†é…ä¸€ä¸ªéœ€è¦ç®¡ç†å¤–éƒ¨èµ„æºçš„æ•°æ®ï¼ˆæ¯”å¦‚æŒ‡é’ˆã€fdï¼‰\næŒ‰å°å—å†…å­˜åˆ†é…`ngx_pool_cleanup_t`ï¼Œè¿™æ˜¯æ¸…ç†çš„å¤´ä¿¡æ¯å—ã€‚\næœ‰ï¼šhandlerã€dataã€nextã€‚\n\nä¹‹åæ‰æ˜¯åˆ†é…sizeã€‚\n\nä¹‹åï¼Œåƒå¤´æ’å¤§å†…å­˜å—çš„å¤´ä¿¡æ¯é“¾è¡¨ä¸€æ ·ï¼Œå¤´æ’æ¸…ç†ç±»çš„å¤´ä¿¡æ¯é“¾è¡¨ã€‚\n```c\nngx_pool_cleanup_t * ngx_pool_cleanup_add(ngx_pool_t *p, size_t size)\n{\n    ngx_pool_cleanup_t  *c;\n\n    c = ngx_palloc(p, sizeof(ngx_pool_cleanup_t));\n    if (c == NULL)\n    {\n        return NULL;\n    }\n\n    if (size)\n    {\n        c->data = ngx_palloc(p, size);\n        if (c->data == NULL)\n        {\n            return NULL;\n        }\n    }\n    else\n    {\n        c->data = NULL;\n    }\n\n    c->handler = NULL;\n    c->next = p->cleanup;\n\n    p->cleanup = c;\n\n    ngx_log_debug1(NGX_LOG_DEBUG_ALLOC, p->log, 0, \"add cleanup: %p\", c);\n\n    return c;\n}\n```\n### é€šè¿‡è¿”å›çš„`ngx_pool_cleanup_t *`ç»‘å®šæ¸…ç†å›è°ƒå‡½æ•°\n```c\nstruct Data\n{\n    char * p;\n    // ...\n};\nstruct Data *pData = ngx_alloc(512);\npData->p = (char*)malloc(128);\nstrcpy(pData->p, \"hello world\");\n\nvoid my_release(void *p)\n{\n    free(p);\n}\n\nngx_pool_cleanup_t *pclean = ngx_pool_cleanup_add(pool, sizeof(char*));\npclean->handler = &my_release;\npclean->data = pData->p;\n```\n## `ngx_pfree(pool, void *p)`å¤§å—å†…å­˜é‡Šæ”¾\nç”¨äºé‡Šæ”¾å¤§å—å†…å­˜ã€‚å…ˆfreeï¼ŒåæŠŠlargeå¤´ä¿¡æ¯ä¸­çš„allocç½®ç©ºã€‚\n```c\nngx_int_t\nngx_pfree(ngx_pool_t *pool, void *p)\n{\n    ngx_pool_large_t  *l;\n\n    for (l = pool->large; l; l = l->next)\n    {\n        if (p == l->alloc)\n        {\n            ngx_log_debug1(NGX_LOG_DEBUG_ALLOC, pool->log, 0,\n                           \"free: %p\", l->alloc);\n\n            ngx_free(l->alloc);\n            l->alloc = NULL;\n\n            return NGX_OK;\n        }\n    }\n    return NGX_DECLINED;\n}\n```\n## å°å—å†…å­˜é‡Šæ”¾ï¼šæ— \nNginxçš„å°å—å†…å­˜ä¸€æ—¦åˆ†é…äº†ä¹‹åï¼Œå°±æ— æ³•ç²¾ç¡®åœ°å›æ”¶ã€‚\n\nä¸åƒSGI STLä¸€æ ·ï¼Œå‡è®¾Aã€Bã€Cä¸‰ä¸ªå°å†…å­˜å•å…ƒç›¸é‚»ï¼ŒAã€Cç©ºé—²ï¼ŒAæ˜¯freelistçš„ç¬¬ä¸€ä¸ªç©ºé—²å—ï¼ŒAçš„nextæ˜¯Cã€‚ç°åœ¨é‡Šæ”¾Bï¼Œåˆ™Bå¤´æ’åˆ°freelistï¼Œç°åœ¨æ˜¯Bè¿ç€Aè¿ç€Cã€‚è¿™æ ·å¯ä»¥ç²¾ç¡®åœ°é‡Šæ”¾ï¼Œå¹¶ä¸‹æ¬¡è¿˜èƒ½é‡æ–°åˆ†é…ï¼ˆå¯ä»¥å‘ç°ï¼Œç”±äºæ˜¯å¤´æ’åˆ°äº†freelistçš„ç¬¬ä¸€ä¸ªç©ºé—²åŒºåŸŸï¼Œæ‰€ä»¥æœ€åé‡Šæ”¾çš„æœ€å…ˆåˆ†é…ï¼‰ã€‚\n\nNginxå‘¢ï¼Œæ¯ä¸ªå†…å­˜æ± å—åªæ˜¯ç”±`last`å’Œ`end`ä¸¤ä¸ªæŒ‡é’ˆç®¡ç†ï¼Œåªèƒ½æŒ‡ç¤ºå½“å‰å†…å­˜æ± å—çš„æœªåˆ†é…çš„éƒ¨åˆ†ã€‚\n\nå½“å·²åˆ†é…çš„éƒ¨åˆ†ä¸­ï¼Œæœ‰ 1 ä¸ªå°å—å†…å­˜è¦é‡Šæ”¾ï¼Œæ— æ³•ç²¾ç¡®ç®¡ç†ã€‚æ‰€ä»¥Nginxåªèƒ½è¿ç»­åœ°é‡Šæ”¾ä¸€æ•´æ®µç©ºé—´ï¼Œä¸lastç›¸è¿ã€‚\n## `ngx_reset_pool(pool)`\néå†largeé“¾è¡¨ï¼Œé‡Šæ”¾æ¯ä¸ªå¤§å—å†…å­˜ã€‚æœ€ålargeç½®ç©ºã€‚\néå†æ¯ä¸ªå†…å­˜æ± å—ï¼ŒæŠŠlastæ‹‰åˆ°å¤´ä¿¡æ¯çš„æœ«å°¾å³å¯ï¼Œç›¸å½“äºé‡Šæ”¾äº†å†…å­˜æ± çš„æ•°æ®ã€‚æœ€åcurrentç½®ä¸ºpoolã€‚\næ³¨æ„ï¼Œåªæ˜¯é‡Šæ”¾äº†å¤§å—å†…å­˜ï¼Œæ‰€æœ‰å†…å­˜æ± å—éƒ½æ²¡æœ‰freeï¼Œåªæ˜¯æ›´æ–°äº†lastã€‚\n```c\nvoid ngx_reset_pool(ngx_pool_t *pool)\n{\n    ngx_pool_t        *p;\n    ngx_pool_large_t  *l;\n\n    for (l = pool->large; l; l = l->next)\n    {\n        if (l->alloc)\n        {\n            ngx_free(l->alloc);\n        }\n    }\n    \n    for (p = pool; p; p = p->d.next)\n    {\n        if (p == pool) // ç¬¬ä¸€ä¸ªå†…å­˜æ± ï¼Œæœ‰poolå¤´ä¿¡æ¯\n        {\n            p->d.last = (u_char*)p + sizeof(ngx_pool_t);\n        }\n        else           // å…¶ä½™çš„å†…å­˜æ± ï¼Œåªæœ‰å°å¤´ä¿¡æ¯ï¼Œæ²¡æœ‰poolå¤§å¤´\n        {\n            p->d.last = (u_char *) p + sizeof(ngx_pool_data_t);\n        }\n        p->d.failed = 0;\n    }\n\n    pool->current = pool;\n    pool->chain = NULL;\n    pool->large = NULL;\n}\n```\n## `ngx_destroy_pool(pool)`\n1. éå†â€œæ¸…ç†â€é“¾è¡¨ï¼Œæ¯ä¸ªéƒ½æŒ‰ç…§ç»‘å®šçš„handleré‡Šæ”¾å…¶dataå¤–éƒ¨èµ„æºã€‚\n2. éå†largeé“¾è¡¨ï¼Œé‡Šæ”¾æ¯ä¸ªå¤§å—å†…å­˜ã€‚\n3. éå†æ¯ä¸ªå†…å­˜æ± å—ï¼Œé‡Šæ”¾æ¯ä¸ªå†…å­˜æ± å—ã€‚\n\n```c\nvoid\nngx_destroy_pool(ngx_pool_t *pool)\n{\n    ngx_pool_t          *p, *n;\n    ngx_pool_large_t    *l;\n    ngx_pool_cleanup_t  *c;\n\n    for (c = pool->cleanup; c; c = c->next)\n    {\n        if (c->handler)\n        {\n            ngx_log_debug1(NGX_LOG_DEBUG_ALLOC, pool->log, 0,\n                           \"run cleanup: %p\", c);\n            c->handler(c->data);\n        }\n    }\n#if (NGX_DEBUG)\n    /*\n     * we could allocate the pool->log from this pool\n     * so we cannot use this log while free()ing the pool\n     */\n    for (l = pool->large; l; l = l->next)\n    {\n        ngx_log_debug1(NGX_LOG_DEBUG_ALLOC, pool->log, 0, \"free: %p\", l->alloc);\n    }\n    for (p = pool, n = pool->d.next; /* void */; p = n, n = n->d.next)\n    {\n        ngx_log_debug2(NGX_LOG_DEBUG_ALLOC, pool->log, 0,\n                       \"free: %p, unused: %uz\", p, p->d.end - p->d.last);\n        if (n == NULL)\n        {\n            break;\n        }\n    }\n#endif\n    for (l = pool->large; l; l = l->next)\n    {\n        if (l->alloc)\n        {\n            ngx_free(l->alloc);\n        }\n    }\n    for (p = pool, n = pool->d.next; /* void */; p = n, n = n->d.next)\n    {\n        ngx_free(p);\n        if (n == NULL)\n        {\n            break;\n        }\n    }\n}\n```\n# Nginxå’ŒSTLé‡Šæ”¾å†…å­˜çš„ç­–ç•¥é€‚ç”¨çš„åœºæ™¯\nNginxå¤§å—å†…å­˜åˆ†é…=ã€‹å†…å­˜é‡Šæ”¾ngx_freeå‡½æ•°\nNginxå°å—å†…å­˜åˆ†é…=ã€‹æ²¡æœ‰æä¾›ä»»ä½•çš„å†…å­˜é‡Šæ”¾å‡½æ•°ã€‚\n\nå®é™…ä¸Šï¼Œä»å°å—å†…å­˜çš„åˆ†é…æ–¹å¼æ¥çœ‹ï¼ˆç›´æ¥é€šè¿‡lastæŒ‡é’ˆåç§»æ¥åˆ†é…å†…å­˜ï¼‰ï¼Œæ ¹æœ¬æ²¡æ³•è¿›è¡Œä¸­é—´éƒ¨åˆ†çš„å°å—å†…å­˜çš„å›æ”¶ã€‚\n\nNginxæœ¬è´¨ï¼šHTTPæœåŠ¡å™¨æ˜¯ä¸€ä¸ªçŸ­é“¾æ¥çš„æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰å‘èµ·ä¸€ä¸ªrequestè¯·æ±‚ï¼Œåˆ°è¾¾NginxæœåŠ¡å™¨ä»¥åï¼Œå¤„ç†å®Œæˆï¼ŒNginxç»™å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªresponseå“åº”ï¼ŒHTTPæœåŠ¡å™¨å°±ä¸»åŠ¨æ–­å¼€tcpè¿æ¥ã€‚\nå‡è®¾HTTP 1.1 keep-aliveï¼š60sï¼ŒHTTPæœåŠ¡å™¨ï¼ˆnginxï¼‰è¿”å›å“åº”ä»¥åï¼Œéœ€è¦ç­‰å¾…60sï¼Œ60sä¹‹å†…å®¢æˆ·ç«¯åˆå‘æ¥è¯·æ±‚ï¼Œé‡ç½®è¿™ä¸ªæ—¶é—´ï¼›\nå¦åˆ™60sä¹‹å†…æ²¡æœ‰å®¢æˆ·ç«¯å‘æ¥çš„å“åº”ï¼ŒNginxä¹Ÿæ˜¯æœ€ç»ˆä¼šä¸»åŠ¨æ–­å¼€è¿æ¥ï¼Œæ­¤æ—¶Nginxå¯ä»¥è°ƒç”¨ngx_reset_poolé‡ç½®å†…å­˜æ± äº†ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚\n\nå› æ­¤ï¼ŒNginxå†…å­˜æ± çš„è®¾è®¡é€‚ç”¨äºé—´æ­‡æ€§ã€çŸ­è¿æ¥çš„æœåŠ¡ã€‚è™½ç„¶æœ‰å†…å­˜æ³„æ¼ï¼Œä½†æ•ˆç‡é«˜ï¼Œç©ºé—´æ¢æ—¶é—´ã€‚\n\nå¦‚æœæ˜¯é•¿è¿æ¥ï¼Œä¸”å°å—å†…å­˜åˆ†é…ã€é‡Šæ”¾è¾ƒå¤šï¼Œæœ€å¥½ç”¨STLäºŒçº§ç©ºé—´é…ç½®å™¨ï¼Œé¿å…å†…å­˜æ³„æ¼è¿‡å¤šã€‚","categories":["Cpp","STL","é¡¹ç›®","å†…å­˜æ± "]},{"title":"è®¾è®¡å¹¶å®ç°çº¿ç¨‹æ± _futureåŸç†","url":"/é¡¹ç›®/è®¾è®¡å¹¶å®ç°çº¿ç¨‹æ± _futureåŸç†/","content":"# çŸ¥è¯†å‚¨å¤‡\n## å¹¶å‘å’Œå¹¶è¡Œ\n\n* å¹¶å‘\n\nå•æ ¸ä¸Šï¼ŒCPUæ—¶é—´ç‰‡è½®è½¬ï¼Œå¤šä¸ªçº¿ç¨‹è½®æµæ‰§è¡Œã€‚ç‰©ç†ä¸Šæ˜¯ä¸²è¡Œæ‰§è¡Œçš„ï¼Œä½†æ˜¯ç”±äºæ¯ä¸ªçº¿ç¨‹å ç”¨çš„CPUæ—¶é—´ç‰‡éå¸¸çŸ­ï¼ˆæ¯”å¦‚10msï¼‰ï¼Œå®è§‚ä¸Šçœ‹å°±åƒæ˜¯å¤šä¸ªçº¿ç¨‹åœ¨å…±åŒæ‰§è¡Œï¼Œè¿™æ ·çš„åœºæ™¯ç§°ä½œå¹¶å‘(concurrent)ã€‚\n\n* å¹¶è¡Œ\n\nåœ¨å¤šæ ¸æˆ–è€…å¤šCPUä¸Šï¼Œå¤šä¸ªçº¿ç¨‹åœ¨åŒä¸€æ—¶åˆ»æ‰§è¡Œï¼Œè¿™æ ·çš„åœºæ™¯æ‰æ˜¯çœŸæ­£çš„å¹¶è¡Œ(parallel)ã€‚\n## ä¸¤ç§å¯†é›†å‹ç¨‹åº\n\nå¤šçº¿ç¨‹ç¨‹åºä¸€å®šå¥½å—ï¼Ÿä¸ä¸€å®šï¼Œè¦çœ‹å…·ä½“çš„åº”ç”¨åœºæ™¯ã€‚\n* IOå¯†é›†å‹ï¼šç¨‹åºé‡Œé¢æŒ‡ä»¤çš„æ‰§è¡Œï¼Œæ¶‰åŠIOæ“ä½œè¾ƒå¤šï¼Œæ¯”å¦‚è®¾å¤‡ã€æ–‡ä»¶ã€ç½‘ç»œæ“ä½œï¼ˆç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥ï¼‰ï¼Œå¯èƒ½ä¼šæŠŠç¨‹åºé˜»å¡ã€‚å¦‚æœCPUæ—¶é—´ç‰‡å†åˆ†é…ç»™è¿™ç§çº¿ç¨‹ï¼Œç›¸å½“äºæµªè´¹äº†CPUèµ„æºã€‚\n* CPUå¯†é›†å‹ï¼šç¨‹åºé‡Œé¢çš„æŒ‡ä»¤éƒ½æ˜¯åšè®¡ç®—ç”¨çš„ï¼Œä¸ä¼šé˜»å¡ã€‚\n---\n* å¤šæ ¸æƒ…å†µä¸‹\n    1. IOå¯†é›†å‹å’ŒCPUå¯†é›†å‹è™½ç„¶å¯¹å¹¶è¡Œè®¡ç®—æœ‰ä¸åŒçš„éœ€æ±‚ï¼ŒIOå¯†é›†å‹æ›´é€‚åˆè®¾è®¡æˆå¤šçº¿ç¨‹ç¨‹åºã€‚ä½†æ˜¯åœ¨å¤šæ ¸æƒ…å†µä¸‹ä¸¤ç§å¯†é›†å‹ç¨‹åºéƒ½æ˜¯æœ‰å¿…è¦ç”¨å¤šçº¿ç¨‹æ¥å¤„ç†çš„ã€‚\n    2. çº¿ç¨‹è¿›è¡Œè°ƒåº¦æ—¶ï¼Œå†…æ ¸ä¸­æœ‰è¿™æ ·ä¸¤ä¸ªé˜Ÿåˆ—ï¼šrunnableï¼Œå°±ç»ªçš„æˆ–æ­£åœ¨è°ƒåº¦çš„é˜Ÿåˆ—ã€‚å¦‚æœå› IOæ“ä½œæœ‰çº¿ç¨‹é˜»å¡äº†ï¼Œåˆ™å°†ä¼šè¿›å…¥é˜»å¡é˜Ÿåˆ—ï¼Œblocking queueã€‚\n* å•æ ¸æƒ…å†µä¸‹\n    1. IOå¯†é›†å‹çš„ç¨‹åºä¾ç„¶é€‚åˆè®¾è®¡ä¸ºå¤šçº¿ç¨‹ç¨‹åºã€‚\n    2. CPUå¯†é›†å‹ç¨‹åºä¸å†é€‚åˆï¼è¿™å°±ç›¸å½“äºåªæœ‰ä¸€ä¸ªè®¡ç®—å™¨ï¼Œå´è®©å¤šä¸ªäººåˆ†æ®µç®—ã€‚çº¿ç¨‹çš„è°ƒåº¦æœ‰é¢å¤–çš„èŠ±è´¹ï¼šçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚CPUå¯„å­˜å™¨ä¿¡æ¯ä¼šä¿å­˜åœ¨çº¿ç¨‹æ ˆä¸Šï¼Œä¸‹æ¬¡è¿˜è¦å†æ¢å¤åˆ°CPUä¸­ï¼Œå®å±éº»çƒ¦ã€‚\n## çº¿ç¨‹çš„ä»£ä»·\n\nä¸ºäº†å®Œæˆä»»åŠ¡ï¼Œåˆ›å»ºå¾ˆå¤šçº¿ç¨‹å¯ä»¥å—ï¼Ÿçº¿ç¨‹è¶Šå¤šè¶Šå¥½å—ï¼Ÿ\n* çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯éƒ½æ˜¯éå¸¸â€œé‡â€çš„æ“ä½œï¼Œéœ€è¦è¿›å…¥å†…æ ¸æ€ã€‚åœ¨æ‰§è¡Œä»»åŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰é›†ä¸­èµ„æºå»å¹²æ­£äº‹ï¼Œè€Œæ˜¯å»èŠ±è´¹å¾ˆå¤§åŠ›åº¦åˆ›å»º/é”€æ¯ï¼Ÿ\n    * éœ€è¦ç»™çº¿ç¨‹åˆ›å»º`PCB(task_struct)`ã€çº¿ç¨‹çš„å†…æ ¸æ ˆã€é¡µç›®å½•ã€é¡µè¡¨\n    * æè¿°åœ°å€ç©ºé—´ç›¸åº”çš„æ•°æ®ç»“æ„ï¼š`vm_area_struct`\n    * å†…æ ¸åˆ›å»ºå®Œåï¼Œè¿˜è¦è¿”å›ç”¨æˆ·æ€\n    * çº¿ç¨‹æ‰§è¡Œå®Œä¸šåŠ¡ï¼Œè¿˜è¦é”€æ¯çº¿ç¨‹ï¼Œåˆè¦åˆ‡æ¢ä¸€æ¬¡\n* çº¿ç¨‹æ ˆæœ¬èº«å ç”¨å¤§é‡å†…å­˜ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½éœ€è¦çº¿ç¨‹æ ˆï¼Œæ ˆå‡ ä¹éƒ½è¢«å ç”¨å®Œäº†ï¼Œè¿˜æ€ä¹ˆåšäº‹æƒ…ï¼Ÿ\n    * 32ä½åœ°å€ç©ºé—´ï¼Œå…±4Gï¼Œç”¨æˆ·ç©ºé—´æœ‰3Gã€‚\n    * çº¿ç¨‹å…±äº«è¿›ç¨‹çš„åœ°å€ç©ºé—´ã€‚\n    * å¯åœ¨linuxä¸‹æ‰§è¡Œ`ulimt -a`å‘½ä»¤è§‚å¯Ÿstack sizeé»˜è®¤æ ˆå¤§å°ï¼Œä¸º8192å­—èŠ‚å³8Mã€‚\n    * $3*1024M=3072M, 3072M/8M=384$ä¸ªã€‚è¿™è¯´æ˜32ä½ç¯å¢ƒä¸‹ï¼Œæœ€å¤šåˆ›å»º384ä¸ªçº¿ç¨‹ã€‚\n* çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢è¦å ç”¨å¤§é‡æ—¶é—´\n    * çº¿ç¨‹è¿‡å¤šï¼Œçº¿ç¨‹çš„è°ƒåº¦æ˜¯éœ€è¦è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢èŠ±è´¹CPUæ—¶é—´ä¹Ÿç‰¹åˆ«å¤šï¼ŒCPUçš„åˆ©ç”¨ç‡å°±ä¸é«˜äº†ã€‚\n* å¤§é‡çº¿ç¨‹åŒæ—¶å”¤é†’ä¼šä½¿ç³»ç»Ÿç»å¸¸å‡ºç°é”¯é½¿çŠ¶è´Ÿè½½æˆ–è€…ç¬é—´è´Ÿè½½é‡å¾ˆå¤§å¯¼è‡´å®•æœº\n    * å¦‚æœåœ¨æŸä¸€æ—¶åˆ»ï¼Œå¤§é‡çš„IOæ“ä½œå‡†å¤‡å¥½äº†ï¼Œé‚£ä¹ˆä¸€æ—¶é—´çº¿ç¨‹æ˜¯æ¥ä¸åŠå¤„ç†çš„ã€‚\n# çº¿ç¨‹åŒæ­¥\n## çº¿ç¨‹äº’æ–¥\n\næŸæ®µä»£ç èƒ½ä¸èƒ½å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ‰§è¡Œï¼Ÿçœ‹è¿™æ®µä»£ç æ˜¯å¦å­˜åœ¨**ç«æ€æ¡ä»¶**ï¼Œå³æœ‰æ— ä¸´ç•ŒåŒºä»£ç æ®µã€‚ï¼ˆä»£ç ç‰‡æ®µåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ‰§è¡Œï¼Œéšç€çº¿ç¨‹çš„è°ƒåº¦é¡ºåºä¸åŒè€Œå¾—åˆ°ä¸åŒçš„æ‰§è¡Œç»“æœï¼‰ã€‚å¦‚æœæœ‰ï¼Œåˆ™è¦é€šè¿‡çº¿ç¨‹åŒæ­¥æ¥ä¿è¯å®ƒçš„åŸå­æ“ä½œã€‚\n\nå¦‚æœåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¸å­˜åœ¨ç«æ€æ¡ä»¶ï¼Œåˆ™ç§°ä¹‹ä¸º**å¯é‡å…¥çš„**ã€‚\n### äº’æ–¥é”\n* lock\n* `try_lock`\n* `lock_guard`\n* `unique_lock`\n### atomicåŸå­ç±»å‹\n* CASæ“ä½œï¼ˆæ— é”æœºåˆ¶ï¼‰\n    * æ— é”é˜Ÿåˆ—ã€æ— é”é“¾è¡¨ã€æ— é”æ•°ç»„\n    * å®é™…ä¸Šä½¿ç”¨çš„æ˜¯è½»é‡çº§ã€æ•ˆç‡é«˜çš„é”ï¼Œä¸æ˜¯æ²¡ç”¨é”ã€‚\n## çº¿ç¨‹é€šä¿¡\n\n[GDBè°ƒè¯•C++11å¤šçº¿ç¨‹æ­»é”](https://blog.csdn.net/QIANGWEIYUAN/article/details/88792621)\n### æ¡ä»¶å˜é‡\n### ä¿¡å·é‡\nçœ‹ä½œèµ„æºè®¡æ•°æ²¡æœ‰é™åˆ¶çš„mutexäº’æ–¥é”ã€‚mutexäº’æ–¥é”çš„èµ„æºè®¡æ•°åªèƒ½æ˜¯0æˆ–è€…1ã€‚\n### åŒºåˆ«\n* äºŒå…ƒä¿¡å·é‡å’Œäº’æ–¥é”çš„åŒºåˆ«\n    * mutexåªèƒ½æ˜¯å“ªä¸ªçº¿ç¨‹è·å–é”ï¼Œç”±å“ªä¸ªçº¿ç¨‹é‡Šæ”¾é”ã€‚\n    * `sem.wait()`å’Œ`sem.post()`åˆ™å¯ä»¥å¤„åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­è°ƒç”¨ã€‚\n# çº¿ç¨‹æ± \nçº¿ç¨‹æ± çš„ä¼˜åŠ¿ï¼š\n\næœåŠ¡è¿›ç¨‹å¯åŠ¨ä¹‹åˆï¼Œäº‹å…ˆåˆ›å»ºå¥½çº¿ç¨‹æ± é‡Œé¢çš„çº¿ç¨‹ï¼Œå½“ä¸šåŠ¡åˆ°æ¥éœ€è¦åˆ†é…çº¿ç¨‹æ—¶ç›´æ¥ä»çº¿ç¨‹æ± ä¸­è·å–ä¸€ä¸ªç©ºé—²çº¿ç¨‹æ‰§è¡Œtaskä»»åŠ¡å³å¯ï¼Œtaskæ‰§è¡Œå®Œæˆä¹‹åæŠŠçº¿ç¨‹å½’è¿˜åˆ°çº¿ç¨‹æ± ä¸­ç»§ç»­ç»™åç»­taskæä¾›æœåŠ¡ï¼Œè€Œä¸ç”¨é‡Šæ”¾çº¿ç¨‹ã€‚\n## é¡¹ç›®ä»‹ç»\n\næœ¬é¡¹ç›®æ‰€å®ç°çš„çº¿ç¨‹æ± å’Œå¯¹è±¡æ± ã€å†…å­˜æ± ã€STLåº“çš„æ„ä¹‰ä¸€æ ·ï¼Œåªèƒ½ç§°ä½œä¸€ä¸ªåº“ï¼Œè€Œä¸èƒ½ä½œä¸ºä¸€ä¸ªç‹¬ç«‹è¿è¡Œçš„ä¸­é—´ä»¶ï¼Œå¿…é¡»é•¶åµŒåœ¨åº”ç”¨ç¨‹åºä¸­ã€‚æœ€ç»ˆé¡¹ç›®è¡¨ç°å½¢å¼ä¸ºä¸€ç§æä¾›ç»™ä»–äººçš„**åŠ¨æ€åº“**ï¼Œæ¯”å¦‚ç”¨åˆ°äº†`mysql.h`å¤´æ–‡ä»¶ï¼Œ`libmysqlclient.so`åŠ¨æ€åº“ã€‚åŠ¨æ€åº“éœ€è¦ç¼–è¯‘å‡ºæ¥ã€‚\n### ä½¿ç”¨æ–¹å¼\n\n* å¯åŠ¨çº¿ç¨‹æ± \n\nå¦‚æœä½ æƒ³åœ¨åº”ç”¨ç¨‹åºä¸­æˆ–è€…ä»£ç ä¸­ä½¿ç”¨æœ¬é¡¹ç›®çš„çº¿ç¨‹æ± ï¼Œä½ å¯ä»¥\n\n1. ç›´æ¥`ThreadPool pool;`å®šä¹‰ä¸€ä¸ª`pool`å¯¹è±¡ï¼›\n2. è€Œååˆ™å¯ä»¥è°ƒç”¨`pool.sexMode(fixed(default) | cached);`æ¥å£è®¾ç½®çº¿ç¨‹æ± çš„è¿è¡Œæ¨¡å¼ï¼Œé»˜è®¤ä¸ºå›ºå®šæ¨¡å¼ã€‚\n3. ç„¶å`pool.start();`å¯åŠ¨çº¿ç¨‹æ± ã€‚startä¸ä¼šé˜»å¡ã€‚\n\nå¯åŠ¨çº¿ç¨‹æ± æ„å‘³ç€çº¿ç¨‹æ± å¼€å§‹åˆ›å»ºè‹¥å¹²çº¿ç¨‹ï¼Œå°±ç»ªï¼Œç­‰å¾…ä»»åŠ¡è¿‡æ¥æ‰§è¡Œä»»åŠ¡ã€‚\n\n* æäº¤ä»»åŠ¡\n\nè°ƒç”¨æ–¹åªè¦æŒ‰ä»¥ä¸‹å½¢å¼è°ƒç”¨APIå³å¯ï¼š`Result result = pool.submitTask(concreteTask);`\n\nè°ƒç”¨æ–¹æ— éœ€å…³å¿ƒå†…éƒ¨æ“ä½œï¼ŒåŒ…æ‹¬çº¿ç¨‹åˆ†é…ã€æ‰§è¡Œè¿‡ç¨‹ã€‚\n\næœ‰æ—¶è°ƒç”¨æ–¹éœ€è¦è·å–ä»»åŠ¡æ‰§è¡Œçš„ç»“æœï¼Œå¯ç”¨`T res = result.get().Cast<T>();`è·å¾—ä»»åŠ¡ç»“æœã€‚ä»»åŠ¡ç»“æœçš„è¿”å›å€¼æ˜¯ä»»æ„ç±»å‹ï¼Œå…·ä½“ç±»å‹Tç”±ç”¨æˆ·æŒ‡å‡ºã€‚ï¼ˆæ­¤å¤„ç”¨åˆ°äº†C++17ä¸­çš„Anyç±»å‹ï¼‰\n\n# çº¿ç¨‹æ± çš„è®¾è®¡\n\n## ç±»æˆå‘˜\n\né¦–å…ˆè¯´ä¸€è¯´æŠ½è±¡å‡ºçš„ç±»ï¼šçº¿ç¨‹æ± ç±»ã€çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ç±»ã€‚\n\n1. æ—¢ç„¶æ˜¯çº¿ç¨‹æ± ï¼Œå°±è¦æœ‰ä¸€ä¸ª**å­˜æ”¾çº¿ç¨‹çš„å®¹å™¨**\n    1. æˆ‘ä»¬æœ€å¥½èƒ½å®æ—¶ç›‘æ§çº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„æ•°é‡ã€ä»¥åŠä¸Šé™é˜ˆå€¼ï¼Œé¿å…çº¿ç¨‹æ•°é‡èµ°å‘æç«¯ä»è€Œå½±å“æ€§èƒ½ï¼ˆçº¿ç¨‹æ•°é‡ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œåå¤„ï¼š1ã€çº¿ç¨‹æ ˆç©ºé—´å†—ä½™ï¼›2ã€ä¸Šä¸‹æ–‡åˆ‡æ¢è¿‡ç¨‹æ—¶é—´å¤šäºæ‰§è¡Œæ“ä½œï¼‰\n2. è¿˜è¦æœ‰ä¸€ä¸ªå­˜æ”¾å¾…å®Œæˆä»»åŠ¡çš„å®¹å™¨ï¼Œå³**ä»»åŠ¡é˜Ÿåˆ—**\n    1. è€ƒä¸è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿå¿…é¡»è€ƒè™‘ï¼Œå¤–å±‚ç”¨æˆ·æäº¤ä»»åŠ¡è¦æ”¾æ•°æ®ï¼Œä¸‹å±‚çº¿ç¨‹æ‰§è¡Œä»»åŠ¡è¦å–æ•°æ®ã€‚\n    2. ä»»åŠ¡ä¸èƒ½å †ç§¯è¿‡å¤šã€‚å¯¹äºä»»åŠ¡é˜Ÿåˆ—ï¼Œä¹Ÿè¦æœ‰ä¸€ä¸ªä¸Šé™é˜ˆå€¼ã€‚\n\n## é€šç”¨åŒ–çš„å®ç° - Taskè®¾è®¡ - ç»§æ‰¿å¤šæ€æ€æƒ³\n\nä»»åŠ¡ç±»å‹éœ€è¦è¾¾åˆ°é€šç”¨æ€§ï¼Œæ‰€ä»¥è¦ç”¨åˆ°ç»§æ‰¿ã€å¤šæ€çš„æ€æƒ³ã€‚ç”¨åŸºç±»æŒ‡é’ˆå¯ä»¥æŒ‡å‘å„ç§å„æ ·çš„æ´¾ç”Ÿç±»å¯¹è±¡ã€‚\n\næ‰€ä»¥éœ€è¦**è®¾è®¡ä¸€ä¸ªæŠ½è±¡ç±»Taskã€‚å†…éƒ¨æä¾›ä¸€ä¸ªçº¯è™šå‡½æ•°`virtual void run() = 0`**ã€‚å¦‚æœè¦è®¾è®¡ç‰¹å®šçš„ä»»åŠ¡ï¼Œåˆ™ç»§æ‰¿ï¼ˆå®ç°ï¼‰ä¹‹ï¼Œé‡å†™runå‡½æ•°å³å¯ã€‚\n\n## çº¿ç¨‹é€šä¿¡çš„ä¿è¯ - mtx+cv\n\nå› ä¸ºæ¶‰åŠåˆ°æ”¾ä»»åŠ¡ã€å–ä»»åŠ¡ï¼Œæ‰€ä»¥å¾ˆæ˜æ˜¾æ˜¯ä¸ªç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ã€‚\n\nå¿…ç„¶**ç”¨åˆ°äº’æ–¥é”+æ¡ä»¶å˜é‡ï¼Œä»è€Œå¯¹ä»»åŠ¡é˜Ÿåˆ—è¿›è¡Œäº’æ–¥ä¿æŠ¤**ã€è¾¾åˆ°æ­£ç¡®çš„çº¿ç¨‹é€šä¿¡ã€‚\n\n## çº¿ç¨‹æ± çš„æ¨¡å¼\n* fixedæ¨¡å¼\n    * çº¿ç¨‹æ± é‡Œé¢çš„çº¿ç¨‹ä¸ªæ•°æ˜¯å›ºå®šä¸å˜çš„ï¼Œä¸€èˆ¬æ˜¯ThreadPoolåˆ›å»ºæ—¶æ ¹æ®å½“å‰æœºå™¨çš„CPUæ ¸å¿ƒæ•°é‡è¿›è¡ŒæŒ‡å®šã€‚\n* cachedæ¨¡å¼\n    * çº¿ç¨‹æ± é‡Œé¢çš„çº¿ç¨‹ä¸ªæ•°æ˜¯å¯åŠ¨æ€å¢é•¿çš„ï¼Œæ ¹æ®ä»»åŠ¡çš„æ•°é‡åŠ¨æ€åœ°å¢åŠ çº¿ç¨‹çš„æ•°é‡ï¼Œä½†æ˜¯ä¼šè®¾ç½®ä¸€ä¸ªçº¿ç¨‹æ•°é‡çš„é˜ˆå€¼ã€‚ä»»åŠ¡å¤„ç†å®Œæˆåï¼Œå¦‚æœåŠ¨æ€å¢é•¿çš„çº¿ç¨‹ç©ºé—²60sè€Œæ²¡æœ‰å…¶ä»–ä»»åŠ¡å¾…å¤„ç†ï¼Œé‚£ä¹ˆå°±å…³é—­çº¿ç¨‹ï¼Œä¿æŒæ± ä¸­çº¿ç¨‹çš„æœ€åˆæ•°é‡ã€‚\n### ä»£ç å½¢å¼\n```cpp\nint main()\n{\n\tThreadPool pool;\n    pool.setMode(fixed(default) | cached);\n    pool.start();\n}\n```\n### æäº¤ä»»åŠ¡API\n```cpp\nResult result = pool.submitTask(concreteTask);\nresult.get().Cast<T>();\n```\n\n# çº¿ç¨‹æ± ç±»ï¼ˆThreadPoolï¼‰\nçº¿ç¨‹æ± ï¼Œä¸å…‰è¦ç®¡ç†çº¿ç¨‹ï¼Œè€Œä¸”è¦é›†æˆä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ã€‚è¦å¯¹å¤–æä¾›æäº¤ä»»åŠ¡çš„æ¥å£ã€‚\n\nå…¶ä¸­çš„çº¿ç¨‹å»å–ä»»åŠ¡ï¼Œåšï¼Œç„¶åè¿”å›ä»»åŠ¡ç»“æœã€‚ï¼ˆè¿™æ˜¯çº¿ç¨‹ç±»é‡Œçš„äº‹æƒ…ï¼‰\n\nç®¡ç†çš„çº¿ç¨‹ï¼Œç”¨ vector ç®¡ç†ã€‚\nç®¡ç†çš„ä»»åŠ¡ï¼Œç”¨ queue ç®¡ç†ã€‚ä»»åŠ¡é˜Ÿåˆ—è¦ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚\n\n```cpp\nenum class PoolMode\n{\n    MODE_FIXED,     // å›ºå®šæ•°é‡çš„çº¿ç¨‹\n    MODE_CACHED,    // çº¿ç¨‹æ•°é‡å¯åŠ¨æ€å¢é•¿\n};\nclass ThreadPool\n{\npublic:\n    ThreadPool();\n    ~ThreadPool();\n    /* è®¾ç½®çº¿ç¨‹æ± çš„å·¥ä½œæ¨¡å¼ */\n    void setMode(PoolMode mode);\n    /* è®¾ç½®åˆå§‹çš„çº¿ç¨‹æ•°é‡ */\n    void setInitThreadSize(int size);\n    /* è®¾ç½®taské˜Ÿåˆ—ä»»åŠ¡æ•°é‡æœ€å¤§é˜ˆå€¼ */\n    void setTaskQueMaxThreshHold(int threshHold);\n    /* å¯åŠ¨çº¿ç¨‹æ±  */\n    void start();\n    /* ç»™çº¿ç¨‹æ± æäº¤ä»»åŠ¡ */\n    void submitTask(std::shared_ptr<Task> task);\nprivate:\n    PoolMode m_poolMode;                //å½“å‰çº¿ç¨‹æ± å·¥ä½œæ¨¡å¼\n    std::vector<Thread*> m_threads;     //çº¿ç¨‹åˆ—è¡¨\n    int m_initThreadSize;               //åˆå§‹çš„çº¿ç¨‹æ•°é‡\n    /**\n     * ä»»åŠ¡é˜Ÿåˆ—å®¹å™¨ã€‚\n     * ç‰¹åˆ«è¦æ³¨æ„ï¼Œéœ€è¦ç”¨ shared_ptr å¼ºå¼•ç”¨ç”¨æˆ·ä¼ æ¥çš„ task ï¼Œ\n     * ä»¥ä¿è¯ä»»åŠ¡å¯¹è±¡çš„ç”Ÿå‘½æœŸã€‚\n     */\n    std::queue<std::shared_ptr<Task>> m_taskQueue;\n    /* ç›®å‰ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ•°é‡ */\n    std::atomic_int m_taskNum;\n    /* ä»»åŠ¡é˜Ÿåˆ—æœ€å¤§ä¸Šé™é˜ˆå€¼ */\n    int m_taskQueMaxThreshHold;\n    /* ä¿æŠ¤å®‰å…¨åœ°æ“ä½œä»»åŠ¡é˜Ÿåˆ— */\n    std::mutex m_taskQueMtx;\n    /* è¡¨ç¤ºä»»åŠ¡é˜Ÿåˆ—ä¸æ»¡ */\n    std::condition_variable m_taskQueNotFull;\n    /* è¡¨ç¤ºä»»åŠ¡é˜Ÿåˆ—ä¸ç©º */\n    std::condition_variable m_taskQueNotEmpty;\nprivate:\n    ThreadPool(const ThreadPool &) = delete;\n    ThreadPool& operator=(const ThreadPool &) = delete;\n};\n```\n## ThreadPoolæ„é€ ã€ææ„\n```cpp\n/* çº¿ç¨‹æ± æ„é€  */\nThreadPool::ThreadPool()\n   : m_initThreadSize(4),\n     m_taskNum(0),\n     m_taskQueMaxThreshHold(TASK_MAX_THRESHHOLD),\n     m_poolMode(PoolMode::MODE_FIXED)\n{\n\n}\nThreadPool::~ThreadPool()\n{\n\n}\n```\n## è®¾ç½®å‚æ•°\n```cpp\n/* è®¾ç½®çº¿ç¨‹æ± çš„å·¥ä½œæ¨¡å¼ */\nvoid ThreadPool::setMode(PoolMode mode)\n{\n   m_poolMode = mode;\n}\n/* è®¾ç½®åˆå§‹çš„çº¿ç¨‹æ•°é‡ */\nvoid ThreadPool::setInitThreadSize(int size)\n{\n   m_initThreadSize = size;\n}\n/* è®¾ç½®taské˜Ÿåˆ—ä»»åŠ¡æ•°é‡æœ€å¤§é˜ˆå€¼ */\nvoid ThreadPool::setTaskQueMaxThreshHold(int threshHold)\n{\n   m_taskQueMaxThreshHold = threshHold;\n}\n```\n## å¯åŠ¨çº¿ç¨‹æ± \n```cpp\n/* å¯åŠ¨çº¿ç¨‹æ±  */\nvoid ThreadPool::start(int initThreadSize);\n```\n## ç»™çº¿ç¨‹æ± æäº¤ä»»åŠ¡\n```cpp\n/* ç»™çº¿ç¨‹æ± æäº¤ä»»åŠ¡ */\nvoid ThreadPool::submitTask(std::shared_ptr<Task> task);\n```\n\n# Threadç±»\n## çº¿ç¨‹å‡½æ•°å®šä¹‰åœ¨å“ªä¸ªä½ç½®å‘¢ï¼Ÿ\n* æ€è€ƒï¼šçº¿ç¨‹å‡½æ•°å®šä¹‰åœ¨å“ªä¸ªä½ç½®å‘¢ï¼Ÿ\n    * å¦‚æœå†™åœ¨Threadç±»ä¸­ï¼Œé‚£ä¹ˆå®šä¹‰åœ¨ ThreadPool çš„å˜é‡åˆ™ä¸å®¹æ˜“è¢«å‡½æ•°æ‰€è®¿é—®ã€‚\n    * å®šä¹‰ä¸ºå…¨å±€å‡½æ•°å‘¢ï¼Ÿçº¿ç¨‹æ± é‡Œçš„å˜é‡éƒ½æ˜¯ç§æœ‰çš„ï¼Œä¹Ÿä¸æ˜“è®¿é—®ã€‚\n    * ç»“è®ºï¼šOOPçš„æ‰‹æ³•ï¼Œå†™åœ¨ThreadPoolä¸­ã€‚\n\n```cpp\n/* threadpool.h */\nclass ThreadPool\n{\nprivate:\n  /* å®šä¹‰çº¿ç¨‹å‡½æ•° */\n  void threadFunc();\n};\n```\n## æ€ä¹ˆæŠŠçº¿ç¨‹å‡½æ•°æ‰”ç»™Threadå¯¹è±¡\n* çº¿ç¨‹å¯¹è±¡æ˜¯åœ¨çº¿ç¨‹æ± é‡Œæ„å»ºçš„ï¼Œçº¿ç¨‹å¯åŠ¨æ‰§è¡Œä¹Ÿæ˜¯åœ¨çº¿ç¨‹æ± é‡Œåšçš„ï¼Œ\n* é‚£ä¹ˆåˆ›å»º thread çº¿ç¨‹å¯¹è±¡æ—¶éœ€è¦æŠŠçº¿ç¨‹å‡½æ•°ç»™åˆ° thread çº¿ç¨‹å¯¹è±¡ã€‚æ€ä¹ˆæŠŠå‡½æ•°æ‰”ç»™å¯¹è±¡ï¼Ÿæ€ä¹ˆè§£å†³è¿™ä¸ªæŠ€æœ¯é—®é¢˜ï¼Ÿ\n    * å¼•å…¥`<functional>`ï¼Œç”¨`std::bind()`æŠŠå‡½æ•°å¯¹è±¡ç»‘å®šã€‚åœ¨çº¿ç¨‹æ±  start æ—¶ï¼Œæ„é€  thread æ—¶ä¼ å…¥\n\n```cpp\nvoid ThreadPool::start(int initThreadSize)\n{\n    m_initThreadSize = initThreadSize;\n    for(int i = 0; i < m_initThreadSize; ++i)\n    {\n        m_threads.emplace_back(\n            new Thread(std::bind(&ThreadPool::threadFunc, this))\n        );\n    }\n    for(int i = 0; i < m_initThreadSize; ++i)\n    {\n        m_threads[i]->start();\n    }\n}\n```\n## å¤´æ–‡ä»¶\nç”±ä¸Šè¿° Thread ç±»æ„é€ æ—¶å¯¹å‡½æ•°å¯¹è±¡çš„å¤„ç†ï¼Œå¯ä»¥å¾—åˆ° Thread ç±»çš„å¤§è‡´å±æ€§éœ€æ±‚ã€æ„é€ å‚æ•°ã€‚\n\n```cpp\nclass Thread\n{\npublic:\n    /* çº¿ç¨‹å‡½æ•°å¯¹è±¡ç±»å‹åˆ«å */\n    using ThreadFunc = std::function<void()>;\n    Thread(ThreadFunc func);\n    ~Thread();\n    void start();\nprivate:\n    ThreadFunc m_func;\n};\n```\n## start å‡½æ•°ï¼ˆåˆ›å»ºçº¿ç¨‹åï¼Œåˆ†ç¦»çº¿ç¨‹ï¼‰\n* start å‡½æ•° - å¯åŠ¨çº¿ç¨‹ï¼Œåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹å‡½æ•°\n    * éœ€è¦æ³¨æ„ï¼šå‡ºäº†startå‡½æ•°ä½œç”¨åŸŸä¹‹åçº¿ç¨‹å¯¹è±¡ä¼šææ„ï¼Œä½†æ˜¯çº¿ç¨‹å‡½æ•°ä¸èƒ½æ¶ˆå¤±ï¼Œä»–è¿˜è¦å»æ¶ˆè´¹ä»»åŠ¡é˜Ÿåˆ—ä¸Šçš„ä»»åŠ¡ã€‚**æ‰€ä»¥çº¿ç¨‹å¯¹è±¡éœ€è¦è®¾ç½®ä¸ºåˆ†ç¦»çº¿ç¨‹ï¼Œå¦åˆ™ç¨‹åºä¼šæŒ‚æ‰**ã€‚\n    * åˆ†ç¦»çš„æ•ˆæœå°±æ˜¯ï¼š**çº¿ç¨‹å¯¹è±¡**å’Œå®ƒæ‰€**å¯åŠ¨çš„çº¿ç¨‹ï¼ˆå®è´¨çš„çº¿ç¨‹**ï¼‰åˆ†ç¦»å¼€äº†ã€‚ç‹¬ç«‹å­˜åœ¨ï¼Œäº’ä¸å…³å¿ƒå¯¹æ–¹çš„ç”Ÿå‘½æœŸã€‚\n\n```cpp\n/* threadpool.cpp */\n#include<thread>\n/* å¯åŠ¨çº¿ç¨‹ */\nvoid Thread::start()\n{\n    std::thread t(m_func);\t//çº¿ç¨‹å¯¹è±¡tï¼Œçº¿ç¨‹å‡½æ•°m_func\n    t.detach();\n}\n```\n# ç®€å•æµ‹è¯•\n* ç®€å•æµ‹è¯•ï¼Œé»˜è®¤å¯åŠ¨ 4 ä¸ªçº¿ç¨‹ã€‚å¯åŠ¨ååœ¨ä¸åŒçš„çº¿ç¨‹åˆ†åˆ«æ‰§è¡Œ threadFunc å‡½æ•°ã€‚\n    * æ³¨æ„ï¼šåˆ›å»ºçš„çº¿ç¨‹åˆ†ç¦»ä¹‹åï¼Œæ‰§è¡Œå®Œæ¯•åä¼šè‡ªåŠ¨å›æ”¶ã€‚ä½†æ˜¯å¯èƒ½å­˜åœ¨ä¸»çº¿ç¨‹å¯åŠ¨åçœ‹ä¸åˆ°æ‰“å°ç»“æœçš„æƒ…å†µï¼Œé‚£æ˜¯å› ä¸ºä¸»çº¿ç¨‹ç»“æŸåœ°å¤ªå¿«ï¼Œå¯¼è‡´æ²¡èƒ½çœ‹åˆ°ï¼ˆå®é™…ä¸­çš„æœåŠ¡å™¨ä¸»çº¿ç¨‹ä¸ä¼šå¾ˆå¿«ç»“æŸï¼Œè€Œæ˜¯ä¿æŒï¼‰ã€‚ä¸ºäº†çœ‹åˆ°æ‰§è¡Œç»“æœï¼Œå¯ä»¥ç¡çœ ä¸€æ®µæ—¶é—´ã€‚\n\n```cpp\nvoid ThreadPool::threadFunc()\n{\n  std::cout << \"begin threadFunc tid:\" \n      << std::this_thread::get_id() << std::endl;\n  std::cout << \"end threadFunc\" \n      << std::this_thread::get_id() << std::endl;\n}\n/* çº¿ç¨‹æ± é¡¹ç›®æµ‹è¯•.cpp */\n#include\"threadpool.h\"\n#include<iostream>\n#include<chrono>\n#include<thread>\nint main()\n{\n    ThreadPool pool;\n    pool.start();\n    std::this_thread::sleep_for(std::chrono::seconds(5));\n}\n```\n\n# æ™ºèƒ½æŒ‡é’ˆè§£å†³é¿å…æ‰‹åŠ¨é‡Šæ”¾\n\n```cpp\nvoid ThreadPool::start(int initThreadSize)\n{\n    m_initThreadSize = initThreadSize;\n    for(int i = 0; i < m_initThreadSize; ++i)\n    {\n        auto ptr = std::make_unique<Thread>(\n            std::bind(&ThreadPool::threadFunc, this)\n        );\n        m_threads.emplace_back(ptr);\n    }\n    for(int i = 0; i < m_initThreadSize; ++i)\n    {\n        m_threads[i]->start();\n    }\n}\n```\n\nä½†æ˜¯è¿™æ ·ä¼šå‡ºç°ç¼–è¯‘ä¸è¿‡çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæŠ¥é”™å‘ç°`unique_ptr`çš„æ‹·è´æ„é€ å·²ç»åˆ é™¤ï¼Œè¿™æ˜¯å”¯ä¸€æ€§æ™ºèƒ½æŒ‡é’ˆçš„è¯­ä¹‰å†³å®šçš„ã€‚è€Œç§»åŠ¨æ„é€ æ²¡æœ‰åˆ é™¤ï¼Œæ„å‘³å¯ä»¥ç”¨å³å€¼è¿›è¡Œèµ„æºè½¬ç§»ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨`ptr`å‰åŠ `std::move`ã€‚\n\n```cpp\n        m_threads.emplace_back(std::move(ptr));\n```\n\n# submitTask\n\n```cpp\n/* ç»™çº¿ç¨‹æ± æäº¤ä»»åŠ¡ */\nvoid ThreadPool::submitTask(std::shared_ptr<Task> sp)\n{\n    /* è·å–é” */\n    std::unique_lock<std::mutex> lock(m_taskQueMtx);\n    /* çº¿ç¨‹çš„é€šä¿¡ï¼Œç­‰å¾…ä»»åŠ¡é˜Ÿåˆ—æœ‰ç©ºä½™ */\n    //while(taskQue_.size() == taskQueMaxThreshHold_){ notFull_.wait(); }\n    m_taskQueNotFull.wait(\n        lock,\n        [&]()->bool {\n            return m_taskQueue.size() < m_taskQueMaxThreshHold;\n        }\n    );\n    /* å¦‚æœæœ‰ç©ºä½™ï¼ŒæŠŠä»»åŠ¡æ”¾åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ */\n\tm_taskQueue.emplace(sp);\n    ++m_taskNum;\n    /* å› ä¸ºæ–°æ”¾äº†ä»»åŠ¡ï¼Œä»»åŠ¡é˜Ÿåˆ—è‚¯å®šä¸ç©ºäº†ï¼Œé€šçŸ¥notEmpty_ä¸Šçš„ç­‰å¾…çº¿ç¨‹ */\n    m_taskQueNotEmpty.notify_all();\n}\n```\n\n## æœåŠ¡é™çº§ï¼ˆ`wait_for(time)`ï¼‰\n\nä¸ºäº†æ€§èƒ½æ›´åŠ ä¼˜åŒ–ï¼Œæˆ‘ä»¬é™åˆ¶ç”¨æˆ·æäº¤ä»»åŠ¡çš„æœ€é•¿é˜»å¡æ—¶é—´æ˜¯`1s`ï¼Œå¦‚æœæäº¤ä»»åŠ¡è¶…è¿‡äº† 1s è¯´æ˜ç›®å‰çº¿ç¨‹æ± çš„ä»»åŠ¡é˜Ÿåˆ—å‹åŠ›æ¯”è¾ƒå¤§ï¼Œé˜²æ­¢çŸ­æ—¶é—´å†…ç§¯å‹å¾ˆå¤šä»»åŠ¡ï¼Œåˆ™è§„å®šä¸ºæäº¤ä»»åŠ¡å¤±è´¥ï¼Œè¿”å›ã€‚ç§°ä¸º**æœåŠ¡é™çº§**ã€‚\n\néœ€è¦ç”¨åˆ°`wait`çš„ä¸¤ä¸ªå»¶ä¼¸ï¼Œ`wait_for(time)`ï¼Œ`wait_until(endtime)`ã€‚è¿”å›å€¼ä¸ºboolå€¼ï¼Œ`false`è¡¨ç¤ºåˆ°æ—¶é—´åæ¡ä»¶ä¾ç„¶æ²¡æ»¡è¶³ã€‚\n\nä»¥ä¸‹è¯´çš„æ˜¯ï¼šå¦‚æœç­‰äº†è¶…è¿‡ 1 ç§’ï¼Œè¯´æ˜æ»¡çš„çŠ¶æ€å·²ç»è¶…è¿‡äº† 1 ç§’ï¼Œ`wait_for`è¿”å› `false` ï¼Œ`if` æ¡ä»¶æˆç«‹ï¼Œæäº¤å¤±è´¥ã€‚\n```cpp\n    if(!m_taskQueNotFull.wait_for(\n        lock,\n        std::chrono::seconds(1),\n        [&]()->bool {\n            return taskQue_.size() < (size_t)taskQueMaxThreshHold_;\n        }))\n    {\n        std::cerr<<\"task queue is full, submit out of time failed.\"<<endl;\n        return;\n    }\n```\n# ThreadFunc\n\n```cpp\nvoid ThreadPool::threadFunc()\n{\nfor(;;)\n{\n    std::shared_ptr<Task> task;\n    /* å—ä½œç”¨åŸŸ */\n    {\n        /* å…ˆè·å–é” */\n        std::unique_lock<std::mutex> lock(m_taskQueMtx);\n        std::cout << \"tid:\" << std::this_thread::get_id()\n            << \"å°è¯•è·å–ä»»åŠ¡...\" << std::endl;\n        /* ç­‰å¾…notEmptyæ¡ä»¶ */\n        m_taskQueNotEmpty.wait(\n            lock,\n            [&]()->bool {\n                return m_taskQueue.size() > 0;\n            }\n        );\n        std::cout << \"tid:\" << std::this_thread::get_id()\n            << \"è·å–ä»»åŠ¡æˆåŠŸ...\" << std::endl;\n        /* ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­å–ä¸€ä¸ªä»»åŠ¡å‡ºæ¥ */\n        task = m_taskQueue.front();\n        m_taskQueue.pop();\n        --m_taskNum;\n        /* å¦‚æœæœ‰å‰©ä½™ä»»åŠ¡ï¼Œç»§ç»­é€šçŸ¥å…¶ä»–çº¿ç¨‹æ¥å–ä»»åŠ¡ */\n        if (m_taskQueue.size() > 0)\n        {\n            m_taskQueNotEmpty.notify_all();\n        }\n        /* å–å‡ºäº†ä¸€ä¸ªä»»åŠ¡ï¼Œä»»åŠ¡é˜Ÿåˆ—æ­¤æ—¶è‚¯å®šä¸æ»¡äº†ï¼Œå¯¹ç­‰å¾…æäº¤ä»»åŠ¡çš„äººè¿›è¡Œé€šçŸ¥ */\n        m_taskQueNotFull.notify_one();\n    }\n    /* å½“å‰çº¿ç¨‹è´Ÿè´£æ‰§è¡Œè¿™ä¸ªä»»åŠ¡, æ²¡å¿…è¦æ‹¥æœ‰é”, è„±ç¦»å—ä½œç”¨åŸŸ, é‡Šæ”¾é” */\n    if(task != nullptr)\n        task->run();\n}\n}\n```\n\n# æµ‹è¯•1\n\n```cpp\nclass MyTask : public Task\n{\npublic:\n    void run()\n    {\n        std::cout << \"tid:\" << std::this_thread::get_id()\n            << \"begin!\" << std::endl;\n        \n        std::this_thread::sleep_for(std::chrono::seconds(2));\n        \n    \tstd::cout << \"tid:\" << std::this_thread::get_id()\n            << \"end!\" << std::endl;\n    }\n};\n-------------------------------------------------------------------\ntest example:\n/* ä»¥ä¸‹ä¸ºæäº¤3ä¸ªä»»åŠ¡ï¼Œé¢„ä¼°ç»“æœä¸º3ä¸ªçº¿ç¨‹è·å–ä»»åŠ¡æˆåŠŸï¼Œ1ä¸ªæ²¡æœ‰è·å–åˆ°ï¼Œä¸€ç›´é˜»å¡ */\nint main()\n{\n    ThreadPool pool;\n\tpool.start(4);\n\tpool.submitTask(std::make_shared<MyTask>());\n\tpool.submitTask(std::make_shared<MyTask>());\n\tpool.submitTask(std::make_shared<MyTask>());\n    getchar();\n}\n/* è‹¥4ä¸ªçº¿ç¨‹ï¼Œæäº¤5ä¸ªä»»åŠ¡ï¼Œåˆ™æœ€å…ˆå®Œæˆå¹¶æŠ¢åˆ°é”çš„çº¿ç¨‹èƒ½å†æ¬¡è·å¾—ç¬¬5ä¸ªä»»åŠ¡ */\n/* è‹¥4ä¸ªçº¿ç¨‹ï¼Œæäº¤10ä¸ªä»»åŠ¡ï¼Œå¹¶æŠŠé˜Ÿåˆ—å®¹é‡è®¾ä¸º4ï¼Œåˆ™å¯èƒ½æœ‰2ä¸ªä»»åŠ¡æäº¤å¤±è´¥ */\n```\n\n# çº¿ç¨‹æ‰§è¡Œçš„è¿”å›å€¼ï¼ˆfutureå’Œpackaged_taskçš„å®ç°åŸç†ï¼‰\n\næ¯”å¦‚ï¼Œè®¡ç®—1åˆ°30000çš„å’Œã€‚çº¿ç¨‹1è®¡ç®—1åˆ°10000ï¼Œ2è®¡ç®—10001åˆ°20000ï¼Œ3è®¡ç®—20001åˆ°30000ã€‚\nä¸»çº¿ç¨‹ç»™æ¯ä¸€ä¸ªçº¿ç¨‹åˆ†é…è®¡ç®—çš„åŒºé—´ï¼Œå¹¶ç­‰å¾…ä»–ä»¬ç®—å®Œä¹‹åè¿”å›ç»“æœï¼Œåˆå¹¶æœ€ç»ˆçš„ç»“æœå³å¯ã€‚\nä½†æ˜¯ï¼Œæ€ä¹ˆèƒ½æ‹¿åˆ°çº¿ç¨‹çš„è¿”å›å€¼å‘¢ï¼Ÿ\n\n```cpp\nclass MyTask : public Task\n{\npublic:\n    MyTask(int begin, int end)\n    \t: begin_(begin), end_(end)\n    {\n        \n    }\n    void run()\n    {\n        std::cout << \"tid:\" << std::this_thread::get_id()\n            << \"begin!\" << std::endl;\n        int sum = 0;\n        for(int i = begin_; i <= end_; ++i)\n        {\n            sum += i;\n        }\n        \n    \tstd::cout << \"tid:\" << std::this_thread::get_id()\n            << \"end!\" << std::endl;\n        \n        return sum;\n    }\n};\n```\n\n* é—®é¢˜1ï¼šæ€ä¹ˆè®¾è®¡runå‡½æ•°çš„è¿”å›å€¼ï¼Œå¯ä»¥è¡¨ç¤ºä»»æ„çš„ç±»å‹ï¼Ÿ\n* é—®é¢˜2ï¼šå¦‚ä½•è®¾è®¡è¿™é‡Œçš„Resultæœºåˆ¶ï¼Ÿ\n\n```cpp\nResult res1 = pool.submitTask(std::make_shared<MyTask>(1, 10000));\nResult res2 = pool.submitTask(std::make_shared<MyTask>(10001, 20000));\nResult res3 = pool.submitTask(std::make_shared<MyTask>(20001, 30000));\nres1.get();\nres2.get();\nres3.get();\n```\n\n\n## Anyç±»å‹ - æŒ‰éœ€è¿”å›å…·ä½“ç±»å‹\n\n```cpp\nclass Any\n{\npublic:\n    Any() = default;\n    ~Any() = default;\n    Any(const Any&) = delete;\n    Any& operator=(const Any&) = delete;\n    Any(Any &&) = default;\n    Any& operator=(Any &&) = default;\n    \n    /* è¿™ä¸ªæ„é€ å‡½æ•°å¯ä»¥è®© Any ç±»å‹æ¥æ”¶ä»»æ„å…¶ä»–çš„æ•°æ® */\n    template<typename T>\n    Any(T data) : base_(std::make_unique<Derived<T>>(data))\n    {}\n    /* è¿™ä¸ªæ–¹æ³•èƒ½æŠŠ Any å¯¹è±¡é‡Œé¢å­˜å‚¨çš„ data æ•°æ®æå–å‡ºæ¥ */\n    template<typename T>\n    T cast_()\n    {\n        // base_ æ˜¯å®šä¹‰åœ¨ Any ç±»ä¸­çš„ä¸€ä¸ª std::unique_ptr<Base>\n        // get() å¯ä»¥è·å¾— å…¶å®é™…æŒ‡é’ˆ\n        Derive<T>* pd = dynamic_cast<Derive<T>*>(base_.get());\n        if(pd == nullptr)\n        {\n            throw \"type is unmatch!\";\n        }\n        return pd->data_;\n    }\nprivate:\n    class Base\n    {\n    public:\n        virtual ~Base() = default;\n    };\n    \n    template<typename T>\n    class Derived : public Base\n    {\n    public:\n        Derived(T data) : data_(data)\n        {}\n    private:\n        // å®é™…çš„ data å­˜åœ¨ Derived ç±»ä¸­ã€‚\n        T data_;\n    };\n    \nprivate:\n    /* å®šä¹‰ä¸€ä¸ªåŸºç±»çš„æŒ‡é’ˆ */\n    std::unique_ptr<Base> base_;\n};\nint main()\n{\n    ThreadPool pool;\n    pool.start(4);\n    \n    Result res = pool.submitTask(std::make_shared<MyTask>(1, 10000));\n    int sum = res.get().cast_<int>();\n}\n```\nå¦‚æ­¤ä¸€æ¥ï¼š\nresè°ƒç”¨getï¼Œç­‰å¾… task æ‰§è¡Œå®Œæ¯•ï¼Œ`get()`å°±èƒ½è¿”å›ä¸€ä¸ª`Any`ã€‚è¿™ä¸ª `Any` çš„æ¨¡æ¿å‚æ•°æŒ‡æ˜äº†é‡Œé¢å­˜æ”¾çš„æ•°æ®æ˜¯ `int` å‹ï¼Œ `Any` å¯¹è±¡è°ƒç”¨å…¶ `cast_`ï¼Œ å–å‡ºäº†é‡Œé¢å­˜æ”¾çš„æ•°æ®ã€‚ï¼ˆé€šè¿‡`dynamic_cast<Derive<int>*>`ï¼‰å¦‚æœç±»å‹ä¸åŒ¹é…ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚\n\n## è‡ªå®ç°ä¿¡å·é‡ç±»\n\n```cpp\nclass Semaphore\n{\npublic:\n    Semaphore(int limit = 0)\n        : resLimit_(limit)\n    {\n    }\n    ~Semaphore() = default;\n    /* è·å–ä¸€ä¸ªä¿¡å·é‡èµ„æº */\n    void wait()\n    {\n        std::unique_lock<std::mutex> lock(mtx_);\n        /* ç­‰å¾…ä¿¡å·é‡æœ‰èµ„æºï¼Œæ²¡æœ‰èµ„æºçš„è¯ï¼Œé˜»å¡å½“å‰çº¿ç¨‹ */\n        cond_.wait(lock, [&]()->bool {return resLimit_ > 0;});\n        --resLimit_;\n    }\n    /* å¢åŠ ä¸€ä¸ªä¿¡å·é‡èµ„æº */\n    void post()\n    {\n        std::unique_lock<std::mutex> lock(mtx_);\n        ++resLimit_;\n        cond_.notify_one();\n    }\nprivate:\n    // ä¿¡å·é‡ç›®å‰æ‹¥æœ‰çš„èµ„æºæ•°\n    int resLimit_;\n    std::mutex mtx_;\n    std::condition_variable cond_;\n};\n```\n\n## ï¼ˆâ­ï¼‰Resultè®¾è®¡\nå…ˆåˆ†æä¸€ä¸‹å±€åŠ¿ï¼š\n1. Taské‡Œé¢è‚¯å®šæœ‰ç»“æœ\n2. å¤–éƒ¨æœ‰ä¸€ä¸ªResultè¦æ¥æ”¶ç»“æœ\n3. Taské‡Œé¢çš„ç»“æœæ€ä¹ˆå·§å¦™åœ°è½¬ç§»åˆ°Resultä¸Šé¢ï¼Ÿ\n4. å…¶å®Taskä¸ç”¨ä¸“é—¨æœ‰ä¸€ä¸ªAnyæˆå‘˜å˜é‡ä¿å­˜ã€‚\n5. å¯ä»¥ç›´æ¥åœ¨Taskä¸­ä¿å­˜ä¸€ä¸ªResultæŒ‡é’ˆã€‚\n6. å¤–éƒ¨Resultä¹Ÿç»‘å®šä¸€ä¸ªTaskä½œä¸ºæˆå‘˜å¯¹è±¡ã€‚**ä¸ºäº†è®©Taskå»¶é•¿ç”Ÿå‘½æœŸï¼ŒResultéœ€è¦ç”¨`shared_ptr<Task>`æ„é€ **ã€‚\n7. `Result`æ„é€ å‡½æ•°ä¸­ï¼Œåªéœ€è¦æ‰§è¡Œï¼š`task_->setResult(this);`ï¼Œä¾¿å¯ä»¥ç§»èŠ±æ¥æœ¨ï¼ŒæŠŠTaskæˆå‘˜å˜é‡`result_`æŒ‡å‘å¤–éƒ¨çš„Resultã€‚\n8. è¿™æ ·ï¼ŒTaskå†…éƒ¨ï¼Œrunå®Œä¹‹åï¼Œè¿”å›äº†Anyï¼ŒTaskä¾¿å¯ä»¥ä¸»åŠ¨è°ƒç”¨`result_->setVal(run())`ã€‚æŠŠç»“æœå†™å›å¤–éƒ¨çš„Resultå†…éƒ¨ã€‚\n\nsubmitTaskæ¥å£è¿”å›ç±»å‹éœ€è¦è®©ç”¨æˆ·èƒ½æ¥æ”¶åˆ°çº¿ç¨‹ä»»åŠ¡çš„è¿”å›å€¼ï¼Œå¹¶ä¸”è¦æ±‚å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œæ‰€ä»¥æ”¹ä¸ºResultã€‚ç›¸åº”çš„ï¼Œæˆ‘ä»¬éœ€è¦è®¾è®¡è¿™æ ·çš„Resultç±»å‹ã€‚\n* æ€è€ƒï¼Œreturnæ—¶ç”¨ä¸‹é¢å“ªç§æ–¹å¼ï¼Ÿ\n    * `task->getResult();`è¿˜æ˜¯`Result(task);`ï¼Ÿ\n    * è¦æ‰§è¡Œçš„taskä»é˜Ÿåˆ—ä¸­`taskQue_.pop()`ï¼Œæ¥ç€è°ƒç”¨å®Œæ¯•åTaskå°±ä¼šææ„ï¼ˆæ³¨æ„ï¼ŒsubmitTaskä¼ å…¥çš„æ˜¯shared_ptrï¼Œå¼•ç”¨è®¡æ•°å‡1ï¼Œå¦‚æœæ­¤æ—¶æ²¡æœ‰å…¶ä»–äººå¼•ç”¨è¯¥Taskï¼Œå°†ä¼šææ„ï¼Œé‡Œé¢çš„anyå­˜å‚¨çš„ç»“æœå°±å¤±æ•ˆäº†ï¼‰ï¼Œå³taskç”Ÿå‘½æœŸç°åœ¨åªå­˜åœ¨äº`threadFunc`å‡½æ•°ä¸­ã€‚\n    * å¦‚æœæ˜¯`task->getResult();`\n        * è‹¥taskä¸­çš„Resultæ˜¯ä»¥å€¼å½¢å¼å­˜çš„ï¼Œåˆ™è‚¯å®šä¸è¡Œï¼Œå› ä¸ºtaskææ„ä¹‹åï¼ŒResultä¹Ÿä¼šææ„ã€‚\n        * è‹¥taskä¸­çš„Resultæ˜¯ä»¥æŒ‡é’ˆå½¢å¼å­˜çš„ï¼Œåˆ™å¿…é¡»æŒ‡å®šåˆ°ä¸€ä¸ªå¤–éƒ¨èµ„æºä¿å­˜ã€‚æ¯”å¦‚å­˜åˆ°å †ä¸Šã€‚\n            * å¦‚æœæ˜¯åœ¨å †ä¸Šä¿å­˜ï¼Œè¿˜å¿…é¡»æä¾›ä¸€ä¸ªgetResultæ¥å£ï¼Œè¿”å›Resultçš„æŒ‡é’ˆï¼Œå³`result_`æˆå‘˜å˜é‡ã€‚è¿™æ ·ï¼Œå¯ä»¥åšåˆ°æŠŠResultå®‰å…¨åœ°ä¿å­˜ä¸‹æ¥ã€‚\n    * ä½†æ˜¯ï¼Œå¯ä»¥ä»¥æ›´ä¸ºå·§å¦™çš„æ–¹å¼ï¼`Result(task);`\n        * Resultç»‘å®šäº†è¿™ä¸ªtaskï¼ˆç”¨sharedæ™ºèƒ½æŒ‡é’ˆç®¡ç†ï¼Œè®©taskå¯¹è±¡çš„ç”Ÿå‘½æœŸå»¶è‡³å’ŒResultå¯¹ç­‰ï¼‰ï¼Œåœ¨Resultçš„æ„é€ å‡½æ•°ä¸­ï¼Œè°ƒç”¨`task->setResult(this);`ï¼ï¼ï¼å±…ç„¶å·§å¦™åœ°æŠŠâ€œå¤–éƒ¨èµ„æºåœ°å€â€æŒ‡å‘äº†å¤–éƒ¨å¾…æ¥æ”¶ç»“æœçš„Resultè‡ªå·±ï¼é¿å…äº†å †ä¸Šå»ºç«‹çš„çƒ¦æ¼ã€‚\n\n```cpp\nclass ThreadPool\n{\n/*\t\t\t...\t\t\t*/\npublic:\n    Result submitTask(std::shared_ptr<Task> sp);\n/*\t\t\t...\t\t\t*/\n};\n--------------------------\nResult ThreadPool::submitTask(std::shared_ptr<Task> sp)\n{\n/*\t\t\t...\t\t\t*/\n\tif(...)\n    {\n        ...\n/*\t\tæ€è€ƒï¼Œreturnæ—¶ç”¨ä¸‹é¢å“ªç§æ–¹å¼ï¼Ÿ\t*/\n/*      return task->getResult();\t */\n        // æ­¤æ—¶æ˜¯æäº¤ä»»åŠ¡å¤±è´¥çš„è¿”å›\n        return Result(task);\n    }\n\n/*\t\t\t...\t\t\t*/\n\n/*\tæ€è€ƒï¼Œreturnæ—¶ç”¨ä¸‹é¢å“ªç§æ–¹å¼ï¼Ÿ\t*/\n/*  return task->getResult();\t */\n    // æ­¤æ—¶æ˜¯æäº¤ä»»åŠ¡æˆåŠŸåçš„è¿”å›\n    return Result(task);\n}\n```\n\nç»è¿‡ä¸Šé¢çš„è®¨è®ºï¼ŒResultç±»æˆå‘˜é‡Œéœ€è¦ç»‘å®šä¸€ä¸ªTaskå¯¹è±¡ã€‚å³ä¸‹é¢çš„`task_`ã€‚ä¸‹é¢æ˜¯Resultæˆå‘˜å’Œå…¶æ„é€ ã€‚\n\n```cpp\n/* å®ç°æ¥æ”¶æäº¤åˆ°çº¿ç¨‹æ± çš„taskä»»åŠ¡æ‰§è¡Œå®Œæˆåçš„è¿”å›å€¼ç±»å‹Result */\nclass Result\n{\npublic:\n    Result(std::shared_ptr<Task> task, bool isValid = true);\n    ~Result() = default;\nprivate:\n    /* å­˜å‚¨ä»»åŠ¡çš„è¿”å›å€¼ */\n    Any any_;\n    /* çº¿ç¨‹é€šä¿¡ä¿¡å·é‡ */\n    Semaphore sem_;\n    /* æŒ‡å‘å¯¹åº”è·å–è¿”å›å€¼çš„ä»»åŠ¡å¯¹è±¡ */\n    std::shared_ptr<Task> task_;\n    /* ä»»åŠ¡æ‰§è¡Œæ˜¯å¦æœ‰æ•ˆ/æˆåŠŸ */\n    std::atomic_bool isValid_;\n}\n------------------\n//threadpool.cpp\nResult::Result(std::shared_ptr<Task> task, bool isValid)\n    : isValid_(isValid), task_(task)\n{\n}\n\n```\n### æˆå‘˜å‡½æ•°\n* é—®é¢˜1ï¼šsetValå‡½æ•°ï¼Œè·å–ä»»åŠ¡æ‰§è¡Œå®Œçš„è¿”å›å€¼ï¼Œè®°å½•åœ¨anyæˆå‘˜ã€‚\n* é—®é¢˜2ï¼šgetå‡½æ•°ï¼Œç”¨æˆ·è°ƒç”¨è¿™ä¸ªæ–¹æ³•è·å–taskçš„è¿”å›å€¼ï¼ˆæ²¡æ‰§è¡Œå®Œéœ€è¦é˜»å¡ï¼‰\n\n```cpp\nclass Result\n{\npublic:\n    void setVal(Any any);\n    Any get();\nprivate:\n    Any any_;\n    Semaphore sem_;\n    std::shared_ptr<Task> task_;\n    std::atomic_bool isValid_;\n};\n-------------\n/* \tç”¨æˆ·è°ƒç”¨çš„ */\nAny Result::get()\n{\n    if(!isValid_)\n    {\n        return \"\";\n    }\n    /* é˜»å¡ç”¨æˆ·çš„çº¿ç¨‹ç›´åˆ°taské€šçŸ¥å…¶æ‰§è¡Œå®Œæ¯• */\n    sem_.wait();\n    return std::move(any_);\n}\n/* è°è°ƒç”¨ï¼Ÿç­”æ¡ˆæ˜¯ Task çš„ run ç»“æŸä¹‹åï¼Œé€šè¿‡Result * result_ é—´æ¥è°ƒç”¨æ¬¡å‡½æ•°ï¼Œé€šçŸ¥ get() å”¤é†’æ‹¿ç»“æœ */\nvoid Result::setVal(Any any)\n{\n    /* å­˜å‚¨taskçš„è¿”å›å€¼ */\n    this->any_ = std::move(any);\n    sem_.post();\n}\n```\n## Taskå¢åŠ æ–¹æ³•ï¼ŒæŠŠç»“æœå†™å…¥Result\n\næ€æƒ³ï¼šåœ¨threadFunå‡½æ•°ä¸­ï¼Œä¸ä»…è¦é taskå¯¹è±¡Taskç±»ä¸­çš„runæ–¹æ³•æ‰§è¡Œå…·ä½“å“ªç§ä»»åŠ¡ï¼Œè¿˜è¦æŠŠä»»åŠ¡çš„è¿”å›å€¼ç»™åˆ°resultï¼Œå¯ä»¥ç”¨execæ¥å°è£…ï¼Œexecæ²¡æœ‰å¤šæ€ï¼Œrunæœ‰å¤šæ€ã€‚\n\n```cpp\nvoid Task::exec()\n{\n    if(result_ != nullptr)\n    {\n        // run()ç»“æŸä¹‹åï¼ŒsetValæ‰èƒ½è¢«è°ƒç”¨æˆåŠŸï¼Œæ­¤æ—¶å½±å“åˆ°äº† result_ ä¸­ä¿å­˜çš„ä¿¡å·é‡ +1ï¼Œå› æ­¤ å¤–éƒ¨çš„result.get()ä¸å†é˜»å¡\n\t    result_->setVal(run());\t//å¦‚æ­¤å¯çŸ¥ï¼Œtaskä¸­éœ€è¦å°è£…ä¸€ä¸ªresultå¯¹è±¡ã€‚\n    }\n}\n----------------\nclass Task\n{\npublic:\n    Task();\n    ~Task() = default;\n\tvoid exec();\n    void setResult(Result *res);\n    virtual Any run() = 0;\nprivate:\n/*\tæ²¡å¿…è¦ç”¨sharedæ™ºèƒ½æŒ‡é’ˆï¼Œå¦åˆ™å°±ä¼šå‡ºç°ï¼šResultä¸­æœ‰shared_ptr<Task>ï¼ŒTaskä¸­æœ‰shared_ptr<Result>ã€‚å¾ªç¯å¼•ç”¨ï¼Œæ— æ³•é‡Šæ”¾ï¼*/\n    Result *result_;\t//resultå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸé•¿äºtaskï¼Œä¸æ€•ã€‚\n};\n----------------\nvoid Task::setResult(Result *res)\n{\n    result_ = res;\n}\nTask::Task()\n    : result_(nullptr)\n{       \n}\n----------------\n/* è°è°ƒç”¨setResultï¼Ÿæ­¤ Result ä¸æ˜¯ Result é‡Œçš„ val ï¼Œ è€Œæ˜¯ä¿å­˜ Val çš„ä¸€ä¸ªåœ°æ–¹ï¼Œä¸è¦ææ··äº† */\n// å¤–éƒ¨å¯ä»¥é€šè¿‡ task æ¥ æŒ‡å®š Result è¦ä¿å­˜åˆ°å“ªä¸ªåœ°æ–¹ã€‚\n// æ¯”å¦‚å¯ä»¥ä¼ å…¥ å¤–éƒ¨ Result çš„ this æŒ‡é’ˆï¼›ä¹Ÿå¯ä»¥ new ä¸€ä¸ª Result åœ¨ å †ä¸Šï¼Œset åˆ°å †ä¸Šåœ°å€\n// å¦‚æœ Result ç»‘å®šäº†ä¸€ä¸ª task å°±å¯ä»¥ é€šè¿‡è¿™ä¸ª task è®¾ç½® Result ä¸º è‡ªå·±ï¼ˆthisï¼‰\nResult::Result(std::std::shared_ptr<Task> task, bool isValid)\n\t: isValid_(isValid), task_(task)\n{\n    task_->setResult(this);\n}\n```\n\n## æµ‹è¯•2ï¼ˆMaster - Slaveæ¨¡å‹ï¼‰\n\nMaster - Slaveæ¨¡å‹ï¼ŒMasterçº¿ç¨‹ç”¨æ¥åˆ†è§£ä»»åŠ¡ï¼Œç„¶åç»™å„ä¸ªSlaveçº¿ç¨‹åˆ†é…ä»»åŠ¡ï¼Œç­‰å¾…å„ä¸ªSlaveçº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡ï¼Œè¿”å›ç»“æœã€‚æœ€åMasterçº¿ç¨‹åˆå¹¶å„ä¸ªä»»åŠ¡ç»“æœï¼Œè¾“å‡ºã€‚\n\n```cpp\nclass MyTask : public Task\n{\npublic:\n    MyTask(int begin, int end)\n    \t: begin_(begin), end_(end)\n    {\n    }\n\tAny run()\n    {\n        std::cout << \"tid:\" << std::this_thread::get_id()\n            << \"begin!\" << std::endl;\n        uLong sum = 0;\n        for(uLong i = begin_; i <= end_; ++i)\n            sum += i;\n        std::cout << \"tid:\" << std::this_thread::get_id()\n            << \"end!\" << std::endl;\n        return sum;\n    }\n};\nusing uLong = unsigned long long;\nint main()\n{\n    ThreadPool pool;\n    pool.start(4);\n    Result res1 = pool.submitTask(std::make_shared<MyTask>(1, 100000000));\n    Result res2 = pool.submitTask(std::make_shared<MyTask>(100000001, 200000000));\n    Result res3 = pool.submitTask(std::make_shared<MyTask>(200000001, 300000000));\n    uLong sum1 = res1.get().cast_<uLong>();\n    uLong sum2 = res2.get().cast_<uLong>();\n    uLong sum3 = res3.get().cast_<uLong>();\n    cout << sum1 + sum2 + sum3 << endl;\n}\n```\n\næµ‹è¯•ç»“æœï¼š\n\n![image-20220407095057418](../../images/çº¿ç¨‹æ± 2.0/image-20220407095057418.png)\n\n# cachedæ¨¡å¼çº¿ç¨‹æ± \n\nä¸»è¦çš„ä½¿ç”¨ç‚¹ï¼šsubmitTaskå‡½æ•°ä¸­ï¼Œå¯èƒ½éœ€è¦æ ¹æ®ä»»åŠ¡æ•°é‡å’Œç©ºé—²çº¿ç¨‹çš„æ•°é‡ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦åˆ›å»ºæ–°çš„çº¿ç¨‹ã€‚\n* éœ€è¦å¤„ç†çš„é—®é¢˜\n    * é—®é¢˜1ï¼Œç”¨æˆ·è‡ªå·±å¦‚ä½•è®¾ç½®çº¿ç¨‹æ± çš„å·¥ä½œæ¨¡å¼\n    * é—®é¢˜2ï¼ŒsubmitTaskå‡½æ•°ä¸­ï¼Œæ ¹æ®ä»»åŠ¡æ•°é‡å’Œç©ºé—²çº¿ç¨‹çš„æ•°é‡ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦åˆ›å»ºæ–°çš„çº¿ç¨‹\n    * é—®é¢˜3ï¼ŒthreadFuncå‡½æ•°ä¸­ï¼Œæœ‰å¯èƒ½å·²ç»åˆ›å»ºäº†å¾ˆå¤šçš„çº¿ç¨‹ï¼Œå¦‚æœç©ºé—²æ—¶é—´è¶…è¿‡60sï¼Œéœ€è¦ç»“æŸã€å›æ”¶ã€‚\n\n```cpp\nint main()\n{\n    ThreadPool pool;\n    /* ç”¨æˆ·è‡ªå·±è®¾ç½®çº¿ç¨‹æ± çš„å·¥ä½œæ¨¡å¼ */\n    pool.setMode(PoolMode::MODE_CACHED);\n    /* å¼€å§‹å¯åŠ¨çº¿ç¨‹æ±  */\n    pool.start(4);\n}\n```\n\n## åˆ‡æ¢å·¥ä½œæ¨¡å¼\n\nä¸ºäº†é˜²æ­¢ç”¨æˆ·åœ¨çº¿ç¨‹æ± å¯åŠ¨åå†å»åˆ‡æ¢çº¿ç¨‹æ± çš„å·¥ä½œæ¨¡å¼ï¼Œæˆ‘ä»¬éœ€è¦ç»™çº¿ç¨‹æ± æ·»åŠ ä¸€ä¸ªçŠ¶æ€å˜é‡ï¼Œä»¥æ§åˆ¶ç”¨æˆ·èƒ½å¦å¯¹çº¿ç¨‹æ± çš„å·¥ä½œæ¨¡å¼è¿›è¡Œåˆ‡æ¢ã€‚\n\n```cpp\nclass ThreadPool\n{\npublic:\n/*\t\t\t...\t\t\t*/\nprivate:\n/*\t\t\t...\t\t\t*/\n    /* æ£€æŸ¥poolçš„è¿è¡ŒçŠ¶æ€ */\n    bool checkRunningState() const;\nprivate:\n/*\t\t\t...\t\t\t*/\n    \n    /* è¡¨ç¤ºå½“å‰çº¿ç¨‹æ± çš„å¯åŠ¨ */\n    std::atomic_bool isPoolRunning_;\n};\n-------------------------------------------\nThreadPool::ThreadPool()\n\t: initThreadSize_(0),\n\t  taskSize_(0),\n\t  taskQueMaxThreshHold_(TASK_MAX_THRESHHOLD),\n\t  poolMode_(PoolMode::MODE_FIXED),\n\t  isPoolRunning_(false)\n{\n}\nvoid ThreadPool::start(int initThreadSize)\n{\n    /* è®¾ç½®çº¿ç¨‹æ± çš„çŠ¶æ€ä¸ºè¿è¡Œæ€ */\n    isPoolRunning_ = true;\n    \n/*\t\t\t...\t\t\t*/\n}\nbool ThreadPool::checkRunningState() const\n{\n    return isPoolRunning_;\n}\n------------------------------------------\nvoid ThreadPool::setMode(PoolMode mode)\n{\n    if(checkRunningState())\n        return;\n    poolMode_ = mode;\n}\n```\n\n## åˆ›å»ºæ›´å¤šçº¿ç¨‹\n\ncachedæ¨¡å¼ï¼šä»»åŠ¡å¤„ç†æ¯”è¾ƒç´§æ€¥ï¼Œåœºæ™¯æ˜¯å°è€Œå¿«çš„ä»»åŠ¡ã€‚\n\nThreadPooléœ€è¦æ·»åŠ è®°å½•ä¸€ä¸ªç©ºé—²çº¿ç¨‹æ•°é‡çš„å˜é‡ã€‚\n\n```cpp\nclass ThreadPool\n{\npublic:\n/*\t\t\t...\t\t\t*/\nprivate:\n/*\t\t\t...\t\t\t*/\nprivate:\n/*\t\t\t...\t\t\t*/\n\n    /* è®°å½•ç©ºé—²çº¿ç¨‹çš„æ•°é‡ */\n    std::atomic_int idleThreadSize_;\n}\n-------------------------------------------\nThreadPool::ThreadPool()\n\t: initThreadSize_(0),\n\t  taskSize_(0),\n\t  idleThreadSize_(0),\n\t  taskQueMaxThreshHold_(TASK_MAX_THRESHHOLD),\n\t  poolMode_(PoolMode::MODE_FIXED),\n\t  isPoolRunning_(false)\n{\n}\n/* ç©ºé—²çº¿ç¨‹æ•°é‡éœ€è¦åŠ 1 */\nvoid ThreadPool::start(int initThreadSize)\n{\n/*\t\t\t...\t\t\t*/\n    /* æ¯å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹å°±ç»™idleThreadSize_åŠ 1ï¼Œè¡¨ç¤ºå¤šäº†ä¸€ä¸ªç©ºé—²çº¿ç¨‹ */\n    for(int i = 0; i < initThreadSize_; ++i)\n    {\n        threads_[i]->start();\n        ++idleThreadSize_;\n    }\n}\n/* ç©ºé—²çº¿ç¨‹æ•°é‡éœ€è¦å‡1 */\nvoid ThreadPool::threadFunc()\n{\n    for(;;)\n    {\n    /*\t\t\t...\t\t\t*/\n        std::shared_ptr<Task> task;\n        {\n            notEmpty_.wait(lock, [&]()->bool {return taskQue_.size()>0;});\n            --idleThreadSize_;\n        }\n    /*\t\t\t...\t\t\t*/\n    \tnotFull_.notify_all();\n    }\n    if(task != nullptr) task -> exec();\n    ++idleThreadSize_;\n}\n```\n\nç°åœ¨æ¥å¢åŠ  submitTask å‡½æ•°å¯¹ cached æ¨¡å¼å¤„ç†çš„ç»†èŠ‚ã€‚\næœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼Œå°±æ˜¯å°½ç®¡ä»»åŠ¡éå¸¸å¤šï¼Œä½†æ˜¯æˆ‘ä»¬è¦å¯¹çº¿ç¨‹çš„æ•°é‡è®¾ä¸€å®šçš„ä¸Šé™å€¼ã€‚\nå³éœ€è¦ç»™ ThreadPool ç±»å¢åŠ ä¸€ä¸ªçº¿ç¨‹æ•°é‡é˜ˆå€¼å˜é‡ã€‚\n\nç„¶åä¸ºäº†æ¯”è¾ƒçº¿ç¨‹æ± å½“å‰çº¿ç¨‹çš„æ•°é‡çŠ¶å†µï¼Œä¹Ÿè¦æ·»åŠ ä¸€ä¸ªè®°å½•çº¿ç¨‹æ€»æ•°é‡çš„å˜é‡ã€‚\n\n```cpp\nconst int THREAD_MAX_THRESHHOLD = 10;\nclass ThreadPool\n{\npublic:\n/*\t\t\t...\t\t\t*/\n    /* è®¾ç½®çº¿ç¨‹æ± cachedæ¨¡å¼ä¸‹çš„çº¿ç¨‹é˜ˆå€¼ */\n    void setThreadSizeThreshHold(int threshhold);\n/*\t\t\t...\t\t\t*/\nprivate:\n/*\t\t\t...\t\t\t*/\nprivate:\n/*\t\t\t...\t\t\t*/\n    /* çº¿ç¨‹æ•°é‡ä¸Šé™é˜ˆå€¼ */\n    int threadSizeThreshHold_;\n    /* è®°å½•å½“å‰çº¿ç¨‹æ± é‡Œé¢çº¿ç¨‹çš„æ€»æ•°é‡ */\n    std::atomic_int curThreadSize_;\n/*\t\t\t...\t\t\t*/\n};\nThreadPool::ThreadPool()\n\t: initThreadSize_(0),\n\t  taskSize_(0),\n\t  idleThreadSize_(0),\n\t  curThreadSize_(0),\n\t  taskQueMaxThreshHold_(TASK_MAX_THRESHHOLD),\n\t  threadSizeThreshHold_(THREAD_MAX_THRESHHOLD),\n\t  poolMode_(PoolMode::MODE_FIXED),\n\t  isPoolRunning_(false)\n{\n}\nvoid ThreadPool::start(int initThreadSize)\n{\n/*\t\t\t...\t\t\t*/\n    /* è®°å½•åˆå§‹çº¿ç¨‹ä¸ªæ•° */\n    initThreadSize_ = initThreadSize;\n    curThreadSize_ = initThreadSize;\n    /* åˆ›å»ºçº¿ç¨‹å¯¹è±¡ */\n/*\t\t\t...\t\t\t*/\n    /* å¯åŠ¨æ‰€æœ‰çº¿ç¨‹ */\n/*\t\t\t...\t\t\t*/\n}\nvoid ThreadPool::setThreadSizeThreshHold(int threshhold)\n{\n    if(checkRunningState() || poolMode_==PoolMode::MODE_FIXED)\n        return;\n    threadSizeThreshHold_ = threshhold;\n}\n-------------------------------------------------------\n/* å…³æ³¨ä¸‰ä¸ªçŠ¶æ€ï¼š\n * 1.çº¿ç¨‹æ± çš„å·¥ä½œæ¨¡å¼æ˜¯å¦æ˜¯cachedï¼›\n * 2.ä»»åŠ¡æ•°é‡æ˜¯å¦å·²ç»å¤§äºç©ºé—²çº¿ç¨‹æ•°é‡ï¼›\n * 3.çº¿ç¨‹æ€»æ•°é‡æ˜¯å¦æ²¡æœ‰è¶…è¿‡çº¿ç¨‹æ•°é‡ä¸Šé™ï¼›\n */\nResult ThreadPool::submitTask(std::shared_ptr<Task> sp)\n{\n/*\t\t\t...\t\t\t*/\n    if(poolMode_ == PoolMode::MODE_CACHED\n      && taskSize_ > idleThreadSize_\n      && curThreadSize_ < threadSizeThreshHold_)\n    {\n        /* åˆ›å»ºæ–°çº¿ç¨‹ */\n        auto ptr = std::make_unique<Thread>(std::bind(&ThreadPool::threadFunc, this));\n        threads_.emplace_back(std::move(ptr));\n        threads_[threadId]->start();\t//å¯åŠ¨çº¿ç¨‹\n        /* ä¿®æ”¹çº¿ç¨‹ä¸ªæ•°ç›¸å…³çš„å˜é‡ */\n        ++curThreadSize_;\n        ++idleThreadSize_;\n    }\n    \n    return Result(sp);\n}\n```\n\n## ä»»åŠ¡å¤„ç†å®Œæ¯•ï¼Œå›æ”¶å¤šä½™çº¿ç¨‹\n\nè¶…è¿‡`initThreadSize_`æ•°é‡çš„çº¿ç¨‹è¦è¿›è¡Œå›æ”¶ã€‚\n\n**å½“å‰æ—¶é—´ æ¯” ä¸Šä¸€æ¬¡çº¿ç¨‹æ‰§è¡Œå®Œæ¯•çš„æ—¶é—´** å¤§äº 60s åå›æ”¶ã€‚\n\n> `C++11`ä¸­æä¾›äº†é«˜ç²¾åº¦æ—¶é—´API - `std::chrono::high_resolution_clock().now()`;\n\n```cpp\nconst int THREAD_IDLE_TIME = 60;\t//å•ä½s\nvoid ThreadPool::threadFunc(int threadid)\n{\n    /* ä¸Šä¸€æ¬¡çº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡çš„æ—¶é—´ */\n    auto lastTime = std::chrono::high_resolution_clock().now();\n    for(;;)\n    {\n    \tTask task;\n        {\n            std::unique_lock<std::mutex> lock(taskQueMtx_);\n            std::cout << \"tid: \" << std::this_thread::get_id()\n                << \"å°è¯•è·å–ä»»åŠ¡...\" << std::endl;\n                \n            // cachedæ¨¡å¼ä¸‹ï¼Œæœ‰å¯èƒ½å·²ç»åˆ›å»ºäº†å¾ˆå¤šçš„çº¿ç¨‹ï¼Œä½†æ˜¯ç©ºé—²æ—¶é—´è¶…è¿‡60sï¼Œåº”è¯¥æŠŠå¤šä½™çš„çº¿ç¨‹\n            // ç»“æŸå›æ”¶æ‰ï¼ˆè¶…è¿‡initThreadSize_æ•°é‡çš„çº¿ç¨‹è¦è¿›è¡Œå›æ”¶ï¼‰\n            // å½“å‰æ—¶é—´ - ä¸Šä¸€æ¬¡çº¿ç¨‹æ‰§è¡Œçš„æ—¶é—´ > 60s\n\n            // æ¯ä¸€ç§’ä¸­è¿”å›ä¸€æ¬¡   æ€ä¹ˆåŒºåˆ†ï¼šè¶…æ—¶è¿”å›ï¼Ÿè¿˜æ˜¯æœ‰ä»»åŠ¡å¾…æ‰§è¡Œè¿”å›\n            // é” + åŒé‡åˆ¤æ–­\n            while (taskQueue_.size() == 0)\n            {\n                // çº¿ç¨‹æ± è¦ç»“æŸï¼Œå›æ”¶çº¿ç¨‹èµ„æº\n                if (!isPoolRunning_)\n                {\n                    threads_.erase(threadid);\n                    std::cout << \"threadid: \" << std::this_thread::get_id() << \" exit!\"\n                        << std::endl;\n                    exitCond_.notify_all();\n                    return;\n                }\n                \n                if (poolMode_ == PoolMode::MODE_CACHED)\n                {\n                    //while(taskQue_.size() > 0) // ä¸å†å»åˆ¤æ–­ taskQue_.size() > 0ï¼Œå³ä½¿sizeæ˜¯0ï¼Œä¹Ÿä¸€ç›´ç­‰å¾…60s\n                    //{\n                    \n                    /* è¶…æ—¶ 1s è¿”å› */\n                    if(std::cv_status::timeout ==\n                       notEmpty_.wait_for(lock, std::chrono::seconds(1)))\n                    {\n                        auto now = std::chrono::high_resolution_clock().now(); //è¿”å›çš„æ˜¯time_pointç±»å‹\n                        auto dur = std::chrono::duration_cast<std::chrono::seconds>(now - lastTime);\n                        if(dur.count() >= THREAD_MAX_IDLE_TIME\n                          && curThreadSize_ > initThreadSize_)\n                        {\n                            /* å¼€å§‹å›æ”¶å½“å‰çº¿ç¨‹ */\n                            /* ä¿®æ”¹è®°å½•çº¿ç¨‹æ•°é‡çš„ç›¸å…³å˜é‡ */\n                            /* æŠŠçº¿ç¨‹ä»çº¿ç¨‹åˆ—è¡¨å®¹å™¨ä¸­åˆ é™¤ */\n                            /* é—®é¢˜ï¼šæ€ä¹ˆçŸ¥é“çº¿ç¨‹å‡½æ•°å¯¹åº”çš„æ˜¯çº¿ç¨‹åˆ—è¡¨å®¹å™¨ä¸­çš„å“ªä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ */\n                            /* æˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªæ˜ å°„å…³ç³»æ¥è®°å½•ï¼šthreadid => threadå¯¹è±¡ => åˆ é™¤ */\n                            thread_.erase(threadid);\n                            --curThreadSize_;\n                            --idleThreadSize_;\n                            std::cout << \"threadid: \" << std::this_thread::get_id() << \" exit!\"\n                                << std::endl;\n                            return;\n                        }\n                    } \n                    //} // while(taskQue_.size() > 0) ç»“æŸ\n                } \n                else // poolMode_ != PoolMode::MODE_CACHED\n                {\n                    notEmpty_.wait(lock /* , [&]()->bool { return taskQue_.size() > 0; } */);\n                }\n            } // end while (taskQueue_.size() == 0)\n\n            // æ­¤æ—¶ taskQueue_.size() != 0 è€Œ æˆ‘ä»¬åˆæ‹¿åˆ°äº† ä»»åŠ¡é˜Ÿåˆ—çš„é”ï¼Œå¯ä»¥ç›´æ¥å–èµ°ä»»åŠ¡\n            --idleThreadSize_;\n            std::cout << \"tid: \" << std::this_thread::get_id()\n                << \"è·å–ä»»åŠ¡æˆåŠŸ...\" << std::endl;\n            task = taskQue_.front();\n            taskQue_.pop();\n            --taskSize_;\n\n            if (taskQue_.size() > 0)\n            {\n                notEmpty_.notify_all();\n            }\n\n            notFull_.notify_all();\n        } // end std::unique_lock<std::mutex> lock(taskQueMtx_);\n        if(task != nullptr)\n        {\n            task();\n        }\n        ++idleThreadSize_;\n        /* çº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡åæ›´æ–°lastTime */\n        lastTime = std::chrono::high_resolution_clock().now();\n    }\n}\n```\n\n## é—®é¢˜ï¼šæ€ä¹ˆçŸ¥é“çº¿ç¨‹å‡½æ•°å¯¹åº”çš„æ˜¯çº¿ç¨‹åˆ—è¡¨å®¹å™¨ä¸­çš„å“ªä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ï¼Ÿ\n\næˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªæ˜ å°„å…³ç³»æ¥è®°å½•ï¼š`threadid - threadå¯¹è±¡`\n```cpp\n    std::unordered_map<int, std::unique_ptr<Thread>> threads_;\n```\n\næ‰€ä»¥ï¼ŒThreadå¯¹è±¡éœ€è¦å°è£…ä¸€ä¸ªidå€¼ã€‚\nç„¶åï¼Œåœ¨çº¿ç¨‹å‡½æ•°`threadFunc`ä¼ å…¥`int threadid`å‚æ•°ã€‚\nè¿™æ ·ï¼Œè¯¥ id çš„Threadåœ¨çº¿ç¨‹å‡½æ•°ä¸­è®¡æ—¶è‡ªå·±çš„ç©ºé—²æ—¶é—´ï¼Œè‹¥è¿ç»­ wait äº† 60sï¼ˆæ¯waitä¸€æ¬¡1sè¶…æ—¶è¿”å›ï¼‰ï¼Œè¯´æ˜ä»»åŠ¡è¿‡å°‘ï¼Œç©ºé—²çº¿ç¨‹è¿‡å¤šã€‚\nåªæœ‰çŸ¥é“äº† id å·ï¼Œæ‰èƒ½è®© ThreadPool è®°å½•çš„ çº¿ç¨‹map ç²¾ç¡®åœ°åˆ é™¤ã€‚\n\n```cpp\nclass Thread\n{\npublic:\n    using ThreadFunc = std::function<void()>;\n    Thread(ThreadFunc func);\n    ~Thread();\n    void start();\n    /* å¯åŠ¨çº¿ç¨‹ */\n    int getId() const;\nprivate:\n    ThreadFunc func_;\n    // è¿™æ˜¯å±äº Threadç±» å…±äº«çš„è®¡æ•°å™¨ã€‚è¡¨ç¤ºæ›¾ç»å·²ç”Ÿæˆäº†å¤šå°‘ä¸ªçº¿ç¨‹å¯¹è±¡\n    static int generateId;\n    // å½“å‰Thread å¯¹è±¡çš„ID\n    int threadId_;\n}\n----------------------------------------------\nint Thread::generateId_ = 0;\nThread::Thread(ThreadFunc func)\n\t: func_(func), threadId(++generateId_)\n{\n    \n}\nint Thread::getId() const\n{\n    return threadId_;\n}\n```\n\nç„¶åï¼Œæœ€å¤§çš„å˜åŒ–æ¥äº†ï¼ŒæŠŠåŸå…ˆçš„çº¿ç¨‹åˆ—è¡¨çš„vectorå®¹å™¨å˜æˆäº†unordered\\_mapã€‚\n```cpp\nclass ThreadPool\n{\n// ...\nprivate:\nÂ  Â  std::unordered_map<int, std::unique_ptr<Thread>> threads_; // çº¿ç¨‹åˆ—è¡¨\n// ...\n};\n```\n\nå› æ­¤ï¼Œåœ¨ start å¯åŠ¨çº¿ç¨‹æ± çš„æ“ä½œä¸­ï¼Œç”Ÿæˆçº¿ç¨‹çš„åŠ¨ä½œå°±è¦æœ‰æ‰€å˜åŒ–\n\nè¦é¢„ç•™ä¸€ä¸ªå ä½ç¬¦`_1`ï¼Œè¿™æ˜¯ç»™çº¿ç¨‹å‡½æ•°çš„ä¼ å…¥å‚æ•°çš„ä½ç½®ï¼Œ`threadid`ã€‚\n\n```cpp\n// å¼€å¯çº¿ç¨‹æ± \nvoid ThreadPool::start(int initThreadSize = std::thread::hardware_concurrency())\n{\n    // è®¾ç½®çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€\n    isPoolRunning_ = true;\n\n    // è®°å½•åˆå§‹çº¿ç¨‹ä¸ªæ•°\n    initThreadSize_ = initThreadSize;\n    curThreadSize_ = initThreadSize;\n\n    // åˆ›å»ºçº¿ç¨‹å¯¹è±¡\n    for (int i = 0; i < initThreadSize_; i++)\n    {\n        // åˆ›å»ºthreadçº¿ç¨‹å¯¹è±¡çš„æ—¶å€™ï¼ŒæŠŠçº¿ç¨‹å‡½æ•°ç»™åˆ°threadçº¿ç¨‹å¯¹è±¡\n        auto ptr = std::make_unique<Thread>(std::bind(&ThreadPool::threadFunc, this, std::placeholders::_1));\n        int threadId = ptr->getId();\n        threads_.emplace(threadId, std::move(ptr));\n        // threads_.emplace_back(std::move(ptr));\n    }\n\n    // å¯åŠ¨æ‰€æœ‰çº¿ç¨‹  std::vector<Thread*> threads_;\n    for (int i = 0; i < initThreadSize_; i++)\n    {\n        threads_[i]->start(); // éœ€è¦å»æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹å‡½æ•°\n        idleThreadSize_++;    // è®°å½•åˆå§‹ç©ºé—²çº¿ç¨‹çš„æ•°é‡\n    }\n}\n```\n## æ”¹ä¸ºæ— åºå“ˆå¸Œè¡¨å­˜å‚¨idã€Threadå¯¹è±¡æ˜ å°„å…³ç³»ï¼Œåçš„ä»£ç è°ƒæ•´\n### submitTask\n```cpp\nResult ThreadPool::submitTask(std::shared_ptr<Task> sp)\n{\n/*\t\t\t...\t\t\t*/\n    if(poolMode == PoolMode::MODE_CACHED\n      && taskSize_ > idleThreadSize_\n      && curThreadSize_ < threadSizeThreshHold_)\n    {\n        auto ptr = std::make_unique<Thead>(std::bind(&ThreadPool::threadFunc, this));\n        int threadId = ptr->getId();\n        threads_.emplace(threadId, std::move(ptr));\n        threads_[threadId]->start();\n        /* ä¿®æ”¹çº¿ç¨‹ä¸ªæ•°ç›¸å…³çš„å˜é‡ */\n        ++curThreadSize_;\n        ++idleThreadSize_;\n    }\n    return Result(sp);\n}\n```\n### ThreadPoolçš„`threadFunc(int threadid)`æ¥å£æ·»åŠ intå‚æ•°\n\n```cpp\nclass ThreadPool\n{\npublic:\n    ...\nprivate:\n    /* å®šä¹‰çº¿ç¨‹å‡½æ•°ï¼ŒåŠ äº†ä¸€ä¸ªå‚æ•°threadid */\n    void threadFunc(int threadid);\n    ...\nprivate:\n\t...\n}\n```\n### Threadä¸­`using ThreadFunc`çš„`std::function<void(int)>`\n```cpp\nclass Thread\n{\npublic:\n    /* è¦å’ŒthreadFuncå‡½æ•°å‚æ•°ä¸€è‡´ */\n    using ThreadFunc = std::function<void(int)>;\n}\n```\n### Threadçš„startï¼Œå¤šä¼ å…¥ä¸€ä¸ª`threadId_`\n```cpp\nvoid Thread::Start()\n{\n    std::thread t(func_, threadId_);\n    t.detach();\n}\n```\n## æµ‹è¯•3\n\n```cpp\nclass MyTask : public Task\n{\npublic:\n    MyTask(int begin, int end)\n\t\t: begin_(begin), end_(end)\n    {\n    }\n    Any run()\n    {\n        std::cout << \"tid:\" << std::this_thread::get_id()\n            << \"begin!\" << std::endl;\n        std::this_thread::sleep_for(std::chrono::seconds(3));\n        uLong sum = 0;\n        for(uLong i = begin_; i <= end_; ++i)\n            sum += i;\n        std::cout << \"tid:\" << std::this_thread::get_id()\n            << \"end!\" << std::endl;\n        return sum;\n    }\n};\n---------------------------------------------------------------------------------------\n/* åœ¨submitTaskå‡½æ•°ä¸­ åŠ æ‰“å°çº¿ç¨‹çš„ç›¸å…³ä¿¡æ¯ */\nResult ThreadPool::submitTask(std::shared_ptr<Task> sp)\n{\n/*\t\t\t...\t\t\t*/\n    if(poolMode == PoolMode::MODE_CACHED\n      && taskSize_ > idleThreadSize_\n      && curThreadSize_ < threadSizeThreshHold_)\n    {\n        std::cout << \">>> create new thread ...\" << std::endl;\n        auto ptr = std::make_unique<Thead>(\n            std::bind(&ThreadPool::threadFunc,\n                      this, std::placeholders::_1)\n        );\n        int threadId = ptr->getId();\n        threads_.emplace(threadId, std::move(ptr));\n        threads_[threadId]->start();\t//å¯åŠ¨çº¿ç¨‹\n        /* ä¿®æ”¹çº¿ç¨‹ä¸ªæ•°ç›¸å…³çš„å˜é‡ */\n        ++curThreadSize_;\n        ++idleThreadSize_;\n    }\n    return Result(sp);\n}\n--------------------------------------------------------------------------------------\n/* æš‚æ—¶ä¿®æ”¹è¶…æ—¶æ—¶é—´ï¼Œæ–¹ä¾¿æµ‹è¯•è§‚å¯Ÿ */\nconst int THREAD_MAX_IDLE_TIME = 10;\nvoid ThreadPool::threadFunc()\n{\n\t\t\t\t\t/*\t\t\t...\t\t\t*/\n                    \tif(dur.count() >= THREAD_MAX_IDLE_TIME\n                          && curThreadSize_ > initThreadSize_)\n                        {\n                            ...\n                        }\n\t\t\t\t\t/*\t\t\t...\t\t\t*/\n}\n--------------------------------------------------------------------------------------\n/* é»˜è®¤åˆå§‹å››çº¿ç¨‹ï¼Œå…­ä»»åŠ¡ã€‚\n * æ¯ä¸ªä»»åŠ¡éƒ½è‡³å°‘æ¶ˆè€—3ç§’ï¼Œ\n * å¼€å§‹æ—¶ä¼šæŠŠå››ä¸ªçº¿ç¨‹éƒ½å ä½ï¼Œä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹æ¥å®Œæˆåä¸¤ä¸ªä»»åŠ¡\n * å…¨éƒ¨ä»»åŠ¡å®Œæˆåï¼Œè¶…è¿‡10ç§’åï¼Œä¼šæŠŠå¤šä½™çš„2ä¸ªçº¿ç¨‹å›æ”¶ã€‚\n */\nconst int TASK_MAX_THRESHHOLD = INT32_MAX;\nconst int THREAD_MAX_THRESHHOLD = 10;\nint main()\n{\n    {\n        ThreadPool pool;\n        pool.setMode(PoolMode::MODE_CACHED);\n        pool.start(4);\n        Result res1 = pool.submitTask(std::make_shared<MyTask>(1,100000000));\t\t\t//1\n        Result res2 = pool.submitTask(std::make_shared<MyTask>(100000001,200000000));\t//2\n        Result res3 = pool.submitTask(std::make_shared<MyTask>(200000001,300000000));\t//3\n        pool.submitTask(std::make_shared<MyTask>(200000001,300000000));\t\t\t\t\t//4\n\n        pool.submitTask(std::make_shared<MyTask>(200000001,300000000));\t\t\t\t\t//5\n        pool.submitTask(std::make_shared<MyTask>(200000001,300000000));\t\t\t\t\t//6\n        uLong sum1 = res1.get().cast_<uLong>();\n        uLong sum2 = res2.get().cast_<uLong>();\n        uLong sum3 = res3.get().cast_<uLong>();\n    }\n    getchar();\n}\n```\n\næµ‹è¯•ç»“æœ\n\n![image-20220407172417250](../../images/çº¿ç¨‹æ± 2.0/image-20220407172417250.png)\n\n![image-20220407172451064](../../images/çº¿ç¨‹æ± 2.0/image-20220407172451064.png)\n\n![image-20220407172642102](../../images/çº¿ç¨‹æ± 2.0/image-20220407172642102.png)\n\n## é—®é¢˜ï¼šThreadPoolå¯¹è±¡ææ„ä»¥åï¼Œæ€ä¹ˆæ ·æŠŠçº¿ç¨‹æ± ç›¸å…³çš„çº¿ç¨‹èµ„æºå…¨éƒ¨å›æ”¶\n\nåœ¨ææ„å‡½æ•°ä¸­ï¼Œç”¨æˆ·çº¿ç¨‹éœ€è¦ç­‰å¾…çº¿ç¨‹æ± çº¿ç¨‹ï¼Œè¿™æ˜¯ä¸¤ç±»ä¸åŒçš„çº¿ç¨‹ï¼Œéœ€è¦é€šè¿‡çº¿ç¨‹é—´é€šä¿¡æ¥è¾¾åˆ°ç­‰å¾…å®Œæˆã€‚\n\nçº¿ç¨‹é—´é€šä¿¡å¯ä»¥ç”¨ä¿¡å·é‡ã€æ¡ä»¶å˜é‡ï¼Œéƒ½å¯ä»¥ï¼Œæˆ‘ä»¬åœ¨ThreadPoolç±»ä¸­ä½¿ç”¨ä¸€ä¸ªæ¡ä»¶å˜é‡`exitCond_`ã€‚\n\n```cpp\nclass ThreadPool\n{\npublic:\n    ...\nprivate:\n    ...\nprivate:\n    ...\n    /* ç­‰å¾…çº¿ç¨‹èµ„æºå…¨éƒ¨å›æ”¶ */\n    std::condition_variable exitCond_;\n    ...\n}\n```\n\nåœ¨ææ„å‡½æ•°ä¸­ï¼Œ\n1. ç½®`isPoolRunning_`ä¸ºfalseï¼Œå¦‚æ­¤çº¿ç¨‹å‡½æ•°è¿›å»ä¹‹åå‘ç°çº¿ç¨‹æ± è¦å…³é—­äº†ï¼Œ\n    1. å¦‚æœä»»åŠ¡é˜Ÿåˆ—ä¸º0ï¼Œåˆ™å°±ç›´æ¥é€€å‡ºã€‚\n    2. å¦‚æœä»»åŠ¡é˜Ÿåˆ—ä¸ä¸º0åˆ™å–ä»»åŠ¡ã€‚\n2. `notEmpty_.notify_all();`ï¼Œæœ€åä¸€æ³¢å”¤é†’ï¼Œè®©æ‰€æœ‰çº¿ç¨‹é†’æ¥ï¼Œçœ‹æœ‰æ²¡æœ‰ä»»åŠ¡ï¼Œæ²¡ä»»åŠ¡å°±æ”¶å·¥ã€‚\n3. ThreadPoolå…³æ³¨`exitCond_`ï¼Œè‹¥æœ‰äººé€šçŸ¥äº†ï¼Œåˆ™è¯´æ˜æ˜¯çº¿ç¨‹é™†é™†ç»­ç»­åœ¨é€€å‡ºäº†ï¼Œç›´åˆ°`threads_.size() == 0`ï¼Œè¯´æ˜æ‰€æœ‰çº¿ç¨‹éƒ½é€€å‡ºäº†ã€‚è¿™æ—¶å€™ï¼Œçº¿ç¨‹æ± å°±å¯ä»¥æ”¾å¿ƒææ„äº†ã€‚\n\n```cpp\nThreadPool::~ThreadPool()\n{\n    isPoolRunning_ = false;\n    notEmpty_.notify_all();\n    /* ç­‰å¾…çº¿ç¨‹æ± ä¸­æ‰€æœ‰çš„çº¿ç¨‹è¿”å›ï¼Œæœ‰ä¸¤ç§çŠ¶æ€ï¼šé˜»å¡/æ‰§è¡Œä¸­ */\n    std::unique_lock<std::mutex> lock(taskQueMtx_);\n    exitCond_.wait(lock, [&]()->bool {return threads_.size() == 0;});\n}\n```\n\n# é¡¹ç›®æ¨è¿›æ—¶é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ\n1. å®ç°æ ¸å¿ƒåŠŸèƒ½æ—¶çš„é—®é¢˜ï¼šå¦‚ä½•é€šç”¨åœ°è·å–æäº¤ä»»åŠ¡åçš„è¿”å›å€¼ï¼Œå³Anyï¼ŒResultçš„è®¾è®¡ã€‚\n2. è®¾è®¡çº¿ç¨‹æ± èµ„æºå›æ”¶çš„ï¼Œæ˜¯ä»¥...çš„æ–¹å¼å®ç°çš„ï¼Œæµ‹è¯•æ—¶ï¼Œæœ‰æ—¶ä¼šå‡ºç°æ­»é”çš„ç°è±¡\n## è°ƒè¯•æ–¹æ³•\ngdbè°ƒè¯•ï¼Œattachåˆ°æ­£åœ¨æ­»é”çš„è¿›ç¨‹ï¼ŒæŠŠçº¿ç¨‹æ ˆæ‰“å°å‡ºæ¥ï¼Œåœ¨å“ªä¸€ä¸ªå‡½æ•°çš„å“ªä¸€å¥è¯ä¸åŠ¨äº†ã€‚\n\né—®é¢˜è¦ç´ ï¼š\n1ã€çº¿ç¨‹æ± è¦ç»“æŸï¼Œè¦é‡Šæ”¾æ•´ä¸ªæ± å­çš„èµ„æºäº†ã€‚\n2ã€çº¿ç¨‹æ± çš„æˆå‘˜`isPoolRunning_`çŠ¶æ€ç½®ä¸ºäº†`false`ã€‚\n\nä»¥ä¸Šä¸¤ä¸ªè¦ç´ \n\n1ï¼Œä¸å—çº¿ç¨‹æ± å†…çš„çº¿ç¨‹ç›®å‰çš„çŠ¶æ€è€Œå½±å“ï¼Œçº¿ç¨‹çš„çŠ¶æ€ï¼šåœ¨ç­‰å¾…ä»»åŠ¡ã€åœ¨æ‰§è¡Œä»»åŠ¡ã€‚\n2ï¼Œ`isPoolRunning_`å¿…å°†å½±å“çº¿ç¨‹çš„ä»£ç è·¯å¾„ã€‚\n\n`isPoolRunning_`åœ¨çº¿ç¨‹æ± `start`æ—¶ç½®ä¸º`true`ã€‚\n\næˆ‘ä»¬è®¾è®¡çš„ThreadPoolä¸ç”¨è€ƒè™‘æˆå‘˜çš„ææ„é—®é¢˜ï¼Œæœ€ä¸»è¦çš„ä¸¤ä¸ªæˆå‘˜å®¹å™¨ï¼š\n1ã€æ— åºmapä¸­çš„çº¿ç¨‹å¯¹è±¡æ˜¯`unique_ptr`ç®¡ç†çš„ã€‚\n2ã€queueä¸­çš„ä»»åŠ¡é˜Ÿåˆ—æ˜¯`shared_ptr`ç®¡ç†çš„ã€‚\n3ã€å…¶ä½™çš„å˜é‡éƒ½æ˜¯éæŒ‡é’ˆå˜é‡ã€‚\n\nThreadPoolææ„æ—¶ä»…ä»…åªæ˜¯æŠŠ`isPoolRunning_`ç½®`false`å°±å¯ä»¥äº†å—ï¼Ÿ\nå½“ç„¶ä¸å¯ä»¥ã€‚çº¿ç¨‹æ± è¦ç­‰å¾…çº¿ç¨‹æ± é‡Œé¢æ‰€æœ‰çš„çº¿ç¨‹è¿”å›ã€‚\nç›®å‰çº¿ç¨‹å¯èƒ½åœ¨`threadFunc`å‡½æ•°ä¸­é˜»å¡åœ¨`notEmpty`ä¸Šï¼Œå¦ä¸€ç§æ˜¯æ­£åœ¨æ‰§è¡Œä»»åŠ¡ä¸­ã€‚\n\næ­¤æ—¶å°±éœ€è¦ä¸åŒçº¿ç¨‹çš„é€šä¿¡ã€‚å³ç”¨æˆ·çº¿ç¨‹å’Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚\nç”¨ä¿¡å·é‡ã€æ¡ä»¶å˜é‡éƒ½å¯ä»¥ã€‚\næˆ‘ä»¬ç”¨æ¡ä»¶å˜é‡ã€‚\nåœ¨ThreadPoolä¸­å®šä¹‰ä¸€ä¸ªæˆå‘˜ï¼Œ`std::condition_variable exitCond_;` ç­‰å¾…çº¿ç¨‹èµ„æºå…¨éƒ¨å›æ”¶\n\n```cpp\nThreadPool::~ThreadPool()\n{\n    isPoolRunning_ = false;\n    /* æˆ‘ä»¬æš‚ä¸”åœ¨è¿™ä¸ªä½ç½® å”¤é†’notEmpty_ä¸Šçš„æ‰€æœ‰çº¿ç¨‹ */\t//å®é™…ä¸Šï¼Œæ˜¯ç•™äº†ä¸€ä¸ªå‘\n    notEmpty_.notify_all();\n    \n    std::unique_lock<std::mutex> lock(taskQueMtx_);\n    /* è¡¨æ˜ï¼šè¦ç­‰å¾…åˆ°threads_.size()ç­‰äº0 */\n    exitCond_.wait(lock, [&]()->bool {return threads_.size()==0;});\n}\n```\n\n```cpp\n//å¯èƒ½ä¼šäº§ç”Ÿæ­»é”çš„æƒ…å†µï¼š\nint main()\n{\n    ThreadPool pool;\n    pool.start(4);\n    Result res1 = pool.submitTask(std::make_shared<MyTask>(1,10000000));\n    uLong sum1 = res1.get().cast_<uLong>();\n    cout << sum1 << endl;\n    cout << \"main over!\" << endl;\n}\n/* è¿è¡Œç»“æœ\n * tid: 9624å°è¯•è·å–ä»»åŠ¡..\n * tid: 9624è·å–ä»»åŠ¡æˆåŠŸ...\n * tid:tid: 1664å°è¯•è·å–ä»»åŠ¡...\n * 9624begin!\n * tid: 15228å°è¯•è·å–ä»»åŠ¡...\n * tid:6796å°è¯•è·å–ä»»åŠ¡...\n * tid:9624end!\n * tid:9624å°è¯•è·å–ä»»åŠ¡...5000000050000000\n * main over!\n * \n * threadid:6796 exit!\n * threadid:s1664 exit!\n * threadid:15228 exit!\n *\t\t//å‘ç°ï¼ŒæŠ¢åˆ°ä»»åŠ¡çš„çº¿ç¨‹å›ä¸æ¥äº†ã€‚\n */\n```\n\n## ä»£ç åˆ†æ\n\n```cpp\n/* mainå‡½æ•°æ‰€åœ¨çš„ä¸»çº¿ç¨‹ï¼Œå³ç”¨æˆ·åˆ›å»ºçº¿ç¨‹æ± çš„çº¿ç¨‹ */\nThreadPool::~ThreadPool()\n{\n    isPoolRunning_ = false;\n    notEmpty_.notify_all();\n    std::unique_lock<std::mutex> lock(taskQueMtx_);\n    exitCond_.wait(lock, [&]()->bool {return threads_.size()==0;});\n}\n/* çº¿ç¨‹æ± ä¸­çš„æ¯ä¸ªçº¿ç¨‹çš„çº¿ç¨‹å‡½æ•° */\nvoid ThreadPool::threadFunc(int threadid)\n{\n    auto lastTime = ...;\n    while(isPoolRunning_)\n    {\n        std::shared_ptr<Task> task;\n        {\n            std::unique_lock<std::mutex> lock(taskQueMtx_);\t\t//æŠ¢é”åŠ¨ä½œ\n            std::cout << \"tid: \" << std::this_thread::get_id()\n                << \"å°è¯•è·å–ä»»åŠ¡... \" << std::endl;\n            while(taskQue_.size() == 0)\n            {\n                if(poolMode_ == PoolMode::MODE_CACHED)\n                {\n                    /* timeout==wait_forçš„è¿”å›å€¼ æ„å‘³ç€ç­‰å¾…è¶…æ—¶äº† */\n                    if(std::cv_status::timeout ==\n                       notEmpty_.wait_for(lock, std::chrono::seconds(1)))\n                    {\n                        //å›æ”¶é•¿æ—¶é—´ç©ºé—²çš„çº¿ç¨‹\n                        return;\n                    }\n                    /* å¦åˆ™ï¼Œè¯´æ˜è¢«å”¤é†’äº†ï¼Œæœ‰ä»»åŠ¡äº†ï¼Œä¸”æŠ¢åˆ°é”äº†ï¼Œç»§ç»­å¾€ä¸‹ */\n                }\n                else /* è‹¥ä¸æ˜¯cachedæ¨¡å¼ï¼Œåˆ™æŒ‰éƒ¨å°±ç­è€å®ç­‰å¾… */\n                {\n                    notEmpty_.wait(lock);\n                }\n            }\n\t\t\tif(!isPoolRunning_)\n            {\n                threads_.erase(threadid);\n                std::cout << \"threadid:\" << std::this_thread::get_id()\n                    << \" exit:\" << std::endl;\n                /* æ¯ä¸€ä¸ªçº¿ç¨‹åˆ é™¤åï¼Œéƒ½é€šçŸ¥exitCond_ä¸€ä¸‹ï¼Œå”¤é†’ç”¨æˆ·ä¸»çº¿ç¨‹ */\n                exitCond_.notify_all();\n                return;\n            }\n        }\n        /* è‹¥è¢«å”¤é†’äº†ï¼Œæœ‰ä»»åŠ¡äº†ï¼Œä¸”æŠ¢åˆ°é”äº†ï¼Œè€Œä¸”ç¡®è®¤äº†isPoolRunningï¼Œåˆ™å¯ä»¥å–å¾—ä»»åŠ¡ */\n        --idleThreadSize_;\n        std::cout << \"tid:\" << std::this_thread::get_id()\n            << \"è·å–ä»»åŠ¡æˆåŠŸ...\" << std::endl;\n    }\n}\n```\n\nç¬¬ä¸€ç§æƒ…å†µï¼šçº¿ç¨‹æ˜¯å›ºå®šæ¨¡å¼ï¼Œä»»åŠ¡é˜Ÿåˆ—ç©ºæ—¶ï¼Œç­‰å¾…åœ¨`notEmpty_`ä¸Šã€‚è¿™ç§æƒ…å†µæˆ‘ä»¬ä¸æ€•ï¼Œå› ä¸ºçº¿ç¨‹æ± ææ„å‡½æ•°å·²ç»å†™äº†`notEmpty_.notify_all()`;\n\nç¬¬äºŒç§æƒ…å†µï¼š`task->exec()`ä¸­ï¼Œå³çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ä¸­ã€‚è¿™ç§ä¹Ÿæ²¡äº‹ï¼Œçº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡å†æ¬¡è¿›å…¥whileå¾ªç¯åˆ¤æ–­æ—¶å‘ç°`isPoolRunning_ä¸ºfalse`äº†ï¼Œåˆ™åˆ é™¤çº¿ç¨‹ï¼Œé€€å‡ºã€‚\n\nç¬¬ä¸‰ç§æƒ…å†µæ‰æ˜¯å…³é”®ï¼Œçº¿ç¨‹`task->exec()` æ‰§è¡Œå®Œåè¿›å…¥äº†`while (isPoolRunning_)`å¾ªç¯ï¼Œåˆ°äº†è·å–é”è¯­å¥ä¹‹å‰çš„ä½ç½®ã€‚è¿™æ—¶ï¼Œçº¿ç¨‹æ± å…³é—­äº†ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨RunningçŠ¶æ€åˆ‡æ¢ä¸º`false`ï¼ç°åœ¨ï¼Œçº¿ç¨‹æ± ã€å­çº¿ç¨‹çš„ä¸‹ä¸€ä¸ªåŠ¨ä½œéƒ½æ˜¯å¯¹`taskQueMtx_`è¿›è¡ŒåŠ é”ï¼è€Œæœ€å…³é”®çš„ï¼Œ**å¦‚æœèƒ½å¤Ÿâ€œé˜´å·®é˜³é”™åœ°â€è¿›å…¥ç¬¬äºŒä¸ª`while`å¾ªç¯ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨`notEmpty_`ä¸Šç­‰æ­»**ï¼Œå› ä¸ºæ­¤æ—¶çº¿ç¨‹æ± åœ¨è¯­ä¹‰ä¸Šæ˜¯å·²ç»å…³é—­äº†ï¼Œæ²¡äººå†å»å”¤é†’å®ƒã€‚\n\nç¬¬ä¸‰ç§æƒ…å†µä¸­çš„ç¬¬ä¸€ç§æƒ…å†µï¼šçº¿ç¨‹æ± æŠ¢åˆ°é”ï¼Œåˆåœ¨`exitCond_`ä¸Š`wait`é˜»å¡ï¼Œè€Œå­çº¿ç¨‹è™½ç„¶èƒ½æŠ¢åˆ°é”ï¼Œä½†æ˜¯ä¼šæ­»åœ¨`notEmpty_`ä¸Šã€‚\n\nç¬¬ä¸‰ç§æƒ…å†µä¸­çš„ç¬¬äºŒç§æƒ…å†µï¼šå­çº¿ç¨‹æŠ¢åˆ°é”ï¼Œå¾€ä¸‹æ‰§è¡Œï¼Œåˆ™æ²¡æœ‰ä»»åŠ¡æ—¶ï¼Œåœ¨`notEmpty_`ä¸Šç­‰å¾…ä¼šæ”¾å¼ƒé”ï¼Œé˜»å¡è‡ªå·±ï¼Œçº¿ç¨‹æ± ä¹‹åä¼šæŠ¢åˆ°é”ï¼Œç­‰å¾…çº¿ç¨‹ç»“æŸã€‚**è¿™æ—¶æ²¡æœ‰äººå»å”¤é†’notEmpty\\_ä¸Šçš„å­çº¿ç¨‹äº†ã€‚æ­»é”ã€‚è¿™æ˜¯é—®é¢˜ä¹‹å…³é”®**ã€‚\n\né‚£ä¹ˆï¼Œç¬¬ä¸‰ç§æƒ…å†µæ€ä¹ˆè§£å†³æ­»é”é—®é¢˜å‘¢ï¼Ÿ\n\næˆ‘ä»¬æ³¨æ„åˆ°ï¼Œç¬¬ä¸‰ç§æƒ…å†µä¸­ç¬¬ä¸€ç§æƒ…å†µçš„é—®é¢˜æ˜¯å› ä¸ºçº¿ç¨‹æ± `exitCond_.wait()`åï¼Œè¿›å…¥äº†ç¬¬ä¸€ä¸ª`while`åäº‰æŠ¢`lock`çš„çº¿ç¨‹å¯èƒ½æ‹¿åˆ°é”åï¼Œé¡ºç†æˆç« è¿›å…¥ç¬¬äºŒä¸ª`while`ä¸­ï¼Œè‹¥æ°é€¢æ²¡æœ‰ä»»åŠ¡ï¼Œåˆ™æ­»åœ¨äº†`notEmpty_`ä¸Šã€‚æ‰€ä»¥ä¸ºäº†é˜²æ­¢é”™è¯¯çš„æ—¶æœºè¿›å…¥åˆ°ç¬¬äºŒä¸ª`while`å¾ªç¯ä¸­ï¼Œåœ¨æ¡ä»¶å¤„é¦–å…ˆå†åˆ¤æ–­ä¸€æ¬¡`isPoolRunning_`ã€‚\n\n### 3.1çš„è§£å†³æ–¹æ¡ˆï¼šé”+åŒé‡åˆ¤æ–­\n\n```cpp\nvoid ThreadPool::threadFunc(int threadid)\n{\n    auto lastTime = ...;\n    while(isPoolRunning_)\n    {\n        std::shared_ptr<Task> task;\n        {\n            std::unique_lock<std::mutex> lock(taskQueMtx_);\n            std::cout << ... << std::endl;\n            while(isPoolRunning_ && taskQue_.size()==0)\n            {\n                if(poolMode_ == PoolMode::MODE_CACHED)\n                {\n                    if(std::cv_status::timeout ==\n                       notEmpty_.wait_for(lock, std::chrono::seconds(1)))\n                    {\n                        //...\n                        return;\n                    }\n                }\n                else\n                {\n                    notEmpty_.wait(lock);\n                }\n            }//é€€å‡ºwhileçš„ä¸¤ç§æƒ…å†µï¼š1.!Running, 2.Running && taskQue_.size()!=0\n            if(!isPoolRunning_)\n            {\n\t\t\t\tbreak;\n            }\n            --idleThreadSize_;\n            std::cout << \"è·å–ä»»åŠ¡æˆåŠŸ\" << std::endl;\n            task = taskQue_.front();taskQue_.pop();\n            --taskSize_;\n            notFull_.notify_all();\n        }\n        if(task != nullptr)task->exec();\n        ++idleThreadSize_;\n        lastTime = ...;\n    }\n    threads_.erase(threadid);\n    std::cout << \"çº¿ç¨‹é€€å‡º\" << std::endl;\n    exitCond_.notify_all();\n    return;\n}\n```\n\nå¦‚æ­¤ä¸€æ¥ï¼Œçº¿ç¨‹æ± å…ˆæŠ¢åˆ°é”ï¼Œå†åœ¨`exitCond_`ä¸Š`wait`é˜»å¡é‡Šæ”¾é”åï¼Œå­çº¿ç¨‹å¾—åˆ°é”å‘ä¸‹èµ°åˆ°äº†ç¬¬äºŒä¸ªwhileè¯­å¥ï¼Œç”±äºå†æ¬¡åˆ¤æ–­`isPoolRunning_`ï¼Œè¿™æ—¶å‘ç°æ”¹å˜ä¸º`false`äº†ï¼Œå°±ä¸ä¼šèµ°åˆ°`notEmpty_.wait()`äº†ã€‚ç°æºœæºœå»åšåˆ é™¤åŠ¨ä½œäº†ã€‚\n\n### 3.2çš„è§£å†³æ–¹æ¡ˆï¼šè°ƒæ•´åŠ é”ä½ç½®\n\nè™½ç„¶3.1è§£å†³äº†`isPoolRunning`çŠ¶æ€è„è¯»è¿™ä¸ªæ¼æ´é—®é¢˜ï¼Œä½†æ˜¯ä¾æ—§ä¸èƒ½è§£å†³â€œå­çº¿ç¨‹å…ˆæŠ¢åˆ°é”â€ä»è€Œåœ¨`notEmpty_`ä¸Šç­‰å¾…è¿™ç§æƒ…å†µå‘ç”Ÿã€‚å³ä½¿å­çº¿ç¨‹é‡Šæ”¾äº†é”ï¼Œä½†æ˜¯æ²¡æœ‰äººå†å»å”¤é†’`notEmpty_`ï¼Œå› ä¸ºåŸæ¥çš„è¯­åºæ˜¯å…ˆå”¤é†’ï¼Œå†æŠ¢é”ã€‚æ‰€ä»¥æˆ‘ä»¬è¦è®©ç”¨æˆ·çº¿ç¨‹çš„åŠ é”ã€å”¤é†’æ”¾åœ¨å­çº¿ç¨‹waitä¹‹åï¼Œ**è¦è®©å­çº¿ç¨‹waité‡Šæ”¾äº†é”ä¹‹åï¼Œæ‰è®©ç”¨æˆ·çº¿ç¨‹å”¤é†’`notEmpty_`**ï¼äºæ˜¯ï¼š\n\n```cpp\nThreadPool::~ThreadPool()\n{\n    isPoolRunning_ = false;\n    std::unique_lock<std::mutex> lock(taskQueMtx_);\n    notEmpty_.notify_all();\n    exitCond_.wait(lock, [&]()->bool {return threads_.size()==0;});\n}\n```\n\nè°ƒæ¢äº†ä¸€ä¸‹ç¬¬äºŒã€ç¬¬ä¸‰å¥ï¼Œå³å­çº¿ç¨‹å…ˆæŠ¢åˆ°é”åwaitåœ¨`notEmpty_`ä¸Šåé‡Šæ”¾é”ï¼Œç”¨æˆ·çº¿ç¨‹å†æŠ¢åˆ°é”ä¹‹åæ‰å»`notify_all()`å®ƒï¼Œé‚£ä¹ˆé˜»å¡çš„å­çº¿ç¨‹è¢«å”¤é†’äº†ï¼Œå¾€ä¸‹æ‰§è¡Œï¼Œå‘ç°`isPoolRunning_`å˜ä¸º`false`äº†ï¼Œç°æºœæºœå»åšåˆ é™¤åŠ¨ä½œäº†ã€‚å®Œç¾è§£å†³é—®é¢˜ã€‚\n\n# ç¼–è¯‘ä¸ºåŠ¨æ€åº“\n\n## ç›´æ¥åœ¨å‘½ä»¤è¡Œä½¿ç”¨`g++`ç¼–è¯‘\n\n```bash\ng++ -o libxcg-threadpool.so -fPIC -shared [æºæ–‡ä»¶å¦‚: threadpool.cpp] -std=c++17\n```\n\n## ç”¨cmakeæ„å»ºç¼–è¯‘\n\n### æ ¹ç›®å½•\n\n```cmake\ncmake_minimum_required(VERSION 3.0.0)\nproject(xcg-threadpool)\n#é…ç½®ç¼–è¯‘é€‰é¡¹\nset(CMAKE_CXX_FLAGS ${CMAKE_CXX_FLAGS} -g)\n#é…ç½®æœ€ç»ˆçš„åº“æ–‡ä»¶è¾“å‡ºçš„è·¯å¾„\nset(LIBRARY_OUTPUT_PATH ${PROJECT_SOURCE_DIR}/lib)\n#é…ç½®å¤´æ–‡ä»¶çš„æœç´¢è·¯å¾„\ninclude_directories(${PROJECT_SOURCE_DIR}/include)\n#åŠ è½½å­ç›®å½•\nadd_subdirectory(src)\n```\n\n### srcç›®å½•\n\n```cmake\n#å®šä¹‰äº†SRC_LISTå˜é‡ï¼ŒåŒ…å«äº†è¯¥ç›®å½•ä¸‹æ‰€æœ‰çš„æºæ–‡ä»¶\naux_source_directory(. SRC_LIST)\n#æŒ‡å®šç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶\nadd_library(${PROJECT_NAME} SHARED ${SRC_LIST})\n#æŒ‡å®šå¯æ‰§è¡Œæ–‡ä»¶é“¾æ¥æ—¶ éœ€è¦ä¾èµ–çš„åº“æ–‡ä»¶\ntarget_link_libraries(xcg-threadpool pthread)\n```\n\n# ä½¿ç”¨åŠ¨æ€åº“ç¼–è¯‘å¯æ‰§è¡Œæ–‡ä»¶\n\né¦–å…ˆéœ€è¦æŠŠåŠ¨æ€åº“`libxcg-threadpool.so`ç§»åŠ¨åˆ°`/usr/lib`æˆ–`/usr/local/lib`ï¼›æŠŠåŠ¨æ€åº“å¯¹åº”çš„å¤´æ–‡ä»¶`threadpool.h`ç§»åŠ¨åˆ°`/usr/include`æˆ–`/usr/local/include`ä¸‹ã€‚\n\n```bash\ng++ -o main main.cpp -std=c++17 -lxcg-threadpool -lpthread\n```\n\n# é‡æ„ç®€æ´ç‰ˆçš„çº¿ç¨‹æ± \nè¦å¯¹å¤–æä¾›ä¸€ä¸ªç®€å•æ˜“ç”¨çš„submitTaskæ¥å£ã€‚\nè®©ç”¨æˆ·ç›´æ¥ä¼ ä¸€ä¸ªï¼š`future result = submitTask(func, 1, 2);`\nè€Œä¸ç”¨å†å»ç»§æ‰¿ä¸€ä¸ªæŠ½è±¡çš„Taskäº†ï¼Œç”šè‡³è¿˜å¾—`make_shared<MyTask()>(func, 1, 2);`ï¼Œè¿™æ ·å¤ªç¹çäº†ã€‚\n\nä¸»è¦ç”¨åˆ°çš„æŠ€å·§å°±æ˜¯ï¼šå¯å˜å‚æ¨¡æ¿ï¼Œä¸‡èƒ½å¼•ç”¨ï¼Œå‡½æ•°ç»‘å®šå™¨ï¼Œå®Œç¾è½¬å‘ã€‚\nsubmitTaskçš„è¿”å›ç±»å‹æ— æ³•å†™å‡ºï¼Œéœ€è¦ç”¨åˆ°autoå ä½ï¼Œä¹‹åç”¨decltypeè¿›è¡Œæ¨å¯¼ã€‚\n## ThreadPoolæˆå‘˜å˜é‡\n```cpp\nprivate:\n    std::unordered_map<int, std::unique_ptr<Thread>> threads_;\n    int initThreadSize_;\n    int threadSizeThreshHold_;\n    std::atomic_int curThreadSize_;\n    std::atomic_int idleThreadSize_;\n\n    using Task = std::function<void()>;\n    // æ­¤å¤„ä¹‹å‰çš„ç‰ˆæœ¬æ˜¯æ™ºèƒ½æŒ‡é’ˆç®¡ç†çš„taskï¼Œç›®å‰ä¸éœ€è¦äº†ã€‚\n    // å› ä¸ºæˆ‘ä»¬æŠŠsharedptrå¯¹Taskçš„åŒ…è£…éƒ½åœ¨submitTaskå†…éƒ¨è¿›è¡Œå°è£…äº†ã€‚\n    std::queue<Task> taskQue_;\n\n    std::atomic_int taskSize_;\n    int taskQueMaxThreshHold_;\n\n    std::mutex taskQueMtx_;\n    std::condition_variable notFull_;\n    std::condition_variable notEmpty_;\n    std::condition_variable exitCond_;\n\n    PoolMode poolMode_;\n    std::atomic_bool isPoolRunning_;\n};\n```\n## ä¼˜åŒ–submitTask\nä»¥ä¸‹çš„å…³é”®ç‚¹ï¼šä»»åŠ¡é˜Ÿåˆ—ä¸­å­˜å‚¨çš„ä»»åŠ¡ï¼ˆlambdaï¼‰æ•è·äº†`shared_ptr`ï¼Œå› æ­¤å½“è¿™ä¸ªä»»åŠ¡è¢«æ‰§è¡Œæ—¶ï¼Œå®ƒä»ç„¶æŒæœ‰ä¸€ä¸ª`shared_ptr`ï¼Œè¿™æ ·`packaged_task`å°±ä¸ä¼šåœ¨æ‰§è¡Œå‰è¢«é”€æ¯ã€‚\nå½“ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œè¿™ä¸ªlambdaå°±ä¼šè¢«é”€æ¯ï¼Œé‚£ä¹ˆå®ƒæŒæœ‰çš„`shared_ptr`ä¹Ÿä¼šè¢«é”€æ¯ï¼ˆå¼•ç”¨è®¡æ•°å‡ä¸€ï¼‰ã€‚å¦‚æœè¿™æ—¶æ²¡æœ‰å…¶ä»–`shared_ptr`å¼•ç”¨ï¼ˆæ¯”å¦‚åœ¨`submitTask`å‡½æ•°ä¸­ï¼Œé™¤äº†ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„é‚£ä¸ª`shared_ptr`ï¼Œè¿˜æœ‰`submitTask`å‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡`task`ï¼‰ï¼Œé‚£ä¹ˆ`packaged_task`å°±ä¼šåœ¨ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åè¢«é”€æ¯ã€‚\n\nä½†æ˜¯ï¼Œåœ¨submitTaskå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬è¿”å›äº†ä¸€ä¸ª`future`ï¼Œè¿™ä¸ª`future`æ˜¯ä¸`packaged_task`å…³è”çš„ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ`std::packaged_task`çš„ææ„ä¸ä¼šå½±å“å…¶å…³è”çš„`future`å—ï¼Ÿä¸ä¼šã€‚å› ä¸º`std::future`æ˜¯é€šè¿‡å…±äº«çŠ¶æ€ï¼ˆshared stateï¼‰ä¸`std::packaged_task`å…³è”çš„ï¼Œè¿™ä¸ªå…±äº«çŠ¶æ€ç‹¬ç«‹äº`packaged_task`å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿`packaged_task`å¯¹è±¡é”€æ¯äº†ï¼Œåªè¦å…±äº«çŠ¶æ€è¿˜å­˜åœ¨ï¼ˆå› ä¸º`future`è¿˜æŒæœ‰ï¼‰ï¼Œé‚£ä¹ˆ`future`ä»ç„¶å¯ä»¥æ­£å¸¸å·¥ä½œã€‚æ‰€ä»¥ï¼Œ`packaged_task`å¯¹è±¡é”€æ¯åï¼Œ`future`çš„`get()`ä»ç„¶å¯ä»¥æ­£å¸¸è¿”å›ç»“æœï¼ˆæˆ–è€…å¼‚å¸¸ï¼‰ã€‚\n\næˆ‘ä»¬è¦æ˜ç¡®çš„ï¼š\nfutureåªæ˜¯è´Ÿè´£æŒæœ‰ç»“æœã€‚ä½†\n**future ä¸ä¼šå»¶é•¿ task çš„ç”Ÿå‘½å‘¨æœŸâ€‹**â€‹ï¼Œ\n- `std::future`Â åªç®¡ç†â€‹**â€‹å…±äº«çŠ¶æ€â€‹**â€‹ï¼ˆshared stateï¼‰çš„ç”Ÿå‘½å‘¨æœŸï¼ˆå­˜å‚¨ç»“æœçš„å†…å­˜åŒºåŸŸï¼‰\n- â€‹**â€‹ä¸ä¼šâ€‹**â€‹å»¶é•¿å…³è”çš„Â `packaged_task`Â å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ\n- `future`Â åªä¾èµ–å…±äº«çŠ¶æ€ï¼Œä¸ä¾èµ–Â `packaged_task`Â å¯¹è±¡æœ¬èº«ã€‚å³å…±äº«çŠ¶æ€çš„ç”Ÿå‘½å‘¨æœŸç‹¬ç«‹äºÂ `packaged_task`\n    - ç”±æœ€åä¸€ä¸ªå¼•ç”¨å®ƒçš„Â `future`Â æˆ–Â `shared_future`Â ç®¡ç†\n    - ä¸Â `packaged_task`Â å¯¹è±¡çš„é”€æ¯æ— å…³\n\n```mermaid\nclassDiagram\n    class PackagedTask {\n        +operator()()\n        +get_future()\n        -shared_state* \n    }\n    \n    class SharedState {\n        +result\n        +ready_flag\n    }\n    \n    class Future {\n        +shared_state*\n    }\n    \n    PackagedTask --> SharedState : ç‹¬å æ‹¥æœ‰\n    Future --> SharedState : åªè¯»å¼•ç”¨\n```\nå…³é”®ç‚¹ï¼š\n1. `packaged_task`Â â€‹**â€‹ç‹¬å æ‹¥æœ‰â€‹**â€‹å…±äº«çŠ¶æ€çš„ç”Ÿå‘½å‘¨æœŸ\n2. `future`Â â€‹**â€‹åªæŒæœ‰å¯¹å…±äº«çŠ¶æ€çš„å¼±å¼•ç”¨â€‹**â€‹\n3. ç§»åŠ¨ã€é”€æ¯Â `packaged_task`Â ä¼šâ€‹**â€‹è½¬ç§»å…±äº«çŠ¶æ€çš„æ‰€æœ‰æƒâ€‹**ã€‚ä½†æ˜¯ä¸ä¼šé”€æ¯SharedStateï¼Œå› ä¸ºå¤–éƒ¨è¿˜æœ‰Futureåœ¨è§‚å¯Ÿã€‚\n    1. å› æ­¤ï¼Œå…¶å®ä¹Ÿå¯ä»¥åœ¨ä¹‹å‰å°±ä¿å­˜ä¸‹æ¥taskçš„futureï¼Œç„¶åå†å»æŠŠtaskè½¬ç§»ç»™ä»»åŠ¡é˜Ÿåˆ—ã€‚è¿™æ ·æ— æ‰€è°“taskæ˜¯å¦åœ¨å¤–éƒ¨è·å¾—ç»“æœä¹‹å‰é”€æ¯äº†ã€‚\n        1. ä½†æ˜¯è¿™æ ·ä¼šé™åˆ¶taskåœ¨ç§»åŠ¨ä¹‹åçš„æ“ä½œï¼Œæ— æ³•åœ¨ç§»åŠ¨ä¹‹åè·å¾—futureäº†ã€‚\n\n\nå…³é”®ç‚¹ï¼š\n1. â€‹**â€‹å…±äº«æ‰€æœ‰æƒâ€‹**â€‹ï¼š\n    - ä»»åŠ¡é˜Ÿåˆ—å’Œå·¥ä½œçº¿ç¨‹å…±åŒæŒæœ‰Â `shared_ptr`ã€‚\n        - ï¼ˆâ­ï¼‰å½“ lambda è¢«æ”¾å…¥é˜Ÿåˆ—æ—¶ï¼Œ`shared_ptr`Â çš„å¼•ç”¨è®¡æ•°å¢åŠ \n    - æœ€åä¸€ä¸ªæŒæœ‰è€…é‡Šæ”¾æ—¶Â `packaged_task`Â æ‰ä¼šé”€æ¯\n        - å½“é˜Ÿåˆ—ä¸­çš„ lambda è¢«é”€æ¯æ—¶ï¼Œ`shared_ptr`Â å¼•ç”¨è®¡æ•°å‡å°‘\n2. â€‹**â€‹ç”Ÿå‘½å‘¨æœŸå®‰å…¨â€‹**â€‹ï¼š\n    - å³ä½¿Â `submitTask`Â è¿”å›ï¼Œåªè¦é˜Ÿåˆ—æˆ–çº¿ç¨‹æŒæœ‰Â `shared_ptr`\n    - `packaged_task`Â å¯¹è±¡ä¼šä¸€ç›´å­˜æ´»åˆ°ä»»åŠ¡æ‰§è¡Œå®Œæˆ\n\n```cpp\ntemplate<typename Func, typename... Args>\nauto submitTask(Func&& func, Args&&... args) -> std::future<decltype(func(args...))>\n{\n    using RType = decltype(func(args...));\n    auto task = std::make_shared<std::packaged_task<RType()>>(\n        std::bind(std::forward<Func>(func), std::forward<Args>(args)...));\n    std::future<RType> result = task->get_future();\n\n    std::unique_lock<std::mutex> lock(taskQueMtx_);\n    if (!notFull_.wait_for(lock, std::chrono::seconds(1),\n        [&]() -> bool { return taskQue_.size() < taskQueMaxThreshHold_; }))\n    {\n        std::cerr << \"task queue is full, submit task failed.\" << std::endl;\n        // è¿™é‡Œï¼Œç”¨ lambda è¡¨è¾¾å¼ å……å½“ çº¿ç¨‹å‡½æ•° funcï¼Œå‡½æ•°ä¸­åªè¿”å›ä¸€ä¸ªç©ºRType()\n        // RType()å³ä¸€ä¸ªé»˜è®¤æ„é€ çš„Â future\n        // ä½†æ˜¯å¯èƒ½ä¼šå‡ºç°ä¸¤ä¸ªé—®é¢˜ï¼š\n        // 1. RTypeÂ æ²¡æœ‰é»˜è®¤æ„é€ å‡½æ•°ï¼ˆå¦‚Â std::atomicï¼‰ï¼Œ\n        // 2. è¯­ä¹‰ä¸å‡†ç¡®ï¼Œåº”è¯¥æ˜¾å¼æŒ‡å‡º æäº¤å¤±è´¥çš„åŸå› \n        // auto task = std::make_shared<std::packaged_task<RType()>>(\n        //     []() -> RType { return RType(); });\n        // task();\n        // return task->get_future();\n        \n        // æ”¹è¿›æ–¹æ¡ˆä¸€ï¼š\n        // return std::async(std::launch::deferred, \n        //     [] { throw std::runtime_error(\"Task queue full\"); }).share().get_future();\n        // æ”¹è¿›æ–¹æ¡ˆäºŒï¼š\n        std::promise<RType> p;\n        p.set_exception(std::make_exception_ptr(std::runtime_error(\"Task queue full\")));\n        return p.get_future();\n    }\n    \n    // å…³é”®ï¼štaskè¿™ä¸ªshared_ptrï¼Œç”±è¿™ä¸ªlambdaè¡¨è¾¾å¼æ•è·äº†ï¼Œä¹‹åè¿™ä¸ªtaskçš„ç”Ÿå‘½å‘¨æœŸå°±å’Œä»»åŠ¡é˜Ÿåˆ—ä¸€è‡´äº†ã€‚\n    taskQue_.emplace([task]() { (*task)(); });\n    ++taskSize_;\n\n    notEmpty_.notify_all();\n\n    if (poolMode_ == PoolMode::MODE_CACHED\n        && taskSize_ > idleThreadSize_\n        && curThreadSize_ < threadSizeThreshHold_)\n    {\n        std::cout << \">>> create new thread...\" << std::endl;\n        // åˆ›å»ºæ–°çš„çº¿ç¨‹å¯¹è±¡\n        auto ptr = std::make_unique<Thread(std::bind(&ThreadPool::threadFunc, this, std::placeholder::_1));\n        int threadId = ptr->getId();\n        threads_.emplace(threadId, std::move(ptr));\n        threads_[threadId]->start();\n        ++curThreadSize_;\n        ++idleThreadSize_;\n    }\n    return result;\n}\n```\n## å†æ¬¡ä¼˜åŒ–submitTask\n- `future`Â åªä¾èµ–å…±äº«çŠ¶æ€ï¼Œä¸ä¾èµ–Â `packaged_task`Â å¯¹è±¡æœ¬èº«ã€‚å³å…±äº«çŠ¶æ€çš„ç”Ÿå‘½å‘¨æœŸç‹¬ç«‹äºÂ `packaged_task`\n    - ç”±æœ€åä¸€ä¸ªå¼•ç”¨å®ƒçš„Â `future`Â æˆ–Â `shared_future`Â ç®¡ç†\n    - ä¸Â `packaged_task`Â å¯¹è±¡çš„é”€æ¯æ— å…³\n```mermaid\nclassDiagram\n    class PackagedTask {\n        +operator()()\n        +get_future()\n        -shared_state* \n    }\n    \n    class SharedState {\n        +result\n        +ready_flag\n    }\n    \n    class Future {\n        +shared_state*\n    }\n    \n    PackagedTask --> SharedState : ç‹¬å æ‹¥æœ‰\n    Future --> SharedState : åªè¯»å¼•ç”¨\n```\nå…³é”®ç‚¹ï¼š\n1. `packaged_task`Â â€‹**â€‹ç‹¬å æ‹¥æœ‰â€‹**â€‹å…±äº«çŠ¶æ€çš„ç”Ÿå‘½å‘¨æœŸ\n2. `future`Â â€‹**â€‹åªæŒæœ‰å¯¹å…±äº«çŠ¶æ€çš„å¼±å¼•ç”¨â€‹**â€‹\n3. ç§»åŠ¨ã€é”€æ¯Â `packaged_task`Â ä¼šâ€‹**â€‹è½¬ç§»å…±äº«çŠ¶æ€çš„æ‰€æœ‰æƒâ€‹**ã€‚ä½†æ˜¯ä¸ä¼šé”€æ¯SharedStateï¼Œå› ä¸ºå¤–éƒ¨è¿˜æœ‰Futureåœ¨è§‚å¯Ÿã€‚\n    1. å› æ­¤ï¼Œå…¶å®ä¹Ÿå¯ä»¥åœ¨ä¹‹å‰å°±ä¿å­˜ä¸‹æ¥taskçš„futureï¼Œç„¶åå†å»æŠŠtaskè½¬ç§»ç»™ä»»åŠ¡é˜Ÿåˆ—ã€‚è¿™æ ·æ— æ‰€è°“taskæ˜¯å¦åœ¨å¤–éƒ¨è·å¾—ç»“æœä¹‹å‰é”€æ¯äº†ã€‚\n        1. ç§»åŠ¨taskçš„ç¼ºç‚¹ï¼šä½†æ˜¯è¿™æ ·ä¼šé™åˆ¶taskåœ¨ç§»åŠ¨ä¹‹åçš„æ“ä½œï¼Œæ— æ³•åœ¨ç§»åŠ¨ä¹‹åè·å¾—futureäº†ã€‚\n\nä¼˜åŒ–ç‚¹ï¼š\n1. å®Œç¾è½¬å‘æ•è·ï¼ˆC++20ï¼‰ä»£æ›¿Â `std::bind`ï¼Œæ›´é«˜æ•ˆä¸”é¿å…é¢å¤–å¼€é”€\n2. ç§»åŠ¨taskåˆ°lambdaä¸­ï¼Œè€Œä¸æ˜¯å»ºç«‹`shared_ptr`æ¥ç®¡ç†å®ƒã€‚æ¯”`shared_ptr`ç‰ˆæœ¬æ›´è½»é‡é«˜æ•ˆï¼ˆå‡å°‘ä¸€æ¬¡å †åˆ†é…ï¼‰ã€‚\næ³¨æ„ç‚¹ï¼š\nä¸ºä»€ä¹ˆéœ€è¦mutableï¼Ÿ\n\nå› ä¸º`packaged_task`çš„`operator()`è°ƒç”¨ä¼šæ”¹å˜`packaged_task`å¯¹è±¡ï¼ˆå®ƒå†…éƒ¨ä¼šæ‰§è¡Œä»»åŠ¡å¹¶å°†ç»“æœå­˜å‚¨åˆ°å…±äº«çŠ¶æ€ï¼Œæ‰€ä»¥ä¼šæ”¹å˜`packaged_task`çš„çŠ¶æ€ï¼‰ï¼Œå› æ­¤`lambda`çš„è°ƒç”¨è¿ç®—ç¬¦å¿…é¡»å£°æ˜ä¸º`mutable`ï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šè®¤ä¸ºä½ åœ¨ä¸€ä¸ª`const`çš„`lambda`ä¸­è¯•å›¾ä¿®æ”¹æ•è·çš„å¯¹è±¡ã€‚\næ‰€ä»¥ï¼Œè¿™é‡Œmutableæ˜¯å¿…é¡»çš„ã€‚\n\nåœ¨å®Œç¾è½¬å‘æ•è·å¯å˜å‚æ—¶ï¼Œä¸ºä»€ä¹ˆä¹Ÿéœ€è¦åŠ mutableï¼Ÿ\næˆ‘ä»¬é€šè¿‡å®Œç¾è½¬å‘æ•è·äº†`func`å’Œ`args`ã€‚åœ¨lambdaä½“å†…ï¼Œæˆ‘ä»¬è°ƒç”¨äº†`func`ï¼Œå¹¶ä½¿ç”¨äº†`std::forward<Args>(args)...`æ¥è½¬å‘å‚æ•°ã€‚ç”±äº**è½¬å‘å¯èƒ½æ„å‘³ç€ç§»åŠ¨ï¼ˆå½“å‚æ•°æ˜¯å³å€¼æ—¶ï¼‰ï¼Œè¿™ä¼šä¿®æ”¹æ•è·çš„`args`**ï¼ˆç§»åŠ¨åï¼Œå¯¹è±¡çš„çŠ¶æ€è¢«æ”¹å˜ï¼Œé€šå¸¸ä¸ºç©ºæˆ–æœ‰æ•ˆçŠ¶æ€è¢«è½¬ç§»ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦`mutable`æ¥å…è®¸å¯¹æ•è·çš„å˜é‡è¿›è¡Œä¿®æ”¹ï¼ˆåŒ…æ‹¬ç§»åŠ¨æ“ä½œï¼‰ã€‚\n\n```cpp\ntemplate<typename Func, typename... Args>\nauto submitTask(Func&& func, Args&&... args) -> std::future<decltype(func(args...))>\n{\n    using RType = decltype(func(args...));\n    \n    // 1. åˆ›å»ºä»»åŠ¡å’Œfuture\n    auto task = std::packaged_task<RType()>(\n        [func = std::forward<Func>(func), ...args = std::forward<Args>(args)] () mutable \n        {\n             return func(std::forward<Args>(args)...);\n        }); // âœ… å®Œç¾è½¬å‘æ•è·(C++20)\n    \n    std::future<RType> result = task.get_future();\n\n    // 2. é”ä¿æŠ¤é˜Ÿåˆ—æ“ä½œ\n    std::unique_lock<std::mutex> lock(taskQueMtx_);\n    \n    // 3. æ£€æŸ¥é˜Ÿåˆ—å®¹é‡\n    if (!notFull_.wait_for(lock, 1s, \n        [&] { return taskQue_.size() < taskQueMaxThreshHold_; }))\n    {\n        // ä¼˜é›…çš„é”™è¯¯å¤„ç†\n        std::promise<RType> p;\n        p.set_exception(\n            std::make_exception_ptr(std::runtime_error(\"Task queue full\")));\n        return p.get_future(); // â±ï¸ ç«‹å³å°±ç»ªçš„å¼‚å¸¸future\n    }\n    \n    // 4. æäº¤ä»»åŠ¡åˆ°é˜Ÿåˆ—\n    taskQue_.emplace([task = std::move(task)]() mutable {\n        task(); // âœ… æ‰§è¡Œç§»åŠ¨åçš„ä»»åŠ¡\n    });\n    ++taskSize_;\n    \n    // 5. é€šçŸ¥å·¥ä½œçº¿ç¨‹\n    notEmpty_.notify_all();\n    \n    // 6. åŠ¨æ€æ‰©ç¼©å®¹é€»è¾‘ (CACHEDæ¨¡å¼)\n    if (poolMode_ == PoolMode::MODE_CACHED && \n        taskSize_ > idleThreadSize_ &&\n        curThreadSize_ < threadSizeThreshHold_)\n    {\n        // ... åˆ›å»ºæ–°çº¿ç¨‹ (çœç•¥ç»†èŠ‚)\n    }\n    \n    return result; // ğŸ¯ è¿”å›æœ‰æ•ˆçš„future\n}\n```\n## threadFuncçš„é‡æ„\n```cpp\nconst int THREAD_IDLE_TIME = 60;\t//å•ä½s\nvoid ThreadPool::threadFunc(int threadid)\n{\n    /* ä¸Šä¸€æ¬¡çº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡çš„æ—¶é—´ */\n    auto lastTime = std::chrono::high_resolution_clock().now();\n    for(;;)\n    {\n        // æ­¤å¤„ä¹‹å‰çš„ç‰ˆæœ¬æ˜¯æ™ºèƒ½æŒ‡é’ˆç®¡ç†çš„taskï¼Œç›®å‰ä¸éœ€è¦äº†ã€‚\n        // å› ä¸ºæˆ‘ä»¬æŠŠsharedptrå¯¹Taskçš„åŒ…è£…éƒ½åœ¨submitTaskå†…éƒ¨è¿›è¡Œå°è£…äº†ã€‚\n    \tTask task;\n        {\n            std::unique_lock<std::mutex> lock(taskQueMtx_);\n            std::cout << \"tid: \" << std::this_thread::get_id()\n                << \"å°è¯•è·å–ä»»åŠ¡...\" << std::endl;\n                \n            // cachedæ¨¡å¼ä¸‹ï¼Œæœ‰å¯èƒ½å·²ç»åˆ›å»ºäº†å¾ˆå¤šçš„çº¿ç¨‹ï¼Œä½†æ˜¯ç©ºé—²æ—¶é—´è¶…è¿‡60sï¼Œåº”è¯¥æŠŠå¤šä½™çš„çº¿ç¨‹\n            // ç»“æŸå›æ”¶æ‰ï¼ˆè¶…è¿‡initThreadSize_æ•°é‡çš„çº¿ç¨‹è¦è¿›è¡Œå›æ”¶ï¼‰\n            // å½“å‰æ—¶é—´ - ä¸Šä¸€æ¬¡çº¿ç¨‹æ‰§è¡Œçš„æ—¶é—´ > 60s\n\n            // æ¯ä¸€ç§’ä¸­è¿”å›ä¸€æ¬¡   æ€ä¹ˆåŒºåˆ†ï¼šè¶…æ—¶è¿”å›ï¼Ÿè¿˜æ˜¯æœ‰ä»»åŠ¡å¾…æ‰§è¡Œè¿”å›\n            // é” + åŒé‡åˆ¤æ–­\n            while (taskQueue_.size() == 0)\n            {\n                // çº¿ç¨‹æ± è¦ç»“æŸï¼Œå›æ”¶çº¿ç¨‹èµ„æº\n                if (!isPoolRunning_)\n                {\n                    threads_.erase(threadid);\n                    std::cout << \"threadid: \" << std::this_thread::get_id() << \" exit!\"\n                        << std::endl;\n                    exitCond_.notify_all();\n                    return;\n                }\n                \n                if (poolMode_ == PoolMode::MODE_CACHED)\n                {\n                    //while(taskQue_.size() > 0) // ä¸å†å»åˆ¤æ–­ taskQue_.size() > 0ï¼Œå³ä½¿sizeæ˜¯0ï¼Œä¹Ÿä¸€ç›´ç­‰å¾…60s\n                    //{\n                    \n                    /* è¶…æ—¶ 1s è¿”å› */\n                    if(std::cv_status::timeout ==\n                       notEmpty_.wait_for(lock, std::chrono::seconds(1)))\n                    {\n                        auto now = std::chrono::high_resolution_clock().now(); //è¿”å›çš„æ˜¯time_pointç±»å‹\n                        auto dur = std::chrono::duration_cast<std::chrono::seconds>(now - lastTime);\n                        if(dur.count() >= THREAD_MAX_IDLE_TIME\n                          && curThreadSize_ > initThreadSize_)\n                        {\n                            /* å¼€å§‹å›æ”¶å½“å‰çº¿ç¨‹ */\n                            /* ä¿®æ”¹è®°å½•çº¿ç¨‹æ•°é‡çš„ç›¸å…³å˜é‡ */\n                            /* æŠŠçº¿ç¨‹ä»çº¿ç¨‹åˆ—è¡¨å®¹å™¨ä¸­åˆ é™¤ */\n                            /* é—®é¢˜ï¼šæ€ä¹ˆçŸ¥é“çº¿ç¨‹å‡½æ•°å¯¹åº”çš„æ˜¯çº¿ç¨‹åˆ—è¡¨å®¹å™¨ä¸­çš„å“ªä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ */\n                            /* æˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªæ˜ å°„å…³ç³»æ¥è®°å½•ï¼šthreadid => threadå¯¹è±¡ => åˆ é™¤ */\n                            thread_.erase(threadid);\n                            --curThreadSize_;\n                            --idleThreadSize_;\n                            std::cout << \"threadid: \" << std::this_thread::get_id() << \" exit!\"\n                                << std::endl;\n                            return;\n                        }\n                    } \n                    //} // while(taskQue_.size() > 0) ç»“æŸ\n                } \n                else // poolMode_ != PoolMode::MODE_CACHED\n                {\n                    notEmpty_.wait(lock /* , [&]()->bool { return taskQue_.size() > 0; } */);\n                }\n            } // end while (taskQueue_.size() == 0)\n\n            // æ­¤æ—¶ taskQueue_.size() != 0 è€Œ æˆ‘ä»¬åˆæ‹¿åˆ°äº† ä»»åŠ¡é˜Ÿåˆ—çš„é”ï¼Œå¯ä»¥ç›´æ¥å–èµ°ä»»åŠ¡\n            --idleThreadSize_;\n            std::cout << \"tid: \" << std::this_thread::get_id()\n                << \"è·å–ä»»åŠ¡æˆåŠŸ...\" << std::endl;\n            task = taskQue_.front();\n            taskQue_.pop();\n            --taskSize_;\n\n            if (taskQue_.size() > 0)\n            {\n                notEmpty_.notify_all();\n            }\n\n            notFull_.notify_all();\n        } // end std::unique_lock<std::mutex> lock(taskQueMtx_);\n        if(task != nullptr)\n        {\n            task();\n        }\n        ++idleThreadSize_;\n        /* çº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡åæ›´æ–°lastTime */\n        lastTime = std::chrono::high_resolution_clock().now();\n    }\n}\n```\næµ‹è¯•\n```cpp\nint sum(int a, int b)\n{\n    return a + b;\n}\nint main()\n{\n    ThreadPool pool;\n    pool.setMode(PoolMode::MODE_CACHED);\n    pool.start(2);\n    future<int> res1 = pool.submitTask(sum, 1, 2);\n    future<int> res2 = pool.submitTask([](int begin, int end) -> int\n        {\n            int sum = 0;\n            for (int i = begin; i <= end; ++i)\n            {\n                sum += i;\n            }\n            return sum;\n        }, 1, 100);\n    future<int> res3 = pool.submitTask(sum, 1, 2);\n    future<int> res4 = pool.submitTask(sum, 1, 2);\n        \n    cout << res1.get() << endl;\n    cout << res2.get() << endl;\n    cout << res3.get() << endl;\n    cout << res4.get() << endl;\n}\n```\n","categories":["æ“ä½œç³»ç»Ÿ","å¤šçº¿ç¨‹","Cpp","é¡¹ç›®"]},{"title":"åŠåŒæ­¥åŠå¼‚æ­¥çº¿ç¨‹æ± æ¨¡å‹","url":"/é¡¹ç›®/åŠåŒæ­¥åŠå¼‚æ­¥çº¿ç¨‹æ± æ¨¡å‹/","content":"# å†…å®¹\n\n1. åŠåŒæ­¥åŠå¼‚æ­¥çº¿ç¨‹æ± ä»‹ç»\n# çº¿ç¨‹æ± ä»‹ç»\n\nåœ¨å¤„ç†å¤§é‡å¹¶å‘ä»»åŠ¡çš„æ—¶å€™ï¼Œå¦‚æœæŒ‰ç…§ä¼ ç»Ÿçš„æ–¹å¼ï¼šæ¥ä¸€ä¸ªä»»åŠ¡è¯·æ±‚ï¼Œå¯¹åº”ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†è¯·æ±‚ä»»åŠ¡ã€‚é‚£ä¹ˆå¤§é‡çš„çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯å°†æ¶ˆè€—è¿‡å¤šçš„ç³»ç»Ÿèµ„æºï¼Œè¿˜å¢åŠ äº†çº¿ç¨‹ä¸Šä¸‹æ–‡ï¼ˆè¿è¡Œç¯å¢ƒï¼‰åˆ‡æ¢çš„å¼€é”€ï¼Œè€Œé€šè¿‡çº¿ç¨‹æ± æŠ€æœ¯å°±å¯ä»¥å¾ˆå¥½åœ°è§£å†³è¿™äº›é—®é¢˜ã€‚\n\nçº¿ç¨‹æ± æŠ€æœ¯é€šè¿‡åœ¨ç³»ç»Ÿä¸­é¢„å…ˆåˆ›å»ºä¸€å®šæ•°é‡çš„çº¿ç¨‹ï¼Œå½“ä»»åŠ¡è¯·æ±‚åˆ°æ¥æ—¶ä»çº¿ç¨‹æ± ä¸­åˆ†é…ä¸€ä¸ª**é¢„å…ˆåˆ›å»ºçš„çº¿ç¨‹**å»å¤„ç†ä»»åŠ¡ï¼Œçº¿ç¨‹åœ¨å¤„ç†å®Œä»»åŠ¡ä¹‹åè¿˜å¯ä»¥é‡ç”¨ï¼Œ**ä¸ä¼šé”€æ¯**ï¼Œè€Œæ˜¯ç­‰å¾…ä¸‹æ¬¡ä»»åŠ¡çš„åˆ°æ¥ã€‚è¿™æ ·ï¼Œé€šè¿‡çº¿ç¨‹æ± èƒ½**é¿å…å¤§é‡çš„çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯åŠ¨ä½œï¼Œä»è€ŒèŠ‚çœç³»ç»Ÿèµ„æº**ã€‚\n\nè¿™æ ·åšçš„ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œå¯¹äºå¤šæ ¸å¤„ç†å™¨ï¼Œç”±äºçº¿ç¨‹ä¼šè¢«åˆ†é…åˆ°å¤šä¸ªCPUï¼Œä¼š**æé«˜å¹¶è¡Œå¤„ç†çš„æ•ˆç‡**ï¼›å¦ä¸€ä¸ªå¥½å¤„æ˜¯**æ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹é˜»å¡**ï¼Œå¯ä»¥é˜²æ­¢ä¸»çº¿ç¨‹è¢«é˜»å¡è€Œä½¿ä¸»æµç¨‹è¢«é˜»å¡ï¼Œå¯¼è‡´å…¶ä»–çš„è¯·æ±‚å¾—ä¸åˆ°å“åº”çš„é—®é¢˜ã€‚\n\nçº¿ç¨‹æ± åˆ†ä¸ºåŠåŒæ­¥åŠå¼‚æ­¥çº¿ç¨‹æ± å’Œé¢†å¯¼è€…è¿½éšè€…çº¿ç¨‹æ± ï¼Œæœ¬æ–‡å°†ä¸»è¦ä»‹ç»åŠåŒæ­¥åŠå¼‚æ­¥çº¿ç¨‹æ± ï¼Œè¿™ç§çº¿ç¨‹æ± åœ¨å®ç°ä¸Šæ›´ç®€å•ï¼Œä½¿ç”¨å¾—æ¯”è¾ƒå¤šã€‚\n\n# åŠåŒæ­¥åŠå¼‚æ­¥çº¿ç¨‹æ± ç»“æ„\n\nåŠåŒæ­¥åŠå¼‚æ­¥çº¿ç¨‹æ± åˆ†æˆä¸‰å±‚ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚\n\n![image-20220330153004372](../../images/çº¿ç¨‹æ± /image-20220330153004372.png)\n\nç¬¬ä¸€å±‚æ˜¯åŒæ­¥æœåŠ¡å±‚ï¼Œå®ƒå¤„ç†æ¥è‡ªä¸Šå±‚çš„ä»»åŠ¡è¯·æ±‚ï¼Œä¸Šå±‚çš„è¯·æ±‚å¯èƒ½æ˜¯å¹¶å‘çš„ï¼Œè¿™äº›è¯·æ±‚ä¸æ˜¯é©¬ä¸Šå°±ä¼šè¢«å¤„ç†ï¼Œè€Œæ˜¯å°†è¿™äº›ä»»åŠ¡æ”¾åˆ°ä¸€ä¸ªåŒæ­¥æ’é˜Ÿå±‚ä¸­ï¼Œç­‰å¾…å¤„ç†ã€‚\n\nç¬¬äºŒå±‚æ˜¯åŒæ­¥æ’é˜Ÿå±‚ï¼Œæ¥è‡ªä¸Šå±‚çš„ä»»åŠ¡è¯·æ±‚éƒ½ä¼šåŠ åˆ°æ’é˜Ÿå±‚ä¸­ç­‰å¾…å¤„ç†ã€‚\n\nç¬¬ä¸‰å±‚æ˜¯å¼‚æ­¥æœåŠ¡å±‚ï¼Œè¿™ä¸€å±‚ä¸­ä¼šæœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å¤„ç†æ’é˜Ÿå±‚ä¸­çš„ä»»åŠ¡ï¼Œå¼‚æ­¥æœåŠ¡å±‚ä»åŒæ­¥æ’é˜Ÿå±‚ä¸­å–å‡ºä»»åŠ¡å¹¶è¡Œçš„å¤„ç†ã€‚\n\nè¿™ç§ä¸‰å±‚çš„ç»“æ„å¯ä»¥æœ€å¤§ç¨‹åº¦å¤„ç†ä¸Šå±‚çš„å¹¶å‘è¯·æ±‚ã€‚å¯¹äºä¸Šå±‚æ¥è¯´åªè¦å°†ä»»åŠ¡ä¸¢åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­å°±è¡Œäº†ï¼Œè‡³äºè°å»å¤„ç†ï¼Œä»€ä¹ˆæ—¶å€™å¤„ç†éƒ½ä¸ç”¨å…³å¿ƒï¼Œä¸»çº¿ç¨‹ä¹Ÿä¸ä¼šé˜»å¡ï¼Œè¿˜èƒ½ç»§ç»­å‘èµ·æ–°çš„è¯·æ±‚ã€‚è‡³äºä»»åŠ¡å…·ä½“æ€ä¹ˆå¤„ç†ï¼Œè¿™äº›ç»†èŠ‚éƒ½æ˜¯é å¼‚æ­¥æœåŠ¡å±‚çš„å¤šçº¿ç¨‹å¼‚æ­¥å¹¶è¡Œæ¥å®Œæˆçš„ï¼Œè¿™äº›çº¿ç¨‹æ˜¯ä¸€å¼€å§‹å°±åˆ›å»ºçš„ï¼Œä¸ä¼šå› ä¸ºå¤§é‡çš„ä»»åŠ¡åˆ°æ¥è€Œåˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œé¿å…äº†é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹å¯¼è‡´çš„ç³»ç»Ÿå¼€é”€ï¼Œè€Œä¸”é€šè¿‡å¤šæ ¸å¤„ç†èƒ½å¤§å¹…æé«˜å¤„ç†æ•ˆç‡ã€‚\n\n# å…³é”®æŠ€æœ¯åˆ†æ\n\nåŒæ­¥æ’é˜Ÿå±‚å±…äºæ ¸å¿ƒåœ°ä½ï¼Œå› ä¸ºä¸Šå±‚ä¼šå°†ä»»åŠ¡åŠ åˆ°æ’é˜Ÿå±‚ä¸­ï¼Œå¼‚æ­¥æœåŠ¡å±‚åŒæ—¶ä¹Ÿä¼šå–å‡ºä»»åŠ¡ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªåŒæ­¥çš„è¿‡ç¨‹ã€‚\n\nåœ¨å®ç°æ—¶ï¼Œæ’é˜Ÿå±‚å°±æ˜¯ä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—ï¼Œå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶æ·»åŠ æˆ–å–å‡ºä»»åŠ¡ï¼Œå¹¶ä¸”è¦ä¿è¯æ“ä½œè¿‡ç¨‹æ˜¯å®‰å…¨çš„ã€‚\n\nçº¿ç¨‹æ± æœ‰ä¸¤ä¸ªæ´»åŠ¨è¿‡ç¨‹ï¼Œä¸€ä¸ªæ˜¯å¾€åŒæ­¥é˜Ÿåˆ—ä¸­æ·»åŠ ä»»åŠ¡ï¼Œå¦ä¸€ä¸ªæ˜¯ä»åŒæ­¥é˜Ÿåˆ—ä¸­å–ä»»åŠ¡ã€‚æ´»åŠ¨å›¾å¦‚å›¾æ‰€ç¤ºã€‚\n\n![image-20220330154305073](../../images/çº¿ç¨‹æ± /image-20220330154305073.png)\n\nä»æ´»åŠ¨å›¾ä¸­å¯ä»¥çœ‹åˆ°çº¿ç¨‹æ± çš„æ´»åŠ¨è¿‡ç¨‹ï¼Œä¸€å¼€å§‹çº¿ç¨‹æ± ä¼šå¯åŠ¨ä¸€å®šæ•°é‡çš„çº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹å±äºå¼‚æ­¥å±‚ï¼Œä¸»è¦ç”¨æ¥å¹¶è¡Œå¤„ç†æ’é˜Ÿå±‚ä¸­çš„ä»»åŠ¡ã€‚\n\nå¦‚æœæ’é˜Ÿå±‚ä¸­çš„ä»»åŠ¡æ•°ä¸ºç©ºï¼Œåˆ™è¿™äº›çº¿ç¨‹ç­‰å¾…ä»»åŠ¡çš„åˆ°æ¥ï¼Œå¦‚æœå‘ç°æ’é˜Ÿå±‚ä¸­æœ‰ä»»åŠ¡äº†ï¼Œçº¿ç¨‹æ± åˆ™ä¼šä»ç­‰å¾…çš„è¿™äº›çº¿ç¨‹ä¸­å”¤é†’ä¸€ä¸ªæ¥å¤„ç†æ–°ä»»åŠ¡ã€‚åŒæ­¥æœåŠ¡å±‚åˆ™ä¼šä¸æ–­åœ°å°†æ–°çš„ä»»åŠ¡æ·»åŠ åˆ°åŒæ­¥æ’é˜Ÿå±‚ä¸­è¿™é‡Œæœ‰ä¸ªé—®é¢˜å€¼å¾—æ³¨æ„ï¼Œæœ‰å¯èƒ½ä¸Šå±‚çš„ä»»åŠ¡éå¸¸å¤šï¼Œè€Œä»»åŠ¡åˆæ˜¯éå¸¸è€—æ—¶çš„ï¼Œè¿™æ—¶ï¼Œå¼‚æ­¥å±‚ä¸­çš„çº¿ç¨‹å¤„ç†ä¸è¿‡æ¥ï¼Œåˆ™åŒæ­¥æ’é˜Ÿå±‚ä¸­çš„ä»»åŠ¡ä¼šä¸æ–­å¢åŠ ï¼Œå¦‚æœåŒæ­¥æ’é˜Ÿå±‚ä¸åŠ ä¸Šé™æ§åˆ¶ï¼Œåˆ™å¯èƒ½ä¼šå¯¼è‡´æ’é˜Ÿå±‚ä¸­çš„ä»»åŠ¡è¿‡å¤šã€å†…å­˜æš´æ¶¨çš„é—®é¢˜ã€‚å› æ­¤ï¼Œæ’é˜Ÿå±‚éœ€è¦åŠ ä¸Šé™çš„æ§åˆ¶ï¼Œå½“æ’é˜Ÿå±‚ä¸­çš„ä»»åŠ¡æ•°è¾¾åˆ°ä¸Šé™æ—¶ï¼Œå°±ä¸è®©ä¸Šå±‚çš„ä»»åŠ¡æ·»åŠ è¿›æ¥ï¼Œèµ·åˆ°é™åˆ¶å’Œä¿æŠ¤çš„ä½œç”¨ã€‚\n\n# åŒæ­¥é˜Ÿåˆ—\n\nåŒæ­¥é˜Ÿåˆ—å³ä¸ºçº¿ç¨‹ä¸­ä¸‰å±‚ç»“æ„ä¸­çš„ä¸­é—´é‚£ä¸€å±‚ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ä¿è¯é˜Ÿåˆ—ä¸­å…±äº«æ•°æ®çº¿ç¨‹å®‰å…¨ï¼Œè¿˜ä¸ºä¸Šä¸€å±‚åŒæ­¥æœåŠ¡å±‚æä¾›æ·»åŠ æ–°ä»»åŠ¡çš„æ¥å£ï¼Œä»¥åŠä¸ºä¸‹ä¸€å±‚å¼‚æ­¥æœåŠ¡å±‚æä¾›å–ä»»åŠ¡çš„æ¥å£ã€‚åŒæ—¶ï¼Œè¿˜è¦é™åˆ¶ä»»åŠ¡æ•°çš„ä¸Šé™ï¼Œé¿å…ä»»åŠ¡è¿‡å¤šå¯¼è‡´å†…å­˜æš´æ¶¨çš„é—®é¢˜ã€‚\n\nåŒæ­¥é˜Ÿåˆ—çš„å®ç°æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬ä¼šç”¨åˆ°C++11çš„é”ã€æ¡ä»¶å˜é‡ã€å³å€¼å¼•ç”¨ã€std::moveä»¥åŠstd::forwardã€‚moveæ˜¯ä¸ºäº†å®ç°ç§»åŠ¨è¯­ä¹‰ï¼Œforwardæ˜¯ä¸ºäº†å®ç°å®Œç¾è½¬å‘ã€‚\n\nåŒæ­¥é˜Ÿåˆ—çš„é”æ˜¯ç”¨æ¥çº¿ç¨‹åŒæ­¥çš„ã€‚\n\næ¡ä»¶å˜é‡æ˜¯ç”¨æ¥å®ç°çº¿ç¨‹é€šä¿¡çš„ï¼Œå³çº¿ç¨‹æ± ç©ºäº†å°±è¦ç­‰å¾…ï¼Œä¸ä¸ºç©ºå°±é€šçŸ¥ä¸€ä¸ªçº¿ç¨‹å»å¤„ç†ï¼›çº¿ç¨‹æ± æ»¡äº†å°±ç­‰å¾…ï¼Œç›´åˆ°æ²¡æœ‰æ»¡çš„æ—¶å€™æ‰é€šçŸ¥ä¸Šå±‚æ·»åŠ æ–°ä»»åŠ¡ã€‚\n\nåŒæ­¥é˜Ÿåˆ—çš„å…·ä½“å®ç°å¦‚ä¸‹ã€‚\n\n```cpp\n#include<list>\n#include<mutex>\n#include<condition_variable>\n#include<iostream>\nusing namespace std;\ntemplate<class T>\nclass SyncQueue\n{\npublic:\n    SyncQueue(int maxSize) : m_maxSize(maxSize), m_needStop(false){}\n    void Put(const T& x)\n    {\n        Add(x);\n    }\n    void Put(T && x)\n    {\n        Add(std::forward<T>(x));\n    }\n    void Take(std::list<T>& list)\n    {\n        std::unique_lock<std::mutex> locker(m_mutex);\n        //å¦‚æœé˜Ÿåˆ—æ²¡æœ‰åœæ­¢è¿è¡Œï¼Œåˆ™ç»§ç»­çœ‹ä»»åŠ¡é˜Ÿåˆ—æ˜¯å¦ç©ºï¼Œå¦‚æœç©ºåˆ™é˜»å¡ï¼Œä¸ç©ºåˆ™ç»§ç»­\n        m_notEmpty.wait(locker,\n                       [this]()->bool{return m_needStop || NotEmpty();});\n        if(m_needStop)return;\n        list = std::move(m_queue);\t//moveå¯¹äºlistæ¥è¯´åªç§»åŠ¨å®¹å™¨å†…éƒ¨å¯¹è±¡\n        m_notFull.notify_one();\n    }\n    void Take(T & t)\n    {\n        std::unique_lock<std::mutex> locker(m_mutex);\n        //å¦‚æœé˜Ÿåˆ—æ²¡æœ‰åœæ­¢è¿è¡Œï¼Œåˆ™ç»§ç»­çœ‹ä»»åŠ¡é˜Ÿåˆ—æ˜¯å¦ç©ºï¼Œå¦‚æœç©ºåˆ™é˜»å¡ï¼Œä¸ç©ºåˆ™ç»§ç»­\n        m_notEmpty.wait(locker,\n                       [this]()->bool{return m_needStop || NotEmpty();});\n        if(m_needStop)return;\n        t = m_queue.front();\t//èµ‹å€¼æ‹·è´\n        m_queue.pop_front();\n        m_notFull.notify_one();\n    }\nprivate:\n    std::list<T> m_queue;\t//ä»»åŠ¡\n    std::mutex m_mutex;\n    std::condition_variable m_notEmpty;\t//å¼‚æ­¥ä»»åŠ¡å±‚\n    std::condition_variable m_notFull;\t//åŒæ­¥ä»»åŠ¡å±‚\n    int m_maxSize;\n    bool m_needStop;\n};\n```\n\nå…¶ä¸­Takeå‡½æ•°å–çš„æ–¹æ³•æ˜¯â€œé’“é±¼â€çš„æ–¹å¼ã€‚\n\n> å¦‚æœæƒ³é€šè¿‡å‡½æ•°çš„returnç›´æ¥è¿”å›\\_Tyæ˜¯ä¸ç°å®çš„ï¼Œå› ä¸ºå¦‚æœæ ˆç©ºçš„è¯ä¼šäº§ç”Ÿè¿”å›å€¼æ··æ·†ã€‚\n>\n> æ‰€ä»¥åœ¨å¤–éƒ¨å…ˆå®šä¹‰ä¸€ä¸ªå¯¹è±¡åï¼Œé€šè¿‡ä¼ å…¥å¼•ç”¨å»æ¥æ”¶å¯¹è±¡å€¼ï¼ˆé€šè¿‡èµ‹å€¼æ‹·è´ï¼‰ã€‚\n\n```cpp\n_Ty Top();\n_Ty GetTop()\n{\n/*  if(Empty())return -1; */\n}\nbool GetPop(_Ty &v)\n{\n    if(Empty())return false;\n    v = data[top];\n    top -= 1;\n    return true;\n}\n```\n\n## Stop\n\n```cpp\nclass SyncQueue\n{\npublic:\n    void Stop()\n    {\n        {\n            std::unique_lock<std::mutex> locker(m_mutex);\n\t        m_needStop = true;\n        }\n        //éœ€è¦å”¤é†’æ‰€æœ‰é˜»å¡çš„çº¿ç¨‹ï¼Œè®©ä»–ä»¬å°½å¿«é€€å‡ºä¸šåŠ¡æ“ä½œã€‚\n        m_notFull.notify_all();\n        m_notEmpty.notify_all();\n    }\n    bool Empty()/* æ­¤æ–¹æ³•éœ€è¦ä¿®æ”¹æˆå‘˜é”çš„å±æ€§ï¼Œä¸èƒ½è®¾ç½®ä¸ºconstæ–¹æ³• */\n    {\n        std::unique_lock<std::mutex> locker(m_mutex);\n        return m_queue.empty();\n    }\n    bool Full()\n    {\n        std::unique_lock<std::mutex> locker(m_mutex);\n        return m_queue.size() == m_maxSize;\n    }\n    size_t Size()\n    {\n        std::unique_lock<std::mutex> locker(m_mutex);\n        return m_queue.size();\n    }\n    int Count()\n    {\n        return m_queue.size();\n    }\nprivate:\n    bool NotFull() const\n    {\n        bool full = m_queue.size() >= m_maxSize;\n        if(full)\n        {\n            cout << \"m_queue æ»¡äº†\" << endl;\n        }\n        return !full;\n    }\n    bool NotEmpty() const\n    {\n        bool empty = m_queue.empty();\n        if(empty)\n        {\n            cout << \"m_queue ç©ºäº†\" << endl;\n        }\n        return !empty;\n    }\n};\n```\n\n### Add\n\n```cpp\nclass SyncQueue\n{\nprivate:\n    template<class F>\n    void Add(F&& x)\n    {\n        std::unique_lock<std::mutex> locker(m_mutex);\n        m_notFull.wait(locker,\n                      [this]()->bool {return m_needStop||NotFull();});\n        m_queue.push_back(std::forward<F>(x));\n        m_notEmpty.notify_one();\n    }\n};\n```\n\n# çº¿ç¨‹æ± \n\n```cpp\nconst int MaxTaskCount = 100;\nclass ThreadPool\n{\npublic:\n    using Task = std::function<void()>;\n    ThreadPool(int numThreads = std::thread::hardware_concurrency)\n        : m_queue(MaxTaskCount) /* è®¾ç½®m_queueçš„æœ€å¤§å®¹çº³ä»»åŠ¡é‡ */\n    {\n        Start(numThreads);\n    }\n    ~ThreadPool()\n    {\n        Stop();\n    }\nprivate:\n    std::list<std::shared_ptr<std::thread> > m_threadgroup;\n    SyncQueue<Task> m_queue;\n    atomic_bool m_running;\t//åˆå§‹åŒ–ä¸ºå‡\n    std::once_flag m_flag;\t//ç¡®ä¿å‡½æ•°æ‰§è¡Œä¸€æ¬¡çš„æ ‡å¿—\n}\n```\n\n* Startã€RunInThreadã€StopThread\n\n```cpp\nclass ThreadPool\n{\npublic:\n    void Stop()\n    {\n        std::call_once(m_flag, [this]() {StopThreadGroup();});\n    }\n\n    void Start(int numThreads)\t//åˆ›å»ºè‹¥å¹²çº¿ç¨‹ï¼Œæ”¾åˆ°çº¿ç¨‹ç»„\n    {\n        m_running = true;\n        for(int i = 0; i < numThreads; ++i)\n        {\n            //æ³¨æ„ï¼ŒRunInThreadæ˜¯ç±»æˆå‘˜å‡½æ•°ï¼Œéœ€è¦æŒ‡æ˜å…¶æ˜¯å“ªä¸ªç±»ä¸­çš„ï¼Œè€Œä¸”è¦åœ¨å‰é¢åŠ &\n            m_threadgroup.push_back(\n                make_shared<thread>(&ThreadPool::RunInThread, this)\n            );\n            \n        }\n    }\nprivate:\n    void RunInThread()\t\t//ä¸»çº¿ç¨‹å¯¹åº”çš„å‡½æ•°ï¼Œå±äºç±»æˆå‘˜å‡½æ•°ï¼Œéœ€ä¼ å…¥this\n    {\n        while(m_running)\t//Startårunningä¸ºtrue\n        {\n            std::list<Task> list;\n            m_queue.Take(list);\n            for(auto & task : list)\n            {\n                if(!m_running)return;\n                task();\n            }\n        }\n    }\n    void StopThreadGroup()\n    {\n        m_queue.Stop();\n        m_running = false;\n        for(auto & th : m_threadgroup)\n        {\n            if(th)\n            {\n                th->join();\n            }\n        }\n        m_threadgroup.clear();\n    }\n};\n```\n\n* AddTask\n\n```cpp\nclass ThreadPool\n{\npublic:\n    void AddTask(Task && task)\n    {\n        m_queue.Put(task);\n    }\n    void AddTask(const Task & task)\n    {\n        m_queue.Put(task);\n    }\n};\n```\n\n# æµ‹è¯•\n\n```cpp\nvoid funa(ThreadPool &pool)\n{\n    for(int i = 0;i < 10; ++i)\n    {\n        auto thdid = this_thread::get_id();\n        pool.AddTask();\n    }\n}\nvoid TestThPool()\n{\n    ThreadPool pool;\n    std::thread tha(fun, 1);\n}\nint main()\n{\n    TestThPool();\n    return 0;\n}\n```\n# ä¸‹å»æ€è€ƒçš„é—®é¢˜\n\n1. è¿˜æœ‰ä¸€ä¸ªæ¦‚å¿µæ˜¯åç¨‹ã€‚æ˜¯åœ¨ç”¨æˆ·æ€çš„æ¨¡æ‹Ÿå¹¶å‘ï¼Œå› è€Œæ¯”çº¿ç¨‹é€Ÿåº¦æ›´å¿«ï¼Œä½†æ˜¯åç¨‹æœ¬è´¨ä¸Šä¸æ˜¯å¹¶è¡Œã€é«˜å¹¶å‘ï¼Œå› ä¸ºå®é™…ä¸Šå®ƒç›¸å¯¹äºCPUæ¥è¯´æ˜¯å¤„äºä¸²è¡Œçš„çŠ¶æ€ã€‚\n2. ä¸‹å»æ€è€ƒçº¿ç¨‹æ± å¦‚ä½•ä¸å¯¹è±¡æ± è¿æ¥ï¼Œå¯¹è±¡ä¸­å¯ä»¥è¿æ¥MySQLæ•°æ®åº“ï¼Œå¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ± è°ƒç”¨å¯¹è±¡çš„æŸ¥è¯¢ã€æ›´æ–°æ•°æ®æ–¹æ³•ã€‚\n3. åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ä¸æŸä¸ªçº¿ç¨‹æŒ‚æ¥åï¼Œèƒ½ä¸èƒ½åœ¨ä¸­é—´æš‚åœï¼Ÿæš‚åœæ—¶æ”¹å˜çº¿ç¨‹çš„å±æ€§ï¼Œç„¶åå†ç»§ç»­è·‘åŠ¨ï¼Ÿ\n4. èƒ½ä¸èƒ½ç²¾å‡†åœ°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå‡†ç¡®åœ°æŒ‚åœ¨æŸä¸ªæ ¸ä¸Šï¼Ÿ\n5. ä¸‹å»çœ‹çœ‹è°·æ­Œçš„çº¿ç¨‹æ± \n6. ä¸‹å»çœ‹çœ‹protobuf\n","categories":["æ“ä½œç³»ç»Ÿ","å¤šçº¿ç¨‹","Cpp","é¡¹ç›®"]},{"title":"Cpp_functional","url":"/Cpp/Cpp_functional/","content":"# å†…å®¹\n\n1. std::function\n2. std::bind\n# å¯è°ƒç”¨å¯¹è±¡\n\nCppä¸­ï¼Œå­˜åœ¨â€œå¯è°ƒç”¨å¯¹è±¡(Callable Objects)â€è¿™ä¸€æ¦‚å¿µã€‚å‡†ç¡®æ¥è¯´ï¼Œå¯è°ƒç”¨å¯¹è±¡æœ‰å¦‚ä¸‹å‡ ç§å®šä¹‰ï¼š\n\n1. æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆ\n2. æ˜¯ä¸€ä¸ªå…·æœ‰operator()æˆå‘˜å‡½æ•°çš„ç±»å¯¹è±¡ï¼ˆä»¿å‡½æ•°ï¼‰ã€‚\n3. æ˜¯ä¸€ä¸ªå¯è¢«è½¬æ¢ä¸ºå‡½æ•°æŒ‡é’ˆçš„ç±»å¯¹è±¡ã€‚\n4. æ˜¯ä¸€ä¸ªç±»æˆå‘˜ï¼ˆå‡½æ•°ï¼‰æŒ‡é’ˆã€‚\n\n* å¯è°ƒç”¨å¯¹è±¡çš„ä½¿ç”¨ç¤ºä¾‹\n\n  * å‡½æ•°æŒ‡é’ˆ\n\n    ```cpp\n    void func(void)\n    {\n        // ...\n    }\n    ```\n\n  * ä»¿å‡½æ•°\n\n    ```cpp\n    struct Foo\n    {\n        void operator()(void)\n        {\n            // ...\n        }\n    };\n    ```\n\n  * å¯è½¬æ¢ä¸ºå‡½æ•°æŒ‡é’ˆçš„ç±»å¯¹è±¡\n\n    ```cpp\n    struct Bar\n    {\n        using fr_t = void(*)(void);\n        static void func(void)\n        {\n            // ...\n        }\n        operator fr_t(void)\n        {\n            return func;\n        }\n    }\n    ```\n\n  * ç±»æˆå‘˜å‡½æ•°æŒ‡é’ˆ\n\n    ```cpp\n    struct A\n    {\n        int a_;\n        void mem_func(void)\n        {\n            // ...\n        }\n    };\n    ```\n\n  * æµ‹è¯•\n\n    ```cpp\n    int main(void)\n    {\n        void (* func_ptr)(void) = &func;\n        func_ptr();\n        \n        Foo foo;\n        foo();\n        \n        Bar bar;\n        bar();\n        \n        void (A::*mem_func_ptr)(void) = &A::mem_func;\n        int A::*mem_obj_ptr = &A::a_;\n        A aa;\n        (aa.*mem_func_ptr)();\n        aa.*mem_obj_ptr = 123;\n        \n        return 0;\n    }\n    ```\n\nä»ä¸Šè¿°å¯çœ‹åˆ°ï¼Œé™¤äº†ç±»æˆå‘˜æŒ‡é’ˆä¹‹å¤–ï¼Œä¸Šé¢å®šä¹‰æ¶‰åŠçš„å¯¹è±¡å‡å¯ä»¥åƒä¸€ä¸ªå‡½æ•°é‚£æ ·åšè°ƒç”¨æ“ä½œã€‚Cpp11ä¸­ï¼Œè¿™äº›å¯¹è±¡(func\\_ptrã€fooã€barã€mem\\_func\\_ptrã€mem\\_obj\\_ptr)éƒ½è¢«ç§°ä½œ**å¯è°ƒç”¨å¯¹è±¡**ã€‚ç›¸å¯¹åº”åœ°ï¼Œè¿™äº›å¯¹è±¡çš„ç±»å‹è¢«ç»Ÿç§°ä¸ºâ€œ**å¯è°ƒç”¨ç±»å‹**â€ã€‚\n\n> ä¸Šé¢å¯¹å¯è°ƒç”¨ç±»å‹çš„å®šä¹‰é‡Œå¹¶æ²¡æœ‰åŒ…æ‹¬å‡½æ•°ç±»å‹ï¼Œè¿™æ˜¯å› ä¸ºå‡½æ•°ç±»å‹å¹¶ä¸èƒ½ç›´æ¥ç”¨æ¥å®šä¹‰å¯¹è±¡ï¼›ä¹Ÿæ²¡æœ‰åŒ…æ‹¬å‡½æ•°å¼•ç”¨ï¼Œå› ä¸ºå¼•ç”¨ä»æŸç§æ„ä¹‰æ¥è¯´ï¼Œå¯ä»¥çœ‹ä½œä¸€ä¸ªconstçš„å‡½æ•°æŒ‡é’ˆã€‚\n\nCppä¸­çš„å¯è°ƒç”¨å¯¹è±¡å…·æœ‰ç»Ÿä¸€çš„æ“ä½œå½¢å¼ï¼Œå³åé¢åŠ æ‹¬å·è¿›è¡Œè°ƒç”¨ï¼ˆé™¤äº†ç±»æˆå‘˜å‡½æ•°æŒ‡é’ˆï¼‰ï¼Œä½†æ˜¯å®šä¹‰æ–¹æ³•å´äº”èŠ±å…«é—¨ã€‚æˆ‘ä»¬è¯•å›¾ä½¿ç”¨ç»Ÿä¸€çš„æ–¹å¼è¿›è¡Œä¿å­˜ï¼Œæˆ–ä¼ é€’ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡æ—¶ã€‚äºæ˜¯Cpp11é€šè¿‡æä¾›std::funcitonå’Œstd::bindç»Ÿä¸€äº†å¯è°ƒç”¨å¯¹è±¡çš„å„ç§æ“ä½œã€‚\n\n# å¯è°ƒç”¨å¯¹è±¡åŒ…è£…å™¨std::function\n\nstd::functionæ˜¯å¯è°ƒç”¨å¯¹è±¡çš„åŒ…è£…å™¨ï¼Œæ˜¯ä¸€ä¸ªç±»æ¨¡æ¿ï¼Œå¯ä»¥å®¹çº³é™¤äº†ç±»æˆå‘˜å‡½æ•°æŒ‡é’ˆä¹‹å¤–çš„æ‰€æœ‰å¯è°ƒç”¨å¯¹è±¡ã€‚é€šè¿‡æŒ‡å®šå®ƒçš„æ¨¡æ¿å‚æ•°ï¼Œå®ƒå¯ä»¥ç”¨ç»Ÿä¸€çš„æ–¹å¼å¤„ç†å‡½æ•°ã€å‡½æ•°å¯¹è±¡ã€å‡½æ•°æŒ‡é’ˆï¼Œå¹¶å…è®¸ä¿å­˜å’Œå»¶è¿Ÿæ‰§è¡Œå®ƒä»¬ã€‚\n\n* std::functionçš„åŸºæœ¬ç”¨æ³•ç¤ºä¾‹\n\n  * ç»‘å®šä¸€ä¸ªæ™®é€šå‡½æ•°\n\n    ```cpp\n    #include<iostream>\n    #include<functional>\n    void func(void)\n    {\n        std::cout << __FUNCTION__ << std::endl;\n    }\n    int main()\n    {\n        std::function<void(void)> fr1 = func;\n        fr1();\n        return 0;\n    }\n    /* func */\n    ```\n\n  * ç»‘å®šä¸€ä¸ªç±»çš„é™æ€æˆå‘˜å‡½æ•°\n\n    ```cpp\n    #include<iostream>\n    #include<functional>\n    class Foo\n    {\n    public:\n        static int foo_func(int a)\n        {\n            std::cout << __FUNCTION__ << \"(\" << a << \") ->: \";\n            return a;\n        }\n    };\n    int main()\n    {\n        std::function<int(int)> fr2 = Foo::foo_func;\n        std::cout << fr2(123) << std::endl;\n        return 0;\n    }\n    /* foo_func(123) ->: 123 */\n    ```\n\n  * ç»‘å®šä¸€ä¸ªä»¿å‡½æ•°\n\n    ```cpp\n    class Bar\n    {\n    public:\n        int operator()(int a)\n        {\n            std::cout << __FUNCTION__ << \"(\" << a << \") ->: \";\n            return a;\n        }\n    };\n    int main()\n    {\n        Bar bar;\n        fr2 = bar;\n        std::cout << fr2(123) << std::endl;\n        return 0;\n    }\n    /* operator()(123) ->: 123 */\n    ```\n\nä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°std::functionçš„ä½¿ç”¨æ–¹æ³•ï¼Œå½“æˆ‘ä»¬ç»™std::functionå¡«å…¥åˆé€‚çš„å‡½æ•°ç­¾åï¼ˆå³ä¸€ä¸ªå‡½æ•°ç±»å‹ï¼Œåªéœ€è¦åŒ…æ‹¬è¿”å›å€¼å’Œå‚æ•°è¡¨ï¼‰ä¹‹åï¼Œå®ƒå°±å˜æˆäº†ä¸€ä¸ªå¯ä»¥å®¹çº³æ‰€æœ‰è¿™ä¸€ç±»è°ƒç”¨æ–¹å¼çš„â€œå‡½æ•°åŒ…è£…å™¨â€ã€‚\n\n* std::functionä½œä¸ºå›è°ƒå‡½æ•°çš„ç¤ºä¾‹\n\n  ```cpp\n  #include<iostream>\n  #include<functional>\n  class A\n  {\n      std::function<void()> callback_;\n  public:\n      A(const std::function<void()> & f) : callback_(f)\n      {}\n      void notify(void)\n      {\n          callback_();\t//å›è°ƒåˆ°ä¸Šå±‚\n      }\n  };\n  class Foo\n  {\n  public:\n      void operator()(void)\n      {\n          std::cout << __FUNCTION__ << std::endl;\n      }\n  };\n  int main()\n  {\n      Foo foo;\n      A aa(foo);\n      aa.notify();\n      return 0;\n  }\n  ```\n\nä»ä¸Šé¢ä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°ï¼Œstd::functionå¯ä»¥å–ä»£å‡½æ•°æŒ‡é’ˆçš„ä½œç”¨ã€‚å› ä¸ºå®ƒå¯ä»¥ä¿å­˜å‡½æ•°å»¶è¿Ÿæ‰§è¡Œï¼Œæ‰€ä»¥æ¯”è¾ƒé€‚åˆä½œä¸ºå›è°ƒå‡½æ•°ã€‚\n\n* std::functionè¿˜å¯ä»¥ä½œä¸ºå‡½æ•°å…¥å‚\n\n  ```cpp\n  #include<iostream>\n  #include<functional>\n  void call_when_even(int x, const std::funciton<void(int)> & f)\n  {\n      if(!(x&1))\t//x % 2 == 0\n      {\n          f(x);\n      }\n  }\n  void output(int x)\n  {\n      std::cout << x << \" \";\n  }\n  int main()\n  {\n      for(int i = 0; i < 10; ++i)\n      {\n          call_when_even(i, output);\n      }\n      std::cout << std::endl;\n      return 0;\n  }\n  /* 0 2 4 6 8 */\n  ```\n\nä»ä¸Šä¾‹å¯ä»¥çœ‹åˆ°ï¼Œstd::functionæ¯”æ™®é€šå‡½æ•°æŒ‡é’ˆæ›´çµæ´»ã€ä¾¿åˆ©ã€‚\n\n# std::bindç»‘å®šå™¨\n\nå½“std::functionå’Œstd::bindé…åˆèµ·æ¥ä½¿ç”¨æ—¶ï¼Œæ‰€æœ‰çš„å¯è°ƒç”¨å¯¹è±¡ï¼ˆåŒ…æ‹¬ç±»æˆå‘˜å‡½æ•°æŒ‡é’ˆå’Œç±»æˆå‘˜æŒ‡é’ˆï¼‰éƒ½å°†å…·æœ‰ç»Ÿä¸€çš„è°ƒç”¨æ–¹å¼ã€‚\n\nstd::bindç”¨æ¥å°†å¯è°ƒç”¨å¯¹è±¡ä¸å…¶å‚æ•°ä¸€èµ·è¿›è¡Œç»‘å®šï¼Œç»‘å®šåçš„ç»“æœå¯ä»¥ä½¿ç”¨std::functionè¿›è¡Œä¿å­˜ï¼Œå¹¶å»¶è¿Ÿè°ƒç”¨åˆ°ä»»ä½•æˆ‘ä»¬éœ€è¦çš„æ—¶å€™ã€‚\n\né€šä¿—æ¥è®²ï¼Œbindä¸»è¦æœ‰ä¸¤å¤§ä½œç”¨ï¼š\n\n1. å°†å¯è°ƒç”¨å¯¹è±¡ä¸å…¶å‚æ•°ä¸€èµ·ç»‘å®šæˆä¸€ä¸ªä»¿å‡½æ•°ã€‚\n2. å°†å¤šå…ƒï¼ˆå‚æ•°ä¸ªæ•°ä¸ºn, n>1ï¼‰å¯è°ƒç”¨å¯¹è±¡è½¬æˆä¸€å…ƒæˆ–è€…ï¼ˆn-1ï¼‰å…ƒå¯è°ƒç”¨å¯¹è±¡ï¼Œå³åªç»‘å®šéƒ¨åˆ†å‚æ•°ã€‚\n\n* å®é™…ä½¿ç”¨ç¤ºä¾‹\n\n  ```cpp\n  #include<iostream>\n  #include<functional>\n  void call_when_even(int x, const std::function<void(int)> & f)\n  {\n      if(!(x&1))\t//x % 2 == 0\n      {\n          f(x);\n      }\n  }\n  void output(int x)\n  {\n      std::cout << x << \" \";\n  }\n  void output_add_2(int x)\n  {\n      std::cout << x + 2 << \" \";\n  }\n  int main()\n  {\n      {\n          auto fr = std::bind(output, std::placeholders::_1);\n          for(int i = 0; i < 10; ++i)\n          {\n              call_when_even(i, fr);\n          }\n          std::cout << std::endl;\n      }\n      {\n          auto fr = std::bind(output_add_2, std::placeholders::_1);\n          for(int i = 0; i < 10; ++i)\n          {\n              call_when_even(i, fr);\n          }\n          std::cout << std::endl;\n      }\n      return 0;\n  }\n  /* \n  0 2 4 6 8 \n  2 4 6 8 10\n  */\n  ```\n\nåŒæ ·è¿˜æ˜¯ä¸Šé¢std::functionä¸­æœ€åçš„ä¸€ä¸ªä¾‹å­ï¼Œåªæ˜¯åœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†std::bindï¼Œåœ¨å‡½æ•°å¤–éƒ¨é€šè¿‡ç»‘å®šä¸åŒçš„å‡½æ•°ï¼Œæ§åˆ¶äº†æœ€åçš„æ‰§è¡Œç»“æœã€‚\n\næˆ‘ä»¬ä½¿ç”¨auto frä¿å­˜std::bindçš„è¿”å›ç»“æœï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬å¹¶ä¸å…³å¿ƒstd::bindçœŸæ­£çš„è¿”å›ç±»å‹ï¼ˆ**å®é™…ä¸Šstd::bindçš„è¿”å›ç±»å‹æ˜¯ä¸€ä¸ªstlå†…éƒ¨å®šä¹‰çš„ä»¿å‡½æ•°ç±»å‹**ï¼‰ï¼Œåªéœ€è¦çŸ¥é“å®ƒæ˜¯ä¸€ä¸ªä»¿å‡½æ•°ï¼Œå¯ä»¥ç›´æ¥èµ‹å€¼ç»™ä¸€ä¸ªstd::functionã€‚å½“ç„¶ï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨std::functionç±»å‹æ¥ä¿å­˜std::bindçš„è¿”å›å€¼ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚\n\nstd::placeholders::\\_1æ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼Œä»£è¡¨è¿™ä¸ªä½ç½®å°†åœ¨å‡½æ•°è°ƒç”¨æ—¶ï¼Œè¢«ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°æ‰€æ›¿ä»£ã€‚\n\nå› ä¸ºæœ‰äº†å ä½ç¬¦çš„æ¦‚å¿µï¼Œstd::bindçš„ä½¿ç”¨éå¸¸çµæ´»ã€‚\n\n```cpp\n#include<iostream>\n#include<functional>\nvoid output(int x, int y)\n{\n    std::cout << x << \" \" << y << std::endl;\n}\nint main()\n{\n    std::bind(output, 1, 2)();\t\t\t\t\t\t\t//è¾“å‡º1 2\n    std::bind(output, std::placeholders::_1, 2)(1);\t\t//è¾“å‡º1 2\n    std::bind(output, 2, std::placeholders::_1)(1);\t\t//è¾“å‡º2 1\n/*  std::bind(output, 2, std::placeholders::_2)(1);*/\t//error, ç¼ºå°‘ç¬¬äºŒä¸ªå‚æ•°\n    std::bind(output, 2, std::placeholders::_2)(1, 2);\t//è¾“å‡º2 2, ç›¸å½“äºç¬¬1ä¸ªå‚æ•°ä»…ä»…æ˜¯æ ‡å¿—\n    std::bind(output, std::placeholders::_1,\n              \t\t  std::placeholders::_2)(1, 2);\t\t//è¾“å‡º1 2\n    std::bind(output, std::placeholders::_2,\n              \t\t  std::placeholders::_1)(1, 2);\t\t//è¾“å‡º2 1\n    return 0;\n}\n```\n\nä¸Šé¢ä¾‹å­å¯¹std::bindçš„è¿”å›ç»“æœç›´æ¥æ–½ä»¥è°ƒç”¨ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œ**std::bindå¯ä»¥ç›´æ¥ç»‘å®šå‡½æ•°çš„æ‰€æœ‰å‚æ•°ï¼Œä¹Ÿå¯ä»¥ä»…ç»‘å®šéƒ¨åˆ†å‚æ•°**ã€‚\n\nåœ¨ç»‘å®šéƒ¨åˆ†å‚æ•°çš„æ—¶å€™ï¼Œé€šè¿‡ä½¿ç”¨std::placeholdersï¼Œæ¥å†³å®šç©ºä½å‚æ•°å°†ä¼šå±äºè°ƒç”¨å‘ç”Ÿæ—¶çš„ç¬¬å‡ ä¸ªå‚æ•°ã€‚\n\n* ä¸‹é¢æ¥çœ‹bindå’Œfunctioné…åˆä½¿ç”¨\n\n  ```cpp\n  #include<iostream>\n  #include<functional>\n  class A\n  {\n  public:\n      int i_ = 0;\n      void output(int x, int y)\n      {\n          std::cout << x << \" \" << y << std::endl;\n      }\n  };\n  int main()\n  {\n      A a;\n      std::functional<void(int, int)> fr = \n          std::bind(&A::output, &a, std::placeholders::_1,\n                    std::placeholders::_2);//ç›®æ ‡å‡½æ•°A::output, ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯thisæŒ‡é’ˆ, è¿˜æœ‰å…¶ä»–ä¸¤ä¸ªå‚æ•°ã€‚\n      fr(1, 2);\t//è¾“å‡º1 2\n      std::function<int&(void)> fr_i = std::bind(&A::i_, &a);\n      fr_i() = 123;\n      std::cout << a.i_ << std::endl;\t//è¾“å‡º123\n      return 0;\n  }\n  ```\n\nfrçš„ç±»å‹æ˜¯std::function<void(int, int)>ã€‚æˆ‘ä»¬é€šè¿‡ä½¿ç”¨std::bindï¼Œå°†Açš„æˆå‘˜å‡½æ•°outputçš„æŒ‡é’ˆå’Œaç»‘å®šï¼Œå¹¶è½¬æ¢ä¸ºä¸€ä¸ªä»¿å‡½æ•°æ”¾å…¥frä¸­å­˜å‚¨ã€‚\n\nä¹‹åï¼Œstd::bindå°†Açš„æˆå‘˜i\\_çš„æŒ‡é’ˆå’Œaç»‘å®šï¼Œè¿”å›çš„ç»“æœè¢«æ”¾å…¥std::function<int&(void)>ä¸­å­˜å‚¨ï¼Œå¹¶å¯ä»¥åœ¨éœ€è¦æ—¶ä¿®æ”¹è®¿é—®è¿™ä¸ªæˆå‘˜ã€‚\n\n# å®è´¨\n\n```cpp\nclass Alloc\n{\n    size_t _sz;\n    int *& _ptr;\npublic:\n    Alloc(size_t sz, int *& p) : _sz(sz), _ptr(p) {}\n    void operator()()\n    {\n        _ptr = (int*)malloc(_sz);\n    }\n}\nvoid alloc(size_t sz, int *& p)\n{\n    p = (int*)malloc(sz);\n}\nint main()\n{\n    int * p = nullptr;\n    int sz = sizeof(int) * 10;\n    auto fr = std::bind(alloc, sz, std::ref(p));\n    fr();\n    if(p != nullptr)\n    {\n        cout << p << endl;\n    }\n}\n```\n\n","categories":["Cpp"]},{"title":"Linux_libevent_Reactoræ¨¡å¼","url":"/Linux/Linux_libevent_Reactoræ¨¡å¼/","content":"# å†…å®¹\n\n1. IOæ¡†æ¶åº“\n2. Reactoræ¨¡å¼çš„IOæ¡†æ¶åº“åŒ…å«å“ªäº›ç»„ä»¶\n3. libeventæ˜¯ä¸€ä¸ªè½»é‡çº§çš„I/Oæ¡†æ¶åº“ã€‚\n# I/Oæ¡†æ¶åº“\n\nI/Oæ¡†æ¶åº“ä»¥åº“å‡½æ•°çš„å½¢å¼ï¼Œå°è£…äº†è¾ƒä¸ºåº•å±‚çš„ç³»ç»Ÿè°ƒç”¨ã€‚\nå„ç§I/Oæ¡†æ¶åº“çš„å®ç°åŸç†åŸºæœ¬ç›¸ä¼¼ï¼Œè¦ä¹ˆä»¥Reactoræ¨¡å¼å®ç°ï¼Œè¦ä¹ˆä»¥Proactoræ¨¡å¼å®ç°ï¼Œè¦ä¹ˆåŒæ—¶ä¸¤ç§æ¨¡å¼å®ç°ã€‚\n# Reactoræ¨¡å¼\n\n`Reactoræ¨¡å¼`è¦æ±‚**ä¸»çº¿ç¨‹ï¼ˆIOå¤„ç†å•å…ƒï¼‰åªè´Ÿè´£ç›‘å¬æ–‡ä»¶æè¿°ç¬¦ä¸Šæ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿ**ï¼Œæœ‰çš„è¯å°±ç«‹å³å‘å·¥ä½œçº¿ç¨‹ï¼ˆé€»è¾‘å•å…ƒï¼‰é€šçŸ¥è¯¥äº‹ä»¶ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¸»çº¿ç¨‹ä¸åšå…¶ä»–å®è´¨æ€§çš„å·¥ä½œã€‚å³è¯»å†™æ•°æ®ã€æ¥å—æ–°çš„è¿æ¥ã€å¤„ç†å®¢æˆ·è¯·æ±‚å‡åœ¨å·¥ä½œçº¿ç¨‹ä¸­å®Œæˆã€‚\n## å·¥ä½œæµç¨‹\n\nä½¿ç”¨åŒæ­¥I/Oæ¨¡å‹ï¼ˆä»¥`epoll_wait`ä¸ºä¾‹ï¼‰å®ç°çš„`Reactoræ¨¡å¼`çš„å·¥ä½œæµç¨‹æ˜¯ï¼š\n\n1. **ä¸»çº¿ç¨‹å¾€`epoll`å†…æ ¸äº‹ä»¶è¡¨ä¸­æ³¨å†Œ`socket`ä¸Šçš„è¯»å°±ç»ªäº‹ä»¶**ã€‚\n2. ä¸»çº¿ç¨‹è°ƒç”¨`epoll_wait`ç­‰å¾…`socket`ä¸Šæœ‰æ•°æ®å¯è¯»ã€‚\n3. å½“`socket`ä¸Šæœ‰æ•°æ®å¯è¯»æ—¶ï¼Œ`epoll_wait`é€šçŸ¥ä¸»çº¿ç¨‹ã€‚**ä¸»çº¿ç¨‹åˆ™å°†`socket`å¯è¯»äº‹ä»¶æ”¾å…¥è¯·æ±‚é˜Ÿåˆ—**ã€‚\n4. ç¡çœ åœ¨è¯·æ±‚é˜Ÿåˆ—ä¸Šçš„æŸä¸ª**å·¥ä½œçº¿ç¨‹**è¢«å”¤é†’ï¼Œå®ƒä»`socket`è¯»å–æ•°æ®ï¼Œå¹¶å¤„ç†å®¢æˆ·è¯·æ±‚ï¼Œç„¶å**å·¥ä½œçº¿ç¨‹å¾€`epoll`å†…æ ¸äº‹ä»¶è¡¨ä¸­æ³¨å†Œè¯¥`socket`ä¸Šçš„å†™å°±ç»ªäº‹ä»¶**ã€‚\n5. ä¸»çº¿ç¨‹è°ƒç”¨`epoll_wait`ç­‰å¾…`socket`å¯å†™ã€‚\n6. å½“`socket`å¯å†™æ—¶ï¼Œ`epoll_wait`é€šçŸ¥**ä¸»çº¿ç¨‹**ã€‚**ä¸»çº¿ç¨‹å°†`socket`å¯å†™äº‹ä»¶æ”¾å…¥è¯·æ±‚é˜Ÿåˆ—**ã€‚\n7. ç¡çœ åœ¨è¯·æ±‚é˜Ÿåˆ—ä¸Šçš„æŸä¸ª**å·¥ä½œçº¿ç¨‹**è¢«å”¤é†’ï¼Œå®ƒå¾€`socket`ä¸Šå†™å…¥æœåŠ¡å™¨å¤„ç†å®¢æˆ·è¯·æ±‚çš„ç»“æœã€‚\n\næ€»ç»“ï¼šä¸»çº¿ç¨‹æ³¨å†Œè¯»äº‹ä»¶ï¼Œå¯è¯»æ—¶ï¼Œä¸»çº¿ç¨‹æ”¾å…¥è¯·æ±‚é˜Ÿåˆ—ï¼›å·¥ä½œçº¿ç¨‹è¯»æ•°æ®ï¼Œå¤„ç†è¯·æ±‚ï¼Œå·¥ä½œçº¿ç¨‹æ³¨å†Œå†™äº‹ä»¶ï¼›å¯å†™æ—¶ï¼Œä¸»çº¿ç¨‹æ”¾å…¥è¯·æ±‚é˜Ÿåˆ—ï¼›å·¥ä½œçº¿ç¨‹å†™æ•°æ®ã€‚\n\n![image-20220524104612105](../../images/Linux_libevent/image-20220524104612105.png)\n\n## ç»„ä»¶æ¡†æ¶\n\nåŸºäºReactoræ¨¡å¼çš„I/Oæ¡†æ¶åº“åŒ…å«å¦‚ä¸‹å‡ ä¸ªç»„ä»¶ï¼š\n\n1. å¥æŸ„(Handle)\n2. äº‹ä»¶å¤šè·¯åˆ†å‘å™¨(Event Demultiplexer)\n3. äº‹ä»¶å¤„ç†å™¨(Event Handler)å’Œå…·ä½“çš„äº‹ä»¶å¤„ç†å™¨(Concrete EventHandler)\n4. Reactorã€‚\n\nè¿™äº›ç»„ä»¶çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n![image-20220423142048988](../../images/Linux_libevent/image-20220423142048988.png)\n\n* å¥æŸ„\n  * è¯´ç™½äº†å°±æ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼Œå¥æŸ„åœ¨windowsä¸ŠæŸä¸ªèµ„æºçš„idï¼Œå› ä¸ºlibeventåº“æ˜¯è·¨å¹³å°çš„ï¼Œæ‰€ä»¥å«æ³•å®¹æ˜“æ··ç”¨ã€‚\n* äº‹ä»¶å¤šè·¯åˆ†å‘å™¨\n  * äº‹ä»¶çš„åˆ°æ¥æ˜¯éšæœºçš„ã€å¼‚æ­¥çš„ã€‚æ¯”å¦‚æˆ‘ä»¬æ— æ³•é¢„çŸ¥ç¨‹åºä½•æ—¶æ”¶åˆ°ä¸€ä¸ªå®¢æˆ·è¿æ¥è¯·æ±‚ï¼Œåˆäº¦æˆ–æ”¶åˆ°ä¸€ä¸ªæš‚åœä¿¡å·ï¼Œæ‰€ä»¥ç¨‹åºéœ€è¦å¾ªç¯åœ°ç­‰å¾…åˆ¤æ–­æœ‰æ— äº‹ä»¶äº§ç”Ÿï¼Œè¿™å°±æ˜¯**äº‹ä»¶å¾ªç¯**ã€‚\n  * åœ¨äº‹ä»¶å¾ªç¯ä¸­ï¼Œç­‰å¾…äº‹ä»¶ä¸€èˆ¬ä½¿ç”¨I/Oå¤ç”¨æŠ€æœ¯æ¥å®ç°ã€‚I/Oæ¡†æ¶åº“ä¸€èˆ¬å°†ç³»ç»Ÿæ”¯æŒçš„å„ç§I/Oå¤ç”¨ç³»ç»Ÿè°ƒç”¨å°è£…æˆç»Ÿä¸€çš„æ¥å£ï¼Œç§°ä¸º**äº‹ä»¶å¤šè·¯åˆ†å‘å™¨**ã€‚å› æ­¤äº‹ä»¶å¤šè·¯åˆ†å‘å™¨å¯ä»¥ç†è§£ä¸ºå°è£…äº†IOå¤ç”¨ï¼Œæä¾›äº†ä¸€ä¸ªæ›´ä¾¿äºä½¿ç”¨çš„æ¥å£ã€‚\n  * äº‹ä»¶å¤šè·¯åˆ†å‘å™¨çš„demultiplexæ–¹æ³•æ˜¯ç­‰å¾…äº‹ä»¶çš„æ ¸å¿ƒå‡½æ•°ï¼Œå…¶å†…éƒ¨è°ƒç”¨çš„æ˜¯selectã€pollã€epoll\\_waitç­‰å‡½æ•°ã€‚\n  * äº‹ä»¶å¤šè·¯åˆ†å‘å™¨è¿˜éœ€è¦å®ç°`register_event`å’Œ`remove_event`æ–¹æ³•ï¼Œä»¥ä¾›è°ƒç”¨è€…ç»™äº‹ä»¶å¤šè·¯åˆ†å‘å™¨ä¸­æ·»åŠ äº‹ä»¶å’Œä»ä¸­åˆ é™¤äº‹ä»¶ã€‚\n* äº‹ä»¶å¤„ç†å™¨å’Œå…·ä½“äº‹ä»¶å¤„ç†å™¨\n  * äº‹ä»¶å¤„ç†å™¨æ‰§è¡Œäº‹ä»¶å¯¹åº”çš„ä¸šåŠ¡é€»è¾‘ã€‚å®ƒé€šå¸¸åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª`handle_event`å›è°ƒå‡½æ•°ï¼Œè¿™äº›å›è°ƒå‡½æ•°åœ¨äº‹ä»¶å¾ªç¯ä¸­è¢«æ‰§è¡Œã€‚\n  * I/Oæ¡†æ¶åº“æä¾›çš„äº‹ä»¶å¤„ç†å™¨é€šå¸¸æ˜¯ä¸€ä¸ªæ¥å£ï¼Œç”¨æˆ·éœ€è¦ç»§æ‰¿å®ƒæ¥å®ç°è‡ªå·±çš„äº‹ä»¶å¤„ç†å™¨ï¼Œå³å…·ä½“äº‹ä»¶å¤„ç†å™¨ã€‚**å› æ­¤ï¼Œäº‹ä»¶å¤„ç†å™¨ä¸­çš„å›è°ƒå‡½æ•°ä¸€èˆ¬è¢«å£°æ˜ä¸ºè™šå‡½æ•°ï¼Œä»¥æ”¯æŒç”¨æˆ·çš„æ‰©å±•**ã€‚\n  * æ­¤å¤–ï¼Œäº‹ä»¶å¤„ç†å™¨ä¸€èˆ¬è¿˜æä¾›ä¸€ä¸ª`get_handle`æ–¹æ³•ï¼Œå®ƒè¿”å›ä¸è¯¥äº‹ä»¶å¤„ç†å™¨å…³è”çš„å¥æŸ„ã€‚é‚£ä¹ˆï¼Œäº‹ä»¶å¤„ç†å™¨å’Œå¥æŸ„æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ**å½“äº‹ä»¶å¤šè·¯åˆ†å‘å™¨æ£€æµ‹åˆ°æœ‰äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå®ƒæ˜¯é€šè¿‡å¥æŸ„æ¥é€šçŸ¥åº”ç”¨ç¨‹åº**çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»å°†äº‹ä»¶å¤„ç†å™¨å’Œå¥æŸ„ç»‘å®šï¼Œæ‰èƒ½åœ¨äº‹ä»¶å‘ç”Ÿæ—¶è·å–åˆ°æ­£ç¡®çš„äº‹ä»¶å¤„ç†å™¨ã€‚\n* Reactoræ˜¯I/Oæ¡†æ¶åº“çš„æ ¸å¿ƒã€‚å®ƒæä¾›çš„å‡ ä¸ªä¸»è¦æ–¹æ³•æ˜¯ï¼š\n  * `handle_events`ï¼Œè¯¥æ–¹æ³•æ‰§è¡Œ**äº‹ä»¶å¾ªç¯**ã€‚é‡å¤è¿‡ç¨‹ï¼šç­‰å¾…äº‹ä»¶ï¼Œç„¶åä¾æ¬¡å¤„ç†æ‰€æœ‰å°±ç»ªäº‹ä»¶å¯¹åº”çš„äº‹ä»¶å¤„ç†å™¨ã€‚\n  * `register_handler`ï¼Œè¯¥æ–¹æ³•è°ƒç”¨äº‹ä»¶å¤šè·¯åˆ†å‘å™¨çš„`register_event`æ–¹æ³•æ¥ç»™äº‹ä»¶å¤šè·¯åˆ†å‘å™¨ä¸­æ³¨å†Œä¸€ä¸ªäº‹ä»¶ã€‚\n  * `remove_handler`ï¼Œè¯¥æ–¹æ³•è°ƒç”¨äº‹ä»¶å¤šè·¯åˆ†å‘å™¨çš„`remove_event`æ–¹æ³•æ¥åˆ é™¤äº‹ä»¶å¤šè·¯åˆ†å‘å™¨ä¸­çš„ä¸€ä¸ªäº‹ä»¶ã€‚\n\n# libevent\n\nlibeventæ”¯æŒçš„äº‹ä»¶ç±»å‹\n\n```c\n#define EV_TIMEOUT\t\t0x01\t/* å®šæ—¶äº‹ä»¶ */\n#define EV_READ\t\t\t0x02\t/* å¯è¯»äº‹ä»¶ */\n#define EV_WRITE\t\t0x04\t/* å¯å†™äº‹ä»¶ */\n#define EV_SIGNAL\t\t0x08\t/* ä¿¡å·äº‹ä»¶ */\n#define EV_PERSIST\t\t0x10\t/* æ°¸ä¹…äº‹ä»¶ */\n#define EV_ET\t\t\t0x20   /*è¾¹æ²¿è§¦å‘äº‹ä»¶,éœ€è¦IOå¤ç”¨ç³»ç»Ÿè°ƒç”¨æ”¯æŒ,å¦‚epoll*/\n```\n\n## ç¼–ç¨‹æµç¨‹\n\n1. å®šä¹‰ã€åˆ›å»ºæ¡†æ¶ç¤ºä¾‹\n2. å‘æ¡†æ¶ç¤ºä¾‹æ³¨å†Œã€æ³¨é”€äº‹ä»¶ï¼šæŒ‡å®šå…·ä½“å“ªä¸ª**base**ã€å“ªä¸ª**æè¿°ç¬¦**ï¼Œå“ªç§**äº‹ä»¶**ï¼Œç»‘å®š**å›è°ƒå‡½æ•°**å’Œ**å‚æ•°**\n    1. æœ‰å“ªäº›äº‹ä»¶ï¼šIOäº‹ä»¶ï¼ˆ`fd`ã€`EV_READ`ã€`fun_cb`ï¼‰ã€ä¿¡å·äº‹ä»¶ï¼ˆ`sig`ã€`EV_SIGNAL`ã€`sig_cb`ï¼‰ã€å®šæ—¶å™¨äº‹ä»¶ï¼ˆ`-1`ã€`EV_TIMEOUT`ã€`tv_cb`ï¼‰\n3. å¼€å¯äº‹ä»¶å¾ªç¯ï¼Œå®é™…ä¸Šå°±æ˜¯æ¡†æ¶åº•å±‚è°ƒç”¨`select/poll/epoll`\n4. äº‹ä»¶å‘ç”Ÿä¹‹åï¼Œè°ƒç”¨å›è°ƒå‡½æ•°å¦‚`fun_cb`ã€‚\n## ç¤ºä¾‹\n\n```c\n#include<sys/signal.h>\t//SIGINT\n#include<event.h>\nvoid signal_cb(int fd, short event, void * argc)\n{\n    struct event_base* base = (event_base*)argc;\n    struct timeval delay = {2, 0};\n    printf(\"Caught an interrupt signal; exiting cleanly in 2 seconds...\\n\");\n    event_base_loopexit(base, &delay);\n}\nvoid timeout_cb(int fd, short event, void * argc)\n{\n    printf(\"timeout\\n\");\n}\nint main()\n{\n    struct event_base* base = event_init();\n    struct event* signal_event = evsignal_new(base, SIGINT, signal_cb, base);\n    event_add(signal_event, NULL);\n    \n    timeval tv = {1, 0};\n    struct event* timeout_event = evtimer_new(base, timeout_cb, NULL);\n    event_add(timeout_event, &tv);\n    \n    event_base_dispatch(base);\n    \n    event_free(timeout_event);\n    event_free(signal_event);\n    event_base_free(base);\n}\n```\n\nä¸Šé¢çš„ä»£ç æè¿°äº†ä½¿ç”¨Libeventåº“çš„ä¸»è¦é€»è¾‘ï¼š\n\n1. è°ƒç”¨`event_init`å‡½æ•°åˆ›å»º`event_base`å¯¹è±¡ã€‚ä¸€ä¸ª`event_base`ç›¸å½“äºä¸€ä¸ªReactorå®ä¾‹ã€‚\n2. åˆ›å»ºå…·ä½“çš„äº‹ä»¶å¤„ç†å™¨ï¼Œå¹¶è®¾ç½®ä»–ä»¬æ‰€ä»å±çš„Reactorå®ä¾‹ã€‚æœ¬ä¾‹ä¸­çš„**`evsignal_new`**ç”¨äºåˆ›å»ºä¿¡å·äº‹ä»¶å¤„ç†å™¨ï¼Œ**`evtimer_new`**ç”¨äºåˆ›å»ºå®šæ—¶äº‹ä»¶å¤„ç†å™¨ï¼Œ**å®ƒä»¬æ˜¯å®šä¹‰åœ¨`/include/event2/event.h`æ–‡ä»¶ä¸­çš„å®**ï¼Œä»£ç å¦‚ä¸‹ã€‚å…¶ä¸­`evtimer_new`çš„åŸå‹`event_new`çš„ç¬¬äºŒä¸ªå‚æ•°é»˜è®¤èµ‹`-1`ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°é»˜è®¤èµ‹`0`ã€‚\n\n```c\n#define evsignal_new(b, x, cb, arg) \\\nevent_new((b), (x), EV_SIGNAL|EV_PERSIST, (cb), (arg))\n#define evtimer_new(b, cb, arg) \\\nevent_new((b), -1, 0, (cb), (arg))\n```\n3. å›è°ƒå‡½æ•°çš„æ ¼å¼éœ€è¦ç»Ÿä¸€ï¼š`void fun_cb(int fd, short event, void* argc)`\n\n```c\n#include<sys/signal.h>\t//SIGINT\n#include<event.h>\nvoid sig_fun(int fd, short event, void * argc)\n{\n    printf(\"sig=%d\\n\", fd);\n}\nvoid timeout_fun(int fd, short event, void * argc)\n{\n    if(ev & EV_TIMEOUT)\n    {\n        printf(\"timeout\\n\");\n    }\n}\nint main()\n{\n    struct event_base* base = event_init();\n    assert(base != NULL);\n    \n    struct event* sig_ev = evsignal_new(base, SIGINT, sig_fun, NULL);\n    event_add(sig_ev, NULL);\n    \n    struct timeval tv = {5, 0};\n    //å®šæ—¶å™¨ä¸éœ€è¦fdæè¿°ç¬¦ã€ä¹Ÿä¸éœ€è¦ä¿¡å·ä»£å·ã€‚\n    //æ‰€ä»¥ï¼Œç›¸åº”åœ°:\tevtimer_newå¯¹åº”çš„timeout_funå›è°ƒå‡½æ•°ä¸­çš„fdå‚æ•°é»˜è®¤èµ‹-1\n    //\t\t\t\tevtimer_newå¯¹åº”çš„event_newå‡½æ•°çš„ä¿¡å·ä»£å·å‚æ•°é»˜è®¤èµ‹-1 \n    struct event* timeout_ev = evtimer_new(base, timeout_fun, NULL);\n    event_add(timeout_ev, &tv);\n    \n    event_base_dispatch(base);\t//å¼€å¯äº‹ä»¶å¾ªç¯\n    \n    event_free(sig_ev);\n    event_free(timeout_ev);\n    event_base_free(base);\n}\n```\n\n`ctrl+c`ç»ˆæ­¢è¿›ç¨‹çš„ä¿¡å·ä»£å·æ˜¯2ï¼Œä½†æ˜¯ä¿¡å·äº‹ä»¶å¹¶æ²¡æœ‰fdæè¿°ç¬¦ï¼Œè€Œæ˜¯å·§å¦™åœ°å¤ç”¨äº†fdï¼Œå†™å…¥ä¿¡å·ä»£å·ã€‚\n\n## ç¼–è¯‘æµ‹è¯•\n\n`gcc`ç¼–è¯‘é“¾æ¥å‘½ä»¤åéœ€è¦åŠ åç¼€`-levent`ã€‚\n\n# MainServer\n\n```cpp\nclass TcpServer;\nclass ThreadPool;\nclass Reactor;\n\nclass MainServer\n{\nprivate:\n    TcpServer * m_server;\n    ThreadPool * m_pool;\n    Reactor * m_reactor;\npublic:\n    MainServer();\n    ~MainServer();\n    static void ListenEventCallBack(int fd, short events, void * arg);\n    \n};\n```\n\n```cpp\n#include\"mainServer.h\"\n#include\"tcpServer.h\"\nMainServer::Mainserver()\n{\n    m_server = new TcpServer;\n}\nMainServer::~MainServer()\n{\n    m_server = new TcpServer(IpAddressPort{\"127.0.0.1\", 8000});\n    m_pool = new ThreadPool(3);\n    m_reactor = new Reactor();\n    m_reactor->AddEventAndHandler(m_server->GetLfd, EV_READ | EV_PERSIST, MainServer::ListenEventCallBack)\n}\nMainServer::ListenEventCallBack(int fd, short events, void * arg)\n{\n    \n}\n```","categories":["é¡¹ç›®","Linux","ç½‘ç»œ","è®¾è®¡æ¨¡å¼"]},{"title":"Linux_IOå¤ç”¨_select_poll","url":"/Linux/Linux_IOå¤ç”¨_select_poll/","content":"# å†…å®¹\n\n1. åŸºæœ¬æ¦‚å¿µ\n2. äº†è§£æ¥å£socket\n3. äº†è§£åè®®tcp/udp\n4. ioå¤ç”¨\n5. select\n6. poll/epoll\n\nå¯ä»¥å‚è€ƒå­¦ä¹ çš„æ–‡ç« ï¼š\n\n1. [æ·±å…¥æµ…å‡ºç†è§£selectã€pollã€epollçš„å®ç°](https://zhuanlan.zhihu.com/p/367591714)\n2. [linuxåœ¨ç³»ç»Ÿè°ƒç”¨è¿›å…¥å†…æ ¸æ—¶ï¼Œä¸ºä»€ä¹ˆè¦å°†å‚æ•°ä»ç”¨æˆ·ç©ºé—´æ‹·è´åˆ°å†…æ ¸ç©ºé—´ï¼Ÿä¸èƒ½ç›´æ¥è®¿é—®ï¼Œæˆ–æ˜¯ä½¿ç”¨memcpyå—ï¼Ÿéè¦ä½¿ç”¨copy_from_useræ‰è¡Œå—ï¼Ÿ](https://www.zhihu.com/question/19728793) - é’ˆå¯¹ä¸ºä»€ä¹ˆselect/pollè°ƒç”¨ä¸€æ¬¡æ‹·è´ä¸€æ¬¡æ•°ç»„åˆ°å†…æ ¸æ€ç©ºé—´ã€‚\n\n# I/Oå¤ç”¨\n\n1. select\n2. poll\n3. epoll\n\n# select\n\nå…ˆè§‚å¯Ÿå…¶API\n\n```c\n#include<sys/select.h>\nint select(int nfds, fd_set* readfds, fd_set* writefds, fd_set* exceptfds, struct timeval* timeout);\n```\n\n1. å‚æ•°\n   1. `nfds`å‚æ•°é€šå¸¸è¢«è®¾ç½®ä¸º`select`ç›‘å¬çš„æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦ä¸­çš„æœ€å¤§å€¼åŠ 1ï¼Œè¡¨ç¤ºåœ¨`fd_set`é›†åˆä¸­ï¼Œæˆ‘ä»¬å…³å¿ƒçš„æè¿°ç¬¦çš„æ€»æ•°ã€‚ä¸ºä»€ä¹ˆåŠ 1å‘¢ï¼Ÿå› ä¸ºæ–‡ä»¶æè¿°ç¬¦æ˜¯ä»0å¼€å§‹è®¡æ•°çš„ã€‚`nfds`ä¸`fd_setå®¹é‡å¤§å°`ä¸ä¸€æ ·ï¼Œå®¹é‡å¤§å°æŒ‡çš„æ˜¯`FD_SETSIZE`ï¼Œå³`fd_setå®¹é‡å¤§å°`æ˜¯`fd_set`å¯å®¹çº³æè¿°ç¬¦çš„æœ€å¤§å¤§å°ã€‚\n   2. readfdså‚æ•°æ˜¯selectå…³å¿ƒçš„è¯»äº‹ä»¶çš„é›†åˆï¼›\n   3. writefdså‚æ•°æ˜¯selectå…³å¿ƒçš„å†™äº‹ä»¶çš„é›†åˆï¼›\n   4. exceptfdså‚æ•°selectå…³å¿ƒçš„å¼‚å¸¸äº‹ä»¶çš„é›†åˆï¼›\n   5. timeoutå‚æ•°è®¾ç½®selectçš„è¶…æ—¶æ—¶é—´ã€‚\n2. è¿”å›å€¼\n   1. é›†åˆä¸­æœ‰äº‹ä»¶å°±ç»ªçš„æè¿°ç¬¦çš„ä¸ªæ•°\n   2. ä½†æ˜¯å¹¶æ²¡æœ‰å‘Šè¯‰ä½ å…·ä½“æ˜¯å“ªä¸€ä¸ªæè¿°ç¬¦å°±ç»ª\n\n## fd_setç»“æ„ä½“\n\n```c\n#include<typesizes.h>\n#define __FD_SETSIZE 1024\n\n#include<sys/select.h>\n#define FD_SETSIZE __FD_SETSIZE\ntypedef long int __fd_mask;\n#undef __NFDBITS\n#define __NFDBITS (8*(int)sizeof(__fd_mask))\ntypedef struct\n{\n#ifdef __USE_XOPEN\n    __fd_mask fds_bits[__FD_SETSIZE / __NFDBITS];\n#define __FDS_BITS(set) ((set)->fds_bits)\n#else\n    __fd_mask __fds_bits[__FD_SETSIZE / __NFDBITS];\n#define __FDS_BITS(set) ((set)->__fds_bits)\n#endif\n}fd_set;\n-------------------\n#define FD_SETSIZE 1024\n#define NFDBITS (8*(int)sizeof(long int))\ntypedef struct\n{\n    long int fds_bits[FD_SETSIZE / NFDBITS];\n}fd_set;\n```\n\nå…¶ä¸­ï¼Œ`__FD_SETSIZE`æŒ‡å‡ºselectå¯ä»¥å…³æ³¨çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦ä¸ªæ•°ï¼Œé»˜è®¤ä¸º1024ã€‚\n\n`__fd_mask`è¢«å®šä¹‰ä¸º`long int`çš„ç±»å‹åˆ«ç§°ï¼Œ`long int`åœ¨32ä½æœºå 8ä¸ªå­—èŠ‚ã€‚\n\n`__NFDBITS`è®¡ç®—çš„æ˜¯1ä¸ª`__fd_mask`å…ƒç´ æ‰€å ç”¨çš„ä½æ•°ï¼Œä¸€ä¸ªå­—èŠ‚å 8ä½ï¼Œsizeofç®—å‡º`__fd_mask`çš„å­—èŠ‚æ•°ï¼Œç›¸ä¹˜å¾—å…¶å ç”¨çš„bitå¤§å°ã€‚\n\næ¥ç€ï¼Œå®šä¹‰`fds_bits`ï¼Œå…¶æ˜¯`long int`å‹çš„æ•°ç»„ï¼Œæ•°ç»„å¤§å°ä¸º`__FD_SETSIZE`é™¤ä»¥`__NFDBITS`ã€‚æ¯”å¦‚`SETSIZE`ä¸º1024ä½ï¼Œ`NFDBITS`æ˜¯64ä½ï¼Œåˆ™æ•°ç»„å¤§å°ä½`1024/64=16`ã€‚è¿™é‡Œçš„è®¡ç®—ä¸»è¦æ˜¯ä¸ºäº†è®¡ç®—å‡ºæ•°ç»„çš„å¤§å°ï¼Œä»¥ç¡®å®šå¤šå¤§çš„æ•°ç»„å¯ä»¥æ­£å¥½å®¹çº³`1024`ä¸ªä½æ•°ï¼Œæ¥è®°å½•æ–‡ä»¶æè¿°ç¬¦ä¿¡æ¯ã€‚\n\n## ç”¨åˆ°çš„å®å‡½æ•°\n\n`fd_set`é›†åˆå¯¹äºæ–‡ä»¶æè¿°ç¬¦çš„ç®¡ç†æ˜¯æŒ‰ä½è¿›è¡Œçš„ï¼Œè€Œä½åªæœ‰0å’Œ1ä¸¤ç§çŠ¶æ€ã€‚\n\nå‡å¦‚`SETSIZE=1024`ï¼Œåˆ™å¯ç®¡ç†1024ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æœ`æ–‡ä»¶æè¿°ç¬¦7`æœ‰æ•ˆï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä½æ“ä½œï¼Œä½¿å…¶ä½å˜ä¸º`1`ã€‚\n\nç”±äºä½æ“ä½œè¿‡äºç¹çï¼Œselect APIä¸­æä¾›äº†ä¸€ç³»åˆ—å®å‡½æ•°æ¥æ–¹ä¾¿æˆ‘ä»¬è®¿é—®ã€æ“ä½œ`fd_set`é›†åˆçŠ¶æ€ã€‚\n\n```c\n#include<sys/select.h>\nFD_ZERO(fd_set *fdset);\t\t\t\t/*æ¸…é™¤fdsetçš„æ‰€æœ‰ä½*/\nFD_SET(int fd, fd_set *fdset);\t\t/*è®¾ç½®fdsetçš„ä½fd*/\nFD_CLR(int fd, fd_set *fdset);\t\t/*æ¸…é™¤fdsetçš„ä½fd*/\nint FD_ISSET(int fd, fd_set *fdset);/*æµ‹è¯•fdsetçš„ä½fdæ˜¯å¦è¢«è®¾ç½®*/\n```\n\n## selectç¼–ç¨‹æ€è·¯\n\næœ€å¥½å¦å¤–å®šä¹‰ä¸€ä¸ªæ•´å‹æ•°ç»„ï¼Œå…¶å¤§å°ä¸ºæˆ‘ä»¬é¢„æµ‹å°†è¦å‡ºç°çš„æè¿°ç¬¦çš„æœ€å¤šæ•°ç›®ã€‚ç”¨ä½œæˆ‘ä»¬å­˜æ”¾æè¿°ç¬¦çš„å®¹å™¨ã€‚åˆå§‹åŒ–æ—¶å°†æ•°ç»„å€¼ä¸€å¾‹è®¾ä¸º`-1`ï¼Œè¡¨ç¤ºå®¹å™¨ä¸­è¯¥ä½ç½®è¿˜æ²¡æœ‰å­˜æ”¾æè¿°ç¬¦ã€‚å¦‚æœåœ¨æŸä¸€æ—¶åˆ»æœ‰ä¸€ä¸ªæè¿°ç¬¦æœ‰äº†æ¶ˆæ¯ï¼Œæˆ‘ä»¬å°±å°†è¯¥æè¿°ç¬¦æ•°å€¼è¦†ç›–åˆ°è¿™ä¸ªå®¹å™¨ä¸­ç¬¬ä¸€ä¸ªä¸º`-1`çš„åœ°æ–¹ã€‚\n\n```c\n#define MAX 10\nvoid fds_init(int fds[])\n{\n    for(int i = 0;i<MAX;++i)\n    {\n        fds[i] = -1;\n    }\n}\nvoid fds_add(int fd, int fds[])//å‘fdså®¹å™¨ä¸­æ·»åŠ æè¿°ç¬¦fd\n{\n    if(fd<0)\n    {\n        printf(\"æ— æ•ˆçš„æè¿°ç¬¦\\n\");\n        return;\n    }\n    for(int i = 0;i<MAX;++i)\n    {\n        if(fds[i]==-1)\n        {\n            fds[i] = fd;\n            return;\n        }\n    }\n    printf(\"å®¹å™¨å·²æ»¡ï¼Œæ— æ³•æ·»åŠ è¯¥æè¿°ç¬¦\\n\");\n}\nvoid fds_del(int fd, int fds[])\n{\n    for(int i = 0;i<MAX;++i)\n    {\n        if(fds[i]==fd)\n        {\n            fds[i] = -1;\n            return;\n        }\n    }\n    printf(\"æ²¡æœ‰æ‰¾åˆ°è¯¥æè¿°ç¬¦\\n\");\n}\nint main()\n{\n    int fds[MAX];\n    fds_init(fds);\n}\n```\n\n## ç¤ºä¾‹-TCPæœåŠ¡ä½¿ç”¨selectå¤„ç†å¤šä¸ªå¥—æ¥å­—\n\n```c\nint main()\n{\n    int sockfd = socket_init();//socket_initå°è£…äº†bind(ip:port)çš„æ“ä½œï¼Œè¿˜å°è£…äº†å¯¹sockfdè¿›è¡Œlistençš„æ“ä½œï¼Œå¹¶è®¾ç½®äº†ç›‘å¬é˜Ÿåˆ—å¤§å°ã€‚\n    assert(sockfd!=-1);\n    \n    int fds[MAX];\n    fds_init(fds);\n    \n    fds_add(sockfd, fds);\n    \n    fd_set fdset;//æ­¤å¤„çš„fd_setå³<sys/select.h>åº“ä¸­APIæä¾›çš„fd_setç»“æ„ä½“ï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªæœ‰1024ä¸ªâ€œäºŒè¿›åˆ¶ä½â€çš„æ•°ç»„ã€‚\n    while(1)//å°†fds[MAX]ä¸­æ‰€æœ‰æœ‰æ•ˆçš„(å³>=0)æè¿°ç¬¦å…¨éƒ¨â€œåŠ å…¥â€fdsetä¸­ï¼Œ\n    //å³æŠŠfdsetä¸­ä¸æŸæœ‰æ•ˆæè¿°ç¬¦å¯¹åº”çš„[ä½]çš„çŠ¶æ€è®¾ä¸º1ã€‚\n    {\n        FD_ZERO(&fdset);\t//æŠŠ1024ä½å…¨æ¸…é›¶ã€‚\n        int maxfd = -1;//è®°å½•å½“å‰æœ€å¤§çš„æè¿°ç¬¦æ•°å€¼æ˜¯å¤šå°‘ï¼Œæ–¹ä¾¿è¿‡åè°ƒç”¨selectä¼ å…¥å‚æ•°nfdsã€‚\n        for(int i = 0; i<MAX; ++i)\n        {\n            if(fds[i] == -1)\n            {\n                continue;\n            }\n            FD_SET(fds[i],fdset);\t//fds[i] != -1, è¯´æ˜æœ‰æ•ˆ\n            if(maxfd<fds[i])//å¯»æ‰¾æœ€å¤§æè¿°ç¬¦æ•°å€¼\n            {\n                maxfd = fds[i];\n            }\n        }//end for\n        \n    \t//æ­¤æ—¶ï¼Œæˆ‘ä»¬å·²ç»æŠŠå¼€å§‹åˆ›å»ºçš„sockfdæ·»åŠ åˆ°äº†fdsetä¸­ã€‚\n        //ä¸‹é¢å°±å¯ä»¥ç”¨selectæ¥ç›‘æµ‹è¯¥å¥—æ¥å­—æ˜¯å¦æœ‰æ¶ˆæ¯äº†ã€‚\n        //æ¯”å¦‚ï¼Œsockfdç›‘å¬åˆ°äº†å®¢æˆ·ç«¯çš„connectä¿¡æ¯ï¼Œ\n        //åˆ™selectå°±å¯ä»¥æ¢æµ‹åˆ°fdsetä¸­å¯¹åº”çš„sockfdä½å¤„äºæ¶ˆæ¯å°±ç»ªæ€ï¼Œ\n        //åˆ™selectå°±å¯ä»¥ä¸å†é˜»å¡ï¼Œç«‹é©¬è¿”å›ã€‚\n        struct timeval tv = {5,0};\n        //è¿”å›åœ¨fdseté›†åˆä¸­æœ‰ä¿¡æ¯çš„æè¿°ç¬¦çš„ä¸ªæ•°ã€‚\n        int n = select(maxfd+1, &fdset, NULL, NULL, &tv);\n        if(n < 0)\n        {\n            printf(\"select err\\n\");\n        }\n        else if(n == 0)\n        {\n            printf(\"time out\\n\");\n        }\n        else\n        {\n            for(int i = 0; i<MAX; ++i)//ä¾ç„¶éœ€è¦æ ¹æ®fdsetæŸ¥è¯¢:\n            //ç›®å‰æ˜¯å“ªä¸ªæè¿°ç¬¦æœ‰äº‹ä»¶äº§ç”Ÿï¼Œ\n            //fdsetçš„è¿‡æ»¤åˆéœ€è¦æ ¹æ®fdsçš„è®°å½•è¿›è¡Œéå†ã€‚\n            {\n                if(fds[i] == -1)continue;\n                if(FD_ISSET(fds[i], &fdset))//æ­¤å¤„åˆ¤æ–­ISSET\n                //å³æ˜¯åˆ¤æ–­æˆ‘ä»¬å…³æ³¨çš„æè¿°ç¬¦æ˜¯å¦æœ‰äº‹ä»¶äº§ç”Ÿã€‚\n                //ä¸ºä»€ä¹ˆæ­¤æ—¶æ ‡å¿—ä½ä¸º1ä¸€å®šæœ‰äº‹ä»¶äº§ç”Ÿï¼Ÿ\n                //å› ä¸ºåœ¨è¿™ä¹‹å‰æˆ‘ä»¬è¿›è¡Œäº†selectï¼Œ\n                //selectä¸ä»…è¯´æ˜æœ‰äº‹ä»¶äº§ç”Ÿï¼Œå®ƒè¿˜åšäº†æ›´å¤šçš„å·¥ä½œï¼š\n                //å°†æˆ‘ä»¬å…³å¿ƒçš„æè¿°ç¬¦å´åœ¨å…¶ä¸Šæ²¡æœ‰äº‹ä»¶äº§ç”Ÿçš„æ ‡å¿—ä½ç½®0ã€‚\n                //å› æ­¤ç›®å‰æ‰€æœ‰æ ‡å¿—ä½ä¸º1çš„æè¿°ç¬¦å‡æœ‰äº‹ä»¶ã€‚\n                {\n                    //ä»¥ä¸‹æ‰æ˜¯æ ¸å¿ƒä¸šåŠ¡ä»£ç ,æŠ“ä½äº†æœ‰äº‹ä»¶äº§ç”Ÿçš„æè¿°ç¬¦,\n                    //å¯¹è¿™äº›æè¿°ç¬¦æˆ‘ä»¬çš„å¤„ç†æµç¨‹,å¯¹äºä¸åŒç±»å‹çš„æè¿°ç¬¦\n                    //éœ€è¦ä¸åŒçš„å¤„ç†æµç¨‹ã€‚æ¯”å¦‚sockfdç”¨acceptå¤„ç†ï¼Œ\n                    //acceptè¿”å›1ä¸ªæ–°æè¿°ç¬¦c,åˆ™å…ˆå°†å…¶åŠ å…¥fdså®¹å™¨,\n                    //ä¸‹ä¸€è½®å†ç”¨recvå¤„ç†æè¿°ç¬¦cçš„æ¶ˆæ¯ã€‚\n                    if(fds[i] == sockfd)//å¤„ç†ç›‘å¬å¥—æ¥å­—sockfd\n                    {\n                        struct sockaddr_in caddr;\n                        int len = sizeof(caddr);\n                        int c = accept(sockfd, (struct sockaddr*)&caddr, &len);\n                        if(c < 0)\n                        {\n                            continue;\n                        }\n                        printf(\"accept c = %d\\n\", c);\n                        //æ­¤å¤„çš„fds_addæ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°ï¼Œæ·»åŠ çš„æ˜¯fdsè‡ªå®šä¹‰æ•°ç»„\n                        fds_add(c, fds);//åªæ˜¯æ”¶åˆ°fdså®¹å™¨ï¼Œä¸‹æ¬¡whileæ‰«ææ‰å°†cåŠ åˆ°fdset\n                    }\n                    else//å¤„ç†æ”¶å‘å¥—æ¥å­—ï¼Œåœ¨æ­¤ç¨‹åºï¼Œé™¤äº†sockfdçš†ä¸ºæ”¶å‘å¥—æ¥å­—c\n                    {\n                        char buff[128] = {0};\n                        int num = recv(fds[i], buff, 127, 0);\n                        if(num <= 0)\n                        {\n                            printf(\"client close\\n\");\n                            close(fds[i]);\n                            fds_del(fds[i], fds);\n                        }\n                        else//num > 0ï¼Œè¯»åˆ°äº†æ•°æ®\n                        {\n                            printf(\"recv(c = %d) = %s\\n\",fds[i],buff);\n                            send(fds[i], \"ok\", 2, 0);\n                        }\n                    }\n                }//end if(ISSET(fds[i], &fdset))\n            }//end for(int i = 0; i<MAX; ++i)\n        }//end if(n > 0)\n    }//while end\n}\n```\n\nåœºæ™¯æƒ…å†µï¼šå¦‚æœå®¢æˆ·ç«¯ä¸selectæœåŠ¡ç«¯å·²å»ºç«‹è¿æ¥ï¼Œè€Œå®¢æˆ·ç«¯è¿›ç¨‹ç»“æŸï¼Œselectä¼šä¸€ç›´é˜»å¡ã€æœªæ„ŸçŸ¥å—ï¼Ÿ--ä¸ä¼šã€‚\n\nå› ä¸ºå®¢æˆ·ç«¯çš„è¿›ç¨‹ç»“æŸï¼Œä¹Ÿç®—æ˜¯ä¸€ç§è¯»äº‹ä»¶ï¼Œç›¸å½“äºé€šçŸ¥æœåŠ¡ç«¯è¯¥å¥—æ¥å­—è¿æ¥ç»“æŸäº†ã€‚é‚£ä¹ˆæœåŠ¡ç«¯recvä¼šè¿”å›0ï¼Œè¾¾åˆ°å…³é—­è¯¥å¥—æ¥å­—çš„æ¡ä»¶ï¼Œå…³é—­åï¼Œåˆ«å¿˜äº†åœ¨fdså®¹å™¨ä¸­åˆ é™¤æ‰è¯¥æè¿°ç¬¦ã€‚\n\nå¦‚æœå¿˜è®°äº†closeè¯¥å¥—æ¥å­—ï¼Œä¸”å¿˜äº†`fds_del`è¯¥æè¿°ç¬¦ï¼Œé‚£ä¹ˆå¦‚æœå®¢æˆ·ç«¯ç»“æŸè¿›ç¨‹ï¼ŒæœåŠ¡ç«¯å°±ä¼šä¸€ç›´æ‰“å°\"`client close`\"ï¼Œå› ä¸ºselectä¸€ç›´åœ¨æ¢æµ‹æ­¤æè¿°ç¬¦æœ‰æ— è¯»äº‹ä»¶ï¼Œè‹¥è¯¥å¥—æ¥å­—è¿æ¥å…³é—­ï¼Œé‚£ä¹ˆæ­¤æè¿°ç¬¦ä¸€ç›´æœ‰è¯»äº‹ä»¶ï¼Œ`recv`è¿”å›0ï¼Œç”±äºæ²¡æœ‰`fds_del`ï¼Œæ¯æ¬¡éƒ½ä¼šå…³æ³¨ï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½ä¼šæ‰“å°\"`client close`\"ã€‚\n\n# poll\n\nå¯ä»¥ç†è§£ä¸ºåŠ å¼ºç‰ˆçš„selectã€‚\n\nå…ˆè§‚å¯Ÿå…¶API\n\n```c\n#include<poll.h>\nint poll(struct pollfd* fds, nfds_t nfds, int timeout);\n```\n\n1. fdså‚æ•°æ˜¯ä¸€ä¸ª`pollfd`ç»“æ„ç±»å‹çš„æŒ‡é’ˆï¼Œå¯æŒ‡å‘ä¸€æ®µè¿ç»­ç©ºé—´ï¼ˆæ•°ç»„ï¼‰ï¼Œå› æ­¤å¾ˆçµæ´»ï¼Œ**å¤§å°å¯æŒ‰éœ€å£°æ˜**ã€‚å®ƒå¯ä»¥æŒ‡å®šæˆ‘ä»¬æ„Ÿå…´è¶£çš„æ–‡ä»¶æè¿°ç¬¦ä¸Šå‘ç”Ÿçš„å¯è¯»ã€å¯å†™å’Œå¼‚å¸¸ç­‰äº‹ä»¶ã€‚å®šä¹‰å¦‚ä¸‹\n\n   ```c\n   struct pollfd\n   {\n       int fd;\t\t\t//æ–‡ä»¶æè¿°ç¬¦\n       short events;\t//æ³¨å†Œçš„äº‹ä»¶ç±»å‹ï¼ŒæŒ‰ä½æ ‡å¿—\n       short revents;\t//å®é™…å‘ç”Ÿçš„äº‹ä»¶ï¼ŒæŒ‰ä½æ ‡å¿—ï¼Œç”±å†…æ ¸å¡«å……\n   }\n   ```\n\n   1. å…¶ä¸­ï¼Œfdæˆå‘˜æŒ‡å®šæ–‡ä»¶æè¿°ç¬¦ã€‚\n   2. eventsæˆå‘˜å‘Šè¯‰pollç›‘å¬fdä¸Šçš„å“ªäº›äº‹ä»¶ç±»å‹ï¼Œä»–å¯ä»¥æ˜¯ä¸€ç³»åˆ—äº‹ä»¶ç±»å‹çš„**æŒ‰ä½æˆ–**ã€‚å¸¸è§çš„äº‹ä»¶ç±»å‹æœ‰ï¼š`POLLIN`(æ•°æ®å¯è¯»)ã€`POLLOUT`(æ•°æ®å¯å†™)ã€‚\n   3. reventsæˆå‘˜ç”±å†…æ ¸ä¿®æ”¹ï¼Œä»¥é€šçŸ¥åº”ç”¨ç¨‹åºfdä¸Šå®é™…å‘ç”Ÿäº†å“ªäº›äº‹ä»¶ã€‚\n\n## pollç¼–ç¨‹\n\n```c\nvoid poll_fds_init(struct pollfd* fds)\n{\n    for(int i = 0;i<MAX;++i)\n    {\n        fds[i].fd = -1;\n        fds[i].events = 0;\n        fds[i].revents = 0;\n    }\n}\nvoid poll_fds_add(int fd, struct pollfd* fds)\n{\n    for(int i = 0;i<MAX;++i)\n    {\n        if(fds[i].fd == -1)\n        {\n            fds[i].fd = fd;\n            fds[i].events = POLLIN;//åªå…³æ³¨è¯»äº‹ä»¶\n            fds[i].revents = 0;\n            break;\n        }\n    }\n}\nvoid poll_fds_del(int fd, struct pollfd* fds)\n{\n    for(int i = 0;i<MAX;++i)\n    {\n        if(fds[i].fd == fd)\n        {\n            fds[i].fd = -1;\n            fds[i].events = 0;\n            fds[i].revents = 0;\n            break;\n        }\n    }\n}\n#define MAX 10\nint main()\n{\n    int sockfd = socket_init();\n    assert(sockfd != -1);\n    struct pollfd poll_fds[MAX];\n    poll_fds_init(poll_fds);\n    poll_fds_add(sockfd,poll_fds);\n    while(1)\n    {\n        int n = poll(poll_fds,MAX,5000);//5000ms timeout \n        if(n < 0)printf(\"poll error\\n\");\n        else if(n == 0)printf(\"time out \\n\");\n        else\n        {\n            for(int i = 0;i<MAX;++i)\n            {\n                if(poll_fds[i].fd == -1)continue;\n                //short has 16bits,POLLIN is 10000000 ...,\n                //when revents is 10000000 ...,then the read event is going\n                if(poll_fds[i].revents & POLLIN)//revents & POLLIN ä¸ä¸º0 åˆ™ä»£è¡¨æœ‰è¯»äº‹ä»¶äº§ç”Ÿ\n                {\n                    if(poll_fds[i].fd == sockfd)\n                    {\n                        struct sockaddr_in caddr;\n                        int len = sizeof(caddr);\n                        int c = accept(sockfd, (struct sockaddr*)&caddr, &len);\n                        if(c < 0)\n                        {\n                            continue;\n                        }\n                        printf(\"accept:%d\\n\", c);\n                        poll_fds_add(c, poll_fds);\n                    }\n                    else\n                    {\n                        char buff[128] = {0};\n                        int num = recv(poll_fds[i].fd, buff, 127, 0);\n                        if(num <= 0)\n                        {\n                            close(poll_fds[i].fd);\n                            poll_fds_del(poll_fds[i].fd, poll_fds);\n                            printf(\"client close\\n\");\n                        }\n                        else\n                        {\n                            printf(\"recv(%d):%s\\n\", poll_fds[i].fd, buff);\n                            send(poll_fds[i].fd, \"ok\", 2, 0);\n                        }\n                    }\n\n                }\n                if(poll_fds[i].revents & POLLOUT)\n                {\n\t\t\t\t\t//...\n                }\n            }\n        }\n    }    \n}\n```\n\nä¸selectçš„ä¸€å¤„ç»†èŠ‚åŒºåˆ«ï¼š\n\næ¯æ¬¡selecté™¤äº†ç›‘æµ‹`fd_set`æœ‰æ•ˆæè¿°ç¬¦ä¸Šæœ‰æ— äº‹ä»¶ï¼Œå…¶æ¬¡è¿˜å°†æ²¡æœ‰äº‹ä»¶çš„æè¿°ç¬¦ä»`fd_set`ç§»é™¤ï¼ˆå°†è¯¥æè¿°ç¬¦å¯¹åº”åœ¨`fd_set`ä¸Šçš„ä½è¿›è¡Œ`ç½®0`æ“ä½œï¼‰ï¼ˆ**è¿™æ ·å°±å¾—æ¯æ¬¡selectä¹‹å‰éƒ½è¦é‡æ–°æ³¨å†Œä¸€éæˆ‘ä»¬å…³æ³¨çš„æè¿°ç¬¦ï¼ˆå³ç”¨æˆ·å’Œå†…æ ¸å…±åŒæ“ä½œFD_SETã€FD_CLRç­‰ï¼‰**ï¼‰ï¼Œç„¶åä¸‹é¢è¿‡æ»¤æœ‰äº‹ä»¶çš„æè¿°ç¬¦æ—¶ï¼Œåªè¦æ‰¾åˆ°`fd_set`é›†åˆå“ªä¸ªä½æ˜¯1çŠ¶æ€å³å°±æ‰¾åˆ°äº†æœ‰äº‹ä»¶äº§ç”Ÿçš„æè¿°ç¬¦ã€‚\n\nè€Œpollçš„ç”¨æ³•æ˜¯ï¼šç”¨æˆ·åªç®¡æ³¨å†Œ`events`ï¼Œå®é™…ä¸Šçš„æœ‰æ— äº‹ä»¶**ç”±å†…æ ¸æ¥è¿›è¡Œå¯¹`revents`çš„å¡«å……**ï¼Œä»¥æ­¤æ¥æ›´å¥½åœ°åŒºåˆ«è¯¥æè¿°ç¬¦æ˜¯å¦æœ‰äº‹ä»¶äº§ç”Ÿã€‚**è¿™æ ·ï¼Œå°±ä¸ç”¨åœ¨æ¯æ¬¡pollä¹‹å‰é‡æ–°æ³¨å†Œä¸€éæˆ‘ä»¬å…³æ³¨çš„æè¿°ç¬¦çš„ç»“æ„ä½“é‡Œçš„`events`äº†**ã€‚æˆ‘ä»¬åªè¦æŠŠè¦å…³å¿ƒçš„æè¿°ç¬¦çš„`fd`ç½®æˆ`é-1`ï¼Œä»¥åŠç®¡ç†å¥½è¦å…³å¿ƒçš„å“ªäº›äº‹ä»¶ç±»å‹`events`å³å¯ã€‚\n\n## ä¸selectç›¸æ¯”çš„ä¼˜ç‚¹\n\n1. å¯ä»¥ç›‘å¬çš„æè¿°ç¬¦çš„æœ€å¤§æ•°ç›®å¯ä»¥è¶…è¿‡`1024`ä¸ªï¼Œå¤§å°æŒ‰éœ€è‡ªæ‹Ÿã€‚\n2. å¯ä»¥ç›‘å¬çš„äº‹ä»¶ç±»å‹æ•°ç›®å˜å¤šã€å˜ç»†äº†ï¼Œæ›´å¼ºå¤§äº†ã€‚\n3. **ä¸ç”¨**åœ¨æ¯æ¬¡`poll`ä¹‹å‰**é‡æ–°æ³¨å†Œ**ä¸€éæˆ‘ä»¬å…³æ³¨çš„æè¿°ç¬¦çš„ç»“æ„ä½“é‡Œçš„`events`äº†\n\n# æ€»ç»“\n\nselectå’Œpollçš„æ€»ä½“å®ç°æµç¨‹ï¼š\n* ç”¨æˆ·ç¨‹åº\n\nselectç”¨`fd_set`ç»“æ„ä½“ï¼ˆé»˜è®¤æ˜¯1024ä¸ªbitä½çš„æ•°ç»„ï¼‰ï¼›pollç”¨`struct pollfd fds[MAX]`ç»“æ„ä½“ã€‚\n\nselectå’Œpollé€šå¸¸è¢«å¾ªç¯è°ƒç”¨ã€‚æ¯è°ƒç”¨ä¸€æ¬¡ï¼Œå°±æ‹·è´ä¸€æ¬¡ç»“æ„ä½“æ•°ç»„ç»™å†…æ ¸ã€‚\n\n> [linuxåœ¨ç³»ç»Ÿè°ƒç”¨è¿›å…¥å†…æ ¸æ—¶ï¼Œä¸ºä»€ä¹ˆè¦å°†å‚æ•°ä»ç”¨æˆ·ç©ºé—´æ‹·è´åˆ°å†…æ ¸ç©ºé—´ï¼Ÿä¸èƒ½ç›´æ¥è®¿é—®ï¼Œæˆ–æ˜¯ä½¿ç”¨memcpyå—ï¼Ÿéè¦ä½¿ç”¨copy_from_useræ‰è¡Œå—ï¼Ÿ](https://www.zhihu.com/question/19728793) - é’ˆå¯¹ä¸ºä»€ä¹ˆselect/pollè°ƒç”¨ä¸€æ¬¡æ‹·è´ä¸€æ¬¡æ•°ç»„åˆ°å†…æ ¸æ€ç©ºé—´ã€‚\n\n* å†…æ ¸è½®è¯¢\nå†…æ ¸å¯¹è‹¥å¹²ä¸ªæ–‡ä»¶æè¿°ç¬¦è¿›è¡Œè½®è¯¢æ‰«æã€‚æŸ¥çœ‹ä¹‹ä¸Šæ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿã€‚\næ—¶é—´å¤æ‚åº¦ï¼Œä¸ºO(n)\n* select/pollè¿”å›å\nè¿”å›å€¼ä»…ä»…å‘Šè¯‰ç”¨æˆ·ç¨‹åºå‘ç”Ÿäº†äº‹ä»¶çš„æè¿°ç¬¦ä¸ªæ•°ï¼Œå¹¶æœªå‘Šè¯‰å…·ä½“å“ªä¸ªæè¿°ç¬¦ã€‚\nç”¨æˆ·ç¨‹åºè¿˜éœ€è¦å†æ¬¡è½®è¯¢ä¸€éã€‚O(n)\n![select](../../images/Linux_IOå¤ç”¨_select&poll/select.mp4)\n\n","categories":["Linux","ç½‘ç»œ"]},{"title":"å¯¹è±¡æ± ","url":"/é¡¹ç›®/å¯¹è±¡æ± /","content":"\n# å†…å®¹\n\n1. å…³è”å…³ç³»\n2. ä¸€çº§é…ç½®å™¨å’ŒäºŒçº§é…ç½®å™¨çš„å…³ç³»\n3. ç±»å‹èƒå–\n4. allocator\n5. `__malloc_alloc_template`é™æ€æˆå‘˜çš„ç±»å¤–åˆå§‹åŒ–ï¼Œå…¶ä¸­å‡½æ•°æŒ‡é’ˆå°¤ä¸ºéº»çƒ¦\n\n# å…³è”å…³ç³»\n\nå¼±å…³è”\n\n```cpp\nclass Person\n{\nprivate:\n    Book * pbook;\npublic:\n    Student(){}\n    ~Student(){}\t//ä¸èƒ½ææ„book\n}\n```\n\n\n\nå¼ºå…³è”\n\n```cpp\nclass Person\n{\nprivate:\n    Book & book;\npublic:\n    Student(Book & book) : _book(book){}\n}\n```\n\n# èšåˆ/ç»„åˆå…³ç³»\n\n```cpp\nclass Point\n{\nprivate:\n    float _x;\n    float _y;\npublic:\n    Point(float x = 0.0f, float y = 0.0f) : _x(x), _y(y){}\n    Point(const Point&) = default;\n    Point & operator=(const Point&) = default;\n    ~Point(){}\n}\n```\n\n# new\n\n1. sizeof\n2. åˆ†é…å­—èŠ‚ç©ºé—´\n3. æ„å»º è¿”å›åœ°å€\n\n# delete\n\n1. ææ„\n2. ç©ºé—´é‡Šæ”¾\n\n# äºŒçº§é…ç½®å™¨\n\n* ä¸€çº§é…ç½®å™¨çš„é—®é¢˜\n    * ç›´æ¥çš„mallocåçš„æ•°æ®ä¸Šä¸‹å„æœ‰ä¸€ä¸ªè¶Šç•Œæ ‡è®°ã€‚ä¸Šè¶Šç•Œæ ‡è®°ä¹‹å¤–è¿˜æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”³è¯·äº†å¤šå°‘å­—èŠ‚ï¼Œè¿˜æœ‰nextåŸŸã€prevåŸŸä»¥ä¾¿è¿æ¥åˆ°é“¾è¡¨ä¸­è¿›è¡Œå†…å­˜ç®¡ç†ã€‚é™¤æ­¤ä¹‹å¤–å¯èƒ½è¿˜æœ‰æœ‰æ•ˆ/å¤±æ•ˆ(æ˜¯å¦é‡Šæ”¾)çš„æ ‡è®°ã€‚\n    * é™¤äº†åŒ…è£…ä¿¡æ¯å ç©ºé—´è¾ƒå¤šä¹‹å¤–ï¼Œè¿˜æœ‰mallocæ—¶èŠ±è´¹çš„æ—¶é—´ä¹Ÿå¤šã€‚è¿™æ ·å°±é€ æˆå¯¹äºæ¯”è¾ƒå°çš„å¯¹è±¡æ•°æ®åœ¨mallocæ—¶å…¥ä¸æ•·å‡ºã€‚\n    * ç»“è®ºå°±æ˜¯ï¼šå¯¹äºè¾ƒå°æ•°æ®ï¼Œé€‚ç”¨äºå†…å­˜æ± æ¥è¿›è¡Œå†…å­˜ç®¡ç†ã€‚\n* **å¯¹äºå®¢æˆ·ç«¯ç”³è¯·è¾ƒå°ç©ºé—´ï¼ˆ128bytesï¼‰çš„å…·ä½“å¤„ç†æµç¨‹**ï¼š\n    1. æ¯æ¬¡é…ç½®ä¸€å¤§å—å†…å­˜ï¼Œå¹¶ç»´æŠ¤å¯¹åº”çš„è‡ªç”±é“¾è¡¨(free-list)\n    2. ä¸‹æ¬¡å¦‚æœå†æœ‰ç›¸åŒå¤§å°çš„å†…å­˜éœ€æ±‚ï¼Œç›´æ¥ä»free-listä¸­å–å‡ºè‹¥å¹²å°å—ã€‚\n    3. å¦‚æœå®¢æˆ·ç«¯é‡Šæ”¾å°å—å†…å­˜ï¼Œå°±ç”±é…ç½®å™¨å›æ”¶åˆ°free-listä¸­ã€‚æ‰€ä»¥é…ç½®å™¨é™¤äº†åˆ†é…ç©ºé—´ï¼Œè¿˜è´Ÿè´£å›æ”¶ç©ºé—´ã€‚\n* ä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼ŒSGIç¬¬äºŒçº§é…ç½®å™¨ä¼šä¸»åŠ¨æŒ‰ä»»ä½•å°å—å†…å­˜çš„å†…å­˜éœ€æ±‚é‡è®¡ç®—æˆ8çš„å€æ•°ã€‚ï¼ˆæ¯”å¦‚å®¢æˆ·ç«¯è¦æ±‚30bytesï¼Œåˆ™è®¡ç®—ä¸º32bytesã€‚\n* å…±ç»´æŠ¤16ä¸ªfree-listsï¼Œå„è‡ªç®¡ç†å¤§å°åˆ†åˆ«ä¸º8ã€16ã€24ã€32ã€40ã€48ã€56ã€64ã€72ã€80ã€88ã€96ã€104ã€112ã€120ã€128çš„å°é¢åŒºå—ã€‚\n* free-listsçš„å•ç»“ç‚¹ç»“æ„å¦‚ä¸‹ï¼š\n\n```cpp\nunion obj\n{\n  union obj * free_list_link;\n  char client_data[1];\t//the client sees this\n}\n```\n\n## æ€»è§ˆ\n\n```c++\nenum { __ALIGN = 8};\nenum { __MAX_BYTES = 128};\nenum { __NFREELISTS = __MAX_BYTES / __ALIGN};\t// 128 / 8 = 16\n```\n\n```c++\ntemplate<bool threads, int inst>\t//å‚æ•°1ï¼šæ˜¯å¦è€ƒè™‘å¤šçº¿ç¨‹ï¼Œå‚æ•°2ï¼šæ ‡è¯†\nclass __default_alloc_template\n{\nprivate:\n    union obj\t/* åªæ˜¯ç±»å‹å®šä¹‰ */\n    {\n        union obj * free_list_link;\t//next\n        char client_data[1];\n    };\nprivate:\n    static obj * volatile free_list[__NFREELISTS];//volatileä¿®é¥°obj*ï¼Œå³free_listæ•°ç»„ä¸­å¯¹äºçš„æ•°æ®å†…å®¹ã€‚\n    static char* start_free;//æ¯æ¬¡é…ç½®çš„ä¸€å¤§å—'å†…å­˜' çš„å†…å­˜æ¥æºçš„å‰©ä½™éƒ¨åˆ†çš„èµ·å§‹\n    static char* end_free;\t//æ¯æ¬¡é…ç½®çš„ä¸€å¤§å—'å†…å­˜' çš„å†…å­˜æ¥æºçš„å‰©ä½™éƒ¨åˆ†çš„æœ«å°¾\n    static size_t heap_size;//ä¸Šé¢æåˆ°çš„éƒ½æ˜¯å†…å­˜æ¥æºï¼Œè€Œè¿™ä¸ªå†…å­˜æ¥æºéƒ½æ˜¯ä»å †åŒºç”³è¯·çš„ï¼Œå †åŒºç”³è¯·çš„æ€»ç©ºé—´æ•°è¦è®°å½•åœ¨æ¡ˆ\n    static size_t ROUNT_UP(size_t bytes);\n    static size_t FREELIST_INDEX(size_t bytes);\t//hash\n    static char* chunk_alloc(size_t size, int & nobjs);//size - å¯¹è±¡çš„å¤§å°ï¼Œnobjså¯¹è±¡çš„ä¸ªæ•°\n    static void* refill(size_t size);\t//é‡æ–°å¡«å……\npublic:\t/* ç”¨æˆ·è°ƒç”¨ */\n    static void* allocate(size_t size);\n    static void deallocate(void* p, size_t n);\n    static void* reallocate(void* p, size_t old_sz, size_t new_sz);\n};\n```\n\n## æˆå‘˜åˆå§‹åŒ–\n\n```c++\n// å¯¹free_list[__NFREELISTS]è¿›è¡Œåˆå§‹åŒ–ã€‚\ntemplate<bool threads, int inst> //\t1: __default_alloc_templateæ˜¯æ¨¡æ¿ç±»ï¼Œéœ€è¦å£°æ˜\ntypename __default_alloc_template<threads, inst>::obj * volatile // 2: objæ˜¯__default_alloc_template<threads, inst>ç±»å†…çš„ç±»ï¼Œéœ€è¦åŠ ä¸Šâ€œå“ªä¸ªç±»â€ï¼Œå¹¶ä¸”è¦åŠ ä¸Š\"typename\"ä»¥ç¤º\"obj\"æ˜¯ä¸ªç±»åï¼Œè€Œéæˆå‘˜ã€‚\n    __default_alloc_template<threads, inst>::free_list[__NFREELISTS] = {};\t// 3: free_list[__NFREELISTS]æ˜¯__default_alloc_template<threads, inst>ç±»å†…çš„æˆå‘˜ï¼Œéœ€è¦åŠ ä¸Šâ€œå“ªä¸ªç±»â€ï¼Œä½†æ— éœ€åŠ \"typename\"ã€‚\n// å¯¹start_freeè¿›è¡Œåˆå§‹åŒ–\ntemplate<bool threads, int inst>\nchar* __default_alloc_template<threads, inst>::start_free = nullptr;\n// å¯¹end_freeè¿›è¡Œåˆå§‹åŒ–\ntemplate<bool threads, int inst>\nchar* __default_alloc_template<threads, inst>::end_free = nullptr;\n// å¯¹heap_sizeè¿›è¡Œåˆå§‹åŒ–\ntemplate<bool threads, int inst>\nsize_t __default_alloc_template<threads, inst>::heap_size = 0;\n```\n\n## å‡½æ•°å®ç°\n\nå‡†å¤‡å·¥ä½œ\n\n```c++\nusing malloc_alloc = __malloc_alloc_template<0>;\n```\n\n### allocate\n\nç›¸å½“äºå•é“¾è¡¨çš„å¤´åˆ æ³•ï¼Œè¿”å›åˆ äº†çš„èŠ‚ç‚¹çš„åœ°å€ç»™ç”¨æˆ·ç”¨ã€‚\n\n```c++\nstatic void * allocate(size_t size)\n{\n    if(size > (size_t)__MAX_BYTES)\n    {\n        return malloc_alloc::allocate(size);\t//è½¬ç»™ä¸€çº§é…ç½®å™¨ã€‚\n    }\n    obj * result = nullptr;\n    obj * volatile * my_free_list = nullptr;\t//æ˜¯äºŒçº§æŒ‡é’ˆï¼Œè¦æŒ‡å‘obj*\n    my_free_list = free_list + FREELIST_INDEX(size);\n    result = *my_free_list;\n    if(nullptr == result)\t//è¯´æ˜æ­¤ä¸‹æ ‡å¤„æ— å†…å­˜å—äº†ï¼Œéœ€è¦ç”³è¯·ã€‚\n    {\n        void * r = refill(ROUND_UP(size));\n        return r;\n    }\n    *my_free_list = result->free_list_link;\t//æŠŠfree_listæ­¤ä¸‹æ ‡çš„æŒ‡é’ˆæ›´æ–°åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚ç›¸å½“äºé“¾è¡¨çš„å¤´åˆ æ³•ã€‚\n    return result;\n}\n```\n\n### refill\n\n```c++\nstatic void * refill(size_t size)\n{\n    int nobjs = 20;\n    char * chunk = chunk_alloc(size, nobjs);\n    //chunk_allocè¿è¡Œä¹‹åï¼Œnobjså€¼å¯èƒ½å‘ç”Ÿæ”¹å˜ã€‚\n    if(1 == nobjs)\n    {\n        //å¦‚æœnobjsæ˜¯1ï¼Œåˆ™è¯´æ˜å†…å­˜å—æ­£å¥½ç”¨å®Œï¼Œä¸ç”¨å†å¤„ç†åç»­å†…å­˜åŒºåŸŸçš„é“¾æ¥ã€ç§»åŠ¨\n        return chunk;\n    }\n    \n    //æ¥ä¸‹æ¥ï¼ŒæŠŠå†…å­˜å—åˆ†å´©ç¦»æï¼Œä¾æ¬¡ä¸²è”ã€‚\n    obj * volatile * my_free_list = NULL;\n    obj * result = (obj*)chunk;\n    obj * current_obj = NULL, * next_obj = NULL;\n    my_free_list = free_list + FREELIST_INDEX(size);\n    *my_free_list = next_obj = (obj*)(chunk+size);\n    for(int i = 1; ; ++i)\n    {\n        current_obj = next_obj;\n        next_obj = (obj*)((char*)next_obj + size);\n        if(i == nobjs-1)//æœ€åä¸€å—\n        {\n            current_obj->free_list_link = NULL;\n            break;\n        }\n        current_obj->free_list_link = next_obj;\n    }\n    return result;\n}\n```\n\n### chunk_alloc\n\n```c++\nstatic char* chunk_alloc(size_t size, int & nobjs)\n{\n    char * result = NULL;\n    size_t total_bytes = size * nobjs;\n    size_t bytes_left = end_free - start_free;\n    if(bytes_left >= total_bytes)\n    {\n        result = start_free;\n        start_free = start_free + total_bytes;\n        return result;\n    }\n    else if(bytes_left >= size)\n    {\n        nobjs = bytes_left / size;\n        total = size * nobjs;\n        \n        result = start_free;\n        start_free = start_free + total_bytes;\n        return result;\n    }\n    else //å†…å­˜ä¸è¶³ä»¥åˆ†é…1ä¸ªå¯¹è±¡ï¼ŒæŠŠå‰©ä½™çš„æ’å…¥åˆ°å…¶ä»–ä¸‹æ ‡(å‰©8å­—èŠ‚æ’åˆ°0, 16å­—èŠ‚æ’åˆ°1, ...)ï¼Œç„¶åå†å¦å¤–ç”³è¯·ä¸€ä¸ªå¤§çš„\n    {\n        size_t bytes_to_get = 2 * total_bytes + ROUND_UP(heap_size >> 4);\n        if(bytes_left > 0)\n        {\n            obj * volatile * my_free_list = free_list + FREELIST_INDEX(bytes_left);\n            //å¤´æ’\n            ((obj*)start_free)->free_list_link = *my_free_list;\n            *my_free_list = (obj*)start_free;\n        }\n        //å‰©ä½™çš„æ®‹å­˜ç©ºé—´ å¤„ç†å®Œæ¯•ï¼Œæ¥ä¸‹æ¥ç”³è¯·å¤§å—å†…å­˜\n        start_free = (char*)malloc(bytes_to_get);\n        if(NULL == start_free)\t//å †åŒºå±…ç„¶æ²¡æœ‰èµ„æºäº†ï¼æ— å¥ˆä¹‹è®¡ï¼Œåªèƒ½å‘æ¯”ä»–ä¹‹åçš„é“¾è¡¨æ‰¾æœ‰æ— å‰©ä½™å—ã€‚\n        {\n            obj * volatile * my_free_list = NULL;\n            for(int i = size; i <= __MAX_BYTES; i += __ALIGN)\t//æ³¨æ„ï¼Œiä»sizeå¼€å§‹ï¼Œè€Œä¸ä¸€å®šä»æœ€å°çš„å—å¤§å°8å¼€å§‹ï¼Œå› ä¸ºæ‰¾æ¯”ä½ å°çš„æ²¡æœ‰ç”¨å¤„ã€‚å¾—æ‰¾å¤§çš„ã€‚\n            {\n                my_free_list = free_list + FREELIST_INDEX(i);\n                obj * p = NULL;\n                if(NULL != p)\t//æ‰¾åˆ°äº†æ¯”ä»–å¤§çš„çš„å‰©ä½™çš„äº†ï¼\n                {\n                    *my_free_list = (*my_free_list)->free_list_link;\n                    start_free = (char*)p;\n                    end_free = start_free + i;\n                    return chunk_alloc(size, nobjs);\n                }\n            }\n            //å¦‚æœä¸Šé¢çš„forå¾ªç¯æ²¡èƒ½ä½¿å¾—å…¶æ‰¾åˆ°åˆé€‚çš„å†…å­˜å—ï¼Œåˆ™è¯´æ˜çœŸçš„æ˜¯â€œå±±ç©·æ°´å°½ç–‘æ— è·¯â€äº†ï¼Œåªèƒ½è½¬1çº§é…ç½®å™¨ï¼ŒæŠ›å‡ºå¼‚å¸¸æˆ–è€…é€šè¿‡handlerå¤„ç†ã€‚\n            start_free = malloc_alloc::allocate(bytes_to_get);\n        }\n        end_free = start_free + bytes_to_get;\n        heap_size += bytes_to_get;\n        return chunk_alloc(size, nobjs);\t//é€’å½’æ­¤å‡½æ•°ï¼Œç›¸å½“äºé‡æ–°æ¥ä¸€éæµç¨‹\n    }\n}\n```\n\n### ROUND_UP & INDEX\n\n```c++\nstatic size_t ROUNT_UP(size_t bytes)\n{\n    // 0 -> 0, 1~8 -> 8, 9~16 - > 16, 17~24 -> 24, ...\n    return (bytes+ __ALIGN-1) & ~(__ALIGN - 1);\n}\nstatic size_t FREELIST_INDEX(size_t bytes)\n{\n    // 1~8 -> 0, 9~16 -> 1, 17~24 -> 2, ...\n    return ((bytes+ __ALIGN-1) / __ALIGN) - 1;\n}\n```\n\n### æµ‹è¯•allocate\n\n```c++\n#ifdef __USE_MALLOC\ntypedef __malloc_alloc_template<0> malloc_alloc;\ntypedef malloc_alloc alloc;\n#else\ntypedef __default_alloc_template<0, 0> alloc;\n#endif\n```\n\n```c++\ntemplate<class T, class Alloc>\nclass simple_alloc\n{\npublic:\n    static T* allocate(size_t n)\t//ç”³è¯·nä¸ªTå¯¹è±¡\n    {\n        return Alloc::allocate(sizeof(T)*n);\n    }\n    static T* allocate()\n    {\n        return Alloc::allocate(sizeof(T));\n    }\n    void deallocate(T *p, size_t n)\n    {\n        if(NULL == p)return;\n        Alloc::deallocate(p, sizeof(T)*n);\n    }\n    void deallocate(T* p)\n    {\n        if(NULL == p)return;\n        Alloc::deallocate(p, sizeof(T));\n    }\n};\n```\n\nå¼•å…¥listè¿›è¡Œæµ‹è¯•\n\n```c++\n#include\"my_list.h\"\nusing namespace std;\nint main()\n{\n    xcg::my_list<char> mylist;\n    \n    for(int i = 0; i < 23; ++i)\n    {\n        mylist.push_back(i + 'a');\n    }\n    return 0;\n}\n```\n\nlistæ„å»ºæµç¨‹ï¼š\n\n```c++\ntemplate<class _Ty, class _A = xcg::alloc>\nclass my_list\n{\npublic:\n    typedef _Ty\t\t\t\t\t\t\t value_type;\n    typedef _Ty&\t\t\t\t\t\t reference;\n    typedef _Ty*\t\t\t\t\t\t pointer;\n    typedef const _Ty&\t\t\t\t\t const_reference;\n    typedef const _Ty*\t\t\t\t\t const_pointer;\n    \n    typedef _A\t\t\t\t\t\t\t allocator_type;\n    typedef xcg::simple_alloc<_Node, _A> data_allocate;\t\t//simple_allocä¸­ä½¿ç”¨çš„æ˜¯ç¬¬äºŒä¸ªå‚æ•°çš„allocateã€‚åœ¨è¿™é‡Œå³ä½¿ç”¨_A::allocateï¼Œé»˜è®¤å‚æ•°æ˜¯xcg::allocï¼Œè€Œæ ¹æ®å¼€å…³è¯­å¥ï¼Œè‹¥æ˜¯ä½¿ç”¨malloc_allocåˆ™ä¸ºä¸€çº§é…ç½®å™¨ï¼Œè‹¥ä¸ºdefault_allocåˆ™ç”¨äºŒçº§é…ç½®å™¨ã€‚æˆ‘ä»¬é»˜è®¤ä½¿ç”¨çš„æ˜¯__default_alloc_template<0, 0>ã€‚\n    \npublic:\n    my_list() : _Head(_Buynode()), _Size(0) {}\nprotected:\n    _Nodeptr _Buynode(_Nodeptr _parg = NULL, _Nodeptr _narg = NULL)\n    {\n        _Nodeptr _S = data_allocate::allocate();\n        _Acc::_Prev(_S) = _parg == NULL ? _S : _parg;\n        _Acc::_Next(_S) = _narg == NULL ? _S : _narg;\n        return _S;\n    }\nprivate:\n    _Nodeptr _Head;\n    size_t _Size;\n};\n```\n\n### deallocate\n\n```c++\nstatic void deallocate(void * p, size_t size)\t// n è¡¨ç¤ºç©ºé—´å¤§å°\n{\n    if(size > (size_t)__MAX_BYTES)\n    {\n        malloc_alloc::deallocate(p, size);\n        return;\n    }\n    //å½’è¿˜ç»™é…ç½®å™¨\n    obj * q = (obj*)p;\n    obj * volatile * my_free_list = free_list + FREELIST_INDEX(size);\n    //å¤´æ’\n    q->free_list_link = *my_free_list;\n    *my_free_list = q;\n    return;\n}\n```\n\n### æµ‹è¯•deallocate\n\n```c++\niterator erase(iterator _P)\n{\n    _Nodeptr _S = _P++._Mynode();\n    _Acc::_Next(_Acc::_Prev(_S)) = _Acc::_Next(_S);\n    _Acc::_Prev(_Acc::_Next(_S)) = _Acc::_Prev(_S);\n    destroy(&_Acc::_Value(_S));\t//ä¸åˆ é™¤èŠ‚ç‚¹ï¼Œè€Œæ˜¯é‡Šæ”¾valueåŸŸã€‚\n    _Freenode(_);\n    \n    return _P;\n}\nvoid _Freenode(_Nodeptr _P)\n{\n    data_allocate::deallocate(_P);\n}\nvoid pop_back()\n{\n    erase(--end());\n}\nvoid pop_front()\n{\n    erase(begin());\n}\n```\n\n```c++\nclass Object\n{\nprivate:\n    int value;\npublic:\n    Object(int x = 0) : value(x)\n    {\n        cout << \"create object\" << this << endl;\n    }\n    ~Object()\n    {\n        cout << \"destroy object\" << this << endl;\n    }\n};\nint main()\n{\n    xcg::my_list<Object> objlist;\n    for(int i = 0; i < 10; ++i)\n    {\n        objlist.push_back(Object(i));\n    }\n    objlist.pop_back();\n    return 0;\n}\n```\n\n### reallocate\n\n```c++\nstatic void* reallocate(void * p, size_t old_sz, size_t new_sz)\n{\n    if(old_sz > (size_t)__MAX_BYTES && new_sz > (size_t)__MAX_BYTES)\n    {\n        return malloc_alloc::reallocate(p, old_sz, new_sz);\n    }\n    // old_sz == 20, new_sz == 22\t-->24, 24\n    if(ROUND_UP(old_sz) == ROUND_UP(new_sz))\n    {\n        return p;\n    }\n    // old_sz > 128, new_sz < 128\n    // old_sz < 128, new_sz < 128\n    // old_sz < 128, new_sz > 128\n    size_t sz = old_sz < new_sz ? old_sz : new_sz;\n    void * s = allocate(new_sz);\n    memmove(s, p ,sz);\n    deallocate(p, old, sz);\n    return s;\n}\n```\n\n","categories":["Cpp","é¡¹ç›®"]},{"title":"ç½‘ç»œ_TCP","url":"/ç½‘ç»œ/ç½‘ç»œ_TCP/","content":"# å››æ¬¡æŒ¥æ‰‹\n![](../../images/ç½‘ç»œ_TCP/image-20250722092657370.png)\n\n\n# TCP\nç‰¹ç‚¹ï¼š\n\n1. é¢å‘è¿æ¥çš„\n    1. ä¸‰æ¬¡æ¡æ‰‹--åœ¨å®¢æˆ·ç«¯connect()æ—¶\n        1. å¿…é¡»æ˜¯ä¸‰æ¬¡\n    2. å››æ¬¡æŒ¥æ‰‹--åœ¨ä»»ä¸€æ–¹closeæ—¶\n        1. æœ‰æ—¶å¯ä»¥ä¸‰æ¬¡\n2. å¯é çš„\n    1. åº”ç­”ç¡®è®¤\n    2. è¶…æ—¶é‡ä¼ \n    3. ä¹±åºé‡æ’\n    4. å»é‡\n    5. æ»‘åŠ¨çª—å£è¿›è¡Œæµé‡æ§åˆ¶\n3. æµå¼æœåŠ¡\n    1. å‘é€å’Œæ¥æ”¶çš„æ¬¡æ•°å¯èƒ½ä¸ä¸€è‡´ã€‚\n        1. è¿ç»­å¤šæ¬¡å‘é€çš„æ•°æ®å¯èƒ½ä¼šè¢«å¯¹æ–¹ä¸€æ¬¡æ€§æ”¶åˆ°ã€‚\n    2. èµ·å§‹æœ«å°¾åŠ æ ‡è®°\n    3. sendä¹‹årecvéš”å¼€\n4. tcpæ˜¯æœ‰çŠ¶æ€çš„\n    1. å¼€å§‹`closed`\n    2. `listen`--`connecting`(ä¸‰æ¬¡æ¡æ‰‹ä¸­)\n    3. `established`(å·²å®Œæˆæ¡æ‰‹)\n    4. `FIN_WAIT_1`/`FIN_WAIT_2`\n    5. `TIME_WAIT`\n        1. å¯é åœ°ç»ˆæ­¢TCPçš„è¿æ¥\n        2. è®©è¿Ÿæ¥çš„æŠ¥æ–‡åœ¨è¿™ä¸€æ®µæ—¶é—´è¢«è¯†åˆ«ï¼Œå³æ”¶é›†åä¸¢å¼ƒï¼Œä»¥é˜²æ­¢è¯¯ä¼ ç»™ä¸‹ä¸€ä¸ªä½¿ç”¨è¯¥ç«¯å£çš„è¿æ¥ã€‚\n\né—®é¢˜ï¼š1ã€TCP/IPåè®®è¯¦è§£ å·ä¸€ï¼›2ã€UNIXç½‘ç»œç¼–ç¨‹ å·ä¸€\n\n1. ä¸‰æ¬¡æ¡æ‰‹ï¼Œå››æ¬¡æŒ¥æ‰‹\n2. åº”ç­”ç¡®è®¤ã€è¶…æ—¶é‡ä¼ æœºåˆ¶\n3. ä¹±åºé‡æ’ã€å»é‡ã€æ»‘åŠ¨çª—å£è¿›è¡Œæµé‡æ§åˆ¶\n4. ä»€ä¹ˆæ˜¯ç²˜åŒ…ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ\n5. ä¸­é—´è½¬æ¢çŠ¶æ€çš„æ„ä¹‰ï¼ŸTIME_WAITçŠ¶æ€çš„æ„ä¹‰ï¼Ÿ\n# TCPé¦–éƒ¨\n\n![image-20220325091330300](../../images/Linux_TCP/image-20220325091330300.png)\n\n* åºåˆ—å·(Sequence Number)å­—æ®µæ ‡è¯†äº†TCPå‘é€ç«¯åˆ°TCPæ¥æ”¶ç«¯çš„æ•°æ®æµçš„ä¸€ä¸ªå­—èŠ‚ï¼Œ**è¯¥å­—èŠ‚ä»£è¡¨ç€è¿™ä¸ªæŠ¥æ–‡æ®µå¯¹åº”çš„æ•°æ®ä¸­çš„ç¬¬ä¸€ä¸ªå­—èŠ‚**ã€‚å¦‚æœæˆ‘ä»¬è€ƒè™‘åœ¨ä¸¤ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´çš„ä¸€ä¸ªæ–¹å‘ä¸ŠæµåŠ¨çš„æ•°æ®æµï¼ŒTCPç»™æ¯ä¸ªå­—èŠ‚èµ‹äºˆä¸€ä¸ªåºåˆ—å·ã€‚è¿™ä¸ªåºåˆ—å·æ˜¯ä¸€ä¸ª32ä½çš„æ— ç¬¦å·æ•°ï¼Œåˆ°è¾¾$2^{32}-1$åå†å¾ªç¯å›åˆ°0ã€‚\n* **ç¡®è®¤å·(Acknowledgment Number)**æ˜¯è¯¥å‘é€æ–¹æœŸå¾…æ¥æ”¶çš„ä¸‹ä¸€ä¸ªåºåˆ—å·ã€‚\n    * TCPå¯ä»¥è¢«æè¿°ä¸ºä¸€ç§â€œå¸¦ç´¯ç§¯æ­£å‘ç¡®è®¤çš„æ»‘åŠ¨çª—å£åè®®â€ã€‚ACKå·å­—æ®µè¢«æ„å»ºç”¨äºæŒ‡æ˜åœ¨æ¥æ”¶æ–¹å·²ç»é¡ºåºæ”¶åˆ°çš„æœ€å¤§å­—èŠ‚(åŠ 1)ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå­—èŠ‚1~1024å·²ç»æ¥æ”¶æˆåŠŸï¼Œè€Œä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µåŒ…å«å­—èŠ‚2049~3072ï¼Œé‚£ä¹ˆæ¥æ”¶æ–¹ä¸èƒ½ä½¿ç”¨è§„åˆ™çš„ACKå·å­—æ®µå»å‘ä¿¡å‘Šè¯‰å‘é€æ–¹å®ƒæ¥æ”¶åˆ°äº†è¿™ä¸ªæ–°æŠ¥æ–‡æ®µï¼ˆå…ˆä¿ç•™ï¼‰ã€‚ç„¶è€Œï¼Œç°ä»£TCPæœ‰ä¸€ä¸ª**é€‰æ‹©ç¡®è®¤(Selective ACKnowledgment, SACK)é€‰é¡¹**ï¼Œå¯ä»¥å…è®¸æ¥æ”¶æ–¹å‘Šè¯‰å‘é€æ–¹å®ƒæ­£ç¡®åœ°æ¥æ”¶åˆ°äº†æ¬¡åºæ‚ä¹±çš„æ•°æ®ã€‚å½“ä¸ä¸€ä¸ªå…·æœ‰é€‰æ‹©é‡å‘(selective repeat)èƒ½åŠ›çš„TCPå‘é€æ–¹æ­é…æ—¶ï¼Œå°±å¯ä»¥å®ç°æ€§èƒ½çš„æ˜¾è‘—æ”¹å–„ã€‚æˆ‘ä»¬å°†ä¼šçœ‹åˆ°TCPæ˜¯å¦‚ä½•ä½¿ç”¨é‡å¤ç¡®è®¤(duplicate acknowledgments)ä»¥å¸®åŠ©å®ƒçš„æ‹¥å¡æ§åˆ¶å’Œå·®é”™æ§åˆ¶è¿‡ç¨‹çš„ã€‚\n* **å¤´éƒ¨é•¿åº¦(Header Length)å­—æ®µ**ç»™å‡ºäº†å¤´éƒ¨çš„é•¿åº¦ï¼Œæ­¤å­—æ®µåªå 4ä½ï¼Œè®¡ç®—æ—¶ï¼Œä»¥32ä½å­—(4å­—èŠ‚)ä¸ºå•ä½ï¼Œæ¯”å¦‚è¯¥å­—æ®µæ˜¯1111ï¼Œåˆ™å¤´éƒ¨é•¿åº¦ä¸º$15 * (32 / 8) = 60$å­—èŠ‚ã€‚å®ƒæ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºé€‰é¡¹(Options)å­—æ®µçš„é•¿åº¦æ˜¯å¯å˜çš„ã€‚\n* æ¥ä¸‹æ¥æ˜¯é¢„ç•™ä½(Resv)å’Œ8ä¸ªæ ‡å¿—ä½ï¼Œæ—§ç‰ˆæœ¬çš„TCPå¤´éƒ¨çš„æ ‡å¿—ä½åªç”¨åˆ°äº†å6ä¸ªï¼›å®ƒä»¬ä¸­çš„1ä¸ªæˆ–å¤šä¸ªå¯è¢«åŒæ—¶å¯ç”¨ã€‚å…¶ä¸­é™¤äº†å6ä¸ªæ—§ç‰ˆæœ¬å·²æœ‰çš„ï¼Œæ–°çš„2ä¸ªæ ‡å¿—ä½ä¸ºï¼š\n    1. CWRï¼šæ‹¥å¡çª—å£å‡ï¼ˆå‘é€æ–¹é™ä½å®ƒçš„å‘é€é€Ÿç‡ï¼‰\n    2. ECEï¼šECNå›æ˜¾ï¼ˆå‘é€æ–¹æ¥æ”¶åˆ°äº†ä¸€ä¸ªæ›´æ—©çš„æ‹¥å¡é€šå‘Šï¼‰\n* **çª—å£å¤§å°(Window Size)å­—æ®µ**ã€‚TCPçš„æµé‡æ§åˆ¶ç”±æ¯ä¸ªç«¯å£ä½¿ç”¨è¿™ä¸ªå­—æ®µæ¥é€šå‘Šä¸€ä¸ªçª—å£å¤§å°æ¥å®Œæˆã€‚è¿™ä¸ªçª—å£å¤§å°æ˜¯**å­—èŠ‚æ•°**ï¼Œä»ACKå·æŒ‡å®šçš„ï¼Œä¹Ÿæ˜¯æ¥æ”¶æ–¹æƒ³è¦æ¥æ”¶çš„é‚£ä¸ªå­—èŠ‚å¼€å§‹ã€‚è¿™æ˜¯ä¸€ä¸ª16ä½çš„å­—æ®µï¼Œé™åˆ¶äº†çª—å£å¤§å°åˆ°65535å­—èŠ‚ï¼Œä»è€Œé™åˆ¶äº†TCPçš„ååé‡æ€§èƒ½ã€‚**çª—å£ç¼©æ”¾(Window Scale)é€‰é¡¹**å¯å…è®¸å¯¹è¿™ä¸ªå€¼è¿›è¡Œç¼©æ”¾,ç»™é«˜é€Ÿå’Œå¤§å»¶è¿Ÿç½‘ç»œæä¾›äº†æ›´å¤§çš„çª—å£å’Œæ”¹è¿›æ€§èƒ½ã€‚\n* TCPæ ¡éªŒå’Œ(TCP Checksum)å­—æ®µè¦†ç›–äº†TCPçš„å¤´éƒ¨ã€æ•°æ®ä»¥åŠIPå¤´éƒ¨ä¸­çš„ä¸€äº›å­—æ®µï¼›æ˜¯ä¸€ä¸ªå¼ºåˆ¶æ€§çš„å­—æ®µï¼Œç”±å‘ç«¯è®¡ç®—å’Œå­˜å‚¨ï¼Œå¹¶ç”±æ”¶ç«¯è¿›è¡ŒéªŒè¯ã€‚TCPæ£€éªŒå’Œçš„è®¡ç®—ä¸UDPæ£€éªŒå’Œçš„è®¡ç®—ç›¸ä¼¼ï¼Œä½¿ç”¨ä¸€ä¸ªä¼ªé¦–éƒ¨ã€‚\n* ç´§æ€¥æŒ‡é’ˆ(Urgent Pointer)å­—æ®µã€‚ç´§æ€¥æŒ‡é’ˆæ˜¯ä¸€ä¸ªæ­£åç§»é‡ï¼Œå’Œåºåˆ—å·å­—æ®µä¸­çš„å€¼ç›¸åŠ **è¡¨ç¤ºç´§æ€¥æ•°æ®æœ€åä¸€ä¸ªå­—èŠ‚**çš„åºåˆ—å·ã€‚è¿™ç§TCPç´§æ€¥æœºåˆ¶æ˜¯å‘é€ç«¯å‘å¦ä¸€ç«¯æä¾›ç‰¹æ®Šæ ‡å¿—æ•°æ®çš„æ–¹æ³•ã€‚\n* é€‰é¡¹å­—æ®µã€‚æœ€å¸¸è§çš„å°±æ˜¯â€œæœ€å¤§æ®µå¤§å°â€é€‰é¡¹ã€‚è¿æ¥çš„æ¯ä¸ªç«¯ç‚¹ä¸€èˆ¬åœ¨å®ƒå‘é€çš„ç¬¬ä¸€ä¸ªæŠ¥æ–‡æ®µï¼ˆä¸ºäº†å»ºç«‹è¯¥è¿æ¥ï¼ŒSYNä½å­—æ®µè¢«è®¾ç½®çš„é‚£ä¸ªæŠ¥æ–‡æ®µï¼‰ä¸ŠæŒ‡å®šè¿™ä¸ªé€‰é¡¹ã€‚MSSæŒ‡å®šè¯¥é€‰é¡¹çš„å‘é€è€…åœ¨ç›¸åæ–¹å‘ä¸Šå¸Œæœ›æ¥æ”¶åˆ°çš„æŠ¥æ–‡æ®µçš„æœ€å¤§å€¼ã€‚\n* TCPæŠ¥æ–‡æ®µçš„æ•°æ®éƒ¨åˆ†æ˜¯å¯é€‰çš„ã€‚å½“ä¸€ä¸ªè¿æ¥è¢«å»ºç«‹å’Œç»ˆæ­¢æ—¶ï¼Œäº¤æ¢çš„æŠ¥æ–‡æ®µåªåŒ…å«TCPå¤´éƒ¨(å¯èƒ½å¸¦é€‰é¡¹)è€Œæ²¡æœ‰æ•°æ®ã€‚\n    * å¦‚æœè¿™ä¸ªæ–¹å‘ä¸Šæ²¡æœ‰æ•°æ®è¢«ä¼ è¾“ï¼Œé‚£ä¹ˆä¸€ä¸ªä¸å¸¦ä»»ä½•æ•°æ®çš„å¤´éƒ¨ä¹Ÿä¼šç”¨äºACKæ¥æ”¶åˆ°çš„æ•°æ®ï¼ˆç§°ä¸ºä¸€ä¸ªpure ACKï¼‰ï¼ŒåŒæ—¶é€šçŸ¥é€šä¿¡æ–¹æ”¹å˜çª—å£å¤§å°ï¼ˆç§°ä¸ºä¸€ä¸ªçª—å£æ›´æ–°(window update)ï¼‰ã€‚\n    * å½“ä¸€ä¸ªæŠ¥æ–‡æ®µå¯ä¸å¸¦æ•°æ®å‘é€æ—¶ï¼Œè¶…æ—¶æ“ä½œä¼šå› æ­¤è€Œäº§ç”Ÿä¸€äº›æ–°æƒ…å†µã€‚\n\n# æ ‡å¿—ä½\n\n## URG\n\nURGï¼Œå…¨æ‹¼æ˜¯urgentã€‚è¡¨ç¤ºç´§æ€¥ã€‚æ­¤æ ‡å¿—è¡¨ç¤ºï¼š**ç´§æ€¥æŒ‡é’ˆæœ‰æ•ˆ**ã€‚\n\n## ACK\n\nè¡¨ç¤ºç¡®è®¤åºå·å­—æ®µæœ‰æ•ˆã€‚éœ€è¦æ³¨æ„ï¼Œç¡®è®¤æ ‡å¿—ä½å’Œç¡®è®¤åºå·å­—æ®µä¸ä¸€æ ·ï¼Œç¡®è®¤åºå·å’Œåºåˆ—å·ä¸ä¸€æ ·ã€‚\n\n* æ—¢ç„¶æ¯ä¸ªä¼ è¾“çš„å­—èŠ‚éƒ½è¢«è®¡æ•°ï¼Œç¡®è®¤åºå·ä¼šå¡«å†™è¯¥ç«¯æ‰€æœŸæœ›æ”¶åˆ°çš„ä¸‹ä¸€ä¸ªåºå·ã€‚å› æ­¤ç¡®è®¤åºå·åº”å½“æ˜¯ä¸Šæ¬¡å·²æˆåŠŸæ”¶åˆ°æ•°æ®å­—èŠ‚åºå·+1ã€‚\n* å‘é€ä¸€ä¸ªACKä¸å‘é€ä»»ä½•ä¸€ä¸ªTCPæŠ¥æ–‡æ®µçš„å¼€é”€æ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºé‚£ä¸ª32ä½çš„ACKå·å­—æ®µä¸€ç›´éƒ½\n  æ˜¯å¤´éƒ¨çš„ä¸€éƒ¨åˆ†ï¼ŒACKä½å­—æ®µä¹Ÿä¸€æ ·ã€‚\n  TCP/IPè¯¦è§£\\_å·1\\_ç¬¬2ç‰ˆ\\_è‹±è¯­åŸæ–‡å¦‚ä¸‹ï¼šSending an ACK costs nothing more than sending any other TCP segment because the 32-bit ACK Number field is always part of the header, as is the ACK bit field.\n* åªæœ‰ACKæ ‡å¿—ä¸º1æ—¶ï¼Œç¡®è®¤åºå·å­—æ®µæ‰æœ‰æ•ˆï¼›ä¸€æ—¦ä¸€ä¸ªè¿æ¥å»ºç«‹èµ·æ¥ï¼Œç¡®è®¤åºå·å­—æ®µæ€»æ˜¯è¢«è®¾ç½®ï¼Œ ACKæ ‡å¿—ä¹Ÿæ€»æ˜¯è¢«è®¾ç½®ä¸º1ï¼›è¿™ä¸ª**ACKä½å­—æ®µå‡ ä¹ç”¨äºæ‰€æœ‰æŠ¥æ–‡æ®µï¼Œé™¤äº†åˆå§‹å’Œæœ«å°¾æŠ¥æ–‡æ®µ**ã€‚\n\n## PSH\n\næ¥æ”¶æ–¹åº”è¯¥å°½å¿«å°†è¿™ä¸ªæŠ¥æ–‡æ®µäº¤ç»™åº”ç”¨å±‚ã€‚\n\n## RST\n\né‡å»ºè¿æ¥\n\n## SYN\n\nåŒæ­¥åºå·ç”¨æ¥å‘èµ·ä¸€ä¸ªè¿æ¥ã€‚\n\n* å½“å»ºç«‹ä¸€ä¸ªæ–°çš„è¿æ¥æ—¶ï¼ŒSYNæ ‡å¿—å˜1ã€‚åºåˆ—å·å­—æ®µéšå³ä¼šåŒ…å«ç”±è¿™ä¸ªä¸»æœºé€‰æ‹©çš„è¯¥è¿æ¥çš„**åˆå§‹åºåˆ—å·ISN(Initial Sequence Number)**ã€‚\n* è¯¥ä¸»æœºè¦å‘é€æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚åºåˆ—å·ä¸ºISN+1ï¼Œå› ä¸ºSYNæ ‡å¿—æ¶ˆè€—äº†ä¸€ä¸ªåºå·ã€‚æ¶ˆè€—ä¸€ä¸ªåºåˆ—å·ä¹Ÿæ„å‘³ç€ä½¿ç”¨é‡ä¼ è¿›è¡Œå¯é ä¼ è¾“ã€‚å› æ­¤ï¼ŒSYNå’Œåº”ç”¨ç¨‹åºå­—èŠ‚ï¼ˆè¿˜æœ‰FINï¼Œç¨åæˆ‘ä»¬å°†ä¼šè§åˆ°ï¼‰æ˜¯è¢«å¯é ä¼ è¾“çš„ã€‚ä¸æ¶ˆè€—åºåˆ—å·çš„ACKsåˆ™ä¸æ˜¯ã€‚\n## FIN\n\nFINå‘ç«¯å®Œæˆå‘é€ä»»åŠ¡ã€‚\n\n# å¦‚ä½•ä¿è¯æ•°æ®å¯é ä¼ è¾“\n\né‚£äº›è‡ªèº«ä¸åŒ…å«å¯é ä¼ é€’æ•°æ®æœºåˆ¶çš„åè®®ã€‚å®ƒä»¬å¯èƒ½ä¼šä½¿ç”¨ä¸€ç§åƒæ ¡éªŒå’Œæˆ–CRCè¿™æ ·çš„æ•°å­¦å‡½æ•°æ¥**æ£€æµ‹**æ¥æ”¶åˆ°çš„æœ‰å·®é”™çš„æ•°æ®ï¼Œ**ä½†æ˜¯å®ƒä»¬ä¸å°è¯•å»çº æ­£å·®é”™**ã€‚æ¯”å¦‚å¯¹äºIPå’ŒUDPåˆ™æ ¹æœ¬æ²¡æœ‰å®ç°å·®é”™çº æ­£ã€‚å¯¹äºä»¥å¤ªç½‘å’ŒåŸºäºå…¶ä¸Šçš„å…¶ä»–åè®®ï¼Œåè®®æä¾›ä¸€å®šæ¬¡æ•°çš„é‡è¯•ï¼Œå¦‚æœè¿˜æ˜¯ä¸æˆåŠŸåˆ™æ”¾å¼ƒã€‚\n\né€šä¿¡åª’ä»‹å¯èƒ½ä¼šä¸¢å¤±æˆ–æ”¹å˜è¢«ä¼ é€’çš„æ¶ˆæ¯ï¼Œåœ¨è¿™ç§ç¯å¢ƒä¸‹çš„é€šä¿¡é—®é¢˜å·²ç»è¢«ç ”ç©¶äº†å¤šå¹´ã€‚å…³äºè¿™ä¸ªè¯¾é¢˜çš„ä¸€äº›æœ€é‡è¦çš„ç†è®ºå·¥ä½œç”±é¦™å†œåœ¨1948å¹´ç»™å‡ºã€‚è¿™äº›å·¥ä½œæ™®åŠäº†æœ¯è¯­â€œæ¯”ç‰¹â€ï¼Œå¹¶æˆä¸ºä¿¡æ¯ç†è®º(information theory)é¢†åŸŸçš„åŸºç¡€ï¼Œå¸®åŠ©æˆ‘ä»¬ç†è§£äº†åœ¨ä¸€ä¸ªæœ‰æŸï¼ˆå¯èƒ½ä¼šåˆ é™¤æˆ–æ”¹å˜æ¯”ç‰¹ï¼‰ä¿¡é“é‡Œå¯é€šè¿‡çš„ä¿¡æ¯é‡çš„æ ¹æœ¬é™åˆ¶ã€‚ä¿¡æ¯ç†è®ºä¸ç¼–ç ç†è®º(coding theory)çš„é¢†åŸŸå¯†åˆ‡ç›¸å…³ï¼Œç¼–ç ç†è®ºæä¾›ä¸åŒçš„ä¿¡æ¯ç¼–ç æ‰‹æ®µï¼Œä»è€Œä½¿å¾—ä¿¡æ¯èƒ½åœ¨é€šä¿¡ä¿¡é“é‡Œå°½é‡å…äºå‡ºé”™ã€‚å…¶ä¸­æœ‰ä¸¤ç§æ‰‹æ®µï¼š\n\n1. ä½¿ç”¨å·®é”™æ ¡æ­£ç ï¼ˆåŸºæœ¬ä¸Šæ˜¯æ·»åŠ ä¸€äº›å†—ä½™çš„æ¯”ç‰¹ï¼Œä½¿å¾—å³ä½¿æŸäº›æ¯”ç‰¹è¢«æ¯ï¼ŒçœŸå®çš„ä¿¡æ¯ä¹Ÿå¯ä»¥è¢«æ¢å¤è¿‡æ¥ï¼‰æ¥çº æ­£é€šä¿¡é—®é¢˜æ˜¯å¤„ç†å·®é”™çš„ä¸€ç§éå¸¸é‡è¦çš„æ–¹æ³•ã€‚\n2. å¦ä¸€ç§æ–¹æ³•æ˜¯ç®€å•åœ°â€œå°è¯•é‡æ–°å‘é€â€ï¼Œç›´åˆ°ä¿¡æ¯æœ€ç»ˆè¢«æ¥æ”¶ã€‚è¿™ç§æ–¹æ³•ï¼Œç§°ä¸ºè‡ªåŠ¨é‡å¤è¯·æ±‚(Automatic Repeat Request, ARQ)ï¼Œæ„æˆäº†è®¸å¤šé€šä¿¡åè®®çš„åŸºç¡€ï¼ŒåŒ…æ‹¬TCPåœ¨å†…ã€‚\n\n## ARQå’Œé‡ä¼ \n\nå¦‚æœæˆ‘ä»¬è€ƒè™‘çš„ä¸åªæ˜¯å•ä¸ªé€šä¿¡ä¿¡é“ï¼Œè€Œæ˜¯å‡ ä¸ªçš„å¤šè·³çº§è”ï¼Œæˆ‘ä»¬ä¼šå‘ç°ä¸åªä¼šç¢°åˆ°å‰é¢æåˆ°çš„é‚£å‡ ç§å·®é”™ç±»å‹ï¼ˆåˆ†ç»„æ¯”ç‰¹å·®é”™ï¼‰ï¼Œè€Œä¸”è¿˜ä¼šæœ‰æ›´å¤šå…¶ä»–çš„ç±»å‹ã€‚è¿™äº›é—®é¢˜å¯èƒ½å‘ç”Ÿåœ¨ä¸­é—´è·¯ç”±å™¨ä¸Šï¼Œæ˜¯å‡ ç§åœ¨è®¨è®ºIPæ—¶ä¼šé‡åˆ°çš„é—®é¢˜ï¼šåˆ†ç»„é‡æ–°æ’åºï¼Œåˆ†ç»„å¤åˆ¶ï¼Œåˆ†ç»„æ³¯ç­ï¼ˆä¸¢å¤±ï¼‰ã€‚ä¸ºåœ¨å¤šè·³é€šä¿¡ä¿¡é“ï¼ˆä¾‹å¦‚IPï¼‰ä¸Šä½¿ç”¨è€Œè®¾è®¡çš„å¸¦çº é”™çš„åè®®å¿…é¡»è¦å¤„ç†è¿™äº›é—®é¢˜ã€‚\n\nç°åœ¨è®©æˆ‘ä»¬æ¥æ¢è®¨èƒ½å¤„ç†è¿™äº›é—®é¢˜çš„åè®®æœºåˆ¶ã€‚åœ¨æ¦‚æ‹¬æ€§åœ°è®¨è®ºè¿™äº›ä¹‹åï¼Œæˆ‘ä»¬ä¼šæ¢ç©¶å®ƒä»¬æ˜¯å¦‚ä½•è¢«TCPåœ¨äº’è”ç½‘ä¸Šä½¿ç”¨çš„ã€‚\n\nä¸€ä¸ªç›´æ¥å¤„ç†åˆ†ç»„ä¸¢å¤±ï¼ˆå’Œæ¯”ç‰¹å·®é”™ï¼‰çš„æ–¹æ³•æ˜¯é‡å‘åˆ†ç»„ç›´åˆ°å®ƒè¢«æ­£ç¡®æ¥æ”¶ã€‚è¿™éœ€è¦ç§æ–¹æ³•æ¥åˆ¤æ–­ï¼š\n\n1. æ¥æ”¶æ–¹æ˜¯å¦å·²æ”¶åˆ°åˆ†ç»„ï¼›\n2. æ¥æ”¶æ–¹æ¥æ”¶åˆ°çš„åˆ†ç»„æ˜¯å¦ä¸ä¹‹å‰å‘é€æ–¹å‘é€çš„ä¸€æ ·ã€‚\n\næ¥æ”¶æ–¹ç»™å‘é€æ–¹å‘ä¿¡å·ä»¥ç¡®å®šè‡ªå·±å·²ç»æ¥æ”¶åˆ°ä¸€ä¸ªåˆ†ç»„ï¼Œè¿™ç§æ–¹æ³•ç§°ä¸ºç¡®è®¤(acknowledgment, ACK)ã€‚æœ€åŸºæœ¬çš„å½¢å¼æ˜¯ï¼Œå‘é€æ–¹å‘é€ä¸€ä¸ªåˆ†ç»„ï¼Œç„¶åç­‰å¾…ä¸€ä¸ªACKã€‚å½“æ¥æ”¶æ–¹æ¥æ”¶åˆ°è¿™ä¸ªåˆ†ç»„æ—¶ï¼Œå®ƒå‘é€å¯¹åº”çš„ACKã€‚å½“å‘é€æ–¹æ¥æ”¶åˆ°è¿™ä¸ªACKï¼Œå®ƒå†å‘é€å¦ä¸€ä¸ªåˆ†ç»„ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±è¿™æ ·ç»§ç»­ã€‚è¿™é‡Œä¼šæœ‰ä¸€äº›æœ‰æ„æ€çš„é—®é¢˜ï¼š\n\n1. å‘é€æ–¹å¯¹ä¸€ä¸ªACKåº”è¯¥ç­‰å¾…å¤šé•¿æ—¶é—´ï¼Ÿ\n2. å¦‚æœACKä¸¢å¤±äº†æ€ä¹ˆåŠï¼Ÿ\n3. å¦‚æœåˆ†ç»„è¢«æ¥æ”¶åˆ°äº†ï¼Œä½†æ˜¯é‡Œé¢æœ‰é”™æ€ä¹ˆåŠï¼Ÿ\n\nç¬¬ä¸€ä¸ªé—®é¢˜å…¶å®æŒºæ·±å¥¥çš„ã€‚å†³å®šå»ç­‰å¾…å¤šé•¿æ—¶é—´ä¸å‘é€æ–¹æœŸå¾…(expect)ä¸ºä¸€ä¸ªACKç­‰å¾…å¤šé•¿æ—¶é—´æœ‰å…³ã€‚ç°åœ¨ç¡®å®šè¿™ä¸ªæ—¶é—´å¯èƒ½æ¯”è¾ƒå›°éš¾ï¼Œå› æ­¤æˆ‘ä»¬æ¨è¿Ÿå¯¹è¿™ä¸ªæŠ€æœ¯çš„è®¨è®ºã€‚\n\nç¬¬äºŒä¸ªé—®é¢˜çš„ç­”æ¡ˆæ¯”å®¹æ˜“ï¼šå¦‚æœä¸€ä¸ªACKä¸¢å¤±äº†ï¼Œå‘é€æ–¹ä¸æ˜“åŒºåˆ†ACKæŠ¥æ–‡æ®µä¸¢å¤±ä¸åŸåˆ†ç»„ä¸¢å¤±çš„æƒ…å†µï¼Œæ‰€ä»¥å®ƒç®€å•åœ°å†æ¬¡å‘é€åŸåˆ†ç»„ã€‚å½“ç„¶ï¼Œè¿™æ ·çš„è¯ï¼Œæ¥æ”¶æ–¹å¯èƒ½ä¼šæ¥æ”¶åˆ°ä¸¤ä¸ªæˆ–æ›´å¤šçš„æ‹·è´ï¼Œå› æ­¤å®ƒå¿…é¡»å‡†å¤‡å¥½å¤„ç†è¿™ç§æƒ…å†µï¼ˆè§ä¸‹ä¸€æ®µï¼‰ã€‚\n\nè‡³äºç¬¬ä¸‰ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©æŸä¸ªç¼–ç æŠ€æœ¯æ¥è§£å†³ã€‚ä½¿ç”¨ç¼–ç æ¥æ£€æµ‹ä¸€ä¸ªå¤§çš„åˆ†ç»„ä¸­çš„å·®é”™ï¼ˆæœ‰å¾ˆå¤§çš„æ¦‚ç‡ï¼‰ä¸€èˆ¬éƒ½å¾ˆç®€å•ï¼Œä»…ä½¿ç”¨æ¯”å…¶è‡ªèº«å°å¾ˆå¤šçš„ä¸€äº›æ¯”ç‰¹å³å¯çº æ­£ã€‚æ›´ç®€å•çš„ç¼–ç ä¸€èˆ¬ä¸èƒ½çº æ­£å·®é”™ï¼Œä½†æ˜¯èƒ½æ£€æµ‹å®ƒä»¬ã€‚è¿™å°±æ˜¯æ ¡éªŒå’Œä¸CRCä¼šå¦‚æ­¤å—æ¬¢è¿çš„åŸå› ã€‚ç„¶åï¼Œä¸ºäº†æ£€æµ‹åˆ†ç»„é‡Œçš„å·®é”™ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ç§æ ¡éªŒå’Œå½¢å¼ã€‚å½“ä¸€ä¸ªæ¥æ”¶æ–¹æ¥æ”¶åˆ°ä¸€ä¸ªå«æœ‰å·®é”™çš„åˆ†ç»„æ—¶ï¼Œå®ƒä¸å‘é€ACKã€‚æœ€åï¼Œå‘é€æ–¹é‡å‘å®Œæ•´åˆ°è¾¾çš„æ— å·®é”™çš„åˆ†ç»„ã€‚\n\nåˆ°ç›®å‰ä¸ºæ­¢å³ä½¿è¿™ç§ç®€å•çš„åœºæ™¯ï¼Œæ¥æ”¶æ–¹éƒ½å¯èƒ½æ¥æ”¶åˆ°è¢«ä¼ é€åˆ†ç»„çš„é‡å¤(duplicate)å‰¯æœ¬ã€‚è¿™ä¸ªé—®é¢˜è¦ä½¿ç”¨åºåˆ—å·(sequence number)æ¥å¤„ç†ã€‚åŸºæœ¬ä¸Šï¼Œåœ¨è¢«æºç«¯å‘é€æ—¶ï¼Œæ¯ä¸ª**å”¯ä¸€**çš„åˆ†ç»„éƒ½æœ‰ä¸€ä¸ªæ–°çš„åºåˆ—å·ï¼Œè¿™ä¸ªåºåˆ—å·ç”±åˆ†ç»„è‡ªèº«ä¸€ç›´æºå¸¦ç€ã€‚æ¥æ”¶æ–¹å¯ä»¥ä½¿ç”¨è¿™ä¸ªåºåˆ—å·æ¥åˆ¤æ–­å®ƒæ˜¯å¦å·²ç»è§è¿‡è¿™ä¸ªåˆ†ç»„ï¼Œå¦‚æœè§è¿‡åˆ™ä¸¢å¼ƒå®ƒã€‚\n\nåˆ°ç›®å‰ä¸ºæ­¢ä»‹ç»çš„åè®®æ˜¯å¯é çš„ï¼Œä½†æ•ˆç‡ä¸å¤ªé«˜ã€‚å¦‚æœä»å‘é€æ–¹åˆ°æ¥æ”¶æ–¹ä¼ é€’å³ä½¿ä¸€ä¸ªå¾ˆå°çš„åˆ†ç»„éƒ½è¦ç”¨å¾ˆé•¿æ—¶é—´ï¼ˆæ¨è¿Ÿæˆ–å»¶è¿Ÿï¼‰çš„è¯ï¼ˆå¦‚ä¸€ç§’æˆ–ä¸¤ç§’ï¼Œå¯¹å«æ˜Ÿé“¾è·¯æ¥è¯´å¹¶éä¸æ­£å¸¸ï¼‰ï¼Œè€ƒè™‘ä¸€ä¸‹é‚£ä¼šæ€æ ·ã€‚å‘é€æ–¹å¯ä»¥æ³¨å…¥ä¸€ä¸ªåˆ†ç»„åˆ°é€šä¿¡è·¯å¾„ï¼Œç„¶ååœä¸‹æ¥ç­‰å¾…ç›´åˆ°å®ƒæ”¶åˆ°ACKã€‚è¿™ä¸ªåè®®å› æ­¤è¢«ç§°ä¸ºâ€œåœæ­¢å’Œç­‰å¾…â€ã€‚å‡è®¾æ²¡æœ‰åˆ†ç»„åœ¨ä¼ è¾“ä¸­ä¸¢å¤±æˆ–è€…è¿™äº›åˆ†ç»„æ²¡æœ‰è¢«æ— å¯æŒ½å›åœ°æŸå®³ï¼Œè¯¥åè®®çš„ååé‡(throughput)æ€§èƒ½ï¼ˆæ¯å•ä½æ—¶é—´å‘é€çš„æ•°æ®é‡ï¼‰ä¸$M/R$æˆæ­£æ¯”ï¼Œ$M$æ˜¯åˆ†ç»„å¤§å°ï¼Œ$R$æ˜¯å¾€è¿”æ—¶é—´ï¼ˆRTTï¼‰ï¼Œå³åˆ†ç»„è¶Šå°ã€å¾€è¿”æ—¶é—´è¶Šå¤§åˆ™æ€§èƒ½å°±è¶Šä½ã€‚å¦‚æœæœ‰åˆ†ç»„ä¸¢å¤±å’ŒæŸå®³çš„è¯ï¼Œæƒ…å†µç”šè‡³æ›´ç³Ÿç³•ï¼šâ€œååè´¨(goodput)â€ï¼ˆæ¯å•ä½æ—¶é—´ä¼ é€çš„**æœ‰ç”¨**æ•°æ®é‡ï¼‰æ˜æ˜¾è¦æ¯”ååé‡è¦ä½ã€‚\n\nå¯¹äºä¸ä¼šæŸå®³å’Œä¸¢å¤±å¤ªå¤šåˆ†ç»„çš„ç½‘ç»œæ¥è¯´ï¼Œä½ååé‡çš„åŸå› æ˜¯ç½‘ç»œç»å¸¸æ²¡æœ‰å¤„äºç¹å¿™çŠ¶æ€ã€‚æƒ…å†µä¸ä½¿ç”¨è£…é…æµæ°´çº¿æ—¶ä¸å‡ºä¸€ä¸ªå®Œæ•´äº§å“å°±ä¸å‡†æ–°çš„å·¥ä½œè¿›å…¥ç±»ä¼¼ã€‚æµæ°´çº¿å¤§éƒ¨åˆ†æ—¶é—´æ˜¯ç©ºé—²çš„ã€‚æˆ‘ä»¬è¿›ä¸€æ­¥å¯¹æ¯”ï¼Œå¾ˆæ˜æ˜¾ï¼Œå¦‚æœæˆ‘ä»¬å…è®¸åŒä¸€æ—¶é—´æœ‰å¤šä¸ªå·¥ä½œå•å…ƒè¿›äººæµæ°´çº¿ï¼Œå°±å¯ä»¥åšå¾—æ›´å¥½ã€‚å¯¹ç½‘ç»œé€šä¿¡æ¥è¯´ä¹Ÿæ˜¯ä¸€æ ·çš„ä¸€â€”å¦‚æœæˆ‘ä»¬å…è®¸å¤šä¸ªåˆ†ç»„è¿›å…¥ç½‘ç»œï¼Œå°±å¯ä»¥ä½¿å®ƒâ€œæ›´ç¹å¿™â€ï¼Œä»è€Œå¾—åˆ°æ›´é«˜çš„ååé‡ã€‚\nå¾ˆæ˜æ˜¾ï¼Œå…è®¸å¤šä¸ªåˆ†ç»„åŒæ—¶è¿›äººç½‘ç»œä½¿äº‹æƒ…å˜å¾—å¤æ‚ã€‚ç°åœ¨å‘é€æ–¹å¿…é¡»ä¸ä»…è¦å†³å®šä»€ä¹ˆæ—¶é—´æ³¨å…¥ä¸€ä¸ªåˆ†ç»„åˆ°ç½‘ç»œä¸­ï¼Œè¿˜è¦è€ƒè™‘æ³¨å…¥å¤šå°‘ä¸ªã€‚å¹¶ä¸”å¿…é¡»è¦æŒ‡å‡ºåœ¨ç­‰å¾…ACKæ—¶ï¼Œæ€æ ·\n# TIME_WAIT\n2å€çš„MSLæ—¶é—´ï¼ˆMaximum Segment Lifetimeï¼‰ã€‚","categories":["ç½‘ç»œ"]},{"title":"é«˜çº§æ•°æ®ç»“æ„_Bæ ‘","url":"/é«˜çº§æ•°æ®ç»“æ„/é«˜çº§æ•°æ®ç»“æ„_Bæ ‘/","content":"# Bæ ‘\nBä»£è¡¨Balancedï¼Œæ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½åœ¨åŒä¸€å±‚ã€‚\n# Bæ ‘ä»£ç ç¤ºä¾‹\n\n```cpp\n#include<iostream>\nusing namespace std;\n#define M 5\n#define MAXSIZE (M-1)\n#define MINSIZE (M/2)\ntypedef char KeyType;\ntypedef struct Record {} Record;\ntypedef struct ElemType\n{\n\tKeyType key;\n\tRecord* recptr;\n}ElemType;\ntypedef struct BNode\n{\n\tint num;\n\tstruct BNode* parent;\n\tElemType data[M + 1];\n\tstruct BNode* sub[M + 1];\n}BNode;\ntypedef struct BTree\n{\n\tstruct BNode* root;\n\tint cursize;\n}BTree;\ntypedef struct Result\n{\n\tstruct BNode* pnode;\n\tint index;\n\tbool tag;\n}Result;\nBNode* Buynode()\n{\n\tBNode* s = (BNode*)malloc(sizeof(BNode));\n\tif (nullptr == s)exit(1);\n\tmemset(s, 0, sizeof(BNode));\n\treturn s;\n}\nvoid Init_BTree(BTree& tree)\n{\n\ttree.root = nullptr;\n\ttree.cursize = 0;\n}\nResult FindKey(BTree& tree, KeyType kx)\n{\n\tResult res = { nullptr, -1,false };\n\tstruct BNode* ptr = tree.root;\n\twhile (ptr != nullptr)\n\t{\n\t\tptr->data[0].key = kx;\n\t\tint i = ptr->num;\n\t\twhile (i>=0 && ptr->data[i].key)\n\t\t{\n\t\t\t--i;\n\t\t}\n\t\tres.pnode = ptr;\n\t\tres.index = i;\n\t\tif (i > 0 && kx == ptr->data[i].key) \n\t\t{ \n\t\t\tres.tag = true;\n\t\t\tbreak;\n\t\t}\n\t\tptr = ptr->sub[i];\n\t}\n\treturn res;\n}\nBNode* MakeRoot(const ElemType& item, BNode* left, BNode* right)\n{\n\tBNode* s = Buynode();\n\ts->num = 1;\n\ts->parent = nullptr;\n\ts->data[1] = item;\n\ts->sub[0] = left;\n\tif (left != nullptr)left->parent = s;\n\ts->sub[1] = right;\n\tif (right != nullptr)right->parent = s;\n\treturn s;\n}\nvoid Insert_Item(BNode* ptr, int pos, const ElemType& item, BNode* right)\n{\n\tfor (int i = ptr->num; i > pos; --i)\n\t{\n\t\tptr->data[i + 1] = ptr->data[i];\n\t\tptr->sub[i + 1] = ptr->sub[i];\n\t}\n\tptr->data[pos + 1] = item;\t//?\n\tptr->sub[pos + 1] = right;\t//?\n\tptr->num += 1;\n}\nElemType Move_Item(BNode* s, BNode* ptr, int pos)\n{\n\tfor (int i = 0, j = pos + 1; j <= ptr->num; ++i, ++j)\n\t{\n\t\ts->data[i] = ptr->data[j];\n\t\ts->sub[i] = ptr->sub[j];\n\t\tif (s->sub[i] != nullptr)\n\t\t{\n\t\t\ts->sub[i]->parent = s;\n\t\t}\n\t}\n\ts->num = MINSIZE;\n\tptr->num = MINSIZE;\n\ts->parent = ptr->parent;\n\treturn s->data[0];\n}\nBNode* Splice(BNode* ptr)\n{\n\tBNode* s = Buynode();\n\tElemType item = Move_Item(s, ptr, MINSIZE);\n\tif (ptr->parent == nullptr)\n\t{\n\t\treturn MakeRoot(item, ptr, s);\n\t}\n\tBNode* pa = ptr->parent;\n\tint pos = pa->num;\n\tpa->data[0] = item;\n\twhile (pos > 0 && item.key < pa->data[pos].key) { --pos; }\n\tInsert_Item(pa, pos, item, s);\n\tif (pa->num > MAXSIZE)\n\t{\n\t\treturn Splice(pa);\n\t}\n\telse\n\t{\n\t\treturn nullptr;\n\t}\n}\nbool Insert(BTree& tree, const ElemType& item)\n{\n\tif (tree.root == nullptr)\n\t{\n\t\ttree.root = MakeRoot(item, nullptr, nullptr);\n\t\ttree.cursize = 1;\n\t\treturn true;\n\t}\n\t//ä¸ä¸ºç©º\n\tResult res = FindKey(tree, item.key);\n\tif (res.pnode != nullptr && res.tag)return false;\n\t//åœ¨res.pnodeå¤„æ’å…¥\n\tBNode* ptr = res.pnode;\n\tint pos = res.index;\n\tInsert_Item(ptr, pos, item, nullptr);\n\n\tif (ptr->num > MAXSIZE)\n\t{\n\t\tBNode* newroot = Splice(ptr);\t//åˆ†è£‚\n\t\tif (newroot != nullptr)\n\t\t{\n\t\t\ttree.root = newroot;\n\t\t}\n\t}\n\ttree.cursize += 1;\n\treturn true;\n}\nBNode* FindPrev(BNode* ptr, int pos)\n{\n\tBNode* p = ptr->sub[pos];\n\twhile (p != nullptr && p->sub[p->num])\n\t{\n\t\tp = p->sub[p->num];\n\t}\n\treturn p;\n}\nBNode* FindNext(BNode* ptr, int pos)\n{\n\tBNode* p = ptr->sub[pos];\n\twhile (p != nullptr && p->sub[0])\n\t{\n\t\tp = p->sub[0];\n\t}\n\treturn p;\n}\nbool Remove(BTree& tree, KeyType kx)\n{\n\tResult res = FindKey(tree, kx);\n\tif (res.pnode == nullptr || !res.tag)return false;\n\tBNode* ptr = res.pnode;\n\tint pos = res.index;\n\tBNode* pre = FindPrev(ptr, pos - 1);\n\tBNode* nt = FindNext(ptr, pos);\n\tif (pre != nullptr && ptr->num > MINSIZE)\n\t{\n\t\tptr->data[pos] = pre->data[ptr->num];\n\t\tptr = pre;\n\t\tpos = pre->num;\n\t}\n\telse if (nt != nullptr && nt->num > MINSIZE)\n\t{\n\t\tptr->data[pos] = nt->data[1];\n\t\tptr = nt;\n\t\tpos = 1;\n\t}\n\telse if (pre != nullptr)\n\t{\n\t\tptr->data[pos] = pre->data[pre->num];\n\t\tptr = pre;\n\t\tpos = pre->num;\n\t}\n\tDelete_Leaf(ptr, pos);\n\tif (ptr->parent == nullptr && ptr->num == 0)\n\t{\n\t\tfree(ptr);\n\t\ttree.root = nullptr;\n\t}\n\telse if (ptr->num < MINSIZE)\n\t{\n\t\tBNode* newroot = Merge_Leaf(ptr);\n\t\tif (newroot != nullptr)\n\t\t{\n\t\t\ttree.root = newroot;\n\t\t}\n\t}\n}\nint main()\n{\n\tBTree myt;\n\tInit_BTree(myt);\n\tchar ch[] = { \"qwertyuiopasdfghjklzxcvbnm\" };\n\tint i = 0;\n\twhile (ch[i] != '\\0')\n\t{\n\t\tElemType item = { ch[i],nullptr };\n\t\tcout << Insert(myt, item);\n\t\ti++;\n\t}\n\tcout << endl;\n}\n```\n\n# `B*`\n\nä¸B+æ ‘çš„ç»“æ„ä¸€è‡´ã€‚\n\nä½†æ˜¯\n\n```cpp\nbool Move_Left_Right(BNode * ptr)\n{\n    bool res = false;\t//æ˜¯å¦ç§»åŠ¨\n    BNode * left = ptr->prev;\n    BNode * right = ptr->next;\n    if(left != nullptr && left->num < LEAFMAX)\n    {\n        //å·¦ç§»\n        res = true;\n    }else if(right != nullptr && right->num < LEAFMAX)\n    {\n        //å³ç§»\n        res = true;\n    }\n    return res;\n}\nbool Insert(BTree& tree, KeyType kx, Record * rec)\n{\n\tif (tree.root == nullptr)\n\t{\n\t\tBNode *s = BuyLeaf();\n\t\ts->key[0] = kx;\n        s->recptr[0] = rec;\n        s->num = 1;\n        tree.root = tree.first = s;\n        return true;\n\t}\n\t//ä¸ä¸ºç©º\n\tResult resr = FindRoot(tree.root, kx);\n\tResult resf = FindLeaf(tree.first, kx);\n\tif(resf.pnode == nullptr){cout << \"BTree struct err\"<<endl;return false;}\n    if (resf.tag){cout << \"exist\"<<endl;return false;}\n\t//åœ¨res.pnodeå¤„æ’å…¥\n\tBNode* ptr = resf.pnode;\n\tint pos = resf.index;\n\tInsert_Leaf_Item(ptr, pos, kx, rec);\n\t\n\tif (ptr->num > LEAFMAX)\n\t{\n        // ç§»åŠ¨\n\t\tBNode* newroot = Splice_Leaf(ptr);\t//åˆ†è£‚\n\t\tif (newroot != nullptr)\n\t\t{\n\t\t\ttree.root = newroot;\n\t\t}\n\t}\n\ttree.cursize += 1;\n\treturn true;\n}\n```\n\n\n\n\n\n","categories":["é«˜çº§æ•°æ®ç»“æ„","æ ‘"]},{"title":"Cè¯­è¨€_restrict","url":"/C/Cè¯­è¨€_restrict/","content":"\nå‚è€ƒæ–‡ç« ï¼š[C++ éœ€è¦ restrict å…³é”®å­—å—ï¼Ÿ - è“è‰²çš„å›ç­” - çŸ¥ä¹](https://www.zhihu.com/question/32106315/answer/54660335)\n\n# æ¼”ç¤º\n\nC/Cppç¼–è¯‘å™¨ï¼Œæ— è®ºæ˜¯GCCï¼ŒClangï¼ŒVCppï¼ŒIBM XL Cppç­‰ï¼Œè¿™äº›ä¸»æµçš„Cppç¼–è¯‘å™¨éƒ½æä¾›äº†restrictå…³é”®å­—çš„æ”¯æŒï¼Œåªæ˜¯ä¹¦å†™çš„å½¢å¼æœ‰æ‰€å˜åŒ–ï¼Œå¦‚å¯èƒ½æ˜¯\\_\\_restrict\\_\\_ï¼Œ\\_\\_restrictç­‰ ï¼Œè€Œrestrictæ˜¯é™åˆ¶**Pointer Alias**çš„ï¼Œé™åˆ¶Pointer Aliasæœ‰åŠ©äºç¼–è¯‘å™¨åšä¼˜åŒ–ï¼Œè¿™å’Œunique_ptrå®Œå…¨æ˜¯ä¸¤ç äº‹ã€‚\n\n## restrict\n\nä»¥GCCäº§ç”Ÿæ±‡ç¼–æŒ‡ä»¤çš„ä¾‹å­æ¥è¡¥å……ä¸€ä¸‹ï¼Œæ¯”è¾ƒç›´è§‚\n\n```c\nvoid f(int *a, int *b, int *c)\n{\n    *a += *c;\n    *b += *c;\n}\n```\n\n-O3åçš„æ±‡ç¼–ä»£ç \n\n```x86asm\nf(int*, int*, int*):\n\tmovl\t(%rdx), %eax\n\taddl\t%eax, (%rdi)\n\tmovl\t(%rdx), %eax\n\taddl\t%eax, (%rsi)\n\tret\n```\n\nåŠ ä¸Šrestrict\n\n```c\nvoid f(int * __restrict__ a, int* __restrict__ b, int* __restrict__ c)\n{\n  *a += *c;\n  *b += *c;\n}\n```\n\n-O3å\n\n```x86asm\nf(int*, int*, int*):\n\tmovl\t(%rdx), %eax\n\taddl\t%eax, (%rdi)\n\taddl\t%eax, (%rsi)\n\tret\n```\n\n**å¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹è§æ˜¯4æ¡æŒ‡ä»¤å˜ä¸ºäº†3æ¡æŒ‡ä»¤ï¼Œè€Œå°‘æ‰çš„ä¸€æ¡å°±æ˜¯ç¬¬äºŒæ¬¡çš„load c**\n\n## unique_ptr\n\n```cpp\n#include <memory>\nusing namespace std;\nvoid f(std::unique_ptr<int> a, std::unique_ptr<int>b, std::unique_ptr<int> c)\n{\n  *a += *c;\n  *b += *c;\n}\n```\n\n-O3 -std=c++11\n\n```x86asm\nf(std::unique_ptr<int, std::default_delete<int> >, std::unique_ptr<int, std::default_delete<int> >, std::unique_ptr<int, std::default_delete<int> >):\n\tmovq\t(%rdx), %rdx\n\tmovq\t(%rdi), %rax\n        \n        ; *a += *c\n\tmovl\t(%rdx), %ecx\n\taddl\t%ecx, (%rax)\n\n\tmovq\t(%rsi), %rax\n        \n        ; *b += *c\n\tmovl\t(%rdx), %edx\n\taddl\t%edx, (%rax)\n\tret\n```\n\næ‰€ä»¥ï¼Œå¯è§ï¼Œunique_ptrå’Œrestrictå®Œå…¨æ˜¯ä¸¤ç äº‹ã€‚\n\n# ä¸ªäººç†è§£\n\nè‡³äºä¸ºä»€ä¹ˆä¼šå’Œunique_ptræ··æ·†ï¼Œå› ä¸ºä»–ä¸¤ä¸ªè¯­ä¹‰ä¸Šæœ‰å…±åŒä¹‹å¤„ï¼šåªæœ‰ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘æŸä¸ªå˜é‡ã€‚ä½†æ˜¯restrictçš„ç›®çš„æ˜¯ç»™ç¼–è¯‘å™¨åšä¼˜åŒ–ï¼Œè€Œä¸”å®ƒçš„é™åˆ¶æ•ˆæœä¸constä¿®é¥°ç¬¦å¾ˆç±»ä¼¼ï¼Œéœ€è¦è‡ªå·±å»ä½“ä¼šï¼›\n\n---\n\nè¯„è®ºåŒºè§è§£ï¼š\n\næé—®è€… - dawnmistï¼šæŒ‰ç…§unique_ptrçš„è¯­ä¹‰ï¼Œå®ƒæ˜¯èµ„æºçš„å”¯ä¸€æŒæœ‰è€…ã€‚å¦‚æœèµ„æºæ˜¯å†…å­˜ï¼Œé‚£ä¹Ÿåªèƒ½é€šè¿‡è¿™ä¸€ä¸ªunique_ptrè®¿é—®ã€‚ç”¨unique_ptræ—¶ï¼Œç¼–è¯‘å™¨èƒ½ä¸èƒ½åƒrestricté‚£æ ·ä¼˜åŒ–è¿™ä¸ªæŒ‡é’ˆè®¿é—®å‘¢ï¼Ÿ\n\nå›ç­”è€… - è“è‰²ï¼šä¸è¡Œï¼Œunique_ptrå¯ä»¥é€šè¿‡get()æ–¹æ³•è½¬ä¸ºåŸå§‹æŒ‡é’ˆï¼›unique_ptråªæ˜¯ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆï¼Œæ‰€ä»¥ä½ ä¸èƒ½è¿™æ ·é™åˆ¶unique_ptrçš„è¯­ä¹‰ã€‚","categories":["C"]},{"title":"ç½‘ç»œ_ç½‘ç»œç¼–ç¨‹æµç¨‹","url":"/ç½‘ç»œ/ç½‘ç»œ_ç½‘ç»œç¼–ç¨‹æµç¨‹/","content":"# TCPç¼–ç¨‹æµç¨‹\né¢è¯•å”¯ä¸€è¦å†™ä»£ç çš„ã€‚\n\n1. æœåŠ¡å™¨ç«¯ï¼š\n    1. `socket()` - åˆ›å»ºå¥—æ¥å­— - æ‰€éœ€åœ°å€ï¼šip+port\n    2. `bind()` - æŒ‡å®šè¿™ä¸ªå¥—æ¥å­—æ˜¯å“ªä¸ªIP:Port\n    3. `listen()` - è®¾ç½®ç›‘å¬é˜Ÿåˆ—çš„å¤§å°\n    4. `c = accept()` - æ¥å—è¿æ¥\n    5. `recv()` - æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ•°æ®\n    6. `send()` - ç»™å®¢æˆ·ç«¯å‘é€æ•°æ®\n    7. `close()` - å…³é—­è¿æ¥\n2. å®¢æˆ·ç«¯ï¼š\n    1. `socket()` - åˆ›å»ºå¥—æ¥å­—\n    2. `connect()` - å‘èµ·è¿æ¥\n    3. `send()` - å¦‚æœå»ºç«‹è¿æ¥æˆåŠŸï¼Œåˆ™å¯ä»¥å‘é€æ•°æ®\n    4. `recv()` - æ”¶æœåŠ¡å™¨å›å¤çš„æ•°æ®\n    5. `close()`\n\n>å®¢æˆ·ç«¯çš„bindï¼š\n>ä¸€èˆ¬æƒ…å†µä¸‹å®¢æˆ·ç«¯ä¸éœ€è¦bindï¼Œç«¯å£å·æ˜¯éšæœºçš„ã€‚å¦‚æœæƒ³è¦è®©å®¢æˆ·ç«¯å›ºå®šè‡ªå·±å‘å‡ºè¿æ¥çš„ç«¯å£å·ï¼Œå¯ä»¥ä¸»åŠ¨bindã€‚\n# å­—èŠ‚åºï¼ˆå¤§å°ç«¯é—®é¢˜ï¼‰\nå‚è€ƒï¼šã€ŠLinuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹ï¼ˆæ¸¸åŒï¼‰ã€‹5.1.1 ä¸»æœºå­—èŠ‚åºå’Œç½‘ç»œå­—èŠ‚åº ä¸€èŠ‚ã€‚\n\nç°ä»£CPUçš„ç´¯åŠ å™¨ä¸€æ¬¡éƒ½èƒ½è£…è½½ï¼ˆè‡³å°‘ï¼‰4å­—èŠ‚ï¼ˆè¿™é‡Œè€ƒè™‘32ä½æœºï¼Œä¸‹åŒï¼‰ï¼Œé‚£ä¹ˆè¿™4å­—èŠ‚åœ¨å†…å­˜ä¸­æ’åˆ—çš„é¡ºåºå°†å½±å“å®ƒè¢«ç´¯åŠ å™¨è£…è½½æˆçš„æ•´æ•°çš„å€¼ã€‚è¿™å°±æ˜¯å­—èŠ‚åºé—®é¢˜ã€‚\n\nå­—èŠ‚åºåˆ†ä¸ºå¤§ç«¯å­—èŠ‚åºï¼ˆbig endianï¼‰å’Œå°ç«¯å­—èŠ‚åºï¼ˆlittle endianï¼‰ã€‚\nå¤§ç«¯å­—èŠ‚åºæ˜¯æŒ‡ä¸€ä¸ªæ•´æ•°çš„é«˜ä½å­—èŠ‚ï¼ˆ23ï½31bitï¼‰å­˜å‚¨åœ¨å†…å­˜çš„ä½åœ°å€å¤„ï¼Œä½ä½å­—èŠ‚ï¼ˆ0ï½7bitï¼‰å­˜å‚¨åœ¨å†…å­˜çš„é«˜åœ°å€å¤„ã€‚\nå°ç«¯å­—èŠ‚åºåˆ™æ˜¯æŒ‡æ•´æ•°çš„é«˜ä½å­—èŠ‚å­˜å‚¨åœ¨å†…å­˜çš„é«˜åœ°å€å¤„ï¼Œè€Œä½ä½å­—èŠ‚åˆ™å­˜å‚¨åœ¨å†…å­˜çš„ä½åœ°å€å¤„ã€‚\n\n**ç°ä»£PCï¼ˆå¦‚ x86ï¼‰å¤§å¤šé‡‡ç”¨å°ç«¯å­—èŠ‚åº**ï¼Œå› æ­¤å°ç«¯å­—èŠ‚åºåˆè¢«ç§°ä¸º**ä¸»æœºå­—èŠ‚åº**ã€‚ä¸¤å°ä¸åŒå­—èŠ‚åºçš„ä¸»æœºä¼ é€’æ•°æ®æ—¶ï¼Œå¿…ç„¶å‘ç”Ÿé”™è¯¯ã€‚\n\n>ä¹Ÿæœ‰ç³»ç»Ÿé‡‡ç”¨å¤§ç«¯å­—èŠ‚åºï¼Œå¦‚PowerPCã€Javaè™šæ‹Ÿæœºã€‚\n\nè§£å†³é—®é¢˜çš„æ–¹æ³•æ˜¯ï¼šå‘é€ç«¯æ€»æ˜¯æŠŠè¦å‘é€çš„æ•°æ®è½¬åŒ–æˆå¤§ç«¯å­—èŠ‚åºæ•°æ®åå†å‘é€ï¼Œè€Œæ¥æ”¶ç«¯çŸ¥é“å¯¹æ–¹ä¼ é€è¿‡æ¥çš„æ•°æ®æ€»æ˜¯é‡‡ç”¨å¤§ç«¯å­—èŠ‚åºï¼Œæ‰€ä»¥æ¥æ”¶ç«¯å¯ä»¥æ ¹æ®è‡ªèº«é‡‡ç”¨çš„å­—èŠ‚åºå†³å®šæ˜¯å¦å¯¹æ¥æ”¶åˆ°çš„æ•°æ®è¿›è¡Œè½¬æ¢ï¼ˆå°ç«¯æœºè½¬æ¢ï¼Œå¤§ç«¯æœºä¸è½¬æ¢ï¼‰ã€‚å› æ­¤å¤§ç«¯å­—èŠ‚åºä¹Ÿç§°ä¸ºç½‘ç»œå­—èŠ‚åºã€‚\n\néœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œå³ä½¿æ˜¯åŒä¸€å°æœºå™¨ä¸Šçš„ä¸¤ä¸ªè¿›ç¨‹ï¼ˆæ¯”å¦‚ä¸€ä¸ªç”±Cè¯­è¨€ç¼–å†™ï¼Œå¦ä¸€ä¸ªç”±JAVAç¼–å†™ï¼‰é€šä¿¡ï¼Œä¹Ÿè¦è€ƒè™‘å­—èŠ‚åºçš„é—®é¢˜ï¼ˆJAVAè™šæ‹Ÿæœºé‡‡ç”¨å¤§ç«¯å­—èŠ‚åºï¼‰ã€‚\n\nä»¥ä¸‹ä»£ç å¯ç”¨äºæ£€æŸ¥æœºå™¨çš„å­—èŠ‚åºã€‚\n```c\n#include <stdio.h>\nvoid byteorder()\n{\n    union\n    {\n        short value;\n        char bytes[sizeof(short)];\n    } test;\n    test.value = 0x0102;\n    if (test.bytes[1] == 1)       // é€šè¿‡æ•°ç»„[1] çœ‹ é«˜åœ°å€ å­˜æ”¾çš„æ˜¯ é«˜ä½ï¼ˆ1ï¼‰å—ï¼Ÿ\n    {\n        printf(\"little endian\\n\");\n    }\n    else if (test.bytes[1] == 2)  // é€šè¿‡æ•°ç»„[1] çœ‹ é«˜åœ°å€ å­˜æ”¾çš„æ˜¯ ä½ä½ï¼ˆ2ï¼‰å—ï¼Ÿ\n    {\n        printf(\"big endian\\n\");\n    }\n    else\n    {\n        printf(\"unknown endianness\\n\");\n    }\n}\n```\n## è½¬æ¢å­—èŠ‚åºAPI\nå®šä¹‰äº`<netinet/in.h>`\n\nLinuxæä¾›äº†å¦‚ä¸‹4ä¸ªå‡½æ•°æ¥å®Œæˆä¸»æœºå­—èŠ‚åºå’Œç½‘ç»œå­—èŠ‚åºä¹‹é—´çš„è½¬æ¢ï¼š\nè¿™4ä¸ªå‡½æ•°ä¸­ï¼Œé•¿æ•´å‹å‡½æ•°é€šå¸¸ç”¨æ¥è½¬æ¢IPåœ°å€ï¼ˆ4å­—èŠ‚ï¼‰ï¼ŒçŸ­æ•´å‹å‡½æ•°ç”¨æ¥è½¬æ¢ç«¯å£å·ï¼ˆ2å­—èŠ‚ï¼‰ã€‚\nå½“ç„¶ä¸é™äºæ­¤ã€‚ä»»ä½•æ ¼å¼åŒ–çš„æ•°æ®é€šè¿‡ç½‘ç»œä¼ è¾“æ—¶ï¼Œéƒ½åº”è¯¥ä½¿ç”¨è¿™äº›å‡½æ•°æ¥è½¬æ¢å­—èŠ‚åºã€‚\n```c\n#include <netinet/in.h>\nunsigned long int htonl(unsigned long int hostlong);\nunsigned short int htons(unsigned short int hostshort);\nunsigned long int ntohl(unsigned long int netlong);\nunsigned short int ntohs(unsigned short int netshort);\n```\nå®ƒä»¬çš„å«ä¹‰å¾ˆæ˜ç¡®ï¼Œæ¯”å¦‚`htonl`è¡¨ç¤ºâ€œhost to network longâ€ï¼Œå³å°†é•¿æ•´å‹ï¼ˆ32bitï¼‰çš„ä¸»æœºå­—èŠ‚åºæ•°æ®è½¬åŒ–ä¸ºç½‘ç»œå­—èŠ‚åºæ•°æ®ã€‚\n1. `h: host` / `n: network`\n2. to: transfer to\n    1. n + l: `long int` / `s: short int`\n    2. h + l: `long int` / `s: short int`\n# socketåœ°å€ç»“æ„\nå¸¸è§çš„åè®®æ—ï¼š\n![](../../images/ç½‘ç»œ_TCPç¼–ç¨‹æµç¨‹/image-20250722065423512.png)\n>åè®®æ—ï¼šProtocol Familyï¼Œç®€å†™PFã€‚ä¹Ÿç§°domainã€‚\n>åœ°å€æ—ï¼šAddress Familyï¼Œç®€å†™AFã€‚ç”¨äºæ ‡è¯†â€‹**â€‹ç½‘ç»œåœ°å€å’Œç«¯å£å·â€‹**â€‹ã€‚\n>AF_INETï¼šAddress Family - Internetçš„ç®€å†™ã€‚Interneté‡‡ç”¨çš„åè®®å°±æ˜¯TCP/IPåè®®æ—ã€‚ä¸å¸¦åç¼€çš„é»˜è®¤ä¸ºTCP/IPv4ã€‚åœ¨ Linux/UNIX/Windows ç³»ç»Ÿä¸­é€šç”¨\n>AF_UNIXï¼šAddress Family - UNIXçš„ç®€å†™ï¼Œæœ‰çš„ä¹Ÿç®€å†™ä¸ºAF_LOCALã€‚ç”¨äºæœ¬åœ°è¿›ç¨‹é—´é€šä¿¡\n>AF_PACKETï¼šç”¨äºåº•å±‚çš„æ•°æ®é“¾è·¯å±‚è®¿é—®\n## é€šç”¨socketåœ°å€ç»“æ„\nsocketç½‘ç»œç¼–ç¨‹æ¥å£ä¸­è¡¨ç¤º**socketåœ°å€**çš„æ˜¯ç»“æ„ä½“`sockaddr`ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š\n```c++\n#include<bits/socket.h>\nstruct sockaddr\n{\n    sa_family_t sa_family;\t//socket address family type\n    char sa_data[14];       //socket address data\n}\n```\n`sa_family`æˆå‘˜æ˜¯åœ°å€æ—ç±»å‹ï¼ˆ`sa_family_t`ï¼‰çš„å˜é‡ã€‚**åœ°å€æ—**ç±»å‹é€šå¸¸ä¸**åè®®æ—**ç±»å‹å¯¹åº”ã€‚\n`sa_data`æˆå‘˜ç”¨äºå­˜æ”¾socketåœ°å€å€¼ã€‚ä½†æ˜¯ï¼Œä¸åŒçš„åè®®æ—çš„åœ°å€å€¼å…·æœ‰ä¸åŒçš„å«ä¹‰å’Œé•¿åº¦ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n![](../../images/ç½‘ç»œ_TCPç¼–ç¨‹æµç¨‹/image-20250722070305877.png)\nå¯è§ï¼Œ14å­—èŠ‚æ ¹æœ¬æ— æ³•å®Œå…¨å®¹çº³å¤šæ•°åè®®æ—çš„åœ°å€å€¼ã€‚å› æ­¤ï¼ŒLinuxå®šä¹‰äº†æ–°çš„é€šç”¨socketåœ°å€ç»“æ„ä½“ï¼š\n>è¿™ä¸ªç»“æ„ä½“ä¸ä»…æä¾›äº†è¶³å¤Ÿå¤§çš„ç©ºé—´ç”¨äºå­˜æ”¾åœ°å€å€¼ï¼Œè€Œä¸”æ˜¯å†…å­˜å¯¹é½çš„\n\n```c\n#include <bits/socket.h>\nstruct sockaddr_storage\n{\n    sa_family_t sa_family;\n    unsigned long int __ss_align;\n    char __ss_padding[128 - sizeof(__ss_align)];\n}\n```\n## ä¸“ç”¨socketåœ°å€ç»“æ„\nä¸Šé¢æåˆ°çš„ä¸¤ä¸ªé€šç”¨socketåœ°å€ç»“æ„ä½“æ˜¾ç„¶å¾ˆä¸å¥½ç”¨ï¼Œæ¯”å¦‚è®¾ç½®ä¸è·å–IPåœ°å€å’Œç«¯å£å·å°±éœ€è¦æ‰§è¡Œçƒ¦ççš„ä½æ“ä½œã€‚æ‰€ä»¥Linuxä¸ºå„ä¸ªåè®®æ—æä¾›äº†ä¸“é—¨çš„socketåœ°å€ç»“æ„ä½“ã€‚\næ¯”å¦‚UNIXæœ¬åœ°åŸŸåè®®æ—ä½¿ç”¨çš„socketåœ°å€ç»“æ„ä½“`sockaddr_un`ï¼š\n\n```c\n#include <sys/un.h>\nstruct sockaddr_un\n{\n    sa_family_t sin_family;// æ­é… AF_UNIXä½¿ç”¨\n    char sun_path[108];    // socket unix path æ–‡ä»¶è·¯å¾„\n}\n```\n\nTCP/IPçš„ä¸“ç”¨socketåœ°å€ç»“æ„ï¼Œè§ä¸‹æ–‡ã€‚\n# TCP/IPåè®®æ—åœ°å€ç»“æ„\nTCP/IPåè®®æ—æœ‰`sockaddr_in`å’Œ`sockaddr_in6`ä¸¤ä¸ªä¸“ç”¨socketåœ°å€ç»“æ„ä½“ï¼Œåˆ†åˆ«ç”¨äºIPv4å’ŒIPv6ã€‚\nå®šä¹‰äº`<netinet/in.h>`ä¸­\n## IPv4ï¼šsockaddr_in\n`sockaddr_in`çš„inè¡¨ç¤ºInternetï¼ˆv4ï¼‰ã€‚\n```c\n// IPv4 socketåœ°å€æ—ç»“æ„\nstruct sockaddr_in\n{\n    sa_family_t \tsin_family;\t//åœ°å€æ—\n    __be16\t\t\tsin_port;\t//ç«¯å£å·ï¼Œ__be16 è¡¨ç¤º 16ä½å¤§ç«¯åºï¼Œç±»å‹æ˜¯ u_int16_t\n    struct in_addr\tsin_addr;\t//IPv4 çš„ IPåœ°å€å­˜æ”¾ç»“æ„\n};\n```\næ³¨æ„å‘½åçš„è§„å¾‹ï¼š\nSocketåœ°å€æ—ç»“æ„ä½“`sockaddr_xx`æˆå‘˜çš„å‰ç¼€éƒ½å¸¦`sxx_`ã€‚\n\n`in_addr`è¿™ä¸ªç»“æ„ä½“æ˜¯å•ç‹¬å®šä¹‰çš„ï¼Œå’Œsocketæ¦‚å¿µæ˜¯ç‹¬ç«‹çš„ã€‚ç”¨äºå­˜æ”¾ IPv4 çš„ IPåœ°å€ã€‚æ‰€ä»¥ç±»å‹åä¸å¸¦â€sâ€œå‰ç¼€ã€‚\n```c\nstruct in_addr\n{\n    union\n    {\n        struct\n        {\n            // 4ä¸ªcharéƒ½æ˜¯8ä½2è¿›åˆ¶ï¼Œç”¨äºå­˜å‚¨4ä¸ª0-255ã€‚\n            u_char s_b1, s_b2, s_b3, s_b4; \n        }S_un_b;\t\t//An IPv4 address formatted as 4 u_chars, 4 * 8 bits\n        \n        struct\n        {\n            u_short s_w1, s_w2;\n        }S_un_w;\t\t//An IPv4 address formatted as 2 u_shorts, 2 * 16bits\n        \n        u_long S_addr;\t//An IPv4 address formatted as 1 u_long, 1 * 32 bits\n    }S_un;\n#define s_addr S_un.S_addr\t// u_long\n};\n```\nå…¶ä¸­`#define`ç»™`S_un.S_addr`å–äº†åˆ«å`s_addr`ã€‚è€Œä¸”ç”¨çš„è¿˜æ˜¯è”åˆä½“ï¼Œç­‰æ•ˆäºï¼š\n```c\nstruct in_addr\n{\n    u_int32_t s_addr;\n};\n```\nå› æ­¤å¤–ç•Œè®¿é—®IPåœ°å€åªéœ€è¦ï¼š`mysocketaddr.sin_addr.s_addr`ã€‚æ³¨æ„ä¸­é—´çš„`sin_addr`æ˜¯socketIPv4åœ°å€æ—çš„æˆå‘˜åï¼Œè¦å’Œ`sin_addr`çš„ç±»å‹å`in_addr`åŒºåˆ†ã€‚\n### ç¤ºä¾‹\n```c\nint main()\n{\n\tchar *echo_host = \"192.168.1.20\";\n\tint ehco_port = 7;\n\tstruct sockaddr_in *server = (struct sockaddr_in*)malloc(sizeof(struct sockaddr_in));\n\tserver->sin_family = AF_INET;\n\tserver->sin_port = htons(echo_port);\n\t//server is a struct of 'sockaddr_in'\n\t//so :  sockaddr_in . sin_addr(is a 'in_addr')\n\t\t\tin_addr . s_addr(is a #define of 'S_un.S_addr', S_addr is a u_long)\n\t\tso, sockaddr_in.in_addr.S_un.S_addr\n\t//final we find the u_long variable, 4 bytes, Corresponds to the 4 bytes of ipv4.\n\tserver->sin_addr.s_addr = inet_addr(echo_host);\n}\n```\n## IPv6\n```c\nstruct sockaddr_in6\n{\n    sa_family_t\t\tsin6_family;\t//AF_INET6\n    u_inet16_t\t\tsin6_port;\t\t//port ç½‘ç»œå­—èŠ‚åº\n    u_int32_t\t\tsin6_flowinfo;\t//æµä¿¡æ¯, åº”è®¾ç½®ä¸º0\n    struct in6_addr\tsin6_addr;\t\t//IPv6åœ°å€ç»“æ„ä½“\n    u_int32_t\t\tsin6_scope_id;\t//scope ID,å°šå¤„äºè¯•éªŒé˜¶æ®µ\n};\n```\n\n```c\nstruct in6_addr\n{\n    unsigned char sa_addr[16];\t    //IPåœ°å€ï¼Œ16å­—èŠ‚ ç½‘ç»œå­—èŠ‚åº\n};\n```\n# IPåœ°å€å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°\n\näººä»¬ä¹ æƒ¯ç”¨ç‚¹åˆ†åè¿›åˆ¶å­—ç¬¦ä¸²è¡¨ç¤ºIPv4åœ°å€ï¼Œç¼–ç¨‹ä¸­æˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸ªå­—ç¬¦ä¸²è½¬åŒ–ä¸ºæ•´æ•°ï¼Œæ‰èƒ½å¡«å…¥åœ°å€ç»“æ„ä½“ã€‚\n\n```c\n#include<arpa/inet.h>\nin_addr_t inet_addr(const char* cp); //å­—ç¬¦ä¸²è¡¨ç¤ºçš„IPv4åœ°å€è½¬åŒ–ä¸ºç½‘ç»œå­—èŠ‚åº\nint inet_aton(const char* cp, struct in_addr* inp);// ä¸inet_addråŠŸèƒ½ç›¸åŒï¼Œä½†æ˜¯è½¬åŒ–ç»“æœæ˜¯å­˜åˆ°äº†inpä¸­ æˆåŠŸè¿”å›1å¤±è´¥è¿”å›0\n\nchar* inet_ntoa(struct in_addr in);\t //net to ASCII, IPv4åœ°å€çš„ç½‘ç»œå­—èŠ‚åºè½¬åŒ–ä¸ºå­—ç¬¦ä¸²è¡¨ç¤º\n```\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`inet_ntoa`å‡½æ•°å†…éƒ¨ç”¨ä¸€ä¸ªé™æ€å˜é‡å­˜å‚¨è½¬åŒ–ç»“æœï¼Œå‡½æ•°çš„è¿”å›å€¼æŒ‡å‘è¯¥é™æ€å†…å­˜ï¼Œå› æ­¤`inet_ntoa`æ˜¯ä¸å¯é‡å…¥çš„ã€‚\n```c\nchar* szValuel = inet_ntoa(\"1.2.3.4\");\nchar* szValue2 = inet_ntoa(\"10.194.71.60\");\nprintf(\"address 1: $s\\n\", szValue1);\nprintf(\"address 2: $s\\n\", szValue2);\n```\nè¿è¡Œè¿™æ®µä»£ç ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ï¼š\naddress1: 10.194.71.60\naddress2: 10.194.71.60\nå› æ­¤å¤šæ¬¡è°ƒç”¨è¯¥å‡½æ•°åï¼Œå‰é¢çš„ç»“æœéƒ½ä¼šå¤±æ•ˆã€‚\n\n## æ¨èä½¿ç”¨æ›´æ–°çš„å‡½æ•°ï¼ˆptonã€ntopï¼‰\nå®šä¹‰äº`<arpa/inet.h>`ã€‚è¿™æ˜¯éšIPv6å‡ºç°çš„æ–°å‡½æ•°ï¼Œä½†åŒæ ·é€‚ç”¨äºIPv4ã€‚\n```c\n#include<arpa/inet.h>\nint inet_pton(int af, const char* src, void* dst);\nconst char* inet_ntop(int af, const void* src, char* dst, socklen_t cnt);\n```\n`inet_pton`æˆåŠŸæ—¶è¿”å›1ï¼Œå¤±è´¥åˆ™è¿”å›0å¹¶è®¾ç½®errnoã€‚\n\n`inet_ntop`ä¸­çš„cntå‚æ•°æŒ‡å®šç›®æ ‡å­˜å‚¨å•å…ƒï¼ˆå­—ç¬¦æ•°ç»„ï¼‰çš„å¤§å°ã€‚ä¸‹é¢çš„å®èƒ½å¸®åŠ©æˆ‘ä»¬æŒ‡å®šè¿™ä¸ªå¤§å°ï¼š\n```c\n#include <netinet/in.h>\n#define INET_ADDRSTRLEN  16\n#define INET6_ADDRSTRLEN 46\n```\n16æ˜¯ï¼š4ä¸ª3ä½æ•°+3ä¸ªç‚¹+1ä¸ª`\\0`\n\n`inet_ntop`æˆåŠŸæ—¶è¿”å›ç›®æ ‡å­˜å‚¨å•å…ƒçš„åœ°å€ï¼Œå¤±è´¥åˆ™è¿”å›`NULL`å¹¶è®¾ç½®errnoã€‚\n# å»ºç«‹Socketè¿æ¥API\n\n```c\n#include<sys/types.h>\n#include<sys/socket.h>\nint socket(int domain, int type, int protocol);\nint bind(int sockfd, const struct sockaddr* addr, socklen_t addrlen);\nint listen(int sockfd, int backlog);\nint accept(int sockfd, struct sockaddr* addr, socklen_t *addrlen);\nint connect(int sockfd, const struct sockaddr* serv_addr, socklen_t addrlen);\nint close(int sockfd);\n```\n## socket()\n```c\nint socket(int domain, int type, int protocol);\n```\n1. `socket()`æ–¹æ³•æ˜¯ç”¨æ¥åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—ï¼Œæœ‰äº†å¥—æ¥å­—å°±å¯ä»¥é€šè¿‡ç½‘ç»œè¿›è¡Œæ•°æ®çš„æ”¶å‘ã€‚åˆ›å»ºå¥—æ¥å­—æ—¶è¦**æŒ‡å®šä½¿ç”¨çš„æœåŠ¡ç±»å‹**ï¼Œæ¯”å¦‚ä½¿ç”¨TCPåè®®é€‰æ‹©æµå¼æœåŠ¡`SOCK_STREAM`ã€‚\n2. å‚æ•°å«ä¹‰ï¼š\n    1. ç¬¬ä¸€ä¸ªdomainè¡¨ç¤ºSocket Address Familyï¼Œé€šå¸¸æ˜¯`AF_INET`ï¼›\n    2. ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºåŸºäºçš„æœåŠ¡ç±»å‹ï¼Œé€šå¸¸æœ‰åŸºäºæµå¼çš„æœåŠ¡(TCP)å’ŒåŸºäºæ•°æ®æŠ¥çš„æœåŠ¡(UDP)ï¼›\n    3. ç¬¬ä¸‰ä¸ªå‚æ•°æŒ‡æ˜ä½ æ˜¯åŸºäºä»€ä¹ˆåè®®ã€‚ä¸€èˆ¬å¡«0ï¼Œè¡¨ç¤ºé»˜è®¤ã€‚å› ä¸ºå‰ä¸¤ä¸ªå‚æ•°çš„ç¡®å®šå³å¯çº¦æŸç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯TCPè¿˜æ˜¯UDPäº†ã€‚\n3. Returns `file descriptor` on success, `-1` on error.\n## bind() - å‘½åsocket - ç»‘å®šåœ°å€\n```c\nint bind(int sockfd, const struct sockaddr* addr, socklen_t addrlen);\n```\n1. `bind()`æ–¹æ³•ç”¨æ¥æŒ‡å®šå¥—æ¥å­—ä½¿ç”¨çš„IPåœ°å€å’Œç«¯å£\n    1. IPåœ°å€å°±æ˜¯ç­‰å¾…è¢«è¿æ¥çš„æœåŠ¡å™¨åœ°å€ã€‚\n    2. ç«¯å£æ˜¯ä¸€ä¸ª16ä½çš„æ•´å‹å€¼ã€‚\n        1. `0-1023`ä¸ºçŸ¥åç«¯å£ï¼Œåœ¨linuxä¸Šï¼Œ1024ä»¥å†…çš„ç«¯å£å·åªæœ‰rootç”¨æˆ·å¯ä»¥ä½¿ç”¨ã€‚\n        2. `1024-4095`ä¸ºé¢„ç•™ç«¯å£ï¼Œç”¨æˆ·ä¸å¯éšæ„ä½¿ç”¨ï¼›\n        3. `4096ä»¥ä¸Š`ä¸ºä¸´æ—¶ç«¯å£ï¼Œç”¨æˆ·æŒ‰éœ€ä½¿ç”¨ã€‚\n2. sockaddrå¯ä»¥çœ‹ä½œæ˜¯`sockaddr_in`çš„æŠ½è±¡ç±»å‹ã€‚\n3. return`0` on success, or `-1` on error.\n## listen()\nåˆ›å»º2ä¸ªç›‘å¬é˜Ÿåˆ—ï¼Œä¸€ä¸ªå­˜æ”¾æœªå®Œæˆè¿æ¥çš„å®¢æˆ·ï¼Œä¸€ä¸ªå­˜æ”¾å·²å®Œæˆè¿æ¥çš„å®¢æˆ·ã€‚\n```c\nint listen(int sockfd, int backlog);\n```\n1. å°†æ–‡ä»¶æè¿°ç¬¦`sockfd`å¼•ç”¨çš„æµsocketæ ‡è®°ä¸ºè¢«åŠ¨ã€‚è¿™ä¸ªsocketåé¢ä¼šè¢«ç”¨æ¥æ¥å—å…¶ä»–socketçš„ä¸»åŠ¨è¿æ¥ã€‚\n2. ç”¨æ¥åˆ›å»ºç›‘å¬é˜Ÿåˆ—ã€‚ç›‘å¬é˜Ÿåˆ—æœ‰**ä¸¤ç§**ï¼Œ**ä¸€ä¸ªæ˜¯å­˜æ”¾æœªå®Œæˆä¸‰æ¬¡æ¡æ‰‹çš„è¿æ¥**ï¼Œ**ä¸€ç§æ˜¯å­˜æ”¾å·²å®Œæˆä¸‰æ¬¡æ¡æ‰‹çš„è¿æ¥**ã€‚\n3. ç¬¬äºŒä¸ªå‚æ•°`backlog`æŒ‡å®šç³»ç»Ÿç›‘å¬è¿æ¥çš„æœ€å¤§å®¹é‡æ•°ç›®ã€‚å¦‚æœè¿æ¥æ•°é‡è¶…è¿‡äº†é˜Ÿåˆ—é•¿åº¦ï¼ŒæœåŠ¡å™¨å°†ä¸å†å—ç†æ–°çš„è¿æ¥ï¼Œå®¢æˆ·ç«¯ä¼šæ”¶åˆ°`ECONNREFUSED`é”™è¯¯æ¶ˆæ¯ã€‚\n    1. åœ¨å†…æ ¸ç‰ˆæœ¬2.2ä¹‹å‰ï¼Œbacklogè¡¨ç¤ºæ‰€æœ‰åŠè¿æ¥ï¼ˆSYN_RCVDï¼‰ã€å®Œå…¨è¿æ¥ï¼ˆESTABLISHEDï¼‰çš„æ•°é‡ä¸Šé™ã€‚\n    2. ä½†è‡ª2.2ä¹‹åï¼Œå®ƒåªè¡¨ç¤ºå¤„äºå®Œå…¨è¿æ¥çŠ¶æ€çš„æ•°é‡ä¸Šé™ã€‚å¤„äºåŠè¿æ¥çŠ¶æ€çš„æ•°é‡ä¸Šé™åˆ™ç”±`/proc/svs/net/ipv4/tcp_max_syn_backlog`å®šä¹‰ã€‚\n    3. backlogå‚æ•°çš„å…¸å‹å€¼æ˜¯5ã€‚\n    4. ç³»ç»Ÿå®é™…ä¸Šå¯ä»¥ç›‘å¬çš„è¿æ¥æ•°ç›®æ˜¯è¶…è¿‡backlogçš„ã€‚\n4. return `0` on success, or `-1` on error.\n5. æ— æ³•åœ¨ä¸€ä¸ªå·²è¿æ¥çš„socketï¼ˆå·²ç»æˆåŠŸæ‰§è¡Œ`connect()`çš„æˆ–ç”±`accept()`è°ƒç”¨è¿”å›çš„socketï¼‰å†æ‰§è¡Œ`listen()`ã€‚\n\n![](../../images/ç½‘ç»œ_TCPç¼–ç¨‹æµç¨‹/image-20250722090234499.png)\nå›¾ç‰‡æºäºUNIXç½‘ç»œç¼–ç¨‹_å·1\n\n### å…·ä½“æµç¨‹\n1. å½“æ¥è‡ªå®¢æˆ·çš„SYNåˆ°è¾¾æ—¶ï¼ŒTCPåœ¨æœªå®Œæˆè¿æ¥é˜Ÿåˆ—ä¸­åˆ›å»ºä¸€ä¸ªæ–°é¡¹\n2. ç„¶åå“åº”ä»¥ä¸‰è·¯æ¡æ‰‹çš„ç¬¬äºŒä¸ªåˆ†èŠ‚ï¼šæœåŠ¡å™¨çš„SYN+ACKå“åº”ã€‚\n3. è¿™ä¸€é¡¹ä¸€ç›´ä¿ç•™åœ¨æœªå®Œæˆè¿æ¥é˜Ÿåˆ—ä¸­ï¼Œç›´åˆ°ä¸‰è·¯æ¡æ‰‹çš„ç¬¬ä¸‰ä¸ªåˆ†èŠ‚ï¼ˆå®¢æˆ·å¯¹æœåŠ¡å™¨SYNçš„ACKï¼‰åˆ°è¾¾æˆ–è€…è¯¥é¡¹è¶…æ—¶ä¸ºæ­¢ã€‚\n4. å¦‚æœä¸‰è·¯æ¡æ‰‹æ­£å¸¸å®Œæˆï¼Œè¯¥é¡¹å°±ä»æœªå®Œæˆè¿æ¥é˜Ÿåˆ—ç§»åˆ°å·²å®Œæˆè¿æ¥é˜Ÿåˆ—çš„é˜Ÿå°¾ã€‚\n5. å½“è¿›ç¨‹è°ƒç”¨acceptæ—¶ï¼Œå·²å®Œæˆè¿æ¥é˜Ÿåˆ—ä¸­çš„é˜Ÿå¤´é¡¹å°†è¿”å›ç»™è¿›ç¨‹ï¼Œ\n    1. æˆ–è€…å¦‚æœè¯¥é˜Ÿåˆ—ä¸ºç©ºï¼Œé‚£ä¹ˆè¿›ç¨‹å°†è¢«ç½®äºä¼‘çœ çŠ¶æ€ï¼Œç›´åˆ°TCPåœ¨è¯¥é˜Ÿåˆ—ä¸­æ”¾å…¥ä¸€é¡¹æ‰å”¤é†’å®ƒã€‚\n## accept()\n```c\nint accept(int sockfd, struct sockaddr* addr, socklen_t *addrlen);\n```\n1. `accept()`ï¼šä»å·²å®Œæˆè¿æ¥é˜Ÿåˆ—çš„é˜Ÿå¤´å–å‡ºä¸€ä¸ªè¿æ¥é¡¹ã€‚æ¯å¤„ç†ä¸€ä¸ªè¿æ¥ï¼Œåˆ™`accept()`è¿”å›è¯¥è¿æ¥å¯¹åº”çš„å¥—æ¥å­—æè¿°ç¬¦ã€‚å¦‚æœè¯¥é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™accepté˜»å¡ã€‚\n2. å®ƒä¼šåˆ›å»ºä¸€ä¸ªæ–°socketï¼Œå¹¶ä¸”æ­£æ˜¯è¿™ä¸ªæ–°socketä¼šä¸æ‰§è¡Œ`connect()`çš„å¯¹ç­‰socketè¿›è¡Œè¿æ¥ã€‚\n3. ç”±äºacceptæ˜¯é€šç”¨çš„APIï¼Œå®ƒä¸çŸ¥é“å¯¹æ–¹æ˜¯ä»€ä¹ˆåè®®æ—ï¼Œå› æ­¤addræ˜¯æŠ½è±¡ç±»å‹ï¼Œaddrlenä¹Ÿæ˜¯ä¸ç¡®å®šçš„ï¼Œéœ€è¦ä¼ æŒ‡é’ˆã€‚\n4. `accept()`è°ƒç”¨è¿”å›çš„å‡½æ•°ç»“æœæ˜¯åˆ›å»ºçš„socketå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦ã€‚\n5. return `file descriptor` on success, or `-1` on error.\n\n### acceptåªç®¡å–å‡ºè¿æ¥ï¼Œä¸ç®¡è¿æ¥çŠ¶æ€\nç°åœ¨è€ƒè™‘å¦‚ä¸‹æƒ…å†µï¼šå¦‚æœç›‘å¬é˜Ÿåˆ—ä¸­å¤„äºESTABLISHEDçŠ¶æ€çš„è¿æ¥å¯¹åº”çš„å®¢æˆ·ç«¯å‡ºç°ç½‘ç»œå¼‚å¸¸ï¼ˆæ¯”å¦‚æ‰çº¿ï¼‰ï¼Œæˆ–è€…æå‰é€€å‡ºï¼Œé‚£ä¹ˆæœåŠ¡å™¨å¯¹è¿™ä¸ªè¿æ¥æ‰§è¡Œçš„acceptè°ƒç”¨æ˜¯å¦æˆ\nåŠŸï¼Ÿ\nå®¢æˆ·ç«¯è¿æ¥æˆåŠŸåï¼Œç«‹å³æ–­å¼€è¯¥å®¢æˆ·ç«¯çš„ç½‘ç»œè¿æ¥ï¼ˆç±»ä¼¼äºæ‹”æ‰ç½‘çº¿ï¼‰ï¼ˆæœåŠ¡å™¨è¿˜æ²¡ååº”è¿‡æ¥å®¢æˆ·ç«¯æ–­ç½‘äº†ï¼‰ã€‚ç»“æœå‘ç°acceptè°ƒç”¨èƒ½å¤Ÿæ­£å¸¸è¿”å›ã€‚\nåœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œnetstatå‘½ä»¤ä»¥æŸ¥çœ‹acceptè¿”å›çš„è¿æ¥socketçš„çŠ¶æ€ï¼šå‘ç°ä¾ç„¶æ˜¯ESTABLISHEDã€‚è¯´æ˜ï¼Œacceptè°ƒç”¨å¯¹äºå®¢æˆ·ç«¯ç½‘ç»œæ–­å¼€æ¯«ä¸çŸ¥æƒ…ã€‚\n\nå¦‚æœå®¢æˆ·ç«¯å»ºç«‹è¿æ¥åç«‹å³é€€å‡ºå®¢æˆ·ç«¯ç¨‹åºï¼ˆå®¢æˆ·ç«¯å‘å‡ºFINï¼‰ã€‚è¿™æ¬¡acceptè°ƒç”¨åŒæ ·æ­£å¸¸è¿”å›ã€‚\næœåŠ¡ç«¯netstatå‘½ä»¤å‘ç°è¿æ¥çŠ¶æ€ä¸º`CLOSE_WAIT`ã€‚å†æ¬¡è¯´æ˜ï¼šacceptåªæ˜¯ä»ç›‘å¬é˜Ÿåˆ—ä¸­å–å‡ºè¿æ¥ï¼Œè€Œä¸è®ºè¿æ¥å¤„äºä½•ç§çŠ¶æ€ï¼Œæ›´ä¸å…³å¿ƒä»»ä½•ç½‘ç»œçŠ¶å†µçš„å˜åŒ–ã€‚\n## connect()\n```c\nint connect(int sockfd, const struct sockaddr* serv_addr, socklen_t addrlen);\n```\n1. connectæ–¹æ³•å°†æ–‡ä»¶æè¿°ç¬¦`sockfd`å¼•ç”¨çš„ä¸»åŠ¨socketè¿æ¥åˆ°é€šè¿‡addrå’ŒaddrlenæŒ‡å®šåœ°å€çš„ç›‘å¬socketä¸Šã€‚\n2. ä¸€èˆ¬ç”±å®¢æˆ·ç«¯ç¨‹åºæ‰§è¡Œï¼Œéœ€è¦æŒ‡å®šè¿æ¥çš„æœåŠ¡å™¨ç«¯çš„IPåœ°å€å’Œç«¯å£ã€‚è¯¥æ–¹æ³•æ‰§è¡Œåï¼Œä¼šè¿›è¡Œä¸‰æ¬¡æ¡æ‰‹ï¼Œå»ºç«‹è¿æ¥ã€‚\n3. return `0` on success, or `-1` on error.\n# æ•°æ®æ”¶å‘API\n\n## TCP\n```c\nssize_t recv(int sockfd, void* buff, size_t len, int flags);\nssize_t send(int sockfd, const void* buff, size_t len, int flags);\n```\nrecvè¿”å›æ¥æ”¶çš„å­—èŠ‚æ•°ï¼Œå¦‚æœå‘ç”Ÿé”™è¯¯åˆ™è¿”å› `-1`ã€‚å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™ä¼šè®¾ç½® `errno` æ¥æŒ‡ç¤ºé”™è¯¯ã€‚\nå½“**æµå¥—æ¥å­—**ï¼ˆå¦‚TCPï¼‰å¯¹ç­‰ä½“æ‰§è¡Œäº†æœ‰åºå…³é—­æ—¶ï¼Œè¿”å›å€¼ä¸º 0ï¼ˆä¼ ç»Ÿçš„â€œæ–‡ä»¶ç»“æŸâ€è¿”å›ï¼‰ã€‚\nå¦‚æœè¯·æ±‚ä»**æµå¥—æ¥å­—**æ¥æ”¶çš„å­—èŠ‚æ•°ä¸º 0ï¼Œä¹Ÿå¯èƒ½è¿”å› 0ã€‚\n\nsendå¦‚æœæˆåŠŸï¼Œå°†è¿”å›å·²å‘é€çš„å­—èŠ‚æ•°ã€‚å¦‚æœå¤±è´¥ï¼Œåˆ™è¿”å› `-1`ï¼Œå¹¶è®¾ç½®ç›¸åº”çš„ `errno`ã€‚\n## UDP\n```c\nssize_t recvfrom(int sockfd, void* buff, size_t len, int flags,\n                 struct sockaddr* src_addr, socklen_t* addrlen);\nssize_t sendto(int sockfd, void* buff, size_t len, int flags,\n               struct sockaddr* dest_addr, socklen_t addrlen);\n```\nrecvfromè¿”å›æ¥æ”¶çš„å­—èŠ‚æ•°ï¼Œå¦‚æœå‘ç”Ÿé”™è¯¯åˆ™è¿”å› `-1`ã€‚å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™ä¼šè®¾ç½® `errno` æ¥æŒ‡ç¤ºé”™è¯¯ã€‚\n\nä¸åŒåŸŸï¼ˆä¾‹å¦‚ UNIX å’Œ Internet åŸŸï¼‰ä¸­çš„**æ•°æ®æŠ¥**å¥—æ¥å­—ï¼ˆå¦‚UDPï¼‰å…è®¸æ¥æ”¶ 0 é•¿åº¦æ•°æ®æŠ¥ã€‚å½“æ¥æ”¶åˆ°æ­¤ç±»æ•°æ®æŠ¥æ—¶ï¼Œè¿”å›å€¼ä¸º 0ã€‚\n\nsendtoå¦‚æœæˆåŠŸï¼Œå°†è¿”å›å·²å‘é€çš„å­—èŠ‚æ•°ã€‚å¦‚æœå¤±è´¥ï¼Œåˆ™è¿”å› `-1`ï¼Œå¹¶è®¾ç½®ç›¸åº”çš„ `errno`ã€‚\n\n# Linuxä»£ç  - TCP\n\n```c\nint main()\n{\n/*  int socket(int domain, int type, int protocol);  */\n    int sockfd = socket(AF_INET, SOCK_STREAM, 0);\n    assert(sockfd != -1);\n    \n    struct sockaddr_in ser_addr;\n    memset(&ser_addr, 0, sizeof(ser_addr));\n    \n    ser_addr.sin_family = AF_INET;\n    ser_addr.sin_port = htons(6000);\n    ser_addr.sin_addr.s_addr = inet_addr(\"127.0.0.1\");\t//inet_addr(): make string to integer\n    \n/*  int bind(int sockfd, const struct sockaddr* addr, socklen_t addrlen);  */\n    int res = bind(sockfd, (struct sockaddr*)&ser_addr, sizeof(ser_addr));\n    assert(res != -1);\n    \n/*  int listen(int sockfd, int backlog);  */\n    res = listen(sockfd, 5);\n    assert(res != -1);\n    \n    struct sockaddr_in cli_addr;\n    while(1)\n    {\n/*  int accept(int sockfd, struct sockaddr* addr, socklen_t *addrlen);  */\n        int len = sizeof(cli_addr);\n        int conn_fd = accept(sockfd, (struct sockaddr*)&cli_addr, &len);\n        if (conn_fd == -1) continue;\n        \n        char buff[128] = {0};\n        int num = recv(conn_fd, buff, 127, 0);\n        printf(\"buff = %s, num = %d\\n\", buff, num);\n        \n        send(conn_fd, \"OK\", 2, 0);\n        \n        close(conn_fd);\n    }\n}\n```\n# ç²˜åŒ…é—®é¢˜\nTCPæ˜¯æµå¼æœåŠ¡ï¼Œæ•°æ®æ˜¯ä»¥æµçš„å½¢å¼ä¼ è¾“çš„ï¼Œåœ¨ç½‘ç»œå±‚è¿™ä¸€å±‚é¢ï¼Œä¸åº”è¯¥è€ƒè™‘ç²˜åŒ…çš„é—®é¢˜ã€‚\n\nè€Œæ˜¯åº”è¯¥åœ¨TCPä¼ è¾“çš„æ•°æ®æœ¬èº«ä¸Šåšæ–‡ç« ã€‚\n\nå¯ä»¥è¿™æ ·å¤„ç†ï¼šå‘é€ç«¯æ¯sendä¸€æ¬¡ï¼Œæ¥æ”¶ç«¯å°±recvä¸€æ¬¡ï¼Œå¹¶ä¸”è¦å›å‘ä¸€ä¸ªokï¼Œå‘é€ç«¯recvï¼Œç­‰å¾…okåˆ°äº†ä¹‹åæ‰sendä¸‹ä¸€ä¸ªæ•°æ®ã€‚ä½†æ˜¯è¿™æ ·åšæ•ˆç‡å¤ªä½äº†ã€‚\n\nå¯ä»¥åŠ æ ‡å¿—ä½ä»¥åŒºåˆ†æ•°æ®çš„å®Œæ•´æ€§ã€‚è¿™æ˜¯ç®€å•çš„åšæ³•ã€‚æ¯”å¦‚ï¼š7ã€3ã€2ï¼Œå¤„ç†ä¹‹åï¼š`[7][3][2]`\n\næ›´å¥½çš„åšæ³•æ˜¯ï¼šåœ¨æ¯ä¸ªç‹¬ç«‹çš„æ•°æ®å‰åŠ ä¸€ä¸ªå¤´éƒ¨ï¼Œå¤´éƒ¨ä¸­è®°å½•æ•°æ®çš„é•¿åº¦ã€‚å¦‚æ­¤ä¾¿å¯ä¸ä¸‹ä¸€ä¸ªæ•°æ®åšåŒºåˆ†ã€‚\n\n## ä¼šå¼•èµ·ç²˜åŒ…çš„å®¢æˆ·ç«¯ä»£ç \n```c\n#include <stdio.h>\n#include <sys/socket.h>\n#include <netinet/in.h>\n#include <arpa/inet.h>\n#include <string.h>\n\nint main()\n{\n    int error = 0;\n    int client_sock = socket(AF_INET, SOCK_STREAM, 0);\n    // æ•°æ®äº¤äº’\n\n    // å‘é€æ¶ˆæ¯\n    const char * msg1 = \"hi\";\n    const char * msg2 = \"jack\";\n    error = send(client_sock, msg1, strlen(msg1), 0);\n    if (error < 0)\n    {\n        printf(\"send error\\n\");\n        return -1;\n    }\n    error = send(client_sock, msg2, strlen(msg2), 0);\n    if (error < 0)\n    {\n        printf(\"send error\\n\");\n        return -1;\n    }\n\n    // æ¥æ”¶æ¶ˆæ¯\n\n}\n```\n## å®¢æˆ·ç«¯æ”¹è¿›\nä¸ºæ¯ä¸ªæ¶ˆæ¯åŒ…ä¸€ä¸ªåŒ…è£¹ï¼Œå‰é¢4ä¸ªå­—èŠ‚å­˜æ”¾æ¶ˆæ¯çš„å¤§å°ã€‚\nä½¿ç”¨memmoveå®ç°å­—èŠ‚ç§»åŠ¨ã€‚ï¼ˆå®é™…å°±æ˜¯æŠŠæ¶ˆæ¯å¡«å…¥åˆ°4å­—èŠ‚åçš„ä½ç½®ï¼‰\n```c\n#include <stdio.h>\n#include <sys/socket.h>\n#include <netinet/in.h>\n#include <arpa/inet.h>\n#include <string.h>\n\nint main()\n{\n    int error = 0;\n    int client_sock = socket(AF_INET, SOCK_STREAM, 0);\n\n    struct sockaddr_in server_addr;\n    server_addr.sin_family = AF_INET;\n    server_addr.sin_port = htons(8888);\n    inet_pton(AF_INET, \"127.0.0.1\", &(server_addr.sin_addr.s_addr));\n\n    connect(client_sock, (struct sockaddr*)&server_addr, sizeof(server_addr));\n\n    // æ•°æ®äº¤äº’\n\n    // å‘é€æ¶ˆæ¯\n    const char * msg1 = \"hi\";\n    const char * msg2 = \"jack\";\n    char data1[256] = {0};\n\n    // åœ¨data1çš„ä½åœ°å€ï¼ˆå ç”¨4ä¸ªå­—èŠ‚ï¼‰å¡«å……msgçš„é•¿åº¦\n    *(int*)(data1) = strlen(msg1);\n    int headLen = sizeof(int);\n\n    // ä»data1çš„headLenåé¢å¼€å§‹ï¼Œå¡«å……msg1çš„å­—ç¬¦ä¸²å†…å®¹\n    memmove(data1 + headLen, msg1, strlen(msg1));\n\n    error = send(client_sock, data1, headLen + strlen(msg1), 0);\n    if (error < 0)\n    {\n        printf(\"send error\\n\");\n        return -1;\n    }\n\n\n    char data2[256] = {0};\n    *(int*)(data2) = strlen(msg2);\n    memmove(data2 + headLen, msg2, strlen(msg2));\n    error = send(client_sock, data2, headLen + strlen(msg2), 0);\n    if (error < 0)\n    {\n        printf(\"send error\\n\");\n        return -1;\n    }\n\n    close(client_sock);\n}\n```\n## æœåŠ¡ç«¯\nä¸»è¦é€»è¾‘åœ¨å¾ªç¯ä¸Šã€‚\nè¦è®°å½•æ¯æ¬¡è¯»åˆ°çš„é•¿åº¦ï¼ˆreadLenï¼‰ï¼Œç›®å‰æœªå¤„ç†çš„ï¼ˆå› ä¸ºæ•°æ®ä¸å®Œæ•´ï¼‰çš„é•¿åº¦ï¼ˆgotLenï¼‰ã€‚\nå½“gotLenå¤§äºç­‰äº4å­—èŠ‚æ—¶ï¼Œå‰4ä¸ªå­—èŠ‚æ˜¯å­—ç¬¦ä¸²é•¿åº¦ï¼ˆmsgLenï¼‰ã€‚\nå†å»çœ‹gotLenå‡å»headLenï¼ˆintçš„4å­—èŠ‚ï¼‰ï¼Œæ˜¯å¦å¤§äºç­‰äºmsgLenã€‚å¦‚æœæ˜¯ï¼Œåˆ™è¯´æ˜æ•°æ®å®Œæ•´äº†ï¼Œå¯ä»¥å–å‡ºäº†ã€‚\nå»é™¤ä¹‹åï¼Œåˆ«å¿˜è®°æ›´æ–°gotLençš„å€¼ï¼Œå‡å»è¿™æ¬¡å·²ç»å¤„ç†äº†çš„headLenå’ŒmsgLenã€‚\nå®¹æ˜“é—å¿˜çš„æ˜¯ï¼Œéœ€è¦æŠŠbuffä¸­ï¼ŒæŠŠæœ¬æ¬¡å¤„ç†äº†çš„headLenã€msgLenä¹‹åçš„æ•°æ®å‰ç§»è¦†ç›–ã€‚ä»ç”¨memmoveã€‚\nç¬¬ä¸€å±‚å¾ªç¯ï¼Œæ˜¯è¯»åˆ°buffï¼Œæœ‰å­—èŠ‚å°±è¯»ã€‚é™¤éè¿”å›`-1`ã€‚\nç¬¬äºŒå±‚å¾ªç¯ï¼Œæ˜¯çœ‹æ˜¯å¦å¤Ÿ4ä¸ªå­—èŠ‚ï¼Œä¸å¤Ÿå°±é€€å‡ºç¬¬äºŒå±‚å¾ªç¯ã€‚\n```c\n#include <stdio.h>\n#include <sys/socket.h>\n#include <netinet/in.h>\n#include <arpa/inet.h>\n#include <string.h>\n\nint main()\n{\n    int error = 0;\n    int server_sock = socket(AF_INET, SOCK_STREAM, 0);\n    struct sockaddr_in server_addr;\n    server_addr.sin_family = AF_INET;\n    server_addr.sin_port = htons(8888);\n    inet_pton(AF_INET, \"127.0.0.1\", &(server_addr.sin_addr.s_addr));\n    bind(server_sock, (struct sockaddr*)&server_addr, sizeof(server_addr));\n    listen(server_sock, 5);\n\n    struct sockaddr_in client_addr;\n    socklen_t client_addr_len = sizeof(client_addr);\n    int client_sock = accept(server_sock, (struct sockaddr*)&client_addr, &client_addr_len);\n    // æ•°æ®äº¤äº’\n\n    // æ¥æ”¶æ¶ˆæ¯\n    char buff[1024] = {0};\n    int headLen = sizeof(int);\n    int gotLen = 0;\n    int readLen = 0;\n    while ((readLen = recv(client_sock, buff + gotLen, sizeof(buff) - gotLen, 0)) != -1)\n    {\n        gotLen += readLen;\n        while (gotLen >= headLen)\n        {\n            int msgLen = *(int*)buff;\n            if (gotLen - headLen >= msgLen)\n            {\n                char msgBuff[512] = {0};\n                memmove(msgBuff, buff + headLen, msgLen);\n                printf(\"msgBuff = %s\\n\", msgBuff);\n                int dataLen = headLen + msgLen;\n                memmove(buff, buff + dataLen, gotLen - dataLen);\n                gotLen -= dataLen;\n            }\n            else\n            {\n                break;\n            }\n        }\n    }\n}\n```\n## æµ‹è¯•\n```\nmrcan@ubuntu:~/networkProgram$ ./tcpserver \nmsgBuff = hi\nmsgBuff = jack\n```\n# Linuxä»£ç  - UDP\n## æœåŠ¡ç«¯\n```c\n#include <iostream>\n#include <sys/socket.h>\n#include <netinet/in.h>\n#include <arpa/inet.h>\n#include <string.h>\nint main()\n{\n    int error = 0;\n    int server_socket = socket(AF_INET, SOCK_DGRAM, 0);\n    // addr\n    struct sockaddr_in server_addr;\n    server_addr.sin_family = AF_INET;\n    server_addr.sin_port = htons(8000);\n    error = inet_pton(AF_INET, \"127.0.0.1\", &(server_addr.sin_addr.s_addr));\n    if (error == -1)\n    {\n        printf(\"inet_pton error!\");\n        exit(1);\n    }\n\n    error = bind(server_socket, (sockaddr*)&server_addr, sizeof(server_addr));\n    if (error == -1)\n    {\n        printf(\"bind error!\");\n        exit(1);\n    }\n    struct sockaddr_in client_addr;\n    socklen_t client_addr_len = sizeof(client_addr);\n    while (1)\n    {\n        char buff[1024];\n        memset(buff, 0, sizeof(buff));\n        int n = recvfrom(server_socket, buff, sizeof(buff), 0, (sockaddr*)&client_addr, &client_addr_len);\n        if (n == -1)\n        {\n            printf(\"recvfrom error!\");\n            exit(1);\n        }\n        printf(\"buff = %s\\n\", buff);\n        n = sendto(server_socket, \"ok\", 2, 0, (sockaddr*)&client_addr, client_addr_len);\n        if (n == -1)\n        {\n            printf(\"sendto error!\");\n            exit(1);\n        }\n    }\n}\n```\n\n## å®¢æˆ·ç«¯\n```c\n#include <iostream>\n#include <sys/socket.h>\n#include <netinet/in.h>\n#include <arpa/inet.h>\n#include <string.h>\nint main()\n{\n    int error = 0;\n    int client_socket = socket(AF_INET, SOCK_DGRAM, 0);\n    // addr\n    struct sockaddr_in server_addr;\n    server_addr.sin_family = AF_INET;\n    server_addr.sin_port = htons(8000);\n    error = inet_pton(AF_INET, \"127.0.0.1\", &(server_addr.sin_addr.s_addr));\n    if (error == -1)\n    {\n        printf(\"inet_pton error!\");\n        exit(1);\n    }\n\n    socklen_t server_addr_len = sizeof(server_addr);\n    char buff[1024];\n    while (1)\n    {\n        memset(buff, 0, sizeof(buff));\n        fgets(buff, sizeof(buff), stdin);\n        if (strncmp(\"end\", buff, 3) == 0)\n        {\n            break;\n        }\n        int n = sendto(client_socket, buff, strlen(buff) - 1, 0, (sockaddr*)&server_addr, server_addr_len);\n        if (n == -1)\n        {\n            printf(\"sendto error!\");\n            exit(1);\n        }\n        memset(buff, 0, sizeof(buff));\n        n = recvfrom(client_socket, buff, sizeof(buff), 0, (sockaddr*)&server_addr, &server_addr_len);\n        if (n == -1)\n        {\n            printf(\"recvfrom error!\");\n            exit(1);\n        }\n        printf(\"buff = %s\\n\", buff);\n    }\n}\n```\n\n# Windowsä»£ç \n## è¦å¼•å…¥çš„åº“åŠé“¾æ¥å™¨é…ç½®\nWindowsä¸‹çš„socketç¼–ç¨‹éœ€è¦å¼•å…¥`WinSock2.h`åº“ï¼Œè¿˜éœ€è¦é¢„å¤„ç†é“¾æ¥`#pragma comment(lib, \"Ws2_32.lib\")`ã€‚\n`#pragma comment(lib, \"Ws2_32.lib\")` æ˜¯ç”¨äºæŒ‡å®šé“¾æ¥å™¨é€‰é¡¹çš„é¢„å¤„ç†æŒ‡ä»¤ï¼Œåœ¨Windowså¹³å°çš„`C/C++`ç¼–ç¨‹ä¸­æ¯”è¾ƒå¸¸è§ã€‚\n- **ä½œç”¨**: è¿™æ¡æŒ‡ä»¤å‘Šè¯‰ç¼–è¯‘å™¨åœ¨é“¾æ¥é˜¶æ®µè¦é“¾æ¥ `Ws2_32.lib` åº“ï¼Œè¿™æ˜¯ä¸€ä¸ªåŒ…å« Windows Sockets 2 (Winsock) å‡½æ•°çš„åº“ã€‚Winsock æä¾›äº†ç½‘ç»œç¼–ç¨‹çš„ APIï¼Œå…è®¸ç¨‹åºè¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œæ¯”å¦‚åˆ›å»ºå¥—æ¥å­—ã€å‘é€å’Œæ¥æ”¶æ•°æ®ç­‰ã€‚\n    - é€šè¿‡ `#pragma comment(lib, \"Ws2_32.lib\")`ï¼Œå¯ä»¥åœ¨ä»£ç ä¸­ç›´æ¥æŒ‡å®šè¦é“¾æ¥çš„åº“ï¼Œè¿™æ ·å°±ä¸éœ€è¦åœ¨ç¼–è¯‘æˆ–é¡¹ç›®è®¾ç½®ä¸­æ‰‹åŠ¨é…ç½®é“¾æ¥å™¨é€‰é¡¹ã€‚\n        - æ‰‹åŠ¨é…ç½®ï¼šå³é”®é¡¹ç›®åï¼ŒPropertiesï¼Œå·¦è¾¹æ ï¼šLinker - Inputï¼Œå³è¾¹çš„Additional Dependenciesï¼Œç‚¹å‡»å³è¾¹çš„ä¸‹æ‹‰é”®ï¼Œå†ç‚¹å…¶ä¸­çš„`<Edit...>`ï¼Œä¹‹åå¼¹å‡ºçª—å£ï¼Œå¯ä»¥æŠŠè¦è¾“å…¥çš„åº“å†™åœ¨è¾“å…¥æ¡†ä¸­ã€‚\n\n![](../../images/ç½‘ç»œ_TCPç¼–ç¨‹æµç¨‹è¯¦è§£/image-20240827021846342.png)\n- å¦‚æœä½ åœ¨ä»£ç ä¸­ä½¿ç”¨äº†ç½‘ç»œå‡½æ•°è€Œæ²¡æœ‰é“¾æ¥åˆ° `Ws2_32.lib`ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼Œæç¤ºæ‰¾ä¸åˆ°ç›¸å…³çš„å‡½æ•°å®šä¹‰ã€‚\n## WSAStartup\nåœ¨Microsoft Learnæœç´¢WinSock2ï¼Œå¯ä»¥æ‰¾åˆ°`winsock2.h header`çš„æ¡ç›®ã€‚\n[Winsock2.h header](https://learn.microsoft.com/en-us/windows/win32/api/winsock2/)\n\nç¼–å†™Windows Socketç¨‹åºä¹‹å‰ï¼Œéœ€è¦WSAStartupåˆå§‹åŒ–ã€‚\n[WSAStartup function (winsock2.h)](https://learn.microsoft.com/en-us/windows/win32/api/winsock2/nf-winsock2-wsastartup)\n\nWSAStartup å‡½æ•°å¯åŠ¨è¿›ç¨‹å¯¹ Winsock DLL çš„ä½¿ç”¨ã€‚ï¼ˆå³åˆå§‹åŒ–Winsockçš„åŠ¨æ€é“¾æ¥åº“ï¼‰\nåˆ«å¿˜äº†åœ¨ç¨‹åºç»“æŸå‰è¦WSACleanupï¼Œè¡¨ç¤ºå¸è½½ Winsock DLLã€‚\n```cpp\n#include <WinSock2.h>\n#include <iostream>\n#include <format>\n#pragma comment (lib, \"Ws2_32\")\nint main()\n{\n    WORD wVersionRequested;\n    WSADATA wsaData;\n    int err;\n\n    /* Use the MAKEWORD(lowbyte, highbyte) macro declared in Windef.h */\n    wVersionRequested = MAKEWORD(2, 2);\n\n    err = ::WSAStartup(wVersionRequested, &wsaData);\n    if (err != 0) {\n        /* Tell the user that we could not find a usable */\n        /* Winsock DLL.                                  */\n        std::wcout << std::format(L\"WSAStartup failed with error : {}\\n\", err);\n        return 1;\n    }\n    ::WSACleanup();\n    return 0;\n}\n```\næ­¤å¤„ä½¿ç”¨åˆ°äº†[Cpp_æ‹¼æ¥å­—ç¬¦ä¸²çš„å‡ ç§æ–¹æ³•ï¼ˆformatï¼‰](../Cpp/Cpp_æ‹¼æ¥å­—ç¬¦ä¸²çš„å‡ ç§æ–¹æ³•ï¼ˆformatï¼‰.md)ä¸­çš„formatåº“çš„å­—ç¬¦ä¸²è¾“å‡ºæ–¹æ³•ã€‚\n## åˆ›å»ºå¥—æ¥å­—\nç”¨åˆ°çš„æ˜¯[socket function (winsock2.h)](https://learn.microsoft.com/en-us/windows/win32/api/winsock2/nf-winsock2-socket)\n![](../../images/ç½‘ç»œ_TCPç¼–ç¨‹æµç¨‹è¯¦è§£/image-20240827065503809.png)\n1. ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯Address Familyï¼Œå› æ­¤ç®€ç§°AFï¼Œæ„ä¸ºåœ°å€æ—è§„èŒƒã€‚\n    1. å½“å‰æ”¯æŒçš„å€¼ä¸º`AF_INET`æˆ–`AF_INET6`ï¼Œå®ƒä»¬æ˜¯IPv4å’Œipv6çš„Internetåœ°å€æ—æ ¼å¼ã€‚\n    2. å¦‚æœå®‰è£…äº†åœ°å€æ—çš„Windowså¥—æ¥å­—æœåŠ¡æä¾›ç¨‹åºï¼Œåˆ™æ”¯æŒåœ°å€æ—çš„å…¶ä»–é€‰é¡¹ (ä¾‹å¦‚ï¼Œä¸NetBIOSä¸€èµ·ä½¿ç”¨çš„`AF_NETBIOS`)ã€‚å¦å¤–è¿˜æœ‰è‹¹æœçš„`AF_APPLETALK`ï¼Œè“ç‰™çš„`AF_BTH`ã€‚\n    3. è¯·æ³¨æ„ï¼Œ`AF_` addressç³»åˆ—å’Œ`PF_` protocolç³»åˆ—å¸¸é‡çš„å€¼æ˜¯ç›¸åŒçš„ (ä¾‹å¦‚ï¼ŒAF_INETå’ŒPF_INET)ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ä»»ä¸€å¸¸é‡ã€‚\n2. ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¥—æ¥å­—çš„ç±»å‹è§„èŒƒã€‚\n    1. æœ‰`SOCK_STREAN`ï¼ˆTCPï¼‰ã€`SOCK_DGRAM`ï¼ˆUDPï¼‰ã€`SOCK_RAW`ï¼ˆåŸå§‹å¥—æ¥å­—ï¼‰ã€`SOCK_RDM`ï¼ˆå¯é å¤šæ’­ï¼‰ã€`SOCK_SEQPACKET`ï¼ˆä¼ªæµæ•°æ®æŠ¥å¥—æ¥å­—ï¼‰\n3. ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯åè®®(protocol)ã€‚åè®®å‚æ•°çš„å¯èƒ½é€‰é¡¹ç‰¹å®šäºæŒ‡å®šçš„åœ°å€æ—å’Œå¥—æ¥å­—ç±»å‹ã€‚\n    1. å¦‚æœæŒ‡å®šå€¼0ï¼Œåˆ™è°ƒç”¨è€…ä¸å¸Œæœ›æŒ‡å®šåè®®ï¼Œå¹¶ä¸”æœåŠ¡æä¾›è€…å°†é€‰æ‹©è¦ä½¿ç”¨çš„åè®®ã€‚\n    2. å½“afå‚æ•°æ˜¯AF_INETæˆ–AF_INET6å¹¶ä¸”ç±»å‹æ˜¯SOCK_RAWæ—¶ï¼Œåœ¨IPv6æˆ–IPv4åˆ†ç»„æŠ¥å¤´çš„ protocol å­—æ®µä¸­è®¾ç½®ä¸ºåè®®æŒ‡å®šçš„å€¼ã€‚\n    3. è¯¥åè®®å­—æ®µçš„å¸¸è§å€¼ï¼š`IPPROTO_ICMP`ã€`IPPROTO_IGMP`ã€`BTHPROTO_RFCOMM`ã€`IPPROTO_TCP`ã€`IPPROTO_UDP`ã€`IPPROTO_ICMPV6`ã€`IPPROTO_RM`\n4. è¿”å›å€¼ï¼šå¦‚æœæ²¡æœ‰å‘ç”Ÿé”™è¯¯ï¼Œåˆ™socketè¿”å›socketçš„æè¿°ç¬¦ã€‚å¦åˆ™ï¼Œå°†è¿”å›`INVALID_SOCKET`ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è°ƒç”¨`WSAGetLastError`æ¥æ£€ç´¢ç‰¹å®šçš„é”™è¯¯ä»£ç ã€‚\n\n```cpp\n#define INVALID_SOCKET  (SOCKET)(~0)  // 0å–åï¼Œåˆ™æ˜¯å…¨1\n```\n\n```cpp\nint main()\n{\n    // ...\n\n    SOCKET listen_sock = ::socket(AF_INET, SOCK_STREAM, 0);\n    \n    if (listen_sock == INVALID_SOCKET)\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n    \n    // ...\n}\n```\n## sockaddrç»“æ„\né‡ç‚¹è¯´ä¸€ä¸‹sockaddrï¼Œè¿™æ˜¯ä¸ªç»“æ„ä½“ï¼ŒåŒ…å«äº†ï¼š\n1. `sin_family`\n2. `sin_addr`ï¼Œæ˜¯sockaddrä¸­çš„ä¸€ä¸ªè”åˆä½“ï¼Œå­˜æ”¾IPåœ°å€çš„æ•´å‹ã€‚å¯ä»¥ç”¨`inet_addr(\"127.0.0.1\")`å°†å­—ç¬¦ä¸²è½¬åŒ–ä¸ºæ•´å‹æ¥å¡«å…¥`sin_addr.sin_addr`ã€‚\n3. `sin_port`ï¼Œéœ€è¦ç”¨`htons`ï¼Œä¸»æœºåœ°å€åˆ°ç½‘ç»œçš„è½¬æ¢ã€‚sè¡¨ç¤ºshortï¼Œ2å­—èŠ‚ã€‚\n## bind\n[bind function (winsock2.h)](https://learn.microsoft.com/en-us/windows/win32/api/winsock2/nf-winsock2-bind)\n![](../../images/ç½‘ç»œ_TCPç¼–ç¨‹æµç¨‹è¯¦è§£/image-20240827073919812.png)\n1. å‚æ•°1ï¼šsocketæè¿°ç¬¦ï¼Œæ²¡æœ‰ç»‘å®šè¿‡çš„ã€‚\n2. å‚æ•°2ï¼šæœ¬åœ°åœ°å€çš„sockaddrç»“æ„çš„æŒ‡é’ˆ\n3. å‚æ•°3ï¼šnameå‚æ•°æ‰€æŒ‡å‘çš„å€¼çš„é•¿åº¦ (ä»¥å­—èŠ‚ä¸ºå•ä½)ã€‚\n4. è¿”å›ï¼šå¦‚æœæ²¡æœ‰å‘ç”Ÿé”™è¯¯ï¼Œè¿”å›é›¶ã€‚å¦åˆ™ï¼Œå®ƒè¿”å›`SOCKET_ERROR`ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è°ƒç”¨`WSAGetLastError`æ¥æ£€ç´¢ç‰¹å®šçš„é”™è¯¯ä»£ç ã€‚\n\nå…³äºsockaddrç»“æ„ï¼š[sockaddrç»“æ„](#sockaddrç»“æ„)\n\nç¼–å†™æ—¶ï¼Œå‘ç°ç¬¬äºŒä¸ªå‚æ•°`name`ä¸èƒ½ç›´æ¥å¡«å…¥`&server_addr`ï¼Œè€Œæ˜¯è¦æ˜¾å¼è½¬æ¢ä¸º`const sockaddr*`\n```cpp\nint main()\n{\n    // ...\n\n    sockaddr_in server_addr;\n    server_addr.sin_family = AF_INET;\n    server_addr.sin_addr.S_un.S_addr = inet_addr(\"127.0.0.1\");\n    server_addr.sin_port = htons(9008);\n    \n    if (SOCKET_ERROR == ::bind(listen_sock,\n            reinterpret_cast<const sockaddr*>(&server_addr),\n            sizeof(server_addr)))\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n\n    // ...\n}\n```\n### é—®é¢˜\næŠ¥é”™ï¼š\n```\nerror C4996: 'inet_addr': Use inet_pton() or InetPton() instead or define _WINSOCK_DEPRECATED_NO_WARNINGS to disable deprecated API warnings\n```\nVSç¼–è¯‘å™¨ä¸å»ºè®®ä½¿ç”¨`inet_addr`æ¥è½¬æ¢`ç‚¹åˆ†åè¿›åˆ¶IPåœ°å€å­—ç¬¦ä¸²`ä¸º`ç½‘ç»œå­—èŠ‚åº`ã€‚è€Œæ˜¯ä½¿ç”¨`<ws2tcpip.h>`åº“ä¸­çš„`inet_pton`ï¼Œå³å­—ç¬¦ä¸²è½¬ä¸ºæ•´æ•°ï¼ˆpä»£è¡¨å­—ç¬¦æŒ‡é’ˆï¼Œnä»£è¡¨æ•´æ•°ï¼‰ã€‚\n![](../../images/ç½‘ç»œ_TCPç¼–ç¨‹æµç¨‹è¯¦è§£/image-20240828064535457.png)\n1. å‚æ•°1ï¼Œåœ°å€æ—åè®®\n2. å‚æ•°2ï¼Œè¦è½¬åŒ–çš„å­—ç¬¦ä¸²\n3. å‚æ•°3ï¼Œè¦å†™å…¥åˆ°å“ªé‡Œçš„åœ°å€\n4. è¿”å›å€¼\n    1. å¦‚æœæ²¡æœ‰å‘ç”Ÿé”™è¯¯ï¼Œ`InetPton`å‡½æ•°å°†è¿”å›å€¼1ï¼Œå¹¶ä¸”`pAddrBuf`å‚æ•°æŒ‡å‘çš„ç¼“å†²åŒºåŒ…å«æŒ‰ç½‘ç»œå­—èŠ‚é¡ºåºæ’åˆ—çš„äºŒè¿›åˆ¶æ•°å­—IPåœ°å€ã€‚\n    2. å¦‚æœå‚æ•°æŒ‡å‘çš„å­—ç¬¦ä¸²ä¸æ˜¯æœ‰æ•ˆçš„IPv4ç‚¹åˆ†åè¿›åˆ¶å­—ç¬¦ä¸²æˆ–æœ‰æ•ˆçš„IPv6åœ°å€å­—ç¬¦ä¸²ï¼Œåˆ™InetPtonå‡½æ•°å°†è¿”å›å€¼0ã€‚\n    3. å¦‚æœæŒ‡å‘çš„å­—ç¬¦ä¸²æ²¡é—®é¢˜ï¼Œæœ‰å…¶ä»–é”™è¯¯ï¼šè¿”å›å€¼ä¸º-1ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨`WSAGetLastError`è·å–æ‰©å±•é”™è¯¯ä¿¡æ¯ã€‚\n\n```cpp\n// ...\n#include <ws2tcpip.h>\nint main()\n{\n    // ...\n    \n    sockaddr_in server_addr;\n    server_addr.sin_family = AF_INET;\n    //server_addr.sin_addr.S_un.S_addr = inet_addr(\"127.0.0.1\");\n    if (1 != ::inet_pton(AF_INET, \"127.0.0.1\", &server_addr.sin_addr))\n    {\n        return 1;\n    }\n    server_addr.sin_port = htons(9008);\n    \n    if (SOCKET_ERROR == ::bind(listen_sock,\n            reinterpret_cast<const sockaddr*>(&server_addr),\n            sizeof(server_addr)))\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n\n    // ...\n}\n```\n## listen\nå°†å¥—æ¥å­—ç½®äºä¾¦å¬ä¼ å…¥è¿æ¥çš„çŠ¶æ€ï¼Œæœ¬è´¨ä¸Šæ˜¯è®¾ç½®äº†ä¸€ä¸ªç›‘å¬è¿æ¥å¥—æ¥å­—çš„é˜Ÿåˆ—ã€‚\n[listen function (winsock2.h)](https://learn.microsoft.com/en-us/windows/win32/api/winsock2/nf-winsock2-listen)\n![](../../images/ç½‘ç»œ_TCPç¼–ç¨‹æµç¨‹è¯¦è§£/image-20240828023630523.png)\n1. å‚æ•°1ï¼Œå·²ç»ç»‘å®šäº†çš„ï¼Œä½†æœªè¿æ¥çš„socketæè¿°ç¬¦ã€‚\n2. å‚æ•°2ï¼Œç­‰å¾…è¿æ¥é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ã€‚ä¸€èˆ¬è®¾ç½®ä¸º`SOMAXCONN`ã€‚\n3. è¿”å›å€¼ï¼Œå¦‚æœæ²¡æœ‰é”™è¯¯å‘ç”Ÿï¼Œè¿”å›0ã€‚å¦åˆ™ï¼Œå°†è¿”å›`SOCKET_ERROR`ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è°ƒç”¨`WSAGetLastError`æ¥æ£€ç´¢ç‰¹å®šçš„é”™è¯¯ä»£ç ã€‚\n\n```cpp\nint main()\n{\n    // ...\n    if (SOCKET_ERROR == ::listen(listen_sock, SOMAXCONN))\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n    // ...\n}\n```\n## accept\nä»listençš„ç›‘å¬é˜Ÿåˆ—ä¸­é€‰å‡ºä¸€ä¸ªæœªè¢«è¿æ¥çš„ï¼Œæ‹¿å‡ºæ¥ï¼Œäº§ç”Ÿä¸€ä¸ªworker socketï¼ˆè¿æ¥å¥—æ¥å­—ï¼‰ã€‚å¦‚æœç›‘å¬é˜Ÿåˆ—ä¸­æ²¡æœ‰å®¢æˆ·ç«¯è¿æ¥ï¼Œåˆ™é˜»å¡ï¼Œç›´åˆ°æœ‰äººè¿æ¥åè¿”å›ã€‚\nåœ¨è¿™ä¸ªé˜¶æ®µï¼Œacceptå‡½æ•°ä¼šæŠŠè¿æ¥åˆ°æœåŠ¡ç«¯`listen_sock`ä¸Šçš„clientçš„ä¿¡æ¯å¡«å…¥åˆ°å‚æ•°`sockaddr* client_addr`ä¸­ã€‚\n\n[accept function (winsock2.h)](https://learn.microsoft.com/en-us/windows/win32/api/winsock2/nf-winsock2-accept)\n\n![](../../images/ç½‘ç»œ_TCPç¼–ç¨‹æµç¨‹è¯¦è§£/image-20240828072239856.png)\n1. å‚æ•°1ï¼Œå·²listençš„å¥—æ¥å­—ã€‚ä½†æœ€ç»ˆè¿æ¥å®é™…ä¸Šæ˜¯ä¸acceptè¿”å›çš„å¥—æ¥å­—è¿›è¡Œçš„ã€‚\n2. å‚æ•°2ï¼Œè¯¥ç¼“å†²åŒºè¦å¡«å…¥å®¢æˆ·ç«¯çš„åœ°å€ã€‚addrå‚æ•°çš„ç¡®åˆ‡æ ¼å¼ç”±ä»sockaddrç»“æ„åˆ›å»ºå¥—æ¥å­—æ—¶å»ºç«‹çš„åœ°å€æ—ç¡®å®šã€‚\n3. å‚æ•°3ï¼ŒæŒ‡å‘æ•´æ•°çš„æŒ‡é’ˆï¼Œè¯¥æ•´æ•°åŒ…å«addrå‚æ•°æ‰€æŒ‡å‘çš„ç»“æ„çš„é•¿åº¦ã€‚æœ€å¥½è®©ä»–æŒ‡å‘ä¸€ä¸ªåˆå§‹åŒ–å€¼ä¸º`sizeof(sockaddr_in)`çš„intå€¼ã€‚\n    1. æ ‡å¿—ä¸º`[in, out]`ï¼Œæ„ä¸ºæ˜¯ä¸€ä¸ªéœ€è¦æ­£ç¡®è¾“å…¥ã€å¯èƒ½ä¼šè¾“å‡ºçš„é¡¹ï¼šè§è¿”å›å€¼ä¸­å¯¹addrlençš„æè¿°ã€‚\n    2. addrlenå¼•ç”¨çš„æ•´æ•°æœ€åˆéœ€è¦åŒ…å«addræŒ‡å‘çš„ç©ºé—´é‡ï¼ˆå³`int addrlen{ sizeof(client_addr) }`ï¼‰ã€‚å‡½æ•°è¿”å›æ—¶ï¼Œå®ƒå°†å¡«å…¥è¿”å›çš„åœ°å€çš„å®é™…é•¿åº¦ (ä»¥å­—èŠ‚ä¸ºå•ä½)ã€‚\n4. è¿”å›å€¼ï¼Œå¦‚æœæ²¡æœ‰å‘ç”Ÿé”™è¯¯ï¼Œacceptå°†è¿”å›ä¸€ä¸ªSOCKETç±»å‹çš„å€¼ï¼Œè¯¥å€¼æ˜¯è¿æ¥å¥—æ¥å­—çš„æè¿°ç¬¦ã€‚è¿™ä¸ªè¿”å›å€¼æ˜¯å®é™…è¿æ¥çš„å¥—æ¥å­—çš„å¥æŸ„ã€‚\n    1. å¦åˆ™ï¼Œå°†è¿”å›`INVALID_SOCKET`çš„å€¼ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è°ƒç”¨`WSAGetLastError`æ¥æ£€ç´¢ç‰¹å®šçš„é”™è¯¯ä»£ç ã€‚\n\n```cpp\n// server\nint main()\n{\n    // ...\n    sockaddr_in client_addr;\n    int addrlen{ sizeof(client_addr) };\n    SOCKET work_sock = ::accept(\n        listen_sock,\n        reinterpret_cast<sockaddr*>(&client_addr),\n        &addrlen);\n    if (work_sock == INVALID_SOCKET)\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n    // ...\n}\n```\n## è°ƒè¯• accept - é€šè¿‡ Error Lookup æŸ¥è¯¢åŸå› \nç¨‹åºå·²ç»é€šè¿‡`WSAGetLastError`æŠŠé”™è¯¯ç å¡«å…¥åˆ°äº†errä¸­ã€‚å¦‚æœæŸä¸ªæ­¥éª¤å‡ºç°äº†é—®é¢˜ï¼Œå¯ä»¥çœ‹åˆ°errä¸­çš„å…·ä½“å€¼ã€‚\nè¿™ä¸ªå€¼æ˜¯ä¸ªæ•´æ•°ï¼Œå¯ä»¥åœ¨VSèœå•æ -Tools-External Toolsä¸­æ·»åŠ `errorlook.exe`ç¨‹åºçš„å¿«æ·æ–¹å¼ï¼š\nTitleæ˜¯è‡ªå®šä¹‰çš„ï¼Œæˆ‘ä»¬å¡«å…¥Error LookUpã€‚\nCommandå¡«å…¥`C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\Common7\\Tools\\errlook.exe`\nInitial directoryå¡«å…¥`C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\Common7\\Tools`\n![](../../images/ç½‘ç»œ_TCPç¼–ç¨‹æµç¨‹è¯¦è§£/image-20240829061511915.png)\næ·»åŠ å®Œæ¯•åï¼ŒToolså‡ºæ¥çš„èœå•ä¸­å°±ä¼šæ˜¾ç¤ºäº†ï¼š\n![](../../images/ç½‘ç»œ_TCPç¼–ç¨‹æµç¨‹è¯¦è§£/image-20240829061633740.png)\n\nå¦‚ä¸Šé¢çš„ç¨‹åºï¼Œ`addrlen`å¦‚æœåˆå§‹åŒ–ä¸º0æ—¶ï¼Œä¼ ç»™acceptå‡½æ•°åï¼Œå°±ä¼šå¯¼è‡´accepté”™è¯¯ã€‚ï¼ˆå› ä¸ºacceptæ–‡æ¡£ä¸­ç»™å‡ºå‚æ•°è¯´æ˜ï¼šaddrlenå¼•ç”¨çš„æ•´æ•°æœ€åˆéœ€è¦åŒ…å«addræŒ‡å‘çš„ç©ºé—´é‡ã€‚æ­¤æ—¶æˆ‘ä»¬ä¼ å…¥0æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œacceptä¸­çš„æ“ä½œå¯èƒ½ä¼šè¯»å–addrlençš„å†…å®¹ï¼Œå¯¼è‡´é”™è¯¯ï¼‰\n```cpp\n// server\nint main()\n{\n    // ...\n    sockaddr_in client_addr;\n    int addrlen{ 0 };\n    SOCKET work_sock = ::accept(\n        listen_sock,\n        reinterpret_cast<sockaddr*>(&client_addr),\n        &addrlen);\n    if (work_sock == INVALID_SOCKET)\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n    // ...\n}\n```\næœ€ç»ˆerrç æ˜¯10014ï¼Œé‚£ä¹ˆåœ¨ErrorLookä¸­æŸ¥è¯¢ï¼š\n![](../../images/ç½‘ç»œ_TCPç¼–ç¨‹æµç¨‹è¯¦è§£/image-20240829061728388.png)\n## å®¢æˆ·ç«¯\næ–°å»ºä¸€ä¸ªç©ºé¡¹ç›®ï¼ŒSocketClientStudyï¼Œæ–°å»ºæ–‡ä»¶`basic_stream_client.cpp`ã€‚ä¸ç”¨è®¾ç½®ä¸ºå¯åŠ¨é¡¹ç›®ã€‚\n\nå®¢æˆ·ç«¯ç¨‹åºéœ€è¦WSAåˆå§‹åŒ–ã€åˆ›å»ºå¥—æ¥å­—ã€‚\nåé¢ç›´æ¥è¿æ¥connectï¼Œconnectçš„å‚æ•°å’ŒæœåŠ¡å™¨ç«¯bindçš„å‚æ•°ä¸€æ ·ï¼šåˆ›å»º`sockaddr_in`å¹¶ä¸”å¡«å…¥ç›¸å…³ä¿¡æ¯ï¼ˆåè®®ã€IPåœ°å€ã€ç«¯å£å·ï¼‰ã€‚\n[connect function (winsock2.h)](https://learn.microsoft.com/en-us/windows/win32/api/winsock2/nf-winsock2-connect)\n![](../../images/ç½‘ç»œ_TCPç¼–ç¨‹æµç¨‹è¯¦è§£/image-20240829063508988.png)\nè¿”å›å€¼ï¼šå¦‚æœæ²¡æœ‰å‘ç”Ÿé”™è¯¯ï¼Œè¿”å›0ã€‚å¦åˆ™è¿”å›`SOCKET_ERROR`ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è°ƒç”¨`WSAGetLastError`æ¥æ£€ç´¢ç‰¹å®šçš„é”™è¯¯ä»£ç ã€‚\n1. é˜»å¡å¥—æ¥å­—ï¼Œè¿”å›å€¼æŒ‡ç¤ºè¿æ¥å°è¯•çš„æˆåŠŸæˆ–å¤±è´¥ã€‚\n2. éé˜»å¡å¥—æ¥å­—ï¼Œè¿æ¥å°è¯•æ— æ³•ç«‹å³å®Œæˆã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œconnectå°†è¿”å›`SOCKET_ERROR`ï¼Œ`WSAGetLastError`å°†è¿”å›`WSAEWOULDBLOCK`ã€‚\n\n```cpp\n#include <WinSock2.h>\n#include <iostream>\n#include <format>\n#include <ws2tcpip.h>\n#pragma comment (lib, \"Ws2_32\")\nint main()\n{\n    WORD wVersionRequested;\n    WSADATA wsaData;\n    int err;\n\n    /* Use the MAKEWORD(lowbyte, highbyte) macro declared in Windef.h */\n    wVersionRequested = MAKEWORD(2, 2);\n\n    err = ::WSAStartup(wVersionRequested, &wsaData);\n    if (err != 0) {\n        /* Tell the user that we could not find a usable */\n        /* Winsock DLL.                                  */\n        std::wcout << std::format(L\"WSAStartup failed with error : {}\\n\", err);\n        return 1;\n    }\n\n    SOCKET sock = ::socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);\n    if (sock == INVALID_SOCKET)\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n\n    sockaddr_in server_addr;\n    server_addr.sin_family = AF_INET;\n    //service.sin_addr.S_un.S_addr = inet_addr(\"127.0.0.1\");\n    if (1 != ::inet_pton(AF_INET, \"127.0.0.1\", &server_addr.sin_addr))\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n    server_addr.sin_port = htons(9008);\n    \n    if (SOCKET_ERROR == ::connect(sock, reinterpret_cast<const sockaddr*>(&server_addr), sizeof(server_addr)))\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n\n    ::WSACleanup();\n    return 0;\n}\n```\n## è”è°ƒ1\nå•ç‹¬Buildå®¢æˆ·ç«¯é¡¹ç›®ï¼šå³å‡»å®¢æˆ·ç«¯é¡¹ç›®å-Project Only-Build Only ...\n![](../../images/ç½‘ç»œ_TCPç¼–ç¨‹æµç¨‹è¯¦è§£/image-20240829070708525.png)\nè‹¥BuildæˆåŠŸï¼Œåˆ™å¯ä»¥å¯åŠ¨Serveré¡¹ç›®äº†ã€‚Serveré¡¹ç›®ç›´æ¥ç‚¹å‡»VSå…¨å±€ä¸‹çš„è°ƒè¯•å³å¯ï¼ˆå¿«æ·é”®F5ï¼‰ã€‚\nå¯åŠ¨Serverä¹‹åï¼Œè‹¥æˆåŠŸåœ°é˜»å¡åœ¨acceptï¼Œåˆ™å¯ä»¥å•ç‹¬å¯åŠ¨å®¢æˆ·ç«¯é¡¹ç›®äº†ï¼šå³å‡»å®¢æˆ·ç«¯é¡¹ç›®-Debug-Start New Instance\n![](../../images/ç½‘ç»œ_TCPç¼–ç¨‹æµç¨‹è¯¦è§£/image-20240829070915611.png)\nä¹‹åï¼Œå¯ä»¥å¾ˆè½»æ¾åœ°åœ¨æ­¤ä¸¤ä¸ªé¡¹ç›®ä¸­æµè½¬ã€å•æ­¥è°ƒè¯•ã€‚\n## æœåŠ¡ç«¯-æ˜¾ç¤ºè¿æ¥çš„å®¢æˆ·ç«¯ä¿¡æ¯\næƒ³è¦æ˜¾ç¤ºè¿æ¥çš„å®¢æˆ·ç«¯çš„IPåœ°å€å’Œç«¯å£å·ã€‚\n[InetNtopW function (ws2tcpip.h)](https://learn.microsoft.com/en-us/windows/win32/api/ws2tcpip/nf-ws2tcpip-inetntopw)\n\nå¯¹äºIPåœ°å€ï¼Œåœ¨ç¼–å†™æœåŠ¡ç«¯çš„bindã€å®¢æˆ·ç«¯çš„connectæ—¶ï¼Œå£°æ˜`sockaddr_in`æ—¶ï¼Œéƒ½éœ€è¦ä½¿ç”¨`inet_pton`æ¥å¡«å…¥`sin_addr`ã€‚è¿™æ˜¯è®©IPåœ°å€å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°å€¼å¡«å…¥è”åˆä½“ã€‚\nè€Œæˆ‘ä»¬æƒ³è¦ä»`sockaddr_in`è·å¾—å­—ç¬¦ä¸²å½¢å¼çš„IPåœ°å€æ—¶ï¼Œéœ€è¦ç”¨`inet_ntop`ï¼Œæ³¨æ„ï¼Œä¸èƒ½ç›´æ¥è¯»å–`sockaddr_in`ï¼Œè€Œæ˜¯`sockaddr_in.sin_addr`ã€‚è¯¦è§[sockaddrç»“æ„](#sockaddrç»“æ„)\nå¯¹äºç«¯å£å·ï¼Œå¯¹äºç½‘ç»œç¨‹åºæ¥è¯´ï¼Œéœ€è¦ä½¿ç”¨`htons`ä½¿ä¸»æœºå­—èŠ‚åºè½¬ä¸ºç½‘ç»œå­—èŠ‚åºï¼ˆç±»ä¼¼äºIPåœ°å€ä»å­—ç¬¦ä¸²è½¬æ¢ä¸ºè®¡ç®—æœºç¨‹åºå¯ç†è§£çš„æ•´å‹å€¼ï¼‰ï¼Œå¡«å…¥`sin_port`ã€‚è€Œå¯¹äºäººç±»çš„å¯è¯»æ€§æ¥è®²ï¼Œéœ€è¦ä»ç½‘ç»œå­—èŠ‚åºè½¬ä¸ºä¸»æœºå­—èŠ‚åºï¼ˆç±»ä¼¼äºIPåœ°å€ä»æ•´æ•°å€¼è½¬æ¢ä¸ºäººç±»å¯ç†è§£çš„å­—ç¬¦ä¸²ï¼‰ï¼Œéœ€è¦ï¼š`ntohs`ã€‚\n>`inet_pton`å’Œ`inet_ntop`éƒ½æ˜¯ANSIç‰ˆæœ¬çš„ã€‚\n>`InetNtopW`æ˜¯Unicodeç‰ˆæœ¬çš„ã€‚å‚æ•°é™¤äº†`pStringBuf`çš„ç±»å‹ä¸ºPWSTRä¸ä¸€æ ·ï¼Œå…¶ä»–ä¸€æ ·ã€‚è§[InetNtopW function (ws2tcpip.h)](https://learn.microsoft.com/en-us/windows/win32/api/ws2tcpip/nf-ws2tcpip-inetntopw)\n>\n>`htons`ï¼šhä»£è¡¨hostï¼Œtoæ„ä¸ºè½¬æ¢ï¼Œnä¸ºnetï¼Œsä¸ºshortï¼ˆ2å­—èŠ‚ï¼‰ã€‚è¿˜æœ‰`htonl`ï¼Œä¸ºlong intï¼ˆ4å­—èŠ‚ï¼‰ã€‚\n\n![](../../images/ç½‘ç»œ_TCPç¼–ç¨‹æµç¨‹è¯¦è§£/image-20240829221004234.png)\n\n```cpp\nint main()\n{\n    // ...\n    wchar_t addr_str[46] = L\"\";\n    InetNtopW(AF_INET, reinterpret_cast<void*>(&client_addr.sin_addr), addr_str, 46);\n    std::wcout << std::format(L\"client address: {}, port: {}\\n\", addr_str, ntohs(client_addr.sin_port));\n    // ...\n}\n```\n## æœåŠ¡ç«¯-å‘é€æ¶ˆæ¯\n[send function (winsock2.h)](https://learn.microsoft.com/en-us/windows/win32/api/winsock2/nf-winsock2-send)\n\nå»ºç«‹å¥½socketé€šé“åï¼Œå¯ä»¥ç›´æ¥åœ¨æ­¤socketä¸Šsendï¼Œrecvã€‚\n![](../../images/ç½‘ç»œ_TCPç¼–ç¨‹æµç¨‹è¯¦è§£/image-20240830004003760.png)\n1. å‚æ•°1ï¼Œå·²è¿æ¥çš„socket\n2. å‚æ•°2ï¼Œè¦å‘é€çš„æ•°æ®çš„æŒ‡é’ˆ\n3. å‚æ•°3ï¼Œè¦å‘é€çš„æ•°æ®çš„å¤§å°ï¼ˆå­—èŠ‚æ•°ï¼‰\n4. å‚æ•°4ï¼ŒæŒ‡å®šè°ƒç”¨æ–¹å¼çš„æ ‡å¿—ï¼Œå¯ä»¥æŒ‰ä½ORã€‚å¦‚æ— ç‰¹æ®Šéœ€è¦ï¼Œå¡«0å³å¯ã€‚\n5. è¿”å›å€¼ï¼Œå¦‚æœæ²¡æœ‰å‘ç”Ÿé”™è¯¯ï¼Œå°†è¿”å›å·²å‘é€çš„æ€»å­—èŠ‚æ•°ï¼Œè¯¥å­—èŠ‚æ•°å¯ä»¥å°äºlenå‚æ•°ä¸­è¯·æ±‚å‘é€çš„å­—èŠ‚æ•°ã€‚è‹¥é”™è¯¯ï¼Œå°†è¿”å›`SOCKET_ERROR`ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è°ƒç”¨`WSAGetLastError`æ¥æ£€ç´¢ç‰¹å®šçš„é”™è¯¯ä»£ç ã€‚\n\n| Value         | Meaning                                                                                                                                                               |\n| ------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| MSG_DONTROUTE | Specifies that the data should not be subject to routing. A Windows Sockets service provider can choose to ignore this flag.<br>æŒ‡å®šæ•°æ®ä¸åº”è¿›è¡Œè·¯ç”±ã€‚Windowså¥—æ¥å­—æœåŠ¡æä¾›ç¨‹åºå¯ä»¥é€‰æ‹©å¿½ç•¥æ­¤æ ‡å¿—ã€‚ |\n| MSG_OOB       | Sends OOB data (stream-style socket such as SOCK_STREAM only).<br>å‘é€OOBæ•°æ® (ä»…æµå¼å¥—æ¥å­—ï¼Œå¦‚SOCK_STREAM)                                                                       |\nè¦æ³¨æ„ï¼Œç”±äºæˆ‘ä»¬æƒ³è¦å‘é€çš„æ˜¯ä¸€ä¸ªUnicodeå­—ç¬¦ä¸²ï¼Œè€Œå‚æ•°`buf`çš„ç±»å‹æ˜¯`const char *`ã€‚\né¦–å…ˆï¼Œä¸èƒ½ä»¥wstringå¯¹è±¡çš„å•ä½å‘é€ï¼Œåº”å½“å‘é€å…¶ä¸­çš„å†…å®¹`message.c_str()`ã€‚\nå…¶æ¬¡ï¼Œ`message.c_str()`è¿”å›ç±»å‹ä¸º`const wchar_t *`ï¼Œè€ŒTCPçš„sendæ˜¯è¦æŒ‰å­—èŠ‚æµè¿›è¡Œå‘é€çš„ï¼Œæ‰€ä»¥è¦æ˜¾å¼è½¬æ¢æŒ‡é’ˆä¸º`const char*`ï¼Œè¿™é‡Œçš„`char*`å’Œå­—ç¬¦æ²¡æœ‰å…³ç³»ï¼Œè€Œæ˜¯è¡¨ç¤ºæŒ‰å­—èŠ‚ã€‚\n```cpp\nint main()\n{\n    // ...\n    std::wstring message{ L\"Welcome to server!\" };\n    ::send(\n        work_sock,\n        reinterpret_cast<const char*>(message.c_str()),\n        sizeof(wchar_t) * message.size(),\n        0);\n    // ...\n}\n```\n### sendçš„é˜»å¡é—®é¢˜\nå¦‚æœä¼ è¾“ç³»ç»Ÿå†…æ²¡æœ‰å¯ç”¨çš„ç¼“å†²åŒºç©ºé—´æ¥ä¿å­˜è¦ä¼ è¾“çš„æ•°æ®ï¼Œå¦‚æœå¥—æ¥å­—ä¸æ˜¯éé˜»å¡æ¨¡å¼ï¼Œsendå°†é˜»å¡ã€‚\nåœ¨é¢å‘æµçš„éé˜»å¡å¥—æ¥å­—ä¸Šï¼Œå†™å…¥çš„å­—èŠ‚æ•°å¯ä»¥ä»‹äº1å’Œè¯·æ±‚é•¿åº¦ä¹‹é—´ï¼Œå…·ä½“å–å†³äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è®¡ç®—æœºä¸Šçš„ç¼“å†²åŒºå¯ç”¨æ€§ã€‚\n## æœåŠ¡ç«¯-æ¥æ”¶æ¶ˆæ¯\n[recv function (winsock2.h)](https://learn.microsoft.com/en-us/windows/win32/api/winsock2/nf-winsock2-recv)\n\n![](../../images/ç½‘ç»œ_TCPç¼–ç¨‹æµç¨‹è¯¦è§£/image-20240830044512192.png)\n1. å‚æ•°1ï¼Œå·²è¿æ¥çš„socket\n2. å‚æ•°2ï¼Œè¦æ¥æ”¶æ•°æ®çš„bufæŒ‡é’ˆ\n3. å‚æ•°3ï¼Œbufçš„å­—èŠ‚å¤§å°\n4. å‚æ•°4ï¼Œå½±å“æ­¤å‡½æ•°è¡Œä¸ºçš„æ ‡å¿—\n5. è¿”å›å€¼ï¼Œå¦‚æœæ²¡æœ‰å‘ç”Ÿé”™è¯¯ï¼Œrecvè¿”å›æ¥æ”¶åˆ°çš„å­—èŠ‚æ•°ï¼Œbufå‚æ•°æŒ‡å‘çš„ç¼“å†²åŒºå°†å¡«å…¥æ¥æ”¶åˆ°çš„æ•°æ®ã€‚\n    1. å¦‚æœå¥—æ¥å­—æ˜¯é¢å‘è¿æ¥çš„ï¼Œå¹¶ä¸”è¿œç¨‹ç«¯å·²æ­£å¸¸å…³é—­è¿æ¥ï¼Œåˆ™recvå°†ç«‹å³è¿”å›0ï¼Œæ¥æ”¶åˆ°0å­—èŠ‚ã€‚\n    2. å¦‚æœæ˜¯å¼‚å¸¸æ–­å¼€ï¼Œå°†è¿”å›`SOCKET_ERROR`çš„å€¼ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è°ƒç”¨`WSAGetLastError`æ¥æ£€ç´¢ç‰¹å®šçš„é”™è¯¯ä»£ç ã€‚\n        1. å¦‚æœè¿æ¥å·²é‡ç½®ï¼Œé”™è¯¯ä¸º`WSAECONNRESET`ã€‚\n\n```cpp\nint main()\n{\n    // ...\n    wchar_t buf[100] = { 0 };\n    int bytes_received = ::recv(work_sock, reinterpret_cast<char*>(buf), sizeof(wchar_t) * sizeof(buf), 0);\n    if (bytes_received > 0)\n    {\n        std::wcout << buf << std::endl;\n    }\n    // ...\n}\n```\n### recvçš„é˜»å¡é—®é¢˜\nå¦‚æœå¥—æ¥å­—ä¸Šæ²¡æœ‰å¯ç”¨çš„ä¼ å…¥æ•°æ®ï¼Œåˆ™recvè°ƒç”¨å°†æ ¹æ®ä¸ºé˜»å¡å¹¶ç­‰å¾…æ•°æ®åˆ°è¾¾ã€‚\nå¦‚æœå¥—æ¥å­—æ˜¯éé˜»å¡çš„ã€‚å°†è¿”å›`SOCKET_ERROR`ï¼Œå¹¶å°†é”™è¯¯ä»£ç è®¾ç½®ä¸º`WSAEWOULDBLOCK`ã€‚\n## å®¢æˆ·ç«¯-æ¥æ”¶æ¶ˆæ¯\n\n```cpp\nint main()\n{\n    // ...\n    wchar_t buf[100] = { 0 };\n    int bytes_received = ::recv(\n        sock,\n        reinterpret_cast<char*>(buf),\n        sizeof(wchar_t) * sizeof(buf),\n        0);\n    if (bytes_received > 0)\n    {\n        std::wcout << buf << std::endl;\n    }\n    // ...\n}\n```\n\n## å®¢æˆ·ç«¯-å‘é€æ¶ˆæ¯\nå¯ä»¥ä½¿ç”¨`std::wcin`ä½œä¸ºUnicodeæ ‡å‡†è¾“å…¥åˆ°bufã€‚\nbufä¸­çš„å†…å®¹ä¼šè¢«è¦†ç›–ã€‚ï¼ˆä½†æ˜¯ç”¨wcinä½œä¸ºè¾“å…¥æœ‰ä¸ªç¼ºé™·ï¼Œå°±æ˜¯å¦‚æœå¥å­ä¸­é—´è¢«ç©ºæ ¼æ–­å¼€äº†çš„è¯ï¼Œåªèƒ½å¡«å…¥bufç©ºæ ¼ä¹‹å‰çš„å­—ç¬¦ï¼‰\næ³¨æ„ï¼Œbufçš„ç±»å‹æ˜¯`wchar_t buf[100]`ï¼Œæ˜¯Cé£æ ¼çš„wcharæ•°ç»„ï¼Œå› æ­¤åœ¨è®¡ç®—æœ‰æ•ˆé•¿åº¦lenæ—¶ï¼ˆå³ä¸åŒ…å«ç¬¬ä¸€ä¸ª`\\0`ï¼‰ï¼Œéœ€è¦ä½¿ç”¨`wcslen(buf)`ã€‚å¦‚æœè¦è®¡ç®—æœ‰æ•ˆé•¿åº¦çš„å­—èŠ‚å¤§å°ï¼Œè¿˜éœ€è¦ä¹˜ä»¥`sizeof(wchar_t)`ã€‚\n```cpp\nint main()\n{\n    // ...\n    std::wcout << L\"Please input what you want to send to server: \";\n    std::wcin >> buf;\n    int bytes_sent = ::send(\n        sock,\n        reinterpret_cast<const char*>(buf),\n        sizeof(wchar_t) * wcslen(buf),\n        0);\n    // ...\n}\n```\n## å®¢æˆ·ç«¯-æ”¶å°¾å·¥ä½œ\nç±»ä¼¼äºæŒ‡é’ˆç®¡ç†ï¼Œå…ˆé‡Šæ”¾èµ„æºï¼Œå†æŠŠæè¿°ç¬¦ç½®ä¸ºæ— æ•ˆã€‚\n```cpp\nint main()\n{\n    // ...\n    ::closesocket(sock);\n    sock = INVALID_SOCKET;\n\n    ::WSACleanup();\n    return 0;\n}\n```\n## æœåŠ¡ç«¯-æ”¶å°¾å·¥ä½œ\nç±»ä¼¼äºæŒ‡é’ˆç®¡ç†ï¼Œå…ˆé‡Šæ”¾èµ„æºï¼Œå†æŠŠæè¿°ç¬¦ç½®ä¸ºæ— æ•ˆã€‚\n```cpp\nint main()\n{\n    // ...\n    ::closesocket(work_sock);\n    work_sock = INVALID_SOCKET;\n\n    ::closesocket(listen_sock);\n    listen_sock = INVALID_SOCKET;\n\n    ::WSACleanup();\n}\n```\n## è”è°ƒ2\nåˆ†åˆ«è¿è¡Œã€è°ƒè¯•ä¸¤ç«¯ç¨‹åºçš„æ–¹æ³•åŒ[è”è°ƒ1](#è”è°ƒ1)ã€‚\næµ‹è¯•ç»“æœï¼š\n![](../../images/ç½‘ç»œ_TCPç¼–ç¨‹æµç¨‹è¯¦è§£/image-20240830061031808.png)\n\n![](../../images/ç½‘ç»œ_TCPç¼–ç¨‹æµç¨‹è¯¦è§£/image-20240830061150520.png)\n## ã€å¯é€‰ã€‘å®¢æˆ·ç«¯-bind\nè§[å®¢æˆ·ç«¯çš„bind](#å®¢æˆ·ç«¯çš„bind)ã€‚\néœ€è¦åœ¨connectåˆ°serverä¹‹å‰è¿›è¡Œå®¢æˆ·ç«¯çš„bindã€‚éœ€è¦å£°æ˜ä¸€ä¸ªæœ¬åœ°çš„`sockaddr_in`ï¼Œå¡«å…¥è‡ªå·±çš„åè®®ã€åœ°å€ã€ç«¯å£å·ã€‚\n```cpp\nint main()\n{\n    // create socket...\n    sockaddr_in local;\n    local.sin_family = AF_INET;\n    if (1 != inet_pton(AF_INET, \"127.0.0.1\", &local.sin_addr))\n    {\n        return 1;\n    }\n    local.sin_port = htons(10000);\n    \n    if (SOCKET_ERROR == ::bind(sock, reinterpret_cast<const sockaddr*>(&local), sizeof(local)))\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n    \n    // connect ...\n    \n    // ...\n}\n```\næµ‹è¯•ï¼š\n![](../../images/ç½‘ç»œ_TCPç¼–ç¨‹æµç¨‹/image-20240830063739465.png)\nå‘ç°ï¼Œå®¢æˆ·ç«¯çš„ç«¯å£å·ç¡®å®æ”¹æˆäº†æˆ‘ä»¬è‡ªå®šä¹‰çš„10000ã€‚\n## æœåŠ¡ç«¯-å¾ªç¯å¤šæ¬¡accept\nåœ¨acceptåˆ°sendã€recvç›´åˆ°`closesocket(work_sock)`å¤–é¢åŒ…ä¸€ä¸ªwhileå¾ªç¯å³å¯ã€‚\n```cpp\n// server\nint main()\n{\n    // ...\n    while (true)\n    {\n        // accept ...\n        // send ...\n        // recv ...\n        ::closesocket(work_sock);\n        work_sock = INVALID_SOCKET;\n    }\n    \n    ::closesocket(listen_sock);\n    listen_sock = INVALID_SOCKET;\n\n    ::WSACleanup();\n}\n```\nä½†è¦æ³¨æ„ï¼Œå¦‚æœæƒ³è¦åœ¨ä¸€ä¸ªä¸»æœºä¸Šè¿è¡Œå¤šä¸ªå®¢æˆ·ç«¯ï¼Œåˆ™å®¢æˆ·ç«¯ä¸èƒ½è‡ªå®šä¹‰ä¸ºå›ºå®šçš„ç«¯å£å·ã€‚å³ä¸èƒ½ä¸»åŠ¨bindã€‚\nç»æµ‹è¯•ï¼Œå¯ä»¥è¿è¡Œ2ä¸ªå®¢æˆ·ç«¯ï¼Œæ’é˜Ÿè¿æ¥ï¼š\n![](../../images/ç½‘ç»œ_TCPç¼–ç¨‹æµç¨‹/image-20240830064811774.png)\n## æœåŠ¡ç«¯-ä¿®æ”¹ç›‘å¬é˜Ÿåˆ—å¤§å°\nå¦‚æœä¿®æ”¹æœåŠ¡ç«¯ç›‘å¬é˜Ÿåˆ—å¤§å°ä¸º1ï¼Œä¼šäº§ç”Ÿä»€ä¹ˆå½±å“ï¼Ÿ\n```cpp\n// server\nint main()\n{\n    // ...\n    if (SOCKET_ERROR == ::listen(listen_sock, 1))\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n    // ...\n}\n```\nç»æµ‹è¯•ï¼Œå‘ç°å¯åŠ¨å‰2ä¸ªå®¢æˆ·ç«¯çš„connectæ­£å¸¸ï¼š\n1. ç¬¬1ä¸ªå®¢æˆ·ç«¯åœ¨ç¬¬2ä¸ªå®¢æˆ·ç«¯å¯åŠ¨ä¹‹å‰ï¼Œconnectå¾ˆå¿«è¿”å›ã€‚æ­¤æ—¶ç¬¬1ä¸ªå®¢æˆ·ç«¯è¿˜æ²¡è¾“å…¥æ¶ˆæ¯ï¼Œå ç”¨äº†è¿æ¥ã€‚\n2. ç¬¬2ä¸ªå®¢æˆ·ç«¯åœ¨ç›‘å¬é˜Ÿåˆ—ä¸­ç­‰å¾…ç¬¬1ä¸ªå®¢æˆ·ç«¯ç»“æŸã€‚å› æ­¤connecté˜»å¡ã€‚\n\nä½†ç¬¬3ä¸ªå®¢æˆ·ç«¯å¯åŠ¨åï¼Œå‘ç°ç›‘å¬é˜Ÿåˆ—æ»¡äº†ï¼Œå› æ­¤ä¼šconnectå¤±è´¥ï¼Œç«‹å³è¿”å›`SOCKET_ERROR`ã€‚\n## æœåŠ¡ç«¯-å¾ªç¯+å¤šçº¿ç¨‹accept\nä½¿ç”¨`jthread`+`lambdaè¡¨è¾¾å¼`å°è£…æ¯ä¸€ä¸ªå®¢æˆ·ç«¯è¢«æœåŠ¡ç«¯acceptåï¼ŒæœåŠ¡ç«¯çš„æ“ä½œã€‚æ³¨æ„æ„é€ å®Œæ¯•jthreadåéœ€è¦detachï¼Œå¦åˆ™é»˜è®¤ä¼šjoinï¼Œå¯¼è‡´ä¸»çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹ç»“æŸä»è€Œæ— æ³•å¤„ç†å…¶ä»–ç½‘ç»œäº‹åŠ¡ã€‚\nè¿˜æœ‰ï¼Œç”±äºä½¿ç”¨åˆ°äº†`client_addr`å’Œ`work_sock`ï¼Œéœ€è¦åœ¨lambdaè¡¨è¾¾å¼çš„`[]`ä¸­è¿›è¡Œæ•è·ã€‚\nåœ¨lambdaè¡¨è¾¾å¼ä¸­ï¼Œå¦‚æœè¦ä¿®æ”¹æŸäº›å€¼ï¼ˆæ­¤ä¾‹ä¸­è¦ä¿®æ”¹`client_addr`å’Œ`addr_str`ï¼‰ï¼Œé»˜è®¤æ˜¯ä¸å…è®¸çš„ï¼Œå¦‚æœè¦ä¿®æ”¹ï¼Œéœ€è¦ä¿®é¥°å…¶ä¸º`mutable`ã€‚\n```cpp\n// server\nint main()\n{\n    // WSAStartup\n    // Create Socket\n    // bind\n    // listen\n    while (true)\n    {\n        // accept ...\n        std::jthread t([client_addr, work_sock]() mutable\n            {\n                wchar_t addr_str[46] = L\"\";\n                InetNtopW(AF_INET, reinterpret_cast<void*>(&client_addr.sin_addr), addr_str, 46);\n                std::wcout << std::format(L\"client address: {}, port: {}\\n\", addr_str, ntohs(client_addr.sin_port));\n                // send ...\n                // recv ...\n                ::closesocket(work_sock);\n                work_sock = INVALID_SOCKET;\n            });\n        t.detach();\n    }\n    \n    ::closesocket(listen_sock);\n    listen_sock = INVALID_SOCKET;\n\n    ::WSACleanup();\n    return 0;\n}\n```\n### æ›´å¤šæµ‹è¯•ï¼šå®¢æˆ·ç«¯bindå›ºå®šç«¯å£ï¼Œå¼€å¯å¤šä¸ªå®¢æˆ·ç«¯\nå®¢æˆ·ç«¯bindå›ºå®šç«¯å£10000ï¼Œå¼€å¯å¤šä¸ªå®¢æˆ·ç«¯ã€‚\nåœ¨å¼€å¯ç¬¬2ä¸ªå®¢æˆ·ç«¯æ—¶ï¼Œbindå‡½æ•°ä¼šå¤±è´¥ï¼Œç«‹å³è¿”å›`SOCKET_ERROR`ã€‚\næ­¤æ—¶å…³é—­æ‰€æœ‰å®¢æˆ·ç«¯ã€‚\nçŸ­æ—¶é—´å†…ï¼Œå†é‡æ–°å¯åŠ¨ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œç»‘å®šçš„è¿˜æ˜¯10000ã€‚è¿˜æ˜¯ä¼šå¤±è´¥ï¼Œæ­¤æ—¶bindæˆåŠŸï¼Œä½†connectæ˜¯å¤±è´¥çš„ã€‚bindæˆåŠŸæ˜¯å› ä¸ºç›®å‰10000ç«¯å£åªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯å ç”¨ã€‚connectå¤±è´¥æ˜¯å› ä¸ºè¿™ä¸ªç«¯å£ä¸ä¹…å‰åˆšè¢«ä½¿ç”¨è¿‡ï¼Œè¿˜æ²¡æœ‰å®Œå…¨å¤±æ•ˆã€‚è¿™ä¸å››æ¬¡æ¡æ‰‹é‡Šæ”¾çš„æ—¶é—´æœ‰å…³ç³»ï¼Œé»˜è®¤åœ¨2åˆ†é’Ÿå†…ç›¸åŒçš„ç«¯å£å·ä¸å¯é‡ç”¨ã€‚\næˆ‘ä»¬å¯ä»¥é€šè¿‡`WSAGetLastError()`è·å¾—é”™è¯¯ç +Error LookupæŸ¥è¯¢è¯¦ç»†çš„connectå¤±è´¥æè¿°ï¼š\nç»è°ƒè¯•ï¼Œconnectå¤±è´¥æ—¶çš„é”™è¯¯ç ä¸º10048ã€‚\n```cpp\n// client\n{\n    // ...\n    if (SOCKET_ERROR == ::connect(sock, reinterpret_cast<const sockaddr*>(&server_addr), sizeof(server_addr)))\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n    // ...\n}\n```\n![](../../images/ç½‘ç»œ_TCPç¼–ç¨‹æµç¨‹/image-20240910022156675.png)\nä¸€ä¸ªsocketäº”å…ƒç»„åœ°å€åªèƒ½ç”¨ä¸€æ¬¡ã€‚\n>äº”å…ƒç»„çš„ç»„æˆï¼šåè®®ã€ç½‘ç»œåœ°å€ã€ç«¯å£å·ã€‚\n>åè®®ï¼šå®¢æˆ·ç«¯ã€æœåŠ¡ç«¯æ˜¯ä¸€è‡´çš„ã€‚å…±1ä¸ªã€‚\n>ç½‘ç»œåœ°å€ï¼šå®¢æˆ·ç«¯ã€æœåŠ¡ç«¯å„æœ‰ä¸€ä¸ªã€‚å…±2ä¸ªã€‚\n>ç«¯å£å·ï¼šå®¢æˆ·ç«¯ã€æœåŠ¡ç«¯å„æœ‰ä¸€ä¸ªã€‚å…±2ä¸ªã€‚\n>å› æ­¤ç§°ä¸ºäº”å…ƒç»„ã€‚\n\nç”±äºå®¢æˆ·ç«¯ä¸­åˆšä½¿ç”¨è¿‡çš„10000ç«¯å£è¿˜æœªå®Œå…¨å¤±æ•ˆï¼Œå› æ­¤æ— æ³•å¾ˆå¿«åœ°é‡ç”¨ã€‚\n## ç»“åˆåç¨‹\nåœ¨VSä¸­ï¼ŒåŒä¸€è§£å†³æ–¹æ¡ˆï¼Œå¤šä¸ªé¡¹ç›®ï¼šä¸€ä¸ªæ˜¯æœåŠ¡å™¨é¡¹ç›®ï¼Œä¸€ä¸ªæ˜¯å®¢æˆ·ç«¯é¡¹ç›®ï¼Œè¿˜æœ‰ç°åœ¨è¦æåˆ°çš„åç¨‹é¡¹ç›®ã€‚ä¸ºäº†ä½¿ç”¨åç¨‹ï¼Œåœ¨è§£å†³æ–¹æ¡ˆä¸­å¼•å…¥åç¨‹é¡¹ç›®åï¼Œè¿˜éœ€è¦åœ¨ä½¿ç”¨åˆ°å®ƒçš„é¡¹ç›®ä¸­ï¼ˆå¦‚æœåŠ¡å™¨é¡¹ç›®ï¼‰æ·»åŠ ç°æœ‰é¡¹ï¼ˆAdd Existing Itemï¼‰ï¼Œåœ¨Header Filesä¸­æ·»åŠ `.hpp`ã€`.h`æ–‡ä»¶ï¼Œåœ¨Source Filesä¸­æ·»åŠ `.cpp`æ–‡ä»¶ã€‚ç„¶åï¼Œåœ¨ä»£ç æ–‡ä»¶ä¸­`#include \"../Coroutines/Agave.hpp\"`å¼•å…¥ç›¸åº”å¤´æ–‡ä»¶ä»¥ä½¿ç”¨åº“ã€‚ï¼ˆåœ¨VSä¸­ï¼Œé¡¹ç›®çš„å½“å‰ç›®å½•éƒ½æ˜¯ä»¥`.vcxproj`ä¸ºåŸºå‡†çš„ï¼‰\n\nç”¨åç¨‹å‡½æ•°å°è£…ä¸Šé¢lambdaè¡¨è¾¾å¼ä¸­åšçš„äº‹æƒ…ã€‚\n```cpp\n// server\n// ...\n#include \"../Coroutines-STD20/Agave.hpp\"\n// Fore Declaration\nagave::IAsyncAction worker_async(sockaddr_in client_addr, SOCKET work_sock);\nint main(void)\n{\n    // WSAStartup\n    // create socket\n    // bind\n    // listen\n    \n    while (true)\n    {\n        // ... accept\n        worker_async(client_addr, work_sock);\n    }\n    ::closesocket(listen_sock);\n    listen_sock = INVALID_SOCKET;\n    ::WSACleanup();\n    return 0;\n}\n\nagave::IAsyncAction worker_async(sockaddr_in client_addr, SOCKET work_sock)\n{\n    // let this function run on the child thread instead of the main thread.\n    co_await agave::resume_background();\n    \n    wchar_t addr_str[46] = L\"\";\n    InetNtopW(AF_INET, reinterpret_cast<void*>(&client_addr.sin_addr), addr_str, 46);\n    std::wcout << std::format(L\"client address: {}, port: {}\\n\", addr_str, ntohs(client_addr.sin_port));\n    // send ...\n    // recv ...\n    ::closesocket(work_sock);\n    work_sock = INVALID_SOCKET;\n}\n```\n## ç»“åˆçº¿ç¨‹æ± \nçº¿ç¨‹æ± çš„è®¾è®¡ã€ä»£ç è§[çº¿ç¨‹æ± _bubo](../é¡¹ç›®/çº¿ç¨‹æ± _bubo.md)\n\næ–°å»ºé¡¹ç›®`StreamServer`ï¼Œæ–°å»ºæºæ–‡ä»¶`stream_server_threadpool.cpp`ã€‚æ–‡ä»¶å†…å®¹å…ˆæ‹·è´`basic_stream_server.cpp`çš„ï¼Œä¹‹åå†ä½œè°ƒæ•´ã€‚\n\nè¯¥é¡¹ç›®å¼•å…¥å¤´æ–‡ä»¶ï¼ˆAdd Existing Itemï¼‰ï¼š\n1. çº¿ç¨‹æ± éƒ¨åˆ†ï¼š`ITask.h`ã€`ThreadPool.h`\n2. åç¨‹éƒ¨åˆ†ï¼š`Agave.hpp`ã€`AgaveDetails.hpp`ã€`B_Object.hpp`ã€`BJobScheduler.h`\n\nå¼•å…¥æºæ–‡ä»¶ï¼ˆAdd Existing Itemï¼‰ï¼š\n1. çº¿ç¨‹æ± éƒ¨åˆ†ï¼š`ThreadPool.cpp`\n2. åç¨‹éƒ¨åˆ†ï¼š`BJobScheduler.cpp`ã€‚\n\nè®°å¾—è°ƒæ•´é¡¹ç›®çš„`C++`æ ‡å‡†ä¸º`C++20`ã€‚\n### Task\næ–°å»º`network_task.h`ã€‚\néœ€è¦è®¾è®¡ä»€ä¹ˆï¼Ÿ\n1. å¿…é¡»å®ç°ITaskçš„æ¥å£`run_task`ã€‚\n2. æ ¹æ®`basic_stream_server.cpp`ä¸­çš„`worker_async(sockaddr_in client_addr, SOCKET work_sock)`æ¥å£ï¼ŒæœåŠ¡å™¨è¦ç”Ÿæˆä¸€ä¸ªç½‘ç»œä»»åŠ¡éœ€è¦ä¼ å…¥`client_addr`å’Œ`work_sock`ï¼ˆæœåŠ¡ç«¯`accept`åè¿”å›çš„sockï¼‰ã€‚å› æ­¤`network_task`æ„é€ å‡½æ•°éœ€è¦æœ‰è¿™ä¸¤ä¸ªä½œä¸ºå‚æ•°ï¼Œä»¥åŠéœ€è¦æœ‰æˆå‘˜å˜é‡å­˜å‚¨è¿™ä¸¤ä¸ªã€‚\n\n```cpp\n#include \"../ThreadPool/ITask.h\"\n#include <WinSock2.h>\nclass NetworkTask : public thpool::ITask\n{\npublic:\n\tNetworkTask(sockaddr_in client_addr, SOCKET work_sock);\n\t~NetworkTask();\n\tvoid run_task() override;\nprivate:\n\tsockaddr_in\t\t\t\t_client_addr;\n\tSOCKET\t\t\t\t\t_work_sock;\n};\n```\n\nå®ç°ï¼š\nä¸»è¦å®ç°`run_task`ï¼Œä»£ç å†…å®¹æ˜¯ï¼š\n1. æœåŠ¡ç«¯-æ˜¾ç¤ºè¿æ¥çš„å®¢æˆ·ç«¯ä¿¡æ¯\n2. æœåŠ¡ç«¯-å‘é€æ¶ˆæ¯ã€æ¥æ”¶æ¶ˆæ¯\n3. æœåŠ¡ç«¯-æ”¶å°¾å·¥ä½œ\n\n```cpp\n// stream_server_threadpool.cpp\n#include \"network_task.h\"\n#include <iostream>\n#include <WS2tcpip.h>\n#include <format>\n\nNetworkTask::NetworkTask(sockaddr_in client_addr, SOCKET work_sock) : _client_addr{ client_addr }, _work_sock{ work_sock }\n{\n}\n\nNetworkTask::~NetworkTask()\n{\n}\n\nvoid NetworkTask::run_task()\n{\n    wchar_t addr_str[46] = L\"\";\n    InetNtopW(AF_INET, reinterpret_cast<void*>(&_client_addr.sin_addr), addr_str, 46);\n    std::wcout << std::format(L\"client address: {}, port: {}\\n\", addr_str, ntohs(_client_addr.sin_port));\n    // send ...\n    std::wstring message{ L\"Welcome to server!\" };\n    ::send(\n        _work_sock,\n        reinterpret_cast<const char*>(message.c_str()),\n        sizeof(wchar_t) * message.size(),\n        0);\n    // recv ...\n    wchar_t buf[100] = { 0 };\n    int bytes_received = ::recv(_work_sock, reinterpret_cast<char*>(buf), sizeof(wchar_t) * sizeof(buf), 0);\n    if (bytes_received > 0)\n    {\n        std::wcout << buf << std::endl;\n    }\n    ::closesocket(_work_sock);\n    _work_sock = INVALID_SOCKET;\n}\n```\n### è°ƒç”¨çº¿ç¨‹æ± \nåŸå…ˆ`basic_stream_server.cpp`ä¸­è·å¾—`work_sock`ä¹‹åï¼Œå¯ä»¥è°ƒæ•´å…¶åçš„è¡Œä¸ºï¼Œè®©å…¶è°ƒç”¨åç¨‹ï¼ˆå®é™…æ˜¯ç”¨åç¨‹å‡½æ•°å°è£…äº†åç»­æ”¶å‘è¡Œä¸ºï¼‰ã€‚é‚£ä¹ˆæ­¤å¤„ï¼Œå¯ä»¥æ›´æ”¹ä¸ºè°ƒç”¨çº¿ç¨‹æ± ã€‚\n```cpp\n#include <WinSock2.h>\n#include <iostream>\n#include <format>\n#include <ws2tcpip.h>\n#include \"network_task.h\"                // add\n#include \"../ThreadPool/ThreadPool.h\"    // add\n#pragma comment (lib, \"Ws2_32\")\nint main()\n{\n    thpool::ThreadPool threadpool{ 10 }; // add\n    \n    WORD wVersionRequested;\n    WSADATA wsaData;\n    int err;\n\n    /* Use the MAKEWORD(lowbyte, highbyte) macro declared in Windef.h */\n    wVersionRequested = MAKEWORD(2, 2);\n\n    err = ::WSAStartup(wVersionRequested, &wsaData);\n    if (err != 0) {\n        /* Tell the user that we could not find a usable */\n        /* Winsock DLL.                                  */\n        std::wcout << std::format(L\"WSAStartup failed with error : {}\\n\", err);\n        return 1;\n    }\n\n    SOCKET listen_sock = ::socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);\n    if (listen_sock == INVALID_SOCKET)\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n    sockaddr_in server_addr;\n    server_addr.sin_family = AF_INET;\n    //service.sin_addr.S_un.S_addr = inet_addr(\"127.0.0.1\");\n    if (1 != ::inet_pton(AF_INET, \"127.0.0.1\", &server_addr.sin_addr))\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n    server_addr.sin_port = htons(9008);\n\n    if (SOCKET_ERROR == ::bind(listen_sock,\n        reinterpret_cast<const sockaddr*>(&server_addr),\n        sizeof(server_addr)))\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n\n    if (SOCKET_ERROR == ::listen(listen_sock, SOMAXCONN))\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n\n    while (true)\n    {\n        sockaddr_in client_addr;\n        int addrlen{ sizeof(client_addr) };\n        SOCKET work_sock = ::accept(\n            listen_sock,\n            reinterpret_cast<sockaddr*>(&client_addr),\n            &addrlen);\n        if (work_sock == INVALID_SOCKET)\n        {\n            err = ::WSAGetLastError();\n            return 1;\n        }\n\n        // adjust: è°ƒç”¨çº¿ç¨‹æ± \n        threadpool.add_task(std::shared_ptr<thpool::ITask>(new NetworkTask{ client_addr, work_sock }));\n    }\n\n    ::closesocket(listen_sock);\n    listen_sock = INVALID_SOCKET;\n\n    ::WSACleanup();\n    return 0;\n}\n```\n#### æµ‹è¯•\nè¿è¡Œ1ä¸ªæœåŠ¡ç«¯ã€3ä¸ªå®¢æˆ·ç«¯ã€‚\n![](../../images/ç½‘ç»œ_TCPç¼–ç¨‹æµç¨‹/image-20240927061849838.png)\n3ä¸ªå®¢æˆ·ç«¯åˆ†åˆ«è¾“å…¥`ThisIs1/2/3`\n![](../../images/ç½‘ç»œ_TCPç¼–ç¨‹æµç¨‹/image-20240927061953070.png)\n### è°ƒç”¨çº¿ç¨‹æ± åŒæ—¶ä½¿ç”¨åç¨‹\næ–°å»ºæºæ–‡ä»¶`stream_server_threadpool_coroutine.cpp`ï¼Œå†…å®¹æš‚æ—¶æ‹·è´`stream_server_threadpool.cpp`ã€‚\næ–°å»ºå¤´æ–‡ä»¶`coroutine_task.hpp`ã€‚ä¸`network_task.hpp`ä¸åŒï¼Œå…¶éœ€è¦ä¸€ä¸ªfunctionã€‚\nåç¨‹å’Œä»»åŠ¡ä¹‹é—´ç”¨functionæ¥ä½œä¸ºåª’ä»‹ï¼Œå¯ä»¥æŠŠfnçœ‹ä½œæ˜¯åç¨‹å‡½æ•°`agave::IAsyncAction worker_async`ï¼Œä¼ å…¥ç»™CoroutineTaskã€‚\n```cpp\n#include \"../ThreadPool/ITask.h\"\n#include <WinSock2.h>\n#include <functional>\nclass CoroutineTask : public thpool::ITask\n{\npublic:\n\tCoroutineTask(std::function<void(void)> cb) : _cb{ cb }\n\t{\n\n\t}\n\tvoid run_task() override\n\t{\n\t\tif (_cb)\n\t\t{\n\t\t\t_cb();\n\t\t}\n\t}\nprivate:\n\tstd::function<void(void)>\t\t_cb;\n};\n```\nè°ƒç”¨çº¿ç¨‹æ± åŒæ—¶ä½¿ç”¨åç¨‹æ—¶ï¼Œæˆ‘ä»¬æ˜¯è®¾ç½®åç¨‹çš„èƒŒæ™¯ï¼Œç»‘å®šä¸€ä¸ªçº¿ç¨‹æ± ã€‚\nå³åœ¨å»ºç«‹çº¿ç¨‹æ± åç»™å‡ºå¦‚ä¸‹çš„`set_bg_entry`ï¼Œè¾¾åˆ°çš„æ•ˆæœæ˜¯ï¼šæ¯å½“åç¨‹å‡½æ•°è°ƒç”¨`co_await agave::resume_background()`æ—¶ï¼Œéƒ½ä¼šä»èƒŒæ™¯ç»‘å®šçš„çº¿ç¨‹æ± ä¸­æŠ½å–çº¿ç¨‹èµ„æºæ‰§è¡Œåç¨‹å‡½æ•°ã€‚\nå…·ä½“çš„ï¼šåœ¨`set_bg_entry`ä¸­å¡«å…¥ä¸€ä¸ªlambdaè¡¨è¾¾å¼ï¼Œæ•è·åˆ›å»ºå¥½çš„çº¿ç¨‹æ± ï¼Œåœ¨è¯¥çº¿ç¨‹æ± ä¸­æ·»åŠ ä»»åŠ¡`add_task`ï¼Œå³åˆ›å»ºä¸€ä¸ª`CoroutineTask`ï¼Œä½¿ç”¨`fn`ä½œä¸ºå‚æ•°ã€‚\n```cpp\n// stream_server_threadpool_coroutine.cpp\n#include <WinSock2.h>\n#include <iostream>\n#include <format>\n#include <ws2tcpip.h>\n#include \"network_task.h\"\n#include \"../ThreadPool/ThreadPool.h\"\n#include \"../Coroutines/Agave.hpp\"\n#include \"coroutine_task.hpp\"\n#pragma comment (lib, \"Ws2_32\")\nagave::IAsyncAction worker_async(sockaddr_in client_addr, SOCKET work_sock);\n\nint main()\n{\n    thpool::ThreadPool threadpool{ 10 };\n    agave::set_bg_entry(\n        [&threadpool](std::function<void(void)> fn)\n            {\n                threadpool.add_task(std::shared_ptr<thpool::ITask>(new CoroutineTask{ fn }));\n            }\n        );\n    \n    WORD wVersionRequested;\n    WSADATA wsaData;\n    int err;\n\n    /* Use the MAKEWORD(lowbyte, highbyte) macro declared in Windef.h */\n    wVersionRequested = MAKEWORD(2, 2);\n\n    err = ::WSAStartup(wVersionRequested, &wsaData);\n    if (err != 0) {\n        /* Tell the user that we could not find a usable */\n        /* Winsock DLL.                                  */\n        std::wcout << std::format(L\"WSAStartup failed with error : {}\\n\", err);\n        return 1;\n    }\n\n    SOCKET listen_sock = ::socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);\n    if (listen_sock == INVALID_SOCKET)\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n    sockaddr_in server_addr;\n    server_addr.sin_family = AF_INET;\n    //service.sin_addr.S_un.S_addr = inet_addr(\"127.0.0.1\");\n    if (1 != ::inet_pton(AF_INET, \"127.0.0.1\", &server_addr.sin_addr))\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n    server_addr.sin_port = htons(9008);\n\n    if (SOCKET_ERROR == ::bind(listen_sock,\n        reinterpret_cast<const sockaddr*>(&server_addr),\n        sizeof(server_addr)))\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n\n    if (SOCKET_ERROR == ::listen(listen_sock, SOMAXCONN))\n    {\n        err = ::WSAGetLastError();\n        return 1;\n    }\n\n    while (true)\n    {\n        sockaddr_in client_addr;\n        int addrlen{ sizeof(client_addr) };\n        SOCKET work_sock = ::accept(\n            listen_sock,\n            reinterpret_cast<sockaddr*>(&client_addr),\n            &addrlen);\n        if (work_sock == INVALID_SOCKET)\n        {\n            err = ::WSAGetLastError();\n            return 1;\n        }\n\n        worker_async(client_addr, work_sock);\n    }\n\n    ::closesocket(listen_sock);\n    listen_sock = INVALID_SOCKET;\n\n    ::WSACleanup();\n    return 0;\n}\n\nagave::IAsyncAction worker_async(sockaddr_in client_addr, SOCKET work_sock)\n{\n    // let this function run on the child thread instead of the main thread.\n    co_await agave::resume_background();\n\n    wchar_t addr_str[46] = L\"\";\n    InetNtopW(AF_INET, reinterpret_cast<void*>(&client_addr.sin_addr), addr_str, 46);\n    std::wcout << std::format(L\"client address: {}, port: {}\\n\", addr_str, ntohs(client_addr.sin_port));\n    // send ...\n    std::wstring message{ L\"Welcome to server!\" };\n    ::send(\n        work_sock,\n        reinterpret_cast<const char*>(message.c_str()),\n        sizeof(wchar_t) * message.size(),\n        0);\n    // recv ...\n    wchar_t buf[100] = { 0 };\n    int bytes_received = ::recv(work_sock, reinterpret_cast<char*>(buf), sizeof(wchar_t) * sizeof(buf), 0);\n    if (bytes_received > 0)\n    {\n        std::wcout << buf << std::endl;\n    }\n    ::closesocket(work_sock);\n    work_sock = INVALID_SOCKET;\n}\n```\n#### æµ‹è¯•\n![](../../images/ç½‘ç»œ_TCPç¼–ç¨‹æµç¨‹/image-20240927065028838.png)\n","categories":["Linux","ç½‘ç»œ","Windows"]},{"title":"Linux_åˆ‡æ¢æº","url":"/Linux/Linux_åˆ‡æ¢æº/","content":"# åˆ‡æ¢æº\n\n```bash\nsudo cp /etc/apt/sources.list /etc/apt/sources.list.bak #å¤‡ä»½åŸæ¥çš„åˆ—è¡¨\nsudo vim /etc/apt/sources.list #ä¿®æ”¹æº\n# å°†æ–‡ä»¶å†…å®¹æ›¿æ¢æˆæºæ–‡ä»¶å†…å®¹\ndeb http://mirrors.aliyun.com/ubuntu/ trusty main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ trusty-security main restricted universe multiverse\n\ndeb http://mirrors.aliyun.com/ubuntu/ trusty-updates main restricted universe multiverse\n\ndeb http://mirrors.aliyun.com/ubuntu/ trusty-proposed main restricted universe multiverse\n\ndeb http://mirrors.aliyun.com/ubuntu/ trusty-backports main restricted universe multiverse\n\ndeb-src http://mirrors.aliyun.com/ubuntu/ trusty main restricted universe multiverse\n\ndeb-src http://mirrors.aliyun.com/ubuntu/ trusty-security main restricted universe multiverse\n\ndeb-src http://mirrors.aliyun.com/ubuntu/ trusty-updates main restricted universe multiverse\n\ndeb-src http://mirrors.aliyun.com/ubuntu/ trusty-proposed main restricted universe multiverse\n\ndeb-src http://mirrors.aliyun.com/ubuntu/ trusty-backports main restricted universe multiverse\n# ä¿å­˜\nsudo apt-get update #æ›´æ–°åˆ—è¡¨\n```\n","categories":["Linux"]},{"title":"Linux_é…ç½®VSCode","url":"/Linux/Linux_é…ç½®VSCode/","content":"# å¦‚ä½•åœ¨vscodeä¸‹é…ç½®é“¾æ¥åº“(.so)\n\n* é…ç½®å¤´æ–‡ä»¶çš„æœç´¢è·¯å¾„\n* é…ç½®åº“æ–‡ä»¶çš„æœç´¢è·¯å¾„\n* é…ç½®éœ€è¦é“¾æ¥çš„.soåº“\n\næŒ‰å¿«æ·é”®F1å¯æŠŠvscodeçš„é…ç½®å¯¹è¯æ¡†æ‰“å¼€ï¼Œè¿›è¡Œæ£€ç´¢ï¼Œæˆ‘ä»¬å¯¹cppæ–‡ä»¶çš„ç¼–è¯‘é“¾æ¥è¿›è¡Œé…ç½®ï¼Œè¾“å…¥Editï¼Œæ‰¾C/C++çš„æ¡ç›®ã€‚\n\n![image-20220318152213890](../../images/Linux_å„ç§é…ç½®/image-20220318152213890.png)\n\n![image-20220318152333543](../../images/Linux_å„ç§é…ç½®/image-20220318152333543.png)\n\næ­¤å¤„çš„jsonæ–‡ä»¶å°±æ˜¯cppæ–‡ä»¶ç¼–è¯‘çš„é…ç½®æ–‡ä»¶ã€‚\n\n![image-20220318152417135](../../images/Linux_å„ç§é…ç½®/image-20220318152417135.png)\n\n```bash\né…ç½®è¦ç‚¹ï¼š\n\tg++ -Iå¤´æ–‡ä»¶æœç´¢è·¯å¾„ -Låº“æ–‡ä»¶æœç´¢è·¯å¾„ -låº“çš„åç§°\n\tincludePathå¯ä»¥è‡ªå®šä¹‰æ·»åŠ æ–‡ä»¶çš„æœç´¢è·¯å¾„\t# usr/(local/)includeä¸ç”¨åŠ ï¼Œæ˜¯å…¨ç³»ç»Ÿé€šç”¨çš„\n\tcppstandard - å¦‚: \"cppStandard\" : \"c++11\"\n\t\n```\n\n`Ctrl + shift + B`ï¼šæ˜¯å¯¹buildç›¸å…³çš„é…ç½®ï¼Œé€‰æ‹©C/C++æ¡ç›®åé¢çš„é½¿è½®ã€‚ç‚¹è¿›å»å‘ç°æ˜¯ä¸€ä¸ª`task.json`ã€‚\n\n![image-20220318153301574](../../images/Linux_å„ç§é…ç½®/image-20220318153301574.png)\n\n![image-20220318153413837](../../images/Linux_å„ç§é…ç½®/image-20220318153413837.png)\n\n```bash\né…ç½®è¦ç‚¹ï¼š\n\t\"command\"æ˜¯é€‰æ‹©å“ªä¸ªè·¯å¾„ä¸‹çš„C++ç¼–è¯‘å™¨\n\t\"args\"æ˜¯ç¼–è¯‘é“¾æ¥æŒ‡ä»¤åé¢æ‰€å¸¦çš„å¯åŠ å‚æ•°çš„é…ç½®ä¿¡æ¯\n\t\tå¯åœ¨æœ€åä¸€è¡Œåé¢åŠ è‡ªå·±ç›¸åŠ çš„å‚æ•°\n\t\tæ¯”å¦‚: \"${...}\",\n\t\t\t \"-lmuduo_net\",\n\t\t\t \"-lmuduo_base\",\n\t\t\t \"-lpthread\"\n```\n\né™¤äº†`c_cpp_properties.json`ã€`tasks.json`è¿˜æœ‰ä¸ª`launch.json`é…ç½®æ–‡ä»¶ï¼Œæ˜¯å…³äºè°ƒè¯•ã€è¿è¡Œçš„ã€‚\n","categories":["Linux"]},{"title":"é«˜çº§æ•°æ®ç»“æ„_çº¢é»‘æ ‘","url":"/é«˜çº§æ•°æ®ç»“æ„/é«˜çº§æ•°æ®ç»“æ„_çº¢é»‘æ ‘/","content":"# å†…å®¹\n\n1. çº¢é»‘æ ‘\n\n# çº¢é»‘æ ‘\n\nåœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œçº¢é»‘æ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡äºŒå‰æœç´¢æ ‘ã€‚å…¸å‹ç”¨é€”æ˜¯å®ç°[å…³è”æ•°ç»„](https://zh.wikipedia.org/wiki/å…³è”æ•°ç»„)(å³map)ã€‚çº¢é»‘æ ‘æ˜¯ä» 4 é˜¶ B æ ‘ï¼ˆå³2-3-4æ ‘ï¼‰è¡ç”Ÿå‡ºæ¥çš„å½¢å¼ã€‚\n\n>ä»¥ä¸‹å†…å®¹æ¥è‡ªwikiï¼šhttps://en.wikipedia.org/wiki/Red%E2%80%93black_tree\n>1972å¹´ï¼Œ[é²é“å¤«Â·æ‹œè€³](https://en.wikipedia.org/wiki/Rudolf_Bayer)å‘æ˜äº†ä¸€ç§[B æ ‘](https://en.wikipedia.org/wiki/B-tree \"B-tree\")çš„ç‰¹æ®Š 4 é˜¶å½¢å¼ã€‚è¿™ä¸ª 4 é˜¶ B æ ‘ç»´æŠ¤ä»æ ¹åˆ°å¶çš„æ‰€æœ‰è·¯å¾„ï¼ŒèŠ‚ç‚¹æ•°ç›¸åŒï¼Œä»è€Œåˆ›å»ºå®Œç¾å¹³è¡¡çš„æ ‘ï¼ˆç„¶è€Œï¼Œå¹¶ä¸æ˜¯[äºŒå‰æœç´¢æ ‘](https://zh.wikipedia.org/wiki/äºŒå…ƒæœå°‹æ¨¹)ï¼‰ã€‚æ‹œå°”åœ¨ä»–çš„è®ºæ–‡ä¸­ç§°å‘¼ä»–ä»¬ä¸ºâ€œ**å¯¹ç§°äºŒå‰ B æ ‘**â€ï¼ˆsymmetric binary B-treeï¼‰ï¼Œåæ¥è¿™ç§ 4 é˜¶ B æ ‘è¢«ç§°ä¸º[2-3-4 æ ‘](https://en.wikipedia.org/wiki/2%E2%80%933%E2%80%934_tree \"2â€“3â€“4 tree\")ã€‚\n>\n>åœ¨ 1978 å¹´çš„è®ºæ–‡ã€ŠA Dichromatic Framework for Balanced Treesã€‹ä¸­ï¼Œ[Leonidas J. Guibas](https://en.wikipedia.org/wiki/Leonidas_J._Guibas \"Leonidas J. Guibas\")å’Œ[Robert Sedgewick](https://en.wikipedia.org/wiki/Robert_Sedgewick_\\(computer_scientist\\) \"Robert Sedgewick (computer scientist)\")ä» 2-3-4 æ ‘ä¸­è¡ç”Ÿå‡ºäº†çº¢é»‘æ ‘ã€‚\n>\n>ä¹‹æ‰€ä»¥é€‰æ‹©â€œçº¢è‰²â€æ˜¯å› ä¸ºå®ƒæ˜¯ä½œè€…åœ¨Xerox PARCå·¥ä½œæ—¶å¯ç”¨çš„å½©è‰²æ¿€å…‰æ‰“å°æœºæ‰“å°å‡ºçš„æœ€å¥½çœ‹çš„é¢œè‰²ã€‚Guibas çš„å¦ä¸€ä¸ªå›åº”æ˜¯ï¼Œè¿™æ˜¯å› ä¸ºä»–ä»¬å¯ä»¥ä½¿ç”¨çº¢è‰²å’Œé»‘è‰²çš„ç¬”æ¥ç”»æ ‘ã€‚\n>\n>1993 å¹´ï¼ŒArne Andersson æå‡ºå³å€¾æ ‘çš„æ¦‚å¿µï¼Œä»¥ç®€åŒ–æ’å…¥å’Œåˆ é™¤æ“ä½œã€‚\n>1999 å¹´ï¼ŒÂ [Chris Okasaki](https://en.wikipedia.org/wiki/Chris_Okasaki \"Chris Okasaki\")å±•ç¤ºäº†å¦‚ä½•ä½¿æ’å…¥æ“ä½œçº¯ç²¹å‡½æ•°åŒ–ï¼ˆpurely functionalï¼‰ã€‚å…¶å¹³è¡¡å‡½æ•°åªéœ€è¦å¤„ç† 4 ç§ä¸å¹³è¡¡æƒ…å†µå’Œ 1 ç§é»˜è®¤å¹³â€‹â€‹è¡¡æƒ…å†µã€‚\n>åŸå§‹ç®—æ³•éœ€è¦å¤„ç† 8 ç§ä¸å¹³è¡¡æƒ…å†µï¼Œä½† 2001 å¹´ï¼Œ[Cormen ç­‰äºº](https://en.wikipedia.org/wiki/Red%E2%80%93black_tree#CITEREFCormenLeisersonRivestStein2001)å°†å…¶ç®€åŒ–ä¸º 6 ç§ä¸å¹³è¡¡æƒ…å†µã€‚Sedgewick é€šè¿‡å®è·µè¯æ˜ï¼Œæ’å…¥æ“ä½œä»…éœ€46è¡ŒJavaä»£ç å³å¯å®ç°ã€‚\n>2008 å¹´ï¼ŒSedgewick åŸºäº Arne Andersson ç®€åŒ–æ’å…¥å’Œåˆ é™¤æ“ä½œçš„ç†å¿µï¼Œæå‡ºäº†[å·¦å€¾çº¢é»‘æ ‘](https://en.wikipedia.org/wiki/Left-leaning_red%E2%80%93black_tree \"Left-leaning redâ€“black tree\")ã€‚è¯¥ç»“æ„åˆæœŸå…è®¸èŠ‚ç‚¹æ‹¥æœ‰ä¸¤ä¸ªçº¢è‰²å­èŠ‚ç‚¹ï¼ˆæ›´æ¥è¿‘2-3-4æ ‘ç‰¹æ€§ï¼‰ï¼ŒåæœŸé€šè¿‡å¢åŠ èŠ‚ç‚¹é™åˆ¶ä½¿å…¶æ›´è´´è¿‘2-3æ ‘ç»“æ„ã€‚æ”¹è¿›åï¼ŒSedgewickå°†æ’å…¥ç®—æ³•çš„ä»£ç é‡ä»46è¡Œç²¾å‡è‡³33è¡Œï¼Œæ˜¾è‘—æå‡äº†ä»£ç æ•ˆç‡ã€‚\n\næ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨ä¸€ä¸ªè¡¨ç¤ºâ€œé¢œè‰²â€ï¼ˆâ€œçº¢è‰²â€æˆ–â€œé»‘è‰²â€ï¼‰çš„é¢å¤–ä½ï¼Œç”¨äºç¡®ä¿æ ‘åœ¨æ’å…¥å’Œåˆ é™¤æœŸé—´ä¿æŒå¹³è¡¡ã€‚\n\nå½“æ ‘è¢«ä¿®æ”¹æ—¶ï¼Œæ–°æ ‘è¢«é‡æ–°æ’åˆ—å¹¶â€œé‡æ–°ç»˜åˆ¶â€ä»¥æ¢å¤é™åˆ¶æ ‘åœ¨æœ€åæƒ…å†µä¸‹å¯èƒ½å˜å¾—å¤šä¹ˆä¸å¹³è¡¡çš„ç€è‰²å±æ€§ã€‚è¿™äº›å±æ€§è¢«è®¾è®¡æˆå¯ä»¥æœ‰æ•ˆåœ°æ‰§è¡Œè¿™ç§é‡æ–°æ’åˆ—å’Œé‡æ–°ç€è‰²ã€‚\n\né‡æ–°å¹³è¡¡å¹¶ä¸å®Œç¾ï¼Œä½†ä¿è¯åœ¨$O(\\log n)$æ—¶é—´å†…æœç´¢ï¼Œå…¶ä¸­$n$æ˜¯æ¡ç›®æ•°ã€‚æ’å…¥å’Œåˆ é™¤æ“ä½œä»¥åŠæ ‘çš„é‡æ–°æ’åˆ—å’Œé‡æ–°ç€è‰²ä¹Ÿåœ¨$O(\\log n)$æ—¶é—´å†…æ‰§è¡Œã€‚\n\nè·Ÿè¸ªæ¯ä¸ªèŠ‚ç‚¹çš„é¢œè‰²åªéœ€è¦æ¯ä¸ªèŠ‚ç‚¹çš„ä¸€ä½ä¿¡æ¯ï¼Œå› ä¸ºåªæœ‰ä¸¤ç§é¢œè‰²ã€‚è¯¥æ ‘ä¸åŒ…å«ä»»ä½•å…¶ä»–ç‰¹å®šäºå®ƒæ˜¯çº¢é»‘æ ‘çš„æ•°æ®ï¼Œå› æ­¤å®ƒçš„å†…å­˜å ç”¨å‡ ä¹ä¸ç»å…¸ï¼ˆæœªç€è‰²ï¼‰äºŒå‰æœç´¢æ ‘çš„å†…å­˜å ç”¨ç›¸åŒã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæ— éœ€é¢å¤–çš„å†…å­˜æˆæœ¬å³å¯å­˜å‚¨é¢å¤–çš„ä¿¡æ¯ä½ã€‚\n\n## çº¢é»‘æ ‘ä¸AVLçš„å¯¹æ¯”\n\nå®é™…ä¸Šæ ‘èŠ‚ç‚¹çš„ç»“æ„ä¸AVLä¸€æ¨¡ä¸€æ ·, åªæ˜¯balanceçš„çŠ¶æ€å€¼åªæœ‰ä¸¤ä¸ª, ç„¶ååˆåœ¨è¿™ä¸ªåŸºç¡€ä¸Š, å¯¹å…¶è¿›è¡Œäº†ä¸€äº›é™åˆ¶; \n\nè¿™æ ·çš„å¥½å¤„å°±æ˜¯, å¯¹äºçº¢é»‘æ ‘çš„æ’å…¥/åˆ é™¤æ“ä½œ, åœ¨ç¼–å†™ä»£ç æ—¶, åªéœ€è€ƒè™‘å…¶ä¸¤ç§çŠ¶æ€å³å¯, è¿™æœ‰åˆ©äºå¼€å‘å®è·µ; è€ŒAVLéœ€è¦è€ƒè™‘ä¸‰ç§çŠ¶æ€, å¯¹äºå¼€å‘ä»£ç æ¥è¯´éš¾åº¦åŠ å¤§, å¹¶ä¸”AVLæ ‘è¿‡äºç†æƒ³åŒ–, å¯¼è‡´æ—‹è½¬æ“ä½œè¿‡å¤š, åè€Œä¼šå½±å“æ€§èƒ½; \n\nAVLæ ‘æœ¬æ¥æƒ³è§£å†³ä»€ä¹ˆé—®é¢˜å‘¢? æ˜¯ä¸ºäº†é˜²æ­¢ä¸åŠ é™åˆ¶çš„äºŒå‰æœç´¢æ ‘åœ¨æŒç»­æ’å…¥ä¸€äº›æç«¯çš„å€¼(ä¾æ¬¡æ’å…¥æœ‰åºçš„æ•°)å, æœç´¢æ ‘çš„ç»“æ„é€€åŒ–ä¸ºäº†ä¸€ä¸ªé•¿åº¦ä¸ºnçš„é“¾è¡¨, å› æ­¤æŸ¥æ‰¾æ€§èƒ½ä¹Ÿä¼šé€€åŒ–; \n\nä½†æ˜¯, å¯¹äºŒå‰æœç´¢æ ‘çš„æåº¦é™åˆ¶, ä½¿å…¶ä¿æŒä¸€ä¸ªç†æƒ³åŒ–çš„å¹³è¡¡åˆæ˜¾å¾—çŸ«æ‰è¿‡æ­£, è™½ç„¶æ’å…¥æ•°æ®æ—¶ä¸ç”¨åšè¿‡å¤šçš„æ—‹è½¬(æœ€å¤šåš2æ¬¡æ—‹è½¬æ“ä½œ), ä½†æ˜¯åˆ é™¤æ“ä½œçš„æ—¶å€™, å¯èƒ½ä¼šæ¶‰åŠåˆ°ä¸€é•¿ä¸²çš„æ—‹è½¬å¤„ç†($\\log n$æ¬¡), è¿™ä¹Ÿä¼šå¯¼è‡´æ€§èƒ½çš„é€€åŒ–; \n\näºæ˜¯, çº¢é»‘æ ‘çš„æ€§è´¨å°±åƒæ˜¯åŒæ—¶å…‹æœäº†ä¸¤è€…çš„ç¼ºç‚¹, ä½†æ˜¯åœ¨é«˜åº¦å¹³è¡¡ä¸Š, åšå‡ºäº†ä¸€äº›å¦¥å, ä½†æ˜¯è¿™ä¹Ÿæ˜¯æ— ä¼¤å¤§é›…çš„, çº¢é»‘æ ‘èŠ‚ç‚¹çš„å·¦å³å­æ ‘é«˜åº¦å·®, é•¿çš„é•¿åº¦ä¸è¶…è¿‡çŸ­çš„é•¿åº¦çš„2å€; \n\n| æ“ä½œ               | AVLçš„æ—¶é—´å¤æ‚åº¦ | çº¢é»‘æ ‘çš„æ—¶é—´å¤æ‚åº¦ |\n| ------------------ | --------------- | ------------------ |\n| å¢åˆ æŸ¥             | $O(\\log n)$     | $O(\\log n)$        |\n| Insertæœ€å¤šæ—‹è½¬æ¬¡æ•° | 2               | 2                  |\n| removeæœ€å¤šæ—‹è½¬æ¬¡æ•° | $O(\\log n)$     | 3                  |\n\næ ¹æ®ä¸Šè¡¨, å¯ä»¥å¾—å‡º, å¦‚æœæ“ä½œæ¶‰åŠåˆ°æŸ¥è¯¢/æ’å…¥è¾ƒå¤š, ä¼˜å…ˆé€‰æ‹©AVLæ ‘, AVLæ˜¯ç»å¯¹å¹³è¡¡çš„æ ‘, æŸ¥è¯¢æ•ˆç‡ä¸ä¼šä½äºçº¢é»‘æ ‘; è€Œæ’å…¥æ•ˆç‡ä¸¤è€…ç­‰æ•ˆ; \n\nå¦‚æœæ“ä½œæ¶‰åŠä¿®æ”¹è¾ƒå¤š, æŸ¥è¯¢ä¸å¤š, åˆ™é€‰æ‹©çº¢é»‘æ ‘; é™¤æ­¤ä¹‹å¤–, çº¢é»‘æ ‘åœ¨ç™¾ä¸‡çº§æ•°æ®æˆ–æ›´å¤§è§„æ¨¡çš„æ•°æ®åœºæ™¯ä¸­è¡¨ç°å°†ä¼šè„±é¢–è€Œå‡º; \n\nå¦‚æœå¢åˆ æŸ¥ä¸‰è€…æ“ä½œéƒ½æ¯”è¾ƒå¤š, çº¢é»‘ä¹¦ç»¼åˆæ€§èƒ½è¦æ›´ä¼˜; \n\n# çº¢é»‘æ ‘çš„æ€§è´¨\n\nçº¢é»‘æ ‘æ˜¯æ¯ä¸ªèŠ‚ç‚¹éƒ½å¸¦æœ‰é¢œè‰²å±æ€§çš„**äºŒå‰æŸ¥æ‰¾æ ‘**ï¼Œé¢œè‰²æ˜¯çº¢è‰²æˆ–é»‘è‰²ã€‚åŸºäºäºŒå‰æŸ¥æ‰¾æ ‘çš„å¼ºåˆ¶è¦æ±‚ï¼Œå¯¹äºä»»ä½•æœ‰æ•ˆçš„çº¢é»‘æ ‘æˆ‘ä»¬å¢åŠ äº†å¦‚ä¸‹çš„é¢å¤–è¦æ±‚ï¼š\n\n1. æ¯ä¸ªèŠ‚ç‚¹ä¸æ˜¯çº¢è‰²å°±æ˜¯é»‘è‰²ã€‚\n2. å¦‚æœå·¦å³å­©å­æ˜¯NIL, åˆ™æŠŠæ­¤å­©å­çœ‹ä½œé»‘è‰²èŠ‚ç‚¹; å®é™…ä¸Šè¿™ä¸ªNILèŠ‚ç‚¹æ˜¯å“¨å…µèŠ‚ç‚¹, å¯çœ‹ä½œä¸€ä¸ªå…¬å…±å¶å­èŠ‚ç‚¹; \n3. æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²ã€‚\n4. ä»æ¯ä¸ªå¶å­åˆ°æ ¹çš„æ‰€æœ‰è·¯å¾„ä¸Šä¸èƒ½æœ‰ä¸¤ä¸ªè¿ç»­çš„çº¢è‰²èŠ‚ç‚¹; å¦‚æ­¤, æ¯ä¸ªçº¢è‰²èŠ‚ç‚¹çš„ä¸¤ä¸ªå­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²ã€‚\n5. ä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ¯ä¸ªå¶å­(å¯ä»¥åŒ…å«NILå…¬å…±å¶èŠ‚ç‚¹)çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ã€‚\n\nè¿™äº›çº¦æŸå¼ºåˆ¶äº†çº¢é»‘æ ‘çš„å…³é”®æ€§è´¨ï¼šä»æ ¹åˆ°å¶å­çš„æœ€é•¿çš„å¯èƒ½è·¯å¾„ä¸å¤šäºæœ€çŸ­çš„å¯èƒ½è·¯å¾„çš„ä¸¤å€é•¿ã€‚ç»“æœæ˜¯è¿™ä¸ªæ ‘å¤§è‡´ä¸Šæ˜¯å¹³è¡¡çš„ã€‚å› ä¸ºæ“ä½œæ¯”å¦‚æ’å…¥ã€åˆ é™¤å’ŒæŸ¥æ‰¾æŸä¸ªå€¼çš„æœ€åæƒ…å†µæ—¶é—´éƒ½è¦æ±‚ä¸æ ‘çš„é«˜åº¦æˆæ¯”ä¾‹ï¼Œè¿™ä¸ªåœ¨é«˜åº¦ä¸Šçš„ç†è®ºä¸Šé™å…è®¸çº¢é»‘æ ‘åœ¨æœ€åæƒ…å†µä¸‹éƒ½æ˜¯é«˜æ•ˆçš„ï¼Œè€Œä¸åŒäºæ™®é€šçš„äºŒå‰æŸ¥æ‰¾æ ‘ã€‚\n\næ˜¯æ€§è´¨4å¯¼è‡´è·¯å¾„ä¸Šä¸èƒ½æœ‰ä¸¤ä¸ªè¿ç»­çš„çº¢è‰²èŠ‚ç‚¹ç¡®ä¿äº†è¿™ä¸ªç»“æœã€‚æœ€çŸ­çš„å¯èƒ½è·¯å¾„éƒ½æ˜¯é»‘è‰²èŠ‚ç‚¹ï¼Œæœ€é•¿çš„å¯èƒ½è·¯å¾„æœ‰äº¤æ›¿çš„çº¢è‰²å’Œé»‘è‰²èŠ‚ç‚¹ã€‚å› ä¸ºæ ¹æ®æ€§è´¨5æ‰€æœ‰æœ€é•¿çš„è·¯å¾„éƒ½æœ‰ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ï¼Œè¿™å°±è¡¨æ˜äº†æ²¡æœ‰è·¯å¾„èƒ½å¤šäºä»»ä½•å…¶ä»–è·¯å¾„çš„ä¸¤å€é•¿ã€‚\n\n> æ€è€ƒ: ä¸ºä»€ä¹ˆæ»¡è¶³ä¸Šé¢çš„æ€§è´¨ï¼Œçº¢é»‘æ ‘å°±èƒ½ä¿è¯: å…¶æœ€é•¿è·¯å¾„ä¸­èŠ‚ç‚¹ä¸ªæ•°ä¸ä¼šè¶…è¿‡æœ€çŸ­è·¯å¾„èŠ‚ç‚¹ä¸ªæ•°çš„ä¸¤å€(çº¢é»‘æ ‘èŠ‚ç‚¹çš„å·¦å³å­æ ‘é«˜åº¦å·®, é•¿çš„é•¿åº¦ä¸è¶…è¿‡çŸ­çš„é•¿åº¦çš„2å€; )ï¼Ÿ\n>\n> å¯ä»¥åšä¸ªå‡è®¾: ä¸€ä¸ªèŠ‚ç‚¹åˆ°å…¶`å¶å­èŠ‚ç‚¹1`, å…¨éƒ¨æ˜¯é»‘è‰²èŠ‚ç‚¹, å…±10ä¸ª; è€Œåˆ°å…¶`å¶å­èŠ‚ç‚¹2`, é»‘çº¢èŠ‚ç‚¹äº¤æ›¿, å…±20ä¸ª, è¿™ç§æ˜¯æ»¡è¶³æ€§è´¨5æœ€å¤§çš„æé™äº†, ç”±äºæ€§è´¨5çš„é™åˆ¶, å…¶æœ€é•¿è·¯å¾„ä¸­èŠ‚ç‚¹ä¸ªæ•°ä¸ä¼šè¶…è¿‡æœ€çŸ­è·¯å¾„èŠ‚ç‚¹ä¸ªæ•°çš„ä¸¤å€; \n\n# ç”¨é€”å’Œå¥½å¤„\n\nçº¢é»‘æ ‘å’ŒAVLæ ‘ä¸€æ ·éƒ½å¯¹æ’å…¥æ—¶é—´ã€åˆ é™¤æ—¶é—´å’ŒæŸ¥æ‰¾æ—¶é—´æä¾›äº†æœ€å¥½å¯èƒ½çš„æœ€åæƒ…å†µæ‹…ä¿ã€‚ä¸åªåœ¨æ—¶é—´æ•æ„Ÿçš„åº”ç”¨å¦‚å®æ—¶åº”ç”¨ï¼ˆreal time applicationï¼‰ä¸­æœ‰ä»·å€¼; è€Œä¸”åœ¨æä¾›æœ€åæƒ…å†µæ‹…ä¿çš„å…¶ä»–æ•°æ®ç»“æ„ä¸­ä½œä¸ºåŸºç¡€æ¨¡æ¿æœ‰ä»·å€¼, ä¾‹å¦‚ï¼Œåœ¨è®¡ç®—å‡ ä½•ä¸­ä½¿ç”¨çš„å¾ˆå¤šæ•°æ®ç»“æ„éƒ½å¯ä»¥åŸºäºçº¢é»‘æ ‘å®ç°ã€‚\n\nçº¢é»‘æ ‘åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ä¹Ÿç‰¹åˆ«æœ‰ç”¨ï¼Œåœ¨è¿™é‡Œå®ƒä»¬æ˜¯æœ€å¸¸ç”¨çš„æŒä¹…æ•°æ®ç»“æ„ï¼ˆpersistent data structureï¼‰ä¹‹ä¸€ï¼Œå®ƒä»¬ç”¨æ¥æ„é€ å…³è”æ•°ç»„å’Œé›†åˆï¼Œæ¯æ¬¡æ’å…¥ã€åˆ é™¤ä¹‹åå®ƒä»¬èƒ½ä¿æŒä¸ºä»¥å‰çš„ç‰ˆæœ¬ã€‚é™¤äº†$O(\\log n)$çš„æ—¶é—´ä¹‹å¤–ï¼Œçº¢é»‘æ ‘çš„æŒä¹…ç‰ˆæœ¬å¯¹æ¯æ¬¡æ’å…¥æˆ–åˆ é™¤éœ€è¦$O(\\log n)$çš„ç©ºé—´ã€‚\n\nçº¢é»‘æ ‘æ˜¯2-3-4æ ‘çš„ä¸€ç§ç­‰åŒã€‚æ¢å¥è¯è¯´ï¼Œå¯¹äºæ¯ä¸ª2-3-4æ ‘ï¼Œéƒ½å­˜åœ¨è‡³å°‘ä¸€ä¸ªæ•°æ®å…ƒç´ æ˜¯åŒæ ·æ¬¡åºçš„çº¢é»‘æ ‘ã€‚åœ¨2-3-4æ ‘ä¸Šçš„æ’å…¥å’Œåˆ é™¤æ“ä½œä¹Ÿç­‰åŒäºåœ¨çº¢é»‘æ ‘ä¸­é¢œè‰²ç¿»è½¬å’Œæ—‹è½¬ã€‚è¿™ä½¿å¾—2-3-4æ ‘æˆä¸ºç†è§£çº¢é»‘æ ‘èƒŒåçš„é€»è¾‘çš„é‡è¦å·¥å…·ï¼Œè¿™ä¹Ÿæ˜¯å¾ˆå¤šä»‹ç»ç®—æ³•çš„æ•™ç§‘ä¹¦åœ¨çº¢é»‘æ ‘ä¹‹å‰ä»‹ç»2-3-4æ ‘çš„åŸå› ï¼Œå°½ç®¡2-3-4æ ‘åœ¨å®è·µä¸­ä¸ç»å¸¸ä½¿ç”¨ã€‚\n\nçº¢é»‘æ ‘ç›¸å¯¹äºAVLæ ‘æ¥è¯´ï¼Œç‰ºç‰²äº†éƒ¨åˆ†å¹³è¡¡æ€§ä»¥æ¢å–æ’å…¥/åˆ é™¤æ“ä½œæ—¶å°‘é‡çš„æ—‹è½¬æ“ä½œï¼Œæ•´ä½“æ¥è¯´æ€§èƒ½è¦ä¼˜äºAVLæ ‘ã€‚\n\n# RBæ ‘çš„ç»“æ„è®¾è®¡\n\nçº¢é»‘æ ‘ç›¸æ¯”äºAVLæ ‘, æœ‰ä¸€ä¸ªä¼ä¿©, å°±æ˜¯è®¾ç½®äº†ä¸€ä¸ªå“¨å…µèŠ‚ç‚¹, ä½œä¸ºæ¯ä¸ªå¶èŠ‚ç‚¹çš„å·¦å³å­©å­, æˆ–è€…æ˜¯: ä¸ä¸ºå¶èŠ‚ç‚¹, ä½†æœ‰ä¸€å­©å­æŒ‡é’ˆä¸ºç©ºæ—¶æŒ‡å‘çš„ä¸€ä¸ªèŠ‚ç‚¹, è¿™ä¼šä½¿ç¼–ç¨‹éš¾åº¦é™ä½; \n\nè¿˜å¯ä»¥å¼•å…¥ä¸€ä¸ªä½œä¸ºæ•´ä¸ªçº¢é»‘æ ‘çš„å¤´èŠ‚ç‚¹, åŒäº²æŒ‡é’ˆæŒ‡å‘çº¢é»‘æ ‘æ ¹èŠ‚ç‚¹, å·¦å­©å­æŒ‡é’ˆæŒ‡å‘çº¢é»‘æ ‘æœ€å·¦èŠ‚ç‚¹(æœ€å°å€¼), å³å­©å­æŒ‡é’ˆæŒ‡å‘çº¢é»‘æ ‘æœ€å³èŠ‚ç‚¹(æœ€å¤§å€¼), æ ¹èŠ‚ç‚¹çš„åŒäº²æŒ‡é’ˆæŒ‡å‘è¯¥å¤´èŠ‚ç‚¹; \n\n## èŠ‚ç‚¹ç»“æ„\n\n```cpp\ntypedef enum { RED = 0, BLACK = 1 } ColorType;\ntypedef int KeyType;\ntypedef struct rb_node\n{\n    rb_node * leftchild;\n    rb_node * parent;\n    rb_node * rightchild;\n    ColorType color;\n    KeyType key;\n}rb_node, *RBTree;\nstatic rb_node *NIL = BuyNode();\n```\n\n### æ–°å»ºèŠ‚ç‚¹å‡½æ•° - BuyNode\n\n```cpp\nrb_node * BuyNode()\n{\n    rb_node * s = (rb_node*)malloc(sizeof(rb_node));\n    if(nullptr == s) exit(1);\n    memset(s, 0, sizeof(rb_node));\n    s->leftchild = NIL;\n    s->rightchild = NIL;\n    s->color = RED;\t\t//å‡ºç”Ÿçš„çº¢é»‘æ ‘èŠ‚ç‚¹é»˜è®¤ä¸ºçº¢è‰²\n    return s;\n}\n```\n\n# æ’å…¥\n\n## å»ºæ ¹å‡½æ•°\n\n```cpp\nrb_node * MakeRoot(KeyType kx)\n{\n    rb_node * root = BuyNode();\n    root->color = BLACK;\t\t//é»˜è®¤æ ¹èŠ‚ç‚¹ä¸ºé»‘è‰²\n    root->key = kx;\n    return root;\n}\n```\n\n## Insert\n\n```cpp\nbool Insert(rb_node *& tree, KeyType kx)\n{\n    if(tree == nullptr)\n    {\n        tree = MakeRoot(kx);\n        return true;\n    }\n    rb_node * pa = nullptr;\n    rb_node * p = tree;\n    while(p != nullptr && p->key != kx)\n    {\n        pa = p;\n        p = kx < p->key ? p->leftchild : p->rightchild;\n    }\n    if(p != nullptr && p->key == kx) return false;\n    p = BuyNode();\n    p->key = kx;\n    p->parent = pa;\n    if(kx < pa->key)\n    {\n        pa->leftchild = p;\n    }\n    else\n    {\n        pa->rightchild = p;\n    }\n    PassRBTree(tree, p);    //çº¢é»‘æ ‘è°ƒæ•´\n    return true;\n}\n```\n\n## çº¢é»‘æ ‘è°ƒæ•´\n\n### å·¦å•æ—‹ - RotateLeft\n\n```cpp\nvoid RotateLeft(rb_node *& tree, rb_node * ptr)\n{\n    rb_node * newroot = ptr->rightchild;\n    newroot->parent = ptr->parent;\n    ptr->rightchild = newroot->leftchild;  //1 åŸæ ¹ç»§æ‰¿ è½´èŠ‚ç‚¹çš„å·¦å­©å­\n    if(newroot->leftchild != nullptr)\n    {\n        newroot->leftchild->parent = ptr;  \n    }\n    \n    newroot->leftchild = ptr;              //2 è½´èŠ‚ç‚¹åŒ…æ½åŸæ ¹\n    //3 å¤„ç† åŸæ ¹çˆ¶èŠ‚ç‚¹(æˆ–æ— çˆ¶èŠ‚ç‚¹) çš„å·¦å³å­©å­æŒ‡é’ˆ(æˆ–treeæŒ‡é’ˆ)\n    if(ptr == tree)\n    {\n        tree = newroot;\n    }\n    else\n    {\n        if(ptr->parent->leftchild == ptr)\n        {\n            ptr->parent->leftchild = newroot;\n        }\n        else\n        {\n            ptr->parent->rightchild = newroot;\n        }\n    }\n    \n    ptr->parent = newroot;\n}\n```\n\n### å³å•æ—‹ - RotateRight\n\n```cpp\nvoid RotateRight(rb_node *& tree, rb_node * ptr)\n{\n    rb_node * newroot = ptr->leftchild;\n    newroot->parent = ptr->parent;\n    ptr->leftchild = newroot->rightchild;\n    if(newroot->rightchild != nullptr)\n    {\n        newroot->rightchild->parent = ptr;\n    }\n    newroot->rightchild = ptr;\n    if(ptr == tree)\n    {\n        tree = newroot;\n    }\n    else\n    {\n        if(ptr->parent->leftchild == ptr)\n        {\n            ptr->parent->leftchild = newroot;\n        }\n        else\n        {\n            ptr->parent->rightchild = newroot;\n        }\n    }\n    ptr->parent = newroot;\n}\n```\n\n### è°ƒæ•´å‡½æ•°\n\nå¯¹çº¢é»‘æ ‘ä¿®æ”¹æ—¶, å‡ºç°ä¸å¹³è¡¡æˆ–é¢œè‰²å†²çª, å¯¹å…¶è°ƒæ•´ä½¿å…¶å¹³è¡¡, é¢œè‰²æ­£ç¡®çš„å‡½æ•°\n\n```cpp\nvoid PassRBTree(rb_node *& tree, rb_node *p)\n{\n    rb_node * _X = nullptr;\n    for(; p != tree && p->parent->color == RED; )\n    {\n        if(p->parent->parent->rightchild == p->parent)//è¯´æ˜åœ¨çˆ·çˆ·çš„å³è¾¹æ’å…¥\n        {\n            _X = p->parent->parent->leftchild;\n            if(_X->color == RED)\n            {\n                _X->color = BLACK;\n                p->parent->color = BLACK;\n                p->parent->parent->color = RED;\n                p = p->parent->parent;\t//æ¥ä¸‹æ¥å¾ªç¯çœ‹ä»–çˆ·çˆ·çš„åŒäº²æ˜¯ä¸æ˜¯çº¢\n            }\n            else //å·¦å•æ—‹\n            {\n                p->parent->color = BLACK;\n                p->parent->parent->color = RED;\n                RotateLeft(tree, p->parent->parent);\n            }\n        }\n        else\n        {\n            \n        }\n        \n    }\n    tree->color = BLACK;\n}\n```\n\nåŠ ä¸ŠåŒæ—‹çš„æƒ…å†µ\n\n```cpp\nvoid PassRBTree(rb_node *& tree, rb_node *p)\n{\n    rb_node * _X = nullptr;\n    for(; p != tree && p->parent->color == RED; )\n    {\n        if(p->parent->parent->rightchild == p->parent)//è¯´æ˜åœ¨çˆ·çˆ·çš„å³è¾¹æ’å…¥\n        {\n            _X = p->parent->parent->leftchild;\n            if(_X->color == RED)\n            {\n                _X->color = BLACK;\n                p->parent->color = BLACK;\n                p->parent->parent->color = RED;\n                p = p->parent->parent;\t//æ¥ä¸‹æ¥å¾ªç¯çœ‹ä»–çˆ·çˆ·çš„åŒäº²æ˜¯ä¸æ˜¯çº¢\n            }\n            else\n            {\n                if(p->parent->leftchild == p)//åœ¨çˆ¶èŠ‚ç‚¹çš„å·¦è¾¹, éœ€è¦åŒæ—‹\n                {\n                    p = p->parent;       //å…³é”®ä¸€æ­¥, å·æ¢p, ä»¥ä¸ä¸‹é¢è¯­å¥ä¸²è”\n                    RotateRight(tree, p);//è¿™æ˜¯åŒæ—‹ç¬¬1æ­¥, ä¹‹åpè°ƒåˆ°å…¶çˆ¶èŠ‚ç‚¹çš„å³è¾¹äº†\n                }\n                //ä¸ç®¡ä¸Šé¢çš„æƒ…å†µ, åˆ°è¿™ä¸€æ­¥, pè‚¯å®šåœ¨çˆ¶èŠ‚ç‚¹çš„å³è¾¹, åªéœ€è¦å·¦æ—‹\n                p->parent->color = BLACK;\n                p->parent->parent->color = RED;\n                RotateLeft(tree, p->parent->parent);\n            }\n        }\n        else\n        {\n            _X = p->parent->parent->rightchild;\n            if(_X->color == RED)\n            {\n                \n            }\n            else //è¦æ—‹è½¬\n            {\n                \n            }\n        }\n        \n    }\n    tree->color = BLACK;\n}\n```\n\n","categories":["é«˜çº§æ•°æ®ç»“æ„","æ ‘"]},{"title":"å­¦ä¹ muduoåº“çš„æ€æƒ³","url":"/é¡¹ç›®-muduo/å­¦ä¹ muduoåº“çš„æ€æƒ³/","content":"# å†…å®¹\n\n1. é˜»å¡ã€éé˜»å¡ã€åŒæ­¥ã€å¼‚æ­¥\n2. äº”ç§IOæ¨¡å‹\n3. å¥½çš„ç½‘è·¯æœåŠ¡å™¨è®¾è®¡æ€è·¯\n4. Reactoræ¨¡å‹\n5. `select`/`poll`/`epoll`ã€`LT/ET`æ¨¡å¼å¯¹æ¯”\n6. muduoç½‘ç»œåº“ç¼–ç¨‹ç¯å¢ƒé…ç½®\n7. muduoç½‘ç»œåº“çš„å¤šçº¿ç¨‹æ¨¡å‹\n8. åŸºäºmuduoçš„æœåŠ¡å™¨ç¨‹åºå®ä¾‹\n9. muduoç½‘ç»œåº“æä¾›çš„ç±»\n10. muduoç½‘ç»œåº“ä¸­TcpServerç±»ä¸­çš„å›è°ƒç±»å‹\n11. ä»£ç ç¤ºä¾‹ChatServeråŠè¿è¡Œæµ‹è¯•ç»“æœ\n\n# é˜»å¡ã€éé˜»å¡ã€åŒæ­¥ã€å¼‚æ­¥\n\nç½‘ç»œIOé˜¶æ®µåˆ†ä¸ºä¸¤ä¸ªï¼šæ•°æ®å‡†å¤‡å’Œæ•°æ®è¯»å†™\n\n* æ•°æ®å‡†å¤‡--æ ¹æ®ç³»ç»ŸIOæ“ä½œçš„å°±ç»ªçŠ¶æ€\n    * é˜»å¡ï¼šè°ƒç”¨IOæ–¹æ³•çš„çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€\n    * éé˜»å¡ï¼šä¸ä¼šæ”¹å˜çº¿ç¨‹çš„çŠ¶æ€ï¼Œé€šè¿‡è¿”å›å€¼åˆ¤æ–­\n* æ•°æ®è¯»å†™ï¼ˆIOå±‚é¢çš„åŒæ­¥å’Œå¼‚æ­¥ï¼‰--æ ¹æ®åº”ç”¨ç¨‹åºå’Œå†…æ ¸çš„äº¤äº’æ–¹å¼\n    * åŒæ­¥ï¼šç”¨æˆ·çš„recvå®Œæˆäº†æ‰€æœ‰çš„åŠ¨ä½œï¼Œè€Œä¸”å› æ­¤é˜»å¡æˆ–è€…ç©ºè½¬ç­‰å¾…ã€‚æ•°æ®æ˜¯ç”¨æˆ·ä»TCPçš„æ¥æ”¶ç¼“å†²åŒºæ¬ç§»çš„ã€‚\n    * å¼‚æ­¥ï¼šåº”ç”¨ç¨‹åºæŠŠä»»åŠ¡äº¤ç»™æ“ä½œç³»ç»Ÿï¼Œè‡ªå·±å»åšåˆ«çš„äº‹æƒ…ï¼Œæ“ä½œç³»ç»Ÿå¤„ç†å®Œåï¼Œé€šçŸ¥ç”¨æˆ·å±‚â€œbufçš„æ•°æ®å·²ç»å‡†å¤‡å¥½äº†â€ã€‚å¯ä»¥é€šè¿‡sigioé€šçŸ¥æˆ–è€…å®ç°çº¦å®šçš„å›è°ƒæ–¹å¼é€šçŸ¥\n\n```c\nssize_t recv(int sockfd, void* buf, size_t len, int flags);\nint size = recv(sockfd, buf, 1024, 0);\t//recvé˜»å¡è‡³sockfdä¸Šæœ‰æ•°æ®å‡†å¤‡å¥½\n//å¦‚æœrecvçš„å±æ€§è®¾ç½®ä¸ºset non-blockï¼Œåˆ™å³ä½¿sockfdæ²¡æœ‰æ•°æ®ä¹Ÿä¼šè¿”å›ï¼Œcpuç©ºè½¬\n\n/*\n\tè¿”å›å€¼ï¼š\n\t\tsize == -1; # åŸå› å¯èƒ½ä¸º1.ç³»ç»Ÿå†…éƒ¨é”™è¯¯; 2.å½“å‰å¤„äºéé˜»å¡æ¨¡å¼ï¼Œæ— æ•°æ®\n\t\t\tè‹¥ errno == EAGAIN åˆ™è¯´æ˜ å½“å‰çš„é”™è¯¯æ˜¯å› ä¸ºå¤„äºéé˜»å¡æ¨¡å¼ã€‚\n\t\tsize == 0;\t# æ˜¯ç”±äºè¿œç«¯çš„æ­£å¸¸closeè€Œè¿”å›\n*/\n```\n\né™ˆç¡•ï¼š**ï¼ˆéï¼‰é˜»å¡å’Œå¼‚/åŒæ­¥IOçš„å…³ç³»ï¼šåœ¨å¤„ç†IOçš„æ—¶å€™ï¼Œé˜»å¡å’Œéé˜»å¡éƒ½æ˜¯åŒæ­¥IOï¼Œåªæœ‰ä½¿ç”¨äº†ç‰¹æ®Šçš„APIæ‰æ˜¯å¼‚æ­¥IOã€‚**\n![image-20220316211609059](../../images/å­¦ä¹ muduoåº“çš„æ€æƒ³/image-20220316211609059.png)\n\nå³ä½¿epollä¹Ÿæ˜¯åŒæ­¥çš„IOï¼Œè¿”å›å‘ç”Ÿäº‹ä»¶çš„eventï¼Œè¯»çš„æ—¶å€™éœ€è¦è°ƒç”¨recvï¼Œæ‰€ä»¥æ˜¯åŒæ­¥IOã€‚\n\n* ä¸šåŠ¡å±‚é¢çš„ä¸€ä¸ªé€»è¾‘å¤„ç†æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Ÿ\n    * åŒæ­¥ï¼šAæ“ä½œç­‰å¾…Bæ“ä½œå®Œæ¯•ï¼Œå¾—åˆ°è¿”å›å€¼ï¼Œç»§ç»­å¤„ç†\n    * å¼‚æ­¥ï¼šAæ“ä½œå‘Šè¯‰Bæ“ä½œå®ƒæ„Ÿå…´è¶£çš„äº‹ä»¶åŠé€šçŸ¥æ–¹å¼ï¼ŒAæ“ä½œç»§ç»­æ‰§è¡Œè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘äº†ï¼Œç­‰Bç›‘å¬åˆ°ç›¸åº”ã€‚\n\n## æ€»ç»“\n\n>ä¸€ä¸ªå…¸å‹çš„ç½‘ç»œIOæ¥å£è°ƒç”¨ï¼Œåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«æ˜¯â€œæ•°æ®å°±ç»ªâ€å’Œâ€œæ•°æ®è¯»å†™â€ï¼Œæ•°æ®å°±ç»ªé˜¶\n>æ®µåˆ†ä¸ºé˜»å¡å’Œéé˜»å¡ï¼Œè¡¨ç°å¾—ç»“æœå°±æ˜¯ï¼Œé˜»å¡å½“å‰çº¿ç¨‹æˆ–æ˜¯ç›´æ¥è¿”å›ã€‚\n>\n>åŒæ­¥è¡¨ç¤ºAå‘Bè¯·æ±‚è°ƒç”¨ä¸€ä¸ªç½‘ç»œIOæ¥å£æ—¶ï¼ˆæˆ–è€…è°ƒç”¨æŸä¸ªä¸šåŠ¡é€»è¾‘APIæ¥å£æ—¶ï¼‰ï¼Œæ•°æ®çš„è¯»å†™éƒ½\n>æ˜¯ç”±è¯·æ±‚æ–¹Aè‡ªå·±æ¥å®Œæˆçš„ï¼ˆä¸ç®¡æ˜¯é˜»å¡è¿˜æ˜¯éé˜»å¡ï¼‰ï¼›å¼‚æ­¥è¡¨ç¤ºAå‘Bè¯·æ±‚è°ƒç”¨ä¸€ä¸ªç½‘ç»œIOæ¥å£\n>æ—¶ï¼ˆæˆ–è€…è°ƒç”¨æŸä¸ªä¸šåŠ¡é€»è¾‘APIæ¥å£æ—¶ï¼‰ï¼Œå‘Bä¼ å…¥è¯·æ±‚çš„äº‹ä»¶ä»¥åŠäº‹ä»¶å‘ç”Ÿæ—¶é€šçŸ¥çš„æ–¹å¼ï¼ŒAå°±\n>å¯ä»¥å¤„ç†å…¶å®ƒé€»è¾‘äº†ï¼Œå½“Bç›‘å¬åˆ°äº‹ä»¶å¤„ç†å®Œæˆåï¼Œä¼šç”¨äº‹å…ˆçº¦å®šå¥½çš„é€šçŸ¥æ–¹å¼ï¼Œé€šçŸ¥Aå¤„ç†ç»“\n>æœã€‚\n\n# äº”ç§IOæ¨¡å‹\n\n* é˜»å¡ blocking\n* éé˜»å¡ non-blocking\n* IOå¤ç”¨ IO multiplexing\n* ä¿¡å·é©±åŠ¨ signal-driven\n* å¼‚æ­¥ asynchronous\n\n# å¥½çš„ç½‘ç»œæœåŠ¡å™¨è®¾è®¡\n\nåœ¨è¿™ä¸ªå¤šæ ¸æ—¶ä»£ï¼ŒæœåŠ¡ç«¯ç½‘ç»œç¼–ç¨‹å¦‚ä½•é€‰æ‹©çº¿ç¨‹æ¨¡å‹ï¼Ÿlibeventä½œè€…çš„è§‚ç‚¹ï¼š**one loop(äº‹ä»¶å¾ªç¯, ä¸€èˆ¬ç”¨IOå¤ç”¨ä½œä¸ºäº‹ä»¶åˆ†å‘å™¨) per thread** is usually a good model. å¤šçº¿ç¨‹æœåŠ¡ç«¯ç¼–ç¨‹çš„é—®é¢˜å°±è½¬æ¢ä¸ºå¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜æ•ˆä¸”æ˜“ç”¨çš„event loopï¼Œç„¶åæ¯ä¸ªçº¿ç¨‹runä¸€ä¸ªevent loopå°±è¡Œäº†ã€å³muduoåº“çš„æ€æƒ³ã€‘ï¼ˆå½“ç„¶çº¿ç¨‹é—´çš„åŒæ­¥ã€äº’æ–¥å°‘ä¸äº†ï¼Œè¿˜æœ‰å…¶ä»–çš„è€—æ—¶äº‹ä»¶éœ€è¦èµ·å¦å¤–çš„çº¿ç¨‹æ¥åšï¼‰ã€‚\n\n* event loopæ˜¯non-blockingç½‘ç»œç¼–ç¨‹çš„æ ¸å¿ƒï¼Œåœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œnon-blockingå‡ ä¹æ€»æ˜¯å’ŒIO-multiplexingä¸€èµ·ä½¿ç”¨ï¼ŒåŸå› æœ‰äºŒï¼š\n    * **ä¸è¦å•ç‹¬ä½¿ç”¨éé˜»å¡IO**ï¼šæ²¡æœ‰äººçœŸçš„ä¼šç”¨è½®è¯¢(busy-polling)æ¥æ£€æŸ¥æŸä¸ªnon-blocking IOæ“ä½œæ˜¯å¦å®Œæˆï¼Œå¤ªæµªè´¹CPUèµ„æº\n    * **ä¸è¦å•ç‹¬ä½¿ç”¨IOå¤ç”¨**ï¼ˆæ¯”å¦‚é˜»å¡çš„IOå¤ç”¨ï¼‰ï¼šIO multiplexingä¸€èˆ¬ä¸èƒ½å’Œblocking IOç”¨åœ¨ä¸€èµ·ï¼Œå› ä¸ºblocking IOä¸­read()/write()/accept()/connect()éƒ½æœ‰å¯èƒ½é˜»å¡å½“å‰çº¿ç¨‹ï¼Œè¿™æ ·çº¿ç¨‹å°±æ²¡åŠæ³•å¤„ç†å…¶ä»–socketä¸Šçš„IOæ“ä½œäº†\n    * æ‰€ä»¥å½“æˆ‘ä»¬æåˆ°non-blockingçš„æ—¶å€™ï¼Œå®é™…ä¸ŠæŒ‡çš„æ˜¯non-blocking + IO multiplexingï¼Œå•ç”¨å…¶ä¸­ä»»ä½•ä¸€ä¸ªéƒ½æ²¡æœ‰åŠæ³•å¾ˆå¥½åœ°å®ç°åŠŸèƒ½ã€‚\n    * ç»“è®ºï¼šepoll + éé˜»å¡IO + çº¿ç¨‹æ± (çº¿ç¨‹çš„æ•°ç›®ä¸€èˆ¬å¯¹åº”ç”µè„‘çš„CPUæ ¸æ•°)\n\n> nginxä½¿ç”¨çš„æ˜¯epoll + forkï¼Œæ˜¯ä¸æ˜¯ä¸å¦‚epoll + pthreadï¼Ÿ\n\nnginxé‡‡ç”¨äº†epoll+forkæ¨¡å‹ä½œä¸ºç½‘ç»œæ¨¡å—çš„æ¶æ„è®¾è®¡ï¼Œå®ç°äº†ç®€å•å¥½ç”¨çš„è´Ÿè½½ç®—æ³•ï¼Œä½¿å„ä¸ªforkç½‘ç»œè¿›ç¨‹ä¸ä¼šå¿™çš„è¶Šå¿™ã€é—²çš„è¶Šé—²ï¼Œå¹¶ä¸”**é€šè¿‡ä¸€æŠŠä¹è§‚é”è§£å†³äº†è¯¥æ¨¡å‹å¯¼è‡´çš„æœåŠ¡å™¨æƒŠç¾¤**ç°è±¡ï¼ŒåŠŸèƒ½ååˆ†å¼ºå¤§ã€‚\n\n# Reactoræ¨¡å‹\n\nmuduoåº“å’Œlibeventåº“éƒ½æ˜¯â€œåŸºäºäº‹ä»¶é©±åŠ¨çš„Reactoræ¨¡å‹â€ã€‚\n\nWikipediaç»™å‡ºçš„Reactor Design Patternçš„è§£é‡Šï¼š\n\n> The Reactor design pattern is an **event handling pattern** for handling service **requests delivered concurrently** ~~to a service handler~~ by one or more inputs. The service handler then **demultiplexes the incoming requests** and **dispatchers them synchronously** to the associated request handlers.\n\nGoogle Translate:\n\n>Reactor è®¾è®¡æ¨¡å¼æ˜¯ä¸€ç§äº‹ä»¶å¤„ç†æ¨¡å¼ï¼Œç”¨äºå¤„ç†é€šè¿‡ä¸€ä¸ªæˆ–å¤šä¸ªè¾“å…¥åŒæ—¶äº¤ä»˜ç»™æœåŠ¡å¤„ç†ç¨‹åºçš„æœåŠ¡è¯·æ±‚ã€‚ ç„¶åï¼ŒæœåŠ¡å¤„ç†ç¨‹åºå¯¹ä¼ å…¥çš„è¯·æ±‚è¿›è¡Œå¤šè·¯åˆ†è§£ï¼Œå¹¶å°†å®ƒä»¬åŒæ­¥åˆ†é…ç»™ç›¸å…³è”çš„è¯·æ±‚å¤„ç†ç¨‹åºã€‚\n\n* Reactorå››ä¸ªé‡è¦ç»„ä»¶\n  * Eventäº‹ä»¶\n  * Reactorååº”å †\n  * Demultiplexäº‹ä»¶åˆ†å‘å™¨\n  * EventHandleräº‹ä»¶å¤„ç†å™¨\n\n```mermaid\n%%æ—¶åºå›¾ä¾‹å­\nsequenceDiagram\n\tparticipant Event\n\tparticipant Reactor\n\tparticipant Demultiplex\n\tparticipant EventHandler\n\tEvent ->> Reactor: æ³¨å†ŒEventå’ŒHandler\n\tloop äº‹ä»¶é›†åˆ\n\t\tReactor -> Reactor:Eventé›†åˆ\n\tend\n\tReactor ->> Demultiplex: å‘Epoll add/mod/del Event\n\tReactor ->> Demultiplex: å¯åŠ¨ååº”å †\n    loop äº‹ä»¶åˆ†å‘å™¨\n    \tDemultiplex -> Demultiplex:å¼€å¯äº‹ä»¶å¾ªç¯epoll_wait\n    end\n    Demultiplex ->> Reactor: è¿”å›å‘ç”Ÿäº‹ä»¶çš„Event\n    Reactor ->> EventHandler: è°ƒç”¨Eventå¯¹åº”çš„äº‹ä»¶å¤„ç†å™¨EventHandler\n```\n\n# epoll\n\n## selectå’Œpollçš„ç¼ºç‚¹\n\n* selectçš„ç¼ºç‚¹ï¼š\n    * å•ä¸ªè¿›ç¨‹èƒ½å¤Ÿç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡å­˜åœ¨æœ€å¤§é™åˆ¶ï¼Œé€šå¸¸æ˜¯1024ï¼ˆå¯æ›´æ”¹ï¼š`#define __FD_SETSIZE 1024`ï¼‰ï¼Œä½†ç”±äºselecté‡‡ç”¨è½®è¯¢çš„æ–¹å¼æ‰«ææ–‡ä»¶æè¿°ç¬¦ï¼Œåˆ™æ–‡ä»¶æè¿°ç¬¦æ•°é‡è¶Šå¤šï¼Œæ€§èƒ½å°±è¶Šå·®ã€‚\n    * å†…æ ¸/ç”¨æˆ·ç©ºé—´å†…å­˜æ‹·è´é—®é¢˜ï¼Œselectéœ€è¦å¤åˆ¶å¤§é‡çš„å¥æŸ„æ•°æ®ç»“æ„ï¼Œäº§ç”Ÿå·¨å¤§çš„å¼€é”€\n    * selectè¿”å›çš„æ˜¯å«æœ‰æ•´ä¸ªå¥æŸ„çš„æ•°ç»„ï¼Œåº”ç”¨ç¨‹åºéœ€è¦éå†æ•´ä¸ªæ•°ç»„æ‰èƒ½å‘ç°å“ªäº›å¥æŸ„å‘ç”Ÿäº†äº‹ä»¶\n    * selectçš„è§¦å‘æ–¹å¼æ˜¯æ°´å¹³è§¦å‘ï¼Œåº”ç”¨ç¨‹åºå¦‚æœæ²¡æœ‰å®Œæˆå¯¹ä¸€ä¸ªå·²ç»å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦è¿›è¡ŒIOæ“ä½œï¼Œé‚£ä¹ˆä¹‹åæ¯æ¬¡selectè°ƒç”¨è¿˜æ˜¯ä¼šå°†è¿™äº›æ–‡ä»¶æè¿°ç¬¦é€šçŸ¥è¿›ç¨‹ï¼ˆæ„æ€å°±æ˜¯ä¸€ä»¶äº‹æƒ…å¤„ç†å¾—å¤ªæ‹–æ²“ï¼Œæ‹–å»¶å¥½å‡ æ¬¡æ‰å®Œæˆï¼Œå½±å“æ•ˆç‡ï¼‰ã€‚å…¶å®epollçš„LTæ¨¡å¼ä¹Ÿæ˜¯è¿™æ ·ã€‚ä½†æ˜¯ETæ¨¡å¼æ•ˆç‡ä¸ä¸€å®šæ¯”LTå¥½ã€‚\n* poll\n    * ç›¸æ¯”selectæ¨¡å‹ï¼Œpollä½¿ç”¨é“¾è¡¨ä¿å­˜æ–‡ä»¶æè¿°ç¬¦ï¼Œå› æ­¤æ²¡æœ‰äº†ç›‘è§†æ–‡ä»¶æ•°é‡çš„é™åˆ¶ï¼Œä½†å…¶ä»–ä¸‰ä¸ªç¼ºç‚¹ä¾ç„¶å­˜åœ¨ã€‚\n\n>ä»¥selectæ¨¡å‹ä¸ºä¾‹ï¼Œå‡è®¾æˆ‘ä»¬çš„æœåŠ¡å™¨éœ€è¦æ”¯æŒ100ä¸‡çš„å¹¶å‘è¿æ¥ï¼Œåˆ™åœ¨__FD_SETSIZE ä¸º1024çš„æƒ…å†µä¸‹ï¼Œåˆ™æˆ‘ä»¬è‡³å°‘éœ€è¦å¼€è¾Ÿ1kä¸ªè¿›ç¨‹æ‰èƒ½å®ç°100ä¸‡çš„å¹¶å‘è¿æ¥ã€‚é™¤äº†è¿›ç¨‹é—´ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ—¶é—´æ¶ˆè€—å¤–ï¼Œä»å†…æ ¸/ç”¨æˆ·ç©ºé—´å¤§é‡çš„å¥æŸ„ç»“æ„å†…å­˜æ‹·è´ã€æ•°ç»„è½®è¯¢ç­‰ï¼Œæ˜¯ç³»ç»Ÿéš¾ä»¥æ‰¿å—çš„ã€‚å› æ­¤ï¼ŒåŸºäºselectæ¨¡å‹çš„æœåŠ¡å™¨ç¨‹åºï¼Œè¦è¾¾åˆ°100ä¸‡çº§åˆ«çš„å¹¶å‘è®¿é—®ï¼Œæ˜¯ä¸€ä¸ªå¾ˆéš¾å®Œæˆçš„ä»»åŠ¡ã€‚\n\n## epollåŸç†åŠä¼˜åŠ¿\n\nepollçš„å®ç°æœºåˆ¶ä¸select/pollæœºåˆ¶å®Œå…¨ä¸åŒã€‚\n\nepollé€šè¿‡åœ¨Linuxå†…æ ¸ä¸­ç”³è¯·ä¸€ä¸ªç®€æ˜“çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæå‡äº†æ•ˆç‡ã€‚\n\n> æ–‡ä»¶ç³»ç»Ÿä¸€èˆ¬ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„å®ç°â€”â€”B+æ ‘ï¼Œç£ç›˜IOæ¶ˆè€—ä½ã€æ•ˆç‡å¾ˆé«˜ã€‚\n\næŠŠåŸå…ˆçš„select/pollè°ƒç”¨åˆ†æˆä»¥ä¸‹3ä¸ªéƒ¨åˆ†ï¼š\n\n1. è°ƒç”¨`epoll_create()`å»ºç«‹ä¸€ä¸ª`epollå¯¹è±¡`ï¼ˆåœ¨`epollæ–‡ä»¶ç³»ç»Ÿ`ä¸­ä¸ºè¿™ä¸ª`å¥æŸ„å¯¹è±¡`åˆ†é…èµ„æºï¼‰\n\n   * `epoll_create`åœ¨å†…æ ¸ä¸Šåˆ›å»ºçš„`eventpoll`ç»“æ„å¦‚ä¸‹ï¼š\n\n     ```c++\n     struct eventpoll\n     {\n         //...\n         /* çº¢é»‘æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œè¿™æ£µæ ‘ä¸­å­˜å‚¨ç€æ‰€æœ‰æ·»åŠ åˆ°epollä¸­çš„éœ€è¦ç›‘æ§çš„äº‹ä»¶*/\n         struct rb_root rbr;\n         /* åŒé“¾è¡¨ä¸­åˆ™å­˜æ”¾ç€å°†è¦é€šè¿‡epoll_waitè¿”å›ç»™ç”¨æˆ·çš„æ»¡è¶³æ¡ä»¶çš„äº‹ä»¶*/\n         struct list_head rdlist;\n         //...\n     }\n     ```\n\n     \n\n2. è°ƒç”¨`epoll_ctl`å‘`epoll`å¯¹è±¡ä¸­æ·»åŠ è¿™100ä¸‡ä¸ªè¿æ¥çš„å¥—æ¥å­—\n\n3. è°ƒç”¨`epoll_wait`æ”¶é›†å‘ç”Ÿçš„äº‹ä»¶çš„`fd`èµ„æº\n\n> å¦‚æ­¤ä¸€æ¥ï¼Œè¦å®ç°ä¸Šé¢è¯´çš„åœºæ™¯ï¼Œåªéœ€åœ¨è¿›ç¨‹å¯åŠ¨æ—¶å»ºç«‹ä¸€ä¸ª`epollå¯¹è±¡`ï¼Œç„¶ååœ¨éœ€è¦æ—¶åƒè¿™ä¸ª`epollå¯¹è±¡`ä¸­æ·»åŠ æˆ–è€…åˆ é™¤äº‹ä»¶ã€‚åŒæ—¶`epoll_wait`æ—¶ï¼Œå¹¶æ²¡æœ‰å‘æ“ä½œç³»ç»Ÿå¤åˆ¶è¿™100ä¸‡ä¸ªè¿æ¥çš„å¥æŸ„æ•°æ®ï¼Œå†…æ ¸ä¹Ÿä¸éœ€è¦å»éå†å…¨éƒ¨çš„äº‹ä»¶ã€‚\n\n* LTæ¨¡å¼ï¼Œmuduoé‡‡ç”¨çš„æ˜¯LTæ¨¡å¼\n    * ç‰¹ç‚¹ï¼šå†…æ ¸æ•°æ®æ²¡è¢«è¯»å®Œï¼Œå°±ä¼šä¸€ç›´ä¸ŠæŠ¥æ•°æ®\n    * ä¸ä¼šä¸¢å¤±æ•°æ®æˆ–è€…æ¶ˆæ¯\n        * åº”ç”¨æ²¡æœ‰è¯»å–å®Œæ•°æ®ï¼Œå†…æ ¸ä¼šä¸æ–­ä¸ŠæŠ¥\n    * ä½å»¶è¿Ÿå¤„ç†\n        * æ¯æ¬¡è¯»æ•°æ®åªéœ€è¦ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼Œç…§é¡¾äº†å¤šä¸ªè¿æ¥çš„å…¬å¹³æ€§ï¼Œä¸ä¼šå› ä¸ºæŸä¸ªè¿æ¥ä¸Šçš„æ•°æ®é‡è¿‡å¤§è€Œå½±å“å…¶ä»–è¿æ¥å¤„ç†æ¶ˆæ¯\n    * è·¨å¹³å°å¤„ç†\n        * åƒselectä¸€æ ·å¯ä»¥è·¨å¹³å°ä½¿ç”¨\n* ETæ¨¡å¼\n    * ç‰¹ç‚¹ï¼šå†…æ ¸æ•°æ®åªä¸ŠæŠ¥ä¸€æ¬¡ï¼Œæ•ˆç‡ç›¸å¯¹è¾ƒé«˜\n\n# muduoç½‘ç»œåº“ç¼–ç¨‹å‡†å¤‡\n\n## å¼€å‘ç¯å¢ƒ\n\n1. ubuntu linux\n2. å®‰è£…jsonå¼€å‘åº“\n3. å®‰è£…boost + muduoç½‘ç»œåº“å¼€å‘ç¯å¢ƒ[muduoåº“æºç ç¼–è¯‘å®‰è£…](https://blog.csdn.net/QIANGWEIYUAN/article/details/89023980)\n4. å®‰è£…redisç¯å¢ƒ\n5. å®‰è£…mysqlæ•°æ®åº“ç¯å¢ƒ\n6. å®‰è£…nginx\n7. å®‰è£…cmakeç¯å¢ƒ\n\n* é…ç½®è¿œç¨‹å¼€å‘ç¯å¢ƒ\n  * [windows+vscodeé…ç½®è¿œç¨‹linuxå¼€å‘ç¯å¢ƒ](https://blog.csdn.net/qq756684177/article/details/94236990)\n    1. linuxç³»ç»Ÿè¿è¡ŒsshdæœåŠ¡\n    2. åœ¨vscodeä¸Šå®‰è£…Remote Developmentæ’ä»¶ï¼Œå…¶ä¾èµ–æ’ä»¶ä¼šè‡ªåŠ¨å®‰è£…\n  * [VSç¯å¢ƒåˆ›å»ºè¿œç¨‹linuxè·¨å¹³å°é¡¹ç›®](https://blog.csdn.net/QIANGWEIYUAN/article/details/89469717)\n  * vscodeåœ¨linuxç¯å¢ƒä¸‹ç›´æ¥å¼€å‘\n## å®‰è£…æµç¨‹\n1. muduoåº“æ˜¯åŸºäºboostå¼€å‘çš„ï¼Œæ‰€ä»¥éœ€è¦å…ˆåœ¨Linuxå¹³å°ä¸Šå®‰è£…booståº“ã€‚éœ€è¦æ³¨æ„ï¼Œbooståº“çš„ç¼–è¯‘éœ€è¦å®‰è£…gccã€makeç­‰åŸºç¡€å·¥å…·æ‰è¡Œã€‚ç¯å¢ƒï¼šUbuntu 20.04.6ï¼Œå¤ªæ–°çš„Ubuntuç”±äºæ— æ³•å…¼å®¹æ—§ä»£ç ï¼Œä¸èƒ½å®‰è£…ã€‚\n    1. `tar -xzvf boost_1_69_0.tar.gz`è§£å‹\n    2. æ‰§è¡Œ`./bootstrap.sh`ï¼šä¹Ÿå¯ä»¥åœ¨åé¢åŠ `--prefix=/usr/local`æŒ‡å®šå®‰è£…ç›®å½•ï¼ˆé»˜è®¤è·¯å¾„ï¼‰\n    3. `./b2`å®‰è£…ï¼ˆå¦‚æœLinuxç³»ç»Ÿæ²¡æœ‰å®‰è£…g++ç¼–è¯‘å™¨ï¼Œéœ€è¦å…ˆå®‰è£…ï¼‰\n    4. æœ€åï¼Œå†æŠŠä¸Šé¢çš„booståº“å¤´æ–‡ä»¶å’Œlibåº“æ–‡ä»¶å®‰è£…åœ¨é»˜è®¤çš„Linuxç³»ç»Ÿå¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶çš„æœç´¢è·¯å¾„ä¸‹ï¼Œè¿è¡Œä¸‹é¢å‘½ä»¤ï¼ˆå› ä¸ºè¦ç»™/usrç›®å½•ä¸‹æ‹·è´æ–‡ä»¶ï¼Œéœ€è¦å…ˆè¿›å…¥rootç”¨æˆ·ï¼‰ï¼š`sudo ./b2 install`\n    5. sudo ldconfigâ€‹æ›´æ–°é“¾æ¥åº“ç¼“å­˜\n    6. éªŒè¯å®‰è£…boostæ˜¯å¦æˆåŠŸï¼Œé€šè¿‡ä¸‹é¢çš„ä»£ç éªŒè¯ä¸€ä¸‹ï¼š\n\n       ```cpp\n#include <iostream>\n#include <boost/bind.hpp>\n#include <string>\nusing namespace std;\n\nclass Hello\n{\npublic:\n\tvoid say(string name) \n\t{ cout << name << \" say: hello world!\" << endl; }\n};\n\nint main()\n{\n\tHello h;\n\tauto func = boost::bind(&Hello::say, &h, \"zhang san\");\n\tfunc();\n\treturn 0;\n}//è¿è¡Œç»“æœzhang san say: hello world!\n```\n2. `unzip muduo-master.zip`\n3. `cd muduo-master`\n4. muduoåº“æºç ç¼–è¯‘ä¼šç¼–è¯‘å¾ˆå¤š`unit_test`æµ‹è¯•ç”¨ä¾‹ä»£ç ï¼Œç¼–è¯‘è€—æ—¶é•¿ï¼Œæˆ‘ä»¬ç”¨ä¸åˆ°ï¼Œvimç¼–è¾‘ä¸Šé¢æºç ç›®å½•é‡Œé¢çš„`CMakeLists.txt`æ–‡ä»¶ï¼Œå¦‚ä¸‹ä¿®æ”¹ï¼š\n\n![](../../images/å­¦ä¹ muduoåº“çš„æ€æƒ³/image-20250712185725471.png)\n7. `./build.sh`æºç ç¼–è¯‘æ„å»ºç¨‹åºï¼Œè¿è¡Œè¯¥ç¨‹åºï¼ˆæ³¨æ„ï¼šmuduoæ˜¯ç”¨cmakeæ¥æ„å»ºçš„ï¼Œéœ€è¦å…ˆå®‰è£…cmakeï¼Œubuntuä¸‹`sudo apt-get install cmake`å°±å¯ä»¥ï¼Œredhatæˆ–è€…centoså¯ä»¥ä»yumä»“åº“å®‰è£…ï¼‰\n8. ç¼–è¯‘å®Œæˆåï¼Œè¾“å…¥`./build.sh install`å‘½ä»¤è¿›è¡Œmuduoåº“å®‰è£…ã€‚ä½†è¿™ä¸ª`./build.sh install`å®é™…ä¸ŠæŠŠmuduoçš„å¤´æ–‡ä»¶å’Œlibåº“æ–‡ä»¶æ”¾åˆ°äº†`muduo-master`åŒçº§ç›®å½•ä¸‹çš„`build`ç›®å½•ä¸‹çš„`release-install-cpp11`æ–‡ä»¶å¤¹ä¸‹é¢äº†\n\n   ```bash\nroot@tony-virtual-machine:/home/tony/package# ls\nbuild  muduo-master  muduo-master.zip\nroot@tony-virtual-machine:/home/tony/package# cd build/\nroot@tony-virtual-machine:/home/tony/package/build# ls\nrelease-cpp11  release-install-cpp11\nroot@tony-virtual-machine:/home/tony/package/build# cd release-install-cpp11/\nroot@tony-virtual-machine:/home/tony/package/build/release-install-cpp11# ls\ninclude  lib\n   ```\n   æ‰€ä»¥ä¸Šé¢çš„installå‘½ä»¤å¹¶æ²¡æœ‰æŠŠå®ƒä»¬æ‹·è´åˆ°ç³»ç»Ÿè·¯å¾„ä¸‹ï¼Œå¯¼è‡´æˆ‘ä»¬æ¯æ¬¡ç¼–è¯‘ç¨‹åºéƒ½éœ€è¦æŒ‡å®šmuduoåº“çš„å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶è·¯å¾„ï¼Œå¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©ç›´æ¥æŠŠinlcudeï¼ˆå¤´æ–‡ä»¶ï¼‰å’Œlibï¼ˆåº“æ–‡ä»¶ï¼‰ç›®å½•ä¸‹çš„æ–‡ä»¶æ‹·è´åˆ°ç³»ç»Ÿç›®å½•ä¸‹ï¼ˆéœ€è¦sudoï¼‰ï¼š\n   ```bash\nroot@tony-virtual-machine:/home/tony/package/build/release-install-cpp11# ls\ninclude  lib\nroot@tony-virtual-machine:/home/tony/package/build/release-install-cpp11# cd include/\nroot@tony-virtual-machine:/home/tony/package/build/release-install-cpp11/include# ls\nmuduo\nroot@tony-virtual-machine:/home/tony/package/build/release-install-cpp11/include# mv muduo/ /usr/include/\nroot@tony-virtual-machine:/home/tony/package/build/release-install-cpp11/include# cd ..\nroot@tony-virtual-machine:/home/tony/package/build/release-install-cpp11# ls\ninclude  lib\nroot@tony-virtual-machine:/home/tony/package/build/release-install-cpp11# cd lib/\nroot@tony-virtual-machine:/home/tony/package/build/release-install-cpp11/lib# ls\nlibmuduo_base.a  libmuduo_http.a  libmuduo_inspect.a  libmuduo_net.a\nroot@tony-virtual-machine:/home/tony/package/build/release-install-cpp11/lib# mv * /usr/local/lib/\nroot@tony-virtual-machine:/home/tony/package/build/release-install-cpp11/lib# \n   ```\n   æ‹·è´å®Œæˆä»¥åä½¿ç”¨muduoåº“ç¼–å†™`C++`ç½‘ç»œç¨‹åºï¼Œä¸ç”¨åœ¨æŒ‡å®šå¤´æ–‡ä»¶å’Œlibåº“æ–‡ä»¶è·¯å¾„ä¿¡æ¯äº†ï¼Œå› ä¸º`g++`ä¼šè‡ªåŠ¨ä»`/usr/include`å’Œ`/usr/local/lib`è·¯å¾„ä¸‹å¯»æ‰¾æ‰€éœ€è¦çš„æ–‡ä»¶ã€‚\n## æµ‹è¯•ä»£ç \næµ‹è¯•muduoæ˜¯å¦èƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨ï¼Œç¼–å†™ä¸€ä¸ªç®€å•çš„echoå›æ˜¾æœåŠ¡å™¨ï¼Œå¦‚ä¸‹ï¼š\n```cpp\n#include <muduo/net/TcpServer.h>\n#include <muduo/base/Logging.h>\n#include <boost/bind.hpp>\n#include <muduo/net/EventLoop.h>\n\n// ä½¿ç”¨muduoå¼€å‘å›æ˜¾æœåŠ¡å™¨\nclass EchoServer\n{\n public:\n  EchoServer(muduo::net::EventLoop* loop,\n             const muduo::net::InetAddress& listenAddr);\n\n  void start(); \n\n private:\n  void onConnection(const muduo::net::TcpConnectionPtr& conn);\n\n  void onMessage(const muduo::net::TcpConnectionPtr& conn,\n                 muduo::net::Buffer* buf,\n                 muduo::Timestamp time);\n\n  muduo::net::TcpServer server_;\n};\n\nEchoServer::EchoServer(muduo::net::EventLoop* loop,\n                       const muduo::net::InetAddress& listenAddr)\n  : server_(loop, listenAddr, \"EchoServer\")\n{\n  server_.setConnectionCallback(\n      boost::bind(&EchoServer::onConnection, this, _1));\n  server_.setMessageCallback(\n      boost::bind(&EchoServer::onMessage, this, _1, _2, _3));\n}\n\nvoid EchoServer::start()\n{\n  server_.start();\n}\n\nvoid EchoServer::onConnection(const muduo::net::TcpConnectionPtr& conn)\n{\n  LOG_INFO << \"EchoServer - \" << conn->peerAddress().toIpPort() << \" -> \"\n           << conn->localAddress().toIpPort() << \" is \"\n           << (conn->connected() ? \"UP\" : \"DOWN\");\n}\n\nvoid EchoServer::onMessage(const muduo::net::TcpConnectionPtr& conn,\n                           muduo::net::Buffer* buf,\n                           muduo::Timestamp time)\n{\n  // æ¥æ”¶åˆ°æ‰€æœ‰çš„æ¶ˆæ¯ï¼Œç„¶åå›æ˜¾\n  muduo::string msg(buf->retrieveAllAsString());\n  LOG_INFO << conn->name() << \" echo \" << msg.size() << \" bytes, \"\n           << \"data received at \" << time.toString();\n  conn->send(msg);\n}\n\n\nint main()\n{\n  LOG_INFO << \"pid = \" << getpid();\n  muduo::net::EventLoop loop;\n  muduo::net::InetAddress listenAddr(8888);\n  EchoServer server(&loop, listenAddr);\n  server.start();\n  loop.loop();\n}\n```\n\nä½¿ç”¨g++è¿›è¡Œç¼–è¯‘ï¼Œæ³¨æ„é“¾æ¥muduoå’Œpthreadçš„åº“æ–‡ä»¶ï¼Œç¼–è¯‘å‘½ä»¤å¦‚ä¸‹ï¼š\n```bash\ng++ main.cpp -lmuduo_net -lmuduo_base -lpthread -std=c++11\n```\nç¼–è¯‘é“¾æ¥å®Œæˆï¼Œç”Ÿæˆa.outå¯æ‰§è¡Œç¨‹åºï¼Œä¸Šé¢çš„echoæœåŠ¡å™¨ç›‘å¬8888ç«¯å£ï¼Œè¿è¡Œä¸Šé¢çš„a.outå›æ˜¾æœåŠ¡å™¨å¦‚ä¸‹ï¼š\n```bash\nroot@tony-virtual-machine:/home/tony/code# ./a.out \n20190404 08:00:15.254790Z 42660 INFO  pid = 42660 - main.cpp:61\n```\nç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ï¼Œå¯ä»¥æ‰“å¼€ä¸€ä¸ªæ–°çš„shellå‘½ä»¤è¡Œç”¨netcatå‘½ä»¤æ¨¡æ‹Ÿå®¢æˆ·ç«¯è¿æ¥echoæœåŠ¡å™¨è¿›è¡ŒåŠŸèƒ½æµ‹è¯•ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š\n```bash\ntony@tony-virtual-machine:~$ echo \"hello world\" | nc localhost 8888\n\nhello world #å®¢æˆ·ç«¯æ•°æ®å›æ˜¾\n```\nå®¢æˆ·ç«¯æ•°æ®å›æ˜¾æ­£ç¡®ï¼Œçœ‹çœ‹æœåŠ¡å™¨æ¥æ—¥å¿—ä¿¡æ¯æ‰“å°å¦‚ä¸‹ï¼š\n```bash\nroot@tony-virtual-machine:/home/tony/code# ./a.out \n20190404 08:00:15.254790Z 42660 INFO  pid = 42660 - main.cpp:61\n20190404 08:00:59.438626Z 42660 INFO  TcpServer::newConnection [EchoServer] - new connection [EchoServer-0.0.0.0:8888#1] from 127.0.0.1:33480 - TcpServer.cc:80\n20190404 08:00:59.438707Z 42660 INFO  EchoServer - 127.0.0.1:33480 -> 127.0.0.1:8888 is UP - main.cpp:42\n20190404 08:00:59.438812Z 42660 INFO  EchoServer-0.0.0.0:8888#1 echo 12 bytes, data received at 1554364859.438723 - main.cpp:53\n```\nåˆ°æ­¤ï¼Œmuduoå®‰è£…æˆåŠŸï¼Œèƒ½å¤Ÿæ­£å¸¸è¿›è¡ŒC++ç½‘ç»œç¨‹åºå¼€å‘ï¼\n## é…ç½®é“¾æ¥åº“ã€å¤´æ–‡ä»¶\n\nmuduoåº“çš„ä½¿ç”¨éœ€è¦é“¾æ¥`lib`åº“æ–‡ä»¶ï¼Œä¸€èˆ¬ä¸º`.so`æ–‡ä»¶ã€‚ä¸€èˆ¬`.so`æ–‡ä»¶éƒ½åœ¨`/usr/libæˆ–/usr/local/lib`è·¯å¾„ä¸‹ã€‚\n\nç¼–è¯‘é“¾æ¥ä½¿ç”¨muduoåº“çš„ç¨‹åºéœ€è¦åŠ åç¼€`-l ...`\n\n```bash\n# /usr/lib or /usr/local/lib\n# 3 lib: libmuduo_base.so; libmuduo_net.so; libpthread.so\n-lmuduo_net -lmuduo_base -lpthread\n# æ³¨æ„é¡ºåºï¼Œnetéœ€è¦å†™åœ¨å‰é¢ï¼Œå› ä¸ºnetä¾èµ–baseï¼›baseå†™ä¸­é—´ï¼Œå› ä¸ºä¾èµ–phtread\n```\n\n### å¦‚ä½•åœ¨vscodeé…ç½®è¿™ä¸‰ä¸ªåº“ï¼Ÿ\n\nvscodeä¸­æŒ‰`F1`é”®ï¼Œæœç´¢`edit configurations`ï¼Œå°†ä¼šæ‰“å¼€ï¼š\n\né¡¹ç›®ç›®å½•ä¸‹çš„`.vscode`æ–‡ä»¶å¤¹ä¸‹çš„`c_cpp_properties.json`\n\n```json\n{\n    \"configurations\": [\n        {\n            \"name\": \"Linux\",\n            \"includePath\": [\n                \"${workspaceFolder}/**\"\n            ],\n            \"defines\": [],\n            \"compilerPath\": \"/usr/bin/gcc\",\n            \"cStandard\": \"c17\",\n            \"cppStandard\": \"c++20\",\n            \"intelliSenseMode\": \"linux-gcc-x64\"\n        }\n    ],\n    \"version\": 4\n}\n```\n\nbuildæ„å»ºé¡¹ç›®çš„å¿«æ·é”®æ˜¯`ctrl+shift+B`é”®ï¼Œä½†è‹¥ä½ æ²¡æœ‰é…ç½®è¿‡buildæµç¨‹ï¼Œå°†ä¼šå¼¹å‡ºé€‰é¡¹è®©ä½ é…ç½®ã€‚å®é™…ä¸Šå°±æ˜¯è®©ä½ é…ç½®`.vscode`ä¸‹çš„`tasks.json`ã€‚\n\n> é™¤äº†ä¸Šé¢è¿™ä¸¤ä¸ªjsonæ–‡ä»¶ï¼Œvscodeä¸‹çš„cppé¡¹ç›®ä¸­è¿˜æœ‰ä¸€ä¸ªjsoné…ç½®æ–‡ä»¶æ˜¯launch.jsonï¼Œæ˜¯å…³äºè°ƒè¯•çš„é…ç½®ä¿¡æ¯ã€‚\n\n```json\n{\n    // See https://go.microsoft.com/fwlink/?LinkId=733558\n    // for the documentation about the tasks.json format\n    \"version\": \"2.0.0\",\n    \"tasks\": [\n        {\n            \"type\": \"shell\",\n            \"label\": \"build\",\n            \"command\": \"/usr/bin/g++\",\n            \"args\": [\n                \"-g\",\n                \"${file}\",\n                \"-o\",\n                \"${fileDirname}/${fileBasenameNoExtension}\",\n            ],\n            \"options\": {\n                \"cwd\": \"/usr/bin\"\n            },\n            \"problemMatcher\": [\n                \"$gcc\"\n            ],\n            \"group\": \"build\"\n        }\n    ]\n}\n```\n\nå…¶ä¸­ï¼Œ`args`é”®å°±æ˜¯buildæ—¶ç¼–è¯‘é“¾æ¥å‘½ä»¤åé¢åŠ çš„å‚æ•°ã€‚\n\næˆ‘ä»¬åœ¨æ­¤ä½¿ç”¨muduoåº“ï¼Œè‹¥æƒ³ç”¨vscodeæ¥ä¸€é”®buildï¼Œåˆ™å¯ä»¥åœ¨argsé‡ŒåŠ ä¸Šä¸‰ä¸ªå‚æ•°ã€‚\n\n```json\n\t\t{\n            // ...\n\t\t\t\"args\": [\n                // ...\n                \"-lmuduo_net\",\n                \"-lmuduo_base\",\n                \"-lpthread\"\n            ],\n            // ...\n        }\n```\n\nå¦‚æœé…ç½®æ–‡ä»¶å†™å¥½äº†ï¼Œåˆ™å°±å¯ä»¥åœ¨vscodeä¸‹ä¸€é”®buildã€‚\n\n# muduoç½‘ç»œåº“çš„å¤šçº¿ç¨‹æ¨¡å‹\n\n* ç½‘ç»œæœåŠ¡å™¨ç¼–ç¨‹å¸¸ç”¨æ¨¡å‹\n    1. accept + read/write : ä¸æ˜¯å¹¶å‘æœåŠ¡å™¨\n    2. accpet + fork (process-pre-connection) : é€‚åˆå¹¶å‘è¿æ¥æ•°ä¸å¤§ï¼Œè®¡ç®—ä»»åŠ¡å·¥ä½œé‡å¤§äºforkçš„å¼€é”€\n    3. accept + thread (thread-pre-connection) : æ¯”æ–¹æ¡ˆ2çš„å¼€é”€å°äº†ä¸€ç‚¹ï¼Œä½†æ˜¯å¹¶å‘é€ æˆçº¿ç¨‹å †ç§¯è¿‡å¤š\n    4. reactors in threads (one loop per thread) : æ˜¯muduoçš„ç½‘ç»œè®¾è®¡ã€‚æœ‰ä¸€ä¸ªmain reactorè´Ÿè½½acceptè¿æ¥ï¼Œç„¶åæŠŠè¿æ¥åˆ†å‘åˆ°æŸä¸ªsub reactor(é‡‡ç”¨round-robinçš„æ–¹å¼æ¥é€‰æ‹©sub reactor)ï¼Œè¯¥è¿æ¥çš„æ“ä½œéƒ½åœ¨sub reactoræ‰€å¤„çš„çº¿ç¨‹ä¸­å®Œæˆã€‚å¤šä¸ªè¿æ¥å¯èƒ½è¢«åˆ†æ´¾åˆ°å¤šä¸ªçº¿ç¨‹ä¸­ï¼Œä»¥å……åˆ†åˆ©ç”¨CPUã€‚\n    5. reactors in process  (one loop pre process) : æ˜¯nginxæœåŠ¡å™¨çš„ç½‘ç»œæ¨¡å—è®¾è®¡ï¼ŒåŸºäºè¿›ç¨‹è®¾è®¡ï¼Œé‡‡ç”¨å¤šä¸ªReactorså……å½“I/Oè¿›ç¨‹å’Œå·¥ä½œè¿›ç¨‹ï¼Œé€šè¿‡ä¸€æŠŠaccepté”å®Œç¾è§£å†³å¤šä¸ªReactorsçš„â€œæƒŠç¾¤ç°è±¡â€ã€‚\n* muduoåº•å±‚çš„æ¨¡å‹\n\nmuduoçš„ç½‘ç»œè®¾è®¡ï¼šreactors in threads - one loop per thread.\n\næ–¹æ¡ˆçš„ç‰¹ç‚¹æ˜¯\"one loop per thread\"ï¼Œæœ‰ä¸€ä¸ªmain reactorè´Ÿè´£acceptè¿æ¥ï¼Œç„¶åæŠŠè¿æ¥åˆ†å‘åˆ°æŸä¸ªsub reactorï¼ˆè½®è¯¢æ–¹å¼é€‰æ‹©ï¼‰ã€‚è¯¥è¿æ¥çš„æ‰€æœ‰æ“ä½œéƒ½åœ¨è¯¥reactoræ‰€å¤„çš„çº¿ç¨‹ä¸­å®Œæˆã€‚å¤šä¸ªè¿æ¥å¯èƒ½è¢«åˆ†æ´¾åˆ°å¤šä¸ªçº¿ç¨‹ä¸­ï¼Œä»¥å……åˆ†åˆ©ç”¨CPUã€‚å¦‚æœæœ‰è¿‡å¤šçš„è€—è´¹CPU IOçš„è®¡ç®—ä»»åŠ¡ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªä¸“é—¨å¤„ç†è€—æ—¶è®¡ç®—ä»»åŠ¡çš„çº¿ç¨‹è´Ÿè´£å¤„ç†è¯¥ç±»ä»»åŠ¡ã€‚\n\nreactor pollçš„å¤§å°æ ¹æ®CPUæ ¸å¿ƒçš„æ•°ç›®ç¡®å®šã€‚\n\n```cpp\n//è®¾ç½®EventLoopçš„çº¿ç¨‹ä¸ªæ•°ï¼Œåº•å±‚é€šè¿‡EventLoopThreadPoolçº¿ç¨‹æ± ç®¡ç†çº¿ç¨‹ç±»EventLoopThread\n_server.setThreadNum(10);\n```\n\n# åŸºäºmuduoçš„æœåŠ¡å™¨ç¨‹åº\n\n## muduoç½‘ç»œåº“æä¾›çš„ç±»\n\n1. TcpServerï¼šç”¨äºç¼–å†™æœåŠ¡å™¨ç¨‹åºçš„ã€‚\n2. TcpClientï¼šç”¨äºç¼–å†™å®¢æˆ·ç«¯ç¨‹åºçš„ã€‚\n\nè¿™ä¸¤ä¸ªç±»ï¼Œå®é™…ä¸Šå°±æ˜¯æŠŠ`epoll+çº¿ç¨‹æ± `å°è£…åœ¨ä¸€èµ·äº†ã€‚å¥½å¤„å°±æ˜¯æŠŠç½‘ç»œIOä»£ç å’Œä¸šåŠ¡ä»£ç åŒºåˆ†å¼€ï¼Œä½¿ç¨‹åºå‘˜å¯ä»¥ä¸“å¿ƒå¼€å‘ä¸šåŠ¡ä»£ç ã€‚\n\nä¸šåŠ¡ä»£ç å…³æ³¨çš„ä¸¤ä»¶äº‹æƒ…ï¼š\n\n1. ç”¨æˆ·çš„è¿æ¥ä¸æ–­å¼€\n2. ç”¨æˆ·çš„å¯è¯»å†™äº‹ä»¶\n\nä½†è¿™ä¸¤ä»¶äº‹æƒ…ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨äº†ç½‘ç»œåº“ï¼Œåˆ™å¦‚ä½•ç›‘å¬ã€ä½•æ—¶å‘ç”Ÿäº‹ä»¶å…¨éƒ½ç”±ç½‘ç»œåº“ç»™ç¨‹åºå‘˜ä¸ŠæŠ¥ã€‚\n\n## muduoåº“ä¸­TcpServerç±»ä¸­é‡è¦çš„å›è°ƒå±æ€§\n\n```cpp\nvoid setConnectionCallback(const ConnectionCallback& cb)\n{\n    connectionCallback_ = cb;\n}\nvoid setMessageCallback(const MessageCallback & cb)\n{\n    messageCallback_ = cb;\n}\n```\n\n```cpp\ntypedef std::function<void (const TcpConnectionPtr&)> ConnectionCallback;\ntypedef std::function<void (const TcpConnectionPtr&, Buffer*, Timestamp)> MessageCallback;\n```\n\n## ä»£ç ç¤ºä¾‹ - ChatServer\n\néœ€è¦åŒ…å«çš„å¤´æ–‡ä»¶\n\n```cpp\n#include<muduo/net/TcpServer.h>\n#include<muduo/net/EventLoop.h>\n#include<functional>\nusing namespace std::placeholders;\n#include<iostream>\n```\n\n```cpp\nclass ChatServer\n{\npublic:\n    /* åœ¨å…¶ä¸­ï¼š\n     * 1ã€ç±»å†…æ„é€ TcpServerï¼Œåˆå§‹åŒ–EventLoopæŒ‡é’ˆ\n     * 2ã€ç»™TcpServeræ³¨å†Œç”¨æˆ·è¿æ¥çš„åˆ›å»ºã€è¿æ¥çš„æ–­å¼€å›è°ƒ\n     * 3ã€ç»™TcpServeræ³¨å†Œç”¨æˆ·è¯»å†™äº‹ä»¶å›è°ƒ\n     * 4ã€è®¾ç½®TcpServerçš„çº¿ç¨‹æ•°é‡ï¼Œmuduoåº“ä¼šè‡ªå·±åˆ†é…IOçº¿ç¨‹å’Œå·¥ä½œçº¿ç¨‹\n     */\n    ChatServer(muduo::net::EventLoop* loop, //äº‹ä»¶å¾ªç¯\n               const muduo::net::InetAddress& listenAddr,   //IP+port\n               const std::string& nameArg)  //æœåŠ¡å™¨çš„åå­—\n        : m_server(loop, listenAddr, nameArg),\n          m_loop(loop)\n    {\n        m_server.setConnectionCallback(std::bind(&ChatServer::onConnection, this, _1));\n        m_server.setMessageCallback(std::bind(&ChatServer::onMessage, this, _1, _2, _3));\n        m_server.setThreadNum(4);\n    }\n    //å¼€å¯äº‹ä»¶å¾ªç¯\n    void start()\n    {\n        m_server.start();\n    }\nprivate:\n    //å½“å‘ç”Ÿç”¨æˆ·çš„è¿æ¥åˆ›å»ºã€è¿æ¥æ–­å¼€äº‹ä»¶åï¼Œè°ƒç”¨å‡½æ•°\n    void onConnection(const muduo::net::TcpConnectionPtr &conn)\n    {\n\n    }\n    //è¯»å†™äº‹ä»¶å‘ç”Ÿåï¼Œè°ƒç”¨å‡½æ•°\n    void onMessage(const muduo::net::TcpConnectionPtr &conn,\n                   muduo::net::Buffer * buffer,\n                   muduo::Timestamp time)\n    {\n\n    }\nprivate:\n    muduo::net::TcpServer m_server;\n    muduo::net::EventLoop * m_loop;\n};\n```\n\n### ç¼–å†™å›è°ƒå‡½æ•°\n\nOnConnectionå’ŒOnMessage\n\n```cpp\n    //å½“å‘ç”Ÿç”¨æˆ·çš„è¿æ¥åˆ›å»ºã€è¿æ¥æ–­å¼€äº‹ä»¶åï¼Œè°ƒç”¨å‡½æ•°\n    void onConnection(const muduo::net::TcpConnectionPtr &conn)\n    {\n        std::cout << conn->peerAddress().toIpPort() << \" -> \" <<\n            conn->localAddress().toIpPort() << \" state:\";\n        if(conn->connected())\n        {\n            std::cout << \" online.\";\n        }\n        else\n        {\n            std::cout << \" offline.\"\n            conn->shutdown();\n            //_loop->quit();\n        }\n        std::cout << std::endl;\n    }\n    //è¯»å†™äº‹ä»¶å‘ç”Ÿåï¼Œè°ƒç”¨å‡½æ•°\n    void onMessage(const muduo::net::TcpConnectionPtr &conn,\n                   muduo::net::Buffer * buffer,\n                   muduo::Timestamp time)\n    {\n        std::string buf = buffer->retrieveAllAsString();\n        std::cout << \"recv data: \" << buf << \" time: \" << time.toString() << std::endl;\n        conn->send(buf);\n    }\n```\n\n### ä¸»å‡½æ•°\n\n```cpp\nint main()\n{\n    muduo::net::EventLoop loop; //ç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ªepoll\n    muduo::net::InetAddress addr(\"127.0.0.1\", 6000);\n    ChatServer chatserver(&loop, addr, \"mychat\");\n    chatserver.start();\n    loop.loop();    //ç›¸å½“äºè°ƒç”¨epoll_waitï¼Œä»¥é˜»å¡æ–¹å¼ç­‰å¾…æ–°ç”¨æˆ·è¿æ¥äº‹ä»¶ã€å·²è¿æ¥ç”¨æˆ·çš„è¯»å†™äº‹ä»¶\n}\n```\n\n### æµ‹è¯•æœåŠ¡å™¨ç¨‹åº\n\né¦–å…ˆï¼Œç¼–è¯‘é“¾æ¥éœ€è¦åŠ åç¼€`-lmuduo_net -lmuduo_base -lpthread`ã€‚\n\nç¼–è¯‘é“¾æ¥åï¼Œæ‰§è¡Œç¨‹åºã€‚\n\n```bash\n./chatserver\n```\n\nå¯ä»¥é€šè¿‡telnetè¿æ¥æœåŠ¡å™¨ã€‚\n\n```bash\ntelnet 127.0.0.1 6000\n```\n\n#### è¿è¡Œç»“æœ\n\n```\nxcg@ubuntu:~$ telnet 127.0.0.1 6000\nTrying 127.0.0.1...\nConnected to 127.0.0.1.\nEscape character is '^]'.\nhello!\t\t\t\t\t#å®¢æˆ·ç«¯è¾“å…¥æ˜¾ç¤ºåˆ°å±å¹•ä¸Šçš„ï¼Œå‘é€ç»™æœåŠ¡å™¨çš„å†…å®¹\nhello!\t\t\t\t\t#æ”¶åˆ°çš„æœåŠ¡å™¨å¤åˆ¶åå›å‘çš„ä¸€æ¨¡ä¸€æ ·çš„å†…å®¹ã€‚\n^]\ntelnet> quit\nConnection closed.\n```\n\n```\nxcg@ubuntu:~/muduo-0528$ ./chatserver \n20220528 08:10:49.554317Z  8116 INFO  TcpServer::newConnection [mychat] - new connection [mychat-127.0.0.1:6000#1] from 127.0.0.1:60338 - TcpServer.cc:80\n127.0.0.1:60338 -> 127.0.0.1:6000 state: online.\nrecv data: hello!\n time: 1653725453.563665\n127.0.0.1:60338 -> 127.0.0.1:6000 state: offline.\n20220528 08:10:56.835295Z  8116 INFO  TcpServer::removeConnectionInLoop [mychat] - connection mychat-127.0.0.1:6000#1 - TcpServer.cc:109\n```\n\n","categories":["é¡¹ç›®","muduo"]},{"title":"Cpp_çº¿ç¨‹åº“","url":"/Cpp/Cpp_çº¿ç¨‹åº“/","content":"# å†…å®¹\n\n1. çº¿ç¨‹çš„æ„é€ \n2. detachã€join\n3. `mutex`ã€`recursive_mutex`ã€`shared_mutex`\n4. `lock_guard`ã€`unique_lock`ã€`shared_lock`\n5. chrono\n6. `std::ref`\n7. jthread\n    1. çº¿ç¨‹å–æ¶ˆ\n8. æ¡ä»¶å˜é‡\n    1. waitã€`wait_for`ã€`wait_until`\n9. futureã€promise\n    1. `packaged_task`\n    2. async\n10. ä¿¡å·é‡\n11. é—©é”ï¼ˆlatchï¼‰ã€å±éšœï¼ˆBarrierï¼‰\n# chrono\n`std::this_thread::sleep_for`å¯ä»¥ç”¨äºçº¿ç¨‹ç¡çœ ã€‚\n1. å¯ä»¥ä½¿ç”¨`<chrono>`åº“ä¸‹çš„`std::chrono::milliseconds(n)`æ¥æŒ‡å®šæ—¶é—´å•ä½ã€‚\n2. `C++17`ä¹‹åå¯ä»¥ä½¿ç”¨`using namespace std::chrono_literals`ç”¨äºæŠŠå­—é¢å¸¸é‡æ ‡è¯†ç¬¦æ˜ å°„ä¸ºç§’ã€æ¯«ç§’ç­‰ã€‚\n\n![](../../images/Cpp_çº¿ç¨‹åº“/image-20240722225224344.png)\n# threadåˆ›å»ºçº¿ç¨‹ - å–ç¥¨ç¨‹åº\n1. ç”¨`std::thread`æ„é€ ã€‚\n    1. å‚æ•°1å¡«å‡½æ•°åœ°å€ã€‚\n    2. å‚æ•°2å¡«å‡½æ•°å‚æ•°ï¼Œæ²¡æœ‰åˆ™ä¸å¡«ã€‚\n    3. éµå¾ªçš„æ˜¯RAIIï¼Œæ„é€ å®Œå³å¼€å§‹è¿è¡Œã€‚\n2. çº¿ç¨‹å¯¹è±¡æœ‰`detach`æ–¹æ³•ç”¨æ¥è„±ç¦»ä¸»çº¿ç¨‹çš„ç®¡ç†ã€‚é˜²æ­¢ä¸»çº¿ç¨‹å…ˆäºå­çº¿ç¨‹ç»“æŸå¯¼è‡´çº¿ç¨‹å› ä¸ºæ•´ä¸ªè¿›ç¨‹æå‰ç»ˆæ­¢è€Œæœªæ‰§è¡Œå®Œæ¯•ã€‚\n3. ä¹Ÿå¯ä»¥ä½¿ç”¨`th.join()`æ–¹æ³•æ¥è®©ä¸»çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œç»“æŸã€‚ç›¸å½“äºWaitForSingleObject\n\n```cpp\n#include <thread>\n#include <chrono>\nconstinit int tickets = 100;\nvoid station(void);\nvoid station2(void);\n\nint main()\n{\n    std::thread th(&station);\n    std::thread th2(&station2);\n    th.detach();\n    th2.detach();\n    //std::this_thread::sleep_for(std::chrono::milliseconds(5000));\n    std::this_thread::sleep_for(5000ms);\n}\nvoid station(void)\n{\n    while (true)\n    {\n        if (tickets > 0)\n        {\n            std::wcout << L\"Station #1: \" << tickets-- << std::endl;\n        }\n        else\n        {\n            break;\n        }\n    }\n}\nvoid station2(void)\n{\n    while (true)\n    {\n        if (tickets > 0)\n        {\n            std::wcout << L\"Station #2: \" << tickets-- << std::endl;\n        }\n        else\n        {\n            break;\n        }\n    }\n}\n```\n## è¾“å‡º\n```\nStation #1: 100\nStation #1: 99\n...\nStation #1: ...\n...\nStation #1: 89\nStation #1: 88\nStation #1: 87\nStation #2: 86\nStation #2: 85\n...\nStation #2: ...\n...\nStation #2: 67\nStation #2: 66\nStation #2: 65\nStation #2: 64\nStation #2: 63\nStation #2: 62\nStation #1: 61\nStation #1: 60\n...\nStation #1: ...\n...\nStation #1: 5\nStation #1: 4\nStation #1: 3\nStation #1: 2\nStation #1: 1\nStation #2: 0\n```\nå‘ç°æŠŠ0å·ç¥¨å–æ‰äº†ï¼Œé”™è¯¯ã€‚\n# mutexï¼ˆäº’æ–¥é‡ï¼‰\nå®šä¹‰äº`<mutex>`ä¸­ã€‚\n## mutexç‰¹æ€§ï¼šæ„é€ å‡½æ•°ä»¥åŠä¸å¯å¤åˆ¶æ€§\nåœ¨[mutexæ„é€ å‡½æ•°](https://legacy.cplusplus.com/reference/mutex/mutex/mutex/)ä¸­æŒ‡å‡ºï¼Œæ„é€ ä¸€ä¸ªmutexå¯¹è±¡ï¼Œåˆå§‹çŠ¶æ€æ˜¯è§£é”ã€‚\nmutexå¯¹è±¡ä¸èƒ½è¢«å¤åˆ¶ã€ç§»åŠ¨ï¼ˆå¤åˆ¶æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦éƒ½è¢«åˆ é™¤ï¼‰\nå› æ­¤ï¼Œè¦ç‰¹åˆ«æ³¨æ„ä½ åˆ›å»ºçš„mutexçš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸å»ºè®®å»ºç«‹åœ¨æ ˆå¸§éšæ—¶å¡Œé™·çš„ä½ç½®ã€‚\n## recursive_mutexï¼ˆå¤šæ¬¡äº’æ–¥é‡ï¼‰\nå•çº¯çš„mutexåªèƒ½é”ä¸€æ¬¡ã€‚\n`recursive_mutex`å¯ä»¥é”å¤šæ¬¡ï¼Œä¹Ÿå¯ä»¥è§£é”å¤šæ¬¡ã€‚\n## åŸºäºC++æ ‡å‡†çº¿ç¨‹åº“äº’æ–¥é‡çš„å–ç¥¨ç¨‹åº\n```cpp\n#include <iostream>\n#include <print>\n#include <thread>\n#include <mutex>\n#include <vector>\n#include <chrono>\nusing namespace std::literals;\nvoid seller(std::string const& name, int& ticketsNum, std::mutex& mx);\nint main()\n{\n    std::vector<std::jthread> vec_jthreads;\n    int tickets = 1000;\n    std::mutex mx;\n    // start new thread\n    for (int i = 0; i < 10; ++i)\n    {\n        std::stringstream ss;\n        ss << \"seller \" << i;\n        vec_jthreads.emplace_back(seller, ss.str(), std::ref(tickets), std::ref(mx));\n    }\n    \n    for (auto& jth : vec_jthreads)\n    {\n        jth.join();\n    }\n\n    std::println(\"Finally, tickets remain: {}\", tickets);\n    return 0;\n}\nvoid seller(std::string const& name, int& tickets, std::mutex& mx)\n{\n    std::this_thread::sleep_for(1000ms);\n    while (true)\n    {\n        mx.lock();\n        if (tickets > 0)\n        {\n            std::println(\"{}: {}\", name, tickets);\n            --tickets;\n            mx.unlock();\n        }\n        else\n        {\n            mx.unlock();\n            break;\n        }\n    }\n}\n```\n## è¾“å‡º\n```\nStation #1: 500\nStation #1: 499\n...\nStation #1: ...\n...\nStation #1: 394\nStation #1: 393\n----------------------\nStation #2: 392\nStation #2: 391\n...\nStation #2: ...\n...\nStation #2: 5\nStation #2: 4\nStation #2: 3\nStation #2: 2\nStation #2: 1\n```\n## åˆ†æ\nå¯ä»¥çœ‹åˆ°çº¿ç¨‹1ã€2å„è‡ªæŒæœ‰é”çš„è·¨åº¦è¿˜æ˜¯æŒºå¤§çš„ï¼Œè¿™æ˜¯å› ä¸ºåœ¨`è·¨å¹³å°C++çº¿ç¨‹åº“`åœ¨Windowsä¸‹çš„æ‰§è¡Œæ˜¯ç”¨`Windowsä¸´ç•ŒåŒº`å®ç°çš„ã€‚\n# ä½œä¸ºå¼•ç”¨ä¼ å…¥çº¿ç¨‹å‡½æ•°å‚æ•°ï¼ˆ`std::ref`ï¼‰\n1. `std::mutex`é”æ˜¯ä¸å¯å¤åˆ¶çš„ã€‚åªèƒ½é€šè¿‡å¼•ç”¨ä¼ é€’ã€‚\n\n```cpp\nvoid station(std::mutex& mx);\nint main()\n{\n    std::mutex mx;\n    std::thread th(&station, mx); // error\n    th.join();\n}\nvoid station(std::mutex& mx)\n{\n    // ...\n}\n```\næ­¤æ—¶ï¼Œè™½ç„¶çº¿ç¨‹å‡½æ•°å‚æ•°ç±»å‹ä¸ºå¼•ç”¨ï¼Œä½†å®é™…å†™çš„ä»£ç ä¸­ï¼Œâ€œmxâ€è¿™ä¸ªå½¢å¼å’Œå€¼ç±»å‹çš„å½¢å¼ä¸èƒ½åŒºåˆ†ï¼Œç¼–è¯‘å™¨æ— æ³•å¯¹å…¶ç›´æ¥è§£æä¸ºå¼•ç”¨ï¼Œäº§ç”ŸäºŒä¹‰æ€§ã€‚ï¼ˆå³ç¼–è¯‘å™¨é»˜è®¤éƒ½å…ˆæŒ‰ç…§å€¼ä¼ é€’å¤„ç†ï¼Œä¹‹åæ‰å»å¤„ç†ã€åŒºåˆ†æ˜¯å¦ä¸ºå¼•ç”¨ï¼‰\n2. å› æ­¤ä¸èƒ½ç›´æ¥è£¸ä¼ ï¼Œä¸ºäº†æ˜¾å¼æŒ‡å‡ºæ­¤å˜é‡ä¸ºå¼•ç”¨ç±»å‹ï¼Œè¦åŒ…è£…ä¸€å±‚â€œå¼•ç”¨åŒ…è£¹å™¨â€ã€‚`std::reference_wrapper(mx)`ï¼Œä¹Ÿå¯ä»¥ç®€å†™ä¸º`std::ref(mx)`ã€‚åœ¨å®é™…ä½¿ç”¨åˆ°è¯¥å¼•ç”¨ç±»å‹å˜é‡æ—¶ï¼ŒåŒ…è£¹å™¨ä¼šè‡ªå·±é‡Šæ”¾å‡ºå®é™…å†…å®¹ã€‚\n\n```cpp\nvoid station(std::mutex& mx);\nvoid station2(std::mutex& mx);\nint main()\n{\n    std::mutex mx;\n    std::thread th(&station, std::ref(mx));\n    std::thread th2(&station2, std::ref(mx));\n    th.join();\n    th2.join();\n}\nvoid station(std::mutex& mx)\n{\n    // ...\n}\nvoid station2(std::mutex& mx)\n{\n    // ...\n}\n```\n## è§£æ`std::ref`\n\n```c++\nvoid fun(int n, int & ret)\n{\n\tfor (int i = 1; i <= n; ++i)\n\t{\n\t\tcout << \"thread fun\" << endl;\n\t\tstd::this_thread::sleep_for(std::chrono::milliseconds(100));\n\t}\n\tret = n;\n\tcout << \"thread fun end\" << endl;\n\treturn n;\n}\nint main()\n{\n\tint x = 10;\n\tstd::thread tha(fun, 5, std::ref(x));\n\ttha.join();\n\tcout << x << endl;\t\t//è¾“å‡º5\n}\n```\n\n```c++\nint main()\n{\n\tint x = 10;\n\tstd::thread tha(fun, 5, x);\t\t//ç¼–è¯‘ä¸é€šè¿‡\n\ttha.join();\n\tcout << x << endl;\n}\n```\n\nä¸ºä»€ä¹ˆç›´æ¥ä¼ xä¸èƒ½ç¼–è¯‘é€šè¿‡å‘¢ï¼Ÿå› ä¸ºthreadçš„æ„é€ è·ç¦»startçº¿ç¨‹ä¸­é—´æœ‰ä¸€å±‚å¯å˜å‚æ¨¡æ¿ç»„ä»¶ï¼š\n\n```c++\ntemplate<class Function, class... Args>\nexplicit thread(Function&& f, Args&&... args);\n```\n\n```c++\ntemplate <class _Fn, class... _Args>\nexplicit thread(_Fn&& _Fx, _Args&&... _Ax)\n{\n    _Start(_STD forward<_Fn>(_Fx), _STD forward<_Args>(_Ax)...);\n}\n```\n\nthreadçš„æ„é€ éœ€è¦å…ˆé€šè¿‡è¿™ä¸ªç»„ä»¶ï¼Œåˆ™ç”±äº`args`æ˜¯æŒ‰`[æ¨¡æ¿ &&]`æ¥æ”¶ï¼Œå¦‚æœç›´æ¥å•çº¯ä¼ `x`ï¼Œåˆ™ä¼šè¯†åˆ«ä¸ºæ™®é€šçš„`int`å€¼ä¼ é€’ï¼Œåœ¨åˆ°è¾¾`_Start`æ¥å£åï¼Œ`x`çš„`int`ç±»å‹ä¸å‚æ•°ç±»å‹`int &`ä¸åŒ¹é…ï¼Œæ— æ³•ç¼–è¯‘é€šè¿‡ã€‚\n\næ‰€ä»¥éœ€è¦ä¸€ä¸ªç‰¹æ®Šçš„æœºåˆ¶ï¼Œç”¨`std::ref`æ˜¾å¼æŒ‡å‡ºæŠŠ`x`æŒ‰å¼•ç”¨æ–¹å¼ä¼ é€’ï¼ˆä¼ åœ°å€ï¼‰ï¼Œå¦‚æ­¤ï¼Œåœ¨ç»è¿‡æ¨¡æ¿æ—¶ï¼ŒæŒ‰è½¬å‘å¼•ç”¨å¤„ç†ï¼Œç»è¿‡`_Start`æ¥å£çš„å®Œç¾è½¬å‘åä½œä¸ºå³å€¼**éšå¼è½¬æ¢**ä¸º`int &`ç±»å‹ï¼Œå¦‚æ­¤ä¾¿å¯ç¼–è¯‘é€šè¿‡ï¼Œè¾¾åˆ°æŒ‰å¼•ç”¨ä¼ å‚çš„ç›®çš„ã€‚\n\nä¸ºä»€ä¹ˆæ˜¯éšå¼è½¬æ¢ï¼Ÿ\n```c++\n//std::refçš„åº•å±‚æ˜¯reference_wrapperç±»ï¼Œå…¶ä¸­æœ‰éšå¼è½¬æ¢\ntemplate <class _Ty>\nclass reference_wrapper\n{\npublic:\n    using type = _Ty;\n    \n    template <class _Uty>\n    reference_wrapper(_Uty&& _Val)\n    {\n        _Ty& _Ref = static_cast<_Uty&&>(_Val);\n        _Ptr      = &_Ref;\t/*_STD addressof(_Ref);*/\n    }\n    \n    operator _Ty&() const noexcept\n    {\n        return *_Ptr;\n    }\nprivate:\n    _Ty* _Ptr{};\n};\n```\n\næµ‹è¯•\n```c++\n#include<iostream>\n#include<thread>\nusing namespace std;\n//std::refçš„åº•å±‚æ˜¯reference_wrapperç±»ï¼Œå…¶ä¸­æœ‰éšå¼è½¬æ¢\n\ntemplate <class _Ty>\nclass my_reference_wrapper\n{\npublic:\n    using type = _Ty;\n\n    template <class _Uty>\n    my_reference_wrapper(_Uty&& _Val)\n    {\n        _Ty& _Ref = static_cast<_Uty&&>(_Val);\n        _Ptr = &_Ref;\t/*_STD addressof(_Ref);*/\n    }\n\n    operator _Ty&() const noexcept\n    {\n        return *_Ptr;\n    }\nprivate:\n    _Ty* _Ptr{};\n};\nint fun(int n, int& x)\n{\n    for (int i = 1; i <= n; ++i)\n    {\n        cout << \"thread fun\" << endl;\n        std::this_thread::sleep_for(std::chrono::milliseconds(100));\n    }\n    x = n;\n    cout << \"thread fun end\" << endl;\n    return n;\n}\nint main()\n{\n    int x = 10;\n    \n    std::thread tha(fun, 5, my_reference_wrapper<int>(x));\n    tha.join();\n    cout << x << endl;\n}\n```\n\n```c++\ntemplate <class _Fn, class... _Args>\nexplicit thread(_Fn&& _Fx, _Args&&... _Ax)\n{\n    _Start(_STD forward<_Fn>(_Fx), _STD forward<_Args>(_Ax)...);\n}\n```\n\næ„é€ thaæ—¶çš„ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯`my_reference_wrapper<int>(x)`ï¼Œæ˜¯ä¸ªå³å€¼ï¼ä¼ å…¥threadå¯å˜å‚æ¨¡æ¿å‡½æ•°ï¼Œå®Œç¾è½¬å‘ï¼Œå³å€¼å åŠ å³å€¼ï¼Œä¾ç„¶æ˜¯å³å€¼ï¼Œè°ƒç”¨`_Start`æ—¶ä¼˜å…ˆåŒ¹é…`&&`ç±»å‹çš„å‚æ•°ï¼Œä½†æ˜¯å‘ç°æ²¡æœ‰ï¼Œè€Œä¸”åªæœ‰ä¸€ä¸ªåŒ¹é…çš„é€‰é¡¹æ˜¯ï¼š`(int n, int & x)`ï¼Œæ˜¯`int&`ç±»å‹ï¼Œäºæ˜¯ä¹ï¼Œæ— å¥ˆä¹‹ä¸¾ï¼Œè°ƒç”¨æˆå‘˜å‡½æ•°`operator _Ty()`ï¼Œå³ä¸ºéšå¼è½¬æ¢ä¸º`&Ty`çš„å·¦å€¼å¼•ç”¨ç±»å‹ã€‚\n\nå¦‚æ­¤ä¸€æ¥ï¼Œå³å¯æŠŠçº¿ç¨‹å‡½æ•°å¤–éƒ¨çš„`x`æŒ‰å¼•ç”¨ä¼ é€’ã€‚\n# å˜é‡çš„ä½œç”¨åŸŸ\nModern Cppå¼•å…¥äº†ä¸€äº›å˜é‡çš„ä½œç”¨åŸŸå…³é”®å­—ã€‚\nå˜é‡çš„ä½œç”¨åŸŸç±»å‹ï¼š\n1. å…¨å±€\n2. autoï¼ˆå±€éƒ¨ï¼‰ï¼šåœ¨å½“å‰æ ˆå¸§ä¸‹\n3. thread_localï¼šç”¨äºä¿®é¥°å…¨å±€å˜é‡ã€‚ä¸åŒçº¿ç¨‹è®¿é—®ç›¸åŒåå­—çš„å…¨å±€å˜é‡ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆå‰¯æœ¬ï¼Œå¯¹æ­¤åå­—å˜é‡çš„æ“ä½œåªåœ¨å½“å‰çº¿ç¨‹æœ‰æ•ˆï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–äººã€‚\n# lock_guard\nå®šä¹‰äº`<mutex>`ä¸­ã€‚ç”¨äºå¸®åŠ©ç®¡ç†mutexã€‚\nRAIIå¯¹è±¡ã€‚è‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸã€‚\néœ€è¦ä¸€ä¸ªmutexé”æ¥æ„é€ ã€‚æ„é€ åç«‹åˆ»å¯¹mutexä¸Šé”ï¼Œç›´åˆ°`lock_guard`è‡ªèº«ææ„æ—¶å¯¹mutexè§£é”ã€‚\nä¸mutexä¸€æ ·ï¼Œ`lock_guard`å¯¹è±¡æ— æ³•å¤åˆ¶/ç§»åŠ¨ã€‚\n\n>`lock_guard`æ˜¯ä¸€ä¸ªæ¨¡æ¿ç±»ï¼Œéœ€è¦ä¸€ä¸ªæ¨¡æ¿å‚æ•°ï¼Œå¦‚å¡«å†™`<std::mutex>`ã€‚åœ¨`C++17`åï¼Œä¸ç”¨å¡«å†™æ¨¡æ¿å‚æ•°ï¼Œå¯ä»¥è‡ªåŠ¨åˆ¤æ–­ç¨‹åºä»£ç å¤§æ‹¬å·ä¸­çš„å‚æ•°ç±»å‹ã€‚\n\n```cpp\nvoid station(std::mutex& mx);\nvoid station2(std::mutex& mx);\nint main()\n{\n    std::mutex mx;\n    std::thread th(&station, std::ref(mx));\n    std::thread th2(&station2, std::ref(mx));\n    th.join();\n    th2.join();\n}\nvoid station(std::mutex& mx)\n{\n    while (true)\n    {\n        std::lock_guard<std::mutex> lck{ mx };\n        if (tickets > 0)\n        {\n            std::wcout << L\"Station #1: \" << tickets-- << std::endl;\n        }\n        else\n        {\n            break;\n        }\n    } // é€€å‡ºæ­¤æ‹¬å·æ—¶ï¼Œlckææ„\n}\nvoid station2(std::mutex& mx)\n{\n    while (true)\n    {\n        std::lock_guard lck{ mx }; // åœ¨`C++17`åï¼Œä¸ç”¨å¡«å†™æ¨¡æ¿å‚æ•°ï¼Œå¯ä»¥è‡ªåŠ¨åˆ¤æ–­ç¨‹åºä»£ç å¤§æ‹¬å·ä¸­çš„å‚æ•°ç±»å‹ã€‚\n        if (tickets > 0)\n        {\n            std::wcout << L\"Station #2: \" << tickets-- << std::endl;\n        }\n        else\n        {\n            break;\n        }\n    } // é€€å‡ºæ­¤æ‹¬å·æ—¶ï¼Œlckææ„\n}\n```\n# unique_lock\næ˜¯`lock_guard`çš„å¤šåŠŸèƒ½ç‰ˆï¼Œå¯ä»¥è‡ªå·±æ§åˆ¶unlockã€è½¬ç§»æ‰€æœ‰æƒã€‚\nå®šä¹‰äº`<mutex>`ä¸­\n1. å’Œ`lock_guard`ç”¨æ³•ä¸€æ ·ï¼Œä½†æ˜¯`unique_lock`æ”¯æŒè½¬ç§»ç»™å¦ä¸€ä¸ª`unique_lock`ã€‚ï¼ˆéœ€è¦ä½¿ç”¨`std::move`ï¼‰\n2. æœ‰unlockã€releaseã€swapæ–¹æ³•ã€‚\n3. å¯ä»¥ç®¡ç†æ™®é€š`mutex`ï¼Œä¹Ÿå¯ä»¥ç®¡ç†`shared_mutex`ã€‚\n\n```cpp\nvoid station(std::mutex& mx);\nvoid station2(std::mutex& mx);\nint main()\n{\n    std::mutex mx;\n    std::thread th(&station, std::ref(mx));\n    std::thread th2(&station2, std::ref(mx));\n    th.join();\n    th2.join();\n}\nvoid station(std::mutex& mx)\n{\n    while (true)\n    {\n        std::unique_lock lck{ mx };\n        if (tickets > 0)\n        {\n            std::wcout << L\"Station #1: \" << tickets-- << std::endl;\n            std::unique_lock lck2 = std::move(lck);\n        }\n        else\n        {\n            break;\n        }\n    } // é€€å‡ºæ­¤æ‹¬å·æ—¶ï¼Œlck2ã€lckææ„\n}\n// station2 ...\n```\n## è¾“å‡º\n```\nStation #1: 100\nStation #1: 99\n...\nStation #1: ...\n...\nStation #1: 67\nStation #1: 66\nStation #2: 65\nStation #2: 64\n...\nStation #2: ...\n...\nStation #2: 8\nStation #2: 7\nStation #2: 6\nStation #2: 5\nStation #2: 4\nStation #2: 3\nStation #2: 2\nStation #2: 1\n```\n# shared_mutexï¼ˆå…±äº«äº’æ–¥é‡ï¼‰\nå®šä¹‰äº`<shared_mutex>`ï¼Œ`C++17`ç»™å‡ºçš„å…±äº«äº’æ–¥é‡ã€‚\n\nShared mutexes are especially useful when shared data can be safely read by any number of threads simultaneously, but a thread may only write the same data when no other thread is reading or writing at the same time.\n\næ¶ˆè´¹è€…å¯ä»¥å…±åŒè®¿é—®ï¼Œä½†ä¸èƒ½å’Œç”Ÿäº§è€…ä¸€èµ·å…±äº«ã€‚\n1. æä¾›çš„æ–¹æ³•ï¼š\n    1. `lock_shared`ç”¨äºæ¶ˆè´¹è€…å…±äº«äº’æ–¥é‡ã€‚\n    2. `lock`ç”¨äºç”Ÿäº§è€…ç‹¬å äº’æ–¥é‡ã€‚\n    3. `lock`å’Œ`lock`ï¼Œ`lock`å’Œ`lock_shared`éƒ½äº’æ–¥ã€‚\n2. åœ¨ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ä¸­ï¼Œ`lock_shared`ã€`unlock_shared`ç”¨äº`n`ä¸ªæ¶ˆè´¹è€…ä¸€èµ·è¿›å…¥æ¶ˆè´¹ã€‚`lock`ã€`unlock`ç”¨äºé˜»æ–­**æ‰€æœ‰æ¶ˆè´¹è€…ã€å…¶ä»–ç”Ÿäº§è€…**è¿›å…¥ã€‚\n\n```cpp\n#include <shared_mutex>\n#include <iostream>\n#include <thread>\n#include <chrono>\n#include <mutex>\nconstinit int tickets{ 0 };\nvoid station(std::shared_mutex& mx);\nvoid station2(std::shared_mutex& mx);\nvoid produce(std::shared_mutex& mx);\nusing namespace std::chrono_literals;\n\nint main()\n{\n    std::shared_mutex mx;\n    std::thread consumer(&station, std::ref(mx));\n    std::thread consumer2(&station2, std::ref(mx));\n    std::thread producer(&produce, std::ref(mx));\n\n    consumer.join();\n    consumer2.join();\n    producer.join();\n}\nvoid produce(std::shared_mutex& mx)\n{\n    while (true)\n    {\n        mx.lock();\n        std::wcout << L\"Producer: \" << ++tickets << std::endl;\n        std::this_thread::sleep_for(500ms);\n        mx.unlock();\n\n    }\n}\nvoid station(std::shared_mutex& mx)\n{\n    while (true)\n    {\n        mx.lock_shared();\n        if (tickets > 0)\n        {\n            std::wcout << L\"Station #1: \" << tickets-- << std::endl;\n            mx.unlock_shared();\n        }\n        else\n        {\n            mx.unlock_shared();\n        }\n    }\n}\nvoid station2(std::shared_mutex& mx)\n{\n    while (true)\n    {\n        mx.lock_shared();\n        if (tickets > 0)\n        {\n            std::wcout << L\"Station #2: \" << tickets-- << std::endl;\n            mx.unlock_shared();\n        }\n        else\n        {\n            mx.unlock_shared();\n        }\n    }\n}\n```\n## è¾“å‡º\n```\nProducer: 1\nStation #2: 1\nStation #1: 0\nProducer: 0\nProducer: 1\nProducer: 2\nProducer: 3\nStation #2: 3\nStation #1: 2\nStation #1: 1\nProducer: 1\nProducer: 2\nProducer: 3\nStation #2: 3\nStation #2: 2\nStation #2: 1\nProducer: 1\nStation #2: 1\nProducer: 1\nProducer: 2\nProducer: 3\nProducer: 4\n ...\n```\n## åˆ†æ\n1. è¾“å‡ºä¸­çœ‹åˆ°1ä¸ªproducerå’Œ2ä¸ªconsumeræ˜¯äº’æ–¥çš„ï¼Œæœ‰ä¸€æ–¹åœ¨åˆ™å¦ä¸€æ–¹ä¸åŠ¨ã€‚\n2. è¾“å‡ºä¸­çœ‹åˆ°0å·ç¥¨æœ‰æ—¶å€™ä¹Ÿä¼šè¢«å–æ‰ã€‚è¯æ˜äº†`mx.lock_shared()`åªæ˜¯è®©nä¸ªæ¶ˆè´¹è€…åŒæ—¶æ‹¿åˆ°é”ï¼Œå¹¶ä¸”æ²¡æœ‰åšè¿›ä¸€æ­¥çš„åŒæ­¥ç®¡ç†ã€‚\n# shared_lockå’Œunique_lockæ­é…ç®¡ç†shared_mutex\n1. æŠŠ`shared_mutex`çš„å¼€é”è§£é”çš„åŠ¨ä½œè®©é”ç®¡ç†å™¨ï¼ˆ`shared_lock`å’Œ`unique_lock`ï¼‰æ¥ç®¡ã€‚\n2. `shared_mutex`çš„lockã€unlockåŠ¨ä½œè®©`unique_lock`æ¥ç®¡\n3. `shared_mutex`çš„lock_sharedã€unlock_sharedåŠ¨ä½œè®©`shared_lock`æ¥ç®¡ã€‚\n\n```cpp\n#include <shared_mutex>\n#include <iostream>\n#include <thread>\n#include <chrono>\n#include <mutex>\nconstinit int tickets{ 0 };\nvoid station(std::shared_mutex& mx);\nvoid station2(std::shared_mutex& mx);\nvoid produce(std::shared_mutex& mx);\nusing namespace std::chrono_literals;\n\nint main()\n{\n    std::shared_mutex mx;\n    std::thread consumer(&station, std::ref(mx));\n    std::thread consumer2(&station2, std::ref(mx));\n    std::thread producer(&produce, std::ref(mx));\n\n    consumer.join();\n    consumer2.join();\n    producer.join();\n}\nvoid produce(std::shared_mutex& mx)\n{\n    while (true)\n    {\n        std::unique_lock lck{ mx };\n        std::wcout << L\"Producer: \" << ++tickets << std::endl;\n        std::this_thread::sleep_for(500ms);\n    }\n}\nvoid station(std::shared_mutex& mx)\n{\n    while (true)\n    {\n        std::shared_lock lck{ mx };\n        if (tickets > 0)\n        {\n            std::wcout << L\"Station #1: \" << tickets-- << std::endl;\n        }\n        else\n        {\n        }\n    }\n}\nvoid station2(std::shared_mutex& mx)\n{\n    while (true)\n    {\n        std::shared_lock lck{ mx };\n        if (tickets > 0)\n        {\n            std::wcout << L\"Station #2: \" << tickets-- << std::endl;\n        }\n        else\n        {\n        }\n    }\n}\n```\n# `C++`å¤šçº¿ç¨‹ä¸lambdaè¡¨è¾¾å¼ç»“åˆ\nä½¿ç”¨lambdaè¡¨è¾¾å¼å®šä¹‰ä¸€ä¸ªçº¿ç¨‹å‡½æ•°ï¼šæ¯100msæ‰“å°ä»0åˆ°100ã€‚\n```cpp\n#include <iostream>\n#Include <thread>\n#include <chrono>\n\nusing namespace std::chrono_literals;\nint main()\n{\n    std::thread t1([]() -> void\n    {\n        for (int i = 0; i <= 100; ++i)\n        {\n            std::cout << i << std::endl;\n            std::this_thread::sleep_for(100ms);\n        }\n    });\n    t1.join();\n}\n```\n## lambdaå‡½æ•°å‚æ•°çš„å¤„ç†\nlambdaè¡¨è¾¾å¼ä½œä¸ºçº¿ç¨‹å‡½æ•°ï¼Œå¦‚æœæœ‰å…¶è‡ªå·±çš„å†…éƒ¨å‚æ•°ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¼ å…¥lambdaè¡¨è¾¾å¼åï¼Œå†ä¼ å…¥å…¶ä½¿ç”¨çš„å‚æ•°ã€‚\n```cpp\n#include <iostream>\n#Include <thread>\n#include <chrono>\n\nusing namespace std::chrono_literals;\nint main()\n{\n    auto nums{ 100 };\n    std::thread t1([](auto nu) -> void\n        {\n            for (int i = 0; i <= nu; ++i)\n            {\n                std::cout << i << std::endl;\n                std::this_thread::sleep_for(100ms);\n            }\n            nu = 50; // å¸¦ä¸å›å»\n        }, nums);\n    std::thread t2([](int& nu) -> void\n        {\n            for (int i = 0; i <= nu; ++i)\n            {\n                std::cout << i << std::endl;\n                std::this_thread::sleep_for(100ms);\n            }\n            nu = 50;  // å¸¦å›å»ä¿®æ”¹äº†numsçš„å€¼\n        }, std::ref(nums));\n    t1.join();\n    t2.join();\n}\n```\n1. å‚æ•°æŒ‰å€¼ä¼ é€’ï¼šlambdaå½¢å‚ç±»å‹å¯ä»¥ç”¨autoã€‚\n2. å‚æ•°æŒ‰å¼•ç”¨ä¼ é€’ï¼šä¼ å‚æ—¶å¿…é¡»ç”¨`std::ref`ã€‚æ­¤æ—¶ç”±äºæœ‰å¼•ç”¨åŒ…è£¹å™¨ï¼Œautoä¸èƒ½æ¨å¯¼ã€‚æ‰€ä»¥lambdaå½¢å‚ç±»å‹ä¸å¯ä»¥ç”¨`auto &`ï¼Œä¹Ÿä¸å¯ä»¥ç”¨`auto &&`ï¼Œå¿…é¡»æ˜ç¡®`ClassName &`\n# jthread\n`C++20`ä¸‹çš„åŠ å¼ºç‰ˆthreadç±»\n1. å¦‚æœmainå‡½æ•°ä¸­æ²¡å†™t1çš„joinï¼Œé‚£ä¹ˆä¼šå…ˆåˆ°`return 0;`ï¼Œä¹‹ååœ¨mainå³å°†return 0æ—¶ï¼Œt1ææ„æ—¶ï¼Œè‡ªåŠ¨åœ°ä¸ºt1è°ƒç”¨joinï¼Œåˆ™æœ€åä¸»çº¿ç¨‹ç­‰å¾…t1ç»“æŸåä¸€èµ·é€€å‡ºã€‚å¦‚æœæ˜ç¡®å†™äº†joinåˆ™æŒ‰ç…§æ™®é€šthreadçš„joinæ—¶æœºã€‚\n2. å¦‚æœåªå†™detachï¼Œé‚£ä¹ˆæœ€åå°±ä¸ä¼šè‡ªåŠ¨åŠ joinï¼Œä¸»çº¿ç¨‹é€€å‡ºæ—¶å­çº¿ç¨‹ä¹Ÿä¼šé€€å‡ºã€‚\n## çº¿ç¨‹å–æ¶ˆ\n![](../../images/Cpp_çº¿ç¨‹åº“/image-20240723044901963.png)\nè¿™äº›Â `stop_XXX`Â ç±»å‹éƒ½åœ¨`<stop_token>`ä¸­å®šä¹‰ï¼Œæ—¨åœ¨ä½¿`jthread`å–æ¶ˆï¼Œå°½ç®¡å®ƒä»¬ä¹Ÿå¯ä»¥ç‹¬ç«‹ä½¿ç”¨ `std::jthread`Â - ä¾‹å¦‚ï¼Œä¸­æ–­`std::condition_variable_any`ç­‰å¾…å‡½æ•°ï¼Œæˆ–ç”¨äºè‡ªå®šä¹‰çº¿ç¨‹ç®¡ç†å®ç°ã€‚äº‹å®ä¸Šï¼Œå®ƒä»¬ç”šè‡³ä¸éœ€è¦ç”¨äºâ€œåœæ­¢â€ä»»ä½•ä¸œè¥¿ï¼Œè€Œæ˜¯å¯ä»¥ç”¨äºçº¿ç¨‹å®‰å…¨çš„ä¸€æ¬¡æ€§å‡½æ•°è°ƒç”¨è§¦å‘å™¨ã€‚ï¼ˆè¿™æ®µè¯çš„æ„æ€å¤§æ¦‚æ˜¯ï¼Œ`stop_token`åªæ˜¯å«åšâ€œåœæ­¢â€ï¼Œä½†å®é™…ä¸Šæ²¡æœ‰çœŸçš„åœæ­¢åŠ¨ä½œï¼‰\n### stop_tokenã€stop_requested\n1. tokenä¼šå…±äº«ä¸€ä¸ªæ ‡è®°æ€§çš„å¯¹è±¡\n2. çº¿ç¨‹å¯ä»¥`get_stop_token`è·å¾—token\n3. çº¿ç¨‹å¯ä»¥`request_stop`é€šçŸ¥åœæ­¢\n    1. æ—§çš„è®©çº¿ç¨‹åœæ­¢çš„æ‰‹æ®µï¼šéœ€è¦å»ºç«‹å¦‚Windowsä¸‹çš„Eventï¼Œé€šè¿‡Eventè®©çº¿ç¨‹åœæ­¢ã€‚ç°åœ¨è¿™ç§`stop_token`æ–¹æ³•ä½¿çº¿ç¨‹åœæ­¢æ›´ç®€æ´äº†ã€‚\n\n\n1. å¦‚æœè¦ä¼ å…¥`stop_token`ï¼Œjthreadçš„çº¿ç¨‹å‡½æ•°ä¸­å†…éƒ¨çš„ç¬¬1ä¸ªå‚æ•°å¿…é¡»å†™`std::stop_token`\n2. jthreadæä¾›äº†`request_stop`å‡½æ•°ã€‚æä¾›äº†`get_stop_token`å‡½æ•°ã€‚\n\nä»¥ä¸‹ç¨‹åºè¡¨ç¤ºï¼š\n1. ä¸»çº¿ç¨‹åˆ›å»ºt1ï¼Œå†…éƒ¨æœ‰ä¸€ä¸ªtokæ¯100msæŸ¥çœ‹æ˜¯å¦æœ‰å¤–éƒ¨è¯·æ±‚åœæ­¢ã€‚\n2. ç¨‹åºæ‰§è¡Œ3såï¼Œä¸»çº¿ç¨‹è°ƒç”¨`t1.request_stop()`è¯·æ±‚t1åœæ­¢ã€‚\n```cpp\n#include <iostream>\n#include <thread>\n\nusing namespace std::chrono_literals;\nint main()\n{\n    std::jthread t1([](std::stop_token tok) -> void\n        {\n            for (int i = 0; i <= 100; ++i)\n            {\n                std::cout << i << std::endl;\n                if (tok.stop_requested())\n                {\n                    break;\n                }\n                std::this_thread::sleep_for(100ms);\n            }\n        });\n        \n    std::this_thread::sleep_for(3s);\n    t1.request_stop();\n    \n    t1.join();\n    return 0;\n}\n```\n### åº”ç”¨åœºæ™¯\nä¼ è¾“æ–‡ä»¶è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡tokenè¿™ç§ç±»ä¼¼äºä¿¡å·çš„ä¸œè¥¿ï¼Œç”¨äºæ§åˆ¶å¦ä¸€ä¸ªçº¿ç¨‹ã€‚ï¼ˆä¼ ç»Ÿæ–¹æ³•æ˜¯éœ€è¦WaitForSingleObjectï¼Œè¾ƒä¸ºç¹çï¼‰\nè¿™æ˜¯ä¸€ç§é¢å‘å¯¹è±¡çš„è®¾è®¡ï¼Œtokenå¯ä»¥é€šè¿‡ä¼ å‚ä¼ é€’ï¼ŒæŒ‰ç…§äº‹ä»¶é€šçŸ¥çš„æ–¹å¼ï¼ŒæŒ‰éœ€å¿«é€Ÿä½¿ç”¨ã€‚\n### stop_possible\nå¯çœ‹[std::stop_token::stop_possible](https://en.cppreference.com/w/cpp/thread/stop_token/stop_possible)ä¸­çš„ä»£ç ç¤ºä¾‹ã€‚\n### stop_source\n\njthreadå¯¹è±¡å¯ä»¥é€šè¿‡è°ƒç”¨`get_stop_source`ï¼Œè¿”å›ä¸Â `jthread`Â å¯¹è±¡å†…éƒ¨ä¿å­˜çš„ç›¸åŒå…±äº«åœæ­¢çŠ¶æ€å…³è”çš„ `std::stop_source`ã€‚\n\nè·å–åˆ°jthreadçš„sourceåå°±ä¸ç”¨æ“ä½œjthreadäº†ï¼Œå¯ä»¥é€šè¿‡sourceè¿›è¡Œï¼š\n1. `source.get_token()`ï¼Œå°±ç›¸å½“äº`t1.get_stop_token()`\n2. `source.request_stop()`\n\n```cpp\n#include <iostream>\n#include <thread>\n#include<stop_token>\nusing namespace std::chrono_literals;\nint main()\n{\n    std::jthread t1([](std::stop_token tok) -> void\n        {\n            for (int i = 0; i <= 100; ++i)\n            {\n                std::cout << i << std::endl;\n                if (tok.stop_requested())\n                {\n                    break;\n                }\n                std::this_thread::sleep_for(100ms);\n            }\n        });\n    \n    auto source = t1.get_stop_source();\n    std::this_thread::sleep_for(3s);\n    source.request_stop();\n}\n```\n### stop_callback\nå®šä¹‰äº`<stop_token>`ï¼Œç”¨äºæ­é…`stop_token`ä½¿ç”¨ï¼ŒæŒ‡ç¤ºçº¿ç¨‹å–æ¶ˆåè¿›è¡Œçš„å›è°ƒæ“ä½œã€‚\n1. éœ€è¦ä¸€ä¸ª`stop_token`å’Œä¸€ä¸ªå‡½æ•°ä½œä¸ºæ„é€ \n2. å½“è¯¥`stop_token`å¯¹åº”çš„çº¿ç¨‹å¾—åˆ°`stop_requested`ä¿¡å·æ—¶ï¼Œè°ƒç”¨`stop_callback`æ„é€ æ—¶ç»‘å®šçš„å‡½æ•°ã€‚\n\n```cpp\n#include <iostream>\n#include <thread>\n#include <stop_token>\nusing namespace std::chrono_literals;\nint main()\n{\n    std::jthread t1([](std::stop_token tok) -> void\n        {\n            for (int i = 0; i <= 100; ++i)\n            {\n                std::cout << i << std::endl;\n                if (tok.stop_requested())\n                {\n                    break;\n                }\n                std::this_thread::sleep_for(100ms);\n            }\n        });\n\n    std::stop_callback cb{ t1.get_stop_token(), []() -> void\n        {\n            std::wcout << L\"Stopped!\" << std::endl;\n        } };\n\n    std::this_thread::sleep_for(3s);\n    t1.request_stop();\n}\n```\nå¯èƒ½çš„è¾“å‡ºï¼š\n```\n0\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\nStopped!\n28\n```\n# æ¡ä»¶å˜é‡ï¼ˆwaitï¼‰\nä»`C++11`å°±å¼€å§‹å¼•å…¥äº†\n\nç±»ä¼¼äºWindowsä¸‹çš„ä¿¡å·ï¼ˆäº‹ä»¶ï¼‰ã€‚\n\n`Modern C++`ä¸­é€šç”¨çš„ç”¨äºé€šçŸ¥ã€ç­‰å¾…çš„å·¥å…·ã€‚\n\néœ€è¦å’Œé”é…å¥—ä½¿ç”¨ï¼Œå› ä¸ºcvçš„waitæ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ª`std::unique_lock<std::mutex>`å‚æ•°\n\nä»¥ä¸‹ç¨‹åºè¯´çš„æ˜¯ï¼š\n1. åˆ›å»ºä¸€ä¸ªt1çº¿ç¨‹\n2. t1çº¿ç¨‹å°è¯•æ‹¿mxé”\n3. æ‹¿åˆ°mxåï¼Œåœ¨mxé”ä¸Šé¢waitï¼Œé‡Šæ”¾é”ï¼Œä¹‹åä¼‘çœ ï¼ˆè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼‰\n4. å¦‚æœæ²¡æœ‰é€šçŸ¥åˆ™ä¸€ç›´é˜»å¡ã€‚\n5. ä¸»çº¿ç¨‹ä¼‘çœ 3s\n6. ä¸»çº¿ç¨‹notifyé€šçŸ¥ç­‰å¾…é˜Ÿåˆ—ï¼Œå”¤é†’äº†t1çº¿ç¨‹ã€‚\n7. å­çº¿ç¨‹t1è¢«å”¤é†’åï¼Œå¿…é¡»é‡æ–°è·å–é”ï¼Œæ‰èƒ½è¿”å›ä»è€Œç»§ç»­ä¸‹ä¸€æ­¥ã€‚\n\nç»¼ä¸Šæ‰€è¿°ï¼Œwaitæœ‰ä¸‰å¤§æ­¥éª¤ï¼š\n1. é‡Šæ”¾é”\n2. ä¼‘çœ ï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—\n3. è¢«å”¤é†’ï¼Œå°è¯•è·å–é”ã€‚\n    1. å¦‚æœæˆåŠŸåˆ™è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚\n    2. å¦‚æœæš‚æ—¶æ²¡æ‹¿åˆ°é”åˆ™é˜»å¡ï¼Œç›´åˆ°æ‹¿åˆ°é”åæ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥ã€‚\n        1. ä½†è¿™æ˜¯å› æŠ¢é”è€Œå¯¼è‡´é˜»å¡ï¼Œå’Œwaitçš„ç­‰å¾…é˜Ÿåˆ—æ˜¯ä¸¤ç äº‹ï¼\n        2. ä¹Ÿå°±æ˜¯è¯´ï¼ˆå†æ¬¡å¼ºè°ƒï¼‰ï¼šwaitæ˜¯ä¸»åŠ¨é˜»å¡ï¼ˆwaitä¹‹å‰æ‹¿åˆ°äº†é”ï¼Œä½†æ˜¯æ¡ä»¶ä¸ºå‡ï¼Œä¸»åŠ¨æ”¾å¼ƒäº†é”ï¼‰ã€‚è€Œä¸€æ—¦æ¡ä»¶ä¸ºçœŸï¼Œä¸”è¢«å”¤é†’åï¼ŒæŠ¢é”æ²¡æŠ¢åˆ°ï¼Œåˆ™æ˜¯è¢«åŠ¨é˜»å¡ã€‚\n\né™¤äº†è¿™ä¸‰å¤§æ­¥éª¤ï¼Œè¿˜æœ‰ä¸€å¤§å‰æï¼šç³»ç»Ÿå‡å®šåœ¨waitè°ƒç”¨å‰ï¼Œå…¶ä¸­çš„mxäº’æ–¥é‡å·²ä¸Šé”ã€‚æ‰€ä»¥å¿…é¡»åœ¨æ‹¿åˆ°é”ä¹‹åæ‰èƒ½waitã€‚\n```cpp\n#include <condition_variable>\n#include <mutex>\nstd::mutex mx;\nstd::condition_variable cv;\nusing namespace std::chrono_literals;\nint main()\n{\n    std::jthread t1([]() -> void\n    {\n        std::unique_lock lck{ mx };\n        cv.wait(lck);\n        for (int i = 0; i <= 100; ++i)\n        {\n            std::cout << i << std::endl;\n            \n            std::this_thread::sleep_for(100ms);\n        }\n    });\n    std::this_thread::sleep_for(3s);\n    cv.notify_one();\n}\n```\n### æ³¨æ„äº‹é¡¹\næ®ã€Šæ“ä½œç³»ç»Ÿå¯¼è®ºã€‹P252 30.1èŠ‚ ä¸­çš„æç¤ºï¼š\n>æ¨èåœ¨å‘notifyä¿¡å·æ—¶æ€»æ˜¯æŒæœ‰é”\n>\n>å°½ç®¡å¹¶ä¸æ˜¯æ‰€æœ‰æƒ…å†µä¸‹éƒ½ä¸¥æ ¼éœ€è¦ï¼Œä½†æœ‰æ•ˆä¸”ç®€å•çš„åšæ³•è¿˜æ˜¯åœ¨ä½¿ç”¨æ¡ä»¶å˜é‡å‘é€notifyä¿¡å·æ—¶æŒæœ‰é”ï¼ˆæŒ‡è¦å‘é€notifyçš„çº¿ç¨‹ï¼‰ã€‚æœ‰çš„ä¾‹å­æ˜¯å¿…é¡»åŠ é”çš„æƒ…å†µï¼Œä½†ä¹Ÿæœ‰ä¸€äº›æƒ…å†µå¯ä»¥ä¸åŠ é”ï¼Œè€Œè¿™å¯èƒ½æ˜¯ä½ åº”è¯¥é¿å…ï¼ˆé¿å…å†å»åˆ†æƒ…å†µè€ƒè™‘ï¼‰çš„ã€‚å› æ­¤ï¼Œ**ä¸ºäº†ç®€å•**ï¼Œè¯·åœ¨è°ƒç”¨ signalï¼ˆä¹Ÿå°±æ˜¯notifyï¼‰ æ—¶æŒæœ‰é”ï¼ˆhold the lock when calling signalï¼‰ã€‚\n>\n>è¿™ä¸ªæç¤ºçš„åé¢ï¼Œå³è°ƒç”¨ wait æ—¶æŒæœ‰é”ï¼Œä½†è¿™å°±ä¸åªæ˜¯å»ºè®®äº†ï¼Œwait çš„è¯­ä¹‰æ˜¯å¼ºåˆ¶è¦æ±‚å‰ææŒæœ‰é”çš„ã€‚å› ä¸º wait è°ƒç”¨æ€»æ˜¯å‡è®¾ä½ è°ƒç”¨å®ƒæ—¶å·²ç»æŒæœ‰é”ã€è°ƒç”¨è€…ç¡çœ ä¹‹å‰ä¼šé‡Šæ”¾é”ä»¥åŠè¿”å›å‰é‡æ–°æŒæœ‰é”ã€‚\n>\n>å› æ­¤ï¼Œå¯ä»¥æå‡ºä¸€èˆ¬åŒ–å½¢å¼ï¼Œä¿è¯ç¨‹åºæ­£ç¡®ï¼šè°ƒç”¨ signal å’Œ wait æ—¶éƒ½è¦æŒæœ‰é”ï¼ˆhold the lock when calling signal or waitï¼‰ã€‚\n\nå°±æ‹¿ä¸Šé¢çš„ä¾‹å­æ¥è¯´ï¼Œå¦‚æœä¸å¯¹`notify_one`åŠ ä»¥åŒæ­¥æ§åˆ¶çš„è¯ï¼Œæœ‰å¯èƒ½t1çº¿ç¨‹åœ¨lckä¸Šé”çš„æ—¶å€™ï¼Œä¸»çº¿ç¨‹æ°å¥½`notify_one`ï¼Œå¯¼è‡´åœ¨å…¶waitä¹‹å‰å”¤é†’ï¼Œåˆ™waitä¹‹åå†ä¹Ÿæ²¡æœ‰å”¤é†’çš„æœºä¼šï¼Œç¨‹åºå°±ä¸€ç›´é˜»å¡äº†ã€‚\n\næ‰€ä»¥ï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­çš„`cv.notify_one()`è¯­å¥ä¹‹å‰åŠ é”ï¼ˆè®°å¾—å’Œt1ä¸­mutexå˜é‡ä¸€è‡´ï¼‰ã€‚\nè€Œä¸”æ—¢ç„¶åœ¨`cv.notify_one()`ä¹‹å‰åŠ äº†é”ï¼Œå°±è¦åœ¨`cv.notify_one()`ä¹‹åè§£é”ï¼Œæ˜¯å› ä¸ºwaitè¢«å”¤é†’ä¹‹åè¿˜éœ€è¦å¾—åˆ°é”æ‰èƒ½è„±ç¦»é˜»å¡ç»§ç»­ä¸‹ä¸€æ­¥æ“ä½œã€‚\n```cpp\nint main()\n{\n    // t1 ...\n\n    std::this_thread::sleep_for(3s);\n    \n    std::unique_lock lck{ mx };    // add\n    cv.notify_one();\n    lck.unlock();                  // add\n    \n}\n```\n## wait_for\n```cpp\ntemplate <class Rep, class Period>\ncv_status wait_for (unique_lock<mutex>& lck, const chrono::duration<Rep,Period>& rel_time);\n```\nåœ¨waitçš„åŸºç¡€ä¸Šï¼Œæ—¢å¯ä»¥é€šè¿‡è·å¾—é€šçŸ¥å¾—åˆ°å”¤é†’ï¼Œä¹Ÿå¯ä»¥è®¡æ—¶è¶…æ—¶å¾—åˆ°å”¤é†’ã€‚\nå³ï¼šè¶…æ—¶åä¸**è¢«notify**çš„è¡Œä¸ºä¸€æ ·ï¼Œå°è¯•è·å–é”ï¼Œå¦‚æœæˆåŠŸåˆ™ä¸‹ä¸€æ­¥ï¼Œå¦‚æœå¤±è´¥åˆ™é˜»å¡ã€‚\nä½†è¿”å›å€¼æœ‰ç‰¹ç‚¹ï¼Œè¶…æ—¶åˆ™è¿”å›`std::cv_status::timeout`ï¼Œå…¶ä»–æƒ…å†µè¿”å›`std::cv_status::no_timeout`\n### ç”¨å¤„ï¼šç»“åˆnotifyæ¥åœæ­¢çº¿ç¨‹\nwaitæ˜¯ç”¨äºé€šçŸ¥çº¿ç¨‹**å¼€å§‹**ä¸‹ä¸€æ­¥åŠ¨ä½œã€‚\nè€Œ`wait_for`åˆ™å¯ä»¥ç”¨äºé€šçŸ¥çº¿ç¨‹**åœæ­¢**ã€‚\n\nä»¥ä¸‹ç¨‹åºæ˜¯è¯´ï¼š2ä¸ªæ¡ä»¶å˜é‡ï¼Œ`cv`å’Œ`cv2`ï¼Œ`cv`ç”¨äº`wait`ï¼Œä»¥å†³å®šä½•æ—¶å¼€å§‹ã€‚`cv2`ç”¨äº`wait_for`ï¼Œç»“åˆè¿”å›å€¼statusï¼Œåœ¨ä¸€æ®µæ—¶é—´ç­‰å¾…åœæ­¢çš„ä¿¡å·ã€‚\nä¸»çº¿ç¨‹ï¼š\n1. åœ¨é‡Šæ”¾äº†cvå¯¹åº”çš„lckåï¼Œå­çº¿ç¨‹waitæˆåŠŸè·å–åˆ°é”å¼€å§‹ä¸‹ä¸€æ­¥ã€‚\n2. ä¼‘çœ 3sï¼Œä¿è¯å­çº¿ç¨‹å¯ä»¥è‡³å°‘æ‰§è¡Œ3sã€‚\n3. ä¹‹åä¸å­çº¿ç¨‹ç«äº‰lck2é”ï¼Œä¸€æ—¦ä¸»çº¿ç¨‹æ‹¿åˆ°äº†ï¼Œå½“å³notifyç»™cv2ï¼Œä¹‹åé‡Šæ”¾é”ã€‚\n\nå­çº¿ç¨‹ï¼š\n1. åœ¨cvä¸Šç­‰å¾…ï¼Œä¸€æ—¦è·å–lckåˆ™ä¸‹ä¸€æ­¥ã€‚\n2. æ¯æ¬¡forå¾ªç¯éƒ½å…ˆæŠ¢lck2é”\n    1. åœ¨ä¸»çº¿ç¨‹ä¼‘çœ çš„3så†…ï¼Œè‚¯å®šèƒ½æŠ¢åˆ°ã€‚å¹¶ä¸”æ¯æ¬¡wait_foré‡Šæ”¾é”ä¹Ÿä¸ä¼šè¢«åˆ«äººæŠ¢ï¼Œå³ä¸ä¼šè¢«notifyï¼Œæ‰€ä»¥è¿”å›å€¼åº”è¯¥éƒ½æ˜¯timeout\n    2. 3sä¸»çº¿ç¨‹å”¤é†’åï¼Œä¸ä¸»çº¿ç¨‹ç«äº‰lck2é”\n        1. å¦‚æœå­å…ˆæŠ¢åˆ°äº†ï¼Œåˆ™è¿™ä¸€æ¬¡forå¾ªç¯åœ¨wait_foræ—¶lck2é‡Šæ”¾50msï¼Œå¦‚æœä¸»çº¿ç¨‹åœ¨æ­¤æœŸé—´æŠ¢åˆ°äº†ï¼Œå¹¶ä¸”å‘äº†notifyï¼Œåˆ™statusä¸º`no_timeout`ï¼Œå­çº¿ç¨‹breakç»“æŸã€‚æ­¤æƒ…å†µä¸‹åªèƒ½æ‰“å°ä¸€åŠã€‚\n        2. ä¹Ÿæœ‰å¯èƒ½ï¼šforæ¯æ¬¡å¾ªç¯ç»“æŸæ—¶ï¼Œé‡Šæ”¾é”ï¼Œä¸»çº¿ç¨‹åœ¨å¾ˆå°å¾ˆå°çš„ç©ºæŒ¡å†…æŠ¢åˆ°é”ï¼Œå¯¼è‡´æå‰notifyï¼Œé”™è¿‡cv2ç­‰å¾…çš„æ—¶æœºï¼Œä½†æ˜¯è¿™ä¸ªå¯èƒ½å¾ˆå°ã€‚æ­¤æƒ…å†µä¸‹1000ä¸ªæ•°å…¨éƒ¨è¾“å‡ºã€‚\n\n```cpp\n#include <condition_variable>\n#include <mutex>\n#include <iostream>\nstd::mutex mx, mx2;\nstd::condition_variable cv, cv2;\nusing namespace std::chrono_literals;\nint main()\n{\n    std::jthread t1([]() -> void\n    {\n        std::unique_lock lck{ mx };\n        cv.wait(lck);\n        std::cout << \"Got the Notify to Start!\" << std::endl;\n\n        for (int i = 0; i <= 1000; ++i)\n        {\n            std::cout << i << std::endl;\n\n            std::unique_lock lck2{ mx2 };\n            if (auto status = cv2.wait_for(lck2, 50ms);\n                status == std::cv_status::no_timeout)\n            {\n                std::cout << \"Got the Notify to Out!\" << std::endl;\n                break;\n            }\n            else\n            {\n                std::cout << \"Timeout: No Notify\" << std::endl;\n            }\n        }\n    });\n    std::this_thread::sleep_for(1s);\n    std::unique_lock lck{ mx };\n    cv.notify_one();\n    lck.unlock();\n    std::this_thread::sleep_for(3s);\n    std::unique_lock lck2{ mx2 };\n    cv2.notify_one();\n    lck2.unlock();\n}\n```\nè¾“å‡º\n```\nGot the Notify to Start!\n0\nTimeout: No Notify\n1\nTimeout: No Notify\n2\nTimeout: No Notify\n3\nTimeout: No Notify\n4\nTimeout: No Notify\n5\nTimeout: No Notify\n6\nTimeout: No Notify\n7\nTimeout: No Notify\n8\nTimeout: No Notify\n9\nTimeout: No Notify\n10\nTimeout: No Notify\n11\nTimeout: No Notify\n12\nTimeout: No Notify\n13\nTimeout: No Notify\n14\nTimeout: No Notify\n15\nTimeout: No Notify\n16\nTimeout: No Notify\n17\nTimeout: No Notify\n18\nTimeout: No Notify\n19\nTimeout: No Notify\n20\nTimeout: No Notify\n21\nTimeout: No Notify\n22\nTimeout: No Notify\n23\nTimeout: No Notify\n24\nTimeout: No Notify\n25\nTimeout: No Notify\n26\nTimeout: No Notify\n27\nTimeout: No Notify\n28\nTimeout: No Notify\n29\nTimeout: No Notify\n30\nTimeout: No Notify\n31\nTimeout: No Notify\n32\nTimeout: No Notify\n33\nTimeout: No Notify\n34\nTimeout: No Notify\n35\nTimeout: No Notify\n36\nTimeout: No Notify\n37\nTimeout: No Notify\n38\nTimeout: No Notify\n39\nTimeout: No Notify\n40\nTimeout: No Notify\n41\nTimeout: No Notify\n42\nTimeout: No Notify\n43\nTimeout: No Notify\n44\nTimeout: No Notify\n45\nTimeout: No Notify\n46\nTimeout: No Notify\n47\nTimeout: No Notify\n48\nGot the Notify to Out!\n```\n### é—®é¢˜\nä¸Šé¢é‚£ä¸ªç¨‹åºï¼Œç»è¿‡VSç¼–è¯‘è¿è¡Œåœ¨Windows11æ—¶ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼š\nï¼ˆä¸ºäº†è®©é—®é¢˜æ›´åŠ æ˜æ˜¾ï¼Œä¸»çº¿ç¨‹éƒ¨åˆ†ä»£ç æ”¹ä¸ºä»¥ä¸‹ï¼šåŠ é•¿äº†ç¬¬äºŒæ®µç¡çœ æ—¶é—´ï¼Œå¹¶ä¸”åœ¨ç¡çœ å‰ååŠ è¾“å‡ºæç¤ºï¼‰\n```cpp\nint main()\n{\n    // ...\n    std::this_thread::sleep_for(1s);\n    std::wcout << L\"After Sleep 1s...\" << std::endl;\n    \n    std::unique_lock lck{ mx };\n    cv.notify_one();\n    lck.unlock();\n    \n    std::wcout << L\"Before Sleep 8s...\" << std::endl;\n    std::this_thread::sleep_for(8s);\n    std::wcout << L\"After Sleep 8s...\" << std::endl;\n    std::unique_lock lck2{ mx2 };\n    cv2.notify_one();\n    lck2.unlock();\n}\n```\nä¸»çº¿ç¨‹æ˜æ˜8ç§’åæ‰ä¼šnotify_oneï¼Œä½†æ˜¯æŸæ—¶çš„è¾“å‡ºç»“æœä¸‹ï¼Œå±…ç„¶å¾ˆå¿«å°±è®©å­çº¿ç¨‹åœæ­¢äº†ï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ\nè§‚å¯Ÿè¾“å‡ºä¿¡æ¯ï¼Œå‘ç°ï¼Œä¸»çº¿ç¨‹è¿˜æ²¡è¾“å‡º`After Sleep 8s...`ï¼Œå­çº¿ç¨‹å°±è¢«é€šçŸ¥äº†ï¼Œè¯æ˜notifyè‚¯å®šä¸æ˜¯ä¸»çº¿ç¨‹å‘å‡ºçš„ã€‚\n```\nAfter Sleep 1s...\nBefore Sleep 8s...\nGot the Notify to Start!\n0\nTimeout: No Notify\n1\nTimeout: No Notify\n2\nTimeout: No Notify\n3\nTimeout: No Notify\n4\nTimeout: No Notify\n5\nGot the Notify to Out!\n\n```\n## å‡å”¤é†’\nåœ¨waitï¼ˆæ™®é€šã€forã€untilï¼‰ç­‰å¾…è¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹å¯èƒ½ä¼šå› ä¸ºå‡å”¤é†’è€Œæå‰è¢«å”¤é†’ï¼Œè€Œä¸æ˜¯å› ä¸ºæ¡ä»¶å˜é‡è¢«é€šçŸ¥ã€‚\n\nå‡å”¤é†’å¯ä»¥çœ‹ä½œæ˜¯æ“ä½œç³»ç»Ÿæ•…æ„æ›¿ç¨‹åºå‘˜`notify_one`ï¼Œä¼šè®©å­çº¿ç¨‹ä¼šè®¤ä¸º`wait_for`å·²ç»è¢«å”¤é†’ï¼Œä»è€Œé€€å‡ºå¾ªç¯ã€‚\n\n>æ™®é€šçš„`wait`åœ¨Windowsä¸‹ä¸ä¼šå‡å”¤é†’ã€‚è€Œåœ¨Unixã€Linuxã€Solarisã€AIXä¸­è¡Œä¸ºå¯èƒ½ä¼šä¸åŒã€‚\n\nåœ¨å½“å‰çš„ä»£ç ä¸­ï¼Œå½“`wait_for`è¿”å›æ—¶ï¼Œä»…é€šè¿‡æ£€æŸ¥`timeout`ä¸å¦æ¥å†³å®šæ˜¯å¦é€€å‡ºå¾ªç¯ã€‚å¦‚æœæ˜¯å› ä¸ºå‡å”¤é†’è€Œè¿”å›ï¼Œ`status == std::cv_status::no_timeout`å¯èƒ½ä¾ç„¶ä¸ºçœŸï¼Œè¿™ä¼šå¯¼è‡´çº¿ç¨‹æå‰ç»“æŸã€‚\n\nä¸ºäº†é˜²æ­¢å‡å”¤é†’å¸¦æ¥çš„é—®é¢˜ï¼Œé€šå¸¸çš„åšæ³•æ˜¯åœ¨ç­‰å¾…åæ£€æŸ¥å…±äº«æ¡ä»¶å˜é‡çŠ¶æ€æ˜¯å¦æ»¡è¶³ã€‚ä½ å¯ä»¥é€šè¿‡åœ¨`wait_for`ä¹‹åå†æ£€æŸ¥ä¸€ä¸ªboolæ ‡å¿—ï¼ˆä¾‹å¦‚`stop_requested`ï¼‰æ¥å†³å®šæ˜¯å¦é€€å‡ºå¾ªç¯ã€‚\nåœ¨ä¸Šé¢çš„ç¨‹åºä¸­ï¼Œåœ¨å…¨å±€åŒºå®šä¹‰å®ƒï¼Œåˆå€¼ä¸ºfalseï¼Œå¹¶ä¸”åœ¨`cv2.notify_one`è¯­å¥ä¹‹å‰ç½®ä¸ºtrueã€‚è¿™æ ·ï¼Œä¸ä»…è¦é€šè¿‡åˆ¤æ–­æ˜¯å¦timeoutï¼Œè¿˜è¦åˆ¤æ–­boolæ ‡å¿—ï¼Œä»¥ç¡®ä¿¡æ˜¯æˆ‘ä»¬è‡ªå·±å‘å‡ºçš„å”¤é†’ã€‚\n```cpp\n#include <condition_variable>\n#include <mutex>\n#include <iostream>\nstd::mutex mx, mx2;\nstd::condition_variable cv, cv2;\nbool stop_requested = false;\nusing namespace std::chrono_literals;\nint main()\n{\n    std::jthread t1([]() -> void\n    {\n        std::unique_lock lck{ mx };\n        cv.wait(lck);\n        std::cout << \"Got the Notify to Start!\" << std::endl;\n\n        for (int i = 0; i <= 1000; ++i)\n        {\n            std::cout << i << std::endl;\n\n            std::unique_lock lck2{ mx2 };\n            if (auto status = cv2.wait_for(lck2, 50ms);\n                status == std::cv_status::no_timeout && stop_requested == true)\n            {\n                std::cout << \"Got the Notify to Out!\" << std::endl;\n                break;\n            }\n            else\n            {\n                std::cout << \"Timeout: No Notify\" << std::endl;\n            }\n        }\n    });\n    std::this_thread::sleep_for(1s);\n    std::wcout << L\"After Sleep 1s...\" << std::endl;\n\n    std::unique_lock lck{ mx };\n    cv.notify_one();\n    lck.unlock();\n\n    std::wcout << L\"Before Sleep 8s...\" << std::endl;\n    std::this_thread::sleep_for(8s);\n    std::wcout << L\"After Sleep 8s...\" << std::endl;\n    \n    std::unique_lock lck2{ mx2 };\n    stop_requested = true;\n    cv2.notify_one();\n    lck2.unlock();\n}\n```\n### å¯ç”¨lambdaè¡¨è¾¾å¼ä½œä¸ºè°“è¯ç®€åŒ–ä»£ç \n```cpp\nwait(lck, [&stop_requested]() -> bool { return stop_requested; });\n```\nè¾“å‡º\n```\nAfter Sleep 1s...\nBefore Sleep 8s...\nGot the Notify to Start!\n0\nTimeout: No Notify\n1\nTimeout: No Notify\n2\nTimeout: No Notify\n3\nTimeout: No Notify\n4\nTimeout: No Notify\n5\nTimeout: No Notify\n6\nTimeout: No Notify\n7\nTimeout: No Notify\n8\nTimeout: No Notify\n9\nTimeout: No Notify\n10\nTimeout: No Notify\n11\nTimeout: No Notify\n12\nTimeout: No Notify\n13\nTimeout: No Notify\n14\nTimeout: No Notify\n15\nTimeout: No Notify\n16\nTimeout: No Notify\n17\nTimeout: No Notify\n18\nTimeout: No Notify\n19\nTimeout: No Notify\n20\nTimeout: No Notify\n21\nTimeout: No Notify\n22\nTimeout: No Notify\n23\nTimeout: No Notify\n24\nTimeout: No Notify\n25\nTimeout: No Notify\n26\nTimeout: No Notify\n27\nTimeout: No Notify\n28\nTimeout: No Notify\n29\nTimeout: No Notify\n30\nTimeout: No Notify\n31\nTimeout: No Notify\n32\nTimeout: No Notify\n33\nTimeout: No Notify\n34\nTimeout: No Notify\n35\nTimeout: No Notify\n36\nTimeout: No Notify\n37\nTimeout: No Notify\n38\nTimeout: No Notify\n39\nTimeout: No Notify\n40\nTimeout: No Notify\n41\nTimeout: No Notify\n42\nTimeout: No Notify\n43\nTimeout: No Notify\n44\nTimeout: No Notify\n45\nTimeout: No Notify\n46\nTimeout: No Notify\n47\nTimeout: No Notify\n48\nTimeout: No Notify\n49\nTimeout: No Notify\n50\nTimeout: No Notify\n51\nTimeout: No Notify\n52\nTimeout: No Notify\n53\nTimeout: No Notify\n54\nTimeout: No Notify\n55\nTimeout: No Notify\n56\nTimeout: No Notify\n57\nTimeout: No Notify\n58\nTimeout: No Notify\n59\nTimeout: No Notify\n60\nTimeout: No Notify\n61\nTimeout: No Notify\n62\nTimeout: No Notify\n63\nTimeout: No Notify\n64\nTimeout: No Notify\n65\nTimeout: No Notify\n66\nTimeout: No Notify\n67\nTimeout: No Notify\n68\nTimeout: No Notify\n69\nTimeout: No Notify\n70\nTimeout: No Notify\n71\nTimeout: No Notify\n72\nTimeout: No Notify\n73\nTimeout: No Notify\n74\nTimeout: No Notify\n75\nTimeout: No Notify\n76\nTimeout: No Notify\n77\nTimeout: No Notify\n78\nTimeout: No Notify\n79\nTimeout: No Notify\n80\nTimeout: No Notify\n81\nTimeout: No Notify\n82\nTimeout: No Notify\n83\nTimeout: No Notify\n84\nTimeout: No Notify\n85\nTimeout: No Notify\n86\nTimeout: No Notify\n87\nTimeout: No Notify\n88\nTimeout: No Notify\n89\nTimeout: No Notify\n90\nTimeout: No Notify\n91\nTimeout: No Notify\n92\nTimeout: No Notify\n93\nTimeout: No Notify\n94\nTimeout: No Notify\n95\nTimeout: No Notify\n96\nTimeout: No Notify\n97\nTimeout: No Notify\n98\nTimeout: No Notify\n99\nTimeout: No Notify\n100\nTimeout: No Notify\n101\nTimeout: No Notify\n102\nTimeout: No Notify\n103\nTimeout: No Notify\n104\nTimeout: No Notify\n105\nTimeout: No Notify\n106\nTimeout: No Notify\n107\nTimeout: No Notify\n108\nTimeout: No Notify\n109\nTimeout: No Notify\n110\nTimeout: No Notify\n111\nTimeout: No Notify\n112\nTimeout: No Notify\n113\nTimeout: No Notify\n114\nTimeout: No Notify\n115\nTimeout: No Notify\n116\nTimeout: No Notify\n117\nTimeout: No Notify\n118\nTimeout: No Notify\n119\nTimeout: No Notify\n120\nTimeout: No Notify\n121\nTimeout: No Notify\n122\nTimeout: No Notify\n123\nTimeout: No Notify\n124\nTimeout: No Notify\n125\nTimeout: No Notify\n126\nTimeout: No Notify\n127\nTimeout: No Notify\n128\nTimeout: No Notify\n129\nAfter Sleep 8s...\nGot the Notify to Out!\n\n```\n## wait_until\n```cpp\ntemplate <class Clock, class Duration>\ncv_status wait_until (unique_lock<mutex>& lck, const chrono::time_point<Clock,Duration>& abs_time);\n```\nå’Œ`wait_for`è¡Œä¸ºä¸€æ ·ï¼Œä¸åŒç‚¹åœ¨äºï¼š\n1. `wait_for`çš„æ—¶é—´æ˜¯æ—¶é—´æ®µã€é—´éš”ã€‚\n2. `wait_until`çš„æ—¶é—´æ˜¯æ—¶é—´ç‚¹ã€‚\n# future\nåœ¨æ ‡å¤´Â `<future>`Â ä¸­å®šä¹‰\n\né¡¾åæ€ä¹‰ï¼Œfutureå°±æ˜¯ä¸ºäº†ç”¨äºè·å–è¿”å›å€¼çš„ã€‚å†…éƒ¨åŒ…è£…äº†ä¸€ä¸ªä»»åŠ¡æˆ–å‡½æ•°ã€‚\n\nfutureæ˜¯ç»™æœŸå¾…æ–¹ä½¿ç”¨æ¥getè·å–å€¼çš„ã€‚\npromiseæ˜¯ç»™æ‰¿è¯ºæ–¹ä½¿ç”¨æ¥setè®¾ç½®å€¼çš„ã€‚\n\nä»¥ä¸‹ç¨‹åºè¡¨ç¤ºï¼šå­çº¿ç¨‹æœŸå¾…ä¸€ä¸ªå€¼ï¼Œæ­¤å€¼ç”±ä¸»çº¿ç¨‹æä¾›ã€‚é€šè¿‡ç»™å­çº¿ç¨‹ä¼ å…¥futureå®ç°ã€‚\nä¸»çº¿ç¨‹å®šä¹‰ä¸€ä¸ªpromiseï¼Œç”Ÿæˆä¸€ä¸ªè¯¥promiseçš„futureä¼ ç»™tå­çº¿ç¨‹å‡½æ•°ã€‚\nå­çº¿ç¨‹è°ƒç”¨`fut.get()`é˜»å¡å¼ç­‰å¾…ä¸»çº¿ç¨‹å¯¹futç›¸åº”çš„promiseå‘é€ä¿¡æ¯ã€‚\nä¸€æ—¦ä¸»çº¿ç¨‹å‘promiseå‘é€ä¿¡æ¯ï¼Œå­çº¿ç¨‹å°±ä¼šè¢«é€šçŸ¥ï¼Œéšåè¿”å›å¾—åˆ°valã€‚\n```cpp\n#include <future>\n#include <chrono>\nusing namespace std::chrono_literals;\nint main()\n{\n    std::promise<int> prom;\n    std::future<int> fut = prom.get_future();\n    std::jthread t([](std::future<int> fut) -> void\n        {\n            std::wcout << L\"Start & Wait...\" << std::endl;\n            int val = fut.get();\n            std::wcout << L\"Got a value: \" << val << std::endl;\n        }, std::move(fut));\n        \n    std::this_thread::sleep_for(5s);\n    prom.set_value(50);\n    std::this_thread::sleep_for(1s);\n}\n```\nè¾“å‡ºï¼š\n```\nStart & Wait...\nGot a value: 50\n```\n## shared_future\nç”¨`shared_future`å¯ä»¥è®©å¤šä¸ªçº¿ç¨‹åŒæ—¶ç›‘å¬ä¸€ä¸ªå…±äº«çš„futureã€‚\nè°ƒç”¨`fut.share()`å³å¯è·å¾—`shared_future`ç±»å‹çš„futureï¼Œå¯ä»¥ä¼ å…¥åˆ°çº¿ç¨‹å‡½æ•°ä¸­ä½¿ç”¨ã€‚\n\nä¸è¦å¤šæ¬¡è°ƒç”¨`fut.share()`ï¼Œå¦åˆ™ä¹‹å‰çš„`shared_future`ä¼šå¤±æ•ˆã€‚\n\n```cpp\nint main()\n{\n    std::promise<int> prom;\n    auto fut = prom.get_future();\n    auto shared_fut = fut.share();\n\n    std::jthread t1([](std::shared_future<int> shared_fut) -> void\n        {\n            std::wcout << L\"t1 Start & Wait...\" << std::endl;\n            auto val = shared_fut.get();\n            std::wcout << L\"t1 Got a value: \" << val << std::endl;\n        }, shared_fut);\n    std::jthread t2([](std::shared_future<int> shared_fut) -> void\n        {\n            std::wcout << L\"t2 Start & Wait...\" << std::endl;\n            auto val = shared_fut.get();\n            std::wcout << L\"t2 Got a value: \" << val << std::endl;\n        }, shared_fut);\n    std::this_thread::sleep_for(5s);\n    prom.set_value(50);\n    std::this_thread::sleep_for(1s);\n}\n```\nè¾“å‡ºï¼š\n```\nt2 Start & Wait...\nt1 Start & Wait...\nt2 Got a value: 50\nt1 Got a value: 50\n```\n## packaged_task\nç”¨äºä»å­çº¿ç¨‹è·å¾—è¾“å‡ºå€¼ã€‚\n\nä¸promiseä¸€æ ·ï¼Œpackaged_task æ˜¯æ‰¿è¯ºæ–¹ï¼Œæ˜¯ç»™å‡ºå€¼çš„ã€‚å¯ä»¥è°ƒç”¨get_futureè·å¾—å…¶å¯¹åº”çš„futureã€‚æœŸå¾…æ–¹å¯ä»¥é€šè¿‡æ­¤futureè·å–å…¶è¿”å›å€¼ã€‚\n\nåˆ›å»ºå­çº¿ç¨‹æ—¶ï¼Œä¼ å…¥å®šä¹‰å¥½çš„ packaged_taskï¼Œéœ€è¦`std::move`ç§»åŠ¨ã€‚\n\nä»¥ä¸‹ç¨‹åºè¡¨ç¤ºï¼šä¸»çº¿ç¨‹æœŸå¾…ä¸€ä¸ªå€¼ï¼Œæ­¤å€¼ç”±å­çº¿ç¨‹æä¾›ã€‚é€šè¿‡ç»™å­çº¿ç¨‹ä¼ å…¥ packaged_task å®ç°ã€‚\n```cpp\n#include <future>\nusing namespace std::chrono_literals;\nint main()\n{\n    std::packaged_task<int(int)> pkg{ [](int v) -> int\n        {\n            for (auto i = v; i >= 0; --i)\n            {\n                std::cout << i << std::endl;\n                std::this_thread::sleep_for(200ms);\n            }\n            return 3;\n        }};\n    \n    auto fut = pkg.get_future();\n    \n    std::jthread t(std::move(pkg), 50);\n    \n    int v = fut.get();          // block\n    std::wcout << L\"main thread got a value: \" << v << std::endl;\n}\n```\n## async\nç›¸å½“äºåŒ…è£…å¥½çš„`thread(packaged_task, ...)`ã€‚å¯ä»¥ç›´æ¥è¿”å›ä¸€ä¸ªfutureã€‚å¹¶ä¸”å®šä¹‰åç›¸å½“äºç›´æ¥åˆ›å»ºäº†å­çº¿ç¨‹ã€‚\n1. å‚æ•°1ï¼šLaunch Policy\n    1. æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼š`std::launch::deferred`ã€`std::launch::async`ã€‚\n    2. é»˜è®¤æ˜¯`std::launch::async`ï¼Œæ„ä¸ºç«‹å³æ‰§è¡Œã€‚\n    3. `std::launch::deferred`æ„ä¸ºåœ¨ä»–äºº`fut.get()`æ—¶æ‰æ‰§è¡Œã€‚\n2. å‚æ•°2ï¼šfn\n3. å‚æ•°3ï¼šå‡½æ•°å‚æ•°\n\nä»¥ä¸‹ç¨‹åºè¡¨ç¤ºï¼šä¸»çº¿ç¨‹æœŸå¾…ä¸€ä¸ªå€¼ï¼Œæ­¤å€¼ç”±å­çº¿ç¨‹æä¾›ã€‚é€šè¿‡asyncåˆ›å»ºå­çº¿ç¨‹å®ç°ã€‚\n```cpp\nint main()\n{\n    auto fut = std::async([](int v) -> int\n        {\n            for (auto i = v; i > 0; --i)\n            {\n                std::cout << i << std::endl;\n                std::this_thread::sleep_for(200ms);\n            }\n            return 3;\n        }, 50);\n    int v = fut.get();\n    std::wcout << L\"main thread got a value: \" << v << std::endl;\n}\n```\nä»¥ä¸Šæ˜¯asyncçš„ç®€å•åº”ç”¨ã€‚\n### å¼‚æ­¥ç‰¹æ€§ï¼ˆasyncï¼‰\nè¿˜æœ‰ä¸€äº›ç‰¹æ€§ï¼šæ‰€è°“å¼‚æ­¥ï¼Œå°±æ˜¯ä¸»çº¿ç¨‹ã€asyncåŠ¨ä½œäº’ä¸å¹²æ‰°ã€‚æ¯”å¦‚ï¼š\nasyncå¯åŠ¨åï¼Œä¸»çº¿ç¨‹æ‰“å°å†…å®¹è‡³å±å¹•ã€Sleepç­‰ç­‰ï¼Œä¸ä¼šå‡ºç°å’Œå­çº¿ç¨‹è¾“å‡ºçš„é”™ä¹±ï¼ˆé™¤äº†æ¢è¡Œä»¥å¤–ï¼‰ã€‚\n```cpp\nint main()\n{\n    auto fut = std::async([](int v) -> int\n        {\n            for (auto i = v; i > 0; --i)\n            {\n                std::cout << i << std::endl;\n                std::this_thread::sleep_for(200ms);\n            }\n            return 3;\n        }, 50);\n    \n    std::wcout << L\"main thread begin to Sleep...\" << std::endl;\n    std::this_thread::sleep_for(5s);\n    std::wcout << L\"main thread Wake up\" << std::endl;\n    int v = fut.get();\n    std::wcout << L\"main thread got a value: \" << v << std::endl;\n}\n```\nè¾“å‡ºï¼š\n```\nmain thread begin to Sleep...50\n\n49\n48\n47\n46\n45\n44\n43\n42\n41\n40\n39\n38\n37\n36\n35\n34\n33\n32\n31\n30\n29\n28\n27\n26\nmain thread Wake up\n25\n24\n23\n22\n21\n20\n19\n18\n17\n16\n15\n14\n13\n12\n11\n10\n9\n8\n7\n6\n5\n4\n3\n2\n1\nmain thread got a value: 3\n\n```\n### deferredç‰¹æ€§\nè‡³äº`std::launch::deferred`ã€‚ç»è¿‡æµ‹è¯•ï¼š\n```cpp\nint main()\n{\n    auto fut = std::async(std::launch::deferred,\n        [](int v) -> int\n        {\n            for (auto i = v; i > 0; --i)\n            {\n                std::cout << i << std::endl;\n                std::this_thread::sleep_for(200ms);\n            }\n            return 3;\n        }, 50);\n    \n    std::wcout << L\"main thread begin to Sleep...\" << std::endl;\n    std::this_thread::sleep_for(5s);\n    std::wcout << L\"main thread Wake up\" << std::endl;\n    int v = fut.get();\n    std::wcout << L\"main thread got a value: \" << v << std::endl;\n}\n```\nå‘ç°ï¼Œè¾“å‡ºï¼š\n```\nmain thread begin to Sleep...\nmain thread Wake up\n50\n49\n48\n47\n46\n45\n44\n43\n42\n41\n40\n39\n38\n37\n36\n35\n34\n33\n32\n31\n30\n29\n28\n27\n26\n25\n24\n23\n22\n21\n20\n19\n18\n17\n16\n15\n14\n13\n12\n11\n10\n9\n8\n7\n6\n5\n4\n3\n2\n1\nmain thread got a value: 3\n\n```\næ„å‘³ç€ï¼Œè¯¥å¯åŠ¨ç­–ç•¥è¡¨ç¤ºç­‰å¾…ä¸»çº¿ç¨‹å…ˆæ‰§è¡Œä¸€éƒ¨åˆ†å†…å®¹ï¼Œç›´åˆ°ä¸»çº¿ç¨‹å¼€å§‹`fut.get()`æ—¶ï¼Œasyncå†å¯åŠ¨ã€‚\n# ä¿¡å·é‡\n## ä¿¡å·é‡å’Œæ¡ä»¶å˜é‡çš„å¯¹æ¯”\næ¡ä»¶å˜é‡çš„åœºæ™¯ç”¨äºç²¾ç¡®æ§åˆ¶çº¿ç¨‹çš„åŒæ­¥ï¼Œé€‚åˆåŒæ­¥æ¡ä»¶æ›´å¤æ‚çš„åœºæ™¯ï¼ˆæ¡ä»¶å˜é‡å¯ä»¥æ­é…ä¸€ä¸ªè®¡æ•°å™¨æ¥è¾¾åˆ°ä¿¡å·é‡çš„æ•ˆæœï¼‰ã€‚\n\nä¿¡å·é‡çš„ä½¿ç”¨åœºæ™¯æ˜¯å¯ä»¥ç®€å•åœ°æ§åˆ¶å¯¹èµ„æºçš„å¹¶å‘è®¿é—®æ•°é‡ã€‚\n\næ¡ä»¶å˜é‡çš„ä½¿ç”¨è¾ƒä¸ºçµæ´»ï¼Œéœ€è¦æ‰‹åŠ¨ç²¾ç¡®æ§åˆ¶åŠ é”ã€‚\nè€Œä¿¡å·é‡çš„ä½¿ç”¨å°±å¾ˆç®€å•ï¼Œç®€å•åœ°å¯¹è®¡æ•°å™¨åŠ å‡å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚\n## API\n`C++20`å¼€å§‹ã€‚å®šä¹‰äº`<semaphore>`\næ ¹æ®cppreferenceï¼Œä¿¡å·é‡æ˜¯ä¸€ç§è½»é‡çº§åŒæ­¥åŸè¯­ï¼Œç”¨äºé™åˆ¶å¯¹å…±äº«èµ„æºçš„å¹¶å‘è®¿é—®ã€‚ä¿¡å·é‡ç›¸æ¯”æ¡ä»¶å˜é‡æ›´é«˜æ•ˆï¼Œå› ä¸ºæ¡ä»¶å˜é‡ç”¨åˆ°äº†mutexã€‚\nåˆ†ä¸¤ç§ï¼š\n1. `counting_semaphore`ï¼Œéè´Ÿå€¼ã€‚\n2. `binary_semaphore`ï¼ŒäºŒå€¼ã€‚\n\n```cpp\ntemplate<std::ptrdiff_t = /* implementation-defined */>\nclassÂ counting_semaphore;\n\nusingÂ binary_semaphoreÂ =Â std::counting_semaphore<1>;\n```\n## ç¤ºä¾‹ï¼šæ”¹å†™Windowsä¿¡å·é‡API\nç”¨`C++`çº¿ç¨‹åº“ä¿¡å·é‡æ”¹å†™â€”â€”ã€ŠWindows_å¤šçº¿ç¨‹ã€‹ä¸­[ç¤ºä¾‹ï¼šå¤šä¸ªè¿›åº¦æ¡åŒæ—¶åŠ¨ç”»](#ç¤ºä¾‹ï¼šå¤šä¸ªè¿›åº¦æ¡åŒæ—¶åŠ¨ç”»)\næ¯”å¦‚ï¼š`std::counting_semaphore<5> semaphore(3);`ä»£è¡¨æœ€å¤§å€¼ä¸º5ï¼Œåˆå§‹å€¼ä¸º3ã€‚å¦‚æœæœ€å¤§å€¼ä¸å¡«ï¼Œåˆ™é»˜è®¤ç»™ä¸€ä¸ªè¶…å¤§çš„æ•°ã€‚\nä»¥ä¸‹ä¾‹å­ï¼š`std::counting_semaphore<2> semaphore(2);`ä»£è¡¨æœ€å¤§å€¼ä¸º2ï¼Œåˆå§‹å€¼ä¸º2ã€‚\n```cpp\n#include <semaphore>\nstd::counting_semaphore<2> semaphore(2);\n\n// ...\n{\n    {\n        std::jthread t([]() -> void\n        {\n            std::unique_lock lck{ start_mx };\n            start_cv.wait(lck);\n            lck.unlock();\n            semaphore.acquire();\n            for (int i = 0; i < 100; ++i)\n            {\n                // ...\n            }\n            semaphore.release();\n        });\n    }\n}\n```\n## äºŒå€¼ä¿¡å·é‡å½“ä½œæ¡ä»¶å˜é‡ä½¿ç”¨\nå…¶å®å°±æ˜¯ï¼š`usingÂ binary_semaphoreÂ =Â std::counting_semaphore<1>;`\n```cpp\nstd::binary_semaphore bin_sema{ 0 };\n// ...\n{\n    // ...\n    case /* ... */:\n    {\n        std::jthread t([]() -> void\n        {\n            bin_sema.acquire();\n            bin_sema.release(1);\n            \n            semaphore.acquire();\n            for (int i = 0; i < 100; ++i)\n            {\n                // ...\n            }\n            semaphore.release();\n        });\n    }\n    // ...\n    case WM_KETDOWN:\n    {\n        if (wParam == 'F')\n        {\n            bin_sema.release(1);\n        }\n    }\n    \n}\n```\n# é—©é”ï¼ˆLatchï¼‰ã€å±éšœï¼ˆBarrierï¼‰\né—©é”å’Œå±éšœæ˜¯çº¿ç¨‹åè°ƒæœºåˆ¶ï¼Œå…è®¸ä»»æ„æ•°é‡çš„çº¿ç¨‹é˜»å¡ï¼Œç›´åˆ°é¢„æœŸæ•°é‡çš„çº¿ç¨‹åˆ°è¾¾ã€‚é—©é”ä¸èƒ½é‡å¤ä½¿ç”¨ï¼Œè€Œå±éšœå¯ä»¥é‡å¤ä½¿ç”¨ã€‚\n\nä¸»è¦ç”¨äºç­‰å¾…nä¸ªçº¿ç¨‹åˆ°ä½ï¼Œä¹‹ååšä¸€äº›äº‹æƒ…ã€‚\nå±éšœï¼ˆBarrierï¼‰ä½¿ç”¨ä¹‹åå¯ä»¥reseté‡æ–°ä½¿ç”¨ã€‚","categories":["æ“ä½œç³»ç»Ÿ","å¤šçº¿ç¨‹","Cpp","Modern"]},{"title":"Cpp_å³å€¼å¼•ç”¨_moveçš„å®ç°","url":"/Cpp/Cpp_å³å€¼å¼•ç”¨_moveçš„å®ç°/","content":"# å†…å®¹\n\n1. å³å€¼å¼•ç”¨çš„ä¾‹å­\n2. å³å€¼å¼•ç”¨çš„å®ç°\n\n# å³å€¼å¼•ç”¨çš„ä¾‹å­\n\n```c++\nusing namespace std;\nclass MyString\n{\n    char* str;\npublic:\n    MyString(const char* p = NULL) : str(NULL)\n    {\n        if(p != NULL)\n        {\n            int len = strlen(p) + 1;\n            str = new char[len];\n            strcpy_s(str, len, p);\n        }\n    }\n    MyString(const MyString & src) : str(NULL)\n    {\n        if(src.str != NULL)\n        {\n            int len = strlen(src.str) + 1;\n            str = new char[len];\n            strcpy_s(str, len, src.str);\n        }\n    }\n    MyString(MyString && src) : str(src.str)\n    {\n        src.str = NULL;\n    }\n    ~MyString()\n    {\n        if(str != NULL)\n        {\n            delete[]str;\n        }\n        str = NULL;\n    }\n}\nint main()\n{\n    MyString s1(\"xcgong\");\n    MyString s2(s1);\n    MyString s3(std::move(s1));\t//å®è´¨ä¸Šæ˜¯æŠŠs1â€œå¼ºè½¬â€ä¸º å³å€¼å¼•ç”¨ æ‰èƒ½è¿›è¡Œç§»åŠ¨æ„é€ \n    \n    \n}\n```\n\n# moveçš„å®ç°\n\n```c++\ntemplate<class _Ty>\nstruct my_remove_reference\n{\n    using type = _Ty;\n    using _Const_thru_ref_type = const _Ty;\n}\ntemplate<class _Ty>\nstruct my_remove_reference<_Ty&>\n{\n    using type = _Ty;\n    using _Const_thru_ref_type = const _Ty &;\n}\ntemplate<class _Ty>\nstruct my_remove_reference<_Ty&&>\n{\n    using type = _Ty;\n    using _Const_thru_ref_type = const _Ty &&;\n}\n\ntemplate<class _Ty>\nusing my_remove_reference_t = typename my_remove_reference<_Ty>::type;\n//my_remove_reference_t<Object> --> my_remove_reference<Object>::type;\ntemplate<class _Ty>\nmy_remove_reference_t<_Ty>&& my_move(_Ty && _Arg)\n{\n    \t\t\t\t\t\t\t\t//å¼ºè½¬ä¸º_Tyçº¯ç²¹ç±»å‹çš„å³å€¼å¼•ç”¨å½¢å¼\n    return static_cast<my_remove_reference_t<_Ty> &&>(_Arg);\n}\nint main()\n{\n    MyString s1(\"xcgong\");\n    MyString s2(xcg::my_move(s1));\n/*\n\tmy_move  ->\n\t    return static_cast<my_remove_reference_t<_Ty> &&>(_Arg);\n\t\t\tmy_remove_reference_t<_Ty>  ->\n\t\t\t\tmy_remove_reference<_Ty>::type  ->\n\t\t\t\t\tmy_remove_reference<MyString>::type  ->\n\t\t\t\t\t\ttype == _Ty -> \"MyString\"\n\t--> return static_cast<MyString &&>(_Arg);\n\tæ•ˆæœ: _Arg ç”± MyString è½¬ä¸º MyString &&\t\nåˆ™--MyString s2(xcg::my_move(s1))--ç­‰æ•ˆäº:\n\tMyString s2( (MyString &&)s1);\n\t\tè°ƒç”¨ï¼šMyString(MyString && src), å³ç§»åŠ¨æ„é€ ã€‚è¿›è¡Œèµ„æºæ‹¥æœ‰æƒçš„è½¬ç§»\n*/\n}\n```\n\n# å¼•ç”¨ç±»å‹ä¸æ¨¡æ¿ç»“åˆ\n\nå¯æµ‹è¯•`is_lvalue_reference`ï¼Œè¿™æ˜¯ä¸ªæ¨¡æ¿ç±»ï¼Œå®šä¹‰äº`<type_traits>`ä¸­ã€‚\n```cpp\n#include <iostream>\n#include <type_traits>\n \nclass A {};\n \nint main()\n{\n    std::cout << std::boolalpha;\n    std::cout << std::is_lvalue_reference<A>::value << '\\n';\n    std::cout << std::is_lvalue_reference<A&>::value << '\\n';\n    std::cout << std::is_lvalue_reference<A&&>::value << '\\n';\n    std::cout << std::is_lvalue_reference<int>::value << '\\n';\n    std::cout << std::is_lvalue_reference<int&>::value << '\\n';\n    std::cout << std::is_lvalue_reference<int&&>::value << '\\n';\n}\n/* Output:\n    false\n    true\n    false\n    false\n    true\n    false\n*/\n```\nå¯æµ‹è¯•`is_rvalue_reference`ï¼Œè¿™æ˜¯ä¸ªæ¨¡æ¿ç±»ï¼Œå®šä¹‰äº`<type_traits>`ä¸­ã€‚\n```cpp\n#include <type_traits>\n#include <iostream>\n \nclass A {};\n \nstatic_assert\n(\n    std::is_rvalue_reference_v<A> == false and\n    std::is_rvalue_reference_v<A&> == false and\n    std::is_rvalue_reference_v<A&&> != false and\n    std::is_rvalue_reference_v<char> == false and\n    std::is_rvalue_reference_v<char&> == false and\n    std::is_rvalue_reference_v<char&&> != false\n);\n \n \n \ntemplate <typename T>\nvoid test(T&& x)\n{\n    static_assert(std::is_same_v<T&&, decltype(x)>);\n    std::cout << \"T\\t\" << std::is_rvalue_reference<T>::value << '\\n';\n    std::cout << \"T&&\\t\" << std::is_rvalue_reference<T&&>::value << '\\n';\n    std::cout << \"decltype(x)\\t\" << std::is_rvalue_reference<decltype(x)>::value << '\\n';\n}\n \nint main()\n{\n    std::cout << std::boolalpha;\n    std::cout << \"A\\t\" << std::is_rvalue_reference<A>::value << '\\n';\n    std::cout << \"A&\\t\" << std::is_rvalue_reference<A&>::value << '\\n';\n    std::cout << \"A&&\\t\" << std::is_rvalue_reference<A&&>::value << '\\n';\n    std::cout << \"char\\t\" << std::is_rvalue_reference<char>::value << '\\n';\n    std::cout << \"char&\\t\" << std::is_rvalue_reference<char&>::value << '\\n';\n    std::cout << \"char&&\\t\" << std::is_rvalue_reference<char&&>::value << '\\n';\n \n    std::cout << \"\\ntest(42)\\n\";\n    test(42);\n \n    std::cout << \"\\ntest(x)\\n\";\n    int x = 42;\n    test(x);\n}\n/*\n    A\tfalse\n    A&\tfalse\n    A&&\ttrue\n    char\tfalse\n    char&\tfalse\n    char&&\ttrue\n     \n    test(42)\n    T\tfalse\n    T&&\ttrue\n    decltype(x)\ttrue\n     \n    test(x)\n    T\tfalse\n    T&&\tfalse\n    decltype(x)\tfalse\n*/\n```\n\n```cpp\ntemplate<class T>\nvoid fac(T &&a)\n{\n    \n}\n```","categories":["Cpp","å³å€¼å¼•ç”¨"]},{"title":"Cpp_ç±»å‹è½¬æ¢","url":"/Cpp/Cpp_ç±»å‹è½¬æ¢/","content":"# å†…å®¹\n1. æ€»è¿°\n2. é€šè¿‡å•å‚æ•°çš„æ„é€ å‡½æ•°å®ç°ç±»å‹è½¬æ¢\n3. é€šè¿‡ç±»å‹è½¬æ¢è¿ç®—ç¬¦å®ç°ç±»å‹è½¬æ¢\n4. explicit\n5. éšå¼è½¬æ¢\n6. å››ä¸ªå…³é”®å­—\n    1. `static_cast`\n    2. `const_cast`\n    3. `reinterpret_cast`\n    4. `dynamic_cast`\n# ç±»å‹è½¬æ¢è¿ç®—ç¬¦\nä½¿ç”¨æ¥æ”¶å•å‚æ•°çš„æ„é€ å‡½æ•°æ‰§è¡Œç±»å‹è½¬æ¢è™½ç„¶ä¾¿æ·ï¼Œä½†æœ‰æ—¶å€™å¹¶éå¦‚æ„¿ã€‚\nå¹¶ä¸”æ„é€ å‡½æ•°æ— æ³•æŒ‡å®šï¼š\n1. ä»ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹å‘å†…ç½®ç±»å‹çš„éšå¼è½¬æ¢ï¼ˆå› ä¸ºå†…ç½®ç±»å‹ä¸æ˜¯ç±»ï¼‰\n2. ä»æ–°ç±»åˆ°å…ˆå‰å®šä¹‰çš„ç±»çš„è½¬æ¢ï¼Œï¼ˆè€Œä¸ä¿®æ”¹æ—§ç±»çš„å£°æ˜ï¼Ÿï¼‰ã€‚\n\næˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸ºæºç±»å‹å®šä¹‰ä¸€ä¸ªç±»å‹è½¬æ¢è¿ç®—ç¬¦(conversion operator)æ¥è§£å†³ä¸Šè¿°é—®é¢˜ã€‚æˆå‘˜å‡½æ•°`X::operator T()`å®šä¹‰äº†ä»Xåˆ°Tçš„ç±»å‹è½¬æ¢ï¼Œå…¶ä¸­Tæ˜¯ä¸€ä¸ªç±»å‹åã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ç§åªå 6ä¸ªäºŒè¿›åˆ¶ä½çš„æ•´æ•°Tinyã€‚æˆ‘ä»¬å¸Œæœ›åœ¨ç®—æœ¯è¿ç®—ä¸­å®ƒå¯ä»¥å’Œæ™®é€šçš„æ•´æ•°å®Œç¾åœ°èåˆåœ¨ä¸€èµ·ï¼Œå¹¶ä¸”å½“Tinyçš„å€¼è¶…å‡ºå…¶èŒƒå›´æ—¶æŠ›å‡º`Bad_range`å¼‚å¸¸ï¼š\n\n```c++\nclass Tiny\n{\n    char v;\n    void assign(int i)\n    {\n        // æ£€æŸ¥æ˜¯å¦è¶Šç•Œ\n        if(i & ~077) throw Bad_range();\n        v = i;\n    }\n    class Bad_range{};\n    Tiny(int i)\t\t\t\t//ç”¨intæ„é€ Tiny\n    {\n        assign(i);\n    }\n    Tiny & operator=(int i)\t//intèµ‹å€¼ç»™Tiny\n    {\n        assign(i);\n        return *this;\n    }\n    //é»˜è®¤çš„æ‹·è´æ„é€  å’Œ åŒç±»èµ‹å€¼é‡è½½\n    Tiny(const Tiny&) = default;\n    Tiny & operator=(const Tiny&) = default;\n    operator int() const\n    {\n        return v;\t//conversion to int\n    }\n}\n```\n\nç”¨intåˆå§‹åŒ–Tinyæˆ–è€…ç»™å®ƒèµ‹å€¼æ—¶è¿›è¡Œè¶Šç•Œæ£€æŸ¥ï¼ˆæº¢å‡ºï¼ŒåŒ…æ‹¬ä¸Šæº¢ã€ä¸‹æº¢ï¼‰ã€‚ç›¸åï¼Œå½“æ‹·è´Tinyçš„æ—¶å€™æ— é¡»æ£€æŸ¥æ˜¯å¦è¶Šç•Œï¼Œå› æ­¤é»˜è®¤çš„æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—æ˜¯æ­£ç¡®çš„ï¼Œæ— é¡»ä¿®æ”¹ã€‚\n\nä¸ºäº†è®©Tinyå¯ä»¥ä½¿ç”¨intçš„å¸¸è§„æ“ä½œï¼Œæˆ‘ä»¬å®šä¹‰äº†ä»Tinyå‘intçš„éšå¼ç±»å‹è½¬æ¢`Tiny::operator int()`ã€‚è¯·æ³¨æ„ï¼Œç›®æ ‡ç±»å‹å·²ç»ä½œä¸ºè¿ç®—ç¬¦åå­—çš„ä¸€éƒ¨åˆ†å‡ºç°ï¼Œå› æ­¤ä¸å¿…å†é‡å¤å‡ºç°åœ¨è½¬æ¢å‡½æ•°è¿”å›å€¼çš„ä½ç½®äº†ã€‚\n\n```c++\nTiny::operator int() const {return v;}\t\t//æ­£ç¡®\nint Tiny::operator int() const {return v;}\t//é”™è¯¯ï¼Œæ²¡å¿…è¦åŠ è¿”å›ç±»å‹\n```\n\nä»è¿™å±‚æ„ä¹‰ä¸Šæ¥è¯´ï¼Œç±»å‹è½¬æ¢è¿ç®—ç¬¦ç±»ä¼¼äºæ„é€ å‡½æ•°ã€‚\n\nå¦‚æœåœ¨éœ€è¦intçš„åœ°æ–¹å‡ºç°äº†Tinyï¼Œå®ƒä¼šè‡ªåŠ¨è½¬æ¢ä¸ºå¯¹åº”çš„intå€¼ã€‚ä¾‹å¦‚ï¼š\n\n```c++\nint main()\n{\n    Tiny c1 = 2;\t\t//è°ƒç”¨ Tiny(int)\n    Tiny c2 = 62;\n    Tiny c3 = c2 - c1;\n    Tiny c4 = c3;\n    int i = c1 + c2;\t//è°ƒç”¨ operator int()\n    c1 = c1 + c2;\t\t\n    i = c3 - 64;\t\t//è°ƒç”¨ operator int()\n    c2 = c3 - 64;\n    c3 = c4;\n}\n```\n\né€šå¸¸æƒ…å†µä¸‹ï¼Œæœ€å¥½å°½é‡é¿å…ä½¿ç”¨ç±»å‹è½¬æ¢è¿ç®—ç¬¦ï¼Œä¸€æ—¦è¿‡åº¦ä½¿ç”¨çš„è¯å¯èƒ½å¼•èµ·ç¨‹åºçš„äºŒä¹‰æ€§ã€‚å¦‚æœæ—¢æœ‰ç”¨æˆ·è‡ªå®šä¹‰çš„ç±»å‹è½¬æ¢å‡½æ•°ï¼Œåˆæœ‰ç”¨æˆ·è‡ªå®šä¹‰çš„è¿ç®—ç¬¦ï¼Œåˆ™è¿™ä¸¤è€…é—´å¯èƒ½äº§ç”ŸäºŒä¹‰æ€§ã€‚ä¾‹å¦‚ï¼š\n\n```c++\nint operator+(Tiny, Tiny);\nvoid f(Tiny t, int i)\n{\n    t + i;\t//é”™è¯¯ï¼ŒäºŒä¹‰æ€§é—®é¢˜ï¼š\"operator+(t, Tiny(i))\" è¿˜æ˜¯ \"int(t)+i\" ?\n}\n```\n\nå› æ­¤ï¼Œå¯¹äºæŸç§ç»™å®šçš„æ•°æ®ç±»å‹ï¼Œæœ€å¥½ä¸è¦åŒæ—¶æä¾›ç”¨æˆ·è‡ªå®šä¹‰çš„ç±»å‹è½¬æ¢å’Œç”¨æˆ·è‡ªå®šä¹‰çš„è¿ç®—ç¬¦ï¼Œåœ¨å®ƒä»¬ä¹‹é—´é€‰æ‹©ä¸€ç§å³å¯ã€‚\n\n# explicitç±»å‹è½¬æ¢è¿ç®—ç¬¦\n\nç±»å‹è½¬æ¢è¿ç®—ç¬¦ä¹Ÿè®¸èƒ½ç”¨åœ¨ä»£ç çš„ä»»ä½•åœ°æ–¹ã€‚ç„¶è€Œï¼Œæœ€ä¼˜çš„é€‰æ‹©æ˜¯æŠŠç±»å‹è½¬æ¢è¿ç®—ç¬¦å£°æ˜æˆexplicitå¹¶ä¸”æ˜ç¡®åªæœ‰å½“**ç›´æ¥åˆå§‹åŒ–**æ—¶æ‰èƒ½ä½¿ç”¨å®ƒï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æ­¤å¤„ä½¿ç”¨ç­‰ä»·çš„excplictæ„é€ å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œæ ‡å‡†åº“unique_ptrå«æœ‰ä¸€ä¸ªè½¬æ¢ç›®æ ‡ä¸ºboolçš„è½¬æ¢è¿ç®—ç¬¦ã€‚\n\n```c++\ntemplate<typename T, typename D = default_delete<T>>\nclass unique_ptr\n{\npublic:\n    // ...\n    explicit operator bool() const noexcept;\t//\n};\n```\n\nä¹‹æ‰€ä»¥æŠŠè¿™ä¸ªç±»å‹è½¬æ¢è¿ç®—ç¬¦å£°æ˜æˆexplicitæ˜¯å› ä¸ºä»–å¯èƒ½å‡ºç°åœ¨æŸäº›æ„æƒ³ä¸åˆ°çš„ä¸Šä¸‹æ–‡ä¸­ã€‚\n\n```c++\nvoid use(unique_ptr<Record> p, unique_ptr<int> q)\n{\n    if(!p)\t\t\t//è¿™æ˜¯æ­£ç¡®çš„ç”¨æ³•ï¼Œ!p è°ƒç”¨ operator bool()\n        throw Invalid_unique_ptr{};\n    bool b = p;\t\t//ç¦æ­¢çš„ç”¨æ³•\tç¦æ­¢æŠŠpéšå¼è½¬æ¢ä¸ºbool\n    int x = p+q;\t//ç¦æ­¢çš„ç”¨æ³•\tç¦æ­¢æŠŠpã€qéšå¼è½¬æ¢ä¸ºbool/int\n}\n```\n# å››ä¸ªcastå…³é”®å­—\n## static_cast\n### ç”¨ä¸åŸºæœ¬ç±»å‹é—´çš„è½¬æ¢\nè¿™äº›åŸºæœ¬ç±»å‹å¤§éƒ½å¯ä»¥è¿›è¡Œéšå¼è½¬æ¢ã€‚å¦‚æŠŠintè½¬æ¢ä¸ºcharï¼ŒæŠŠintè½¬æ¢ä¸ºfloat/doubleã€‚\n\n```c++\nint main()\n{\n    float f = 12.23;\n    int a = (int)f;\t\t//è™½ç„¶è¾¾åˆ°äº†å¼ºè½¬çš„æ•ˆæœï¼Œä½†æ˜¯å¼ºè½¬çš„ç›®çš„æ²¡æœ‰å†™å‡º\n    int b = static_cast<int>f;\n}\n```\n\n```cpp\nint main()\n{\n    int a = 10;\n    char ch = 'a';\n    double dx = 12.23;\n    \n    a = ch;//ok\n    ch = a;//ok\n    a = static_cast<int>(ch);//ok\n    ch = static_cast<char>(a);//ok\n    \n    a = dx;//ok\n    dx = a;//ok\n    a = static_cast<int>(dx);//ok\n    dx = static_cast<double>(dx);//ok\n}\n```\n### ç”¨äºæŒ‡é’ˆè½¬æ¢\n\n```cpp\nint main()\n{\n    int a = 10;\n    int * ip = nullptr;\n    ip = &a;//ok\n    ip = (int*)&a;//æœ‰è„±è£¤å­æ”¾å±çš„å«Œç–‘;\n    ip = static_cast<int*>(&a);//ok\n}\n```\n\n```cpp\nint main()\n{\n    const int a = 10;\n    int * ip = nullptr;\n    ip = &a;//error\n    ip = (int*)&a;//ok, cè¯­è¨€åŸç”Ÿæ–¹æ³•\n    ip = static_cast<int*>(&a);//error, aæ˜¯ä¸€ä¸ªconsté‡\n    return 0;\n}\n```\n\n```cpp\nint main()\n{\n    const int a = 10;\n    const int * ip = nullptr;\n    ip = &a;//ok\n    ip = (int*)&a;//ok, const int * å¯ä»¥æ¥æ”¶int *\n    ip = static_cast<const int*>(&a);//ok\n}\n```\n\n```cpp\nint main()\n{\n    int a = 10;\n    char * cp = nullptr;\n    cp = static_cast<char*>(&a);//error, å¯¹äºæŒ‡é’ˆç±»å‹, int*å’Œchar*ä¸åŒã€‚\n}\n```\n### æ€»ç»“\nç»¼ä¸Šæ‰€è¿°ï¼Œ`static_cast`ä¸ä»…èƒ½é’ˆå¯¹åŸºæœ¬ç±»å‹ï¼Œè¿˜å¯ä»¥è¿›è¡Œé’ˆå¯¹æŒ‡é’ˆç±»å‹ï¼Œè¦æ±‚åªæœ‰ä¸€ä¸ªï¼Œå³`static_cast`è¿›è¡Œçš„ç±»å‹è½¬æ¢ï¼Œç»“æœæ¥å—è€…å’Œè½¬æ¢è€…çš„ç±»å‹è¦ç›¸åŒï¼Œæˆ–ç›¸äº’ä¹‹é—´å¯ä»¥è¿›è¡Œéšå¼è½¬æ¢ã€‚\n### static_castä¸èƒ½å»å¸¸æ€§\n\n```cpp\nint main()\n{\n    const int a = 10;\n    int * p = nullptr;\n    p = static_cast<const int*>(&a);//error, pæ˜¯int *, è€Œ&aæ˜¯const int *ç±»å‹, int *ä¸èƒ½æ¥æ”¶const int *\n    p = static_cast<int*>(&a);//error, static_castæ²¡æœ‰å»å¸¸æ€§çš„ç”¨æ³•, è¦ç”¨const_castæ‰è¡Œã€‚\n}\n```\n### å¼•ç”¨ä¹‹é—´çš„è½¬æ¢\n\nå¯ä»¥æŠŠå·¦å€¼å¼ºè½¬ä¸ºå³å€¼å¼•ç”¨ã€‚\n\n```cpp\nint main()\n{\n    int a = 10;\n    int & b = static_cast<int&>(a);\n    int && c = static_cast<int&&>(a);//ç›¸å½“äºint && c = (int&&)a;\n}\n```\n\n### `void*`ä¹‹é—´çš„è½¬æ¢ - ä¸å®‰å…¨\n\n```cpp\nint main()\n{\n    int a = 10;//å 4ä¸ªå­—èŠ‚\n    void * vp = &a;\n    char * cp = static_cast<char*>(vp);//æŠŠæ— ç±»å‹æŒ‡é’ˆè½¬ä¸ºäº†char*ç±»å‹, ä»¥1å­—èŠ‚è§£æåŸæ¥çš„4å­—èŠ‚\n    float * fp = static_cast<float*>(vp);//æŠŠæ— ç±»å‹æŒ‡é’ˆè½¬ä¸ºäº†float*ç±»å‹, ä»¥4å­—èŠ‚è§£æåŸæ¥çš„4å­—èŠ‚, ä½†æ˜¯è§£ææ–¹å¼æ˜¯æŠŠåŸæ¥çš„4å­—èŠ‚intå†…å®¹çœ‹ä½œfloatå†…å®¹\n    double * dp = static_cast<double*>(vp);//æŠŠæ— ç±»å‹æŒ‡é’ˆè½¬ä¸ºäº†double*ç±»å‹, ä»¥8å­—èŠ‚è§£æåŸæ¥çš„4å­—èŠ‚\n}\n```\n\n### è½¬ä¸ºvoid - ä»¥å¼ƒå€¼ä¸ºç›®çš„çš„è½¬æ¢\n\næŠŠä¸€ä¸ªå€¼è½¬ä¸ºvoidç±»å‹ï¼Œè¯­ä¹‰æ˜¯æˆ‘ä»¬ä¸éœ€è¦è¿™ä¸ªå€¼ï¼Œå³åºŸå¼ƒã€‚\n\n```cpp\nint main()\n{\n    int a = 10, b = 20;\n    static_cast<void>(a + b);\n}\n```\n\n### ç»§æ‰¿å…³ç³»ä¸­çš„è½¬æ¢\n\n```cpp\nclass Base\n{\nprivate:\n    int value;\npublic:\n    Base(int x = 0) : value(x) {}\n}\nclass Derived : public Base\n{\nprivate:\n    int num;\npublic:\n    Derived(int x = 0) : Base(x + 10), num(x) {}\n}\n```\n\nåŸºäºå…¬æœ‰ç»§æ‰¿ï¼Œçˆ¶å¯¹è±¡å’Œå­å¯¹è±¡ä¹‹é—´å…·å¤‡èµ‹å€¼å…¼å®¹æ€§è§„åˆ™ã€‚\n\n```cpp\nint main()\n{\n    Base * bp = nullptr;\n    Derived * dp = nullptr;\n    Base b;\n    Derived d;\n    \n    bp = &b;//ok, çˆ¶æŒ‡é’ˆæŒ‡å‘çˆ¶å¯¹è±¡\n    bp = &d;//ok, çˆ¶æŒ‡é’ˆæŒ‡å‘å­å¯¹è±¡\n    \n    bp = static_cast<Base*>(&b);//ok\n    bp = static_cast<Derived*>(&d);//ok\n    \n}\n```\n\né€šè¿‡ä»¥ä¸Šä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼Œå­å¯¹è±¡æŒ‡é’ˆå¯èµ‹ç»™çˆ¶æŒ‡é’ˆï¼Œè¿™åœ¨ç»§æ‰¿å…³ç³»ä¸­æ˜¯ä¸Šè¡Œè½¬æ¢ã€‚è¿™åœ¨`static_cast`ä¸­æ˜¯åˆæ³•çš„ã€å®‰å…¨çš„ã€‚é‚£ä¹ˆä¸‹è¡Œè½¬æ¢å‘¢ï¼Ÿ\n\n```cpp\nint main()\n{\n    Base * bp = nullptr;\n    Derived * dp = nullptr;\n    Base b;\n    Derived d;\n    \n    dp = static_cast<Base*>(bp);//å¯ä»¥ç¼–è¯‘é€šè¿‡, ä½†æ˜¯è¯­ä¹‰ä¸Šæ˜¯é”™è¯¯çš„ã€‚ç›¸å½“äºç”¨8å­—èŠ‚çš„derivedå¼ºè¡Œè§£é‡Šbaseçš„4å­—èŠ‚å†…å®¹è¢«ã€‚\n}\n```\n\n![è§£é‡Šè¶Šç•Œ](../../images/Cpp_ç±»å‹è½¬æ¢/è§£é‡Šè¶Šç•Œ.png)\n\nå¦‚å›¾æ‰€ç¤ºï¼Œdpæœ¬ä»¥ä¸ºå®ƒæŒ‡å‘çš„åŒºåŸŸæ˜¯ä¸€ä¸ªderivedå¯¹è±¡ï¼Œå®é™…ä¸Šï¼Œå®ƒæŒ‡å‘çš„åªæ˜¯ä¸€ä¸ªbaseå¯¹è±¡ï¼Œåªæ‹¥æœ‰4å­—èŠ‚ã€‚åˆ™dpè§£é‡Šæ­¤åŒºåŸŸæ—¶ï¼Œä¼šæŠŠvalue4å­—èŠ‚ä¸‹é¢çš„4å­—èŠ‚ä¹Ÿè§£é‡Šåˆ°ã€‚å®é™…ä¸Šï¼Œä¸‹é¢é¢å¤–çš„4ä¸ªå­—èŠ‚ä¸å½’è¿™ä¸ªå¯¹è±¡ç®¡ç†ï¼Œè¿™å°±é€ æˆäº†è¯­ä¹‰é”™è¯¯ã€‚å› æ­¤ï¼Œä¸å¯ä»¥æŠŠçˆ¶åœ°å€ä¼ ç»™å­æŒ‡é’ˆã€‚ä½†æ˜¯`static_cast`ä¸èƒ½æ£€æŸ¥è¿™ä¸ªé”™è¯¯çš„è¯­ä¹‰ã€‚\n\nè¦æ£€æŸ¥è¿™ä¸ªè¯­ä¹‰é”™è¯¯ï¼Œéœ€è¦ä½¿ç”¨`dynamic_cast`åŠ¨æ€è½¬æ¢ã€‚\n## const_cast\nè¯¥å…³é”®å­—å¯ä»¥ç”¨æ¥ä¿®æ”¹ç±»å‹çš„constå±æ€§æˆ–volatileå±æ€§ã€‚\n```c++\nint main()\n{\n    const int a = 10;\n    int * p = (int*)&a;\t//è™½ç„¶è¾¾åˆ°äº†å¼ºè½¬çš„æ•ˆæœï¼Œä½†æ˜¯å¼ºè½¬çš„ç›®çš„æ²¡æœ‰å†™å‡º\n    int * q = const_cast<int*>&a;\t//æ­¤å¤„æ˜ç¡®æŒ‡å‡ºconst_cast:ç›®çš„æ˜¯å»å¸¸æ€§ã€‚\n}\n```\n\n```cpp\nint main()\n{\n    const int a = 10;\n    int x = const_cast<int>(a);//error, è„±è£¤å­æ”¾å±, å¤šæ­¤ä¸€ä¸¾, aæœ¬æ¥å°±æ˜¯intä¸å¸¦å¸¸æ€§ã€‚\n}\n```\n\n```cpp\nint main()\n{\n    const int a = 10;\n    const int * cp = &a;\n    int * p = const_cast<int*>(&a);//ok\n    int * p = const_cast<int*>(cp);//ok\n}\n```\n\n```cpp\nint main()\n{\n    const int & cr = a;\n    int & r = const_cast<int&>(cr);//ok\n    int && rr = const_cast<int&&>(cr);//ok\n}\n```\n## reinterpret_cast\n\næŒ‡æ˜äº†æˆ‘ä»¬è¦æ‹¿æ–°ç±»å‹æ–¹å¼å»è§£é‡ŠåŸæœ‰æ•°æ®ã€‚æ¯”å¦‚ä¸‹é¢ä»£ç ï¼ŒåŸæ¥cpçš„ç±»å‹æ˜¯`char *`æŒ‡é’ˆï¼Œè§£é‡Šå†…å­˜å†…å®¹æ˜¯æŒ‰ç…§ä¸€å­—èŠ‚è§£é‡Šï¼Œå¹¶ä¸”è¾“å‡ºæ—¶è¿˜ä¼šè½¬ä¹‰ä¸ºç›¸åº”å­—ç¬¦ã€‚\n\nå’Œcè¯­è¨€çš„å¼ºè½¬æœ‰ä¸€æ‹¼ï¼Œä½†æ˜¯åªé€‚ç”¨äºæŒ‡é’ˆå’Œå¼•ç”¨ï¼Œä¸é€‚ç”¨äºåŸºæœ¬æ•°æ®ç±»å‹ã€‚\n\nè€Œç»è¿‡ç±»å‹å¼ºè½¬ï¼Œç”¨`int *`æŒ‡é’ˆå»è§£é‡ŠcpæŒ‡å‘çš„åŸå§‹å†…å®¹ï¼Œæ¯”å¦‚`'a'`å°±å˜ä¸ºäº†97ã€‚\n\n```c++\nint main()\n{\n    char c = 'a';\n    char * cp = &c;\n    //int * ip = (int*)cp;\t//è™½ç„¶è¾¾åˆ°äº†å¼ºè½¬çš„æ•ˆæœï¼Œä½†æ˜¯å¼ºè½¬çš„ç›®çš„æ²¡æœ‰å†™å‡º\n    int * ip = reinterpret_cast<int*>cp;\n}\n```\n\n```cpp\nint main()\n{\n    int a = 10;\n    char ch = 'x';\n    a = static_cast<int>(ch);//ok\n    a = reinterpret_cast<int>(ch);//error, æ­¤å…³é”®å­—åªé€‚ç”¨äºæŒ‡é’ˆçš„é‡æ–°è§£é‡Š(å¼ºè½¬)\n}\n```\n\n```cpp\nint main()\n{\n    char ch = 'x';\n    int * ip = static_cast<int*>(&ch);//ok, å³æ‹¿intæ¥è§£é‡Šchçš„åœ°å€å¼€å§‹çš„4ä¸ªå­—èŠ‚ã€‚\n}\n```\n\n```cpp\nint main()\n{\n    char ch = 'x';\n    int &ra = static_cast<int&>(ch);//error, å› ä¸ºstaticé™åˆ¶ä¸¤æ–¹ç±»å‹ä¸€è‡´ã€‚\n    int &rb = reinterpret_cast<int&>(ch);//ok, å³æ‹¿int&æ¥è§£é‡Šã€å¼•ç”¨chçš„åœ°å€å¼€å§‹çš„4ä¸ªå­—èŠ‚\n}\n```\n\n## dynamic_cast\n\nå¯¹äºå†…ç½®ç±»å‹ï¼ˆåŸºæœ¬æ•°æ®ç±»å‹ã€æŒ‡é’ˆç±»å‹ï¼‰éƒ½æ˜¯é™æ€è½¬æ¢ã€‚\n\nå¯¹äºè‡ªå®šä¹‰ã€è‡ªè®¾è®¡ç±»å‹ï¼Œå¦‚æœä¸å­˜åœ¨è™šå‡½æ•°ç”šè‡³ä¸å­˜åœ¨ç»§æ‰¿å…³ç³»ï¼Œåˆ™ä»æ˜¯é™æ€è½¬æ¢ï¼›å¦‚æœæœ‰ç»§æ‰¿å…³ç³»ä¸”å­˜åœ¨è™šå‡½æ•°ã€å¤šæ€æ€§è´¨ï¼Œåˆ™éœ€è¦åŠ¨æ€è½¬æ¢ï¼Œè½¬æ¢è¿‡ç¨‹éœ€è¦æŸ¥è™šè¡¨ã€‚\n\né€šå¸¸ç”¨äºæœ‰ç»§æ‰¿å…³ç³»ç±»å‹çš„æŒ‡é’ˆç±»å‹ä¹‹é—´çš„ä¸‹è¡Œè½¬æ¢ï¼ˆæ¯”å¦‚ï¼ŒåŸæœ¬æ˜¯çˆ¶æŒ‡é’ˆï¼Œä½†å®é™…ä¸Šæ˜¯å­å¯¹è±¡ï¼Œåˆ™å¯ä»¥ç”¨æ­¤å…³é”®å­—è½¬ä¸ºå­æŒ‡é’ˆç±»å‹ï¼‰ã€‚\n\n```c++\nclass Base\n{\npublic:\n    virtual void fun() {}\n};\nclass Derived : public Base\n{\npublic:\n    virtual void fun() {}\n};\nint main()\n{\n    Base base;\n    Derived derived;\n    Base * bp;\n    Derived * dp;\n    bp = &derived;\n    dp = dynamic_cast<Derived*>(bp);\n}\n```\n\né™¤æ­¤ä¹‹å¤–ï¼Œdynamic_castè¿˜å¯ä»¥ç”¨äºç±»å±‚æ¬¡é—´çš„ä¸Šè¡Œè½¬æ¢ï¼ˆå­æŒ‡é’ˆæ¢ä¸ºçˆ¶æŒ‡é’ˆï¼‰ï¼Œå’Œç±»ä¹‹é—´çš„äº¤å‰è½¬æ¢ï¼ˆï¼Ÿï¼‰ã€‚åœ¨ç±»å±‚æ¬¡é—´è¿›è¡Œä¸Šè¡Œè½¬æ¢æ—¶ï¼Œdynamic_castå’Œstatic_castçš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼›åœ¨è¿›è¡Œä¸‹è¡Œè½¬æ¢æ—¶ï¼Œdynamic_castå…·æœ‰ç±»å‹æ£€æŸ¥çš„åŠŸèƒ½ï¼Œæ¯”static_castæ›´å®‰å…¨ã€‚\n\n### dynamic_castè‡ªå®ç°\n\n```c++\n#include<iostream>\nusing namespace std;\nclass Base\n{\npublic:\n    virtual void fun() {}\n};\nclass Derived : public Base\n{\npublic:\n    virtual void fun() {}\n};\ntemplate<class _Ty_dest, class _Ty_src>\n_Ty_dest my_dynamic_cast(_Ty_src src)\n{\n    _Ty_dest tmp = (_Ty_dest)src;\n    //cout << typeid(*tmp).name() << endl;\n    //cout << typeid(*src).name() << endl;\n    if (typeid(*tmp) == typeid(*src))\n        return (_Ty_dest)src;\n    else\n        return NULL;\n}\nint main()\n{\n    Base base;\n    Derived derived;\n    Base* bp = &derived;\n    Derived* dp;\n    bp = &derived;\n    //cout << typeid(Derived).name() << endl;\n    //cout << typeid(*bp).name() << endl;\n    dp = my_dynamic_cast<Derived*>(bp);\n    cout << dp << endl;\n}\n```\n\n# RTTI\n\nå…¨åRun Time Type identificationã€‚è¿è¡Œæ—¶ç±»å‹è¯†åˆ«ã€‚é€šå¸¸ä»¥æŒ‡é’ˆå½¢å¼å­˜åœ¨è™šè¡¨ä¸­ï¼Œå®é™…å†…å®¹å­˜å‚¨åœ¨rodataåŒºä¸­ï¼Œå¯¹è±¡ç±»å‹æ˜¯type_infoç±»å‹ï¼Œæˆå‘˜æœ‰ï¼š`==ã€!=ã€name()ã€before(type_info)`ã€‚\n\ndynamic_castçš„è¿è¡Œéœ€è¦æ£€æŸ¥ä¼ å…¥çš„å‚æ•°çš„å®é™…ç±»å‹æ˜¯å¦ä¸æ¨¡æ¿å‚æ•°ç±»å‹ä¸€è‡´ã€‚\n\nè¿è¡Œæ—¶ç±»å‹è¯†åˆ«çš„åŠŸèƒ½ç”±ä¸¤ä¸ªè¿ç®—ç¬¦å®ç°ï¼š\n\n1. `typeid`è¿ç®—ç¬¦ï¼Œç”¨äºè¿”å›è¡¨è¾¾å¼çš„ç±»å‹ï¼›\n2. `dynamic_cast`è¿ç®—ç¬¦ï¼Œç”¨äºå°†åŸºç±»çš„æŒ‡é’ˆæˆ–å¼•ç”¨å®‰å…¨åœ°è½¬æ¢æˆæ´¾ç”Ÿç±»çš„æŒ‡é’ˆæˆ–å¼•ç”¨ã€‚\n\n## å¯¹äºå†…ç½®ç±»å‹ã€æŒ‡é’ˆçš„ç±»å‹è¯†åˆ«\n\nå±äºé™æ€è¯†åˆ«èŒƒç•´ï¼Œå³ç¼–è¯‘æ—¶è¯†åˆ«ã€‚\n\n```cpp\nint main()\n{\n    int * ip = new int(10);\n    int ar[10] = {1, 2, 3};\n    int(*par)[10] = &ar;\n    cout << typeid(ip).name() << endl;  //\"int *\"\n    cout << typeid(*ip).name() << endl; //\"int\"\n    cout << typeid(par).name() << endl; //\"int (*) [10]\"\n    cout << typeid(*par).name() << endl;//\"int [10]\"\n}\n```\n\n## å¯¹äºè‡ªå®šä¹‰ç±»å‹\n\n```cpp\nclass Object\n{\nprivate:\n    int value;\npublic:\n    Base(int x = 0) : num(x) {}\n    ~Base() {}\n}\n```\n\n### ä¸å¸¦constçš„æƒ…å†µ\n\n```cpp\nint main()\n{\n    Object obj;\n    Object * op = &obj;\n    cout << typeid(op).name() << endl; //class Object *\n    cout << typeid(*op).name() << endl;//class Object\n}\n```\n\n### å¸¦constçš„æƒ…å†µ\n\nä¸ç®¡Objectå¯¹è±¡å¸¦ä¸å¸¦constä¿®é¥°ï¼Œ`typeid`å¯¹é¡¶å±‚ç±»å‹çš„æè¿°éƒ½ä¸ä¼šå¸¦constå­—çœ¼ï¼Œä½†`*cop`ï¼ˆå³æ‰€æŒ‡ä¹‹ç‰©ï¼‰å®é™…ä¸Šæ˜¯å¯èƒ½æœ‰constå±æ€§çš„ã€‚\n\n```cpp\nint main()\n{\n    Object obj;\n    const Object * cop = &obj;\n    cout << typeid(cop).name() << endl; //class Object const *\n    cout << typeid(*cop).name() << endl;//class Object\n}\n```\n\n```cpp\nint main()\n{\n    const Object cobj;\n    const Object * cop = &cobj;\n    cout << typeid(cop).name() << endl; //class Object const *\n    cout << typeid(*cop).name() << endl;//class Object\n}\n```\n\n#### å¼•ç”³ - æ¨¡æ¿\n\n```cpp\ntemplate<class T>\nvoid fun(T & a)\n{\n    cout << typeid(T).name() << endl;\n    cout << typeid(a).name() << endl;\n}\n```\n\nä»¥ä¸‹ç¨‹åºï¼šTå®é™…ä¸Šæ˜¯int ; è€Œaå®é™…ä¸Šæ˜¯int &ï¼Œä½†è¾“å‡ºæ—¶ï¼ŒTå’Œaç±»å‹è¾“å‡ºçš„éƒ½æ˜¯intã€‚è¯´æ˜é¡¶å±‚å½¢å¼ï¼ˆå³éæŒ‡é’ˆã€å¼•ç”¨ï¼‰æ—¶ï¼Œåªè¾“å‡ºçº¯ç²¹ç±»å‹intï¼Œæ‰€ä»¥ï¼Œaä¸è¾“å‡ºå¼•ç”¨ã€‚\n\n```cpp\nint main()\n{\n    int x = 10;\n    fun(x);//è¾“å‡ºint int\n}\n```\n\nä»¥ä¸‹ç¨‹åºï¼šTå®é™…ä¸Šæ˜¯const intï¼Œaå®é™…ä¸Šæ˜¯const int &ï¼Œä½†è¾“å‡ºæ—¶Tå’Œaç±»å‹è¾“å‡ºçš„éƒ½æ˜¯intã€‚è¯´æ˜é¡¶å±‚å½¢å¼ï¼ˆå³éæŒ‡é’ˆã€å¼•ç”¨ï¼‰æ—¶ï¼Œåªè¾“å‡ºçº¯ç²¹ç±»å‹intï¼Œæ‰€ä»¥ï¼ŒTå’Œaå‡ä¸è¾“å‡ºconstå’Œå¼•ç”¨ã€‚\n\n```cpp\nint main()\n{\n    const int x = 10;\n    fun(x);//è¾“å‡ºint int\n}\n```\n\nè¦æ€ä¹ˆéªŒè¯Tå®é™…ä¸Šæ˜¯ä¸€ä¸ªconst intç±»å‹å‘¢ï¼Ÿå¯ä»¥å°è¯•åœ¨funå‡½æ•°ä¸­å®šä¹‰ä¸€ä¸ªTç±»å‹çš„æœªåˆå§‹åŒ–å˜é‡ã€‚ä¼šå‘ç”Ÿé”™è¯¯ï¼Œå› ä¸ºç¼–è¯‘å™¨åˆ¤å®šæ­¤å¤„Tä¸ºä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œå¿…é¡»åœ¨å®šä¹‰æ—¶äºˆä»¥åˆå§‹åŒ–ã€‚ä¹Ÿå°±éªŒè¯äº†Tç±»å‹ä¸ºå¸¦constçš„intï¼Œåªæ˜¯åœ¨typeidè¾“å‡ºæ—¶æ²¡æœ‰è¾“å‡º&ã€‚\n\n```cpp\nint main()\n{\n    const int x = 10;\n    fun(x);\n}\ntemplate<class T>\nvoid fun(T & a)\n{\n    T b;//error, Tæ˜¯ä¸€ä¸ªconst int &, å¼•ç”¨å˜é‡å¿…é¡»åœ¨å®šä¹‰æ—¶åˆå§‹åŒ–ã€‚\n    cout << typeid(T).name() << endl;\n    cout << typeid(a).name() << endl;\n}\n```\n\n## typeidçš„åº”ç”¨ - ç”¨äºæ¯”è¾ƒæ˜¯å¦æ˜¯ç›¸åŒç±»å‹\n\n```cpp\nint main()\n{\n    int a = 10, b = 20;\n    const int * ap = &a;\n    int * bp = &b;\n    cout << (typeid(ap) == typeid(bp)) << endl;//ä¸ç­‰äº, å› ä¸ºapä¸ºconst int *, bpä¸ºint *\n    cout << (typeid(*ap) == typeid(*bp)) << endl;//ç­‰äº, å› ä¸º*apå’Œ*bpçš„typeid.nameå‡ä¸ºint\n}\n```\n\n## typeidåœ¨ç»§æ‰¿å…³ç³»ä¸­\n\n### æœ‰ç»§æ‰¿ä½†æ— å¤šæ€å…³ç³»ï¼ˆæ— è™šå‡½æ•°ï¼‰\n\næœ‰ç»§æ‰¿ä½†æ— å¤šæ€å…³ç³»ï¼ˆæ— è™šå‡½æ•°ï¼‰ä¸­çš„typeidç±»å‹è¾“å‡ºä»ä¸ºé™æ€è¯†åˆ«ã€‚\n\n```cpp\nclass Base\n{\n    int value;\npublic:\n    Base(int x = 0) : value(x) {}\n    ~Base() {}\n}\nclass Derived : public Base\n{\n    int num;\npublic:\n    Derived(int x = 0) : num(x) {}\n    ~Derived() {}\n}\n```\n\nå¦‚ä»¥ä¸‹ç¨‹åºï¼Œ`*bp`è¾“å‡ºçš„æ˜¯Baseï¼Œè€Œå®é™…ä¸Šbpæ‰€æŒ‡ä¹‹ç‰©ä¸ºDerivedç±»å‹å¯¹è±¡ã€‚è¿™æ˜¯å› ä¸ºBaseå’ŒDerivedæœ‰ç»§æ‰¿ä½†æ— å¤šæ€å…³ç³»ï¼Œå› æ­¤typeidåªæ ¹æ®æŒ‡é’ˆç±»å‹æ¥é™æ€è¾“å‡ºï¼Œè€Œæœªèƒ½è¯†åˆ«æ‰€æŒ‡ä¹‹ç‰©çš„çœŸå®ç±»å‹ã€‚\n\n```cpp\nint main()\n{\n    Derived d;\n    Derived * dp = &d;  //å­æŒ‡é’ˆæŒ‡å‘å­å¯¹è±¡ ok\n    Base * bp = &d;     //çˆ¶æŒ‡é’ˆæŒ‡å‘å­å¯¹è±¡ ok\n    cout << typeid(dp).name() << endl; //class Derived *\n    cout << typeid(bp).name() << endl; //class Base *\n    cout << typeid(*dp).name() << endl;//class Derived\n    cout << typeid(*bp).name() << endl;//class Base\n}\n```\n\n### æœ‰ç»§æ‰¿ä¸”æœ‰å¤šæ€å…³ç³»ï¼ˆæœ‰è™šå‡½æ•°ï¼‰\n\n```cpp\nclass Base\n{\n    int value;\npublic:\n    Base(int x = 0) : value(x) {}\n    virtual ~Base() {}//æ­¤å¤„, å®šä¹‰äº†ä¸€ä¸ªè™šå‡½æ•°ã€‚è‡ªæ­¤, Baseå’ŒDerivedç±»å°±å­˜åœ¨å¤šæ€å…³ç³»äº†ã€‚\n}\nclass Derived : public Base\n{\n    int num;\npublic:\n    Derived(int x = 0) : num(x) {}\n    ~Derived() {}\n}\n```\n\n```cpp\nint main()\n{\n    Derived d;\n    Derived * dp = &d;  //å­æŒ‡é’ˆæŒ‡å‘å­å¯¹è±¡ ok\n    Base * bp = &d;     //çˆ¶æŒ‡é’ˆæŒ‡å‘å­å¯¹è±¡ ok\n    cout << typeid(dp).name() << endl; //class Derived *\n    cout << typeid(bp).name() << endl; //class Base *\n    cout << typeid(*dp).name() << endl;//class Derived\n    cout << typeid(*bp).name() << endl;//class Derived, æ­¤å¤„å˜ä¸ºäº†Derived, å³bpæŒ‡å‘çš„å¯¹è±¡çš„å®é™…ç±»å‹\n}\n```\n\nå¦‚ä»¥ä¸Šç¨‹åºï¼Œ`*bp`è¾“å‡ºçš„æ˜¯Derivedï¼Œæ­£ç¡®å¯¹åº”äº†å®é™…ä¸Šbpæ‰€æŒ‡ä¹‹ç‰©ä¸ºDerivedç±»å‹å¯¹è±¡ã€‚è¿™æ˜¯å› ä¸ºBaseå’ŒDerivedæœ‰ç»§æ‰¿ä¸”æœ‰å¤šæ€å…³ç³»ï¼Œå› æ­¤typeidæ ¹æ®bpæ‰€æŒ‡å¯¹è±¡çš„å®é™…ç±»å‹æ¥è¾“å‡ºã€‚\n\næ€ä¹ˆæ ¹æ®bpæ‰€æŒ‡å¯¹è±¡çš„å®é™…ç±»å‹æ¥è¾“å‡ºå‘¢ï¼ŸåŸç†æ˜¯æŸ¥è™šè¡¨ã€‚\n\n> åœ¨ç»§æ‰¿ä¸”å¤šæ€å…³ç³»ä¸­ï¼Œä½†å‡¡é€šè¿‡æŒ‡é’ˆã€å¼•ç”¨çš„æ–¹å¼æ“ä½œæ—¶ï¼Œéƒ½ä¼šå¼•å‘æŸ¥è™šè¡¨çš„åŠ¨ä½œã€‚\n```cpp\ntypeid(*op)//*opè§£å¼•ç”¨äº†æŒ‡é’ˆï¼ŒæŸ¥è™šè¡¨\nop->fun();//é€šè¿‡opæŒ‡é’ˆè°ƒç”¨å‡½æ•°ï¼ŒæŸ¥è™šè¡¨ã€‚\n```\n\nè™šè¡¨çš„ç»“æ„ï¼šè™šè¡¨åŒ…å«çš„å†…å®¹ï¼Œé™¤äº†æˆ‘ä»¬ç†Ÿæ‚‰çš„è™šæˆå‘˜å‡½æ•°æŒ‡é’ˆå¤–ï¼Œåœ¨è™šå‡½æ•°è¡¨çš„è‹¥å¹²è™šæˆå‘˜å‡½æ•°æŒ‡é’ˆä¹‹å‰ï¼Œå³è™šå‡½æ•°è¡¨çš„å‰4ä¸ªå­—èŠ‚ï¼Œå­˜æ”¾äº†ä¸€ä¸ªRTTIæŒ‡é’ˆã€‚è¿™ä¸ªæŒ‡é’ˆå³æŒ‡å‘äº†å½“å‰å¯¹è±¡çš„çœŸå®ç±»å‹ä¿¡æ¯ï¼Œå³`type_info`ç»“æ„ä½“ã€‚è¿™ä¸ªç»“æ„ä½“å­˜æ”¾äº†æ­¤ç±»å‹çš„ç±»å‹åç­‰ä¿¡æ¯ã€‚\n\næ‰€ä»¥ï¼Œåœ¨ç»§æ‰¿ä¸”æœ‰å¤šæ€å…³ç³»ä¸­è¿›è¡Œ`typeid`æŸ¥è¯¢æ—¶ï¼Œæ˜¯ä¸€ç§åŠ¨æ€çš„æŸ¥è¯¢æ–¹æ¡ˆï¼Œå³é€šè¿‡è™šè¡¨æŒ‡é’ˆï¼Œæ‰¾åˆ°ç›¸åº”çš„è™šè¡¨ï¼Œè™šè¡¨å¤´éƒ¨æœ‰ä¸ªRTTIï¼Œå³å½“å‰å¯¹è±¡çš„ç±»å‹ä¿¡æ¯ã€‚\n\n#### éšæ‚£ï¼šè°¨é˜²ç©ºæŒ‡é’ˆ\n\n```cpp\nclass Base\n{\n    int value;\npublic:\n    Base(int x = 0) : value(x) {}\n    virtual ~Base() {}//æ­¤å¤„, å®šä¹‰äº†ä¸€ä¸ªè™šå‡½æ•°ã€‚è‡ªæ­¤, Baseå’ŒDerivedç±»å°±å­˜åœ¨å¤šæ€å…³ç³»äº†ã€‚\n}\nclass Derived : public Base\n{\n    int num;\npublic:\n    Derived(int x = 0) : num(x) {}\n    ~Derived() {}\n}\n```\n\n```cpp\nint main()\n{\n    Base * bp = nullptr;\n    cout << typeid(bp).name() << endl;\n    cout << typeid(*bp).name() << endl;//å´©æºƒ\n}\n```\n\nä»¥ä¸Šç¨‹åºä¸­ï¼ŒBaseå’ŒDerivedç±»æœ‰å¤šæ€å…³ç³»ï¼ˆæœ‰è™šå‡½æ•°è¡¨æŒ‡é’ˆï¼‰ï¼Œ`*bp`å°†ä¼šå¼•èµ·æŸ¥è™šè¡¨æ“ä½œã€‚ä½†æ˜¯ï¼ŒæŸ¥å¯¹è±¡è™šè¡¨æŒ‡é’ˆæ—¶ï¼Œè¿›å…¥äº†é™·é˜±ï¼Œbpæœ¬åº”è¯¥æŒ‡å‘è™šå‡½æ•°è¡¨åœ°å€ï¼Œä½†å®ƒå±…ç„¶æŒ‡å‘çš„æ˜¯ä¸€ä¸ªç©ºæŒ‡é’ˆï¼äºæ˜¯è¿›è¡Œäº†å¯¹ç©ºæŒ‡é’ˆçš„æ“ä½œå¯¼è‡´ç¨‹åºå´©æºƒã€‚\n\n> å®é™…ä¸Šï¼Œå¦‚æœBaseå’ŒDerivedåªæœ‰ç»§æ‰¿å…³ç³»è€Œæ²¡æœ‰å¤šæ€å…³ç³»ï¼ˆå³ä¸¤ä¸ªå¯¹è±¡æ²¡æœ‰è™šå‡½æ•°è¡¨æŒ‡é’ˆï¼‰ï¼Œåˆ™ä¸ä¼šå¼•èµ·ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œå› ä¸ºä¸æ¶‰åŠåˆ°æŸ¥è™šè¡¨ï¼Œtypeidåªæ˜¯ä¸€ä¸ªé™æ€ç±»å‹è¯†åˆ«ï¼Œåªæ ¹æ®bpçš„æŒ‡é’ˆç±»å‹è¾“å‡ºæŒ‡é’ˆå¯¹åº”çš„ç±»å‹ã€‚è¿™ä¹ŸéªŒè¯äº†å‰é¢æåˆ°çš„ï¼Œâ€œæœ‰ç»§æ‰¿ä½†æ— å¤šæ€å…³ç³»ï¼ˆæ— è™šå‡½æ•°ï¼‰ä¸­çš„typeidç±»å‹è¾“å‡ºä»ä¸ºé™æ€è¯†åˆ«ã€‚â€\n\næ‰€ä»¥æˆ‘ä»¬åœ¨å¤šæ€å…³ç³»ä¸­è¦è°¨é˜²æ‰€æœ‰æ¶‰åŠåˆ°æŸ¥è™šè¡¨æ“ä½œå¼•èµ·çš„ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚\n\n```cpp\nint main()\n{\n    Base * bp = nullptr;\n    cout << typeid(bp).name() << endl;\n    try\n    {\n        cout << typeid(*op).name() << endl;//æŠ›å‡ºå¼‚å¸¸\n    }\n    catch(std::bad_typeid& e)\n    {\n        cout << e.what() << endl;\n    }\n}\n//è¾“å‡ºï¼š\n//class Object *\n//Attempted a typeid of nullptr pointer!\n```\n\n# dynamic_caståº”ç”¨åœºæ™¯ - ä¸‹è¡Œè½¬æ¢\n\nåœ¨ç»§æ‰¿å…³ç³»çš„ä¸Šè¡Œè½¬æ¢ä¸­ã€‚`static_cast`å’Œ`dynamic_cast`å‡æ˜¯å¯ä»¥çš„ï¼Œè€Œä¸”ä¸ç®¡æœ‰æ— å¤šæ€å…³ç³»ï¼ˆæœ‰æ— è™šå‡½æ•°ï¼‰ä¹Ÿæ˜¯æ— æ‰€è°“çš„ã€‚\n\nç°åœ¨æˆ‘ä»¬æ¥è®¨è®ºä¸‹è¡Œè½¬æ¢çš„æƒ…å†µã€‚\n\n## æ— å¤šæ€\n\n```cpp\nclass Base\n{\n    int value;\npublic:\n    Base(int x = 0) : value(x) {}\n    ~Base() {}\n}\nclass Derived : public Base\n{\n    int num;\npublic:\n    Derived(int x = 0) : num(x) {}\n    ~Derived() {}\n}\n```\n\n```cpp\nint main()\n{\n    Derived d;\n    Base * bp = &d;\n    Derived * dp = nullptr;\n    dp = bp;//error, ç”¨å­æŒ‡é’ˆæŒ‡å‘å­å¯¹è±¡, è¯­ä¹‰æ­£ç¡®, ä½†ç¼–è¯‘ä¸é€šè¿‡ã€‚å› ä¸ºBase *å’ŒDerived *ç±»å‹ä¸ä¸€è‡´ã€‚\n}\n```\n\nä»¥ä¸Šç¨‹åºå› ä¸ºBase *å’ŒDerived *ç±»å‹ä¸ä¸€è‡´ï¼Œæ‰€ä»¥æ— æ³•ç›´æ¥`dp = bp;`ï¼Œæˆ‘ä»¬å¯ä»¥æš‚æ—¶ç”¨`static_cast`è§£å†³ã€‚\n\n```cpp\nint main()\n{\n    Derived d;      //å­å¯¹è±¡\n    Base * bp = &d; //å–å­å¯¹è±¡åœ°å€ä¼ ç»™çˆ¶æŒ‡é’ˆ\n    Derived * dp = nullptr;//å®šä¹‰ä¸€ä¸ªå­æŒ‡é’ˆ\n    dp = static_cast<Derived*>(bp);//ä½¿ç”¨äº†static_cast, ç¼–è¯‘é€šè¿‡ã€‚ç”¨å­æŒ‡é’ˆæŒ‡å‘å­å¯¹è±¡ã€‚è¯­ä¹‰æ­£ç¡®ã€‚\n}\n```\n\n`static_cast`åœ¨ç»§æ‰¿å…³ç³»ä¸­ï¼Œåªèƒ½è§£å†³ä¸Šè¡Œè½¬æ¢ï¼Œå¯¹äºä¸‹è¡Œè½¬æ¢ï¼ˆå­æŒ‡é’ˆæŒ‡å‘çˆ¶å¯¹è±¡ï¼‰åˆ™å°†ä¼šå¯¼è‡´è¯­ä¹‰é”™è¯¯ï¼æ‰€ä»¥åœ¨ç»§æ‰¿å…³ç³»ä¸­ï¼Œ`static_cast`æ…ç”¨ï¼\n\n```cpp\nint main()\n{\n    Base b;        //çˆ¶å¯¹è±¡\n    Base * bp = &b;//çˆ¶æŒ‡é’ˆ\n    Derived * dp = nullptr;\n    dp = static_cast<Derived*>(bp);//ä½¿ç”¨äº†static_cast, ç¼–è¯‘é€šè¿‡ã€‚ä½†æ˜¯! ç”¨å­æŒ‡é’ˆæŒ‡å‘çˆ¶å¯¹è±¡ï¼Œè¯­ä¹‰ä¸æ­£ç¡®ï¼Œå³è§£é‡Šè¶Šç•Œã€‚\n}\n```\n\n## ä½¿ç”¨dynamic_castçš„åœºæ™¯ï¼ˆå¿…é¡»æœ‰å¤šæ€ï¼‰\n\nä¸Šé¢çš„é”™è¯¯ï¼Œéœ€è¦ä½¿ç”¨`dynamic_cast`æ¥è§£å†³ã€‚ç›¸æ¯”äºä¸Šä¸€ä¸ªç¨‹åºï¼Œæ­¤å¤„æ˜¯dynamic_cast, å®ƒä¼šæœ‰ä¸€ä¸ªå¤„ç†, å¦‚æœå‘ç°äº†â€œç”¨å­æŒ‡é’ˆæŒ‡å‘çˆ¶å¯¹è±¡â€çš„è¡Œä¸ºï¼Œåˆ™ç»™dpè¿”å›ä¸€ä¸ªnullptræŒ‡é’ˆã€‚\n\n> ä½†æ˜¯è¦æ³¨æ„çš„æ˜¯ï¼Œ**è¦ä½¿ç”¨`dynamic_cast`è¿›è¡Œä¸‹è¡Œè½¬æ¢çš„å‰ææ˜¯ï¼Œç±»ä¹‹é—´å¿…é¡»è¦æœ‰å¤šæ€å…³ç³»**ï¼Œæ‰èƒ½ä½¿ç”¨`dynamic_cast`è¿›è¡Œä¸‹è¡Œè½¬æ¢ã€‚å¦åˆ™ç¼–è¯‘å‡ºé”™ã€‚\n>\n> ````cpp\n> class Base\n> {\n>     int value;\n> public:\n>     Base(int x = 0) : value(x) {}\n>     virtual ~Base() {}//æ­¤å¤„, å®šä¹‰äº†ä¸€ä¸ªè™šå‡½æ•°ã€‚è‡ªæ­¤, Baseå’ŒDerivedç±»å°±å­˜åœ¨å¤šæ€å…³ç³»äº†ã€‚\n> }\n> class Derived : public Base\n> {\n>     int num;\n> public:\n>     Derived(int x = 0) : num(x) {}\n>     ~Derived() {}\n> }\n> ````\n\n```cpp\nint main()\n{\n    Base b;\n    Base * bp = &b;\n    Derived * dp = nullptr;\n    dp = dynamic_cast<Derived*>(bp);//ç¼–è¯‘é€šè¿‡ã€‚ç›¸æ¯”äºä¸Šä¸€ä¸ªç¨‹åºï¼Œæ­¤å¤„æ˜¯dynamic_cast, å®ƒä¼šæœ‰ä¸€ä¸ªå¤„ç†, å¦‚æœå‘ç°äº†â€œç”¨å­æŒ‡é’ˆæŒ‡å‘çˆ¶å¯¹è±¡â€çš„è¡Œä¸ºï¼Œåˆ™ç»™dpè¿”å›ä¸€ä¸ªnullptræŒ‡é’ˆã€‚\n}\n```\n\n```cpp\nint main()\n{\n    Derived d;\n    Base * bp = &d;\n    Derived * dp = nullptr;\n    dp = dynamic_cast<Derived*>(bp);//ç¼–è¯‘é€šè¿‡ã€‚ç›¸æ¯”äºä¸Šä¸€ä¸ªç¨‹åºï¼Œç”¨å­æŒ‡é’ˆæŒ‡å‘å­å¯¹è±¡ï¼Œè¯­ä¹‰æ­£ç¡®ï¼Œåˆ™ç»™dpè¿”å›ä¸€ä¸ªénullptrçš„Derived*æŒ‡é’ˆã€‚\n}\n```\n\n## å¦‚æœä½¿ç”¨å¼•ç”¨éœ€è¦å¤„ç†å¼‚å¸¸\n\nä¸Šé¢è®¨è®ºåˆ°äº†ï¼Œå¦‚æœ`dynamic_cast`å‘ç°äº†â€œç”¨å­æŒ‡é’ˆæŒ‡å‘çˆ¶å¯¹è±¡â€çš„è¡Œä¸ºï¼Œåˆ™è¿”å›ä¸€ä¸ªnullptræŒ‡é’ˆã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å¼•ç”¨å‘¢ï¼Ÿâ€”â€”è‚¯å®šä¸å­˜åœ¨ç©ºå¼•ç”¨ï¼Œå› æ­¤éœ€è¦å¤„ç†å¼‚å¸¸ã€‚\n\n```cpp\nint main()\n{\n    Derived d;\n    Base b;\n    Base & rb = b;//çˆ¶å¼•ç”¨ å¼•ç”¨ çˆ¶å¯¹è±¡\n    try\n    {\n        Derived & rd = dynamic_cast<Derived&>(rb);//æ¬²ç”¨\"å­å¼•ç”¨ å¼•ç”¨ çˆ¶å¯¹è±¡\", æŠ›å¼‚å¸¸\n    }\n    catch(std::bad_cast &e)\n    {\n        cout << e.what() << endl;\n    }\n}\n```\n\n# åº”ç”¨ - å¦‚ä½•åœ¨å¸¸æ–¹æ³•ä¸­ä¿®æ”¹å¯¹è±¡\n\n```cpp\nclass Object\n{\n    int value;\npublic:\n    Object(int x = 0) : value(x) {}\n    void fun() const\n    {\n        int x = value;\n        value = 100;//å¸¸æ–¹æ³•ä¸­ä¿®æ”¹å±æ€§å€¼\n    }\n}\n```\n\næ–¹æ³•ä¸€ï¼šç»™è¦ä¿®æ”¹çš„å€¼åŠ mutableå…³é”®å­—ã€‚\n\n```cpp\n    mutable int value;\n```\n\næ–¹æ³•äºŒï¼šå¯¹è¦ä¿®æ”¹çš„å€¼å–åœ°å€ï¼Œå¹¶å¼ºè½¬ä¸ºä¸å¸¦constçš„æŒ‡é’ˆå±æ€§ï¼Œå†è§£å¼•ç”¨ã€‚å¯ç”¨`const_cast`\n\n```cpp\n    void fun() const\n    {\n        int x = value;\n        *(int*)&value = 100;\n        *(const_cast<int*>(&value)) = 100;\n    }\n```\n\næ–¹æ³•ä¸‰ï¼šå¯¹thisæŒ‡é’ˆä¸‹æ‰‹ã€‚åŒæ–¹æ³•äºŒã€‚\n\n```cpp\n    void fun() const\n    {\n        int x = value;\n        (const_cast<Object*>(this))->value = 100;\n    }\n```\n\n# åŠ¨æ€è½¬æ¢çš„åº”ç”¨ - åƒåœ¾åˆ†ç±»\n\n```cpp\n#include<iostream>\n#include<vector>\n#include<map>\nusing namespace std;\nclass Trash\n{\n    float m_weight;\npublic:\n    Trash(float wt) : m_weight(wt) {}\n    virtual ~Trash()\n    {\n        cout << \"~Trash()\" << endl;\n    }\n    float getWeight() const\n    {\n        return m_weight;\n    }\n    virtual float getPrice() const = 0;\n};\n```\n\n```cpp\n//é“œ\nclass Copper : public Trash\n{\n    static float price;\npublic:\n    Copper(float wt) : Trash(wt) {}\n    float getPrice() const\n    {\n        return price;\n    }\n    static void setPrice(float newPrice)\n    {\n        price = newPrice;\n    }\n};\nfloat Copper::price = 2.80;\n```\n\n```cpp\n//çº¸\nclass Paper : public Trash\n{\n    static float price;\npublic:\n    Paper(float wt) : Trash(wt) {}\n    float getPrice() const\n    {\n        return price;\n    }\n    static void setPrice(float newPrice)\n    {\n        price = newPrice;\n    }\n};\nfloat Paper::price = 0.20;\n```\n\n```cpp\n//ç»ç’ƒ\nclass Glass : public Trash\n{\n    static float price;\npublic:\n    Glass(float wt) : Trash(wt) {}\n    float getPrice() const\n    {\n        return price;\n    }\n    static void setPrice(float newPrice)\n    {\n        price = newPrice;\n    }\n};\nfloat Glass::price = 0.32;\n```\n\n```cpp\ntemplate<class Container>\nvoid sumPrice(Container & bin)\n{\n    float total = 0;\n    for(auto p : bin)\n    {\n        total += p->getPrice() * p->getWeight();\n        cout << \"weight of \" << typeid(*p).name() << \" = \"\n            << p->getWeight() << endl;\n    }\n    cout << \"Total price = \" << total << endl;\n}\n```\n\n```cpp\nint main()\n{\n    srand(time(NULL));\n    vector<Trash*> bin;//çˆ¶ç±»æŒ‡é’ˆã€‚å¯æŒ‡å‘å…·ä½“çš„åƒåœ¾ç±»ã€‚\n    int n = rand() % 50;\n    for(int i = 0; i < n; ++i)\n    {\n        switch(rand() % 3)\n        {\n        case 0:\n            bin.push_back(new Copper((rand() % 1000) / 10.0)));\n            break;\n        case 1:\n            bin.push_back(new Paper((rand() % 1000) / 10.0)));\n            break;\n        case 2:\n            bin.push_back(new Glass((rand() % 1000) / 10.0)));\n            break;\n        }\n    }\n    \n    vector<Copper*> coppBin;\n    vector<Paper*>  paperBin;\n    vector<Glass*>  glassBin;\n    vector<Trash*>::iterator sorter = bin.begin();\n    while(sorter != bin.end())\n    {\n        Copper *cp = dynamic_cast<Copper*>(*sorter);\n        Paper  *pp = dynamic_cast<Paper*>(*sorter);\n        Glass  *gp = dynamic_cast<Glass*>(*sorter);\n        if(cp)\n        {\n            coppBin.push_back(cp);\n        }\n        else if(pp)\n        {\n            paperBin.push_back(pp);\n        }\n        else if(gp)\n        {\n            glassBin.push_back(gp);\n        }\n        ++sorter;\n    }\n    sumPrice(coppBin);\n    sumPrice(paperBin);\n    sumPrice(glassBin);\n    sumPrice(bin);\n    for(auto x : bin)\n    {\n        delete x;\n        x = nullptr;\n    }\n}\n```\n\n","categories":["Cpp"]},{"title":"é«˜çº§æ•°æ®ç»“æ„_å¹³è¡¡æœç´¢æ ‘","url":"/é«˜çº§æ•°æ®ç»“æ„/é«˜çº§æ•°æ®ç»“æ„_å¹³è¡¡æœç´¢æ ‘/","content":"\n# å†…å®¹\n\n1. AVL - å¹³è¡¡æœç´¢æ ‘\n2. å•æ—‹è½¬\n3. åŒæ—‹è½¬\n\n# å¹³è¡¡æœç´¢æ ‘\n\nåœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒAVLæ ‘ï¼ˆä»¥å‘æ˜è€…Adelson-Velskyå’ŒLandis å‘½åï¼‰æ˜¯ä¸€ç§**è‡ªå¹³è¡¡-äºŒå‰æœç´¢æ ‘(BST)**ã€‚åœ¨AVLæ ‘ä¸­ï¼Œä»»ä½•èŠ‚ç‚¹çš„ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦æœ€å¤šç›¸å·®1ï¼›å¦‚æœåœ¨ä»»ä½•æ—¶å€™å®ƒä»¬çš„å·®å¼‚è¶…è¿‡1ï¼Œåˆ™ä¼šè¿›è¡Œé‡æ–°å¹³è¡¡ä»¥æ¢å¤æ­¤å±æ€§ã€‚åœ¨å¹³å‡æƒ…å†µå’Œæœ€åæƒ…å†µä¸‹ï¼ŒæŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤éƒ½éœ€è¦$O(\\log n)$æ—¶é—´ï¼Œå…¶ä¸­$n$æ˜¯æ“ä½œä¹‹å‰æ ‘ä¸­çš„èŠ‚ç‚¹æ•°ã€‚æ’å…¥å’Œåˆ é™¤å¯èƒ½éœ€è¦é€šè¿‡ä¸€ä¸ªæˆ–å¤šä¸ªæ ‘æ—‹è½¬æ¥é‡æ–°å¹³è¡¡æ ‘ã€‚\n\nAVLæ ‘ä»¥å…¶ä¸¤ä½è‹è”å‘æ˜å®¶Georgy Adelson-Velskyå’ŒEvgenii Landisçš„åå­—å‘½å;\n\nAVLæ ‘ç»å¸¸ä¸çº¢é»‘æ ‘è¿›è¡Œæ¯”è¾ƒï¼Œå› ä¸ºå®ƒä»¬éƒ½æ”¯æŒç›¸åŒçš„æ“ä½œé›†å¹¶ä¸”é‡‡ç”¨$O(\\log n)$åŸºæœ¬æ“ä½œçš„æ—¶é—´ã€‚å¯¹äºæŸ¥æ‰¾å¯†é›†å‹åº”ç”¨ç¨‹åºï¼ŒAVLæ ‘æ¯”çº¢é»‘æ ‘æ›´å¿«ï¼Œå› ä¸ºå®ƒä»¬æ›´ä¸¥æ ¼åœ°å¹³è¡¡ã€‚\n\n# ç±»Cå®ç°æ–¹å¼\n\n## èŠ‚ç‚¹ç»“æ„\n\nå¯ä»¥çœ‹åˆ°, ç›¸æ¯”äºäºŒå‰æœç´¢æ ‘åªå¤šå‡ºä¸€ä¸ªbalanceå› å­, è¿™ä¸ªå¹³è¡¡å› å­å°†å¸¦æ¥ä»€ä¹ˆé­”åŠ›å‘¢?\n\n```c++\ntypedef int KeyType;\ntypedef struct AVLNode\n{\n    struct AVLNode* leftchild;\n    struct AVLNode* parent;\n    struct AVLNode* rightchild;\n\tKeyType key;\n    int balance;\t//-1,0,1\n}AVLNode, *AVLTree;\n```\n\n# æ—‹è½¬\n\nå¦‚æœåœ¨ä¸€æ£µå¹³è¡¡çš„äºŒå‰æœç´¢æ ‘ä¸­æ’å…¥ä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼Œé€ æˆäº†ä¸å¹³è¡¡ã€‚æ­¤æ—¶å¿…é¡»è°ƒæ•´æ ‘çš„ç»“æ„ï¼Œä½¿ä¹‹å¹³è¡¡åŒ–ã€‚\n\nå¹³è¡¡åŒ–æ—‹è½¬æœ‰ä¸¤ç±»ï¼š\n\n1. å•æ—‹è½¬ï¼ˆå·¦æ—‹å’Œå³æ—‹ï¼‰\n2. åŒæ—‹è½¬ï¼ˆå·¦å¹³è¡¡å’Œå³å¹³è¡¡ï¼‰\n\n* æ¯æ’å…¥ä¸€ä¸ªæ–°èŠ‚ç‚¹æ—¶ï¼ŒAVLæ ‘ä¸­ç›¸å…³èŠ‚ç‚¹çš„å¹³è¡¡çŠ¶æ€ä¼šå‘ç”Ÿæ”¹å˜ã€‚å› æ­¤ï¼Œåœ¨æ’å…¥ä¸€ä¸ªæ–°èŠ‚ç‚¹åï¼Œéœ€è¦ä»æ’å…¥ä½ç½®æ²¿é€šå‘æ ¹çš„è·¯å¾„å›æº¯ï¼Œæ£€æŸ¥å„ç»“ç‚¹çš„å¹³è¡¡å› å­ï¼ˆå·¦ã€å³å­æ ‘çš„é«˜åº¦å·®ï¼‰ã€‚\n  * å¦‚æœåœ¨æŸä¸€èŠ‚ç‚¹å‘ç°é«˜åº¦ä¸å¹³è¡¡ï¼Œåœæ­¢å›æº¯ã€‚\n  * ä»å‘ç”Ÿä¸å¹³è¡¡çš„èŠ‚ç‚¹èµ·ï¼Œæ²¿åˆšæ‰å›æº¯çš„è·¯å¾„å–ç›´æ¥ä¸‹ä¸¤å±‚çš„èŠ‚ç‚¹ã€‚\n  * å¦‚æœè¿™ä¸‰ä¸ªèŠ‚ç‚¹å¤„äºä¸€æ¡ç›´çº¿ä¸Šï¼Œåˆ™é‡‡ç”¨å•æ—‹è½¬è¿›è¡Œå¹³è¡¡åŒ–ã€‚å•æ—‹è½¬å¯æŒ‰å…¶æ–¹å‘åˆ†ä¸ºå·¦å•æ—‹è½¬å’Œå³å•æ—‹è½¬ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯å¦ä¸€ä¸ªçš„é•œåƒï¼Œå…¶æ–¹å‘ä¸ä¸å¹³è¡¡çš„å½¢çŠ¶ç›¸å…³ã€‚\n  * å¦‚æœè¿™ä¸‰ä¸ªèŠ‚ç‚¹å¤„äºä¸€æ¡æŠ˜çº¿ä¸Šï¼Œåˆ™é‡‡ç”¨åŒæ—‹è½¬è¿›è¡Œå¹³è¡¡åŒ–ã€‚åŒæ—‹è½¬åˆ†ä¸ºå…ˆå·¦åå³å’Œå…ˆå³åå·¦ä¸¤ç±»ã€‚\n\n## å•æ—‹è½¬\n\n| è¦è¾¾åˆ°å¹³è¡¡éœ€è¦çš„æ—‹è½¬æ“ä½œ | ä¾‹å­                                                         | åŸå›                         |\n| ------------------------ | ------------------------------------------------------------ | --------------------------- |\n| å³å•æ—‹è½¬(é¡ºæ—¶é’ˆ)         | ![image-20220314155058162](../../images/é«˜çº§æ•°æ®ç»“æ„_å¹³è¡¡æœç´¢æ ‘/image-20220314155058162.png) | å·¦å­©å­çš„å·¦å­æ ‘é«˜ - å·¦å·¦æ—‹è½¬ |\n| å·¦å•æ—‹è½¬(é€†æ—¶é’ˆ)         | ![image-20220314155134839](../../images/é«˜çº§æ•°æ®ç»“æ„_å¹³è¡¡æœç´¢æ ‘/image-20220314155134839.png) | å³å­©å­çš„å³å­æ ‘é«˜ - å³å³æ—‹è½¬ |\n\n## å·¦å•æ—‹è½¬(å³å³æ—‹è½¬) - é€†æ—¶é’ˆ\n\n![image-20220314163614131](../../images/é«˜çº§æ•°æ®ç»“æ„_å¹³è¡¡æœç´¢æ ‘/image-20220314163614131.png)\n\næ­¤å›¾ä¸ºä¾‹ï¼Œæ’å…¥100åï¼Œ56çš„å¹³è¡¡å› å­ä¸º2ï¼Œ78ä¸º1ï¼Œ89ä¸º1ã€‚åˆ™æˆ‘ä»¬éœ€è¦ä»¥78ä¸ºè½´ï¼Œå°†56è¿›è¡Œå·¦å•æ—‹è½¬ã€‚\n\nå·¦å•æ—‹è½¬ä¼šæ˜¯ä»€ä¹ˆæ•ˆæœï¼Ÿå…ˆçœ‹ç®€å•çš„æƒ…å†µ\n\n![image-20220314163747839](../../images/é«˜çº§æ•°æ®ç»“æ„_å¹³è¡¡æœç´¢æ ‘/image-20220314163747839.png)\n\nä»¥æ­¤ä¸ºå¯å‘ï¼Œè¿›è¡Œæ—‹è½¬\n\n![image-20220314164516467](../../images/é«˜çº§æ•°æ®ç»“æ„_å¹³è¡¡æœç´¢æ ‘/image-20220314164516467.png)\n\nå†æ¥çœ‹ä¸€ä¸ªä¸ä»£ç æ­¥éª¤æœ‰å…³çš„å›¾ä¾‹\n\n![image-20220314164731464](../../images/é«˜çº§æ•°æ®ç»“æ„_å¹³è¡¡æœç´¢æ ‘/image-20220314164731464.png)\n\n1. newrootæŒ‡é’ˆæŒ‡å‘ptrçš„å³å­æ ‘ï¼ˆè½´ï¼‰\n2. ptrçš„å³å­©å­æŒ‡é’ˆæŒ‡å‘newrootçš„å·¦å­æ ‘ï¼ˆæ‰¿ï¼‰\n3. newrootçš„å·¦å­©å­æŒ‡é’ˆæŒ‡å‘ptrï¼ˆæ½ï¼‰\n\nä»¥ä¸‹ä¸ºæœ€åŸºæœ¬çš„ä¸‰æ­¥èµ°ï¼š\n\n```c++\nvoid RotateLeft(AVLTree& tree, AVLNode* ptr)\n{\n\tAVLNode* newroot = ptr->rightchild;\t  //1:ä»¥ptrå³å­æ ‘ä¸ºè½´\n\tptr->rightchild = newroot->leftchild; //2:ptrçš„å³æŒ‡é’ˆæ‰¿æ¥newrootçš„å·¦å­©å­\n\tnewroot->leftchild = ptr;             //3:newrootçš„å·¦æŒ‡é’ˆåŒ…æ½pträ¸ºé¦–çš„å­æ ‘ï¼Œæ½ä¸ºå·²æœ‰\n}\n```\n\nåœ¨è¿™ä¸‰æ­¥ä¸­ï¼Œæ¯ä¸€æ­¥çš„åé¢éƒ½è¦åšç›¸åº”çš„å¯¹parentçš„ç»´æŠ¤\n\n1. newrootçš„çˆ¶æŒ‡é’ˆæŒ‡å‘ptrçš„çˆ¶èŠ‚ç‚¹ï¼ˆptrçš„çˆ¶èŠ‚ç‚¹ä»£æ›¿äº†newrootçš„çˆ¶ï¼‰\n2. è‹¥newrootæœ‰å·¦å­©å­ï¼Œåˆ™å·¦å­©å­çš„çˆ¶æŒ‡é’ˆæŒ‡å‘ptrçš„èŠ‚ç‚¹\n3. ptrçš„çˆ¶æŒ‡é’ˆæŒ‡å‘newroot\n\n```c++\nvoid RotateLeft(AVLTree& tree, AVLNode* ptr)\n{\n\tAVLNode* newroot = ptr->rightchild;\t\t//1.1:\n    newroot->parent = ptr->parent\t\t\t//1.2:\n\n\tptr->rightchild = newroot->leftchild;\t//2.1:ptrå³æŒ‡é’ˆæ‰¿æ¥newrootå·¦å­©\n    if(newroot->left != nullptr)newroot->leftchild->parent = ptr;//2.2:\n\t\n    newroot->leftchild = ptr;\t\t\t\t//3.1:newrootå·¦æŒ‡é’ˆåŒ…æ½ptrå­æ ‘\n    ptr->parent = newroot;\t\t\t\t\t//3.2\n}\n```\n\nåœ¨æœ€åä¸€æ­¥ï¼Œå¤„ç†ptrçš„parentæŒ‡é’ˆä¹‹å‰ï¼Œè¿˜è¦å¤„ç†**ptrçš„çˆ¶èŠ‚ç‚¹çš„æŸä¸€å­©å­æŒ‡é’ˆ**æŒ‡å‘é—®é¢˜ï¼Œ**åŸæœ¬æ˜¯æŒ‡å‘50çš„(å³ptr)**ï¼Œä½†70(newroot)åŒ…æ½äº†50(ptr)çš„åœ°ä½ï¼Œåˆ™åŸæœ¬50(ptr)çš„çˆ¶èŠ‚ç‚¹çš„ä¸€ä¸ªå­©å­æŒ‡é’ˆå°±è¦æŒ‡å‘70(newroot)ï¼Œ**è‡³äºæ˜¯å·¦å­©å­æŒ‡é’ˆè¿˜æ˜¯å³å­©å­æŒ‡é’ˆï¼Œéœ€è¦æ ¹æ®æ˜¯å¦å’Œptråœ°å€æ˜¯å¦ç›¸ç­‰åˆ¤æ–­**ã€‚\n\n```c++\nvoid RotateLeft(AVLTree& tree, AVLNode* ptr)\n{\n\tAVLNode* newroot = ptr->rightchild;\t\t//1.1:\n    newroot->parent = ptr->parent;\t\t\t//1.2:\n\n\tptr->rightchild = newroot->leftchild;\t//2.1:ptrå³æŒ‡é’ˆæ‰¿æ¥newrootå·¦å­©\n    if(newroot->left != nullptr)newroot->leftchild->parent = ptr;//2.2:\n\t\n    newroot->leftchild = ptr;\t\t\t\t//3.1:newrootå·¦æŒ‡é’ˆåŒ…æ½ptrå­æ ‘\n    \n    //??? : æ­¤å¤„æ˜¯å¦éœ€è¦åˆ¤ç©º\n    if(ptr->parent->leftchild == ptr)ptr->parent->leftchild = newroot;\n    else ptr->parent->rightchild = newroot;\t//4:\n    \n    ptr->parent = newroot;\t\t\t\t\t//3.2:\n}\n```\n\nä»£ç è¿˜æ²¡å®Œï¼Œè¿˜è¦å¤„ç†æ ¹èŠ‚ç‚¹çš„å˜åŒ–\n\n```c++\nvoid RotateLeft(AVLTree& tree, AVLNode* ptr)\n{\n\tAVLNode* newroot = ptr->rightchild;\t\t//1.1:\n    newroot->parent = ptr->parent;\t\t\t//1.2:\n\n\tptr->rightchild = newroot->leftchild;\t//2.1:ptrå³æŒ‡é’ˆæ‰¿æ¥newrootå·¦å­©\n    if(newroot->left != nullptr)newroot->leftchild->parent = ptr;//2.2:\n\t\n    newroot->leftchild = ptr;\t\t\t\t//3.1:newrootå·¦æŒ‡é’ˆåŒ…æ½ptrå­æ ‘\n    \n    if(ptr == tree)tree = newroot;\t\t\t//4:å¦‚æœptræ­£å¥½æ˜¯æ ¹ï¼Œåˆ™newrootæ›¿ä»£root\n    else\t\t\t\t\t\t\t\t\t//5:è‹¥pträ¸æ˜¯æ ¹ï¼Œåˆ™å¤„ç†å…¶çˆ¶èŠ‚ç‚¹çš„å·¦å³å­©å­æŒ‡é’ˆ\n    {\t//æ­¤å¤„ä¸ç”¨åˆ¤ç©ºï¼Œæ—¢ç„¶pträ¸æ˜¯æ ¹åˆ™ptr->parentä¸€å®šä¸ä¸ºç©ºï¼\n        if(ptr->parent->leftchild == ptr)ptr->parent->leftchild = newroot;\n        else ptr->parent->rightchild = newroot;\t\n    }\n\n    ptr->parent = newroot;\t\t\t\t\t//3.2:\n}\n```\n\n## åŒæ—‹è½¬\n\n| æ—‹è½¬æ–¹å‘   | ä¾‹å­                                                         | åŸå›              |\n| ---------- | ------------------------------------------------------------ | ---------------- |\n| å·¦å³åŒæ—‹è½¬ | ![image-20220314155238443](../../images/é«˜çº§æ•°æ®ç»“æ„_å¹³è¡¡æœç´¢æ ‘/image-20220314155238443.png) | å·¦å­©å­çš„å³å­æ ‘é«˜ |\n| å³å·¦åŒæ—‹è½¬ | ![image-20220314155251894](../../images/é«˜çº§æ•°æ®ç»“æ„_å¹³è¡¡æœç´¢æ ‘/image-20220314155251894.png) | å³å­©å­çš„å·¦å­æ ‘é«˜ |\n\n## å·¦å³æ—‹è½¬ - å…ˆå·¦æ—‹åå³æ—‹\n\nå…ˆä»¥å·¦å­©å­èŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹, å·¦å­©å­èŠ‚ç‚¹çš„å³å­©å­èŠ‚ç‚¹ä¸ºè½´, è¿›è¡Œå·¦å•æ—‹è½¬;\n\nå†, ä»¥çˆ¶èŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹, å·¦å­©å­èŠ‚ç‚¹ä¸ºè½´, è¿›è¡Œå³å•æ—‹è½¬;\n\n# Insert\n\nåœ¨å‘ä¸€æ£µæœ¬æ¥æ˜¯é«˜åº¦å¹³è¡¡$(balance = 0,1,-1)$çš„AVLæ ‘ä¸­æ’å…¥ä¸€ä¸ªæ–°èŠ‚ç‚¹å’Œåœ¨BSTæ ‘ä¸€æ ·ï¼ŒåŒºåˆ«æ˜¯å¦‚æœæ ‘ä¸­æŸä¸ªèŠ‚ç‚¹çš„å¹³è¡¡å› å­$|balance| > 1$ï¼Œåˆ™å‡ºç°äº†ä¸å¹³è¡¡ï¼Œéœ€è¦åšå¹³è¡¡åŒ–å¤„ç†ï¼Œä½¿å¾—æ ‘ä¸­å„èŠ‚ç‚¹é‡æ–°å¹³è¡¡åŒ–ã€‚\n\n```cpp\nAVLNode * Buynode(KeyType kx)\n{\n    AVLNode * s = (AVLNode*)malloc(sizeof(AVLNode));\n    if(nullptr == s) exit(1);\n    memset(s, 0, sizeof(AVLNode));\n    s->key = kx;\n    s->balance = 0;\n    return s;\n}\nbool Insert(AVLNode *& tree, KeyType kx)\n{\n    if(tree == nullptr)\n    {\n        tree = MakeRoot(val);\n        return true;\n    }\n    AVLNode * pa = nullptr;\n    AVLNode * p = tree;\n    while(p != nullptr && p->key != kx)\n    {\n        pa = p;\n        p = kx < p->key ? p->leftchild : p->rightchild;\n    }\n    if(p != nullptr && p->key == kx) //å·²å­˜åœ¨é‡å¤å€¼\n        return false;\n\n    p = Buynode(kx);\n    \n    p->parent = pa;\n    \n    if(kx < pa->key)\n    {\n        pa->leftchild = p;\n    }\n    else\n    {\n        pa->rightchild = p;\n    }\n    return true;\n}\n```\n\n## å›æº¯å¹³è¡¡\n\nå¯¹äºAVLæ ‘æ¥è¯´, å•çº¯çš„Insertæ˜¯ä¸å¤Ÿçš„, è¿˜éœ€è¦ä¾é å››ä¸ªå‡½æ•° - å·¦æ—‹/å³æ—‹/å·¦å³æ—‹è½¬/å³å·¦æ—‹è½¬, æ¥è¾¾åˆ°å¯¹æ ‘ç»“æ„çš„å¹³è¡¡åŒ–;\n\néœ€è¦è€ƒè™‘çš„ä¸€ä¸ªå…³é”®ç‚¹: å›æº¯çš„ç»ˆæ­¢æ¡ä»¶æ˜¯ä»€ä¹ˆ? å³forå¾ªç¯ç»ˆæ­¢åˆ¤æ–­è¯­å¥; \n\n```cpp\nvoid PassBalance(AVLNode &tree, AVLNode * ptr)\n{\n    AVLNode * pa = p->parent;\n    for(; pa != nullptr; )\n    {\n        if(pa->leftchild == p) //påœ¨paçš„å·¦è¾¹\n        switch(pa->balance)\n        {\n            case 0: //æœ¬æ¥å¹³è¡¡, æ’åˆ°å·¦, -1\n                pa->balance = -1;     break;\n            case 1: //æœ¬æ¥å³1, æ’åˆ°å·¦, 0\n                pa->balance = 0;      break;\n            case -1://æœ¬æ¥å·¦1, æ’åˆ°å·¦, éœ€è¦å¹³è¡¡\n                LeftBalance(tree, pa);break;\n        }\n        else //påœ¨paçš„å³è¾¹\n        switch(pa->balance)\n        {\n            case 0: //æœ¬æ¥å¹³è¡¡, æ’åˆ°å³, 1\n                pa->balance = 1;      break;\n            case -1://æœ¬æ¥å·¦1, æ’åˆ°å³, å¹³è¡¡\n                pa->balance = 0;      break;\n            case 1: //æœ¬æ¥å³1, æ’åˆ°å³, éœ€è¦å¹³è¡¡\n                RightBalance(tree, pa);break;\n        }\n        \n        p = pa;\n        pa = p->parent;\n    }\n}\n```\n\nè¿˜å¯ä»¥è¿›ä¸€æ­¥åšä¼˜åŒ–: å¾ªç¯ä¸ä¸€å®šè¦ä¸€ç›´ç»§ç»­ - æœ‰å¯èƒ½èŠ‚ç‚¹åœ¨æ’å…¥ä¹‹å, æ•´ä¸ªæ ‘çš„é«˜åº¦æ²¡æœ‰å‘ç”Ÿå˜åŒ–, æ­¤æ—¶æ— éœ€è¿›è¡Œå…¨éƒ¨çš„å›æº¯;\n\n```cpp\nvoid PassBalance(AVLNode &tree, AVLNode * ptr)\n{\n    AVLNode * pa = p->parent;\n    bool taller = true;\n    for(; pa != nullptr && taller; )\n    {\n        if(pa->leftchild == p) //påœ¨paçš„å·¦è¾¹\n        switch(pa->balance)\n        {\n            case 0: //æœ¬æ¥å¹³è¡¡, æ’åˆ°å·¦, -1\n                pa->balance = -1;     break;\n            case 1: //æœ¬æ¥å³1, æ’åˆ°å·¦, 0, å› æ­¤æ ‘é«˜æ— å˜åŒ–, æ— éœ€å›æº¯\n                pa->balance = 0;\n                taller = false;       break;\n            case -1://æœ¬æ¥å·¦1, æ’åˆ°å·¦, éœ€è¦å¹³è¡¡, è¿›è¡Œæ—‹è½¬å, æ ‘é«˜ä¹Ÿå¹³è¡¡äº†, æ— éœ€å›æº¯\n                LeftBalance(tree, pa);\n                taller = false;       break;\n        }\n        else //påœ¨paçš„å³è¾¹\n        switch(pa->balance)\n        {\n            case 0: //æœ¬æ¥å¹³è¡¡, æ’åˆ°å³, 1\n                pa->balance = 1;      break;\n            case -1://æœ¬æ¥å·¦1, æ’åˆ°å³, å¹³è¡¡, å› æ­¤æ ‘é«˜æ— å˜åŒ–, æ— éœ€å›æº¯\n                pa->balance = 0;\n                taller = false;       break;\n            case 1: //æœ¬æ¥å³1, æ’åˆ°å³, éœ€è¦å¹³è¡¡, è¿›è¡Œæ—‹è½¬å, æ ‘é«˜ä¹Ÿå¹³è¡¡äº†, æ— éœ€å›æº¯\n                RightBalance(tree, pa);\n                taller = false;       break;\n        }\n        \n        p = pa;\n        pa = p->parent;\n    }\n}\n```\n\nè¿™æ ·ä¸€æ¥, æ­¤å¾ªç¯æœ€å¤šè¿›å…¥ä¸¤æ¬¡å³å¯é€€å‡º, å› ä¸º, ä¸ç®¡ä½ æŠŠ`pa->balance`è°ƒä¸º`-1`æˆ–`1`, ä¸‹æ¬¡å¾ªç¯ä¸­çš„`pa->balance`è‚¯å®šä¸ä¼šæ˜¯ä¸Šæ¬¡çš„å€¼, è€ŒæŸä¸€caseä¸­, é™¤äº†ç¬¬ä¸€ç§æƒ…å†µtallerä¸ºtrue, å…¶ä»–ä¸¤ç§å‡ä¸ºfalse; \n\n### å·¦å¹³è¡¡\n\n```cpp\nvoid LeftBalance(AVLTree & tree, AVLNode * ptr)\n{\n    AVLNode * leftsub = ptr->leftchild;\n    AVLNode * rightsub = nullptr;\n    switch(leftsub->balance)\n    {\n        case 0: /* left balance, but maybe a fault */ break;\n        case -1:/* å·¦ç›´çº¿, éœ€è¦å³å•æ—‹è½¬ */\n            RotateLeft(tree, ptr);\n            ptr->balance = 0;\n            leftsub->balance = 0;                     break;\n        case 1: /* å·¦å³æŠ˜çº¿, éœ€è¦åŒæ—‹è½¬ */\n            rightsub = leftsub->rightchild;\n            switch(rightsub->balance)\n            {\n                case -1:/* åœ¨æ ¹çš„å·¦å­©å­çš„å³å­©å­çš„å·¦è¾¹æ’å…¥ */\n                    leftsub->balance = 0;\n                    ptr->balance = 1;                 break;\n                case 1: /* åœ¨æ ¹çš„å·¦å­©å­çš„å³å­©å­çš„å³è¾¹æ’å…¥ */\n                    leftsub->balance = -1;\n                    ptr->balance = 0;                 break;\n                case 0: /* */\n                    leftsub->balance = 0;\n                    ptr->balance = 0;                 break;\n            }\n            /* å…ˆä»¥æ ¹çš„å·¦å­©å­ä¸ºæ ¹èŠ‚ç‚¹, ä»¥å…¶å³å­©å­ä¸ºè½´, è¿›è¡Œå·¦å•æ—‹è½¬ */\n            RotateLeft(tree, leftsub);\n            /* å†ä»¥æ ¹(ptr)ä½œä¸ºæ ¹èŠ‚ç‚¹, ä»¥å…¶å·¦å­©å­ä¸ºè½´, è¿›è¡Œå³å•æ—‹è½¬ */\n            RotateRight(tree, ptr);\n            rightsub->balance = 0;\n            break;//case 1, end\n    }\n}\n```\n\n\n\n# Delete\n\n* å¦‚æœè¢«åˆ ç»“ç‚¹xæœ€å¤šåªæœ‰ä¸€ä¸ªå­©å­ï¼Œé‚£ä¹ˆé—®é¢˜æ¯”è¾ƒç®€å•ã€‚å¦‚æœè¢«åˆ ç»“ç‚¹xæœ‰ä¸¤ä¸ªå­©å­ï¼Œé¦–å…ˆæœç´¢åœ¨ä¸­åºæ¬¡åºä¸‹çš„ç›´æ¥å‰é©±yï¼ˆåŒæ ·å¯ä»¥æ‰¾ç›´æ¥åç»§ï¼‰ã€‚å†æŠŠç»“ç‚¹yçš„å†…å®¹ä¼ é€ç»™ç»“ç‚¹xï¼Œç°åœ¨é—®é¢˜è½¬ç§»åˆ°åˆ é™¤ç»“ç‚¹yã€‚\n  * æŠŠç»“ç‚¹yå½“ä½œè¢«åˆ ç»“ç‚¹xã€‚\n* å°†ç»“ç‚¹xä»æ ‘ä¸­åˆ å»ã€‚å› ä¸ºç»“ç‚¹xæœ€å¤šæœ‰ä¸€ä¸ªå­©å­ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°æŠŠxçš„åŒäº²ç»“ç‚¹ä¸­åŸæ¥æŒ‡å‘xçš„æŒ‡é’ˆæ”¹æŒ‡åˆ°è¿™ä¸ªå­©å­ç»“ç‚¹ï¼›å¦‚æœç»“ç‚¹xæ²¡æœ‰å­©å­ï¼ŒxåŒäº²ç»“ç‚¹çš„ç›¸åº”æŒ‡é’ˆç½®ä¸ºNULLã€‚ç„¶åå°†åŸæ¥ä»¥ç»“ç‚¹xä¸ºæ ¹çš„å­æ ‘çš„é«˜åº¦å‡1ï¼Œ\n\n* å¿…é¡»æ²¿xé€šå‘æ ¹çš„è·¯å¾„åå‘è¿½è¸ªé«˜åº¦çš„å˜åŒ–å¯¹è·¯å¾„ä¸Šå„ä¸ªç»“ç‚¹çš„å½±å“ã€‚\n* ç”¨ä¸€ä¸ªå¸ƒå°”å˜é‡shorteræ¥æŒ‡æ˜å­æ ‘çš„é«˜åº¦æ˜¯å¦è¢«ç¼©çŸ­ã€‚åœ¨æ¯ä¸ªç»“ç‚¹ä¸Šè¦åšçš„æ“ä½œå–å†³äºshorterçš„å€¼å’Œç»“ç‚¹çš„balanceï¼Œæœ‰æ—¶è¿˜è¦ä¾èµ–å­å¥³çš„balanceã€‚\n* å¸ƒå°”å˜é‡shorterçš„å€¼åˆå§‹åŒ–ä¸ºTrueã€‚ç„¶åå¯¹äºä»xçš„åŒäº²åˆ°æ ¹çš„è·¯å¾„ä¸Šçš„å„ä¸ªç»“ç‚¹pï¼Œåœ¨shorterä¿æŒä¸ºTrueæ—¶æ‰§è¡Œä¸‹é¢çš„æ“ä½œã€‚å¦‚æœshorterå˜æˆFalseï¼Œç®—æ³•ç»ˆæ­¢ã€‚\n\n* case 1ï¼šå½“å‰èŠ‚ç‚¹pçš„balanceä¸º0ã€‚\n  * å¦‚æœå®ƒçš„å·¦å­æ ‘æˆ–å³å­æ ‘è¢«ç¼©çŸ­ï¼Œåˆ™å®ƒçš„balanceæ”¹ä¸º1æˆ–-1ï¼ŒåŒæ—¶shorterç½®ä¸ºfalseã€‚\n* case 2ï¼šèŠ‚ç‚¹pçš„balanceä¸ä¸º0ï¼Œä¸”è¾ƒé«˜çš„å­æ ‘è¢«ç¼©çŸ­ï¼Œåˆ™pçš„balanceæ”¹ä¸º0ï¼ŒåŒæ—¶shorterç½®ä¸ºtrueã€‚\n\n![image-20220320184924205](../../images/é«˜çº§æ•°æ®ç»“æ„_å¹³è¡¡æœç´¢æ ‘/image-20220320184924205.png)\n","categories":["é«˜çº§æ•°æ®ç»“æ„","æ ‘"]},{"title":"Cpp_å€¼ç±»å‹_å¼•ç”¨æŠ˜å ","url":"/Cpp/Cpp_å€¼ç±»å‹_å¼•ç”¨æŠ˜å /","content":"# `static_cast`\n\n`int a`ä¸èƒ½ç›´æ¥ç”¨`int && e`æ¥æ”¶ã€‚\n```cpp\nint main()\n{\n    int a = 12;\n    int && e = a;  // error\n    e = 13;\n}\n```\n\n`int a`å¼ºè½¬ä¸º`int&&`æ—¶ï¼Œå¯ä»¥ç”¨`int && e`æ¥æ”¶ï¼Œä¿®æ”¹eï¼Œä¼šè¿å¸¦ä¿®æ”¹aã€‚\n```cpp\nint main()\n{\n    int a = 12;\n    int && e = static_cast<int&&>(a);\n    e = 13;     // e = 13; a = 13\n}\n```\n`int a`å¼ºè½¬ä¸º`int`æ—¶ï¼Œå¯ä»¥ç”¨`int && e`æ¥æ”¶ï¼Œä¿®æ”¹eï¼Œä¸ä¼šè¿å¸¦ä¿®æ”¹aã€‚\n\n> ä¸ºä»€ä¹ˆï¼Ÿ\n> å¼ºè½¬ä¸ºå€¼ç±»å‹æ—¶ï¼Œç›¸å½“äºæ‹·è´äº†ä¸€ä»½ä¸´æ—¶å¯¹è±¡ï¼ˆå¦åˆ›ç©ºé—´ï¼‰ã€‚\n\n```cpp\nint main()\n{\n    int a = 12;\n    int && e = static_cast<int>(a);\n    e = 13;     // e = 13; a = 12\n}\n```\n\n# ç§»åŠ¨æ„é€ ï¼ˆæ‹·è´å³å€¼æ„é€ ï¼‰\n1. å‚æ•°ä¸èƒ½åŠ constï¼Œå› ä¸ºè¯­ä¹‰ä¸Šï¼Œæ˜¯è¦æŠŠotherå¯¹è±¡çš„èµ„æºç§»åŠ¨è¿‡æ¥ï¼Œæ˜¯éœ€è¦æ”¹åŠ¨otherçš„ã€‚\n2. ç»éªŒä¸Šï¼Œè¦æŠŠç§»åŠ¨æ„é€ å‡½æ•°å£°æ˜ä¸ºnoexceptï¼Œå› ä¸ºæ¶‰åŠåˆ°èµ„æºçš„ç§»åŠ¨çš„åŠ¨ä½œè¿‡ç¨‹ä¸­å³ä½¿å‡ºç°äº†å¼‚å¸¸ä¹Ÿæ— æ³•å¤„ç†ã€ä¿®å¤ã€‚\n\n```cpp\nclass Test\n{\npublic:\n    Test(int val) : _val { new int(val) }\n    {}\n    // ä»¥éå³å€¼å¯¹è±¡æ‹·è´æ„é€ \n    Test(Test const & other)\n    {\n        _val = new int(*other._val);\n    }\n    // ä»¥å³å€¼å¯¹è±¡ç§»åŠ¨æ„é€ \n    Test(Test && other) noexcept\n    {\n        _val = other._val;\n        other._val = nullptr;\n    }\n    ~Test()\n    {\n        if(_val)\n        {\n            delete _val;\n            _val = nullptr;\n        }\n    }\n    void set_value(int v)\n    {\n        if(_val)\n        {\n            *_val = v;\n        }\n    }\nprivate:\n    int * _val;\n};\n```\næµ‹è¯•ç§»åŠ¨æ„é€ ï¼šä»¥ä¸‹ä»£ç æœªèƒ½èµ°åˆ°ç§»åŠ¨æ„é€ å‡½æ•°çš„æ–­ç‚¹â€”â€”ç¼–è¯‘å™¨ä¼˜åŒ–äº†\n\n> ç¼–è¯‘å™¨ä¼˜åŒ–äº†ï¼š`Test test{ get_test() }`ã€‚æ²¡èµ°ç§»åŠ¨æ„é€ ï¼Œè€Œæ˜¯ç›´æ¥æŠŠ`Test test{5}`åœ¨mainå‡½æ•°ä¸­çš„testä¸Šæ„é€ äº†ã€‚\n> è¿™ä¸ªç°è±¡å«åšï¼šå…·åçš„è¿”å›å€¼ä¼˜åŒ–ã€‚\n\n```cpp\nTest get_test(void)\n{\n    Test test{5};\n    return test;\n}\nint main()\n{\n    Test test{ get_test() };\n}\n```\nå¦‚æœä¸ä¼˜åŒ–çš„è¯ï¼Œä¼šæ˜¯ä»¥ä¸‹çš„æƒ…å†µï¼šä¸€å…±åˆ›å»ºäº†3ä¸ªå¯¹è±¡ï¼Œæœ‰2ä¸ªæ˜¯ä¸­é—´æ— ç”¨çš„ä¸´æ—¶å¯¹è±¡\n```cpp\nTest get_test(void)\n{\n    Test test{ 5 };         // create a new test object\n    return test;            // generated a temporary test object\n}\nint main()\n{\n    Test test{ get_test() };// create a new object by calling copy-constructor\n}\n```\nä¸ºäº†èƒ½çœ‹åˆ°ç§»åŠ¨æ„é€ å‡½æ•°çš„æ–­ç‚¹ï¼šä¸é€šè¿‡å‡½æ•°è¿”å›çš„ä¸´æ—¶å€¼ï¼Œé€šè¿‡è‡ªå·±æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªtestï¼Œæ¥å¼ºè½¬ä¸ºå³å€¼å¼•ç”¨ï¼Œä»è€Œç§»åŠ¨æ„é€ æ–°çš„testã€‚\n```cpp\nint main()\n{\n    Test test2{ static_cast<Test&&>(test) };\n}\n```\n# èµ‹å€¼é‡è½½\n\nä»¥éå³å€¼å¯¹è±¡èµ‹å€¼\n```cpp\nTest & operator=(Test const& other)\n{\n    if(&other == this) return *this;\n    if(_val != nullptr)\n    {\n        delete _val;\n        _val = nullptr;\n    }\n    if(other._val != nullptr) \n    {\n        _val = new int { *other._val };\n    }\n    return *this;\n}\n```\n\nä»¥å³å€¼å¯¹è±¡èµ‹å€¼\n```cpp\nTest & operator=(Test && other)\n{\n    if(&other == this) return *this;\n    if(_val != nullptr)\n    {\n        delete _val;\n        _val = nullptr;\n    }\n    _val = other._val;\n    return *this;\n}\n```\n\n# `static_cast`ä¸‰ç§å€¼ç±»å‹çš„è¡Œä¸º\n\næ²¡æœ‰å˜é‡æ¥æ”¶æ—¶çš„è¡Œä¸ºï¼š\n```cpp\nint main()\n{\n    Test test{ 2 };\n\n    static_cast<Test>(test);\n    static_cast<Test&>(test);\n    static_cast<Test&&>(test);\n    \n}\n```\n\né€šè¿‡æ–­ç‚¹è°ƒè¯•ï¼Œå‘ç°ï¼Œå¼ºè½¬ä¸ºæ™®é€šå€¼ç±»å‹`<Test>`æ—¶ï¼Œè€Œä¸”æ˜¯åœ¨ä¸è¿›è¡Œå…¶ä»–æ“ä½œçš„æƒ…å†µä¸‹ï¼Œä»ä¼šè°ƒç”¨ä¸€æ¬¡æ™®é€šæ‹·è´æ„é€ å‡½æ•°ã€‚å…¶ä»–ä¸¤å¥ä¸ä¼šè¿›è¡Œæ‹·è´ã€‚\n\næ¥ä¸‹æ¥ç ”ç©¶å…¶ä»–ä¸¤ä¸ªè¯­å¥â€”â€”åœ¨æœ‰å˜é‡æ¥æ”¶æ—¶çš„è¡Œä¸ºã€‚\n## å¼ºè½¬ä¸ºæ™®é€šå€¼ç±»å‹\n1. ä»¥æ™®é€šå€¼ç±»å‹æ¥æ”¶æ—¶ï¼Œä¼šæ‹·è´ï¼Œè°ƒç”¨çš„æ˜¯æ™®é€šæ‹·è´æ„é€ ï¼›\n2. ä¸å¯ä»¥å·¦å€¼å¼•ç”¨æ¥æ”¶æ™®é€šå€¼ç±»å‹ã€‚\n3. ä»¥å³å€¼å¼•ç”¨æ¥æ”¶æ—¶ï¼Œ**ä¹Ÿä¼šæ‹·è´**ï¼Œè°ƒç”¨çš„æ˜¯æ™®é€šæ‹·è´æ„é€ ã€‚\n\n```cpp\nint main()\n{\n    Test test{ 2 };\n\n    Test    test11 = static_cast<Test>(test);\n    Test &  test12 = static_cast<Test>(test);\n    Test && test13 = static_cast<Test>(test);\n}\n```\n## å¼ºè½¬ä¸ºå·¦å€¼\n1. ä»¥æ™®é€šå€¼ç±»å‹æ¥æ”¶æ—¶ï¼Œä¼šæ‹·è´ï¼Œè°ƒç”¨çš„æ˜¯æ™®é€šæ‹·è´æ„é€ ï¼›\n2. ä»¥å·¦å€¼å¼•ç”¨æ¥æ”¶æ—¶ï¼Œä¸ä¼šæ‹·è´ï¼Œ**æ˜¯é«˜æ•ˆçš„ç”¨æ³•**ã€‚\n3.  ä¸å¯ä»¥å³å€¼å¼•ç”¨æ¥æ”¶å·¦å€¼ã€‚\n\n```cpp\nint main()\n{\n    Test test{ 2 };\n\n    Test    test21 = static_cast<Test&>(test);\n    Test &  test22 = static_cast<Test&>(test);\n  //Test && test23 = static_cast<Test&>(test);  // error\n}\n```\n## å¼ºè½¬ä¸ºå³å€¼\n1. ä»¥æ™®é€šå€¼ç±»å‹æ¥æ”¶æ—¶ï¼Œä¼šæ‹·è´ï¼Œ**è°ƒç”¨å³å€¼æ„é€ **ï¼ˆå¦‚æœå³å€¼æ„é€ è¾ƒå¥½åœ°å¤„ç†äº†èµ„æºçš„ç§»åŠ¨ï¼Œåˆ™è¾ƒé«˜æ•ˆã€‚**è‹¥æ²¡æœ‰æ˜ç¡®å†™å³å€¼æ„é€ ï¼Œåˆ™ä»ä¼šè¿›è¡Œæ™®é€šæ‹·è´ï¼Œåˆ™é™ä½äº†æ•ˆç‡**ï¼‰ï¼›\n2. ä¸å¯ä»¥å·¦å€¼å¼•ç”¨æ¥æ”¶å³å€¼ã€‚\n3. ä»¥å³å€¼å¼•ç”¨æ¥æ”¶æ—¶ï¼Œä¸ä¼šæ‹·è´ï¼Œ**æ˜¯é«˜æ•ˆçš„ç”¨æ³•**ã€‚\n\n```cpp\nint main()\n{\n    Test test{ 2 };\n\n    Test    test31 = static_cast<Test&&>(test);  // decide on Move Constructor\n  //Test &  test32 = static_cast<Test&&>(test);  // error\n    Test && test33 = static_cast<Test&&>(test);\n}\n```\n\nå…¶ä¸­ï¼Œä»¥â€œå³å€¼å¼•ç”¨ç±»å‹â€æ¥æ”¶â€œå¼ºè½¬ä¸ºå³å€¼çš„å¯¹è±¡â€ï¼ˆæˆ–è€…`std::move`åçš„å¯¹è±¡ï¼‰ï¼Œè¿™ä¸ªè¡Œä¸ºå…¶å®æ˜¯å¯¹â€œå³å€¼å¯¹è±¡â€çš„ç”Ÿå‘½æœŸçš„å»¶å±•ã€‚å¦‚æœé€šè¿‡å³å€¼å¼•ç”¨æ¥ä¿®æ”¹å¯¹è±¡ï¼Œé‚£ä¹ˆå¯¹è±¡æºå€¼ä¹Ÿä¼šä¿®æ”¹ã€‚è¿™æ‰æ˜¯å³å€¼å¼•ç”¨æœ€æœ¬åŸçš„åŠŸèƒ½ã€‚\n```cpp\nint main()\n{\n    Test test{ 2 };\n    // test    : _val : 2\n\n    Test && test33 = static_cast<Test&&>(test);\n    test33.set_value(4);\n    // test.33 : _val : 4\n    // test    : _val : 4\n}\n```\n## æ€»ç»“\n\nModern Cppå¼•å…¥äº†å€¼ç±»å‹çš„ç»†åˆ†ï¼Œä¸æ˜¯è®©ä½ è£…é€¼çš„ï¼Œä¹Ÿä¸æ˜¯ä¸ºäº†ç»™ç¨‹åºå‘˜å¢åŠ ç—›è‹¦çš„ï¼Œè€Œæ˜¯ä¸ºäº†è®©å„ç§ç±»å‹éƒ½æœ‰å®ƒæœ€å¥½çš„å½’å®¿ï¼š\n1. å·¦å€¼äº¤ç»™å·¦å€¼å¼•ç”¨ï¼ˆä¸ä¼šæœ‰ä»»ä½•å…¶ä»–å¤šä½™çš„æ“ä½œï¼Œé«˜æ•ˆè½¬æ‰‹ï¼‰\n2. å³å€¼äº¤ç»™å³å€¼å¼•ç”¨ï¼ˆä¸ä¼šæœ‰ä»»ä½•å…¶ä»–å¤šä½™çš„æ“ä½œï¼Œé«˜æ•ˆè½¬æ‰‹ï¼‰\n3. å³å€¼äº¤ç»™æ™®é€šç±»å‹ï¼ˆè°ƒç”¨å³å€¼æ„é€ ï¼Œå¦‚æœå³å€¼æ„é€ è¾ƒå¥½åœ°å¤„ç†äº†èµ„æºçš„ç§»åŠ¨ï¼Œåˆ™è¾ƒé«˜æ•ˆï¼‰\n\n1. å¯¹äºå‰ä¸¤ç§æ¥è¯´ï¼Œåªè¦å¼•ç”¨ç±»å‹åŒ¹é…ï¼Œåˆ™æ— éœ€ç¨‹åºå‘˜è´¹å¿ƒï¼Œä¾¿å¯æé«˜æ•ˆç‡ã€‚\n2. è€Œå¯¹äºç¨‹åºå‘˜æ¥è¯´ï¼Œæœ€è¦æ³¨æ„çš„å°±æ˜¯ç¬¬ä¸‰ç§æƒ…å†µï¼Œå³å³å€¼æ„é€ å‡½æ•°éœ€è¦ç¨‹åºå‘˜æ¥æ˜ç¡®å†™å‡ºï¼ŒæŒ‡æ˜èµ„æºè½¬ç§»çš„åŠ¨ä½œï¼Œå†³å®šäº†å³å€¼äº¤ç»™æ™®é€šç±»å‹çš„æ•ˆç‡ã€‚**å¦‚æœæ²¡æœ‰å†™å³å€¼æ„é€ å‡½æ•°ï¼Œåˆ™ä»ä¼šè¿›è¡Œæ™®é€šæ‹·è´ï¼Œåˆ™é™ä½äº†æ•ˆç‡ã€‚**\n# `forwarding_reference`\n\nå½¢å¼ä¸Šå’Œå³å€¼å¼•ç”¨ä¸€æ ·ï¼Œä½†æ€§è´¨ã€è¡Œä¸ºæ˜¯æœªå®šä¹‰çš„ã€‚\n1. ä¼ å…¥æ¨¡æ¿çš„ç±»å‹ï¼Œæ˜¯ä¸ç¡®å®šçš„ï¼Œéœ€è¦æ¥æ”¶åå¦å¤–æ¨æ–­ã€‚\n2. ä¼ ç»™autoçš„ç±»å‹ï¼Œäº¦å¦‚æ­¤ï¼Œæ¥æ”¶åéœ€è¦æ¨æ–­ã€‚\n\nå›°æ‰°ï¼š\n```cpp\ntemplate<typename T>\nvoid test(T const & t)\n{\n    \n}\n\nint main()\n{\n    const int ca = 10;\n    int a = 11;\n    test(ca);\n    test(a);\n    test(9);\n}\n```\né—®é¢˜ï¼šå­—é¢å¸¸é‡æ— æ³•ä¼ é€’ç»™`T & t`ã€‚\näºæ˜¯åŠ äº†`T const & t`ï¼Œå¯ä»¥ä¼ é€’äº†ã€‚\n\nä½†æ˜¯ï¼Œå¯¼è‡´ï¼Œå¦‚æœä¼ çš„æ˜¯const intå˜é‡ï¼Œåˆ™TååŠ constä¸å¦å¯¹åº”çš„è¡Œä¸ºä¸ä¸€æ ·ã€‚\næ€»ç»“èµ·æ¥å°±æ˜¯ï¼š\n1. Tåæ— constæ—¶\n    1. ä¼ å…¥éå¸¸å·¦å€¼ï¼ŒTå¯¹åº”çš„ç±»å‹æ˜¯`const int`ï¼Œtå¯¹åº”çš„ç±»å‹æ˜¯`const int &`\n    2. ä¼ å…¥å¸¸å·¦å€¼ï¼ŒTå¯¹åº”çš„ç±»å‹æ˜¯`int`ï¼Œtå¯¹åº”çš„ç±»å‹æ˜¯`int &`\n    3. å¸¸æ€§åœ¨ä¼ å…¥å‰åå§‹ç»ˆæ˜¯å¯¹åº”çš„ï¼Œå¾ˆå¥½ã€‚\n    4. ä½†æ˜¯ï¼šä¸èƒ½æ¥æ”¶å³å€¼ã€‚\n    5. æ€»ç»“ï¼šè™½ç„¶ä¸æ€ä¹ˆé€šç”¨ï¼Œä½†æ˜¯èµ·ç æ²¡æœ‰å¾ˆä¹±ã€‚\n2. Tåæœ‰constæ—¶\n    1. èƒ½æ¥æ”¶å³å€¼äº†ï¼Œå¾ˆå¥½ã€‚\n    2. ä½†æ˜¯ï¼Œæ— è®ºä¼ å…¥çš„æ˜¯å¸¸å·¦å€¼ã€éå¸¸å·¦å€¼ã€å³å€¼ï¼Œæœ€åï¼ŒTå¯¹åº”çš„ç±»å‹éƒ½ä¼šæ˜¯`int`ï¼Œtå¯¹åº”çš„ç±»å‹éƒ½ä¼šæ˜¯`const int &`ã€‚\n    3. é‚£ä¹ˆå°±å¯¼è‡´ï¼šå¦‚æœä¼ å…¥çš„æ˜¯éå¸¸å·¦å€¼ï¼Œç”±äºtè¢«æ±¡æŸ“æˆäº†const intï¼Œå¯¼è‡´tæ— æ³•ä¿®æ”¹ã€‚\n## å…¨æ–°çš„è§£å†³æ–¹æ¡ˆ\n\nä½¿ç”¨`T &&`è¿™ä¸ªå½¢å¼æ”¹è¿›`T const & `ã€‚è™½ç„¶æ ·å­çœ‹èµ·æ¥æ˜¯å³å€¼å¼•ç”¨ï¼Œä½†å®ƒä¸æ˜¯ï¼Œå› ä¸ºTæ˜¯ä¸ç¡®å®šç±»å‹ï¼Œè€Œå®ƒåˆå¸¸ç”¨åœ¨å‚æ•°è½¬å‘ä¸­ï¼Œæ‰€ä»¥èµ·äº†æ–°åå«â€è½¬å‘å¼•ç”¨ (Forwarding Reference)â€œï¼ˆä¹Ÿæœ‰äººå«Universal Referenceï¼‰ã€‚æ ¹æ®æ¥æ”¶çš„å€¼ç±»å‹çš„ä¸åŒï¼ŒTä¹Ÿä¼šè·Ÿç€å˜åŒ–ã€‚\n\nåŒ…å®¹åº¦å’Œ`T const &`ä¸€æ ·ï¼Œæ—¢èƒ½æ¥æ”¶å¸¸å·¦å€¼ã€éå¸¸å·¦å€¼ï¼Œåˆèƒ½æ¥æ”¶å³å€¼ã€‚\næœ€ç»ˆè¾¾åˆ°çš„æ•ˆæœå´æ¯”`T const &`æ›´å¥½ï¼š\n1. å¸¸å·¦å€¼ï¼ŒTå¯¹åº”çš„ç±»å‹æ˜¯`const int &`ï¼Œtå¯¹åº”çš„ç±»å‹æ˜¯`const int &`\n2. å·¦å€¼ï¼ŒTå¯¹åº”çš„ç±»å‹æ˜¯`int &`ï¼Œtå¯¹åº”çš„ç±»å‹æ˜¯`int &`\n3. å³å€¼ï¼ŒTå¯¹åº”çš„ç±»å‹æ˜¯`int`ï¼Œtå¯¹åº”çš„ç±»å‹æ˜¯`int &&`\n\n```cpp\ntemplate<typename T>\nvoid test(T && t)\n{\n    \n}\n\nint main()\n{\n    int a = 11;\n    test(a);\n    test(9);\n}\n```\n## å¼•ç”¨æŠ˜å \nReference Collapsed\n## æ¨¡æ¿å‚æ•°ä¸­çš„`&&`\n\nè™½ç„¶ç»è¿‡ä¼ å…¥ï¼Œå˜æˆäº†å¯¹åº”çš„å¼•ç”¨ï¼Œåœ¨å‡½æ•°ä¸­ä¹Ÿå¯ä»¥ä¿®æ”¹tçš„å€¼ï¼ˆconstç±»å‹é™¤å¤–ï¼‰ï¼Œä½†æ˜¯å…¶å®æ²¡å•¥æ„ä¹‰ï¼Œè¿™ä¸ªè½¬å‘å¼•ç”¨çš„æ„ä¹‰å°±æ˜¯åœ¨äºè®©ä½ è½¬å‘çš„ï¼Œä¸æ˜¯ä¿®æ”¹å€¼ã€‚\n\n```cpp\ntemplate <typename T>\nvoid test(T && t)\n{\n    t = 8;\n}\nint main()\n{\n    int a = 11;\n    test(a);    // å¯ä»¥æŠŠæœ¬èº«æ”¹ä¸º8ã€‚\n    test(9);    // 9è¿˜æ˜¯9ï¼Œä¸å˜ã€‚   t = 8ä¿®æ”¹çš„æ˜¯å‰¯æœ¬\n}\n```\n## autoåçš„`&&`\n\n```cpp\nint main()\n{\n    int a = 11;\n  //int  && ri = a;   // error  å³å€¼å¼•ç”¨æ— æ³•æ¥æ”¶å·¦å€¼\n  //auto &  la = 9;   // error  å·¦å€¼å¼•ç”¨æ— æ³•æ¥æ”¶å³å€¼\n    auto && ra = a;   // ok     ra : int &  \n    auto && ra2= 9;   // ok     ra2: int && ra2\n}\n```\n# move\n\næŠŠä¼ å…¥çš„å€¼ç±»å‹è½¬æ¢ä¸ºå³å€¼ã€‚\n\n```cpp\ntemplate<typename T>\nT&& mymove(T && t)\n{\n    return static_cast<T&&>(t);\n}\n```\n\n```\nT: int & + && -> t: int &\nT: int   + && -> t: int && \n```\nç°åœ¨çš„é—®é¢˜æ˜¯ï¼šä¼ å…¥ä¸åŒå€¼ç±»å‹çš„å˜é‡åï¼Œè¡Œä¸ºä¸ä¸€è‡´ã€‚è‹¥æ˜¯å·¦å€¼ï¼Œåˆ™æœ€ç»ˆåªèƒ½å¼ºè½¬ä¸º`int &`ï¼›è‹¥ä¸ºå³å€¼ï¼Œåˆ™æœ€ç»ˆåªèƒ½å¼ºè½¬ä¸º`int &&`ã€‚ç°åœ¨æˆ‘ä»¬æƒ³è¦è¿½æ±‚ï¼šæ— è®ºå·¦å³å€¼ï¼Œæœ€ç»ˆéƒ½è½¬ä¸ºå·¦å€¼ã€‚\n\né‚£ä¹ˆå¯ä»¥è€ƒè™‘ç”¨TraitsæŠ€æœ¯ï¼Œæ¶ˆé™¤å·¦å³å€¼çš„åŒºåˆ«ã€å½±å“ï¼Œç»Ÿä¸€ã€‚\n```cpp\ntemplate<typename T>\nclass RemoveRefTraits\n{\npublic:\n    using TYPE = T;\n};\n\ntemplate<typename T>\nclass RemoveRefTraits<T&>\n{\npublic:\n    using TYPE = T;\n};\n\ntemplate<typename T>\nclass RemoveRefTraits<T&&>\n{\npublic:\n    using TYPE = T;\n};\n\ntemplate <typename T>\nusing RemRef_t = RemoveRefTraits<T>::TYPE;\n```\n\n```cpp\ntemplate<typename T>\nRemRef_t<T>&& mymove(T && t)\n{\n    return static_cast<RemRef_t<T>&&>(t);\n}\n```\n# å®Œç¾è½¬å‘\nPerfect Forwarding\n\n","categories":["Cpp","Modern"]},{"title":"é«˜çº§æ•°æ®ç»“æ„_æœç´¢æ ‘","url":"/é«˜çº§æ•°æ®ç»“æ„/é«˜çº§æ•°æ®ç»“æ„_æœç´¢æ ‘/","content":"\n# å†…å®¹\n\n1. å„ç§æœç´¢æ ‘ä¹‹é—´çš„å…³ç³»\n2. æ ‘å¼æŸ¥æ‰¾çš„æ€»ä½“æ„æ€\n3. æ ‘å¼æŸ¥æ‰¾åŸºæœ¬ç®—æ³•ä¸æ•°æ®ç»“æ„\n4. äºŒå‰æœç´¢æ ‘--åŸºäºåŠçº¿æ€§çš„æ ‘å½¢ç»“æ„\n5. æˆ‘ä»¬çš„ç†æƒ³ï¼šå…¼é¡¾åŠ¨æ€ä¿®æ”¹ä¸é™æ€æŸ¥æ‰¾æ“ä½œæ•ˆç‡\n6. ç†æƒ³å¹³è¡¡\n7. é€‚åº¦å¹³è¡¡\n8. AVL--å¹³è¡¡äºŒå‰æœç´¢æ ‘--æœ€åæƒ…å†µä¸‹ï¼Œå•æ¬¡åŠ¨æ€ä¿®æ”¹å’Œé™æ€æŸ¥æ‰¾ä¹Ÿå‡å¯ä»¥åœ¨O(logn)æ—¶é—´å†…å®Œæˆ\n\næœ¬æ–‡ç« çš„æœç´¢æ ‘å®ç°æœ‰ä¸¤ç§æ–¹å¼\n\n1. ç±»Cç»“æ„ä½“å®ç°æ–¹å¼ï¼Œè‡ªå­¦ä¹ å®ç°ã€‚\n2. æ¨¡æ¿ç±»å®ç°æ–¹å¼ï¼Œå‚è€ƒé‚“ä¿Šè¾‰çš„ã€Šæ•°æ®ç»“æ„\\_C++è¯­è¨€ç‰ˆ\\_ç¬¬3ç‰ˆã€‹ã€‚\n\n## å„ç§æœç´¢æ ‘ä¹‹é—´çš„å…³ç³»\n\n![image-20220312143749079](../../images/é«˜çº§æ•°æ®ç»“æ„_æœç´¢æ ‘/image-20220312143749079.png)\n\n# äºŒå‰æœç´¢æ ‘--ç±»Cç»“æ„ä½“\n\n## èŠ‚ç‚¹ç»“æ„\n\n* èŠ‚ç‚¹ç»“æ„\n\n```c++\ntypedef int KeyType;\ntypedef struct BstNode\n{\n\tKeyType key;\n\tBstNode* leftchild;\n\tBstNode* parent;\n\tBstNode* rightchild;\n}BstNode,*BSTree;\n```\n\n* Buynode\n\n```c++\nBstNode* Buynode()\n{\n\tBstNode* s = (BstNode*)malloc(sizeof(BstNode));\n\tif (NULL == s)exit(1);\n\tmemset(s, 0, sizeof(BstNode));\n\treturn s;\n}\n```\n\n## Insert\n\n```c++\nBstNode* MakeRoot(KeyType kx)\n{\n\tBstNode* pnode = Buynode();\n\tpnode->key = kx;\n\treturn pnode;\n}\nbool Insert(BstNode*& ptr, KeyType kx)\n{\n\tif (ptr == NULL)\n\t{\n\t\tptr = MakeRoot(kx);\n\t\treturn true;\n\t}\n\tBstNode* p = ptr;\t//éå†Nodeçš„æŒ‡é’ˆ\n\tBstNode* pa = NULL;\t//å®æ—¶è¿½è¸ªpçš„parent\n\twhile (p != NULL && p->key != kx)\n\t{\n\t\tpa = p;\n\t\tp = kx < p->key ? p->leftchild : p->rightchild;\n\t}\n\t/* å®é™…ä¸Šä¸ç”¨å†åˆ¤æ–­p->key == kx, åªè¦p != NULLå°±è¯´æ˜æ‰¾åˆ°äº†ç›¸ç­‰çš„èŠ‚ç‚¹ï¼Œ\n\t   å¦‚æœæ­¤æ—¶p!=NULLçš„è¯ï¼Œä¸Šé¢çš„whileå¾ªç¯çš„é€€å‡ºå°±æ˜¯å› ä¸ºp->key==kxè€Œé€€å‡ºçš„\n\t*/\n\tif (p != NULL /* && p->key == kx */)return false;\n\n\t// æ­¤æ—¶å·²ç»æ‰¾åˆ°è¦æ’å…¥çš„ä½ç½®\n\tp = Buynode();\n\tp->key = kx;\n\tp->parent = pa;\n\t// æ›´æ–°paçš„å·¦æˆ–å³å­©å­\n\tif (p->key < pa->key) pa->leftchild = p;\n\telse pa->rightchild = p;\n\treturn true;\n}\n```\n\nä»£ç ç»“æ„ä¼˜åŒ–--Insertä¸­åŒ…å«äº†å»ºæ ¹çš„æƒ…å†µ\n\n```c++\nbool Insert(BstNode*& ptr, KeyType kx)\n{\n\tBstNode* p = ptr;\t//éå†Nodeçš„æŒ‡é’ˆ\n\tBstNode* pa = NULL;\t//å®æ—¶è¿½è¸ªpçš„parent\n\twhile (p != NULL && p->key != kx)\n\t{\n\t\tpa = p;\n\t\tp = kx < p->key ? p->leftchild : p->rightchild;\n\t}\n\tif (p != NULL)return false;\n\n\t// æ­¤æ—¶å·²ç»æ‰¾åˆ°è¦æ’å…¥çš„ä½ç½®\t\t\t//å…¶ä¸­ï¼ŒåŒ…æ‹¬æ ¹ä¸ºç©ºçš„æƒ…å†µ\n\tp = Buynode();\n\tp->key = kx;\n\tp->parent = pa;\n    if(pa == NULL)\t//å»ºæ ¹çš„æƒ…å†µ\n    {\n        ptr = p;\n    }\n    else // æ›´æ–°paçš„å·¦æˆ–å³å­©å­\n    {\n        if(p->key < pa->key)\n            pa->leftchild = p;\n        else \n            pa->rightchild = p;\n    }\n    return true;\n}\n```\n\n### æµ‹è¯•\n\n```c++\nvoid InOrder(BstNode* ptr)\n{\n\tif (ptr != NULL)\n\t{\n\t\tInOrder(ptr->leftchild);\n\t\tcout << ptr->key << \" \";\n\t\tInOrder(ptr->rightchild);\n\t}\n}\nint main()\n{\n\tBSTree root = NULL;\n\tint ar[] = { 53,17,78,9,45,65,87,23,81,94,88,100 };\n\tint n = sizeof(ar) / sizeof(ar[0]);\n\tfor (int i = 0; i < n; ++i)\n\t{\n\t\tcout << Insert(root, ar[i]) << endl;\n\t}\n    InOrder(root);cout << endl;\n\treturn 0;\n}\n```\n\n## Next & NiceInOrder\n\n```c++\nBstNode* First(BstNode* ptr)\n{\n\twhile (ptr != NULL && ptr->leftchild != NULL)\n\t{\n\t\tptr = ptr->leftchild;\n\t}\n\treturn ptr;\n}\n// æ‰¾åˆ°å½“å‰èŠ‚ç‚¹çš„ç›´æ¥åç»§ï¼ˆæŒ‰å…³é”®ç å¤§å°ï¼‰\nBstNode* Next(BstNode* ptr)\n{\n\tif (ptr == NULL)return NULL;\n    // å­˜åœ¨å³åˆ†æ”¯\n\tif (ptr->rightchild != NULL)\n\t{\n\t\treturn First(ptr->rightchild);\n\t}\n\telse // æ²¡æœ‰å³åˆ†æ”¯\n\t{\n\t\tBstNode* pa = ptr->parent;\n        // æ²¿ç€å³å­æ ‘å›æº¯ï¼Œç›´åˆ°æ‰¾åˆ°è‡ªå·±ä½œä¸ºçˆ¶èŠ‚ç‚¹çš„å·¦å­æ ‘\n        // è¿™ä¸€è¿‡ç¨‹å¯ä»¥ç”¨ä¸­åºéå†çš„æ¬¡åºè§£é‡Š\n        while(pa != NULL && pa->leftchild != ptr)\n        {\n            ptr = pa;\n            pa = ptr->parent;\n        }\n        return pa;\n\t}\n}\n```\n\n```c++\nvoid NiceInOrder(BstNode* ptr)\n{\n    for(BstNode* p = First(ptr); p != NULL; p = Next(p))\n    {\n        cout << p->key << \" \";\n    }\n    cout << endl;\n}\n```\n\n## Prev & NiceRevInOrder\n\n```c++\nBstNode* Last(BstNode* ptr)\n{\n\twhile (ptr != NULL && ptr->rightchild != NULL)\n\t{\n\t\tptr = ptr->rightchild;\n\t}\n\treturn ptr;\n}\nBstNode* Prev(BstNode* ptr)\n{\n    if(ptr == NULL)return NULL;\n    // å­˜åœ¨å·¦åˆ†æ”¯\n    if(ptr->leftchild != NULL)\n    {\n        return Last(ptr->leftchild);\n    }\n    else\n    {\n        BstNode* pa = ptr->parent;\n        while(pa != NULL && pa->leftchild != ptr)\n        {\n            ptr = pa;\n            pa = ptr->parent;\n        }\n        return pa;\n    }\n}\n```\n\n```c++\nvoid NiceRevInOrder(BstNode* ptr)\n{\n    for(BstNode* p = Last(ptr); p != NULL; p = Prev(p))\n    {\n        cout << p->key << \" \";\n    }\n    cout << endl;\n}\n```\n\n## Remove\n\n```c++\nbool Remove(BstNode*& ptr, KeyType kx)\n{\n    if(ptr == NULL)return false;\n    BstNode* p = ptr;\n    while(p != NULL && p->key != kx)\n    {\n        p = kx < p->key ? p->leftchild : p->rightchild;\n    }\n    if(p == NULL)return false;\n    \n    //åŒåˆ†æ”¯çš„ç‰¹æ®Šå¤„ç†ï¼Œä¸ç›´æ¥åç»§èŠ‚ç‚¹æ›¿æ¢ã€‚æŠŠåˆ é™¤çš„ç›®æ ‡è½¬å‘å…¶ç›´æ¥åç»§èŠ‚ç‚¹ã€‚è¿›è€Œè½¬ä¸ºåˆ é™¤å•åˆ†æ”¯èŠ‚ç‚¹çš„æƒ…å†µï¼\n    if(p->leftchild != NULL && p->rightchild != NULL)\n    {\n        BstNode * psucc = First(p->rightchild);\t//succ: successor,åç»§\n        p->key = psucc->key;\n        p = psucc;\n    } \n    //å•åˆ†æ”¯ã€å¶å­é€šç”¨\n    BstNode* pa = p->parent;\n    BstNode * newchild = p->leftchild!=NULL ? p->leftchild : p->rightchild;\n    \n    // ä½¿pä¸newchildè§£é™¤å…³ç³»\n    \t//ç»´æŠ¤newchildçš„parent\n    if(newchild != NULL)newchild->parent = pa;\n    \t//è§£é™¤pçš„childå…³ç³»ï¼Œç”±äºå°†è¢«åˆ å»ï¼ŒæŠŠpçš„å·¦å³å­©å­ç½®ä¸ºNULL\n    p->rightchild = p->leftchild = NULL;\n    \n    //æ­¤å¤„ï¼šç»´æŠ¤paçš„å·¦å³å­©å­ã€‚ç»´æŠ¤æ ¹èŠ‚ç‚¹\n    //å¦‚æœåˆ é™¤çš„æ˜¯æ ¹èŠ‚ç‚¹ï¼šä¸ç»´æŠ¤paçš„å·¦å³å­©å­(å› ä¸ºpaä¸ºç©º)ï¼Œæ›¿æ¢root\n    if(pa == NULL)\t//pa == NULLåˆ™è¯´æ˜åˆ é™¤çš„æ˜¯æ ¹èŠ‚ç‚¹\n    {\n        ptr = newchild;\n    }\n    else\t\t\t//åˆ é™¤éæ ¹èŠ‚ç‚¹çš„æƒ…å†µï¼Œç»´æŠ¤paçš„å·¦å³å­©å­ï¼Œä¸æ›¿æ¢root\n    {\n        // å°†newchildæ›¿ä»£pçš„ä½ç½®\n            //åˆ é™¤å•åˆ†æ”¯èŠ‚ç‚¹æ—¶ï¼Œnewchildä¸ºå…¶åˆ†æ”¯èŠ‚ç‚¹ï¼›\n            //åˆ é™¤å¶å­èŠ‚ç‚¹æ—¶ï¼Œnewchildä¸ºç©ºã€‚ä¸å½±å“ã€‚\n        if(pa->leftchild == p)\n            pa->leftchild = newchild;\n        else\n            pa->rightchild = newchild;\n    }\n    //åˆ é™¤ç»“æŸ\n    free(p);\n    return true;\n}\n```\n\n\n\n# äºŒå‰æœç´¢æ ‘--æ¨¡æ¿ç±»\n\n## é¡ºåºæ€§\n\nåœ¨äºŒå‰æœç´¢æ ‘ï¼ˆbinary search treeï¼‰ä¸­ï¼Œå¤„å¤„éƒ½æ»¡è¶³é¡ºåºæ€§ï¼š\nâ€œ**ä»»ä¸€èŠ‚ç‚¹rçš„å·¦ï¼ˆå³ï¼‰å­æ ‘ä¸­ï¼Œæ‰€æœ‰èŠ‚ç‚¹ï¼ˆè‹¥å­˜åœ¨ï¼‰å‡ä¸å¤§äºï¼ˆä¸å°äºï¼‰r**â€ã€‚\n\n![image-20220312145342588](../../images/é«˜çº§æ•°æ®ç»“æ„_æœç´¢æ ‘/image-20220312145342588.png)\n\nä¸ºå›é¿è¾¹ç•Œæƒ…å†µï¼Œè¿™é‡Œæš‚ä¸”å‡å®šæ‰€æœ‰èŠ‚ç‚¹äº’ä¸ç›¸ç­‰ã€‚\n\nä¸‹å›¾å·¦ä¸‰ä¸ªç¤ºä¾‹æ˜¯äºŒå‰æœç´¢æ ‘ï¼Œå³ä¸‰ä¸ªç¤ºä¾‹æ˜¯åä¾‹ã€‚\n![image-20220312145511100](../../images/é«˜çº§æ•°æ®ç»“æ„_æœç´¢æ ‘/image-20220312145511100.png)\n\nå½“ç„¶ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¯¹ç›¸ç­‰å…ƒç´ çš„ç¦æ­¢æ—¢ä¸è‡ªç„¶ä¹Ÿä¸å¿…è¦ã€‚å¯åœ¨ä»£ç çš„åŸºç¡€ä¸Šç»§ç»­æ‰©å±•ï¼Œä½¿å¾—äºŒå‰æœç´¢æ ‘çš„æ¥å£æ”¯æŒç›¸ç­‰è¯æ¡çš„åŒæ—¶å¹¶å­˜ï¼ˆä¹ é¢˜[7-10]ï¼‰ã€‚åœ¨å»é™¤æ‰è¿™ä¸€é™åˆ¶ä¹‹åï¼Œå›¾ä¸­åŸå…ˆçš„ç¬¬ä¸€ä¸ªåä¾‹ï¼Œå°†è½¬è€Œæˆä¸ºåˆæ³•çš„äºŒå‰æœç´¢æ ‘ã€‚\n\n## ä¸­åºéå†åºåˆ—\n\nä¸‹å›¾ä¸ºäºŒå‰æœç´¢æ ‘çš„ä¸­åºéå†åºåˆ—ï¼Œå•è°ƒå¢ã€‚\n![image-20220312145818194](../../images/é«˜çº§æ•°æ®ç»“æ„_æœç´¢æ ‘/image-20220312145818194.png)\n\né¡ºåºæ€§æ˜¯ä¸€é¡¹å¾ˆå¼ºçš„æ¡ä»¶ã€‚å®é™…ä¸Šï¼Œæœç´¢æ ‘ä¸­èŠ‚ç‚¹ä¹‹é—´çš„å…¨åºå…³ç³»ï¼Œå·²å®Œå…¨â€œè•´å«â€äºè¿™ä¸€æ¡ä»¶ä¹‹ä¸­ã€‚ä»¥å¦‚ä¸Šå›¾æ‰€ç¤ºçš„äºŒå‰æœç´¢æ ‘ä¸ºä¾‹ï¼Œåªéœ€è¯¥æ ‘åšä¸€æ¬¡ä¸­åºéå†ï¼Œå³å¯å°†è¯¥æ ‘è½¬æ¢ä¸ºä¸€ä¸ªçº¿æ€§åºåˆ—ï¼Œä¸”è¯¥åºåˆ—ä¸­çš„èŠ‚ç‚¹ä¸¥æ ¼æŒ‰ç…§å…¶å¤§å°æ¬¡åºæ’åˆ—ã€‚\n\nè¿™ä¸€ç°è±¡ï¼Œå¹¶éå·§åˆã€‚å€ŸåŠ©æ•°å­¦å½’çº³æ³•ï¼Œå¯ä»¥è¯æ˜æ›´å…·ä¸€èˆ¬æ€§çš„ç»“è®ºï¼š**ä»»ä½•ä¸€æ£µäºŒå‰æ ‘æ˜¯äºŒå‰æœç´¢æ ‘ï¼Œå½“ä¸”ä»…å½“å…¶ä¸­åºéå†åºåˆ—å•è°ƒéé™**ã€‚\n\n## BSTæ¨¡æ¿ç±»\n\n```c++\n#include \"BinTree.h\"\ntemplate<typename T> class BST : public BinTree<T>\n{\nprotected:\n    BinNodePosi(T) _hot;\t//\"å‘½ä¸­\"èŠ‚ç‚¹çš„çˆ¶äº²\npublic:\n    virtual BinNodePosi(T) & search(const T& e);\t//æŸ¥æ‰¾\n    virtual BinNodePosi(T) insert(const T& e);\t\t//æ’å…¥\n    virtual bool remove(const T& e);\t\t\t\t//åˆ é™¤\n};\n```\n\nå¯è§ï¼Œåœ¨ç»§æ‰¿åŸæ¨¡æ¿ç±»BinTreeçš„åŒæ—¶ï¼ŒBSTå†…éƒ¨ä¹Ÿç»§ç»­æ²¿ç”¨äº†äºŒå‰æ ‘èŠ‚ç‚¹æ¨¡æ¿ç±»BinNodeã€‚æŒ‰ç…§äºŒå‰æœç´¢æ ‘çš„æ¥å£è§„èŒƒå®šä¹‰ï¼Œè¿™é‡Œæ–°å¢äº†ä¸‰ä¸ªæ ‡å‡†çš„å¯¹å¤–æ¥å£search()ã€insert()å’Œremove()ï¼Œåˆ†åˆ«å¯¹åº”äºåŸºæœ¬çš„æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤æ“ä½œã€‚è¿™ä¸‰ä¸ªæ ‡å‡†æ¥å£çš„è°ƒç”¨å‚æ•°ï¼Œéƒ½æ˜¯å±äºå…ƒç´ ç±»å‹Tçš„å¯¹è±¡å¼•ç”¨â€”â€”è¿™æ­£æ˜¯æ­¤ç±»ç»“æ„â€œå¾ªå…³é”®ç è®¿é—®â€æ–¹å¼çš„å…·ä½“ä½“ç°ã€‚\n\nä»¥åè¿˜å°†ä»¥BSTä¸ºåŸºç±»ï¼Œè¿›ä¸€æ­¥æ´¾ç”Ÿå‡ºäºŒå‰æœç´¢æ ‘çš„å¤šä¸ªå˜ç§ã€‚æ— è®ºå“ªä¸€å˜ç§ï¼Œæ—¢å¿…é¡»æ”¯æŒä¸Šè¿°ä¸‰ä¸ªåŸºæœ¬æ¥å£ï¼ŒåŒæ—¶åœ¨å†…éƒ¨çš„å…·ä½“å®ç°æ–¹å¼åˆæœ‰æ‰€ä¸åŒã€‚å› æ­¤ï¼Œå®ƒä»¬å‡è¢«å®šä¹‰ä¸ºè™šæˆå‘˜å‡½æ•°ï¼Œä»è€Œå¼ºåˆ¶è¦æ±‚æ´¾ç”Ÿçš„æ‰€æœ‰å˜ç§ï¼Œæ ¹æ®å„è‡ªçš„è§„åˆ™å¯¹å…¶é‡å†™ã€‚\n\n## æŸ¥æ‰¾ç®—æ³•åŠå…¶å®ç°\n\näºŒå‰æœç´¢æ ‘çš„æŸ¥æ‰¾ç®—æ³•ï¼Œäº¦é‡‡ç”¨äº†**å‡è€Œæ²»ä¹‹**çš„æ€è·¯ä¸ç­–ç•¥ï¼Œå…¶æ‰§è¡Œè¿‡ç¨‹å¯æè¿°ä¸ºï¼š**ä»æ ‘æ ¹å‡ºå‘ï¼Œé€æ­¥åœ°ç¼©å°æŸ¥æ‰¾èŒƒå›´ï¼Œç›´åˆ°å‘ç°ç›®æ ‡ï¼ˆæˆåŠŸï¼‰æˆ–ç¼©å°è‡³ç©ºæ ‘ï¼ˆå¤±è´¥ï¼‰**ã€‚\n\nä¾‹å¦‚ï¼Œåœ¨ä¸‹å›¾ä¸­æŸ¥æ‰¾å…³é”®ç 22çš„è¿‡ç¨‹å¦‚ä¸‹ã€‚é¦–å…ˆï¼Œç»ä¸æ ¹èŠ‚ç‚¹16æ¯”è¾ƒç¡®è®¤ç›®æ ‡å…³é”®ç æ›´å¤§ï¼Œæ•…æ·±å…¥å³å­æ ‘25é€’å½’æŸ¥æ‰¾ï¼›ç»æ¯”è¾ƒå‘ç°ç›®æ ‡å…³é”®ç æ›´å°ï¼Œæ•…ç»§ç»­æ·±å…¥å·¦å­æ ‘19é€’å½’æŸ¥æ‰¾ï¼›ç»å†æ¬¡æ¯”è¾ƒç¡®è®¤ç›®æ ‡å…³é”®ç æ›´å¤§åï¼Œæ·±å…¥å³å­æ ‘22é€’å½’æŸ¥æ‰¾ï¼›æœ€ç»ˆåœ¨èŠ‚ç‚¹22å¤„åŒ¹é…ï¼ŒæŸ¥æ‰¾æˆåŠŸã€‚\n![image-20220312152123162](../../images/é«˜çº§æ•°æ®ç»“æ„_æœç´¢æ ‘/image-20220312152123162.png)\n\nå®é™…ä¸Šï¼Œé’ˆå¯¹16ã€25ã€19çš„æŸ¥æ‰¾ï¼Œä¹Ÿå°†ç»è¿‡è¯¥è·¯å¾„çš„æŸä¸€å‰ç¼€ï¼ŒæˆåŠŸç»ˆæ­¢äºå¯¹åº”çš„èŠ‚ç‚¹ã€‚å½“ç„¶ï¼ŒæŸ¥æ‰¾æœªå¿…æˆåŠŸã€‚æ¯”å¦‚é’ˆå¯¹å…³é”®ç 20çš„æŸ¥æ‰¾ä¹Ÿä¼šç»è¿‡åŒä¸€æŸ¥æ‰¾é€šè·¯å¹¶æŠµè¾¾èŠ‚ç‚¹22ï¼Œä½†åœ¨å› ç›®æ ‡å…³é”®ç æ›´å°è€Œè¯•å›¾ç»§ç»­å‘å·¦æ·±å…¥æ—¶å‘ç°å·¦å­æ ‘ä¸ºç©ºï¼Œè‡³æ­¤å³å¯ç¡®è®¤æŸ¥æ‰¾å¤±è´¥ã€‚\n\n> ï¼ˆæ­¤ç±»ç©ºèŠ‚ç‚¹é€šå¸¸å¯¹åº”äºç©ºå­©å­æŒ‡é’ˆæˆ–å¼•ç”¨ï¼Œä¹Ÿå¯å‡æƒ³åœ°ç­‰æ•ˆä¸ºâ€œçœŸå®â€èŠ‚ç‚¹ï¼Œåä¸€æ–¹å¼ä¸ä»…å¯ç®€åŒ–ç®—æ³•æè¿°ä»¥åŠé€€åŒ–æƒ…å†µçš„å¤„ç†ï¼Œä¹Ÿå¯ç›´è§‚åœ°è§£é‡Šï¼ˆB-æ ‘ä¹‹ç±»ï¼‰çºµè´¯å¤šçº§å­˜å‚¨å±‚æ¬¡çš„æœç´¢æ ‘ã€‚æ•…åœ¨åä¸€åœºåˆï¼Œç©ºèŠ‚ç‚¹ä¹Ÿç§°ä½œå¤–éƒ¨èŠ‚ç‚¹ï¼ˆexternal nodeï¼‰ï¼Œå¹¶ç­‰æ•ˆåœ°å½“ä½œå¶èŠ‚ç‚¹çš„â€œå­©å­â€ã€‚è¿”é‡Œæš‚é‡‡ç”¨å‰ä¸€æ–¹å¼ï¼Œæ•…ç©ºèŠ‚ç‚¹ä¸åœ¨æ’å›¾ä¸­å‡ºç°ã€‚ï¼‰ \n\nä¸€èˆ¬åœ°ï¼Œåœ¨ä¸Šè¿°æŸ¥æ‰¾è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦å‘ç°å½“å‰èŠ‚ç‚¹ä¸ºNULLï¼Œå³è¯´æ˜æŸ¥æ‰¾èŒƒå›´å·²ç»ç¼©å°è‡³ç©ºï¼ŒæŸ¥æ‰¾å¤±è´¥ï¼›å¦åˆ™ï¼Œè§†å…³é”®ç æ¯”è¾ƒç»“æœï¼Œå‘å·¦ï¼ˆæ›´å°ï¼‰æˆ–å‘å³ï¼ˆæ›´å¤§ï¼‰æ·±å…¥ï¼Œæˆ–è€…æŠ¥å‘ŠæˆåŠŸï¼ˆç›¸ç­‰ï¼‰ã€‚\n\n**å¯¹ç…§ä¸­åºéå†åºåˆ—å¯è§ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸æœ‰åºå‘é‡çš„äºŒåˆ†æŸ¥æ‰¾è¿‡ç¨‹ç­‰æ•ˆï¼Œæ•…å¯è§†ä½œåè€…çš„æ¨å¹¿**ã€‚\n\n### searchIn()ç®—æ³•ä¸search()æ¥å£\n\n* searchIn()\n\n  ```c++\n  template<typename T>\n  static BinNodePosi(T) & searchIn(BinNodePosi(T) & v, const T& e, BinNodePosi(T) & hot)\n  {\n      if(v==nullptr || (e == v->data)) return v;\n      hot = v;\n      return searchIn(((e < v->data) ? v->lc : v->rc), e, hot);\n  }\n  ```\n\n* search()\n\n  ```c++\n  template<typename T> BinNodePosi(T) & BST<T>::search(const T& e)\n  {\n      //è¿”å›ç›®æ ‡èŠ‚ç‚¹ä½ç½®çš„å¼•ç”¨ï¼Œä»¥ä¾¿åç»­æ’å…¥ã€åˆ é™¤æ“ä½œã€‚\n      return searchIn(_root, e, hot = NULL);\n  }\n  ```\n\n### è¯­ä¹‰çº¦å®š\n\nä»¥ä¸ŠæŸ¥æ‰¾ç®—æ³•ä¹‹æ‰€ä»¥å¦‚æ­¤å®ç°ï¼Œæ˜¯ä¸ºäº†ç»Ÿä¸€å¹¶ç®€åŒ–åç»­ä¸åŒæœç´¢æ ‘çš„å„ç§æ“ä½œæ¥å£çš„å®ç°ã€‚å…¶ä¸­çš„æŠ€å·§ï¼Œä¸»è¦ä½“ç°äºè¿”å›å€¼å’Œhotå˜é‡ï¼ˆå³BinTreeå¯¹è±¡å†…éƒ¨çš„_hotå˜é‡ï¼‰çš„è¯­ä¹‰çº¦å®šã€‚\n\n* è‹¥æŸ¥æ‰¾æˆåŠŸï¼Œåˆ™searchIn()ä»¥åŠsearch()çš„è¿”å›å€¼éƒ½å°†å¦‚å›¾å·¦æ‰€ç¤ºï¼ŒæŒ‡å‘ä¸€ä¸ªå…³é”®ç ä¸ºeä¸”çœŸå®å­˜åœ¨çš„èŠ‚ç‚¹ï¼›\n* è‹¥æŸ¥æ‰¾å¤±è´¥ï¼Œåˆ™è¿”å›å€¼çš„æ•°å€¼è™½ç„¶ä¸ºNULLï¼Œä½†æ˜¯å®ƒä½œä¸ºå¼•ç”¨å°†å¦‚å›¾å³æ‰€ç¤ºï¼ŒæŒ‡å‘æœ€åä¸€æ¬¡è¯•å›¾è½¬å‘çš„ç©ºèŠ‚ç‚¹ã€‚å¯¹äºåä¸€ç§æƒ…å†µï¼Œä¸å¦¨å‡æƒ³åœ°å°†æ­¤ç©ºèŠ‚ç‚¹è½¬æ¢ä¸ºä¸€ä¸ªæ•°å€¼ä¸ºeçš„å“¨å…µèŠ‚ç‚¹â€”â€”å¦‚æ­¤ï¼Œæ— è®ºæˆåŠŸä¸å¦ï¼ŒæŸ¥æ‰¾çš„è¿”å›å€¼æ€»æ˜¯ç­‰æ•ˆåœ°æŒ‡å‘â€œå‘½ä¸­èŠ‚ç‚¹â€ã€‚\n  ![image-20220312160254950](../../images/é«˜çº§æ•°æ®ç»“æ„_æœç´¢æ ‘/image-20220312160254950.png)\n* åœ¨è°ƒç”¨searchIn()ç®—æ³•ä¹‹å‰ï¼Œsearch()æ¥å£é¦–å…ˆå°†å†…éƒ¨å˜é‡\\_hotåˆå§‹åŒ–ä¸ºNULLï¼Œç„¶åä½œä¸ºå¼•ç”¨å‹å‚æ•°hotä¼ é€’ç»™searchIn()ã€‚åœ¨æ•´ä¸ªæŸ¥æ‰¾çš„è¿‡ç¨‹ä¸­ï¼Œhotå˜é‡å§‹ç»ˆæŒ‡å‘å½“å‰èŠ‚ç‚¹çš„çˆ¶äº²ã€‚\n  å› æ­¤åœ¨ç®—æ³•è¿”å›æ—¶ï¼ŒæŒ‰ç…§å¦‚ä¸Šå®šä¹‰ï¼Œ\\_hotäº¦å°†ç»Ÿä¸€æŒ‡å‘â€œå‘½ä¸­èŠ‚ç‚¹â€çš„çˆ¶äº²ã€‚å³ä¾¿åœ¨é€€åŒ–çš„æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚æŸ¥æ‰¾ç»ˆæ­¢å¹¶è¿”å›äºæ ‘æ ¹å¤„ï¼‰ï¼Œç®—æ³•searchIn()çš„è¾“å‡ºä¾ç„¶ç¬¦åˆä»¥ä¸Šè¯­ä¹‰çº¦å®šã€‚\n* è¯·æ³¨æ„ï¼Œ\\_hotèŠ‚ç‚¹æ˜¯å¦æ‹¥æœ‰å¦ä¸€ä¸ªå­©å­ï¼Œä¸æŸ¥æ‰¾æˆåŠŸä¸å¦æ— å…³ã€‚æŸ¥æ‰¾æˆåŠŸæ—¶ï¼ŒèŠ‚ç‚¹eå¯èƒ½æ˜¯\n  å¶å­ï¼Œä¹Ÿå¯èƒ½æ˜¯å†…éƒ¨èŠ‚ç‚¹ï¼›æŸ¥æ‰¾å¤±è´¥æ—¶ï¼Œå‡æƒ³çš„å“¨å…µeç­‰æ•ˆäºå¶èŠ‚ç‚¹ï¼Œä½†å¯èƒ½æœ‰å…„å¼Ÿã€‚\n\n### æ•ˆç‡\n\n* åœ¨äºŒå‰æœç´¢æ ‘çš„æ¯ä¸€å±‚ï¼ŒæŸ¥æ‰¾ç®—æ³•è‡³å¤šè®¿é—®ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸”åªéœ€å¸¸æ•°æ—¶é—´ï¼Œæ•…**æ€»ä½“æ‰€éœ€æ—¶é—´åº”çº¿æ€§æ­£æ¯”äºæŸ¥æ‰¾è·¯å¾„çš„é•¿åº¦**ï¼Œæˆ–æœ€ç»ˆè¿”å›èŠ‚ç‚¹çš„æ·±åº¦ã€‚\n* åœ¨æœ€å¥½æƒ…å†µä¸‹ï¼Œç›®æ ‡å…³é”®ç æ°å¥½å‡ºç°åœ¨æ ‘æ ¹å¤„ï¼ˆæˆ–å…¶é™„è¿‘ï¼‰ï¼Œæ­¤æ—¶åªéœ€O(1)æ—¶é—´ã€‚\n* ç„¶è€Œä¸å¹¸çš„æ˜¯ï¼Œå¯¹äºè§„æ¨¡ä¸ºnçš„äºŒå‰æœç´¢æ ‘ï¼Œæ·±åº¦åœ¨æœ€åæƒ…å†µä¸‹å¯è¾¾Î©(n)ã€‚æ¯”å¦‚ï¼Œå½“è¯¥æ ‘é€€åŒ–ä¸ºï¼ˆæ¥è¿‘äºï¼‰ä¸€æ¡å•é“¾æ—¶ï¼Œå‘ç”Ÿæ­¤ç±»æƒ…å†µçš„æ¦‚ç‡å°†å¾ˆé«˜ã€‚æ­¤æ—¶çš„å•æ¬¡æŸ¥æ‰¾å¯èƒ½éœ€è¦çº¿æ€§æ—¶é—´å¹¶ä¸å¥‡æ€ªï¼Œå› ä¸ºå®é™…ä¸Šè¿™æ ·çš„ä¸€æ£µâ€œäºŒåˆ†â€æœç´¢æ ‘ï¼Œå·²ç»é€€åŒ–æˆäº†ä¸€ä¸ªä¸æŠ˜ä¸æ‰£çš„ä¸€ç»´æœ‰åºåˆ—è¡¨ï¼Œè€Œæ­¤æ—¶çš„æŸ¥æ‰¾åˆ™ç­‰æ•ˆäºé¡ºåºæŸ¥æ‰¾ã€‚\n* ç”±æ­¤æˆ‘ä»¬å¯å¾—åˆ°å¯ç¤ºï¼šè‹¥è¦æ§åˆ¶å•æ¬¡æŸ¥æ‰¾åœ¨æœ€åæƒ…å†µä¸‹çš„è¿è¡Œæ—¶é—´ï¼Œé¡»ä»æ§åˆ¶äºŒå‰æœç´¢æ ‘çš„**é«˜åº¦**å…¥æ‰‹ã€‚åç»­å°†è¦è®¨è®ºçš„å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼Œæ­£æ˜¯åŸºäºè¿™ä¸€æ€è·¯è€Œåšçš„æ”¹è¿›ã€‚\n\n## æ’å…¥ç®—æ³•åŠå…¶å®ç°\n\n### ç®—æ³•\n\n* ä¸ºäº†åœ¨äºŒå‰æœç´¢æ ‘ä¸­æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé¦–å…ˆéœ€è¦åˆ©ç”¨æŸ¥æ‰¾ç®—æ³•search()ç¡®å®šæ’å…¥çš„ä½ç½®åŠæ–¹å‘ï¼Œç„¶åæ‰èƒ½å°†æ–°èŠ‚ç‚¹ä½œä¸ºå¶å­æ’å…¥ã€‚\n* ä»¥å¦‚å·¦å›¾1æ‰€ç¤ºçš„äºŒå‰æœç´¢æ ‘ä¸ºä¾‹ã€‚è‹¥æ¬²æ’å…¥å…³é”®ç 40ï¼Œåˆ™åœ¨æ‰§è¡Œsearch(40)ä¹‹åï¼Œå¦‚å›¾2æ‰€ç¤ºï¼Œ\\_hotå°†æŒ‡å‘æ¯”è¾ƒè¿‡çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹46ï¼ŒåŒæ—¶è¿”å›å…¶å·¦å­©å­ï¼ˆæ­¤æ—¶ä¸ºç©ºï¼‰çš„ä½ç½®ã€‚äºæ˜¯æ¥ä¸‹æ¥å¦‚å›¾(c)æ‰€ç¤ºï¼Œåªéœ€åˆ›å»ºæ–°èŠ‚ç‚¹40ï¼Œå¹¶å°†å…¶ä½œä¸º46çš„å·¦å­©å­æ¥å…¥ï¼Œæ‹“æ‰‘æ„ä¹‰ä¸Šçš„èŠ‚ç‚¹æ’å…¥å³å‘Šå®Œæˆã€‚\n  ![image-20220312162256305](../../images/é«˜çº§æ•°æ®ç»“æ„_æœç´¢æ ‘/image-20220312162256305.png)\n* ä¸è¿‡ï¼Œä¸ºä¿æŒäºŒå‰æœç´¢æ ‘ä½œä¸ºæ•°æ®ç»“æ„çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ï¼Œè¿˜éœ€ä»èŠ‚ç‚¹_hotï¼ˆ46ï¼‰å‡ºå‘ï¼Œè‡ªåº•è€Œä¸Šåœ°é€ä¸ªæ›´æ–°æ–°èŠ‚ç‚¹40å†ä»£ç¥–å…ˆçš„é«˜åº¦ã€‚\n* æ¥ä¸‹æ¥è‹¥æ¬²æ’å…¥å…³é”®ç 55ï¼Œåˆ™åœ¨æ‰§è¡Œsearch(55)ä¹‹åå¦‚å›¾3æ‰€ç¤ºï¼Œ\\_hotå°†æŒ‡å‘æ¯”è¾ƒè¿‡çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹53ï¼ŒåŒæ—¶è¿”å›å…¶å³å­©å­ï¼ˆæ­¤æ—¶ä¸ºNULLï¼‰çš„ä½ç½®ã€‚äºæ˜¯å¦‚å›¾4æ‰€ç¤ºï¼Œåˆ›å»ºæ–°èŠ‚ç‚¹55ï¼Œå¹¶å°†å…¶ä½œä¸º53çš„å³å­©å­æ¥å…¥ã€‚å½“ç„¶ï¼Œæ­¤ååŒæ ·éœ€ä»èŠ‚ç‚¹\\_hotå‡ºå‘ï¼Œé€ä»£æ›´æ–°ç¥–å…ˆçš„é«˜åº¦ã€‚\n\n### insert()æ¥å£çš„å®ç°\n\n```c++\ntemplate<typename T>\nBinNodePosi(T) BST<T>::insert(const T& e)\n{\n    BinNodePosi(T) &x = search(e);\t//searchçš„è¿‡ç¨‹ä¸­æ›´æ–°äº†_hot\n    if(x!=nullptr)return x;//å¦‚æœeå€¼åœ¨æ ‘ä¸­å·²ç»å­˜åœ¨åˆ™ä¸æ’\n    \n    x = new BinNode<T> (e, _hot);\t//åˆ›å»ºæ–°èŠ‚ç‚¹xï¼šä»¥eä¸ºå…³é”®ç ï¼Œä»¥_hotä¸ºçˆ¶\n    _size++;\n    updateHeightAbove(x);\t\t\t//æ›´æ–°xåŠå…¶å†ä»£ç¥–å…ˆçš„é«˜åº¦\n    return x;\n}\n```\n\n* é¦–å…ˆè°ƒç”¨search()æŸ¥æ‰¾eã€‚è‹¥è¿”å›ä½ç½®xéç©ºï¼Œåˆ™è¯´æ˜å·²æœ‰é›·åŒèŠ‚ç‚¹ï¼Œæ’å…¥æ“ä½œå¤±è´¥ã€‚å¦åˆ™ï¼Œ\n  **xå¿…æ˜¯\\_hotèŠ‚ç‚¹çš„æŸä¸€ç©ºå­©å­**ï¼Œäºæ˜¯åˆ›å»ºè¿™ä¸ªå­©å­å¹¶å­˜å…¥eã€‚\n* æŒ‰ç…§ä»¥ä¸Šå®ç°æ–¹å¼ï¼Œæ— è®ºæ’å…¥æ“ä½œæˆåŠŸä¸å¦ï¼Œéƒ½ä¼šè¿”å›ä¸€ä¸ªéç©ºä½ç½®ï¼Œä¸”è¯¥å¤„çš„èŠ‚ç‚¹ä¸æ‹Ÿæ’å…¥çš„èŠ‚ç‚¹ç›¸ç­‰ã€‚å¦‚æ­¤å¯ä»¥ç¡®ä¿ä¸€è‡´æ€§ï¼Œä»¥ç®€åŒ–åç»­çš„æ“ä½œã€‚\n* å¦å¤–ï¼Œä¸Šé¢çš„æŸ¥æ‰¾ç®—æ³•ä¸­çš„å¯¹â€œé¦–ä¸ªèŠ‚ç‚¹æ’å…¥ç©ºæ ‘â€ç­‰ç‰¹æ®Šæƒ…å†µçš„å¤„ç†æ‰‹æ³•ä¸è¿™é‡Œçš„ç±»ä¼¼ï¼Œå¯ä»¥è®¤çœŸä½“ä¼šä¸€ç•ªã€‚\n\n### æ•ˆç‡\n\nç”±ä¸Šå¯è§ï¼ŒèŠ‚ç‚¹æ’å…¥æ“ä½œæ‰€éœ€çš„æ—¶é—´ï¼Œä¸»è¦æ¶ˆè€—äºå¯¹ç®—æ³•search()åŠupdateHeightAbove()çš„è°ƒç”¨ã€‚åè€…ä¸å‰è€…ä¸€æ ·ï¼Œåœ¨æ¯ä¸€å±‚æ¬¡è‡³å¤šæ¶‰åŠä¸€ä¸ªèŠ‚ç‚¹ï¼Œä»…æ¶ˆè€—O(1)æ—¶é—´ï¼Œæ•…å…¶**æ—¶é—´å¤æ‚åº¦ä¹ŸåŒæ ·å–å†³äºæ–°èŠ‚ç‚¹çš„æ·±åº¦**ï¼Œåœ¨æœ€åæƒ…å†µä¸‹ä¸è¶…è¿‡å…¨æ ‘çš„é«˜åº¦ã€‚\n\n## åˆ é™¤ç®—æ³•åŠå…¶å®ç°\n\nä¸ºä»äºŒå‰æœç´¢æ ‘ä¸­åˆ é™¤èŠ‚ç‚¹ï¼Œé¦–å…ˆä¹Ÿéœ€è¦è°ƒç”¨ç®—æ³•BST::search()ï¼Œåˆ¤æ–­ç›®æ ‡èŠ‚ç‚¹æ˜¯å¦çš„ç¡®å­˜åœ¨äºæ ‘ä¸­ã€‚è‹¥å­˜åœ¨ï¼Œåˆ™éœ€è¿”å›å…¶ä½ç½®ï¼Œç„¶åæ–¹èƒ½ç›¸åº”åœ°å…·ä½“å®æ–½åˆ é™¤æ“ä½œã€‚\n\n![image-20220312165938462](../../images/é«˜çº§æ•°æ®ç»“æ„_æœç´¢æ ‘/image-20220312165938462.png)\n\n### å•åˆ†æ”¯æƒ…å†µ\n\nä»¥å·¦å›¾1æ‰€ç¤ºäºŒå‰æœç´¢æ ‘ä¸ºä¾‹ï¼Œè‹¥æ¬²åˆ é™¤èŠ‚ç‚¹69ï¼Œéœ€é¦–å…ˆé€šè¿‡search(69)å®šä½å¾…åˆ é™¤çš„èŠ‚ç‚¹69ã€‚å› è¯¥èŠ‚ç‚¹çš„å³å­æ ‘ä¸ºç©ºï¼Œæ•…åªéœ€å¦‚å›¾2æ‰€ç¤ºï¼Œå°†69æ›¿æ¢ä¸º64ã€‚åˆ™æ‹“æ‰‘æ„ä¹‰ä¸Šçš„èŠ‚ç‚¹åˆ é™¤å³å‘Šå®Œæˆã€‚å¦å¤–ï¼Œä¸ºä¿æŒäºŒå‰æœç´¢æ ‘ä½œä¸ºæ•°æ®ç»“æ„çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ï¼Œè¿˜éœ€æ›´æ–°å…¨æ ‘çš„è§„æ¨¡è®°å½•ï¼Œé‡Šæ”¾è¢«æ‘˜é™¤çš„èŠ‚ç‚¹69ï¼Œå¹¶è‡ªä¸‹è€Œä¸Šåœ°é€ä¸ªæ›´æ–°æ›¿ä»£èŠ‚ç‚¹64å†ä»£ç¥–å…ˆçš„é«˜åº¦ã€‚**æ³¨æ„ï¼Œé¦–ä¸ªéœ€è¦æ›´æ–°é«˜åº¦çš„ç¥–å…ˆ58ï¼Œæ°å¥½ç”±\\_hotæŒ‡ç¤º**ã€‚\n\nä¸éš¾ç†è§£ï¼Œå¯¹äºæ²¡æœ‰å·¦å­©å­çš„ç›®æ ‡èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥å¯¹ç§°åœ°äºˆä»¥å¤„ç†ã€‚å½“ç„¶ï¼Œä»¥ä¸ŠåŒæ—¶ä¹Ÿå·²æ¶µç›–äº†å·¦å³å­©å­å‡ä¸å­˜åœ¨çš„æƒ…å†µï¼ˆå³ç›®æ ‡èŠ‚ç‚¹ä¸ºå¶å­ï¼‰ã€‚\n\n### åŒåˆ†æ”¯æƒ…å†µ\n\nç»§ç»­ä¸Šä¾‹ï¼Œè®¾æ‹Ÿå†åˆ é™¤äºŒåº¦èŠ‚ç‚¹36ï¼Œå¦‚å›¾2æ‰€ç¤ºï¼Œé¦–å…ˆè°ƒç”¨BinNode::succ()ç®—æ³•ï¼Œæ‰¾åˆ°è¯¥èŠ‚ç‚¹çš„ç›´æ¥åç»§40ã€‚ç„¶åï¼Œåªéœ€å¦‚å›¾3æ‰€ç¤ºäº¤æ¢äºŒè€…çš„æ•°æ®é¡¹å³å¯å°†åç»§èŠ‚ç‚¹ç­‰æ•ˆåœ°è§†ä½œå¾…åˆ é™¤çš„ç›®æ ‡èŠ‚ç‚¹ã€‚ä¸éš¾éªŒè¯ï¼Œè¯¥åç»§èŠ‚ç‚¹å¿…æ— å·¦å­©å­ï¼Œä»è€Œç›¸å½“äºè½¬åŒ–ä¸ºæ­¤å‰ç›¸å¯¹ç®€å•çš„æƒ…å†µâ€”â€”å•åˆ†æ”¯æƒ…å†µã€‚æœ€åå¦‚å›¾4æ‰€ç¤ºï¼Œå°†æ–°çš„ç›®æ ‡èŠ‚ç‚¹36æ›¿æ¢ä¸ºå…¶å³å­©å­46ã€‚\n\næ³¨æ„ï¼Œåœ¨äº’æ¢36å’Œ40åï¼Œå¦‚å›¾3æ‰€ç¤ºï¼Œæ›¾ç»ä¸€åº¦å¹¶ä¸æ»¡è¶³é¡ºåºæ€§ï¼Œä½†è¿™å¹¶ä¸è¦ç´§ï¼Œåœ¨æŒ‰ç…§ä¸Šè¿°æ–¹æ³•å®Œæˆæ•´ä¸ªåˆ é™¤åŠ¨ä½œåï¼Œå…¨æ ‘çš„é¡ºåºæ€§å¿…ç„¶åˆå°†æ¢å¤ã€‚\n\nåŒæ ·åœ°ï¼Œé™¤äº†æ›´æ–°å…¨æ ‘è§„æ¨¡è®°å½•å’Œé‡Šæ”¾è¢«æ‘˜é™¤èŠ‚ç‚¹ï¼Œæ­¤æ—¶ä¹Ÿè¦æ›´æ–°ä¸€ç³»åˆ—ç¥–å…ˆèŠ‚ç‚¹çš„é«˜åº¦ã€‚ä¸éš¾éªŒè¯ï¼Œæ­¤æ—¶é¦–ä¸ªéœ€è¦æ›´æ–°é«˜åº¦çš„ç¥–å…ˆ53ä¾ç„¶æ°å¥½ç”±\\_hotæŒ‡ç¤ºã€‚\n\n### remove()å®ç°\n\n```c++\ntemplate<typename T>\nbool BST<T>::remove(const T& e)\n{\n    BinNodePosi(T) & x = search(e);\n    if(x == nullptr)return false;\n    removeAt(x, _hot);\n    --_size;\n    updateHeightAbove(_hot);\n    return true;\n}\ntemplate<typename T>\nstatic BinNodePosi(T) removeAt(BinNodePosi(T) & x, BinNodePosi(T) & hot)\n{\n    BinNodePosi(T) w = x;\n    BinNodePosi(T) succ = NULL;\n    if(!HasLChild(*x))\t\t//è‹¥è¦åˆ é™¤çš„èŠ‚ç‚¹æ²¡æœ‰å·¦å­©å­\t\n        succ = x = x->rc;\t//ç›´æ¥å°†xæ›¿æ¢ä¸ºå…¶å³å­æ ‘\n    else if(!HasRChild(*x))\t//è‹¥å³å­æ ‘ä¸ºç©º\n        succ = x = x->lc;\t//å¯¹ç§°åœ°å¤„ç†ï¼Œæ³¨æ„ï¼šæ­¤æ—¶succ!=NULL\n    else\t//åŒåˆ†æ”¯æƒ…å†µ\n    {\t//è‹¥å·¦å³å­æ ‘å‡å­˜åœ¨ï¼Œxå’Œå…¶ç›´æ¥åç»§wäº’æ¢ï¼Œwä½œä¸ºå®é™…è¢«deleteèŠ‚ç‚¹\n        w = w->succ();\t//å¯»æ‰¾xç›´æ¥åç»§w -- åªå¯èƒ½å‘ç”Ÿåœ¨xçš„å³å­æ ‘ä¸­\n        swap(x->data, w->data);//äº¤æ¢xå’Œwçš„data\n        BinNodePosi(T) u = w->parent;\n        ((u == x) ? u->rc : u->lc) = succ = w->rc;\n    }\n    hot = w->parent;\n    if(succ)succ->parent = hot;\n    release(w->data);\n    release(w);\n    return succ;\n}\n```\n\né¦–å…ˆè°ƒç”¨search()æŸ¥æ‰¾eã€‚è‹¥è¿”å›ä½ç½®xä¸ºç©ºï¼Œåˆ™è¯´æ˜æ ‘ä¸­ä¸å«ç›®æ ‡èŠ‚ç‚¹ï¼Œæ•…åˆ é™¤æ“ä½œéšå³å¯ä»¥å¤±è´¥è¿”å›ã€‚å¦åˆ™ï¼Œè°ƒç”¨removeAt()åˆ é™¤ç›®æ ‡èŠ‚ç‚¹xã€‚åŒæ ·ï¼Œæ­¤åè¿˜éœ€æ›´æ–°å…¨æ ‘çš„è§„æ¨¡ï¼Œå¹¶è°ƒç”¨å‡½æ•°updateHeightAbove(\\_hot)ï¼Œæ›´æ–°è¢«åˆ é™¤èŠ‚ç‚¹å†ä»£ç¥–å…ˆçš„é«˜åº¦ã€‚\n\n### æ•ˆç‡\n\nåˆ é™¤æ“ä½œæ‰€éœ€çš„æ—¶é—´ï¼Œä¸»è¦æ¶ˆè€—äºå¯¹search()ã€succ()å’ŒupdateHeightAbove()çš„è°ƒç”¨ã€‚åœ¨æ ‘ä¸­çš„ä»»ä¸€é«˜åº¦ï¼Œå®ƒä»¬è‡³å¤šæ¶ˆè€—O(1)æ—¶é—´ã€‚æ•…**æ€»ä½“çš„æ¸è¿›æ—¶é—´å¤æ‚åº¦ï¼Œäº¦ä¸è¶…è¿‡å…¨æ ‘çš„é«˜åº¦**ã€‚\n","categories":["é«˜çº§æ•°æ®ç»“æ„","æ ‘"]},{"title":"Cpp_STL_allocator","url":"/Cpp/Cpp_STL_allocator/","content":"\n# å†…å®¹\n\n1. ä¸€çº§é…ç½®å™¨å’ŒäºŒçº§é…ç½®å™¨çš„å…³ç³»\n2. ç±»å‹èƒå–\n3. allocator\n4. `__malloc_alloc_template`é™æ€æˆå‘˜çš„ç±»å¤–åˆå§‹åŒ–ï¼Œå…¶ä¸­å‡½æ•°æŒ‡é’ˆå°¤ä¸ºéº»çƒ¦\n\n# ç©ºé—´é…ç½®å™¨\n\nSGI STLç¬¬ä¸€çº§é…ç½®å™¨\n\n```cpp\ntemplate<int inst>\nclass __malloc_alloc_template{ /*...*/ };\n```\n\n1. allocate()ç›´æ¥ä½¿ç”¨malloc()ï¼Œdeallocate()ç›´æ¥ä½¿ç”¨free()ã€‚\n2. æ¨¡æ‹ŸC++çš„set\\_new\\_handler() ä»¥å¤„ç†å†…å­˜ä¸è¶³çš„æƒ…å†µã€‚\n\nSGI STLç¬¬äºŒçº§é…ç½®å™¨\n\n```cpp\ntemplate<bool threads, int inst>\nclass __default_alloc_template{ /*...*/ };\n```\n\n1. ç»´æŠ¤16ä¸ªè‡ªç”±ä¸²åˆ—ï¼Œè´Ÿè´£16ç§å°å‹åŒºå—çš„æ­¤é…ç½®èƒ½åŠ›ã€‚å†…å­˜æ± ä»¥mallocé…ç½®è€Œå¾—ã€‚å¦‚æœå†…å­˜ä¸è¶³ï¼Œè½¬ç¬¬ä¸€çº§é…ç½®å™¨è¿›è¡Œoomå¤„ç†ã€‚\n2. å¦‚æœéœ€æ±‚åŒºå—å¤§äº128bayesï¼Œè½¬ç¬¬ä¸€çº§é…ç½®å™¨ï¼ˆç›´æ¥mallocï¼‰ã€‚\n\n# ç±»å‹èƒå–\n\niterator_traitsè´Ÿè´£èƒå–è¿­ä»£å™¨çš„ç‰¹æ€§ï¼Œè€ŒSGIçš„__type_traitsæŠŠè¿™ç§æŠ€æ³•è¿›ä¸€æ­¥æ‰©å¤§åˆ°è¿­ä»£å™¨ä»¥å¤–çš„ä¸–ç•Œã€‚\n\næˆ‘ä»¬å¯¹ç±»å‹å…³æ³¨çš„å±æ€§æœ‰ï¼š\n\n1. has_trivial_default_constructor\n2. has_trivial_copy_constructor\n3. has_trivial_assignment_operator\n4. has_trivial_destructor\n5. is_POD_type\n\nå¦‚æœæŸç§ç±»å‹çš„æ„é€ ã€æ‹·è´ã€èµ‹å€¼ã€ææ„å‡½æ•°æ˜¯ä¸å¿…è¦çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨å¯¹è¿™ä¸ªç±»å‹è¿›è¡Œä»¥ä¸ŠåŠ¨ä½œæ—¶ï¼Œå°±å¯ä»¥é‡‡ç”¨æœ€åŸå§‹åŒ–ã€æœ€æœ‰æ•ˆç‡çš„æªæ–½ï¼Œå¦‚mallocã€memcpyç­‰ã€‚è¿™å°±æ˜¯å¯¹ç±»å‹å±æ€§èƒå–çš„æ„ä¹‰ã€‚\n\n```c++\nstruct __true_type {};\nstruct __false_type {};\n```\n\n## å°è¯•ç‰›åˆ€\n\n```c++\n#pragma once\nnamespace xcg\n{\n\nstruct __true_type {};\nstruct __false_type {};\n\ntemplate<class T>\nstruct __type_traits\n{\n\ttypedef __true_type\t\tthis_dummy_member_must_be_first;\n\ttypedef __false_type\thas_trivial_default_constructor;\n\ttypedef __false_type\thas_trivial_copy_constructor;\n\ttypedef __false_type\thas_trivial_assignment_operator;\n\ttypedef __false_type\thas_trivial_destructor;\n\ttypedef __false_type\tis_POD_type;\n};\n\ntemplate<>\nstruct __type_traits<char>\n{\n\ttypedef __true_type\t\thas_trivial_default_constructor;\n\ttypedef __true_type\t\thas_trivial_copy_constructor;\n\ttypedef __true_type\t\thas_trivial_assignment_operator;\n\ttypedef __true_type\t\thas_trivial_destructor;\n\ttypedef __true_type\t\tis_POD_type;\n};\n\ntemplate<>\nstruct __type_traits<int>\n{\n\ttypedef __true_type\t\thas_trivial_default_constructor;\n\ttypedef __true_type\t\thas_trivial_copy_constructor;\n\ttypedef __true_type\t\thas_trivial_assignment_operator;\n\ttypedef __true_type\t\thas_trivial_destructor;\n\ttypedef __true_type\t\tis_POD_type;\n};\n\ntemplate<class T>\nstruct __type_traits<T*>\n{\n\ttypedef __true_type\t\thas_trivial_default_constructor;\n\ttypedef __true_type\t\thas_trivial_copy_constructor;\n\ttypedef __true_type\t\thas_trivial_assignment_operator;\n\ttypedef __true_type\t\thas_trivial_destructor;\n\ttypedef __true_type\t\tis_POD_type;\n};\n\n}\n```\n\n# allocator\n\n## STLå¤„ç†å†…å­˜çš„ä¸‰å¤§éƒ¨åˆ†\n\nSTLçš„allocatoræŠŠåˆ†é…ç©ºé—´ã€é‡Šæ”¾ç©ºé—´åˆ†å·¥äº†ã€‚åˆ†é…æ˜¯alloc::allocate()è´Ÿè´£ï¼Œé‡Šæ”¾æ˜¯alloc::deallocate()è´Ÿè´£ï¼›å¯¹è±¡æ„å»ºæ˜¯::construct()è´Ÿè´£ï¼Œå¯¹è±¡ææ„æ˜¯::delete()è´Ÿè´£ï¼Œnewå’Œdeleteå¾€å¾€æ˜¯å…¨å±€å‡½æ•°ã€‚\n\nSTLæ ‡å‡†è§„æ ¼çš„é…ç½®å™¨å®šä¹‰äº\\<memory\\>ä¸­ï¼ŒSGI\\<memory\\>å†…å«ä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶ï¼š\n\n```c++\n#include<stl_alloc.h>\n#include<stl_construct.h>\n```\n\nå®é™…ä¸Šï¼ŒSTLé™¤äº†ä»¥ä¸Šä¸¤ä¸ªé‡è¦éƒ¨åˆ†ï¼Œè¿˜æœ‰stl_uninitialized.hï¼Œæ˜¯å¤„ç†å¤§å—å†…å­˜çš„ã€‚\n\nè¿™ä¸ªåˆ‡å…¥ç‚¹ï¼Œå°±å¯ä»¥ç›´æ¥æŠŠè¯é¢˜å¯¼å‘å†…å­˜æ± äº†ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å…·ä½“ç±»å‹çš„æ„é€ ã€ææ„ã€èµ‹å€¼å‡½æ•°æ˜¯å¦æ— å…³ç´§è¦è€Œé‡‡å–æœ€æœ‰æ•ˆç‡çš„æªæ–½ã€‚\n\n## ç©ºé—´çš„é…ç½®ä¸é‡Šæ”¾std::alloc\n\nå¯¹è±¡æ„å»ºå‰çš„ç©ºé—´é…ç½®ã€å¯¹è±¡ææ„åçš„ç©ºé—´é‡Šæ”¾ï¼Œä¸¤ä¸ªåŠ¨ä½œéƒ½ç”±<stl_alloc.h>è´Ÿè´£ã€‚SGIå¯¹æ­¤çš„è®¾è®¡å“²å­¦å¦‚ä¸‹ï¼š\n\n1. å‘system heapç”³è¯·ç©ºé—´ï¼›\n2. è€ƒè™‘å¤šçº¿ç¨‹çŠ¶æ€ï¼›\n3. è€ƒè™‘å†…å­˜ä¸è¶³æ—¶çš„åº”å¯¹æªæ–½ï¼›\n4. è€ƒè™‘å†…å­˜ç¢ç‰‡é—®é¢˜\n\nå¯¹äºç¬¬å››ä¸ªé—®é¢˜â€”â€”å†…å­˜ç¢ç‰‡é—®é¢˜ï¼ŒSGIè®¾è®¡äº†ä¸¤çº§é…ç½®å™¨ã€‚ç¬¬ä¸€çº§æ˜¯å¯¹äºè¶³å¤Ÿå¤§çš„å†…å­˜å—å¤„ç†æ–¹å¼ã€‚ç¬¬äºŒçº§æ˜¯å¯¹äºå¤ªå°çš„å†…å­˜å—å¤„ç†æ–¹å¼ã€‚è¿™ä¸ªå¤§å°çš„æ ‡å‡†ä»¥128bytesä¸ºç•Œã€‚\n\nä¸€çº§é…ç½®å™¨ï¼š\n\n1. ç›´æ¥malloc\n2. ç›´æ¥free\n3. æ¨¡æ‹Ÿc++çš„set_new_handlerå¤„ç†å†…å­˜ä¸è¶³æƒ…å†µ\n\näºŒçº§é…ç½®å™¨ï¼š\n\n1. ç»´æŠ¤16ä¸ªè‡ªç”±é“¾è¡¨(free lists)ï¼Œå†…å­˜æ± ä»¥mallocè·å–ï¼Œå†…å­˜ä¸è¶³åˆ™ç”¨ä¸€çº§é…ç½®å™¨å¤„ç†ã€‚\n2. å¦‚æœéœ€æ±‚åŒºå—å¤§äº128bytesï¼Œè½¬è°ƒç”¨ä¸€çº§é…ç½®å™¨ã€‚\n\n## ä¸€çº§é…ç½®å™¨çš„é™æ€æˆå‘˜åŠå…¶åˆå§‹åŒ–\n\nå…ˆä»¥ä¸€ä¸ªç®€å•çš„ä¾‹å­è¯´æ˜é™æ€æˆå‘˜çš„ç±»å¤–åˆå§‹åŒ–ã€‚\n\n```c++\nclass Object\n{\nprivate:\n    static int num;\n    static void (*pfun)();\n};\n\nint Object::num = 0;\n//void (*pfun)() = nullptr;\t\t\t//error\n//è¦å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œpfunæ¥è‡ªå“ªä¸ªç±»ã€‚\nvoid (* Object::pfun)() = nullptr;\t//correct\n```\n\nå…¶ä¸­ï¼Œtemplate\\<int inst\\>ä»£è¡¨â€œéç±»å‹â€æ¨¡æ¿ï¼Œæ¨¡æ¿ä¸­çš„å‚æ•°åªæ˜¯ç”¨äºæ ‡è¯†çš„ã€‚\n\n```c++\ntemplate<int inst>\nclass Object\n{\nprivate:\n    static int num;\n    static void (*pfun)();\n};\ntemplate<int inst>\nint Object<inst>::num = 0;\ntemplate<int inst>\nvoid (* Object<inst>::pfun)() = nullptr;\n```\n\n### allocç±»çš„é™æ€æˆå‘˜\n\n```c++\ntemplate<int inst>\nclass __malloc_alloc_template\n{\nprivate:\n    static void * oom_malloc(size_t n);\n    static void * oom_realloc(void * p, size_t new_sz);\n    static void (*__malloc_alloc_oom_handler)();\npublic:\n    static void * allocate(size_t n);\n    static void deallocate(void * p, size_t n);\n    static void * reallocate(void * p, size_t old_sz, size_t new_sz);\n    //static ? set_malloc_handler(void (*f)());\n    //å‡½æ•°åæ˜¯set_malloc_handlerï¼Œå‚æ•°æ˜¯ä¸€ä¸ªvoid(*)()ç±»å‹çš„å˜é‡ï¼Œå‚æ•°åå­—æ˜¯fã€‚\n    //å…¶æ¬²è¿”å›å‡½æ•°æŒ‡é’ˆvoid (*)()ã€‚\n    //ä½†æ˜¯ä¸èƒ½è¿™æ ·å†™ï¼šstatic void(*)() set_malloc_handler(void (*f)());\n    //ä¸‹é¢æ˜¯æ­£ç¡®å†™æ³•\n    static void(* set_malloc_handler(void(*f)()) ) ();\n};\n//æ­¤æ—¶çš„ç±»å¤–åˆå§‹åŒ–\n//__malloc_alloc_templateç±»çš„ç§æœ‰æˆå‘˜__malloc_alloc_oom_handler\ntemplate<int inst>\nvoid(* __malloc_alloc_template<inst>::__malloc_alloc_oom_handler)() = nullptr;\n```\n\nä¸ºäº†è§£å†³å‡½æ•°æŒ‡é’ˆç±»å‹çš„å¯è¯»æ€§é—®é¢˜ï¼Œä½¿ç”¨typedefæˆ–usingé‡å®šä¹‰ç±»å‹åå­—ã€‚ç¬é—´æ¸…çˆ½äº†è®¸å¤šã€‚\n\n```c++\nclass __malloc_alloc_template\n{\npublic:\n    using PFUN = void(*)();\nprivate:\n    static PFUN __malloc_alloc_oom_handler;\npublic:\n    static PFUN set_malloc_handler(PFUN p);\n};\n```\n\næ¥ä¸‹æ¥è¿›è¡Œç±»å¤–åˆå§‹åŒ–ï¼š\n\n```c++\n//__malloc_alloc_templateç±»çš„ç§æœ‰æˆå‘˜__malloc_alloc_oom_handler\ntemplate<int inst>\ntypename __malloc_alloc_template<inst>::PFUN __malloc_alloc_template<inst>::__malloc_alloc_oom_handler = nullptr;\n/*\nåˆ«çœ‹åå­—è¿‡é•¿ï¼Œå®é™…å’Œä¹‹å‰çš„å½¢å¼ä¸€æ ·ã€‚\nä»¿ç…§ä»¥ä¸‹æ–¹å¼å†™ï¼Œæˆå‘˜ç±»å‹+å“ªä¸ªç±»<T>::æˆå‘˜å = ...\ntemplate<int inst>\nint Object<inst>::num = 0;\n/*\n```\n\n# ä¸€çº§é…ç½®å™¨å‡½æ•°å®ç°\n\nå‡½æ•°æˆå‘˜æ€»è§ˆï¼š\n\n```c++\ntemplate<int inst>\nclass __malloc_alloc_template\n{\nprivate:\n    static void * oom_malloc(size_t n);\n    static void * oom_realloc(void * p, size_t new_sz);\n    static void (*__malloc_alloc_oom_handler)();\npublic:\n    static void * allocate(size_t n);\n    static void deallocate(void * p, size_t n);\n    static void * reallocate(void * p, size_t old_sz, size_t new_sz);\npublic:\n    using PFUN = void(*)();\n    static PFUN set_malloc_handler(PFUN p);\n};\n```\n\n## oom_handler\n\noom_handlerï¼ŒæŒ‡out of memoryæ—¶çš„å¤„ç†ã€‚\n\n```c++\nstatic PFUN set_malloc_handler(PFUN p)\n{\n    PFUN old = __malloc_alloc_oom_handler;\n    __malloc_alloc_oom_handler = p;\n    return old;\n}\n```\n\n```c++\nstatic void * oom_malloc(size_t size)\n{\n    void* result = NULL;\n    void (*my_malloc_handler)() = nullptr;\n    for(;;) //infinite loop\n    {\n        my_malloc_handler = __malloc_alloc_oom_handler;\n    \tif(nullptr == my_malloc_handler)\n        {\n            __THROW_BAD_ALLOC;\n        }\n        my_malloc_hanler();\n        result = malloc(size);\t//after handling, retry to malloc\n        if(nullptr != result)\n        {\n            return result;\n        }\n    }\n}\n```\n\n```c++\nstatic void * oom_realloc(void * p, size_t new_sz)\n{\n    void* result = NULL;\n    void (*my_malloc_handler)() = nullptr;\n    for(;;) //infinite loop\n    {\n        my_malloc_handler = __malloc_alloc_oom_handler;\n    \tif(nullptr == my_malloc_handler)\n        {\n            __THROW_BAD_ALLOC;\n        }\n        my_malloc_hanler();\n        result = realloc(p, new_sz);\t//after handling, retry to malloc\n        if(nullptr != result)\n        {\n            return result;\n        }\n    }\n}\n```\n\n## allocate\n\n```c++\nstatic void* allocate(size_t size)\n{\n    void* result = malloc(size);\n    if(nullptr == result)\n    {\n        result = oom_malloc(size);\n    }\n    return result;\n}\n```\n\n## å¯¹oom_handlerçš„ç®€è¦æµ‹è¯•\n\n```c++\n#include\"my_alloc.h\"\n\nchar* chunk1 = (char*)malloc(sizeof(char)*10000000);\nvoid handler1()\n{\n    if(chunk1!=nullptr)\n    {\n        free(chunk1);\n    }\n    chunk1 = nullptr;\n    xcg::malloc_alloc::set_malloc_handler(nullptr);\n}\nint main()\n{\n    //è®¾ç½®hanlerå‡½æ•°\n    xcg::malloc_alloc::set_malloc_handler(handler1);\n    //å°è¯•ç”³è¯·100ä¸ªintç©ºé—´\n    //åœ¨allocateå‡½æ•°ä¸­ï¼Œå¯ä»¥é€šè¿‡è°ƒè¯•å™¨å¼ºåˆ¶å°†resultèµ‹ä¸ºnullptråˆ™å¯è¿›è¡Œoomå¤„ç†æµ‹è¯•ã€‚\n    int * p = (int*)xcg::malloc_alloc::allocate(sizeof(int)*100);\n    return 0;\n}\n```\n\n## deallocate\n\n```c++\nstatic void deallocate(void * p, size_t n)\n{\n    free(p);\n}\n```\n\n## reallocate\n\n```c++\nstatic void * reallocate(void * p, size_t old_sz, size_t new_sz)\n{\n    void * result = realloc(p, new_sz);\n    if(nullptr == result)\n    {\n        result = oom_realloc(p, new_sz);\n    }\n    return result;\n}\n```\n\n# äºŒçº§é…ç½®å™¨\n\n* ä¸€çº§é…ç½®å™¨çš„é—®é¢˜\n  * ç›´æ¥çš„mallocåçš„æ•°æ®ä¸Šä¸‹å„æœ‰ä¸€ä¸ªè¶Šç•Œæ ‡è®°ã€‚ä¸Šè¶Šç•Œæ ‡è®°ä¹‹å¤–è¿˜æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”³è¯·äº†å¤šå°‘å­—èŠ‚ï¼Œè¿˜æœ‰nextåŸŸã€prevåŸŸä»¥ä¾¿è¿æ¥åˆ°é“¾è¡¨ä¸­è¿›è¡Œå†…å­˜ç®¡ç†ã€‚é™¤æ­¤ä¹‹å¤–å¯èƒ½è¿˜æœ‰æœ‰æ•ˆ/å¤±æ•ˆ(æ˜¯å¦é‡Šæ”¾)çš„æ ‡è®°ã€‚\n  * é™¤äº†åŒ…è£…ä¿¡æ¯å ç©ºé—´è¾ƒå¤šä¹‹å¤–ï¼Œè¿˜æœ‰mallocæ—¶èŠ±è´¹çš„æ—¶é—´ä¹Ÿå¤šã€‚è¿™æ ·å°±é€ æˆå¯¹äºæ¯”è¾ƒå°çš„å¯¹è±¡æ•°æ®åœ¨mallocæ—¶å…¥ä¸æ•·å‡ºã€‚\n  * ç»“è®ºå°±æ˜¯ï¼šå¯¹äºè¾ƒå°æ•°æ®ï¼Œé€‚ç”¨äºå†…å­˜æ± æ¥è¿›è¡Œå†…å­˜ç®¡ç†ã€‚\n\n* **å¯¹äºå®¢æˆ·ç«¯ç”³è¯·è¾ƒå°ç©ºé—´ï¼ˆ128bytesï¼‰çš„å…·ä½“å¤„ç†æµç¨‹**ï¼š\n  1. æ¯æ¬¡é…ç½®ä¸€å¤§å—å†…å­˜ï¼Œå¹¶ç»´æŠ¤å¯¹åº”çš„è‡ªç”±é“¾è¡¨(free-list)\n  2. ä¸‹æ¬¡å¦‚æœå†æœ‰ç›¸åŒå¤§å°çš„å†…å­˜éœ€æ±‚ï¼Œç›´æ¥ä»free-listä¸­å–å‡ºè‹¥å¹²å°å—ã€‚\n  3. å¦‚æœå®¢æˆ·ç«¯é‡Šæ”¾å°å—å†…å­˜ï¼Œå°±ç”±é…ç½®å™¨å›æ”¶åˆ°free-listä¸­ã€‚æ‰€ä»¥é…ç½®å™¨é™¤äº†åˆ†é…ç©ºé—´ï¼Œè¿˜è´Ÿè´£å›æ”¶ç©ºé—´ã€‚\n\n* ä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼ŒSGIç¬¬äºŒçº§é…ç½®å™¨ä¼šä¸»åŠ¨æŒ‰ä»»ä½•å°å—å†…å­˜çš„å†…å­˜éœ€æ±‚é‡è®¡ç®—æˆ8çš„å€æ•°ã€‚ï¼ˆæ¯”å¦‚å®¢æˆ·ç«¯è¦æ±‚30bytesï¼Œåˆ™è®¡ç®—ä¸º32bytesã€‚\n\n* å…±ç»´æŠ¤16ä¸ªfree-listsï¼Œå„è‡ªç®¡ç†å¤§å°åˆ†åˆ«ä¸º8ã€16ã€24ã€32ã€40ã€48ã€56ã€64ã€72ã€80ã€88ã€96ã€104ã€112ã€120ã€128çš„å°é¢åŒºå—ã€‚\n\n* free-listsçš„å•ç»“ç‚¹ç»“æ„å¦‚ä¸‹ï¼š\n\n  ```cpp\n  union obj\n  {\n      union obj * free_list_link;\n      char client_data[1];\t//the client sees this\n  }\n  ```\n\n## æ€»è§ˆ\n\n```c++\nenum { __ALIGN = 8};\nenum { __MAX_BYTES = 128};\nenum { __NFREELISTS = __MAX_BYTES / __ALIGN};\t// 128 / 8 = 16\n```\n\n```c++\ntemplate<bool threads, int inst>\t//å‚æ•°1ï¼šæ˜¯å¦è€ƒè™‘å¤šçº¿ç¨‹ï¼Œå‚æ•°2ï¼šæ ‡è¯†\nclass __default_alloc_template\n{\nprivate:\n    union obj\t/* åªæ˜¯ç±»å‹å®šä¹‰ */\n    {\n        union obj * free_list_link;\t//next\n        char client_data[1];\n    };\nprivate:\n    static obj * volatile free_list[__NFREELISTS];//volatileä¿®é¥°obj*ï¼Œå³free_listæ•°ç»„ä¸­å¯¹äºçš„æ•°æ®å†…å®¹ã€‚\n    static char* start_free;//æ¯æ¬¡é…ç½®çš„ä¸€å¤§å—'å†…å­˜' çš„å†…å­˜æ¥æºçš„å‰©ä½™éƒ¨åˆ†çš„èµ·å§‹\n    static char* end_free;\t//æ¯æ¬¡é…ç½®çš„ä¸€å¤§å—'å†…å­˜' çš„å†…å­˜æ¥æºçš„å‰©ä½™éƒ¨åˆ†çš„æœ«å°¾\n    static size_t heap_size;//ä¸Šé¢æåˆ°çš„éƒ½æ˜¯å†…å­˜æ¥æºï¼Œè€Œè¿™ä¸ªå†…å­˜æ¥æºéƒ½æ˜¯ä»å †åŒºç”³è¯·çš„ï¼Œå †åŒºç”³è¯·çš„æ€»ç©ºé—´æ•°è¦è®°å½•åœ¨æ¡ˆ\n    static size_t ROUNT_UP(size_t bytes);\n    static size_t FREELIST_INDEX(size_t bytes);\t//hash\n    static char* chunk_alloc(size_t size, int & nobjs);//size - å¯¹è±¡çš„å¤§å°ï¼Œnobjså¯¹è±¡çš„ä¸ªæ•°\n    static void* refill(size_t size);\t//é‡æ–°å¡«å……\npublic:\t/* ç”¨æˆ·è°ƒç”¨ */\n    static void* allocate(size_t size);\n    static void deallocate(void* p, size_t n);\n    static void* reallocate(void* p, size_t old_sz, size_t new_sz);\n};\n```\n\n## æˆå‘˜åˆå§‹åŒ–\n\n```c++\n// å¯¹free_list[__NFREELISTS]è¿›è¡Œåˆå§‹åŒ–ã€‚\ntemplate<bool threads, int inst> //\t1: __default_alloc_templateæ˜¯æ¨¡æ¿ç±»ï¼Œéœ€è¦å£°æ˜\ntypename __default_alloc_template<threads, inst>::obj * volatile // 2: objæ˜¯__default_alloc_template<threads, inst>ç±»å†…çš„ç±»ï¼Œéœ€è¦åŠ ä¸Šâ€œå“ªä¸ªç±»â€ï¼Œå¹¶ä¸”è¦åŠ ä¸Š\"typename\"ä»¥ç¤º\"obj\"æ˜¯ä¸ªç±»åï¼Œè€Œéæˆå‘˜ã€‚\n    __default_alloc_template<threads, inst>::free_list[__NFREELISTS] = {};\t// 3: free_list[__NFREELISTS]æ˜¯__default_alloc_template<threads, inst>ç±»å†…çš„æˆå‘˜ï¼Œéœ€è¦åŠ ä¸Šâ€œå“ªä¸ªç±»â€ï¼Œä½†æ— éœ€åŠ \"typename\"ã€‚\n// å¯¹start_freeè¿›è¡Œåˆå§‹åŒ–\ntemplate<bool threads, int inst>\nchar* __default_alloc_template<threads, inst>::start_free = nullptr;\n// å¯¹end_freeè¿›è¡Œåˆå§‹åŒ–\ntemplate<bool threads, int inst>\nchar* __default_alloc_template<threads, inst>::end_free = nullptr;\n// å¯¹heap_sizeè¿›è¡Œåˆå§‹åŒ–\ntemplate<bool threads, int inst>\nsize_t __default_alloc_template<threads, inst>::heap_size = 0;\n```\n\n## å‡½æ•°å®ç°\n\nå‡†å¤‡å·¥ä½œ\n\n```c++\nusing malloc_alloc = __malloc_alloc_template<0>;\n```\n\n### allocate\n\nç›¸å½“äºå•é“¾è¡¨çš„å¤´åˆ æ³•ï¼Œè¿”å›åˆ äº†çš„èŠ‚ç‚¹çš„åœ°å€ç»™ç”¨æˆ·ç”¨ã€‚\n\n```c++\nstatic void * allocate(size_t size)\n{\n    if(size > (size_t)__MAX_BYTES)\n    {\n        return malloc_alloc::allocate(size);\t//è½¬ç»™ä¸€çº§é…ç½®å™¨ã€‚\n    }\n    obj * result = nullptr;\n    obj * volatile * my_free_list = nullptr;\t//æ˜¯äºŒçº§æŒ‡é’ˆï¼Œè¦æŒ‡å‘obj*\n    my_free_list = free_list + FREELIST_INDEX(size);\n    result = *my_free_list;\n    if(nullptr == result)\t//è¯´æ˜æ­¤ä¸‹æ ‡å¤„æ— å†…å­˜å—äº†ï¼Œéœ€è¦ç”³è¯·ã€‚\n    {\n        void * r = refill(ROUND_UP(size));\n        return r;\n    }\n    *my_free_list = result->free_list_link;\t//æŠŠfree_listæ­¤ä¸‹æ ‡çš„æŒ‡é’ˆæ›´æ–°åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚ç›¸å½“äºé“¾è¡¨çš„å¤´åˆ æ³•ã€‚\n    return result;\n}\n```\n\n### refill\n\n```c++\nstatic void * refill(size_t size)\n{\n    int nobjs = 20;\n    char * chunk = chunk_alloc(size, nobjs);\n    //chunk_allocè¿è¡Œä¹‹åï¼Œnobjså€¼å¯èƒ½å‘ç”Ÿæ”¹å˜ã€‚\n    if(1 == nobjs)\n    {\n        //å¦‚æœnobjsæ˜¯1ï¼Œåˆ™è¯´æ˜å†…å­˜å—æ­£å¥½ç”¨å®Œï¼Œä¸ç”¨å†å¤„ç†åç»­å†…å­˜åŒºåŸŸçš„é“¾æ¥ã€ç§»åŠ¨\n        return chunk;\n    }\n    \n    //æ¥ä¸‹æ¥ï¼ŒæŠŠå†…å­˜å—åˆ†å´©ç¦»æï¼Œä¾æ¬¡ä¸²è”ã€‚\n    obj * volatile * my_free_list = NULL;\n    obj * result = (obj*)chunk;\n    obj * current_obj = NULL, * next_obj = NULL;\n    my_free_list = free_list + FREELIST_INDEX(size);\n    *my_free_list = next_obj = (obj*)(chunk+size);\n    for(int i = 1; ; ++i)\n    {\n        current_obj = next_obj;\n        next_obj = (obj*)((char*)next_obj + size);\n        if(i == nobjs-1)//æœ€åä¸€å—\n        {\n            current_obj->free_list_link = NULL;\n            break;\n        }\n        current_obj->free_list_link = next_obj;\n    }\n    return result;\n}\n```\n\n### chunk_alloc\n\n```c++\nstatic char* chunk_alloc(size_t size, int & nobjs)\n{\n    char * result = NULL;\n    size_t total_bytes = size * nobjs;\n    size_t bytes_left = end_free - start_free;\n    if(bytes_left >= total_bytes)\n    {\n        result = start_free;\n        start_free = start_free + total_bytes;\n        return result;\n    }\n    else if(bytes_left >= size)\n    {\n        nobjs = bytes_left / size;\n        total = size * nobjs;\n        \n        result = start_free;\n        start_free = start_free + total_bytes;\n        return result;\n    }\n    else //å†…å­˜ä¸è¶³ä»¥åˆ†é…1ä¸ªå¯¹è±¡ï¼ŒæŠŠå‰©ä½™çš„æ’å…¥åˆ°å…¶ä»–ä¸‹æ ‡(å‰©8å­—èŠ‚æ’åˆ°0, 16å­—èŠ‚æ’åˆ°1, ...)ï¼Œç„¶åå†å¦å¤–ç”³è¯·ä¸€ä¸ªå¤§çš„\n    {\n        size_t bytes_to_get = 2 * total_bytes + ROUND_UP(heap_size >> 4);\n        if(bytes_left > 0)\n        {\n            obj * volatile * my_free_list = free_list + FREELIST_INDEX(bytes_left);\n            //å¤´æ’\n            ((obj*)start_free)->free_list_link = *my_free_list;\n            *my_free_list = (obj*)start_free;\n        }\n        //å‰©ä½™çš„æ®‹å­˜ç©ºé—´ å¤„ç†å®Œæ¯•ï¼Œæ¥ä¸‹æ¥ç”³è¯·å¤§å—å†…å­˜\n        start_free = (char*)malloc(bytes_to_get);\n        if(NULL == start_free)\t//å †åŒºå±…ç„¶æ²¡æœ‰èµ„æºäº†ï¼æ— å¥ˆä¹‹è®¡ï¼Œåªèƒ½å‘æ¯”ä»–ä¹‹åçš„é“¾è¡¨æ‰¾æœ‰æ— å‰©ä½™å—ã€‚\n        {\n            obj * volatile * my_free_list = NULL;\n            for(int i = size; i <= __MAX_BYTES; i += __ALIGN)\t//æ³¨æ„ï¼Œiä»sizeå¼€å§‹ï¼Œè€Œä¸ä¸€å®šä»æœ€å°çš„å—å¤§å°8å¼€å§‹ï¼Œå› ä¸ºæ‰¾æ¯”ä½ å°çš„æ²¡æœ‰ç”¨å¤„ã€‚å¾—æ‰¾å¤§çš„ã€‚\n            {\n                my_free_list = free_list + FREELIST_INDEX(i);\n                obj * p = NULL;\n                if(NULL != p)\t//æ‰¾åˆ°äº†æ¯”ä»–å¤§çš„çš„å‰©ä½™çš„äº†ï¼\n                {\n                    *my_free_list = (*my_free_list)->free_list_link;\n                    start_free = (char*)p;\n                    end_free = start_free + i;\n                    return chunk_alloc(size, nobjs);\n                }\n            }\n            //å¦‚æœä¸Šé¢çš„forå¾ªç¯æ²¡èƒ½ä½¿å¾—å…¶æ‰¾åˆ°åˆé€‚çš„å†…å­˜å—ï¼Œåˆ™è¯´æ˜çœŸçš„æ˜¯â€œå±±ç©·æ°´å°½ç–‘æ— è·¯â€äº†ï¼Œåªèƒ½è½¬1çº§é…ç½®å™¨ï¼ŒæŠ›å‡ºå¼‚å¸¸æˆ–è€…é€šè¿‡handlerå¤„ç†ã€‚\n            start_free = malloc_alloc::allocate(bytes_to_get);\n        }\n        end_free = start_free + bytes_to_get;\n        heap_size += bytes_to_get;\n        return chunk_alloc(size, nobjs);\t//é€’å½’æ­¤å‡½æ•°ï¼Œç›¸å½“äºé‡æ–°æ¥ä¸€éæµç¨‹\n    }\n}\n```\n\n### ROUND_UP & INDEX\n\n```c++\nstatic size_t ROUNT_UP(size_t bytes)\n{\n    // 0 -> 0, 1~8 -> 8, 9~16 - > 16, 17~24 -> 24, ...\n    return (bytes+ __ALIGN-1) & ~(__ALIGN - 1);\n}\nstatic size_t FREELIST_INDEX(size_t bytes)\n{\n    // 1~8 -> 0, 9~16 -> 1, 17~24 -> 2, ...\n    return ((bytes+ __ALIGN-1) / __ALIGN) - 1;\n}\n```\n\n### æµ‹è¯•allocate\n\n```c++\n#ifdef __USE_MALLOC\ntypedef __malloc_alloc_template<0> malloc_alloc;\ntypedef malloc_alloc alloc;\n#else\ntypedef __default_alloc_template<0, 0> alloc;\n#endif\n```\n\n```c++\ntemplate<class T, class Alloc>\nclass simple_alloc\n{\npublic:\n    static T* allocate(size_t n)\t//ç”³è¯·nä¸ªTå¯¹è±¡\n    {\n        return Alloc::allocate(sizeof(T)*n);\n    }\n    static T* allocate()\n    {\n        return Alloc::allocate(sizeof(T));\n    }\n    void deallocate(T *p, size_t n)\n    {\n        if(NULL == p)return;\n        Alloc::deallocate(p, sizeof(T)*n);\n    }\n    void deallocate(T* p)\n    {\n        if(NULL == p)return;\n        Alloc::deallocate(p, sizeof(T));\n    }\n};\n```\n\nå¼•å…¥listè¿›è¡Œæµ‹è¯•\n\n```c++\n#include\"my_list.h\"\nusing namespace std;\nint main()\n{\n    xcg::my_list<char> mylist;\n    \n    for(int i = 0; i < 23; ++i)\n    {\n        mylist.push_back(i + 'a');\n    }\n    return 0;\n}\n```\n\nlistæ„å»ºæµç¨‹ï¼š\n\n```c++\ntemplate<class _Ty, class _A = xcg::alloc>\nclass my_list\n{\npublic:\n    typedef _Ty\t\t\t\t\t\t\t value_type;\n    typedef _Ty&\t\t\t\t\t\t reference;\n    typedef _Ty*\t\t\t\t\t\t pointer;\n    typedef const _Ty&\t\t\t\t\t const_reference;\n    typedef const _Ty*\t\t\t\t\t const_pointer;\n    \n    typedef _A\t\t\t\t\t\t\t allocator_type;\n    typedef xcg::simple_alloc<_Node, _A> data_allocate;\t\t//simple_allocä¸­ä½¿ç”¨çš„æ˜¯ç¬¬äºŒä¸ªå‚æ•°çš„allocateã€‚åœ¨è¿™é‡Œå³ä½¿ç”¨_A::allocateï¼Œé»˜è®¤å‚æ•°æ˜¯xcg::allocï¼Œè€Œæ ¹æ®å¼€å…³è¯­å¥ï¼Œè‹¥æ˜¯ä½¿ç”¨malloc_allocåˆ™ä¸ºä¸€çº§é…ç½®å™¨ï¼Œè‹¥ä¸ºdefault_allocåˆ™ç”¨äºŒçº§é…ç½®å™¨ã€‚æˆ‘ä»¬é»˜è®¤ä½¿ç”¨çš„æ˜¯__default_alloc_template<0, 0>ã€‚\n    \npublic:\n    my_list() : _Head(_Buynode()), _Size(0) {}\nprotected:\n    _Nodeptr _Buynode(_Nodeptr _parg = NULL, _Nodeptr _narg = NULL)\n    {\n        _Nodeptr _S = data_allocate::allocate();\n        _Acc::_Prev(_S) = _parg == NULL ? _S : _parg;\n        _Acc::_Next(_S) = _narg == NULL ? _S : _narg;\n        return _S;\n    }\nprivate:\n    _Nodeptr _Head;\n    size_t _Size;\n};\n```\n\n### deallocate\n\n```c++\nstatic void deallocate(void * p, size_t size)\t// n è¡¨ç¤ºç©ºé—´å¤§å°\n{\n    if(size > (size_t)__MAX_BYTES)\n    {\n        malloc_alloc::deallocate(p, size);\n        return;\n    }\n    //å½’è¿˜ç»™é…ç½®å™¨\n    obj * q = (obj*)p;\n    obj * volatile * my_free_list = free_list + FREELIST_INDEX(size);\n    //å¤´æ’\n    q->free_list_link = *my_free_list;\n    *my_free_list = q;\n    return;\n}\n```\n\n### æµ‹è¯•deallocate\n\n```c++\niterator erase(iterator _P)\n{\n    _Nodeptr _S = _P++._Mynode();\n    _Acc::_Next(_Acc::_Prev(_S)) = _Acc::_Next(_S);\n    _Acc::_Prev(_Acc::_Next(_S)) = _Acc::_Prev(_S);\n    destroy(&_Acc::_Value(_S));\t//ä¸åˆ é™¤èŠ‚ç‚¹ï¼Œè€Œæ˜¯é‡Šæ”¾valueåŸŸã€‚\n    _Freenode(_);\n    \n    return _P;\n}\nvoid _Freenode(_Nodeptr _P)\n{\n    data_allocate::deallocate(_P);\n}\nvoid pop_back()\n{\n    erase(--end());\n}\nvoid pop_front()\n{\n    erase(begin());\n}\n```\n\n```c++\nclass Object\n{\nprivate:\n    int value;\npublic:\n    Object(int x = 0) : value(x)\n    {\n        cout << \"create object\" << this << endl;\n    }\n    ~Object()\n    {\n        cout << \"destroy object\" << this << endl;\n    }\n};\nint main()\n{\n    xcg::my_list<Object> objlist;\n    for(int i = 0; i < 10; ++i)\n    {\n        objlist.push_back(Object(i));\n    }\n    objlist.pop_back();\n    return 0;\n}\n```\n\n### reallocate\n\n```c++\nstatic void* reallocate(void * p, size_t old_sz, size_t new_sz)\n{\n    if(old_sz > (size_t)__MAX_BYTES && new_sz > (size_t)__MAX_BYTES)\n    {\n        return malloc_alloc::reallocate(p, old_sz, new_sz);\n    }\n    // old_sz == 20, new_sz == 22\t-->24, 24\n    if(ROUND_UP(old_sz) == ROUND_UP(new_sz))\n    {\n        return p;\n    }\n    // old_sz > 128, new_sz < 128\n    // old_sz < 128, new_sz < 128\n    // old_sz < 128, new_sz > 128\n    size_t sz = old_sz < new_sz ? old_sz : new_sz;\n    void * s = allocate(new_sz);\n    memmove(s, p ,sz);\n    deallocate(p, old, sz);\n    return s;\n}\n```\n\n","categories":["Cpp","STL","é¡¹ç›®","å†…å­˜æ± "]},{"title":"Cpp_STL_iterator","url":"/Cpp/Cpp_STL_iterator/","content":"\n# å†…å®¹\n\n1. iteratorçš„åˆ†ç±»\n2. iteratorçš„å±æ€§\n3. advance--ä½¿è¿­ä»£å™¨ç§»åŠ¨næ­¥\n4. é’ˆå¯¹è¿­ä»£å™¨çš„ç±»å‹èƒå–\n5. SGIèƒå–çš„å†™æ³•\n6. distance--è®¡ç®—ä¸¤è¿­ä»£å™¨ä¹‹é—´çš„è·ç¦»\n\n# iterator\n\n```c++\n#pragma once\nnamespace xcg\n{\nstruct input_iterator_tag {};\nstruct output_iterator_tag {};\nstruct forward_iterator_tag : public input_iterator_tag {};\nstruct bidirectional_iterator_tag : public forward_iterator_tag {};\nstruct random_access_iterator_tag : public bidirectional_iterator_tag {};\nusing ptrdiff_t = int;\n\ntemplate<class _C, class _Ty, class _D = ptrdiff_t, class _Pointer = _Ty*,\n\tclass _Reference = _Ty&>\n\tstruct iterator\n{\n\ttypedef _C\t\t\titerator_category;\n\ttypedef _Ty\t\t\tvalue_type;\n\ttypedef _D\t\t\tdifference_type;\n\ttypedef _Pointer\tpointer;\n\ttypedef _Reference\treference;\n};\ntemplate<class _Ty, class _D = ptrdiff_t>\nstruct _Forit : public iterator<forward_iterator_tag, _Ty, _D> {};\ntemplate<class _Ty, class _D = ptrdiff_t>\nstruct _Bidit : public iterator<bidirectional_iterator_tag, _Ty, _D> {};\ntemplate<class _Ty, class _D = ptrdiff_t>\nstruct _Ranit : public iterator<random_access_iterator_tag, _Ty, _D> {};\n\ntemplate<class _II, class _D>\ninline void __advance(_II& i, _D n, input_iterator_tag)\n{\n\twhile (n--) ++i;\n}\ntemplate<class _BI, class _D>\ninline void __advance(_BI& i, _D n, bidirectional_iterator_tag)\n{\n\tif (n >= 0)\n\t{\n\t\twhile (n--) ++i;\n\t}\n\telse\n\t{\n\t\twhile (n++) --i;\n\t}\n}\ntemplate<class _RAI, class _D>\ninline void __advance(_RAI& i, _D n, input_iterator_tag)\n{\n\ti += n;\n}\ntemplate<class _II, class _D>\ninline void advance(_II& i, _D n)\n{\n\n}\n}\n```\n\n```c++\ntemplate<class _Iterator>\nstruct iterator_traits\n{\n    iterator_traits() {}\n\ttypedef typename _Iterator::iterator_category\titerator_category;\n\ttypedef typename _Iterator::value_type\t\t\tvalue_type;\n\ttypedef typename _Iterator::difference_type\t\tdifference_type;\n\ttypedef typename _Iterator::pointer\t\t\t\tpointer;\n\ttypedef typename _Iterator::reference\t\t\treference;\n};\n```\n\n## advance\n\n```c++\ninline void advance(_II& i, _D n)\n{\n\titerator_traits<_II>();\n\ttypedef typename iterator_traits<_II>::iterator_category cate;\n\t__advance(i, n, cate());\n}\n```\n\n## èƒå–å™¨\n\né¦–å…ˆæ˜¯é’ˆå¯¹æ³›å‹iteratorï¼Œå…¶æ˜¯æ ‡å‡†çš„è¿­ä»£å™¨ï¼Œé‡è½½äº†\\*å’Œ->è¿ç®—ç¬¦ã€‚è¿™é‡Œçš„èƒå–å™¨å¯å®¹çº³çš„ä¸åŒ…æ‹¬è£¸æŒ‡é’ˆã€‚\n\n```c++\ntemplate<class _Iterator>\nstruct iterator_traits\n{\n    iterator_traits() {}\n\ttypedef typename _Iterator::iterator_category\titerator_category;\n\ttypedef typename _Iterator::value_type\t\t\tvalue_type;\n\ttypedef typename _Iterator::difference_type\t\tdifference_type;\n\ttypedef typename _Iterator::pointer\t\t\t\tpointer;\n\ttypedef typename _Iterator::reference\t\t\treference;\n};\n```\n\næ¥ä¸‹æ¥æ˜¯é’ˆå¯¹è£¸æŒ‡é’ˆä½œå‡ºçš„æ¨¡æ¿ç‰¹åŒ–ã€‚è£¸æŒ‡é’ˆå¯çœ‹ä½œæ˜¯å¯éšæœºè®¿é—®çš„è¿­ä»£å™¨ã€‚\n\n```c++\ntemplate<class T>\nstruct iterator_traits<T*>\n{\n\titerator_traits() {}\n\ttypedef typename random_access_iterator_tag\t\titerator_category;\n\ttypedef typename T\t\tvalue_type;\n\ttypedef typename int\tdifference_type;\n\ttypedef typename T*\t\tpointer;\n\ttypedef typename T&\t\treference;\n};\n```\n\næ¥ç€å†æ¬¡å¯¹è£¸æŒ‡é’ˆçš„èƒå–å™¨æ¨¡æ¿ä½œå‡ºéƒ¨åˆ†ç‰¹åŒ–ï¼Œå¯å¤„ç†å¸¸è£¸æŒ‡é’ˆã€‚\n\n```c++\ntemplate<class T>\nstruct iterator_traits<const T*>\n{\n\titerator_traits() {}\n\ttypedef typename random_access_iterator_tag\t\titerator_category;\n\ttypedef typename T\t\t\t\tvalue_type;\n\ttypedef typename int\t\t\tdifference_type;\n\ttypedef typename const T*\t\tpointer;\n\ttypedef typename const T&\t\treference;\n};\n```\n\n## è‡³æ­¤ä»£ç ç‰ˆæœ¬v1\n\n```c++\n#pragma once\nnamespace xcg\n{\nstruct input_iterator_tag {};\nstruct output_iterator_tag {};\nstruct forward_iterator_tag : public input_iterator_tag {};\nstruct bidirectional_iterator_tag : public forward_iterator_tag {};\nstruct random_access_iterator_tag : public bidirectional_iterator_tag {};\nusing ptrdiff_t = int;\n\ntemplate<class _C, class _Ty, class _D = ptrdiff_t, class _Pointer = _Ty*,\n\tclass _Reference = _Ty&>\n\tstruct iterator\n{\n\ttypedef _C\t\t\titerator_category;\n\ttypedef _Ty\t\t\tvalue_type;\n\ttypedef _D\t\t\tdifference_type;\n\ttypedef _Pointer\tpointer;\n\ttypedef _Reference\treference;\n};\n\ntemplate<class _Iterator>\nstruct iterator_traits\n{\n\titerator_traits() {}\n\ttypedef typename _Iterator::iterator_category\titerator_category;\n\ttypedef typename _Iterator::value_type\t\t\tvalue_type;\n\ttypedef typename _Iterator::difference_type\t\tdifference_type;\n\ttypedef typename _Iterator::pointer\t\t\t\tpointer;\n\ttypedef typename _Iterator::reference\t\t\treference;\n};\n\ntemplate<class T>\nstruct iterator_traits<T*>\n{\n\titerator_traits() {}\n\ttypedef typename random_access_iterator_tag\t\titerator_category;\n\ttypedef typename T\t\tvalue_type;\n\ttypedef typename int\tdifference_type;\n\ttypedef typename T*\t\tpointer;\n\ttypedef typename T&\t\treference;\n};\ntemplate<class T>\nstruct iterator_traits<const T*>\n{\n\titerator_traits() {}\n\ttypedef typename random_access_iterator_tag\t\titerator_category;\n\ttypedef typename T\t\t\t\tvalue_type;\n\ttypedef typename int\t\t\tdifference_type;\n\ttypedef typename const T*\t\tpointer;\n\ttypedef typename const T&\t\treference;\n};\n\ntemplate<class _Ty, class _D = ptrdiff_t>\nstruct _Forit : public iterator<forward_iterator_tag, _Ty, _D> {};\ntemplate<class _Ty, class _D = ptrdiff_t>\nstruct _Bidit : public iterator<bidirectional_iterator_tag, _Ty, _D> {};\ntemplate<class _Ty, class _D = ptrdiff_t>\nstruct _Ranit : public iterator<random_access_iterator_tag, _Ty, _D> {};\n\ntemplate<class _II, class _D>\ninline void __advance(_II& i, _D n, input_iterator_tag)\n{\n\twhile (n--) ++i;\n}\ntemplate<class _BI, class _D>\ninline void __advance(_BI& i, _D n, bidirectional_iterator_tag)\n{\n\tif (n >= 0)\n\t{\n\t\twhile (n--) ++i;\n\t}\n\telse\n\t{\n\t\twhile (n++) --i;\n\t}\n}\ntemplate<class _RAI, class _D>\ninline void __advance(_RAI& i, _D n, input_iterator_tag)\n{\n\ti += n;\n}\ntemplate<class _II, class _D>\ninline void advance(_II& i, _D n)\n{\n\titerator_traits<_II>();\n\ttypedef typename iterator_traits<_II>::iterator_category cate;\n\t__advance(i, n, cate());\n}\n}\n```\n\n## SGIçš„åšæ³•\n\n```c++\n//ä»¥ä¸‹ä¸‰ä¸ªå‡½æ•°æ˜¯SGIæ¯”è¾ƒé‡è¦çš„å†™æ³•æ¨¡å¼\ntemplate<class _II>\ninline typename iterator_traits<_II>::iterator_category\niterator_category(const _II&)\n{\n\ttypedef typename iterator_traits<_II>::iterator_category cate;\n\treturn cate();\n}\ntemplate<class _II>\ninline typename iterator_traits<_II>::value_type*\nvalue_type(const _II&)\n{\n\treturn static_cast<typename iterator_traits<_II>::value_type*>(0);\n}\ntemplate<class _II>\ninline typename iterator_traits<_II>::difference_type*\ndifference_type(const _II &)\n{\n\treturn static_cast<typename iterator_traits<_II>::difference_type*>(0);\n}\n```\n\n```c++\ntemplate<class _II, class _D>\ninline void advance(_II& i, _D n)\n{\n    //è¿™é‡Œæ˜¯SGIçš„å†™æ³•ï¼Œä½¿ä»£ç æ›´åŠ çµæ´»ã€‚\n\t__advance(i, n, iterator_category(i));\n}\n```\n\n## distance\n\n```c++\ntemplate<class _II>\ninline typename iterator_traits<_II>::difference_type\n__distance(_II _F, _II _L, input_iterator_tag)\n{\n\ttypename iterator_traits<_II>::difference_type n = 0;\n\twhile (_F != _L)\n\t{\n\t\t++_F;\n\t\t++n;\n\t}\n\treturn n;\n}\ntemplate<class _RAI>\ninline typename iterator_traits<_RAI>::difference_type\n__distance(_RAI _F, _RAI _L, input_iterator_tag)\n{\n\ttypename iterator_traits<_RAI>::difference_type n = 0;\n\treturn _L - _F;\n}\n\ntemplate<class _II>\ninline typename iterator_traits<_II>::difference_type\ndistance(_II _F, _II _L, input_iterator_tag)\n{\n\treturn __distance(_F, _L, iterator_category(_F));\n}\n```\n\n# è¿­ä»£å™¨å¤±æ•ˆçš„åœºæ™¯\nå¯ä»¥æŒ‡å‘å…ƒç´ çš„å·¥å…·ï¼šè¿­ä»£å™¨ã€æŒ‡é’ˆå’Œå¼•ç”¨ã€‚æœ‰æ—¶ï¼Œè™½ç„¶è¿­ä»£å™¨å¤±æ•ˆï¼Œä½†æŒ‡é’ˆå’Œå¼•ç”¨ä¸ä¸€å®šå¤±æ•ˆã€‚\n\né™¤äº†å…ƒç´ çš„è¿­ä»£å™¨å¤±æ•ˆçš„é—®é¢˜ï¼Œè¿˜è¦è€ƒè™‘å®¹å™¨endè¿™ä¸ªè¿­ä»£å™¨æ˜¯å¦å¤±æ•ˆçš„é—®é¢˜ã€‚**`end()` ç‰¹æ€§**ï¼šåªè¦å…ƒç´ æ•°å˜äº†ï¼Œä¹‹å‰æ‹¿åˆ°çš„ `end()` ç«‹åˆ»å¤±æ•ˆã€‚\n## vectorã€string\n1. åªè¦æ¶‰åŠåˆ°æ‰©å®¹ï¼Œå…¨éƒ¨è¿­ä»£å™¨éƒ½ä¼šå¤±æ•ˆï¼ˆåŒ…æ‹¬è¿­ä»£å™¨ã€æŒ‡é’ˆå’Œå¼•ç”¨ï¼‰ã€‚\n2. insertã€push_backï¼šä¹‹åï¼Œæ’å…¥ç‚¹ï¼ˆæ’å…¥åï¼Œæ”¾çš„æ˜¯æ–°å…ƒç´ ï¼‰åˆ°æœ«å°¾ï¼Œè¿™ä¸€èŒƒå›´å…¨å¤±æ•ˆï¼ˆè¿­ä»£å™¨ã€æŒ‡é’ˆå’Œå¼•ç”¨ï¼‰ã€‚æ’å…¥ç‚¹ä¹‹å‰çš„ä¸å—å½±å“ã€‚\n    1. `end()` è¿­ä»£å™¨å¤±æ•ˆ\n3. eraseï¼šä¹‹åï¼Œåˆ é™¤ç‚¹ï¼ˆåˆ é™¤åï¼Œæ”¾çš„æ˜¯ä¸‹ä¸€ä¸ªå…ƒç´ ï¼‰åˆ°æœ«å°¾ï¼Œè¿™ä¸€èŒƒå›´å…¨å¤±æ•ˆï¼ˆè¿­ä»£å™¨ã€æŒ‡é’ˆå’Œå¼•ç”¨ï¼‰ã€‚åˆ é™¤ç‚¹ä¹‹å‰çš„ä¸å—å½±å“ã€‚\n    1. `end()` è¿­ä»£å™¨å¤±æ•ˆ\n## deque\n`deque` ä¸æ˜¯ä¸€æ•´å—è¿ç»­å†…å­˜ï¼Œè€Œæ˜¯**å¤šå—å®šé•¿ç¼“å†²åŒº + ä¸€å¼ â€œå—ç´¢å¼•è¡¨â€(map)**ã€‚\næ’å…¥å¯èƒ½å¯¼è‡´æ‰©å®¹ï¼ˆæ–°åˆ†é…ä¸€ä¸ªè¿ç»­å†…å­˜æ®µï¼‰ã€‚\n\nè¿­ä»£å™¨é‡Œä¸ä»…æœ‰å…ƒç´ æŒ‡é’ˆï¼Œè¿˜å¸¦ç€æŒ‡å‘å—åŠç´¢å¼•è¡¨çš„ä½ç½®ï¼›**ä¸€æ—¦åœ¨ä¸¤ç«¯æ‰©å±•éœ€è¦æ”¹åŠ¨ç´¢å¼•è¡¨ï¼Œæ‰€æœ‰è¿­ä»£å™¨éƒ½ä¼šå¤±æ•ˆ**ã€‚ä½†å…ƒç´ æœ¬èº«é€šå¸¸æ²¡æ¬å®¶ï¼Œæ‰€ä»¥**å¼•ç”¨/æŒ‡é’ˆå¤šæ•°ä»ç„¶æœ‰æ•ˆ**ï¼ˆé™¤éä½ åˆ çš„å°±æ˜¯å®ƒï¼Œæˆ–åœ¨ä¸­é—´æ’å…¥/åˆ é™¤å¯¼è‡´å…ƒç´ æ¬åŠ¨ï¼‰ã€‚è¿™æ­£æ˜¯å®ƒä¸ `vector`/`list` æœ€å¤§çš„å·®å¼‚ã€‚\n1. æ’å…¥\n    1. é¦–å°¾æ’å…¥\n        1. è§„å®šæ‰€æœ‰çš„**è¿­ä»£å™¨**å¤±æ•ˆï¼ˆä¸åŒ…æ‹¬æŒ‡é’ˆã€å¼•ç”¨ï¼‰ã€‚\n        2. å¼•ç”¨/æŒ‡é’ˆé€šå¸¸ä»æŒ‡å‘åŸå…ƒç´ ï¼Œä¸å¤±æ•ˆï¼\n            1. æ— è®ºæ˜¯å¦æ‰©å®¹ï¼Œå…¶ä»–çš„å…ƒç´ éƒ½æ˜¯ä¿ç•™åœ¨åŸä½ç½®çš„ï¼Œå› æ­¤**å…¶ä»–å…ƒç´ çš„å¼•ç”¨/æŒ‡é’ˆä¸å—å½±å“**ã€‚\n    2. åœ¨ä¸­é—´æ’å…¥\n        1. **æ‰€æœ‰å…¨å¤±æ•ˆ**ï¼ˆåŒ…æ‹¬è¿­ä»£å™¨ã€æŒ‡é’ˆå’Œå¼•ç”¨ï¼‰ã€‚\n2. åˆ é™¤\n    1. é¦–å°¾å…ƒç´ \n        1. è¢«åˆ é™¤å…ƒç´ çš„è¿­ä»£å™¨ã€æŒ‡é’ˆå’Œå¼•ç”¨å¤±æ•ˆã€‚å…¶ä»–å…ƒç´ ä¸å½±å“ï¼\n        2. å¦‚æœåˆ é™¤çš„æ˜¯é¦–å…ƒç´ ï¼Œå®¹å™¨çš„endè¿­ä»£å™¨ä¸å¤±æ•ˆï¼ˆä¸åŒ…æ‹¬æŒ‡é’ˆã€å¼•ç”¨ï¼‰ã€‚\n            1. åªæœ‰è¿™ä¸€ç§æƒ…å†µä¸ä½¿ `end()` å¤±æ•ˆï¼Œå…¶ä»–æƒ…å†µéƒ½ä¸è¦ç”¨æ—§çš„endã€‚\n                1. ä½†æ˜¯ï¼Œæœ‰å¯èƒ½è™½ç„¶æ˜¯pop_frontï¼Œä½†æ°å¥½å®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œæ­¤æ—¶endä¹Ÿä¼šå¤±æ•ˆã€‚\n        3. å¦‚æœåˆ é™¤çš„æ˜¯å°¾å…ƒç´ ï¼Œå®¹å™¨çš„endè¿­ä»£å™¨ä¼šå¤±æ•ˆï¼ˆä¸åŒ…æ‹¬æŒ‡é’ˆã€å¼•ç”¨ï¼‰ã€‚\n    2. åˆ é™¤ä¸­é—´å…ƒç´ \n        1. **æ‰€æœ‰å…¨å¤±æ•ˆ**ï¼ˆåŒ…æ‹¬è¿­ä»£å™¨ã€æŒ‡é’ˆå’Œå¼•ç”¨ï¼‰ã€‚\n\n![](../../images/Cpp_STL_iterator/image-20250822003024458.png)\n\n## list\n1. insertï¼šä¸ä¼šè®©è¿­ä»£å™¨å¤±æ•ˆï¼ˆæ‰€æœ‰å…ƒç´ ï¼ŒåŒ…æ‹¬æ–°æ’å…¥çš„ï¼Œéƒ½ä¸ä¼šå¤±æ•ˆï¼‰ã€‚\n    1. ä½†æ˜¯ï¼Œæ’å…¥åï¼Œæ’å…¥ç‚¹æ”¾çš„æ˜¯æ–°å…ƒç´ ï¼ŒåŸæ¥ä½ç½®çš„å…ƒç´ è¢«æŒ¤åˆ°äº†å³è¾¹ã€‚å¦‚æœéœ€è¦ç»§ç»­å‘å³éå†ï¼Œè®°å¾—åœ¨æ’å…¥ä¹‹åå•ç‹¬åšä¸€æ¬¡`++`ã€‚\n2. eraseï¼šä¹‹åï¼Œä»…å¯¹åˆ é™¤çš„å…ƒç´ çš„è¿­ä»£å™¨å¤±æ•ˆã€‚å…¶ä»–ä»æœ‰æ•ˆã€‚\n## mapã€multimapã€setã€multiset\n1. insertï¼šæ— å½±å“ï¼šä¸ä¼šè®©è¿­ä»£å™¨ã€æŒ‡é’ˆã€å¼•ç”¨å¤±æ•ˆï¼ˆæ‰€æœ‰å…ƒç´ ï¼ŒåŒ…æ‹¬æ–°æ’å…¥çš„ï¼Œéƒ½ä¸ä¼šå¤±æ•ˆï¼‰ã€‚\n2. eraseï¼šä»…å¯¹åˆ é™¤çš„å…ƒç´ çš„è¿­ä»£å™¨ã€æŒ‡é’ˆã€å¼•ç”¨å¤±æ•ˆã€‚å…¶ä»–å…ƒç´ ä»æœ‰æ•ˆã€‚\n## unordered_mapã€unordered_set\nå“ˆå¸Œè¡¨çš„æ’å…¥ï¼Œå¯èƒ½ä¼šå­˜åœ¨å®¹å™¨å¢é•¿å¯¼è‡´é‡æ–°å“ˆå¸Œã€‚\næ’å…¥åï¼Œæ–°å®¹å™¨çš„å°ºå¯¸è¶…è¿‡å…¶å®¹é‡é˜ˆå€¼ï¼ˆè®¡ç®—æ–¹å¼ä¸ºå®¹å™¨çš„ `bucket_count` ä¹˜ä»¥å…¶ `max_load_factor`ï¼‰ï¼Œåˆ™ä¼šå¼ºåˆ¶æ‰§è¡Œé‡æ–°å“ˆå¸Œã€‚åˆ é™¤ä¸æ¶‰åŠé‡æ–°å“ˆå¸Œã€‚\nåœ¨é‡æ–°å“ˆå¸Œåï¼Œå®¹å™¨ä¸­çš„æ‰€æœ‰è¿­ä»£å™¨éƒ½ä¼šå¤±æ•ˆã€‚ï¼ˆæŒ‡é’ˆã€å¼•ç”¨ä»æœ‰æ•ˆï¼Œå³ä½¿é‡æ–°å“ˆå¸Œï¼‰\n\n1. insertï¼š\n    1. å¦‚æœä¸æ¶‰åŠåˆ°é‡æ–°å“ˆå¸Œã€‚ä¸ä¼šè®©è¿­ä»£å™¨ã€æŒ‡é’ˆã€å¼•ç”¨å¤±æ•ˆï¼ˆæ‰€æœ‰å…ƒç´ ï¼ŒåŒ…æ‹¬æ–°æ’å…¥çš„ï¼Œéƒ½ä¸ä¼šå¤±æ•ˆï¼‰ã€‚\n    2. å¦‚æœé‡æ–°å“ˆå¸Œï¼Œå®¹å™¨ä¸­çš„æ‰€æœ‰è¿­ä»£å™¨å¤±æ•ˆã€‚ï¼ˆ**ä½†æŒ‡é’ˆã€å¼•ç”¨ä»æœ‰æ•ˆï¼Œå³ä½¿é‡æ–°å“ˆå¸Œ**ï¼‰\n    3. å…ƒç´ çš„æŒ‡é’ˆã€å¼•ç”¨åœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½ä¿æŒæœ‰æ•ˆï¼Œå³ä½¿åœ¨é‡æ–°å“ˆå¸Œä¹‹åä¹Ÿæ˜¯å¦‚æ­¤ã€‚\n2. eraseï¼šä»…å¯¹åˆ é™¤çš„å…ƒç´ çš„è¿­ä»£å™¨ã€æŒ‡é’ˆã€å¼•ç”¨å¤±æ•ˆã€‚å…¶ä»–å…ƒç´ ä»æœ‰æ•ˆã€‚\n\n## å…¶ä»–å¦‚queueã€stackã€`priority_queueâ€‹`\næ²¡æœ‰æä¾›è¿­ä»£å™¨ã€‚ä¸ç”¨è°ˆå¤±æ•ˆçš„æ¦‚å¿µã€‚\n## Array\n1. å›ºå®šå¤§å°ï¼›ä¸ä¼šæ’/åˆ ï¼›\n2. ä¿®æ”¹å…ƒç´ å€¼**ä¸**ä½¿è¿­ä»£å™¨å¤±æ•ˆã€‚\n3. `swap(array)` ä¸å¤±æ•ˆè¿­ä»£å™¨ï¼ˆæŒ‡å‘åŒä¸€å—å†…å­˜ï¼‰ã€‚","categories":["Cpp","STL"]},{"title":"ç»ƒä¹ _Cpp_å¤šçº¿ç¨‹","url":"/å¤šçº¿ç¨‹/ç»ƒä¹ _Cpp_å¤šçº¿ç¨‹/","content":"# å†…å®¹\n\n1. æ‰“å°å¥‡å¶æ•°\n2. æ‰“å°0~100\n3. ä¸‰çº¿ç¨‹ä¾æ¬¡æ‰“å°Aã€Bã€C\n# ä¸¤çº¿ç¨‹äº¤æ›¿æ‰“å°å¥‡å¶æ•°\n\n```c\n#include<thread>\n#include<mutex>\n#include<condition_variable>\n#include<iostream>\nstd::mutex data_mutex;\nstd::condition_variable data_cv;\nbool oddtag = true;\nvoid printodd()//æ‰“å°å¥‡æ•°\n{\n    std::unique_lock<std::mutex> ulock(data_mutex);\n    for(int odd = 1; odd <= 100; odd+=2)\n    {\n        while(oddtag != true)\n        {\n            data_cv.wait(ulock);\n        }\n        std::cout << \"odd: \" << odd << std::endl;\n        oddtag = false;\n        data_cv.notify_all();\n    }\n}\nvoid printeven()//æ‰“å°å¶æ•°\n{\n    std::unique_lock<std::mutex> ulock(data_mutex);\n    for(int even = 2; even <= 100; even+=2)\n    {\n        while(oddtag == true)\n        {\n            data_cv.wait(ulock);\n        }\n        std::cout << \"even: \" << even << std::endl;\n        oddtag = true;\n        data_cv.notify_all();\n    }\n}\nint main()\n{\n    std::thread thodd(printodd);\n    std::thread theven(printeven);\n\n    thodd.join();\n    theven.join();\n    return 0;\n}\n```\n\n# ä¸‰çº¿ç¨‹æ‰“å°0~100\n\n## æœ€åŸå§‹çš„å¿™ç­‰å¾…ç‰ˆæœ¬\n\n```cpp\n#include<iostream>\nusing namespace std;\nstd::mutex g_mtx;\nstd::condition_variable cv;\nint number = 0;\nvoid fun0()\n{\n    while(number <= 100)\n    {\n        while(number%3 == 0 && number <= 100)\n        {\n            cout << \"fun0 : \" << number << endl;\n            number += 1;\n        }\n    }\n}\nvoid fun1()\n{\n    while(number <= 100)\n    {\n        while(number%3 == 1 && number <= 100)\n        {\n            cout << \"fun0 : \" << number << endl;\n            number += 1;\n        }\n    }\n}\nvoid fun2()\n{\n    while(number <= 100)\n    {\n        while(number%3 == 2 && number <= 100)\n        {\n            cout << \"fun0 : \" << number << endl;\n            number += 1;\n        }\n    }\n}\n```\n\nä»¥ä¸Šè™½ç„¶ä¹Ÿå¯ä»¥è¾¾åˆ°å¤šçº¿ç¨‹æ‰“å°0~100ï¼Œä½†æ˜¯å­˜åœ¨å¿™ç­‰å¾…é—®é¢˜ã€‚\n\n## å°è¯•åŠ é”\n\n```cpp\n#include<iostream>\nstd::mutex g_mtx;\nstd::condition_variable cv;\nint number = 0;\nvoid fun0()\n{\n    unique_lock<std::mutex> locker(g_mtx);\n    while(number <= 100)\n    {\n        while(number%3==0 && number <= 100)\n        {\n            cout << \"fun : 0\" << number << endl;\n            number += 1;\n            cv.notify_one();\n        }\n        cv.wait(locker);\n    }\n}\n//...\n```\n\nä½†æ˜¯è¿™é‡Œåˆæœ‰é—®é¢˜äº†ï¼Œæœ‰æ—¶å€™ç¨‹åºå¯ä»¥æ­£å¸¸åœ°æ‰“å°å®Œæ¯•ï¼Œè€Œæœ‰æ—¶å€™åˆ™ä¼šæ­»åœ¨æŸä¸ªä½ç½®ã€‚\n\nå› ä¸º`notify_one`æœ‰å¯èƒ½æ²¡æœ‰å«é†’é‚£ä¸ªè®©ç¨‹åºæ­£å¸¸è¿è¡Œä¸‹å»çš„çº¿ç¨‹ã€‚\n\næ‰€ä»¥éœ€è¦ç”¨åˆ°`notify_all()`ã€‚\n\n```cpp\n#include<iostream>\nstd::mutex g_mtx;\nstd::condition_variable cv;\nint number = 0;\nvoid fun0()\n{\n    unique_lock<std::mutex> locker(g_mtx);\n    while(number <= 100)\n    {\n        while(number%3==0 && number <= 100)\n        {\n            cout << \"fun : 0\" << number << endl;\n            number += 1;\n            cv.notify_all();\n        }\n        cv.wait(locker);\n    }\n}\n//...\n```\n\nåˆæœ‰äº†æ–°é—®é¢˜ï¼Œä¸ºä»€ä¹ˆç¨‹åºç»“æŸä¸äº†äº†ï¼Ÿ\n\næœ€åä¸€ä¸ªäººï¼ˆå…¶å®æ˜¯çº¿ç¨‹fun1ï¼‰æŠŠè‡ªå·±waitæŒ‚èµ·äº†ï¼Œç¡åœ¨äº†é‚£é‡Œã€‚å› ä¸ºå®ƒæ˜¯æœ€åæ‰“å°çš„ï¼Œwaitäº†ã€‚åˆ«äººéƒ½å› ä¸ºwhileé€€å‡ºäº†ï¼Œæ²¡äººå»ç®¡ä»–äº†ã€‚\n\næ‰€ä»¥éœ€è¦åœ¨fun0æˆ–fun2çº¿ç¨‹é€€å‡ºå¤–å±‚whileå¾ªç¯æ—¶è¿›è¡Œå†æ¬¡notify_allè¿›è¡Œè§£é™¤ã€‚\n\n```cpp\n#include<iostream>\n#include<thread>\n#include<mutex>\n#include<condition_variable>\nusing namespace std;\nmutex mtx;\ncondition_variable cv;\nint count = 1;\n\nvoid print_1()\n{\n    unique_lock<mutex> locker(mtx);\n    while(count <= 100)\n    {\n        while(count%3 == 1 && count <= 100)\n        {\n            cout << \"print_1 : \" << count << endl;\n            count += 1;\n            cv.notify_all();\n        }\n        cv.wait(locker);\n    }\n}\nvoid print_2()\n{\n    unique_lock<mutex> locker(mtx);\n    while(count <= 100)\n    {\n        while(count%3 == 2 && count <= 100)\n        {\n            cout << \"print_2 : \" << count << endl;\n            count += 1;\n            cv.notify_all();\n        }\n        cv.wait(locker);\n    }\n}\nvoid print_3()\n{\n    unique_lock<mutex> locker(mtx);\n    while(count <= 100)\n    {\n        while(count%3 == 0 && count <= 100)\n        {\n            cout << \"print_3 : \" << count << endl;\n            count += 1;\n            cv.notify_all();\n        }\n        cv.wait(locker);\n    }\n    cv.notify_all();\n}\nint main()\n{\n    thread t1(print_1);\n    thread t2(print_2);\n    thread t3(print_3);\n    t1.join();\n    t2.join();\n    t3.join();\n}\n```\n\n## é—®é¢˜ä»£ç  - æœªè¿‡æ»¤è¾¹ç•Œ, é€ æˆæ•°æ®æº¢å‡º\n\n```cpp\n#include<iostream>\n#include<thread>\n#include<mutex>\n#include<condition_variable>\nusing namespace std;\nmutex mtx;\ncondition_variable cv;\nint count = 1;\n\nvoid print_1()\n{\n    unique_lock<mutex> locker(mtx);\n    while(count<= 100)\n    {\n        while(count%3 != 1)\n        {\n            cv.wait(locker);\n        }\n        cout << count << endl;\n        ++count;\n        cv.notify_all();\n    }\n}\nvoid print_2()\n{\n    unique_lock<mutex> locker(mtx);\n    while(count<= 100)\n    {\n        while(count%3 != 2)\n        {\n            cv.wait(locker);\n        }\n        cout << count << endl;\n        ++count;\n        cv.notify_all();\n    }\n}\nvoid print_3()\n{\n    unique_lock<mutex> locker(mtx);\n    while(count<= 100)\n    {\n        while(count%3 != 0)\n        {\n            cv.wait(locker);\n        }\n        cout << count << endl;\n        ++count;\n        cv.notify_all();\n    }\n}\nint main()\n{\n    thread t1(print_1);\n    thread t2(print_2);\n    thread t3(print_3);\n    t1.join();\n    t2.join();\n    t3.join();\n}\n```\n\nè¿è¡Œç»“æœæ˜¯æ‰“å°`1`åˆ°`102`ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºåœ¨`while(count%3 != x){cv.wait(locker)}`è·³å‡ºåæ²¡æœ‰è¿‡æ»¤`count`çš„å¤§å°æ˜¯å¦è¶…è¿‡äº†`100`ã€‚æœ€å¤–å±‚çš„`while(count <= 100)`æ—¶ï¼Œ`count==99`æ—¶ï¼Œçº¿ç¨‹1ã€çº¿ç¨‹2ã€çº¿ç¨‹3éƒ½è¿›å…¥å…¶ä¸­ï¼Œçº¿ç¨‹1é¡ºåˆ©æ‰§è¡Œå®Œæ¯•ï¼Œçº¿ç¨‹2ã€çº¿ç¨‹3è¢«å”¤é†’åï¼Œç”±äºæ²¡æœ‰åˆ¤æ–­ã€è¿‡æ»¤`count`çš„å¤§å°æ˜¯å¦è¶…è¿‡äº†`100`ï¼Œåˆ™é¡ºåˆ©èµ°åˆ°ä¸‹é¢æ‰“å°ä»£ç éƒ¨åˆ†ï¼Œç›¸å½“äºæ¼ç½‘ä¹‹é±¼ã€‚\n\n## é—®é¢˜ä»£ç  - æŸçº¿ç¨‹é€€å‡ºæ—¶æœªåŠæ—¶æ›´æ–°æ ‡è¯†å˜é‡å¯¼è‡´å…¶ä»–çº¿ç¨‹é˜»å¡\n\n```cpp\n#include<iostream>\n#include<thread>\n#include<mutex>\n#include<condition_variable>\nusing namespace std;\nmutex mtx;\ncondition_variable cv;\nint count = 1;\n\nvoid print_1()\n{\n    unique_lock<mutex> locker(mtx);\n    while(count<= 100)\n    {\n        while(count%3 != 1)\n        {\n            cv.wait(locker);\n        }\n        if(count <= 100)\n        {\n            cout << count << endl;\n            ++count;\n        }\n        cv.notify_all();\n    }\n}\nvoid print_2()\n{\n    unique_lock<mutex> locker(mtx);\n    while(count<= 100)\n    {\n        while(count%3 != 2)\n        {\n            cv.wait(locker);\n        }\n        if(count <= 100)\n        {\n            cout << count << endl;\n            ++count;\n        }\n        cv.notify_all();\n    }\n}\nvoid print_3()\n{\n    unique_lock<mutex> locker(mtx);\n    while(count<= 100)\n    {\n        while(count%3 != 0)\n        {\n            cv.wait(locker);\n        }\n        if(count <= 100)\n        {\n            cout << count << endl;\n            ++count;\n        }\n        cv.notify_all();\n    }\n}\nint main()\n{\n    thread t1(print_1);\n    thread t2(print_2);\n    thread t3(print_3);\n    t1.join();\n    t2.join();\n    t3.join();\n}\n```\n\nè¿™æ¬¡çš„æ‰“å°æ•ˆæœæ˜¯ï¼š`1`åˆ°`100`ï¼Œæ•°ç›®æ˜¯æ­£ç¡®çš„ï¼Œä¸å¤šä¸å°‘ã€‚ä½†æ˜¯ï¼Œæ›´å°´å°¬çš„é—®é¢˜æ¥äº†ï¼Œå±…ç„¶åœ¨æ‰“å°100ä¹‹åé˜»å¡æ­»äº†ï¼è¿™è¯´æ˜æœ‰çš„çº¿ç¨‹å†ä¹Ÿè·³ä¸å‡ºæ¡ä»¶å˜é‡ä¸Šçš„ç­‰å¾…é˜Ÿåˆ—äº†ã€‚\n\nå…³é”®çš„è§£å†³æ–¹æ³•ï¼šæŠŠæ¯æ¡çº¿ç¨‹ä¸­æœ€åçš„`++count`è¯­å¥æ”¾åˆ°`if(count <= 100)`è¯­å¥å¤–è¾¹ã€‚\n\nä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºå¦‚æœ`++count`åœ¨`if(count <= 100)`æ‰èƒ½æ‰§è¡Œæ—¶ï¼Œå°±ä¼šé€ æˆä¸€ä¸ªé—®é¢˜ï¼šçº¿ç¨‹1åˆ¤æ–­`count <= 100`é€šè¿‡ï¼Œå¯ä»¥æ‰“å°100ï¼Œä¹‹åï¼Œ`++count`ï¼Œæ­¤æ—¶countä¸º101ï¼›**æ­¤æ—¶å…³é”®å¤„**ï¼šçº¿ç¨‹2ï¼Œåˆ¤æ–­`count <= 100`ä¸é€šè¿‡ï¼Œé‚£ä¹ˆï¼Œ`++count`æœªèƒ½æ‰§è¡Œï¼›è¿™ç»™çº¿ç¨‹3é€ æˆäº†å¾ˆå¤§çš„éº»çƒ¦ï¼šæ¥åˆ°äº†çº¿ç¨‹3ï¼Œç”±äºå®ƒå¤„åœ¨`while(count%3 != x){cv.wait(locker)}`è¯­å¥ä¸­ï¼Œè¢«çº¿ç¨‹2å”¤é†’ååˆ¤æ–­`count%3 == 0`ï¼Œç”±äºcountåœ¨ä¸Šä¸ªçº¿ç¨‹æ²¡æœ‰æ›´æ–°ï¼Œæ‰€ä»¥`count%3 != 0`ï¼Œè¿™è®©çº¿ç¨‹3æ²¡èƒ½å¤Ÿè·³å‡ºwaitçš„é­”çˆªã€‚ä¹‹åï¼Œçº¿ç¨‹1ã€çº¿ç¨‹2å¼€å¿ƒçš„è‡ªå·±èµ°äº†ï¼Œä¸¢ä¸‹çº¿ç¨‹3æ²‰ç¡è‡´æ­»ï¼Œæ²¡äººå†å»å”¤é†’å¥¹äº†......\n\n## æ”¹è¿›ç‰ˆ - æ›´ç¬¦åˆå¥—è·¯çš„\n\n```cpp\n#include<iostream>\n#include<thread>\n#include<mutex>\n#include<condition_variable>\nusing namespace std;\nmutex mtx;\ncondition_variable cv;\nint count = 1;\n\nvoid print_1()\n{\n    unique_lock<mutex> locker(mtx);\n    while(count<= 100)\n    {\n        while(count%3 != 1)\n        {\n            cv.wait(locker);\n        }\n        if(count <= 100)\n        {\n            cout << count << endl;\n        }\n        ++count;\n        cv.notify_all();\n    }\n}\nvoid print_2()\n{\n    unique_lock<mutex> locker(mtx);\n    while(count<= 100)\n    {\n        while(count%3 != 2)\n        {\n            cv.wait(locker);\n        }\n        if(count <= 100)\n        {\n            cout << count << endl;\n        }\n        ++count;\n        cv.notify_all();\n    }\n}\nvoid print_3()\n{\n    unique_lock<mutex> locker(mtx);\n    while(count<= 100)\n    {\n        while(count%3 != 0)\n        {\n            cv.wait(locker);\n        }\n        if(count <= 100)\n        {\n            cout << count << endl;\n        }\n        ++count;\n        cv.notify_all();\n    }\n}\nint main()\n{\n    thread t1(print_1);\n    thread t2(print_2);\n    thread t3(print_3);\n    t1.join();\n    t2.join();\n    t3.join();\n}\n```\n\n# ä¸‰çº¿ç¨‹å¾ªç¯æ‰“å°è‹¥å¹²æ¬¡ABC\n\nå¦‚æœä¸åŠ ä»»ä½•æ§åˆ¶ï¼Œåˆ™ä»£ç å¦‚ä¸‹\n\n```cpp\n#include<iostream>\n#include<thread>\n#include<mutex>\n#include<condition_variable>\nusing namespace std;\nvoid print_a()\n{\n    for(int i = 0; i < 10; ++i)\n    {\n        cout << \"A\";\n    }\n}\nvoid print_b()\n{\n    for(int i = 0; i < 10; ++i)\n    {\n        cout << \"B\";\n    }\n}\nvoid print_c()\n{\n    for(int i = 0; i < 10; ++i)\n    {\n        cout << \"C\";\n    }\n}\nint main()\n{\n    thread t1(print_a);\n    thread t2(print_b);\n    thread t3(print_c);\n    t1.join();\n    t2.join();\n    t3.join();\n}\n```\n\nè¿™æ ·çš„æ‰“å°å°†ä¼šé”™ä¹±æ— ç« ã€‚\n\néœ€è¦åŠ çº¿ç¨‹æ§åˆ¶ã€‚\n\nä¸‹é¢æ¥è¯´ä¸€ç§æ–¹æ¡ˆ - **äº’æ–¥é‡+æ¡ä»¶å˜é‡+æ ‡è®°**\n\n```cpp\nstd::mutex mtx;\nstd::condition_variable cv;\nint isReady = 0;\t//æ ‡è®°è¯¥æ‰“å°ç¬¬å‡ ä¸ªå­—æ¯äº†\n```\n\n## å¸¸çŠ¯çš„é”™è¯¯\n\n### æ²¡æœ‰åˆå§‹åŒ–locker\n\nåº”åœ¨ä¸‰ä¸ªå‡½æ•°æœ€å¼€å§‹åˆå§‹åŒ–lockerã€‚\n\n```cpp\nmutex mtx;\nvoid print_a()\n{\n    unique_lock<mutex> locker(mtx);\t// must have\n    for(int i = 0; i<10; ++i)\n    {\n        ...\n    }\n}\nvoid print_b()\n{\n    unique_lock<mutex> locker(mtx);\t// must have\n    for(int i = 0; i<10; ++i)\n    {\n        ...\n    }\n}\nvoid print_c()\n{\n    unique_lock<mutex> locker(mtx);\t// must have\n    for(int i = 0; i<10; ++i)\n    {\n        ...\n    }\n}\n```\n\n### waitå¤–å›´çš„æ¡ä»¶å†™çš„æ˜¯ifè€Œä¸æ˜¯while\n\nä»¥`print_a`å‡½æ•°ä¸¾ä¾‹ã€‚\n\n```cpp\nif(isReady%3 != 0)\n{\n    cv.wait(locker);\n}\n```\n\nè¿™æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºä¸€å…±æœ‰ä¸‰ä¸ªçº¿ç¨‹ï¼Œæ¯æ¬¡å”¤é†’æ—¶ï¼Œå¦å¤–ä¸¤ä¸ªäººä¸ä¸€å®šè°èƒ½æŠ¢åˆ°é”ï¼Œå¦‚æœå”¤é†’åå°±ç›´æ¥é€€å‡ºwaitï¼Œåˆ™æ— æ³•ä¿è¯çº¿ç¨‹åŒæ­¥ã€‚\n\n## æœ€ç»ˆæ­£ç¡®çš„ä»£ç \n\n```cpp\n#include<iostream>\n#include<thread>\n#include<mutex>\n#include<condition_variable>\nusing namespace std;\nmutex mtx;\ncondition_variable cv;\nint isReady = 0;\n\nvoid print_a()\n{\n    unique_lock<mutex> locker(mtx);\n    for(int i = 0; i < 10; ++i)\n    {\n        while(isReady != 0)\n        {\n            cv.wait(locker);\n        }\n        cout << \"A\";\n        isReady = 1;\n        cv.notify_all();\n    }\n}\nvoid print_b()\n{\n    unique_lock<mutex> locker(mtx);\n    for(int i = 0; i < 10; ++i)\n    {\n        while(isReady != 1)\n        {\n            cv.wait(locker);\n        }\n        cout << \"B\";\n        isReady = 2;\n        cv.notify_all();\n    }\n}\nvoid print_c()\n{\n    unique_lock<mutex> locker(mtx);\n    for(int i = 0; i < 10; ++i)\n    {\n        while(isReady != 2)\n        {\n            cv.wait(locker);\n        }\n        cout << \"C\";\n        isReady = 0;\n        cv.notify_all();\n    }\n}\nint main()\n{\n    thread t1(print_a);\n    thread t2(print_b);\n    thread t3(print_c);\n    t1.join();\n    t2.join();\n    t3.join();\n}\n```\n\nå¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå®¹æ˜“å‡ºé”™çš„åœ°æ–¹ï¼Œå¿…é¡»`notify_all()`ï¼Œè€Œä¸èƒ½`notify_one()`ã€‚å› ä¸ºå¦‚æœåªå”¤é†’1ä¸ªçš„è¯ï¼Œæœ‰å¯èƒ½æ˜¯Aæ‰“å°å®Œä¹‹åå”¤é†’Cï¼Œè¿™æ ·Cçº¿ç¨‹ä¸ç¬¦åˆæ¡ä»¶ï¼Œç»§ç»­æ²‰ç¡ï¼Œè€ŒBçº¿ç¨‹å†ä¹Ÿæ²¡äººå”¤é†’å®ƒäº†ï¼Œä¹‹åä¸‰äººå°±éƒ½æ²‰ç¡ä¸‹å»äº†ã€‚\n\n# æ‰“å°å¥‡å¶æ•°è¿›é˜¶ç‰ˆ\n\nç°æœ‰å‡½æ•°`printNumber`å¯ä»¥ç”¨ä¸€ä¸ªæ•´æ•°å‚æ•°è°ƒç”¨ï¼Œå¹¶è¾“å‡ºè¯¥æ•´æ•°åˆ°æ§åˆ¶å°ã€‚\nä¾‹å¦‚ï¼Œè°ƒç”¨`printNumber(7)`å°†ä¼šè¾“å‡º`7`åˆ°æ§åˆ¶å°ã€‚\n\nç»™ä½ ç±»`ZeroEvenOdd`çš„ä¸€ä¸ªå®ä¾‹ï¼Œè¯¥ç±»ä¸­æœ‰ä¸‰ä¸ªå‡½æ•°ï¼š`zero`ã€`even`å’Œ`odd`ã€‚`ZeroEvenOdd`çš„ç›¸åŒå®ä¾‹å°†ä¼šä¼ é€’ç»™ä¸‰ä¸ªä¸åŒçº¿ç¨‹ï¼š\n\nçº¿ç¨‹`A`ï¼šè°ƒç”¨`zero()`ï¼Œåªè¾“å‡º`0`\nçº¿ç¨‹`B`ï¼šè°ƒç”¨`even()`ï¼Œåªè¾“å‡ºå¶æ•°\nçº¿ç¨‹`C`ï¼šè°ƒç”¨`odd()`ï¼Œåªè¾“å‡ºå¥‡æ•°\nä¿®æ”¹ç»™å‡ºçš„ç±»ï¼Œä»¥è¾“å‡ºåºåˆ—`010203040506070809010011012...`ï¼Œå…¶ä¸­æ€»å…±æ‰“å°çš„æ•°å­—æ•°ç›®å¿…é¡»ä¸º`2n`ã€‚\n\nå®ç°`ZeroEvenOdd`ç±»ï¼š\n\n`ZeroEvenOdd(int n)`ç”¨æ•°å­—`n`åˆå§‹åŒ–å¯¹è±¡ï¼Œè¡¨ç¤ºéœ€è¦è¾“å‡ºçš„æ•°ã€‚\n`void zero(printNumber)`è°ƒç”¨`printNumber`ä»¥è¾“å‡ºä¸€ä¸ª`0`ã€‚\n`void even(printNumber)`è°ƒç”¨`printNumber`ä»¥è¾“å‡ºå¶æ•°ã€‚\n`void odd(printNumber)`è°ƒç”¨`printNumber`ä»¥è¾“å‡ºå¥‡æ•°ã€‚\n\nç¤ºä¾‹1ï¼š\n```\nè¾“å…¥ï¼šn = 2\nè¾“å‡ºï¼š\"0102\"\nè§£é‡Šï¼šä¸‰æ¡çº¿ç¨‹å¼‚æ­¥æ‰§è¡Œï¼Œå…¶ä¸­ä¸€ä¸ªè°ƒç”¨ zero()ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ even()ï¼Œæœ€åä¸€ä¸ªçº¿ç¨‹è°ƒç”¨odd()ã€‚æ­£ç¡®çš„è¾“å‡ºä¸º \"0102\"ã€‚\n```\n\nç¤ºä¾‹ 2ï¼š\n```\nè¾“å…¥ï¼šn = 5\nè¾“å‡ºï¼š\"0102030405\"\n```\n\næç¤ºï¼š`1 <= n <= 1000`\n\n## Leet-code ACç‰ˆä»£ç \n\n```cpp\nclass ZeroEvenOdd {\nprivate:\n    int n;\n    mutex mtx;\n    condition_variable cv;\n    int num = 1;\n    bool flag = true;\npublic:\n    ZeroEvenOdd(int n) {\n        this->n = n;\n    }\n\n    // printNumber(x) outputs \"x\", where x is an integer.\n    void zero(function<void(int)> printNumber)\n    {\n        unique_lock<mutex> locker(mtx);\n        while(num <= n)\n        {\n            while(flag != true)\n            {\n                cv.wait(locker);\n            }\n            if(num <= n)\n            {\n                printNumber(0);\n            }\n            flag = false;\n            cv.notify_all();\n        }\n    }\n    // å¶æ•°\n    void even(function<void(int)> printNumber)\n    {\n        unique_lock<mutex> locker(mtx);\n        while(num <= n)\n        {\n            while(flag == true || num%2 != 0)\n            {\n                cv.wait(locker);\n            }\n            if(num <= n)\n            {\n                printNumber(num);\n            }\n            ++num;\n            flag = true;\n            cv.notify_all();\n        }\n    }\n    // å¥‡æ•°\n    void odd(function<void(int)> printNumber)\n    {\n        unique_lock<mutex> locker(mtx);\n        while(num <= n)\n        {\n            while(flag == true || num%2 != 1)\n            {\n                cv.wait(locker);\n            }\n            if(num <= n)\n            {\n                printNumber(num);\n            }\n            ++num;\n            flag = true;\n            cv.notify_all();\n        }\n    }\n};\n```\n\n## è‡ªæµ‹è¯•ç‰ˆä»£ç \n\n```cpp\n#include<thread>\n#include<mutex>\n#include<condition_variable>\n#include<functional>\n#include<iostream>\nusing namespace std;\nint n = 100;\nmutex mtx;\ncondition_variable cv;\nint num = 1;\nbool flag = true;\n\nvoid zero()\n{\n    unique_lock<mutex> locker(mtx);\n    while (num <= n)\n    {\n        while (flag != true)\n        {\n            cv.wait(locker);\n        }\n        if (num <= n)\n        {\n            cout << 0;\n        }\n        flag = false;\n        cv.notify_all();\n    }\n}\n// å¶æ•°\nvoid even()\n{\n    unique_lock<mutex> locker(mtx);\n    while (num <= n)\n    {\n        while (flag == true || num % 2 != 0)\n        {\n            cv.wait(locker);\n        }\n        if (num <= n)\n        {\n            cout << num;\n        }\n        ++num;\n        flag = true;\n        cv.notify_all();\n    }\n}\n// å¥‡æ•°\nvoid odd()\n{\n    unique_lock<mutex> locker(mtx);\n    while (num <= n)\n    {\n        while (flag == true || num % 2 != 1)\n        {\n            cv.wait(locker);\n        }\n        if (num <= n)\n        {\n            cout << num;\n        }\n        ++num;\n        flag = true;\n        cv.notify_all();\n    }\n}\nint main()\n{\n    thread t0(zero);\n    thread t1(odd);\n    thread t2(even);\n\n    t0.join();\n    t1.join();\n    t2.join();\n}\n```\n\nç»“æœ\n\n![image-20220525193318608](../../images/å¤šçº¿ç¨‹ç»ƒä¹ /image-20220525193318608.png)\n\n","categories":["æ“ä½œç³»ç»Ÿ","å¤šçº¿ç¨‹","Cpp","Modern","ç»ƒä¹ "]},{"title":"Linux_Cè¿æ¥æ•°æ®åº“","url":"/æ•°æ®åº“/MySQL_Linuxä¸‹Cè¿æ¥æ•°æ®åº“/","content":"\n# å†…å®¹\n\n1. C/C++è¿æ¥æ•°æ®åº“ -- C/Sç»“æ„é€šå¼\n2. åŸºæœ¬sqlè¯­å¥\n3. è§†å›¾ã€ç´¢å¼•ã€äº‹åŠ¡\n\n# æ•°æ®åº“çš„æ„æˆ\n\n1. æ•°æ®æ–‡ä»¶--å­˜åœ¨ç£ç›˜ä¸Š\n2. æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ\n\n# åŸºæœ¬æ¨¡å¼\n\nåŸºæœ¬æ¨¡å¼å°±æ˜¯ç”¨å®¢æˆ·ç«¯è¿æ¥æ•°æ®åº“æœåŠ¡å™¨ï¼Œä½¿ç”¨TCPè¿æ¥ã€‚\n\n1. é¦–å…ˆè¦å¯åŠ¨æ•°æ®åº“æœåŠ¡ï¼Œå³å…ˆæŠŠTCPæœåŠ¡ç«¯è¿è¡Œèµ·æ¥\n2. é€šè¿‡å®¢æˆ·ç«¯è¿æ¥æ•°æ®åº“\n\n\n\n# ç›¸å…³å‘½ä»¤\n\n## linuxå‘½ä»¤\n\n```bash\nservice mysql status \t# æŸ¥çœ‹çŠ¶æ€\nnetstat -natp\t\t\t# æŸ¥çœ‹ç«¯å£çŠ¶æ€ï¼ˆçœ‹æ˜¯å¦æœ‰3306å³å¯çŸ¥mysqlæœåŠ¡æ˜¯å¦å¯åŠ¨ï¼‰\nservice mysql restart\nservice mysql stop\nservice mysql start\n\n\n```\n\nè¿æ¥æ•°æ®åº“å‘½ä»¤\n\n```bash\nmysql -uroot -p\nmysql -uç”¨æˆ·å -hä¸»æœºåœ°å€(çœç•¥ä»£è¡¨æœ¬æœº) -på¯†ç (æœ€å¥½ä¸è¦åœ¨æ­¤æ˜æ–‡å†™å‡º)\n```\n\n## mysqlå‘½ä»¤\n\n```sql\nselect user,host,plugin from mysql.user;\nALTER user 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY\n'123'; #æ³¨å†Œç”¨æœ¬åœ°ç™»å½•æ–¹å¼çš„rootç”¨æˆ·ï¼Œå¹¶ä¸”è®¾ç½®å¯†ç \n```\n\n### åˆ›å»ºæ•°æ®åº“\n\n```sql\ncreate database xcg charset=utf8;\nselect database();\ndrop database xcg;\t#åˆ é™¤\n```\n\n### åˆ›å»ºæ•°æ®è¡¨\n\n```sql\n```\n\n### ç”¨æˆ·ç®¡ç†ä¸æˆæƒ\n\n* æŸ¥çœ‹å·²æ³¨å†Œç”¨æˆ·ä¿¡æ¯\n\nç›¸åŒåå­—çš„userå¯èƒ½æœ‰ä¸åŒçš„ç™»é™†æ–¹å¼ï¼Œè¿™è¢«è®¤ä¸ºæ˜¯ä¸¤ä¸ªä¸åŒçš„ç”¨æˆ·ï¼Œä»¥hostå­—æ®µåŒºåˆ†ï¼Œæœ‰ä¸¤ç§hostï¼Œä¸€ç§æ˜¯%ï¼Œä¸€ç§æ˜¯localhostã€‚%æ˜¯è¿œç¨‹ç™»å½•ï¼Œlocalhostæ˜¯æœ¬åœ°ç™»å½•ã€‚\n\n```mysql\nselect user, host, plugin from mysql.user;\n```\n\n![image-20220319085241427](../../images/æ•°æ®åº“/image-20220319085241427.png)\n\n* åˆ›å»ºç”¨æˆ·\n\n```mysql\n#åˆ›å»ºç”¨æˆ·ç¤ºä¾‹\ncreate user 'stu'@'localhost' identified by '123';\n#åˆ›å»ºç”¨æˆ· å¹¶ æŒ‡å®šåŠ å¯†æ–¹å¼\ncreate user 'stu1'@'localhost' identified WITH mysql_native_password by '123';\n#åˆ›å»ºrootçš„è¿œç¨‹ç™»å½•ç”¨æˆ·\t'%'\ncreate user 'root'@'%' identified WITH mysql_native_password by '123';\n```\n\n# è¿œç¨‹ç™»å½•\n\næ¡ä»¶æœ‰äºŒ\n\n1. æœ‰è¿œç¨‹ç™»é™†æ–¹å¼çš„ç”¨æˆ·ä»¥åŠè®¾ç½®äº†å¯†ç \n2. é…ç½®æ–‡ä»¶ä¸­è¦è®¾ç½®å¯ä»¥è¿œç¨‹ç™»é™†\n\né…ç½®æ–‡ä»¶ä½ç½®åœ¨å¦‚ä¸‹ä½ç½®ï¼Œéœ€è¦ä¿®æ”¹å¯ä»¥ç”¨viæ‰“å¼€ã€‚æ³¨æ„ï¼Œä¿®æ”¹å‰éœ€è¦åˆ‡æ¢ä¸ºç®¡ç†å‘˜æ¨¡å¼ã€‚\n\n```bash\nvi /etc/mysql/mysql.conf.d/mysqld.cnf\n```\n\nä¿®æ”¹å®Œåï¼Œéœ€è¦é‡å¯mysqlæœåŠ¡å™¨\n\n```bash\nservice mysql restart\n```\n\n# Cè¯­è¨€è®¿é—®mysql\n\n1. è¿æ¥æ•°æ®åº“ä½¿ç”¨çš„å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶\n\n   ```c\n   #include<mysql/mysql.h>\t//æœ‰çš„æ˜¯#include<mysql.h>\n   ```\n\n   æ³¨æ„ï¼Œç¨‹åºä¸­ä½¿ç”¨äº†è®¿é—®mysqlçš„æœ‰å…³å‡½æ•°æ¥å£ï¼Œéœ€è¦åœ¨ä»£ç é“¾æ¥æ—¶æŒ‡å®šåº“å: -lmysqlclient\n\n2. åˆå§‹åŒ–è¿æ¥å¥æŸ„\n\n   ```c\n   MYSQL *mysql_init(MYSQL *mysql);\n   ```\n\n3. è¿æ¥æ•°æ®åº“\n\n   ```c\n   MYSQL *mysql_real_connect(MYSQL *mysql, const char* host,\n                             const char* user, const char* passwd\n                             const char* db,\tunsigned int port\n                             const char* unix_socket,\n                             unsigned long clientflag);\n   ```\n\n   \n\n## è¯»\n\n1. æŒ‡å®šselectè¯­å¥\n\n   ```c\n   char * sql = \"select * from student\";\n   if(n != 0)\n   {\n       mysql_close(mysql);\n       exit(1);\n   }\n   ```\n\n2. è·å–ç»“æœé›†\n\n   ```c\n   MYSQL_RES * res = mysql_store_result(mysql);\n   if(res == NULL)\n   {\n       mysql_close(mysql);\n       exit(1);\n   }\n   ```\n\n3. è·å–ç»“æœé›†çš„è¡Œæ•°ã€åˆ—æ•°\n\n   ```c\n   int num = mysql_num_rows(res);\n   int count = mysql_field_count(mysql);\n   ```\n\n4. éå†\n\n   ```c\n   for(int i = 0; i<num; ++i)\n   {\n       MYSQL_ROW row = mysql_fetch_row(res);\n       for(int j = 0; j<count; ++j)\n       {\n           printf(\"%s\\t\",row[j]);\n       }\n       printf(\"\\n\");\n   }\n   ```\n\n5. æ”¶å°¾å·¥ä½œ\n\n   ```c\n   mysql_free_result(res);\n   mysql_close(mysql);\n   exit(0);\n   ```\n\n   \n\n# è§†å›¾\n\n# äº‹åŠ¡\n\n# ç´¢å¼•\n\nåˆ›å»ºç´¢å¼•\n\n```mysql\ncreate index t_index on test_index(title(20));\n```\n\n","categories":["Linux","æ•°æ®åº“","MySQL"]},{"title":"ç½‘ç»œ_æ•°æ®é“¾è·¯å±‚","url":"/ç½‘ç»œ/ç½‘ç»œ_æ•°æ®é“¾è·¯å±‚/","content":"\n# æ•°æ®é“¾è·¯å±‚\n\nä¼ è¾“å•ä½ï¼šå¸§\n\n1. ç‚¹å¯¹ç‚¹ä¿¡é“å’Œå¹¿æ’­ä¿¡é“çš„ç‰¹ç‚¹ï¼ŒåŠä¸¤ç§ä¿¡é“æ‰€ä½¿ç”¨çš„åè®®çš„ç‰¹ç‚¹(PPPå’ŒCSMA/DA)\n2. ä¸‰ä¸ªåŸºæœ¬é—®é¢˜ï¼š\n   1. å°è£…æˆå¸§\n   2. é€æ˜ä¼ è¾“\n   3. å·®é”™æ£€æµ‹\n3. ä»¥å¤ªç½‘MACå±‚çš„ç¡¬ä»¶åœ°å€\n4. é€‚é…å™¨ã€è½¬å‘å™¨ã€é›†çº¿å™¨ã€ç½‘æ¡¥ã€ä»¥å¤ªç½‘äº¤æ¢æœºçš„ä½œç”¨ä»¥åŠä½¿ç”¨åœºåˆ\n\n# ç‚¹å¯¹ç‚¹ä¿¡é“\n\nç‚¹å¯¹ç‚¹ä¿¡é“çš„æ•°æ®é“¾è·¯å±‚çš„åè®®æ•°æ®å•å…ƒâ€”â€”å¸§ã€‚\n\nç‚¹å¯¹ç‚¹ä¿¡é“çš„æ•°æ®é“¾è·¯å±‚åœ¨è¿›è¡Œé€šä¿¡æ—¶çš„ä¸»è¦æ­¥éª¤å¦‚ä¸‹ï¼š\n\n1. èŠ‚ç‚¹Açš„æ•°æ®é“¾è·¯å±‚æŠŠç½‘ç»œå±‚äº¤ä¸‹æ¥çš„IPæ•°æ®æŠ¥æ·»åŠ é¦–éƒ¨å’Œå°¾éƒ¨å°è£…æˆå¸§ã€‚\n2. èŠ‚ç‚¹AæŠŠå°è£…å¥½çš„å¸§å‘é€ç»™èŠ‚ç‚¹Bçš„æ•°æ®é“¾è·¯å±‚ã€‚\n3. è‹¥èŠ‚ç‚¹Bçš„æ•°æ®é“¾è·¯å±‚æ”¶åˆ°çš„å¸§æ— å·®é”™ï¼Œåˆ™ä»æ”¶åˆ°çš„å¸§ä¸­æå–å‡ºIPæ•°æ®æŠ¥äº¤ç»™ä¸Šé¢çš„ç½‘ç»œå±‚ï¼›å¦åˆ™ä¸¢å¼ƒè¿™ä¸ªå¸§ã€‚\n\n# æˆå¸§\n\nä»€ä¹ˆæ˜¯æˆå¸§ï¼Ÿ\n\nå°è£…æˆå¸§(framing)å°±æ˜¯**å‘é€æ–¹åœ¨ä¸€æ®µæ•°æ®çš„å‰ååˆ†åˆ«æ·»åŠ é¦–éƒ¨å’Œå°¾éƒ¨**ï¼Œè¿™æ ·å°±æ„æˆäº†ä¸€ä¸ªå¸§ã€‚**æ¥æ”¶ç«¯åœ¨æ”¶åˆ°ç‰©ç†å±‚ä¸Šäº¤çš„æ¯”ç‰¹æµåï¼Œå°±èƒ½æ ¹æ®é¦–éƒ¨å’Œå°¾éƒ¨çš„æ ‡è®°ï¼Œä»æ”¶åˆ°çš„æ¯”ç‰¹æµä¸­è¯†åˆ«å¸§çš„å¼€å§‹å’Œç»“æŸ**ã€‚\n\næˆ‘ä»¬çŸ¥é“ï¼Œåˆ†ç»„äº¤æ¢çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µå°±æ˜¯ï¼šæ‰€æœ‰åœ¨äº’è”ç½‘ä¸Šä¼ é€çš„æ•°æ®éƒ½ä»¥åˆ†ç»„ï¼ˆå³IP æ•°æ®æŠ¥ï¼‰ä¸ºä¼ é€å•ä½ã€‚ç½‘ç»œå±‚çš„IPæ•°æ®æŠ¥ä¼ é€åˆ°æ•°æ®é“¾è·¯å±‚å°±æˆä¸ºå¸§çš„æ•°æ®éƒ¨åˆ†ã€‚åœ¨å¸§çš„æ•°æ®éƒ¨åˆ†çš„å‰é¢å’Œåé¢åˆ†åˆ«æ·»åŠ ä¸Šé¦–éƒ¨å’Œå°¾éƒ¨ï¼Œæ„æˆäº†ä¸€ä¸ªå®Œæ•´çš„å¸§ã€‚è¿™æ ·çš„å¸§å°±æ˜¯æ•°æ®é“¾è·¯å±‚çš„æ•°æ®ä¼ é€å•å…ƒã€‚\n\n## å¸§å®šç•Œ\n\nå¸§å®šç•Œæ˜¯ï¼šç”¨äºåˆ¤æ–­å¸§çš„è¾¹ç•Œï¼Œä»å“ªå¼€å§‹åˆ°å“ªç»“æŸã€‚è¦ç”¨ç‰¹æ®Šçš„å­—ç¬¦ä¸²è¡¨ç¤ºå®ƒçš„å¼€å§‹å’Œç‰¹æ®Šçš„å­—ç¬¦ä¸²è¡¨ç¤ºç»“æŸã€‚\n\nä¸€ä¸ªå¸§çš„å¸§é•¿ç­‰äºå¸§çš„æ•°æ®éƒ¨åˆ†é•¿åº¦åŠ ä¸Šå¸§é¦–éƒ¨å’Œå¸§å°¾éƒ¨çš„é•¿åº¦ã€‚é¦–éƒ¨å’Œå°¾éƒ¨çš„ä¸€ä¸ªé‡è¦ä½œç”¨å°±æ˜¯è¿›è¡Œ**å¸§å®šç•Œ**ï¼ˆå³ç¡®å®šå¸§çš„ç•Œé™ï¼‰ã€‚æ­¤å¤–ï¼Œé¦–éƒ¨å’Œå°¾éƒ¨è¿˜åŒ…æ‹¬è®¸å¤šå¿…è¦çš„æ§åˆ¶ä¿¡æ¯ã€‚åœ¨å‘é€å¸§æ—¶ï¼Œæ˜¯ä»å¸§é¦–éƒ¨å¼€å§‹å‘é€çš„ã€‚å„ç§æ•°æ®é“¾è·¯å±‚åè®®éƒ½å¯¹å¸§é¦–éƒ¨å’Œå¸§å°¾éƒ¨çš„æ ¼å¼æœ‰æ˜ç¡®çš„è§„å®šã€‚æ˜¾ç„¶ï¼Œä¸ºäº†æé«˜å¸§çš„ä¼ è¾“æ•ˆç‡ï¼Œåº”å½“ä½¿å¸§çš„æ•°æ®éƒ¨åˆ†é•¿åº¦å°½å¯èƒ½åœ°å¤§äºé¦–éƒ¨å’Œå°¾éƒ¨çš„é•¿åº¦ã€‚ä½†æ˜¯ï¼Œæ¯ä¸€ç§**é“¾è·¯å±‚åè®®éƒ½è§„å®šäº†æ‰€èƒ½ä¼ é€çš„å¸§çš„æ•°æ®éƒ¨åˆ†é•¿åº¦ä¸Šé™**â€”â€”**æœ€å¤§ä¼ é€å•å…ƒMTU**(Maximum Transfer Unit)ã€‚ç»™å‡ºäº†å¸§çš„é¦–éƒ¨å’Œå°¾éƒ¨çš„ä½ç½®ï¼Œä»¥åŠå¸§çš„æ•°æ®éƒ¨åˆ†ä¸MTUçš„å…³ç³»ã€‚\n\n* å¸§å®šç•Œçš„å‡ ç§æ–¹æ³•\n  * å­—ç¬¦å¡«å……çš„é¦–å°¾ç•Œç¬¦æ³•\n  * æ¯”ç‰¹ä½å¡«å……çš„é¦–ä½ç•Œç¬¦æ³•\n  * å­—ç¬¦è®¡æ•°æ³•\n\nå½“æ•°æ®åœ¨ä¼ è¾“ä¸­å‡ºç°å·®é”™æ—¶ï¼Œå¸§å®šç•Œç¬¦çš„ä½œç”¨æ›´åŠ æ˜æ˜¾ã€‚å‡å®šå‘é€ç«¯åœ¨å°šæœªå‘é€å®Œä¸€ä¸ªå¸§æ—¶çªç„¶å‡ºæ•…éšœï¼Œä¸­æ–­äº†å‘é€ã€‚ä½†éšåå¾ˆå¿«åˆæ¢å¤æ­£å¸¸ï¼Œäºæ˜¯é‡æ–°ä»å¤´å¼€å§‹å‘é€åˆšæ‰æœªå‘é€å®Œçš„å¸§ã€‚ç”±äºä½¿ç”¨äº†å¸§å®šç•Œç¬¦ï¼Œæ¥æ”¶ç«¯å°±çŸ¥é“å‰é¢æ”¶åˆ°çš„æ•°æ®æ˜¯ä¸ªä¸å®Œæ•´çš„å¸§ï¼ˆåªæœ‰é¦–éƒ¨å¼€å§‹ç¬¦SOHè€Œæ²¡æœ‰ä¼ è¾“ç»“æŸç¬¦EOTï¼‰ï¼Œå¿…é¡»ä¸¢å¼ƒã€‚è€Œåé¢æ”¶åˆ°çš„æ•°æ®æœ‰æ˜ç¡®çš„å¸§å®šç•Œç¬¦ï¼ˆSOHå’ŒEOTï¼‰ï¼Œå› æ­¤è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„å¸§ï¼Œåº”å½“æ”¶ä¸‹ã€‚\n\n## é€æ˜ä¼ è¾“\n\næ•°æ®éƒ¨åˆ†å¦‚æœå‡ºç°å’Œå¤´å’Œå°¾ä¸€æ ·çš„ç‰¹æ®Šçš„å­—ç¬¦ä¸²æˆ–ä½ä¸²çš„å†…å®¹ï¼Œä¼šå¹²æ‰°æ¥æ”¶æ–¹çš„å®šç•Œã€‚\n\nå½“ä¼ é€çš„å¸§æ˜¯ç”¨æ–‡æœ¬æ–‡ä»¶ç»„æˆçš„å¸§æ—¶ï¼ˆæ–‡æœ¬æ–‡ä»¶ä¸­çš„å­—ç¬¦éƒ½æ˜¯ä»é”®ç›˜ä¸Šè¾“å…¥çš„ï¼‰ï¼Œå…¶æ•°æ®éƒ¨åˆ†æ˜¾ç„¶ä¸ä¼šå‡ºç°åƒSOHæˆ–EOTè¿™æ ·çš„å¸§å®šç•Œæ§åˆ¶å­—ç¬¦ã€‚**å¯è§ä¸ç®¡ä»é”®ç›˜ä¸Šè¾“å…¥ä»€ä¹ˆå­—ç¬¦éƒ½å¯ä»¥æ”¾åœ¨è¿™æ ·çš„å¸§ä¸­ä¼ è¾“è¿‡å»ï¼Œå› æ­¤è¿™æ ·çš„ä¼ è¾“å°±æ˜¯é€æ˜ä¼ è¾“**ã€‚\n\nä½†å½“æ•°æ®éƒ¨åˆ†æ˜¯éASCIIç çš„æ–‡æœ¬æ–‡ä»¶æ—¶ï¼ˆå¦‚äºŒè¿›åˆ¶ä»£ç çš„è®¡ç®—æœºç¨‹åºæˆ–å›¾åƒç­‰ï¼‰ï¼Œæƒ…å†µå°±ä¸åŒäº†ã€‚å¦‚æœæ•°æ®ä¸­çš„æŸä¸ªå­—èŠ‚çš„äºŒè¿›åˆ¶ä»£ç æ°å¥½å’ŒSOHæˆ–EOTè¿™ç§æ§åˆ¶å­—ç¬¦ä¸€æ ·ï¼ˆå¦‚å›¾3-6æ‰€ç¤ºï¼‰ï¼Œæ•°æ®é“¾è·¯å±‚å°±ä¼šé”™è¯¯åœ°â€œæ‰¾åˆ°å¸§çš„è¾¹ç•Œâ€ï¼ŒæŠŠéƒ¨åˆ†å¸§æ”¶ä¸‹ï¼ˆè¯¯è®¤ä¸ºæ˜¯ä¸ªå®Œæ•´çš„å¸§ï¼‰ï¼Œè€ŒæŠŠå‰©ä¸‹çš„é‚£éƒ¨åˆ†æ•°æ®ä¸¢å¼ƒï¼ˆè¿™éƒ¨åˆ†æ‰¾ä¸åˆ°å¸§å®šç•Œæ§åˆ¶å­—ç¬¦SOHï¼‰ã€‚è¿™æ ·çš„å¸§ä¼ è¾“ä¸æ˜¯é€æ˜ä¼ è¾“ã€‚\n\n![image-20220309194235539](../../images/ç½‘ç»œ_æ•°æ®é“¾è·¯å±‚/image-20220309194235539.png)\n\n* ç†è§£é€æ˜ä¼ è¾“\n  * â€œé€æ˜â€è¡¨ç¤ºï¼šæŸä¸€ä¸ªå®é™…å­˜åœ¨çš„äº‹ç‰©çœ‹èµ·æ¥å´å¥½åƒä¸å­˜åœ¨ä¸€æ ·ï¼ˆä¾‹å¦‚ï¼Œä½ çœ‹ä¸è§åœ¨ä½ å‰é¢æœ‰å—100%é€æ˜çš„ç»ç’ƒçš„å­˜åœ¨ï¼‰ã€‚\n  * â€œåœ¨æ•°æ®é“¾è·¯å±‚é€æ˜ä¼ é€æ•°æ®â€â€”â€”è¡¨ç¤ºæ— è®ºä»€ä¹ˆæ ·çš„æ¯”ç‰¹ç»„åˆçš„æ•°æ®ï¼Œéƒ½**èƒ½å¤ŸæŒ‰ç…§åŸæ ·æ²¡æœ‰å·®é”™åœ°é€šè¿‡**è¿™ä¸ªæ•°æ®é“¾è·¯å±‚ã€‚å› æ­¤ï¼Œå¯¹æ‰€ä¼ é€çš„æ•°æ®æ¥è¯´ï¼Œè¿™äº›æ•°æ®å°±â€œçœ‹ä¸è§â€æ•°æ®é“¾è·¯å±‚æœ‰ä»€ä¹ˆå¦¨ç¢æ•°æ®ä¼ è¾“çš„ä¸œè¥¿ã€‚æˆ–è€…è¯´ï¼Œæ•°æ®é“¾è·¯å±‚å¯¹è¿™äº›æ•°æ®æ¥è¯´æ˜¯é€æ˜çš„ã€‚\n\n* è§£å†³é€æ˜ä¼ è¾“é—®é¢˜\n  * å¿…é¡»è®¾æ³•ä½¿æ•°æ®ä¸­å¯èƒ½å‡ºç°çš„æ§åˆ¶å­—ç¬¦â€œSOHâ€å’Œâ€œEOTâ€åœ¨æ¥æ”¶ç«¯ä¸è¢«è§£é‡Šä¸ºæ§åˆ¶å­—ç¬¦ã€‚\n  * å…·ä½“çš„æ–¹æ³•æ˜¯ï¼šå‘é€ç«¯çš„æ•°æ®é“¾è·¯å±‚åœ¨**æ•°æ®ä¸­**å‡ºç°æ§åˆ¶å­—ç¬¦â€œSOHâ€æˆ–â€œEOTâ€çš„å‰é¢æ’å…¥ä¸€ä¸ªè½¬ä¹‰å­—ç¬¦â€œESCâ€(å…¶åå…­è¿›åˆ¶ç¼–ç æ˜¯1Bï¼ŒäºŒè¿›åˆ¶æ˜¯00011011)ã€‚\n  * åœ¨æ¥æ”¶ç«¯çš„æ•°æ®é“¾è·¯å±‚åœ¨æŠŠæ•°æ®é€å¾€ç½‘ç»œå±‚ä¹‹å‰åˆ é™¤è¿™ä¸ªæ’å…¥çš„è½¬ä¹‰å­—ç¬¦ã€‚\n  * å¦‚æœè½¬ä¹‰å­—ç¬¦â€œESCâ€œä¹Ÿå‡ºç°åœ¨æ•°æ®å½“ä¸­ï¼Œé‚£ä¹ˆè§£å†³æ–¹æ³•ä»ç„¶æ˜¯åœ¨è½¬ä¹‰å­—ç¬¦çš„å‰é¢æ’å…¥ä¸€ä¸ªè½¬ä¹‰å­—ç¬¦ã€‚å› æ­¤ï¼Œå½“æ¥æ”¶ç«¯æ”¶åˆ°è¿ç»­çš„ä¸¤ä¸ªè½¬ä¹‰å­—ç¬¦æ—¶ï¼Œå°±åˆ é™¤å…¶ä¸­å‰é¢çš„ä¸€ä¸ªã€‚\n  * è¿™ç§æ–¹æ³•ç§°ä¸ºå­—èŠ‚å¡«å……(byte stuffing)æˆ–å­—ç¬¦å¡«å……(character stuffing)ã€‚\n    ![image-20220309195841138](../../images/ç½‘ç»œ_æ•°æ®é“¾è·¯å±‚/image-20220309195841138.png)\n\n## å·®é”™æ§åˆ¶ï¼šå¾ªç¯å†—ä½™æ ¡éªŒç è®¡ç®—\n\nè¢«é™¤æ•°æ˜¯è°ï¼Ÿâ€”â€”åŸå§‹æ•°æ®+åé¢è¡¥è‹¥å¹²ä¸ªé›¶ï¼ˆç”Ÿæˆå¤šé¡¹å¼çš„æœ€é«˜æ¬¡å¹‚ï¼‰ã€‚\n\né™¤æ•°æ˜¯è°ï¼Ÿâ€”â€”ç”Ÿæˆå¤šé¡¹å¼å¯¹åº”çš„äºŒè¿›åˆ¶åºåˆ—ã€‚\n\nå•†å’Œä½™æ•°è°æ˜¯å†—ä½™ç ï¼Ÿâ€”â€”ä½™æ•°ã€‚ä½™æ•°ä½æ•°ä¸å¤Ÿæ—¶è¦åœ¨å‰é¢è¡¥é›¶ï¼ˆæœ€åæ€»ä½æ•°ä¸ºç”Ÿæˆå¤šé¡¹å¼çš„æœ€é«˜æ¬¡å¹‚ï¼‰\n\nP77 ç®€ç­”é¢˜ 6 7 8\n\n## çº é”™æœºåˆ¶-åé¦ˆé‡å‘æœºåˆ¶[ä¼ è¾“å±‚]\n\n* åº”å½“æ˜ç¡®ï¼Œâ€œæ— æ¯”ç‰¹å·®é”™â€ä¸â€œæ— ä¼ è¾“å·®é”™â€æ˜¯ä¸åŒçš„æ¦‚å¿µã€‚\n  * åœ¨æ•°æ®é“¾è·¯å±‚ä½¿ç”¨ CRC æ£€éªŒï¼Œèƒ½å¤Ÿå®ç°æ— æ¯”ç‰¹å·®é”™çš„ä¼ è¾“ï¼Œä½†è¿™è¿˜ä¸æ˜¯å¯é ä¼ è¾“ã€‚\n  * è¦åšåˆ°â€œæ— å·®é”™ä¼ è¾“â€ï¼ˆå³å‘é€ä»€ä¹ˆå°±æ”¶åˆ°ä»€ä¹ˆï¼‰å°±å¿…é¡»å†åŠ ä¸Šç¡®è®¤å’Œé‡ä¼ æœºåˆ¶ã€‚ \n  * æœ¬ç« ä»‹ç»çš„æ•°æ®é“¾è·¯å±‚åè®®éƒ½ä¸æ˜¯å¯é ä¼ è¾“çš„åè®®ã€‚\n  * **å¾ªç¯å†—ä½™æ ¡éªŒç åªæ˜¯åœ¨æ•°æ®é“¾è·¯å±‚ä¿è¯å¸§çš„æ¯”ç‰¹ä½ä¸å‡ºé”™**ï¼Œå³**æ— æ¯”ç‰¹å·®é”™**ã€‚ä½†æ˜¯å¤æ‚çš„æƒ…å†µå¦‚å¸§ä¸¢å¤±ã€å¸§é‡å¤ã€å¸§å¤±åºè¿™äº›å¤æ‚é”™è¯¯æƒ…å†µå°±éœ€è¦æ›´é«˜å±‚çš„åè®®æ¥çº é”™ã€‚è¿™é‡Œè®¨è®ºçš„åé¦ˆé‡å‘æœºåˆ¶æ˜¯**ä¼ è¾“å±‚çš„å¯é ä¼ è¾“çš„å·¥ä½œåŸç†**ã€‚\n\næ ¹æ®ä¸Šè¿°ï¼Œç”±äºæ£€é”™ç ä¸èƒ½è‡ªåŠ¨çº æ­£æ‰€å‘ç°å¸§ä¹±åºçš„é”™è¯¯ï¼Œæ‰€ä»¥å½“æ¥æ”¶æ–¹å‘ç°é”™è¯¯æ—¶ï¼Œè¦ç»™å‘é€æ–¹åé¦ˆä¿¡æ¯è¦æ±‚é‡å‘ã€‚\n\nåˆå«**è‡ªåŠ¨è¯·æ±‚é‡ä¼ ARQ**(Automatic Repeat-reQuest)ï¼Œé‡ä¼ çš„è¯·æ±‚æ˜¯è‡ªåŠ¨è¿›è¡Œçš„ï¼Œæ¥æ”¶æ–¹ä¸éœ€è¦è¯·æ±‚å‘é€æ–¹é‡ä¼ æŸä¸ªå‡ºé”™çš„å¸§ã€‚\n\n1. åœæ­¢-ç­‰å¾…æ–¹å¼\n2. è¿ç»­å·¥ä½œæ–¹å¼ï¼ˆè¿ç»­ARQåè®®ï¼‰\n   1. æ‹‰å›æ–¹å¼\n   2. é€‰æ‹©æ€§é‡å‘æ–¹å¼\n\n### åœæ­¢ç­‰å¾…åè®®\n\n* åŸºæœ¬æ€æƒ³\n  * å‘é€ç«¯åœ¨**å‘å‡ºä¸€å¸§åå¿…é¡»åœä¸‹æ¥ç­‰å¾…æ¥æ”¶ç«¯å¯¹æ‰€å‘é€çš„ç¡®è®¤å¸§**è¿›è¡Œç¡®è®¤ã€‚è‹¥ç¡®è®¤å¯¹æ–¹æ­£ç¡®æ”¶åˆ°ï¼Œåˆ™å‘é€æ–¹ç»§ç»­å‘é€ä¸‹ä¸€å¸§ï¼Œå¦åˆ™ï¼Œå‘é€æ–¹å°±é‡å‘è¯¥å¸§ã€‚\n\n* Aå‘Bå‘é€å¸§ï¼š\n  * BæˆåŠŸæ¥æ”¶åˆ°äº†ï¼Œä¸”æ£€æµ‹åæ­£å¸¸ï¼Œåˆ™å›ä¼ Aä¸€ä¸ªç¡®è®¤å¸§ï¼Œè¢«Aæ¥æ”¶åˆ°åï¼ŒAæ‰ç»§ç»­å‘é€ä¸‹ä¸€ä¸ªå¸§ã€‚\n  * Bæ¥æ”¶å¸§æ—¶**æ£€æµ‹å‡ºé”™è¯¯åˆ™ä¸¢å¼ƒè¯¥å¸§**ï¼ˆæˆ–è€…**å¸§åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸¢å¤±**ï¼‰ï¼ŒBä¸ä¼šå‘é€ä»»ä½•ä¿¡æ¯ã€‚åˆ™Aå¿…é¡»é‡å‘è¯¥å¸§ï¼Œç›´åˆ°BæˆåŠŸæ¥æ”¶ä¸ºæ­¢ã€‚\n    * Bç­‰ç¡®è®¤è¦ç­‰å¾…å¤šé•¿æ—¶é—´ï¼Ÿâ€”â€”Aè®¾ç½®äº†ä¸€ä¸ª**è¶…æ—¶è®¡æ—¶å™¨**ï¼Œå¦‚æœåˆ°æœŸä¹‹å‰æ”¶åˆ°äº†ç›¸åº”çš„ç¡®è®¤åˆ™é‡ç½®è¯¥è®¡æ—¶å™¨ï¼Œç»§ç»­å‘é€ä¸‹ä¸€ä¸ªå¸§ã€‚\n    * è‹¥å¸§æ­£ç¡®åˆ°è¾¾Bï¼Œä½†Bå›é€çš„ç¡®è®¤ä¸¢å¤±æˆ–å»¶è¿Ÿäº†ï¼Œ**Aæœªæ”¶åˆ°Bçš„ç¡®è®¤ï¼Œä¼šè¶…æ—¶é‡å‘è¯¥å¸§**ã€‚**Bå¯èƒ½ä¼šæ”¶åˆ°é‡å¤çš„å¸§**ã€‚Bå¦‚ä½•çŸ¥é“æ”¶åˆ°äº†é‡å¤çš„å¸§ï¼Œéœ€è¦ä¸¢å¼ƒå‘¢ï¼Ÿâ€”â€”**ç¼–å·**ã€‚\n      * Aä¸ºæ¯ä¸€ä¸ªå‘é€çš„å¸§éƒ½è¿›è¡Œç¼–å·ã€‚è‹¥Bæ”¶åˆ°äº†ç¼–å·ç›¸åŒçš„å¸§ï¼Œåˆ™Bè®¤ä¸ºæ”¶åˆ°äº†é‡å¤å¸§ï¼ŒBä¸¢å¼ƒé‡å¤çš„å¸§ï¼Œ**å¹¶ä¸”Bå›é€ç¡®è®¤**ã€‚\n      * Bä¸ºå‘é€çš„ç¡®è®¤ä¹Ÿè¿›è¡Œç¼–å·ï¼ŒæŒ‡ç¤ºè¯¥ç¡®è®¤æ˜¯å¯¹å“ªä¸€ä¸ªå¸§çš„ç¡®è®¤ã€‚Aæ ¹æ®ç¡®è®¤å¸§åŠå…¶ç¼–å·ï¼Œå¯ä»¥ç¡®å®šå®ƒæ˜¯å¯¹å“ªä¸€ä¸ªå¸§çš„ç¡®è®¤ï¼Œé¿å…é‡å¤å‘é€ï¼Œå¹¶ä¸”**Aå¯ä»¥æ ¹æ®æ­¤ç¡®è®¤å·ä¼ é€ä¸‹ä¸€ä¸ªå¸§**ã€‚è‹¥ä¸ºé‡å¤çš„ç¡®è®¤ï¼Œåˆ™å°†å…¶ä¸¢å¼ƒã€‚\n\n* ç¡®è®¤å¸§çš„ç¼–å·é—®é¢˜\n  * ç¡®è®¤å¸§ï¼ˆACKnowledgement, ACKï¼‰â€”â€”æ­£ç¡®æ¥æ”¶åå›ä¼ çš„å¸§è¢«ç§°ä¸ºç¡®è®¤å¸§ã€‚\n  * ä¹ æƒ¯å°†ç¡®è®¤åºå·nè¡¨ç¤ºä¸ºACKnï¼Œ**ACKnè¡¨ç¤ºâ€œç¬¬nâ€“1å·å¸§å·²ç»æ”¶åˆ°ï¼Œç°åœ¨æœŸæœ›æ¥æ”¶ç¬¬nå·å¸§â€**ã€‚\n* æ€§èƒ½åˆ†æ\n  * åœæ­¢ç­‰å¾…åè®®å®ç°ç®€å•ï¼Œä½†**ä¼ è¾“è·ç¦»è¿œæ—¶**ä¿¡é“åˆ©ç”¨ç‡ä½ã€‚\n* æ”¹è¿›\n  * é‡‡ç”¨**æµæ°´çº¿ä¼ è¾“**ï¼Œå°±æ˜¯å‘é€æ–¹å¯è¿ç»­å‘é€å¤šä¸ªå¸§ï¼Œä¸å¿…æ¯å‘å®Œä¸€ä¸ªå¸§å°±åœé¡¿ä¸‹æ¥ç­‰å¾…å¯¹æ–¹çš„ç¡®è®¤ã€‚è¿™æ ·å¯ä½¿ä¿¡é“ä¸Šä¸€ç›´æœ‰æ•°æ®ä¸é—´æ–­åœ°ä¼ é€ã€‚ä»è€Œæé«˜ä¿¡é“åˆ©ç”¨ç‡ã€‚**è¿™æ˜¯è¿ç»­ARQåè®®çš„åŸºæœ¬æ€æƒ³**ã€‚\n* ä¸ARQçš„å…³ç³»\n  * CRCæ£€éªŒå™¨èƒ½å¤Ÿè‡ªåŠ¨ä¸¢å¼ƒæ£€æµ‹åˆ°çš„å‡ºé”™å¸§ã€‚å®ç”¨çš„CRCæ£€éªŒå™¨éƒ½æ˜¯ç”¨ç¡¬ä»¶å®Œæˆçš„ã€‚å› æ­¤æ‰€è°“çš„â€œä¸¢å¼ƒå‡ºé”™å¸§â€ï¼Œå¯¹ä¸Šå±‚è½¯ä»¶æˆ–ç”¨æˆ·æ¥è¯´éƒ½æ˜¯æ„Ÿè§‰ä¸åˆ°çš„ã€‚\n  * å‘é€ç«¯å¯¹å‡ºé”™çš„æ•°æ®å¸§è¿›è¡Œé‡ä¼ æ˜¯è‡ªåŠ¨è¿›è¡Œçš„ï¼Œå› è€Œè¿™ç§**å·®é”™æ§åˆ¶æœºåˆ¶**å¸¸ç®€ç§°ä¸ºARQ(Automatic Repeat reQuest)ï¼Œç›´è¯‘æ˜¯è‡ªåŠ¨é‡ä¼ è¯·æ±‚ï¼Œä½†æ„æ€æ˜¯è‡ªåŠ¨è¯·æ±‚é‡ä¼ ã€‚å› æ­¤**åœç­‰åè®®ä¸­åŒ…å«ç€ARQåè®®**ï¼ˆæ˜¯ä¸€ç§å·®é”™æ§åˆ¶æœºåˆ¶ï¼‰\n\n### è¿ç»­ARQ\n\n* åŸºæœ¬æ€æƒ³\n  * å‘é€æ–¹åœ¨å‘é€ä¸€ä¸ªå¸§åï¼Œ**ä¸åœä¸‹æ¥ç­‰å¾…ç¡®è®¤å¸§åˆ°æ¥**ã€‚è€Œæ˜¯**è¿ç»­å†å‘é€å¤šä¸ªå¸§**ï¼Œå¸§çš„ä¸ªæ•°å–å†³äºå‘é€æ–¹çš„å‘é€èƒ½åŠ›å’Œæ¥æ”¶ç«¯çš„æ¥æ”¶èƒ½åŠ›ã€‚æ­¤æ–¹å¼ä¸­ï¼Œå¿…é¡»ä¸ºä¸åŒå¸§ç¼–ä¸Šåºåˆ—å·ä½œä¸ºå¸§æ ‡è¯†ã€‚\n  * æ¥æ”¶æ–¹ä¸€èˆ¬é‡‡ç”¨**ç´¯ç§¯ç¡®è®¤**çš„æ–¹å¼\n\n#### æ‹‰å›æ–¹å¼\n\nè¿ç»­å‘äº†å¤šä¸ªå¸§ï¼ŒæŸä¸€ä¸ªå‡ºé”™åï¼Œä»å‡ºé”™çš„å¼€å§‹éœ€è¦å…¨éƒ¨é‡å‘ï¼Œå› ä¸ºè¦æ±‚æ˜¯æŒ‰åºæ¥æ”¶ã€‚æ¢è¨€ä¹‹ï¼Œä¸€æ—¦æ¥æ”¶æ–¹å‘ç°ç¬¬nå¸§å‡ºé”™ï¼Œåˆ™ä¸¢å¼ƒç¬¬nå¸§åŠç¬¬nå¸§ä»¥åçš„æ‰€æœ‰å¸§ã€‚\n\nåœ¨ç­‰ä¸åˆ°2å·å¸§çš„ç¡®è®¤è€Œé‡ä¼ 2å·æ•°æ®å¸§æ—¶ï¼Œè™½ç„¶ç»“ç‚¹Aå·²ç»å‘å®Œäº†5å·å¸§ï¼Œä½†ä»å¿…é¡»å‘å›èµ°ï¼Œå°†2å·å¸§åŠå…¶ä»¥åçš„å„å¸§å…¨éƒ¨è¿›è¡Œé‡ä¼ ã€‚è¿ç»­ ARQåˆç§°ä¸ºGo-back-N ARQï¼Œæ„æ€æ˜¯å½“å‡ºç°å·®é”™å¿…é¡»é‡ä¼ æ—¶ï¼Œè¦å‘å›èµ°Nä¸ªå¸§ï¼Œç„¶åå†å¼€å§‹é‡ä¼ ã€‚\n\n* ä»£ä»·ï¼šä¿¡é“çš„å¸¦å®½ã€‚\n\n#### é€‰æ‹©é‡å‘æ–¹å¼\n\nå‡å®šå‘é€æ–¹è¿ç»­å‘é€äº†må¸§ï¼Œè€Œæ¥æ”¶æ–¹åœ¨å¯¹æ”¶åˆ°çš„æ•°æ®è¿›è¡Œæ ¡éªŒåå‘ç°ç¬¬nå¸§å‡ºé”™(nâ‰¤m)ï¼Œäºæ˜¯**æ¥æ”¶æ–¹ç»™å‘é€æ–¹å‡ºé”™ä¿¡æ¯è¦æ±‚å‘é€æ–¹é‡å‘ç¬¬nå¸§**ã€‚æ¢è¨€ä¹‹ï¼Œä¸€æ—¦æ¥æ”¶æ–¹å‘ç°ç¬¬nå¸§å‡ºé”™ï¼Œåˆ™ä¸¢å¼ƒç¬¬nå¸§ï¼Œä½†**ç¼“å­˜ç¬¬nå¸§ä»¥åçš„æ‰€æœ‰æ­£ç¡®å¸§**ã€‚\n\né€‰æ‹©é‡å‘æ–¹å¼ä¸æ‹‰å›æ–¹å¼æ¯”è¾ƒï¼Œå‰è€…åªé‡å‘å‡ºé”™çš„æ•°æ®ã€‚æ•ˆç‡é«˜ã€‚\n\n* ä»£ä»·ï¼šå­˜å‚¨ç©ºé—´ï¼›å®ç°æ¯”è¾ƒå¤æ‚\n  * æ¥æ”¶ç«¯å¿…é¡»ç»´æŒä¸€ä¸ªè¶³å¤Ÿå¤§çš„ç¼“å­˜ä»¥ä¾¿å­˜å‚¨å‡ºé”™å¸§ä¹‹åæ”¶åˆ°çš„å¸§ï¼Œç›´åˆ°å‡ºé”™å¸§è¢«é‡ä¼ ã€‚\n  * è€Œä¸”å®ƒå¿…é¡»å…·æœ‰**å°†æ”¶åˆ°çš„é‡ä¼ å¸§æ’å…¥åˆ°æ­£ç¡®ä½ç½®**çš„é€»è¾‘åŠŸèƒ½ã€‚å‘é€ç«¯ä¹Ÿè¦æ±‚æ›´å¤æ‚çš„é€»è¾‘åŠŸèƒ½ä»¥ä¾¿**èƒ½å¤Ÿä¸æŒ‰é¡ºåºå‘é€ä¸€ä¸ªå¸§**ã€‚ç”±äºæœ‰è¿™æ ·çš„å¤æ‚æ€§ï¼Œé€‰æ‹©é‡ä¼ ARQè¿œä¸å¦‚go-back-N ARQç”¨å¾—å¹¿æ³›ã€‚\n\n#### ç´¯ç§¯ç¡®è®¤\n\nå³**ä¸å¿…å¯¹æ”¶åˆ°çš„å¸§é€ä¸ªå‘é€ç¡®è®¤**ï¼Œè€Œæ˜¯å¯¹æŒ‰åºåˆ°è¾¾çš„**æœ€åä¸€ä¸ªå¸§**å‘é€ç¡®è®¤ï¼Œè¿™æ ·å°±è¡¨ç¤ºï¼šåˆ°è¿™ä¸ªå¸§ä¸ºæ­¢çš„æ‰€æœ‰å¸§éƒ½å·²æ­£ç¡®æ”¶åˆ°äº†ã€‚\n\n**ä¼˜ç‚¹**ï¼šå®¹æ˜“å®ç°ï¼Œå³ä½¿ç¡®è®¤ä¸¢å¤±ä¹Ÿä¸å¿…é‡ä¼ ï¼›**ç¼ºç‚¹**ï¼šä¸èƒ½å‘å‘é€æ–¹åæ˜ å‡ºæ¥æ”¶æ–¹å·²ç»æ­£ç¡®æ”¶åˆ°çš„æ‰€æœ‰å¸§çš„ä¿¡æ¯ã€‚\n\n## æµé‡æ§åˆ¶\n\næ»‘åŠ¨çª—å£åè®®\n\n## ä¹ é¢˜\n\n# ä½¿ç”¨å¹¿æ’­ä¿¡é“çš„æ•°æ®é“¾è·¯å±‚\n\nå¹¿æ’­ä¿¡é“å¯ä»¥è¿›è¡Œä¸€å¯¹å¤šçš„é€šä¿¡ã€‚ä»¥å¤ªç½‘å’Œæ— çº¿å±€åŸŸç½‘éƒ½æ˜¯å¹¿æ’­é“¾è·¯å±‚æŠ€æœ¯çš„ä¾‹å­ã€‚ä¸‹é¢è¦è®¨è®ºçš„å±€åŸŸç½‘ä½¿ç”¨çš„å°±æ˜¯å¹¿æ’­ä¿¡é“ã€‚\n\n# å±€åŸŸç½‘æŠ€æœ¯\n\néµå¾ªIEEE 802ç³»åˆ—æ ‡å‡†ã€‚å®é™…ä¸Šå±€åŸŸç½‘ä½“ç³»ç»“æ„æ˜¯**ç‰©ç†å±‚å’Œæ•°æ®é“¾è·¯å±‚**ï¼ˆç»†åˆ†æˆäº†MAC[Madium Access Control]å­å±‚ã€LLC[Logical Link Control]å­å±‚ï¼‰ã€‚ä¸ä»‹è´¨ç›¸å…³çš„æ˜¯MACï¼ˆä¸ç‰©ç†å±‚æ¥è§¦ï¼‰ï¼Œæ— å…³çš„æ˜¯LLCï¼ˆä¸ç½‘ç»œå±‚æ¥è§¦ï¼‰ã€‚\n\n## å±€åŸŸç½‘çš„ç‰¹ç‚¹å’Œåˆ†ç±»\n\nå±€åŸŸç½‘æœ€ä¸»è¦çš„ç‰¹ç‚¹æ˜¯ï¼šç½‘ç»œä¸ºä¸€ä¸ªå•ä½æ‰€æ‹¥æœ‰ï¼Œä¸”åœ°ç†èŒƒå›´å’Œç«™ç‚¹\næ•°ç›®å‡æœ‰é™ã€‚\n\nå±€åŸŸç½‘å¯æŒ‰ç½‘ç»œæ‹“æ‰‘è¿›è¡Œåˆ†ç±»ã€‚ç”±äºé›†çº¿å™¨(hub)çš„å‡ºç°å’ŒåŒç»çº¿å¤§é‡ç”¨äºå±€åŸŸç½‘ä¸­ï¼Œæ˜Ÿå½¢ä»¥å¤ªç½‘ä»¥åŠå¤šçº§æ˜Ÿå½¢ç»“æ„çš„ä»¥å¤ªç½‘è·å¾—äº†éå¸¸å¹¿æ³›çš„åº”ç”¨ã€‚ä¸‹å›¾ä¸ºæ˜Ÿå½¢ç½‘ã€‚\n![image-20220309204233779](../../images/ç½‘ç»œ_æ•°æ®é“¾è·¯å±‚/image-20220309204233779.png)\n\nä¸‹å›¾ä¸ºæ€»çº¿ç½‘ï¼Œå„ç«™ç›´æ¥è¿åœ¨æ€»çº¿ä¸Šã€‚æ€»çº¿ä¸¤ç«¯çš„åŒ¹é…ç”µé˜»å¸æ”¶åœ¨æ€»çº¿ä¸Šä¼ æ’­çš„ç”µç£æ³¢ä¿¡å·çš„èƒ½é‡ï¼Œé¿å…åœ¨æ€»çº¿ä¸Šäº§ç”Ÿæœ‰å®³çš„ç”µç£æ³¢åå°„ã€‚\n![image-20220309204450154](../../images/ç½‘ç»œ_æ•°æ®é“¾è·¯å±‚/image-20220309204450154.png)\n\næ€»çº¿ç½‘ä»¥ä¼ ç»Ÿä»¥å¤ªç½‘æœ€ä¸ºè‘—åï¼Œä½†ä»¥å¤ªç½‘åæ¥åˆæ¼”å˜æˆäº†æ˜Ÿå½¢ç½‘ã€‚ç»è¿‡å››åå¤šå¹´çš„å‘å±•ï¼Œä»¥å¤ªç½‘çš„é€Ÿç‡å·²å¤§å¤§æé«˜ã€‚\n\n## ä»¥å¤ªç½‘\n\nç°åœ¨æœ€å¸¸ç”¨çš„ä»¥å¤ªç½‘çš„é€Ÿç‡æ˜¯1 Gbit/sï¼ˆå®¶åº­æˆ–ä¸­å°ä¼ä¸šï¼‰ã€10 Gbit/sï¼ˆæ•°æ®ä¸­å¿ƒï¼‰å’Œ100 Gbit/sï¼ˆé•¿è·ç¦»ä¼ è¾“ï¼‰ï¼Œä¸”å…¶é€Ÿç‡ä»åœ¨ç»§ç»­æé«˜ã€‚ç°åœ¨ä»¥å¤ªç½‘å·²æˆä¸ºäº†å±€åŸŸç½‘çš„åŒä¹‰è¯ï¼Œå› æ­¤è°ˆè®ºå±€åŸŸç½‘å¯ä»¥çœ‹ä½œæ˜¯åœ¨è°ˆè®ºä»¥å¤ªç½‘ã€‚\n\n* ä¸ºäº†é€šä¿¡çš„ç®€ä¾¿ï¼Œä»¥å¤ªç½‘çš„ä¸¤ç§æªæ–½\n  * ç¬¬ä¸€ï¼Œé‡‡ç”¨è¾ƒä¸ºçµæ´»çš„**æ— è¿æ¥çš„å·¥ä½œæ–¹å¼**ï¼Œå³ä¸å¿…å…ˆå»ºç«‹è¿æ¥å°±å¯ä»¥ç›´æ¥å‘é€æ•°æ®ã€‚é€‚é…å™¨å¯¹å‘é€çš„æ•°æ®å¸§ä¸è¿›è¡Œç¼–å·ï¼Œä¹Ÿä¸è¦æ±‚å¯¹æ–¹å‘å›ç¡®è®¤ã€‚è¿™æ ·åšå¯ä»¥ä½¿ä»¥å¤ªç½‘å·¥ä½œèµ·æ¥éå¸¸ç®€å•ï¼Œè€Œå±€åŸŸç½‘ä¿¡é“çš„è´¨é‡å¾ˆå¥½ï¼Œå› é€šä¿¡è´¨é‡ä¸å¥½äº§ç”Ÿå·®é”™çš„æ¦‚ç‡æ˜¯å¾ˆå°çš„ã€‚å› æ­¤ï¼Œä»¥å¤ªç½‘æä¾›çš„æœåŠ¡æ˜¯å°½æœ€å¤§åŠªåŠ›çš„äº¤ä»˜ï¼Œå³**ä¸å¯é çš„äº¤ä»˜**ã€‚å½“ç›®çš„ç«™æ”¶åˆ°æœ‰å·®é”™çš„æ•°æ®å¸§æ—¶ï¼ˆä¾‹å¦‚ï¼Œ**ç”¨CRCæŸ¥å‡ºå·®é”™**ï¼‰ï¼Œå°±æŠŠå¸§ä¸¢å¼ƒï¼Œå…¶ä»–ä»€ä¹ˆä¹Ÿä¸åšã€‚**å¯¹æœ‰å·®é”™å¸§æ˜¯å¦éœ€è¦é‡ä¼ åˆ™ç”±é«˜å±‚æ¥å†³å®š**ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé«˜å±‚ä½¿ç”¨TCPåè®®ï¼Œé‚£ä¹ˆTCPå°±ä¼šå‘ç°ä¸¢å¤±äº†ä¸€äº›æ•°æ®ã€‚äºæ˜¯ç»è¿‡ä¸€å®šçš„æ—¶é—´åï¼ŒTCPå°±æŠŠè¿™äº›æ•°æ®é‡æ–°ä¼ é€’ç»™ä»¥å¤ªç½‘è¿›è¡Œé‡ä¼ ã€‚**ä½†ä»¥å¤ªç½‘å¹¶ä¸çŸ¥é“è¿™æ˜¯é‡ä¼ å¸§ï¼Œè€Œæ˜¯å½“ä½œæ–°çš„æ•°æ®å¸§æ¥å‘é€**ã€‚\n  * ç¬¬äºŒï¼Œä»¥å¤ªç½‘å‘é€çš„æ•°æ®éƒ½ä½¿ç”¨**æ›¼å½»æ–¯ç‰¹(Manchester)ç¼–ç **çš„ä¿¡å·ã€‚æˆ‘ä»¬çŸ¥é“ï¼ŒäºŒè¿›åˆ¶åŸºå¸¦æ•°å­—ä¿¡å·é€šå¸¸å°±æ˜¯é«˜ã€ä½ç”µå‹äº¤æ›¿å‡ºç°çš„ä¿¡å·ã€‚ä½¿ç”¨è¿™ç§ä¿¡å·çš„æœ€å¤§é—®é¢˜å°±æ˜¯å½“å‡ºç°ä¸€é•¿ä¸²è¿ç»­çš„1æˆ–è¿ç»­çš„0æ—¶ï¼Œæ¥æ”¶ç«¯å°±æ— æ³•ä»æ”¶åˆ°çš„æ¯”ç‰¹æµä¸­æå–ä½åŒæ­¥ï¼ˆå³æ¯”ç‰¹åŒæ­¥ï¼‰ä¿¡å·ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œ**æ›¼å½»æ–¯ç‰¹ç¼–ç çš„ç¼–ç æ–¹æ³•æ˜¯æŠŠæ¯ä¸€ä¸ªç å…ƒå†åˆ†æˆä¸¤ä¸ªç›¸ç­‰çš„é—´éš”**ã€‚ç å…ƒ1æ˜¯å‰ä¸€ä¸ªé—´éš”ä¸ºä½ç”µå‹è€Œåä¸€ä¸ªé—´éš”ä¸ºé«˜ç”µå‹ã€‚ç å…ƒ0åˆ™æ­£å¥½ç›¸åï¼Œä»é«˜ç”µå‹å˜åˆ°ä½ç”µå‹ï¼ˆä¹Ÿå¯é‡‡ç”¨ç›¸åçš„çº¦å®šï¼Œå³1æ˜¯â€œå‰é«˜åä½â€è€Œ0æ˜¯â€œå‰ä½åé«˜â€ï¼‰ã€‚**è¿™æ ·å°±ä¿è¯äº†åœ¨æ¯ä¸€ä¸ªæ¯”ç‰¹çš„æ­£ä¸­é—´å‡ºç°ä¸€æ¬¡ç”µå‹çš„è½¬æ¢ï¼Œè€Œæ¥æ”¶ç«¯å°±åˆ©ç”¨è¿™ç§ç”µå‹çš„è½¬æ¢å¾ˆæ–¹ä¾¿åœ°æŠŠä½åŒæ­¥ä¿¡å·æå–å‡ºæ¥**ã€‚ä½†æ˜¯ä»æ›¼å½»æ–¯ç‰¹ç¼–ç çš„æ³¢å½¢å›¾ä¹Ÿä¸éš¾çœ‹å‡ºï¼Œ**å…¶ç¼ºç‚¹æ˜¯å®ƒæ‰€å çš„é¢‘å¸¦å®½åº¦æ¯”åŸå§‹çš„åŸºå¸¦ä¿¡å·å¢åŠ äº†ä¸€å€**ï¼ˆå› ä¸ºæ¯ç§’ä¼ é€çš„ç å…ƒæ•°åŠ å€äº†ï¼‰ã€‚\n\n## ä»‹è´¨è®¿é—®æ§åˆ¶\n\nä»‹è´¨è®¿é—®çš„æ§åˆ¶éƒ½åœ¨MACå­å±‚å®Œæˆã€‚\n\næœ€æ—©çš„ä»¥å¤ªç½‘æ˜¯å°†è®¸å¤šè®¡ç®—æœºéƒ½è¿æ¥åˆ°ä¸€æ ¹æ€»çº¿ä¸Šã€‚å½“åˆè®¤ä¸ºè¿™ç§è¿æ¥æ–¹æ³•æ—¢ç®€å•åˆå¯é ï¼Œå› ä¸ºåœ¨é‚£ä¸ªæ—¶ä»£æ™®éè®¤ä¸ºï¼šâ€œæœ‰æºå™¨ä»¶ä¸å¯é ï¼Œè€Œæ— æºçš„ç”µç¼†çº¿æ‰æ˜¯æœ€å¯é çš„â€ã€‚\n\næ€»çº¿çš„ç‰¹ç‚¹æ˜¯ï¼šå½“ä¸€å°è®¡ç®—æœºå‘é€æ•°æ®æ—¶ï¼Œæ€»çº¿ä¸Šçš„æ‰€æœ‰è®¡ç®—æœºéƒ½èƒ½æ£€æµ‹åˆ°è¿™ä¸ªæ•°æ®ã€‚è¿™ç§å°±æ˜¯å¹¿æ’­é€šä¿¡æ–¹å¼ã€‚\n\n* ä¸ºäº†åœ¨æ€»çº¿ä¸Šå®ç°ä¸å¹²æ‰°ä»–äººçš„ä¸€å¯¹ä¸€çš„é€šä¿¡ï¼Œéœ€è¦é‡‡å–ä¸€äº›æŠ€æœ¯æªæ–½\n  * å¯ä»¥ä½¿æ¯ä¸€å°è®¡ç®—æœºçš„é€‚é…å™¨éƒ½æ‹¥æœ‰ä¸€ä¸ªä¸å…¶ä»–é€‚é…å™¨éƒ½ä¸åŒçš„åœ°å€ã€‚åœ¨**å‘é€æ•°æ®å¸§æ—¶ï¼Œåœ¨å¸§çš„é¦–éƒ¨å†™æ˜æ¥æ”¶ç«™çš„åœ°å€**ã€‚ç°åœ¨çš„ç”µå­æŠ€æœ¯å¯ä»¥å¾ˆå®¹æ˜“åšåˆ°ï¼š**ä»…å½“æ•°æ®å¸§ä¸­çš„ç›®çš„åœ°å€ä¸é€‚é…å™¨ROMä¸­å­˜æ”¾çš„ç¡¬ä»¶åœ°å€ä¸€è‡´æ—¶ï¼Œè¯¥é€‚é…å™¨æ‰èƒ½æ¥æ”¶è¿™ä¸ªæ•°æ®å¸§**ï¼Œä¸æ˜¯å‘é€ç»™è‡ªå·±çš„æ•°æ®å¸§å°±ä¸¢å¼ƒã€‚è¿™æ ·ï¼Œå…·æœ‰å¹¿æ’­ç‰¹æ€§çš„æ€»çº¿ä¸Šå°±å®ç°äº†ä¸€å¯¹ä¸€çš„é€šä¿¡ã€‚\n  * é™¤äº†ç»™æ¯ä¸ªç½‘ç»œé€‚é…å™¨ä¸€ä¸ªå•ç‹¬çš„åœ°å€ï¼Œè¿˜éœ€è¦è§£å†³ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸º**æœ‰äº›èŠ‚ç‚¹å¯èƒ½åœ¨æŸä¸€åˆ»åŒæ—¶ä¼ è¾“å¸§ï¼Œé‚£ä¹ˆæ‰€æœ‰èŠ‚ç‚¹ä¼šåŒæ—¶æ¥åˆ°å¤šä¸ªå¸§**ï¼Œè¿™ä¸ªç°è±¡å«åšï¼šä¼ è¾“çš„è¿™äº›å¸§åœ¨æ‰€æœ‰çš„æ¥æ”¶æ–¹å¤„**ç¢°æ’**äº†ã€‚é€šå¸¸ï¼Œåœ¨ç¢°æ’å‘ç”Ÿæ—¶ï¼Œæ²¡æœ‰ä¸€ä¸ªæ¥æ”¶èŠ‚ç‚¹èƒ½å¤Ÿè·å¾—æœ‰æ•ˆå¸§ï¼Œå› æ­¤ï¼Œæ¶‰åŠæ­¤æ¬¡ç¢°æ’çš„æ‰€æœ‰å¸§éƒ½æ¶ˆå¤±äº†ï¼Œç›¸åº”çš„è¿™æ®µæ—¶é—´ä¸­å¹¿æ’­ä¿¡é“å¤§é‡å¸¦å®½ä¼šè¢«æµªè´¹æ‰ã€‚é‚£ä¹ˆå¦‚ä½•æ¥è§„èŒƒå¹¿æ’­ç½‘ç»œ(ä¾‹å¦‚æ€»çº¿ç½‘)ä¸Šçš„è®¡ç®—æœºåœ¨å¹¿æ’­ä¿¡é“ä¸Šçš„ä¼ è¾“è¡Œä¸ºå‘¢ï¼Ÿè¿™æ˜¯ä¸€ä¸ª**å¤šè·¯è®¿é—®é—®é¢˜**ã€‚æ˜¾ç„¶éœ€è¦é€šè¿‡åˆ¶å®š**å¤šè·¯è®¿é—®åè®®**æ¥è§£å†³ã€‚\n\n### é€‚é…å™¨çš„ä½œç”¨\n\n* é‡è¦åŠŸèƒ½\n  * è¿›è¡Œä¸²è¡Œ/å¹¶è¡Œè½¬æ¢\n  * å¯¹æ•°æ®è¿›è¡Œç¼“å­˜\n  * åœ¨è®¡ç®—æœºçš„æ“ä½œç³»ç»Ÿå®‰è£…è®¾å¤‡é©±åŠ¨ç¨‹åº\n  * å®ç°ä»¥å¤ªç½‘åè®®\n\n### åª’ä½“å…±äº«æŠ€æœ¯\n\n* é™æ€åˆ’åˆ†ä¿¡é“\n  * é¢‘åˆ†å¤ç”¨\n  * æ—¶åˆ†å¤ç”¨\n  * æ³¢åˆ†å¤ç”¨\n  * ç åˆ†å¤ç”¨\n* åŠ¨æ€åª’ä½“æ¥å…¥æ§åˆ¶ï¼ˆå¤šç‚¹æ¥å…¥ï¼‰\n  * éšæœºæ¥å…¥ï¼šæ‰€æœ‰çš„ç”¨æˆ·å¯éšæœºåœ°å‘é€ä¿¡æ¯\n  * å—æ§æ¥å…¥ï¼šç”¨æˆ·å¿…é¡»æœä»ä¸€å®šçš„æ§åˆ¶ï¼Œå¦‚è½®è¯¢(polling)\n\n### ä»‹è´¨è®¿é—®æ§åˆ¶ç­–ç•¥\n\nåœ¨ä»‹è´¨è®¿é—®æ§åˆ¶æŠ€æœ¯ä¸­ï¼Œæœ€å…³é”®çš„æ˜¯æ§åˆ¶åœ°ç‚¹å’Œæ§åˆ¶æ–¹æ³•ã€‚\n\n1. åœ¨ä»€ä¹ˆåœ°æ–¹å¯¹åª’ä½“è®¿é—®è¿›è¡Œæ§åˆ¶\n\n   * é›†ä¸­å¼æ§åˆ¶\n     * æŒ‡å®šä¸€ä¸ªå•ç‹¬çš„é›†ä¸­æ§åˆ¶å™¨æˆ–ä¸€ä¸ªå…·æœ‰æ§åˆ¶æ•´ä¸ªç½‘ç»œçš„èƒ½åŠ›çš„èŠ‚ç‚¹æ¥ç®¡ç†ç½‘ç»œçš„é€šä¿¡ï¼Œå…¶å°†æ‹¥æœ‰æ§åˆ¶ç½‘ç»œè®¿é—®çš„æƒåˆ©ã€‚\n     * ä¼˜ç‚¹\n       * èƒ½æä¾›é™¤äº†å¯¹åª’ä½“è®¿é—®å¤–çš„å…¶ä»–æ›´é«˜çº§çš„åŠŸèƒ½ï¼Œå¦‚ä¼˜å…ˆçº§æ§åˆ¶ã€å¯é æ€§ç­‰ã€‚\n       * æ¯ä¸ªç«™ç‚¹çš„è®¿é—®æ§åˆ¶é€»è¾‘ç®€å•\n       * é¿å…è¿›è¡Œåˆ†å¸ƒåˆä½œå¯èƒ½å¸¦æ¥çš„åè°ƒé—®é¢˜ \n     * ç¼ºç‚¹\n       * å¦‚æœæ§åˆ¶ç‚¹ä¸èƒ½å·¥ä½œï¼Œåˆ™ä¼šå¯¼è‡´æ•´ä¸ªç½‘ç»œç˜«ç—ªã€‚\n       * ç”±äºæ‰€æœ‰è®¿é—®è¦ç»è¿‡æ§åˆ¶ç‚¹çš„å…è®¸ï¼Œå¯èƒ½ä¼šå½¢æˆç“¶é¢ˆï¼Œé™ä½æ•ˆç‡ã€‚\n   * åˆ†å¸ƒå¼æ§åˆ¶\n     * æ— é›†ä¸­æ§åˆ¶èŠ‚ç‚¹ï¼Œå„èŠ‚ç‚¹å‡å¤„äºå¹³ç­‰åœ°ä½ï¼›ç”±å„ä¸ªç«™ç‚¹å…±åŒå®Œæˆåª’ä½“è®¿é—®æ§åˆ¶åŠŸèƒ½ï¼ŒåŠ¨æ€åœ°ç¡®å®šç«™ç‚¹çš„å‘é€é¡ºåºï¼›èŠ‚ç‚¹é—´çš„é€šä¿¡ç”±å„èŠ‚ç‚¹è‡ªèº«æ§åˆ¶ã€‚\n     * åˆ†ç±»\n       * CSMA/CD\n       * ä»¤ç‰Œæ³•\n       * æ—¶éš™æ³•(Time Slot)\n\n2. æ€ä¹ˆå¯¹å…±äº«åª’ä½“è¿›è¡Œæ§åˆ¶è®¿é—®\n\n   * åŒæ­¥æœºåˆ¶ï¼šå¦‚FDMã€TDMç­‰ã€‚\n\n   * å¼‚æ­¥æœºåˆ¶ï¼šå¦‚æ—¶é—´ç‰‡è½®è½¬ï¼ˆå¾ªç¯å¼ï¼‰ã€é¢„çº¦å¼ã€ç«äº‰å¼ç­‰ã€‚\n\n     |        | æ€»çº¿æ‹“æ‰‘             | ç¯å‹æ‹“æ‰‘                 |\n     | ------ | -------------------- | ------------------------ |\n     | å¾ªç¯å¼ | ä»¤ç‰Œæ€»çº¿(IEEE 802.4) | ä»¤ç‰Œç¯(IEEE 802.5; FDDI) |\n     | é¢„çº¦å¼ | DQDB(IEEE 802.6)     |                          |\n     | ç«äº‰å¼ | CSMA/CD(IEEE 802.3)  |                          |\n\n     * æ—¶é—´ç‰‡è½®è½¬ï¼ˆå¾ªç¯å¼ï¼‰\n       * æ¯ä¸ªç«™ç‚¹æŒ‰ç…§ä¸€å®šçš„æ—¶é—´é¡ºåºå¾—åˆ°ä¼ è¾“æ—¶é—´ã€‚å¦‚æœç«™ç‚¹åˆ©ç”¨è¿™ä¸ªæœºä¼šå‘é€ï¼Œåˆ™å¯¹å…¶å‘é€æ—¶é—´æˆ–å‘é€çš„æ•°æ®æ€»é‡æœ‰ä¸€å®šé™åˆ¶ï¼Œè¶…è¿‡è¿™ä¸ªé™åˆ¶çš„æ•°æ®åªèƒ½åœ¨ä¸‹ä¸€è½®ä¸­å‘é€ã€‚\n       * è¿™ç§é¡ºåºæ§åˆ¶å¯èƒ½æ˜¯é›†ä¸­å¼çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯åˆ†å¸ƒå¼çš„ã€‚ \n       * åœ¨ä¸€æ®µæ—¶é—´å†…æœ‰å¤šä¸ªèŠ‚ç‚¹è¦ä¼ è¾“æ•°æ®æ—¶ï¼Œæ­¤æ–¹å¼æ˜¯æœ‰æ•ˆçš„ã€‚\n       * å½“è¦ä¼ è¾“æ•°æ®çš„èŠ‚ç‚¹è¾ƒå°‘æ—¶ï¼Œæ—¶é—´å¼€é”€å°±æ˜¾å¾—å¾ˆå¤§ã€‚\n     * é¢„çº¦å¼\n       * ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ç§æŠ€æœ¯**æŠŠä¼ è¾“åª’ä½“çš„ä½¿ç”¨æ—¶é—´åˆ’åˆ†ä¸ºä¸€äº›æ—¶æ§½**ã€‚ä¸€ä¸ªèŠ‚ç‚¹è¦ä¼ è¾“æ•°æ®æ—¶ï¼Œå°±å¯ä»¥é¢„çº¦ä¸€äº›æ—¶æ§½è¿›è¡Œè¿ç»­ä¼ è¾“ã€‚\n       * é€‚åˆäºä¼ è¾“è¿ç»­æ•°æ®çš„æƒ…å†µã€‚**æµå¼é€šä¿¡å°±æ˜¯é•¿æ—¶é—´è¿ç»­ä¼ è¾“**ï¼Œä¾‹å¦‚è¯éŸ³é€šä¿¡ã€é¥æµ‹é€šä¿¡å’Œé•¿æ–‡ä»¶çš„ä¼ è¾“ç­‰ã€‚\n       * å¯ä»¥æ˜¯é›†ä¸­å¼çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯åˆ†å¸ƒå¼çš„ã€‚\n     * ç«äº‰å¼\n       * è¿™ç§æŠ€æœ¯å¹¶ä¸å¯¹å„ä¸ªå·¥ä½œç«™ç‚¹çš„å‘é€æƒé™è¿›è¡Œæ§åˆ¶ï¼Œè€Œæ˜¯ç”±å„ä¸ªå·¥ä½œç«™ç‚¹è‡ªç”±ç«äº‰å‘é€æœºä¼šã€‚\n       * å¯¹çªå‘æ€§çš„æ•°æ®ä¼ è¾“ï¼Œç«äº‰æ˜¯æœ€å¸¸ç”¨çš„æœºåˆ¶ã€‚çªå‘å¼é€šä¿¡å°±æ˜¯çŸ­æ—¶é—´çš„å°‘é‡ä¼ è¾“ï¼Œä¾‹å¦‚ç»ˆç«¯å’Œä¸»æœºä¹‹é—´çš„é€šä¿¡å°±æ˜¯è¿™æ ·çš„ã€‚\n       * åœ¨ä½è´Ÿè·æ—¶ï¼Œæ€§èƒ½ä¸é”™ã€‚\n       * æ˜¯åˆ†å¸ƒå¼çš„ã€‚\n\n### å¤šè·¯è®¿é—®åè®®\n\næœ‰å…³å¤šè·¯è®¿é—®åè®®æ–¹é¢çš„ç ”ç©¶ä»åœ¨æ´»è·ƒï¼Œæ‰€æœ‰çš„å¤šè·¯è®¿é—®åè®®å¯åˆ†ä¸ºä¸‰ç§ç±»å‹ä¹‹ä¸€ï¼šä¿¡é“åˆ’åˆ†åè®®ã€éšæœºæ¥å…¥åè®®ã€è½®æµåè®®ã€‚\n\n#### ä¿¡é“åˆ’åˆ†åè®®\n\n* æ—¶åˆ†å¤šè·¯å¤ç”¨(TDM)\n* é¢‘åˆ†å¤šè·¯å¤ç”¨(FDM)\n* ç åˆ†å¤šå€(Code Division Multiple Access, CDMA)\n\n#### éšæœºæ¥å…¥åè®®\n\nåœ¨éšæœºæ¥å…¥åè®®ä¸­ï¼Œä¸€ä¸ªä¼ è¾“èŠ‚ç‚¹æ€»æ˜¯ä»¥ä¿¡é“çš„å…¨éƒ¨é€Ÿç‡(å³R bps)è¿›è¡Œå‘é€ã€‚å½“æœ‰ç¢°æ’æ—¶ï¼Œæ¶‰åŠç¢°æ’çš„æ¯ä¸ªèŠ‚ç‚¹åå¤åœ°é‡å‘å®ƒçš„å¸§ï¼Œç›´åˆ°æ— ç¢°æ’åœ°é€šè¿‡ä¸ºæ­¢ã€‚ä½†æ˜¯å½“ä¸€ä¸ªèŠ‚ç‚¹ç»å†ä¸€æ¬¡ç¢°æ’æ—¶ï¼Œä»–ä¸å¿…ç«‹åˆ»é‡å‘è¯¥å¸§ï¼Œè€Œæ˜¯åœ¨**é‡å‘è¯¥å¸§ä¹‹å‰ç­‰å¾…ä¸€ä¸ªéšæœºæ—¶å»¶**ã€‚æ¶‰åŠç¢°æ’çš„æ¯ä¸ªèŠ‚ç‚¹ç‹¬ç«‹åœ°é€‰æ‹©éšæœºæ—¶å»¶ã€‚å› ä¸ºè¯¥éšæœºæ—¶å»¶æ˜¯ç‹¬ç«‹é€‰æ‹©çš„ï¼Œæ‰€ä»¥å¯èƒ½ï¼šè¿™äº›èŠ‚ç‚¹ä¹‹ä¸€æ‰€é€‰æ‹©çš„æ—¶å»¶å……åˆ†å°äºå…¶ä»–ç¢°æ’èŠ‚ç‚¹çš„æ—¶å»¶ï¼Œå› æ­¤èƒ½å¤Ÿæ— ç¢°æ’åœ°å°†å®ƒçš„å¸§åœ¨ä¿¡é“ä¸­å‘å‡ºã€‚\n\næœ€å¸¸ç”¨çš„éšæœºæ¥å…¥åè®®æœ‰**ALOHAåè®®**å’Œ**è½½æ³¢ä¾¦å¬å¤šè·¯è®¿é—®(CSMA)åè®®**ã€‚ä»¥å¤ªç½‘æ˜¯ä¸€ç§æµè¡Œå¹¶å¹¿æ³›éƒ¨ç½²çš„CSMAåè®®ã€‚\n\n* ALOHAåè®®\n  * è®¿é—®æ–¹å¼ï¼šä¸ç›‘å¬â€”â€”éšæœºé‡å‘ï¼Œâ€œå‘é€â€”â€”å†²çªâ€”â€”å†å‘é€â€ã€‚\n  * ä¿¡é“åˆ©ç”¨ç‡æœ€å¤šä¸º18%\n* åˆ†æ§½ALOHAåè®®\n  * å„ç”¨æˆ·èŠ‚ç‚¹åªèƒ½åœ¨ä¸‹ä¸€æ—¶é—´ç‰‡çš„èµ·å§‹æ—¶åˆ»å¼€å§‹å‘é€ä¿¡æ¯ã€‚\n  * ä¿¡é“åˆ©ç”¨ç‡æœ€å¤šä¸º37%\n* CSMAåè®®\n  * è½½æ³¢ä¾¦å¬å¤šè·¯è®¿é—®ï¼ŒCarrier Sense Multiple Accessï¼Œæ˜¯ä¸€ç§é€‚åˆäºæ€»çº¿ç»“æ„çš„å…·æœ‰ä¿¡é“æ£€æµ‹åŠŸèƒ½çš„åˆ†å¸ƒå¼ä»‹è´¨è®¿é—®æ§åˆ¶æ–¹æ³•ï¼Œå…¶æ§åˆ¶æ‰‹æ®µç§°ä¹‹ä¸ºâ€œè½½æ³¢ä¾¦å¬â€ã€‚\n  * è¯¥åè®®çš„ä¸€èˆ¬æè¿°éå¸¸ç®€å•ã€‚å¦‚æœä¸€ä¸ªç«™ç‚¹æœ‰ä¸€ä¸ªå¸§è¦å‘é€ï¼Œå®ƒéµå¾ªä¸‹é¢çš„è§„åˆ™ï¼š1ã€ä¾¦å¬ä»‹è´¨çš„æ´»åŠ¨ã€‚2ã€å¦‚æœæ²¡æœ‰æ´»åŠ¨ï¼Œåˆ™ç«‹å³ä¼ é€ï¼Œå¦åˆ™ç­‰å¾…ã€‚\n  * CSMAåˆ†ä¸ºä¸‰ç§æ–¹å¼ï¼ŒéåšæŒå’ŒåšæŒCSMAï¼ŒåšæŒCSMAåˆåˆ†ä¸ºâ€œ1-åšæŒCSMAâ€å’Œâ€œp-åšæŒCSMAâ€\n    * éåšæŒCSMAï¼šä¸€æ—¦ç›‘å¬åˆ°ä¿¡é“å¿™ï¼Œå°±ä¸å†ç›‘å¬ï¼›å»¶è¿Ÿä¸€ä¸ªéšæœºæ—¶é—´åå†æ¬¡ç›‘å¬\n      * ä¼˜ç‚¹ï¼šé™ä½äº†å†²çªå‘ç”Ÿæ¦‚ç‡\n      * ç¼ºç‚¹ï¼šä¿¡é“åˆ©ç”¨ç‡é™ä½\n    * 1-åšæŒCSMAï¼šç›‘å¬åˆ°ä¿¡é“å¿™æ—¶ï¼Œä»ç»§ç»­ç›‘å¬ï¼Œç›´åˆ°ä¿¡é“ç©ºé—²ç«‹å³ä¼ è¾“ã€‚å¦‚æœå†²çªï¼Œåˆ™ç­‰å¾…ä¸€æ®µéšæœºçš„æ—¶é—´åé‡å¤ç¬¬ä¸€æ­¥ã€‚\n      * ä¼˜ç‚¹ï¼šæœ‰åˆ©äºæŠ¢å ä¿¡é“ï¼Œå‡å°‘ä¿¡é“ç©ºé—²æ—¶é—´\n      * ç¼ºç‚¹ï¼šå†²çªæ¦‚ç‡è¾ƒå¤§\n    * p-åšæŒCSMAï¼š1ã€è‹¥ä»‹è´¨ç©ºé—²ï¼Œä»¥æ¦‚ç‡pä¼ è¾“ï¼Œä»¥æ¦‚ç‡(1-p)å»¶è¿Ÿä¸€ä¸ªæ—¶é—´å•ä½ï¼Œè¯¥æ—¶é—´å•ä½é€šå¸¸ç­‰äºæœ€å¤§ä¼ æ’­å»¶è¿Ÿçš„ä¸¤å€ï¼›2ã€è‹¥ä»‹è´¨å¿™ï¼Œç»§ç»­ç›‘å¬ç›´åˆ°ä¿¡é“ç©ºé—²ï¼Œå¹¶é‡å¤ç¬¬1æ­¥ï¼›3ã€è‹¥ä¼ è¾“å»¶è¿Ÿäº†ä¸€ä¸ªæ—¶é—´å•ä½ï¼Œåˆ™é‡å¤ç¬¬1æ­¥ã€‚\n    * å¯¹æ¯”ï¼šéåšæŒCSMAåè®®ä¸­çš„ç«™ç‚¹æ˜¯å°Šé‡åˆ«äººçš„ï¼Œè€Œâ€œ1-åšæŒâ€æ–¹å¼æ˜¯è‡ªç§çš„ã€‚è¯•å›¾æ—¢èƒ½å¦‚éåšæŒç®—æ³•é‚£æ ·å‡å°‘å†²çªè€Œåˆåƒâ€œ1-åšæŒâ€ç®—æ³•é‚£æ ·å‡å°‘ç©ºé—²æ—¶é—´çš„ä¸€ç§æŠ˜è¡·æ–¹æ¡ˆæ˜¯â€œp-åšæŒâ€åè®®ã€‚\n  * CSMAçš„æ„ä¹‰ï¼šåœ¨ä¿¡é“å¿™æ—¶ä¸ä¼šæœ‰å…¶ä»–ä¸»æœºæ‰“ä¹±æ­£åœ¨è¿›è¡Œçš„å‘é€ã€‚ç”±äºé‡‡ç”¨äº†ä¿¡é“ä¾¦å¬ï¼Œå› æ­¤åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘äº†å†²çªå‘ç”Ÿçš„æ¬¡æ•°ï¼Œä»è€Œæé«˜äº†ä¿¡é“çš„åˆ©ç”¨ç‡å’Œæ•´ä¸ªç½‘ç»œçš„ååé‡ã€‚\n  * CSMAä¸èƒ½å®Œå…¨é¿å…å†²çªçš„åŸå› ï¼šå½“ä¸»æœºAè®¤ä¸ºä¿¡é“ç©ºé—²æ—¶ï¼Œä¸»æœºBä¹Ÿå¯èƒ½è®¤ä¸ºä¿¡é“ç©ºé—²ï¼Œå› æ­¤ï¼Œä¸¤å°ä¸»æœºå·®ä¸å¤šåŒæ—¶å‘é€æ•°æ®ï¼Œå¯¼è‡´å†²çªå‘ç”Ÿã€‚\n\n### å±€åŸŸç½‘å®é™…å¸¸ç”¨çš„è®¿é—®æ§åˆ¶æ–¹å¼\n\n* ç›®å‰ï¼Œè®¡ç®—æœºå±€åŸŸç½‘å¸¸ç”¨çš„è®¿é—®æ§åˆ¶æ–¹å¼æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«ç”¨äºä¸åŒçš„æ‹“æ‰‘ç»“æ„ã€‚\n  * å¸¦æœ‰å†²çªæ£€æµ‹çš„è½½æ³¢ä¾¦å¬å¤šè·¯è®¿é—®æ³•CSMA/CD (Carrier Sense Multiple Access with Collision Detection)\n  * ä»¤ç‰Œç¯è®¿é—®æ§åˆ¶æ³•(Token Ring)\n  * ä»¤ç‰Œæ€»çº¿è®¿é—®æ§åˆ¶æ³•(Token Bus)\n\n|        | æ€»çº¿æ‹“æ‰‘                 | ç¯å‹æ‹“æ‰‘                     |\n| ------ | ------------------------ | ---------------------------- |\n| å¾ªç¯å¼ | **ä»¤ç‰Œæ€»çº¿**(IEEE 802.4) | **ä»¤ç‰Œç¯**(IEEE 802.5; FDDI) |\n| é¢„çº¦å¼ | DQDB(IEEE 802.6)         |                              |\n| ç«äº‰å¼ | **CSMA/CD**(IEEE 802.3)  |                              |\n\nå…¶ä¸­CSMA/CDæ˜¯ç›®å‰æ¯”è¾ƒæµè¡Œã€åº”ç”¨æœ€å¹¿æ³›çš„ä»‹è´¨è®¿é—®æ§åˆ¶æ–¹æ³•ï¼Œä»¥ä¸‹é‡ç‚¹ä»‹ç»æ­¤è®¿é—®æ–¹æ³•ã€‚\n\n#### CSMA/CDåè®®\n\nCSMA/CDå’Œå®ƒä¹‹å‰çš„ALOHAã€CSMAæŠ€æœ¯éƒ½æ˜¯éšæœºè®¿é—®å’Œç«äº‰å‘é€åè®®ã€‚éšæœºè®¿é—®æ„å‘³ç€ä»»ä½•èŠ‚ç‚¹éƒ½æ— æ³•é¢„è®¡å…¶å‘é€çš„æ—¶åˆ»ï¼›ç«äº‰å‘é€æ˜¯æŒ‡æ‰€æœ‰å‘é€çš„èŠ‚ç‚¹è‡ªç”±ç«äº‰ä¿¡é“çš„ä½¿ç”¨æƒã€‚\n\nå›åˆ°æœ¬åŸçš„é—®é¢˜â€”â€”**å¦‚ä½•è§£å†³åœ¨å¹¿æ’­ç½‘ç»œä¸­å¤šä¸ªå¸§ç¢°æ’çš„é—®é¢˜**ï¼Ÿ\n\nCSMAè§£å†³çš„é—®é¢˜åªæœ‰ç›‘å¬ï¼Œç›‘å¬åªèƒ½æŠŠä¿¡é“å†²çªç‡é™ä½ã€‚ä½†ä¸èƒ½å®Œå…¨é¿å…å†²çªã€‚å…³é”®æ˜¯ï¼šCSMAåªæ˜¯åœ¨å‘é€ä¹‹å‰è¿›è¡Œä¾¦å¬æœ‰æ— å…¶ä»–å ç”¨ä¿¡é“ï¼Œå‘é€ä¹‹åå°±ä¸å†ä¾¦å¬äº†ï¼Œè¿™æ ·ä¾æ—§å¯èƒ½ä¼šäº§ç”Ÿç¢°æ’ã€‚æ‰€ä»¥éœ€è¦å‘é€åä¹Ÿè¦ä¾¦å¬æ‰è¡Œâ€”â€”äºæ˜¯å¸¦ä¸Šäº†åç¼€CDï¼ŒCDæŒ‡çš„æ˜¯Collision Detecionï¼Œâ€œå¸¦å†²çªæ£€æµ‹â€ã€‚\n\n> * æ•°æ®åœ¨å‘é€å‰ç›‘å¬åˆ°ä¿¡é“â€œç©ºé—²â€ï¼Œä»€ä¹ˆè¿˜ä¼šäº§ç”Ÿç¢°æ’ï¼Ÿ\n>   * å½“æŸç«™ç›‘å¬åˆ°ä¿¡é“æ˜¯ç©ºé—²æ—¶ï¼Œå¯èƒ½æ€»çº¿å¹¶éçœŸæ­£ç©ºé—²ã€‚ç”µç£æ³¢åœ¨æ€»çº¿ä¸Šæ€»æ˜¯ä»¥æœ‰é™çš„é€Ÿç‡ä¼ æ’­ã€‚ç”µç£æ³¢åœ¨1kmç”µç¼†çš„ä¼ æ’­æ—¶å»¶çº¦ä¸º5Î¼sã€‚ä¹Ÿå°±æ˜¯è¯´ä½ å¬åˆ°çš„å·²ç»æˆä¸ºäº†è¿‡å»å¼ï¼Œä¸èƒ½ä»£è¡¨ç°åœ¨è¿›è¡Œæ—¶ã€‚\n\n* CSMA/CDçš„å·¥ä½œæµç¨‹\n  1. å…ˆå¬åå‘ï¼šæ¯ä¸ªç«™åœ¨å‘é€æ•°æ®ä¹‹å‰å…ˆæ£€æµ‹æ€»çº¿ä¸Šæ˜¯å¦ç©ºé—²ã€‚å¦‚æœä¿¡é“æ˜¯ç©ºé—²çš„ï¼Œç«‹å³æŠ¢å æ€»çº¿å‘é€ä¿¡æ¯ã€‚å¦‚æœä¿¡é“å¿™ï¼Œåˆ™é€€é¿ä¸€æ®µæ—¶é—´å†å°è¯•ã€‚\n  2. è¾¹å¬è¾¹å‘ï¼šå½“ä¸€ä¸ªèŠ‚ç‚¹å°†å¼€å§‹å‘é€æ•°æ®åï¼Œåœ¨ä¼ é€çš„è¿‡ç¨‹ä¸­å‘é€è€…è¦è¾¹å‘é€è¾¹ç›‘å¬(listen while talking)\n  3. å†²çªåœæ­¢ï¼šå¦‚æœç›‘æµ‹åˆ°çš„ä¿¡æ¯ä¸å‘å‡ºçš„ä¸ä¸€è‡´ï¼Œè¯´æ˜å‘ç”Ÿäº†å†²çªï¼Œåˆ™åœæ­¢å‘é€ï¼Œå¹¶å‘é€ä¸€ä¸²é˜»å¡ä¿¡å·ä»¥åŠ å¼ºå†²çªã€‚\n  4. éšæœºå»¶è¿Ÿåé‡å‘ï¼šå»¶è¿Ÿä¸€ä¸ªéšæœºæ—¶é—´ç‰‡å†å»ä¾¦å¬æ€»çº¿ï¼Œå»¶è¿Ÿæ—¶é—´çŸ­çš„èŠ‚ç‚¹å…ˆæŠ¢å æ€»çº¿ã€‚\n\n##### äº‰ç”¨æœŸ\n\n##### æœ€çŸ­å¸§é•¿\n\näº¤æ¢æœºçš„è½¬å‘æ–¹å¼æœ‰ä¸¤ç§ï¼š1ã€ç›´é€šæ–¹å¼ï¼ˆç›´æ¥è½¬å‘ï¼‰ï¼›2ã€å­˜å‚¨è½¬å‘\n\nç›´æ¥è½¬å‘æœ‰æ—¶åªå…è®¸è½¬å‘é•¿åº¦å¤§äº64å­—èŠ‚çš„å¸§ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ\n\nç”µç£æ³¢åœ¨æ€»çº¿ä¸Šæ€»æ˜¯ä»¥æœ‰é™çš„é€Ÿç‡ä¼ æ’­çš„ï¼Œæ˜¯æœ‰æ—¶å»¶çš„ã€‚å¦‚æœæ€»çº¿ä¸Šä¼ è¾“ä¸­çš„å¸§å¾ˆçŸ­ï¼Œå¯èƒ½ç”µç£æ³¢ä¾¦å¬ä¸åˆ°ï¼Œå°±è¯¯ä»¥ä¸ºä¿¡é“æ˜¯ç©ºé—²çš„ã€‚\n\n# äº¤æ¢å±€åŸŸç½‘\n\n## åœ¨æ•°æ®é“¾è·¯å±‚æ‰©å±•ä»¥å¤ªç½‘\n\n### ç½‘æ¡¥\n\n* æœ€åˆäººä»¬ä½¿ç”¨çš„æ˜¯**ç½‘æ¡¥**ï¼Œç½‘æ¡¥å¯¹æ”¶åˆ°çš„å¸§æ ¹æ®å…¶MACå¸§çš„ç›®çš„åœ°å€è¿›è¡Œ**è½¬å‘**å’Œ**è¿‡æ»¤**ã€‚å½“**ç½‘æ¡¥æ”¶åˆ°ä¸€ä¸ªå¸§æ—¶ï¼Œå¹¶ä¸æ˜¯å‘æ‰€æœ‰çš„ç«¯å£è½¬å‘æ­¤å¸§ï¼Œè€Œæ˜¯æ ¹æ®æ­¤å¸§çš„ç›®çš„MACåœ°å€ï¼ŒæŸ¥æ‰¾ç½‘æ¡¥ä¸­çš„åœ°å€è¡¨ï¼Œç„¶åç¡®å®šå°†è¯¥å¸§è½¬å‘åˆ°å“ªä¸€ä¸ªç«¯å£**ï¼Œæˆ–è€…æ˜¯æŠŠå®ƒä¸¢å¼ƒï¼ˆå³è¿‡æ»¤ï¼‰ã€‚\n\n### äº¤æ¢å¼é›†çº¿å™¨\n\n* **äº¤æ¢å¼é›†çº¿å™¨(switching hub)**æ·˜æ±°äº†ç½‘æ¡¥ï¼Œå¸¸è¢«ç§°ä¸ºä»¥å¤ªç½‘**äº¤æ¢æœº(switch)**æˆ–**ç¬¬äºŒå±‚äº¤æ¢æœº(L2 switch)**ï¼Œç¬¬äºŒå±‚çš„æ„æ€æ˜¯å¼ºè°ƒè¿™ç§äº¤æ¢æœºå·¥ä½œåœ¨æ•°æ®é“¾è·¯å±‚ã€‚ä»¥å¤ªç½‘äº¤æ¢æœºçš„æ€§èƒ½è¿œè¿œè¶…è¿‡æ™®é€šçš„é›†çº¿å™¨ï¼Œè€Œä¸”ä»·æ ¼ä¹Ÿä¸è´µï¼Œè¿™å°±ä½¿å·¥ä½œåœ¨ç‰©ç†å±‚çš„é›†çº¿å™¨é€æ¸åœ°é€€å‡ºäº†å¸‚åœºã€‚\n* ä»¥å¤ªç½‘äº¤æ¢æœºå®è´¨ä¸Šå°±æ˜¯ä¸€ä¸ª**å¤šç«¯å£çš„ç½‘æ¡¥**ï¼Œé€šå¸¸éƒ½æœ‰åå‡ ä¸ªæˆ–æ›´å¤šçš„ç«¯å£ï¼Œå’Œå·¥ä½œåœ¨ç‰©ç†å±‚çš„è½¬å‘å™¨ã€é›†çº¿å™¨æœ‰å¾ˆå¤§çš„å·®åˆ«ã€‚\n* ä»¥å¤ªç½‘äº¤æ¢æœºçš„æ¯ä¸ªç«¯å£éƒ½ç›´æ¥ä¸ä¸€ä¸ªå•å°ä¸»æœºæˆ–å¦ä¸€ä¸ªä»¥å¤ªç½‘äº¤æ¢æœºç›¸è¿ï¼Œä¸€èˆ¬éƒ½ä»¥å…¨åŒå·¥æ–¹å¼å·¥ä½œã€‚\n* å…·æœ‰å¹¶è¡Œæ€§ï¼Œå³å¯ä»¥åŒæ—¶è¿é€šå¤šå¯¹ç«¯å£ï¼Œä½¿å¤šå¯¹ä¸»æœºèƒ½å¤ŸåŒæ—¶é€šä¿¡ï¼ˆå³å¯ä»¥ä¸€æ¬¡åˆ†æã€è½¬å‘å¤šä¸ªå¸§ï¼‰ã€‚\n* ç›¸äº’é€šä¿¡çš„ä¸»æœºéƒ½ç‹¬å ä¼ è¾“åª’ä½“ï¼Œ**æ— ç¢°æ’**åœ°ä¼ è¾“æ•°æ®ã€‚æ¢å¥è¯è¯´ï¼Œ**æ¯ä¸€ä¸ªç«¯å£å’Œè¿æ¥åˆ°ç«¯å£çš„ä¸»æœºæ„æˆäº†ä¸€ä¸ªç¢°æ’åŸŸï¼Œå…·æœ‰Nä¸ªç«¯å£çš„ä»¥å¤ªç½‘äº¤æ¢æœºçš„ç¢°æ’åŸŸå…±æœ‰Nä¸ª**ã€‚å¯¹äºä¼ ç»Ÿçš„10 Mbit/s çš„å…±äº«å¼ä»¥å¤ªç½‘ï¼Œè‹¥å…±æœ‰10 ä¸ªç”¨æˆ·ï¼Œåˆ™æ¯ä¸ªç”¨æˆ·å æœ‰çš„å¹³å‡å¸¦å®½åªæœ‰1 Mbit/sã€‚\n  * è‹¥ä½¿ç”¨ä»¥å¤ªç½‘äº¤æ¢æœºæ¥è¿æ¥è¿™äº›ä¸»æœºï¼Œè™½ç„¶åœ¨æ¯ä¸ªç«¯å£åˆ°ä¸»æœºçš„å¸¦å®½è¿˜æ˜¯10Mbit/sï¼Œä½†ç”±äºä¸€ä¸ªç”¨æˆ·åœ¨é€šä¿¡æ—¶æ˜¯ç‹¬å è€Œä¸æ˜¯å’Œå…¶ä»–ç½‘ç»œç”¨æˆ·å…±äº«ä¼ è¾“åª’ä½“çš„å¸¦å®½ï¼Œå› æ­¤å¯¹äºæ‹¥æœ‰10ä¸ªç«¯å£çš„äº¤æ¢æœºçš„æ€»å®¹é‡åˆ™ä¸º100Mbit/sã€‚è¿™æ­£æ˜¯äº¤æ¢æœºçš„æœ€å¤§ä¼˜ç‚¹ã€‚\n* ä»¥å¤ªç½‘äº¤æ¢æœºçš„è¾“å‡ºæ¥å£è®¾æœ‰ç¼“å†²å­˜å‚¨å™¨ï¼Œéå¸¸ç±»ä¼¼äºè·¯ç”±å™¨æ¥å£çš„ç¼“å­˜ã€‚å› æ­¤ï¼Œå¦‚æœè¿æ¥åœ¨ä»¥å¤ªç½‘äº¤æ¢æœºä¸Šçš„ä¸¤å°ä¸»æœºï¼ŒåŒæ—¶å‘å¦ä¸€å°ä¸»æœºå‘é€å¸§ï¼Œé‚£ä¹ˆå½“è¿™å°ä¸»æœºçš„ç«¯å£ç¹å¿™æ—¶ï¼Œå‘é€å¸§çš„è¿™ä¸¤å°ä¸»æœºçš„ç«¯å£ä¼šæŠŠæ”¶åˆ°çš„å¸§æš‚å­˜ä¸€ä¸‹ï¼Œä»¥åå†å‘é€å‡ºå»ã€‚\n\n#### ä»æ€»çº¿ä»¥å¤ªç½‘åˆ°æ˜Ÿå½¢ä»¥å¤ªç½‘\n\nä¼ ç»Ÿçš„ç”µè¯ç½‘æ˜¯æ˜Ÿå½¢ç»“æ„ï¼Œå…¶ä¸­å¿ƒå°±æ˜¯ç”µè¯äº¤æ¢æœºã€‚é‚£ä¹ˆåœ¨20ä¸–çºª70å¹´ä»£ä¸­æœŸå‡ºç°çš„å±€åŸŸç½‘ï¼Œä¸ºä»€ä¹ˆä¸é‡‡ç”¨è¿™ç§æ˜Ÿå½¢ç»“æ„å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºåœ¨å½“æ—¶çš„æŠ€æœ¯æ¡ä»¶ä¸‹ï¼Œè¿˜å¾ˆéš¾ç”¨å»‰ä»·çš„æ–¹æ³•åˆ¶é€ å‡ºé«˜å¯é æ€§çš„ä»¥å¤ªç½‘äº¤æ¢æœºã€‚æ‰€ä»¥é‚£æ—¶çš„ä»¥å¤ªç½‘å°±é‡‡ç”¨æ— æºçš„æ€»çº¿ç»“æ„ã€‚è¿™ç§æ€»çº¿å¼ä»¥å¤ªç½‘ä¸€é—®ä¸–å°±å—åˆ°å¹¿å¤§ç”¨æˆ·çš„æ¬¢è¿ï¼Œå¹¶è·å¾—äº†å¾ˆå¿«çš„å‘å±•ã€‚\n\nç„¶è€Œéšç€ä»¥å¤ªç½‘ä¸Šç«™ç‚¹æ•°ç›®çš„å¢å¤šï¼Œä½¿å¾—æ€»çº¿ç»“æ„ä»¥å¤ªç½‘çš„å¯é æ€§ä¸‹é™ã€‚ä¸æ­¤åŒæ—¶ï¼Œå¤§è§„æ¨¡é›†æˆç”µè·¯ä»¥åŠä¸“ç”¨èŠ¯ç‰‡çš„å‘å±•ï¼Œä½¿å¾—æ˜Ÿå½¢ç»“æ„çš„ä»¥å¤ªç½‘äº¤æ¢æœºå¯ä»¥åšå¾—æ—¢ä¾¿å®œåˆå¯é ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé‡‡ç”¨ä»¥å¤ªç½‘äº¤æ¢æœºçš„æ˜Ÿå½¢ç»“æ„å°±æˆä¸ºä»¥å¤ªç½‘çš„é¦–é€‰æ‹“æ‰‘ï¼Œè€Œä¼ ç»Ÿçš„æ€»çº¿ä»¥å¤ªç½‘ä¹Ÿå¾ˆå¿«ä»å¸‚åœºä¸Šæ¶ˆå¤±äº†ã€‚\n\næ€»çº¿ä»¥å¤ªç½‘ä½¿ç”¨CSMA/CDåè®®ï¼Œä»¥åŠåŒå·¥æ–¹å¼å·¥ä½œã€‚ä½†ä»¥å¤ªç½‘äº¤æ¢æœºä¸ä½¿ç”¨å…±äº«æ€»çº¿ï¼Œæ²¡æœ‰ç¢°æ’é—®é¢˜ï¼Œå› æ­¤ä¸ä½¿ç”¨CSMA/CDåè®®ï¼Œè€Œæ˜¯ä»¥å…¨åŒå·¥æ–¹å¼å·¥ä½œã€‚\n\næ—¢ç„¶è¿ä»¥å¤ªç½‘çš„é‡è¦åè®®CSMA/CDéƒ½ä¸ä½¿ç”¨äº†ï¼ˆç›¸å…³çš„â€œäº‰ç”¨æœŸâ€ä¹Ÿæ²¡æœ‰äº†ï¼‰ï¼Œä¸ºä»€ä¹ˆè¿˜å«ä½œä»¥å¤ªç½‘å‘¢ï¼ŸåŸå› å°±æ˜¯**å®ƒçš„å¸§ç»“æ„æœªæ”¹å˜ï¼Œä»ç„¶é‡‡ç”¨ä»¥å¤ªç½‘çš„å¸§ç»“æ„**ã€‚è¿™ä¹Ÿå°±å¯¹åº”äº†ï¼šâ€œäº¤æ¢æœºå¯¹äºä¸»æœºæ¥è¯´æ˜¯é€æ˜çš„ï¼Œä¸»æœºæ€»ä»¥ä¸ºè‡ªå·±åœ¨æ€»çº¿ä¸Šè¿›è¡Œé€šä¿¡ã€‚â€\n\n### äº¤æ¢æœºçš„è½¬å‘æ–¹å¼ï¼ˆäº¤æ¢æ–¹å¼ï¼‰\n\nè™½ç„¶è®¸å¤šä»¥å¤ªç½‘äº¤æ¢æœºå¯¹æ”¶åˆ°çš„å¸§é‡‡ç”¨**å­˜å‚¨è½¬å‘æ–¹å¼**è¿›è¡Œè½¬å‘ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›äº¤æ¢æœºé‡‡ç”¨**ç›´é€š(cut-through)çš„äº¤æ¢æ–¹å¼**ã€‚\n\nç›´é€šäº¤æ¢ä¸å¿…æŠŠæ•´ä¸ªæ•°æ®å¸§å…ˆç¼“å­˜åå†è¿›è¡Œå¤„ç†ï¼Œè€Œæ˜¯åœ¨**æ¥æ”¶æ•°æ®å¸§çš„åŒæ—¶**å°±**ç«‹å³**åœ°**æŒ‰æ•°æ®å¸§çš„ç›®çš„MACåœ°å€å†³å®šè¯¥å¸§çš„è½¬å‘ç«¯å£**ï¼Œå› è€Œæé«˜äº†å¸§çš„è½¬å‘é€Ÿåº¦ã€‚å¦‚æœåœ¨è¿™ç§äº¤æ¢æœºçš„å†…éƒ¨é‡‡ç”¨åŸºäºç¡¬ä»¶çš„äº¤å‰çŸ©é˜µï¼Œäº¤æ¢æ—¶å»¶å°±éå¸¸å°ã€‚ç›´é€šäº¤æ¢çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯å®ƒä¸æ£€æŸ¥å·®é”™å°±ç›´æ¥å°†å¸§è½¬å‘å‡ºå»ï¼Œå› æ­¤æœ‰å¯èƒ½ä¹Ÿå°†ä¸€äº›æ— æ•ˆå¸§è½¬å‘ç»™å…¶ä»–çš„ç«™ã€‚\n\nåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä»éœ€è¦é‡‡ç”¨åŸºäºè½¯ä»¶çš„å­˜å‚¨è½¬å‘æ–¹å¼è¿›è¡Œäº¤æ¢ï¼Œä¾‹å¦‚å½“éœ€è¦è¿›è¡Œçº¿è·¯é€Ÿç‡åŒ¹é…ã€åè®®è½¬æ¢æˆ–å·®é”™æ£€æµ‹æ—¶ã€‚\n\nç°åœ¨æœ‰çš„å‚å•†å·²ç”Ÿäº§å‡ºèƒ½æ”¯æŒä¸¤ç§äº¤æ¢æ–¹å¼çš„ä»¥å¤ªç½‘äº¤æ¢æœºã€‚ä»¥å¤ªç½‘äº¤æ¢æœºçš„å‘å±•ä¸å»ºç­‘ç‰©ç»“æ„åŒ–å¸ƒçº¿ç³»ç»Ÿçš„æ™®åŠåº”ç”¨å¯†åˆ‡ç›¸å…³ã€‚åœ¨ç»“æ„åŒ–å¸ƒçº¿ç³»ç»Ÿä¸­ï¼Œå¹¿æ³›åœ°ä½¿ç”¨äº†ä»¥å¤ªç½‘äº¤æ¢æœºã€‚\n\n### äº¤æ¢æœºçš„åœ°å€è¡¨\n\nä»¥å¤ªç½‘äº¤æ¢æœºæ˜¯ä¸€ç§å³æ’å³ç”¨è®¾å¤‡ï¼Œå…¶å†…éƒ¨çš„å¸§**äº¤æ¢è¡¨ï¼ˆåˆç§°ä¸ºåœ°å€è¡¨ï¼‰**æ˜¯é€šè¿‡**è‡ªå­¦ä¹ ç®—æ³•**è‡ªåŠ¨åœ°é€æ¸å»ºç«‹èµ·æ¥çš„ã€‚å®é™…ä¸Šï¼Œè¿™ç§äº¤æ¢è¡¨å°±æ˜¯ä¸€ä¸ª**å†…å®¹å¯å¯»å€å­˜å‚¨å™¨CAM(Content Addressable Memory)**ã€‚ä»¥å¤ªç½‘äº¤æ¢æœºç”±äºä½¿ç”¨äº†ä¸“ç”¨çš„äº¤æ¢ç»“æ„èŠ¯ç‰‡ï¼Œäº¤æ¢æœºçš„ç¡¬ä»¶è½¬å‘å¸§çš„è½¬å‘é€Ÿç‡è¦æ¯”ä½¿ç”¨è½¯ä»¶è½¬å‘çš„ç½‘æ¡¥å¿«å¾ˆå¤šã€‚\n\n* äº¤æ¢æœºçš„è‡ªå­¦ä¹ åŠŸèƒ½\n  * å‡å®šåœ¨å›¾ä¸­çš„ä»¥å¤ªç½‘äº¤æ¢æœºæœ‰4ä¸ªç«¯å£ï¼Œå„è¿æ¥ä¸€å°è®¡ç®—æœºï¼Œå…¶MACåœ°å€åˆ†åˆ«æ˜¯A, B, Cå’ŒDã€‚äº¤æ¢è¡¨æœ€é‡è¦çš„å°±æ˜¯ä¸¤ä¸ªå­—æ®µï¼š**ç›®çš„MACåœ°å€**å’Œ**ç›¸åº”çš„è½¬å‘ç«¯å£**ã€‚åœ¨ä¸€å¼€å§‹ï¼Œä»¥å¤ªç½‘äº¤æ¢æœºé‡Œé¢çš„äº¤æ¢è¡¨æ˜¯ç©ºçš„ã€‚\n![image-20220311154911596](../../images/ç½‘ç»œ_æ•°æ®é“¾è·¯å±‚/image-20220311154911596.png)\n  * å‡å®šAå…ˆå‘Bå‘é€ä¸€å¸§ï¼Œä»ç«¯å£1è¿›å…¥åˆ°äº¤æ¢æœºã€‚äº¤æ¢æœºæ”¶åˆ°å¸§åï¼Œå…ˆæŸ¥æ‰¾äº¤æ¢è¡¨ã€‚ç°åœ¨è¡¨ä¸­æ²¡æœ‰Bçš„åœ°å€ã€‚äºæ˜¯ï¼Œ**äº¤æ¢æœºæŠŠæ­¤å¸§çš„æºåœ°å€Aå’Œç«¯å£1å†™å…¥äº¤æ¢è¡¨**ä¸­ï¼Œå¹¶**å‘é™¤ç«¯å£1ä»¥å¤–çš„æ‰€æœ‰ç«¯å£å¹¿æ’­è¿™ä¸ªå¸§**ã€‚å¦‚æ­¤å¹¿æ’­å‘é€å°±å¯ä¿è¯Bæ”¶åˆ°è¿™ä¸ªå¸§ï¼Œè€Œ**å…¶ä»–ç«¯å£**Cå’ŒDåœ¨æ”¶åˆ°å¸§åï¼Œ**å› ç›®çš„åœ°å€ä¸åŒ¹é…å°†ä¸¢å¼ƒæ­¤å¸§**ã€‚è¿™ä¸€è¿‡ç¨‹ä¹Ÿç§°ä¸º**è¿‡æ»¤**ã€‚\n  * ç”±äºåœ¨äº¤æ¢è¡¨ä¸­å†™å…¥äº†é¡¹ç›®(A, 1)ï¼Œå› æ­¤ä»¥åä¸ç®¡ä»å“ªä¸ªç«¯å£æ”¶åˆ°å¸§ï¼Œåªè¦å…¶ç›®çš„åœ°å€æ˜¯Aï¼Œå°±æŠŠæ”¶åˆ°çš„å¸§ä»ç«¯å£1è½¬å‘å‡ºå»é€äº¤Aã€‚\n  * æ¥ä¸‹æ¥å‡å®šBé€šè¿‡ç«¯å£3å‘Aå‘é€ä¸€å¸§ã€‚äº¤æ¢æœºæŸ¥æ‰¾äº¤æ¢è¡¨ï¼Œå‘ç°äº¤æ¢è¡¨ä¸­çš„MACåœ°å€æœ‰Aï¼Œè¡¨æ˜å‡¡æ˜¯å‘ç»™Açš„å¸§ï¼ˆå³ç›®çš„åœ°å€ä¸ºAçš„å¸§ï¼‰ï¼Œéƒ½åº”ä»ç«¯å£1è½¬å‘ç»™Aã€‚æ˜¾ç„¶ï¼Œ**ç°åœ¨åº”ç›´æ¥æŠŠæ”¶åˆ°çš„å¸§ä»ç«¯å£1è½¬å‘ç»™Aï¼Œè€Œæ²¡æœ‰å¿…è¦å†å¹¿æ’­æ”¶åˆ°çš„å¸§**ã€‚äº¤æ¢è¡¨è¿™æ—¶ç”¨æºåœ°å€Bå†™å…¥ä¸€ä¸ªé¡¹ç›®(B, 3)ï¼Œè¡¨æ˜ä»Šåå¦‚æœ‰å‘é€ç»™Bçš„å¸§ï¼Œåº”ä»ç«¯å£3è½¬å‘ç»™Bã€‚\n![image-20220311155521369](../../images/ç½‘ç»œ_æ•°æ®é“¾è·¯å±‚/image-20220311155521369.png)\n  * ç»è¿‡ä¸€æ®µæ—¶é—´åï¼Œåªè¦ä¸»æœºCå’ŒDä¹Ÿå‘å…¶ä»–ä¸»æœºå‘é€å¸§ï¼Œä»¥å¤ªç½‘äº¤æ¢æœºä¸­çš„äº¤æ¢è¡¨å°±ä¼šæŠŠè½¬å‘åˆ°Cæˆ–Dåº”å½“ç»è¿‡çš„ç«¯å£å·ï¼ˆ2æˆ–4ï¼‰å†™å…¥äº¤æ¢è¡¨ä¸­ã€‚è¿™æ ·ï¼Œäº¤æ¢è¡¨ä¸­çš„é¡¹ç›®å°±é€æ¸å¢å¤šäº†ã€‚\n  * è€ƒè™‘åˆ°æœ‰æ—¶å¯èƒ½è¦åœ¨äº¤æ¢æœºçš„ç«¯å£æ›´æ¢ä¸»æœºï¼Œæˆ–è€…ä¸»æœºè¦æ›´æ¢å…¶ç½‘ç»œé€‚é…å™¨ï¼Œè¿™å°±éœ€è¦åŠæ—¶**æ›´æ–°**äº¤æ¢è¡¨ä¸­çš„é¡¹ç›®ã€‚ä¸ºæ­¤ï¼Œ**å½“äº¤æ¢è¡¨ä¸­å†™å…¥ä¸€ä¸ªé¡¹ç›®æ—¶å°±è®°ä¸‹å½“æ—¶çš„æ—¶é—´ï¼Œåªè¦è¶…è¿‡é¢„å…ˆè®¾å®šçš„æ—¶é—´ï¼ˆä¾‹å¦‚300ç§’ï¼‰ï¼Œè¯¥é¡¹ç›®å°±è‡ªåŠ¨è¢«åˆ é™¤**ã€‚ç”¨è¿™æ ·çš„æ–¹æ³•ä¿è¯äº¤æ¢è¡¨ä¸­çš„æ•°æ®éƒ½ç¬¦åˆå½“å‰ç½‘ç»œçš„å®é™…çŠ¶å†µã€‚è¿™å°±æ˜¯è¯´ï¼Œå›¾ä¸­çš„äº¤æ¢è¡¨**å®é™…ä¸Šæ˜¯æœ‰ä¸‰åˆ—ï¼Œå³MACåœ°å€ã€ç«¯å£å’Œå†™å…¥æ—¶é—´**ã€‚\n  * ä»¥å¤ªç½‘äº¤æ¢æœºçš„è¿™ç§è‡ªå­¦ä¹ æ–¹æ³•ä½¿å¾—ä»¥å¤ªç½‘äº¤æ¢æœºèƒ½å¤Ÿå³æ’å³ç”¨ï¼Œä¸å¿…äººå·¥è¿›è¡Œé…ç½®ï¼Œå› æ­¤éå¸¸æ–¹ä¾¿ã€‚\n\n## é“¾è·¯å±‚å¯»å€å’ŒARP\n\n# è™šæ‹Ÿå±€åŸŸç½‘\n\nä»¥å¤ªç½‘äº¤æ¢æœºçš„é—®ä¸–ï¼ŒåŠ é€Ÿäº†ä»¥å¤ªç½‘çš„æ™®åŠåº”ç”¨ã€‚ä¸€ä¸ªä»¥å¤ªç½‘äº¤æ¢æœºå¯ä»¥éå¸¸æ–¹ä¾¿åœ°è¿æ¥å‡ åå°è®¡ç®—æœºï¼Œæ„æˆä¸€ä¸ªæ˜Ÿå½¢ä»¥å¤ªç½‘ã€‚ä½†æ˜¯ï¼Œå½“ä¸€ä¸ªä»¥å¤ªç½‘åŒ…å«çš„è®¡ç®—æœºå¤ªå¤šæ—¶ï¼Œå¾€å¾€ä¼šå¸¦æ¥ä¸¤ä¸ªç¼ºç‚¹ã€‚\n\né¦–å…ˆï¼Œä¸€ä¸ªä»¥å¤ªç½‘æ˜¯ä¸€ä¸ªå¹¿æ’­åŸŸã€‚åœ¨ä»¥å¤ªç½‘ä¸Šç»å¸¸ä¼šå‡ºç°å¤§é‡çš„å¹¿æ’­å¸§ã€‚åœ¨äº¤æ¢æœºçš„äº¤æ¢è¡¨çš„å»ºç«‹è¿‡ç¨‹ä¸­è¦ä½¿ç”¨è®¸å¤šå¹¿æ’­å¸§ã€‚ç»å¸¸ä½¿ç”¨çš„ARPå’ŒDHCP åè®®ï¼Œä¹Ÿéƒ½è¦åœ¨ä»¥å¤ªç½‘ä¸­ä¼ é€å¾ˆå¤šçš„å¹¿æ’­å¸§ã€‚åœ¨ä¸€ä¸ªä¸»æœºæ•°é‡å¾ˆå¤§çš„ä»¥å¤ªç½‘ä¸Šä¼ æ’­å¹¿æ’­å¸§ï¼Œå¿…ç„¶ä¼šæ¶ˆè€—å¾ˆå¤šçš„ç½‘ç»œèµ„æºã€‚å¦‚æœç½‘ç»œçš„é…ç½®å‡ºäº†äº›å·®é”™ï¼Œå°±æœ‰å¯èƒ½å‘ç”Ÿå¹¿æ’­å¸§åœ¨ç½‘ç»œä¸­æ— é™åˆ¶åœ°å…œåœˆå­ï¼Œå½¢æˆäº†â€œå¹¿æ’­é£æš´â€ï¼Œä½¿æ•´ä¸ªçš„ç½‘ç»œç˜«ç—ªã€‚\n\nå…¶æ¬¡ï¼Œä¸€ä¸ªå•ä½çš„ä»¥å¤ªç½‘å¾€å¾€ä¸ºå¥½å‡ ä¸ªä¸‹å±éƒ¨é—¨æ‰€å…±äº«ã€‚ä½†æœ‰äº›éƒ¨é—¨çš„ä¿¡æ¯æ˜¯éœ€è¦ä¿å¯†çš„ï¼ˆä¾‹å¦‚ï¼Œè´¢åŠ¡éƒ¨é—¨æˆ–äººäº‹éƒ¨é—¨ï¼‰ã€‚è®¸å¤šéƒ¨é—¨å…±äº«ä¸€ä¸ªå±€åŸŸç½‘å¯¹ä¿¡æ¯å®‰å…¨ä¸åˆ©ã€‚\n\nå¦‚æœä½¿æ¯ä¸€ä¸ªå°éƒ¨é—¨å„æ‹¥æœ‰è‡ªå·±çš„è¾ƒå°çš„å±€åŸŸç½‘ï¼Œé‚£ä¹ˆè¿™ä¸ä½†å¯ä½¿å±€åŸŸç½‘çš„å¹¿æ’­åŸŸèŒƒå›´ç¼©å°ï¼ŒåŒæ—¶ä¹Ÿæé«˜äº†å±€åŸŸç½‘çš„å®‰å…¨æ€§ã€‚åœ¨ä»¥å¤ªç½‘äº¤æ¢æœºå‡ºç°åï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çµæ´»åœ°å»ºç«‹è™šæ‹Ÿå±€åŸŸç½‘VLAN (Virtual LAN)ã€‚è¿™æ ·å°±æŠŠä¸€ä¸ªè¾ƒå¤§çš„å±€åŸŸç½‘ï¼Œåˆ†å‰²æˆä¸ºä¸€äº›è¾ƒå°çš„å±€åŸŸç½‘ï¼Œè€Œæ¯ä¸€ä¸ªå±€åŸŸç½‘æ˜¯ä¸€ä¸ªè¾ƒå°çš„å¹¿æ’­åŸŸã€‚\n\n> åœ¨IEEE 802.1Q æ ‡å‡†ä¸­ï¼Œå¯¹è™šæ‹Ÿå±€åŸŸç½‘VLAN æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š\n> è™šæ‹Ÿå±€åŸŸç½‘VLANæ˜¯**ç”±ä¸€äº›å±€åŸŸç½‘ç½‘æ®µæ„æˆçš„ä¸ç‰©ç†ä½ç½®æ— å…³çš„é€»è¾‘ç»„**ï¼Œè€Œè¿™äº›ç½‘æ®µå…·æœ‰æŸäº›å…±åŒçš„éœ€æ±‚ã€‚æ¯ä¸€ä¸ªVLANçš„å¸§éƒ½æœ‰ä¸€ä¸ªæ˜ç¡®çš„æ ‡è¯†ç¬¦ï¼ŒæŒ‡æ˜å‘é€è¿™ä¸ªå¸§çš„è®¡ç®—æœºå±äºå“ªä¸€ä¸ªVLANã€‚\n\n## è™šæ‹Ÿå±€åŸŸç½‘çš„ä»¥å¤ªç½‘å¸§æ ¼å¼\n\n1988å¹´IEEEæ‰¹å‡†äº†802.3acæ ‡å‡†ï¼Œè¿™ä¸ªæ ‡å‡†å®šä¹‰äº†ä»¥å¤ªç½‘çš„å¸§æ ¼å¼çš„æ‰©å±•ï¼Œä»¥ä¾¿æ”¯æŒè™šæ‹Ÿå±€åŸŸç½‘ã€‚è™šæ‹Ÿå±€åŸŸç½‘åè®®å…è®¸åœ¨ä»¥å¤ªç½‘çš„å¸§æ ¼å¼ä¸­æ’å…¥ä¸€ä¸ª4å­—èŠ‚çš„æ ‡è¯†ç¬¦ï¼Œç§°ä¸ºVLANæ ‡ç­¾(tag)ï¼Œç”¨æ¥æŒ‡æ˜å‘é€è¯¥å¸§çš„è®¡ç®—æœºå±äºå“ªä¸€ä¸ªè™šæ‹Ÿå±€åŸŸç½‘ã€‚æ’å…¥VLANæ ‡ç­¾çš„å¸§ç§°ä¸º802.1Qå¸§ã€‚æ‰€ä»¥è™šæ‹Ÿå±€åŸŸç½‘å…¶å®åªæ˜¯å±€åŸŸç½‘ç»™ç”¨æˆ·æä¾›çš„ä¸€ç§æ‹“å±•æœåŠ¡ï¼Œè€Œå¹¶ä¸æ˜¯ä¸€ç§æ–°å‹å±€åŸŸç½‘ã€‚\n![image-20220311162303692](../../images/ç½‘ç»œ_æ•°æ®é“¾è·¯å±‚/image-20220311162303692.png)\n\nVLANæ ‡ç­¾å­—æ®µçš„é•¿åº¦æ˜¯4å­—èŠ‚ï¼Œæ’å…¥åœ¨ä»¥å¤ªç½‘MACå¸§çš„æºåœ°å€å­—æ®µå’Œç±»å‹å­—æ®µä¹‹é—´ã€‚VLANæ ‡ç­¾çš„å‰ä¸¤ä¸ªå­—èŠ‚æ€»æ˜¯è®¾ç½®ä¸º0x8100ï¼ˆå³äºŒè¿›åˆ¶çš„10000001 00000000ï¼‰ï¼Œç§°ä¸ºIEEE 802.1Qæ ‡ç­¾ç±»å‹ã€‚\n\nVLANæ ‡ç­¾çš„åä¸¤ä¸ªå­—èŠ‚ä¸­ï¼Œå‰é¢4ä½å®é™…ä¸Šæ²¡æœ‰ä»€ä¹ˆä½œç”¨ï¼Œè¿™é‡Œä¸è®¨è®ºã€‚**åé¢çš„12ä½æ˜¯è¯¥è™šæ‹Ÿå±€åŸŸç½‘VLANæ ‡è¯†ç¬¦VID (VLAN ID)**ï¼Œå®ƒå”¯ä¸€åœ°æ ‡å¿—äº†802.1Qå¸§å±äºå“ªä¸€ä¸ªVLANã€‚12ä½çš„VIDå¯è¯†åˆ«4096ä¸ªä¸åŒçš„VLANã€‚\n\næ’å…¥VLANæ ‡ç­¾åï¼Œ802.1Qå¸§æœ€åçš„å¸§æ£€éªŒåºåˆ—FCSå¿…é¡»é‡æ–°è®¡ç®—ã€‚\n\nå½“æ•°æ®é“¾è·¯å±‚æ£€æµ‹åˆ°MACå¸§çš„æºåœ°å€å­—æ®µåé¢çš„ä¸¤ä¸ªå­—èŠ‚çš„å€¼æ˜¯0x8100æ—¶ï¼Œå°±çŸ¥é“ç°åœ¨æ’å…¥äº†4å­—èŠ‚çš„VLANæ ‡ç­¾ã€‚ç”±äºç”¨äºVLANçš„ä»¥å¤ªç½‘å¸§çš„é¦–éƒ¨å¢åŠ äº†4ä¸ªå­—èŠ‚ï¼Œå› æ­¤ä»¥å¤ªç½‘çš„æœ€å¤§å¸§é•¿ä»åŸæ¥çš„1518å­—èŠ‚ï¼ˆ1500å­—èŠ‚çš„æ•°æ®åŠ ä¸Š18å­—èŠ‚çš„é¦–éƒ¨å’Œå°¾éƒ¨ï¼‰å˜ä¸º1522å­—èŠ‚ã€‚\n\n### ä¾‹å­\n\nè¿™æ ·çš„802.1Qå¸§åœ¨ä»€ä¹ˆåœ°æ–¹ä½¿ç”¨å‘¢ï¼Ÿç”¨ç®€å•ä¾‹å­æ¥è¯´æ˜ã€‚\n![image-20220311163430309](../../images/ç½‘ç»œ_æ•°æ®é“¾è·¯å±‚/image-20220311163430309.png)\n\näº¤æ¢æœº#1è¿æ¥äº†7å°è®¡ç®—æœºï¼Œç»„æˆäº†ä¸€ä¸ªå±€åŸŸç½‘ï¼ˆä¸€ä¸ªå¹¿æ’­åŸŸï¼‰ã€‚ç°åœ¨æŠŠå±€åŸŸç½‘åˆ’åˆ†ä¸ºä¸¤ä¸ªè™šæ‹Ÿå±€åŸŸç½‘VLAN-10å’ŒVLAN-20ã€‚è¿™é‡Œçš„10å’Œ20æ˜¯è™šæ‹Ÿå±€åŸŸç½‘çš„ç¼–å·ï¼Œå³VIDå­—æ®µçš„å€¼ï¼Œç”±äº¤æ¢æœºç®¡ç†äººå‘˜è®¾å®šã€‚\n\nç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸¤ä¸ªè¾ƒå°çš„å¹¿æ’­åŸŸã€‚æ¯å°è®¡ç®—æœºéƒ½æ˜¯é€šè¿‡æ¥å…¥é“¾è·¯(access link)è¿æ¥åˆ°ä»¥å¤ªç½‘äº¤æ¢æœºçš„ã€‚ç®¡ç†äººå‘˜åˆ’åˆ†è™šæ‹Ÿå±€åŸŸç½‘çš„æ–¹æ³•æœ‰å¤šç§ã€‚ä¾‹å¦‚ï¼ŒæŒ‰äº¤æ¢æœºçš„ç«¯å£åˆ’åˆ†ï¼Œæˆ–æŒ‰MACåœ°å€åˆ’åˆ†ã€‚æ¯å°ä¸»æœºå¹¶ä¸çŸ¥é“è‡ªå·±çš„VIDå€¼ï¼ˆä½†äº¤æ¢æœºå¿…é¡»çŸ¥é“è¿™äº›ä¿¡æ¯ï¼‰ã€‚è¿™äº›ä¸»æœºé€šè¿‡æ¥å…¥é“¾è·¯å‘é€åˆ°äº¤æ¢æœºçš„å¸§éƒ½æ˜¯æ ‡å‡†çš„ä»¥å¤ªç½‘å¸§ã€‚\n\n> åœ¨ä¸€ä¸ªç”¨å¤šä¸ªäº¤æ¢æœºè¿æ¥èµ·æ¥çš„è¾ƒå¤§çš„å±€åŸŸç½‘ä¸­ï¼Œå¯ä»¥çµæ´»åœ°åˆ’åˆ†è™šæ‹Ÿå±€åŸŸç½‘ï¼Œä¸å—åœ°ç†ä½ç½®çš„é™åˆ¶ã€‚ä¸€ä¸ªè™šæ‹Ÿå±€åŸŸç½‘çš„èŒƒå›´å¯ä»¥è·¨è¶Šä¸åŒçš„äº¤æ¢æœºã€‚å½“ç„¶ï¼Œæ‰€ä½¿ç”¨çš„äº¤æ¢æœºå¿…é¡»è¦èƒ½å¤Ÿè¯†åˆ«å’Œå¤„ç†è™šæ‹Ÿå±€åŸŸç½‘ã€‚åœ¨å›¾ä¸­ï¼Œåœ¨å¦å¤–ä¸€å±‚æ¥¼çš„äº¤æ¢æœº#2è¿æ¥äº†5å°è®¡ç®—æœºï¼Œå¹¶ä¸äº¤æ¢æœº#1ç›¸è¿æ¥ã€‚äº¤æ¢æœº#2ä¸­çš„ä¸¤å°è®¡ç®—æœºåŠ å…¥åˆ°VLAN-10ï¼Œè€Œå¦å¤–3å°åŠ å…¥åˆ°VLAN-20ã€‚è¿™ä¸¤ä¸ªè™šæ‹Ÿå±€åŸŸç½‘è™½ç„¶éƒ½è·¨è¶Šäº†ä¸¤ä¸ªäº¤æ¢æœºï¼Œä½†éƒ½å„è‡ªæ˜¯ä¸€ä¸ªå¹¿æ’­åŸŸï¼Œå³VLAN-10æ˜¯å¤„äºåŒä¸€å¹¿æ’­åŸŸï¼ŒVLAN-20å¤„äºå¦ä¸€ä¸ªå¹¿æ’­åŸŸã€‚\n\n* Aç»™Bå‘ï¼ˆåŒä¸€äº¤æ¢æœºï¼ŒåŒä¸€VLANï¼‰\n\nç°åœ¨å‡å®šAå‘Bå‘é€å¸§ã€‚ç”±äºäº¤æ¢æœº#1èƒ½å¤Ÿæ ¹æ®å¸§é¦–éƒ¨çš„ç›®çš„MACåœ°å€ï¼Œè¯†åˆ«Bå±äºæœ¬äº¤æ¢æœºç®¡ç†çš„VLAN-10ï¼Œå› æ­¤å°±åƒåœ¨æ™®é€šä»¥å¤ªç½‘ä¸­é‚£æ ·ç›´æ¥è¿›è¡Œå¸§çš„è½¬å‘ï¼Œä¸éœ€è¦ä½¿ç”¨VLANæ ‡ç­¾ã€‚è¿™æ˜¯æœ€ç®€å•çš„æƒ…å†µã€‚\n\n* Aç»™Eå‘ï¼ˆåŒä¸€VLANï¼Œè·¨è¶Šäº¤æ¢æœºçš„æƒ…å†µï¼‰\n\n> è¿æ¥ä¸¤ä¸ªäº¤æ¢æœºç«¯å£ä¹‹é—´çš„é“¾è·¯ç§°ä¸º**æ±‡èšé“¾è·¯**(trunk link)æˆ–å¹²çº¿é“¾è·¯ã€‚\n\nç°åœ¨å‡å®šAå‘Eå‘é€å¸§ã€‚äº¤æ¢æœº#1æŸ¥åˆ°Eå¹¶æ²¡æœ‰è¿æ¥åˆ°æœ¬äº¤æ¢æœºï¼Œå› æ­¤å¿…é¡»ä»æ±‡èšé“¾è·¯æŠŠå¸§è½¬å‘åˆ°äº¤æ¢æœº#2ï¼Œä½†åœ¨**è½¬å‘ä¹‹å‰ï¼Œè¦æ’å…¥VLANæ ‡ç­¾**ï¼Œå¦‚æœä¸æ’å…¥VLANæ ‡ç­¾ï¼Œäº¤æ¢æœº#2å°±ä¸çŸ¥é“åº”æŠŠå¸§è½¬å‘ç»™å“ªä¸€ä¸ªVLANã€‚å› æ­¤åœ¨æœ‰è™šæ‹Ÿå±€åŸŸç½‘çš„ä»¥å¤ªç½‘ä¸­çš„æ±‡èšé“¾è·¯ï¼ˆä¸¤ä¸ªäº¤æ¢æœºä¹‹é—´ï¼‰ä¼ é€çš„å¸§æ˜¯802.1Qå¸§ã€‚äº¤æ¢æœº#2åœ¨å‘Eè½¬å‘å¸§ä¹‹å‰ï¼Œè¦æ‹¿èµ°å·²æ’å…¥çš„VLANæ ‡ç­¾ï¼Œå› æ­¤Eæ”¶åˆ°çš„å¸§å°±æ˜¯Aå‘é€çš„æ ‡å‡†ä»¥å¤ªç½‘å¸§ï¼Œè€Œä¸æ˜¯802.1Qå¸§ã€‚ä¸Šå›¾è¯´æ˜äº†è¿™ç§æƒ…å†µã€‚\n\n> æ‰€ä»¥ï¼Œåœ¨æœ‰è™šæ‹Ÿå±€åŸŸç½‘çš„ä»¥å¤ªç½‘ä¸­çš„äº¤æ¢æœºå¯¹äºä¸»æœºæ¥è¯´ä»æ˜¯é€æ˜çš„ï¼Œäº¤æ¢æœºåœ¨è½¬å‘ç»™ä¸»æœºå‰å·²æŠŠVLANçš„4å­—èŠ‚æ ‡ç­¾å¤„ç†ã€‚\n\n* Aç»™Cå‘ï¼ˆåŒä¸€äº¤æ¢æœºï¼Œè·¨è¶ŠVLANï¼‰\n\nå¦‚æœAå‘Cå‘é€å¸§ï¼Œæƒ…å†µåˆæ€æ ·å‘¢ï¼Ÿè¿™ç§æƒ…å†µå°±å¤æ‚äº›äº†ï¼Œå› ä¸ºè¿™æ˜¯åœ¨ä¸åŒç½‘ç»œä¹‹é—´çš„é€šä¿¡ã€‚è™½ç„¶Aå’ŒCéƒ½è¿æ¥åˆ°åŒä¸€ä¸ªäº¤æ¢æœºï¼Œä½†å®ƒä»¬å·²ç»å¤„åœ¨ä¸åŒçš„ç½‘ç»œä¸­ï¼ˆVLAN-10å’ŒVLAN-20ï¼‰ã€‚è¿™é—®é¢˜æ˜¯äº’è¿ç½‘ç»œä¸­çš„é€šä¿¡é—®é¢˜ï¼Œå·²ç»è¶…è¿‡äº†æ•°æ®é“¾è·¯å±‚çš„èŒƒå›´ã€‚è¿™è¦ç”±ç½‘ç»œå±‚ä¸­çš„è·¯ç”±å™¨æ¥è§£å†³ã€‚\n\nä¸è¿‡æœ‰çš„äº¤æ¢æœºä¸­åµŒå…¥äº†ä¸€ä¸ªç”¨ä¸“ç”¨èŠ¯ç‰‡æ„æˆçš„è½¬å‘æ¨¡å—ï¼Œç”¨æ¥åœ¨ä¸åŒçš„VLANä¹‹é—´è½¬å‘å¸§ã€‚è¿™æ ·å°±å¯ä»¥ä¸å¿…å†ä½¿ç”¨å¦å¤–çš„è·¯ç”±å™¨ï¼Œè€Œå°±åœ¨äº¤æ¢æœºä¸­å®ç°äº†ç¬¬3å±‚çš„è½¬å‘åŠŸèƒ½ï¼ˆç”±äºä½¿ç”¨ç¡¬ä»¶è½¬å‘ï¼Œè½¬å‘å¸§çš„é€Ÿç‡æé«˜äº†ï¼Œæ¯”ä½¿ç”¨è·¯ç”±å™¨è¦å¿«ï¼‰ã€‚è¿™ç§è½¬å‘åŠŸèƒ½è¢«ç§°ä¸º**ç¬¬3å±‚äº¤æ¢**ï¼Œè€Œ**è¿™ç§äº¤æ¢æœºå¸¸ç§°ä¸ºL3/L2äº¤æ¢æœº**ã€‚\n\n* Aç»™Få‘ï¼ˆè·¨è¶Šäº¤æ¢æœºï¼Œè·¨è¶ŠVLANï¼‰\n\næœ‰äº†è¿™ç§ç¬¬3å±‚äº¤æ¢æœºï¼Œç”šè‡³äºï¼šè¿æ¥åˆ°ä¸åŒäº¤æ¢æœºçš„Aå’ŒFï¼Œéƒ½å¯ä»¥ä¸éœ€è¦ç»è¿‡å¦å¤–çš„è·¯ç”±å™¨è€Œç›¸äº’é€šä¿¡äº†ã€‚\n","categories":["ç½‘ç»œ"]},{"title":"Cpp_STL_å…³è”å®¹å™¨","url":"/Cpp/Cpp_STL_å…³è”å®¹å™¨/","content":"# å†…å®¹\n\n1. æ— åºå…³è”å®¹å™¨ - unordered\n    1. é“¾å¼å“ˆå¸Œè¡¨ï¼šå¢åˆ æŸ¥O(1)ã€‚é€‚ç”¨äºå¤„ç†æµ·é‡æ•°æ®æŸ¥é‡å¤ã€å»é‡å¤\n    2. `unordered_set`ã€`unordered_multiset`\n    3. `unordered_map`ã€`unordered_multimap`\n2. æœ‰åºå…³è”å®¹å™¨\n    1. çº¢é»‘æ ‘ï¼šå¢åˆ æŸ¥O($log_2 N$)\n    2. `set`ã€`multiset`\n    3. `map`ã€`multimap` \n3. setå’Œmapçš„åŒºåˆ«\n    1. setåªæœ‰keyã€‚\n    2. mapæ¯ä¸€ä¸ªkeyéƒ½å¯¹åº”ä¸€ä¸ªvalueã€‚\n# unordered_set\n\n1. æ’å…¥ï¼šinsert\n2. éå†ï¼šiterator\n3. åˆ é™¤ï¼šeraseï¼Œå¯æŒ‰keyï¼Œä¹Ÿå¯æŒ‰iterator\n\næ— åºsetã€mapçš„è¿­ä»£å™¨æ˜¯forwardç±»å‹ï¼Œåªèƒ½å•å‘ï¼Œä¸èƒ½åŒå‘ã€‚\næ’å…¥é€Ÿåº¦å¿«äºçº¢é»‘æ ‘ï¼Œä½†å¯èƒ½æµªè´¹ç©ºé—´ã€‚å¦‚æœhashæ•ˆæœä¸å¥½ï¼Œå¯èƒ½æ•ˆç‡ä¸é«˜ã€‚\n## æ’å…¥\n```cpp\n#include<unordered_set>\nusing namespace std;\nint main()\n{\n    unordered_set<int> set1;\n    for(int i = 0; i < 50; ++i)\n    {\n        set1.insert(rand() % 20 + 1)ï¼›\n    }\n    cout << set1.size() << endl;\n    cout << set1.count(15) << endl;\n}\n//sizeæ˜¯æŒ‡setå®¹å™¨ç›®å‰æ’å…¥äº†çš„å…ƒç´ æ•°ï¼Œå¯èƒ½ä¸ºå°äºç­‰äº50ï¼Œå› ä¸ºæ’å…¥å·²å­˜åœ¨çš„è¯åˆ™ä¸ä¼šé‡å¤\n//countæ˜¯æŒ‡ç›®æ ‡å€¼åœ¨setå®¹å™¨ä¸­å­˜åœ¨çš„æ•°ç›®ï¼Œåœ¨unordered_setä¸­åªå¯èƒ½ä¸º1ã€0ï¼Œä¸å¯èƒ½å¤§äº1ã€‚\n```\nè¦çŸ¥é“ï¼Œvectorã€dequeã€listçš„æ’å…¥éƒ½éœ€è¦ä¸€ä¸ªiteratoræ‰èƒ½æ’å…¥ï¼Œå› ä¸ºå®ƒä»¬æ˜¯é¡ºåºå®¹å™¨ï¼Œæ²¡æœ‰å…¶ä»–çš„æ¡ä»¶çº¦æŸï¼Œå› æ­¤è¦æ ¹æ®ç¨‹åºå‘˜çš„æŒ‡ä»¤ç”¨è¿­ä»£å™¨æ‰¾ä½ç½®ã€‚\n\nè€Œæ— åºé›†åˆåº•å±‚æ˜¯çº¢é»‘æ ‘ï¼Œæœ‰ä¸¥æ ¼çš„çº¦æŸï¼Œè¦æƒ³æ’å…¥åˆ°é‡Œé¢ï¼Œæ•°æ®ç»“æ„æœ¬èº«å°±ä¼šåœ¨å†…éƒ¨ç»™è¯¥å€¼æ‰¾å¥½ä½ç½®ï¼Œå› æ­¤åªéœ€è¦æä¾›è¦æ’å…¥çš„ä¸œè¥¿å³å¯ã€‚ç±»ä¼¼åœ°ï¼Œä»¥å“ˆå¸Œè¡¨ä¸ºåº•å±‚çš„mapä¹Ÿæ˜¯è¿™æ ·ï¼Œæ’å…¥æ—¶è¿›è¡Œhashè¿ç®—ï¼Œå·²ç»æ— å½¢ä¹‹ä¸­ç¡®å®šå¥½äº†è¦æ’å…¥çš„ä½ç½®äº†ã€‚å› æ­¤ä¸éœ€è¦æä¾›è¿­ä»£å™¨ã€‚\n## éå†\n\n```cpp\nint main()\n{\n    auto it1 = set1.begin();\n    for(; it1 != set1.end(); ++it1)\n    {\n        cout << *it1 << \" \";\n    }\n    cout << endl;\n}\n```\n\nfor-eachè¯­å¥è¿›è¡Œéå†è¾“å‡ºï¼šï¼ˆå®é™…ä¸Šï¼Œfor-eachçš„åº•å±‚å°±æ˜¯ç”¨è¿­ä»£å™¨è¿›è¡Œçš„ï¼‰\n```cpp\nint main()\n{\n    for(int v : set1)\n    {\n        cout << v << \" \";\n    }\n    cout << endl;\n}\n```\n## åˆ é™¤\n\nåˆ é™¤æŸå€¼çš„å…ƒç´ ã€‚\n\n```cpp\nint main()\n{\n    for(auto it1 = set1.begin(); it1 != set1.end(); ++it1)\n    {\n        if(*it1 == 30)\n        {\n            // è®°å¾—æ›´æ–°è¿­ä»£å™¨ï¼Œå› ä¸ºå¦‚æœä¸æ›´æ–°çš„è¯ï¼Œit1å°†ä¼šå¤±æ•ˆ\n            it1 = set1.erase(it1);\n        }\n    }\n}\n```\nå¦‚æœæ˜¯multisetï¼Œåˆ™æœ‰å¯èƒ½ä¸æ­¢ä¸€ä¸ªæ­¤å€¼çš„å…ƒç´ ï¼Œéœ€è¦æ›´æ–°è¿­ä»£å™¨ã€‚åƒä¸‡è¦æ³¨æ„è¿­ä»£å™¨çš„`++`æ“ä½œä¸å†åƒä¹‹å‰ä¸€æ ·æ— è„‘åœ°åœ¨forçš„ç¬¬ä¸‰ä¸ªä½ç½®`++`ï¼Œè€Œæ˜¯ä¸‹ç§»åˆ°elseçš„æƒ…å†µã€‚\n```cpp\nint main()\n{\n    // set2 ä¸º multiset\n    for(auto it2 = set2.begin(); it2 != set2.end(); )\n    {\n        if(*it2 == 30)\n        {\n            // è®°å¾—æ›´æ–°è¿­ä»£å™¨ï¼Œå› ä¸ºå¦‚æœä¸æ›´æ–°çš„è¯ï¼Œit1å°†ä¼šå¤±æ•ˆ\n            it2 = set2.erase(it1);\n        }\n        else\n        {\n            ++it2;\n        }\n    }\n}\n```\n## find\n\nå»æ‰¾æŒ‡å®šå€¼çš„å…ƒç´ ï¼Œå­˜åœ¨åˆ™è¿”å›å…¶è¿­ä»£å™¨ï¼Œä¸å­˜åœ¨åˆ™è¿”å›`end()`\n```cpp\nint main()\n{\n    it1 = set1.find(20);\n    if(it1 != set1.end())\n    {\n        set1.erase(it1);\n    }\n}\n```\n# unordered_map\n\n```cpp\n#include<unordered_map>\nint main()\n{\n    unordered_map<int, string> map1;\n    map1.insert(1000, \"å¼ ä¸‰\");\n    map1.insert(make_pair(1001, \"æå››\"));\n    // C++11 çš„ä¾¿æ·æ–¹å¼ï¼šæ‹¬å·å¯¹\n    map1.insert({1002, \"ç‹äº”\"});\n    map1.insert({1000, \"è€å…­\"});\n    \n    cout << map1.size() << endl;\n}\n// ç»“æœä¸º3ï¼Œå› ä¸ºè€å…­çš„1000å·é‡å¤äº†\n```\n## `operator[]`\n\nè®¿é—®æˆ–**æ’å…¥**æ•°æ®å…ƒç´ ã€‚è¿”å›ä¸€ä¸ªå¯¹åº”é”®å€¼å¯¹ä¸­çš„å€¼çš„å¼•ç”¨ã€‚\n```cpp\nint main()\n{\n    cout << map1[1000] << endl;\n    map1[1000] = \"å¼ å››\";\n}\n```\nå¦‚æœè®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„keyï¼š\nåˆ™åˆ›å»ºä¸€ä¸ªé”®å€¼å¯¹ï¼Œkeyä¸ºè®¿é—®çš„å€¼ï¼Œvalueç”¨å¯¹åº”çš„æ•°æ®ç»“æ„çš„é»˜è®¤æ„é€ è¿›è¡Œæ„é€ ã€‚åŒæ—¶ï¼Œè¿”å›ä¸€ä¸ªå¯¹åº”é”®å€¼å¯¹ä¸­çš„å€¼çš„å¼•ç”¨ã€‚\n```cpp\nint main()\n{\n    cout << map1.size() << endl;\n    map1[2000];\n    cout << map1.size() << endl;\n}\n// ç»“æœæ˜¯[]è®¿é—®2000åï¼Œsizeä¼šåœ¨ä¹‹å‰çš„åŸºç¡€ä¸ŠåŠ 1ã€‚\n```\n## åˆ é™¤ï¼šerase\n\n```cpp\nint main()\n{\n    map1.erase(1002); // {1002, \"ç‹äº”\"} è¢«åˆ é™¤\n}\n```\n## find\n\n```cpp\nint main()\n{\n    auto it1 = map1.find(1001);\n    if(it1 != map1.end())\n    {\n        // å¦‚æœæ‰¾åˆ°äº†ï¼Œåˆ™è¿”å›çš„æ˜¯ä¸€ä¸ªpairå¯¹è±¡\n        cout << \"key: \" << it1->first << \", value: \" << it1->second << endl;\n    }\n}\n```\n## éå†\n\n```cpp\nint main()\n{\n    for(cosnt pair<int, string> &p : map1)\n    {\n        //...\n    }\n}\n```\nfor-eachæ–¹æ³•ï¼š\n```cpp\nint main()\n{\n    auto it = map1.begin();\n    for(; it != map1.end(); ++it)\n    {\n        // ...\n    }\n}\n```\n# ä½“éªŒæ— åºå…³è”å®¹å™¨ï¼ˆå“ˆå¸Œè¡¨ï¼‰çš„æŸ¥é‡èƒ½åŠ›\n\n```cpp\nint main()\n{\n    const int ARR_LEN = 100000;\n    int arr[ARR_LEN] = { 0 };\n    for(int i = 0; i < ARR_LEN; ++i)\n    {\n        arr[i] = rand() % 10000 + 1;\n    }\n\n    unordered_map<int, int> map1;\n    for(int key : arr)\n    {\n        auto it = map1.find(key);\n        if(it == map1.end())\n        {\n            map1.insert({key, 1});\n        }\n        else\n        {\n            ++it->second;\n        }\n\n        //å…¶å®ä»¥ä¸Šè¿™äº›ä¸œè¥¿å¯ä»¥ç”¨ä¸€å¥è¯æ¥ä»£æ›¿ï¼š\n        //++map1[key];\n    }\n    for(const pair<int, intg> &p : map1)\n    {\n        if(p.second > 1)\n        {\n            cout << \"key: \" << p.first << \"é‡å¤\" << p.second << \"æ¬¡\" << endl;\n        }\n    }\n}\n```\nåœ¨ä¸Šé¢çš„10ä¸‡ä¸ªæ•´æ•°ä¸­ï¼Œç»Ÿè®¡å“ªäº›æ•°å­—é‡å¤äº†ï¼Œå¹¶ä¸”ç»Ÿè®¡æ•°å­—é‡å¤çš„æ¬¡æ•°ã€‚\nç”¨æ•°ç»„æ‰¾æ•ˆç‡æ˜¯å¾ˆä½çš„ã€‚åˆ™ç”¨å“ˆå¸Œè¡¨ã€‚\n## å»é‡ã€æ‰“å°\n\n```cpp\nint main()\n{\n    // arræ˜¯æœ‰é‡å¤æ•°å­—çš„æ•°ç»„\n    unordered_set<int> set;\n    for(int v : arr)\n    {\n        set.insert(v);\n    }\n    for(itn v : set)\n    {\n        cout << v << \" \";\n    }\n    cout << endl;\n}\n```\n# set\næœ‰åºçš„mapã€setçš„åº•å±‚éƒ½æ˜¯çº¢é»‘æ ‘ã€‚\nsetç›¸å½“äºåªæœ‰é”®ï¼Œæ²¡æœ‰å€¼çš„mapã€‚\n```cpp\nint main()\n{\n    std::set<int> my_set{1, 2, 3, 4, 5, 5, 3};\n    for (auto&& v : my_set)\n    {\n        std::cout << v << std::endl;\n    }\n}\n```\nè¾“å‡º1 2 3 4 5\n## æ’å…¥è‡ªå®šä¹‰å¯¹è±¡\n\nç”±äºæ˜¯æœ‰åºå®¹å™¨ï¼Œæ‰€ä»¥ç±»å¯¹è±¡å¿…é¡»å¯ä»¥åšåˆ°å¯æ¯”è¾ƒã€‚å› æ­¤å¿…é¡»é‡è½½æ¯”è¾ƒè¿ç®—ç¬¦ã€‚\nè€Œå…·ä½“åœ°ï¼Œå¦‚æœä¸é‡è½½è¿ç®—ç¬¦ï¼Œç›´æ¥æ’å…¥ï¼ŒæŠ¥é”™ï¼š\n```\nerror C2676: äºŒè¿›åˆ¶â€œ<â€:â€œconst _Tyâ€ä¸å®šä¹‰è¯¥è¿ç®—ç¬¦æˆ–åˆ°é¢„å®šä¹‰è¿ç®—ç¬¦å¯æ¥æ”¶çš„ç±»å‹çš„è½¬æ¢\n```\næ„å‘³ç€ï¼Œæ’å…¥æœ‰åºå®¹å™¨ï¼Œå¿…é¡»è¦é‡è½½`<`è¿ç®—ç¬¦ï¼Œä¸”åªèƒ½æ˜¯`<`ï¼Œç»æµ‹è¯•ï¼Œåªé‡è½½`>`ä»æŠ¥é”™ï¼Œæ‰€ä»¥è‡³å°‘è¦é‡è½½`<`è¿ç®—ç¬¦ã€‚\n\n```cpp\nclass Student\n{\npublic:\n    Student(int id, string name)\n        :_id(id = 0), _name(name = \"\") {}\n    bool operator<(const Student &stu) const\n    {\n        return _id < stu._id;\n    }\nprivate:\n    int _id;\n    string _name;\n    friend ostream &operator<<(ostream &out, const Student &stu);\n};\nostream& operator<<(ostream& out, const Student& stu)\n{\n    out << \"id: \" << stu._id << \" name: \" << stu._name;\n    return out;\n}\nint main()\n{\n    set<Student> set1;\n    set1.insert(Student(1000, \"zhangsan\"));\n    set1.insert(Student(1020, \"lisi\"));\n}\n```\n## éå†\n```cpp\n#include<set>\nint main()\n{\n    set<int> set1;\n    for(int i = 0; i < 20; ++i)\n    {\n        set1.insert(rand() % 20 + 1);\n    }\n    for(int v : set1)\n    {\n        cout << v << \" \";\n    }\n    cout << endl;\n}\n//å°†ä¼šæŒ‰åºä»å°åˆ°å¤§è¾“å‡ºå†…å®¹ï¼š1 2 3 5 6 8 10 12 15 16 17 19\n```\nå®é™…çš„è¿‡ç¨‹æ˜¯å¯¹è¯¥çº¢é»‘æ ‘è¿›è¡Œä¸­åºéå†ã€‚\n### è¿­ä»£å™¨éå†\n\n```cpp\nint main()\n{\n    for(auto it = set1.begin(); it != set1.end(); ++it)\n    {\n        // å…ƒç´ çš„<<è¾“å‡ºæ“ä½œç¬¦å·²ç»è¢«é‡è½½ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å†™å¦‚æ­¤ã€‚\n        cout << *it << endl;\n    }\n}\n//è¾“å‡ºç»“æœï¼š\n//id: 1000 name: zhangsan\n//id: 1020 name: lisi\n```\n# map\nå­˜çš„æ˜¯é”®å€¼å¯¹ï¼Œæœ‰åºï¼Œæ‰€ä»¥ä¹Ÿç§°ä¸ºå­—å…¸ã€‚\néå†æ—¶å¾—åˆ°çš„æ˜¯pairï¼ˆå¯¹å„¿ï¼‰ï¼Œå®šä¹‰äº`<utility>`ä¸­ã€‚\nåº•å±‚ç»“æ„æ˜¯çº¢é»‘æ ‘ã€‚\n## insertã€éå†\ninsertåªèƒ½æ¥æ”¶pairæˆ–è€…`{ 4, 'd' }`ã€‚ç„¶åç³»ç»Ÿéœ€è¦ä¸´æ—¶æ„é€ å¯¹è±¡åæ’å…¥ã€‚\n```cpp\nint main()\n{\n    std::map<unsigned, char> my_map{{1, 'a'}, {2, 'b'}, {3, 'c'}};\n\n    std::pair<unsigned, char> pr;\n    pr.first = 4;\n    pr.second = 'd';\n    my_map.insert(pr);\n    \n    for (auto it = my_map.begin(); it != my_map.end(); ++it)\n    {\n        std::cout << (*it).first << \" \" << it->second << std::endl;\n    }\n}\n```\nranged forè®©éå†æ›´ç®€æ´ï¼š\n```cpp\nint main()\n{\n    for (auto&& v : my_map)\n    {\n        std::cout << v.first << \" \" << v.second << std::endl;\n    }\n}\n```\n## ç»“æ„åŒ–ç»‘å®š\n`C++17`ä¹‹åï¼Œç”šè‡³èƒ½æŠŠkeyå’Œvalueåˆ†å¼€æå–ï¼šå«åšç»“æ„åŒ–ç»‘å®šï¼ˆstructured bindingï¼‰\n```cpp\nint main()\n{\n    for (auto&& [v, v2] : my_map)\n    {\n        std::cout << v << \" \" << v2 << std::endl;\n    }\n}\n```\n\n```cpp\nstruct A\n{\n    int a;\n    int a2;\n    int a3;\n};\nA bar(void)\n{\n    return {1, 2, 3};\n}\nint main()\n{\n    auto&& [a, b, c] = bar();\n    std::cout << a << ',' << b << ',' << c << std::endl;\n}\n```\n\n```cpp\nA aa{ 4, 5, 6 };\nA& foo(void)\n{\n    return aa;\n}\nint main()\n{\n    auto&& [a, b, c] = foo();\n    std::cout << a << ',' << b << ',' << c << std::endl;\n    a = 9; // å¤–éƒ¨aaä¸­çš„ç¬¬ä¸€ä¸ªå€¼ä¹Ÿä¼šå˜ä¸º9\n}\n```\n### emplaceæ’å…¥\nå¯ä»¥ç›´æ¥æ‹¿æ•£è£…çš„å‚æ•°åˆæˆpairï¼Œå°±åœ°æ„é€ ã€‚ä¸ä¼šé€ æˆå¤šä½™çš„å¤åˆ¶ã€‚\n```cpp\nint main()\n{\n    std::map<unsigned, char> my_map{{1, 'a'}, {2, 'b'}, {3, 'c'}};\n\n    my_map.emplace(5, 'e');\n}\n```\n### åœ¨åŒä¸€keyé‡å¤æ’å…¥\n1. å¦‚æœåœ¨åŒä¸€keyé‡å¤æ’å…¥å…¶ä»–çš„valueå€¼ï¼Œä¸ä¼šæ”¹å˜åŸvalueå€¼ã€‚åº”è¯¥ä¼šæ”¾å¼ƒæ’å…¥ã€‚è¿™ç§æƒ…å†µåŒ…å«emplaceå’Œinsertã€‚ï¼ˆåœ¨`C++23`ä¸‹æµ‹è¯•ï¼‰\n2. ä½†æ˜¯å¦‚æœç”¨`[]`æ¥å†™å…¥çš„è¯ï¼Œæ˜¯ä¼šè¢«æ”¹çš„ã€‚\n3. `insert_or_assign`æ˜¯æ’å…¥æˆ–ä¿®æ”¹ã€‚å¦‚æœæ²¡æœ‰è¯¥keyåˆ™æ’å…¥ï¼Œå¦‚æœå­˜åœ¨è¯¥keyåˆ™æ”¹å˜ã€‚\n```cpp\nint main()\n{\n    std::map<unsigned, char> my_map{{1, 'a'}, {2, 'b'}, {3, 'c'}};\n\n    my_map.emplace(3, 'e');\n    my_map.emplace(3, 'f');  // ä¸ä¼šæŠŠeæ”¹ä¸ºf\n    my_map.insert({3, 'g'}); // ä¸ä¼šæ”¹ä¸ºg\n    my_map[3] = 'h';         // ä¼šæ”¹ä¸ºh\n    my_map.insert_or_assign(3, 'i'); // ä¼šæ”¹ä¸ºi\n}\n```\n## æŸ¥è¯¢\n### `std::find`\nå¦‚æœæ¸…æ¥škeyã€valueï¼Œåˆ™å¯ä»¥æŒ‰ç…§å…·ä½“çš„pairè¿›è¡Œfindã€‚pairå¿…é¡»å†™æ˜é”®å€¼ç±»å‹ï¼Œå¦åˆ™å¯èƒ½ä¼šäº§ç”ŸäºŒä¹‰æ€§æ— æ³•æ¨æ–­æ˜ç¡®çš„ç±»å‹ã€‚\n```cpp\nint main()\n{\n    std::map<unsigned, char> my_map( {1, 'a'}, {2, 'b'}, {3, 'c'});\n    std::pair<unsigned, char> pr = {3, 'c'};\n    auto it = std::find(my_map.begin(), my_map.end(), pr);\n}\n```\nå¦‚æœä¸è®°å¾—valueå€¼ã€‚ç”¨find_ifã€‚å› ä¸ºmapçš„é”®æ˜¯å”¯ä¸€çš„ï¼Œåªèƒ½å¯¹åº”ä¸€ä¸ªå€¼ã€‚\n```cpp\nint main()\n{\n    std::map<unsigned, char> my_map( {1, 'a'}, {2, 'b'}, {3, 'c'});\n    auto it = std::find_if(\n        my_map.begin(),\n        my_map.end(),\n        []() -> bool\n        {\n            return v.first == 3;\n        });\n}\n```\n### `map::find`\nè¿™æ˜¯mapè‡ªå¸¦çš„findï¼Œæ•ˆç‡æ›´é«˜ï¼Œå› ä¸ºåˆ©ç”¨äº†è‡ªèº«çº¢é»‘æ ‘çš„ç‰¹æ€§ã€‚\n```cpp\nint main()\n{\n    std::map<unsigned, char> my_map( {1, 'a'}, {2, 'b'}, {3, 'c'});\n    auto it = my_map.find(3);\n    if (it != my_map.end())\n    {\n        std::cout << it->second << std::endl;\n    }\n```\n### `[]`\nå¯ç”¨`[]`æŸ¥è¯¢ï¼Œä½†æ˜¯æœ‰å‰¯ä½œç”¨ï¼Œå¦‚æœæŸ¥è¯¢ä¸€ä¸ªä¸å­˜åœ¨çš„keyä¼šé»˜è®¤æ„é€ ä¸€ä¸ªé”®å€¼å¯¹ã€‚\n```cpp\nint main()\n{\n    std::map<unsigned, char> my_map( {1, 'a'}, {2, 'b'}, {3, 'c'});\n    std::cout << my_map[30] << std::endl;\n}\n```\n## æ’å…¥éœ€è¦åŸºäºCompare\nmapæ’å…¥æ˜¯éœ€è¦å¯¹æ¯”keyçš„å¤§å°å…³ç³»çš„ï¼Œå¯¹äºæœ‰é»˜è®¤å¤§å°å…³ç³»çš„å¯ä»¥è‡ªç„¶æ’å…¥ã€‚\nä½†å¯¹äºè‡ªå®šä¹‰ç±»ï¼Œå°±éœ€è¦æ·»åŠ ä¸€ä¸ªä»¿å‡½æ•°ä½œä¸ºæ¯”è¾ƒå™¨äº†ã€‚ä»¿å‡½æ•°ä¸­çš„`()`è®°å¾—åŠ ä¸Šconstä¿®é¥°ã€‚åªéœ€è¦å®ç°ä¸€ä¸ª`<`å…³ç³»å³å¯ã€‚\n```cpp\nclass A\n{\npublic:\n    A(unsigned val) : _val{ val } {}\n    unsigned _val;\n};\nclass KeyComp\n{\npublic:\n    bool operator (A const& left, A const& right) const\n    {\n        return left._val < right._val;\n    }\n};\nint main()\n{\n    std::map<A, char, KeyComp> my_map{ {{1}, 'a'}, {{2}, 'b'}, {{3}, 'c'} };\n    return 0;\n}\n```\né™¤äº†ä½¿ç”¨ä»¿å‡½æ•°ä½œä¸ºæ¯”è¾ƒå™¨ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨è‡ªå®šä¹‰ç±»ä¸­å®šä¹‰`<`å‡½æ•°ã€‚\n```cpp\nclass A\n{\npublic:\n    A(unsigned val) : _val{ val } {}\n    bool operator() (A const& other) const\n    {\n        return _val < other._val;\n    }\n    unsigned _val;\n};\nint main()\n{\n    std::map<A, char> my_map{ {{1}, 'a'}, {{2}, 'b'}, {{3}, 'c'} };\n    return 0;\n}\n```\n# multimap\nä¸€ä¸ªé”®å¯ä»¥å¯¹åº”å¤šä¸ªvalueã€‚\nå¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æ™®é€šmapï¼Œå¯ä»¥ç”¨listä½œä¸ºå€¼ç±»å‹ï¼ŒåµŒå¥—çš„å®¹å™¨ï¼Œæ¥å®ç°ä¸€é”®å¤šå€¼ã€‚\n```cpp\nint main()\n{\n    std::map<unsigned, std::list<char>> my_container{\n        {1u, {'a', 'b', 'c'}},\n        {2u, {'d', 'e', 'f'}},\n        {3u, {'g', 'h', 'i'}},\n        {4u, {'j', 'k', 'l'}} };\n    for (auto&& v : my_container)\n    {\n        std::cout << \"Key: \" << v.first << \" values: \";\n        for (auto&& v2 : v.second)\n        {\n            std::cout << v2 << \" \";\n        }\n        std::cout << stdd::endl;\n    }\n    \n}\n```\nè¾“å‡ºï¼š\n```\nkey: 1 values: a b c\nkey: 2 values: d e f\nkey: 3 values: g h i\nkey: 4 values: j k l\n```\nå¦‚æœç”¨multimapï¼Œå°†ä¼šæ›´ç®€å•ï¼š\n```cpp\nint main()\n{\n    std::multimap<unsigned, char> multi_map{\n        {1u, 'a'}, {1u, 'b'}, {1u, 'c'},\n        {2u, 'd'}, {2u, 'e'}, {2u, 'f'},\n        {3u, 'g'}, {3u, 'h'}, {3u, 'i'},\n        {4u, 'j'}, {4u, 'k'}, {4u, 'l'} };\n    for(auto&& v : multi_map)\n    {\n        std::cout << v.first << \" \" << v.second << std::endl;\n    }\n}\n```\n## æŸ¥è¯¢ï¼šequal_range\nä¼šè¿”å›ä¸€ä¸ªpairï¼Œpairçš„firstæ˜¯æŸ¥è¯¢åˆ°çš„å¯¹åº”keyçš„ç¬¬ä¸€ä¸ªé”®å€¼å¯¹çš„è¿­ä»£å™¨ï¼Œsecondæ˜¯ç¬¦åˆè¦æ±‚çš„é”®å€¼å¯¹çš„endè¿­ä»£å™¨ã€‚\nåŒä¸€ä¸ªkeyå¯¹åº”çš„å¤šä¸ªé”®å€¼å¯¹æ˜¯æŒ‰é¡ºåºçš„ã€‚æ‰€ä»¥å¯ä»¥ç”¨`++it`éå†ã€‚\n```cpp\nint main()\n{\n    std::multimap<unsigned, char> multi_map{ /* ... */ };\n    auto it_pair = multi_map.equal_range(3u);\n    for(auto it = it_pair.first; it != it_pair.second; ++it)\n    {\n        std::cout << it->first << \" \" << it->second << std::endl;\n    }\n}\n```\nè¾“å‡ºï¼š\n```\n3 g\n3 h\n3 i\n```\nç”¨structured bindingï¼š\n```cpp\nint main()\n{\n    std::multimap<unsigned, char> multi_map{ /* ... */ };\n    auto && [it, end] = multi_map.equal_range(3u);\n    for(; it != end; ++it)\n    {\n        std::cout << it->first << \" \" << it->second << std::endl;\n    }\n}\n```\n## lower_bound\nè¿”å›çš„æ˜¯å‚æ•°keyå¯¹åº”çš„é”®å€¼å¯¹ä¸­ä½ç½®æœ€å°çš„è¿­ä»£å™¨ã€‚æ¯”å¦‚æŸ¥çš„æ˜¯3uï¼Œåˆ™è¿”å›`{3u, g}`å¯¹åº”çš„è¿­ä»£å™¨ã€‚\n```cpp\nint main()\n{\n    std::multimap<unsigned, char> multi_map{ /* ... */ };\n    auto lower_it = multi_map.lower_bound(3u);\n    for (auto it = multi_map.begin(); it != lower_it; ++it)\n    {\n        std::cout << it->first << \" \" << it->second << std::endl;\n    }\n}\n```\nè¾“å‡º\n```\n1 a\n1 b\n1 c\n2 d\n2 e\n2 f\n```\nå¯¹åº”çš„è¿˜æœ‰upper_boundã€‚æ¯”å¦‚æŸ¥çš„æ˜¯3uï¼Œåˆ™è¿”å›`{4u, j}`å¯¹åº”çš„è¿­ä»£å™¨ã€‚å³3uæ‰€æœ‰é”®å€¼å¯¹æœ«å°¾çš„ä¸‹ä¸€ä¸ªè¿­ä»£å™¨ã€‚\n```cpp\nint main()\n{\n    std::multimap<unsigned, char> multi_map{ /* ... */ };\n    auto upper_it = multi_map.upper_bound(3u);\n    // ä»\n    for (; upper_it != multi_map.end(); ++upper_it)\n    {\n        std::cout << it->first << \" \" << it->second << std::endl;\n    }\n}\n```\nè¾“å‡º\n```\n4 j\n4 k\n4 l\n```","categories":["Cpp","STL"]},{"title":"Cpp_STL_deque","url":"/Cpp/Cpp_STL_deque/","content":"\n# å†…å®¹\n\n1. deque\n\n# æ„é€ \n\n```c++\n#include<iostream>\n#include<vector>\nusing namespace std;\nint main()\n{\n\tvector<int> ar1;\t//ç©ºvector\n\tvector<int> ar2 = { 12,23,34,45,56,67,78,89 }; //ç±»ä¼¼æ•°ç»„çš„åˆå§‹åŒ–æ–¹å¼\n\tvector<int> ar3(10, 23); //å­˜10ä¸ª23\n\tvector<int> ar4({ 12,23,34,45,56,67 }); //åˆå§‹åŒ–åˆ—è¡¨ä½œä¸ºå‚æ•°æ„é€ \n\tvector<int> ar5(ar2); //æ‹·è´æ„é€ ï¼ŒæŒ‰ar2çš„æœ‰æ•ˆsize\n\tvector<int> ar6(std::move(ar2)); //ç§»åŠ¨æ„é€ \n}\n```\n\n# emplaceå’Œpush\n\né¦–å…ˆæ¥çœ‹éšå¼è½¬æ¢çš„æ¦‚å¿µï¼š\n\n```c++\nclass Object\n{\n    int val;\npublic:\n    Object(int val) : val(val) { }\n    \n};\nint main()\n{\n    vector<Object> objvec;\n    objvec.push_back(20); //éšå¼è½¬æ¢20ï¼Œåˆ›å»ºä¸´æ—¶å¯¹è±¡Object(20)ã€‚å®é™…ä¸Šæ˜¯ï¼šemplace_back(Object(20))\n    objvec.emplace_back(20); //åœ¨vec.end()å¤„ç›´æ¥å®šä½new Object(20)\n    \n}\n```\n\n# vectorä¸æ™ºèƒ½æŒ‡é’ˆç»“åˆ\n\n```c++\nint main()\n{\n    std::vector<Shape*> shape;\n    string name;\n    while(cin >> name, name != \"end\")\n    {\n        if(name == \"Circle\")\n        {\n            shape.push_back(new Circle());\n        }\n        else if(name == \"Square\")\n        {\n            shape.push_back(new Square());\n        }\n        else\n        {\n            cout << \"input class name error: \" << name << endl;\n        }\n    }\n    for(auto & x : shape)\n    {\n        x->draw();\n        x->erase();\n    }\n}\n```\n\n","categories":["Cpp","STL"]},{"title":"Cpp_STL_list","url":"/Cpp/Cpp_STL_list/","content":"# å†…å®¹\n\n1. list\n2. åŒºåˆ†ï¼šlistæ˜¯åŒå‘è¿­ä»£å™¨ï¼Œvectoræ˜¯éšæœºè¿­ä»£å™¨\n\n# æ„é€ \n\n```c++\n#include<iostream>\n#include<vector>\nusing namespace std;\nint main()\n{\n\tvector<int> ar1;\t//ç©ºvector\n\tvector<int> ar2 = { 12,23,34,45,56,67,78,89 }; //ç±»ä¼¼æ•°ç»„çš„åˆå§‹åŒ–æ–¹å¼\n\tvector<int> ar3(10, 23); //å­˜10ä¸ª23\n\tvector<int> ar4({ 12,23,34,45,56,67 }); //åˆå§‹åŒ–åˆ—è¡¨ä½œä¸ºå‚æ•°æ„é€ \n\tvector<int> ar5(ar2); //æ‹·è´æ„é€ ï¼ŒæŒ‰ar2çš„æœ‰æ•ˆsize\n\tvector<int> ar6(std::move(ar2)); //ç§»åŠ¨æ„é€ \n}\n```\n\n# ä¸vectorçš„åŒºåˆ«\n\n1. åº•å±‚å®ç°\n2. ç©ºé—´åˆ©ç”¨ç‡\n3. æŸ¥è¯¢å…ƒç´ \n    1. vectorï¼šiterator `operator[]`ï¼Œ`find` O(n)ï¼Œ`binary_search` O(logn)\n    2. listï¼šiterator `find` O(n)\n4. æ’å…¥å’Œåˆ é™¤\n    1. vectoréœ€è¦åˆ†çš„æƒ…å†µè¾ƒå¤š\n        1. çœ‹æ˜¯å¦éœ€è¦å¢å®¹ï¼›\n        2. åœ¨ä¸­é—´æ’å…¥è¿˜æ˜¯åœ¨æœ€åæ’å…¥ï¼›\n        3. åˆ é™¤ï¼šæœ€ååˆ é™¤O(1)ï¼Œä¸­é—´åˆ é™¤éœ€è¦å†…å­˜æ‹·è´ï¼›\n        4. resizeå’Œreserveçš„åŒºåˆ«\n    2. listï¼š\n        1. æ’å…¥O(1)ï¼Œéœ€è¦å†…å­˜ç”³è¯·ï¼Œ\n        2. åˆ é™¤O(1)ï¼Œéœ€è¦å†…å­˜é‡Šæ”¾ã€‚\n5. è¿­ä»£å™¨ï¼š\n    1. vectorï¼š\n        1. éšæœºè¿­ä»£å™¨ï¼Œå¯æ£€æŸ¥è¶Šç•Œã€‚æ”¯æŒ`++`ï¼Œ`--`ï¼Œ`+`ï¼Œ`+=`ï¼Œ`<`ï¼Œ`>`ï¼Œ`==`ï¼Œ`!=`ï¼›\n        2. æ’å…¥å’Œåˆ é™¤å…ƒç´ å¯èƒ½å¯¼è‡´è¿­ä»£å™¨å¤±æ•ˆã€‚\n    2. listï¼š\n        1. æ’å…¥å…ƒç´ ä¸ä¼šå¯¼è‡´è¿­ä»£å™¨å¤±æ•ˆï¼Œä½†æ˜¯æ˜¯æ’åœ¨å½“å‰è¿­ä»£å™¨æŒ‡å‘çš„ä½ç½®ä¹‹å‰ï¼Œæ’å…¥åè¿­ä»£å™¨æŒ‡å‘æ–°æ’çš„ä½ç½®ï¼›åŸä½ç½®çš„è¢«æŒ¤åˆ°äº†å³é¢ã€‚æ‰€ä»¥ï¼Œå¦‚æœéœ€è¦åœ¨æ’å…¥åç»§ç»­éå†ï¼Œ éœ€è¦å•ç‹¬`++`1æ¬¡ã€‚\n        2. eraseåˆ é™¤å…ƒç´ ï¼Œè¢«åˆ çš„å…ƒç´ çš„è¿­ä»£å™¨å¤±æ•ˆã€‚\n# å¦‚ä½•æŠ‰æ‹©ï¼Ÿ\n\nä»€ä¹ˆæ—¶å€™è¯¥ç”¨vectorï¼Ÿä»€ä¹ˆæ—¶å€™è¯¥ç”¨listï¼Ÿ\n1. å¦‚æœéœ€è¦é«˜æ•ˆçš„éšæœºå­˜å–ï¼Œè€Œä¸åœ¨ä¹æ’å…¥å’Œåˆ é™¤çš„æ•ˆç‡ï¼ˆå¾ˆå°‘ä½¿ç”¨æ’å…¥å’Œåˆ é™¤æ“ä½œ)ã€‚é€‰ç”¨vectorã€‚\n2. å¦‚æœéœ€è¦å¤§é‡çš„æ’å…¥å’Œåˆ é™¤çš„æ“ä½œï¼Œéšæœºå­˜å–å¾ˆå°‘ä½¿ç”¨ã€‚é€‰ç”¨listã€‚\n## ä¸¾ä¾‹\n\nä¾‹1âˆ¶æ¯”å¦‚åˆ¶ä½œäº†ä¸€ä¸ªæ¸¸æˆç©å®¶æ’è¡Œæ¦œï¼Œé‚£ä¹ˆå°±è¦å®æ—¶åˆ·æ–°è¿™ä¸ªæ’è¡Œæ¦œï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœæœ‰äººè¾¾åˆ°æ’è¡Œçš„æ¡ä»¶ï¼Œé‚£ä¹ˆå°±è¦æŠŠä»–åŠ è¿›å»ï¼Œå¦‚æœäººæ•°å¤šå‡ºäº†ï¼Œé‚£ä¹ˆå°±æŠŠæ’åé åçš„ç§»é™¤æ‰ï¼Œè¿™å°±éœ€è¦å¤§é‡çš„æ’å…¥åˆ é™¤æ“ä½œï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±åº”è¯¥ä¼˜å…ˆè€ƒè™‘listï¼Œè€Œä¸æ˜¯vectorã€‚\n## ä¸­é—´æ’å…¥\næƒ³åœ¨æŸä¸ªå€¼çš„å…ƒç´ å‰é¢æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œé¦–å…ˆéœ€è¦findå‡ºä½ç½®å¹¶å¾—åˆ°è¿­ä»£å™¨itï¼Œç„¶ååœ¨itä½ç½®è¿›è¡Œæ’å…¥ã€‚\n```cpp\nint main()\n{\n    std::list<int> lst{ 1, 2, 3, 4, 5, 6, 7, 8 };\n    auto it = std::find(lst.begin(), lst.end(), 5);\n    \n    lst.emplace(it, 50);\n    \n    std::for_each(\n        lst.cbegin(),\n        lst.cend(),\n        [](auto&& v)\n        {\n            std::cout << v << std::endl;\n        });\n}\n```\n>emplace:\n>ï¼ˆ1ï¼‰åœ¨ä½ç½®æ’å…¥æ–°å…ƒç´ ã€‚\n>ï¼ˆ2ï¼‰ä¸å…¶ä»–æ ‡å‡†é¡ºåºå®¹å™¨ä¸åŒï¼Œ`list`å’Œ`forward_list`ç»è¿‡ä¸“é—¨è®¾è®¡ï¼Œå¯ä»¥åœ¨ä»»ä½•ä½ç½®é«˜æ•ˆåœ°æ’å…¥å’Œåˆ é™¤å…ƒç´ ï¼Œå³ä½¿åœ¨åºåˆ—çš„ä¸­é—´ä¹Ÿæ˜¯å¦‚æ­¤ã€‚\n>ï¼ˆ3ï¼‰å°±åœ°æ„é€ \n>è¿”å›å€¼ï¼š\n>ä¸€ä¸ªæŒ‡å‘æ–°æ’å…¥å…ƒç´ çš„è¿­ä»£å™¨ã€‚","categories":["Cpp","STL"]},{"title":"Cpp_STL_vector","url":"/Cpp/Cpp_STL_vector/","content":"\n# å†…å®¹\n\nvector\n\n# æ„é€ \n\n```c++\n#include<iostream>\n#include<vector>\nusing namespace std;\nint main()\n{\n\tvector<int> ar1;\t//ç©ºvector\n\tvector<int> ar2 = { 12,23,34,45,56,67,78,89 }; //ç±»ä¼¼æ•°ç»„çš„åˆå§‹åŒ–æ–¹å¼\n\tvector<int> ar3(10, 23); //å­˜10ä¸ª23\n\tvector<int> ar4({ 12,23,34,45,56,67 }); //åˆå§‹åŒ–åˆ—è¡¨ä½œä¸ºå‚æ•°æ„é€ \n\tvector<int> ar5(ar2); //æ‹·è´æ„é€ ï¼ŒæŒ‰ar2çš„æœ‰æ•ˆsize\n\tvector<int> ar6(std::move(ar2)); //ç§»åŠ¨æ„é€ \n}\n```\n\n# emplaceå’Œpush\n\né¦–å…ˆæ¥çœ‹éšå¼è½¬æ¢çš„æ¦‚å¿µï¼š\n\n```c++\nclass Object\n{\n    int val;\npublic:\n    Object(int val) : val(val) { }\n    \n};\nint main()\n{\n    vector<Object> objvec;\n    objvec.push_back(20); //éšå¼è½¬æ¢20ï¼Œåˆ›å»ºä¸´æ—¶å¯¹è±¡Object(20)ã€‚å®é™…ä¸Šæ˜¯ï¼šemplace_back(Object(20))\n    objvec.emplace_back(20); //åœ¨vec.end()å¤„ç›´æ¥å®šä½new Object(20)\n    \n}\n```\n\n# vectorä¸æ™ºèƒ½æŒ‡é’ˆç»“åˆ\n\n```c++\nint main()\n{\n    std::vector<Shape*> shape;\n    string name;\n    while(cin >> name, name != \"end\")\n    {\n        if(name == \"Circle\")\n        {\n            shape.push_back(new Circle());\n        }\n        else if(name == \"Square\")\n        {\n            shape.push_back(new Square());\n        }\n        else\n        {\n            cout << \"input class name error: \" << name << endl;\n        }\n    }\n    for(auto & x : shape)\n    {\n        x->draw();\n        x->erase();\n    }\n}\n```\n\n","categories":["Cpp","STL"]},{"title":"Cpp_å…¼å®¹Cå’ŒCppçš„æ€æƒ³_å®Œç¾è½¬å‘","url":"/Cpp/Cpp_å…¼å®¹Cå’ŒCppçš„æ€æƒ³_å®Œç¾è½¬å‘/","content":"# å†…å®¹\n\né‡ç‚¹æ˜¯æ¨¡æ¿çš„æ€æƒ³ï¼Œä½¿å¾—Cppåœ¨åŒ…ç½—ä¸‡è±¡æ—¶å¦‚è™æ·»ç¿¼ï¼šæ¨¡æ¿ä¸­çš„ç±»å‹ï¼ŒæŠŠè¦ç”¨åˆ°çš„ç±»å‹ä¿¡æ¯èƒå–å‡ºæ¥ç»™æ¨¡æ¿å‡½æ•°ï¼Œè€ŒåŸæœ¬çš„ç±»å‹ä¿¡æ¯ä¸ä¸¢å¤±ã€‚ä½¿å¾—åœ¨æœ‰å‹å’Œæ— å‹ä¹‹é—´æ¸¸ç¦»ã€‚è¿™è¾¾åˆ°äº†å¾ˆå¤šçš„æ•ˆæœï¼ŒåŒ…æ‹¬æŠŠcå­é›†å’Œclasså­é›†ä¸­åŸºæœ¬æ•°æ®ç±»å‹å’Œè‡ªå®šä¹‰ç±»å‹çš„é¸¿æ²Ÿç»™å¡«è¡¥äº†ã€‚\n# æ¨¡æ¿æ˜¯CèŒƒå¼å’ŒClassèŒƒå¼çš„æ¡¥æ¢\n1. Cå­é›†ï¼ˆé¢å‘è¿‡ç¨‹ï¼‰\n2. Classå­é›†ï¼ˆé¢å‘å¯¹è±¡ï¼‰\n3. STL\n4. æ¨¡æ¿--å¯ä»¥è·¨è¶ŠCå’ŒClasså­é›†ã€‚\n# æ¨¡æ¿è·¨è¶Šcå’Œclass\n\nå…ˆå°è¯•ç‰›åˆ€ï¼Œåˆæ¬¡æ„Ÿå—ã€‚\n\nä¸‹é¢çš„ä»£ç å¥‡å¦™ä¹‹å¤„å°±æ˜¯ï¼šä½¿ç”¨äº†æ¨¡æ¿åï¼Œä½ å¹¶ä¸æ¸…æ¥šTæ˜¯å†…ç½®ç±»å‹è¿˜æ˜¯å°è£…ç±»å‹ï¼Œæ‰€ä»¥è¦å®Œæˆç»Ÿä¸€å†…ç½®ç±»å‹å’Œå°è£…ç±»å‹çš„æ“ä½œå¿…å®šå¾ˆéº»çƒ¦ã€‚æ¨¡æ¿çš„å¼ºå¤§èƒŒåéƒ½æ˜¯å¿ƒé…¸ã€‚\n```c++\ntemplate<class T>\nvoid fun(T a)\n{\n    \n}\nfun<int>(12);\nfun<Object>(obj);\n```\n\nåœ¨è°ˆä¸‹ä¸€ä¸ªçŸ¥è¯†â€œå®Œç¾è½¬å‘â€ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥ä¸€æ®µC++11ä¹‹åï¼Œå·¦å€¼å³å€¼çš„é‡è½½æƒ…å†µï¼š\n\n```c++\n#include<iostream>\nusing namespace std;\nvoid fun(int& a)\n{\n\tcout << \"fun(int& a)\" << endl;\n}\n// const int&æ˜¯ä¸ªä¸‡èƒ½å¼•ç”¨ï¼Œå·¦å³å€¼éƒ½å¯ä»¥æ¥æ”¶ï¼Œ\n// ä½†æ˜¯å¦‚æœfunæœ‰int &&çš„é‡è½½åˆ™int &&ï¼ˆå¦‚å³å€¼10ï¼‰ä¼˜å…ˆè¢«å…¶æ¥æ”¶ï¼›\n// åŒæ ·çš„é“ç†ï¼Œå¦‚æœfunæœ‰int &çš„é‡è½½åˆ™int &ï¼ˆå¦‚å·¦å€¼aï¼‰ä¼˜å…ˆè¢«å…¶æ¥æ”¶\nvoid fun(const int& a)\n{\n\tcout << \"fun(const int& a)\" << endl;\n}\nvoid fun(int&& a)\n{\n\tcout << \"fun(int&& a)\" << endl;\n}\n//void fun(int a){} //ä¸fun(int &)å†²çª\nint main()\n{\n\tint a = 10;\n    const int b = 20;\n\tfun(a);\t\t//fun(int& a)\n\tfun(b);\t\t//fun(const int& a)\n\tfun(10);\t//fun(int&& a) --> è™½ç„¶10ä¹Ÿå¯ä»¥è¢«const int &æ¥æ”¶ï¼Œä½†æ˜¯C++11å¼€å§‹åï¼Œé‡è½½å¯¹å€¼çš„ç±»å‹ã€å·¦å³å€¼è¿›è¡Œäº†æ¸…æ™°çš„åˆ’åˆ†ã€‚ä»¥å‰åªæŒ‰ç±»å‹é‡è½½ï¼Œä¹‹åæŒ‰å·¦å³å€¼ä¹Ÿå¯ä»¥é‡è½½ã€‚\n}\n```\n\nç»“åˆä¸‹é¢çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¸ºäº†åœ¨facä¸­è°ƒç”¨å…¶ä»–å‡½æ•°ä½¿ç”¨åˆ°tmpæ—¶ä¿æŒå…¶å³å€¼å±æ€§ï¼Œä½¿ç”¨åˆ°å®Œç¾è½¬å‘\n\n```c++\nvoid fun(int& a)\n{\n\tcout << \"fun(int& a)\" << endl;\n}\nvoid fun(const int& a)\n{\n\tcout << \"fun(const int& a)\" << endl;\n}\nvoid fun(int&& a)\n{\n\tcout << \"fun(int&& a)\" << endl;\n}\ntemplate<class T>\nvoid fac(T && tmp)\n{\n    //cout << std::is_rvalue_reference<T> << endl;\n    //cout << std::is_lvalue_reference<T> << endl;\n    fun(tmp);\n    // è™½ç„¶åœ¨è°ƒç”¨facæ—¶ï¼Œtmpä¼ å…¥æ­¤å‡½æ•°ä¸­å‰æ˜¯ä¸€ä¸ªå³å€¼ï¼Œä½†æ˜¯ä¼ å‚åŠ¨ä½œå®Œæˆåtmpæˆä¸ºäº†ä¸€ä¸ªå…·åå˜é‡ï¼Œåˆ™åˆé€€åŒ–ä¸ºäº†å·¦å€¼ï¼Œå¯¼è‡´åªèƒ½è°ƒç”¨fun(int& a)ã€‚\n    //æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæœºåˆ¶ï¼Œæ¥ä¿æŒå˜é‡çš„å·¦å³å€¼å±æ€§ã€‚å³å®Œç¾è½¬å‘\n    fun(std::forward<T>(tmp)); //ä¾ç„¶ä¿æŒtmpçš„å³å€¼å±æ€§ï¼Œä½¿å…¶å¯ä»¥è°ƒç”¨fun(int&& a)ã€‚\n}\nint main()\n{\n    int a = 10;\n    const int b = 20;\n    fac(a);\n    fac(b);\n    fac(20);\n    return 0;\n}\n/* è¿è¡Œç»“æœ\n    fac(a);-----------------\n            fun(int& a)\n            fun(int& a)\n    fac(b);-----------------\n            fun(const int& a)\n            fun(const int& a)\n    fac(20);-----------------\n            fun(int& a)\t\t\t-->***å®Œç¾è½¬å‘ä¹‹å‰\n            fun(int&& a)\t\t-->***å®Œç¾è½¬å‘ä¹‹å\n*/\n```\n\næœ‰ä¸€ä¸ªå¾ˆç–‘æƒ‘çš„é—®é¢˜ï¼šæ—¢ç„¶`fac(a);` `fac(b);`ç¼–è¯‘é€šè¿‡äº†ï¼Œä¸ºä»€ä¹ˆå®Œç¾è½¬å‘åè¿è¡Œçš„ç»“æœè¿˜æ˜¯`fun(int& a)`ã€`fun(const int& a)`ï¼Ÿ\n\n```c++\nvoid fun(int& a)\n{\n    cout << \"fun(int& a)\" << endl;\n}\nvoid fun(const int& a)\n{\n    cout << \"fun(const int& a)\" << endl;\n}\nvoid fun(int&& a)\n{\n    cout << \"fun(int&& a)\" << endl;\n}\nvoid test(int&& a)\t\t\t//--ä¸ä¸Šä¸€ä¸ªä¾‹å­æœ€å¤§çš„åŒºåˆ«ï¼šä¸æ˜¯æ¨¡æ¿å‡½æ•°!\n{\n    fun(a);\n    fun(std::forward<int>(a));\n}\nint main()\n{\n    int a = 10;\n    const int b = 20;\n    //test(a);\t\t\t\t// å‚æ•°æ˜¯å·¦å€¼ï¼Œæ˜¯æ— æ³•è°ƒç”¨test(int&& a)çš„ï¼Œå› ä¸ºç¼–è¯‘å™¨è§„å®š:æ— æ³•å°†â€˜å³å€¼å‚æ•°â€™--â€˜ç»‘å®šåˆ°å·¦å€¼â€™ã€‚\n    //test(std::move(b));\t// ç¼–è¯‘å™¨æç¤ºï¼šå°†\"int &&â€ç±»å‹çš„å¼•ç”¨ç»‘å®šåˆ°\"std:remove_reference_t<const int &>â€ç±»å‹çš„åˆå§‹å€¼è®¾å®šé¡¹æ—¶ï¼Œé™å®šç¬¦è¢«ä¸¢å¼ƒ   --->æ„æ€æ˜¯ï¼Œè­¦å‘Šæˆ‘ä»¬ä¸è¦è¿™æ ·åšã€‚è¿™æ ·ä¼šä¸¢å¤±bçš„constå±æ€§ã€‚\n    \n    test(std::move(a));\t\t// ä½†æ˜¯æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨å¹³æ—¶çš„ä¹¦å†™ä¸­ï¼Œint a = 10; int b = a;è¿™ç§å†™æ³•æ˜¯å¾ˆæ™®éçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè™½ç„¶å³å€¼ä¸èƒ½æ”¾åœ¨å·¦å€¼çš„ä½ç½®ä¸Šï¼Œä½†æ˜¯å·¦å€¼æ˜¯å¯ä»¥å……å½“å³å€¼ä½¿ç”¨çš„ï¼Œåªä¸è¿‡æ˜¯ç¼–è¯‘å™¨è§„å®šäº†æˆ‘ä»¬ä¸èƒ½åœ¨è°ƒç”¨å‡½æ•°æ—¶ä¸æŠŠå·¦å€¼å’Œå³å€¼æ··æ·†ã€‚\n    \t\t\t\t\t\t// å› ä¸ºä¸èƒ½ç›´æ¥test(a);è¯´æ˜é—®é¢˜æ‰€åœ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬std::move(a)\t\t\t\t\n}\n/* è¿è¡Œç»“æœ\n    fun(int& a)\n    fun(int&& a)\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å®Œç¾è½¬å‘å‰ï¼Œå› ä¸ºåˆ°äº†funå‡½æ•°ä¸­ï¼Œaåˆæˆä¸ºäº†æœ‰åå˜é‡ï¼Œæ‰€ä»¥å†æ¬¡è°ƒç”¨fun(a)é€€åŒ–ä¸ºå·¦å€¼ï¼›è€Œå®Œç¾è½¬å‘åï¼Œå¯ä»¥ä¿æŒaçš„å³å€¼æ€§ã€‚\n*/\n```\n\nè¿™ä¸ªç»“æœï¼Œä¸ä¸Šä¸€ä¸ªä»£ç ä¸­çš„ç»“æœï¼ˆå®Œç¾è½¬å‘åè¿è¡Œçš„ç»“æœä¾æ—§æ˜¯`fun(int& a)`ã€`fun(const int& a)`ï¼‰ä¸€ç»å¯¹æ¯”ï¼Œå‘ç°äº†é—®é¢˜ï¼šå°±æ˜¯è°ƒç”¨`fac(a);` `fac(b);`ä¹‹å‰ï¼Œç”±äº`fac`æ˜¯ä¸€ä¸ªæ¨¡æ¿å‡½æ•°ï¼Œè€Œä¸”å‚æ•°ç±»å‹å¾ˆç‰¹æ®Šï¼è¿™æ˜¯æœ€å…³é”®çš„ç‚¹ï¼Œå‚æ•°ç±»å‹æ˜¯`T && tmp`ï¼Œè¿™å°±è¦æ±‚ï¼Œä¸ç®¡Tæ˜¯ä»€ä¹ˆç±»å‹ï¼Œä¸ç®¡è¦ä¼ å…¥çš„å®å‚æ˜¯å¦æ˜¯å³å€¼å±æ€§ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥è®©å…¶æˆåŠŸè¿›å…¥åˆ°æ­¤ä¸­ï¼Œç”šè‡³ä»–æ˜¯ä¸€ä¸ªå·¦å€¼ï¼ˆå·¦å€¼æ˜¯å¯ä»¥å……å½“å³å€¼ä½¿ç”¨çš„ï¼‰ã€‚è€Œæ¨¡æ¿æœºåˆ¶ä¸­çš„Tæ˜¯ä¼šä¿ç•™ä¼ å…¥å®å‚ç±»å‹çš„æ‰€æœ‰ä¿¡æ¯çš„ï¼ŒåŒ…æ‹¬constå±æ€§å’Œå·¦å³å€¼å±æ€§ï¼Œæ¯”å¦‚`int a = 10;`çš„aæ˜¯éå¸¸æ€§å·¦å€¼ï¼Œ`const int b = 20;`çš„bæ˜¯å¸¸æ€§å·¦å€¼ã€‚æ‰€ä»¥ï¼Œçœ‹ä¸Šå»tmpæ˜¯ä¸€ä¸ªå³å€¼ï¼Œä½†æ˜¯tmpçš„æ ¹æºå±æ€§æ˜¯å¤–éƒ¨aã€båŸæ¥çš„å±æ€§ã€‚æ‰€ä»¥å®Œç¾è½¬å‘åçš„ç»“æœä¾æ—§æ˜¯açš„éå¸¸æ€§å·¦å€¼`int &`ï¼Œbçš„å¸¸æ€§å·¦å€¼`const int &`ã€‚\n\né€šè¿‡è¿™ä¸ªä¾‹å­ï¼Œå¯ä»¥å¾—å‡ºï¼Œæ¨¡æ¿å‡½æ•°çš„`<class T> void fun(T && tmp)`å¹¶æœªä¸¢å¼ƒTå…ƒç´ åŸæœ¬çš„çš„constä¿¡æ¯ã€å·¦å³å€¼å±æ€§ã€‚\n\né‚£ä¹ˆæˆ‘ä»¬æ¥å°è¯•ç‰›åˆ€ä¸€ä¸‹ï¼š\n```c++\nvoid fun(int& a)\n{\n\tcout << \"fun(int& a)\" << endl;\n}\nvoid fun(const int& a)\n{\n\tcout << \"fun(const int& a)\" << endl;\n}\nvoid fun(int&& a)\n{\n\tcout << \"fun(int&& a)\" << endl;\n}\ntemplate<class T>\nvoid fac_template(T && tmp)\n{\n    fun(tmp);\n    fun(std::forward<T>(tmp));\n}\nvoid fac_non_template(T && tmp)\n{\n    fun(tmp);\n    fun(std::forward<T>(tmp));\n}\nint main()\n{\n    int a = 10;\n    fac_template(std::move(a));\t\t\t// æ³¨æ„æ­¤å¤„åŒºåˆ«ï¼Œä¸Šä¸Šä¸ªä»£ç ä¸­æ˜¯fac(a),æ­¤å¤„æ˜¯fac(std::move(a))\n    \n    fac_non_template(std::move(a));\n    return 0;\n}\n/* è¿è¡Œç»“æœ\n\t----------------\n\tfac_template(std::move(a));\n\t----------------\n        fun(int& a)\n        fun(int&& a)\t//ä¸Šä¸Šä¸ªä»£ç fac(a)çš„æ­¤å¤„çš„ç»“æœæ˜¯fun(int& a)ï¼Œè€Œæ­¤å¤„æ˜¯fun(int&& a)\n\t----------------\n    fac_non_template(std::move(a));\n    ----------------\n        fun(int& a)\n        fun(int&& a)\n*/\n```\n# åœ¨cppæ–‡ä»¶ä¸­è°ƒç”¨cæ–‡ä»¶\nçŸ›ç›¾ç‚¹ï¼š\n1. C++è°ƒç”¨C\n    1. C++äº§ç”Ÿå‡½æ•°ç¬¦å·-ï¼ˆå‡½æ•°å+å‚æ•°ç±»å‹åˆ—è¡¨ï¼‰ï¼ŒCè¯­è¨€äº§ç”Ÿå‡½æ•°ç¬¦å·-ï¼ˆå‡½æ•°åï¼‰\n2. Cè¯­è¨€è°ƒç”¨C++\n    1. å¦‚æœå°†C++çš„å‡½æ•°ç¬¦å·æ”¹ä¸ºCè¯­è¨€çš„å‡½æ•°ç¬¦å·--éœ€è¦æ”¹åŠ¨C++æºæ–‡ä»¶--ä¸ç°å®ã€‚\n    2. æ­£ç¡®è§£å†³åŠæ³•æ˜¯æ·»åŠ è‡ªå·±å®ç°çš„C++æ–‡ä»¶ï¼Œå†™**C++å‡½æ•°ä½œä¸ºä¸­é—´å±‚å»è°ƒç”¨éœ€è¦çš„C++å‡½æ•°ï¼Œç„¶åè®©è‡ªå®ç°çš„C++å‡½æ•°äº§ç”ŸCè¯­è¨€ç¬¦å·ï¼ˆextern Cï¼‰**ã€‚\n\n```c\n#func.c\n\n#include<stdio.h>\nvoid fun_C()\n{\n    printf(\"void fun_C()\");\n}\n#main.cpp\nvoid fun_C();\n//cppç”Ÿæˆçš„ç¬¦å·çš„æ–¹å¼æ˜¯å–å†³äºå‡½æ•°åå’Œå‚æ•°åˆ—è¡¨ã€‚\n//è€Œcç”Ÿæˆçš„ç¬¦å·åªæ˜¯å‡½æ•°å\n//æ‰€ä»¥å¯¼è‡´ç¬¦å·æ‰¾ä¸åˆ°ã€‚\nint main()\n{\n    fun_C();\n    return 0;\n}\n//å¦‚ä½•è§£å†³â€”â€”ä½¿ç”¨Cè¯­è¨€çš„æ–¹å¼ç¼–è¯‘å’Œç”Ÿæˆç¬¦å·ã€‚\nextern \"C\"\n{\n    void fun_C();//å£°æ˜\n}\n```\n\nåè¿‡æ¥å‘¢ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ\n\n```c++\n#fun.cpp\nvoid fun_CPP()//ç”Ÿæˆçš„ç¬¦å·ï¼šfun_CPP_void\n{\n    printf(\"void fun_CPP()\");\n}\n\n#func.c\nvoid fun_CPP();//ç”Ÿæˆçš„ç¬¦å·ï¼šfun_CPP\nint main()\n{\n    fun_CPP();\n    return 0;\n}\n\n```\n\n\n\n```c++\n//Cè°ƒç”¨C++çš„ä»£ç æ–¹æ³•\n#fun.cpp\nvoid fun_CPP()//ç”Ÿæˆçš„ç¬¦å·ï¼šfun_CPP_void\n{\n    printf(\"void fun_CPP()\");\n}\n\n#tmp.cpp\nvoid fun_CPP();\nextern \"C\"\n{\n    void fun_CPP_tmp()\n    {\n        fun_CPP();\n    }\n}\n\n#func.c\nvoid fun_CPP_tmp();//ç”Ÿæˆçš„ç¬¦å·ï¼šfun_CPP\nint main()\n{\n    fun_CPP_tmp();\n    return 0;\n}\n\n```\n\n## externå…³é”®å­—\n\nä¸¤ç§ç”¨æ³•ï¼š\n\n1. C++ä¸­ï¼Œå¹²é¢„ç¼–è¯‘å™¨ï¼Œ`extern \"C\"`æ˜¯ä»¥Cæ–¹å¼ç¼–è¯‘ï¼Œ`extern \"C++\"`æ˜¯ä»¥C++æ–¹å¼ç¼–è¯‘ï¼›\n2. Cè¯­è¨€ä¸­ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨ï¼Œå‡½æ•°æ˜¯å¤–éƒ¨å‡½æ•°ï¼Œæ—¢å¯ä»¥ç”¨åœ¨æœ¬æ–‡ä»¶ï¼Œä¹Ÿå¯ç”¨åœ¨å…¶ä»–æ–‡ä»¶ã€‚","tags":["tulun"],"categories":["Cpp","Modern"]},{"title":"Cpp_å®Œç¾è½¬å‘","url":"/Cpp/Cpp_å®Œç¾è½¬å‘/","content":"# å†…å®¹\n\n1. ä¸ºä½•éœ€è¦å®Œç¾è½¬å‘\n2. å®Œç¾è½¬å‘\n# ä¸ºä½•éœ€è¦å®Œç¾è½¬å‘\n\n```c++\ntemplate<class T>\nvoid fun(T a)\n{\n    // ...\n}\n// ç”±äºTç±»å‹æœ‰å¯èƒ½æ˜¯å†…ç½®ç±»å‹(Cå­é›†)ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å°è£…ç±»å‹(C++å­é›†)ï¼Œæ‰€ä»¥å¯¹äºæ¨¡æ¿æ¥è¯´ï¼Œå®ç°cå­é›†å’Œclasså­é›†ä¸Šçš„ç»Ÿä¸€çš„èƒŒåå·¥ä½œå¿…å®šå¤æ‚ã€‚\nfun<int>(12);\nfun<Object>(obj);\n```\n\n```c++\n#include<iostream>\nusing namespace std;\nvoid fun(int& a)\n{\n\tcout << \"fun(int& a)\" << endl;\n}\nvoid fun(const int& a)//const int&æ˜¯ä¸ªä¸‡èƒ½å¼•ç”¨ï¼Œå·¦å³å€¼éƒ½å¯ä»¥æ¥æ”¶ï¼Œä½†æ˜¯å¦‚æœfunæœ‰int &&çš„é‡è½½åˆ™ä¼˜å…ˆè¢«int &&æ¥æ”¶ï¼ˆå¦‚å³å€¼10ï¼‰ï¼›åŒæ ·çš„é“ç†ï¼Œå¦‚æœfunæœ‰int &çš„é‡è½½åˆ™ä¼˜å…ˆè¢«int &æ¥æ”¶ï¼ˆå¦‚å·¦å€¼aï¼‰ã€‚\n{\n\tcout << \"fun(const int& a)\" << endl;\n}\nvoid fun(int&& a)\n{\n\tcout << \"fun(int&& a)\" << endl;\n}\n//void fun(int a){} //ä¸fun(int &)å†²çª\nint main()\n{\n\tint a = 10;\n    const int b = 20;\n\tfun(a);\t\t//fun(int& a)\n\tfun(b);\t\t//fun(const int& a)\n\tfun(10);\t//fun(int&& a) --> è™½ç„¶10ä¹Ÿå¯ä»¥è¢«const int &æ¥æ”¶ï¼Œä½†æ˜¯C++11å¼€å§‹åï¼Œé‡è½½å¯¹å€¼çš„ç±»å‹ã€å·¦å³å€¼è¿›è¡Œäº†æ¸…æ™°çš„åˆ’åˆ†ã€‚ä»¥å‰åªæŒ‰ç±»å‹é‡è½½ï¼Œä¹‹åæŒ‰å·¦å³å€¼ä¹Ÿå¯ä»¥é‡è½½ã€‚\n}\n```\n\n# å®Œç¾è½¬å‘\n\n```c++\nvoid fun(int& a)\n{\n\tcout << \"fun(int& a)\" << endl;\n}\nvoid fun(const int& a)\n{\n\tcout << \"fun(const int& a)\" << endl;\n}\nvoid fun(int&& a)\n{\n\tcout << \"fun(int&& a)\" << endl;\n}\ntemplate<class T>\nvoid fac(T&& tmp)\n{\n    //cout << std::is_rvalue_reference<T> << endl;\n    //cout << std::is_lvalue_reference<T> << endl;\n    fun(tmp);\n    // è™½ç„¶åœ¨è°ƒç”¨facæ—¶ï¼Œtmpä¼ å…¥æ­¤å‡½æ•°ä¸­å‰æ˜¯ä¸€ä¸ªå³å€¼ï¼Œä½†æ˜¯ä¼ å‚åŠ¨ä½œå®Œæˆåtmpæˆä¸ºäº†ä¸€ä¸ªå…·åå˜é‡ï¼Œåˆ™åˆé€€åŒ–ä¸ºäº†å·¦å€¼ï¼Œå¯¼è‡´åªèƒ½è°ƒç”¨fun(int& a)ã€‚\n    //æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæœºåˆ¶ï¼Œæ¥ä¿æŒå˜é‡çš„å·¦å³å€¼å±æ€§ã€‚å³å®Œç¾è½¬å‘\n    fun(std::forward<T>(tmp)); //ä¾ç„¶ä¿æŒtmpçš„å³å€¼å±æ€§ï¼Œä½¿å…¶å¯ä»¥è°ƒç”¨fun(int&& a)ã€‚\n}\nint main()\n{\n    int a = 10;\n    const int b = 20;\n    fac(a);\n    fac(b);\n    fac(20);\n    return 0;\n}\n/* è¿è¡Œç»“æœ\n    fun(int& a)\n    fun(int& a)\n    fun(const int& a)\n    fun(const int& a)\n    fun(int& a)\t\t\t-->***å®Œç¾è½¬å‘ä¹‹å‰\n    fun(int&& a)\t\t-->***å®Œç¾è½¬å‘ä¹‹å\n*/\n```\n\n","categories":["Cpp","Modern","å³å€¼å¼•ç”¨"]},{"title":"å·¥å‚æ–¹æ³•æ¨¡å¼","url":"/è®¾è®¡æ¨¡å¼/å·¥å‚æ–¹æ³•æ¨¡å¼/","content":"\n# å†…å®¹\n\n1. å·¥å‚æ–¹æ³•æ¨¡å¼ä¹‹å‰\n2. å·¥å‚æ–¹æ³•æ¨¡å¼\n\n# å·¥å‚æ–¹æ³•æ¨¡å¼ä¹‹å‰\n\nç®€å•å·¥å‚æ¨¡å¼è™½ç„¶ç®€å•ï¼Œä½†å­˜åœ¨ä¸€ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜ã€‚**å½“ç³»ç»Ÿä¸­éœ€è¦å¼•å…¥æ–°äº§å“æ—¶ï¼Œç”±äºé™æ€å·¥å‚æ–¹æ³•é€šè¿‡æ‰€ä¼ å…¥å‚æ•°çš„ä¸åŒæ¥åˆ›å»ºä¸åŒçš„äº§å“ï¼Œè¿™å¿…å®šè¦ä¿®æ”¹å·¥å‚ç±»çš„æºä»£ç (å¢åŠ if else)ï¼Œå°†è¿èƒŒâ€œå¼€é—­åŸåˆ™â€ï¼Œå¦‚ä½•å®ç°å¢åŠ æ–°äº§å“è€Œä¸å½±å“å·²æœ‰ä»£ç ï¼Ÿ** å·¥å‚æ–¹æ³•æ¨¡å¼åº”è¿è€Œç”Ÿã€‚\n\næ¡ˆä¾‹åˆ†æ-**æ—¥å¿—è®°å½•å™¨çš„è®¾è®¡**ï¼š\n\næŸè½¯ä»¶å…¬å¸æ¬²å¼€å‘ä¸€ä¸ªç³»ç»Ÿè¿è¡Œæ—¥å¿—è®°å½•å™¨(Logger)ï¼Œè¯¥è®°å½•å™¨å¯ä»¥é€šè¿‡å¤šç§é€”å¾„ä¿å­˜ç³»ç»Ÿçš„è¿è¡Œæ—¥å¿—ï¼Œå¦‚é€šè¿‡æ–‡ä»¶è®°å½•æˆ–æ•°æ®åº“è®°å½•ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡**ä¿®æ”¹é…ç½®æ–‡ä»¶**çµæ´»åœ°æ›´æ¢æ—¥å¿—è®°å½•æ–¹å¼ã€‚åœ¨è®¾è®¡å„ç±»æ—¥å¿—è®°å½•å™¨æ—¶ï¼Œè¯¥å…¬å¸çš„å¼€å‘äººå‘˜å‘ç°éœ€è¦å¯¹æ—¥å¿—è®°å½•å™¨è¿›è¡Œä¸€äº›åˆå§‹åŒ–å·¥ä½œï¼Œåˆå§‹åŒ–å‚æ•°çš„è®¾ç½®è¿‡ç¨‹è¾ƒä¸ºå¤æ‚ï¼Œè€Œä¸”æŸäº›å‚æ•°çš„è®¾ç½®æœ‰ä¸¥æ ¼çš„å…ˆåæ¬¡åºï¼Œå¦åˆ™å¯èƒ½ä¼šå‘ç”Ÿè®°å½•å¤±è´¥ã€‚**å¦‚ä½•å°è£…è®°å½•å™¨çš„åˆå§‹åŒ–è¿‡ç¨‹å¹¶ä¿è¯å¤šç§è®°å½•å™¨åˆ‡æ¢çš„çµæ´»æ€§**æ˜¯è¯¥å…¬å¸å¼€å‘äººå‘˜é¢ä¸´çš„ä¸€ä¸ªéš¾é¢˜ã€‚\n\nè¯¥å…¬å¸çš„å¼€å‘äººå‘˜é€šè¿‡å¯¹è¯¥éœ€æ±‚è¿›è¡Œåˆ†æï¼Œå‘ç°è¯¥æ—¥å¿—è®°å½•å™¨æœ‰ä¸¤ä¸ªè®¾è®¡è¦ç‚¹ï¼š\n\n1. éœ€è¦å°è£…æ—¥å¿—è®°å½•å™¨çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œè¿™äº›åˆå§‹åŒ–å·¥ä½œè¾ƒä¸ºå¤æ‚ï¼Œä¾‹å¦‚éœ€è¦åˆå§‹åŒ–å…¶ä»–ç›¸å…³çš„ç±»ï¼Œè¿˜æœ‰å¯èƒ½éœ€è¦è¯»å–é…ç½®æ–‡ä»¶ï¼ˆä¾‹å¦‚è¿æ¥æ•°æ®åº“æˆ–åˆ›å»ºæ–‡ä»¶ï¼‰ï¼Œå¯¼è‡´ä»£ç è¾ƒé•¿ï¼Œå¦‚æœå°†å®ƒä»¬éƒ½å†™åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œä¼šå¯¼è‡´æ„é€ å‡½æ•°åºå¤§ï¼Œä¸åˆ©äºä»£ç çš„ä¿®æ”¹å’Œç»´æŠ¤ï¼›\n2. ç”¨æˆ·å¯èƒ½éœ€è¦æ›´æ¢æ—¥å¿—è®°å½•æ–¹å¼ï¼Œåœ¨å®¢æˆ·ç«¯ä»£ç ä¸­éœ€è¦æä¾›ä¸€ç§çµæ´»çš„æ–¹å¼æ¥é€‰æ‹©æ—¥å¿—è®°å½•å™¨ï¼Œå°½é‡**åœ¨ä¸ä¿®æ”¹æºä»£ç çš„åŸºç¡€ä¸Šæ›´æ¢æˆ–è€…å¢åŠ æ—¥å¿—è®°å½•æ–¹å¼**ã€‚\n\nè¯¥å…¬å¸å¼€å‘äººå‘˜æœ€åˆä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼å¯¹æ—¥å¿—è®°å½•å™¨è¿›è¡Œäº†è®¾è®¡ï¼Œåˆå§‹ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼š\n\n![image-20220225130836527](../../images/å·¥å‚æ–¹æ³•æ¨¡å¼/image-20220225130836527.png)\n\nåœ¨ä¸Šå›¾ä¸­ï¼ŒLoggerFactoryå……å½“åˆ›å»ºæ—¥å¿—è®°å½•å™¨çš„å·¥å‚ï¼Œæä¾›äº†å·¥å‚æ–¹æ³•createLogger()ç”¨äºåˆ›å»ºæ—¥å¿—è®°å½•å™¨ï¼ŒLoggeræ˜¯æŠ½è±¡æ—¥å¿—è®°å½•å™¨æ¥å£ï¼Œå…¶å­ç±»ä¸ºå…·ä½“æ—¥å¿—è®°å½•å™¨ã€‚å…¶ä¸­ï¼Œå·¥å‚ç±»LoggerFactoryä»£ç ç‰‡æ®µå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```c++\nclass LoggerFactory\n{\npublic:\n    LoggerFactory() {}\n    ~LoggerFactory() {}\n    static Logger* createLogger(const string & args)\n    {\n        if(args == \"db\")\n        {\n            // ... è¿æ¥æ•°æ®åº“ä»£ç \n            Logger* logger = new DatabaseLogger();//åˆ›å»ºæ•°æ®åº“æ—¥å¿—è®°å½•å™¨å¯¹è±¡\n            // ... åˆå§‹åŒ–æ•°æ®åº“æ—¥å¿—è®°å½•å™¨ä»£ç \n            return logger;\n        }\n        else if(args == \"file\")\n        {\n            // ... åˆ›å»ºæ—¥å¿—æ–‡ä»¶\n            Logger* logger = new DatabaseLogger();//åˆ›å»ºæ–‡ä»¶æ—¥å¿—è®°å½•å™¨å¯¹è±¡\n            // ... åˆå§‹åŒ–æ–‡ä»¶æ—¥å¿—è®°å½•å™¨ä»£ç \n            return logger;\n        }\n        return nullptr;\n    }\n}\n```\n\nä¸ºäº†çªå‡ºè®¾è®¡é‡ç‚¹ï¼Œä¸Šè¿°ä»£ç çœç•¥äº†å…·ä½“æ—¥å¿—è®°å½•å™¨ç±»çš„åˆå§‹åŒ–ä»£ç ã€‚åœ¨LoggerFactoryç±»ä¸­æä¾›äº†é™æ€å·¥å‚æ–¹æ³•createLogger()ï¼Œç”¨äºæ ¹æ®æ‰€ä¼ å…¥çš„å‚æ•°åˆ›å»ºå„ç§ä¸åŒç±»å‹çš„æ—¥å¿—è®°å½•å™¨ã€‚é€šè¿‡ä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼ï¼Œæˆ‘ä»¬å°†æ—¥å¿—è®°å½•å™¨å¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨åˆ†ç¦»ï¼Œå®¢æˆ·ç«¯åªéœ€ä½¿ç”¨ç”±å·¥å‚ç±»åˆ›å»ºçš„æ—¥å¿—è®°å½•å™¨å¯¹è±¡å³å¯ï¼Œæ— é¡»å…³å¿ƒå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°ï¼Œè™½ç„¶ç®€å•å·¥å‚æ¨¡å¼å®ç°äº†å¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨åˆ†ç¦»ï¼Œä½†æ˜¯ä»ç„¶å­˜åœ¨å¦‚ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š\n\n1. å·¥å‚ç±»è¿‡äºåºå¤§ï¼ŒåŒ…å«äº†å¤§é‡çš„ifâ€¦elseâ€¦ä»£ç ï¼Œå¯¼è‡´ç»´æŠ¤å’Œæµ‹è¯•éš¾åº¦å¢å¤§ï¼›\n2. ç³»ç»Ÿæ‰©å±•ä¸çµæ´»ï¼Œå¦‚æœå¢åŠ æ–°ç±»å‹çš„æ—¥å¿—è®°å½•å™¨ï¼Œå¿…é¡»ä¿®æ”¹é™æ€å·¥å‚æ–¹æ³•çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¿åäº†â€œå¼€é—­åŸåˆ™â€ã€‚\n\nå¦‚ä½•è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œæä¾›ä¸€ç§ç®€å•å·¥å‚æ¨¡å¼çš„æ”¹è¿›æ–¹æ¡ˆï¼Ÿè¿™å°±æ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼çš„åŠ¨æœºä¹‹ä¸€ã€‚\n\n# å·¥å‚æ–¹æ³•æ¨¡å¼çš„æ€æƒ³\n\nåœ¨ç®€å•å·¥å‚æ¨¡å¼ä¸­åªæä¾›ä¸€ä¸ªå·¥å‚ç±»ï¼Œè¯¥å·¥å‚ç±»å¤„äºå¯¹äº§å“ç±»è¿›è¡Œå®ä¾‹åŒ–çš„ä¸­å¿ƒä½ç½®ï¼Œå®ƒéœ€è¦çŸ¥é“æ¯ä¸€ä¸ªäº§å“å¯¹è±¡çš„åˆ›å»ºç»†èŠ‚ï¼Œå¹¶å†³å®šä½•æ—¶å®ä¾‹åŒ–å“ªä¸€ä¸ªäº§å“ç±»ã€‚ç®€å•å·¥å‚æ¨¡å¼æœ€å¤§çš„ç¼ºç‚¹æ˜¯å½“æœ‰æ–°äº§å“è¦åŠ å…¥åˆ°ç³»ç»Ÿä¸­æ—¶ï¼Œå¿…é¡»ä¿®æ”¹å·¥å‚ç±»ï¼Œéœ€è¦åœ¨å…¶ä¸­åŠ å…¥å¿…è¦çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¿™è¿èƒŒäº†â€œå¼€é—­åŸåˆ™â€ã€‚æ­¤å¤–ï¼Œåœ¨ç®€å•å·¥å‚æ¨¡å¼ä¸­ï¼Œæ‰€æœ‰çš„äº§å“éƒ½ç”±åŒä¸€ä¸ªå·¥å‚åˆ›å»ºï¼Œå·¥å‚ç±»èŒè´£è¾ƒé‡ï¼Œä¸šåŠ¡é€»è¾‘è¾ƒä¸ºå¤æ‚ï¼Œå…·ä½“äº§å“ä¸å·¥å‚ç±»ä¹‹é—´çš„è€¦åˆåº¦é«˜ï¼Œä¸¥é‡å½±å“äº†ç³»ç»Ÿçš„çµæ´»æ€§å’Œæ‰©å±•æ€§ï¼Œè€Œå·¥å‚æ–¹æ³•æ¨¡å¼åˆ™å¯ä»¥å¾ˆå¥½åœ°è§£å†³è¿™ä¸€é—®é¢˜ã€‚\n\nåœ¨å·¥å‚æ–¹æ³•æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬**ä¸å†æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å·¥å‚ç±»æ¥åˆ›å»ºæ‰€æœ‰çš„äº§å“å¯¹è±¡ï¼Œè€Œæ˜¯é’ˆå¯¹ä¸åŒçš„äº§å“æä¾›ä¸åŒçš„å·¥å‚ï¼Œç³»ç»Ÿæä¾›ä¸€ä¸ªä¸äº§å“ç­‰çº§ç»“æ„å¯¹åº”çš„å·¥å‚ç­‰çº§ç»“æ„**ã€‚\n\n# å·¥å‚æ–¹æ³•æ¨¡å¼çš„å¼€å§‹\n\n## å·¥å‚æ–¹æ³•æ¨¡å¼çš„å®šä¹‰\n\nå·¥å‚æ–¹æ³•æ¨¡å¼(Factory Method Pattern)ï¼šå®šä¹‰ä¸€ä¸ªç”¨äºåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå°†å“ªä¸€ä¸ªç±»å®ä¾‹åŒ–ã€‚å·¥å‚æ–¹æ³•æ¨¡å¼è®©ä¸€ä¸ªç±»çš„å®ä¾‹åŒ–å»¶è¿Ÿåˆ°å…¶å­ç±»ã€‚å·¥å‚æ–¹æ³•æ¨¡å¼åˆç®€ç§°ä¸ºå·¥å‚æ¨¡å¼(Factory Pattern)ï¼Œåˆå¯ç§°ä½œè™šæ‹Ÿæ„é€ å™¨æ¨¡å¼(Virtual Constructor Pattern)æˆ–å¤šæ€å·¥å‚æ¨¡å¼(Polymorphic Factory Pattern)ã€‚å·¥å‚æ–¹æ³•æ¨¡å¼æ˜¯ä¸€ç§ç±»åˆ›å»ºå‹æ¨¡å¼ã€‚\n\nå·¥å‚æ–¹æ³•æ¨¡å¼**æä¾›ä¸€ä¸ªæŠ½è±¡å·¥å‚æ¥å£æ¥å£°æ˜æŠ½è±¡å·¥å‚æ–¹æ³•**ï¼Œè€Œç”±å…¶å­ç±»æ¥å…·ä½“å®ç°å·¥å‚æ–¹æ³•ï¼Œåˆ›å»ºå…·ä½“çš„äº§å“å¯¹è±¡ã€‚å·¥å‚æ–¹æ³•æ¨¡å¼ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼š\n\n![image-20220225132211587](../../images/å·¥å‚æ–¹æ³•æ¨¡å¼/image-20220225132211587.png)\n\nåœ¨å·¥å‚æ–¹æ³•æ¨¡å¼ç»“æ„å›¾ä¸­åŒ…å«å¦‚ä¸‹å‡ ä¸ªè§’è‰²ï¼š\n\n1. **Factoryï¼ˆæŠ½è±¡å·¥å‚ï¼‰**\n   * åœ¨æŠ½è±¡å·¥å‚ç±»ä¸­ï¼Œå£°æ˜äº†å·¥å‚æ–¹æ³•(Factory Method)ï¼Œç”¨äºè¿”å›ä¸€ä¸ªäº§å“ã€‚\n   * æŠ½è±¡å·¥å‚æ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼çš„æ ¸å¿ƒï¼Œæ‰€æœ‰åˆ›å»ºå¯¹è±¡çš„å·¥å‚ç±»éƒ½å¿…é¡»å®ç°è¯¥æ¥å£ã€‚\n2. **ConcreteFactoryï¼ˆå…·ä½“å·¥å‚ï¼‰**\n   * å®ƒæ˜¯æŠ½è±¡å·¥å‚ç±»çš„å­ç±»ï¼Œå®ç°äº†æŠ½è±¡å·¥å‚ä¸­å®šä¹‰çš„å·¥å‚æ–¹æ³•ï¼Œå¹¶å¯ç”±å®¢æˆ·ç«¯è°ƒç”¨ï¼Œè¿”å›ä¸€ä¸ªå…·ä½“äº§å“ç±»çš„å®ä¾‹ã€‚\n3. **Productï¼ˆæŠ½è±¡äº§å“ï¼‰**\n   * å®ƒæ˜¯å®šä¹‰äº§å“çš„æ¥å£ï¼Œæ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼æ‰€åˆ›å»ºå¯¹è±¡çš„è¶…ç±»å‹ï¼Œä¹Ÿå°±æ˜¯äº§å“å¯¹è±¡çš„å…¬å…±çˆ¶ç±»ã€‚\n4. **ConcreteProductï¼ˆå…·ä½“äº§å“è§’è‰²ï¼‰**\n   * å®ƒå®ç°äº†æŠ½è±¡äº§å“æ¥å£ï¼ŒæŸç§ç±»å‹çš„å…·ä½“äº§å“ç”±ä¸“é—¨çš„å…·ä½“å·¥å‚åˆ›å»ºï¼Œå…·ä½“å·¥å‚å’Œå…·ä½“äº§å“ä¹‹é—´ä¸€ä¸€å¯¹åº”ã€‚\n\n**ä¸ç®€å•å·¥å‚æ¨¡å¼ç›¸æ¯”ï¼Œå·¥å‚æ–¹æ³•æ¨¡å¼æœ€é‡è¦çš„åŒºåˆ«æ˜¯å¼•å…¥äº†æŠ½è±¡å·¥å‚è§’è‰²**ï¼ŒæŠ½è±¡å·¥å‚å¯ä»¥æ˜¯æ¥å£ï¼Œä¹Ÿå¯ä»¥æ˜¯æŠ½è±¡ç±»æˆ–è€…å…·ä½“ç±»ï¼Œå…¶å…¸å‹ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```c++\nstruct Factory\n{\npublic:\n    Factory() {cout << \"Factory()\"<<endl;}\n    virtual ~Factory() {cout << \"~Factory\"<<endl;}\n    virtual Product * factoryMethod() = 0;\n}\n```\n\nåœ¨æŠ½è±¡å·¥å‚ä¸­å£°æ˜äº†å·¥å‚æ–¹æ³•ä½†å¹¶æœªå®ç°å·¥å‚æ–¹æ³•ï¼Œå…·ä½“äº§å“å¯¹è±¡çš„åˆ›å»ºç”±å…¶å­ç±»è´Ÿè´£ï¼Œå®¢æˆ·ç«¯é’ˆå¯¹æŠ½è±¡å·¥å‚ç¼–ç¨‹ï¼Œå¯åœ¨è¿è¡Œæ—¶å†æŒ‡å®šå…·ä½“å·¥å‚ç±»ï¼Œå…·ä½“å·¥å‚ç±»å®ç°äº†å·¥å‚æ–¹æ³•ï¼Œä¸åŒçš„å…·ä½“å·¥å‚å¯ä»¥åˆ›å»ºä¸åŒçš„å…·ä½“äº§å“ï¼Œå…¶å…¸å‹ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```c++\nclass ConcreteFactoryA : public Factory\n{\npublic:\n    ConcreteFactoryA() {cout << \"ConcreteFactoryA()\"<<endl;}\n    ~ConcreteFactoryA() {cout << \"~ConcreteFactoryA()\"<<endl;}\n    virtual Product * factoryMethod()\n    {\n        return new ConcreteProductA();\n    }\n}\nclass ConcreteFactoryB : public Factory\n{\npublic:\n    ConcreteFactoryB() {cout << \"ConcreteFactoryB()\"<<endl;}\n    ~ConcreteFactoryB() {cout << \"~ConcreteFactoryB()\"<<endl;}\n    virtual Product * factoryMethod()\n    {\n        return new ConcreteProductB();\n    }\n}\n```\n\näº§å“ç±»ï¼ˆä¸ç®€å•å·¥å‚æ¨¡å¼æ— å¼‚ï¼‰\n\n```c++\nclass Product\n{\npublic:\n    Product() { cout << \"Product()\" << endl; }\n    virtual ~Product() { cout << \"~Product\" << endl; }\n    virtual void methodSame()\n    {\n        cout << \"this is Product\" << endl;\n        //å…¬å…±æ–¹æ³•çš„å®ç°\n    }\n    virtual void methodDiff() = 0;//æŠ½è±¡ä¸šåŠ¡æ–¹æ³•\n};\nclass ConcreteProductA : public Product\n{\npublic:\n    ConcreteProductA() { cout << \"ConcreteProductA()\" << endl; }\n    virtual ~ConcreteProductA() { cout << \"~ConcreteProductA\" << endl; }\n    virtual void methodDiff()\n    {\n        cout << \"this is A\" << endl;\n        // ä¸šåŠ¡æ–¹æ³•çš„è¦†ç›–å®ç°\n    }\n};\nclass ConcreteProductB : public Product\n{\npublic:\n    ConcreteProductB() { cout << \"ConcreteProductB()\" << endl; }\n    virtual ~ConcreteProductB() { cout << \"~ConcreteProductB\" << endl; }\n    virtual void methodDiff()\n    {\n        cout << \"this is B\" << endl;\n        // ä¸šåŠ¡æ–¹æ³•çš„è¦†ç›–å®ç°\n    }\n};\n```\n\nåœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œå…·ä½“å·¥å‚ç±»åœ¨å®ç°å·¥å‚æ–¹æ³•æ—¶é™¤äº†åˆ›å»ºå…·ä½“äº§å“å¯¹è±¡ä¹‹å¤–ï¼Œè¿˜å¯ä»¥è´Ÿè´£äº§å“å¯¹è±¡çš„åˆå§‹åŒ–å·¥ä½œä»¥åŠä¸€äº›èµ„æºå’Œç¯å¢ƒé…ç½®å·¥ä½œï¼Œä¾‹å¦‚è¿æ¥æ•°æ®åº“ã€åˆ›å»ºæ–‡ä»¶ç­‰ã€‚\n\nåœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ï¼Œåªéœ€å…³å¿ƒå·¥å‚ç±»å³å¯ï¼Œä¸åŒçš„å…·ä½“å·¥å‚å¯ä»¥åˆ›å»ºä¸åŒçš„äº§å“ï¼Œå…¸å‹çš„å®¢æˆ·ç«¯ç±»ä»£ç ç‰‡æ®µå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```c++\nint main()\n{\n    Factory* factorya = new ConcreteFactoryA();\n    Factory* factoryb = new ConcreteFactoryB();\n    Product* producta = factorya->factoryMethod();\n    Product* productb = factoryb->factoryMethod();\n    delete factorya;\n    delete factoryb;\n    delete producta;\n    delete productb;\n}\n/* è¿è¡Œç»“æœ\n        Factory()\n        ConcreteFactoryA()\n        Factory()\n        ConcreteFactoryB()\n        Product()\n        ConcreteProductA()\n        Product()\n        ConcreteProductB()\n        ~ConcreteFactoryA\n        ~Factory\n        ~ConcreteFactoryB\n        ~Factory\n        ~ConcreteProductA\n        ~Product\n        ~ConcreteProductB\n        ~Product\n*/\n```\n\nå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æ¥å­˜å‚¨å…·ä½“å·¥å‚ç±»ConcreteFactoryçš„ç±»åï¼Œæ›´æ¢æ–°çš„å…·ä½“å·¥å‚æ—¶æ— é¡»ä¿®æ”¹æºä»£ç ï¼Œç³»ç»Ÿæ‰©å±•æ›´ä¸ºæ–¹ä¾¿ã€‚\n\n### æ€è€ƒ\n\nå·¥å‚æ–¹æ³•æ¨¡å¼ä¸­çš„å·¥å‚æ–¹æ³•èƒ½å¦ä¸ºé™æ€æ–¹æ³•ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ\n\n## å®Œæ•´è§£å†³æ–¹æ¡ˆ\n\nè¯¥å…¬å¸å¼€å‘äººå‘˜å†³å®šä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼æ¥è®¾è®¡æ—¥å¿—è®°å½•å™¨ã€‚å…¶åŸºæœ¬ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼š\n\n![image-20220225140347802](../../images/å·¥å‚æ–¹æ³•æ¨¡å¼/image-20220225140347802.png)\n\nåœ¨ä¸Šå›¾ä¸­ï¼ŒLoggeræ¥å£å……å½“æŠ½è±¡äº§å“ï¼Œå…¶å­ç±»FileLoggerå’ŒDatabaseLoggerå……å½“å…·ä½“äº§å“ï¼ŒLoggerFactoryæ¥å£å……å½“æŠ½è±¡å·¥å‚ï¼Œå…¶å­ç±»FileLoggerFactoryå’ŒDatabaseLoggerFactoryå……å½“å…·ä½“å·¥å‚ã€‚å®Œæ•´ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```c++\n//æ—¥å¿—è®°å½•å™¨æ¥å£ï¼šæŠ½è±¡äº§å“\ninterface Logger {\n\tpublic void writeLog();\n}\n \n//æ•°æ®åº“æ—¥å¿—è®°å½•å™¨ï¼šå…·ä½“äº§å“\nclass DatabaseLogger implements Logger {\n\tpublic void writeLog() {\n\t\tSystem.out.println(\"æ•°æ®åº“æ—¥å¿—è®°å½•ã€‚\");\n\t}\n}\n \n//æ–‡ä»¶æ—¥å¿—è®°å½•å™¨ï¼šå…·ä½“äº§å“\nclass FileLogger implements Logger {\n\tpublic void writeLog() {\n\t\tSystem.out.println(\"æ–‡ä»¶æ—¥å¿—è®°å½•ã€‚\");\n\t}\n}\n \n//æ—¥å¿—è®°å½•å™¨å·¥å‚æ¥å£ï¼šæŠ½è±¡å·¥å‚\ninterface LoggerFactory {\n\tpublic Logger createLogger();\n}\n \n//æ•°æ®åº“æ—¥å¿—è®°å½•å™¨å·¥å‚ç±»ï¼šå…·ä½“å·¥å‚\nclass DatabaseLoggerFactory implements LoggerFactory {\n\tpublic Logger createLogger() {\n\t\t\t//è¿æ¥æ•°æ®åº“ï¼Œä»£ç çœç•¥\n\t\t\t//åˆ›å»ºæ•°æ®åº“æ—¥å¿—è®°å½•å™¨å¯¹è±¡\n\t\t\tLogger logger = new DatabaseLogger(); \n\t\t\t//åˆå§‹åŒ–æ•°æ®åº“æ—¥å¿—è®°å½•å™¨ï¼Œä»£ç çœç•¥\n\t\t\treturn logger;\n\t}\t\n}\n \n//æ–‡ä»¶æ—¥å¿—è®°å½•å™¨å·¥å‚ç±»ï¼šå…·ä½“å·¥å‚\nclass FileLoggerFactory implements LoggerFactory {\n\tpublic Logger createLogger() {\n            //åˆ›å»ºæ–‡ä»¶æ—¥å¿—è®°å½•å™¨å¯¹è±¡\n\t\t\tLogger logger = new FileLogger(); \n\t\t\t//åˆ›å»ºæ–‡ä»¶ï¼Œä»£ç çœç•¥\n\t\t\treturn logger;\n\t}\t\n}\n```\n\nç¼–å†™å¦‚ä¸‹å®¢æˆ·ç«¯æµ‹è¯•ä»£ç ï¼š\n\n```c++\nint main()\n{\n    LoggerFactory factory;\n    Logger logger;\n    factory = new FileLoggerFactory(); //å¯å¼•å…¥é…ç½®æ–‡ä»¶å®ç°\n    logger = factory.createLogger();\n    logger.writeLog();\n}\n/* è¿è¡Œç»“æœ\n\n*/\n```\n\n## ä¸é…ç½®æ–‡ä»¶ç»“åˆ\n\n ä¸ºäº†è®©ç³»ç»Ÿå…·æœ‰æ›´å¥½çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ï¼ŒSunnyå…¬å¸å¼€å‘äººå‘˜å†³å®šå¯¹æ—¥å¿—è®°å½•å™¨å®¢æˆ·ç«¯ä»£ç è¿›è¡Œé‡æ„ï¼Œä½¿å¾—å¯ä»¥åœ¨ä¸ä¿®æ”¹ä»»ä½•å®¢æˆ·ç«¯ä»£ç çš„åŸºç¡€ä¸Šæ›´æ¢æˆ–å¢åŠ æ–°çš„æ—¥å¿—è®°å½•æ–¹å¼ã€‚\n\nåœ¨å®¢æˆ·ç«¯ä»£ç ä¸­å°†ä¸å†ä½¿ç”¨newå…³é”®å­—æ¥åˆ›å»ºå·¥å‚å¯¹è±¡ï¼Œè€Œæ˜¯å°†å…·ä½“å·¥å‚ç±»çš„ç±»åå­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ï¼ˆå¦‚XMLæ–‡ä»¶ï¼‰ä¸­ï¼Œé€šè¿‡è¯»å–é…ç½®æ–‡ä»¶è·å–ç±»åå­—ç¬¦ä¸²ï¼Œå†ä½¿ç”¨Javaçš„åå°„æœºåˆ¶ï¼Œæ ¹æ®ç±»åå­—ç¬¦ä¸²ç”Ÿæˆå¯¹è±¡ã€‚åœ¨æ•´ä¸ªå®ç°è¿‡ç¨‹ä¸­éœ€è¦ç”¨åˆ°ä¸¤ä¸ªæŠ€æœ¯ï¼šJavaåå°„æœºåˆ¶ä¸é…ç½®æ–‡ä»¶è¯»å–ã€‚è½¯ä»¶ç³»ç»Ÿçš„é…ç½®æ–‡ä»¶é€šå¸¸ä¸ºXMLæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨DOM (Document Object Model)ã€SAX (Simple API for XML)ã€StAX (Streaming API for XML)ç­‰æŠ€æœ¯æ¥å¤„ç†XMLæ–‡ä»¶ã€‚å…³äºDOMã€SAXã€StAXç­‰æŠ€æœ¯å‡å¯å……å½“é…ç½®æ–‡ä»¶æŠ€æœ¯ã€‚\n\n# å‚è€ƒæ–‡çŒ®\n\n```\n[1] åˆ˜ä¼Ÿ. è®¾è®¡æ¨¡å¼.\n```\n","categories":["è®¾è®¡æ¨¡å¼","åˆ›å»ºå‹æ¨¡å¼"]},{"title":"æ’åº_å †æ’åº","url":"/ç®—æ³•/æ’åº_å †æ’åº/","content":"# å†…å®¹\n\n1. é»˜è®¤åˆ’åˆ†æ³•\n\n# ä»£ç é€»è¾‘\n\n```c++\n\n```\n# éé€’å½’å½¢å¼\n\n```c++\n\n```\n# å †æ’åºçš„åº”ç”¨\n\nå †æ’åºä¸»è¦æœåŠ¡äºä¼˜å…ˆé˜Ÿåˆ—ï¼Œäºæ˜¯å †æ’åºçš„åº”ç”¨ä¾¿æ˜¯ä¼˜å…ˆé˜Ÿåˆ—çš„åº”ç”¨ï¼Œç”¨åˆ°ä¼˜å…ˆé˜Ÿåˆ—çš„éƒ½æœ‰å †æ’åºã€‚\n\n1. ä¼˜å…ˆé˜Ÿåˆ—çš„åº•å±‚æ˜¯å †æ’åºï¼Œå…³é”®éƒ¨åˆ†æ˜¯ä»ä¸‹åˆ°ä¸Šã€ä»ä¸Šåˆ°ä¸‹è°ƒæ•´å‡½æ•°\n2. å“ˆå¤«æ›¼æ ‘\n3. æœç´¢ç®—æ³•ï¼Œå¹¿åº¦æœç´¢ï¼ŒAæ˜Ÿç®—æ³•ï¼ˆæ¯æ¬¡å–å‡ºä»£ä»·æœ€ä½çš„æ–¹å—ï¼‰\n4. å¤–æ’åºä¸­çš„è´¥è€…æ ‘æ˜¯å †çš„ä¸€ä¸ªå˜ç§å½¢å¼ï¼Œå †çš„æ™®é€šåº”ç”¨æ˜¯å–ä¸€ä¸ªæ•°æ®ï¼Œå¯¹äºè´¥è€…æ ‘æ¥è¯´æ˜¯å–ä¸€ç»„æ•°æ®ã€‚\n5. é€‚äºæ‰¾ç¬¬kæ•°ï¼Œä½†æ˜¯æ•´ä½“æ€§èƒ½åŠ£äºå¿«é€Ÿæ’åºæ–¹æ³•æ‰¾ç¬¬kæ•°ï¼Œè™½ç„¶éƒ½æ˜¯æŒ‰åˆ’åˆ†å¯»æ‰¾çš„ï¼ˆä¸€åŠçš„ä¸€åŠï¼‰ï¼Œä½†æ˜¯å †æ’åºè¦æŠŠæ•´ä¸ªéƒ½æ’å®Œï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯$O(nlogk)$ï¼Œè€Œå¿«æ’æ‰¾ç¬¬kæ•°çš„å¤æ‚åº¦æ˜¯$O(n)$\n# é€‚ç”¨æ€æƒ³çš„é¢˜\n\n","categories":["ç®—æ³•","æ’åº"]},{"title":"ç®—æ³•_åŠ¨æ€è§„åˆ’","url":"/ç®—æ³•/ç®—æ³•_åŠ¨æ€è§„åˆ’/","content":"# å†…å®¹\n1. \n# åŠ¨æ€è§„åˆ’é€‚ç”¨çš„é—®é¢˜\næ±‚è§£æœ€ä¼˜åŒ–é—®é¢˜\n# è§£é¢˜è¿‡ç¨‹\næ‰¾åˆ°è§„æ¨¡ç¼©å‡çš„æ–¹æ¡ˆ\n# ç»å…¸é¢˜ç›®\n\n## æœ€é•¿å…¬å…±å­åºåˆ—\n\nå‡è®¾æœ‰Xæ•°ç»„è§„æ¨¡æ˜¯mï¼ŒYæ•°ç»„è§„æ¨¡æ˜¯nï¼Œæœ€é•¿å…¬å…±å­åºåˆ—ä¸ºZï¼Œè§„æ¨¡ä¸ºk(>=0)ã€‚\n\n```c++\nX={x1, x2, x3, ..., xm-1, xm};\nY={y1, y2, y3, ..., yn-1, yn};\nZ={z1, z2, z3, ..., zk-1, zk};\n```\n\n```c++\n1.è‹¥xm == xn, åˆ™xm == yn == zk\t//å°å†™xï¼Œyï¼Œzè¡¨ç¤ºæŸä¸€å­—ç¬¦\n    åˆ™å¯ä»¥æŠŠé—®é¢˜çš„è§£è§„æ¨¡è§£é‡Šä¸ºï¼šZk-1 = Xm-1 && Yn-1\t//å¤§å†™X,Y,Zè¡¨ç¤ºæ•°ç»„è§„æ¨¡é—®é¢˜\n2.è‹¥xm != yn, xm != zkï¼Œ\n    åˆ™Zk = Xm-1 && Yn\n3.è‹¥xm != yn, yn != zkï¼Œ\n    åˆ™Zk = Xm && Yn-1\n```\n\n```c++\nc[m][n]è¡¨ç¤ºMAXLEN\n    c[m][n] = (m == 0 || n == 0) ? 0 : ...\n    m > 1, n > 1\n    c[m][n] = (xm == yn) ? c[m-1][n-1] + 1 : ...\n    c[m][n] = (xm != yn) ? Max(c[m-1][n],c[m][n-1]) : ...\n```\n### é€’å½’ç‰ˆæœ¬\n\n```c++\n#include<iostream>\n#include<vector>\nusing namespace std;\n\nint LCSLength(const char* X, int m, const char* Y, int n)\n{\n\tif (m == 0 || n == 0)return 0;\n\telse\n\t{\n\t\tif (X[m] == Y[n])return LCSLength(X, m - 1, Y, n - 1) + 1;\n\t\telse\n\t\t{\n\t\t\tint max1 = LCSLength(X, m - 1, Y, n);\n\t\t\tint max2 = LCSLength(X, m, Y, n - 1);\n\t\t\treturn max1 > max2 ? max1 : max2;\n\t\t}\n\t}\n}\nint main()\n{\n\tchar X[] = { \"#ABCBDAB\" };\n\tchar Y[] = { \"#BDCABA\" };\n\tint xm = strlen(X) - 1;\n\tint yn = strlen(Y) - 1;\n\tvector<vector<int>> c;\n\tc.resize(xm + 1);\n\tfor (int i = 0; i < xm + 1; ++i)\n\t{\n\t\tc[i].resize(yn + 1);\n\t}\n\tint maxlen = LCSLength(X, xm, Y, yn);\n}\n```\n### ä¼ å…¥vector\n\n```c++\n#include<iostream>\n#include<vector>\nusing namespace std;\n\nint LCSLength(const char* X, int m, const char* Y, int n, vector<vector<int>> &c)\n{\n\tif (m == 0 || n == 0)return 0;\n\telse\n\t{\n\t\tif (X[m] == Y[n])return LCSLength(X, m - 1, Y, n - 1) + 1;\n\t\telse\n\t\t{\n\t\t\tint max1 = LCSLength(X, m - 1, Y, n);\n\t\t\tint max2 = LCSLength(X, m, Y, n - 1);\n\t\t\treturn max1 > max2 ? max1 : max2;\n\t\t}\n\t}\n}\nint main()\n{\n\tchar X[] = { \"#ABCBDAB\" };\n\tchar Y[] = { \"#BDCABA\" };\n\tint xm = strlen(X) - 1;\n\tint yn = strlen(Y) - 1;\n\tvector<vector<int>> c;\n\tc.resize(xm + 1);\n\tfor (int i = 0; i < xm + 1; ++i)\n\t{\n\t\tc[i].resize(yn+1, 0); //ç¬¬äºŒä¸ªå‚æ•°ä»£è¡¨æ¯ä¸€ä¸ªintéƒ½åˆå§‹åŒ–ä¸º0\n\t}\n\tint maxlen = LCSLength(X, xm, Y, yn);\n}\n```\n# å¤å…¸é—®é¢˜-å…”å­\n\næœ‰ä¸€å¯¹å…”å­ï¼Œä»å‡ºç”Ÿåç¬¬3ä¸ªæœˆèµ·ï¼Œæ¯ä¸ªæœˆéƒ½ç”Ÿä¸€å¯¹å…”å­ï¼Œå°å…”å­é•¿åˆ°ç¬¬ä¸‰ä¸ªæœˆå¼€å§‹æ¯ä¸ªæœˆåˆç”Ÿä¸€å¯¹å…”å­ï¼Œå‡å¦‚å…”å­ä¸æ­»ï¼Œé—®ç¬¬24ä¸ªæœˆçš„å…”å­æ€»æ•°ä¸ºå¤šå°‘ï¼Ÿ\n\n```c++\nint dp[25];\ndp[0] [1] [2] [3] [4] [5] [6] [7] [8] [9]\n       1   1   2   3   5   \n    å‘ç°ï¼Œdp[i] = dp[i-1] + dp[i-2]\n```","categories":["ç®—æ³•","åŠ¨æ€è§„åˆ’"]},{"title":"ç®€å•å·¥å‚æ¨¡å¼","url":"/è®¾è®¡æ¨¡å¼/ç®€å•å·¥å‚æ¨¡å¼/","content":"\n# å†…å®¹\n\n1. ç®€å•å·¥å‚æ¨¡å¼ä¹‹å‰\n2. ç®€å•å·¥å‚æ¨¡å¼\n\n# ç®€å•å·¥å‚æ¨¡å¼ä¹‹å‰\n\næ¡ˆä¾‹åˆ†æï¼š\n\næŸè½¯ä»¶å…¬å¸æ¬²å¼€å‘ä¸€å¥—å›¾è¡¨åº“ï¼Œè¯¥å›¾è¡¨åº“å¯ä»¥ä¸ºåº”ç”¨ç³»ç»Ÿæä¾›å„ç§ä¸åŒå¤–è§‚çš„å›¾è¡¨ï¼Œä¾‹å¦‚æŸ±çŠ¶å›¾ã€é¥¼çŠ¶å›¾ã€æŠ˜çº¿å›¾ç­‰ã€‚è¯¥å…¬å¸å›¾è¡¨åº“è®¾è®¡äººå‘˜å¸Œæœ›ä¸ºåº”ç”¨ç³»ç»Ÿå¼€å‘äººå‘˜æä¾›ä¸€å¥—çµæ´»æ˜“ç”¨çš„å›¾è¡¨åº“ï¼Œè€Œä¸”**å¯ä»¥è¾ƒä¸ºæ–¹ä¾¿åœ°å¯¹å›¾è¡¨åº“è¿›è¡Œæ‰©å±•**ï¼Œä»¥ä¾¿èƒ½å¤Ÿåœ¨å°†æ¥å¢åŠ ä¸€äº›æ–°ç±»å‹çš„å›¾è¡¨ã€‚\n\nè¯¥è½¯ä»¶å…¬å¸å›¾è¡¨åº“è®¾è®¡äººå‘˜æå‡ºäº†ä¸€ä¸ªåˆå§‹è®¾è®¡æ–¹æ¡ˆï¼Œå°†æ‰€æœ‰å›¾è¡¨çš„å®ç°ä»£ç å°è£…åœ¨ä¸€ä¸ªChartç±»ä¸­ï¼Œå…¶æ¡†æ¶ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```c++\nclass Chart\n{\nprivate:\n    string type;\npublic:\n    Chart(const string & type) : type(type)\n    {\n        if(type == \"histogram\")\n        {\n            //åˆå§‹åŒ–æŸ±çŠ¶å›¾\n        }\n        else if(type == \"pie\")\n        {\n            //åˆå§‹åŒ–é¥¼çŠ¶å›¾\n        }\n        else if(type == \"line\")\n        {\n            //åˆå§‹åŒ–æŠ˜çº¿å›¾\n        }\n    }\n    void display()\n    {\n        if(type == \"histogram\")\n        {\n            //æ˜¾ç¤ºæŸ±çŠ¶å›¾\n        }\n        else if(type == \"pie\")\n        {\n            //æ˜¾ç¤ºé¥¼çŠ¶å›¾\n        }\n        else if(type == \"line\")\n        {\n            //æ˜¾ç¤ºæŠ˜çº¿å›¾\n        }\n    }\n};\nint main()\n{\n    Chart(\"pie\");\n}\n```\n\nå®¢æˆ·ç«¯ä»£ç é€šè¿‡è°ƒç”¨Chartç±»çš„æ„é€ å‡½æ•°æ¥åˆ›å»ºå›¾è¡¨å¯¹è±¡ï¼Œæ ¹æ®å‚æ•°typeçš„ä¸åŒå¯ä»¥å¾—åˆ°ä¸åŒç±»å‹çš„å›¾è¡¨ï¼Œç„¶åå†è°ƒç”¨display()æ–¹æ³•æ¥æ˜¾ç¤ºç›¸åº”çš„å›¾è¡¨ã€‚\n\nChartç±»æ˜¯ä¸€ä¸ªâ€œå·¨å¤§çš„â€ç±»ï¼Œåœ¨è¯¥ç±»çš„è®¾è®¡ä¸­å­˜åœ¨å¦‚ä¸‹å‡ ä¸ªé—®é¢˜ï¼š\n\n1. åœ¨Chartç±»ä¸­åŒ…å«å¾ˆå¤šâ€œifâ€¦elseâ€¦â€ä»£ç å—ï¼Œæ•´ä¸ªç±»çš„ä»£ç ç›¸å½“å†—é•¿ï¼Œä»£ç è¶Šé•¿ï¼Œé˜…è¯»éš¾åº¦ã€ç»´æŠ¤éš¾åº¦å’Œæµ‹è¯•éš¾åº¦ä¹Ÿè¶Šå¤§ï¼›è€Œä¸”å¤§é‡æ¡ä»¶è¯­å¥çš„å­˜åœ¨è¿˜å°†å½±å“ç³»ç»Ÿçš„æ€§èƒ½ï¼Œç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­éœ€è¦åšå¤§é‡çš„æ¡ä»¶åˆ¤æ–­ã€‚\n2. Chartç±»çš„èŒè´£è¿‡é‡ï¼Œå®ƒè´Ÿè´£åˆå§‹åŒ–å’Œæ˜¾ç¤ºæ‰€æœ‰çš„å›¾è¡¨å¯¹è±¡ï¼Œå°†å„ç§å›¾è¡¨å¯¹è±¡çš„åˆå§‹åŒ–ä»£ç å’Œæ˜¾ç¤ºä»£ç é›†ä¸­åœ¨ä¸€ä¸ªç±»ä¸­å®ç°ï¼Œ**è¿åäº†â€œå•ä¸€èŒè´£åŸåˆ™â€**ï¼Œä¸åˆ©äºç±»çš„é‡ç”¨å’Œç»´æŠ¤ï¼›è€Œä¸”å°†å¤§é‡çš„å¯¹è±¡åˆå§‹åŒ–ä»£ç éƒ½å†™åœ¨æ„é€ å‡½æ•°ä¸­å°†å¯¼è‡´æ„é€ å‡½æ•°éå¸¸åºå¤§ï¼Œå¯¹è±¡åœ¨åˆ›å»ºæ—¶éœ€è¦è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼Œé™ä½äº†å¯¹è±¡åˆ›å»ºçš„æ•ˆç‡ã€‚\n3. å½“éœ€è¦å¢åŠ æ–°ç±»å‹çš„å›¾è¡¨æ—¶ï¼Œå¿…é¡»ä¿®æ”¹Chartç±»çš„æºä»£ç ï¼Œ**è¿åäº†â€œå¼€é—­åŸåˆ™â€**ã€‚\n4. å®¢æˆ·ç«¯åªèƒ½é€šè¿‡newå…³é”®å­—æ¥ç›´æ¥åˆ›å»ºChartå¯¹è±¡ï¼ŒChartç±»ä¸å®¢æˆ·ç«¯ç±»è€¦åˆåº¦è¾ƒé«˜ï¼Œå¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨æ— æ³•åˆ†ç¦»ã€‚\n5. å®¢æˆ·ç«¯åœ¨åˆ›å»ºChartå¯¹è±¡ä¹‹å‰å¯èƒ½è¿˜éœ€è¦è¿›è¡Œå¤§é‡åˆå§‹åŒ–è®¾ç½®ï¼Œä¾‹å¦‚è®¾ç½®æŸ±çŠ¶å›¾çš„é¢œè‰²ã€é«˜åº¦ç­‰ï¼Œå¦‚æœåœ¨Chartç±»çš„æ„é€ å‡½æ•°ä¸­æ²¡æœ‰æä¾›ä¸€ä¸ªé»˜è®¤è®¾ç½®ï¼Œé‚£å°±åªèƒ½ç”±å®¢æˆ·ç«¯æ¥å®Œæˆåˆå§‹è®¾ç½®ï¼Œè¿™äº›ä»£ç åœ¨æ¯æ¬¡åˆ›å»ºChartå¯¹è±¡æ—¶éƒ½ä¼šå‡ºç°ï¼Œå¯¼è‡´ä»£ç çš„é‡å¤ã€‚\n\né¢å¯¹ä¸€ä¸ªå¦‚æ­¤å·¨å¤§ã€èŒè´£å¦‚æ­¤é‡ï¼Œä¸”ä¸å®¢æˆ·ç«¯ä»£ç è€¦åˆåº¦éå¸¸é«˜çš„ç±»ï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆåŠï¼Ÿç®€å•å·¥å‚æ¨¡å¼å°†åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³ä¸Šè¿°é—®é¢˜ã€‚\n\n# ç®€å•å·¥å‚æ¨¡å¼çš„æ€æƒ³\n\n## ä¸ºä½•éœ€è¦å·¥å‚[Javaä»£ç è®²è§£]\n\nåœ¨å¼€å§‹ç®€å•å·¥å‚æ¨¡å¼å‰ï¼Œæˆ‘ä»¬å…ˆæ¢ç©¶ä¸€ä¸ªé—®é¢˜â€”â€”åˆ›å»ºå¯¹è±¡å¯ä»¥å¾ˆçµæ´»ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦å·¥å‚ï¼Ÿ\n\nä¸ä¸€ä¸ªå¯¹è±¡ç›¸å…³çš„èŒè´£é€šå¸¸æœ‰ä¸‰ç±»ï¼š**å¯¹è±¡æœ¬èº«æ‰€å…·æœ‰çš„èŒè´£ã€åˆ›å»ºå¯¹è±¡çš„èŒè´£å’Œä½¿ç”¨å¯¹è±¡çš„èŒè´£**ã€‚å¯¹è±¡æœ¬èº«çš„èŒè´£æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œå°±æ˜¯å¯¹è±¡è‡ªèº«æ‰€å…·æœ‰çš„ä¸€äº›æ•°æ®å’Œè¡Œä¸ºï¼Œå¯é€šè¿‡ä¸€äº›å…¬å¼€çš„æ–¹æ³•æ¥å®ç°å®ƒçš„èŒè´£ã€‚åœ¨æœ¬æ–‡ï¼Œæˆ‘ä»¬å°†ç®€å•è®¨è®ºä¸€ä¸‹å¯¹è±¡çš„åˆ›å»ºèŒè´£å’Œä½¿ç”¨èŒè´£ã€‚\n\nåˆ›å»ºå¯¹è±¡çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œè­¬å¦‚åœ¨Javaè¯­è¨€ä¸­ï¼Œæœ‰ä»¥ä¸‹å‡ ç§åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼š\n\n1. newå…³é”®å­—\n2. åå°„æœºåˆ¶\n3. clone()æ–¹æ³•\n4. é€šè¿‡å·¥å‚ç±»åˆ›å»ºå¯¹è±¡\n\næ¯«æ— ç–‘é—®ï¼Œåœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ç›´æ¥ä½¿ç”¨newå…³é”®å­—æ˜¯æœ€ç®€å•çš„ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼Œä½†æ˜¯å®ƒçš„çµæ´»æ€§è¾ƒå·®ï¼Œä¸‹é¢é€šè¿‡ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹æ¥åŠ ä»¥è¯´æ˜ï¼š \n\n```c++\nclass LoginAction\n{\n    private UserDAO udao;\n    public LoginAction()\n    {\n        udao = new JDBCUserDAO();\t//åˆ›å»ºå¯¹è±¡\n    }\n    public void execute()\n    {\n        // ...\n        udao.findUserById();\t\t//ä½¿ç”¨å¯¹è±¡\n    \t// ...\n    }\n}\n```\n\nåœ¨LoginActionç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªUserDAOç±»å‹çš„å¯¹è±¡udaoï¼Œåœ¨LoginActionçš„æ„é€ å‡½æ•°ä¸­åˆ›å»ºäº†JDBCUserDAOç±»å‹çš„udaoå¯¹è±¡ï¼Œå¹¶åœ¨execute()æ–¹æ³•ä¸­è°ƒç”¨äº†udaoå¯¹è±¡çš„findUserById()æ–¹æ³•ï¼Œè¿™æ®µä»£ç çœ‹ä¸Šå»å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚\n\nä¸‹é¢åˆ†æä»¥ä¸‹LoginActionå’ŒUserDAOä¹‹é—´çš„å…³ç³»ï¼ŒLoginActionç±»è´Ÿè´£åˆ›å»ºäº†ä¸€ä¸ªUserDAOå­ç±»çš„å¯¹è±¡å¹¶ä½¿ç”¨UserDAOçš„æ–¹æ³•æ¥å®Œæˆç›¸åº”çš„ä¸šåŠ¡å¤„ç†ï¼Œä¹Ÿå°±æ˜¯è¯´**LoginActionå³è´Ÿè´£udaoçš„åˆ›å»ºåˆè´Ÿè´£udaoçš„ä½¿ç”¨**ã€‚åˆ›å»ºå¯¹è±¡å’Œä½¿ç”¨å¯¹è±¡çš„èŒè´£è€¦åˆåœ¨ä¸€èµ·ï¼Œè¿™æ ·çš„è®¾è®¡ä¼šå¯¼è‡´ä¸€ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜ï¼šå¦‚æœåœ¨LoginActionä¸­å¸Œæœ›èƒ½å¤Ÿä½¿ç”¨UserDAOçš„å¦ä¸€ä¸ªå­ç±»å¦‚HibernateUserDAOç±»å‹çš„å¯¹è±¡ï¼Œå¿…é¡»ä¿®æ”¹LoginActionç±»çš„æºä»£ç ï¼ˆæ¯”å¦‚ï¼Œä¿®æ”¹æ„é€ å‡½æ•°ï¼Œudao=new HibernateUserDAO();ï¼‰ï¼Œ**è¿åäº†â€œå¼€é—­åŸåˆ™â€**ã€‚\n\n## å¦‚ä½•è§£å†³è¯¥é—®é¢˜ï¼Ÿ\n\næœ€å¸¸ç”¨çš„ä¸€ç§è§£å†³æ–¹æ³•æ˜¯å°†udaoå¯¹è±¡çš„åˆ›å»ºèŒè´£ä»LoginActionç±»ä¸­ç§»é™¤ï¼Œåœ¨LoginActionç±»ä¹‹å¤–åˆ›å»ºå¯¹è±¡ï¼Œé‚£ä¹ˆè°æ¥è´Ÿè´£åˆ›å»ºUserDAOå¯¹è±¡å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å·¥å‚ç±»ã€‚\n\né€šè¿‡å¼•å…¥å·¥å‚ç±»ï¼Œå®¢æˆ·ç±»ï¼ˆå¦‚LoginActionï¼‰ä¸æ¶‰åŠå¯¹è±¡çš„åˆ›å»ºï¼Œå¯¹è±¡çš„åˆ›å»ºè€…ä¹Ÿä¸éœ€è®¾è®¡å¯¹è±¡çš„ä½¿ç”¨ã€‚å¼•å…¥å·¥å‚ç±»UserDAOFactoryä¹‹åçš„ç»“æ„å¦‚å›¾\n\n![image-20220224235938416](../../images/ç®€å•å·¥å‚æ¨¡å¼/image-20220224235938416.png)\n\n## å¥½å¤„\n\n### å¥½å¤„1-åˆ†ç¦»åˆ›å»ºèŒè´£å’Œä½¿ç”¨èŒè´£\n\nå·¥å‚ç±»çš„å¼•å…¥é™ä½äº†å› ä¸ºäº§å“æˆ–å·¥å‚ç±»æ”¹å˜æ‰€é€ æˆçš„ç»´æŠ¤å·¥ä½œé‡ã€‚å¦‚æœUserDAOçš„æŸä¸ªå­ç±»çš„æ„é€ å‡½æ•°å‘ç”Ÿæ”¹å˜æˆ–è€…è¦éœ€è¦æ·»åŠ æˆ–ç§»é™¤ä¸åŒçš„å­ç±»ï¼Œåªè¦ç»´æŠ¤UserDAOFactoryçš„ä»£ç ï¼Œè€Œä¸ä¼šå½±å“åˆ°LoginActionï¼›å¦‚æœUserDAOçš„æ¥å£å‘ç”Ÿæ”¹å˜ï¼Œä¾‹å¦‚æ·»åŠ ã€ç§»é™¤æ–¹æ³•æˆ–æ”¹å˜æ–¹æ³•åï¼Œåªè¦ä¿®æ”¹LoginActionï¼ˆè­¬å¦‚executeå‡½æ•°å†…éƒ¨è°ƒç”¨udaoçš„æ–¹æ³•ï¼‰ï¼Œä¸ä¼šç»™UserDAOFactoryå¸¦æ¥ä»»ä½•å½±å“ã€‚\n\nå·¥å‚æ¨¡å¼è¯´æ¥è¯´å»ï¼Œåªå¼ºè°ƒäº†ä¸€ç‚¹ï¼šä¸¤ä¸ªç±»Aå’ŒBä¹‹é—´çš„å…³ç³»åº”è¯¥ä»…ä»…æ˜¯Aåˆ›å»ºBæˆ–è€…æ˜¯Aä½¿ç”¨Bï¼Œè€Œä¸èƒ½ä¸¤ç§å…³ç³»éƒ½æœ‰ã€‚**å°†å¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨åˆ†ç¦»**ã€‚ä½¿å¾—ç³»ç»Ÿæ›´åŠ ç¬¦åˆâ€œå•ä¸€èŒè´£åŸåˆ™â€ï¼Œæœ‰åˆ©äºå¯¹åŠŸèƒ½çš„å¤ç”¨å’Œç³»ç»Ÿçš„ç»´æŠ¤ã€‚\n\n### å¥½å¤„2-å·¥å‚ç±»å°†å¯¹è±¡çš„åˆ›å»ºä»£ç ã€é…ç½®ç¯å¢ƒå°è£…\n\næ­¤å¤–ï¼Œå°†å¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨åˆ†ç¦»è¿˜æœ‰ä¸€ä¸ªå¥½å¤„ï¼š**é˜²æ­¢ç”¨æ¥å®ä¾‹åŒ–ä¸€ä¸ªç±»çš„æ•°æ®å’Œä»£ç åœ¨å¤šä¸ªç±»ä¸­åˆ°å¤„éƒ½æ˜¯ï¼Œå¯ä»¥å°†æœ‰å…³åˆ›å»ºçš„çŸ¥è¯†æ¬ç§»åˆ°ä¸€ä¸ªå·¥å‚ç±»ä¸­**ã€‚è¿™åœ¨Joshua Kerievskyçš„ã€Šé‡æ„ä¸æ¨¡å¼ã€‹ä¸€ä¹¦ä¸­æœ‰ä¸“é—¨çš„ä¸€èŠ‚æ¥è¿›è¡Œä»‹ç»ã€‚å› ä¸ºæœ‰æ—¶å€™æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¯¹è±¡ä¸åªæ˜¯ç®€å•è°ƒç”¨å…¶æ„é€ å‡½æ•°ï¼Œè¿˜éœ€è¦è®¾ç½®ä¸€äº›å‚æ•°ï¼Œå¯èƒ½è¿˜éœ€è¦é…ç½®ç¯å¢ƒï¼Œå¦‚æœå°†è¿™äº›ä»£ç æ•£è½åœ¨æ¯ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„å®¢æˆ·ç±»ä¸­ï¼ŒåŠ¿å¿…ä¼šå‡ºç°ä»£ç é‡å¤ã€åˆ›å»ºè”“å»¶çš„é—®é¢˜ï¼Œè€Œè¿™äº›å®¢æˆ·ç±»å…¶å®æ— é¡»æ‰¿æ‹…å¯¹è±¡çš„åˆ›å»ºå·¥ä½œï¼Œå®ƒä»¬åªéœ€ä½¿ç”¨å·²åˆ›å»ºå¥½çš„å¯¹è±¡å°±å¯ä»¥äº†ã€‚æ­¤æ—¶ï¼Œå¯ä»¥å¼•å…¥**å·¥å‚ç±»æ¥å°è£…å¯¹è±¡çš„åˆ›å»ºé€»è¾‘å’Œå®¢æˆ·ä»£ç çš„å®ä¾‹åŒ–/é…ç½®é€‰é¡¹**ã€‚\n\n### å¥½å¤„3-å¯ä»¥å¢åŠ ä»£ç å¯è¯»æ€§\n\nä½¿ç”¨å·¥å‚ç±»è¿˜æœ‰ä¸€ä¸ªâ€œä¸æ˜¯ç‰¹åˆ«æ˜æ˜¾çš„â€ä¼˜ç‚¹ï¼Œä¸€ä¸ªç±»å¯èƒ½æ‹¥æœ‰å¤šä¸ªæ„é€ å‡½æ•°ï¼Œè€Œåœ¨Javaã€C++ç­‰è¯­è¨€ä¸­æ„é€ å‡½æ•°åå­—éƒ½ä¸ç±»åç›¸åŒï¼Œå®¢æˆ·ç«¯åªèƒ½é€šè¿‡ä¼ å…¥ä¸åŒçš„å‚æ•°æ¥è°ƒç”¨ä¸åŒçš„æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡ï¼Œ**ä»æ„é€ å‡½æ•°å’Œå‚æ•°åˆ—è¡¨ä¸­ä¹Ÿè®¸å¤§å®¶æ ¹æœ¬ä¸äº†è§£ä¸åŒæ„é€ å‡½æ•°æ‰€æ„é€ çš„äº§å“çš„å·®å¼‚ã€‚ä½†å¦‚æœå°†å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹å°è£…åœ¨å·¥å‚ç±»ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æä¾›ä¸€ç³»åˆ—åå­—å®Œå…¨ä¸åŒçš„å·¥å‚æ–¹æ³•**ï¼Œæ¯ä¸€ä¸ªå·¥å‚æ–¹æ³•å¯¹åº”ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä»¥ä¸€ç§æ›´åŠ å¯è¯»ã€æ˜“æ‡‚çš„æ–¹å¼æ¥åˆ›å»ºå¯¹è±¡ï¼Œè€Œä¸”ï¼Œä»ä¸€ç»„å·¥å‚æ–¹æ³•ä¸­é€‰æ‹©ä¸€ä¸ªæ„ä¹‰æ˜ç¡®çš„å·¥å‚æ–¹æ³•ï¼Œæ¯”ä»ä¸€ç»„åç§°ç›¸åŒå‚æ•°ä¸åŒçš„æ„é€ å‡½æ•°ä¸­é€‰æ‹©ä¸€ä¸ªæ„é€ å‡½æ•°è¦æ–¹ä¾¿å¾ˆå¤šã€‚\n\nåœ¨ä¸‹å›¾ï¼ŒçŸ©å½¢å·¥å‚ç±»RectangleFactoryæä¾›äº†ä¸¤ä¸ªå·¥å‚æ–¹æ³•createRectangle()å’ŒcreateSquare()ï¼Œä¸€ä¸ªç”¨äºåˆ›å»ºé•¿æ–¹å½¢ï¼Œä¸€ä¸ªç”¨äºåˆ›å»ºæ­£æ–¹å½¢ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•æ¯”ç›´æ¥é€šè¿‡æ„é€ å‡½æ•°æ¥åˆ›å»ºé•¿æ–¹å½¢æˆ–æ­£æ–¹å½¢å¯¹è±¡æ„ä¹‰æ›´åŠ æ˜ç¡®ï¼Œä¹Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†å®¢æˆ·ç«¯è°ƒç”¨æ—¶å‡ºé”™çš„æ¦‚ç‡ã€‚![image-20220225002101931](../../images/ç®€å•å·¥å‚æ¨¡å¼/image-20220225002101931.png)\n\n## ä½•æ—¶ä¸éœ€è¦\n\né‚£ä¹ˆï¼Œæ˜¯å¦éœ€è¦ä¸ºè®¾è®¡ä¸­çš„æ¯ä¸€ä¸ªç±»éƒ½é…å¤‡ä¸€ä¸ªå·¥å‚ç±»ï¼Ÿç­”æ¡ˆæ˜¯ï¼šå…·ä½“æƒ…å†µå…·ä½“åˆ†æã€‚å¦‚æœäº§å“ç±»å¾ˆç®€å•ï¼Œè€Œä¸”ä¸å­˜åœ¨å¤ªå¤šå˜æ•°ï¼Œå…¶æ„é€ è¿‡ç¨‹ä¹Ÿå¾ˆç®€å•ï¼Œæ­¤æ—¶æ— é¡»ä¸ºå…¶æä¾›å·¥å‚ç±»ï¼Œç›´æ¥åœ¨ä½¿ç”¨ä¹‹å‰å®ä¾‹åŒ–å³å¯ï¼Œä¾‹å¦‚Javaè¯­è¨€ä¸­çš„Stringç±»ï¼Œæˆ‘ä»¬å°±æ— é¡»ä¸ºå®ƒä¸“é—¨æä¾›ä¸€ä¸ªStringFactoryï¼Œè¿™æ ·åšåè€Œæœ‰ç‚¹åƒæ€é¸¡ç”¨ç‰›åˆ€ï¼Œå¤§æå°ç”¨ï¼Œè€Œä¸”ä¼šå¯¼è‡´å·¥å‚æ³›æ»¥ï¼Œå¢åŠ ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚\n\n# ç®€å•å·¥å‚æ¨¡å¼çš„å¼€å§‹\n\n## ç®€å•å·¥å‚æ¨¡å¼çš„å®šä¹‰\n\nç®€å•å·¥å‚æ¨¡å¼(Simple Factory Pattern)ï¼šå®šä¹‰ä¸€ä¸ªå·¥å‚ç±»ï¼Œå®ƒå¯ä»¥æ ¹æ®å‚æ•°çš„ä¸åŒè¿”å›ä¸åŒç±»çš„å®ä¾‹ï¼Œè¢«åˆ›å»ºçš„å®ä¾‹é€šå¸¸éƒ½å…·æœ‰å…±åŒçš„çˆ¶ç±»ã€‚**åœ¨ç®€å•å·¥å‚æ¨¡å¼ä¸­ç”¨äºåˆ›å»ºå®ä¾‹çš„æ–¹æ³•æ˜¯é™æ€(static)æ–¹æ³•**ï¼Œå› æ­¤ç®€å•å·¥å‚æ¨¡å¼åˆè¢«ç§°ä¸ºé™æ€å·¥å‚æ–¹æ³•(Static Factory Method)æ¨¡å¼ï¼Œå®ƒå±äºç±»åˆ›å»ºå‹æ¨¡å¼ã€‚\n\nåœ¨ç®€å•å·¥å‚æ¨¡å¼ç»“æ„å›¾ä¸­åŒ…å«å¦‚ä¸‹å‡ ä¸ªè§’è‰²ï¼š\n\n1. **Factoryï¼ˆå·¥å‚è§’è‰²ï¼‰**\n   * å·¥å‚è§’è‰²å³å·¥å‚ç±»ï¼Œå®ƒæ˜¯ç®€å•å·¥å‚æ¨¡å¼çš„æ ¸å¿ƒï¼Œè´Ÿè´£å®ç°åˆ›å»ºæ‰€æœ‰äº§å“å®ä¾‹çš„å†…éƒ¨é€»è¾‘\n   * å·¥å‚ç±»**å¯ä»¥è¢«å¤–ç•Œç›´æ¥è°ƒç”¨**ï¼Œåˆ›å»ºæ‰€éœ€çš„äº§å“å¯¹è±¡\n   * åœ¨å·¥å‚ç±»ä¸­æä¾›äº†é™æ€çš„å·¥å‚æ–¹æ³•factoryMethod()ï¼Œå®ƒçš„è¿”å›ç±»å‹ä¸º**æŠ½è±¡äº§å“ç±»å‹**Product\n2. **Productï¼ˆæŠ½è±¡äº§å“è§’è‰²ï¼‰**\n   * å®ƒæ˜¯å·¥å‚ç±»æ‰€åˆ›å»ºçš„æ‰€æœ‰å¯¹è±¡çš„çˆ¶ç±»ï¼Œå°è£…äº†å„ç§äº§å“å¯¹è±¡çš„å…¬æœ‰æ–¹æ³•\n   * å®ƒçš„å¼•å…¥å°†æé«˜ç³»ç»Ÿçš„çµæ´»æ€§ï¼Œ**ä½¿å¾—åœ¨å·¥å‚ç±»ä¸­åªéœ€å®šä¹‰ä¸€ä¸ªé€šç”¨çš„å·¥å‚æ–¹æ³•ï¼Œå› ä¸ºæ‰€æœ‰åˆ›å»ºçš„å…·ä½“äº§å“å¯¹è±¡éƒ½æ˜¯å…¶å­ç±»å¯¹è±¡**ã€‚\n3. **ConcreteProductï¼ˆå…·ä½“äº§å“è§’è‰²ï¼‰**\n   * å®ƒæ˜¯ç®€å•å·¥å‚æ¨¡å¼çš„åˆ›å»ºç›®æ ‡ï¼Œæ‰€æœ‰è¢«åˆ›å»ºçš„å¯¹è±¡éƒ½å……å½“è¿™ä¸ªè§’è‰²çš„æŸä¸ªå…·ä½“ç±»çš„å®ä¾‹\n   * æ¯ä¸€ä¸ªå…·ä½“äº§å“è§’è‰²éƒ½ç»§æ‰¿äº†æŠ½è±¡äº§å“è§’è‰²ï¼Œéœ€è¦å®ç°åœ¨æŠ½è±¡äº§å“ä¸­å£°æ˜çš„æŠ½è±¡æ–¹æ³•ã€‚\n\n## ç®€å•å·¥å‚æ¨¡å¼çš„è®¾è®¡æ­¥éª¤\n\nåœ¨ä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼æ—¶ï¼Œé¦–å…ˆéœ€è¦å¯¹äº§å“ç±»è¿›è¡Œé‡æ„ï¼Œ**ä¸èƒ½è®¾è®¡ä¸€ä¸ªåŒ…ç½—ä¸‡è±¡çš„äº§å“ç±»ï¼Œè€Œéœ€æ ¹æ®å®é™…æƒ…å†µè®¾è®¡ä¸€ä¸ªäº§å“å±‚æ¬¡ç»“æ„**ï¼Œå°†æ‰€æœ‰äº§å“ç±»å…¬å…±çš„ä»£ç ç§»è‡³æŠ½è±¡äº§å“ç±»ï¼Œå¹¶åœ¨æŠ½è±¡äº§å“ç±»ä¸­å£°æ˜ä¸€äº›æŠ½è±¡æ–¹æ³•ï¼Œä»¥ä¾›ä¸åŒçš„å…·ä½“äº§å“ç±»æ¥å®ç°ã€‚\n\n1. é¦–å…ˆå°†éœ€è¦åˆ›å»ºçš„å„ç§ä¸åŒå¯¹è±¡ï¼ˆä¾‹å¦‚å„ç§ä¸åŒçš„Chartå¯¹è±¡ï¼‰çš„ç›¸å…³ä»£ç å°è£…åˆ°ä¸åŒçš„ç±»ä¸­ï¼Œè¿™äº›ç±»ç§°ä¸º**å…·ä½“äº§å“ç±»**ï¼Œè€Œå°†å®ƒä»¬å…¬å…±çš„ä»£ç è¿›è¡ŒæŠ½è±¡å’Œæå–åå°è£…åœ¨ä¸€ä¸ª**æŠ½è±¡äº§å“ç±»**ä¸­ï¼Œæ¯ä¸€ä¸ªå…·ä½“äº§å“ç±»éƒ½æ˜¯æŠ½è±¡äº§å“ç±»çš„å­ç±»ï¼›\n2. ç„¶åæä¾›ä¸€ä¸ª**å·¥å‚ç±»**ç”¨äºåˆ›å»ºå„ç§äº§å“ï¼Œåœ¨å·¥å‚ç±»ä¸­æä¾›ä¸€ä¸ªåˆ›å»ºäº§å“çš„å·¥å‚æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ä»¥æ ¹æ®æ‰€ä¼ å…¥çš„å‚æ•°ä¸åŒåˆ›å»ºä¸åŒçš„å…·ä½“äº§å“å¯¹è±¡ï¼›\n3. **å®¢æˆ·ç«¯**åªéœ€è°ƒç”¨å·¥å‚ç±»çš„å·¥å‚æ–¹æ³•å¹¶**ä¼ å…¥ç›¸åº”çš„å‚æ•°**å³å¯å¾—åˆ°ä¸€ä¸ªäº§å“å¯¹è±¡ã€‚\n\nå…¸å‹çš„æŠ½è±¡äº§å“ç±»ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```c++\nclass Product\n{\npublic:\n    Product() {cout << \"Product()\" << endl;}\n    virtual ~Product() {cout << \"~Product\" << endl;}\n    virtual void methodSame()\n    {\n        cout << \"this is Product\" << endl;\n        //å…¬å…±æ–¹æ³•çš„å®ç°\n    }\n    virtual void methodDiff() = 0;//æŠ½è±¡ä¸šåŠ¡æ–¹æ³•\n};\n```\n\nåœ¨å…·ä½“äº§å“ç±»ä¸­å®ç°äº†æŠ½è±¡äº§å“ç±»ä¸­å£°æ˜çš„æŠ½è±¡ä¸šåŠ¡æ–¹æ³•ï¼Œä¸åŒçš„å…·ä½“äº§å“ç±»å¯ä»¥æä¾›ä¸åŒçš„å®ç°ï¼Œå…¸å‹çš„å…·ä½“äº§å“ç±»ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```c++\nclass ConcreteProductA : public Product\n{\npublic:\n    ConcreteProductA() {cout << \"ConcreteProductA()\" << endl;}\n    ~ConcreteProductA() {cout << \"~ConcreteProductA\" << endl;}\n    virtual void methodDiff()\n    {\n        cout << \"this is A\" << endl;\n        // ä¸šåŠ¡æ–¹æ³•çš„è¦†ç›–å®ç°\n    }\n};\nclass ConcreteProductB : public Product\n{\npublic:\n    ConcreteProductB() {cout << \"ConcreteProductB()\" << endl;}\n    ~ConcreteProductB() {cout << \"~ConcreteProductB\" << endl;}\n    virtual void methodDiff()\n    {\n        cout << \"this is B\" << endl;\n        // ä¸šåŠ¡æ–¹æ³•çš„è¦†ç›–å®ç°\n    }\n};\n```\n\nç®€å•å·¥å‚æ¨¡å¼çš„æ ¸å¿ƒæ˜¯å·¥å‚ç±»ï¼Œåœ¨æ²¡æœ‰å·¥å‚ç±»ä¹‹å‰ï¼Œå®¢æˆ·ç«¯ä¸€èˆ¬ä¼šä½¿ç”¨newå…³é”®å­—æ¥ç›´æ¥åˆ›å»ºäº§å“å¯¹è±¡ï¼Œè€Œåœ¨å¼•å…¥å·¥å‚ç±»ä¹‹åï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡å·¥å‚ç±»æ¥åˆ›å»ºäº§å“ï¼Œåœ¨ç®€å•å·¥å‚æ¨¡å¼ä¸­ï¼Œå·¥å‚ç±»æä¾›äº†ä¸€ä¸ªé™æ€å·¥å‚æ–¹æ³•ä¾›å®¢æˆ·ç«¯ä½¿ç”¨ï¼Œæ ¹æ®æ‰€ä¼ å…¥çš„å‚æ•°ä¸åŒå¯ä»¥åˆ›å»ºä¸åŒçš„äº§å“å¯¹è±¡ï¼Œå…¸å‹çš„å·¥å‚ç±»ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```c++\nclass Factory\n{\npublic:\n    Factory() {cout << \"Factory()\" << endl;}\n    ~Factory() {cout << \"~Factory\" << endl;}\n    static Product* getProduct(const string & arg)\n    {\n        Product* product = nullptr;\n        if(arg == \"A\")\n        {\n            product = new ConcreteProductA();\n            // ... åˆå§‹åŒ–è®¾ç½®product\n        }\n        else if(arg == \"B\")\n        {\n            product = new ConcreteProductB();\n            // ... åˆå§‹åŒ–è®¾ç½®product\n        }\n        return product;\n    }\n};\n```\n\nåœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨å·¥å‚ç±»çš„å·¥å‚æ–¹æ³•å³å¯å¾—åˆ°äº§å“å¯¹è±¡ï¼Œå…¸å‹ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```c++\nint main()\n{\n    unique_ptr<Product> pA = unique_ptr<Product>(Factory::getProduct(\"A\"));\n    unique_ptr<Product> pB = unique_ptr<Product>(Factory::getProduct(\"B\"));\n    pA->methodSame();\n    pA->methodDiff(); \n    pB->methodSame();\n    pB->methodDiff();\n\n    return 0;\n}\n```\n\n\n\n## ç¤ºä¾‹ç»“æ„\n\n ç®€å•å·¥å‚æ¨¡å¼çš„è¦ç‚¹åœ¨äºï¼š**å½“ä½ éœ€è¦ä»€ä¹ˆï¼Œåªéœ€è¦ä¼ å…¥ä¸€ä¸ªæ­£ç¡®çš„å‚æ•°ï¼Œå°±å¯ä»¥è·å–ä½ æ‰€éœ€è¦çš„å¯¹è±¡ï¼Œè€Œæ— é¡»çŸ¥é“å…¶åˆ›å»ºç»†èŠ‚ã€‚** ç®€å•å·¥å‚æ¨¡å¼ç»“æ„æ¯”è¾ƒç®€å•ï¼Œå…¶æ ¸å¿ƒæ˜¯å·¥å‚ç±»çš„è®¾è®¡![image-20220225002900697](../../images/ç®€å•å·¥å‚æ¨¡å¼/image-20220225002900697.png)\n\n# å‚è€ƒæ–‡çŒ®\n\n```\n[1] åˆ˜ä¼Ÿ. è®¾è®¡æ¨¡å¼.\n```\n","categories":["è®¾è®¡æ¨¡å¼","åˆ›å»ºå‹æ¨¡å¼"]},{"title":"è®¾è®¡åŸåˆ™","url":"/è®¾è®¡æ¨¡å¼/è®¾è®¡åŸåˆ™/","content":"# å†…å®¹\n\n1. é¢å‘å¯¹è±¡çš„è®¾è®¡åŸåˆ™\n2. å¸¸è§ä¸ƒç§è®¾è®¡åŸåˆ™\n# é¢å‘å¯¹è±¡çš„è®¾è®¡åŸåˆ™ï¼šå¯ç»´æŠ¤æ€§çš„å¤ç”¨\n\nå¯¹äºé¢å‘å¯¹è±¡è½¯ä»¶ç³»ç»Ÿçš„è®¾è®¡è€Œè¨€ï¼Œåœ¨æ”¯æŒå¯ç»´æŠ¤æ€§çš„åŒæ—¶ï¼Œæé«˜ç³»ç»Ÿçš„å¯å¤ç”¨æ€§æ˜¯ä¸€ä¸ªè‡³å…³é‡è¦çš„é—®é¢˜ã€‚\nå¦‚ä½•åŒæ—¶æé«˜ä¸€ä¸ªè½¯ä»¶ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œå¯å¤ç”¨æ€§æ˜¯é¢å‘å¯¹è±¡è®¾è®¡éœ€è¦è§£å†³çš„æ ¸å¿ƒé—®é¢˜ä¹‹ä¸€ã€‚\nåœ¨é¢å‘å¯¹è±¡è®¾è®¡ä¸­ï¼Œå¯ç»´æŠ¤æ€§çš„å¤ç”¨æ˜¯ä»¥è®¾è®¡åŸåˆ™ä¸ºåŸºç¡€çš„ã€‚\n\né¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™ä¸ºæ”¯æŒå¯ç»´æŠ¤æ€§å¤ç”¨è€Œè¯ç”Ÿï¼Œè¿™äº›åŸåˆ™è•´å«åœ¨å¾ˆå¤šè®¾è®¡æ¨¡å¼ä¸­ï¼Œå®ƒä»¬æ˜¯ä»è®¸å¤šè®¾è®¡æ–¹æ¡ˆä¸­æ€»ç»“å‡ºçš„æŒ‡å¯¼æ€§åŸåˆ™ã€‚é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™ä¹Ÿæ˜¯ç”¨äºè¯„ä»·ä¸€ä¸ªè®¾è®¡æ¨¡å¼çš„é‡è¦æŒ‡æ ‡ä¹‹ä¸€ï¼Œåœ¨è®¾è®¡é¢å‘å¯¹è±¡è½¯ä»¶ç³»ç»Ÿçš„è¿‡ç¨‹ä¸­ï¼Œè¦å¤šæ€è€ƒï¼Œâ€œXXXæ¨¡å¼ç¬¦åˆXXXåŸåˆ™å—ï¼Ÿâ€ã€â€œXXXæ¨¡å¼è¿åäº†XXXåŸåˆ™å—ï¼Ÿâ€ã€‚\n# å¸¸è§è®¾è®¡åŸåˆ™ - SOLID\n\n1. Robert C. Martinï¼ˆâ€œUncle Bobâ€ï¼‰åœ¨2000å¹´ä»£åˆæœŸæå‡ºå¹¶æ¨å¹¿äº†SOLIDåŸåˆ™ï¼Œã€ŠAgile Software Development, Principles, Patterns, and Practicesã€‹ä¸€ä¹¦ä¸­ï¼Œå¯¹è¿™äº›åŸåˆ™è¿›è¡Œäº†è¯¦ç»†çš„è§£é‡Šå’Œè®¨è®ºã€‚\n2. é‡Œæ°ä»£æ¢åŸåˆ™ï¼ˆLSPï¼‰ç”±è®¡ç®—æœºç§‘å­¦å®¶Barbara Liskovåœ¨1987å¹´çš„ä¸€ç¯‡åä¸ºã€ŠData Abstraction and Hierarchyã€‹çš„è®ºæ–‡ä¸­é¦–æ¬¡æå‡ºã€‚è™½ç„¶Liskovå¹¶æ²¡æœ‰æ˜ç¡®æå‡ºSOLIDè¿™ä¸ªæœ¯è¯­ï¼Œä½†å¥¹çš„å·¥ä½œä¸ºå…¶ä¸­çš„LSPåŸåˆ™å¥ å®šäº†åŸºç¡€ã€‚\n\n| è®¾è®¡åŸåˆ™åç§°                             | å®šä¹‰                                                                                                      | ä½¿ç”¨é¢‘ç‡  |\n| ---------------------------------- | ------------------------------------------------------------------------------------------------------- | ----- |\n| å•ä¸€èŒè´£åŸåˆ™, Single Responsibility, SRP | ä¸€ä¸ªç±»åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½é¢†åŸŸä¸­çš„ç›¸åº”èŒè´£                                                                                      | â˜…â˜…â˜…â˜…â˜† |\n| å¼€é—­åŸåˆ™, Open-Closed, OCP             | è½¯ä»¶å®ä½“åº”å¯¹æ‰©å±•å¼€æ”¾ï¼Œè€Œå¯¹ä¿®æ”¹å…³é—­                                                                                       | â˜…â˜…â˜…â˜…â˜… |\n| é‡Œæ°ä»£æ¢åŸåˆ™, Liskov Substitution, LSP   | å¦‚æœä¸€ä¸ªå­ç±»å¯ä»¥æ›¿æ¢å…¶çˆ¶ç±»ï¼Œå¹¶ä¸”ç¨‹åºçš„è¡Œä¸ºæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆè¿™ä¸ªå­ç±»æ˜¯ç¬¦åˆé‡Œæ°ä»£æ¢åŸåˆ™çš„ã€‚<br>æ¢å¥è¯è¯´ï¼Œå­ç±»å¯¹è±¡å¿…é¡»èƒ½å¤Ÿæ›¿æ¢çˆ¶ç±»å¯¹è±¡ï¼Œå¹¶ä¸”ä¸å½±å“ç¨‹åºçš„æ­£ç¡®æ€§ã€‚                       | â˜…â˜…â˜…â˜…â˜… |\n| æ¥å£éš”ç¦»åŸåˆ™, Interface Segregation, ISP | å®¢æˆ·ç«¯ä¸åº”è¯¥è¢«è¿«ä¾èµ–å®ƒä»¬ä¸éœ€è¦çš„æ¥å£ï¼Œå³ä¸€ä¸ªç±»å¯¹å¦ä¸€ä¸ªç±»çš„ä¾èµ–åº”è¯¥å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Šã€‚<br>å…·ä½“æ¥è¯´ï¼Œæ¥å£éš”ç¦»åŸåˆ™æå€¡å°†è‡ƒè‚¿çš„æ¥å£æ‹†åˆ†ä¸ºå¤šä¸ªå°å‹çš„ã€ç‰¹å®šå®¢æˆ·çš„æ¥å£ï¼Œè¿™æ ·æ¯ä¸ªæ¥å£åªåŒ…å«å®¢æˆ·ç«¯çœŸæ­£éœ€è¦çš„æ–¹æ³•ã€‚ | â˜…â˜…â˜†â˜†â˜† |\n| ä¾èµ–å€’è½¬åŸåˆ™, Dependence Inversion, DIP  | ï¼ˆè½¯ä»¶è®¾è®¡çš„çµé­‚ï¼‰é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–äºä½å±‚æ¨¡å—ï¼ŒäºŒè€…éƒ½åº”è¯¥ä¾èµ–äºæŠ½è±¡ï¼›æŠ½è±¡ä¸åº”è¯¥ä¾èµ–äºç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–äºæŠ½è±¡ã€‚                                                | â˜…â˜…â˜…â˜…â˜… |\n## å¼€é—­åŸåˆ™\nä¸€ä¸ªè½¯ä»¶å®ä½“ï¼ˆç±»ã€æ¨¡å—ã€å‡½æ•°ç­‰ï¼‰åº”è¯¥åœ¨ä¸ä¿®æ”¹å…¶æºä»£ç çš„æƒ…å†µä¸‹ï¼Œæ‰©å±•æˆ–å¢å¼ºå…¶è¡Œä¸ºã€‚\né€šè¿‡åœ¨ä¸ä¿®æ”¹ç°æœ‰ä»£ç çš„æƒ…å†µä¸‹å¢åŠ æ–°åŠŸèƒ½ï¼Œå‡å°‘å¯¹å·²ç¨³å®šç³»ç»Ÿçš„å½±å“ï¼Œé¿å…å¼•å…¥æ–°çš„é”™è¯¯ã€‚è¿™å¯ä»¥é€šè¿‡ä½¿ç”¨æ¥å£ã€æŠ½è±¡ç±»å’Œå¤šæ€ç­‰é¢å‘å¯¹è±¡çš„è®¾è®¡æœºåˆ¶æ¥å®ç°ã€‚\n### ç¤ºä¾‹\nå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„å›¾å½¢ç»˜åˆ¶ç¨‹åºï¼Œæœ€åˆåªæ”¯æŒç»˜åˆ¶åœ†å½¢ã€‚ä¸ºäº†éµå¾ªå¼€é—­åŸåˆ™ï¼Œæˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ªå›¾å½¢æ¥å£ï¼Œå¹¶å®ç°ä¸€ä¸ªåœ†å½¢ç±»ï¼š\n```java\n// å›¾å½¢æ¥å£\ninterface Shape {\n    void draw();\n}\n\n// åœ†å½¢ç±»\nclass Circle implements Shape {\n    @Override\n    public void draw() {\n        System.out.println(\"Drawing a Circle\");\n    }\n}\n\n// ç»˜åˆ¶ç±»\nclass Drawing {\n    private List<Shape> shapes;\n\n    public Drawing() {\n        shapes = new ArrayList<>();\n    }\n\n    public void addShape(Shape shape) {\n        shapes.add(shape);\n    }\n\n    public void drawShapes() {\n        for (Shape shape : shapes) {\n            shape.draw();\n        }\n    }\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        Drawing drawing = new Drawing();\n        drawing.addShape(new Circle());\n        drawing.drawShapes();\n    }\n}\n```\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çš„ç»˜åˆ¶ç¨‹åºå¯ä»¥ç»˜åˆ¶åœ†å½¢ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦æ·»åŠ æ–°çš„å›¾å½¢ï¼Œä¾‹å¦‚çŸ©å½¢ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰©å±•è€Œä¸æ˜¯ä¿®æ”¹ç°æœ‰ä»£ç æ¥å®ç°ï¼š\n```java\n// çŸ©å½¢ç±»\nclass Rectangle implements Shape {\n    @Override\n    public void draw() {\n        System.out.println(\"Drawing a Rectangle\");\n    }\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        Drawing drawing = new Drawing();\n        drawing.addShape(new Circle());\n        drawing.addShape(new Rectangle());\n        drawing.drawShapes();\n    }\n}\n```\né€šè¿‡æ·»åŠ ä¸€ä¸ªå®ç°äº†Shapeæ¥å£çš„æ–°ç±»Rectangleï¼Œæˆ‘ä»¬å¯ä»¥æ‰©å±•ç»˜åˆ¶ç¨‹åºçš„åŠŸèƒ½ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹ç°æœ‰çš„Drawingç±»å’ŒCircleç±»ã€‚è¿™ç§è®¾è®¡ç¬¦åˆå¼€é—­åŸåˆ™ï¼Œå› ä¸ºæˆ‘ä»¬é€šè¿‡æ‰©å±•ï¼ˆæ·»åŠ æ–°ç±»ï¼‰è€Œä¸æ˜¯ä¿®æ”¹ç°æœ‰ä»£ç æ¥å¢åŠ æ–°åŠŸèƒ½ã€‚\n## ä¾èµ–å€’è½¬åŸåˆ™ï¼ˆDIPï¼‰\n![](../../images/è®¾è®¡åŸåˆ™/image-20240730194118409.png)\n1. ä»é¡¹ç›®ç®¡ç†çš„è§’åº¦æ¥è¯´ï¼Œå¦‚æœAç›´æ¥ä¾èµ–Bï¼Œé‚£ä¹ˆå¼€å‘å‘¨æœŸå°±ä¼šè¢«Bæ¨¡å—æ‹–ç´¯ï¼ŒAæ¨¡å—é—²ç½®ï¼ŒäººåŠ›æ•ˆç‡ä¸é«˜ï¼Œä»ç”˜ç‰¹å›¾çœ‹éœ€è¦å¼€å‘28å¤©ã€‚\n    1. è€Œå¦‚æœAã€Båœ¨äº‹å…ˆç»è¿‡è‰¯å¥½çš„åå•†ï¼Œè§„èŒƒå‡ºä¸€å¥—æ¥å£çš„è¯ï¼ŒAã€Bå°±å¯ä»¥å…±åŒä¾èµ–è¿™ä¸ªæ¥å£ï¼Œå„è‡ªåŒæ—¶å¼€å‘ã€‚å‡å¦‚åå•†éœ€è¦3å¤©ï¼Œé‚£ä¹ˆå¼€å‘å‘¨æœŸåªéœ€è¦$3+14=17$å¤©ã€‚\n1. ä»è½¯ä»¶çš„æ‰©å±•æ€§æ¥è¯´ï¼Œå¦‚æœAç›´æ¥ä¾èµ–äºBï¼Œæ²¡æœ‰äº‹å…ˆåå•†å¥½ï¼Œé‚£ä¹ˆBå¯èƒ½ä¸èƒ½å®Œå…¨æ»¡è¶³Açš„éœ€æ±‚ï¼Œåˆ°æ—¶å€™è¿˜æ˜¯éœ€è¦ä¸æ–­ä¿®æ”¹ä»£ç ï¼Œå¼€å‘æ•ˆç‡ä½ä¸‹ã€‚\n    1. å¦‚æœéƒ½ä¾èµ–ä¸€ä¸ªæ¥å£ï¼Œé‚£ä¹ˆåæœŸçš„æ‰©å±•åªéœ€è¦åœ¨æ¥å£ä¸Šå¢è®¾æ–¹æ³•å³å¯ã€‚\n### ç¤ºä¾‹\nå‡è®¾æœ‰ä¸€ä¸ªç®€å•çš„åœºæ™¯ï¼Œä¸€ä¸ªServiceç±»ä¾èµ–äºä¸€ä¸ªRepositoryç±»ï¼š\n```java\npublic class Repository {\n    public void save(Object data) {\n        // ä¿å­˜æ•°æ®çš„å®ç°\n    }\n}\n\npublic class Service {\n    private Repository repository;\n\n    public Service() {\n        this.repository = new Repository();\n    }\n\n    public void process(Object data) {\n        // å¤„ç†æ•°æ®\n        repository.save(data);\n    }\n}\n```\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒServiceç±»ç›´æ¥ä¾èµ–äºå…·ä½“çš„Repositoryç±»ã€‚è¿™ç§è®¾è®¡è¿åäº†ä¾èµ–å€’è½¬åŸåˆ™ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦æ›´æ”¹æ•°æ®å­˜å‚¨çš„æ–¹å¼ï¼Œæ¯”å¦‚ä½¿ç”¨å¦ä¸€ä¸ªæ•°æ®å­˜å‚¨å®ç°ï¼Œå°±å¿…é¡»ä¿®æ”¹Serviceç±»çš„ä»£ç ã€‚\n\næŒ‰ç…§ä¾èµ–å€’è½¬åŸåˆ™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¥å£æ¥å®ç°ä¾èµ–æ³¨å…¥ï¼Œå°†Repositoryçš„å®ç°æŠ½è±¡åŒ–ï¼š\n```java\npublic interface IRepository {\n    void save(Object data);\n}\n\npublic class Repository implements IRepository {\n    @Override\n    public void save(Object data) {\n        // ä¿å­˜æ•°æ®çš„å®ç°\n    }\n}\n\npublic class Service {\n    private IRepository repository;\n\n    public Service(IRepository repository) {\n        this.repository = repository;\n    }\n\n    public void process(Object data) {\n        // å¤„ç†æ•°æ®\n        repository.save(data);\n    }\n}\n```\nåœ¨è¿™ä¸ªè®¾è®¡ä¸­ï¼ŒServiceç±»ä¾èµ–äºIRepositoryæ¥å£ï¼Œè€Œä¸æ˜¯å…·ä½“çš„Repositoryç±»ã€‚è¿™æ ·ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦æ›´æ”¹æ•°æ®å­˜å‚¨çš„æ–¹å¼ï¼Œåªéœ€è¦æä¾›ä¸€ä¸ªå®ç°IRepositoryæ¥å£çš„æ–°ç±»å³å¯ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹Serviceç±»çš„ä»£ç ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œé«˜å±‚æ¨¡å—ï¼ˆServiceï¼‰å’Œä½å±‚æ¨¡å—ï¼ˆRepositoryï¼‰éƒ½ä¾èµ–äºæŠ½è±¡ï¼ˆIRepositoryï¼‰ï¼Œç»†èŠ‚ï¼ˆRepositoryçš„å…·ä½“å®ç°ï¼‰ä¾èµ–äºæŠ½è±¡ï¼ˆIRepositoryï¼‰ï¼Œç¬¦åˆä¾èµ–å€’è½¬åŸåˆ™ã€‚\n\nè¿™ç§è®¾è®¡æé«˜äº†ç³»ç»Ÿçš„çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œä½¿å¾—ä»£ç æ›´å®¹æ˜“æ‰©å±•å’Œä¿®æ”¹ã€‚\n## æ¥å£éš”ç¦»åŸåˆ™\n### ç¤ºä¾‹\nå‡è®¾æœ‰ä¸€ä¸ªå¤§å‹æ¥å£IMultiFunctionDeviceï¼Œå…¶ä¸­åŒ…å«å¤šç§åŠŸèƒ½çš„æ–¹æ³•ï¼š\n```java\npublic interface IMultiFunctionDevice {\n    void print();\n    void scan();\n    void fax();\n    void copy();\n}\n```\nå¦‚æœæŸä¸ªå®¢æˆ·ç«¯åªéœ€è¦æ‰“å°åŠŸèƒ½ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»å®ç°æ‰€æœ‰çš„æ–¹æ³•ï¼Œå³ä½¿ä¸éœ€è¦æ‰«æã€ä¼ çœŸå’Œå¤å°åŠŸèƒ½ã€‚è¿™è¿åäº†æ¥å£éš”ç¦»åŸåˆ™ã€‚\n\næŒ‰ç…§æ¥å£éš”ç¦»åŸåˆ™ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªå¤§æ¥å£æ‹†åˆ†ä¸ºå¤šä¸ªå°æ¥å£ï¼š\n```java\npublic interface IPrinter {\n    void print();\n}\n\npublic interface IScanner {\n    void scan();\n}\n\npublic interface IFax {\n    void fax();\n}\n\npublic interface ICopier {\n    void copy();\n}\n```\nç„¶åï¼Œå¯¹äºåªéœ€è¦æ‰“å°åŠŸèƒ½çš„å®¢æˆ·ç«¯ï¼Œå®ƒåªéœ€è¦ä¾èµ–IPrinteræ¥å£ï¼š\n```java\npublic class SimplePrinter implements IPrinter {\n    @Override\n    public void print() {\n        // å®ç°æ‰“å°åŠŸèƒ½\n    }\n}\n```\nè¿™æ ·ï¼Œå®¢æˆ·ç«¯åªä¾èµ–äºå®ƒéœ€è¦çš„æ¥å£ï¼Œå®ç°äº†æ¥å£éš”ç¦»åŸåˆ™çš„ç›®æ ‡ã€‚\n## é‡Œæ°æ›¿æ¢åŸåˆ™\nå­ç±»å¯¹è±¡å¿…é¡»èƒ½å¤Ÿæ›¿æ¢çˆ¶ç±»å¯¹è±¡ï¼ˆå…¼å®¹çˆ¶ç±»å¯¹è±¡çš„åŠŸèƒ½ï¼‰ï¼Œå¹¶ä¸”ä¸å½±å“ç¨‹åºçš„æ­£ç¡®æ€§ã€‚\né‡Œæ°ä»£æ¢åŸåˆ™ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªè¦ç‚¹ï¼š\n1. **å­ç±»å¿…é¡»å®Œå…¨å®ç°çˆ¶ç±»çš„æ–¹æ³•**ï¼šå­ç±»ä¸èƒ½æŠ›å‡ºçˆ¶ç±»æ²¡æœ‰æŠ›å‡ºçš„å¼‚å¸¸ï¼Œå­ç±»çš„æ–¹æ³•å‚æ•°è¦ä¸çˆ¶ç±»æ–¹æ³•å‚æ•°ç±»å‹ä¸€è‡´ï¼Œè¿”å›å€¼ç±»å‹ä¹Ÿè¦ä¸€è‡´æˆ–æ˜¯å…¶å­ç±»å‹ã€‚\n2. **å­ç±»å¯ä»¥æœ‰è‡ªå·±çš„ç‰¹æ€§**ï¼Œä½†è¿™äº›ç‰¹æ€§ä¸èƒ½æ”¹å˜çˆ¶ç±»åŸæœ‰åŠŸèƒ½çš„å«ä¹‰å’Œè¡Œä¸ºã€‚\n3. **ç»§æ‰¿çš„åŸåˆ™**ï¼šå­ç±»åº”è¯¥æ‰©å±•çˆ¶ç±»çš„åŠŸèƒ½ï¼Œè€Œä¸æ˜¯å‰Šå¼±çˆ¶ç±»çš„åŠŸèƒ½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå­ç±»ä¸åº”è¯¥åˆ é™¤çˆ¶ç±»ä¸­å·²æœ‰çš„åŠŸèƒ½ã€‚\n\næ¯”å¦‚ï¼šOld Bankçš„addè¡Œä¸ºç»“æœæ˜¯3ï¼Œè€ŒNew Bankçš„addè™½ç„¶å½¢å¼ä¸Šä¸€è‡´ï¼Œä½†è¡Œä¸ºå´ä¸æ­£ç¡®ã€‚è¿åäº†é‡Œæ°æ›¿æ¢åŸåˆ™ã€‚çŒœæµ‹New Bankåœ¨é‡å†™addæ–¹æ³•åï¼Œä¼˜åŒ–ä»£ç æˆ–æ›´æ–°ã€å‡çº§ç»„ä»¶åé€ æˆäº†å‰¯ä½œç”¨ï¼Œå¯¼è‡´è¿è¡Œæ—¶è¡Œä¸ºä¸ä¸€è‡´ã€ç»“æœä¸æ­£ç¡®ã€‚\n![](../../images/è®¾è®¡åŸåˆ™/image-20240730201816875.png)\n### ç¤ºä¾‹\nè€ƒè™‘ä¸€ä¸ªçˆ¶ç±»Birdå’Œä¸€ä¸ªå­ç±»Penguinçš„ä¾‹å­ï¼š\n```java\npublic class Bird {\n    public void fly() {\n        System.out.println(\"Bird is flying\");\n    }\n}\n\npublic class Penguin extends Bird {\n    @Override\n    public void fly() {\n        throw new UnsupportedOperationException(\"Penguins cannot fly\");\n    }\n}\n```\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒPenguinä¸èƒ½æ›¿æ¢Birdï¼Œå› ä¸ºä¼é¹…ä¸èƒ½é£ã€‚è¿™è¿åäº†é‡Œæ°ä»£æ¢åŸåˆ™ã€‚æ­£ç¡®çš„åšæ³•æ˜¯é‡æ–°è®¾è®¡ç±»ç»“æ„ï¼Œä½¿å¾—ä¼é¹…å’Œå…¶ä»–é¸Ÿç±»èƒ½å¤Ÿæ›´å¥½åœ°åæ˜ ç°å®ä¸­çš„è¡Œä¸ºï¼š\n```java\npublic class Bird {\n    public void move() {\n        System.out.println(\"Bird is moving\");\n    }\n}\n\npublic class FlyingBird extends Bird {\n    public void fly() {\n        System.out.println(\"Bird is flying\");\n    }\n}\n\npublic class Penguin extends Bird {\n    @Override\n    public void move() {\n        System.out.println(\"Penguin is walking or swimming\");\n    }\n}\n```\nåœ¨è¿™ä¸ªè®¾è®¡ä¸­ï¼ŒFlyingBirdç»§æ‰¿äº†Birdï¼Œå¹¶å¢åŠ äº†flyæ–¹æ³•ï¼Œè€Œä¼é¹…åªæ˜¯ç»§æ‰¿äº†Birdï¼Œå¹¶é‡å†™äº†moveæ–¹æ³•ã€‚è¿™æ ·ï¼Œä¼é¹…å’Œå…¶ä»–é¸Ÿç±»éƒ½èƒ½æ­£ç¡®æ›¿æ¢Birdï¼Œç¬¦åˆé‡Œæ°ä»£æ¢åŸåˆ™ã€‚\n# å…¶ä»–è®¾è®¡åŸåˆ™\n\n| è®¾è®¡åŸåˆ™åç§°                       | å®šä¹‰                                    | ä½¿ç”¨é¢‘ç‡  |\n| ---------------------------- | ------------------------------------- | ----- |\n| åˆæˆå¤ç”¨åŸåˆ™, Composite Reuse, CRP | å°½é‡ä½¿ç”¨å¯¹è±¡ç»„åˆï¼Œè€Œä¸æ˜¯ç»§æ‰¿æ¥è¾¾åˆ°å¤ç”¨çš„ç›®çš„                | â˜…â˜…â˜…â˜…â˜† |\n| è¿ªç±³ç‰¹æ³•åˆ™, Law of Demeter, LoD   | ä¸€ä¸ªè½¯ä»¶å®ä½“åº”å½“å°½å¯èƒ½å°‘åœ°ä¸å…¶ä»–å®ä½“å‘ç”Ÿç›¸äº’ä½œç”¨ï¼Œåªä¸æœ€è¿‘å…³ç³»çš„å®ä½“å…³è”ã€‚ | â˜…â˜…â˜…â˜†â˜† |\n## è¿ªç±³ç‰¹æ³•åˆ™\nè¿ªç±³ç‰¹æ³•åˆ™ç”±Ian Hollandåœ¨1987å¹´æå‡ºï¼Œå¹¶é¦–æ¬¡åœ¨Northeastern Universityï¼ˆç¾å›½ä¸œåŒ—å¤§å­¦ï¼‰çš„Demeter Projectä¸­å¾—åˆ°åº”ç”¨ï¼Œå› æ­¤å¾—åã€‚\nè¯¥åŸåˆ™è¢«è®¤ä¸ºæ˜¯ä¸€ç§ä¿ƒè¿›æ¨¡å—åŒ–å’Œé«˜å†…èšä½è€¦åˆè®¾è®¡çš„é‡è¦ç­–ç•¥ï¼Œå¹¿æ³›åº”ç”¨äºé¢å‘å¯¹è±¡çš„è½¯ä»¶è®¾è®¡ä¸­ã€‚\n\n**æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šä¸€ä¸ªå¯¹è±¡åº”å½“å¯¹å…¶ä»–å¯¹è±¡æœ‰æœ€å°‘çš„äº†è§£**ï¼Œå…·ä½“æ¥è¯´ï¼š\n1. **ä¸€ä¸ªå¯¹è±¡åªåº”ä¸ç›´æ¥çš„æœ‹å‹é€šä¿¡**ï¼šå³ä»…ä¸è‡ªå·±ç›´æ¥æŒæœ‰çš„å¯¹è±¡æˆ–åœ¨æ–¹æ³•ä¸­åˆ›å»ºçš„å¯¹è±¡é€šä¿¡ï¼Œè€Œä¸åº”ä¸è¢«é—´æ¥æŒæœ‰çš„å¯¹è±¡é€šä¿¡ã€‚\n2. **é¿å…â€œç«è½¦å¼â€æ–¹æ³•è°ƒç”¨**ï¼šä¸è¦é€šè¿‡ä¸€ä¸ªå¯¹è±¡é“¾å¼åœ°è°ƒç”¨å¤šä¸ªå¯¹è±¡çš„æ–¹æ³•ï¼Œä¾‹å¦‚ a.getB().getC().doSomething()ã€‚\n3. **é€šè¿‡å¼•å…¥ä¸­ä»‹å‡å°‘å¯¹è±¡é—´çš„ç›´æ¥ä¾èµ–**ï¼šé€šè¿‡å°è£…å¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼Œä½¿å¾—å¯¹è±¡ä¹‹é—´çš„é€šä¿¡é€šè¿‡ä¸­ä»‹å®Œæˆï¼Œä»è€Œå‡å°‘ç›´æ¥ä¾èµ–ã€‚\n### ç¤ºä¾‹\nå‡è®¾æœ‰ä»¥ä¸‹ç±»ç»“æ„ï¼š\n```java\nclass Engine {\n    public void start() {\n        System.out.println(\"Engine started\");\n    }\n}\n\nclass Car {\n    private Engine engine;\n\n    public Car() {\n        this.engine = new Engine();\n    }\n\n    public Engine getEngine() {\n        return engine;\n    }\n}\n\nclass Driver {\n    public void startCar(Car car) {\n        car.getEngine().start(); // è¿åäº†è¿ªç±³ç‰¹æ³•åˆ™\n    }\n}\n```\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒDriverç±»é€šè¿‡Carç±»è®¿é—®Engineç±»çš„æ–¹æ³•ï¼Œè¿åäº†è¿ªç±³ç‰¹æ³•åˆ™ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å¼•å…¥ä¸€ä¸ªä¸­ä»‹æ–¹æ³•æ¥æ”¹è¿›ï¼š\n```cpp\nclass Car {\n    private Engine engine;\n\n    public Car() {\n        this.engine = new Engine();\n    }\n\n    public void startEngine() {\n        engine.start();\n    }\n}\n\nclass Driver {\n    public void startCar(Car car) {\n        car.startEngine(); // ç¬¦åˆè¿ªç±³ç‰¹æ³•åˆ™\n    }\n}\n```\nåœ¨æ”¹è¿›åçš„è®¾è®¡ä¸­ï¼ŒDriverç±»ä¸å†ç›´æ¥è®¿é—®Engineç±»çš„æ–¹æ³•ï¼Œè€Œæ˜¯é€šè¿‡Carç±»çš„startEngineæ–¹æ³•æ¥å¯åŠ¨å¼•æ“ã€‚è¿™ç¬¦åˆè¿ªç±³ç‰¹æ³•åˆ™ï¼Œé™ä½äº†å¯¹è±¡ä¹‹é—´çš„è€¦åˆæ€§ï¼Œæé«˜äº†ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€‚\n# è®¾è®¡åŸåˆ™çš„ä»·å€¼\n\nä¼˜ç§€çš„é¢å‘å¯¹è±¡çš„ç¨‹åºåº”è¯¥æ˜¯æœ‰ä»¥ä¸‹äº”ä¸ªç‰¹å¾çš„ï¼šä½è€¦åˆï¼Œé«˜å†…èšï¼Œé«˜å¤ç”¨ï¼Œæ˜“ç»´æŠ¤ï¼Œæ˜“æ‰©å±•ã€‚\n\n1. å¼€é—­åŸåˆ™è®©ç¨‹åºæ˜“æ‰©å±•ï¼Œæ˜“ç»´æŠ¤ã€‚\n2. é‡Œæ°æ›¿æ¢åŸåˆ™ã€ä¾èµ–å€’ç½®å’Œåˆæˆå¤ç”¨åŸåˆ™å¯ä»¥é™ä½è€¦åˆã€‚\n3. æ¥å£éš”ç¦»ã€å•ä¸€èŒè´£åŸåˆ™å’Œè¿ªç±³ç‰¹åŸåˆ™å¯ä»¥æé«˜å†…èšæ€§ã€‚\n\nè€Œä½è€¦åˆï¼Œé«˜å†…èšçš„ä»£ç æ‰èƒ½å®ç°é«˜å¤ç”¨ã€‚\n\n","categories":["è®¾è®¡æ¨¡å¼"]},{"title":"è®¾è®¡æ¨¡å¼æ¦‚è¿°","url":"/è®¾è®¡æ¨¡å¼/è®¾è®¡æ¨¡å¼æ¦‚è¿°/","content":"# å†…å®¹\n\n1. æ¨¡å¼æ˜¯ä»€ä¹ˆ\n2. è½¯ä»¶æ¨¡å¼çš„ç”±æ¥\n3. è½¯ä»¶æ¨¡å¼çš„æ„æˆ\n4. è®¾è®¡æ¨¡å¼æ˜¯ä»€ä¹ˆ\n5. è®¾è®¡æ¨¡å¼ç”¨é€”åˆ†ç±»ï¼Œå¸¸ç”¨æ¨¡å¼ä¸€è§ˆ\n6. è®¾è®¡æ¨¡å¼çš„ä»·å€¼\n7. å¦‚ä½•å­¦ä¹ è®¾è®¡æ¨¡å¼\n# æ¨¡å¼æ˜¯ä»€ä¹ˆ\n\nç¾å›½Christopher Alexanderåšå£«åŠå…¶ç ”ç©¶å›¢é˜Ÿç”¨äº†çº¦20å¹´çš„æ—¶é—´ï¼Œå¯¹ä½å®…å’Œå‘¨è¾¹ç¯å¢ƒè¿›è¡Œäº†å¤§é‡çš„è°ƒæŸ¥ç ”ç©¶å’Œèµ„æ–™æ”¶é›†å·¥ä½œï¼Œå‘ç°äººä»¬å¯¹èˆ’é€‚ä½å®…å’ŒåŸå¸‚ç¯å¢ƒå­˜åœ¨ä¸€äº›å…±åŒçš„è®¤åŒè§„å¾‹ï¼ŒChristopher Alexanderåœ¨è‘—ä½œA Pattern Language: Towns, Buildings, Constructionä¸­æŠŠè¿™äº›è®¤åŒè§„å¾‹å½’çº³ä¸º253ä¸ªæ¨¡å¼ï¼Œå¯¹æ¯ä¸€ä¸ªæ¨¡å¼(Pattern)éƒ½ä»Contextï¼ˆå‰ææ¡ä»¶ï¼‰ã€Themeæˆ–Problemï¼ˆç›®æ ‡é—®é¢˜ï¼‰ã€ Solutionï¼ˆè§£å†³æ–¹æ¡ˆï¼‰ä¸‰ä¸ªæ–¹é¢è¿›è¡Œäº†æè¿°ï¼Œå¹¶ç»™å‡ºäº†ä»ç”¨æˆ·éœ€æ±‚åˆ†æåˆ°å»ºç­‘ç¯å¢ƒç»“æ„è®¾è®¡ç›´è‡³ç»å…¸å®ä¾‹çš„è¿‡ç¨‹æ¨¡å‹ã€‚\n\nåœ¨Christopher Alexanderçš„å¦ä¸€éƒ¨ç»å…¸è‘—ä½œã€Šå»ºç­‘çš„æ°¸æ’ä¹‹é“ã€‹ä¸­ï¼Œä»–ç»™å‡ºäº†å…³äºæ¨¡å¼çš„å®šä¹‰ï¼š\n\næ¯ä¸ªæ¨¡å¼éƒ½æè¿°äº†ä¸€ä¸ªåœ¨æˆ‘ä»¬çš„ç¯å¢ƒä¸­ä¸æ–­å‡ºç°çš„é—®é¢˜ï¼Œç„¶åæè¿°äº†è¯¥é—®é¢˜çš„è§£å†³æ–¹æ¡ˆçš„æ ¸å¿ƒï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥æ— æ•°æ¬¡åœ°é‡ç”¨é‚£äº›å·²æœ‰çš„æˆåŠŸçš„è§£å†³æ–¹æ¡ˆï¼Œæ— é¡»å†é‡å¤ç›¸åŒçš„å·¥ä½œã€‚\n\nè¿™ä¸ªå®šä¹‰å¯ä»¥ç®€å•åœ°ç”¨ä¸€å¥è¯è¡¨ç¤ºï¼š\n\n**æ¨¡å¼æ˜¯åœ¨ç‰¹å®šç¯å¢ƒä¸‹äººä»¬è§£å†³æŸç±»é‡å¤å‡ºç°é—®é¢˜çš„ä¸€å¥—æˆåŠŸæˆ–æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚**\nA pattern is a successful or efficient **solution to a recurring problem** within a context.\n\n# è½¯ä»¶æ¨¡å¼çš„ç”±æ¥ï¼ˆ23ç§ï¼‰\n\n1990å¹´ï¼Œè½¯ä»¶å·¥ç¨‹ç•Œå¼€å§‹å…³æ³¨Christopher Alexanderç­‰åœ¨è¿™ä¸€ä½å®…ã€å…¬å…±å»ºç­‘ä¸åŸå¸‚è§„åˆ’é¢†åŸŸçš„é‡å¤§çªç ´ã€‚æœ€æ—©å°†æ¨¡å¼çš„æ€æƒ³å¼•å…¥è½¯ä»¶å·¥ç¨‹æ–¹æ³•å­¦çš„æ˜¯1991-1992å¹´ä»¥â€œå››äººç»„â€è‡ªç§°çš„å››ä½è‘—åè½¯ä»¶å·¥ç¨‹å­¦è€…ã€‚\n>Gang of Fourï¼Œç®€ç§°**GoF**ï¼Œåˆ†åˆ«æ˜¯Erich Gamma, Richard Helm, Ralph Johnsonå’ŒJohn Vlissidesã€‚\n>ä¹¦åï¼šDesign Patterns: Elements of Reusable Object-Oriented Softwarec - è®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€\n\n\nä»–ä»¬åœ¨1994å¹´å½’çº³å‘è¡¨äº†23ç§åœ¨è½¯ä»¶å¼€å‘ä¸­ä½¿ç”¨é¢‘ç‡è¾ƒé«˜çš„è®¾è®¡æ¨¡å¼ï¼Œæ—¨åœ¨ç”¨æ¨¡å¼æ¥**ç»Ÿä¸€æ²Ÿé€šé¢å‘å¯¹è±¡æ–¹æ³•åœ¨åˆ†æã€è®¾è®¡å’Œå®ç°é—´çš„é¸¿æ²Ÿ**ã€‚\n\nGoFå°†æ¨¡å¼çš„æ¦‚å¿µå¼•å…¥è½¯ä»¶å·¥ç¨‹é¢†åŸŸï¼Œè¿™æ ‡å¿—ç€è½¯ä»¶æ¨¡å¼çš„è¯ç”Ÿã€‚è½¯ä»¶æ¨¡å¼æ˜¯å°†æ¨¡å¼çš„ä¸€èˆ¬æ¦‚å¿µåº”ç”¨äºè½¯ä»¶å¼€å‘é¢†åŸŸï¼Œå³**è½¯ä»¶å¼€å‘çš„æ€»ä½“æŒ‡å¯¼æ€è·¯æˆ–å‚ç…§æ ·æ¿**ã€‚è½¯ä»¶æ¨¡å¼**å¹¶éä»…é™äºè®¾è®¡æ¨¡å¼ï¼Œè¿˜åŒ…æ‹¬æ¶æ„æ¨¡å¼ã€åˆ†ææ¨¡å¼å’Œè¿‡ç¨‹æ¨¡å¼**ç­‰ï¼Œå®é™…ä¸Šï¼Œ**åœ¨è½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸçš„æ¯ä¸€ä¸ªé˜¶æ®µéƒ½å­˜åœ¨ç€ä¸€äº›è¢«è®¤åŒçš„æ¨¡å¼**ã€‚\n\n# è½¯ä»¶æ¨¡å¼çš„æ„æˆ\n\nè½¯ä»¶æ¨¡å¼æ˜¯åœ¨è½¯ä»¶å¼€å‘ä¸­æŸäº›å¯é‡ç°é—®é¢˜çš„ä¸€äº›æœ‰æ•ˆè§£å†³æ–¹æ³•ï¼Œè½¯ä»¶æ¨¡å¼çš„åŸºç¡€ç»“æ„ä¸»è¦ç”±å››éƒ¨åˆ†æ„æˆï¼ŒåŒ…æ‹¬é—®é¢˜æè¿°ï¼ˆ**å¾…è§£å†³çš„é—®é¢˜æ˜¯ä»€ä¹ˆ**ï¼‰ã€å‰ææ¡ä»¶ï¼ˆ**åœ¨ä½•ç§ç¯å¢ƒæˆ–çº¦æŸæ¡ä»¶ä¸‹ä½¿ç”¨**ï¼‰ã€è§£æ³•ï¼ˆ**å¦‚ä½•è§£å†³**ï¼‰å’Œæ•ˆæœï¼ˆ**æœ‰å“ªäº›ä¼˜ç¼ºç‚¹**ï¼‰ã€‚\n\n# è®¾è®¡æ¨¡å¼æ˜¯ä»€ä¹ˆ\n\nåœ¨è½¯ä»¶æ¨¡å¼ä¸­ï¼Œè®¾è®¡æ¨¡å¼æ˜¯ç ”ç©¶æœ€ä¸ºæ·±å…¥çš„åˆ†æ”¯ï¼Œè®¾è®¡æ¨¡å¼ç”¨äºåœ¨ç‰¹å®šçš„æ¡ä»¶ä¸‹ä¸ºä¸€äº›é‡å¤å‡ºç°çš„è½¯ä»¶è®¾è®¡é—®é¢˜æä¾›åˆç†çš„ã€æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒ**èåˆäº†ä¼—å¤šä¸“å®¶çš„è®¾è®¡ç»éªŒ**ï¼Œå·²ç»åœ¨æˆåƒä¸Šä¸‡çš„è½¯ä»¶ä¸­å¾—ä»¥åº”ç”¨ã€‚ 1995å¹´ï¼Œ GoFå°†æ”¶é›†å’Œæ•´ç†å¥½çš„23ç§è®¾è®¡æ¨¡å¼æ±‡ç¼–æˆDesign Patterns: Elements of Reusable Object-Oriented Softwareï¼ˆã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹ï¼‰ä¸€ä¹¦ï¼Œè¯¥ä¹¦çš„å‡ºç‰ˆä¹Ÿæ ‡å¿—ç€è®¾è®¡æ¨¡å¼æ­£å¼æˆä¸ºé¢å‘å¯¹è±¡è½¯ä»¶å·¥ç¨‹çš„ä¸€ä¸ªé‡è¦ç ”ç©¶åˆ†æ”¯ã€‚\n\nè®¾è®¡æ¨¡å¼çš„ä¸€èˆ¬å®šä¹‰å¦‚ä¸‹ï¼š\n\n**è®¾è®¡æ¨¡å¼**ï¼ˆDesign Patternï¼‰æ˜¯ä¸€å¥—è¢«åå¤ä½¿ç”¨ã€å¤šæ•°äººçŸ¥æ™“çš„ã€ç»è¿‡åˆ†ç±»ç¼–ç›®çš„ã€ä»£ç è®¾è®¡ç»éªŒçš„**æ€»ç»“**ï¼Œä½¿ç”¨è®¾è®¡æ¨¡å¼æ˜¯ä¸ºäº†å¯é‡ç”¨ä»£ç ã€è®©ä»£ç æ›´å®¹æ˜“è¢«ä»–äººç†è§£å¹¶ä¸”ä¿è¯ä»£ç å¯é æ€§ã€‚\n## è®¾è®¡æ¨¡å¼çš„è¦ç´ \n\nè®¾è®¡æ¨¡å¼ä¸€èˆ¬åŒ…å«æ¨¡å¼åç§°ã€é—®é¢˜ã€ç›®çš„ã€è§£å†³æ–¹æ¡ˆã€æ•ˆæœç­‰ç»„æˆè¦ç´ ï¼Œå…¶ä¸­å…³é”®è¦ç´ æ˜¯æ¨¡å¼åç§°ã€é—®é¢˜ã€è§£å†³æ–¹æ¡ˆå’Œæ•ˆæœã€‚\n\n1. **æ¨¡å¼åç§°**(Pattern Name)é€šè¿‡ä¸€ä¸¤ä¸ªè¯æ¥æè¿°æ¨¡å¼çš„é—®é¢˜ã€è§£å†³æ–¹æ¡ˆå’Œæ•ˆæœï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£æ¨¡å¼å¹¶æ–¹ä¾¿å¼€å‘äººå‘˜ä¹‹é—´çš„äº¤æµï¼Œç»å¤§å¤šæ•°æ¨¡å¼éƒ½æ˜¯æ ¹æ®å…¶åŠŸèƒ½æˆ–æ¨¡å¼ç»“æ„æ¥å‘½åçš„ï¼ˆGoFè®¾è®¡æ¨¡å¼ä¸­æ²¡æœ‰ä¸€ä¸ªæ¨¡å¼ç”¨äººåå‘½åï¼‰\n2. **é—®é¢˜**(Problem)æè¿°äº†åº”è¯¥åœ¨ä½•æ—¶ä½¿ç”¨æ¨¡å¼ï¼Œå®ƒåŒ…å«äº†è®¾è®¡ä¸­å­˜åœ¨çš„é—®é¢˜ä»¥åŠé—®é¢˜å­˜åœ¨çš„åŸå› \n3. **è§£å†³æ–¹æ¡ˆ**(Solution)æè¿°äº†ä¸€ä¸ªè®¾è®¡æ¨¡å¼çš„ç»„æˆæˆåˆ†ï¼Œä»¥åŠè¿™äº›ç»„æˆæˆåˆ†ä¹‹é—´çš„ç›¸äº’å…³ç³»ï¼Œå„è‡ªçš„èŒè´£å’Œåä½œæ–¹å¼ï¼Œé€šå¸¸è§£å†³æ–¹æ¡ˆé€šè¿‡UMLç±»å›¾å’Œæ ¸å¿ƒä»£ç æ¥è¿›è¡Œæè¿°\n4. **æ•ˆæœ**(Consequences)æè¿°äº†æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ä»¥åŠåœ¨ä½¿ç”¨æ¨¡å¼æ—¶åº”æƒè¡¡çš„é—®é¢˜ã€‚\n# è®¾è®¡æ¨¡å¼çš„ç”¨é€”åˆ†ç±»\n\nè™½ç„¶GoFè®¾è®¡æ¨¡å¼åªæœ‰23ä¸ªï¼Œä½†æ˜¯å®ƒä»¬å„å…·ç‰¹è‰²ï¼Œæ¯ä¸ªæ¨¡å¼éƒ½ä¸ºæŸä¸€ä¸ªå¯é‡å¤çš„è®¾è®¡é—®é¢˜æä¾›äº†ä¸€å¥—è§£å†³æ–¹æ¡ˆã€‚\n\næ ¹æ®å®ƒä»¬çš„ç”¨é€”ï¼Œè®¾è®¡æ¨¡å¼å¯åˆ†ä¸º**åˆ›å»ºå‹**(Creational)ï¼Œ**ç»“æ„å‹**(Structural)å’Œ**è¡Œä¸ºå‹**(Behavioral)ä¸‰ç§ã€‚\n\n1. **åˆ›å»ºå‹**æ¨¡å¼ä¸»è¦ç”¨äºæè¿°**å¦‚ä½•åˆ›å»ºå¯¹è±¡**ï¼›\n2. **ç»“æ„å‹**æ¨¡å¼ä¸»è¦ç”¨äºæè¿°**å¦‚ä½•å®ç°ç±»æˆ–å¯¹è±¡çš„ç»„åˆ**ï¼›\n3. **è¡Œä¸ºå‹**æ¨¡å¼ä¸»è¦ç”¨äºæè¿°**ç±»æˆ–å¯¹è±¡æ€æ ·äº¤äº’ä»¥åŠæ€æ ·åˆ†é…èŒè´£**ã€‚\n\nåœ¨GoF 23ç§è®¾è®¡æ¨¡å¼ä¸­åŒ…å«5ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ã€7ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼å’Œ11ç§è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ã€‚\n\næ­¤å¤–ï¼Œæ ¹æ®æŸä¸ªæ¨¡å¼ä¸»è¦æ˜¯ç”¨äº**å¤„ç†ç±»ä¹‹é—´çš„å…³ç³»è¿˜æ˜¯å¯¹è±¡ä¹‹é—´çš„å…³ç³»**ï¼Œè®¾è®¡æ¨¡å¼è¿˜å¯ä»¥åˆ†ä¸º**ç±»æ¨¡å¼**å’Œ**å¯¹è±¡æ¨¡å¼**ã€‚\n\næˆ‘ä»¬ç»å¸¸å°†ä¸¤ç§åˆ†ç±»æ–¹å¼ç»“åˆä½¿ç”¨ï¼Œå¦‚å•ä¾‹æ¨¡å¼æ˜¯å¯¹è±¡åˆ›å»ºå‹æ¨¡å¼ï¼Œæ¨¡æ¿æ–¹æ³•æ¨¡å¼æ˜¯ç±»è¡Œä¸ºå‹æ¨¡å¼ã€‚\n\n## å¸¸ç”¨è®¾è®¡æ¨¡å¼ä¸€è§ˆè¡¨\n\nå€¼å¾—ä¸€æçš„æ˜¯ï¼Œæœ‰ä¸€ä¸ªè®¾è®¡æ¨¡å¼è™½ç„¶ä¸å±äºGoF 23ç§è®¾è®¡æ¨¡å¼ï¼Œä½†ä¸€èˆ¬åœ¨ä»‹ç»è®¾è®¡æ¨¡å¼æ—¶éƒ½ä¼šå¯¹å®ƒè¿›è¡Œè¯´æ˜ï¼Œå®ƒå°±æ˜¯**ç®€å•å·¥å‚æ¨¡å¼**ï¼Œä¹Ÿè®¸æ˜¯å¤ªâ€œç®€å•â€äº†ï¼ŒGoFå¹¶æ²¡æœ‰æŠŠå®ƒå†™åˆ°é‚£æœ¬ç»å…¸è‘—ä½œä¸­ï¼Œä¸è¿‡ç°åœ¨å¤§éƒ¨åˆ†çš„è®¾è®¡æ¨¡å¼ä¹¦ç±éƒ½ä¼šå¯¹å®ƒè¿›è¡Œä¸“é—¨çš„ä»‹ç»ã€‚\n\nï¼ˆä»¥ä¸‹éš¾åº¦ã€é¢‘ç‡ç»Ÿè®¡ç»“æœæ¥è‡ªåˆ˜ä¼Ÿï¼‰\n\n<table>\n\t<tr>\n\t    <th>ç±»å‹</th>\n\t    <th>æ¨¡å¼åç§°</th>\n\t    <th>å­¦ä¹ éš¾åº¦</th>\n        <th>ä½¿ç”¨é¢‘ç‡</th>\n\t</tr>\n\t<tr>\n\t    <td rowspan=\"6\">åˆ›å»ºå‹æ¨¡å¼ Creational</td>\n\t    <td>å•ä¾‹æ¨¡å¼ Singleton</td>\n\t    <td>â˜…â˜†â˜†â˜†â˜†</td>\n        <td>â˜…â˜…â˜…â˜…â˜†</td>\n\t</tr>\n\t<tr>\n\t    <td>ç®€å•å·¥å‚æ¨¡å¼</td>\n\t    <td>â˜…â˜…â˜†â˜†â˜†</td>\n        <td>â˜…â˜…â˜…â˜†â˜†</td>\n\t</tr>\n\t<tr>\n\t    <td>å·¥å‚æ–¹æ³•æ¨¡å¼ Factory Method</td>\n\t    <td>â˜…â˜…â˜†â˜†â˜†</td>\n        <td>â˜…â˜…â˜…â˜…â˜…</td>\n\t</tr>\n\t<tr>\n\t    <td>æŠ½è±¡å·¥å‚æ¨¡å¼ Abstract Factory</td>\n\t    <td>â˜…â˜…â˜…â˜…â˜†</td>\n        <td>â˜…â˜…â˜…â˜…â˜…</td>\n\t</tr>\n    <tr>\n\t    <td>åŸå‹æ¨¡å¼ Prototype</td>\n\t    <td>â˜…â˜…â˜…â˜†â˜†</td>\n        <td>â˜…â˜…â˜…â˜†â˜†</td>\n\t</tr>\n    <tr>\n\t    <td>å»ºé€ è€…æ¨¡å¼ Builder</td>\n\t    <td>â˜…â˜…â˜…â˜…â˜†</td>\n        <td>â˜…â˜…â˜†â˜†â˜†</td>\n\t</tr>\n    <tr>\n        <td rowspan=\"7\">ç»“æ„å‹æ¨¡å¼ Structural</td>\n        <td>é€‚é…å™¨æ¨¡å¼ Adapter</td>\n        <td>â˜…â˜…â˜†â˜†â˜†</td>\n        <td>â˜…â˜…â˜…â˜…â˜†</td>\n    </tr>\n    <tr>\n        <td>æ¡¥æ¥æ¨¡å¼ Bridge</td>\n        <td>â˜…â˜…â˜…â˜†â˜†</td>\n        <td>â˜…â˜…â˜…â˜†â˜†</td>\n    </tr>\n    <tr>\n        <td>ç»„åˆæ¨¡å¼ Composite</td>\n        <td>â˜…â˜…â˜…â˜†â˜†</td>\n        <td>â˜…â˜…â˜…â˜…â˜†</td>\n    </tr>\n    <tr>\n        <td>è£…é¥°æ¨¡å¼ Decorator</td>\n        <td>â˜…â˜…â˜…â˜†â˜†</td>\n        <td>â˜…â˜…â˜…â˜†â˜†</td>\n    </tr>\n    <tr>\n        <td>å¤–è§‚æ¨¡å¼ Facade</td>\n        <td>â˜…â˜†â˜†â˜†â˜†</td>\n        <td>â˜…â˜…â˜…â˜…â˜…</td>\n    </tr>\n    <tr>\n        <td>äº«å…ƒæ¨¡å¼ Flyweight</td>\n        <td>â˜…â˜…â˜…â˜…â˜†</td>\n        <td>â˜…â˜†â˜†â˜†â˜†</td>\n    </tr>\n    <tr>\n        <td>ä»£ç†æ¨¡å¼ Proxy</td>\n        <td>â˜…â˜…â˜…â˜†â˜†</td>\n        <td>â˜…â˜…â˜…â˜…â˜†</td>\n    </tr>\n    <tr>\n        <td rowspan=\"11\">è¡Œä¸ºå‹æ¨¡å¼ Behavioral</td>\n        <td>èŒè´£é“¾æ¨¡å¼ Chain of Responsibility</td>\n        <td>â˜…â˜…â˜…â˜†â˜†</td>\n        <td>â˜…â˜…â˜†â˜†â˜†</td>\n    </tr>\n    <tr>\n        <td>å‘½ä»¤æ¨¡å¼ Command</td>\n        <td>â˜…â˜…â˜…â˜†â˜†</td>\n        <td>â˜…â˜…â˜…â˜…â˜†</td>\n    </tr>\n    <tr>\n        <td>è§£é‡Šå™¨æ¨¡å¼ Interpreter</td>\n        <td>â˜…â˜…â˜…â˜…â˜…</td>\n        <td>â˜…â˜†â˜†â˜†â˜†</td>\n    </tr>\n    <tr>\n        <td>è¿­ä»£å™¨æ¨¡å¼ Iterator</td>\n        <td>â˜…â˜…â˜…â˜†â˜†</td>\n        <td>â˜…â˜…â˜…â˜…â˜…</td>\n    </tr>\n    <tr>\n        <td>ä¸­ä»‹è€…æ¨¡å¼ Mediator</td>\n        <td>â˜…â˜…â˜…â˜†â˜†</td>\n        <td>â˜…â˜…â˜†â˜†â˜†</td>\n    </tr>\n    <tr>\n        <td>å¤‡å¿˜å½•æ¨¡å¼ Memento</td>\n        <td>â˜…â˜…â˜†â˜†â˜†</td>\n        <td>â˜…â˜…â˜†â˜†â˜†</td>\n    </tr>\n    <tr>\n        <td>è§‚å¯Ÿè€…æ¨¡å¼ Observer</td>\n        <td>â˜…â˜…â˜…â˜†â˜†</td>\n        <td>â˜…â˜…â˜…â˜…â˜…</td>\n    </tr>\n    <tr>\n        <td>çŠ¶æ€æ¨¡å¼ State</td>\n        <td>â˜…â˜…â˜…â˜†â˜†</td>\n        <td>â˜…â˜…â˜…â˜†â˜†</td>\n    </tr>\n    <tr>\n        <td>ç­–ç•¥æ¨¡å¼ Strategy</td>\n        <td>â˜…â˜†â˜†â˜†â˜†</td>\n        <td>â˜…â˜…â˜…â˜…â˜†</td>\n    </tr>\n    <tr>\n        <td>æ¨¡æ¿æ–¹æ³•æ¨¡å¼ Template Method</td>\n        <td>â˜…â˜…â˜†â˜†â˜†</td>\n        <td>â˜…â˜…â˜…â˜†â˜†</td>\n    </tr>\n    <tr>\n        <td>è®¿é—®è€…æ¨¡å¼ Visitor</td>\n        <td>â˜…â˜…â˜…â˜…â˜†</td>\n        <td>â˜…â˜†â˜†â˜†â˜†</td>\n    </tr>\n</table>\n\n# 1å¥è¯æè¿°23ä¸ªè®¾è®¡æ¨¡å¼\n## ç»“æ„å‹\n\n1. **é€‚é…å™¨æ¨¡å¼ï¼ˆAdapterï¼‰**ï¼šå°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦ä¸€ä¸ªæ¥å£ã€‚\n    - ä¾‹å­ï¼šç”µæºé€‚é…å™¨ï¼Œå°†ä¸¤å­”æ’å¤´é€‚é…æˆä¸‰å­”æ’å¤´ã€‚\n\n2. **æ¡¥æ¥æ¨¡å¼ï¼ˆBridgeï¼‰**ï¼šå°†æŠ½è±¡éƒ¨åˆ†ä¸å®ƒçš„å®ç°éƒ¨åˆ†åˆ†ç¦»ï¼Œä½¿å®ƒä»¬å¯ä»¥ç‹¬ç«‹å˜åŒ–ã€‚\n    - ä¾‹å­ï¼šé¥æ§å™¨ï¼ˆæŠ½è±¡éƒ¨åˆ†ï¼‰å’Œä¸åŒç±»å‹çš„ç”µè§†æœºï¼ˆå®ç°éƒ¨åˆ†ï¼‰ã€‚\n    - è‹¹æœç³»ç»Ÿä¸­OCå’ŒCè¯­è¨€ä¹‹é—´çš„æ¡¥æ¢ã€‚\n\n3. **ç»„åˆæ¨¡å¼ï¼ˆCompositeï¼‰**ï¼šå°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤ºâ€œéƒ¨åˆ†-æ•´ä½“â€çš„å±‚æ¬¡ç»“æ„ï¼Œä½¿å¾—ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ã€‚\n    - ä¾‹å­ï¼šæ–‡ä»¶å¤¹å’Œæ–‡ä»¶çš„ç»“æ„ï¼Œä¸€ä¸ªæ–‡ä»¶å¤¹å¯ä»¥åŒ…å«æ–‡ä»¶æˆ–å­æ–‡ä»¶å¤¹ã€‚\n\n4. **è£…é¥°æ¨¡å¼ï¼ˆDecoratorï¼‰**ï¼šåŠ¨æ€åœ°ç»™å¯¹è±¡æ·»åŠ ä¸€äº›é¢å¤–çš„èŒè´£ã€‚\n    - ä¾‹å­ï¼šç»™åœ£è¯æ ‘æ·»åŠ è£…é¥°å“ï¼Œæ¯ä¸ªè£…é¥°å“å¢åŠ æ–°çš„ç‰¹æ€§ã€‚\n\n5. **å¤–è§‚æ¨¡å¼ï¼ˆFacadeï¼‰**ï¼šä¸ºå­ç³»ç»Ÿä¸­çš„ä¸€ç»„æ¥å£æä¾›ä¸€ä¸ªä¸€è‡´çš„ç•Œé¢ï¼Œä½¿å­ç³»ç»Ÿæ›´å®¹æ˜“ä½¿ç”¨ã€‚\n    - ä¾‹å­ï¼šé¤å…æœåŠ¡å‘˜ï¼Œç»Ÿä¸€ç‚¹èœã€é€èœå’Œç»“è´¦çš„æ¥å£ã€‚\n\n6. **äº«å…ƒæ¨¡å¼ï¼ˆFlyweightï¼Œä¹Ÿå«è½»é‡å¯¹è±¡æ¨¡å¼ï¼‰**ï¼šé€šè¿‡å…±äº«å¤§é‡ç»†ç²’åº¦å¯¹è±¡æ¥èŠ‚çœå†…å­˜ã€‚\n    - ä¾‹å­ï¼šå›´æ£‹æ£‹å­ï¼Œé»‘ç™½æ£‹å­å…±äº«ä¸€ä¸ªå¯¹è±¡ï¼ŒèŠ‚çœå†…å­˜ã€‚\n\n7. **ä»£ç†æ¨¡å¼ï¼ˆProxyï¼‰**ï¼šä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ï¼Œä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚\n    - ä¾‹å­ï¼šæ˜æ˜Ÿçš„ç»çºªäººï¼Œä»£ç†å¤„ç†äº‹åŠ¡å’Œå®‰æ’æ´»åŠ¨ã€‚\n## è¡Œä¸ºå‹\n\n1. **è´£ä»»é“¾æ¨¡å¼ï¼ˆChain of Responsibilityï¼‰**ï¼šå°†è¯·æ±‚æ¶ˆæ¯æ²¿ç€å¤„ç†è€…é“¾ä¼ é€’ï¼Œç›´åˆ°æœ‰å¤„ç†è€…å¤„ç†å®ƒã€‚\n    - ä¾‹å­ï¼šå…¬å¸è¯·å‡å®¡æ‰¹æµç¨‹ï¼Œä¾æ¬¡ç”±ä¸»ç®¡ã€ç»ç†ã€æ€»ç›‘å®¡æ‰¹ã€‚\n\n2. **å‘½ä»¤æ¨¡å¼ï¼ˆCommandï¼‰**ï¼šå°†è¯·æ±‚å°è£…æˆå¯¹è±¡ï¼Œä½¿ä¸åŒçš„è¯·æ±‚ã€é˜Ÿåˆ—æˆ–æ—¥å¿—å‚æ•°åŒ–ã€‚\n    - ä¾‹å­ï¼šé¥æ§å™¨ä¸Šçš„æŒ‰é’®ï¼Œæ¯ä¸ªæŒ‰é’®å°è£…ä¸€ä¸ªå‘½ä»¤ã€‚\n\n3. **è§£é‡Šå™¨æ¨¡å¼ï¼ˆInterpreterï¼‰**ï¼šç»™å®šä¸€ä¸ªè¯­è¨€ï¼Œå®šä¹‰å®ƒçš„æ–‡æ³•è¡¨ç¤ºï¼Œå¹¶å®šä¹‰ä¸€ä¸ªè§£é‡Šå™¨æ¥å¤„ç†è¿™äº›è¡¨ç¤ºã€‚\n    - ä¾‹å­ï¼šæ­£åˆ™è¡¨è¾¾å¼è§£æå™¨ï¼Œè§£é‡Šå’Œå¤„ç†æ­£åˆ™è¡¨è¾¾å¼ã€‚\n    - 3Dè½¯ä»¶ä¸­é€šè¿‡è„šæœ¬æˆ–å‘½ä»¤æŒ‰é’®æ§åˆ¶ç•Œé¢ï¼Œæˆ–æ§åˆ¶ç‰©ä½“è¿åŠ¨ã€‚\n\n4. **è¿­ä»£å™¨æ¨¡å¼ï¼ˆIteratorï¼‰**ï¼šæä¾›ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­çš„å„ä¸ªå…ƒç´ ï¼Œè€Œä¸æš´éœ²å…¶å†…éƒ¨è¡¨ç¤ºã€‚\n    - ä¾‹å­ï¼šå›¾ä¹¦é¦†çš„ä¹¦æ¶ï¼Œä½¿ç”¨è¿­ä»£å™¨éå†ä¹¦ç±ã€‚\n    - STLä¸­å®¹å™¨å’Œç®—æ³•ä¹‹é—´çš„æ¡¥æ¢ã€‚\n\n5. **ä¸­ä»‹è€…æ¨¡å¼ï¼ˆMediatorï¼‰**ï¼šç”¨ä¸€ä¸ªä¸­ä»‹å¯¹è±¡æ¥å°è£…ä¸€ç³»åˆ—å¯¹è±¡çš„äº¤äº’ã€‚\n    - ä¾‹å­ï¼šæœºåœºçš„å¡”å°ï¼Œè°ƒåº¦å’Œç®¡ç†é£æœºçš„èµ·é™ã€‚\n    - æ¸¸æˆå¼•æ“ä¸­ç”¨çš„å±…å¤šã€‚\n\n6. **å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMementoï¼‰**ï¼šåœ¨ä¸ç ´åå°è£…çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€ã€‚\n    - ä¾‹å­ï¼šç”µè„‘çš„ç³»ç»Ÿè¿˜åŸç‚¹ï¼Œè®°å½•ç³»ç»ŸçŠ¶æ€ä»¥ä¾¿å°†æ¥æ¢å¤ã€‚\n    - Wordç¼–è¾‘è¿‡ç¨‹ä¸­çš„undoã€redoã€‚\n\n7. **è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserverï¼‰**ï¼šå®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œä½¿å¾—æ¯å½“ä¸€ä¸ªå¯¹è±¡æ”¹å˜çŠ¶æ€ï¼Œåˆ™æ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½ä¼šå¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°ã€‚\n    - ä¾‹å­ï¼šè®¢é˜…æŠ¥çº¸ï¼Œå½“æŠ¥çº¸æœ‰æ–°å†…å®¹æ—¶ï¼Œé€šçŸ¥æ‰€æœ‰è®¢é˜…è€…ã€‚\n\n8. **çŠ¶æ€æ¨¡å¼ï¼ˆStateï¼‰**ï¼šå…è®¸å¯¹è±¡åœ¨å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å®ƒçš„è¡Œä¸ºã€‚\n    - ä¾‹å­ï¼šç”µæ¢¯çš„çŠ¶æ€ï¼Œä¸åŒçŠ¶æ€ï¼ˆä¸Šä¸‹æ¥¼ã€å¼€å…³é—¨ï¼‰ä¸‹ç”µæ¢¯è¡Œä¸ºä¸åŒã€‚\n\n9. **ç­–ç•¥æ¨¡å¼ï¼ˆStrategyï¼‰**ï¼šå®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼Œå°†æ¯ä¸ªç®—æ³•å°è£…èµ·æ¥ï¼Œå¹¶ä½¿å®ƒä»¬å¯ä»¥äº’æ¢ã€‚\n    - ä¾‹å­ï¼šæ—…æ¸¸å‡ºè¡Œç­–ç•¥ï¼Œæ ¹æ®æƒ…å†µé€‰æ‹©ä¸åŒçš„å‡ºè¡Œæ–¹å¼ï¼ˆå¼€è½¦ã€åå…¬äº¤ã€éª‘è‡ªè¡Œè½¦ï¼‰ã€‚\n    - æ¯”å¦‚HDCï¼Œä¸åŒçš„è®¾å¤‡å¯¹åº”ä¸åŒçš„DCã€‚\n\n10. **æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆTemplate Methodï¼‰**ï¼šå®šä¹‰ä¸€ä¸ªæ“ä½œä¸­çš„ç®—æ³•çš„éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ï¼Œä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜ç®—æ³•çš„ç»“æ„å³å¯é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›æ­¥éª¤ã€‚\n    - ä¾‹å­ï¼šåˆ¶ä½œå’–å•¡çš„æ­¥éª¤ï¼Œå…·ä½“çš„å’–å•¡åˆ¶ä½œç»†èŠ‚ç”±ä¸åŒç§ç±»çš„å’–å•¡å†³å®šã€‚\n    - [Windows_é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡](../Windows/Windows_é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡.md)ä¸­å»ºç«‹çš„Windowæ¡†æ¶å°±æ˜¯æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€‚\n\n11. **è®¿é—®è€…æ¨¡å¼ï¼ˆVisitorï¼‰**ï¼šè¡¨ç¤ºä¸€ä¸ªä½œç”¨äºæŸå¯¹è±¡ç»“æ„ä¸­çš„å„å…ƒç´ çš„æ“ä½œï¼Œä½¿å¾—å¯ä»¥åœ¨ä¸æ”¹å˜å„å…ƒç´ ç±»çš„å‰æä¸‹å®šä¹‰ä½œç”¨äºè¿™äº›å…ƒç´ çš„æ–°æ“ä½œã€‚\n    - ä¾‹å­ï¼šåšç‰©é¦†å¯¼è§ˆå‘˜ï¼Œä¸åŒå¯¼è§ˆå‘˜ä¸ºæ¸¸å®¢è®²è§£ä¸åŒå±•å“çš„ä¿¡æ¯ã€‚\n## åˆ›å»ºå‹\n1. **å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰**ï¼šç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›å…¨å±€è®¿é—®ç‚¹ã€‚\n    - ä¾‹å­ï¼šæ€»ç»ŸåŠå…¬å®¤ï¼ˆå…¨å›½åªæœ‰ä¸€ä¸ªæ€»ç»Ÿï¼‰ã€‚\n\n2. **å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆFactory Methodï¼‰**ï¼šå®šä¹‰ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œä½†è®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸ªç±»ã€‚\n    - ä¾‹å­ï¼šæŠ«è¨åº—ï¼Œæ ¹æ®è®¢å•åˆ¶ä½œä¸åŒç±»å‹çš„æŠ«è¨ã€‚\n\n3. **æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆAbstract Factoryï¼‰**ï¼šæä¾›ä¸€ä¸ªæ¥å£ï¼Œç”¨äºåˆ›å»ºç›¸å…³æˆ–ä¾èµ–å¯¹è±¡çš„å®¶æ—ï¼Œè€Œæ— éœ€æŒ‡å®šå…·ä½“ç±»ã€‚\n    - ä¾‹å­ï¼šå®¶å…·å·¥å‚ï¼Œå¯ä»¥åˆ›å»ºä¸€æ•´å¥—é£æ ¼ä¸€è‡´çš„å®¶å…·ï¼ˆå¦‚ç°ä»£é£æ ¼æˆ–å¤å…¸é£æ ¼ï¼‰ã€‚\n\n4. **å»ºé€ è€…æ¨¡å¼ï¼ˆBuilderï¼‰**ï¼šå°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºè¿‡ç¨‹æ‹†è§£ï¼Œä¸å…¶è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚\n    - ä¾‹å­ï¼šå»ºç­‘å·¥äººï¼ŒæŒ‰ç…§è®¾è®¡å›¾çº¸å»ºé€ ä¸åŒçš„æˆ¿å±‹ã€‚\n\n5. **åŸå‹æ¨¡å¼ï¼ˆPrototypeï¼‰**ï¼šé€šè¿‡å¤åˆ¶ç°æœ‰å¯¹è±¡æ¥åˆ›å»ºæ–°å¯¹è±¡ã€‚\n    - ä¾‹å­ï¼šç»†èƒåˆ†è£‚ï¼Œé€šè¿‡å¤åˆ¶è‡ªèº«äº§ç”Ÿæ–°ç»†èƒã€‚\n\n# è®¾è®¡æ¨¡å¼çš„ä»·å€¼\n\nå¤§éƒ¨åˆ†è®¾è®¡æ¨¡å¼éƒ½å…¼é¡¾äº†ç³»ç»Ÿçš„å¯é‡ç”¨æ€§å’Œå¯æ‰©å±•æ€§ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥æ›´å¥½åœ°é‡ç”¨ä¸€äº›å·²æœ‰çš„è®¾è®¡æ–¹æ¡ˆã€åŠŸèƒ½æ¨¡å—ç”šè‡³ä¸€ä¸ªå®Œæ•´çš„è½¯ä»¶ç³»ç»Ÿï¼Œé¿å…æˆ‘ä»¬ç»å¸¸åšä¸€äº›é‡å¤çš„è®¾è®¡ã€ç¼–å†™ä¸€äº›é‡å¤çš„ä»£ç ã€‚\n\næ­¤å¤–ï¼Œéšç€è½¯ä»¶è§„æ¨¡æ—¥ç›Šå¢å¤§ï¼Œç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ä¹Ÿè¶Šæ¥è¶Šé‡è¦ï¼Œè®¸å¤šè®¾è®¡æ¨¡å¼å°†æœ‰åŠ©äºæé«˜ç³»ç»Ÿçš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ï¼Œè®©æˆ‘ä»¬åœ¨ä¸ä¿®æ”¹æˆ–è€…å°‘ä¿®æ”¹ç°æœ‰ç³»ç»Ÿçš„åŸºç¡€ä¸Šå¢åŠ ã€åˆ é™¤æˆ–è€…æ›¿æ¢åŠŸèƒ½æ¨¡å—ã€‚\n\n# å¦‚ä½•å­¦ä¹ è®¾è®¡æ¨¡å¼\n\n1. åœ¨å­¦ä¹ æ¯ä¸€ä¸ªè®¾è®¡æ¨¡å¼æ—¶è‡³å°‘åº”è¯¥æŒæ¡å¦‚ä¸‹å‡ ç‚¹ï¼šå½“ä½ èƒ½å¤Ÿå›ç­”æ‰€æœ‰é—®é¢˜æ—¶ï¼Œæ­å–œä½ ï¼Œä½ äº†è§£ä¸€ä¸ªè®¾è®¡æ¨¡å¼äº†ï¼Œè‡³äºæŒæ¡å®ƒï¼Œé‚£å°±åœ¨å¼€å‘ä¸­å»ä½¿ç”¨å§ï¼Œç”¨å¤šäº†ä½ è‡ªç„¶å°±æŒæ¡äº†ã€‚\n    1. è¿™ä¸ªè®¾è®¡æ¨¡å¼çš„æ„å›¾æ˜¯ä»€ä¹ˆï¼Œå®ƒè¦è§£å†³ä¸€ä¸ªä»€ä¹ˆé—®é¢˜ï¼Œä»€ä¹ˆæ—¶å€™å¯ä»¥ä½¿ç”¨å®ƒï¼›\n    2. å®ƒæ˜¯å¦‚ä½•è§£å†³çš„ï¼ŒæŒæ¡å®ƒçš„ç»“æ„å›¾ï¼Œè®°ä½å®ƒçš„å…³é”®ä»£ç ï¼›\n    3. èƒ½å¤Ÿæƒ³åˆ°è‡³å°‘ä¸¤ä¸ªå®ƒçš„åº”ç”¨å®ä¾‹ï¼Œä¸€ä¸ªç”Ÿæ´»ä¸­çš„ï¼Œä¸€ä¸ªè½¯ä»¶ä¸­çš„ï¼›\n    4. è¿™ä¸ªæ¨¡å¼çš„ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Œåœ¨ä½¿ç”¨æ—¶è¦æ³¨æ„ä»€ä¹ˆã€‚\n2. â€œå¦‚æœæƒ³ä½“éªŒä¸€ä¸‹è¿ç”¨æ¨¡å¼çš„æ„Ÿè§‰ï¼Œé‚£ä¹ˆæœ€å¥½çš„æ–¹æ³•å°±æ˜¯è¿ç”¨å®ƒä»¬ã€‚â€æ­£å¦‚åœ¨æœ¬ç« æœ€å¼€å§‹æ‰€è¯´çš„ï¼Œè®¾è®¡æ¨¡å¼æ˜¯â€œå†…åŠŸå¿ƒæ³•â€ï¼Œå®ƒè¿˜æ˜¯è¦ä¸â€œå®æˆ˜æ‹›å¼â€ç›¸ç»“åˆæ‰èƒ½å¤Ÿç›¸å¾—ç›Šå½°ã€‚å­¦ä¹ è®¾è®¡æ¨¡å¼çš„ç›®çš„åœ¨äºåº”ç”¨ï¼Œå¦‚æœä¸æ‡‚å¦‚ä½•ä½¿ç”¨ä¸€ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè€Œåªæ˜¯å­¦è¿‡ï¼Œèƒ½å¤Ÿè¯´å‡ºå®ƒçš„ç”¨é€”ï¼Œç»˜åˆ¶å®ƒçš„ç»“æ„ï¼Œå……å…¶é‡ä¹Ÿåªèƒ½è¯´ä½ äº†è§£è¿™ä¸ªæ¨¡å¼ï¼Œä¸¥æ ¼ä¸€ç‚¹è¯´ï¼šä¸ä¼šåœ¨å¼€å‘ä¸­çµæ´»è¿ç”¨ä¸€ä¸ªæ¨¡å¼åŸºæœ¬ä¸Šç­‰äºæ²¡å­¦ã€‚æ‰€ä»¥ä¸€å®šè¦åšåˆ°ï¼šå°‘è¯´å¤šåšã€‚\n3. ä¸è¦æ»¥ç”¨æ¨¡å¼ï¼Œä¸è¦è¯•å›¾åœ¨ä¸€ä¸ªç³»ç»Ÿä¸­ç”¨ä¸Šæ‰€æœ‰çš„æ¨¡å¼ã€‚æ¯ä¸ªæ¨¡å¼éƒ½æœ‰è‡ªå·±çš„é€‚ç”¨åœºæ™¯ï¼Œä¸èƒ½ä¸ºäº†ä½¿ç”¨æ¨¡å¼è€Œä½¿ç”¨æ¨¡å¼ã€‚\n4. å¦‚æœå°†è®¾è®¡æ¨¡å¼æ¯”å–»æˆâ€œä¸‰åå…­è®¡â€ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªæ¨¡å¼éƒ½æ˜¯ä¸€ç§è®¡ç­–ï¼Œå®ƒä¸ºè§£å†³æŸä¸€ç±»é—®é¢˜è€Œè¯ç”Ÿï¼Œä¸ç®¡è¿™ä¸ªè®¾è®¡æ¨¡å¼çš„éš¾åº¦å¦‚ä½•ï¼Œä½¿ç”¨é¢‘ç‡é«˜ä¸é«˜ï¼Œéƒ½åº”è¯¥å¥½å¥½å­¦å­¦ï¼Œå¤šå­¦ä¸€ä¸ªæ¨¡å¼ä¹Ÿå°±æ„å‘³ç€ä½ å¤šäº†â€œä¸€è®¡â€ï¼Œè¯´ä¸å®šä»€ä¹ˆæ—¶å€™å°±ç”¨ä¸Šäº†ã€‚\n5. è®¾è®¡æ¨¡å¼çš„â€œä¸Šä¹˜â€å¢ƒç•Œï¼šâ€œæ‰‹ä¸­æ— æ¨¡å¼ï¼Œå¿ƒä¸­æœ‰æ¨¡å¼â€ã€‚æ¨¡å¼ä½¿ç”¨çš„æœ€é«˜å¢ƒç•Œæ˜¯ä½ å·²ç»ä¸çŸ¥é“å…·ä½“æŸä¸ªè®¾è®¡æ¨¡å¼çš„å®šä¹‰å’Œç»“æ„äº†ï¼Œä½†ä½ ä¼šçµæ´»è‡ªå¦‚åœ°é€‰æ‹©ä¸€ç§è®¾è®¡æ–¹æ¡ˆï¼ˆå…¶å®å°±æ˜¯æŸä¸ªè®¾è®¡æ¨¡å¼ï¼‰æ¥è§£å†³æŸä¸ªé—®é¢˜ï¼Œè®¾è®¡æ¨¡å¼å·²ç»æˆä¸ºä½ å¼€å‘æŠ€èƒ½çš„ä¸€éƒ¨åˆ†ï¼Œèƒ½å¤Ÿæ‰‹åˆ°æ“’æ¥ï¼Œâ€œå†…åŠŸâ€ä¸â€œæ‹›å¼â€å·²æµ‘ç„¶ä¸€ä½“ï¼Œè¦è¾¾åˆ°è¿™ä¸ªå¢ƒç•Œå¹¶ä¸æ˜¯çœ‹å®ŒæŸæœ¬ä¹¦æˆ–è€…å¼€å‘ä¸€ä¸¤ä¸ªé¡¹ç›®å°±èƒ½å¤Ÿå®ç°çš„ï¼Œå®ƒéœ€è¦ä¸æ–­æ²‰æ·€ä¸ç§¯ç´¯ï¼Œæ‰€ä»¥ï¼Œå¯¹æ¨¡å¼çš„å­¦ä¹ ä¸è¦æ€¥äºæ±‚æˆã€‚\n6. GoFå·²æ•…æˆå‘˜ã€è½¯ä»¶å·¥ç¨‹å¤§å¸ˆä¹‹ä¸€John Vlissidesçš„è‘—ä½œã€Šè®¾è®¡æ¨¡å¼æ²‰æ€å½•ã€‹(Pattern Hatching Design Patterns Applied)ï¼šæ¨¡å¼ä»ä¸ä¿è¯ä»»ä½•ä¸œè¥¿ï¼Œå®ƒä¸èƒ½ä¿è¯ä½ ä¸€å®šèƒ½å¤Ÿåšå‡ºå¯å¤ç”¨çš„è½¯ä»¶ï¼Œæé«˜ä½ çš„ç”Ÿäº§ç‡ï¼Œæ›´ä¸èƒ½ä¿è¯ä¸–ç•Œå’Œå¹³ï¼›æ¨¡å¼å¹¶ä¸èƒ½æ›¿ä»£äººæ¥å®Œæˆè½¯ä»¶ç³»ç»Ÿçš„åˆ›é€ ï¼Œå®ƒä»¬åªä¸è¿‡ä¼šç»™é‚£äº›ç¼ºä¹ç»éªŒä½†å´å…·å¤‡æ‰èƒ½å’Œåˆ›é€ åŠ›çš„äººå¸¦æ¥å¸Œæœ›ã€‚\n","categories":["è®¾è®¡æ¨¡å¼"]},{"title":"å½’å¹¶æ’åº","url":"/ç®—æ³•/æ’åº_å½’å¹¶æ’åº/","content":"# ä»£ç é€»è¾‘\n\n```c++\nvoid Merge(int* dest, int* src, int left, int mid, int right)\n{\n    \n}\n```\n\nsrcè¡¨ç¤ºæºæ•°æ®ï¼Œdestè¡¨ç¤ºç›®æ ‡ç©ºé—´ã€‚leftè¡¨ç¤ºæºæ•°æ®çš„æœ€å·¦ä½ç½®ï¼Œmidè¡¨ç¤ºæºæ•°æ®çš„ä¸­é—´ä½ç½®ï¼Œrightè¡¨ç¤ºæºæ•°æ®çš„æœ€å³ä½ç½®ã€‚å…¶ä¸­ï¼Œleftåˆ°midæ•°æ®è¦æ»¡è¶³æœ‰åºï¼Œmidåˆ°rightè¦æ»¡è¶³åŒå‘æœ‰åºã€‚\n\næ­¤å‡½æ•°æ¬²å°†srcä¸­çš„æ•°æ®å½’å¹¶åˆ°destä¸­ï¼Œä½¿æ•´ä½“æœ‰åºã€‚\n\n```c++\nvoid Copy(int* src, int* dest, int left, int right)\n{\n    while(left <= right)\n    {\n        dest[left] = src[left];\n        ++left;\n    }\n}\nvoid Merge(int* src, int* tmp, int left, int mid, int right)\n{\n    int i = left, j = mid + 1;\n    int k = left;\n    while(i <= mid && j <= right)\n    {\n        tmp[k++] = src[i] <= src[j] ? src[i++] : src[j++];\n    }\n    while(i <= mid)\n    {\n        tmp[k++] = src[i++];\n    }\n    while(j <= right)\n    {\n        tmp[k++] = src[j++];\n    }\n}\nvoid MergePass(int* src, int* tmp, int left, int right)\n{\n    if(left < right)\n    {\n        int mid = (right + left) / 2;\n        MergePass(src, tmp, left, mid);\t     //å·¦éƒ¨åˆ†\n        MergePass(src, tmp, mid + 1, right); //å³éƒ¨åˆ†\n        \n        Merge(src, tmp, left, mid, right);\t //å·¦å³ä¸¤éƒ¨åˆ†æ¯”å¯¹åˆå¹¶ï¼Œtmpä¸´æ—¶å­˜å‚¨\n        Copy(tmp, src, left, right);         //å°†tmpå†…å®¹å¯¼åˆ°srcï¼Œä¾¿äºä¸‹æ¬¡ä¸¤éƒ¨åˆ†å‡æœ‰åº\n    }\n}\nvoid MergeSort(int* br, int n)\n{\n    if(br == NULL || n <= 1)return;\n    int* tmp = new int[n];\n    MergePass(br, tmp, 0, n - 1);\n    delete[]tmp;\n}\n```\n\n# éé€’å½’å½¢å¼\n\n```c++\n/*\nå‡è®¾å¯¹0 1 2 3 4 5 6 7 8æ’åº\nMerge(src, dest, 0, 0, 1)  --s=1\n\t\t\t\t 2\t2  3\n\t\t\t\t 4  4  5\n\t\t\t\t 6  6  7\nMerge(src, dest, 0, 1, 3)  --s=2\n\t\t\t\t 4, 5, 7\nMerge(src, dest, 0, 3, 7)  --s=4\n\n*/\nvoid Merge(int * src, int * dest, int left, int mid, int right);\n// sä»£è¡¨å½“å‰ä¸€è½®å½’å¹¶çš„å…ƒç´ æ•°ï¼ˆä¸€åŠè§„æ¨¡ï¼‰\nvoid MergePass(int* src, int* dest, int n, int s)\n{\n    int i = 0;\n    // forçš„æ¡ä»¶åˆ¤æ–­æ˜¯çœ‹ å‰©ä¸‹çš„å…ƒç´ æ•°è¿˜å¤Ÿä¸å¤Ÿå‡‘ä¸€ä¸ª2 * sï¼ˆsæ˜¯è¦å½’å¹¶çš„åŠå—ï¼‰\n    for(i = 0; i + 2 * s - 1 <= n - 1; i += 2 * s)\n    {\n        Merge(src, dest, i, i + s - 1, i + 2 * s - 1);\n    }\n    if(n - 1 > i + s - 1)//å¯¹äº[0 1]-[2 3] [4 5]-[6 7] [8 9]-[10]è€Œè¨€(11-1>8+2-1)ï¼Œå³[8 9][10]è¿˜éœ€è¦å†åˆå¹¶ï¼šå³æ­¤å¤„å¤„ç†çš„æ˜¯å‰©ä¸‹çš„ä¸¤å—ï¼Œå³éƒ¨åˆ†çš„ä¸€å—ä¸æ•´é½ï¼ˆ10ï¼‰\n    {\n        Merge(src, dest, i, i + s - 1, n - 1);\n    }\n    else//[0 1 2 3]-[4 5 6 7] [8 9 10]è€Œè¨€(ä¸æ»¡è¶³ifçš„11-1>10+1-1)ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ8 9 10è½å•äº†ï¼Œæ²¡æœ‰ä¸‹ä¸€ç»„ä¸å®ƒä»¬åˆå¹¶ï¼Œåˆ™åŸæ ·å¤åˆ¶\n    {\n        for(int j = i; j < n; ++j)\n        {\n            dest[j] = src[j];\n        }\n    }\n}\nvoid MergeSort(int * ar, int n)\n{\n    if(ar == NULL || n <= 1)return;\n    int * tmp = new[n];\n    // sä»£è¡¨å½“å‰ä¸€è½®å½’å¹¶çš„å…ƒç´ æ•°ï¼ˆä¸€åŠè§„æ¨¡ï¼‰\n    int s = 1;\n    while(s < n)\n    {\n        MergePass(ar, tmp, n, s);\n        s += s;\n        MergePass(tmp, ar, n, s);\n        s += s;\n    }\n    delete[]tmp;\n}\n```\n\n# é€‚ç”¨æ€æƒ³çš„é¢˜\n\n","categories":["ç®—æ³•","æ’åº"]},{"title":"æ’åº_å¿«é€Ÿæ’åº","url":"/ç®—æ³•/æ’åº_å¿«é€Ÿæ’åº/","content":"# å†…å®¹\n\n1. é»˜è®¤åˆ’åˆ†æ³•\n2. éé€’å½’å½¢å¼\n3. éšæœºåˆ’åˆ†æ³•\n4. ä¸‰ä½å–ä¸­æ³•\n5. å•å‘åˆ’åˆ†æ³•\n6. å•é“¾è¡¨å¿«æ’ï¼ˆå•å‘åˆ’åˆ†æ³•ï¼‰\n\n# åŸå§‹ä»£ç \n\n```c++\n//åˆ’åˆ†å‡½æ•°\nvoid Partition(int * ar, int left, int right)\n{\n    int tmp = ar[left];\n    while(left < right)\n    {\n        while(left<right && ar[right]>tmp)--right;\n        if(left < right) ar[left] = ar[right];\n        while(left<right) && ar[left]<=tmp)++left;\n        if(left < right) ar[right] = ar[left];\n    }\n    ar[left] = tmp;//left == right\n    return left;\n}\nvoid PassQuick(int * ar, int left, int right)\n{\n    if(left < right)\n    {\n        int pos = Partition(ar, left, right);\n        PassQuick(ar, left, pos-1);\n        PassQuick(ar, pos+1, right);\n    }\n}\nvoid QuickSort(int * ar, int n)\n{\n    if(ar==NULL || n<=1)return;\n    PassQuick(ar, 0, n-1);\n}\n```\n\n# è®©å‡½æ•°ä¸å†ä»»æ€§-éé€’å½’\n\n```c++\nvoid Partition(int* ar, int left, int right)\n{\n    int tmp = ar[left];\n    while(left < right)\n    {\n        while(left<right && br[right]>tmp)--right;\n        if(left < right) br[left] = br[right];\n        while(left<right) && br[left]<=tmp)++left;\n        if(left < right) br[right] = br[left];\n    }\n    br[left] = tmp;//left == right\n    return left;\n}\nvoid QuickSort(int* ar, int n)\n{\n    if(ar==NULL || n<=1)return;\n    queue<int> qu;\n    qu.push(0);\n    qu.push(n - 1);\n    while(!qu.empty())\n    {\n        int left = qu.front(); qu.pop();\n        int right = qu.front();qu.pop();\n        int pos = Partition(ar, left, right);\n        if(left < pos-1)\n        {\n            qu.push(left);\n            qu.push(pos-1);\n        }\n        if(pos+1 < right)\n        {\n            qu.push(pos+1);\n            qu.push(right);\n        }\n    }\n}\n```\n\nä½¿ç”¨åˆ«åä¹‹å, ç¨‹åºæ›´ä¸ºç®€æ´;\n\n```c++\nvoid QuickSort(int * ar, int n)\n{\n    if(ar==NULL || n<=1)return;\n    using Pair = std::pair<int,int>;\n    queue<Pair> qu;\n    qu.push(Pair(0, n-1));\n    while(!qu.empty())\n    {\n        Pair pos = qu.front();qu.pop();\n        int mid = Partition(ar, pos.first, pos.second);\n        if(pos.first < mid-1)\n            qu.push(Pair(pos.first, mid-1));\n        if(mid+1 > pos.second)\n            qu.push(Pair(mid+1, pos.second));\n    }\n}\n```\n\n# ä»â€œé€‰å–åˆ’åˆ†åŸºå‡†â€å…¥æ‰‹ä¼˜åŒ–\n\n## éšæœºåˆ’åˆ†\n\nè¿™æ ·åšæ˜¯ä¸ºäº†è®©åˆ’åˆ†ç‚¹æ— åº, ä»¥æ¨¡æ‹Ÿæ•°æ®çš„æ— åºæ€§, é˜²æ­¢æ•°æ®æœ‰åºæƒ…å†µä¸‹å¿«æ’æ€§èƒ½çš„é€€åŒ–; \n\nå®ç°æ–¹æ³•: åœ¨Partitionä¹‹å¤–å†å°è£…ä¸€å±‚éšæœºé€‰å–ä¸€ä¸ªä½ç½®, æŠŠè¿™ä¸ªä½ç½®ä¸`ar[left]`å€¼äº¤æ¢, ç„¶åå†è°ƒç”¨Partition; è¿™æ ·çš„å¥½å¤„å°±æ˜¯, ä¸ç”¨ä¿®æ”¹Partitionå‡½æ•°;\n\n```c++\nint RandPartition(int * ar, int left, int right)\n{\n    srand(time(NULL));\n    int pos = rand() % (right-left+1) + left;//è®°å¾—å–æ¨¡å+leftï¼Œä¸åŠ leftæ˜¯ç›¸å¯¹ä½ç½®ã€‚\n    std::swap(ar[left], ar[pos]);\t\t//å·æ¢æ¢æŸ±\n    return Partiton(ar, left, right);\n}\n```\n\n## ä¸‰ä½å–ä¸­æ³•\n\n```c++\nint MidPartition(int* ar, int left, int right)\n{\n    int midpos = (right - left)/2 + left;\n    struct IndexNode\n    {\n        int key;\n        int index;\n        operator int() const {return key;}\n    };\n    struct IndexNode kL = {ar[left], left};\n    struct IndexNode kM = {ar[midpos], midpos};\n    struct IndexNode kR = {ar[right],right};\n\tstd::priority_queue<IndexNode> hp;\n    //kL,kM,kRå…¥å †æ—¶ï¼Œç”±äºIndexNodeç±»å‹é‡è½½äº†int()å¼ºè½¬è¿ç®—ç¬¦ï¼Œæ‰€ä»¥å…¥å †æŒ‰å…¶keyå¤§å°æ’åºã€‚åˆ™å †ä¸­ç¬¬äºŒä¸ªå…ƒç´ ä¸ºkeyç¬¬äºŒå°çš„ã€‚\n    hp.push(kL); hp.push(kM); hp.push(kR);\n    hp.pop();\n    struct IndexNode pos = hp.top();\n    std::swap(ar[kL.index], ar[pos.index]);\t//å·æ¢æ¢æŸ±\n    return Partition(ar, left, right);\n}\n```\n\n# åº”å¯¹ç‰¹æ®Šæ•°æ®ç»“æ„-å•å‘åˆ’åˆ†\n\nå¯ä»¥å¤„ç†å•é“¾è¡¨åœºæ™¯ä¸‹çš„å¿«æ’ã€‚\n\nå…ˆæ‹¿æ•°ç»„ç»ƒã€‚\n\n```c++\nint ForwardPartition(int * ar, int left, int right)\n{\n    int j = left - 1;//æ…¢æŒ‡é’ˆ\n    int i = left;    //å¿«æŒ‡é’ˆ\n    int tmp = ar[i];\n    while(i <= right)\n    {\n        if(ar[i] <= tmp)\n        {\n            ++j;\n            swap(ar[j],ar[i]);\n        }\n        ++i;\n    }\n    swap(ar[left], ar[j]);  //å•å‘åˆ’åˆ†ï¼Œä»¥leftä¸ºåŸºå‡†ï¼Œè¿‡ç¨‹ä¸­è¦ä¿è¯leftå€¼ä¸ä¼šå˜åŒ–ã€‚æœ€åï¼Œæ‰¾åˆ°jçš„ä½ç½®(åˆ’åˆ†ä¹‹åçš„ä¸­é—´ä½ç½®)åï¼Œæ›¿æ¢ï¼Œè¿”å›ã€‚\n    return j;\n}\n```\n\n## å•é“¾è¡¨çš„åˆ’åˆ†ï¼ˆå¸¦å¤´èŠ‚ç‚¹ï¼‰\n\n```c++\ntypedef int ElemType;\ntypedef struct ListNode\n{\n    ElemType data;\n    struct ListNode* next;\n}ListNode, *LinkList;\n//headè¡¨ç¤ºè¿™ä¸ªåˆ’åˆ†åŒºé—´çš„ç¬¬ä¸€ä¸ªæœ‰æ•ˆèŠ‚ç‚¹çš„å‰ä¸€ä¸ªï¼›endè¡¨ç¤ºè¿™ä¸ªåˆ’åˆ†åŒºé—´æœ€åä¸€ä¸ªæœ‰æ•ˆèŠ‚ç‚¹çš„åä¸€ä¸ªï¼ˆæœ‰å¯èƒ½ä¸ºNULLï¼‰ã€‚\nvoid ForwoadListPartition(ListNode* head,ListNode *end)\n{\n    ListNode* j = head;\n    ListNode* i = head->next;\n    ElemType tmp = i->data;\n    while(i != end)\n    {\n        if(i->data <= tmp)\n        {\n            j = j->next;\n            swap(j->data, i->data);\n        }\n        i = i->next;\n    }\n    swap(head->next->data, j->data);\n    //ä¸å†åƒæ•°ç»„é‚£æ ·ï¼Œä¸ç”¨å¯¹ä¸­é—´ä½ç½®è¿›è¡Œmid-1,mid+1ã€‚å› ä¸ºæ­¤æ—¶çš„head,endå·²ä»£è¡¨ä¸åŒæ„ä¹‰ï¼Œjæ­£å¥½å¯ä»¥å……å½“-1å’Œ+1ã€‚\n    ForwoadListPartition(head, j);\n    ForwoadListPartition(j, end);\n}\n```\n\n# é€‚ç”¨åˆ†æ²»ç­–ç•¥-â€œåˆ’åˆ†â€æ€æƒ³çš„åœºæ™¯\n\n## æ‰¾åˆ°ç¬¬Kå°/å¤§æ•°\n\nä¸èƒ½æœ‰é‡å¤å€¼ã€‚\n\n```c++\nint FindK(int * ar, int left, int right, int k)//kæ˜¯ç›¸å¯¹ä½ç½®\n{\n    if(left==right && k==1)return ar[left];\n    int pos = Partition(ar, left, right);\t//è¿”å›çš„posæ˜¯ç»å¯¹ä¸‹æ ‡\n    int j = pos - left + 1;\t\t\t\t\t//jå’Œkä¸€æ ·ï¼Œæ˜¯ç›¸å¯¹leftçš„ä½ç½®\n    if(k<=j)return FindK(ar, left, pos, k);\t //å½“kè¿˜åœ¨jä¹‹å·¦æ—¶ï¼Œåœ¨left~posç»§ç»­åˆ’åˆ†å¯»æ‰¾ç¬¬kå°\n    else return Findk(ar, pos+1, right, k-j);//å½“kåœ¨jä¹‹å³æ—¶ï¼Œåœ¨pos+1~rightå¯»æ‰¾ç¬¬k-jå°ï¼Œå› ä¸ºæ¢åˆ°å³è¾¹æ—¶ï¼Œ\"k\"çš„å€¼å‘ç”Ÿå˜åŒ–ã€‚\n}\nint FindK_Min(int * ar, int n, int k)//ç¬¬kå°\n{\n    if(ar==NULL || k<0 || k>n)return -1;\n    return FindK(ar, 0, n-1, k);\n}\n```\n## æ— åºæ•°ç»„ä¸­æ‰¾ä¸¤ä¸ªå·®å€¼æœ€å°\n\néè´Ÿæ•°ã€‚\n\nå³æ‰¾æœ€æ¥è¿‘ç‚¹å¯¹ï¼Œä»¥ä¸€ç»´ä¸ºä¾‹ã€‚\n\n```c++\nint FindK_Min(int * ar, int n, int k)\n{\n    if(ar==NULL || k<0 || k>n)return -1;\n    return FindK(ar, 0, n-1, k);\n}\nint MaxS1(const int* ar, int left, int right)\n{\n    return ar[right];\n}\nint MinS2(const int* ar, int left, int right)\n{\n    int min = ar[left];\n    for(int i = left + 1; i<=right; ++i)\n    {\n        if(min > ar[i])\n        {\n            min = ar[i];\n        }\n    }\n    return min;\n}\nint Min(int a, int b)\n{\n    return a < b ? a : b;\n}\nint Min(int a, int b, int c)\n{\n    return Min(a, Min(b, c));\n}\nint Cpair(int * ar, int left, int right)\n{\n    if((right-left) <= 0) return INT_MAX;\n    int mid = (right-left+1)/2;\n    FindK(ar, left, right, mid);//midä¸ºç›¸å¯¹ä½ç½®ï¼Œæ­£å¥½æ˜¯s1ä¸­æœ€å¤§çš„ã€‚\n    int pos = left + mid - 1;//posä¸ºç»å¯¹ä¸‹æ ‡ã€‚\n    int d1 = Cpair(ar, left, pos);\t//åœ¨å·¦éƒ¨åˆ†æ‰¾åˆ°ç‚¹å¯¹çš„æœ€å°å·®å€¼\n    int d2 = Cpair(ar, pos+1,right);//åœ¨å³éƒ¨åˆ†æ‰¾åˆ°ç‚¹å¯¹çš„æœ€å°å·®å€¼\n    int maxs = MaxS1(ar, left, pos);\n    int mins = MinS2(ar, pos+1, right);\n    return Min(d1, d2, mins-maxs);\n}\nint Cpair_Ar(int * ar, int n)\n{\n    if(ar==NULL || n<1)return INT_MAX;\n    else return Cpair(ar, 0, n-1);\n}\n```\n\n# ä¸åŒåœºæ™¯ä¸‹çš„å¯¹ç­–\n\n1. æ•°ç»„ç›¸å¯¹æœ‰åºï¼šéšæœºåˆ’åˆ†æ³•ã€‚åœ¨æ¯æ¬¡åˆ’åˆ†ä¹‹å‰åœ¨leftå’Œrightä¹‹å‰randè®¡ç®—ä¸€ä¸ªposï¼Œä½¿è¯¥å€¼ä¸leftå¯¹åº”çš„å€¼äº¤æ¢ï¼Œè¿›è€Œä»¥å…¶ä¸ºåŸºå‡†è¿›è¡Œåˆ’åˆ†ã€‚\n2. \n","categories":["ç®—æ³•","æ’åº"]},{"title":"Linux_Shellç¼–ç¨‹","url":"/Linux/Linux_Shellç¼–ç¨‹/","content":"# å†…å®¹\n\n1. ç¼–è¯‘å‹è¯­è¨€\n2. è§£é‡Šå™¨\n3. å˜é‡ï¼šæœ¬åœ°å˜é‡ã€ç¯å¢ƒå˜é‡ã€å‚æ•°å˜é‡\n4. æ¡ä»¶ï¼šå­—ç¬¦ä¸²åˆ¤æ–­ã€ç®—æœ¯ã€æ–‡ä»¶æµ‹è¯•\n5. æ§åˆ¶ç»“æ„ï¼šå¾ªç¯ã€case\n6. å‡½æ•°\n7. è„šæœ¬è°ƒç”¨è„šæœ¬ï¼Œcè¯­è¨€è°ƒç”¨è„šæœ¬\n8. awkï¼Œsed\n# ç¯å¢ƒå˜é‡\n\n| ç±»å‹     | è¯­æ³•                       | æ³¨æ„ç‚¹                               |\n| ------ | ------------------------ | --------------------------------- |\n| èµ‹å€¼     | `var=value`              | ä¸èƒ½æœ‰ç©ºæ ¼                             |\n| å¼•ç”¨     | `$var`                   | ç”¨åŒå¼•å·åŒ…è£¹æ˜¯è¯»varçš„å€¼ï¼Œç”¨å•å¼•å·åŒ…è£¹æ˜¯`$var`è¿™4ä¸ªå­—ç¬¦ã€‚ |\n| åˆ é™¤     | unset var                | ä¸è¦åŠ `$`ç¬¦                           |\n| è¾“å…¥     | read `var1` `var2` `...` | æŒ‰é¡ºåºå†™å…¥å˜é‡ï¼Œç±»ä¼¼äºscanfï¼Œä»¥å›è½¦æˆ–è€…ç©ºæ ¼åˆ†éš”        |\n| åˆ—å‡ºæ‰€æœ‰å˜é‡ | set                      |                                   |\n| å…¨å±€åŒ–å˜é‡  | export var               |                                   |\n## ç‰¹æ®Šå˜é‡\n\néƒ½éœ€è¦æ­é…`$`ä½¿ç”¨\n\n| ç‰¹æ®Šå˜é‡    | å®šä¹‰           | æ³¨æ„ç‚¹                              |\n| ------- | ------------ | -------------------------------- |\n| ?       | å‰ä¸€å‘½ä»¤çš„é€€å‡ºçŠ¶æ€    | 0ä»£è¡¨æˆåŠŸã€çœŸï¼›å…¶ä»–é0æ•°ä»£è¡¨å¤±è´¥ã€å‡çš„æŸä¸€çŠ¶æ€         |\n| $       | å½“å‰Shellçš„è¿›ç¨‹ID | echo `$$`æ‰èƒ½è¾“å‡º                    |\n| !       | åå°è¿è¡Œå‘½ä»¤çš„è¿›ç¨‹ID  |                                  |\n| `1 ~ 9` | å½“å‰è„šæœ¬çš„ç¬¬1åˆ°9ä¸ªå‚æ•° |                                  |\n| `_`     | ä¸Šä¸€ä¸ªå‘½ä»¤çš„æœ€åä¸€ä¸ªå‚æ•° | æ¯”å¦‚åœ¨å‘½ä»¤è¡Œæ•²å…¥`ls -a`ï¼Œåˆ™echo `$_`è¾“å‡º`-a` |\n| PS1     | Shellä¸»æç¤ºç¬¦    |                                  |\n| PS2     | Shellæ¬¡æç¤ºç¬¦    |                                  |\n## å­—ç¬¦ä¸²å¤„ç†\n\n1. æ³¨æ„åŒå¼•å·ã€å•å¼•å·çš„åŠŸèƒ½ï¼ŒåŒå¼•å·å¼•èµ·ä¸»è¦æ˜¯ä¸ºäº†æ¶ˆé™¤ç©ºæ ¼çš„å½±å“ï¼Œä¿ç•™è½¬ä¹‰æ•ˆæœï¼›è€Œå•å¼•å·æ˜¯æŠŠæ‰€å¼•çš„å†…å®¹**åŸå°ä¸åŠ¨åœ°**ä¿ç•™ã€‚\n\n```sh\na=\"xcg\"\nstr=\"$a\"\t#æŠŠaçš„å€¼èµ‹ç»™äº†str\necho \"$str\" #å®é™…è¾“å‡º: xcg\n\nstr='$a'\t#æŠŠ\"$a\"è¿™ä¸ª åŸæœ¬çš„å­—ç¬¦ä¸² èµ‹ç»™äº†str\necho \"$str\"\t#å®é™…è¾“å‡º: $a\n```\n\n2. å¦‚æœæƒ³æŠŠæŸä¸€ä¸ªå‘½ä»¤çš„è¿è¡Œç»“æœä½œä¸ºå­—ç¬¦ä¸²è¿”å›ç»™strï¼Œåˆ™æœ‰ä¸¤ç§æ–¹å¼ã€‚\n    1. $( )\n\n```sh\nstr=$(ls)\t#æŠŠå½“å‰ç›®å½•çš„æ–‡ä»¶ä¿¡æ¯å­—ç¬¦ä¸²èµ‹ç»™str\n```\n\n    2. åå¼•å·\n\n```sh\nstr=`ls`\t##æŠŠå½“å‰ç›®å½•çš„æ–‡ä»¶ä¿¡æ¯å­—ç¬¦ä¸²èµ‹ç»™str\n```\n## export\nåœ¨å½“å‰shellå¯ä»¥å†å¯åŠ¨ä¸€ä¸ªshellã€‚å¦‚æœæˆ‘ä»¬åœ¨ä¹‹å‰çš„shellä¸­å®šä¹‰äº†å±€éƒ¨å˜é‡ï¼Œæ¯”å¦‚`var=hello`ï¼Œåœ¨æ–°å¯åŠ¨çš„shellæ˜¯çœ‹ä¸åˆ°çš„ã€‚å¦‚æœè¦æ–°shellçœ‹åˆ°ï¼Œéœ€è¦`export var`ã€‚\nå…¶å®æ–°å¼€çš„è¿™ä¸ªshellæ˜¯åœ¨ä¹‹å‰çš„shellæ–°è¿è¡Œçš„ä¸€ä¸ªç¨‹åºã€‚ä»–ä¿©æ˜¯ä¸åŒçš„è¿›ç¨‹ã€‚åŒç†ï¼Œå¦‚æœæƒ³è®©å…¶ä»–è¿›ç¨‹ä¹Ÿèƒ½çœ‹åˆ°ä¹‹å‰shellçš„ç¯å¢ƒå˜é‡ï¼Œæ­¤æ—¶å°±éœ€è¦exportã€‚\n# ç¬¬ä¸€è¡Œæ³¨é‡Š\nç¬¬ä¸€è¡Œéœ€è¦æ·»åŠ æ³¨é‡Šï¼ŒæŒ‡ç¤ºä½¿ç”¨å“ªä¸ªshellç¨‹åºè¿è¡Œè¯¥è„šæœ¬ã€‚\n```sh\n#! /bin/sh\n\n# ...\n```\n# Cè¯­è¨€ç¼–ç¨‹mainå‡½æ•°çš„å‚æ•° - ç»“åˆç¯å¢ƒå˜é‡\n```c\n// c.c\n#include <stdio.h>\nint main (int ac, char * av[])\n{\n    if (ac > 1)\n    {\n        printf(\"%s\\n\", av[1]);\n    }\n    return 0;\n}\n```\nè¿è¡Œç»“æœï¼š\n```sh\nmrcan@ubuntu:~$ ./c.out var\nvar\n```\nå¦‚ä¸Šï¼Œvaræ˜¯å‘½ä»¤ä¸­çš„å‚æ•°ï¼Œç¨‹åºè¾“å‡ºäº†varè¿™ä¸ªå‚æ•°åã€‚\n```sh\nmrcan@ubuntu:~$ VAR=ThisIsMyVar\nmrcan@ubuntu:~$ ./c.out $VAR\nThisIsMyVar\n```\nå¦‚ä¸Šï¼Œä¹Ÿå¯ä»¥å…ˆå®šä¹‰ç¯å¢ƒå˜é‡VARã€‚ç„¶åå†é€šè¿‡`$VAR`ä¼ åˆ°mainå‡½æ•°ã€‚\n## ç»“åˆé‡å®šå‘ - æŠŠå¦ä¸€ä¸ªç¨‹åºçš„ç»“æœä½œä¸ºå‚æ•°ä¼ åˆ°main\nç»“åˆã€ŠLinux_é‡å®šå‘ã€‹ä¸€æ–‡ä¸­çš„çŸ¥è¯†ã€‚\nå¯ä»¥åˆ©ç”¨â€œå‘½ä»¤ä»£æ¢â€ï¼ˆå½¢å¦‚`$(./a.out)`ï¼‰ã€‚\n```sh\nmrcan@ubuntu:~$ ./a.out \nC Program!  # è¿™æ˜¯a.outçš„æ‰§è¡Œç»“æœ\nmrcan@ubuntu:~$ ./c.out $(./a.out)\nC           # æŠŠa.outçš„è¾“å‡ºä¼ ç»™äº†c.cçš„mainå‡½æ•°\n```\nå¦‚ä¸Šï¼ŒæŠŠ`a.out`çš„è¾“å‡ºç»“æœé€šè¿‡`$(a.out)`ä¼ åˆ°äº†`c.c`çš„mainå‡½æ•°ã€‚\n![](../../images/Linux_Shellç¼–ç¨‹/image-20250716173158651.png)\n\nç³»ç»Ÿä¸­çš„å°ç¨‹åºï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå‘½ä»¤ä»£æ¢çš„å‚æ•°ã€‚\n```sh\npwd # è¾“å‡ºç»“æœ /home/mrcan\nls $(pwd)\n```\nè¾“å‡ºç»“æœï¼š\n```sh\nmrcan@ubuntu:~$ pwd\n/home/mrcan\nmrcan@ubuntu:~$ ls $(pwd)\na.c    b.out  c.out    Documents  Music     Public     test.cpp\na.out  build  c.sh     Downloads  packages  Templates  test_muduo.cpp\nb.c    c.c    Desktop  mprpc      Pictures  test       Videos\n```\n# Operator - æ“ä½œç¬¦\n## Equal Operator\n1. `=` stringã€‚æ³¨æ„ï¼Œ`=`å‰åå¿…é¡»æœ‰ç©ºæ ¼åˆ†éš”ã€‚ä¸ç„¶å°±æˆäº†ç¯å¢ƒå˜é‡èµ‹å€¼äº†ã€‚\n2. `!=` string\n3. `-eq` numeral\n4. `-ne` numeral\n\n```sh\n```\n## Logical Operator\n1. `-a`ï¼šand\n2. `-o`ï¼šor\n3. `!`ï¼šnot\n\n## Relation Operator\n1. `-gt`ï¼šgreater than\n2. `-ge`ï¼šgreater equal\n3. `-lt`ï¼šless than\n4. `-le`ï¼šless equal\n# ifè¯­å¥\n```sh\n#! /bin/sh\nVAR1=\"COMPUTER\"\nif [ $VAR! = \"COM\" ]\nthen\n    echo \"Y\"\nelse\n    echo \"N\"\nfi\n```\næ³¨æ„ç‚¹ï¼š\n1. `=`å‰åæœ‰æ— ç©ºæ ¼çš„è¡Œä¸ºæ˜¯ä¸ä¸€æ ·çš„ã€‚\n2. ä¸­æ‹¬å·çš„å‰åæœ€å¥½ä¹Ÿç•™ä¸Šç©ºæ ¼ï¼Œé¿å…æ— æ³•åˆ†è¾¨ã€‚\n\n```sh\n#! /bin/sh\nVAR1=\"COMPUTER\"\n if [ $VAR1=\"COM\" ]\n# if (test $VAR1=\"COM\")\nthen\n    echo \"Y\"\nelse\n    echo \"N\"\nfi\n```\nä»¥ä¸Šç¨‹åºè¾“å‡ºYï¼Œå³ä½¿VAR1ä¸æ˜¯\"COM\"ã€‚å°±æ˜¯å› ä¸º`=`å‰åæ— ç©ºæ ¼ã€‚\n\n2. ifåè·Ÿçš„`[ ... ]`ç›¸å½“äºï¼š`(test ...)`\n\n# å¾ªç¯\n\n## è¦æ³¨æ„çš„æ˜¯å¯¹è®¡æ•°å˜é‡çš„å¤„ç†\n\næœ‰2ç§æ–¹å¼ï¼š\n\n1. `let`\n\n```sh\ni=1\nlet \"i+=1\"\n```\n\n2. `(( ))`ï¼ŒåŒæ‹¬å·ä¸­æ˜¯æƒ³è¦æ‰§è¡Œçš„å‘½ä»¤/è¡¨è¾¾å¼ï¼Œå¯ä»¥ç”¨$å–è¡¨è¾¾å¼çš„å€¼ã€‚\n\n```sh\ni=1\na=$((i++))\n```\n\n3. åå¼•å·ï¼š\\`expr ...\\`\n\n```sh\ni=1\na=`expr $i \\* 2`\t#*åœ¨è„šæœ¬ä¸­æœ‰å…¶ä»–æ„ä¹‰ï¼Œéœ€è¦åŠ \\è½¬ä¹‰ä¸º'*'ï¼Œåœ¨æ­¤è¡¨ç¤ºä¹˜å·\ni=`expr $i + 1`\t\t#æ­¤æ–¹å¼iè‡ªå¢çš„æ–¹æ³•\n```\n\n\n\n\n## for\n![](../../images/Linux_Shellç¼–ç¨‹/image-20250716194411584.png)\n\nforå¾ªç¯çš„æ¬¡æ•°ç”±inåé¢å€¼çš„æ•°ç›®å†³å®š\n\n```sh\nfor i in 1 2 3\ndo\n\techo i=$i\n\tsleep 1\ndone\n\nfor name in $(ls)\ndo\n\techo \"filename: $name\"\ndone\n```\n### `$@`\n```sh\n#! /bin/sh\nfor x in $@\ndo\n    echo $x\ndone\n```\n\n```sh\n./test.sh 1 2 3 4\n```\nè¾“å‡ºç»“æœ\n```\n1\n2\n3\n4\n```\n## while\n![](../../images/Linux_Shellç¼–ç¨‹/image-20250716203447090.png)\n\n\nåˆ¤æ–­æ¡ä»¶ï¼Œæ»¡è¶³åˆ™å¾ªç¯æ‰§è¡Œã€‚\n\n```sh\n#æ­»å¾ªç¯ç¤ºä¾‹\nwhile [ 1 ]\ndo\n\techo \"run\"\n\tsleep 1\ndone\n#æ­»å¾ªç¯è¾“å‡ºè¾“å…¥çš„å†…å®¹ï¼Œç›´åˆ°è¾“å…¥end\nwhile true\ndo\n\techo \"input\"\n\tread line\n\tif [ \"$line\" = end ]\n\tthen\n\t\tbreak\n\tfi\n\techo \"line=$line\"\ndone\n#è¾“å‡º0-9\nwhile [ \"$i\" -lt 10 ]\ndo\n\techo \"i=$i\"\n\t#let \"i+=1\"\n\t#((++i))\n\ti=`expr $i + 1`\ndone\n```\n\n## until\n![](../../images/Linux_Shellç¼–ç¨‹/image-20250716203453605.png)\n\n\næ¡ä»¶æ²¡æ»¡è¶³æ—¶ï¼Œå¾ªç¯æ‰§è¡Œï¼›ä¸€æ—¦æ¡ä»¶æ»¡è¶³åˆ™é€€å‡ºã€‚\n\n```sh\n#æœ¬åœ°æ‰¾file.txtæ–‡ä»¶ï¼Œéš”ä¸€ç§’æ‰¾ä¸€éï¼Œç›´åˆ°æ‰¾åˆ°ï¼Œé€€å‡ºã€‚\nuntil [ -f file.txt ]\ndo\n\techo \"not find file.txt\"\n\tsleep 1\ndone\necho \"find file.txt\"\n```\n\n# read\n\n readå‘½ä»¤ -n(ä¸æ¢è¡Œ) -p(æç¤ºè¯­å¥) -n(å­—ç¬¦ä¸ªæ•°)-t(ç­‰å¾…æ—¶é—´) -s(ä¸å›æ˜¾)\n# case\n![](../../images/Linux_Shellç¼–ç¨‹/image-20250716203511779.png)\n## ç»“åˆæ­£åˆ™è¡¨è¾¾å¼çš„ç¤ºä¾‹\n\n```sh\nwhile true\ndo\n    echo \"input:\"\n    read line\n    case \"$line\" in\n        yes | Y) \techo \"this is yes\";;\n        no\t| N)\techo \"this is no\";;\n        end)\t\tbreak;;\n        *)\t\t\techo \"$line\";;\n    esac\ndone\n#å¯ä»¥æ­é…æ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨ã€‚\nread line\ncase \"$line\" in\n    [Yy][Ee][Ss] | [Yy])echo \"this is yes\";;\n    [Nn][Oo] | [Nn])\techo \"this is no\";;\n    end)\t\t\t\tbreak;;\n    *)\t\t\t\t\techo \"$line\";;\nesac\n```\n\n# ç»ƒä¹ ï¼šæŠŠå¤šè¡ŒIPåœ°å€è½¬æ¢ä¸º10è¿›åˆ¶\n1. å…ˆç”Ÿæˆnè¡Œï¼ˆ192.168.0.1å¼€å§‹ï¼‰\n2. å¯¹nä¸ªipåœ°å€è¿›è¡Œè½¬æ¢ï¼Œè½¬æ¢åçš„æ•°æ®æ”¾åœ¨`IPint.txt`æ–‡ä»¶å†…ã€‚\n\n## ç”Ÿæˆnè¡ŒIP\n```sh\n#! /bin/sh\n# $1: nums of ip address\nFILE=\"IPs.txt\"\nI=1\nif [ -e $FILE ]\nthen\n    rm $FILE\nfi\n\nwhile [ $I -le $1 ]\ndo\n    echo \"192.168.0.$I\" >> $FILE\n    I=$(expr $I + 1)\ndone\n```\n\n```sh\nmrcan@ubuntu:~$ ./generateIP.sh 10\nmrcan@ubuntu:~$ cat IPs.txt \n192.168.0.1\n192.168.0.2\n192.168.0.3\n192.168.0.4\n192.168.0.5\n192.168.0.6\n192.168.0.7\n192.168.0.8\n192.168.0.9\n192.168.0.10\n```\n## ä»€ä¹ˆæ˜¯IPåœ°å€çš„10è¿›åˆ¶ï¼Ÿ\nä¸æ˜¯ç®€å•çš„æ¯ä¸ªåˆ†æ®µçš„10è¿›åˆ¶ï¼ˆ`192/168/0/1`è¿™äº›ï¼‰\nè€Œæ˜¯è¦ä¸€ä¸ª32ä½æ— ç¬¦å·æ•´å‹æ•°åè¿›åˆ¶è¡¨ç¤ºçš„ï¼šä»32ä¸ª0åˆ°32ä¸ª1çš„è¿™ä¹‹é—´çš„æŸä¸€ä¸ªæ•°ã€‚\nå…¶å®å¯ä»¥ç›´æ¥æŠŠIPåœ°å€çœ‹ä½œ**32ä½2è¿›åˆ¶æ•°**ï¼Œæ¥è½¬æ¢ã€è®¡ç®—ä¸ºå…¶åè¿›åˆ¶å€¼ã€‚\nä½†æ˜¯è¿‡ç¨‹ä¸å¤ªç¾è§‚ã€‚\n![](../../images/Linux_Shellç¼–ç¨‹/image-20250717012003686.png)\nå¦‚ä»¥ä¸Šè¿‡ç¨‹ï¼Œå¤ªå¤æ‚ï¼\n\næœ‰å¯è¯»æ€§æ›´å¥½çš„æ–¹æ³•ï¼šæŠŠIPåœ°å€çœ‹ä½œ**4ä½256è¿›åˆ¶æ•°**ã€‚æ¥è½¬æ¢ã€è®¡ç®—ä¸ºå…¶åè¿›åˆ¶å€¼ã€‚\nIPv4åœ°å€æ¯ä¸€ä¸ªåˆ†æ®µçš„æ•°çš„å¤§å°èŒƒå›´ï¼š0åˆ°255ï¼Œå› æ­¤ç°åœ¨å½¢å¼ä¸‹çš„IPv4æ¯ä½æ•°å±äº256è¿›åˆ¶ï¼Œæ˜¯ç”¨`.`åˆ†å¼€äº†ã€‚\n![](../../images/Linux_Shellç¼–ç¨‹/image-20250717012039244.png)\nå¦‚ä¸Šï¼Œå¾ˆé¦™ï¼\n\né‚£ä¹ˆæˆ‘ä»¬å¹³æ—¶è¯´çš„â€œä¸€ç™¾äºŒåä¸‰â€ï¼Œè¿™ä¸ª3ä½æ•°ï¼Œå°±å¯ä»¥çœ‹ä½œï¼š1.2.3ï¼Œæ¯ä¸€ä¸ªåˆ†æ®µçš„å¤§å°èŒƒå›´æ˜¯0åˆ°9ï¼Œå±äº10è¿›åˆ¶ã€‚æ€ä¹ˆè®¡ç®—å…¶10è¿›åˆ¶æ•°ï¼Ÿpoweræ˜¯10ï¼Œ\n$$\n\\begin{align}\n1 * 10 ^ 2 &= 100 \\\\\n2 * 10 ^ 1 &= 20 \\\\\n3 * 10 ^ 0 &= 3 \\\\\n100 + 20 + 3 &= 123\n\\end{align}\n$$\n\né‚£ä¹ˆï¼Œ4ä½256è¿›åˆ¶ï¼Œè½¬ä¸º10è¿›åˆ¶çš„ç®—æ³•ï¼š\n$$\n\\begin{align}\n192 * 256 ^ 3 &= a\\\\\n168 * 256 ^ 2 &= b\\\\\n0 * 256 ^ 1   &= c\\\\\n1 * 256 ^ 0   &= d\\\\\nresult &= a + b + c + d\n\\end{align}\n$$\n## ç¼–å†™è½¬æ¢è¿›åˆ¶\néœ€è¦åˆ‡åˆ†IPåœ°å€çš„4æ®µã€‚\nç”¨åˆ°äº†cutï¼šè§ã€Š[[Linux_cutå‘½ä»¤]]ã€‹\n\n```sh\n#! /bin/sh\nINPUT=IPs.txt\nOUTPUT=IPint.txt\n\nSUM=0\n\nif [ -e $OUTPUT ]\nthen\n    rm $OUTPUT\nfi\n\ncat $INPUT |           # ç²¾é«“\nwhile read IP\ndo\n    I=1\n    SUM=0\n    while [ $I -le 4 ]\n    do\n        NUM=$(echo $IP | cut -d. -f$I)\n        case $I in\n            1)\n            SUM=$(expr $NUM \\* 256 \\* 256 \\* 256)\n            ;;\n            2)\n            SUM=$(expr $SUM + $NUM \\* 256 \\* 256)\n            ;;\n            3)\n            SUM=$(expr $SUM + $NUM \\* 256)\n            ;;\n            4)\n            SUM=$(expr $SUM + $NUM)\n            ;;\n        esac\n        I=$(expr $I + 1)\n    done\n    echo $IP $SUM >> $OUTPUT\ndone\n```\nè¾“å‡ºç»“æœï¼š\n```\n192.168.0.1 3232235521\n192.168.0.2 3232235522\n192.168.0.3 3232235523\n192.168.0.4 3232235524\n192.168.0.5 3232235525\n192.168.0.6 3232235526\n192.168.0.7 3232235527\n192.168.0.8 3232235528\n192.168.0.9 3232235529\n192.168.0.10 3232235530\n```\n## æ³¨æ„ç‚¹\n1. æ²¡æœ‰`+=`è¿™ä¸ªå½¢å¼\n2. `expr`Â çš„è®¾è®¡ä¸­æ²¡æœ‰åŒ…å«å¹‚è¿ç®—ç¬¦ï¼ˆå¦‚Â `**`Â æˆ–Â `^`ï¼‰ï¼Œå› æ­¤åªèƒ½ç”¨`num \\* 256 \\* 256 \\* 256`è¿™æ ·è¿ä¹˜ã€‚\n3. caseç»“æŸåˆ«å¿˜è®°esac\n## çŸ¥è¯†ç‚¹\nç¨‹åºçš„ç²¾é«“åœ¨äºï¼Œæ€ä¹ˆå¾ªç¯readè¯»å–ä¸€ä¸ªæ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œï¼Œæˆ‘ä»¬ç”¨`cat $INPUT | `ç®¡é“ä¼ å…¥readï¼Œå†ç»™readåŠ ä¸€å±‚å¾ªç¯ï¼Œè¿™æ ·ï¼Œåªè¦ç®¡é“ä¸­è¿˜æœ‰å†…å®¹ï¼Œwhileå¾ªç¯å°±ä¸ä¼šåœæ­¢ã€‚\n\n# å‡½æ•°\n\nä¸‰ä¸ªé—®é¢˜ï¼š1ã€å¦‚ä½•ä¼ å‚çš„é—®é¢˜ï¼›2ã€å‡½æ•°è¿”å›å€¼å¦‚ä½•è·å¾—ï¼›3ã€å¦‚ä½•çœ‹å¾…å‡½æ•°å†…å®šä¹‰çš„å˜é‡\n\n## ç‰¹ç‚¹\n\n1. shellè„šæœ¬ä¸­çš„å‡½æ•°æ²¡æœ‰å£°æ˜ï¼Œéœ€è¦ç›´æ¥å®šä¹‰åœ¨æœ€å‰é¢ã€‚\n2. è°ƒç”¨å‡½æ•°ä¸ç”¨åŠ åœ†æ‹¬å·ï¼Œè€Œæ˜¯åªæœ‰å‡½æ•°å\n\n```sh\nfun()\n{\n\techo \"fun run\"\n}\nfun\n```\n\n## å‚æ•°\n\næ³¨æ„`$#/$1/$2`åœ¨å‡½æ•°ä¸­ã€å‡½æ•°å¤–çš„åŒºåˆ«ï¼šåœ¨å‡½æ•°ä¸­ä»£è¡¨å‡½æ•°çš„å‚æ•°ï¼›è€Œåœ¨å‡½æ•°å¤–ä»£è¡¨æ­¤shellè„šæœ¬çš„å‚æ•°ã€‚\n\n```sh\nfun()\n{\n\techo \"fun run\"\n\techo \"fun: \\$#=$#\"\t# \"$#\"ä»£è¡¨å‚æ•°ä¸ªæ•°\n\techo \"fun: \\$1=$1\"\t# \"$1\"è¡¨ç¤ºè¯¥å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°\n\techo \"fun: \\$2=$2\"\n}\nfun hello 123\n#æ­¤å¤„å°±è¦æ³¨æ„ä¸ä¸Šé¢å‡½æ•°ä¸­$#/$1/$2çš„åŒºåˆ«äº†ï¼Œåœ¨å‡½æ•°ä¸­ä»£è¡¨å‡½æ•°çš„å‚æ•°ï¼›è€Œåœ¨å‡½æ•°å¤–ä»£è¡¨æ­¤shellè„šæœ¬çš„å‚æ•°ã€‚\necho \"my.sh: \\$#=$#\"\necho \"my.sh: \\$1=$1\"\necho \"my.sh: \\$2=$2\"\n\n# åœ¨å¤–éƒ¨æ‰§è¡Œè„šæœ¬æ—¶ï¼š\n# ./my.sh xcg test\n\t# è¾“å‡º:\n        # fun: $#=2\n        # fun: $1=hello\n        # fun: $2=123\n        # my.sh: $#=2\n        # my.sh: $1=xcg\n        # my.sh: $2=test\n```\n\n## è¿”å›å€¼\n\n```sh\nmy_add()\n{\n\tif [ \"$#\" -ne 2 ]\t# -ne : not equal\n\tthen\n\t\techo \"å‚æ•°æœ‰è¯¯\"\n\t\treturn 0\n\tfi\n\tres=`expr $1 + $2`\n\treturn $res\n}\nres=my_add\necho \"$res\"\n# æˆ–è€…å†™ä¸º\n\t# my_add\n\t# echo \"$?\"\n\t\t# \"$?\"ä»£è¡¨ä¸Šä¸€è¡Œè¯­å¥æ‰§è¡Œçš„ç»“æœ(è¿”å›å€¼)ã€‚\n# å¦‚æœæƒ³ä¿å­˜è¿”å›å€¼ï¼Œå¯ä»¥ï¼š\n\t# my_add 123 234\n\t# result=$?\n\t\t# å¦‚æœè¿ç»­å†™ä¸¤è¡Œ\"$?\"ï¼Œåˆ™ç¬¬äºŒè¡Œçš„ç»“æœæ˜¯0ï¼Œå› ä¸º\"$?\"çš„æ‰§è¡Œç»“æœæ˜¯0ï¼Œä»£è¡¨æ‰§è¡ŒæˆåŠŸã€‚\n```\n\n## å˜é‡ç”Ÿå­˜æœŸé—®é¢˜\n\nå‡½æ•°ä¸­çš„å˜é‡å¯èƒ½æ±¡æŸ“åˆ°å‡½æ•°å¤–\n\n```sh\nmy_test()\n{\n\tstr=hello\n\techo \"my_test:str=$str\"\n}\nmy_test\necho \"str=$str\"\n# æ‰“å°ç»“æœ\n\t# my_test:str=hello\n\t# str=hello\n# ç”±æ­¤å¯è§ï¼Œå‡½æ•°ä¸­çš„å˜é‡æ±¡æŸ“åˆ°äº†å‡½æ•°å¤–ã€‚\n```\n\næ­¤é—®é¢˜çš„åŸå› ï¼š\nè„šæœ¬ç¨‹åºçš„æ¦‚å¿µå¹¶ä¸å­˜åœ¨ä½œç”¨åŸŸçš„æ¦‚å¿µã€‚æ‰€ä»¥ï¼Œå‡½æ•°ä¸­å®šä¹‰ã€èµ‹å€¼strè¯­å¥**æ‰§è¡Œ**åï¼Œä¸ç®¡æ˜¯å‡½æ•°ä¸­ï¼Œè¿˜æ˜¯bashè§£é‡Šå™¨ï¼Œä¹Ÿå°±éƒ½å­˜åœ¨strè¿™ä¸ªå˜é‡ã€‚\n\n```sh\nmy_test()\n{\n\tstr=hello\n\techo \"my_test:str=$str\"\n}\ntest2()\n{\n\techo \"test2:str=$str\"\n}\nmy_test\necho \"str=$str\"\ntest2\n# æ‰§è¡Œç»“æœ\n\t# my_test:str=hello\n\t# str=hello\n\t# test2:str=hello\n```\n\n```sh\nmy_test()\n{\n\tstr=hello\n\techo \"my_test:str=$str\"\n}\ntest2()\n{\n\techo \"test2:str=$str\"\n}\n\necho \"str=$str\"\ntest2\nmy_test\n# æ‰§è¡Œç»“æœ\n\t# str=\n\t# test2:str=\n\t# my_test:str=hello\n# åœ¨æ‰§è¡Œmy_testå‰ï¼Œè¿˜æ²¡æœ‰strå˜é‡ç»™å‡ºï¼Œæ‰€ä»¥ï¼Œtest2å’Œå‡½æ•°å¤–çš„stréƒ½æ‰“å°ä¸ºç©º\n```\n\n### è§£å†³å˜é‡æ±¡æŸ“çš„æ–¹æ³•\n\n> 1ã€å¯ä»¥é€šè¿‡unsetåœ¨ç”¨å®Œå˜é‡åï¼Œé”€æ¯ä¹‹ã€‚\n\n```sh\nmy_test()\n{\n\tstr=hello\n\techo \"my_test:str=$str\"\n\tunset str\n}\nmy_test\necho \"str=$str\"\n# æ‰§è¡Œç»“æœ\n\t# my_test:str=hello\n\t# str=\n```\n\n> 2ã€å¯ä»¥åœ¨å˜é‡åå‰åŠ local\n\n```sh\nstr=\"abcdef\"\nmy_test()\n{\n\tlocal str=hello\n\techo \"my_test:str=$str\"\n}\nmy_test\necho \"str=$str\"\n# æ‰§è¡Œç»“æœ\n\t# my_test:str=hello\n\t# str=abcdef\n```\n\n> æ³¨æ„äº‹é¡¹ï¼šunsetå¯¹äºlocalå˜é‡ï¼Œåªä¼šå±€éƒ¨åœ°é”€æ¯è¿™ä¸ªå˜é‡ï¼Œä¸å½±å“å…¨å±€çš„åŒåå˜é‡ã€‚\n\n```sh\n#################### ç¨‹åº1\nstr=\"abcdef\"\nmy_test()\n{\n\tlocal str=hello\n\techo \"my_test:str=$str\"\n\tunset str\n}\nmy_test\necho \"str=$str\"\n# æ‰§è¡Œç»“æœ\n\t# my_test:str=hello\n\t# str=abcdef\n\n#################### ç¨‹åº2\nstr=\"abcdef\"\nmy_test()\n{\n\tstr=hello\n\techo \"my_test:str=$str\"\n\tunset str\n}\nmy_test\necho \"str=$str\"\n# æ‰§è¡Œç»“æœ\n\t# my_test:str=hello\n\t# str=\n```\n\n# è„šæœ¬é—´çš„è°ƒç”¨\n\n```sh\n###################### b.sh\n#!/usr/bin/bash\necho \"b.sh run pid=$$\"\t# \"$$\"ä»£è¡¨æœ¬bashè„šæœ¬çš„pid\n./d.sh\nexit 0\n###################### d.sh\n#!/usr/bin/bash\necho \"d.sh run pid=$$\"\t# \"$$\"ä»£è¡¨æœ¬bashè„šæœ¬çš„pid\nexit 0\n###################### å¤–éƒ¨æ‰§è¡Œ: ./b.sh\n###################### æ‰§è¡Œç»“æœ:\n        # b.sh run pid=5346\n        # d.sh run pid=5347\n```\n\n### è„šæœ¬é—´å˜é‡çš„ä¼ é€’é—®é¢˜\n\n```sh\n###################### b.sh\n#!/usr/bin/bash\necho \"b.sh run pid=$$\"\t# \"$$\"ä»£è¡¨æœ¬bashè„šæœ¬çš„pid\nmystr=hello\necho \"b.sh mystr=$mystr\"\n./d.sh\nexit 0\n###################### d.sh\n#!/usr/bin/bash\necho \"d.sh run pid=$$\"\t# \"$$\"ä»£è¡¨æœ¬bashè„šæœ¬çš„pid\necho \"d.sh mystr=$mystr\"\nexit 0\n###################### å¤–éƒ¨æ‰§è¡Œ: ./b.sh\n###################### æ‰§è¡Œç»“æœ:\n        # b.sh run pid=5368\n        # b.sh mystr=hello\n        # d.sh run pid=5369\n        # d.sh mystr=\n# æ³¨æ„ï¼Œæ­¤æ—¶d.shæ²¡æœ‰æ‰“å°å‡ºæ¥b.shä¸­çš„mystrï¼Œè¯´æ˜ä¸¤ä¸ªè„šæœ¬ç¨‹åºå„è‡ªè¿è¡Œåœ¨ä¸åŒçš„è¿›ç¨‹ç©ºé—´å†…ï¼Œå˜é‡äº’ä¸æ±¡æŸ“ã€‚\n```\n\nä¸ºäº†åœ¨è„šæœ¬é—´å¯ä»¥ä¼ é€’å˜é‡ï¼Œå¯æœ‰ä»¥ä¸‹æ–¹å¼\n\n> 1ã€åœ¨ä¸€ä¸ªshä¸­è°ƒç”¨å¦ä¸€ä¸ªshæ—¶ï¼Œåé¢åŠ å‚æ•°ã€‚ä½†æ˜¯åªæ˜¯èƒ½æ‹¿åˆ°å€¼ï¼Œå˜é‡åå­—ä¸èƒ½é€šç”¨ï¼Œéœ€è¦ç”¨â€œ$1â€æ¥å–å‡ºã€‚\n\n```sh\n###################### b.sh\n#!/usr/bin/bash\necho \"b.sh run pid=$$\"\nmystr=hello\necho \"b.sh mystr=$mystr\"\n./d.sh $mystr\t\t\t#!!! åé¢åŠ å‚æ•°\nexit 0\n###################### d.sh\n#!/usr/bin/bash\necho \"d.sh run pid=$$\"\necho \"d.sh mystr=$1\"\t#!!! éœ€è¦ç”¨â€œ$1â€æ¥å–å‡º\nexit 0\n###################### å¤–éƒ¨æ‰§è¡Œ: ./b.sh\n###################### æ‰§è¡Œç»“æœ:\n        # b.sh run pid=5380\n        # b.sh mystr=hello\n        # d.sh run pid=5381\n        # d.sh mystr=hello\n```\n\n> 2ã€å¦‚æœæƒ³è¦å˜é‡åå­—é€šç”¨ï¼Œå¯ä»¥exportæ”¹å˜mysträ¸ºç¯å¢ƒå˜é‡ï¼Œå› ä¸ºç¯å¢ƒå˜é‡å¯ä»¥è¢«ç»§æ‰¿ï¼Œæ‰€ä»¥è®©å˜é‡åå­—é€šç”¨äº†ã€‚\n\n```sh\n##################### b.sh\n#!/usr/bin/bash\necho \"b.sh run pid=$$\"\nmystr=hello\nexport mystr\t\t\t#exportæ”¹å˜mysträ¸ºç¯å¢ƒå˜é‡\necho \"b.sh mystr=$mystr\"\n./d.sh\nexit 0\n###################### d.sh\n#!/usr/bin/bash\necho \"d.sh run pid=$$\"\necho \"d.sh mystr=$mystr\"\nexit 0\n###################### å¤–éƒ¨æ‰§è¡Œ: ./b.sh\n###################### æ‰§è¡Œç»“æœ:\n        # b.sh run pid=5380\n        # b.sh mystr=hello\n        # d.sh run pid=5381\n        # d.sh mystr=hello\n```\n\n> 3ã€é€šè¿‡sourceã€‚sourceçš„ä½œç”¨æ˜¯åœ¨è°ƒç”¨å¦ä¸€ä¸ªè„šæœ¬æ—¶ï¼Œä¸å¯åŠ¨å¦å¤–çš„shï¼Œè€Œæ˜¯åœ¨è‡ªèº«çš„è§£é‡Šå™¨ä¸­å»è¿è¡Œå¦ä¸€ä¸ªè„šæœ¬çš„å‘½ä»¤ã€‚ç›¸å½“äºå†…è”å±•å¼€äºæ­¤ï¼Œæ‰€ä»¥åŸæ¥çš„å˜é‡å¯ä»¥å¤ç”¨ã€‚ä½†æ˜¯é—®é¢˜çš„éšæ‚£å¾ˆå¤šï¼Œå› ä¸ºè°ƒç”¨çš„è„šæœ¬ä¼šå¯¹åŸæ¥çš„è„šæœ¬é€ å°±çš„ç¯å¢ƒé€ æˆå½±å“ã€‚\n\n```sh\n##################### b.sh\n#!/usr/bin/bash\necho \"b.sh run pid=$$\"\nmystr=hello\necho \"b.sh mystr=$mystr\"\n. ./d.sh\t# å‰é¢çš„â€œ.+ç©ºæ ¼â€ä¸­çš„â€œ.â€å³ä»£è¡¨source\n# source ./d.sh\nexit 0\n###################### d.sh\n#!/usr/bin/bash\necho \"d.sh run pid=$$\"\necho \"d.sh mystr=$mystr\"\nexit 0\n###################### å¤–éƒ¨æ‰§è¡Œ: ./b.sh\n###################### æ‰§è¡Œç»“æœ: !!!å‘ç°pidä¸€æ ·ï¼\n        # b.sh run pid=5448\n        # b.sh mystr=hello\n        # d.sh run pid=5448\n        # d.sh mystr=hello\n```\n\nsourceçš„ä½œç”¨ï¼šæœ‰æ—¶éœ€è¦å¯¹å½“å‰çš„bashè¿›è¡Œç¯å¢ƒå˜é‡çš„åˆå§‹åŒ–ï¼Œå¯ä»¥ç”¨source(. ./xx.sh)æ¥åœ¨æœ¬shç›´æ¥è¿è¡Œæå‰å†™å¥½çš„é…ç½®è„šæœ¬ã€‚\n\n# Cç¨‹åºå’Œè„šæœ¬é—´çš„è°ƒç”¨\n\nè„šæœ¬è°ƒç”¨Cç¨‹åºæ˜¾è€Œæ˜“è§ã€‚\n\næˆ‘ä»¬è®¨è®ºCç¨‹åºè°ƒç”¨è„šæœ¬ã€‚\n\n```sh\n#!/usr/bin/bash\necho \"my.sh pid=$$\"\nmystr=\"hello^_^\"\necho \"mystr=$mystr\"\nexit 0\n\n```\n\n```c\n#include<stdio.h>\n#include<stdlib.h>\n#include<unistd.h>\n#include<string.h>\nint main()\n{\n    printf(\"main pid=%d\\n\",getpid());\n    execl(\"./my.sh\",\"my.sh\",(char*)0);\n    printf(\"execl err\\n\");\n    exit(0);\n}\n// æ‰§è¡Œç»“æœ\n\t// main pid=5607\n\t// my.sh pid=5607\n\t// mystr=hello^_^\n// ä¸ºä»€ä¹ˆpidä¸€æ ·å‘¢ï¼Ÿå› ä¸ºåœ¨mainå‡½æ•°ä¸­execäº†è‡ªèº«ã€‚\n```\n\nè¡¨é¢ä¸Šå¯åŠ¨çš„æ˜¯my.shï¼Œå®é™…ä¸Šå¯åŠ¨çš„æ˜¯/usr/bin/bashã€‚\n\n# ç»ƒä¹ \n\n* ä»é”®ç›˜è¯»å–ä¸€ä¸ªæˆç»©ï¼Œ0~100ä¹‹å¤–çš„ä¸å¯ä»¥ã€‚æŠŠæ•´æ•°å€¼è½¬ä¸ºç­‰çº§Aã€Bã€Cã€Dã€‚\n\n| æˆç»©  | ç­‰çº§ |\n| ----- | ---- |\n| >= 90 | A    |\n| >= 80 | B    |\n| >= 70 | C    |\n| >= 60 | D    |\n| < 60  | E    |\n\n```sh\n#!/usr/bin/bash\n\nwhile [ 1 ]; do\n  printf 'please input your score:'\n  read score\n  if [ $score -ge 0 ] && [ $score -le 100 ]\n  then\n    grade=$(($score/10))\n    #echo $grade\n    printf 'your grade is:'\n    case $grade in\n      9 | 10 ) echo \"A\";;\n      8 ) echo \"B\";;\n      7 ) echo \"C\";;\n      6 ) echo \"D\";;\n      * ) echo \"E\";;\n    esac\n  else\n    echo \"error in your input!\"\n  fi\ndone\n\nexit 0\n```\n\næµ‹è¯•ç»“æœï¼š\n\n![image-20220215130731237](../../images/Linux_Shellç¼–ç¨‹/image-20220215130731237.png)\n\n* ç¬¬ä¸€é¢˜çš„ä¼˜åŒ–\n\n```bash\n#!/usr/bin/bash\nprintf 'è¾“å…¥ä½ çš„æˆç»©ï¼š'\nread score\ncase $score in\n    [0-9] | [1-9][0-9] | 100)\n        grade=$(($score/10))\n        #echo $grade\n        printf \"ä½ çš„æˆç»©æ˜¯$scoreï¼Œç­‰çº§ï¼š\"\n        case $grade in\n            9 | 10 ) echo \"ä¼˜\";;\n            8 ) echo \"è‰¯\";;\n            7 ) echo \"ä¸­\";;\n            6 ) echo \"åŠæ ¼\";;\n            * ) echo \"ä¸åŠæ ¼\";;\n        esac;;\n    *) echo \"error in your input!\";;\nesac\nexit 0\n```\n\n* å¾ªç¯æ¥æ”¶ç”¨æˆ·è¾“å…¥çš„å­¦ç”Ÿæˆç»©ï¼ˆç™¾åˆ†åˆ¶ï¼‰ï¼Œè‹¥æˆç»©å°äº60ï¼Œè¾“å‡ºâ€œä¸åŠæ ¼â€ï¼›è‹¥æˆç»©å¤§äºç­‰äº60ï¼Œè¾“å‡ºâ€œåŠæ ¼â€ï¼ŒæŒ‰Q(q)é”®é€€å‡ºã€‚\n\n```bash\n#!/bin/bash\nwhile true\ndo\n    read -p \"è¾“å…¥æˆç»©ï¼š\" score\n    case $score in\n        [Qq]) exit;;\n        [0-9] | [1-5][0-9]) echo \"ä¸åŠæ ¼\";;\n        100 | [6-9][0-9])   echo \"åŠæ ¼\";;\n        *)  echo \"ä¸åˆæ³•ï¼Œè¯·è¾“å…¥0~100\";;\n    esac\ndone\n```\n\n* å¾ªç¯æ¥æ”¶æŸé—¨è¯¾ç¨‹çš„æˆç»©ï¼Œè®¡ç®—ç”¨æˆ·å·²è¾“å…¥çš„æœ€é«˜åˆ†ã€æœ€ä½åˆ†ã€å¹³å‡åˆ†ï¼ŒæŒ‰P(p)é”®è¾“å‡ºè®¡ç®—ç»“æœï¼ŒæŒ‰Q(q)é”®é€€å‡ºã€‚\n\n```bash\n#!/bin/bash\nmin=100\nmax=0\nsum=0\ncount=0\nwhile true\ndo\n    read -p \"è¾“å…¥åˆ†æ•°ï¼š\" score\n    case $score in\n        [0-9] | [1-9][0-9] | 100)\n            echo \"$score å·²å½•å…¥\"\n            sum=$(($sum+$score))\n            count=$(($count+1))\n            if [ $score -gt $max ]\n            then max=$score\n            fi\n            if [ $score -lt $min ]\n            then min=$score\n            fi;;\n        [Pp])\n            echo \"max = $max\"\n            echo \"min = $min\"\n            echo \"avg = $(($sum/$count))\"\n            continue;;\n        [Qq])   exit;;\n        *)      echo \"$score ä¸åˆæ³•ï¼Œè¯·é‡æ–°è¾“å…¥ã€‚\"\n    esac\ndone\n```\n\n\n\n# æ³¨æ„\n\nä¾‹ï¼šè¾“å…¥ä¸€ä¸ªæ­£æ•´æ•°ï¼Œåˆ¤æ–­å…¶æ˜¯å¦ä¸ºè´¨æ•°ã€‚æ­£ç¡®çš„ç¨‹åºå¦‚ä¸‹ï¼š\n\n```bash\n#!/bin/bash\n\nread -p \"è¯·è¾“å…¥ä¸€ä¸ªæ­£æ•´æ•°ï¼š\" number\n[ $number -eq 1 ] && echo \"$number ä¸æ˜¯è´¨æ•°\" && exit\nfor i in `seq 2 $(($number-1))`\ndo\n    [ $[$number % $i] -eq 0 ] && echo \"$numberä¸æ˜¯è´¨æ•°\" $$ exit\ndone\necho \"$numberæ˜¯è´¨æ•°\" && exit\n# æ­£ç¡®çš„æµ‹è¯•ç»“æœï¼š\n# \tè¾“å…¥ 1\n# \tè¾“å‡º 1ä¸æ˜¯è´¨æ•°\n# æ­£ç¡®çš„æµ‹è¯•ç»“æœï¼š\n# \tè¾“å…¥ 7\n# \tè¾“å‡º 7æ˜¯è´¨æ•°\n```\n\nå…¶ä¸­ï¼Œåˆ¤æ–­è¯­å¥å¦‚[ \\$number -eq 1 ]å¿…é¡»åœ¨é¦–å°¾ä¸­æ‹¬å·ä¹‹é—´æœ‰ç©ºæ ¼ï¼Œä¸ç„¶æ‰¾ä¸åˆ°å‘½ä»¤ã€‚å¦‚ä¸‹æ˜¯é”™è¯¯çš„ã€‚\n\n```bash\nread -p \"è¯·è¾“å…¥ä¸€ä¸ªæ­£æ•´æ•°ï¼š\" number\n[$number -eq 1] && echo \"$number ä¸æ˜¯è´¨æ•°\" && exit\t#é”™è¯¯\nfor i in `seq 2 $(($number-1))`\ndo\n    [$[$number % $i] -eq 0] && echo \"$numberä¸æ˜¯è´¨æ•°\" $$ exit #é”™è¯¯\ndone\necho \"$numberæ˜¯è´¨æ•°\" && exit\n# æµ‹è¯•ï¼š\n# \tè¾“å…¥ 1\n# \tè¾“å‡º ./zhishu.sh: line 4: [1: command not found\n# \t\t 1æ˜¯è´¨æ•°\n# æµ‹è¯•ï¼š\n# \tè¾“å…¥ 7\n# \tè¾“å‡º ./zhishu.sh: line 7: [1: command not found\n#\t\t./zhishu.sh: line 7: [1: command not found\n#\t\t./zhishu.sh: line 7: [3: command not found\n#\t\t./zhishu.sh: line 7: [2: command not found\n#\t\t./zhishu.sh: line 7: [1: command not found\n#\t\t7æ˜¯è´¨æ•°\n```\n\n","categories":["Linux"]},{"title":"ç®—æ³•_é€’å½’_åˆ†æ²»","url":"/ç®—æ³•/ç®—æ³•_é€’å½’_åˆ†æ²»/","content":"# å†…å®¹\n\n# é˜¶ä¹˜(factorial)\n```\né˜¶ä¹˜å¯é€’å½’åœ°å®šä¹‰ä¸º:\nfac(n) = \n\t1;                 å½“n=1æ—¶\n\tfac(n-1)*n;        å½“n>1æ—¶\n```\n\næ­¤å¤„, `fac(n-1)`ä»£è¡¨ä»€ä¹ˆæ„æ€å‘¢? æ˜¯: `1 * 2 * ... * (n-1)`\n\n## ä»£ç \n\néé€’å½’ç‰ˆ\n\n```c\nint factorial(int n)\n{\n    int res = 1;\n    for(int i = 1; i <= n; ++i)\n    {\n        res = res * i;\n    }\n    return res;\n}\n```\n\né€’å½’ç‰ˆ\n\n```c\nint factorial(int n)\n{\n    if(n <= 1)\n        return 1;\n    else\n        return factorial(n - 1) * n;\n}\n```\n\n# æ­»é€’å½’å’Œæ­»å¾ªç¯çš„åŒºåˆ«\n\n## æ­»å¾ªç¯\n\nè‹¥æŠŠä¸Šé¢é˜¶ä¹˜çš„ä»£ç , ç¨åšæ”¹åŠ¨:\n\nforå¾ªç¯ä¸­é—´çš„æ¡ä»¶å»æ‰ - å˜ä¸ºæ­»å¾ªç¯\n\n```c\nint factorial(int n)\n{\n    int res = 1;\n    for(int i = 1;  ; ++i)\n    {\n        res = res * i;\n    }\n    return res;\n}\n```\n\nä½†æ˜¯, æ­»å¾ªç¯é™¤äº†ä¼šè€—è´¹å•æ ¸çš„CPU, ä¸ä¼šå¯¹å†…å­˜ç©ºé—´äº§ç”Ÿä¼¤å®³;\n\n```c\nint main()\n{\n    int sum = fun(4);\n}\n```\n\n## æ­»é€’å½’\n\nè‹¥æŠŠä¸Šé¢é€’å½’ç‰ˆæœ¬é˜¶ä¹˜çš„ä»£ç , ç¨åšæ”¹åŠ¨, æŠŠ`if`åˆ¤æ–­æ¡ä»¶æ”¹ä¸ºæ°¸å‡:\n\n```c\nint factorial(int n)\n{\n    if(false)\n        return 1;\n    else\n        return factorial(n - 1) * n;\n}\n```\n\nåˆ™é€’å½’å°†æ²¡æœ‰ä¸€ä¸ªå‡ºå£;\n\nè€Œä¸”æ›´ä¸¥é‡çš„æ˜¯, ç”±äºæ¯ä¸€æ¬¡çš„é€’å½’è°ƒç”¨éƒ½éœ€è¦å¼€è¾Ÿæ ˆå¸§, æ‰€ä»¥ä¸ä¹…ä¹‹åæ ˆå°†ä¼šæº¢å‡º, ç¨‹åºå´©æºƒ;\n\n## æ€è€ƒ\n\nå°±è¿™ä¸ªç°è±¡, å…¶å®è¯´æ˜äº†èƒŒåçš„ä¸€äº›æ›´é‡è¦çš„æ„ä¹‰, ä¸€èˆ¬, éé€’å½’ç®—æ³•çš„ç©ºé—´å¤æ‚åº¦æœ€ä½å¯ä¸ºO(1), è€Œé€’å½’ç®—æ³•çš„ç©ºé—´å¤æ‚åº¦æœ€ä½ä¸ºO(n), é€’å½’çš„ç‰¹æ€§åŠ¿å¿…é€ æˆé¢å¤–çš„ç©ºé—´;\n\n# éå†æ‰“å°æ•°ç»„\n\nå‡å¦‚æœ‰ä¸€intæ•°ç»„ä¸º`{12,23,34}`, è¦æ±‚æ‰“å°å‡ºæ¥\n\n## éé€’å½’ - èƒ½ä¸èƒ½æŠŠå®ƒæ”¹æˆé€’å½’?\n\n```c++\nvoid Print_Ar(const int * ar, int n)\n{\n    assert(ar != NULL);\n    for(int i = 0; i < n; ++i)\n    {\n        cout << ar[i] << \" \";\n    }\n    cout << endl;\n}//12 23 34\n```\n\n## é€’å½’åˆç‰ˆ - é€†åº\n\n```c++\nvoid Print(const int * ar, int n)\n{\n    if(n > 0)\n    {\n        cout << ar[n-1] << \" \";\n        Print(ar, n-1);\n    }\n}\nvoid Print_Ar_recur(const int * ar, int n)\n{\n    assert(ar != NULL);\n    if(n < 1) return;//the length must > 0\n    Print(ar, n);\n    cout << endl;\n}\nint main()\n{\n    int ar[] = {12, 23, 34};\n    int n = sizeof(ar) / sizeof(ar[0]);\n    Print_Ar_recur(ar, n);\n    return 0;\n}//34 23 12\n```\n\n## é€’å½’2ç‰ˆ - æ­£åº-âœ”\n\nçœ‹åˆ°æ²¡? åªæ˜¯æŠŠ5è¡Œå’Œ6è¡Œçš„ä»£ç è°ƒäº†ä¸ªåº, æ•ˆæœå°±æˆªç„¶ä¸åŒ, è¿™å°±æ˜¯é€’å½’çš„ç¥å¥‡ä¹‹å¤„;\n\nå½“`n > 0`æ—¶, å°†ä¸€ç›´é€’å½’ä¸‹å», ç›´åˆ°nç­‰äº0, ä¹‹å, éšç€é€’å½’æ ˆå¸§çš„å›é€€, å°†ä»0åˆ°`n-1`é€ä¸€æ‰“å°å‡ºæ¥;\n\n```c++\nvoid Print(const int * ar, int n)\n{\n    if(n > 0)\n    {\n        Print(ar, n - 1);\n        cout << ar[n-1] << \" \";\n    }\n}\nvoid Print_Ar_recur(const int * ar, int n)\n{\n    assert(ar != NULL);\n    if(n < 1) return;//the length must > 0\n    Print(ar, n);\n    cout << endl;\n}\nint main()\n{\n    int ar[] = {12, 23, 34};\n    int n = sizeof(ar) / sizeof(ar[0]);\n    Print_Ar_recur(ar, n);\n    return 0;\n}//12 23 34\n```\n\n## æ€»ç»“ - é€’å½’çš„èŒƒå¼\n\né€’å½’çš„é¢˜è§£æœ‰ä¸¤éƒ¨åˆ†ç»„æˆ, å°†ä¼šæŠŠä»£ç åˆ’åˆ†çš„æ¸…æ¸…æ¥šæ¥š;\n\n1. ç¬¬ä¸€ä¸ªå‡½æ•°è¿‡æ»¤æ‰ä¸åˆæ³•çš„å‚æ•°, åŒæ—¶ä½œä¸ºå¼€å§‹è°ƒç”¨é€’å½’çš„è°ƒç”¨è€…;\n2. ç¬¬äºŒä¸ªå‡½æ•°æ‰æ˜¯çœŸæ­£çš„é€’å½’å‡½æ•°;\n\n## æ€»ç»“ - é€’å½’çš„åˆ†æ\n\né€’å½’å‡½æ•°çš„æ‰§è¡Œåˆ†ä¸ºâ€œé€’æ¨â€å’Œâ€œå›å½’â€ä¸¤ä¸ªè¿‡ç¨‹ï¼Œè¿™ä¸¤ä¸ªè¿‡ç¨‹ç”±é€’å½’ç»ˆæ­¢æ¡ä»¶æ§åˆ¶ï¼Œå³é€å±‚é€’æ¨ï¼Œç›´è‡³é€’å½’ç»ˆæ­¢æ¡ä»¶æ»¡è¶³ï¼Œç»ˆæ­¢é€’å½’ï¼Œç„¶åé€å±‚å›å½’ã€‚\n\né€’å½’è°ƒç”¨åŒæ™®é€šçš„å‡½æ•°è°ƒç”¨ä¸€æ ·ï¼Œæ¯å½“è°ƒç”¨å‘ç”Ÿæ—¶ï¼Œå°±è¦**åˆ†é…æ–°çš„æ ˆå¸§**ï¼ˆå½¢å‚æ•°æ®ï¼Œç°åœºä¿æŠ¤ï¼Œå±€éƒ¨å˜é‡ï¼‰, **æ‰€ä»¥, æ¯ä¸ªæ ˆå¸§ä¸­çš„æ•°æ®éƒ½æ˜¯æœ¬å±‚ç‹¬æœ‰çš„!**ï¼›\n\nè€Œä¸æ™®é€šçš„å‡½æ•°è°ƒç”¨ä¸åŒçš„æ˜¯ï¼Œç”±äºé€’æ¨çš„è¿‡ç¨‹æ˜¯ä¸€ä¸ªé€å±‚è°ƒç”¨çš„è¿‡ç¨‹ï¼Œå› æ­¤å­˜åœ¨ä¸€ä¸ªé€å±‚è¿ç»­çš„åˆ†é…æ ˆå¸§è¿‡ç¨‹ï¼Œç›´è‡³é‡åˆ°é€’å½’ç»ˆæ­¢æ¡ä»¶æ—¶ï¼Œæ‰å¼€å§‹å›å½’ï¼Œè¿™æ—¶æ‰é€å±‚é‡Šæ”¾æ ˆå¸§ç©ºé—´ï¼Œè¿”å›åˆ°ä¸Šä¸€å±‚ï¼Œç›´è‡³æœ€åè¿”å›åˆ°ä¸»è°ƒå‡½æ•°ã€‚\n\n## é”™è¯¯ç‰ˆæœ¬1-ä¸è¦ä½¿ç”¨åç½®è‡ªå‡\n\nè¿™ä¸ªæµ…çœ‹çœ‹ä¸å‡ºæ¥, å®é™…ä¸Šæ˜¯ä¸€ä¸ªå¿…æ­»çš„ç»“å±€;\n\nè¿™ä¸ªä¼šå¯¼è‡´**æ ˆæº¢å‡º**;\n\nå› ä¸º, `n--`ä¼šå¯¼è‡´æ¯æ¬¡å‰ä¸€ä¸ªæ ˆå¸§ç»™ä¸‹ä¸€ä¸ªå‡½æ•°ä¼ é€’çš„æ˜¯nåŸæœ¬çš„å€¼, æ‰å»`--`, è¿™æ˜¯åç½®è‡ªå‡çš„è¯­ä¹‰, ç„¶å, å°±ç›¸å½“äºnåŸåœ°ä¸å˜, æ‰€ä»¥ä¸€ç›´åˆ°ä¸äº†æ ˆå¸§å›é€€çš„å‡ºå£;\n\n```c\nvoid Print(const int * br, int n)\n{\n    if(n > 0)\n    {\n        Print(br, n--);\n        cout << br[n - 1] << \" \";\n    }\n}\n```\n\n## é”™è¯¯ç‰ˆæœ¬2-ä¸è¦ä½¿ç”¨å‰ç½®è‡ªå‡\n\nä¼šå¯¼è‡´è¶Šç•Œ, å¹¶ä¸”å‰é¢å¤šæ‰“äº†ä¸€ä¸ª(`br[-1]`), åé¢å°‘æ‰“äº†ä¸€ä¸ª(`br[n-1]`); \n\nå› ä¸ºä»–æŠŠnå‡1å¹¶ä¼ è¿‡å»äº†, å°±ç¼ºå°‘äº†nçš„æƒ…å†µ, å¹¶ä¸”, ç”±äºå‰é¢åšäº†nå€¼çš„åˆ¤æ–­, è€Œåˆåœ¨ifé‡Œé¢æ”¹å€¼, è¿™æ˜¯ä¸å¦¥çš„; å³, æœ€å¥½ä¸è¦åœ¨åˆ¤æ–­nçš„åˆæ³•æ€§åå¯¹nè¿›è¡Œæ”¹åŠ¨, è¿™æ˜¯é€’å½’ç¨‹åºçš„å¿Œè®³; \n\n```c\nvoid Print(const int * br, int n)\n{\n    if(n > 0)\n    {\n        Print(br, --n);\n        cout << br[n - 1] << \" \";\n    }\n}// [?éšæœºå€¼] 12 23 [ç¼º34]\n```\n\nä½†æ˜¯è¿™ç§æƒ…å†µ, ä¹Ÿå¯ä»¥æŠŠç¨‹åºæ”¹æ­£ç¡®, å³: æŠŠæ‰“å°`br[n-1]`æ”¹ä¸º`br[n]`\n```c\nvoid Print(const int * br, int n)\n{\n    if(n > 0)\n    {\n        Print(br, --n);\n        cout << br[n] << \" \";\n    }\n}// 12 23 34\n```\n\nä½†è¿˜æ˜¯ä¸å»ºè®®åœ¨é€’å½’ç¨‹åºçš„å˜é‡ä¸Šè¿›è¡Œå‰ç½®è‡ªå‡;\n\n## é”™è¯¯ç‰ˆæœ¬3-å¼•ç”¨\n\n```c++\nvoid Print(const int * br, int & n)\n{\n    if(n > 0)\n    {\n        Print(br, --n);\n        cout << br[n] << \" \";\n    }\n}\nvoid Print_Ar_recur(const int * br, int n)\n{\n    assert(br != NULL);\n    if(n < 1)return;//the length must > 0\n    Print(br, n);\n    cout << endl;\n}\n//12 12 12\n```\n\nå› ä¸ºæ ˆå¸§é€’è¿›æ—¶, æ‰€æœ‰æ ˆå¸§ä¸­çš„néƒ½ä¸€ç›´åœ¨åŠ¨æ€æ”¹å˜, æœ€ç»ˆæ‰€æœ‰æ ˆå¸§çš„nå€¼éƒ½å˜ä¸º0äº†, å³**æ‰€æœ‰çš„néƒ½ä¿æŒä¸€è‡´äº†**,  å› æ­¤, æ‰“å°çš„éƒ½æ˜¯`br[0]`, è¿™æ˜¯å¼•ç”¨çš„å½±å“;\n\nå°½é‡åœ¨é€’å½’ä¸­å°‘ç”¨å¼•ç”¨ï¼Œåªæœ‰åœ¨çº¿ç´¢äºŒå‰æ ‘æ‰ä¼šç”¨åˆ°\n\n# FindPos\n\nä¼ å…¥æ•°æ®æŒ‡é’ˆ, é•¿åº¦, å’Œè¦æ‰¾åˆ°valå€¼, è¿”å›ä¸‹æ ‡\n\n## éé€’å½’ç‰ˆ\n\n```c++\nint FindPos(const int * br, int n, int val)\n{\n    if(br == NULL || n < 1)return -1;\n    int pos = n - 1;\n    while(pos >= 0 && br[pos]!=val)\n    {\n        --pos;\n    }\n    return pos;\n}\nint main()\n{\n    int ar[] = {12,56,34,78};\n    int n = sizeof(ar)/sizeof(ar[0]);\n    int val = 78;\n    int pos = FindPos(ar,n,val);\n    cout << pos << endl;\n}\n```\n\n## é€’å½’ç‰ˆæœ¬-è‡ªå·±å†™çš„åˆç‰ˆ\n\n```c++\nint Find(const int * br, int n, int val)\n{\n    if(n > 0)\n    {\n        if(br[n - 1] == val) return n - 1;\n        return Find(br, n - 1, val);\n    }\n}\nint FindPos(const int * br, int n, int val)\n{\n    if(br == NULL || n < 1) return -1;\n    return Find(br, n, val);\n}\n```\n\né”™è¯¯ç‚¹ï¼šå¦‚æœæ²¡æœ‰æ‰¾åˆ°valï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚å³, å¦‚æœèµ°åˆ°`n==-1`, åˆ™æ²¡æœ‰returnçš„å€¼, å¯è§†ä¸ºè·å–åˆ°äº†ä¸€ä¸ªéšæœºå€¼\n\n## é€’å½’ç‰ˆæœ¬-æ­£ç¡®ç‰ˆæœ¬\n\n```c++\n//æ¨ç‰ˆ\nint Find(const int * br, int n, int val)\n{\n    if(n <= 0 || br[n-1] == val)\n    {\n        return n - 1;\n    }\n    else\n    {\n        return Find(br, n - 1, val);\n    }\n}\nint FindPos(const int * br, int n, int val)\n{\n    if(br==NULL || n<1)return -1;\n    return Find(br,n,val);\n}\n```\n\n## é€’å½’ç‰ˆæœ¬-æ ‡å‡†ç‰ˆæœ¬\n\n```c\n//åˆç‰ˆå’Œæ¨ç‰ˆç»“åˆã€æ”¹è¿›\n//æ¨ç‰ˆ\nint Find(const int * br, int n, int val)\n{\n    if(n > 0)\n    {\n        if(br[n-1] == val) return n - 1;\n        else return Find(br, n - 1, val);\n    }\n    return -1;\n}\nint FindPos(const int * br, int n, int val)\n{\n    if(br==NULL || n < 1)return -1;\n    return Find(br, n, val);\n}\n```\n\n# æ’åº\n\nå¿«æ’ã€å½’å¹¶ã€å †æ’\n\n## é—®é¢˜\n\n1. æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ\n2. ç©ºé—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ\n3. æ˜¯å¦ç¨³å®šï¼Ÿæ€æ ·å¯ä»¥ç¨³å®šï¼Ÿä»€ä¹ˆæ—¶å€™éœ€è¦ç¨³å®šï¼Œä»€ä¹ˆæ—¶å€™ä¸éœ€è¦ç¨³å®šï¼Ÿ\n4. ä»€ä¹ˆæƒ…å†µä¸‹æ€§èƒ½ä¼šé€€åŒ–ï¼Ÿ\n5. ä¸‰ä¸ªæ’åºçš„é€‚ç”¨åœºæ™¯ï¼Ÿ\n6. å¦‚æœä½ çš„æ’åºçš„é€’å½’çš„ï¼Œæ€ä¹ˆæ”¹ä¸ºéé€’å½’ï¼Ÿ\n\n## å¿«æ’\n\n1. ä¸ºä»€ä¹ˆæ•°æ®æœ‰åºçš„æ—¶å€™, å¿«æ’æ—¶é—´å¤æ‚åº¦ä¸º$O(n^2)$?\n   1. è¿™ä¸ªä»…é™äºæ¯æ¬¡åªä»æœ€è¾¹ç¼˜æ•°æ®ä½œä¸ºåˆ’åˆ†, æ‰å‡ºç°è¿™ç§æƒ…å†µ\n   2. æ¯æ¬¡åˆ’åˆ†æ—¶, ç›¸å½“äºåªåˆ’åˆ†å‡ºäº†ä¸€ä¸ªæ•°æ®å’Œå‰©ä½™çš„æ•°æ®, è§„æ¨¡å¹¶æ²¡æœ‰æœ‰æ•ˆçš„å‡å°, ä»éœ€è¦åˆ’åˆ†$n$æ¬¡; è€Œä¸æ˜¯åƒæœ€å¥½çš„æƒ…å†µ - æ¯æ¬¡æ­£å¥½æŠŠæ•°æ®åˆ’åˆ†åœ¨ä¸­é—´, è§„æ¨¡å‡å°, æ­¤æ—¶åªéœ€åˆ’åˆ†$\\log_2n$æ¬¡; \n   3. æ”¾åœ¨äºŒå‰æ ‘ä¸Šçš„å½¢è±¡å›¾ç¤ºå°±æ˜¯: æœ€å·®æƒ…å†µä¸‹çš„å¿«æ’å°±æ˜¯ä¸€ä¸ªæç«¯ä¸å¹³è¡¡çš„äºŒå‰æ ‘, æœ€å¥½æƒ…å†µä¸‹çš„å¿«æ’å°±æ˜¯ä¸€ä¸ªå¾ˆå¹³è¡¡çš„äºŒå‰æ ‘;\n\n# å¿«æ’\n\n## åˆ’åˆ†å‡½æ•°\n\n```c++\nint Partition(int *ar, int left, int right)\n{\n    int tmp = ar[left];\n    while(left < right)\n    {\n        while(left < right && ar[right] > tmp)\n        {\n            --right;\n        }\n        if(left < right) ar[left] = ar[right];\n        while(left < right && ar[right] <= tmp)\n        {\n            ++left;\n        }\n        if(left < right) ar[right] = ar[left];\n    }\n    ar[left] = tmp;\t//æœ€å, leftæˆä¸ºä¸­é—´ä½ç½®\n    return left;\n}\n```\n\n## æ€è€ƒ - ä¸ºä»€ä¹ˆä¸€ç›´è¦å¼ºè°ƒ`left < right`?\n\nå› ä¸º, å¦‚æœä¸åŠ è¿™ç§æ¡ä»¶çš„è¯, leftæˆ–rightå¯èƒ½å°±ä¼šä¸€ç›´è´ªå©ªåœ°, ä¸ç€è¾¹é™…åœ°èµ°ä¸‹å», **æœ€ç»ˆleftå’Œrightæœ‰å¯èƒ½é”™ä½**!\n\nå¦‚æœäº§ç”Ÿäº†é”™ä½, leftçš„rightä¸‹æ ‡çš„å€¼ç›¸äº’èµ‹å€¼å°†æ²¡æœ‰æ„ä¹‰;\n\nåä¹‹, å¦‚æœå¾ˆå¥½åœ°æ§åˆ¶äº†leftå’Œrightçš„ä½ç½®, æœ€ç»ˆé€€å‡ºæ•´ä¸ªwhileå¾ªç¯å, leftå’Œrightçš„ä½ç½®ä¸€å®šæŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªä½ç½®; å³, æœ€åä¸¤å¥çš„`ar[left] = tmp`å’Œ`return left`åŒæ ·å¯ä»¥æ¢ä¸º`ar[right] = tmp`å’Œ`return left`!\n\n## é€’å½’å‡½æ•°\n\n```c\nvoid PassQuick(int *ar, int left, int right)\n{\n    if(left < right)\t//å¦‚æœleft == right ç›¸å½“äºåªæœ‰ä¸€ä¸ªå…ƒç´ , ä¸éœ€æ’åº\n    {\n        int pos = Partition(ar, left, right);//ä¸Šä¸€ä¸ªåˆ’åˆ†å‡ºæ¥çš„ä¸‹æ ‡\n        \n        PassQuick(ar, left, pos - 1);       //å¯¹left ~ pos-1å†åˆ’åˆ†\n        PassQuick(ar, pos + 1, right);      //å¯¹pos+1 ~ rightå†åˆ’åˆ†\n    }\n}\nvoid QuickSort(int * ar, int n)\n{\n    if(ar == NULL || n < 2)return;\n    PassQuick(ar, 0, n-1);\n}\n```\n\n## æµ‹è¯•\n\n```c\nvoid Print_Ar(const int * ar, int n)\n{\n    if(ar == NULL || n < 1)return;\n    for(int i = 0; i < n; ++i)\n    {\n        cout << ar[i] << \" \";\n    }\n    cout << endl;\n}\nint main()\n{\n    int ar[] = {56, 12, 78, 90, 34, 23, 100, 56, 45, 67, 89};\n    int n = sizeof(ar) / sizeof(ar[0]);\n    Print_Ar(ar, n);\n    QuickSort(ar, n);\n    Print_Ar(ar, n);\n}\n```\n\nåŒæ—¶, ä¹Ÿå¯ä»¥åœ¨`PassQuick`å‡½æ•°ä¸­`Partition`è¯­å¥çš„ä¸‹ä¸€è¡ŒåŠ ä¸ª`Print_Ar(ar, 11)`; è¿™æ ·å°±èƒ½åœ¨æ¯æ¬¡åˆ’åˆ†å®Œæ¯•ä¹‹å, æ¸…æ¥šåœ°çœ‹åˆ°æ•°ç»„çš„çŠ¶æ€;\n\n![image-20220616101832798](../../images/é€’å½’&åˆ†æ²»/image-20220616101832798.png)\n\n## éé€’å½’ - ä½¿ç”¨STLçš„queue\n\n```cpp\nvoid QuickSort(int * ar, int n)\n{\n    if(ar == NULL || n < 2) return;\n    queue<int> qu;\n    qu.push(0);\n    qu.push(n - 1);\n    while(!qu.empty())\n    {\n        int left = qu.front(); qu.pop();\n        int right = qu.front(); qu.pop();\n        \n        int pos = Partition(ar, left, right);\n        if(left < pos - 1)\n        {\n            qu.push(left);\n            qu.push(pos - 1);\n        }\n        if(pos + 1 < right)\n        {\n            qu.push(pos + 1);\n            qu.push(right);\n        }\n    }\n}\n```\n\n### ä½¿ç”¨å¯¹å„¿ - pair\n\n```cpp\nvoid QuickSort(int * ar, int n)\n{\n    if(ar == NULL || n < 2) return;\n    queue<std::pair<int, int>> qu;\n    qu.push(std::pair<int, int>(0, n-1));\n    while(!qu.empty())\n    {\n        std::pair<int, int> record = qu.front(); qu.pop();\n        int pos = Partition(ar, record.first, record.second);\n        if(record.first < pos - 1)\n        {\n            qu.push(std::pair<int, int>(record.first, pos-1));\n        }\n        if(pos + 1 < record.second)\n        {\n            qu.push(std::pair<int, int>(pos+1, record.second));\n        }\n    }\n}\n```\n\nå¯ä»¥ä½¿ç”¨åˆ«åä½¿ç¨‹åºç®€åŒ– - `using idxPair = std::pair<int, int>`\n\n```cpp\nvoid QuickSort(int * ar, int n)\n{\n    if(ar == NULL || n < 2) return;\n    using idxPair = std::pair<int, int>;\n    \n    queue<idxPair> qu;\n    qu.push(idxPair(0, n-1));\n    while(!qu.empty())\n    {\n        idxPair record = qu.front(); qu.pop();\n        int pos = Partition(ar, record.first, record.second);\n        if(record.first < pos - 1)\n        {\n            qu.push(idxPair(record.first, pos-1));\n        }\n        if(pos + 1 < record.second)\n        {\n            qu.push(idxPair(pos+1, record.second));\n        }\n    }\n}\n```\n\n## åˆ’åˆ†å‡½æ•° - å•å‘åˆ’åˆ† - ç‰¹åˆ«é€‚äºå•é“¾è¡¨\n\nè¯¦è§ \"å¿«é€Ÿæ’åº\" ä¸€æ–‡;\n\n# å…¨æ’åˆ—ã€å­é›†æ ‘\n\n## å…¨æ’åˆ—\n\n```c++\nvoid Perm(int * ar, int i, int m)\n{\n    if(i == m)\n    {\n        for(int j = 0;j <= m;++j)\n        {\n            cout << ar[j] << \" \";\n        }\n        cout << endl;\n    }\n    else\n    {\n        for(int j = i;j <= m;++j)\n        {\n            std::swap(ar[i],ar[j]);\n            Perm(ar,i+1,m);\n            std::swap(ar[i],ar[j]);\n        }\n    }\n}\nint main()\n{\n    int ar[] = {1,2,3};\n    int n = sizeof(ar)/sizeof(ar[0]);\n    Perm(ar, 0, n-1);\n}\n/*\n1 2 3\n1 3 2\n2 1 3\n2 3 1\n3 2 1\n3 1 2\n*/\n```\n\n![å…¨æ’åˆ—](../../images/é€’å½’&åˆ†æ²»/å…¨æ’åˆ—.png)\n\n## å­é›†æ ‘\n\n```c++\nvoid fun(int i, int n)\n{\n    if(i >= n)return;\n    else\n    {\n        fun(i+1, n);\n        fun(i+1, n);\n    }\n}\n\n\nvoid Print(int *ar, int * br, int i, int n)\n{\n    if(i >= n)\n    {\n        for(int j = 0;j < n;++j)\n        {\n            if(br[j] == 1)\n            {\n                cout << ar[j] << \" \";\n            }\n            cout << endl;\n        }\n    }\n    else\n    {\n        br[i] = 1;\n        Print(ar, br, i+1, n);\n        br[i] = 0;\n        Print(ar, br, i+1, n);\n    }\n}\nint main()\n{\n    int ar[] = {1,2,3};\n    int br[] = {0,0,0};\n    Print(ar, br, 0, 3);\n    return 0;\n}\n/*\n1 2 3\n1 2\n1 3\n1\n2 3\n2\n3\n*/\n```\n\n","categories":["ç®—æ³•","åˆ†æ²»ç­–ç•¥"]},{"title":"Cpp_å‹å…ƒ","url":"/Cpp/Cpp_å‹å…ƒ/","content":"# ç‰¹ç‚¹\n1. ä¸å…·æœ‰è‡ªåæ€§\n2. ä¸å…·æœ‰ä¼ é€’æ€§\n3. ä¸å…·æœ‰ç»§æ‰¿æ€§\n# ä¸‰ç§å½¢å¼\n1. å¤–éƒ¨å‡½æ•°å‹å…ƒ\n2. æˆå‘˜å‡½æ•°å‹å…ƒ\n3. ç±»å‹å…ƒ\n## å¤–éƒ¨å‡½æ•°å‹å…ƒ\n\n## æˆå‘˜å‡½æ•°å‹å…ƒ\n\n```c++\nclass Object\n{\nprivate:\n    int value;\npublic:\n    Object(int x):value(x)\n    {\n        \n    }\n};\nclass Base\n{\nprivate:\n    int sum;\npublic:\n    Base(int x = 0):sum(x)\n    {\n        \n    }\n    void fun(Object& obj)\n    {\n        obj.value = obj.value + sum;//error\n    }\n};\n```\n\n```c++\nclass Object;//åœ¨Baseå‰è¦å£°æ˜\nclass Base\n{\nprivate:\n    int sum;\npublic:\n    Base(int x = 0):sum(x)\n    {\n        \n    }\n    void fun(Object& obj);\n};\nclass Object\n{\nprivate:\n    int value;\npublic:\n    Object(int x):value(x)\n    {\n        \n    }\n    friend\n};\nvoid Base::fun(Object& obj)\n{\n    obj.value = obj.value + sum;//error\n}\nint main()\n{\n    Base base(10);\n    Object obja(20);\n    base.fun(obja);\n    return 0;\n}\n```\n\n\n\n","categories":["Cpp"]},{"title":"ç»ƒä¹ _Cpp_20220107","url":"/Cpp/ç»ƒä¹ _Cpp_20220107/","content":"# é¢˜ç›®\n\n1. æ€»ç»“const ä¸æŒ‡é’ˆçš„å…³ç³»\n2. æ€»ç»“const ä¸å¼•ç”¨çš„å…³ç³»\n3. æ€»ç»“thisæŒ‡é’ˆ\n4. è®¾è®¡çŸ©å½¢ç±»\n\n   ```c++\n   //leftï¼šæŒ‡å®šçŸ©å½¢å·¦ä¸Šè§’çš„é€»è¾‘Xåæ ‡ã€‚\n   //topï¼šæŒ‡å®šçŸ©å½¢å·¦ä¸Šè§’çš„é€»è¾‘Yåæ ‡ã€‚\n   //rightï¼šæŒ‡å®šçŸ©å½¢å³ä¸‹è§’çš„é€»è¾‘Xåæ ‡ã€‚\n   //bottomï¼šæŒ‡å®šçŸ©å½¢å³ä¸‹è§’çš„é€»è¾‘Yåæ ‡ã€‚\n   class Rectangle \n   {\n   private:\n       int left, top, right, bottom;\n   public:\n       //å®ç°é»˜è®¤æ„é€ å‡½æ•°å’Œå¸¦å‚çš„æ„é€ å‡½æ•°\n       //å®ç°Setå‡½æ•°\n       SetLeft;\n       SetTop;\n       SetRight;\n       SetBottom;\n       // å®ç°Getå‡½æ•°\n       GetLeft;\n       GetTop;\n       GetRight;\n       SetBottom;  \n       void Show() const \n       {\n           cout<<\"left-top point is (\"<<left<<\",\"<<top<<:\")\"<<endl;\n           cout<<\"right-bottom point is (\"<<right<<\",\"<<bottom<<\")\"<<endl;\n       }\n   };\n   ```\n\n5. å®ç°åŒå‘å‡½æ•°\n\n   ```c++\n   class Object\n   {\n   private:\n       int value;\n   public:\n       Object(int x = 0):value(x) {}\n       ~Object() {}\n       void SetValue(int x) {value = x;}\n       int GetValue() {return value;}\n       // ä½¿ç”¨ä¸€ä¸ªå‡½æ•°å®ç° SetValue å’Œ GetValue() å‡½æ•°çš„åŠŸèƒ½\n   };\n   ```\n\n6. å®ç°Stack\n\n   ```c++\n   #define SEQ_INIT_SIZE 10\n   #define SEQ_INC_SIZE 2\n   class SeqStack\n   {\n   private:\n       int *base;\n       int *pos;\n       int maxsize;\n   public:\n       SeqStack(int sz = SEQ_INIT_SIZE):maxsize(sz>SEQ_INIT_SIZE? sz:SEQ_INIT_SIZE)\n       {\n           base = pos = (int*)malloc(sizeof(int)*maxsize);\n           if(NULL == base) exit(1);    \n       }\n       //å®ç°å‡½æ•°æœ‰ï¼š\n       ~SeqStack; // ææ„å‡½æ•°\n       Get_Size; // è¿”å›æ•°æ®çš„ä¸ªæ•°\n       Get_Capacity; // è¿”å›å®¹é‡\n       Is_Empty; // åˆ¤ç©º\n       Is_Full; // åˆ¤æ»¡\n       Push;   // å…¥æ ˆ\n       Pop;   // å‡ºæ ˆ\n       Top;   // å–æ ˆé¡¶æ•°æ® ï¼Œä½†ä¸å‡ºæ ˆ   \n   };\n   ```\n\n7. STL string - [std::basic_string - cppreference.com](https://zh.cppreference.com/w/cpp/string/basic_string)\n   1. é¢„ä¹  STLä¸­çš„stringç±»å‹ï¼›\n   2. ç†Ÿç»ƒæŒæ¡stringç±»å‹ä¸­çš„æ–¹æ³•ã€‚","categories":["Cpp","ç»ƒä¹ "]},{"title":"Cpp_åå­—ç²‰ç¢æŠ€æœ¯","url":"/Cpp/Cpp_åå­—ç²‰ç¢æŠ€æœ¯/","content":"\n# ä»¥å‡½æ•°çš„é‡è½½å¼•å‡º\n\nä¼—æ‰€å‘¨çŸ¥ï¼ŒCä¸­å‡½æ•°ä¸å¯ä»¥é‡è½½è€ŒC++ä¸­å¯ä»¥ã€‚\n\nå‡½æ•°çš„é‡è½½æŒ‡ï¼šå‡½æ•°çš„é‡è½½å°±è¦çœ‹å‡†å‡½æ•°çš„åŸå‹ï¼šåŒ…æ‹¬å‡½æ•°è¿”å›ç±»å‹ã€å‡½æ•°åã€å½¢å‚åˆ—è¡¨ï¼ˆå…¶ä¸­å½¢å‚åå¯çœç•¥ï¼‰ï¼Œä¸”ä¸éœ€è¦å‡½æ•°ä½“ã€‚\n\nä¾‹ï¼š\n\n```c++\n\n```\n\n# 2","categories":["Cpp"]},{"title":"mdè¯­æ³•ç§¯ç´¯","url":"/ä¸€äº›å·¥å…·çš„ä½¿ç”¨/mdè¯­æ³•ç§¯ç´¯/","content":"# å†…å®¹\n\n1. latexè¯­æ³•\n2. mdè¯­æ³•\n\n# latexè¯­æ³•\n\n## ç¬¦å·\n\n### è¿ç®—ç¬¦\n\n| å«ä¹‰                        | è¯­æ³•  | æ•ˆæœ  |\n| --------------------------- | ----- | ----- |\n| å¤§äºç­‰äº(greater equal, ge) | `\\ge` | $\\ge$ |\n| å°äºç­‰äº(less equal, le)    | `\\le` | $\\le$ |\n| ä¸ç­‰äº(not equal, ne)       | `\\ne` | $\\ne$ |\n\n| å«ä¹‰            | è¯­æ³•                | æ•ˆæœ                |\n| --------------- | ------------------- | ------------------- |\n| å‘ä¸Šå–æ•´(ceil)  | `\\lceil x \\rceil`   | $\\lceil x \\rceil$   |\n| å‘ä¸‹å–æ•´(floor) | `\\lfloor x \\rfloor` | $\\lfloor x \\rfloor$ |\n\n### ç®­å¤´\n\næ›´å¤šç®­å¤´å‚è€ƒï¼šhttps://www.sascha-frank.com/Arrow/latex-arrows.html\n\n| å«ä¹‰   | è¯­æ³•                                                       | æ•ˆæœ                                                       |\n| ------ | ---------------------------------------------------------- | ---------------------------------------------------------- |\n| ç­‰æ•ˆäº | `\\Leftrightarrow`ã€`\\leftrightarrow`ã€`\\rightleftharpoons` | $\\Leftrightarrow$ã€$\\leftrightarrow$ã€$\\rightleftharpoons$ |\n| å¯æ¨å‡º | ` \\Rightarrow`ã€`\\rightarrow`ã€`\\longrightarrow`           | $ \\Rightarrow$ã€$\\rightarrow$ã€$\\longrightarrow$           |\n\n### æ³¢æµªçº¿\n\nç”±äºlatexä¸­`~`ç¬¦å·æœ‰ç‰¹æ®Šç”¨é€”ï¼ˆå¼ºåˆ¶ç©ºæ ¼ï¼‰ï¼Œ å› æ­¤éœ€è¦ç”¨å…¶ä»–æ–¹å¼æ‰èƒ½æ‰“å‡ºã€‚\n\næ–¹å¼1ï¼šä¸€èˆ¬æ–‡å­—ç¯å¢ƒä¸‹ï¼Œ`\\textasciitilde`ã€‚æ•ˆæœï¼š$\\textasciitilde$\n\næ–¹å¼2ï¼šå…¬å¼ç¯å¢ƒä¸‹ï¼Œ`\\sim`ã€‚æ•ˆæœï¼š$\\sim$\n\nåŒºåˆ«ï¼šç”¨å…¬å¼ç¯å¢ƒä¸‹æ‰“å‡ºï¼Œæ³¢æµªçº¿ä¼šå¤§ä¸€äº›ã€‚\n\n## å¯¹æ•°\n\n1. `\\log_2 ...` => $\\log_2(n+1)$\n2. `\\ln ...` => $\\ln(n+1)$\n3. `\\lg ...` => $\\lg(n+1)$\n\n## å¤šè¡Œå…¬å¼\n\n### å·¦å¯¹é½\n\n```\nè¯æ˜ï¼šè®¾å®Œå…¨äºŒå‰æ ‘çš„é«˜åº¦ä¸º$h$ï¼Œåˆ™æœ‰\n$$\n\\begin{flalign}\n&~~~~~~2^h-1<n\\le2^{h+1}-1\\\\\n&\\Leftrightarrow 2^h<n+1\\le2^{h+1}\\\\\nå–å¯¹æ•°&\\Leftrightarrow h<\\log_2(n+1)\\le h+1&\n\\end{flalign}\n$$\n```\n\n#### è¦ç‚¹\n\n1. å¼€å¤´ç‹¬è¡Œï¼Œ`\\begin{flalign}`ï¼›ç»“å°¾ç‹¬è¡Œï¼Œ`\\end{flalign}`\n2. **å…¬å¼æ¢è¡Œç¬¦ï¼š`\\\\`**\n\n#### å·¦å¯¹é½æ•ˆæœ\n\nè¯æ˜ï¼šè®¾å®Œå…¨äºŒå‰æ ‘çš„é«˜åº¦ä¸º$h$ï¼Œåˆ™æœ‰\n$$\n\\begin{flalign}\n&~~~~~~2^h-1<n\\le2^{h+1}-1\\\\\n&\\Leftrightarrow 2^h<n+1\\le2^{h+1}\\\\\nå–å¯¹æ•°&\\Leftrightarrow h<\\log_2(n+1)\\le h+1&\n\\end{flalign}\n$$","categories":["ä¸€äº›å·¥å…·çš„ä½¿ç”¨"]},{"title":"ç”Ÿäº§è€…æ¶ˆè´¹è€…","url":"/å¤šçº¿ç¨‹/ç”Ÿäº§è€…æ¶ˆè´¹è€…/","content":"# ç®€å•çš„æ¨¡å‹ - äº§1æ¶ˆ1\nåŸºäºäº’æ–¥é‡ã€æ¡ä»¶å˜é‡ä»¥åŠå…¨å±€æ ‡å¿—ã€‚\n\n```cpp\n#include<iostream>\n#include<thread>\n#include<mutex>\n#include<condition_variable>\n#include<semaphore.h>\nusing namespace std;\nmutex mtx;\ncondition_variable cv;\nint number = 0;\nbool full = false;\n\nvoid produce()\n{\n    unique_lock<mutex> locker(mtx);\n    for(int i = 0; i < 10; ++i)\n    {\n        while(full)\n        {\n            cv.wait(locker);\n        }\n        number = i;\n        full = true;\n        cout << this_thread::get_id() << \"produce: \" << number << endl;\n        cv.notify_all();\n    }\n}\nvoid consume()\n{\n    unique_lock<mutex> locker(mtx);\n    for(int i = 0; i < 10; ++i)\n    {\n        while(!full)\n        {\n            cv.wait(locker);\n        }\n        cout << this_thread::get_id() << \"consume: \" << number << endl;\n        full = false;\n        cv.notify_all();\n    }\n}\nint main()\n{\n    thread producer1(produce);\n    thread producer2(produce);\n    thread producer3(produce);\n    thread consumer1(consume);\n    thread consumer2(consume);\n    thread consumer3(consume);\n    producer1.join();\n    producer2.join();\n    producer3.join();\n    consumer1.join();\n    consumer2.join();\n    consumer3.join();\n}\n```\n\n```\n139780600784640produce: 0\n139780592391936consume: 0\n139780609177344produce: 0\n139780575606528consume: 0\n139780617570048produce: 0\n139780575606528consume: 0\n139780600784640produce: 1\n139780592391936consume: 1\n139780617570048produce: 1\n139780592391936consume: 1\n139780617570048produce: 2\n139780592391936consume: 2\n139780617570048produce: 3\n139780592391936consume: 3\n139780617570048produce: 4\n139780592391936consume: 4\n139780617570048produce: 5\n139780592391936consume: 5\n139780617570048produce: 6\n139780592391936consume: 6\n139780617570048produce: 7\n139780592391936consume: 7\n139780617570048produce: 8\n139780592391936consume: 8\n139780600784640produce: 2\n139780583999232consume: 2\n139780609177344produce: 1\n139780583999232consume: 1\n139780609177344produce: 2\n139780583999232consume: 2\n139780600784640produce: 3\n139780583999232consume: 3\n139780600784640produce: 4\n139780583999232consume: 4\n139780609177344produce: 3\n139780575606528consume: 3\n139780600784640produce: 5\n139780583999232consume: 5\n139780600784640produce: 6\n139780575606528consume: 6\n139780600784640produce: 7\n139780583999232consume: 7\n139780600784640produce: 8\n139780575606528consume: 8\n139780600784640produce: 9\n139780583999232consume: 9\n139780609177344produce: 4\n139780575606528consume: 4\n139780609177344produce: 5\n139780575606528consume: 5\n139780609177344produce: 6\n139780583999232consume: 6\n139780609177344produce: 7\n139780575606528consume: 7\n139780609177344produce: 8\n139780583999232consume: 8\n139780609177344produce: 9\n139780575606528consume: 9\n139780617570048produce: 9\n139780575606528consume: 9\n```\n\n# å¾ªç¯é˜Ÿåˆ—+ä¿¡å·é‡\n\n# å›¾ç¤º\n\n![image-20211224144301657](../../images/%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85/image-20211224144301657.png)\n\n# çº¿ç¨‹ä¸å®‰å…¨ä»£ç \nè¿™æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ç‰ˆæœ¬ã€‚\n\n```c++\n#include<iostream>\n#include<thread>\n#include<mutex>\n#include<semaphore>\ntemplate<class Type>\nclass Queue\n{\nprivate:\n    Queue(const Queue&) = delete;\n    Queue& operator=(const Queue&) = delete;\npublic:\n    Queue(int sz = 8) :data(NULL), maxsize(sz), front(0), tail(0), cursize(0)\n    {\n        data = (Type*)malloc(sizeof(Type) * maxsize);\n        if (NULL == data) exit(1);\n    }\n    ~Queue()\n    {\n        free(data);\n        data = NULL;\n        maxsize = cursize = front = tail = 0;\n    }\n    int Cursize() const { return cursize; }\n    bool IsEmpty() const { return cursize == 0; }\n    int MaxSize() const { return maxsize; }\n    bool IsFull() const { return cursize == maxsize; }\n    Type& Front() { return data[front]; }\n    const Type& Front() const { return data[front]; }\n    Type& Back() { return data[tail]; }\n    const Type& Back() const { return data[tail]; }\n\n    bool Push(const Type& x)\n    {\n        if (IsFull()) return false;\n        data[tail] = x;\n        cursize += 1;\n        tail = (tail + 1) % maxsize;   // ç¡®ä¿äº†å–å€¼èŒƒå›´åœ¨ 0 ~ 7\n        return true;\n    }\n    bool Pop()\n    {\n        if (IsEmpty()) return false;\n        front = (front + 1) % maxsize; // ç¡®ä¿äº†å–å€¼èŒƒå›´åœ¨ 0 ~ 7\n        cursize -= 1;\n        return true;\n    }\n\nprivate:\n    Type* data;\n    int maxsize;\n    // é˜Ÿå¤´\n    int front;\n    // é˜Ÿå°¾\n    int tail;\n    int cursize;\n    mutable std::mutex mtx;\n};\nconstinit int product_num = 100;\nconstinit int n = 8;\nQueue<int> qu(n);\nstd::counting_semaphore produce_sema(8); // ç”Ÿäº§è€…ä¿¡å·é‡\nstd::counting_semaphore consume_sema(0); // æ¶ˆè´¹è€…ä¿¡å·é‡\n// ä¸‹è½½å™¨\nvoid produce()\n{\n    for (int i = 0; i < product_num; ++i)\n    {\n        produce_sema.acquire();\n        std::cout << \"producer: \" << i << std::endl;\n        qu.Push(i);\n        consume_sema.release();\n    }\n}\n// æ’­æ”¾å™¨\nvoid consume()\n{\n    for (int i = 0; i < product_num; ++i)\n    {\n        consume_sema.acquire();\n        std::cout << \"consumer: \" << qu.Front() << std::endl;\n        qu.Pop();\n        produce_sema.release();\n    }\n}\nint main()\n{\n    std::thread produce_th(produce);\n    std::thread consume_th(consume);\n\n    produce_th.join();\n    consume_th.join();\n}\n```\nç»“æœ\n\n```\nproducer: 0\nproducer: 1\nproducer: 2\nproducer: 3\nconsumer: 0\nconsumer: 1\nconsumer: 2\nconsumer: 3\nproducer: 4\nproducer: 5\nproducer: 6\nproducer: 7consumer: 4\nconsumer: 5\nconsumer: 6\n\nproducer: 8\nproducer: 9\nproducer: 10\nproducer: 11\nproducer: 12\nproducer: 13\nproducer: 14\nconsumer: 7\nconsumer: 8\nconsumer: 9\nconsumer: 10\nconsumer: 11\nconsumer: 12\nconsumer: 13\nconsumer: 14\nproducer: 15\nproducer: 16\nproducer: 17\nproducer: 18\nproducer: 19\nproducer: 20\nconsumer: 15\nconsumer: 16\nconsumer: 17\nconsumer: 18\nconsumer: 19\nconsumer: 20\nproducer: 21\nproducer: 22\nproducer: 23\nproducer: 24\nconsumer: 21\nconsumer: 22\nconsumer: 23\nconsumer: 24\nproducer: 25\nproducer: 26\nproducer: 27\nconsumer: 25\nconsumer: 26\nconsumer: 27\nproducer: 28\nproducer: 29\nproducer: 30\nproducer: 31\nproducer: 32\nproducer: 33\nproducer: 34\nproducer: 35\nconsumer: 28\nconsumer: 29\nconsumer: 30\nconsumer: 31\nconsumer: 32\nconsumer: 33\nproducer: 36\nproducer: 37\nproducer: 38\nproducer: 39\nconsumer: 34\nconsumer: 35\nconsumer: 36\nconsumer: 37\nconsumer: 38\nconsumer: 39\nproducer: 40\nproducer: 41\nproducer: 42\nproducer: 43\nproducer: 44\nproducer: 45\nproducer: 46\nproducer: 47\nconsumer: 40\nconsumer: 41\nconsumer: 42\nconsumer: 43\nconsumer: 44\nconsumer: 45\nconsumer: 46\nproducer: 48\nproducer: 49\nproducer: 50\nproducer: 51\nproducer: 52\nproducer: 53\nconsumer: 47\nconsumer: 48\nconsumer: 49\nproducer: 54\nproducer: 55\nproducer: 56\nproducer: 57\nconsumer: 50\nconsumer: producer: 58\n51\nconsumer: 52\nconsumer: 53\nproducer: 59\nproducer: 60\nproducer: 61\nconsumer: 54\nconsumer: 55\nconsumer: 56\nconsumer: 57\nconsumer: 58\nconsumer: 59\nconsumer: 60\nconsumer: 61\nproducer: 62\nproducer: 63\nproducer: 64\nconsumer: 62\nconsumer: 63\nconsumer: 64\nproducer: 65\nproducer: 66\nproducer: 67\nproducer: 68\nproducer: 69\nproducer: 70\nproducer: 71\nproducer: 72\nconsumer: 65\nconsumer: producer: 73\n66\nconsumer: 67\nconsumer: 68\nconsumer: 69\nconsumer: 70\nconsumer: 71\nconsumer: 72\nconsumer: 73\nproducer: 74\nproducer: 75\nproducer: 76\nproducer: 77\nproducer: 78\nproducer: 79\nproducer: 80\nproducer: 81\nconsumer: 74\nconsumer: 75\nconsumer: 76\nconsumer: 77\nconsumer: 78\nconsumer: 79\nconsumer: 80\nconsumer: 81\nproducer: 82\nproducer: 83\nproducer: 84\nproducer: 85\nproducer: 86\nproducer: 87\nproducer: 88\nproducer: 89\nconsumer: 82\nconsumer: 83\nconsumer: 84\nconsumer: 85\nconsumer: 86\nconsumer: 87\nconsumer: 88\nconsumer: 89\nproducer: 90\nproducer: 91\nproducer: 92\nproducer: 93\nproducer: 94\nproducer: 95\nproducer: 96\nproducer: 97\nconsumer: 90\nconsumer: 91\nconsumer: 92\nconsumer: 93\nconsumer: 94\nconsumer: 95\nconsumer: 96\nconsumer: 97\nproducer: 98\nproducer: 99\nconsumer: 98\nconsumer: 99\n\n```\n# åŠ mutexä»£ç \n```cpp\n#include<iostream>\n#include<thread>\n#include<mutex>\n#include<semaphore>\n#include<print>\ntemplate<class Type>\nclass Queue\n{\nprivate:\n    Queue(const Queue&) = delete;\n    Queue& operator=(const Queue&) = delete;\npublic:\n    Queue(int sz = 8) :data(NULL), maxsize(sz), front(0), tail(0), cursize(0)\n    {\n        data = (Type*)malloc(sizeof(Type) * maxsize);\n        if (NULL == data) exit(1);\n    }\n    ~Queue()\n    {\n        free(data);\n        data = NULL;\n        maxsize = cursize = front = tail = 0;\n    }\n    int Cursize() const \n    {\n        std::lock_guard<std::mutex> lock(mtx);\n        return cursize;\n    }\n    bool IsEmpty() const\n    {\n        return Cursize() == 0;\n    }\n    int MaxSize() const\n    {\n        return maxsize;\n    }\n    bool IsFull() const\n    {\n        return Cursize() == maxsize;\n    }\n    Type& Front()\n    {\n        std::lock_guard<std::mutex> lock(mtx);\n        return data[front];\n    }\n    const Type& Front() const\n    {\n        std::lock_guard<std::mutex> lock(mtx);\n        return data[front];\n    }\n    Type& Back()\n    {\n        std::lock_guard<std::mutex> lock(mtx);\n        return data[tail];\n    }\n    const Type& Back() const\n    {\n        std::lock_guard<std::mutex> lock(mtx);\n        return data[tail];\n    }\n\n    bool Push(const Type& x)\n    {\n        if (IsFull()) return false;\n        std::lock_guard<std::mutex> lock(mtx);\n        data[tail] = x;\n        cursize += 1;\n        tail = (tail + 1) % maxsize;   // ç¡®ä¿äº†å–å€¼èŒƒå›´åœ¨ 0 ~ 7\n        return true;\n    }\n    bool Pop()\n    {\n        if (IsEmpty()) return false;\n        std::lock_guard<std::mutex> lock(mtx);\n        front = (front + 1) % maxsize; // ç¡®ä¿äº†å–å€¼èŒƒå›´åœ¨ 0 ~ 7\n        cursize -= 1;\n        return true;\n    }\n\nprivate:\n    Type* data;\n    int maxsize;\n    // é˜Ÿå¤´\n    int front;\n    // é˜Ÿå°¾\n    int tail;\n    int cursize;\n    mutable std::mutex mtx;\n};\nconstinit int product_num = 100;\nconstinit int n = 8;\nQueue<int> qu(n);\nstd::counting_semaphore produce_sema(8); // ç”Ÿäº§è€…ä¿¡å·é‡\nstd::counting_semaphore consume_sema(0); // æ¶ˆè´¹è€…ä¿¡å·é‡\n// ä¸‹è½½å™¨\nvoid produce()\n{\n    for (int i = 0; i < product_num; ++i)\n    {\n        produce_sema.acquire();\n        std::println(\"{} {}\", \"producer:\", i);\n        qu.Push(i);\n        consume_sema.release();\n    }\n}\n// æ’­æ”¾å™¨\nvoid consume()\n{\n    for (int i = 0; i < product_num; ++i)\n    {\n        consume_sema.acquire();\n        std::println(\"{} {}\", \"consumer:\", qu.Front());\n        qu.Pop();\n        produce_sema.release();\n    }\n}\nint main()\n{\n    std::thread produce_th(produce);\n    std::thread consume_th(consume);\n\n    produce_th.join();\n    consume_th.join();\n}\n```\nç»“æœï¼š\n```\nproducer: 0\nproducer: 1\nproducer: 2\nproducer: 3\nproducer: 4\nconsumer: 0\nconsumer: 1\nconsumer: 2\nproducer: 5\nproducer: 6\nproducer: 7\nproducer: 8\nconsumer: 3\nproducer: 9\nproducer: 10\nproducer: 11\nconsumer: 4\nconsumer: 5\nconsumer: 6\nproducer: 12\nconsumer: 7\nconsumer: 8\nconsumer: 9\nconsumer: 10\nconsumer: 11\nproducer: 13\nproducer: 14\nconsumer: 12\nconsumer: 13\nproducer: 15\nconsumer: 14\nconsumer: 15\nproducer: 16\nproducer: 17\nproducer: 18\nproducer: 19\nconsumer: 16\nproducer: 20\nproducer: 21\nproducer: 22\nproducer: 23\nproducer: 24\nconsumer: 17\nconsumer: 18\nconsumer: 19\nproducer: 25\nproducer: 26\nproducer: 27\nconsumer: 20\nconsumer: 21\nproducer: 28\nconsumer: 22\nconsumer: 23\nproducer: 29\nproducer: 30\nconsumer: 24\nconsumer: 25\nconsumer: 26\nconsumer: 27\nproducer: 31\nproducer: 32\nconsumer: 28\nproducer: 33\nproducer: 34\nproducer: 35\nproducer: 36\nconsumer: 29\nconsumer: 30\nconsumer: 31\nproducer: 37\nproducer: 38\nconsumer: 32\nconsumer: 33\nconsumer: 34\nconsumer: 35\nconsumer: 36\nproducer: 39\nproducer: 40\nconsumer: 37\nconsumer: 38\nconsumer: 39\nconsumer: 40\nproducer: 41\nproducer: 42\nproducer: 43\nconsumer: 41\nconsumer: 42\nconsumer: 43\nproducer: 44\nproducer: 45\nproducer: 46\nproducer: 47\nconsumer: 44\nproducer: 48\nproducer: 49\nconsumer: 45\nconsumer: 46\nproducer: 50\nconsumer: 47\nconsumer: 48\nconsumer: 49\nconsumer: 50\nproducer: 51\nproducer: 52\nproducer: 53\nproducer: 54\nconsumer: 51\nconsumer: 52\nconsumer: 53\nconsumer: 54\nproducer: 55\nproducer: 56\nproducer: 57\nproducer: 58\nproducer: 59\nproducer: 60\nconsumer: 55\nproducer: 61\nconsumer: 56\nproducer: 62\nconsumer: 57\nconsumer: 58\nproducer: 63\nproducer: 64\nconsumer: 59\nconsumer: 60\nconsumer: 61\nconsumer: 62\nconsumer: 63\nproducer: 65\nconsumer: 64\nproducer: 66\nproducer: 67\nproducer: 68\nconsumer: 65\nconsumer: 66\nconsumer: 67\nconsumer: 68\nproducer: 69\nproducer: 70\nproducer: 71\nproducer: 72\nproducer: 73\nproducer: 74\nproducer: 75\nconsumer: 69\nconsumer: 70\nconsumer: 71\nconsumer: 72\nconsumer: 73\nproducer: 76\nproducer: 77\nconsumer: 74\nconsumer: 75\nconsumer: 76\nproducer: 78\nproducer: 79\nproducer: 80\nconsumer: 77\nconsumer: 78\nconsumer: 79\nconsumer: 80\nproducer: 81\nproducer: 82\nconsumer: 81\nconsumer: 82\nproducer: 83\nproducer: 84\nproducer: 85\nproducer: 86\nconsumer: 83\nproducer: 87\nproducer: 88\nconsumer: 84\nproducer: 89\nproducer: 90\nproducer: 91\nproducer: 92\nconsumer: 85\nconsumer: 86\nconsumer: 87\nproducer: 93\nproducer: 94\nproducer: 95\nconsumer: 88\nconsumer: 89\nconsumer: 90\nconsumer: 91\nproducer: 96\nproducer: 97\nproducer: 98\nconsumer: 92\nconsumer: 93\nproducer: 99\nconsumer: 94\nconsumer: 95\nconsumer: 96\nconsumer: 97\nconsumer: 98\nconsumer: 99\n\n```\n# æ— é”é˜Ÿåˆ—\n\nå…±æœ‰ä¸‰ä¸ªçº¿ç¨‹ï¼šè§‚å¯Ÿè€…çº¿ç¨‹ï¼ˆè°ƒåº¦çº¿ç¨‹ï¼‰ã€ç”Ÿäº§è€…çº¿ç¨‹ã€æ¶ˆè´¹è€…çº¿ç¨‹ã€‚\n\nå…±æœ‰ä¸‰ä¸ªé˜Ÿåˆ—ã€‚\n\nç”Ÿäº§è€…ç»™ç¬¬ä¸€ä¸ªé˜Ÿåˆ—ç”Ÿäº§æ•°æ®ï¼Œè‹¥ç”Ÿäº§å®Œæ¯•æˆ–è¿™ä¸ªé˜Ÿåˆ—å·²æ»¡ï¼Œç”Ÿäº§è€…é€šçŸ¥è§‚å¯Ÿè€…ã€‚è§‚å¯Ÿè€…åˆ™è°ƒåº¦é˜Ÿåˆ—ï¼ŒæŠŠå­˜æ”¾æ•°æ®çš„é˜Ÿåˆ—ç§»äº¤åˆ°æ¶ˆè´¹è€…ç«¯ï¼ŒæŠŠç¬¬äºŒä¸ªé˜Ÿåˆ—ï¼ˆç©ºé˜Ÿåˆ—ï¼‰ç»™ç”Ÿäº§è€…ï¼Œå†ç»§ç»­ç”Ÿäº§ã€‚è‹¥ç¬¬äºŒä¸ªé˜Ÿåˆ—ä¹Ÿæ»¡äº†ï¼Œä¹Ÿç§»äº¤ç»™æ¶ˆè´¹è€…ç«¯ï¼ŒæŠŠç¬¬ä¸‰ä¸ªé˜Ÿåˆ—ï¼ˆç©ºé˜Ÿåˆ—ï¼‰ç»™ç”Ÿäº§è€…ã€‚å¦‚æ­¤ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹çš„è¿‡ç¨‹ä¸­ï¼Œç”Ÿäº§è€…ä»å¯ä»¥ä¸æ–­ç”Ÿäº§ï¼Œç›´åˆ°æ²¡æœ‰ç©ºçš„é˜Ÿåˆ—ã€‚\n\nç›¸åº”åœ°ï¼Œåªè¦æœ‰ç©ºçš„é˜Ÿåˆ—æˆ–å·²ä½¿ç”¨è¿‡çš„é˜Ÿåˆ—ï¼Œåˆ™ç§»äº¤ç»™ç”Ÿäº§è€…ç«¯ã€‚ï¼ˆæŠŠé˜Ÿåˆ—å…¥é˜Ÿï¼Œæœ‰ç‚¹åƒäºŒç»´é˜Ÿåˆ—çš„æ„Ÿè§‰ï¼‰\n\nè¿™ä¸ªæ¨¡å‹ä¸­ï¼Œæ§åˆ¶çº¿ç¨‹èµ·å…³é”®æ¡¥æ¢ä½œç”¨ï¼Œé€šçŸ¥çº¿ç¨‹é—´ä¿¡æ¯äº¤æµã€‚\n\nå…¶æ¬¡ï¼Œè¿™ä¸ªæ¨¡å‹çš„å¥½å¤„åœ¨äºï¼Œç›¸æ¯”ç®€å•çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼Œä¸æ˜¯å•çº¯åœ°å¯¹åŒä¸€ä¸ªç¼“å†²åŒºå®¹å™¨è¿›è¡Œè¯»å†™ã€‚å¯ä»¥è¿›è¡Œåˆ†åº“ã€åˆ†è¡¨ï¼Œè¿˜å¯æŠŠè¯»å†™æ“ä½œåˆ†å¼€ï¼ˆæ ¹æ®æ¨¡å¼è¿›è¡Œè½®æ¢ï¼‰ï¼Œç²’åº¦å˜ç»†ï¼Œæé«˜å¹¶å‘æ€§èƒ½ã€‚\n## ä¸‹å»æŸ¥èµ„æ–™\n\n1. æ€»çº¿é”çš„æ±‡ç¼–å®ç°\n2. ç¼“å†²é”çš„æ±‡ç¼–å®ç°","categories":["æ“ä½œç³»ç»Ÿ","å¤šçº¿ç¨‹","Cpp","Modern","è®¾è®¡æ¨¡å¼"]},{"title":"Linux_ç½‘ç»œ","url":"/Linux/Linux_ç½‘ç»œ/","content":"# å†…å®¹\n\n1. åŸºæœ¬æ¦‚å¿µ\n2. äº†è§£æ¥å£socket\n3. äº†è§£åè®®tcp/udp\n4. ioå¤ç”¨\n5. select\n6. poll/epoll\n\n# åˆ†å±‚æ¨¡å‹\n\nOSIï¼šä¸ƒå±‚\nTCP/IPåè®®æ—ï¼šå››å±‚\n## é—®é¢˜\n\n1. ä¸ºä»€ä¹ˆè¦åˆ†å±‚ï¼Ÿ\n    1. è§£è€¦ï¼Œåˆ†å·¥ã€‚\n2. ç½‘ç»œï¼š\n3. äº’è”ç½‘ï¼šç½‘ç»œå’Œç½‘ç»œè¿æ¥èµ·æ¥ï¼Œå°±æ˜¯äº’è”ç½‘\n4. ipv4ï¼šæ˜¯32ä½çš„ï¼Œç”¨â€œ.â€åˆ†æˆ4ä¸ªæ®µï¼Œæ¯ä¸ªæ®µæ˜¯8ä½ã€‚æ¯ä¸ªæ®µç”¨1ä¸ª10è¿›åˆ¶è¡¨ç¤ºã€‚\n5. ipv6ï¼šæ˜¯128ä½çš„ï¼Œç”¨â€œ:â€åˆ†æˆ8ä¸ªæ®µï¼Œæ¯ä¸ªæ®µæ˜¯16ä½ã€‚æ¯ä¸ªæ®µç”¨4ä¸ª16è¿›åˆ¶è¡¨ç¤ºã€‚\n6. MACåœ°å€ï¼šç‰©ç†åœ°å€ï¼Œåˆç§°ç¡¬ä»¶åœ°å€ã€‚\n7. æœ‰äº†MACåœ°å€ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰ipåœ°å€ï¼Ÿå¯»å€ï¼\n8. ç«¯å£å·ï¼šè½¯ä»¶å±‚æ¬¡çš„æ¦‚å¿µã€‚å› ä¸ºæœ€ç»ˆè¦è¾¾åˆ°è¿›ç¨‹çš„é€šä¿¡ã€‚\n9. åè®®ï¼š\n    1. tcp\n    2. http\n    3. ip\n    4. udp\n# TCPç¼–ç¨‹æµç¨‹\n\né¢è¯•å”¯ä¸€è¦å†™ä»£ç çš„ã€‚\n\n1. æœåŠ¡å™¨ç«¯ï¼š\n    1. åˆ›å»ºå¥—æ¥å­—socket()\n        1. æ‰€éœ€åœ°å€ï¼šip+port\n    2. bind()\n    3. listen()\n    4. c = accept()\n    5. recv()\n    6. send()\n    7. close()\n2. å®¢æˆ·ç«¯ï¼š\n    1. socket()\n    2. connect()\n    3. send()\n    4. recv()\n    5. close()\n# TCP\n\nç‰¹ç‚¹ï¼š\n1. é¢å‘è¿æ¥çš„\n    1. ä¸‰æ¬¡æ¡æ‰‹--åœ¨å®¢æˆ·ç«¯connect()æ—¶\n        1. å¿…é¡»æ˜¯ä¸‰æ¬¡\n    2. å››æ¬¡æŒ¥æ‰‹--åœ¨ä»»ä¸€æ–¹closeæ—¶\n        1. æœ‰æ—¶å¯ä»¥ä¸‰æ¬¡\n2. å¯é çš„\n    1. åº”ç­”ç¡®è®¤\n    2. è¶…æ—¶é‡ä¼ \n    3. ä¹±åºé‡æ’\n    4. å»é‡\n    5. æ»‘åŠ¨çª—å£è¿›è¡Œæµé‡æ§åˆ¶\n3. æµå¼æœåŠ¡\n    1. å‘é€å’Œæ¥æ”¶çš„æ¬¡æ•°å¯èƒ½ä¸ä¸€è‡´ã€‚\n        1. è¿ç»­å¤šæ¬¡å‘é€çš„æ•°æ®å¯èƒ½ä¼šè¢«å¯¹æ–¹ä¸€æ¬¡æ€§æ”¶åˆ°ã€‚\n            1. èµ·å§‹æœ«å°¾åŠ æ ‡è®°\n            2. sendä¹‹årecvéš”å¼€\n4. tcpæ˜¯æœ‰çŠ¶æ€çš„\n    1. å¼€å§‹closed\n    2. listen--connecting(ä¸‰æ¬¡æ¡æ‰‹ä¸­)\n    3. established(å·²å®Œæˆæ¡æ‰‹)\n    4. FIN_WAIT_1/2\n    5. TIME_WAIT\n        1. å¯é åœ°ç»ˆæ­¢TCPçš„è¿æ¥\n        2. è®©è¿Ÿæ¥çš„æŠ¥æ–‡åœ¨è¿™ä¸€æ®µæ—¶é—´è¢«è¯†åˆ«ï¼Œå³æ”¶é›†åä¸¢å¼ƒï¼Œä»¥é˜²æ­¢è¯¯ä¼ ç»™ä¸‹ä¸€ä¸ªä½¿ç”¨è¯¥ç«¯å£çš„è¿æ¥ã€‚\n\né—®é¢˜ï¼š1ã€TCP/IPåè®®è¯¦è§£ å·ä¸€ï¼›2ã€UNIXç½‘ç»œç¼–ç¨‹ å·ä¸€\n\n1. ä¸‰æ¬¡æ¡æ‰‹ï¼Œå››æ¬¡æŒ¥æ‰‹\n2. åº”ç­”ç¡®è®¤ã€è¶…æ—¶é‡ä¼ æœºåˆ¶\n3. ä¹±åºé‡æ’ã€å»é‡ã€æ»‘åŠ¨çª—å£è¿›è¡Œæµé‡æ§åˆ¶\n4. ä»€ä¹ˆæ˜¯ç²˜åŒ…ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ\n5. ä¸­é—´è½¬æ¢çŠ¶æ€çš„æ„ä¹‰ï¼ŸTIME_WAITçŠ¶æ€çš„æ„ä¹‰ï¼Ÿ\n# UDP\n\nç‰¹ç‚¹ï¼š\n1. æ— è¿æ¥çš„\n    1. æ²¡æœ‰ä¸¥æ ¼æ„ä¹‰ä¸Šçš„æœåŠ¡ç«¯/å®¢æˆ·ç«¯ï¼Œåªè¦çŸ¥é“ip:portå°±å¯ä»¥ç»™å¯¹æ–¹sendtoå‘æ¶ˆæ¯ã€‚recvfromè°çš„æ¶ˆæ¯éƒ½å¯ä»¥æ”¶åˆ°ï¼Œä¹Ÿå¯ä»¥æ”¶åˆ°ä¸åŒç»ˆç«¯çš„æ¶ˆæ¯ã€‚\n2. ä¸å¯é çš„\n    1. æ²¡æœ‰åº”ç­”ç¡®è®¤æœºåˆ¶ï¼Œå‘å‡ºåæ˜¯å¦æˆåŠŸçœ‹å¤©æ„ã€‚\n3. æ•°æ®æŠ¥æœåŠ¡\n    1. å¦‚æœsendäº†å¾ˆå¤šä¿¡æ¯ï¼Œrecvä¸€æ¬¡æ²¡æ”¶å®Œï¼Œåˆ™å‰©ä¸‹çš„æ•°æ®ä¸¢åŒ…ã€‚\n    2. UDPçš„sendå’Œrecvä¹Ÿæœ‰ç¼“å†²åŒºï¼Œä½†æ˜¯å…¶ä¸æ”¶å‘çš„åŠ¨ä½œæ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œå¯¹åº”ç€å‘é€/æ¥æ”¶çš„é‚£ä¸€æ¬¡ã€‚\n4. æ— çŠ¶æ€çš„\n# UDPç¼–ç¨‹æµç¨‹\n\nåœ¨UDPåœºæ™¯ä¸­ï¼Œå…¶å®æ²¡æœ‰ä¸¥æ ¼æ„ä¹‰ä¸Šçš„æœåŠ¡ç«¯/å®¢æˆ·ç«¯ã€‚å› ä¸ºç¼–ç¨‹æµç¨‹å¾ˆç›¸ä¼¼ã€‚\n\n## æœåŠ¡ç«¯\n\nsocket()\nbind()\nrecvfrom()\nsendto()\nclose()\n## å®¢æˆ·ç«¯\n\nsocket()\nã€bind()ï¼šå¯ä»¥ç»‘å®šä¹Ÿå¯ä»¥ä¸ç»‘å®šã€‘\nrecvfrom()\nsendto()\nclose()\n## ä¸tcpçš„åŒºåˆ«\n\n1. åˆ›å»ºsocketæ—¶çš„ç¬¬äºŒä¸ªå‚æ•°TCPä¸­æ˜¯SOCK_STREAMï¼ŒUDPä¸­æ˜¯SOCK_DGRAM(æŒ‡datagrams)\n\n```c\nint sockfd = socket(AF_INET,SOCK_DGRAM,0);\n```\n2. recvfromä¸­å¤šäº†ä¸¤ä¸ªå‚æ•°ï¼Œå‰å››ä¸ªå‚æ•°ä¸TCPä¸€è‡´ï¼Œåé¢ä¸€ä¸ªä¼ å…¥**è¦æ¥æ”¶å“ªä¸ªä¸»æœºçš„sockaddrç±»å‹çš„æŒ‡é’ˆ**ï¼Œæœ€åæ˜¯ä¼ å…¥è¿™ä¸ª**sockaddrå¯¹è±¡çš„é•¿åº¦çš„æŒ‡é’ˆ**ã€‚ä¸ºä»€ä¹ˆè¦ä¼ æŒ‡é’ˆï¼Ÿå› ä¸ºUDPä¸­æŸä¸€ç«¯æ¥æ”¶çš„æ•°æ®å¯ä»¥æ¥è‡ªä¸åŒä¸»æœºï¼Œæ‰€ä»¥ä¼ å…¥æŒ‡é’ˆæ˜¯è¦å®æ—¶çš„è®°å½•è°åœ¨ç»™æ¥æ”¶ç«¯å‘æ•°æ®ã€‚\n3. åŒæ ·çš„ï¼Œsendtoä¹Ÿå¤šäº†ä¸¤ä¸ªå‚æ•°ï¼Œåé¢ä¸€ä¸ªä¼ å…¥**è¦å‘é€åˆ°å“ªä¸ªçš„ä¸»æœºçš„sockaddrç±»å‹çš„æŒ‡é’ˆ**ï¼ˆå‚æ•°ç±»å‹ä¸º`const struct sockaddr* dest_addr`ï¼‰ï¼Œæœ€åä¼ å…¥**è¿™ä¸ª`sockaddr`å¯¹è±¡çš„é•¿åº¦å¤§å°ï¼Œé€šå¸¸ç”¨`sizeof`è®¡ç®—**ã€‚ç›¸å¯¹äº`recvfrom`ï¼Œ**ä¸ºä»€ä¹ˆä¸ä¼ `éconstæŒ‡é’ˆ`äº†**ï¼Ÿå› ä¸ºï¼šè¦ä¹ˆæ˜¯æœåŠ¡ç«¯ï¼Œ`sendto`çš„ç›®çš„ä¸»æœºå·²ç»åœ¨`recvfrom`æ”¶åˆ°å®¢æˆ·ç«¯æ¶ˆæ¯åæ˜ç¡®ï¼›è¦ä¹ˆæ˜¯å®¢æˆ·ç«¯è¦`sendto`çš„ç›®çš„ä¸»æœºå·²ç»å¾ˆæ˜ç¡®åœ°æŒ‡å®šã€‚\n## ä¸€ä¸ªç«¯å£åœ¨å¼€å¯TCPæœåŠ¡çš„åŒæ—¶ï¼Œä¹Ÿå¯ä»¥å¼€å¯UDPæœåŠ¡\n\næˆ‘ä»¬å¸¸è¯´ï¼šä¸€ä¸ªç«¯å£æ ‡è¯†ä¸€ä¸ªè¿›ç¨‹ï¼Œä½†æ˜¯å¯¹äºä¸åŒçš„åè®®ï¼Œä¸¤ä¸ªè¿›ç¨‹å±…ç„¶å¯ä»¥ç»‘å®šåˆ°åŒä¸€ç«¯å£ï¼ä½†æ˜¯ï¼ŒçŸ¥é“ä¸ºä»€ä¹ˆèƒ½è¿™æ ·åšï¼Œå†å»æƒ³ï¼Œè¿™å¥è¯è¿˜æ˜¯æ²¡æ¯›ç—…çš„ã€‚\n\nåªæœ‰ä¸€ä¸ªç«¯å£ï¼Œå¦‚ä½•èƒ½å¤ŸåŒºåˆ†ä¸åŒåè®®ï¼Ÿè¿™ä¸ªåŒºåˆ†å·¥ä½œé€šå¸¸æ˜¯åœ¨åº”ç”¨å±‚å®Œæˆçš„ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªè¿›ç¨‹æ˜¯TCPæœåŠ¡ç«¯ï¼Œå¦ä¸€ä¸ªè¿›ç¨‹çš„UDPæœåŠ¡ç«¯ã€‚UDPæŠ¥æ–‡è¿‡æ¥äº†ï¼Œè¯¥ç»™è°ï¼›ä¸‹ä¸€åˆ»TCPæ•°æ®è¿‡æ¥äº†å†ç»™è°ã€‚ç«¯å£è™½ç„¶ä¸èƒ½åŒºåˆ†ä¸åŒåè®®çš„æ•°æ®æŠ¥ï¼Œä½†æ˜¯æˆ‘ä»¬æœ€ç»ˆéƒ½è¦æŠŠè¯¥æ•°æ®åŒ…ä¼ åˆ°æŸä¸ªè¿›ç¨‹ä¸­å»ï¼**ä¸¤ä¸ªè¿›ç¨‹åŒæ—¶ç›‘å¬åˆ°äº†ç«¯å£çš„æ•°æ®ä¼ æ¥ï¼Œæ­¤æ—¶è¿™ä¸ªæ•°æ®æŠ¥å¤´å·²ç»åŠ äº†å…¶åè®®å¤´ï¼Œè¿›ç¨‹åœ¨å»è§£æåè®®å¤´æ—¶å°±æ¸…æ¥šäº†è¯¥ä¸è¯¥ç»§ç»­æ¥æ”¶è¿™ä¸ªæ•°æ®æŠ¥**ï¼Œè¿™æ ·å°±è‡ªç„¶çš„å®Œæˆäº†å¯¹ä¸åŒåè®®çš„åŒºåˆ†ã€‚å³ï¼šåœ¨åº”ç”¨å±‚ï¼Œæ¯ä¸ªè¿æ¥å°±éœ€è¦æŒ‰ç…§äº”å…ƒç»„æ¥åŒºåˆ†ï¼š{åè®®ï¼Œæºipï¼Œæºportï¼Œç›®çš„ipï¼Œç›®çš„port}ã€‚å³ä½¿ä¸åŒºåˆ†ï¼ŒæŒ‰ç…§SOCK_STREAMæˆ–SOCK_DGRAMï¼ŒæŠ¥æ–‡ç±»å‹ä¸ä¸€æ ·ï¼Œæ ¹æœ¬å°±ä¸é€‚é…ï¼Œæ‰€ä»¥ä¸¤è€…ä½¿ç”¨çš„ç«¯å£åœ¨åº”ç”¨å±‚æ¥è¯´æ˜¯ç‹¬ç«‹çš„ã€‚\n# http\n\n1. æµè§ˆå™¨è§£æåˆ°IPåï¼Œç«¯å£çº¦å®šä¸º80ï¼Œconnectä¸‰æ¬¡æ¡æ‰‹å»ºç«‹TCPè¿æ¥ã€‚\n2. æµè§ˆå™¨ç»™æœåŠ¡å™¨å‘é€httpè¯·æ±‚æŠ¥æ–‡ã€‚æµè§ˆå™¨send\n3. æœåŠ¡å™¨ç»™æµè§ˆå™¨å›å¤åº”ç­”æŠ¥æ–‡ã€‚æµè§ˆå™¨recv\n4. å¦‚æœ2ã€3æ­¥åªå‘ç”Ÿä¸€æ¬¡ï¼Œä¸ºçŸ­è¿æ¥ã€‚å‘ç”Ÿäº†ä¸¤æ¬¡ä»¥ä¸Šï¼Œåˆ™ä¸ºé•¿è¿æ¥ï¼Œä¹‹åä¸ä¼šå¾ˆå¿«æ–­å¼€ã€‚å¦‚æ­¤å¯ä»¥é¿å…æ¡æ‰‹ã€æŒ¥æ‰‹æµªè´¹çš„æ—¶é—´ã€‚\n# I/Oå¤ç”¨\n\n1. select\n2. poll\n3. epoll\n## select\n\nå…ˆè§‚å¯Ÿå…¶API\n\n```c\n#include<sys/select.h>\nint select(int nfds, fd_set* readfds, fd_set* writefds, fd_set* exceptfds, struct timeval* timeout);\n```\n\n1. å‚æ•°\n    1. nfdså‚æ•°é€šå¸¸è¢«è®¾ç½®ä¸ºselectç›‘å¬çš„æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦ä¸­çš„æœ€å¤§å€¼åŠ 1ï¼Œè¡¨ç¤ºåœ¨fd_seté›†åˆä¸­ï¼Œæˆ‘ä»¬å…³å¿ƒçš„æè¿°ç¬¦çš„æ€»æ•°ã€‚ä¸ºä»€ä¹ˆåŠ 1å‘¢ï¼Ÿå› ä¸ºæ–‡ä»¶æè¿°ç¬¦æ˜¯ä»0å¼€å§‹è®¡æ•°çš„ã€‚nfdsä¸fd_setå®¹é‡å¤§å°ä¸ä¸€æ ·ï¼Œå®¹é‡å¤§å°æŒ‡çš„æ˜¯FD_SETSIZEï¼Œå³fd_setå®¹é‡å¤§å°æ˜¯fd_setå¯å®¹çº³æè¿°ç¬¦çš„æœ€å¤§å¤§å°ã€‚\n    2. readfdså‚æ•°æ˜¯selectå…³å¿ƒçš„è¯»äº‹ä»¶çš„é›†åˆï¼›\n    3. writefdså‚æ•°æ˜¯selectå…³å¿ƒçš„å†™äº‹ä»¶çš„é›†åˆï¼›\n    4. exceptfdså‚æ•°selectå…³å¿ƒçš„å¼‚å¸¸äº‹ä»¶çš„é›†åˆï¼›\n    5. timeoutå‚æ•°è®¾ç½®selectçš„è¶…æ—¶æ—¶é—´ã€‚\n2. è¿”å›å€¼\n    1. é›†åˆä¸­æœ‰äº‹ä»¶å°±ç»ªçš„æè¿°ç¬¦çš„ä¸ªæ•°\n    2. ä½†æ˜¯å¹¶æ²¡æœ‰å‘Šè¯‰ä½ å…·ä½“æ˜¯å“ªä¸€ä¸ªæè¿°ç¬¦å°±ç»ª\n### fd_setç»“æ„ä½“\n\n```c\n#include<typesizes.h>\n#define __FD_SETSIZE 1024\n\n#include<sys/select.h>\n#define FD_SETSIZE __FD_SETSIZE\ntypedef long int __fd_mask;\n#undef __NFDBITS\n#define __NFDBITS (8*(int)sizeof(__fd_mask))\ntypedef struct\n{\n#ifdef __USE_XOPEN\n    __fd_mask fds_bits[__FD_SETSIZE / __NFDBITS];\n#define __FDS_BITS(set) ((set)->fds_bits)\n#else\n    __fd_mask __fds_bits[__FD_SETSIZE / __NFDBITS];\n#define __FDS_BITS(set) ((set)->__fds_bits)\n#endif\n}fd_set;\n```\n\nå…¶ä¸­ï¼Œ__FD_SETSIZEæŒ‡å‡ºselectå¯ä»¥å…³æ³¨çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦ä¸ªæ•°ï¼Œé»˜è®¤ä¸º1024ã€‚\n\n__fd_maskè¢«å®šä¹‰ä¸ºlong intçš„ç±»å‹åˆ«ç§°ï¼Œlong intåœ¨32ä½æœºå 8ä¸ªå­—èŠ‚ã€‚\n\n\\_\\_NFDBITSè®¡ç®—çš„æ˜¯1ä¸ª\\_\\_fd\\_maskå…ƒç´ æ‰€å ç”¨çš„ä½æ•°ï¼Œä¸€ä¸ªå­—èŠ‚å 8ä½ï¼Œsizeofç®—å‡º\\_\\_fd_maskçš„å­—èŠ‚æ•°ï¼Œç›¸ä¹˜å¾—å…¶å ç”¨çš„bitå¤§å°ã€‚\n\næ¥ç€ï¼Œå®šä¹‰fds_bitsï¼Œå…¶æ˜¯long intå‹çš„æ•°ç»„ï¼Œæ•°ç»„å¤§å°ä¸º\\_\\_FD\\_SETSIZEé™¤ä»¥\\_\\_NFDBITSã€‚æ¯”å¦‚SETSIZEä¸º1024ä½ï¼ŒNFDBITSæ˜¯64ä½ï¼Œåˆ™æ•°ç»„å¤§å°ä½1024/64=16ã€‚è¿™é‡Œçš„è®¡ç®—ä¸»è¦æ˜¯ä¸ºäº†è®¡ç®—å‡ºæ•°ç»„çš„å¤§å°ï¼Œä»¥ç¡®å®šå¤šå¤§çš„æ•°ç»„å¯ä»¥æ­£å¥½å®¹çº³1024ä¸ªä½æ•°ï¼Œæ¥è®°å½•æ–‡ä»¶æè¿°ç¬¦ä¿¡æ¯ã€‚\n### ç”¨åˆ°çš„å®å‡½æ•°\n\nfd_seté›†åˆå¯¹äºæ–‡ä»¶æè¿°ç¬¦çš„ç®¡ç†æ˜¯æŒ‰ä½è¿›è¡Œçš„ï¼Œè€Œä½åªæœ‰0å’Œ1ä¸¤ç§çŠ¶æ€ã€‚\n\nå‡å¦‚SETSIZE=1024ï¼Œåˆ™å¯ç®¡ç†1024ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æœæ–‡ä»¶æè¿°ç¬¦7æœ‰æ•ˆï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä½æ“ä½œï¼Œä½¿å…¶ä½å˜ä¸º1ã€‚\n\nç”±äºä½æ“ä½œè¿‡äºç¹çï¼Œselect APIä¸­æä¾›äº†ä¸€ç³»åˆ—å®å‡½æ•°æ¥æ–¹ä¾¿æˆ‘ä»¬è®¿é—®ã€æ“ä½œfd_seté›†åˆçŠ¶æ€ã€‚\n\n```c\n#include<sys/select.h>\nFD_ZERO(fd_set *fdset);\t\t\t\t/*æ¸…é™¤fdsetçš„æ‰€æœ‰ä½*/\nFD_SET(int fd, fd_set *fdset);\t\t/*è®¾ç½®fdsetçš„ä½fd*/\nFD_CLR(int fd, fd_set *fdset);\t\t/*æ¸…é™¤fdsetçš„ä½fd*/\nint FD_ISSET(int fd, fd_set *fdset);/*æµ‹è¯•fdsetçš„ä½fdæ˜¯å¦è¢«è®¾ç½®*/\n```\n### selectç¼–ç¨‹æ€è·¯\n\næœ€å¥½å¦å¤–å®šä¹‰ä¸€ä¸ªæ•´å‹æ•°ç»„ï¼Œå…¶å¤§å°ä¸ºæˆ‘ä»¬é¢„æµ‹å°†è¦å‡ºç°çš„æè¿°ç¬¦çš„æœ€å¤šæ•°ç›®ã€‚ç”¨ä½œæˆ‘ä»¬å­˜æ”¾æè¿°ç¬¦çš„å®¹å™¨ã€‚åˆå§‹åŒ–æ—¶å°†æ•°ç»„å€¼ä¸€å¾‹è®¾ä¸º-1ï¼Œè¡¨ç¤ºå®¹å™¨ä¸­è¯¥ä½ç½®è¿˜æ²¡æœ‰å­˜æ”¾æè¿°ç¬¦ã€‚å¦‚æœåœ¨æŸä¸€æ—¶åˆ»æœ‰ä¸€ä¸ªæè¿°ç¬¦æœ‰äº†æ¶ˆæ¯ï¼Œæˆ‘ä»¬å°±å°†è¯¥æè¿°ç¬¦æ•°å€¼è¦†ç›–åˆ°è¿™ä¸ªå®¹å™¨ä¸­ç¬¬ä¸€ä¸ªä¸º-1çš„åœ°æ–¹ã€‚\n\n```c\n#define MAX 10\nvoid fds_init(int fds[])\n{\n    for(int i = 0;i<MAX;++i)\n    {\n        fds[i] = -1;\n    }\n}\nvoid fds_add(int fd, int fds[])//å‘fdså®¹å™¨ä¸­æ·»åŠ æè¿°ç¬¦fd\n{\n    if(fd<0)\n    {\n        printf(\"æ— æ•ˆçš„æè¿°ç¬¦\\n\");\n        return;\n    }\n    for(int i = 0;i<MAX;++i)\n    {\n        if(fds[i]==-1)\n        {\n            fds[i] = fd;\n            return;\n        }\n    }\n    printf(\"å®¹å™¨å·²æ»¡ï¼Œæ— æ³•æ·»åŠ è¯¥æè¿°ç¬¦\\n\");\n}\nvoid fds_del(int fd, int fds[])\n{\n    for(int i = 0;i<MAX;++i)\n    {\n        if(fds[i]==fd)\n        {\n            fds[i] = -1;\n            return;\n        }\n    }\n    printf(\"æ²¡æœ‰æ‰¾åˆ°è¯¥æè¿°ç¬¦\\n\");\n}\nint main()\n{\n    int fds[MAX];\n    fds_init(fds);\n}\n```\n#### ç¤ºä¾‹--TCPæœåŠ¡ä½¿ç”¨selectå¤„ç†å¤šä¸ªå¥—æ¥å­—\n\n```c\nint main()\n{\n    int sockfd = socket_init();//socket_initå°è£…äº†bind(ip:port)çš„æ“ä½œï¼Œè¿˜å°è£…äº†å¯¹sockfdè¿›è¡Œlistençš„æ“ä½œï¼Œå¹¶è®¾ç½®äº†ç›‘å¬é˜Ÿåˆ—å¤§å°ã€‚\n    assert(sockfd!=-1);\n    \n    int fds[MAX];\n    fds_init(fds);\n    \n    fds_add(sockfd, fds);\n    \n    fd_set fdset;//æ­¤å¤„çš„fd_setå³<sys/select.h>åº“ä¸­APIæä¾›çš„fd_setç»“æ„ä½“\n    while(1)//å°†fds[MAX]ä¸­æ‰€æœ‰æœ‰æ•ˆçš„(å³>=0)æè¿°ç¬¦å…¨éƒ¨â€œåŠ å…¥â€fdsetä¸­ï¼Œå³æŠŠfdsetä¸­ä¸æŸæœ‰æ•ˆæè¿°ç¬¦å¯¹åº”çš„[ä½]çš„çŠ¶æ€è®¾ä¸º1ã€‚\n    {\n        FD_ZERO(&fdset);\n        int maxfd = -1;//è®°å½•å½“å‰æœ€å¤§çš„æè¿°ç¬¦æ•°å€¼æ˜¯å¤šå°‘ï¼Œæ–¹ä¾¿è¿‡åè°ƒç”¨selectä¼ å…¥ç¬¬ä¸€ä¸ªå‚æ•°nfdsã€‚\n        for(int i = 0;i<MAX;++i)\n        {\n            if(fds[i]==-1)continue;\n            FD_SET(fds[i],fdset);\n            if(maxfd<fds[i])//å¯»æ‰¾æœ€å¤§æè¿°ç¬¦æ•°å€¼\n            {\n                maxfd = fds[i];\n            }\n        }\n    \t//æ­¤æ—¶ï¼Œæˆ‘ä»¬å·²ç»æŠŠå¼€å§‹åˆ›å»ºçš„sockfdæ·»åŠ åˆ°äº†fdsetä¸­ã€‚ä¸‹é¢å°±å¯ä»¥ç”¨selectæ¥ç›‘æµ‹è¯¥å¥—æ¥å­—æ˜¯å¦æœ‰æ¶ˆæ¯äº†ã€‚æ¯”å¦‚ï¼Œsockfdç›‘å¬åˆ°äº†å®¢æˆ·ç«¯çš„connectä¿¡æ¯ï¼Œåˆ™selectå°±å¯ä»¥æ¢æµ‹åˆ°fdsetä¸­å¯¹åº”çš„sockfdä½å¤„äºæ¶ˆæ¯å°±ç»ªæ€ï¼Œåˆ™selectå°±å¯ä»¥ä¸å†é˜»å¡ï¼Œç«‹é©¬è¿”å›ã€‚\n        struct timeval tv = {5,0};\n        int n = select(maxfd+1,&fdset,NULL,NULL,&tv);//è¿”å›åœ¨fdseté›†åˆä¸­æœ‰ä¿¡æ¯çš„æè¿°ç¬¦çš„ä¸ªæ•°ã€‚\n        if(n<0)printf(\"select err\\n\");\n        else if(n == 0)printf(\"time out\\n\");\n        else\n        {\n            for(int i = 0;i<MAX;++i)//ä¾ç„¶éœ€è¦æ ¹æ®fdsetè¿›è¡ŒæŸ¥è¯¢ç›®å‰æ˜¯å“ªä¸ªæè¿°ç¬¦æœ‰äº‹ä»¶äº§ç”Ÿï¼Œfdsetçš„è¿‡æ»¤åˆéœ€è¦æ ¹æ®fdsçš„è®°å½•è¿›è¡Œéå†ã€‚\n            {\n                if(fds[i]==-1)continue;\n                if(FD_ISSET(fds[i],&fdset))//æ­¤å¤„åˆ¤æ–­ISSETå³æ˜¯åˆ¤æ–­æˆ‘ä»¬å…³æ³¨çš„æè¿°ç¬¦æ˜¯å¦æœ‰äº‹ä»¶äº§ç”Ÿã€‚ä¸ºä»€ä¹ˆæ­¤æ—¶æ ‡å¿—ä½ä¸º1ä¸€å®šæœ‰äº‹ä»¶äº§ç”Ÿï¼Ÿ--å› ä¸ºåœ¨è¿™ä¹‹å‰æˆ‘ä»¬è¿›è¡Œäº†selectï¼Œselectä¸ä»…è¯´æ˜æœ‰äº‹ä»¶äº§ç”Ÿï¼Œå®ƒè¿˜åšäº†æ›´å¤šçš„å·¥ä½œï¼šå°†æˆ‘ä»¬å…³å¿ƒçš„æè¿°ç¬¦å´åœ¨å…¶ä¸Šæ²¡æœ‰äº‹ä»¶äº§ç”Ÿçš„æ ‡å¿—ä½ç½®0ã€‚å› æ­¤ç›®å‰æ‰€æœ‰æ ‡å¿—ä½ä¸º1çš„æè¿°ç¬¦å‡æœ‰äº‹ä»¶ã€‚\n                {\n                    //ä»¥ä¸‹æ‰æ˜¯æ ¸å¿ƒçš„ä¸šåŠ¡ä»£ç ï¼ŒæŠ“ä½äº†æœ‰äº‹ä»¶äº§ç”Ÿçš„æè¿°ç¬¦ï¼Œå¯¹è¿™äº›æè¿°ç¬¦æˆ‘ä»¬çš„å¤„ç†æµç¨‹ï¼Œå¯¹äºä¸åŒç±»å‹çš„æè¿°ç¬¦ï¼Œéœ€è¦ä¸åŒçš„å¤„ç†æµç¨‹ã€‚æ¯”å¦‚sockfdç”¨acceptå¤„ç†ï¼Œacceptè¿”å›ä¸€ä¸ªæ–°çš„æè¿°ç¬¦cï¼Œåˆ™å…ˆå°†å…¶åŠ å…¥fdså®¹å™¨ï¼Œä¸‹ä¸€è½®å†ç”¨recvå¤„ç†æè¿°ç¬¦cçš„æ¶ˆæ¯ã€‚\n                    if(fds[i] == sockfd)//å¤„ç†ç›‘å¬å¥—æ¥å­—sockfd\n                    {\n                        struct sockaddr_in caddr;\n                        int len = sizeof(caddr);\n                        int c = accept(sockfd,(struct sockaddr*)&caddr,&len);\n                        if(c<0)continue;\n                        printf(\"accept c = %d\\n\",c);\n                        fds_add(c,fds);//åªæ˜¯å…ˆæ”¶é›†åˆ°fdså®¹å™¨ä¸­ï¼Œä¸‹ä¸€æ¬¡çš„whileæ‰«ææ‰å°†cæ·»åŠ åˆ°fdseté›†åˆä¸­ã€‚\n                    }\n                    else//å¤„ç†æ”¶å‘å¥—æ¥å­—ï¼Œåœ¨æ­¤ç¨‹åºï¼Œé™¤äº†sockfdçš†ä¸ºæ”¶å‘å¥—æ¥å­—c\n                    {\n                        char buff[128] = {0};\n                        int num = recv(fds[i],buff,127,0);\n                        if(num <= 0)\n                        {\n                            printf(\"client close\\n\");\n                            close(fds[i]);\n                            fds_del(fds[i],fds);\n                        }\n                        else//num > 0ï¼Œè¯»åˆ°äº†æ•°æ®\n                        {\n                            printf(\"recv(c = %d) = %s\\n\",fds[i],buff);\n                            send(fds[i],\"ok\",2,0);\n                        }\n                    }\n                }\n            }\n        }\n    }//while end\n}\n```\n\nåœºæ™¯æƒ…å†µï¼šå¦‚æœå®¢æˆ·ç«¯ä¸selectæœåŠ¡ç«¯å·²å»ºç«‹è¿æ¥ï¼Œè€Œå®¢æˆ·ç«¯è¿›ç¨‹ç»“æŸï¼Œselectä¼šä¸€ç›´é˜»å¡ã€æœªæ„ŸçŸ¥å—ï¼Ÿ--ä¸ä¼šã€‚\n\nå› ä¸ºå®¢æˆ·ç«¯çš„è¿›ç¨‹ç»“æŸï¼Œä¹Ÿç®—æ˜¯ä¸€ç§è¯»äº‹ä»¶ï¼Œç›¸å½“äºé€šçŸ¥æœåŠ¡ç«¯è¯¥å¥—æ¥å­—è¿æ¥ç»“æŸäº†ã€‚é‚£ä¹ˆæœåŠ¡ç«¯recvä¼šè¿”å›0ï¼Œè¾¾åˆ°å…³é—­è¯¥å¥—æ¥å­—çš„æ¡ä»¶ï¼Œå…³é—­åï¼Œåˆ«å¿˜äº†åœ¨fdså®¹å™¨ä¸­åˆ é™¤æ‰è¯¥æè¿°ç¬¦ã€‚\n\nå¦‚æœå¿˜è®°äº†closeè¯¥å¥—æ¥å­—ï¼Œä¸”å¿˜äº†fds_delè¯¥æè¿°ç¬¦ï¼Œé‚£ä¹ˆå¦‚æœå®¢æˆ·ç«¯ç»“æŸè¿›ç¨‹ï¼ŒæœåŠ¡ç«¯å°±ä¼šä¸€ç›´æ‰“å°\"client close\"ï¼Œå› ä¸ºselectä¸€ç›´åœ¨æ¢æµ‹æ­¤æè¿°ç¬¦æœ‰æ— è¯»äº‹ä»¶ï¼Œè‹¥è¯¥å¥—æ¥å­—è¿æ¥å…³é—­ï¼Œé‚£ä¹ˆæ­¤æè¿°ç¬¦ä¸€ç›´æœ‰è¯»äº‹ä»¶ï¼Œrecvè¿”å›0ï¼Œç”±äºæ²¡æœ‰fds_delï¼Œæ¯æ¬¡éƒ½ä¼šå…³æ³¨ï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½ä¼šæ‰“å°\"client close\"ã€‚\n## poll\n\nå¯ä»¥ç†è§£ä¸ºåŠ å¼ºç‰ˆçš„selectã€‚\n\nå…ˆè§‚å¯Ÿå…¶API\n\n```c\n#include<poll.h>\nint poll(struct pollfd* fds, nfds_t nfds, int timeout);\n```\n\n1. fdså‚æ•°æ˜¯ä¸€ä¸ªpollfdç»“æ„ç±»å‹çš„æŒ‡é’ˆï¼Œå¯æŒ‡å‘ä¸€æ®µè¿ç»­ç©ºé—´ï¼ˆæ•°ç»„ï¼‰ï¼Œå› æ­¤å¾ˆçµæ´»ï¼Œå¤§å°å¯æŒ‰éœ€å£°æ˜ã€‚å®ƒå¯ä»¥æŒ‡å®šæˆ‘ä»¬æ„Ÿå…´è¶£çš„æ–‡ä»¶æè¿°ç¬¦ä¸Šå‘ç”Ÿçš„å¯è¯»ã€å¯å†™å’Œå¼‚å¸¸ç­‰äº‹ä»¶ã€‚å®šä¹‰å¦‚ä¸‹\n\n```c\nstruct pollfd\n{\n    int fd;\t\t\t//æ–‡ä»¶æè¿°ç¬¦\n    short events;\t//æ³¨å†Œçš„äº‹ä»¶ç±»å‹ï¼ŒæŒ‰ä½æ ‡å¿—\n    short revents;\t//å®é™…å‘ç”Ÿçš„äº‹ä»¶ï¼ŒæŒ‰ä½æ ‡å¿—ï¼Œç”±å†…æ ¸å¡«å……\n};\n```\n\n   1. å…¶ä¸­ï¼Œfdæˆå‘˜æŒ‡å®šæ–‡ä»¶æè¿°ç¬¦ã€‚\n   2. eventsæˆå‘˜å‘Šè¯‰pollç›‘å¬fdä¸Šçš„å“ªäº›äº‹ä»¶ç±»å‹ï¼Œä»–å¯ä»¥æ˜¯ä¸€ç³»åˆ—äº‹ä»¶ç±»å‹çš„**æŒ‰ä½æˆ–**ã€‚å¸¸è§çš„äº‹ä»¶ç±»å‹æœ‰ï¼šPOLLIN(æ•°æ®å¯è¯»)ã€POLLOUT(æ•°æ®å¯å†™)ã€‚\n   3. reventsæˆå‘˜ç”±å†…æ ¸ä¿®æ”¹ï¼Œä»¥é€šçŸ¥åº”ç”¨ç¨‹åºfdä¸Šå®é™…å‘ç”Ÿäº†å“ªäº›äº‹ä»¶ã€‚\n### pollç¼–ç¨‹\n\n```c\nvoid poll_fds_init(struct pollfd* fds)\n{\n    for(int i = 0;i<MAX;++i)\n    {\n        fds[i].fd = -1;\n        fds[i].events = 0;\n        fds[i].revents = 0;\n    }\n}\nvoid poll_fds_add(int fd, struct pollfd* fds)\n{\n    for(int i = 0;i<MAX;++i)\n    {\n        if(fds[i].fd == -1)\n        {\n            fds[i].fd = fd;\n            fds[i].events = POLLIN;//åªå…³æ³¨è¯»äº‹ä»¶\n            fds[i].revents = 0;\n            break;\n        }\n    }\n}\nvoid poll_fds_del(int fd, struct pollfd* fds)\n{\n    for(int i = 0;i<MAX;++i)\n    {\n        if(fds[i].fd == fd)\n        {\n            fds[i].fd = -1;\n            fds[i].events = 0;\n            fds[i].revents = 0;\n            break;\n        }\n    }\n}\n#define MAX 10\nint main()\n{\n    int sockfd = socket_init();\n    assert(sockfd != -1);\n    struct pollfd poll_fds[MAX];\n    poll_fds_init(poll_fds);\n    poll_fds_add(sockfd,poll_fds);\n    while(1)\n    {\n        int n = poll(poll_fds,MAX,5000);//5000ms timeout \n        if(n < 0)printf(\"poll error\\n\");\n        else if(n == 0)printf(\"time out \\n\");\n        else\n        {\n            for(int i = 0;i<MAX;++i)\n            {\n                if(poll_fds[i].fd == -1)continue;\n                //short has 16bits,POLLIN is 10000000 ...,\n                //when revents is 10000000 ...,then the read event is going\n                if(poll_fds[i].revents & POLLIN)//revents & POLLIN ä¸ä¸º0 åˆ™ä»£è¡¨æœ‰è¯»äº‹ä»¶äº§ç”Ÿ\n                {\n                    if(poll_fds[i].fd == sockfd)\n                    {\n                        struct sockaddr_in caddr;\n                        int len = sizeof(caddr);\n                        int c = accept(sockfd,(struct sockaddr*)&caddr,&len);\n                        if(c<0)continue;\n                        printf(\"accept:%d\\n\",c);\n                        poll_fds_add(c,poll_fds);\n                    }\n                    else\n                    {\n                        char buff[128] = {0};\n                        int num = recv(poll_fds[i].fd,buff,127,0);\n                        if(num <=0)\n                        {\n                            close(poll_fds[i].fd);\n                            poll_fds_del(poll_fds[i].fd,poll_fds);\n                            printf(\"client close\\n\");\n                        }\n                        else\n                        {\n                            printf(\"recv(%d):%s\\n\",poll_fds[i].fd,buff);\n                            send(poll_fds[i].fd,\"ok\",2,0);\n                        }\n                    }\n\n                }\n                if(poll_fds[i].revents & POLLOUT)\n                {\n\t\t\t\t\t//...\n                }\n            }\n        }\n    }    \n}\n```\n\nä¸selectçš„ä¸€å¤„ç»†èŠ‚åŒºåˆ«ï¼š\n\næ¯æ¬¡selecté™¤äº†ç›‘æµ‹fd_setæœ‰æ•ˆæè¿°ç¬¦ä¸Šæœ‰æ— äº‹ä»¶ï¼Œå…¶æ¬¡è¿˜å°†æ²¡æœ‰äº‹ä»¶çš„æè¿°ç¬¦ä»fd_setç§»é™¤ï¼ˆå…¶å®æ˜¯å°†è¯¥æè¿°ç¬¦å¯¹åº”åœ¨fd_setä¸Šçš„ä½è¿›è¡Œç½®0æ“ä½œï¼‰ï¼ˆ**è¿™æ ·å°±å¾—æ¯æ¬¡selectä¹‹å‰éƒ½è¦é‡æ–°æ³¨å†Œä¸€éæˆ‘ä»¬å…³æ³¨çš„æè¿°ç¬¦ï¼ˆå³ç”¨æˆ·å’Œå†…æ ¸å…±åŒæ“ä½œFD_SETã€FD_CLRç­‰ï¼‰ã€‚**ï¼‰ï¼Œç„¶åä¸‹é¢è¿‡æ»¤æœ‰äº‹ä»¶çš„æè¿°ç¬¦æ—¶ï¼Œåªè¦æ‰¾åˆ°fd_seté›†åˆå“ªä¸ªä½æ˜¯1çŠ¶æ€å³å°±æ‰¾åˆ°äº†æœ‰äº‹ä»¶äº§ç”Ÿçš„æè¿°ç¬¦ã€‚\n\nè€Œpollçš„ç”¨æ³•æ˜¯ï¼šç”¨æˆ·åªç®¡æ³¨å†Œeventsï¼Œå®é™…ä¸Šçš„æœ‰æ— äº‹ä»¶**ç”±å†…æ ¸æ¥è¿›è¡Œå¯¹reventsçš„å¡«å……**ï¼Œä»¥æ­¤æ¥æ›´å¥½åœ°åŒºåˆ«è¯¥æè¿°ç¬¦æ˜¯å¦æœ‰äº‹ä»¶äº§ç”Ÿã€‚**è¿™æ ·ï¼Œå°±ä¸ç”¨åœ¨æ¯æ¬¡pollä¹‹å‰é‡æ–°æ³¨å†Œä¸€éæˆ‘ä»¬å…³æ³¨çš„æè¿°ç¬¦çš„ç»“æ„ä½“é‡Œçš„eventsäº†**ã€‚æˆ‘ä»¬åªè¦æŠŠè¦å…³å¿ƒçš„æè¿°ç¬¦çš„fdç½®æˆé-1ï¼Œä»¥åŠç®¡ç†å¥½è¦å…³å¿ƒçš„å“ªäº›äº‹ä»¶ç±»å‹eventså³å¯ã€‚\n### ä¸selectç›¸æ¯”çš„ä¼˜ç‚¹\n\n1. å¯ä»¥ç›‘å¬çš„æè¿°ç¬¦çš„æœ€å¤§æ•°ç›®å¯ä»¥è¶…è¿‡1024ä¸ªï¼Œå¤§å°æŒ‰éœ€è‡ªæ‹Ÿã€‚\n2. å¯ä»¥ç›‘å¬çš„äº‹ä»¶ç±»å‹æ•°ç›®å˜å¤šã€å˜ç»†äº†ï¼Œæ›´å¼ºå¤§äº†ã€‚\n3. **ä¸ç”¨**åœ¨æ¯æ¬¡pollä¹‹å‰**é‡æ–°æ³¨å†Œ**ä¸€éæˆ‘ä»¬å…³æ³¨çš„æè¿°ç¬¦çš„ç»“æ„ä½“é‡Œçš„eventsäº†\n## epoll\n\nepollæ˜¯Linuxç‰¹æœ‰çš„I/Oå¤ç”¨å‡½æ•°ã€‚\n\nepollçš„ä½¿ç”¨å®é™…ä¸Šä¸æ˜¯å•ç‹¬çš„APIï¼Œè€Œæ˜¯æœ‰ä¸€ç»„å‡½æ•°æ¥å®Œæˆã€‚ä¸‰ä¸ªå‡½æ•°ï¼š\n\n```c\n#include<sys/epoll.h>\nint epoll_create(int size);\nint epoll_ctl(int epfd, int op, int fd, struct epoll_event *event);\nint epoll_wait(int epfd, struct epoll_event* events, int maxevents, int timeout);\n```\n\n### å†…æ ¸äº‹ä»¶è¡¨\n\nepollçš„æœ€å¤§ä¼˜åŠ¿åœ¨äºå¤„ç†æè¿°ç¬¦ç‰¹åˆ«å¤šçš„æƒ…å†µï¼Œç›¸æ¯”è½®è¯¢æ–¹å¼ï¼š\n\n1. å¦‚æœç”¨ä¼ ç»Ÿçš„selectã€pollå•çº¯çš„é¡ºåºè½®è¯¢æ–¹æ³•ç›‘æµ‹å°±ç»ªçš„æè¿°ç¬¦ï¼Œé‚£ä¹ˆæ€§èƒ½ä¼šå¾ˆä½ä¸‹çš„ã€‚\n2. è€Œä¸”è™½ç„¶selectã€pollèƒ½é¡ºåˆ©æŸ¥å‡ºæœ‰å‡ ä¸ªæè¿°ç¬¦ä¸Šæœ‰äº‹ä»¶äº§ç”Ÿï¼Œä½†æ˜¯æ˜¯å“ªä¸ªæè¿°ç¬¦ï¼Ÿå¹¶æ²¡æœ‰å‘Šè¯‰æˆ‘ä»¬ï¼Œæ‰€ä»¥åˆå¾—æµªè´¹ä¸€è½®æ—¶é—´æ¥æŸ¥æ‰¾äº§ç”Ÿæ—¶é—´æ˜¯å“ªä¸ªæè¿°ç¬¦ã€‚","categories":["Linux","ç½‘ç»œ"]},{"title":"Cpp_æ™ºèƒ½æŒ‡é’ˆ","url":"/Cpp/Cpp_æ™ºèƒ½æŒ‡é’ˆ/","content":"`C++`ä¸­çš„æ™ºèƒ½æŒ‡é’ˆå®šä¹‰äº`<memory>`ä¸­ã€‚\n# å†…å®¹\n1. RAII\n2. auto_ptr\n3. unique_ptr\n4. shared_ptr\n5. weak_ptr\n# RAII\n\nå †ä¸Šç©ºé—´è¿›è¡Œè‡ªåŠ¨åŒ–ç®¡ç†ï¼Œåˆ©ç”¨å¯¹è±¡è‡ªåŠ¨ææ„çš„æœºåˆ¶ã€‚\n\n# auto_ptr\nè¿™æ˜¯æ—§ç‰ˆæœ¬çš„æ™ºèƒ½æŒ‡é’ˆï¼Œåœ¨`C++11`ä¹‹åè¢«åºŸå¼ƒã€‚\n\n1. ä¸èƒ½ä½¿ç”¨åŒä¸€ä¸ªè£¸æŒ‡é’ˆèµ‹å€¼/åˆå§‹åŒ–å¤šä¸ª`auto_ptr`ã€‚\n2. æ‹·è´æ„é€ å’Œç­‰å·è¿ç®—ç¬¦ï¼Œä¼šå°†æºæ™ºèƒ½æŒ‡é’ˆç½®ç©ºã€‚\n3. release(): è¿”å›å½“å‰æŒ‡å‘çš„åœ°å€ï¼ˆå­˜åˆ°tmpä¸­ï¼‰ï¼Œå¹¶å°†å½“å‰æ™ºèƒ½æŒ‡é’ˆç½®ç©º\n4. reset(): å°†å½“å‰æ™ºèƒ½æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜é‡Šæ”¾ï¼ŒæŒ‡é’ˆç½®ç©ºã€‚\n\n## é—®é¢˜\n\n### æ‹·è´æ„é€ å‡½æ•°æ„ä¹‰ä¸æ˜ç¡®\n1. å¦‚æœæ‹·è´æ„é€ æŒ‰æµ…æ‹·è´å½¢å¼è¿›è¡Œï¼Œåˆ™ä¼šå¯¼è‡´é‡å¤ææ„ï¼Œå´©æºƒã€‚\n2. å¦‚æœæ‹·è´æ„é€ æŒ‰**è½¬ç§»èµ„æº**è¿›è¡Œï¼Œåˆ™ä¼šå¯¼è‡´æ„æƒ³ä¸åˆ°çš„ä¸¥é‡åæœï¼šå¦‚ä»¥ä¸‹ä»£ç ï¼Œåœ¨è°ƒç”¨funå‡½æ•°æŒ‰å€¼ä¼ å…¥`my_auto_ptr`å¯¹è±¡æ—¶ï¼Œè°ƒç”¨æ‹·è´æ„é€ ï¼Œæ‹·è´æ„é€ é‡Šæ”¾è‡ªå·±çš„æ‹¥æœ‰æƒï¼Œç»™äº†apxã€‚åœ¨funå‡½æ•°å¤–å†æ‰¾åŸæŒ‡é’ˆæ—¶ï¼ŒåŸå¯¹è±¡çš„æŒ‡é’ˆä¿¡æ¯å·²ä¸¢å¤±ã€‚\n\n```c++\nclass my_auto_ptr\n{\npublic:\n    my_auto_ptr(const my_auto_ptr& op)\n        : _Owns(op._Owns), _Ptr(op.release())\n    {\n    }\n    \n    _Ty* release() const\n    {\n        _Ty* tmp = NULL;\n        if (_Owns)\n        {\n            _Owns = false;\n            tmp = _Ptr;\n            _Ptr = NULL;\n        }\n        return tmp;\n    }\n};\n    void fun(my_auto_ptr<Object> apx)\n    {\n        int x = apx->Value();\n        cout << x << endl;\n    }\nint main()\n{\n    my_auto_ptr<Object> pobja(new Object(10));\n    fun(pobja);\n    int a = pobja->Value();//error!\n    cout << a << endl;\n}\n```\n### èµ‹å€¼é‡è½½æ„ä¹‰ä¸æ˜ç¡®\n```c++\nclass my_auto_ptr\n{\npublic:\n    my_auto_ptr & operator=(const my_auto_ptr& _Y)\n    {\n        if(this == & _Y)return *this;\n        if(_Owns){delete _Ptr;}\n        _Owns = _Y._Owns;\n        _Ptr = _Y.release();\n    }\n    _Ty* release() const\n    {\n\t\t_Ty* tmp = NULL;\n\t\tif (_Owns)\n\t\t{\n\t\t\t_Owns = false;\n\t\t\ttmp = _Ptr;\n\t\t\t_Ptr = NULL;\n\t\t}\n\t\treturn tmp;\n    }\n};\nvoid fun(my_auto_ptr<Object> apx)\n{\n    int x = apx->Value();\n    cout << x << endl;\n}\nint main()\n{\n    my_auto_ptr<Object> pobja(new Object(10));\n    fun(pobja);\n    int a = pobja->Value();//error!\n    cout << a << endl;\n}\n```\n# unique_ptr\nä»¥ä¸‹æ˜¯ä¼ ç»Ÿçš„ä¸ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆçš„å†™æ³•ã€‚\n```cpp\n#include <iostream>\n#include <memory>\nclass Test\n{\npublic:\n    Test(void)\n    {\n        std::cout << \"Test()\" << std::endl;\n    }\n    ~Test()\n    {\n        std::cout << \"~Test()\" << std::endl;\n    }\n    void show(void) const\n    {\n        std::cout << \"show()\" << std::endl;\n    }\n};\nvoid foo()\n{\n    Test * test = new Test;\n    test->show();\n    delete test;\n    test = nullptr;\n}\nint main()\n{\n    foo();\n    return 0;\n}\n```\nå¦‚ä»Šä¸æ¨èè¿™ä¹ˆå†™äº†ï¼Œ\nå¦‚ä½•å®ç°è®©testå¯¹è±¡ä¸€å‡ºfooå‡½æ•°å°±è‡ªåŠ¨ææ„å‘ƒå‘¢ï¼Ÿä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆè§£å†³ã€‚\n```cpp\nvoid foo()\n{\n    std::unique_ptr<Test> test{ new Test };\n    test->show();\n    // ä¸ç”¨é‡Šæ”¾äº†ï¼Œä¸ç”¨ç½®ç©ºäº†ã€‚\n}\n```\nç”¨æ™ºèƒ½æŒ‡é’ˆç®¡ç†æ—¶ï¼Œå°±ä¸ç”¨æ‰‹åŠ¨é‡Šæ”¾newå‡ºæ¥çš„Testå¯¹è±¡äº†ï¼Œå› ä¸ºæ™ºèƒ½æŒ‡é’ˆæ˜¯åœ¨æ ˆä¸Šå»ºç«‹çš„ï¼Œå‡½æ•°è°ƒç”¨ç»“æŸåæ ˆå¸§ææ„æ—¶ï¼Œæ™ºèƒ½æŒ‡é’ˆå°±ä¼šè‡ªåŠ¨ææ„ï¼Œä»è€ŒæŠŠç»‘å®šçš„å¯¹è±¡ä¹Ÿææ„ã€‚\n## ç‰¹æ€§ï¼šunique\n\n1. æŠŠæ‹·è´æ„é€ å‡½æ•°ç¦ç”¨äº†ã€‚\n2. å¦‚æœæƒ³è¦è¿ç§»åŸæ™ºèƒ½æŒ‡é’ˆï¼Œå¯ä»¥ç”¨move\n```cpp\nvoid foo()\n{\n    std::unique_ptr<Test> test{ new Test };\n    std::unique_ptr<Test> test2 = std::move(test);\n    if (test)\n        test->show();\n    if (test2)\n        test2->show();\n}\n```\n# æ–¹æ³•\næ™ºèƒ½æŒ‡é’ˆå¯¹è±¡çš„`->`å¯¹åº”çš„æ˜¯å…¶æŒæœ‰å¯¹è±¡çš„æ–¹æ³•ã€‚\n`.`å‡ºæ¥çš„æ–¹æ³•æ‰æ˜¯å…¶æœ¬èº«æ‹¥æœ‰çš„æ–¹æ³•ã€‚\n## releaseï¼ˆä¸ææ„æ—§å¯¹è±¡ï¼‰\n```cpp\npointer release() noexcept;\n```\né‡Šæ”¾ç®¡ç†æƒï¼Œè¿”å›å…¶æŒæœ‰å¯¹è±¡çš„æŒ‡é’ˆã€‚\næ™ºèƒ½æŒ‡é’ˆä¸å†ç®¡ç†è¯¥å¯¹è±¡ï¼Œç¨‹åºå‘˜éœ€è¦è‡ªå·±å¤„ç†ææ„ã€‚\n```c++\nclass Test\n{\npublic:\n    Test(void)\n    {\n        std::cout << \"Test()\" << std::endl;\n    }\n    ~Test()\n    {\n        std::cout << \"~Test()\" << std::endl;\n    }\n    void show(void) const\n    {\n        std::cout << \"show()\" << std::endl;\n    }\nprivate:\n    int         _v{ 5 };\n};\nvoid foo()\n{\n    std::unique_ptr<Test> test{ new Test };\n    Test* raw_ptr = test.release();\n    if (test)\n        test->show();\n    delete raw_ptr;\n    raw_ptr = nullptr;\n}\nint main()\n{\n    foo();\n    return 0;\n}\n```\n## resetï¼ˆä¼šææ„æ—§å¯¹è±¡ï¼‰\n\næ¥æ”¶ä¸€ä¸ªåŒç±»å¯¹è±¡çš„æŒ‡é’ˆï¼Œæˆ–nullptrã€‚\n\nåŸæœ¬çš„æ™ºèƒ½æŒ‡é’ˆä¸å†æŒ‡å‘æ—§çš„å¯¹è±¡åœ°å€ï¼Œè½¬è€ŒæŒ‡å‘æ–°çš„å¯¹è±¡åœ°å€ã€‚\n\n1. å¦‚æœæ—§å¯¹è±¡æ²¡æœ‰å…¶ä»–æ™ºèƒ½æŒ‡é’ˆå¼•ç”¨ï¼Œåˆ™ææ„æ—§å¯¹è±¡\n2. æŒ‡å‘æ–°å¯¹è±¡æˆ–nullptr\n```cpp\nvoid foo()\n{\n    std::unique_ptr<Test> test{ new Test };\n    test.reset(new Test);\n    if (test)\n        test->show();\n}\n```\n# è‡ªå®ç°\n```cpp\ntemplate <typename T>\nclass SmartPtr\n{\npublic:\n    SmartPtr(nullptr_t) : _t{ nullptr } {}\n    SmartPtr(void) : _t{ nullptr } {}\n    SmartPtr(T* t) : _t{ t } {}\n    ~SmartPtr()\n    {\n        if (_t)\n        {\n            delete _t;\n            _t = nullptr\n        }\n    }\n    \nprivate:\n    T*           _t;\n};\nint main()\n{\n    SmartPtr test{ new Test };\n}\n```\n## å¤„ç†å¯¹è±¡æ•°ç»„\nç”¨æ¨¡æ¿ç‰¹åŒ–ã€‚\n```cpp\ntemplate <typename T>\nclass SmartPtr<T[]>\n{\npublic:\n    SmartPtr(T* t) : _t{ t } {}\n    ~SmartPtr()\n    {\n        if (_t)\n        {\n            delete [] _t;\n            _t = nullptr;\n        }\n    }\n    // ...\nprivate:\n    // ...\n};\nvoid foo()\n{\n    SmartPtr<Test[]> test{ new Test[5] };\n}\n```\n## `->`é‡è½½\n1. `->`çš„é‡è½½æ¯”è¾ƒæœ‰æ„æ€ï¼Œæˆ‘ä»¬æƒ³è¦å®ç°çš„æ•ˆæœæ˜¯`smartPtr->objFunc()`ï¼Œè€Œ`->`å…ˆè¿”å›çš„æ˜¯`obj*`ï¼Œæœ¬æ¥åº”è¯¥è¿˜éœ€è¦ä¸€ä¸ª`->`æ‰æ­£ç¡®ï¼Œä½†ç³»ç»Ÿé»˜è®¤ä¸€ä¸ª`->`å°±æ‡‚ä½ çš„æ„æ€ã€‚\n```c++\ntemplate <typename T>\nclass SmartPtr\n{\npublic:\n    // ...\n    T* operator-> (void)\n    {\n        return _t;\n    }\nprivate:\n    // ...\n};\n```\n## `boolè¿ç®—ç¬¦`é‡è½½\n```cpp\ntemplate <typename T>\nclass SmartPtr\n{\npublic:\n    // ...\n    operator bool(void)\n    {\n        return _t;\n    }\nprivate:\n    // ...\n};\nvoid foo()\n{\n    SmartPtr<Test> test{ new Test };\n    if (test)\n        test->show();\n}\n```\n## uniqueçš„è½¬ç§»\n1. ç¦ç”¨æ‹·è´æ„é€ \n2. æä¾›å³å€¼å¼•ç”¨æ‹·è´æ„é€ \n3. å®ç°ä¸€ä¸ªreleaseæ–¹æ³•ï¼Œåœ¨å³å€¼å¼•ç”¨æ‹·è´æ„é€ ä¸­å¤ç”¨\n```cpp\ntemplate <typename T>\nclass SmartPtr\n{\npublic:\n    // ...\n    SmartPtr(SmartPtr const&) = delete;\n    SmartPtr(SmartPtr && other) noexcept\n    {\n        _t = other.release();\n    }\n    T* release()\n    {\n        auto t = _t;\n        _t = nullptr;\n        return t;\n    }\nprivate:\n    // ...\n};\nvoid foo()\n{\n    SmartPtr<Test> test{ new Test };\n    SmartPtr<Test> test2 = std::move(test);\n    \n    if (test)\n        test->show();\n    if (test2)\n        test2->show();\n}\n```\n\n# shared_ptr\nå¤šä¸ªæ™ºèƒ½æŒ‡é’ˆå…±äº«ä¸€ä¸ªå¯¹è±¡ã€‚\n\næ”¯æŒæ‹·è´æ„é€ ã€‚\n\næŸä¸ª`shared_ptr`ææ„æ—¶ï¼Œæ‰€æŒæœ‰çš„å¯¹è±¡ä¸ä¼šææ„ï¼Œç›´åˆ°æ­¤å¯¹è±¡æ²¡æœ‰å…¶ä»–`shared_ptr`å¼•ç”¨ã€‚è¿™æ˜¯ç”¨å†…éƒ¨ä¾èµ–çš„å¼•ç”¨è®¡æ•°æœºåˆ¶å®ç°çš„ã€‚\n\n![](../../images/Cpp_æ™ºèƒ½æŒ‡é’ˆ/image-20240722042455549.png)\n## ä¸¤ç§æ„å»ºæ–¹å¼\n\n```c++\nint main()\n{\n    std::shared_ptr<Object> op1(new Object(10));\n    std::shared_ptr<Object> op2(std::make_shared<Object>(10));\n}\n```\n\n## æ–¹æ³•\næ²¡æœ‰releaseï¼Œåªæœ‰resetã€‚\nå¯ä»¥é€šè¿‡`reset(nullptr)`æˆ–`reset()`è¾¾åˆ°releaseçš„æ•ˆæœã€‚\n### use_count\n```cpp\nvoid foo()\n{\n    std::shared_ptr<Test> test(new Test);\n    std::cout << test.use_count() << std::endl;\n}\n```\n### owner_before\n```cpp\nvoid foo()\n{\n    std::shared_ptr<Test> test(new Test);\n    std::shared_ptr<Test> test2 = test;\n    test.reset();\n    bool is_true = test.owner_before(test2); // true\n    is_true = test2.owner_before(test);      // false\n}\n```\nå¯¹è¢«resetçš„å¯¹è±¡testæ¥è¯´ï¼Œåˆ¤æ–­æ˜¯ä¸æ˜¯ä¹‹å‰test2æ‰€æŒå¯¹è±¡çš„æ‹¥æœ‰è€…ã€‚\nè¦æƒ³è¿”å›trueéœ€è¦æ»¡è¶³ï¼š\n1. testå·²ç»è¢«reset\n2. æŒ‡å®šçš„æ™ºèƒ½æŒ‡é’ˆç¡®å®æ˜¯testä¹‹å‰æŒ‡å‘çš„å¯¹è±¡\n```cpp\nvoid foo()\n{\n    std::shared_ptr<Test> test(new Test);\n    std::shared_ptr<Test> test2 = test;\n    // test.reset();\n    bool is_true = test.owner_before(test2); // false\n}\n```\n## åº”ç”¨åœºæ™¯\nè¿”å›ä¸€ä¸ªæŒ‡é’ˆæ—¶ã€‚å³ï¼Œç”¨äºå‡½æ•°é—´ä¼ é€’æŒ‡é’ˆã€‚\nçœå»äº†ç¨‹åºå‘˜å»åˆ¤æ–­ä½•æ—¶éœ€è¦ææ„çš„éš¾é¢˜ã€‚\n```cpp\nstd::shared_ptr<Test> foo()\n{\n    std::shared_ptr<Test> test(new Test);\n    test->show();\n    return test;\n}\nint main()\n{\n    std::shared_ptr<Test> test = foo();\n    if (test)\n        test->show();\n    return 0;\n}\n```\n# weak_ptr\n```cpp\nclass B; // incomplete class\nclass A\n{\npublic:\n    A(void)\n    {\n        std::cout << \"A()\" << std::endl;\n    }\n    ~A()\n    {\n        std::cout << \"~A()\" << std::endl;\n    }\n    void set_b(std::shared_ptr<B> b)\n    {\n        _b = b;\n    }\nprivate:\n    std::shared_ptr<B> _b;\n};\nclass B\n{\npublic:\n    B(void)\n    {\n        std::cout << \"B()\" << std::endl;\n    }\n    ~B()\n    {\n        std::cout << \"~B()\" << std::endl;\n    }\n    void set_a(std::shared_ptr<A> a)\n    {\n        _a = a;\n    }\nprivate:\n    std::shared_ptr<A> _a;\n};\nvoid bar()\n{\n    std::shared_ptr<A> a(new A);\n    std::shared_ptr<B> b(new B);\n    a->set_b(b);\n    b->set_a(a);\n}\nint main()\n{\n    bar();\n    return 0;\n}\n```\nä¸Šé¢ç¨‹åºå°†è¾“å‡ºï¼š\n```\nA()\nB()\n```\næ„å‘³ç€Aã€Bå¯¹è±¡åœ¨æœ€åæ²¡æœ‰è¢«ææ„ï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚\n\næœ¬èº«aã€bæ˜¯ä¸€ä¸ªå¼•ç”¨è®¡æ•°ã€‚\nåˆå› ä¸ºä¸¤ä¸ªç±»å†…éƒ¨éƒ½å­˜åœ¨å¦ä¸€ä¸ªç±»å¯¹è±¡çš„`shared_ptr`æŒ‡é’ˆï¼Œé‚£ä¹ˆaã€bçš„å¼•ç”¨è®¡æ•°åˆä¼šå„è‡ªåŠ 1å˜æˆ2ã€‚\nbarå‡½æ•°è°ƒç”¨ç»“æŸåæ™ºèƒ½æŒ‡é’ˆaã€bææ„ï¼Œä½†å¼•ç”¨è®¡æ•°åªå‡1ï¼Œæ— æ³•å½’é›¶ï¼Œéƒ½åœ¨ç­‰å¯¹æ–¹å…ˆææ„ï¼Œå½¢æˆäº†åƒµå±€ã€‚\nå› æ­¤å½“å¤šæ–¹å†…éƒ¨å¯èƒ½å­˜åœ¨äº¤å‰ã€äº’ç›¸å¼•ç”¨å¯¹æ–¹çš„`shared_ptr`æ—¶ï¼Œéœ€è¦æ”¹å…¶ä¸ºä¸€ç§ä¸ä¼šå¢åŠ å¼•ç”¨è®¡æ•°çš„ç‰¹æ®ŠæŒ‡é’ˆã€‚åˆ™`weak_ptr`åº”è¿è€Œç”Ÿã€‚\n```cpp\nvoid bar()\n{\n    // std::weak_ptr<A> a(new A); // error, weak_pträ¸èƒ½ç›´æ¥ç®¡ç†å¯¹è±¡ã€‚\n    std::shared_ptr<A> a(new A);\n    std::weak_ptr<A> w_a = a;\n    std::cout << a.use_count << std::endl; // 1\n    std::cout << w_a.count << std::endl; // 1\n}\n```\n`weak_ptr`ä¸èƒ½ç›´æ¥ç®¡ç†å¯¹è±¡ã€‚è€Œæ˜¯å¯ä»¥é€šè¿‡ä¸€ä¸ªå·²ç»å­˜åœ¨çš„`shared_ptr`èµ‹å€¼ã€‚\n\næ­¤æ—¶`weak_ptr`ä½œä¸ºä¸€ä¸ªè§‚å¯Ÿè€…ã€‚ä¸èƒ½ç›´æ¥å¼•ç”¨å¯¹è±¡ã€‚\næƒ³è°ƒç”¨çš„æ—¶å€™ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹æ³•ï¼š\n## æ–¹æ³•\n1. expiredç”¨äºåˆ¤æ–­æ­¤`weak_ptr`æ˜¯å¦è¿‡æœŸäº†ã€‚\n2. lockç”¨äºæŠŠ`weak_ptr`å‡çº§ä¸ºä¸€ä¸ª`shared_ptr`ã€‚locké”å®šæ˜¯ä¸ºäº†é˜²æ­¢åœ¨æå‡ç­‰çº§çš„æœŸé—´æŒ‡é’ˆè¿‡æœŸï¼Œä½†æ˜¯å–å‡ºæ¥ä¹‹åä»æœ‰å¯èƒ½è¿‡æœŸï¼Œå› æ­¤éœ€è¦å…ˆifåˆ¤æ–­å–å‡ºçš„æŒ‡é’ˆæ˜¯å¦ä¸ºç©ºã€‚\n3. ä¹Ÿå¯ä»¥ç›´æ¥lockï¼Œä½†æ˜¯expiredæ¯”lockä»£ä»·å°ï¼Œé€šè¿‡å…ˆåˆ¤æ–­æ˜¯å¦è¿‡æœŸä»è€Œå¯èƒ½çœç•¥ä»£ä»·å¤§çš„lockã€‚\n\n```cpp\nvoid bar()\n{\n    std::shared_ptr<A> a(new A);\n    std::weak_ptr<A> w_a = a;\n    if(!w_a.expired())\n    {\n        if(std::shared_ptr<A> a2 = w_a.lock())\n        {\n            a2->show();\n        }\n    }\n}\n```\n## Aã€Bæ­£ç¡®çš„å®šä¹‰\nåªéœ€è¦ä¸€æ–¹çš„å†…éƒ¨çš„`shared_ptr`é™çº§å®šä¹‰ä¸º`weak_ptr`å³å¯è§£å†³åƒµå±€ã€‚\nä»¥ä¸‹ï¼Œå°†Bå†…éƒ¨çš„å¼•ç”¨Açš„æ™ºèƒ½æŒ‡é’ˆæˆå‘˜å˜é‡æ”¹ä¸ºå¼±æŒ‡é’ˆã€‚\n```cpp\nclass B; // incomplete class\nclass A\n{\npublic:\n    A(void)\n    {\n        std::cout << \"A()\" << std::endl;\n    }\n    ~A()\n    {\n        std::cout << \"~A()\" << std::endl;\n    }\n    void show() const\n    {\n        std::cout << \"A::show()\" << std::endl;\n    }\n    void set_b(std::shared_ptr<B> b)\n    {\n        _b = b;\n    }\n    // ç”±äºBåªåœ¨ä¸Šé¢å£°æ˜ï¼Œå› æ­¤ä¸èƒ½åœ¨æ­¤å®šä¹‰æœ‰å…³Bçš„å‡½æ•°ï¼Œè€Œæ˜¯å•ç‹¬å®šä¹‰ã€‚\n    void show_b() const;\nprivate:\n    std::shared_ptr<B> _b;\n};\nclass B\n{\npublic:\n    B(void)\n    {\n        std::cout << \"B()\" << std::endl;\n    }\n    ~B()\n    {\n        std::cout << \"~B()\" << std::endl;\n    }\n    void show() const\n    {\n        std::cout << \"B::show()\" << std::endl;\n    }\n    void set_a(std::shared_ptr<A> a)\n    {\n        _a = a;\n    }\n    void show_a() const\n    {\n        if(!_a.expired())\n        {\n            if(auto a = _a.lock())\n            {\n                a->show();\n            }\n        }\n    }\nprivate:\n    std::weak_ptr<A> _a;\n};\n\nvoid A::show_b() const\n{\n    if (_b)\n    {\n        _b->show();\n    }\n}\n\nvoid bar()\n{\n    std::shared_ptr<A> a(new A);\n    std::shared_ptr<B> b(new B);\n    a->set_b(b);\n    b->set_a(a);\n\n    a->show_b();\n    b->show_a();\n}\nint main()\n{\n    bar();\n    return 0;\n}\n```\næ­£ç¡®çš„è¾“å‡ºï¼š\n```\nA()\nB()\nB::show()\nA::show()\n~A()\n~B()\n```","categories":["Cpp"]},{"title":"æŒ‡å¯¼_å­¦ä¹ è®¡åˆ’_1127","url":"/è®¡ç®—æœºçŸ¥è¯†ä½“ç³»/æŒ‡å¯¼_å­¦ä¹ è®¡åˆ’_1127/","content":"# å†…å®¹\n\n1. C++é«˜è´¨é‡ç¼–ç¨‹\n2. è¿­ä»£å™¨ã€ç±»å‹çš„èƒå–ã€å¦‚ä½•è¿›è¡Œå¯¹è±¡çš„æ„å»ºå’Œé‡Šæ”¾ã€å¯¹è±¡ç©ºé—´çš„é—®é¢˜ï¼ˆå†…å­˜æ± ï¼‰å¦‚è°·æ­Œçš„Tmallocï¼ˆå¤šçº¿ç¨‹ï¼‰\n# ç»§æ‰¿\n\nå­èµ‹ç»™çˆ¶ã€‚éœ€è¦æ˜¯å…¬æœ‰ç»§æ‰¿ã€‚","categories":["è®¡ç®—æœºçŸ¥è¯†ä½“ç³»"]},{"title":"Cpp_æ³›å‹ç®—æ³•_å‡½æ•°å¯¹è±¡","url":"/Cpp/Cpp_æ³›å‹ç®—æ³•_å‡½æ•°å¯¹è±¡/","content":"# å†…å®¹\n\n1. æ³›å‹ç®—æ³•\n    1. copy\n    2. find\n    3. sort\n    4. find_if\n2. å‡½æ•°å¯¹è±¡\n    1. less\n    2. greater\n    3. binder1st\n    4. binder2nd","categories":["Cpp"]},{"title":"Linux_çº¿ç¨‹","url":"/Linux/Linux_çº¿ç¨‹/","content":"# ä¸è¿›ç¨‹çš„åŒºåˆ«\n\n1. è¿›ç¨‹ï¼šä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ç¨‹åºï¼Œæ˜¯èµ„æºåˆ†é…çš„æœ€å°å•ä½ã€‚\n2. çº¿ç¨‹ï¼šè¿›ç¨‹å†…éƒ¨çš„ä¸€æ¡æ‰§è¡Œè·¯å¾„ï¼Œæ˜¯æ‰§è¡Œä»»åŠ¡çš„æœ€å°å•ä½ã€‚\n\n# ä¸ºä»€ä¹ˆéœ€è¦çº¿ç¨‹\n\n1. ç¨‹åºéœ€è¦åŒæ—¶åšå¤šä¸ªäº‹æƒ…\n2. å……åˆ†åˆ©ç”¨å¤šå¤„ç†å™¨ï¼ˆå¤šæ ¸ï¼‰\n\n# ç¤ºä¾‹\n```c\n#include <pthread.h>\n#include <stdio.h>\n#include <stdlib.h>\nint my_global;\nvoid * my_thread_handle(void * arg)\n{\n    int val;\n    val = *((int*)arg);\n    printf(\"new thread begin, got arg, val = %d\\n\", val);\n    my_global += val;\n    sleep(3);\n    pthread_exit(&my_global);\n    printf(\"new thread end\\n\");\n}\nint main()\n{\n    pthread_t mythread;\n    int arg;\n    void *thread_return_val;\n    arg = 100;\n    my_global = 1000;\n    printf(\"my_global = %d\\n\", my_global);\n    printf(\"ready create thread...\\n\");\n    int error = pthread_create(&mythread, NULL, my_thread_handle, &arg);\n    if (error)\n    {\n        printf(\"create thread failed!\\n\");\n        exit(1);\n    }\n    printf(\"wait thread finished...\\n\");\n    error = pthread_join(mythread, &thread_return_val);\n    if (error)\n    {\n        printf(\"pthread_join failed!\\n\");\n        exit(1);\n    }\n    printf(\"got return val, %d\\n\", *((int*)thread_return_val));\n    printf(\"my_global = %d\\n\", my_global);\n}\n```\nè¾“å‡ºç»“æœï¼š\n```\nmy_global = 1000\nready create thread...\nwait thread finished...\nnew thread begin, got arg, val = 100\ngot return val, 1100\nmy_global = 1100\n```\n# API\néœ€åŒ…å«å¤´æ–‡ä»¶`<pthread.h>`\nç¼–è¯‘é“¾æ¥æ—¶éœ€å¸¦é€‰é¡¹`-lpthread`\n## `pthread_create`\n\n\n```c\nint pthread_create(pthread_t *thread, const pthread_attr_t *attr, void *(*start_routine) (void *), void *arg);\n```\n\n\nå‚æ•°ï¼š\n1. threadï¼ŒæŒ‡å‘æ–°çº¿ç¨‹çš„æ ‡è¯†ç¬¦ï¼ˆéœ€è¦ä¼ å…¥å·²ç»å®šä¹‰å¥½çš„`pthread_t`æŒ‡é’ˆï¼‰\n2. attrï¼Œç”¨æ¥è®¾ç½®æ–°çº¿ç¨‹çš„å±æ€§ã€‚ä¸€èˆ¬ç”¨é»˜è®¤å±æ€§NULL\n3. `start_routine`ï¼Œè¯¥çº¿ç¨‹çš„å¤„ç†å‡½æ•°æŒ‡é’ˆï¼Œè¿”å›ç±»å‹ã€å‚æ•°ç±»å‹éƒ½æ˜¯`void*`\n4. argï¼Œä¼ ç»™å¤„ç†å‡½æ•°çš„å‚æ•°ã€‚\n\nè¿”å›å€¼ï¼š\nå¦‚æœæˆåŠŸï¼Œå°†è¿”å› 0ï¼›å¦‚æœå‡ºé”™ï¼Œå°†è¿”å›ä¸€ä¸ªé”™è¯¯å·ï¼Œå¹¶ä¸”`*thread`çš„å†…å®¹æœªå®šä¹‰ã€‚\n## `pthread_exit`\n\n```c\nvoid pthread_exit(void *retval);\n```\n\nåœ¨çº¿ç¨‹å‡½æ•°å†…éƒ¨è°ƒç”¨è¯¥å‡½æ•°ï¼Œç”¨äºç»™å¤–éƒ¨å†™å€¼ã€‚\n\n## `pthread_join`\n```c\nint pthread_join(pthread_t thread, void **retval);\n```\nç­‰å¾…æŒ‡å®šçš„çº¿ç¨‹ç»“æŸã€‚\n\nå‚æ•°ï¼š\n1. threadï¼ŒæŒ‡å®šç­‰å¾…çš„çº¿ç¨‹\n2. retvalï¼ŒæŒ‡å‘è¯¥çº¿ç¨‹å‡½æ•°çš„è¿”å›å€¼ã€‚çº¿ç¨‹å‡½æ•°çš„è¿”å›å€¼ç±»å‹æ˜¯`void*`ï¼Œæ‰€ä»¥è¯¥å‚æ•°çš„ç±»å‹ä¸º`void**`\n\nå¦‚æœæˆåŠŸï¼Œå°†è¿”å› 0ï¼›å¦‚æœå‡ºé”™ï¼Œå°†è¿”å›ä¸€ä¸ªé”™è¯¯å·\n\n\n# åŒæ­¥\nå®‰è£…posixæ‰‹å†Œï¼š\n```sh\nsudo apt install manpages-posix-dev\n```\n\nCè¯­è¨€ä¸­ï¼Œå…³äºåŒæ­¥æä¾›çš„å››ä¸ªæ–¹æ³•ï¼š\n1. ä¿¡å·é‡\n2. äº’æ–¥é”\n3. æ¡ä»¶å˜é‡\n4. è¯»å†™é”\n\nä¿¡å·é‡ã€äº’æ–¥é‡ç”¨äºè§£å†³å¤šä¸ªçº¿ç¨‹å¯¹ä¸´ç•ŒåŒºçš„ç«æ€é—®é¢˜ã€‚\nå¦‚æœåªå…è®¸ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒºåˆ™ç”¨äº’æ–¥é‡ï¼›\nå¦‚æœè¦æ±‚å¤šä¸ªçº¿ç¨‹çš„æ‰§è¡Œé¡ºåºæ»¡è¶³æŸä¸ªçº¦æŸï¼Œç”¨ä¿¡å·é‡ã€‚\n## ä¿¡å·é‡\næ­¤æ—¶æ‰€æŒ‡çš„â€œä¿¡å·é‡â€æ˜¯æŒ‡ç”¨äºåŒä¸€ä¸ªè¿›ç¨‹å†…å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„ä¿¡å·é‡ã€‚\nå³POSIXä¿¡å·é‡ï¼Œé¢ä¸æ˜¯System Vä¿¡å·é‡ï¼ˆç”¨äºè¿›ç¨‹ä¹‹é—´çš„åŒæ­¥ï¼‰\n\nç”¨äºçº¿ç¨‹çš„ä¿¡å·é‡çš„åŸç†ï¼Œä¸ç”¨äºè¿›ç¨‹çš„ä¿¡å·é‡çš„åŸç†ç›¸åŒã€‚éƒ½æœ‰Pã€Væ“ä½œã€‚\n### API\néœ€è¦åŒ…å«å¤´æ–‡ä»¶`<semaphore.h>`\n\nä¿¡å·é‡çš„è¡¨ç¤º\n```c\nsem_t\n```\nä¿¡å·é‡çš„åˆå§‹åŒ–\n```c\nint sem_init(sem_t *sem, int pshared, unsigned int value);\n```\nå‚æ•°ï¼š\n1. semï¼Œä¿¡å·é‡çš„æŒ‡é’ˆ\n2. psharedï¼Œ0 è¡¨ç¤ºè¯¥ä¿¡å·é‡ä¸è¢«å…¶ä»–è¿›ç¨‹å…±äº«ï¼›1 è¡¨ç¤ºå¯è¢«å…¶ä»–è¿›ç¨‹å…±äº«ã€‚\n3. valueï¼Œä¿¡å·é‡çš„åˆå€¼\n\næˆåŠŸæ—¶è¿”å› 0ï¼›åœ¨é”™è¯¯æ—¶è¿”å› -1ï¼Œå¹¶è®¾ç½® errno æ¥æŒ‡ç¤ºé”™è¯¯ã€‚\n\n---\n\nä¿¡å·é‡çš„Pæ“ä½œã€‚æƒ³è¦å–å¾—è®¿é—®æƒï¼Œå¯¹ä¿¡å·é‡å‡1ã€‚\n```c\nint sem_wait(sem_t *sem);\n```\nä¿¡å·é‡çš„Væ“ä½œã€‚æƒ³è¦è®©æ¸¡è®¿é—®æƒï¼Œå¯¹ä¿¡å·é‡åŠ 1ã€‚\n```c\nint sem_post(sem_t *sem);\n```\n\n---\nä¿¡å·é‡çš„ææ„\n```c\nint sem_destroy(sem_t *sem);\n```\n### ç¤ºä¾‹\n```c\n#include <pthread.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <semaphore.h>\n#include <string.h>\n#define BUFF_SIZE 80\nchar buff[BUFF_SIZE];\nsem_t sem;\nstatic void * str_thread_handle(void* arg)\n{\n    while(1)\n    {\n        if (sem_wait(&sem) != 0)\n        {\n            printf(\"sem wait failed!\\n\");\n            exit(1);\n        }\n        printf (\"string is: %s, len = %d\\n\", buff, strlen(buff));\n    }\n}\nint main()\n{\n    int error;\n    pthread_t str_thread;\n    void * thread_return_val;\n\n    error = sem_init(&sem, 0, 0);\n    if (error != 0)\n    {\n        printf(\"sem init failed!\\n\");\n        exit(1);\n    }\n    error = pthread_create(&str_thread, NULL, str_thread_handle, 0);\n    if (error != 0)\n    {\n        printf(\"pthread create failed!\\n\");\n        exit(1);\n    }\n    while (1)\n    {\n        fgets(buff, sizeof(buff), stdin);\n        error = sem_post(&sem);\n        if (error != 0)\n        {\n            printf(\"sem post failed!\\n\");\n            exit(1);\n        }\n        if (strncmp(buff, \"end\", 3) == 0)\n        {\n            break;\n        }\n    }\n    error = pthread_join(str_thread, &thread_return_val);\n    if (error != 0)\n    {\n        printf(\"pthread join failed!\\n\");\n        exit(1);\n    }\n    error = sem_destroy(&sem);\n    if (error != 0)\n    {\n        printf(\"sem_destroy failed!\\n\");\n        exit(1);\n    }\n}\n```\nç»“æœ\n```\n123ï¼ˆç”¨æˆ·è¾“å…¥ï¼‰\nstring is: 123\n, len = 4\n3ï¼ˆç”¨æˆ·è¾“å…¥ï¼‰\nstring is: 3\n, len = 2\n```\n\n## äº’æ–¥é‡\næ•ˆæœä¸Šç­‰åŒäºåˆå€¼ä¸º1çš„ä¿¡å·é‡ã€‚\n\nï¼ˆUNIXç¯å¢ƒé«˜çº§ç¼–ç¨‹ ç¬¬3ç‰ˆ ä¸­æ–‡ç‰ˆï¼‰ä¸ºäº†é¿å…å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹æŸå…¬å…±æ•°æ®æ“ä½œæ—¶äº§ç”Ÿå†²çªï¼Œå¯ä»¥ä½¿ç”¨pthreadçš„äº’æ–¥æ¥å£æ¥ä¿æŠ¤æ•°æ®ï¼Œ**ç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®æ•°æ®**ã€‚\n\näº’æ–¥é‡(mutex)æœ¬è´¨ä¸Šæ¥è¯´æ˜¯ä¸€æŠŠé”ï¼Œåˆ©ç”¨äº’æ–¥é‡ï¼Œåœ¨è®¿é—®å…±äº«èµ„æºå‰å¯¹äº’æ–¥é‡è¿›è¡Œè®¾ç½®ï¼ˆåŠ é”ï¼‰ï¼Œåœ¨è®¿é—®å®Œæˆåé‡Šæ”¾ï¼ˆè§£é”ï¼‰äº’æ–¥é‡ï¼Œå³å¯è¾¾åˆ°çº¿ç¨‹åŒæ­¥ã€‚\n\nå¯¹äº’æ–¥é‡åŠ é”åï¼Œå…¶ä»–çº¿ç¨‹å†æ¬¡å¯¹mutexè¿›è¡Œlockæ“ä½œæ—¶ä¼šè¢«**é˜»å¡**ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ã€‚\n\n> å¦‚æœé‡Šæ”¾äº’æ–¥é‡æ—¶æœ‰ä¸€ä¸ªä»¥ä¸Šçš„çº¿ç¨‹é˜»å¡ï¼Œé‚£ä¹ˆæ‰€æœ‰è¯¥é”ä¸Šçš„é˜»å¡çº¿ç¨‹éƒ½ä¼šå˜æˆ**å¯è¿è¡ŒçŠ¶æ€**ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªå˜ä¸ºè¿è¡Œæ€çš„çº¿ç¨‹å¯ä»¥æ‹¿åˆ°é”è¿›è¡ŒåŠ é”ï¼Œå…¶ä»–çº¿ç¨‹ä¼šçœ‹åˆ°äº’æ–¥é‡ä¾ç„¶æ˜¯é”ç€çš„ï¼Œåªèƒ½å›å»å†æ¬¡ç­‰å¾…é”é‡æ–°å˜ä¸ºå¯ç”¨ã€‚åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œæ¯æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å‘å‰æ‰§è¡Œã€‚\n\n### API\n```c\npthread_mutex_t\n```\n\n```c\n#include<pthread.h>\n/* å‡½æ•°çš„è¿”å›å€¼ï¼šè‹¥æˆåŠŸè¿”å›0ï¼›å¦åˆ™è¿”å›é”™è¯¯ç¼–å· */\nint pthread_mutex_init(pthread_mutex_t *restrict mutex,\n                       const pthread_mutexattr_t *restrict attr);\nint pthread_mutex_destroy(pthread_mutex_t *mutex);\n```\n\nå…³äºrestrictå…³é”®å­—ï¼Œè¯·ç§»æ­¥C/C++è¯­è¨€åˆ†æ ã€‚\n\nè¦ç”¨é»˜è®¤çš„å±æ€§åˆå§‹åŒ–äº’æ–¥é‡ï¼Œåªéœ€æŠŠattrè®¾ä¸ºNULLã€‚\n\n---\n\n```c\n#include<pthread.h>\n/* å‡½æ•°çš„è¿”å›å€¼ï¼šè‹¥æˆåŠŸè¿”å›0ï¼›å¦åˆ™è¿”å›é”™è¯¯ç¼–å· */\nint pthread_mutex_lock(pthread_mutex_t *mutex);\nint pthread_mutex_trylock(pthread_mutex_t *mutex);\nint pthread_mutex_unlock(pthread_mutex_t *mutex);\n```\n\nå¦‚æœçº¿ç¨‹ä¸å¸Œæœ›è¢«é˜»å¡ï¼Œå¯ä»¥ä½¿ç”¨`pthread_mutex_trylock`å°è¯•å¯¹äº’æ–¥é‡è¿›è¡ŒåŠ é”ã€‚\nå¦‚æœè°ƒç”¨`pthread_mutex_trylock`æ—¶äº’æ–¥é‡å¤„äºæœªé”çŠ¶æ€ï¼Œé‚£ä¹ˆå°†é”ä½äº’æ–¥é‡ï¼Œè¿”å›0ï¼›å¦åˆ™å°±ä¸èƒ½é”ä½äº’æ–¥é‡ï¼Œè¿”å›`EBUSY`ã€‚\n\n### é¿å…æ­»é”\n\nå¦‚æœçº¿ç¨‹è¯•å›¾å¯¹åŒä¸€ä¸ªäº’æ–¥é‡åŠ é”ä¸¤æ¬¡ï¼ˆæ‹¿åˆ°é”ä¹‹åå†åŠ é”ï¼‰ï¼Œé‚£ä¹ˆå®ƒè‡ªèº«å°±ä¼šé™·å…¥æ­»é”çŠ¶æ€ã€‚\n\n```c\npthread_mutex_t lock;\nvoid * fun(void *arg)\n{\n    pthread_mutex_lock(&lock);\n    pthread_mutex_lock(&lock);\t//æ­»é”\n    //... \n}\nint main()\n{\n    int res = pthread_mutex_init(&lock, NULL);\n    if(res != 0)// 0 is success, or failed.\n    {\n        exit(1);\n    }\n    // ... initialization mutex\n    \n    pthread_t tid1;\n    res = pthread_create(&tid1, NULL, fun, NULL);\n    if(res != 0)exit(1);\n    \n    res = pthread_join(tid1, NULL);\t//ç¬¬äºŒä¸ªå‚æ•°ç”¨äºæ¥æ”¶çº¿ç¨‹çš„è¿”å›å€¼ï¼Œä¸æ„Ÿå…´è¶£å¯ä»¥è®¾ç½®ä¸ºNULL\n    if(res != 0)exit(1);\n    \n    return 0;\n}\n```\n\nè¿˜æœ‰å…¶ä»–æ–¹å¼ä¹Ÿèƒ½äº§ç”Ÿæ­»é”ï¼Œä¾‹å¦‚ï¼Œç¨‹åºä¸­ä½¿ç”¨ä¸€ä¸ªä»¥ä¸Šçš„äº’æ–¥é‡æ—¶ï¼Œå¦‚æœçº¿ç¨‹1ä¸€ç›´å æœ‰äº’æ–¥é‡1ï¼Œå®ƒè¦è¿›è¡Œä¸‹ä¸€æ­¥çš„æ¡ä»¶æ˜¯å æœ‰äº’æ–¥é‡2ï¼Œè€Œäº’æ–¥é‡2ä¸€ç›´è¢«çº¿ç¨‹2å æœ‰ï¼Œçº¿ç¨‹2ä¸‹ä¸€æ­¥çš„æ¡ä»¶æ˜¯å ç”¨äº’æ–¥é‡1ã€‚å³**ä¸¤ä¸ªçº¿ç¨‹éƒ½åœ¨äº’ç›¸è¯·æ±‚å¦ä¸€ä¸ªçº¿ç¨‹æ‹¥æœ‰çš„èµ„æº**ã€‚\n\nå¯ä»¥é€šè¿‡ä»”ç»†æ§åˆ¶äº’æ–¥é‡åŠ é”çš„é¡ºåºæ¥é¿å…æ­»é”çš„å‘ç”Ÿï¼Œä¾‹å¦‚ï¼Œå‡è®¾éœ€è¦å¯¹ä¸¤ä¸ªäº’æ–¥é‡Aå’ŒBåŒæ—¶åŠ é”ã€‚\n\nå¦‚æœæ‰€æœ‰çº¿ç¨‹æ€»æ˜¯åœ¨å¯¹äº’æ–¥é‡BåŠ é”ä¹‹å‰èƒ½å¤Ÿé”ä½äº’æ–¥é‡Aï¼Œé‚£ä¹ˆä½¿ç”¨è¿™ä¸¤ä¸ªäº’æ–¥é‡å°±ä¸ä¼šäº§ç”Ÿæ­»é”ã€‚ç±»ä¼¼åœ°ï¼Œå¦‚æœæ‰€æœ‰çš„çº¿ç¨‹æ€»æ˜¯åœ¨é”ä½äº’æ–¥é‡Aä¹‹å‰èƒ½å¤Ÿé”ä½äº’æ–¥é‡Bï¼Œé‚£ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿæ­»é”ã€‚\n\nå¯èƒ½å‡ºç°çš„æ­»é”åªä¼šå‘ç”Ÿåœ¨ä¸€ä¸ªçº¿ç¨‹è¯•å›¾é”ä½å¦ä¸€ä¸ªçº¿ç¨‹ä»¥ç›¸åçš„é¡ºåºé”ä½çš„äº’æ–¥é‡ã€‚\n\næœ‰æ—¶å€™ï¼Œåº”ç”¨ç¨‹åºçš„ç»“æ„ä½¿å¾—å¯¹äº’æ–¥é‡è¿›è¡Œæ’åºæ˜¯å¾ˆå›°éš¾çš„ã€‚å¦‚æœæ¶‰åŠäº†å¤ªå¤šçš„é”å’Œæ•°æ®ç»“æ„ï¼Œå¯ç”¨çš„å‡½æ•°å¹¶ä¸èƒ½æŠŠå®ƒè½¬æ¢æˆç®€å•çš„å±‚æ¬¡ï¼Œé‚£ä¹ˆå°±éœ€è¦é‡‡ç”¨å¦å¤–çš„æ–¹æ³•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒBå¯ä»¥å…ˆé‡Šæ”¾å æœ‰çš„é”ï¼ˆå› ä¸ºAå¯èƒ½éœ€è¦Bå æœ‰çš„é”ï¼‰ï¼Œç„¶åè¿‡ä¸€æ®µæ—¶é—´å†è¯•ã€‚\n\n## æ¡ä»¶å˜é‡\n\næ¡ä»¶å˜é‡æ˜¯çº¿ç¨‹å¯ç”¨çš„å¦ä¸€ç§åŒæ­¥æœºåˆ¶ã€‚\n\n**æ¡ä»¶å˜é‡ç»™å¤šä¸ªçº¿ç¨‹æä¾›äº†ä¸€ä¸ªå›åˆçš„åœºæ‰€**ã€‚\n\n**æ¡ä»¶å˜é‡ä¸äº’æ–¥é‡ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œå…è®¸çº¿ç¨‹ä»¥æ— ç«äº‰çš„æ–¹å¼ç­‰å¾…ç‰¹å®šçš„æ¡ä»¶å‘ç”Ÿ**ã€‚\n\næ¡ä»¶æœ¬èº«æ˜¯ç”±äº’æ–¥é‡ä¿æŠ¤çš„ã€‚**çº¿ç¨‹åœ¨æ”¹å˜æ¡ä»¶çŠ¶æ€ä¹‹å‰å¿…é¡»é¦–å…ˆé”ä½äº’æ–¥é‡**ã€‚å…¶ä»–çº¿ç¨‹åœ¨è·å¾—äº’æ–¥é‡ä¹‹å‰ä¸ä¼šå¯Ÿè§‰åˆ°è¿™ç§æ”¹å˜ï¼Œå› ä¸ºäº’æ–¥é‡å¿…é¡»åœ¨é”å®šä»¥åæ‰èƒ½è®¡ç®—æ¡ä»¶ã€‚\n\n\n---\n### API\n```c\npthread_cond_t\n```\n\n```c\n#include<pthread.h>\n/* å‡½æ•°çš„è¿”å›å€¼ï¼šè‹¥æˆåŠŸï¼Œè¿”å›0ï¼›å¦åˆ™ï¼Œè¿”å›é”™è¯¯ç¼–å· */\nint pthread_cond_init(pthread_cond_t *restrict cond,\n                      const pthread_condattr_t *restrict attr);\nint pthread_cond_destroy(pthread_cond_t *cond);\n```\n\nåœ¨ä½¿ç”¨æ¡ä»¶å˜é‡ä¹‹å‰ï¼Œå¿…é¡»å…ˆå¯¹å®ƒè¿›è¡Œåˆå§‹åŒ–ã€‚\n\nåœ¨é‡Šæ”¾æ¡ä»¶å˜é‡åº•å±‚çš„å†…å­˜ç©ºé—´ä¹‹å‰ï¼Œå¯ä»¥ä½¿ç”¨`pthread_cond_destroy`å‡½æ•°å¯¹æ¡ä»¶å˜é‡è¿›è¡Œææ„ã€‚\n\n---\n\n```c\n#include<pthread.h>\n/* å‡½æ•°çš„è¿”å›å€¼ï¼šè‹¥æˆåŠŸï¼Œè¿”å›0ï¼›å¦åˆ™ï¼Œè¿”å›é”™è¯¯ç¼–å· */\nint pthread_cond_wait(pthread_cond_t *restrict cond,\n                      pthread_mutex_t *restrict mutex);\nint pthread_cond_timedwait(pthread_cond_t *restrict cond,\n                           pthread_mutex_t *restrict mutex,\n                           const struct timespec *restrict tsptr);\n```\n\næˆ‘ä»¬ä½¿ç”¨`pthread_cond_wait`ç­‰å¾…æ¡ä»¶å˜é‡å˜ä¸ºçœŸã€‚å¦‚æœåœ¨ç»™å®šçš„æ—¶é—´å†…æ¡ä»¶ä¸èƒ½æ»¡è¶³ï¼Œé‚£ä¹ˆä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ç ã€‚\n\nä¼ é€’ç»™`pthread_cond_wait`çš„**äº’æ–¥é‡å¯¹æ¡ä»¶è¿›è¡Œä¿æŠ¤**ã€‚è°ƒç”¨è€…æŠŠé”ä½çš„äº’æ–¥é‡ä¼ ç»™å‡½æ•°ï¼Œ**å‡½æ•°ç„¶åè‡ªåŠ¨æŠŠè°ƒç”¨çº¿ç¨‹æ”¾åˆ°ç­‰å¾…æ¡ä»¶çš„çº¿ç¨‹åˆ—è¡¨**ä¸Šï¼Œ**å¯¹äº’æ–¥é‡è§£é”**ã€‚è¿™å°±**å…³é—­äº†æ¡ä»¶æ£€æŸ¥**å’Œ**çº¿ç¨‹è¿›å…¥ä¼‘çœ çŠ¶æ€ç­‰å¾…æ¡ä»¶æ”¹å˜**è¿™ä¸¤ä¸ªæ“ä½œ**ä¹‹é—´çš„æ—¶é—´é€šé“**ï¼Œè¿™æ ·çº¿ç¨‹å°±ä¸ä¼šé”™è¿‡æ¡ä»¶çš„ä»»ä½•å˜åŒ–ã€‚`pthread_cond_wait`è¿”å›æ—¶ï¼Œäº’æ–¥é‡å†æ¬¡è¢«é”ä½ã€‚\n\n> pthread_cond_timedwaitå‡½æ•°å¤šäº†ä¸€ä¸ªè¶…æ—¶å‚æ•°`tsptr`ã€‚è¶…æ—¶å€¼æŒ‡å®šäº†æˆ‘ä»¬æ„¿æ„ç­‰å¾…å¤šé•¿æ—¶é—´ï¼Œå®ƒæ˜¯é€šè¿‡`timespec`ç»“æ„æŒ‡å®šçš„ã€‚éœ€è¦æŒ‡å®šæ„¿æ„ç­‰å¾…å¤šé•¿æ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´å€¼æ˜¯ä¸€ä¸ª**ç»å¯¹æ•°**è€Œä¸æ˜¯ç›¸å¯¹æ•°ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æ„¿æ„ç­‰å¾…3åˆ†é’Ÿã€‚é‚£ä¹ˆï¼Œå¹¶ä¸æ˜¯æŠŠ3åˆ†é’Ÿè½¬æ¢æˆ`timespec`ç»“æ„ï¼Œè€Œæ˜¯éœ€è¦æŠŠå½“å‰æ—¶é—´åŠ ä¸Š3åˆ†é’Ÿå†è½¬æ¢æˆtimespecç»“æ„ã€‚\n\n>å¦‚æœè¶…æ—¶åˆ°æœŸæ—¶æ¡ä»¶è¿˜æ˜¯æ²¡æœ‰å‡ºç°ï¼Œ`pthread_cond_timewait`å°†é‡æ–°è·å–äº’æ–¥é‡ï¼Œç„¶åè¿”å›é”™è¯¯`ETIMEDOUT`ã€‚\n\n>ä»`pthread_cond_wait`æˆ–è€…`pthread_cond_timedwait`è°ƒç”¨æˆåŠŸè¿”å›æ—¶ï¼Œçº¿ç¨‹éœ€è¦é‡æ–°è®¡ç®—æ¡ä»¶ï¼Œå› ä¸ºå¦ä¸€ä¸ªçº¿ç¨‹å¯èƒ½å·²ç»åœ¨è¿è¡Œå¹¶æ”¹å˜äº†æ¡ä»¶ã€‚\n\n> å¯ä»¥ä½¿ç”¨`clock_gettime`å‡½æ•°è·å–timespecç»“æ„è¡¨ç¤ºçš„å½“å‰æ—¶é—´ã€‚ä½†æ˜¯ç›®å‰å¹¶ä¸æ˜¯æ‰€æœ‰çš„å¹³å°éƒ½æ”¯æŒè¿™ä¸ªå‡½æ•°ï¼Œå› æ­¤ï¼Œä¹Ÿå¯ä»¥ç”¨å¦ä¸€ä¸ªå‡½æ•°`gettimeofday`è·å–`timeval`ç»“æ„è¡¨ç¤ºçš„å½“å‰æ—¶é—´ï¼Œç„¶åæŠŠè¿™ä¸ªæ—¶é—´è½¬æ¢æˆ`timespec`ç»“æ„ã€‚\n\n---\n\næœ‰ä¸¤ä¸ªå‡½æ•°å¯ä»¥ç”¨äºé€šçŸ¥çº¿ç¨‹æ¡ä»¶å·²ç»æ»¡è¶³ã€‚`pthread_cond_signal`å‡½æ•°è‡³å°‘èƒ½å”¤é†’ä¸€ä¸ªç­‰å¾…è¯¥æ¡ä»¶çš„çº¿ç¨‹ï¼Œè€Œ`pthread_cond_broadcast`å‡½æ•°åˆ™èƒ½å”¤é†’ç­‰å¾…è¯¥æ¡ä»¶çš„æ‰€æœ‰çº¿ç¨‹ã€‚\n\n> POSIXè§„èŒƒä¸ºäº†ç®€åŒ–`thread_cond_signal`çš„å®ç°ï¼Œå…è®¸ä»–åœ¨å®ç°çš„æ—¶å€™å”¤é†’ä¸€ä¸ªä»¥ä¸Šçš„çº¿ç¨‹ã€‚\n\n```c\n#include<pthread.h>\n/* å‡½æ•°çš„è¿”å›å€¼ï¼šè‹¥æˆåŠŸï¼Œè¿”å›0ï¼›å¦åˆ™ï¼Œè¿”å›é”™è¯¯ç¼–å· */\nint pthread_cond_signal(pthread_cond_t * cond);\nint pthread_cond_broadcast(pthread_cond_t * cond);\n```\n\nåœ¨è°ƒç”¨`pthread_cond_signal`æˆ–è€…`pthread_cond_broadcast`æ—¶ï¼Œæˆ‘ä»¬è¯´è¿™æ˜¯åœ¨ç»™çº¿ç¨‹æˆ–è€…æ¡ä»¶å‘ä¿¡å·ã€‚å¿…é¡»æ³¨æ„ï¼Œä¸€å®šè¦åœ¨æ”¹å˜æ¡ä»¶çŠ¶æ€ä»¥åå†ç»™çº¿ç¨‹å‘ä¿¡å·ã€‚\n\næ¡ä»¶æ˜¯å·¥ä½œé˜Ÿåˆ—çš„çŠ¶æ€ã€‚æˆ‘ä»¬ç”¨äº’æ–¥é‡ä¿æŠ¤æ¡ä»¶ï¼Œåœ¨whileå¾ªç¯ä¸­åˆ¤æ–­æ¡ä»¶ã€‚æŠŠæ¶ˆæ¯æ”¾åˆ°å·¥ä½œé˜Ÿåˆ—æ—¶ï¼Œéœ€è¦å æœ‰äº’æ–¥é‡ï¼Œä½†åœ¨ç»™ç­‰å¾…çº¿ç¨‹å‘ä¿¡å·æ—¶ï¼Œä¸éœ€è¦å æœ‰äº’æ–¥é‡ï¼ˆä½†æœ€å¥½è¿˜æ˜¯å æœ‰ï¼Œè¯¦è§[ã€ŠCpp_çº¿ç¨‹åº“ã€‹ä¸€ç¯‡ä¸­çš„ã€Šæ³¨æ„äº‹é¡¹ã€‹ä¸€èŠ‚](Cpp_çº¿ç¨‹åº“.md#æ³¨æ„äº‹é¡¹)ã€‚åªè¦çº¿ç¨‹åœ¨è°ƒç”¨`pthread_cond_signal`ä¹‹å‰æŠŠæ¶ˆæ¯ä»é˜Ÿåˆ—ä¸­æ‹–å‡ºäº†ï¼Œå°±å¯ä»¥åœ¨é‡Šæ”¾äº’æ–¥é‡ä»¥åå®Œæˆè¿™éƒ¨åˆ†å·¥ä½œã€‚å› ä¸ºæˆ‘ä»¬æ˜¯åœ¨whileå¾ªç¯ä¸­æ£€æŸ¥æ¡ä»¶ï¼Œæ‰€ä»¥ä¸å­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼šçº¿ç¨‹é†’æ¥ï¼Œå‘ç°é˜Ÿåˆ—ä»ä¸ºç©ºï¼Œç„¶åè¿”å›ç»§ç»­ç­‰å¾…ã€‚å¦‚æœä»£ç ä¸èƒ½å®¹å¿è¿™ç§ç«äº‰ï¼Œå°±éœ€è¦åœ¨ç»™çº¿ç¨‹å‘ä¿¡å·çš„æ—¶å€™å æœ‰äº’æ–¥é‡ã€‚\n\n## è¯»å†™é”ï¼ˆå…±äº«äº’æ–¥é”ï¼‰\n\nè¯»å†™é”å’Œäº’æ–¥é‡ç±»ä¼¼ï¼Œä¸è¿‡è¯»å†™é”å…è®¸æ›´é«˜çš„å¹¶è¡Œæ€§ã€‚äº’æ–¥é‡è¦ä¹ˆæ˜¯é”ä½çŠ¶æ€ï¼Œè¦ä¹ˆæ˜¯æœªé”çŠ¶æ€ï¼Œè€Œä¸”ä¸€æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¯¹å…¶åŠ é”ã€‚\n\nè¯»å†™é”æœ‰3ç§çŠ¶æ€ï¼š**è¯»æ¨¡å¼ä¸‹åŠ é”çŠ¶æ€**ï¼Œ**å†™æ¨¡å¼ä¸‹åŠ é”çŠ¶æ€**ï¼Œ**ä¸åŠ é”çŠ¶æ€**ã€‚**ä¸€æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å æœ‰å†™æ¨¡å¼çš„è¯»å†™é”ï¼Œä½†æ˜¯å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶å æœ‰è¯»æ¨¡å¼çš„è¯»å†™é”**ã€‚å†™ä¸å†™ã€è¯»éƒ½ä¼šå†²çªï¼Œè¯»ä¸è¯»ä¸å†²çªã€‚\n\n>1. å½“è¯»å†™é”æ˜¯å†™åŠ é”çŠ¶æ€æ—¶ï¼Œåœ¨è¿™ä¸ªé”è¢«è§£é”ä¹‹å‰ï¼Œæ‰€æœ‰è¯•å›¾å¯¹è¿™ä¸ªé”åŠ é”çš„çº¿ç¨‹éƒ½ä¼šè¢«é˜»å¡ï¼›\n>2. å½“è¯»å†™é”åœ¨è¯»åŠ é”çŠ¶æ€æ—¶ï¼Œæ‰€æœ‰è¯•å›¾ä»¥è¯»æ¨¡å¼å¯¹å®ƒè¿›è¡ŒåŠ é”çš„çº¿ç¨‹éƒ½å¯ä»¥å¾—åˆ°è®¿é—®æƒï¼Œä½†æ˜¯ä»»ä½•å¸Œæœ›ä»¥å†™æ¨¡å¼å¯¹æ­¤é”è¿›è¡ŒåŠ é”çš„çº¿ç¨‹éƒ½ä¼šé˜»å¡ï¼Œç›´åˆ°æ‰€æœ‰çš„çº¿ç¨‹é‡Šæ”¾å®ƒä»¬çš„è¯»é”ä¸ºæ­¢ã€‚\n>3. è™½ç„¶å„æ“ä½œç³»ç»Ÿå¯¹è¯»å†™é”çš„å®ç°å„ä¸ç›¸åŒï¼Œä½†å½“è¯»å†™é”å¤„äºè¯»æ¨¡å¼é”ä½çš„çŠ¶æ€ï¼Œè€Œè¿™æ—¶æœ‰ä¸€ä¸ªçº¿ç¨‹è¯•å›¾ä»¥å†™æ¨¡å¼è·å–é”æ—¶ï¼Œè¯»å†™é”é€šå¸¸ä¼šé˜»å¡éšåçš„è¯»æ¨¡å¼é”è¯·æ±‚ã€‚è¿™æ ·å¯ä»¥é¿å…è¯»æ¨¡å¼é”é•¿æœŸå ç”¨ï¼Œè€Œç­‰å¾…çš„å†™æ¨¡å¼é”è¯·æ±‚ä¸€ç›´å¾—ä¸åˆ°æ»¡è¶³ã€‚\n\nè¯»å†™é”ä¹Ÿå«åšå…±äº«äº’æ–¥é”(shared-exclusive lock)ã€‚**å½“è¯»æ¨¡å¼é”ä½æ—¶ï¼Œç›¸å½“äºæ˜¯ä»¥å…±äº«æ¨¡å¼é”ä½çš„ã€‚å½“å†™æ¨¡å¼é”ä½æ—¶ï¼Œæ˜¯ä»¥äº’æ–¥æ¨¡å¼é”ä½çš„**ã€‚\n\n### API\n\n```c\n#include<pthread.h>\n/* å‡½æ•°çš„è¿”å›å€¼ï¼šè‹¥æˆåŠŸï¼Œè¿”å›0ï¼›å¦åˆ™ï¼Œè¿”å›é”™è¯¯ç¼–å· */\nint pthread_rwlock_init(pthread_rwlock_t *restrict rwlock,\n                        pthread_rwlockattr_t *restrict attr);\nint pthread_rwlock_destroy(pthread_rwlock_t *rwlock);\n```\n\nåœ¨é‡Šæ”¾è¯»å†™é”å ç”¨çš„å†…å­˜ä¹‹å‰ï¼Œéœ€è¦è°ƒç”¨pthread\\_rwlock\\_destroyåšæ¸…ç†å·¥ä½œã€‚å¦‚æœpthread\\_rwlock\\_initä¸ºè¯»å†™é”åˆ†é…äº†èµ„æºï¼Œpthread\\_rwlock\\_destroyå°†é‡Šæ”¾è¿™äº›èµ„æºã€‚\n\n**å¦‚æœåœ¨è°ƒç”¨pthread\\_rwlock\\_destroyä¹‹å‰å°±é‡Šæ”¾äº†è¯»å†™é”å ç”¨çš„å†…å­˜ç©ºé—´ï¼Œé‚£ä¹ˆåˆ†é…ç»™è¿™ä¸ªé”çš„èµ„æºå°±ä¼šä¸¢å¤±**ã€‚ï¼ˆåˆ†é…ç»™è¿™ä¸ªé”çš„èµ„æºæŒ‡ä»€ä¹ˆï¼Ÿâ€œä¸¢å¤±â€çš„å…·ä½“å«ä¹‰ï¼Ÿï¼‰\n\n>1. å¦‚æœä½ çš„pthread\\_rwlock\\_tèµ„æºæ˜¯ä¸´æ—¶å˜é‡ï¼Œå°±è¦ä¿è¯åœ¨ç”Ÿå­˜æœŸä¹‹å‰destroyï¼›\n>2. pthread_rwlock_t * è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘çš„å†…å­˜åŒºåŸŸæ˜¯mallocåŠ¨æ€åˆ†é…çš„ï¼Œé‚£å°±æ˜¯destroyåï¼Œå†freeé‡Šæ”¾ç©ºé—´ï¼›\n>3. ä½ çš„pthread_rwlock_tå¦‚æœæ˜¯ä¸ªå…¨å±€å˜é‡ï¼Œé‚£ä¹ˆç”Ÿå­˜æœŸå…¶å®å°±ä¸å½±å“ï¼Œç¨‹åºé€€å‡ºå‰destroyã€‚\n\n---\n\n```c\n#include<pthread.h>\n/* å‡½æ•°çš„è¿”å›å€¼ï¼šè‹¥æˆåŠŸï¼Œè¿”å›0ï¼›å¦åˆ™ï¼Œè¿”å›é”™è¯¯ç¼–å· */\nint pthread_rwlock_rdlock(pthread_rwlock_t *rwlock);\nint pthread_rwlock_wrlock(pthread_rwlock_t *rwlock);\nint pthread_rwlock_unlock(pthread_rwlock_t *rwlock);\n```\n\nè¦åœ¨è¯»æ¨¡å¼ä¸‹é”å®šè¯»å†™é”ï¼Œéœ€è¦è°ƒç”¨pthread\\_rwlock\\_rdlockã€‚è¦åœ¨å†™æ¨¡å¼ä¸‹é”å®šè¯»å†™é”ï¼Œéœ€è¦è°ƒç”¨pthread\\_rwlock\\_wrlockã€‚ä¸ç®¡ä»¥ä½•ç§æ–¹å¼é”ä½è¯»å†™é”ï¼Œéƒ½å¯ä»¥è°ƒç”¨pthread\\_rwlock\\_unlockè¿›è¡Œè§£é”ã€‚\n\n# ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹\n\n```c\n#include <stdio.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <pthread.h>\n#include <semaphore.h>\n#include <time.h>\n\n#define BUFFER_MAX 10\n#define PRODUCER_NUM 2\n#define CONSUMER_NUM 3\n\nsem_t empty;\nsem_t full;\npthread_mutex_t mutex;\n\nint buff[BUFFER_MAX];\nint in_index = 0;\nint out_index = 0;\nvoid *produce(void *arg)\n{\n    int index = (int)arg;\n    for (int i = 0; i < 30; i++)\n    {\n        sem_wait(&empty);\n        pthread_mutex_lock(&mutex);\n        buff[in_index] = rand() % 100;\n        printf(\"the producer %d wrote data %d,where %d\\n\", index, buff[in_index], in_index);\n        in_index = (in_index + 1) % BUFFER_MAX;\n        pthread_mutex_unlock(&mutex);\n        sem_post(&full);\n\n        sleep(2);\n    }\n}\nvoid *consume(void *arg)\n{\n    int index = (int)arg;\n    for (int i = 0; i < 20; i++)\n    {\n        sem_wait(&full);\n        pthread_mutex_lock(&mutex);\n        printf(\"the consumer %d read the data %d,from %d\\n\", index, buff[out_index], out_index);\n        out_index = (out_index + 1) % BUFFER_MAX;\n        pthread_mutex_unlock(&mutex);\n        sem_post(&empty);\n        sleep(1);\n    }\n}\n\nint main()\n{\n    sem_init(&empty, 0, BUFFER_MAX);\n    sem_init(&full, 0, 0);\n    pthread_mutex_init(&mutex, NULL);\n\n    srand((int)time(NULL));\n\n    // create the producers\n    pthread_t producer_id[PRODUCER_NUM];\n    for (int i = 0; i < PRODUCER_NUM; i++)\n    {\n        pthread_create(&producer_id[i], NULL, produce, (void *)i);\n    }\n    pthread_t consumer_id[CONSUMER_NUM];\n    for (int i = 0; i < CONSUMER_NUM; i++)\n    {\n        pthread_create(&consumer_id[i], NULL, consume, (void *)i);\n    }\n    for (int i = 0; i < PRODUCER_NUM; i++)\n    {\n        pthread_join(producer_id[i], NULL);\n    }\n    for (int i = 0; i < CONSUMER_NUM; i++)\n    {\n        pthread_join(consumer_id[i], NULL);\n    }\n    sem_destroy(&empty);\n    sem_destroy(&full);\n    pthread_mutex_destroy(&mutex);\n}\n```\n\nç»“æœï¼š\n```\nthe producer 1 wrote data 96,where 0\nthe producer 0 wrote data 73,where 1\nthe consumer 1 read the data 96,from 0\nthe consumer 0 read the data 73,from 1\nthe producer 0 wrote data 54,where 2\nthe producer 1 wrote data 63,where 3\nthe consumer 0 read the data 54,from 2\nthe consumer 2 read the data 63,from 3\nthe producer 1 wrote data 22,where 4\nthe producer 0 wrote data 60,where 5\nthe consumer 1 read the data 22,from 4\nthe consumer 0 read the data 60,from 5\nthe producer 0 wrote data 20,where 6\nthe producer 1 wrote data 47,where 7\nthe consumer 1 read the data 20,from 6\nthe consumer 2 read the data 47,from 7\nthe producer 1 wrote data 7,where 8\nthe producer 0 wrote data 46,where 9\nthe consumer 1 read the data 7,from 8\nthe consumer 0 read the data 46,from 9\nthe producer 0 wrote data 32,where 0\nthe producer 1 wrote data 96,where 1\nthe consumer 0 read the data 32,from 0\nthe consumer 2 read the data 96,from 1\nthe producer 1 wrote data 61,where 2\nthe producer 0 wrote data 35,where 3\nthe consumer 0 read the data 61,from 2\nthe consumer 1 read the data 35,from 3\nthe producer 0 wrote data 29,where 4\nthe producer 1 wrote data 54,where 5\nthe consumer 0 read the data 29,from 4\nthe consumer 2 read the data 54,from 5\nthe producer 1 wrote data 85,where 6\nthe producer 0 wrote data 20,where 7\nthe consumer 0 read the data 85,from 6\nthe consumer 1 read the data 20,from 7\nthe producer 0 wrote data 13,where 8\nthe producer 1 wrote data 71,where 9\nthe consumer 0 read the data 13,from 8\nthe consumer 2 read the data 71,from 9\nthe producer 0 wrote data 4,where 0\nthe producer 1 wrote data 94,where 1\nthe consumer 0 read the data 4,from 0\nthe consumer 1 read the data 94,from 1\nthe producer 1 wrote data 70,where 2\nthe producer 0 wrote data 99,where 3\nthe consumer 0 read the data 70,from 2\nthe consumer 2 read the data 99,from 3\n...\n```\n\n# å®ç°çº¿ç¨‹çš„ä¸‰ç§æ¨¡å¼\n\n## çº¯ç²¹çš„ç”¨æˆ·çº§çº¿ç¨‹\n\n## çº¯ç²¹çš„å†…æ ¸çº§çº¿ç¨‹\n\n## ç»„åˆ\n\n## åŒºåˆ«\n\n1. ç”¨æˆ·çº§\n   1. åˆ›å»ºå¼€é”€å°ï¼Œå¯ä»¥åˆ›å»ºå¾ˆå¤šã€‚\n   2. æ— æ³•ä½¿ç”¨å¤šä¸ªå¤„ç†å™¨\n2. å†…æ ¸çº§\n   1. åˆ›å»ºå¼€é”€å¤§ã€‚\n   2. ç”±å†…æ ¸ç›´æ¥ç®¡ç†\n   3. å¯ä»¥ä½¿ç”¨å¤šä¸ªå¤„ç†å™¨\n\n# çº¿ç¨‹å®‰å…¨\n\n\n\n# æŸ¥çœ‹çº¿ç¨‹ä¿¡æ¯çš„æ–¹æ³•\n\n```bash\nps -ef | grep main\nps -eLf | grep main #UID PID PPID LWPï¼ˆçº¿ç¨‹IDï¼‰ C NLWPï¼ˆçº¿ç¨‹æ•°ç›®ï¼‰\nps -L #æ˜¾ç¤ºçº¿ç¨‹id\n```\n\n# å¤šçº¿ç¨‹ä¸­çš„fork\n\næ‰§è¡Œforkåï¼Œæ•´ä¸ªè¿›ç¨‹ä¼šè¢«å¤åˆ¶ï¼Œä½†æ˜¯è§„å®šåªå¯ç”¨forkæ‰€åœ¨çš„é‚£æ¡æ‰§è¡Œè·¯å¾„ã€‚\n\n# Linuxçº¿ç¨‹çš„ä¼˜åŠ¿\n\n1. å¤–éƒ¨è·å¾—çº¿ç¨‹çš„è¿”å›å€¼ï¼Ÿ\n2. \n\n","categories":["æ“ä½œç³»ç»Ÿ","å¤šçº¿ç¨‹","Linux"]},{"title":"æ’åºç®—æ³•_æ€»è¿°","url":"/ç®—æ³•/æ’åºç®—æ³•_æ€»è¿°/","content":"# å…«å¤§æ’åºç®—æ³•ï¼Œå½’äº 5 ç±»\n\næœ‰å…«ç§å…¸å‹çš„æ’åºç®—æ³•ï¼Œå¯å½’äºäº”å¤§ç±»ï¼š\n\n1. æ’å…¥æ’åº\n    1. ç›´æ¥æ’å…¥æ’åº\n    2. å¸Œå°”æ’åº\n2. é€‰æ‹©æ’åº\n    1. ç®€å•é€‰æ‹©æ’åº\n    2. å †æ’åº\n3. äº¤æ¢æ’åº\n    1. å†’æ³¡æ’åº\n    2. å¿«é€Ÿæ’åº\n4. å½’å¹¶æ’åº\n5. åŸºæ•°æ’åº\n## ç¨³å®šæ€§\n\nä¸¤è¦ç´ ï¼š\n1. ä¸¤ä¸ªå…ƒç´ ç›¸åŒ\n2. æ’åºåè¿™ä¸¤ä¸ªå…ƒç´ æ˜¯å¦èƒ½ä¿æŒåŸæ¥çš„é¡ºåº\n\nä»¥ä¸‹è®¨è®ºçš„é»˜è®¤éƒ½æ˜¯ä»å°åˆ°å¤§çš„æ’åºã€‚\n# æ’å…¥æ’åºï¼ˆç›´æ¥ã€å¸Œå°”ï¼‰\n## ç›´æ¥æ’å…¥æ’åº\nä¾æ¬¡ä»å¾…æ’åºåºåˆ—ä¸­å–å€¼ï¼Œå‘å·²æ’åºåºåˆ—ä¸­æŠ•æ”¾ï¼Œä¿è¯å†æ¬¡å®Œå…¨æœ‰åºï¼Œç›´åˆ°å¾…æ’åºåˆ—ä¸­æ‰€æœ‰å€¼å–å®Œã€‚\n\næ’å…¥æ’åºå¤§å¤šæ•°éƒ½æ˜¯ä¸¤å±‚å¾ªç¯ã€‚\n\nç›´æ¥æ’å…¥æ’åºçš„æ€æƒ³ï¼šå°†å¾…æ’åºæ•°æ®åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œå·¦è¾¹ä¸ºæœ‰åºçš„ï¼Œå³è¾¹æ˜¯æ— åºçš„ã€‚\nä»å³è¾¹æ‹¿ä¸€ä¸ªæ•°æ®æ’å…¥åˆ°å·¦è¾¹ï¼ˆä¸ºäº†æ–¹ä¾¿ï¼Œæ¯æ¬¡æ‹¿å³è¾¹çš„ç¬¬ä¸€ä¸ªæ•°æ®ï¼‰ï¼Œ\néœ€ä¿æŒå·¦è¾¹ç»§ç»­æœ‰åºï¼Œç›´åˆ°å³è¾¹æ²¡æœ‰æ•°æ®ã€‚\n\nè¿‡ç¨‹å¯ä»¥å‚ç…§æ‰‘å…‹ç‰Œæ’å…¥æ’åºã€‚\n### ã€Šç®—æ³•å¯¼è®ºã€‹å†™æ³•\næ€æƒ³ï¼š`j`æŒ‡å‘çš„æ˜¯å·¦ä¾§å·²æ’åºçš„æœ«å°¾ã€‚`i`æŒ‡å‘çš„æ˜¯æœªæ’åºçš„å¼€å¤´ã€‚\nå¤–éƒ¨`for`æ˜¯ä»å·¦åˆ°å³éå†`i`çš„ã€‚\nå†…éƒ¨`for`æ˜¯ä»å³åˆ°å·¦éå†`j`çš„ã€‚\næ¯æ¬¡ï¼Œ`a[i]`å­˜å…¥åˆ°äº†`tmp`ï¼Œè®©`a[j]`å’Œ`tmp`æ¯”è¾ƒï¼Œè‹¥å¤§äºï¼Œè¯´æ˜è¿˜æ²¡æ‰¾åˆ°tmpï¼ˆ`a[i]`ï¼‰åº”è¯¥åœ¨çš„ä½ç½®ã€‚åˆ™`--j`ç»§ç»­æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªå°äºtmpçš„ä½ç½®ã€‚é‚£ä¹ˆï¼Œé€€å‡ºå†…éƒ¨forï¼ŒæŠŠtmpå­˜å…¥åˆ°å®ƒçš„å³è¾¹ä¸€ä¸ªä½ç½®`a[j + 1] = tmp`ã€‚å¼€å§‹ä¸‹ä¸€ä¸ª`a[i]`çš„æ’åºã€‚\n\nè¿™ä¸ªã€Šç®—æ³•å¯¼è®ºã€‹çš„å†™æ³•å¯è¯»æ€§ä¸å¦‚ã€Šç®—æ³•ã€‹çš„å†™æ³•ï¼Œæ¨èçœ‹åè€…çš„ã€‚\n\n```c\nvoid straight_insert_sort(int a[], int n)\n{\n    for(int i = 1; i < n; ++i)\n    {\n        int tmp = a[i];\n        for(int j = i - 1; j > -1; --j)//jæŒ‡ç¤ºæ¬²æ’å…¥çš„ä½ç½®çš„å‰ä¸€ä¸ª\n        {\n            if(a[j] > tmp)//ç§»åŠ¨\n            {\n                a[j + 1] = a[j];\n            }\n            else break;//jä¸å‡1\n        }\n        a[j + 1] = tmp;\n    }\n}\n```\n\nforå¾ªç¯ä½“ä¸­çš„æ¡ä»¶åˆ¤æ–­å¯ä»¥ä¸forè¡¨è¾¾å¼åˆå¹¶\n\n```c\nvoid straight_insert_sort(int a[], int n)\n{\n    for(int i = 1; i < n; ++i)\n    {\n        int tmp = a[i];\n        for(int j = i - 1; tmp < a[j] && j > -1; --j)\n        {\n            a[j + 1] = a[j];\n        }\n        //jæŒ‡ç¤ºæ’å…¥ä½ç½®çš„å‰ä¸€ä¸ªä½ç½®\n        a[j + 1] = tmp;\n    }\n}\n```\n\n### ã€Šç®—æ³•ã€‹å†™æ³•\nåœ¨æ¯éå†ä¸€ä¸ªå€¼æ—¶ï¼Œç›´æ¥æŠŠ`i`å’Œ`j`åŒæ—¶æŒ‡å‘äº†ä¸€ä¸ªä½ç½®ã€‚ç¬¬ 0 ä¸ªä½ç½®è·³è¿‡ï¼ˆæ’åºç®—æ³•çš„å¸¸è§å¥—è·¯ï¼Œç¬¬ 0 ä¸ªä½ç½®ç•¥è¿‡ï¼Œå½“ä½œå·²æ’åºæ•°æ®ï¼‰ã€‚\n\nåŒæ—¶ï¼Œä¸ç”¨å­˜tmpäº†ï¼Œç›´æ¥å°è£…åˆ°äº†`swap`å‡½æ•°ä¸­ã€‚\n\nå†…éƒ¨`for`å¾ªç¯æ¡ä»¶ï¼Œçœ‹`a[j - 1]`æ˜¯å¦å¤§äº`a[j]`ï¼Œå¤§äºåˆ™äº¤æ¢ã€‚\nå†…éƒ¨forå¾ªç¯åšçš„äº‹æƒ…ï¼Œå°±æ˜¯è®©`a[i]`åœ¨å·¦ä¾§ï¼ˆ`j`çš„åŒºåŸŸï¼‰ï¼Œä»å³åˆ°å·¦ï¼Œæ‰¾åˆ°åˆé€‚çš„ä½ç½®æ’å…¥ã€‚\n\n```c\nvoid straight_insert_sort(int a[], int n)\n{\n    for(int i = 1; i < n; ++i)\n    {\n        for(int j = i; a[j - 1] > a[j] && j > 0; --j)\n        {\n            swap(&a[j], &a[j - 1]);\n        }\n    }\n}\n```\n\n| æƒ…å†µ   | æ—¶é—´å¤æ‚åº¦    |\n| ---- | -------- |\n| æœ€å¥½æƒ…å†µ | $O(n)$   |\n| å¹³å‡æƒ…å†µ | $O(n^2)$ |\n| æœ€åæƒ…å†µ | $O(n^2)$ |\n\n## å¸Œå°”æ’åº - æ’å…¥æ’åºçš„ä¼˜åŒ–\n### ã€Šç®—æ³•ã€‹çš„å†™æ³• - 3x+1 å¢é‡\næœ€å¤§é—´éš”ä¸º n / 3ã€‚æ¯æ¬¡é™¤ä»¥ 3 å–æ•´ï¼Œé—´éš”åºåˆ—é•¿åº¦æ˜¯$O(\\log_3 n)$çº§åˆ«ã€‚1, 4, 13, 40, 121, 364, 1093, ...\n\nåœ¨æ’å…¥æ’åºä¸­åŠ å…¥ä¸€ä¸ªå¤–å¾ªç¯ï¼Œæ¥å°† h æŒ‰ç…§é€’å¢åºåˆ—é€’å‡ï¼Œå°±èƒ½å¾—åˆ°è¿™ä¸ªç®€æ´çš„å¸Œå°”æ’åºã€‚\nå¢å¹… h çš„åˆå§‹å€¼æ˜¯æ•°ç»„é•¿åº¦ä¹˜ä»¥ä¸€ä¸ªå¸¸æ•°å› å­ï¼Œæœ€å°ä¸º1ã€‚\n\nå‡è®¾ n æ˜¯ 10 ï¼Œn / 3 æ˜¯ 3ã€‚åˆ™ h åˆå€¼ä¸º 4ã€‚\nå…ˆæŒ‰ ä¸‹æ ‡é—´éš” 4 è¿›è¡Œæ’åºã€‚è®©æ•°ç»„a æ¯ 4 ä¸ªæœ‰åºï¼Œå³ï¼š0ã€4ã€8æœ‰åºï¼Œ1ã€5ã€9æœ‰åºï¼Œ2ã€6ï¼ˆæ²¡æœ‰10ï¼‰æœ‰åºï¼Œ3ã€7æœ‰åºã€‚\nå†è®© h é€’å‡ï¼Œ`h = h / 3`ï¼Œå¾— h ä¸º 1 ã€‚å³æŒ‰ ä¸‹æ ‡é—´éš” 1 è¿›è¡Œæ’åºã€‚è®©æ•°ç»„a æ¯ 1 ä¸ªæœ‰åºï¼Œå³ï¼š0ã€1ã€2ã€3ã€4ã€5ã€6ã€7ã€8ã€9æœ‰åºã€‚\n```c\nvoid shell_sort(int a[], int n)\n{\n    int h = 1;\n    while (h < n / 3) h = 3 * h + 1; // h å¯èƒ½æ˜¯ 1, 4, 13, 40, 121, 364, 1093, ...\n    while (h >= 1)\n    {\n        // å°†æ•°ç»„å˜ä¸º æ¯ h æœ‰åº\n        for (int i = h; i < n; ++i)\n        {\n            // å°†a[i]æ’å…¥åˆ°a[i-h], a[i-2*h], a[i-3*h]... ä¹‹ä¸­\n            for (int j = i; j - h > -1 && a[j] < a[j - h]; j -= h)\n            {\n                swap(&a[j], &a[j - h]);\n            }\n        }\n        h = h / 3;\n    }\n}\n```\nåœ¨æœ€åçš„æƒ…å†µä¸‹è¯¥ç®—æ³•çš„æ¯”è¾ƒæ¬¡æ•° å’Œ $N^{3/2}$ æˆæ­£æ¯”ã€‚\n**ç»éªŒå¹³å‡å¤æ‚åº¦**ï¼ˆå¤§é‡éšæœºè¾“å…¥ï¼‰ï¼š$O(n^{3/2})$\n**æœ€åæƒ…å†µå¤æ‚åº¦**ï¼š$O(n^{2})$ã€‚Shell æ’åºæ²¡æœ‰ä¸¥æ ¼çš„æœ€åæƒ…å†µæ¬¡æ–¹çº§ä¼˜åŒ–ä¿è¯ï¼ŒæŸäº›ç‰¹æ®Šåºåˆ—ä¼šé€€åŒ–åˆ°å¹³æ–¹çº§\næœ€å¥½æƒ…å†µå¤æ‚åº¦ï¼ˆæ•°ç»„å·²ç»æœ‰åºï¼‰ï¼š$O(n \\log n)$ã€‚å› ä¸ºæ¯ä¸ª h æ’åºåªéœ€ä¸€æ¬¡çº¿æ€§æ‰«æ\n\n### Buboçš„å†™æ³• - æŠ˜åŠå¢é‡\nè¿™æ˜¯æŠ˜åŠå¢é‡åºåˆ—ï¼Œè™½ç„¶åœ¨å¸¸æ•°å› å­ä¸Šæ¯”æ™®é€šæ’å…¥æ’åºå¥½ï¼Œä½†åœ¨æ•°æ®è§„æ¨¡å¤§æ—¶æ˜æ˜¾æ…¢äºç”¨ 3x+1 åºåˆ—çš„æ’åºã€‚\n\næœ€å¤§é—´éš”ä¸ºn / 2ã€‚å¢é‡ä¾æ¬¡ä¸ºï¼šn/2,n/4,n/8,â€¦,1ã€‚åºåˆ—é•¿åº¦ çº¦ç­‰äº $\\log_2 n$ã€‚ 1, 2, 4, 8, 16, 32, 64, ...\n\n```c\nvoid shell_sort(int a[], int n)\n{\n    for(int k = n / 2; k > 0; k /= 2) // kä¸ºç»„è·æˆ–ç»„æ•°\n    {\n        // ç»„å†…è¿›è¡Œ\"ç›´æ¥æ’å…¥æ’åº\"\n        for(int i = k; i < n; i += k)\n        {\n            for(int j = i; j > k - 1 && a[j - k] > a[j]; j -= k)\n            {\n                swap(&a[j - k], &a[j]);\n            }\n        }\n    }\n}\n```\nç”±äºæœ€åä¸€æ¬¡ k=1 ç­‰åŒäºç›´æ¥æ’å…¥æ’åºï¼Œä¸”å‰å‡ è½®æ•ˆæœä¸å¤Ÿæ˜¾è‘—ï¼Œæ€»ä½“æ—¶é—´å¤æ‚åº¦ï¼š$O(n^2)$\nå¹³å‡æƒ…å†µï¼šä¾ç„¶æ¥è¿‘$O(n^2)$ã€‚æ¯”å•çº¯çš„æ’å…¥æ’åºå¿«å¸¸æ•°å€ï¼Œä½†æ•°é‡çº§ä¸å˜ã€‚\næœ€å¥½æƒ…å†µï¼šå¦‚æœæ•°ç»„åˆå§‹å°±æ˜¯æœ‰åºçš„ï¼Œæ¯è½®åªåšä¸€æ¬¡æ‰«æï¼Œå¤æ‚åº¦ï¼š$O(n \\log n)$\n\n| æƒ…å†µ   | æ—¶é—´å¤æ‚åº¦         |\n| ---- | ------------- |\n| æœ€å¥½æƒ…å†µ | $O(n \\log n)$ |\n| å¹³å‡æƒ…å†µ | $O(n^2)$      |\n| æœ€åæƒ…å†µ | $O(n^2)$      |\næ‰€ä»¥ï¼Œè¿™ç§ï¼ˆæŠ˜åŠå¢é‡ï¼‰å¦‚æœä¸åœ¨åºåˆ—å¢é‡ï¼ˆ3x+1 å¢é‡ï¼‰ä¸Šè¿›è¡Œä¼˜åŒ–ï¼Œè¿˜ä¸å¦‚ç›´æ¥ç”¨ç›´æ¥æ’å…¥æ’åºã€‚\n### 3x+1 å¯¹æ¯” æŠ˜åŠ å¢é‡çš„ä¼˜åŠ¿\n**æ’å…¥æ’åºçš„ä¸€ä¸ªæ ¸å¿ƒç‰¹ç‚¹** â€”â€” å®ƒçš„æ•ˆç‡é«˜åº¦ä¾èµ–æ•°æ®çš„**æœ‰åºç¨‹åº¦**ï¼Œæ‰€ä»¥åºåˆ—ä¸åŒæ€§èƒ½å·®å¼‚ä¼šå¾ˆå¤§ã€‚\n\næŠ˜åŠå¢é‡çš„æ—©æœŸé—®é¢˜ï¼š\nå½“ gap å¾ˆå¤§æ—¶ï¼ˆæ¯”å¦‚ n/2ï¼‰ï¼š\n- **å­åºåˆ—å¾ˆçŸ­**ï¼š  \n    gap = n/2 â†’ æ¯ä¸ªå­åºåˆ—åªæœ‰ 2 ä¸ªå…ƒç´   \n    gap = n/4 â†’ æ¯ä¸ªå­åºåˆ—åªæœ‰ 4 ä¸ªå…ƒç´ \n- **æ¯”è¾ƒè¦†ç›–åº¦ä½**ï¼š  \n    å¤§ gap æ’åºæ—¶ï¼Œåªæ¯”è¾ƒå¾ˆç¨€ç–çš„å…ƒç´ å¯¹ï¼Œå¤§éƒ¨åˆ†å…ƒç´ é—´çš„ç›¸å¯¹é¡ºåºå¹¶æ²¡æœ‰ç›´æ¥è°ƒæ•´\n- **é€†åºå¯¹æ¶ˆé™¤æ•ˆç‡ä½**ï¼š  \n    Shell æ’åºçš„æ€§èƒ½æå‡ä¾èµ–äºå°½æ—©å‡å°‘é€†åºå¯¹  \n    ä½†å¤§ gap åªèƒ½æ¶ˆé™¤ç›¸éš”å¾ˆè¿œçš„é€†åºå¯¹ï¼Œå¾ˆå¤šå±€éƒ¨é€†åºï¼ˆç›¸éš” < gap çš„ï¼‰è¿˜ç•™ç€ï¼Œç­‰åˆ° gap å˜å°æ—¶æ‰ä¼šå¤„ç†\n\n3x+1 å¢é‡ å¯¹æ¯” æŠ˜åŠå¢é‡çš„ä¼˜åŠ¿\n- **æŠ˜åŠå¢é‡ n/2=8 ç¬¬ä¸€è½®**æ—¶ï¼Œæ¯ä¸ªå­åºåˆ—é•¿åº¦åªæœ‰ 2ï¼Œå¯¹å±€éƒ¨é€†åºå‡ ä¹æ²¡å½±å“ï¼›\n- **3x+1 ç¬¬ä¸€è½® h=13** æ—¶ï¼Œå­åºåˆ—é•¿è¾¾ 3 æˆ– 4ï¼Œèƒ½ä¸€æ¬¡è°ƒæ•´æ›´å¤§èŒƒå›´çš„å…ƒç´ ï¼Œè¿…é€Ÿå‡å°‘é€†åºå¯¹\n- åˆ° h=1 æ—¶ï¼Œ3x+1 ç‰ˆæœ¬å‰©ä¸‹çš„ä¹±åºéå¸¸å°‘ï¼Œæ‰€ä»¥æœ€åæ’å…¥æ’åºå¾ˆå¿«\n\nåŸå§‹æ•°ç»„ï¼ˆé€†åºï¼‰ï¼š\n16 15 14 13 12 11 10  9  8  7  6  5  4  3  2  1\n\næŠ˜åŠå¢é‡ç¬¬ä¸€è½®ï¼š\n```\nåŸå§‹ï¼š16 15 14 13 12 11 10  9  8  7  6  5  4  3  2  1\ngap=8: (16,8), (15,7), (14,6), (13,5), (12,4), (11,3), (10,2), (9,1)\nç»“æœï¼š 8  7  6  5  4  3  2  1 16 15 14 13 12 11 10  9\n```\nè™½ç„¶ä½ç½®å˜åŒ–å¾ˆå¤§ï¼Œä½†å‰ 8 ä¸ªå’Œå 8 ä¸ªä¾æ—§æ˜¯é€†åºçš„ï¼›\nç»å¤§å¤šæ•°å±€éƒ¨é€†åºè¿˜åœ¨ï¼Œä¸‹ä¸€è½® gap=4 æ—¶æ‰å¼€å§‹æ‰“ä¹±å®ƒä»¬ã€‚\n\n3x+1 å¢é‡ç¬¬ä¸€è½®ï¼š\n- å­åºåˆ—æ˜¯æŒ‰ä¸‹æ ‡ç›¸å·® 13 åˆ†çš„åˆ†ç»„ï¼š\n    - ç»„1: (16, 3)\n    - ç»„2: (15, 2)\n    - ç»„3: (14, 1)\n    - å…¶ä»–å…ƒç´ åªå’Œè‡ªå·±æ¯”è¾ƒ\n- å¯¹æ¯ä¸ªå­åºåˆ—è¿›è¡Œæ’å…¥æ’åºï¼š\n\n```\n3  2  1 13 12 11 10  9  8  7  6  5  4 16 15 14\n```\n\n3x+1 å¢é‡ç¬¬äºŒè½®ï¼ˆh = 4ï¼‰\n- å­åºåˆ—ï¼ˆé—´éš” 4ï¼‰\n    - ç»„1: (3, 12, 8, 4)\n    - ç»„2: (2, 11, 7, 16)\n    - ç»„3: (1, 10, 6, 15)\n    - ç»„4: (13, 9, 5, 14)\n- å„ç»„å†…éƒ¨æ’å…¥æ’åºï¼š\n\nç»“æœï¼š\n`3  2  1  5  8  7  6  9 12 11 10 13  4 16 15 14`\nï¼ˆå·²ç»æ›´æ¥è¿‘æœ‰åºï¼‰\n## æ’å…¥æ’åºæ€»ç»“\n- **é€†åºå¯¹åˆ†æ**ï¼šæ—¶é—´å¤æ‚åº¦ä¸æ•°ç»„ä¸­çš„é€†åºå¯¹æ•°é‡æˆæ­£æ¯”\n- **ä¸å¸Œå°”æ’åºå…³ç³»**ï¼šå¸Œå°”æ’åºæ˜¯æ’å…¥æ’åºçš„æ¨å¹¿ï¼ˆå¤šé—´éš”æ’å…¥ï¼‰ï¼Œè§£å†³äº†å¤§è§„æ¨¡æ•°æ®ç§»åŠ¨ä»£ä»·é«˜çš„é—®é¢˜\n- **å®é™…æ¡ˆä¾‹**ï¼šC++ STL çš„ `std::sort` å¯¹å°æ•°ç»„ï¼ˆä¸€èˆ¬ â‰¤ 32 å…ƒç´ ï¼‰å†…éƒ¨ä¼šç”¨æ’å…¥æ’åºæ”¶å°¾ï¼ˆå¿«é€Ÿæ’åºçš„å°¾é€’å½’éƒ¨åˆ†ï¼‰ï¼Œå› ä¸ºå®ƒåœ¨ç¼“å­˜å‘½ä¸­ç‡å’Œåˆ†æ”¯é¢„æµ‹ä¸Šå¾ˆé«˜æ•ˆã€‚\n- éå¸¸é€‚åˆå°è§„æ¨¡æˆ–æ¥è¿‘æœ‰åºçš„æ•°æ®\n- ä¸åŒçš„å¢é‡åºåˆ— â†’ å†³å®šäº†å¸Œå°”æ’åºæ¯ä¸€è½®èƒ½æ¶ˆé™¤å¤šå°‘é€†åºå¯¹ â†’ å†³å®šäº†æœ€å gap=1 æ—¶çš„å·¥ä½œé‡ â†’ ç›´æ¥å½±å“æ€§èƒ½ã€‚\n\nå¢é‡åºåˆ—çš„ä½œç”¨\n* å¸Œå°”æ’åºçš„æ•ˆç‡ï¼Œå–å†³äºå®ƒèƒ½å¤šå¿«æŠŠé€†åºå¯¹å‡å°‘åˆ°æ¥è¿‘ 0ã€‚\n* gap å¾ˆå¤§æ—¶ â†’ åªèƒ½æ¶ˆé™¤é•¿è·ç¦»çš„é€†åºå¯¹ï¼ˆä¸‹æ ‡å·® â‰¥ gapï¼‰\n* gap å˜å°æ—¶ â†’ æ‰èƒ½å¤„ç†æ›´çŸ­è·ç¦»çš„é€†åºå¯¹ï¼ˆä¸‹æ ‡å·® < gapï¼‰\n\næœ€åä¸€è½® gap=1ï¼ˆæ™®é€šæ’å…¥æ’åºï¼‰ â†’ å¿…é¡»å¤„ç†å‰©ä½™æ‰€æœ‰çŸ­è·ç¦»é€†åºå¯¹\n1. æŠ˜åŠå¢é‡ï¼ˆn/2, n/4, â€¦, 1ï¼‰\n    - å‰å‡ è½® gap å¾ˆå¤§æ—¶ï¼Œæ¯ä¸ªå­åºåˆ—å¾ˆçŸ­\n    - åªèƒ½æ¶ˆé™¤å°‘é‡é•¿è·ç¦»é€†åºå¯¹ï¼Œå¾ˆå¤šçŸ­è·ç¦»é€†åºå¯¹è¦ç•™åˆ°æœ€åä¸€æ¬¡ gap=1 æ—¶å¤„ç†\n    - å¯¼è‡´æœ€åä¸€è½®å‡ ä¹æ˜¯å®Œæ•´çš„ $O(n^2)$ æ’å…¥æ’åº\n2. ä¼˜åŒ–è¿‡çš„å¢é‡ï¼ˆ3x+1ï¼‰\n    - gap åºåˆ—é€’å‡æ¯”ä¾‹è¾ƒå°ï¼ˆçº¦ 2~3 å€ï¼‰ï¼Œè€Œä¸æ˜¯ç›´æ¥å‡åŠ\n    - æ¯ä¸€è½®çš„å­åºåˆ—æ›´é•¿ï¼Œèƒ½ä¸€æ¬¡æ¶ˆé™¤å¤šç§ä¸åŒè·¨åº¦çš„é€†åºå¯¹\n    - åˆ°æœ€å gap=1 æ—¶ï¼Œæ•°ç»„å·²ç»æ¥è¿‘æœ‰åºï¼Œé€†åºå¯¹å¾ˆå°‘ â†’ æ’å…¥æ’åºéå¸¸å¿«\n\né€†åºå¯¹æ˜¯ä»€ä¹ˆï¼Ÿ\n```\n[3, 1, 2]\né€†åºå¯¹ï¼š(3, 1)ã€(3, 2)\næ€»å…± 2 ä¸ªé€†åºå¯¹ã€‚\n```\n# é€‰æ‹©æ’åºï¼ˆç®€å•ã€å †æ’ï¼‰\næ¯æ¬¡æ‰¾åˆ°å‰©ä½™åºåˆ—ä¸­æœ€å°çš„å…ƒç´ ï¼Œæ”¾åˆ°å·²æ’åºåºåˆ—çš„å°¾éƒ¨ï¼ˆæˆ–è€…çœ‹ä½œå‰©ä½™åºåˆ—çš„å¤´éƒ¨ï¼‰ã€‚\n**ä¸æ–­åœ°é€‰æ‹©å‰©ä½™å…ƒç´ ä¹‹ä¸­çš„æœ€å°è€…**ã€‚\n## ç®€å•é€‰æ‹©æ’åº\nã€Šç®—æ³•ã€‹çš„å†™æ³•ï¼š\n```c\nvoid selection_sort(int a[], int n)\n{\n    for (int i = 0; i < n; ++i)\n    {\n        int min_idx = i;\n        for (int j = i + 1; j < n; ++j)\n        {\n            if (a[j] < a[min_idx])\n            {\n                min_idx = j;\n            }\n        }\n        // æ³¨æ„ï¼Œæ˜¯ a[i]è€Œä¸æ˜¯a[j] å’Œ a[min_idx]äº¤æ¢\n        swap(&a[i], &a[min_idx]);\n    }\n}\n```\n\n```\ni min   0 1 2 3 4 5 6 7 8 9 10\n        S O R T E X A M P L E\n0  6    S O R T E X A M P L E\n1  4    A O R T E X S M P L E\n2  10   A E R T O X S M P L E\n3  9    A E E T O X S M P L R\n4  7    A E E L O X S M P T R\n5  7    A E E L M X S O P T R\n6  8    A E E L M O S X P T R\n7  10   A E E L M O P X S T R\n8  8    A E E L M O P R S T X\n9  9    A E E L M O P R S T X\n10 10   A E E L M O P R S T X\n```\n\nä¼˜åŒ–ï¼šç¬¬ä¸€å±‚forä¸­çš„`i`å¯ä»¥ä¼˜åŒ–ä¸º`i < n - 1`ï¼Œå› ä¸ºæ’æœ€åä¸€ä¸ªæ—¶ï¼Œå‰©ä½™åºåˆ—å°±1ä¸ªæ•°äº†ï¼Œæ— éœ€å†æ‰¾æœ€å°äº†ã€‚\n\n```c\nvoid selection_sort(int a[], int n)\n{\n    int min_idx;\n    for(int i = 0; i < n - 1; ++i)\n    {\n        min_idx = i;\n        for(int j = i + 1; j < n; ++j)\n        {\n            if(a[j] < a[min_idx])\n            {\n                min_idx = j;\n            }\n        }\n        swap(&a[i], &a[min_idx]);\n    }\n}\n```\n\n## å †æ’åº\n\nå †çš„ä½œç”¨æ˜¯äº§ç”Ÿä¸€ä¸ªæå€¼å…ƒç´ ã€‚\n\nå †æ˜¯ä¸€ç§å®Œå…¨äºŒå‰æ ‘ã€‚ï¼ˆåŒºåˆ†æ¦‚å¿µï¼šäºŒå‰æ ‘ã€æ»¡äºŒå‰æ ‘ã€å®Œå…¨äºŒå‰æ ‘ï¼‰\n\næ€»ä½“çš„æ’åºè¿‡ç¨‹ï¼šé¦–å…ˆè¦ä¿è¯æ•´ä¸ªäºŒå‰æ ‘æ˜¯ä¸€ä¸ªå¤§ï¼ˆå°ï¼‰æ ¹å †ï¼Œå³**æ¯ä¸€ä¸ªçˆ¶èŠ‚ç‚¹éƒ½è¦æ¯”å…¶å­èŠ‚ç‚¹å¤§ï¼ˆå°ï¼‰**ï¼Œå¦‚æ­¤å°±èƒ½ä¿è¯æ•´ä¸ªæ ‘çš„æ ¹èŠ‚ç‚¹å°±æ˜¯æœ€å¤§ï¼ˆå°ï¼‰çš„èŠ‚ç‚¹ï¼Œå³äº§ç”Ÿäº†ä¸€ä¸ªæå€¼å…ƒç´ ã€‚\næˆ‘ä»¬æŠŠå®ƒå’Œæœªæ’åºçš„æœ€åä¸€ä¸ªå¶å­èŠ‚ç‚¹äº’æ¢å€¼ï¼Œè€Œäº¤æ¢å®Œä¹‹åï¼Œæ ¹èŠ‚ç‚¹æ‰“ä¹±äº†å¤§ï¼ˆå°ï¼‰æ ¹å †çš„ç»“æ„ï¼Œéœ€è¦é‡æ–°ä¿è¯æ•´ä¸ªäºŒå‰æ ‘æ˜¯ä¸€ä¸ªå¤§ï¼ˆå°ï¼‰æ ¹å †ï¼Œæ‰èƒ½äº§ç”Ÿæå€¼å…ƒç´ ä¸æœ€åä½ç½®äº¤æ¢ã€‚\nå¦‚æ­¤ï¼Œå¾ªç¯å¾€å¤ï¼Œæ¯æ‰¾åˆ°ä¸€ä¸ªæå€¼ç‚¹ï¼Œå°±æ¢å…¶åˆ°æœ€åï¼ˆå½’åˆ°å·²æ’åºæ•°åˆ—ä¸­ï¼‰ï¼Œå°±å¯ä»¥è¾¾åˆ°æ’åºçš„ç›®çš„ã€‚\n\n**å…¶ä¸­ï¼Œæ‰¾æå€¼å…ƒç´ ï¼Œå³ä¿è¯æ ‘ä¸ºå¤§ï¼ˆå°ï¼‰æ ¹å †çš„è¿‡ç¨‹ï¼Œæ˜¯ä¸€ä¸ªé€’å½’è¿‡ç¨‹**ï¼šå› ä¸ºå¤§ï¼ˆå°ï¼‰æ ¹å †çš„æ¦‚å¿µå°±æ˜¯ï¼š**å®Œå…¨äºŒå‰æ ‘ä¸­ï¼Œæ¯ä¸€ä¸ªçˆ¶èŠ‚ç‚¹éƒ½è¦æ¯”å…¶å­èŠ‚ç‚¹å¤§ï¼ˆå°ï¼‰**ã€‚ç”±äºæ¶‰åŠåˆ°æ ‘ï¼Œå¹¶ä¸”æ¶‰åŠåˆ°å±‚å±‚ç›¸æ‰£çš„å¤§å°å…³ç³»ï¼Œå› æ­¤å †åŒ–çš„è¿‡ç¨‹æ˜¯ä¸€ä¸ªé€’å½’è¿‡ç¨‹ã€‚\n\nå¦‚æœæŠŠæ•°æ®æŠ½è±¡ä¸ºå †ç»“æ„å»æ’åºï¼Œé‚£ä¹ˆé¦–å…ˆæˆ‘ä»¬éœ€è¦å»ºç«‹å †ã€‚éœ€è¦ä»æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹è¿›è¡Œé€†å‘éå†ï¼Œä¾æ¬¡ä»¥èŠ‚ç‚¹ä¸ºæ ¹è¿›è¡Œå †åŒ–ã€‚\n\n### å †åŒ–å‡½æ•°\nå †åŒ–å‡½æ•°ï¼Œé€’å½’åœ°è®©æ•´é¢—å®Œå…¨äºŒå‰æ ‘æ¯ä¸ªèŠ‚ç‚¹éƒ½å¤§äºï¼ˆå°äºï¼‰å…¶å­èŠ‚ç‚¹ã€‚æ ¹èŠ‚ç‚¹å¤§äºå­—èŠ‚ç‚¹åˆ™æ˜¯å¤§æ ¹å †ï¼Œæ ¹èŠ‚ç‚¹å°äºå­èŠ‚ç‚¹åˆ™æ˜¯å°æ ¹å †ã€‚\n\næ³¨æ„ï¼ï¼ï¼å †åŒ–å‡½æ•°åªé€‚ç”¨äºï¼šåªæœ‰æ ¹èŠ‚ç‚¹ä¸æ˜¯å¤§ï¼ˆå°ï¼‰æ ¹å †ï¼Œè€Œå…¶ä»–èŠ‚ç‚¹ç¬¦åˆå¤§ï¼ˆå°ï¼‰æ ¹å † çš„æƒ…å†µã€‚\n\nä»¥ä¸‹çš„å †åŒ–å‡½æ•°ï¼Œæ˜¯åŸºäºä¸€ä¸ªrootä¸ºæ ¹åˆ°lastèŠ‚ç‚¹çš„å¤§æ ¹å †ã€‚ï¼ˆè¿™æ®µä»£ç ï¼Œäº‹å®ä¸Šæ˜¯ï¼šç”±äºèŠ‚ç‚¹æ¯”å­èŠ‚ç‚¹å°ï¼Œè¿›è¡Œä¸‹æ²‰æ“ä½œï¼‰\nå †åŒ–å‡½æ•°ï¼Œè®©å®ƒç¡®ä¿æ¢å¤åˆ°å¤§æ ¹å †çš„çŠ¶æ€ã€‚\n```c\nvoid heapify(int a[], int root_idx, int last_idx)\n{\n    int left = root_idx * 2 + 1; //rootæœ€å°å€¼å¯èƒ½ä¸º0\n    int right = left + 1;\n    // åˆ¤æ–­è¯¥æ ¹èŠ‚ç‚¹æ˜¯å¦æœ‰å­èŠ‚ç‚¹ï¼Œå¦‚æœleftè¶…è¿‡äº†last_idxå€¼åˆ™é€€å‡º\n    if(left > last_idx) return;\n    int max = root_idx;\n    // è¿è¡Œåˆ°è¿™é‡Œæ—¶ï¼Œleft > last_idxï¼Œå³last_idx <= leftï¼Œç”±äºæ˜¯å®Œå…¨äºŒå‰æ ‘çš„é€»è¾‘ç»“æ„ï¼Œå› æ­¤maxä¸€å®šæœ‰å·¦å­æ ‘ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥çœ‹[left]å’Œ[max]çš„å¤§å°å…³ç³»\n    if(a[left] > a[max])\n    {\n        max = left;\n    }\n    // ä½†æˆ‘ä»¬ä¸èƒ½ç¡®å®šæ˜¯å¦maxæœ‰å³å­æ ‘ï¼Œéœ€è¦åˆ¤æ–­\n    if(right <= last_idx)\n    {\n        if(a[right] > a[max])\n        {\n            max = right;\n        }\n    }\n    if(max != root_idx)\n    {\n        exchange(a, &a[root_idx], &a[max]);\n        heapify(a, max, last_idx);\n    }\n}\n```\n### å †åŒ–å‡½æ•°å’Œä¼˜å…ˆçº§é˜Ÿåˆ—çš„å…³ç³» - ä¸Šæµ®ã€ä¸‹æ²‰å‡½æ•°\nä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå¤§æ ¹å †ï¼Œæ ¹èŠ‚ç‚¹çš„ä¼˜å…ˆçº§æœ€å¤§ã€‚\n\nå¤§æ ¹å †ä¸­ï¼Œä¸Šæµ®ï¼Œswimï¼Œæˆ–FilterUpã€‚å³ç”±äºä¸€ä¸ªèŠ‚ç‚¹**å¤§äºå…¶çˆ¶èŠ‚ç‚¹**ï¼Œä¸Šæµ®ã€‚\nå¤§æ ¹å †ä¸­ï¼Œä¸‹æ²‰ï¼Œsinkï¼Œæˆ–FilterDownã€‚å³ç”±äºä¸€ä¸ªèŠ‚ç‚¹**å°äºå…¶æ‰€æœ‰å­èŠ‚ç‚¹**ï¼Œä¸‹æ”¾ã€‚\n\næˆ‘ä»¬ä»¥ä¸‹æè¿°çš„å‡ä¸ºæ•°ç»„ä¸‹æ ‡ã€‚å› æ­¤ï¼Œå‡è®¾æŸèŠ‚ç‚¹å¯¹åº”çš„ä¸‹æ ‡ä¸º`i`ï¼Œåˆ™å·¦å­èŠ‚ç‚¹çš„ä¸‹æ ‡å°±ä¸º`2 * i + 1`\n```c\nvoid FilterDown(int a[], int start_idx, int end_idx)\n{\n    int i = start_idx;\n    int j = i * 2 + 1;\n    // çœ‹æœ‰æ²¡æœ‰å­èŠ‚ç‚¹ã€‚\n    while (j <= end_idx)\n    {\n        // çœ‹ æœ‰æ²¡æœ‰ å³å­èŠ‚ç‚¹ã€‚å¦‚æœæœ‰åˆ™ çœ‹ å·¦å­èŠ‚ç‚¹å’Œå³å­èŠ‚ç‚¹å“ªä¸ªæ›´å¤§ã€‚\n        if (j < end_idx && a[j + 1] > a[j])\n        {\n            j = j + 1;\n        }\n        // æŠŠæ›´å¤§çš„å­èŠ‚ç‚¹a[j] ä¸ a[i]æ¯”è¾ƒã€‚å¦‚æœa[i] å¤§äºç­‰äº a[j]ï¼Œåˆ™ i èŠ‚ç‚¹ä¸ç”¨æ¢ä½ç½®äº†\n        if (a[i] >= a[j])\n        {\n            break;\n        }\n        swap(&a[i], &[j]);\n        // a[i] å’Œ a[j] äº¤æ¢åï¼Œi èŠ‚ç‚¹å’Œ å®ƒçš„å­èŠ‚ç‚¹æœ‰åºäº†\n        // ä½†æ˜¯ï¼Œj èŠ‚ç‚¹çš„å€¼æ¢æˆäº† a[i]ï¼Œæœ‰å¯èƒ½ j èŠ‚ç‚¹å’Œå®ƒçš„å­èŠ‚ç‚¹ä¹±åºäº†ã€‚é‡æ–°å¼€å§‹ã€‚\n        i = j;\n        j = i * 2 + 1;\n    }\n}\n```\n`(i - 1) / 2`æ˜¯`i`èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ã€‚\næ‰€è°“ä¸Šæµ®ï¼Œæ˜¯é‡ç‚¹å…³æ³¨äºè¯¥èŠ‚ç‚¹æœ¬èº«ï¼Œä¸çˆ¶èŠ‚ç‚¹æ¯”è¾ƒå¤§å°ã€‚æ— éœ€å…³æ³¨å…„å¼ŸèŠ‚ç‚¹ã€‚\n```c\nvoid FilterUp(int a[], int start_idx)\n{\n    int i = start_idx;   // å­èŠ‚ç‚¹\n    int j = (i - 1) / 2; // çˆ¶èŠ‚ç‚¹\n    // è‹¥ å­èŠ‚ç‚¹ å¤§äº çˆ¶èŠ‚ç‚¹ åˆ™ ä¸Šä½\n    while (i > 0 && a[i] > a[j])\n    {\n        swap(&a[i], &a[j]);\n        // a[i] å’Œ a[j] äº¤æ¢åï¼Œi èŠ‚ç‚¹å’Œ å®ƒçš„çˆ¶èŠ‚ç‚¹ j æœ‰åºäº†ï¼ˆç›®å‰a[i] < a[j]ï¼Œå­èŠ‚ç‚¹å°äºçˆ¶èŠ‚ç‚¹ï¼‰\n        // ä½†æ˜¯ï¼Œæœ‰å¯èƒ½ j èŠ‚ç‚¹ å’Œ j çš„çˆ¶èŠ‚ç‚¹ ä¹±åºã€‚é‡æ–°å¼€å§‹ã€‚\n        i = j;\n    }\n}\n```\n### å»ºå †\n\nå†æ¬¡æ³¨æ„ï¼ï¼ï¼å †åŒ–å‡½æ•°åªé€‚ç”¨äºåªæœ‰æ ¹èŠ‚ç‚¹ä¸æ˜¯å¤§ï¼ˆå°ï¼‰æ ¹å †ï¼Œè€Œå…¶ä»–èŠ‚ç‚¹ç¬¦åˆå¤§ï¼ˆå°ï¼‰æ ¹å † çš„æƒ…å†µã€‚\n\nå› æ­¤åœ¨å †åŒ–ä¹‹å‰æˆ‘ä»¬åº”è¯¥å…ˆå»ºç«‹ä¸€ä¸ªå¤§ï¼ˆå°ï¼‰æ ¹å †ï¼\n\næ€ä¹ˆå»ºç«‹å¤§ï¼ˆå°ï¼‰æ ¹å †å‘¢ï¼Ÿæˆ‘ä»¬è¦åˆ©ç”¨ä¸Šé¢è¿™ä¸ªå †åŒ–å‡½æ•°ã€‚è€Œåˆšæ‰ä¸€ç›´åœ¨åå¤å¼ºè°ƒï¼Œå †åŒ–å‡½æ•°åªèƒ½ç”¨äºé™¤äº†æ ¹èŠ‚ç‚¹æ²¡æœ‰å †åŒ–ï¼Œå…¶ä»–èŠ‚ç‚¹å·²å…¨éƒ¨å †åŒ–çš„æƒ…å†µã€‚æ‰€ä»¥ï¼šåªèƒ½ä»éå¶å­èŠ‚ç‚¹é€†ç€ä¾æ¬¡å †åŒ–ï¼æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹ä¸ºï¼š`(last_idx - 1) / 2`ã€‚ï¼ˆ`last_idx`è¡¨ç¤ºæ•°ç»„ä¸‹æ ‡ï¼Œä»0å¼€å§‹ï¼‰\n\n```c\nvoid create_heap(int a[], int root_idx, int last_idx)\n{\n    for(int i = (last_idx - 1) / 2; i > -1; --i)\n    {\n        heapify(a, i, last_idx);\n    }\n}\n```\n### æ’åº\n\nå¦‚ä¸Šæ–‡ï¼Œæ¯æ¬¡äº§ç”Ÿä¸€ä¸ªæå€¼å…ƒç´ ï¼Œå’Œæœªæ’åºçš„æœ€åä¸€ä¸ªå¶å­èŠ‚ç‚¹äº’æ¢å€¼ï¼Œå°±å¯ä»¥è¾¾åˆ°æ’åºçš„ç›®çš„ã€‚\n\n```c\nvoid heap_sort(int a[], int n)\n{\n    create_heap(a, 0, n - 1);\n    for(int i = n - 1; i > 0; )\n    {\n        exchange(a, &a[0], &a[i]);\n        --i;\n        heapify(a, 0, i);\n    }\n}\n```\n### ç”¨ä¸‹æ²‰å‡½æ•°è¿›è¡Œå †æ’åº\næ­¤å¤„ï¼Œsinkï¼Œç”Ÿæˆäº†ä¸€ä¸ªå¤§æ ¹å †ã€‚\nä¹‹åæ¯æ¬¡æŠŠå¤§æ ¹ï¼ˆæ•´æ£µæ ‘çš„æœ€å¤§å€¼ï¼‰æ”¾åˆ°åé¢ï¼Œå½“ä½œå·²æ’åºåºåˆ—ã€‚å†å¯¹æœªæ’åºè¿›è¡Œå¤§æ ¹åŒ–ã€‚ä»¥æ­¤å¾€å¤ã€‚\nå› æ­¤ï¼ŒåŸºäºå¤§æ ¹å †çš„æ’åºä¹‹åçš„åºåˆ—æ˜¯å‡åºçš„ï¼ˆä»å°åˆ°å¤§ï¼‰\nåŒç†ï¼ŒåŸºäºå°æ ¹å †çš„æ’åºä¹‹åçš„åºåˆ—æ˜¯é™åºçš„ï¼ˆä»å¤§åˆ°å°ï¼‰\n```c\nvoid heap_sort(int a[], int n)\n{\n    // i åˆå§‹åŒ–ä¸º å°¾ èŠ‚ç‚¹çš„ çˆ¶ èŠ‚ç‚¹\n    // ä» æœ€åä¸€ä¸ª æœ‰åˆ†æ”¯çš„ èŠ‚ç‚¹ å¼€å§‹ï¼Œä¸€ç›´åˆ° 0 èŠ‚ç‚¹ï¼ˆæ•´æ£µæ ‘çš„æ ¹ï¼‰æ¯ä¸ª äºŒå‰æ ‘ éƒ½ åšä¸€æ¬¡ å¤§æ ¹åŒ– æ“ä½œ\n    for (int i = (n - 1) / 2; i >= 0; i--)\n    {\n        // sink çš„ ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ å…¥çš„æ˜¯ ä¸‹æ ‡ï¼Œn - 1æŒ‡å°¾èŠ‚ç‚¹çš„ä¸‹æ ‡\n        sink(a, i, n - 1);\n    }\n    int i = n - 1;\n    // i ç­‰äº 0 æ—¶ï¼Œåˆ™ æœªæ’åºçš„åªå‰©ä¸€ä¸ªæ•°äº†ï¼Œä¸ç”¨å†æ’åºã€‚\n    while (i > 0)\n    {\n        // ç›®å‰ 0 ä½ç½®å°±æ˜¯æœ€å¤§å€¼ï¼Œæ”¾åˆ°æœ€åï¼ˆå°±æ˜¯ i ä½ç½®ï¼‰ï¼Œç„¶åæœ€åçš„è¾¹ç•Œç¼©å° 1ï¼ˆ--iï¼‰ï¼Œè®© 0 åˆ°æ–°è¾¹ç•Œå¤§æ ¹åŒ–ï¼Œç”Ÿæˆä¸‹ä¸€ä¸ªæå€¼ã€‚\n        swap(&a[0], &a[i]);\n        --i;\n        sink(a, 0, i);\n    }\n}\n```\n# å†’æ³¡æ’åº\n\n```c\nvoid bubble_sort(int a[], int n)\n{\n    for(int i = 0; i < n - 1; ++i)\n    {\n        // æ¯å®Œæˆä¸€æ¬¡ å†…éƒ¨ for å¾ªç¯ï¼Œéƒ½ä¼šä¸º å·²æ’åºåºåˆ— ç¡®å®šä¸€ä¸ªæ•°ã€‚å› æ­¤ å·²æ’åºåºåˆ—çš„è¾¹ç•Œ æ›´æ–°ä¸º i\n        for(int j = n - 1; j > 0 + i; --j)\n        {\n            // æŠŠ å·¦è¾¹å¤§çš„æ•° äº¤æ¢åˆ°äº† å³è¾¹ï¼Œå› æ­¤æœ€åç”Ÿæˆäº† å‡åºåºåˆ—ï¼ˆä»å°åˆ°å¤§ï¼‰\n            if(a[j - 1] > a[j])\n            {\n                swap(&a[j - 1], &a[j]);\n            }\n        }\n    }\n}\n```\nç¬¬ä¸€å±‚forå¾ªç¯é€€å‡ºçš„æ¡ä»¶å¯ä»¥ç”±`i < n`ä¼˜åŒ–æˆ`i < n - 1`ã€‚å› ä¸ºå½“`i == n - 1`æ—¶ï¼Œæœ€åçš„æ•°ä¸€å®šæ˜¯æœ€å¤§çš„æ•°ã€‚\n\nä¼˜åŒ–ï¼šå¦‚æœç¬¬ä¸€æ¬¡forå¾ªç¯ï¼Œä»å°¾éƒ¨åˆ°å¤´éƒ¨ä¸€è·¯æ¯”è¾ƒä¸‹æ¥ï¼Œå‘ç°ï¼Œæ²¡æœ‰äº¤æ¢è¿‡ï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªå·²ç»æœ‰å‡åºçš„åºåˆ—ï¼Œç›´æ¥returnï¼Œä¸å†è¿›è¡Œå¾€åæ— è°“çš„æ’åºäº†ã€‚\næœ€å¥½æƒ…å†µï¼ˆå·²æ’åºæ•°ç»„ï¼‰åªéœ€ $O(n)$\n```c\nvoid bubble_sort(int a[], int n)\n{\n    for(int i = 0; i < n - 1; ++i)\n    {\n        int is_exchanged = 0;\n        for(int j = n - 1; j > 0 + i; --j)\n        {\n            if(a[j - 1] > a[j])\n            {\n                swap(&a[j - 1], &a[j]);\n                is_exchanged = 1;\n            }\n        }\n        if(!is_exchanged)\n            return;\n    }\n}\n```\n\n# å¿«é€Ÿæ’åº\n## åˆ’åˆ†åŸºå‡†\nåœ¨å¿«é€Ÿæ’åºä¸­ï¼Œæœ€é‡è¦çš„å³ä¸ºåˆ’åˆ†è¿‡ç¨‹ï¼Œæ¯ä¸ªæ•°çš„ä½ç½®å°†åœ¨æ¯ä¸€æ¬¡åˆ’åˆ†åç¡®å®šã€‚\n\né‚£ä¹ˆï¼ŒåŸºå‡†å€¼ï¼ˆpivotï¼‰å…¶å®å¯ä»¥ä»æœªå®šåºåˆ—ï¼ˆé™¤äº†ç¡®å®šä½ç½®çš„å…¶ä»–å€¼ï¼‰ä¸­éšæœºé€‰æ‹©ã€‚\n\nåœ¨ä¸åŒæ•™æä¸­ï¼Œè®²è§£çš„å¿«é€Ÿæ’åºå¾€å¾€æœ‰ä¸¤å¤§æ–¹æ¡ˆï¼Œä¸€æ˜¯æ¯æ¬¡é€‰æ‹©å·¦é¦–ä¸ºåŸºå‡†ï¼ŒäºŒæ˜¯æ¯æ¬¡é€‰æ‹©å³å°¾ä¸ºåŸºå‡†è¿›è¡Œåˆ’åˆ†ã€‚\n\nåœ¨ã€Šç®—æ³•å¯¼è®ºã€‹ä¸­ï¼Œé€‰æ‹©çš„æ˜¯å³å°¾ï¼›\nåœ¨ã€Šç®—æ³•ã€‹ï¼ˆæ™®æ—æ–¯é¡¿å¤§å­¦ï¼‰ä¸­é€‰æ‹©çš„æ˜¯å·¦é¦–ã€‚\nåœ¨Buboçš„è®²è§£ä¸­ï¼Œé€‰æ‹©çš„æ˜¯å³å°¾ï¼›\nåœ¨è€æ¨æ´¾ç³»çš„è®²è§£ä¸­ï¼Œé€‰æ‹©çš„æ˜¯å·¦é¦–ã€‚\nåœ¨ç½‘ç»œä¸Šï¼Œå¤§éƒ¨åˆ†é€‰æ‹©çš„æ˜¯å·¦é¦–ã€‚\n## åˆ’åˆ†æ–¹å‘ - å·¦å³å‘ + å•åŒå‘\né™¤äº†åŸºå‡†ä½ç½®çš„é€‰å–ä¸åŒã€‚è¿­ä»£æ–¹å‘ä¹Ÿæœ‰æ‰€ä¸åŒï¼šåˆ†ä¸ºå•å‘ï¼ˆå•è½´ï¼‰æ³•ï¼ˆéœ€è¦åˆ†å·¦å³ï¼‰ã€åŒè½´æ³•ç­‰ã€‚\n\nè¿™äº›å„å¼å„æ ·çš„æ–¹æ³•ï¼Œæ— æ‰€è°“å…¶ç»†èŠ‚ï¼Œå…¶å®è¾¾åˆ°çš„æ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„ï¼Œ\n\nå³æˆ‘ä»¬éœ€è¦å…³æ³¨å…¶æ ¸å¿ƒæœ¬è´¨ï¼Œä¸è¦å¿˜äº†å¿«é€Ÿæ’åºä¸­ï¼Œåˆ’åˆ†å‡½æ•°çš„åˆå¿ƒæ˜¯ä»€ä¹ˆã€‚\n\næ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³è±¡ï¼Œå¦‚æœæ¯æ¬¡é€‰æ‹©å·¦é¦–åˆ’åˆ†ï¼Œé‚£ä¹ˆå…¶å®ç»™å…ƒç´ çš„ä½ç½®äº¤æ¢å¤šäº†ä¸€äº›éº»çƒ¦ï¼Œå³å‡ºç°ä¸åŒçš„æƒ…å†µã€‚\n\nè€Œ**å¦‚æœé€‰æ‹©å³å°¾åˆ’åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œåˆ’åˆ†åŒºåŸŸçš„æ‰©å¼ è¿‡ç¨‹å¾ˆç®€æ´ï¼Œé‚£ä¹ˆå…ƒç´ çš„ä½ç½®äº¤æ¢ä¹Ÿä¸éœ€è¦å¤ªå¤šçš„åˆ†æƒ…å†µï¼Œæ‰€ä»¥æ€è·¯ç›¸å¯¹ç®€æ´**ã€‚\n\næ€»çš„æ¥è¯´ï¼Œåˆ’åˆ†çš„æ–¹å¼æœ‰ä¸‰å¤§è¦ç´ ï¼šå·¦é¦–ã€å³å°¾åˆ’åˆ†ï¼›å•å‘ã€åŒå‘åˆ’åˆ†ï¼›å·¦ã€å³åˆ’åˆ†ï¼ˆå¦‚æœæ˜¯åŒå‘åˆ’åˆ†åˆ™æ˜¯å…ˆå·¦åå³æˆ–å…ˆå³åå·¦ï¼‰\n\nå•å‘åˆ’åˆ†æ–¹æ³•åˆç§°ä¸ºï¼šLomuto åˆ†åŒºï¼ˆLomuto partition schemeï¼‰\nåŒå‘åˆ’åˆ†ï¼ˆå‘ä¸­é—´é€¼è¿‘ï¼‰åˆç§°ä¸ºï¼šHoare åˆ†åŒºï¼ˆHoare partition schemeï¼‰\nå•å‘ã€åŒå‘éƒ½æ˜¯æŠŠæ•°ç»„åˆ†æˆäº†ä¸¤ä¸ªåŒºåŸŸåŠ ä¸€ä¸ªåŸºå‡†å€¼ã€‚\nè¿˜æœ‰ä¸€ç§ä¸‰è·¯åˆ’åˆ†ï¼ˆDutch National Flag partitionï¼‰ï¼Œæ˜¯åˆ†æˆäº†ä¸‰ä¸ªåŒºåŸŸï¼Œå°äºçš„ã€ç­‰äºçš„ã€å¤§äºçš„ã€‚\nä¸‰è·¯åˆ’åˆ†å•ç‹¬å¤„ç†äº†æ•°ç»„ä¸­å’ŒåŸºå‡†å€¼é‡å¤è¿‡å¤šçš„æƒ…å†µã€‚\n\næ€»ä¹‹ï¼Œå¯åˆ†ä¸ºï¼š\n\n1. å·¦é¦–ã€å•å‘ã€å·¦åˆ’åˆ†ï¼›\n2. å·¦é¦–ã€å•å‘ã€å³åˆ’åˆ†ï¼›\n3. å·¦é¦–ã€åŒå‘ã€å…ˆå·¦åå³åˆ’åˆ†ï¼›\n4. å·¦é¦–ã€åŒå‘ã€å…ˆå³åå·¦åˆ’åˆ†ï¼›\n5. å³å°¾ã€å•å‘ã€å·¦åˆ’åˆ†ï¼›\n6. å³å°¾ã€å•å‘ã€å³åˆ’åˆ†ï¼›\n7. å³å°¾ã€åŒå‘ã€å…ˆå·¦åå³åˆ’åˆ†ï¼›\n8. å³å°¾ã€åŒå‘ã€å…ˆå³åå·¦åˆ’åˆ†ï¼›\n9. ä¸‰è·¯åˆ’åˆ†\n## 0ï¼šå·¦é¦–ã€ä¸‰è·¯åˆ’åˆ†\n```c\nvoid quick_sort_3way(int a[], int left, int right)\n{\n    if (left >= right) return;\n    int pivot = a[left];\n    int lt = left, i = left + 1, gt = right; // a[left..lt - 1] < p, a[lt ..gt] == p, a[gt+1..right] > p\n    while (i <= gt)\n    {\n        if (a[i] < pivot)\n        {\n            swap(&a[lt], &a[i]);\n            ++lt;\n            ++i;\n        }\n        else if (a[i] > pivot)\n        {\n            swap(&a[i], &a[gt]);\n            --gt;\n        }\n        else\n        {\n            ++i;\n        } // a[i] == pivot\n    }\n    quick_sort_3way(a, left, lt - 1);\n    quick_sort_3way(a, gt + 1, right);\n}\n\n```\n## 1ï¼šå·¦é¦–ã€å•å‘ã€å·¦åˆ’åˆ†ï¼ˆè€æ¨ï¼‰\n```c\nvoid quick_sort(int a[], int left, int right)\n{\n    if (left >= right) return;\n    int pivot = a[left];\n    int i = left;\n    int j = i + 1;\n    // j éå†å‘å³\n    while (j <= right)\n    {\n        if (a[j] <= pivot)\n        {\n            swap(&a[i + 1], &a[j]);\n            ++i;\n        }\n        ++j;\n    }\n    // i çš„ä½ç½®æ˜¯ å·¦ä¾§éƒ¨åˆ†çš„æœ«å°¾ã€‚\n    // left å±äº å·¦ä¾§éƒ¨åˆ†ã€‚ä¸åº”ä¸i+1äº¤æ¢ï¼Œè€Œæ˜¯ä¸iäº¤æ¢\n    swap(&a[i], &a[left]);\n    // i çš„ä½ç½®æ˜¯åŸºå‡†å€¼ï¼Œå·²å›ºå®šã€‚åªéœ€æ’é™¤äº†iä¹‹åå‰©ä¸‹çš„ã€‚\n    quick_sort(a, left, i - 1);\n    quick_sort(a, i + 1, right);\n}\n```\nä¼˜åŒ–ï¼š`if (a[j] <= pivot)`ä¸­æœ€å¥½æŠŠ`<=`æ”¹ä¸º`<`ã€‚\n1. ä¼˜åŒ–å‰ï¼Œå¦‚æœæ•°ç»„ä¸­ç­‰å€¼å¤ªå¤šï¼Œåˆ™ä¼šè¿›è¡Œå¤šæ¬¡æ— æ„ä¹‰çš„äº¤æ¢ã€‚\n    - è®¾æ•°ç»„å…¨æ˜¯ç›¸åŒå€¼ï¼Œé€‰å·¦ç«¯ä¸ºè½´ã€‚\n    - å¯¹æ¯ä¸ª jï¼Œ`a[j] <= pivot` éƒ½æˆç«‹ï¼Œäºæ˜¯ i æ¯æ¬¡è‡ªå¢ï¼Œå¾ªç¯ç»“æŸå `i == right`ï¼Œæœ€åå†æŠŠ pivot å’Œ `a[i]` äº¤æ¢â€”â€”**è½´è¢«æ”¾åˆ°æœ€å³ç«¯**ã€‚\n    - é€’å½’å˜æˆï¼š`[left, right-1]`ï¼ˆè§„æ¨¡ n-1ï¼‰å’Œç©ºåŒºé—´ã€‚äºæ˜¯é€’å½’å…³ç³» `T(n)=T(n-1)+O(n)`ï¼Œæ•´ä½“é€€åŒ–åˆ° **O(n^2)**ã€‚\n2. ä¼˜åŒ–åï¼Œç”¨ `<` ä¼šå¥½ä¸€ç‚¹ï¼ˆå°‘å¾ˆå¤šäº¤æ¢ï¼‰ï¼Œä½†åœ¨â€œå…¨ç­‰/å¤§é‡é‡å¤â€çš„æ•°æ®ä¸Šè¿˜æ˜¯ä¼šé€€åŒ–åˆ° $O(n^2)$ã€‚\n\n```c\nvoid quick_sort(int a[], int left, int right)\n{\n    if (left >= right) return;\n    int pivot = a[left];\n    int i = left;\n    int j = i + 1;\n    // j éå†å‘å³\n    while (j <= right)\n    {\n        if (a[j] < pivot)\n        {\n            swap(&a[i + 1], &a[j]);\n            ++i;\n        }\n        ++j;\n    }\n    // i çš„ä½ç½®æ˜¯ å·¦ä¾§éƒ¨åˆ†çš„æœ«å°¾ã€‚\n    // left å±äº å·¦ä¾§éƒ¨åˆ†ã€‚ä¸åº”ä¸i+1äº¤æ¢ï¼Œè€Œæ˜¯ä¸iäº¤æ¢\n    swap(&a[i], &a[left]);\n    // i çš„ä½ç½®æ˜¯åŸºå‡†å€¼ï¼Œå·²å›ºå®šã€‚åªéœ€æ’é™¤äº†iä¹‹åå‰©ä¸‹çš„ã€‚\n    quick_sort(a, left, i - 1);\n    quick_sort(a, i + 1, right);\n}\n```\n## 3ï¼šå·¦é¦–ã€åŒå‘ã€å…ˆå·¦åå³åˆ’åˆ†ï¼ˆã€Šç®—æ³•ã€‹ - æ™®æ—æ–¯é¡¿å¤§å­¦ï¼‰\nä»¥å·¦é¦–ä¸ºåŸºå‡†çš„åŒå‘åˆ’åˆ†ï¼Œä¸æ¨èå…ˆä»å·¦åˆ’åˆ†ï¼Œä»£ç å¯è¯»æ€§ä¸å¤ªå¥½ï¼Œè€Œä¸”æœ€åiã€jè¾¹ç•Œä¸èƒ½ä¹±ç”¨ã€‚\nä»¥å·¦é¦–ä¸ºåŸºå‡†çš„åŒå‘åˆ’åˆ†ï¼Œæ¨èå…ˆå³åå·¦åˆ’åˆ†ï¼ˆè€æ¨ç‰ˆæœ¬ï¼‰\n```c\n//æ­¤æ–¹æ³•æ˜¯å‰ç½®++ï¼Œiå’Œjçš„ä½ç½®æœ€åä¸ä¸€å®šé‡åˆï¼Œä¼šé”™å¼€1ä½ï¼\n//ç”±äºæ˜¯ä»¥å·¦é¦–åˆ’åˆ†ï¼Œé‚£ä¹ˆæœ€åæ›¿æ¢åˆ°å·¦é¦–çš„å€¼åˆ™åº”è¯¥æ˜¯ä¸€ä¸ªå°äºï¼ˆç­‰äºï¼‰å·¦é¦–çš„å€¼ã€‚\n//ä»¥ä¸Šä¸¤ä¸ªæ¡ä»¶å†³å®šäº†ï¼Œå¿…é¡»é€‰æ‹©a[j]ï¼ˆå³jåœä¸‹æ¥çš„ä½ç½®çš„å€¼ï¼‰ä¸å·¦é¦–äº¤æ¢ï¼Œåˆ™jå°±ä½œä¸ºç¡®å®šçš„åˆ’åˆ†ç•Œé™ã€‚\n\n//å¦å¤–ï¼Œå·¦å³åˆ’åˆ†çš„é¡ºåºæ— æ‰€è°“ï¼å…ˆå·¦å…ˆå³éƒ½å¯ä»¥ï¼\nvoid quick_sort(int a[], int left, int right)\n{\n    if (left >= right) return;\n    int i = left, j = right + 1;//ä¸ºäº†ä¾¿äºä¸‹é¢++iå’Œ--jçš„ä»£ç ç»Ÿä¸€æ€§ï¼Œæ‰€ä»¥ä»leftåˆ°right+1ï¼Œå®é™…ä¸Šåªè€ƒå¯Ÿåˆ°äº†left+1åˆ°rightçš„éƒ¨åˆ†\n    int pivot = a[left];\n    while(1)\n    {\n        while(a[++i] <= pivot)\n            if(i == right) break;\n        while(a[--j] > pivot)\n            if(j == left) break;\n        if(i >= j) break;\n        swap(&a[i], &a[j]);\n    }\n    swap(&a[left], &a[j]);// a[left]ä¸ºå·¦é¦–å…ƒç´ ï¼Œå³åŸºå‡†å€¼\n    quick_sort(a, left, j - 1);\n    quick_sort(a, j + 1, right);\n}\n```\nå¯è¯»æ€§æ›´å¥½çš„è‡ªç”¨ç‰ˆï¼š\n```c\nvoid quick_sort(int a[], int left, int right)\n{\n    if (left >= right) return;\n\n    int pivot = a[left];\n    int i = left + 1, j = right;\n\n    while (1)\n    {\n        while (i <= j && a[i] <= pivot) ++i; // åœåœ¨ > pivot\n        while (i <= j && a[j] >  pivot) --j; // åœåœ¨ <= pivot\n        if (i > j) break;\n        swap(&a[i], &a[j]);\n        ++i; --j;\n    }\n    // è½´ä¸ j äº¤æ¢ï¼Œä¿è¯ [left..j-1] <= pivotï¼Œpivot åœ¨ j\n    swap(&a[left], &a[j]);\n\n    quick_sort(a, left, j - 1);\n    quick_sort(a, j + 1, right);\n}\n```\næŒ‡é’ˆäº¤é”™ï¼ˆæˆ–ç›¸é‡ï¼‰ååº”æŠŠ **pivot ä¸ `a[j]` äº¤æ¢**ï¼Œè€Œä¸æ˜¯å’Œ `a[i]`ã€‚ç”¨ `i` ä¼šå‡ºé”™ï¼ˆå¦‚ `[1,3,2]` ä¼šå˜æˆ `[3,1,2]`ï¼‰ã€‚\n\n## 4ï¼šå·¦é¦–ã€åŒå‘ã€å…ˆå³åå·¦åˆ’åˆ†ï¼ˆä»¿ç…§Buboçš„â€œå³å°¾ã€åŒå‘ã€å…ˆå·¦åå³åˆ’åˆ†â€æ–¹æ³•å†™çš„ï¼Œè§7ï¼‰\n\n```c\nvoid quick_sort(int a[], int left, int right)\n{\n    if (left >= right) return;\n    int l = left + 1, pivot = left, r = right;\n    while (l < r)\n    {\n        if (a[r] > a[pivot])\n            --r;\n        else if (a[l] <= a[pivot]) \n            ++l;\n        else\n            swap(&a[l], &a[r]);\n    }\n    if (a[r] > a[pivot])\n    {\n        swap(&a[r - 1], &a[pivot]);\n        pivot = r - 1;\n    }\n    else\n    {\n        swap(&a[r], &a[pivot]);\n        pivot = r;\n    }\n    quick_sort(a, left, pivot - 1);\n    quick_sort(a, pivot + 1, right);\n}\n```\n\nä¸Šé¢çš„ä»£ç æ˜¯åˆç‰ˆï¼Œæœ€åçš„`if-else`æƒ³å¤æ‚äº†ï¼Œä»¥ä¸‹æ˜¯ä¼˜åŒ–ï¼š\n\n```c\nvoid quick_sort(int a[], int left, int right)\n{\n    if (left >= right) return;\n    int l = left + 1, pivot = left, r = right;\n    while (l < r)\n    {\n        if (a[r] > a[pivot])\n            --r;\n        else if (a[l] <= a[pivot])\n            ++l;\n        else\n            swap(&a[l], &a[r]);\n    }\n    if (a[l] < a[pivot])\n    {\n        swap(&a[l], &a[pivot]);\n        pivot = l;\n    }\n    quick_sort(a, left, pivot - 1);\n    quick_sort(a, pivot + 1, right);\n}\n```\n### â­è€æ¨ç‰ˆï¼ˆæŒ–å‘æ³•ï¼‰\næŒ–å‘æ³•ï¼ˆåˆå«â€œå¡«å‘æ³•â€ï¼‰æ˜¯å¿«é€Ÿæ’åºçš„ä¸€ç§åŸåœ°åˆ†åŒºå†™æ³•ï¼šå…ˆæŠŠè½´å€¼ï¼ˆpivotï¼‰æš‚å­˜å‡ºæ¥ï¼ŒæŠŠå®ƒåŸæ¥çš„ä½ç½®å½“æˆâ€œå‘â€ï¼Œç„¶åä»æ•°ç»„ä¸¤ç«¯å‘ä¸­é—´æ‰«ï¼Œ**ç”¨é‡åˆ°çš„å…ƒç´ å»â€œå¡«â€å½“å‰çš„å‘**ï¼›è¢«æ¬èµ°çš„ä½ç½®åˆå½¢æˆæ–°çš„å‘ï¼Œäº¤æ›¿è¿›è¡Œï¼Œç›´åˆ°å·¦å³æŒ‡é’ˆç›¸é‡ï¼Œæœ€åæŠŠè½´å€¼æ”¾å›è¿™ä¸ªæœ€ç»ˆçš„å‘ã€‚\n```c\nvoid quick_sort(int a[], int left, int right)\n{\n    if (left >= right) return;\n    int pivot = a[left];\n    int i = left;\n    int j = right;\n    while (i < j)\n    {\n        while (i < j && a[j] > pivot)\n        {\n            --j;\n        }\n        if (i < j) // a[right] <= pivot\n        {\n            a[i] = a[j];\n        }\n        while (i < j && a[i] <= pivot)\n        {\n            ++i;\n        }\n        if (i < j) // a[left] >= pivot\n        {\n            a[j] = a[i];\n        }\n    }\n    a[i] = pivot;\n    quick_sort(a, left, i - 1);\n    quick_sort(a, i + 1, right);\n}\n```\n\n## â­5ï¼šå³å°¾ã€å•å‘ã€å·¦åˆ’åˆ†ï¼ˆåŒ—èˆªç®—æ³•ï¼‰\n`left`åˆ°`i`çš„åŒºåŸŸä¸º**å°äºç­‰äº**åŸºå‡†å€¼çš„åŒºåŸŸã€‚\n\nåœ¨åˆ’åˆ†ç»“æŸå‰ï¼Œ`i + 1`åˆ°`right`çš„åŒºåŸŸï¼Œå‡ä¸º**å¤§äº**åŸºå‡†å€¼çš„åŒºåŸŸã€‚\n\nåˆ’åˆ†ç»“æŸåï¼Œ`i + 1`ä¸ºåŸºå‡†å€¼æœ€åè½åˆ°çš„ä½ç½®ã€‚ï¼ˆéœ€è¦å•ç‹¬è¿›è¡Œ`a[i+1]`å’Œ`a[right]`çš„äº¤æ¢ï¼‰\n\n`left`å’Œ`right`å‡ä¸ºæ•°ç»„ä¸‹æ ‡ã€‚\n```c\nvoid quick_sort(int a[], int left, int right)\n{\n    if(left >= right) return;\n    int i = left - 1, j = left;\n    int pivot = a[right];\n    while(j < right)\n    {\n        if(a[j] > pivot)\n        {\n            ++j;\n        }\n        else\n        {\n            swap(&a[i + 1], &a[j]);\n            ++i;\n            ++j; // ä¸ç®¡ifæ˜¯å¦æˆç«‹ï¼Œéƒ½++j\n        }\n    }\n    // i çš„ä½ç½®æ˜¯ å·¦ä¾§éƒ¨åˆ†çš„æœ«å°¾ã€‚\n    // right å±äº å³ä¾§éƒ¨åˆ†ã€‚ä¸åº”ä¸iäº¤æ¢ï¼Œè€Œæ˜¯ä¸i+1äº¤æ¢\n    swap(&a[i + 1], &a[right]);\n    quick_sort(a, left, i);\n    quick_sort(a, i + 2, right);\n}\n```\n\n`if-else`ä¼˜åŒ–ï¼š\n\n```c\nvoid quick_sort(int a[], int left, int right)\n{\n    if(left >= right) return;\n    int i = left - 1, j = left;\n    int pivot = a[right];\n    while(j < right)\n    {\n        if(a[j] <= pivot)\n        {\n            swap(&a[i + 1], &a[j]);\n            ++i;\n        }\n        ++j;  // ä¸ç®¡ifæ˜¯å¦æˆç«‹ï¼Œéƒ½++j\n    }\n    // i çš„ä½ç½®æ˜¯ å·¦ä¾§éƒ¨åˆ†çš„æœ«å°¾ã€‚\n    // right å±äº å³ä¾§éƒ¨åˆ†ã€‚ä¸åº”ä¸iäº¤æ¢ï¼Œè€Œæ˜¯ä¸i+1äº¤æ¢\n    swap(&a[i + 1], &a[right]);\n    quick_sort(a, left, i);\n    quick_sort(a, i + 2, right);\n}\n```\n### `i`çš„åˆå§‹å€¼åº”ä¸º`left - 1`\nä»¥ä¸Šç¨‹åºï¼Œ`i`çš„åˆå§‹å€¼ä¸åº”æ˜¯`left`ï¼Œè€Œæ˜¯`left - 1`ï¼š\n\næ€ä¹ˆè®°ä½å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœåˆ’åˆ†ä¸¤ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆ`right = 1`ï¼Œ`left = 0`ã€‚å¦‚æœ`i`ä¸€å¼€å§‹å’Œ`j`éƒ½ç­‰äº`left`ï¼Œé‚£ä¹ˆå¦‚æœ`a[j] <= pivot`ï¼Œåˆ™`a[i + 1]`å’Œ`a[j]`äº¤æ¢ï¼Œè¿™æ—¶`i + 1`æ˜¯`right`ï¼Œé€ æˆå°æ•°åœ¨å³ï¼Œæ‰€ä»¥é”™è¯¯ã€‚\n\nå®é™…ä¸Šï¼Œ`i`ã€`j`æŒ‡ç¤ºå™¨åˆ†åˆ«ä»£è¡¨å·¦ã€å³éƒ¨åˆ†çš„æœ«ç«¯ã€‚\n\nä¸¤ä¸ªæç«¯çš„æƒ…å†µå°±æ˜¯ï¼šå¦‚æœ`i`è¶…å‡ºæ•°ç»„å·¦è¾¹ç•Œï¼ˆå€¼ä¸º`-1`ï¼‰åˆ™è¯´æ˜å·¦éƒ¨åˆ†ä¸ºç©ºï¼Œå³æ²¡æœ‰æ¯”åŸºå‡†å€¼å°äºï¼ˆç­‰äºï¼‰çš„å€¼ï¼›\nå¦‚æœ`j`è¶…å‡ºå¾…æ’æ•°ç»„å³è¾¹ç•Œï¼ˆå½“ä»¥å³å°¾åˆ’åˆ†æ—¶ï¼Œ`j`è¶…å‡ºè¾¹ç•Œæ—¶å€¼ä¸º`right`ï¼‰åˆ™è¯´æ˜å³éƒ¨åˆ†ä¸ºç©ºï¼Œå³æ²¡æœ‰æ¯”åŸºå‡†å€¼å¤§çš„å€¼ã€‚\n\néå†æ•°ç»„è¿‡ç¨‹ä¸­ï¼Œä¸»è¦ä¾æ‰˜`j`çš„è¡Œè¿›ï¼Œå¦‚æœé‡åˆ°çš„å€¼æ¯”åŸºå‡†å€¼å¤§ï¼Œåˆ™`j`å•ç‹¬è¿›æ­¥ï¼›å¦‚æœé‡åˆ°å€¼æ¯”åŸºå‡†å€¼å°ï¼ˆç­‰ï¼‰ï¼Œåˆ™éœ€è¦ä¸`å³éƒ¨åˆ†`çš„é¦–ä½ç½®æ›¿æ¢ï¼Œå¦‚æ­¤ï¼Œé‡åˆ°çš„å°çš„å€¼å»äº†`å·¦éƒ¨åˆ†`ï¼ŒåŸå…ˆé¦–ä½ç½®çš„å€¼æ¢åˆ°äº†`å³éƒ¨åˆ†`çš„æœ€æœ«ç«¯ã€‚æœ€åï¼Œ`i`å’Œ`j`åŒæ—¶è¿›ä¸€æ­¥ã€‚\n\n## 7ï¼šå³å°¾ã€åŒå‘ã€å…ˆå·¦åå³åˆ’åˆ†ï¼šï¼ˆBuboï¼‰\n\n```c\n//è¿™ä¸ªç‰ˆæœ¬ä¸‹ï¼Œleftå’Œrightå¿…å®šç›¸ç­‰\n//ä½†æ˜¯ï¼Œå­˜åœ¨ä¸€ç§æƒ…å†µï¼Œå³åªæœ‰ä¸¤ä¸ªå…ƒç´ è¿›è¡Œåˆ’åˆ†ï¼Œå¦‚2ã€3ï¼›\n//é‚£ä¹ˆæ­¤æ—¶leftå’Œrightä¸€ä¸Šæ¥å°±ç›¸ç­‰ï¼Œéƒ½æŒ‡å‘2\n//å¦‚æœæˆ‘ä»¬ä¸å»åša[l]å’Œa[pivot]çš„å¤§å°å¯¹æ¯”ï¼Œé‚£ä¹ˆæœ€åå°±ä¼šåˆ’åˆ†ä¸º3ã€2ï¼ˆ3ä¸ºåŸºå‡†ï¼‰ï¼Œæ­¤æ—¶å‘ç°ï¼Œ2æ¯”3å°ï¼Œå´é”™è¯¯çš„æ’åˆ°åé¢äº†ã€‚\n//æ‰€ä»¥ï¼Œå¿…é¡»åœ¨åé¢åŠ ä¸Ša[l]å’Œå³å°¾å€¼çš„å¤§å°å¯¹æ¯”ï¼æ‰èƒ½è¿›è¡Œæ›¿æ¢\n\n//å¦å¤–ï¼Œæ­¤æ–¹æ³•ä¸èƒ½äº¤æ¢åˆ’åˆ†é¡ºåºï¼å³å¿…é¡»å…ˆå·¦åˆ’åˆ†ï¼Œåå³åˆ’åˆ†ï¼Œå¦åˆ™é”™è¯¯ï¼\nvoid quick_sort(int a[], int left, int right)\n{\n    if (left >= right) return;\n    //æ­¤æ—¶è‹¥åªæœ‰ä¸¤ä¸ªå…ƒç´ ï¼Œåˆ™å‡ºç°l == r\n    int l = left, pivot = right, r = right - 1;\n    while (l < r)\n    {\n        if (a[l] <= a[pivot])\n            ++l;\n        else if (a[r] > a[pivot])\n            --r;\n        else\n            swap(&a[l], &a[r]);\n    }\n    if (a[l] > a[pivot])\n    {\n        swap(&a[l], &a[pivot]);\n        pivot = l;\n    }\n    quick_sort(a, left, pivot - 1);\n    quick_sort(a, pivot + 1, right);\n}\n```\n\n## 8ï¼šå³å°¾ã€åŒå‘ã€å…ˆå³åå·¦åˆ’åˆ†ï¼›ï¼ˆä»¿ç…§â€œå·¦é¦–ã€åŒå‘å…ˆå·¦åå³åˆ’åˆ†â€ã€Šç®—æ³•ã€‹å†™çš„ï¼‰\n\n```c\nvoid quick_sort(int a[], int left, int right)\n{\n    if (left >= right) return;\n    int i = left - 1, j = right;//ä¸ºäº†ä¾¿äºä¸‹é¢++iå’Œ--jçš„ä»£ç ç»Ÿä¸€æ€§ï¼Œæ‰€ä»¥ä»left-1åˆ°rightï¼Œå®é™…ä¸Šåªè€ƒå¯Ÿåˆ°äº†leftåˆ°right-1çš„éƒ¨åˆ†\n    int pivot = a[right];\n    while (1)\n    {\n        while (a[--j] > pivot)\n            if (j == left) break;\n        while (a[++i] <= pivot)\n            if (i == right) break;\n        if (i >= j) break;\n        swap(&a[i], &a[j]);\n    }\n    swap(&a[right], &a[i]);// a[right]ä¸ºå³å°¾å…ƒç´ ï¼Œå³åŸºå‡†å€¼ //å¿…é¡»å’Œa[i]äº¤æ¢ï¼Œå¦åˆ™ä¸å¯¹\n    quick_sort(a, left, i - 1); // å¿…é¡»æ˜¯i - 1ï¼Œå¦åˆ™ä¸å¯¹\n    quick_sort(a, i + 1, right);// å¿…é¡»æ˜¯i + 1ï¼Œå¦åˆ™ä¸å¯¹\n}\n```\n\nå…¶å®æˆ‘ä»¬å‘ç°ï¼Œå…ˆå·¦åå³åˆ’åˆ†ä¹Ÿæ­£ç¡®ï¼Œä½†æ˜¯åä¸‰å¥ä¸­çš„åŸºå‡†ä½ç½®æ˜¯`i`ï¼Œä¸èƒ½æ˜¯`j`\n\n```c\nvoid quick_sort(int a[], int left, int right)\n{\n    if (left >= right) return;\n    int i = left - 1, j = right;//ä¸ºäº†ä¾¿äºä¸‹é¢++iå’Œ--jçš„ä»£ç ç»Ÿä¸€æ€§ï¼Œæ‰€ä»¥ä»left-1åˆ°rightï¼Œå®é™…ä¸Šåªè€ƒå¯Ÿåˆ°äº†leftåˆ°right-1çš„éƒ¨åˆ†\n    int pivot = a[right];\n    while (1)\n    {\n        while (a[++i] <= pivot)\n            if (i == right) break;\n        while (a[--j] > pivot)\n            if (j == left) break;\n        if (i >= j) break;\n        swap(&a[i], &a[j]);\n    }\n    swap(&a[right], &a[i]);// a[right]ä¸ºå³å°¾å…ƒç´ ï¼Œå³åŸºå‡†å€¼ //å¿…é¡»å’Œa[i]äº¤æ¢ï¼Œå¦åˆ™ä¸å¯¹\n    quick_sort(a, left, i - 1); // å¿…é¡»æ˜¯i - 1ï¼Œå¦åˆ™ä¸å¯¹\n    quick_sort(a, i + 1, right);// å¿…é¡»æ˜¯i + 1ï¼Œå¦åˆ™ä¸å¯¹\n}\n```\n\n## æ€»ç»“\n\n```\nè‹¥ç”¨å‰ç½®++ï¼Œiå’Œjçš„ä½ç½®æœ€åä¸ä¸€å®šé‡åˆï¼Œå¯èƒ½ä¼šé”™å¼€1ä½ï¼\nç”±äºæ˜¯ä»¥å·¦é¦–åˆ’åˆ†ï¼Œé‚£ä¹ˆæœ€åæ›¿æ¢åˆ°å·¦é¦–çš„å€¼åˆ™åº”è¯¥æ˜¯ä¸€ä¸ªå°äºï¼ˆç­‰äºï¼‰å·¦é¦–çš„å€¼ã€‚\nä»¥ä¸Šä¸¤ä¸ªæ¡ä»¶å†³å®šäº†ï¼Œå¿…é¡»é€‰æ‹©a[j]ï¼ˆå³jåœä¸‹æ¥çš„ä½ç½®çš„å€¼ï¼‰ä¸å·¦é¦–äº¤æ¢ï¼Œåˆ™jå°±ä½œä¸ºç¡®å®šçš„åˆ’åˆ†ç•Œé™ã€‚\nç›¸åï¼Œå¦‚æœä»¥å³å°¾åˆ’åˆ†ï¼Œé‚£ä¹ˆæ›¿æ¢åˆ°å³å°¾çš„å€¼åˆ™åº”è¯¥æ˜¯ä¸€ä¸ªå¤§äºï¼ˆç­‰äºï¼‰å³å°¾çš„å€¼ã€‚åˆ™å¿…é¡»é€‰æ‹©a[i]ä¸å³å°¾äº¤æ¢ï¼Œåˆ™iå°±ä½œä¸ºç¡®å®šçš„åˆ’åˆ†ç•Œé™ã€‚\n```\n\nç»¼ä¸Šæ‰€è¿°ï¼Œå¿«æ’åˆ’åˆ†å‡½æ•°çš„ç»†èŠ‚éœ€è¦æ³¨æ„ï¼š\n\n1. å¦‚æœä½ é€‰æ‹©çš„æ˜¯åŒå‘åˆ’åˆ†â€”â€”æœ€ç»ˆçš„`i`ã€`j`æŒ‡é’ˆæ˜¯ä¸€å®šé‡åˆå—ï¼Ÿæœ‰å¯èƒ½é”™å¼€1ä½å—ï¼Ÿ\n    1. å¦‚æœé”™å¼€1ä½ï¼Œåˆ™å…ˆå·¦å…ˆå³æ— æ‰€è°“ï¼\n    2. å¦‚æœä¸€å®šé‡åˆï¼Œåˆ™å¿…é¡»æœ‰ä¸ªå…ˆå·¦æˆ–å…ˆå³çš„é¡ºåºï¼**ï¼ˆä¸ºä»€ä¹ˆå‘¢ï¼Ÿï¼‰**\n2. ä½ é€‰æ‹©ä»¥å·¦é¦–æˆ–å³å°¾åˆ’åˆ†ï¼Œå†³å®šäº†ä½ æœ€åæ›¿æ¢å·¦é¦–ï¼ˆå³å°¾ï¼‰çš„æ¡ä»¶å’Œå…·ä½“ä½ç½®ï¼è¿™ä¸ªå’Œ`i`ã€`j`é”™ä¸é”™å¼€æ²¡å…³ç³»ï¼å¦‚æœé€‰æ‹©å·¦é¦–åˆ’åˆ†ï¼Œåˆ™éœ€è¦æ‹¿æ¯”å·¦é¦–å°çš„å€¼ä¸ä¹‹æ›¿æ¢ï¼›å¦‚æœé€‰æ‹©å³å°¾åˆ’åˆ†ï¼Œåˆ™éœ€è¦æ‹¿æ¯”å³å°¾å¤§çš„å€¼ä¸ä¹‹æ›¿æ¢ï¼›\n    1. å¦‚æœä½ çš„æ–¹æ³•æœ‰å¯èƒ½ä½¿`i`ã€`j`é”™å¼€ï¼Œé‚£ä¹ˆ`i`åœä¸‹çš„ä½ç½®ä¸€å®šæ˜¯æ¯”åŸºå‡†å€¼å¤§äºï¼ˆç­‰äºï¼‰çš„ï¼›`j`åœä¸‹çš„ä½ç½®ä¸€å®šæ˜¯æ¯”åŸºå‡†å€¼å°äºï¼ˆç­‰äºï¼‰çš„\n    2. å¦‚æœä½ çš„æ–¹æ³•ä½¿`i`ã€`j`æœ€åä¸€å®šé‡åˆï¼Œé‚£ä¹ˆç”±äºä¸¤ä¸ªå…ƒç´ æ—¶`i`ã€`j`ä¹Ÿæ°å·§é‡åˆï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥æ›¿æ¢å·¦é¦–ï¼ˆå³å°¾ï¼‰ï¼Œéœ€è¦æ¯”è¾ƒ`i`ï¼ˆæˆ–`j`ï¼Œä»–ä¿©ä¸€æ ·ï¼Œæ— æ‰€è°“ï¼‰ï¼Œå¦‚æœä½ é€‰æ‹©å·¦é¦–åˆ’åˆ†ï¼Œåˆ™åˆ¤æ–­å·¦é¦–æ˜¯å¦æ¯”`i`ï¼ˆæˆ–`j`ï¼‰ä½ç½®çš„å€¼å°ï¼ˆç­‰ï¼‰ï¼›å¦‚æœä½ é€‰æ‹©å³å°¾åˆ’åˆ†ï¼Œåˆ™åˆ¤æ–­å³å°¾æ˜¯å¦æ¯”`i`ï¼ˆæˆ–`j`ï¼‰ä½ç½®çš„å€¼å¤§ï¼ˆç­‰ï¼‰â€”â€”è‹¥ä¸æ˜¯ï¼Œåˆ™äº¤æ¢å€¼ï¼Œæ›´æ–°åŸºå‡†ä¸‹æ ‡ï¼ˆpivotï¼‰ï¼›\n## éé€’å½’å½¢å¼\n```cpp\nint Partition(int * ar, int left, int right)\n{\n    int i = left;\n    int j = right;\n    int pivot = ar[left];\n    while (i < j)\n    {\n        while (i < j && ar[j] > pivot)\n        {\n            --j;\n        }\n        if (i < j) // ar[j] <= pivot\n        {\n            ar[i] = ar[j];\n        }\n        while (i < j && ar[i] <= pivot)\n        {\n            ++i;\n        }\n        if (i < j)\n        {\n            ar[j] = ar[i];\n        }\n    }\n    ar[i] = pivot;\n    return i;\n}\nvoid QuickSort(int * ar, int n)\n{\n    std::queue<int> qu;\n    qu.push(0);\n    qu.push(n - 1);\n    while (!qu.empty())\n    {\n        int left = qu.front(); qu.pop();\n        int right = qu.front(); qu.pop();\n        int mid = Partition(ar, left, right);\n        if (left < mid - 1)\n        {\n            qu.push(left);\n            qu.push(mid - 1);\n        }\n        if (mid + 1 < right)\n        {\n            qu.push(mid + 1);\n            qu.push(right);\n        }\n    }\n}\n```\n## ä¼˜åŒ–ï¼šéšæœºåŸºå‡†æˆ–ä¸‰ä½å–ä¸­\n\n## ä¼˜åŒ–ï¼šå°¾é€’å½’æ¶ˆé™¤\n```c\n// partition è¿”å›è½´æœ€ç»ˆä¸‹æ ‡ pï¼›ä¸¤ä¾§ä¸º [left, p-1] ä¸ [p+1, right]\nvoid quick_sort(int a[], int left, int right)\n{\n    while (left < right)\n    {\n        int p = partition(a, left, right);  // ä»»é€‰ Lomuto/æŒ–å‘ï¼Œä¿è¯è¿”å›è½´ä½ p\n        // é€’å½’è¾ƒå°ä¸€ä¾§ï¼Œè¾ƒå¤§ä¸€ä¾§ç”¨å¾ªç¯â€œç¼©åŒºé—´â€\n        if (p - left < right - p)\n        {\n            quick_sort(a, left, p - 1);  // å°çš„é‚£åŠé€’å½’\n            left = p + 1;                // å¤§çš„é‚£åŠè½¬ä¸ºå°¾éƒ¨è¿­ä»£\n        }\n        else\n        {\n            quick_sort(a, p + 1, right);\n            right = p - 1;\n        }\n    }\n}\n```\n## æœ€ç»ˆä»£ç \n```c\n#define INSERTION_SORT_THRESHOLD 16\n\n// ä¸‰æ•°å–ä¸­ï¼šæŠŠ a[left], a[mid], a[right] æ’æˆ a[left] <= a[mid] <= a[right]ï¼Œç„¶åæŠŠä¸­ä½æ•°æ”¾åˆ° left å½“è½´\nstatic inline void median_of_three_to_left(int a[], int left, int right)\n{\n    int mid = left + ((right - left) >> 1);\n    if (a[mid]   < a[left])  swap_int(&a[mid]  , &a[left]);\n    if (a[right] < a[left])  swap_int(&a[right], &a[left]);\n    if (a[right] < a[mid])   swap_int(&a[right], &a[mid]);\n    // æ­¤æ—¶ a[left] <= a[mid] <= a[right]ï¼Œå–ä¸­ä½æ•°ä½œä¸ºè½´ï¼šäº¤æ¢åˆ° left\n    swap_int(&a[left], &a[mid]);\n}\n// å¿«é€Ÿæ’åºï¼ˆæŒ–å‘æ³• + å°¾é€’å½’æ¶ˆé™¤ + å°åŒºé—´æ’æ’ + ä¸‰æ•°å–ä¸­é€‰è½´ï¼‰\nvoid quick_sort(int a[], int left, int right)\n{\n    while (left < right)\n    {\n        // å°åŒºé—´ç”¨æ’å…¥æ’åºæ›´å¿«\n        if (right - left + 1 <= INSERTION_SORT_THRESHOLD)\n        {\n            insertion_sort(a, left, right);\n            return;  // å½“å‰åŒºé—´å®Œæˆï¼Œç›´æ¥è¿”å›ï¼ˆå¤–å±‚ while é€€å‡ºï¼‰\n        }\n\n        // é€‰è½´ä¼˜åŒ–ï¼šä¸‰æ•°å–ä¸­ï¼Œå¹¶å°†ä¸­ä½æ•°æ”¾åˆ° left\n        median_of_three_to_left(a, left, right);\n\n        // åˆ†åŒº\n        int p = partition_pit(a, left, right);\n\n        // å°¾é€’å½’æ¶ˆé™¤ï¼šæ€»æ˜¯é€’å½’è¾ƒå°çš„ä¸€ä¾§ï¼Œè¾ƒå¤§çš„ä¸€ä¾§æ”¹ä¸ºè¿­ä»£\n        if (p - left < right - p)\n        {\n            quick_sort(a, left, p - 1);  // é€’å½’è¾ƒå°æ®µ\n            left = p + 1;                // å¤§æ®µè½¬ä¸ºä¸‹ä¸€è½®å¾ªç¯\n        }\n        else\n        {\n            quick_sort(a, p + 1, right);\n            right = p - 1;\n        }\n    }\n}\n```\n# å½’å¹¶æ’åº\n\nå½’å¹¶æ’åºæ¶‰åŠåˆ°åˆ†æ²»ï¼ˆDivide & Conquerï¼‰ç­–ç•¥çš„æ€æƒ³ã€‚åˆ†æ²»ç­–ç•¥æœ‰å¾ˆå¤šä¾‹å­ï¼Œæ¯”å¦‚MapReduceç”¨äºå¤§è§„æ¨¡æ•°æ®é›†ï¼ˆå¤§äº1TBï¼‰çš„å¹¶è¡Œè¿ç®—ã€‚æ¶‰åŠ\"Mapï¼ˆæ˜ å°„ï¼‰\"å’Œ\"Reduceï¼ˆå½’çº¦ï¼‰\"ã€‚\n\néœ€è¦æ³¨æ„ï¼Œminå’Œmaxæ˜¯ç»å¯¹ä¸‹æ ‡ï¼Œå³è¦æ’åºçš„æ•´ä¸ªæ•°ç»„çš„ä¸‹æ ‡ã€‚\n\n```c\nvoid divide_conquer(int a[], int min, int max, int b[])\n{\n    if(min >= max) return;              //ç»ˆæ­¢æ¡ä»¶\n    int mid = (max - min) / 2 + min;    //æ‰¾åˆ°ä¸­é—´ä½ç½®(å¥‡æ•°æ—¶å·¦è¾¹å¤š1ä¸ª)\n    divide_conquer(a, min, mid, b);     //å¤„ç†å®Œä¹‹åï¼Œæ­¤æ¬¡é€’å½’æ—¶çš„min~maxçš„å·¦åŠä¾§å·²ç»æœ‰åº\n    divide_conquer(a, mid + 1, max, b); //å¤„ç†å®Œä¹‹åï¼Œæ­¤æ¬¡é€’å½’æ—¶çš„min~maxçš„æœ‰åŠä¾§å·²ç»æœ‰åº\n    conquer(a, min, max, b);            //conquerå³åˆå¹¶ä¸¤è¾¹æ•°ç»„çš„å‰ææ˜¯å·¦å³åŒè¾¹å‡å·²æœ‰åº\n}\n```\n\nconquerå³åˆå¹¶ä¸¤è¾¹æ•°ç»„çš„å‰ææ˜¯å·¦å³åŒè¾¹å‡å·²æœ‰åºã€‚\n\n```c\nvoid conquer(int a[], int min, int max, int b[])\n{\n    int mid = (max - min) / 2 + min;\n    int i = min;      //å·¦åŠè¾¹\n    int j = mid + 1;  //å³åŠè¾¹\n    int k = min;      //åˆå¹¶çš„æ–°ç©ºé—´çš„ä¸‹æ ‡\n    while(k <= max)\n    {\n        if(i <= mid && j <= max)//iå’Œjéƒ½æ²¡åˆ°ç»“å°¾ï¼Œåˆ™éœ€è¦ä¸€ä¸€æ¯”å¯¹å¤§å°\n        {\n            if(a[i] < a[j])\n            {\n                b[k] = a[i++];\n            }\n            else b[k] = a[j++];\n        }\n        else if(i > mid)        //å·¦åŠä¾§å·²ç»“æŸï¼Œåˆ™å³åŠä¾§(j)å‰©ä¸‹çš„å¯ç›´æ¥å…¨éƒ¨æ”¾å…¥b\n        {\n            b[k] = a[j++];\n        }\n        else b[k] = a[i++];     //å³åŠä¾§å·²ç»“æŸï¼Œå³åŠä¾§(i)å‰©ä¸‹çš„å¯ç›´æ¥å…¨éƒ¨æ”¾å…¥b\n        ++k;\n    }\n    // åˆ«å¿˜äº†bæ•°ç»„ä¸­å¤„ç†å®Œæˆä¹‹åè¿˜è¦å¤åˆ¶ä¸€ä»½ç»™aæ•°ç»„\n    for(int k = min; k <= max; ++k)\n    {\n        a[k] = b[k];\n    }\n}\n```\n\n```c\nvoid merging_sort(int a[], int n)\n{\n    int * b = (int *)malloc(n * sizeof(a[0]));\n    divide_conquer(a, 0, n - 1, b);\n    // æ— é¡»å†æŠŠbæ•°ç»„å¤åˆ¶ç»™aæ•°ç»„ï¼Œå› ä¸ºå†conquerè¿‡ç¨‹ä¸­bæ•°ç»„å·²ç»å¤åˆ¶ç»™äº†aæ•°ç»„\n    free(b);\n}\n```\n\n# åŸºæ•°æ’åº\n\nç”¨çš„å°‘ï¼Œè€ƒçš„å°‘ï¼ŒåŸºæœ¬ä¸Šå·²ç»é€€å‡ºå†å²èˆå°ï¼Œæš‚ä¸è®¨è®ºã€‚\n# éšæœºæ•°-æµ‹è¯•ç”¨\n\n```c\n#include<stdio.h>\n#include<time.h>\n#define SIZE 13\nvoid show(int * arr, int len)\n{\n    for(int i = 0; i < len; ++i)\n    {\n        printf(\"%i  \", arr[i]);\n    }\n    printf(\"\\n\");\n}\nbool isSort(int * arr, int len)\n{\n    for(int i = 0; i < len - 1; ++i)\n    {\n        if(arr[i] > arr[i + 1])\n            return false;\n    }\n    return true;\n}\nint main()\n{\n    int arr[SIZE] = { 0 };\n    // è®¾ç½®ä¸€ä¸ªéšå³å› å­\n    srand((unsigned)(time(NULL)));\n    for(int i = 0; i < SIZE; ++i)\n    {\n        arr[i] = rand() % 100;\n    }\n    show(arr, SIZE);  //å±•ç¤ºåŸå§‹æ•°æ®\n    XXX(arr);         //è°ƒç”¨æ’åºç®—æ³•\n    show(arr, SIZE);  //å±•ç¤ºæ’åæ•°æ®\n    if(isSort(arr, SIZE))\n        printf(\"æ•°æ®å·²ç»å®Œå…¨æœ‰åº\\n\");\n    else printf(\"æ•°æ®æ— åº\\n\");\n}\n```\n\n# ä¸ºä½•å¿«é€Ÿæ’åºå’Œå½’å¹¶æ’åºå¾ˆé‡è¦\n\nå› ä¸ºè¿™ä¸¤ä¸ªç®—æ³•å¯ä»¥æŠŠæ•´ä¸ªæ•°æ®è¿›è¡Œåˆ’åˆ†ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨å¤šçº¿ç¨‹å¤„ç†åˆ’åˆ†çš„ä»»åŠ¡ï¼Œå¤„ç†å®Œåï¼Œæœ€åå†ç”¨ä¸€ä¸ªä¸»çº¿ç¨‹å¤„ç†æ‰€æœ‰æ•°æ®ã€‚è¿™æ˜¯å¯åˆ’åˆ†ç®—æ³•çš„ä¼˜åŠ¿ã€‚","categories":["ç®—æ³•","æ’åº"]},{"title":"Cpp_ç»§æ‰¿å’Œå¤šæ€","url":"/Cpp/Cpp_ç»§æ‰¿å’Œå¤šæ€/","content":"\n# å†…å®¹\n\n# å¼•å…¥\n\nç±»ä¸ç±»ä¹‹é—´çš„å…³ç³»ï¼š\n\nç»„åˆ/åµŒå¥—ï¼šä¸€ä¸ªç±»ä¸­å£°æ˜äº†å¦ä¸€ä¸ªç±»ï¼Œæ˜¯å±äºçš„å…³ç³»ã€‚ä¸€ä¸ªç±»æ˜¯å¦ä¸€ä¸ªç±»çš„ä¸€éƒ¨åˆ†ã€‚\n\nä»£ç†ï¼šä¸€ä¸ªç±»çš„æ¥å£æ˜¯å¦ä¸€ä¸ªç±»æ¥å£çš„å­é›†\n\nç»§æ‰¿ï¼šfish--goldFish\n\n# éšè—\n\nå­ç±»ä¼šéšè—çˆ¶ç±»çš„åŒåæˆå‘˜ã€‚----åŒåéšè—\n\nè®¿é—®è¢«éšè—çš„æˆå‘˜éœ€è¦åŠ ä¸Šï¼ˆçˆ¶ç±»ï¼‰ä½œç”¨åŸŸã€‚\n\n# åŠ¨å¤šæ€\n\näº§ç”Ÿï¼šä½¿ç”¨æŒ‡é’ˆæˆ–è€…å¼•ç”¨è°ƒç”¨è™šå‡½æ•°ï¼Œå°±ä¼šäº§ç”ŸåŠ¨å¤šæ€è°ƒç”¨\n\nåŠ¨å¤šæ€è°ƒç”¨çš„è¿‡ç¨‹ï¼š\n\n1. ä½¿ç”¨æŒ‡é’ˆæˆ–è€…å¼•ç”¨è°ƒç”¨è™šå‡½æ•°\n2. åœ¨å¯¹è±¡ä¸­æ‰¾åˆ°vfptr\n3. æ ¹æ®vfptræ‰¾åˆ°vftable\n4. åœ¨vftableä¸­æ‰¾åˆ°è¦è°ƒç”¨çš„å‡½æ•°\n5. è°ƒç”¨\n\nvftable\n\nç¼–è¯‘æ—¶æœŸå¦‚æœå‘ç°ç±»ä¸­æœ‰è™šå‡½æ•°ï¼Œå°±ä¼šå¯¹è¿™ä¸ªç±»ç”Ÿæˆvftableï¼ˆè™šå‡½æ•°è¡¨ï¼‰ã€‚å°†å½“å‰\n\n# é¢è¯•\n\n1. çˆ¶å­ç±»/ç»„åˆç±»çš„æ„é€ é¡ºåº\n   1. å…ˆæ„é€ çˆ¶ç±»ï¼Œå†æ„é€ å­ç±»ã€‚\n   2. å…ˆæ„é€ å†…éƒ¨ç±»ï¼Œå†æ„é€ å¤§ç±»ã€‚\n2. ç±»çš„ç¼–è¯‘é¡ºåºï¼š\n   1. ç¼–è¯‘ç±»å\n   2. ç¼–è¯‘æˆå‘˜å=====ç¼–è¯‘åµŒå¥—ç±»\n   3. ç¼–è¯‘æˆå‘˜æ–¹æ³•ä½“\n3. ä»€ä¹ˆæ˜¯å¤šæ€\n   1. é¢å‘å¯¹è±¡æ–¹æ³•å­¦ä¸­ï¼Œæ´¾ç”Ÿç±»ç»§æ‰¿åŸºç±»åè¡¨ç°å‡ºæ¥çš„å½¢å¼å«å¤šæ€ã€‚è¿™ä¸ªå½¢å¼ä¸ºåœ¨åŸºç±»çš„è¡Œä¸ºåŸºç¡€ä¸Šåˆæ´¾ç”Ÿå‡ºå„è‡ªæ´¾ç”Ÿç±»çš„ç‰¹æ€§\n4. åŠ¨å¤šæ€çš„äº§ç”Ÿæ¡ä»¶\n   1. çˆ¶ç±»æœ‰è™šå‡½æ•°\n5. åŠ¨å¤šæ€çš„è¿‡ç¨‹\n   1. å­ç±»ç»§æ‰¿çˆ¶ç±»æ—¶ï¼Œæ‹·è´çˆ¶ç±»è™šå‡½æ•°è¡¨ï¼Œè¦†ç›–è™šå‡½æ•°è¡¨ä¸­çš„åŒåæ–¹æ³•ã€‚\n   2. åœ¨è°ƒç”¨å­ç±»æ–¹æ³•æ—¶ï¼Œå¦‚æœå‘ç°å…¶æ˜¯è™šå‡½æ•°ï¼Œåˆ™ç”±è™šå‡½æ•°è¡¨æŒ‡é’ˆæ‰¾åˆ°è™šå‡½æ•°è¡¨ï¼ŒæŸ¥å‡ºå‡½æ•°æŒ‡é’ˆï¼Œè°ƒç”¨ç»§æ‰¿æˆ–é‡å†™çš„æ–¹æ³•ã€‚\n6. vftableä»€ä¹ˆæ—¶å€™äº§ç”Ÿï¼Ÿåœ¨å“ªé‡Œå­˜å‚¨ï¼Ÿ\n   1. åœ¨æ„é€ å­ç±»å‰ï¼Œæ„é€ çˆ¶ç±»æ—¶äº§ç”Ÿã€‚åœ¨å†…å­˜çš„åªè¯»æ•°æ®æ®µä¸­å­˜å‚¨ã€‚\n7. æ„é€ å‡½æ•°èƒ½ä¸èƒ½å†™æˆè™šå‡½æ•°\n   1. ä¸èƒ½ï¼Œå› ä¸ºè°ƒç”¨è™šå‡½æ•°éœ€è¦å»æ„é€ å¥½çš„å¯¹è±¡ä¸­æ‰¾è™šå‡½æ•°è¡¨æŒ‡é’ˆã€‚ä½†æ˜¯ä»–è¿˜æ²¡æ„é€ å‡ºæ¥ã€‚\n8. é™æ€å‡½æ•°èƒ½ä¸èƒ½å†™æˆè™šå‡½æ•°\n   1. é™æ€å‡½æ•°å±äºç±»çš„å‡½æ•°ï¼Œç†è®ºä¸Šå¯ä»¥è¢«å®šä¹‰ä¸ºè™šå‡½æ•°å¹¶ç»§æ‰¿ã€‚\n9. ææ„å‡½æ•°èƒ½ä¸èƒ½å†™æˆè™šå‡½æ•°\n   1. å¯ä»¥ï¼Œå¹¶ä¸”åœ¨è¿ç”¨å¤šæ€æ—¶ï¼Œå¸¸ç”¨ã€‚\n10. è™šå‡½æ•°èƒ½ä¸èƒ½è¢«å¤„ç†ä¸ºå†…è”\n    1. ä¸èƒ½ã€‚å†…è”æ˜¯åœ¨ç¼–è¯‘æœŸä»£ç æ®µå±•å¼€ï¼Œè€ŒåŠ¨å¤šæ€æ˜¯åœ¨è¿è¡Œæ—¶ã€‚\n11. ä»€ä¹ˆæƒ…å†µä¸‹ææ„å‡½æ•°å¿…é¡»å†™æˆè™šå‡½æ•°\n    1. çˆ¶ç±»æŒ‡é’ˆæŒ‡å‘å­ç±»å¯¹è±¡\n12. çˆ¶ç±»æŒ‡é’ˆèƒ½ä¸èƒ½æŒ‡å‘å­ç±»å¯¹è±¡ï¼Ÿå­ç±»æŒ‡é’ˆèƒ½ä¸èƒ½æŒ‡å‘çˆ¶ç±»å¯¹è±¡ï¼Ÿ\n    1. å‰è€…å¯ä»¥ï¼Œåè€…ä¸å¯ã€‚\n13. ä»€ä¹ˆæ˜¯RTTIï¼Ÿåœ¨ä»€ä¹ˆæ—¶å€™äº§ç”Ÿï¼Ÿå­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ\n14. çˆ¶ç±»æŒ‡é’ˆå¦‚ä½•è½¬åŒ–ä¸ºå­ç±»æŒ‡é’ˆï¼Ÿè½¬åŒ–æœ‰ä»€ä¹ˆæ¡ä»¶ï¼Ÿ\n15. ä»€ä¹ˆæ˜¯è±å½¢ç»§æ‰¿ï¼Ÿè±å½¢ç»§æ‰¿æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ\n16. çº¯è™šå‡½æ•°æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ\n17. éšè—\n18. è¦†ç›–\n\n## ç­”æ¡ˆ\n\n1. \n   1. é™å¤šæ€\n      1. ç¼–è¯‘æ—¶æœŸçš„å¤šæ€ï¼Œåˆè¢«ç§°ä¸ºæ—©ç»‘å®š\n      2. ä»£è¡¨ï¼šå‡½æ•°é‡è½½ã€æ¨¡æ¿\n   2. åŠ¨å¤šæ€\n      1. è¿è¡Œæ—¶æœŸçš„å¤šæ€ï¼Œåˆè¢«ç§°ä¸ºæ™šç»‘å®š\n      2. ä»£è¡¨ï¼šç»§æ‰¿ä¸­çš„å¤šæ€\n\n2. \n   1. ç¼–è¯‘ç±»å\n   2. ç¼–è¯‘æˆå‘˜å=====ç¼–è¯‘åµŒå¥—ç±»\n   3. ç¼–è¯‘æˆå‘˜æ–¹æ³•ä½“\n\n3. \n4. \n   1. æŒ‡é’ˆæˆ–å¼•ç”¨è°ƒç”¨è™šå‡½æ•° + å¯¹è±¡å¿…é¡»å®Œæ•´\n   2. å®Œæ•´å¯¹è±¡ï¼šæ„é€ å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œè™šæ„å‡½æ•°è¿˜æ²¡å¼€å§‹\n\n5. \n   1. ä½¿ç”¨æŒ‡é’ˆæˆ–è€…å¼•ç”¨è°ƒç”¨è™šå‡½æ•°\n   2. åœ¨å¯¹è±¡ä¸­æ‰¾åˆ°vfptr\n   3. æ‰¾åˆ°vftable\n   4. åœ¨è¡¨ä¸­æ‰¾åˆ°å¯¹åº”çš„å‡½æ•°\n\n6. \n   1. ç¼–è¯‘æœŸäº§ç”Ÿ\n   2. æ”¾åœ¨rodataåŒº\n\n7. \n   1. ä¸èƒ½ï¼Œæ„é€ å‡½æ•°æ— æ³•é€šè¿‡æŒ‡é’ˆæˆ–è€…å¼•ç”¨è°ƒç”¨ï¼Œå†™æˆè™šå‡½æ•°æ²¡æœ‰æ„ä¹‰ã€‚\n   2. vfptræ˜¯åœ¨æ„é€ æ—¶æ‰å†™å…¥å¯¹è±¡ï¼Œè€Œè°ƒç”¨è™šæ„é€ å‡½æ•°æ—¶æ²¡æœ‰å¯¹è±¡æ„é€ å‡ºæ¥ã€‚\n\n8. ä¸èƒ½ï¼Œå› ä¸ºé™æ€å‡½æ•°ä¸ä¾èµ–äºå¯¹è±¡ã€‚\n\n10. \n    1. ä¸èƒ½ã€‚å·²å†…è”çš„å‡½æ•°åœ¨ç¼–è¯‘æœŸä»£ç æ®µå±•å¼€ï¼Œåœ¨releaseç‰ˆæœ¬æ²¡æœ‰åœ°å€ã€‚\n\n11. çˆ¶ç±»æŒ‡é’ˆæŒ‡å‘å †ä¸Šçš„å­ç±»å¯¹è±¡æ—¶ï¼Œå¿…é¡»æŠŠçˆ¶ç±»çš„è™šæ„å‡½æ•°å†™ä¸ºè™šå‡½æ•°ã€‚\n\n13. \n    1. runtime type infoï¼Œæ˜¯ä¸€ä¸ªæŒ‡å‘ç±»å‹ä¿¡æ¯çš„æŒ‡é’ˆã€‚\n    2. ç¼–è¯‘æœŸäº§ç”Ÿï¼ŒRTTIæŒ‡é’ˆæ”¾åœ¨vftableé‡Œé¢ï¼Œç±»å‹ä¿¡æ¯æ”¾åœ¨rodataæ®µã€‚\n\n14. ```cpp\n    Derive* pd = dynamic_cast<Derive*>(p);\n    dynamic_cast : çˆ¶ç±»æŒ‡é’ˆè½¬ä¸ºå­ç±»æŒ‡é’ˆä¸“ç”¨çš„ç±»å‹å¼ºè½¬\n    è¦æ±‚ï¼š\n        1.å¿…é¡»æœ‰RTTI\n        2.çˆ¶ç±»æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ä¸­çš„RTTIç¡®å®æ˜¯å­ç±»ç±»å‹ã€‚\n    ```\n\n15. \n\n17. å­ç±»ä¸­çš„æˆå‘˜ä¼šéšè—çˆ¶ç±»ä¸­åŒåçš„æˆå‘˜ã€‚\n18. å­ç±»ä¸­çš„æˆå‘˜æ–¹æ³•ä¼šè¦†ç›–çˆ¶ç±»ä¸­ç›¸åŒï¼ˆåŒè¿”å›å€¼ã€å‚æ•°åˆ—è¡¨ï¼ˆå› ä¸ºå‡½æ•°æŒ‡é’ˆçš„ç±»å‹è¦ç›¸åŒï¼‰ï¼‰çš„è™šå‡½æ•°ã€‚\n\n# è±å½¢ç»§æ‰¿\n\n1. è±å½¢ç»§æ‰¿å¼•å…¥çš„é—®é¢˜\n   1. é€ æˆå…¬å…±çˆ¶ç±»åœ¨å­å¯¹è±¡ä¸­å­˜åœ¨å¤šä¸ªå®ä¾‹\n2. è±å½¢ç»§æ‰¿çš„è§£å†³\n   1. è™šç»§æ‰¿\n3. PowerShellä¸­å‘½ä»¤æŸ¥çœ‹ç±»çš„æ„é€ \n   1. `cl /d1 report Single Class Layout D(è¦æŸ¥çœ‹ç»“æ„çš„ç±»å) ./main.cpp > 1.txt`\n\n# è™šç»§æ‰¿\n\n1. è™šç»§æ‰¿çš„é€»è¾‘\n   1. è¢«è™šç»§æ‰¿çš„ç±»ä¼šå˜æˆè™šåŸºç±»\n   2. è™šåŸºç±»åœ¨å­ç±»å¯¹è±¡ä¸­å­˜æ”¾åœ¨vbtableä¸­\n   3. åŸæœ¬åº”è¯¥å­˜å‚¨è¯¥çˆ¶ç±»å¯¹è±¡çš„ä½ç½®ä¸Šæ›¿æ¢ä¸ºvbptr\n   4. vbptræŒ‡å‘vbtableä¸­è™šåŸºç±»å®ä¾‹çš„ä½ç½®ï¼Œä»è€Œä¿è¯è™šåŸºç±»åœ¨å­ç±»ä¸­åªä¼šæœ‰ä¸€ä¸ªå®ä¾‹çš„å­˜åœ¨\n   5. æ³¨æ„ï¼šè™šåŸºç±»åœ¨å­ç±»æ„é€ æ—¶å€™ä¼šè¢«å½“åšç›´æ¥çˆ¶ç±»è¿›è¡Œæ„é€ ï¼ˆå­ç±»çš„åˆå§‹åŒ–åˆ—è¡¨éœ€è¦åŠ è™šåŸºç±»çš„åˆå§‹åŒ–ï¼‰\n\n# æŠ½è±¡ç±»\n\n1. æœ‰çº¯è™šå‡½æ•°çš„ç±»å«æŠ½è±¡ç±»\n2. \n\n# éšè—å’Œé‡å†™\n\nâ€œéšè—â€æ˜¯æ¯”â€œé‡å†™â€æ›´é‡è¦çš„æ³•åˆ™ã€‚â€œé‡å†™â€è™šå‡½æ•°éœ€è¦å‡½æ•°åŒåï¼Œå¿…å®šè¦éµå®ˆâ€œéšè—â€æ³•åˆ™ï¼Œè¿™ä¸æ„å‘³ç€æˆ‘ä»¬ä¸èƒ½è°ƒç”¨è¢«éšè—çš„åŸºç±»å‡½æ•°ï¼Œâ€œè™šâ€çš„æ„ä¹‰æ­£æ˜¯è¦é€šè¿‡å¦ä¸€ç§å·¥å…·â€”â€”è™šè¡¨æŒ‡é’ˆæ¥æ‰¾å‡ºéšè—çš„åŸºç±»å‡½æ•°ã€‚\n\n```c++\n#include<iostream>\nusing namespace std;\nclass Object\n{\n\tint value;\npublic:\n\tObject(int x = 0) : value(x) {}\n\tvirtual void add() { cout << \"O:add\" << endl; }\n\tvirtual void fun() { cout << \"O:fun\" << endl; }\n};\nclass Base : public Object\n{\nprivate:\n\tint num;\npublic:\n\tBase(int x = 0) : num(x + 10) {}\n\tvirtual void add() { cout << \"B:add\" << endl; }\n\tvirtual void fun(int x) { cout << \"B:fun(int)\" << endl; }\n};\nint main()\n{\n\tBase base(10);\n/*\t'op', 'bp' actually point to a 'Base' instance. \n\tThere are 'B:add()', 'O:fun()', 'B:(int)' in this instance's vft*/\n\tObject* op = &base;\n\tBase* bp = &base;\n\top->add();\t\t//O:add()\n\top->fun();\t\t//O:fun()\n/*\top->fun(133);*/\t//complie error! 'op' is a 'Object' poniter, 'Object' class not has fun(int)\n\n\tbp->add();\t\t//B:add()\t->\toveride the O:add()\n/*\tbp->fun();*/\t//compile error! 'bp' is a 'Base' poniter, though it's vft has the O:fun(), but O:fun() is hidden by B:fun(int)\n\tbp->fun(233);\t//B:fun(int)->\thide\tthe O:fun()\n    \n\t//compile error! 'op' stated a 'Base' poniter, though it's vft has the O:fun(), but O:fun() is hidden by B:fun(int)\n/*\tdynamic_cast<Base*>(op)->fun();\t*/\n    \n    //ok! 'op' is a 'Object' poniter, it's vft not has the 'B:fun(int)'\n\tdynamic_cast<Base*>(op)->fun(1);\n    \n    \n    //ok! Here explicitly stated 'bp' a 'Object' pointer, now compiler feels 'O:fun()' instead of being hidden.\n\tdynamic_cast<Object*>(bp)->fun();\n    \n    //compile error! 'bp' stated a 'Object' pointer, now compiler think the 'bp' not has the 'fun(int)' function.\n/*\tdynamic_cast<Object*>(bp)->fun(2);*/\n\n}\n```\n\n","categories":["Cpp"]},{"title":"Cpp_è¿”å›å€¼","url":"/Cpp/Cpp_è¿”å›å€¼/","content":"# å†…å®¹\n![image-20211107095730498](../../images/è¿”å›å€¼/image-20211107095730498.png)\nGetValueè¿”å›çš„æ˜¯ä¸´æ—¶å˜é‡å‰¯æœ¬ï¼Œç”±å¯„å­˜å™¨ä½œä¸ºä¼ é€’åª’ä»‹ã€‚\n1. a1å¯ä»¥ã€‚å› ä¸ºè°ƒç”¨çš„æ˜¯publicå‡½æ•°ã€‚ä½†æ˜¯å¾—åˆ°çš„æ˜¯ç»è¿‡å¯„å­˜å™¨èµ‹å€¼æ‹¿åˆ°çš„å‰¯æœ¬ã€‚\n2. åº”è¯¥ä¸å¯ä»¥ï¼Œå› ä¸ºè¿”å›å€¼æ˜¯ä¸€ä¸ªå°†äº¡å€¼ï¼Œä¸èƒ½å¯¹å…¶è¿›è¡Œæ™®é€šå¼•ç”¨ã€‚\n3. çŒœæµ‹å¯ä»¥å¯¹å°†äº¡å€¼è¿›è¡Œå¸¸å¼•ç”¨ã€‚\n## 2\n![image-20211107101017513](../../images/è¿”å›å€¼/image-20211107101017513.png)\n## 3\n![image-20211107102226241](../../images/è¿”å›å€¼/image-20211107102226241.png)\n## 4\n\n![image-20211107103310102](../../images/%E8%BF%94%E5%9B%9E%E5%80%BC/image-20211107103310102.png)\n## 5\n\n![image-20211107112403421](../../images/%E8%BF%94%E5%9B%9E%E5%80%BC/image-20211107112403421.png)\n## 6\n\n![image-20211107114851729](../../images/%E8%BF%94%E5%9B%9E%E5%80%BC/image-20211107114851729.png)\n## 7\n\n![image-20211114192200476](../../images/%E8%BF%94%E5%9B%9E%E5%80%BC/image-20211114192200476.png)\n\n`Test ta(10)`ä¸€ä¸ªInt\n\n1. âˆš--ç¼–è¯‘å™¨ä¼˜åŒ–ï¼Œç›´æ¥æ‹·è´æ„é€ ï¼Œä¸€ä¸ªInt\n2. âˆš--æ²¡äº§ç”Ÿ\n3. âˆš--æ²¡äº§ç”Ÿ\n4. Ã—\n5. Ã—\n6. âˆš--æ²¡äº§ç”Ÿ\n7. âˆš--æ²¡äº§ç”Ÿ\n8. âˆš--æ²¡äº§ç”Ÿ\n## 8\n\n![image-20211114195324558](../../images/%E8%BF%94%E5%9B%9E%E5%80%BC/image-20211114195324558.png)\n\n1. âˆš\n2. Ã—\n3. âˆš\n4. Ã—\n5. Ã—\n6. Ã—\n7. âˆš\n8. Ã—\n9. âˆš\n## 9\n\n![image-20211114201105648](../../images/%E8%BF%94%E5%9B%9E%E5%80%BC/image-20211114201105648.png)\n## 10\n\n![image-20211114203355621](../../images/%E8%BF%94%E5%9B%9E%E5%80%BC/image-20211114203355621.png)\n\n1. âˆš\n2. âˆš\n3. âˆš\n4. b1ï¼šæŒ‡é’ˆçš„ä¸´æ—¶é‡ä¹Ÿç®—æ˜¯ä¸€ä¸ªå°†äº¡å€¼\n5. p1ï¼šâˆš\n6. p2ï¼šâˆš\n7. p3ï¼šâˆš\n8. p4ï¼šâˆš\n## 11\n\n![image-20211114204142437](../../images/%E8%BF%94%E5%9B%9E%E5%80%BC/image-20211114204142437.png)\n\n1. a1ï¼šâˆš\n2. a2ï¼šÃ—\n3. a3ï¼šâˆš\n4. b1ï¼šï¼Ÿï¼ŒÃ—ï¼Œå¿…é¡»åœ¨b1çš„Intå‰åŠ const\n5. p1ï¼šÃ—\n6. p2ï¼šâˆš\n7. p3ï¼šÃ—\n8. p4ï¼šâˆš","categories":["Cpp"]},{"title":"Linux_è¿›ç¨‹é—´é€šä¿¡(IPC)","url":"/Linux/Linux_è¿›ç¨‹é—´é€šä¿¡(IPC)/","content":"\n# å†…å®¹\n\n1. ç®¡é“\n2. ä¿¡å·é‡\n3. å…±äº«å†…å­˜\n4. æ¶ˆæ¯é˜Ÿåˆ—\n5. å¥—æ¥å­—\n\n2-4æ¯”è¾ƒæ­£å¼ã€‚å¦‚æœå¡«ç©ºåªæœ‰ä¸‰ä¸ªç©ºï¼Œå¡«2-4ã€‚\n\n# ç®¡é“\n\nç®¡é“æ–‡ä»¶æ˜¯åœ¨å†…å­˜ä¸­åˆ†é…ç©ºé—´ã€‚\n\nè¯»ç«¯rï¼Œå†™ç«¯wã€‚\n\nåˆ†ä¸¤ç§ï¼Œæœ‰åç®¡é“ã€æ— åç®¡é“ã€‚\n\n## æœ‰åç®¡é“\n\n```bash\nmkfifo fifo#mkfifo [åå­—]\n#prw-rw-r-- 1 stu stu 0 fifo\nmkfifo()\n```\n\n```c\n//å†™ç«¯ç¨‹åº\n#include<stdlib.h>\n#include<unistd.h>\n#include<string.h>\n#include<assert.h>\n#include<fcntl.h>\nint main()\n{   \n    int fdw = open(\"fifo\",O_WRONLY);\n    assert(fdw!=-1);\n    printf(\"fdw=%d\\n\",fdw);\n    char buff[128] = {0};\n    fgets(buff,128,stdin);\n    write(fdw,buff,strlen(buff));\n    close(fdw);\n    exit(0);\n}\n```\n\n\n\n```c\nint main()\n{\n    int fdr = open(\"fifo\",O_RDONLY);\n    assert(fdr!=-1);\n    \n    printf(\"fdr=%d\\n\",fdr);\n    \n    char buff[128] = {0};\n    \n    read(fdr,buff,127);\n    printf(\"%s\",buff);\n    close(fdr);\n    exit(0);\n}\n```\n\n\n\n## æ— åç®¡é“\n\n```bash\npipe()\n```\n\n\n\n## æ€»ç»“\n\n1. ç®¡é“ä¸ºç©ºæ—¶ï¼Œè¯»ä¼šé˜»å¡ã€‚\n\n2. ç®¡é“å†™æ»¡æ—¶ï¼Œå†™ä¼šé˜»å¡ã€‚\n\n3. ä¸¤ä¸ªç«¯å£æ‰“å¼€åï¼Œä¹Ÿå†™äº†ä¸€äº›æ•°æ®ï¼Œä¹Ÿè¯»äº†ä¸€äº›æ•°æ®ï¼Œå¦‚æœè¯»å®Œäº†ï¼Œåˆ™ç®¡é“å†…å®¹å˜ç©ºï¼Œåˆ™è¯»ç«¯è¿›ç¨‹é˜»å¡ã€‚è€Œå¦‚æœå†™ç«¯å…³é—­åï¼Œåˆ™è¯»ç«¯ä¸ä¼šå†é˜»å¡äº†ï¼Œå†æ¥ç€readä¼šè¿”å›ä¸€ä¸ªé›¶ï¼Œå¯ä½œä¸ºå†™ç«¯å®Œæ¯•çš„æ ‡å¿—ã€‚\n\n   ```c\n   //å†™ç«¯\n   int main()\n   {   \n       int fdw = open(\"fifo\",O_WRONLY);\n       assert(fdw!=-1);\n       printf(\"fdw=%d\\n\",fdw);\n       while(1)\n       {\n           char buff[128] = {0};\n           printf(\"input util end:\"\\n);\n           fgets(buff,128,stdin);\n           if(strncmp(buff,\"end\",3)==0)\n           {\n               break;\n           }\n       }\n       write(fdw,buff,strlen(buff));\n       close(fdw);\n       exit(0);\n   }\n   //è¯»ç«¯\n   int main()\n   {\n       int fdr = open(\"fifo\",O_RDONLY);\n       assert(fdr!=-1);\n       \n       printf(\"fdr=%d\\n\",fdr);\n       while(1)\n       {\n           char buff[128] = {0};\n       \tint n = read(fdr,buff,127);\n       \tif(n == 0)//n=0è‚¯å®šæ˜¯å› ä¸ºå†™ç«¯closeäº†ï¼Œå› ä¸ºæ²¡æœ‰åœ¨æ²¡å†™å…¥æ—¶é˜»å¡\n           {\n               break;\n           }\n       \tprintf(\"%s\",buff);\n       }\n       close(fdr);\n       exit(0);\n   }\n   ```\n\n4. ç®¡é“è¯»ç«¯å…³é—­åï¼Œå†™ç«¯å†å†™å…¥æ•°æ®æ—¶ï¼Œåˆ™ä¼šè§¦å‘å¼‚å¸¸ï¼Œåˆ™å†…æ ¸ä¼šç»™å†™ç«¯è¿›ç¨‹å‘ä¿¡å·ã€‚\n\n5. é¢è¯•ï¼š\n\n   1. æœ‰åç®¡é“å¯ä»¥åœ¨ä»»æ„ä¸¤ä¸ªè¿›ç¨‹é—´é€šä¿¡ï¼›æ— åç®¡é“åªèƒ½åœ¨çˆ¶å­è¿›ç¨‹é—´ä½¿ç”¨ã€‚\n   2. ç®¡é“é€šä¿¡æ–¹å¼ï¼šåŠåŒå·¥çš„ã€‚\n      1. å•å·¥ï¼šç”µå°ä»Aå‘åˆ°Bï¼Œæ”¶éŸ³æœºä¸å¯èƒ½ç»™ç”µå°å‘æ•°æ®ã€‚è¿‡ç¨‹ä¸å¯é€†ã€‚\n      2. åŠåŒå·¥ï¼šè·Ÿå¯¹è®²æœºç±»ä¼¼ã€‚éœ€è¦æŒ‰ä¸‹æŒ‰é”®æŠ¢å ä¿¡é“ã€‚å…¶ä½™æ˜¯å¬ã€‚åŒä¸€æ—¶åˆ»åªèƒ½è¯»æˆ–å†™ã€‚\n      3. å…¨åŒå·¥ï¼šè…¾è®¯ä¼šè®®ã€‚\n   3. å†™å…¥ç®¡é“çš„æ•°æ®ï¼Œåœ¨å†…å­˜ä¸­ã€‚æœ‰åç®¡é“è™½ç„¶èƒ½åœ¨ç£ç›˜ä¸Šçœ‹åˆ°ï¼Œä½†åªæ˜¯ä¸€ä¸ªæ ‡è¯†ï¼Œå¤§å°æ˜¯0ã€‚\n\n# ä¿¡å·é‡\n\nç›®çš„æ˜¯æ§åˆ¶å¯¹æŸä¸ªä¸´ç•Œèµ„æºçš„è®¿é—®ã€‚\n\n## ä¸´ç•Œèµ„æº\n\nä¸´ç•Œèµ„æºï¼šåŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªè¿›ç¨‹è®¿é—®çš„èµ„æº\n\nä¸´ç•ŒåŒºï¼šè®¿é—®ä¸´ç•Œèµ„æºçš„ä»£ç æ®µ\n\n## å–å€¼\n\næ¯”è¾ƒç‰¹æ®Šï¼Œåªå–0å’Œæ­£æ•°ã€‚\n\nç¬¬ä¸€ç§æ˜¯0ï¼Œ1äºŒå€¼ä¿¡å·é‡ã€‚\n\nç¬¬äºŒç§æ˜¯è®¡æ•°ä¿¡å·é‡ã€‚\n\n## p,væ“ä½œ\n\npï¼Œå‡ä¸€ï¼Œä»£è¡¨è·å–èµ„æºã€‚\n\nvï¼ŒåŠ ä¸€ï¼Œä»£è¡¨é‡Šæ”¾èµ„æºã€‚\n\n## ä»£ç å°è£…\n\n```c\n/*\n1.sem_init()\n2.sem_p()\n3.sem_v()\n4.sem_destroy()\n*/\n```\n\n# å…±äº«å†…å­˜\n\n1. åˆ›å»ºå…±äº«å†…å­˜\n2. å°†å…±äº«å†…å­˜æ˜ å°„åˆ°è¿›ç¨‹ä¸­\n3. æ–­å¼€æ˜ å°„\n4. é”€æ¯å…±äº«å†…å­˜\n\n# æ¶ˆæ¯é˜Ÿåˆ—\n\n1. å‘é€æ¶ˆæ¯ï¼Œå‘é€ä¸¤ä¸ªä¿¡æ¯ï¼Œä¸€æ˜¯typeï¼ŒäºŒæ˜¯æ•°æ®ã€‚\n2. è·å–æ¶ˆæ¯ï¼Œè·å–typeã€‚\n","categories":["æ“ä½œç³»ç»Ÿ","å¤šçº¿ç¨‹","Linux"]},{"title":"Linux_ä¿¡å·","url":"/Linux/Linux_ä¿¡å·/","content":"# ä¿¡å·\n\nä¹Ÿå«è½¯ä¸­æ–­ã€‚\n\né€šçŸ¥è¿›ç¨‹å‘ç”Ÿäº†æŸä¸ªäº‹ä»¶ã€‚\n\n# signal\n\n![image-20211030101557246](../../images/%E4%BF%A1%E5%8F%B7/image-20211030101557246.png)\n\nsignalç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¿¡å·ä»£å·ã€‚ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¿¡å·å¤„ç†å‡½æ•°å…¥å£åœ°å€ã€‚\n\né»˜è®¤ï¼šSIG_DFLï¼›å¿½ç•¥ï¼šSIG_IGNã€‚\n\n```c\n//é»˜è®¤ï¼šSIG_DFLï¼›å¿½ç•¥ï¼šSIG_IGNã€‚\n(void (*)0)\n```\n\n\n\n```c\n//ä»¥ä¸‹ç¨‹åºæŠŠåŸæœ‰çš„SIGINTä¿¡å·å¤„ç†æ–¹å¼æ”¹ä¸ºäº†æˆ‘ä»¬è‡ªå®šä¹‰çš„å‡½æ•°ã€‚\nvoid sig_fun(int sig)\n{\n    printf(\"sig=%d\\n\",sig);\n}\nint main()\n{\n    signal(SIGINT, sig_fun);//åªæ˜¯åšäº†ä¸€ä¸ªçº¦å®šã€‚æ²¡æœ‰å»è°ƒç”¨sig_funå‡½æ•°ã€‚ç­‰åˆ°ä¿¡å·å‡ºç°æ‰å»è°ƒç”¨ã€‚\n    while(1)\n    {\n        printf(\"hello\\n\");\n        sleep(1);\n    }\n}\n```\n\n","categories":["æ“ä½œç³»ç»Ÿ","å¤šçº¿ç¨‹","Linux"]},{"title":"2021å¹´10æœˆé¢è¯•","url":"/é¢è¯•ç»éªŒ/2021å¹´10æœˆé¢è¯•/","content":"\n# 1029\n\nç¬¬ä¸€é“é¢˜ï¼Œç»“æ„ä½“å¯¹é½çš„è§„åˆ™ã€‚\nç¬¬äºŒå¤§é¢˜ï¼Œå®ç°ä¸€ä¸ªå®ï¼Œè®¡ç®—ç»“æ„ä½“æˆå‘˜çš„ç›¸å¯¹åç§»é‡ã€‚\nç¬¬ä¸‰é“é¢˜ï¼Œç»“æ„ä½“å’Œå…±ç”¨ä½“çš„åŒºåˆ«ã€‚\nç¬¬å››é“é¢˜ï¼Œç¼–å†™ç¨‹åºå®Œæˆï¼Œintå˜é‡çš„å°ç«¯å­˜å‚¨è½¬æ¢æˆå¤§ç«¯å­˜å‚¨ã€‚\nç¬¬äº”é“é¢˜ï¼Œè¯´ä¸€ä¸‹ç”¨æˆ·å­˜å‚¨ç©ºé—´éƒ½æœ‰å“ªå‡ ä¸ªåŒºæ„æˆï¼Ÿå›ç­”ä¸€ä¸‹ï¼Œæ ˆåŒºå’Œå †åŒºçš„åŒºåˆ«ã€‚\nç¬¬å…­é“é¢˜ï¼Œä»£ç å®ç°æ‰“å°Nè¡Œæ¨è¾‰ä¸‰è§’ã€‚ä¸å¾—ä½¿ç”¨äºŒç»´æ•°ç»„ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ç»´æ•°ç»„ã€‚\nç¬¬ä¸ƒé“é¢˜ï¼Œå¿«æ’ï¼Œå †æ’ï¼Œå½’å¹¶æ’åºï¼Œä»»é€‰ä¸€é“å®ç°ä»£ç ã€‚\nç¬¬å…«é“é¢˜ï¼Œè°ˆè°ˆé¡ºåºè¡¨å’Œé“¾è¡¨çš„åŒºåˆ«ï¼Œä»¥åŠé€‚ç”¨çš„åœºæ™¯ã€‚\nç¬¬ä¹é“é¢˜ï¼Œå®ç°ä¸å¸¦å¤´èŠ‚ç‚¹å•é“¾è¡¨çš„é€†ç½®ã€‚\n\n# 1\n\nç»“æ„ä½“å¯¹é½çš„è§„åˆ™ã€‚\n\n## æˆ‘ç­”çš„\n\n1. ~~æ‰€æœ‰æˆå‘˜åœ°å€ç›¸å¯¹ç»“æ„ä½“~~é¦–åœ°å€çš„åç§»é‡è¦å¯ä»¥è¢«æˆå‘˜çš„åŸºæœ¬æ•°æ®ç±»å‹å¤§å°æ•´é™¤ã€‚è®¡ç®—sizeofæ—¶ï¼Œé¦–åœ°å€é»˜è®¤ä¸º0ï¼Œæ‰€ä»¥éƒ½æ»¡è¶³ç›¸å¯¹é¦–åœ°å€å¯æ•´é™¤ã€‚\n2. å„ä¸ªæˆå‘˜ä¾æ¬¡ä»ä¸Šåˆ°ä¸‹éƒ½è¦ç›¸å¯¹äºå‰ä¸€ä¸ªæˆå‘˜çš„é¦–åœ°å€åç§»é‡è¢«ä¸‹ä¸€ä¸ªæˆå‘˜åŸºæœ¬æ•°æ®ç±»å‹å¤§å°æ•´é™¤ã€‚\n3. æœ€åï¼Œç»“æ„ä½“çš„å¤§å°è¦å¯ä»¥è¢«è¯¥ç»“æ„ä½“å†…æœ€å¤§çš„æˆå‘˜åŸºæœ¬æ•°æ®ç±»å‹å¤§å°æ•´é™¤ã€‚\n\n## ç­”æ¡ˆ\n\n1. ç»“æ„ä½“å˜é‡çš„é¦–åœ°å€ï¼Œå¿…é¡»æ˜¯ç»“æ„ä½“å˜é‡ä¸­çš„â€œæœ€å¤§åŸºæœ¬æ•°æ®ç±»å‹æˆå‘˜æ‰€å å­—èŠ‚æ•°â€çš„æ•´æ•°å€ã€‚è®¡ç®—sizeofæ—¶ï¼Œé¦–åœ°å€é»˜è®¤ä¸º0ï¼Œæ‰€ä»¥æ»¡è¶³ç›¸å¯¹é¦–åœ°å€å¯æ•´é™¤ã€‚\n2. ç»“æ„ä½“å˜é‡ä¸­ï¼Œç›¸å¯¹äº**ç»“æ„ä½“é¦–åœ°å€**ï¼Œ**æ¯ä¸ªæˆå‘˜**çš„**åç§»é‡**ï¼Œéƒ½æ˜¯**æˆå‘˜æœ¬èº«åŸºæœ¬æ•°æ®ç±»å‹**æ‰€å å­—èŠ‚æ•°çš„æ•´æ•°å€ã€‚æˆ‘ä»¬å¯ä»¥ä¾æ¬¡ä»ä¸Šåˆ°ä¸‹ç´¯è®¡å·²è®¡ç®—çš„å¤§å°ï¼Œå†çœ‹ä¸‹ä¸€æŸä½ç½®æ˜¯å¦æ˜¯å…¶æ•´æ•°å€ã€‚\n3. ç»“æ„ä½“å˜é‡çš„æ€»å¤§å°ï¼Œä¸ºç»“æ„ä½“å˜é‡ä¸­ â€œæœ€å¤§**åŸºæœ¬æ•°æ®ç±»å‹**æˆå‘˜æ‰€å å­—èŠ‚æ•°â€çš„æ•´æ•°å€ã€‚\n\n## #pragma packæŒ‡å®šå¯¹é½å€¼\n\né¢„å¤„ç†æŒ‡ä»¤#pragma pack(n) å¯ä»¥æ”¹å˜é»˜è®¤å¯¹é½æ•°ã€‚n å–å€¼æ˜¯ 1, 2, 4, 8 , 16ã€‚\nvs ä¸­é»˜è®¤å€¼ = 8ï¼Œgcc ä¸­é»˜è®¤å€¼ = 4ï¼›\n\n```c\n#pragma pack(1)\nstruct node\n{\n    char cha;\n    double dx;\n    char chb;\n};\n//è‹¥( )å†…ä¸º1->size:10;\n//\t\tä¸º2->\t12;\n//\t\tä¸º4->\t16;\n//\t\tä¸º8->\t24;\n//\t\tä¸º16->\t24;\n#pragma pack\n```\n\n## åŠ å…¥æŒ‡å®šå¯¹é½æ–¹å¼çš„ç»ˆææ€»ç»“\n\n1. ç»“æ„ä½“å˜é‡çš„é¦–åœ°å€ï¼Œå¿…é¡»æ˜¯MIN{â€œç»“æ„ä½“**æœ€å¤§åŸºæœ¬æ•°æ®ç±»å‹æˆå‘˜**æ‰€å å­—èŠ‚æ•°â€, æŒ‡å®šå¯¹é½æ–¹å¼}çš„æ•´æ•°å€ã€‚\n2. ç»“æ„ä½“ä¸­ï¼Œç›¸å¯¹äºç»“æ„ä½“é¦–åœ°å€ï¼Œæ¯ä¸ªæˆå‘˜çš„åç§»é‡ï¼Œéƒ½æ˜¯MIN{è¯¥åŸºæœ¬æ•°æ®ç±»å‹æˆå‘˜, æŒ‡å®šå¯¹é½æ–¹å¼}çš„æ•´æ•°å€ã€‚\n3. ç»“æ„ä½“çš„æ€»å¤§å°ï¼Œä¸ºMIN{ç»“æ„ä½“æœ€å¤§åŸºæœ¬æ•°æ®ç±»å‹æˆå‘˜æ‰€å å­—èŠ‚æ•°, æŒ‡å®šå¯¹é½æ–¹å¼}çš„æ•´æ•°å€ã€‚\n\n# 2\n\nå®ç°ä¸€ä¸ªå®ï¼Œè®¡ç®—ç»“æ„ä½“æˆå‘˜çš„ç›¸å¯¹åç§»é‡ã€‚\n\n```c\n#define offset(type,member) (int)&( ( (type*)0 ) ->member)\n```\n\n# 3\n\nç»“æ„ä½“å’Œå…±ç”¨ä½“çš„åŒºåˆ«ã€‚\n\nç„¶åè®©ä½ åˆ¤æ–­å¤§å°ç«¯æˆ–è€…å¯¹æ•°æ®è½¬æ¢\n\n# 4\n\nç¼–å†™ç¨‹åºå®Œæˆï¼Œintå˜é‡çš„å°ç«¯å­˜å‚¨è½¬æ¢æˆå¤§ç«¯å­˜å‚¨ã€‚\n\n# 5\n\nè¯´ä¸€ä¸‹ç”¨æˆ·å­˜å‚¨ç©ºé—´éƒ½æœ‰å“ªå‡ ä¸ªåŒºæ„æˆï¼Ÿå›ç­”ä¸€ä¸‹ï¼Œæ ˆåŒºå’Œå †åŒºçš„åŒºåˆ«ã€‚\n\nä»£ç åŒºã€æ•°æ®åŒºã€å †åŒºã€æ ˆåŒº\n\n1) ç®¡ç†æ–¹å¼ï¼šæ ˆç”±ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†ï¼›å †ç”±ç¨‹åºå‘˜æ§åˆ¶ï¼Œä½¿ç”¨æ–¹ä¾¿ï¼Œä½†æ˜“äº§ç”Ÿå†…å­˜æ³„éœ²ã€‚\n2) ç”Ÿé•¿æ–¹å‘ï¼šæ ˆå‘ä½åœ°å€æ‰©å±•(å³â€å‘ä¸‹ç”Ÿé•¿â€)ï¼Œæ˜¯è¿ç»­çš„å†…å­˜åŒºåŸŸï¼›å †å‘é«˜åœ°å€æ‰©å±•(å³â€å‘ä¸Šç”Ÿé•¿â€)ï¼Œæ˜¯ä¸è¿ç»­çš„å†…å­˜åŒºåŸŸã€‚è¿™æ˜¯ç”±äºå †åŒºç®¡ç†ç³»ç»Ÿç”¨é“¾è¡¨æ¥å­˜å‚¨ç©ºé—²å†…å­˜åœ°å€ï¼Œè‡ªç„¶ä¸è¿ç»­ï¼Œè€Œé“¾è¡¨ä»ä½åœ°å€å‘é«˜åœ°å€éå†ã€‚\n3) ç©ºé—´å¤§å°ï¼šæ ˆé¡¶åœ°å€å’Œæ ˆçš„æœ€å¤§å®¹é‡ç”±ç³»ç»Ÿé¢„å…ˆè§„å®š(é€šå¸¸é»˜è®¤1M æˆ–10M)ï¼›å †çš„å¤§å°åˆ™å—é™äºè®¡ç®—æœºç³»ç»Ÿä¸­æœ‰æ•ˆçš„è™šæ‹Ÿå†…å­˜ï¼Œ32 ä½Linux ç³»ç»Ÿä¸­å †å†…å­˜å¯è¾¾2.9G ç©ºé—´ã€‚\n4) å­˜å‚¨å†…å®¹ï¼š\n    1) æ ˆåœ¨å‡½æ•°è°ƒç”¨æ—¶ï¼Œé¦–å…ˆå‹å…¥æ˜¯å‡½æ•°å®å‚ï¼Œç„¶åä¸»è°ƒå‡½æ•°ä¸­ä¸‹æ¡æŒ‡ä»¤(å‡½æ•°è°ƒç”¨è¯­å¥çš„ä¸‹æ¡å¯æ‰§è¡Œè¯­å¥)çš„åœ°å€å‹å…¥ï¼Œæœ€åæ˜¯è¢«è°ƒå‡½æ•°çš„å±€éƒ¨å˜é‡ã€‚æœ¬æ¬¡è°ƒç”¨ç»“æŸåï¼Œå±€éƒ¨å˜é‡å…ˆå‡ºæ ˆï¼ŒæŒ‡ä»¤åœ°å€å‡ºæ ˆï¼Œæœ€åæ ˆå¹³è¡¡ï¼Œç¨‹åºç”±è¯¥ç‚¹ç»§ç»­è¿è¡Œä¸‹æ¡å¯æ‰§è¡Œè¯­å¥ã€‚\n    2) å †é€šå¸¸åœ¨å¤´éƒ¨ç”¨ä¸€ä¸ªå­—èŠ‚å­˜æ”¾å…¶å¤§å°ï¼Œå †ç”¨äºå­˜å‚¨ç”Ÿå­˜æœŸä¸å‡½æ•°è°ƒç”¨æ— å…³çš„æ•°æ®ï¼Œå…·ä½“å†…å®¹ç”±ç¨‹åºå‘˜å®‰æ’ã€‚\n5) åˆ†é…æ–¹å¼ï¼š\n    1) æ ˆå¯é™æ€åˆ†é…æˆ–åŠ¨æ€åˆ†é…ã€‚é™æ€åˆ†é…ç”±ç¼–è¯‘å™¨å®Œæˆï¼Œå¦‚å±€éƒ¨å˜é‡çš„åˆ†é…ã€‚åŠ¨æ€åˆ†é…ç”±allocå‡½æ•°åœ¨æ ˆä¸Šç”³è¯·ç©ºé—´ï¼Œç”¨å®Œåè‡ªåŠ¨é‡Šæ”¾ä¸éœ€è¦è°ƒåŠ¨freeå‡½æ•°ã€‚\n    2) å †åªèƒ½åŠ¨æ€åˆ†é…ä¸”æ‰‹å·¥é‡Šæ”¾ã€‚\n6) åˆ†é…æ•ˆç‡ï¼š\n    1) æ ˆç”±è®¡ç®—æœºåº•å±‚æä¾›æ”¯æŒï¼šåˆ†é…ä¸“é—¨çš„å¯„å­˜å™¨å­˜æ”¾æ ˆåœ°å€ï¼Œå‹æ ˆå‡ºæ ˆç”±ä¸“é—¨çš„æŒ‡ä»¤æ‰§è¡Œï¼Œå› æ­¤æ•ˆç‡è¾ƒé«˜ã€‚\n    2) å †ç”±å‡½æ•°åº“æä¾›ï¼Œæœºåˆ¶å¤æ‚ï¼Œæ•ˆç‡æ¯”æ ˆä½å¾—å¤šã€‚\n7) åˆ†é…åç³»ç»Ÿå“åº”ï¼š\n    1) åªè¦æ ˆå‰©ä½™ç©ºé—´å¤§äºæ‰€ç”³è¯·ç©ºé—´ï¼Œç³»ç»Ÿå°†ä¸ºç¨‹åºæä¾›å†…å­˜ï¼Œå¦åˆ™æŠ¥å‘Šå¼‚å¸¸æç¤ºæ ˆæº¢å‡ºã€‚\n    2) æ“ä½œç³»ç»Ÿä¸ºå †ç»´æŠ¤ä¸€ä¸ªè®°å½•ç©ºé—²å†…å­˜åœ°å€çš„é“¾è¡¨ã€‚å½“ç³»ç»Ÿæ”¶åˆ°ç¨‹åºçš„å†…å­˜åˆ†é…ç”³è¯·æ—¶ï¼Œä¼šéå†è¯¥é“¾è¡¨å¯»æ‰¾ç¬¬ä¸€ä¸ªç©ºé—´å¤§äºæ‰€ç”³è¯·ç©ºé—´çš„å †ç»“ç‚¹ï¼Œç„¶åå°†è¯¥ç»“ç‚¹ä»ç©ºé—²ç»“ç‚¹é“¾è¡¨ä¸­åˆ é™¤ï¼Œå¹¶å°†è¯¥ç»“ç‚¹ç©ºé—´åˆ†é…ç»™ç¨‹åºã€‚è‹¥æ— è¶³å¤Ÿå¤§å°çš„ç©ºé—´(å¯èƒ½ç”±äºå†…å­˜ç¢ç‰‡å¤ªå¤š)ï¼Œæœ‰å¯èƒ½è°ƒç”¨ç³»ç»ŸåŠŸèƒ½å»å¢åŠ ç¨‹åºæ•°æ®æ®µçš„å†…å­˜ç©ºé—´ï¼Œä»¥ä¾¿æœ‰æœºä¼šåˆ†åˆ°è¶³å¤Ÿå¤§å°çš„å†…å­˜ï¼Œç„¶åè¿›è¡Œè¿”å›ã€‚å¤§å¤šæ•°ç³»ç»Ÿä¼šåœ¨è¯¥å†…å­˜ç©ºé—´é¦–åœ°å€å¤„è®°å½•æœ¬æ¬¡åˆ†é…çš„å†…å­˜å¤§å°ï¼Œä¾›åç»­çš„é‡Šæ”¾å‡½æ•°(å¦‚free/delete)æ­£ç¡®é‡Šæ”¾æœ¬å†…å­˜ç©ºé—´ã€‚\n    3) æ­¤å¤–ï¼Œç”±äºæ‰¾åˆ°çš„å †ç»“ç‚¹å¤§å°ä¸ä¸€å®šæ­£å¥½ç­‰äºç”³è¯·çš„å¤§å°ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°†å¤šä½™çš„éƒ¨åˆ†é‡æ–°æ”¾å…¥ç©ºé—²é“¾è¡¨ä¸­ã€‚\n8) ç¢ç‰‡é—®é¢˜ï¼š\n    1) æ ˆä¸ä¼šå­˜åœ¨ç¢ç‰‡é—®é¢˜ï¼Œå› ä¸ºæ ˆæ˜¯å…ˆè¿›åå‡ºçš„é˜Ÿåˆ—ï¼Œå†…å­˜å—å¼¹å‡ºæ ˆä¹‹å‰ï¼Œåœ¨å…¶ä¸Šé¢çš„åè¿›çš„æ ˆå†…å®¹å·²å¼¹å‡ºã€‚\n    2) è€Œé¢‘ç¹ç”³è¯·é‡Šæ”¾æ“ä½œä¼šé€ æˆå †å†…å­˜ç©ºé—´çš„ä¸è¿ç»­ï¼Œä»è€Œé€ æˆå¤§é‡ç¢ç‰‡ï¼Œä½¿ç¨‹åºæ•ˆç‡é™ä½ã€‚\n    3) å¯è§ï¼Œå †å®¹æ˜“é€ æˆå†…å­˜ç¢ç‰‡ï¼›ç”±äºæ²¡æœ‰ä¸“é—¨çš„ç³»ç»Ÿæ”¯æŒï¼Œæ•ˆç‡å¾ˆä½ï¼›ç”±äºå¯èƒ½å¼•å‘ç”¨æˆ·æ€å’Œå†…æ ¸æ€åˆ‡æ¢ï¼Œå†…å­˜ç”³è¯·çš„ä»£ä»·æ›´ä¸ºæ˜‚è´µã€‚æ‰€ä»¥æ ˆåœ¨ç¨‹åºä¸­åº”ç”¨æœ€å¹¿æ³›ï¼Œå‡½æ•°è°ƒç”¨ä¹Ÿåˆ©ç”¨æ ˆæ¥å®Œæˆï¼Œè°ƒç”¨è¿‡ç¨‹ä¸­çš„å‚æ•°ã€è¿”å›åœ°å€ã€æ ˆåŸºæŒ‡é’ˆå’Œå±€éƒ¨å˜é‡ç­‰éƒ½é‡‡ç”¨æ ˆçš„æ–¹å¼å­˜æ”¾ã€‚æ‰€ä»¥ï¼Œå»ºè®®å°½é‡ä½¿ç”¨æ ˆï¼Œ**ä»…åœ¨åˆ†é…å¤§é‡æˆ–å¤§å—å†…å­˜ç©ºé—´æ—¶ä½¿ç”¨å †**ã€‚\n    4) æœ€åä½¿ç”¨æ ˆå’Œå †æ—¶åº”é¿å…è¶Šç•Œå‘ç”Ÿï¼Œå¦åˆ™å¯èƒ½ç¨‹åºå´©æºƒæˆ–ç ´åç¨‹åºå †ã€æ ˆç»“æ„ï¼Œäº§ç”Ÿæ„æƒ³ä¸åˆ°çš„åæœã€‚\n# 6\n\nä»£ç å®ç°æ‰“å°Nè¡Œæ¨è¾‰ä¸‰è§’ã€‚ä¸å¾—ä½¿ç”¨äºŒç»´æ•°ç»„ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ç»´æ•°ç»„ã€‚\n\n```c\nint ar[100] = { 0,1 };\t//åˆå§‹åŒ–æ•°ç»„\nint n, i, j;\nint l, r;\t//å­˜æ”¾ä¸Šä¸€å±‚å·¦è¾¹çš„æ•°å’Œå³è¾¹çš„æ•°\nn = 10;\t\t//å±‚æ•°\nfor (i = 1; i <= n; i++)\n{\n    l = 0;\n    for (j = 1; j <= i; j++)\n    {\n        r = ar[j];\t\t\t\t//é¢è¯•é¢˜ç©ºç™½å¤„\n        ar[j] = l + r;\t\t\t//é¢è¯•é¢˜ç©ºç™½å¤„\n        printf(\"%-4d\", ar[j]);\n        l = r;\n    }\n    printf(\"\\n\");\n}\n```\n\n\n\n# 7\n\nå¿«æ’ï¼Œå †æ’ï¼Œå½’å¹¶æ’åºï¼Œä»»é€‰ä¸€é“å®ç°ä»£ç ã€‚\n\n# 8\n\nè°ˆè°ˆé¡ºåºè¡¨å’Œé“¾è¡¨çš„åŒºåˆ«ï¼Œä»¥åŠé€‚ç”¨çš„åœºæ™¯ã€‚\n\n# 9\n\nå®ç°ä¸å¸¦å¤´èŠ‚ç‚¹å•é“¾è¡¨çš„é€†ç½®ã€‚\n\n","categories":["é¢è¯•ç»éªŒ"]},{"title":"Cpp_Mstring_è¿­ä»£å™¨","url":"/Cpp/Cpp_Mstring_è¿­ä»£å™¨/","content":"# è¿­ä»£å™¨\n\nå¯ä»¥ç†è§£ä¸ºï¼ŒæŒ‡å‘å®¹å™¨å†…éƒ¨æ•°æ®çš„ä¸€ä¸ªæŒ‡é’ˆã€‚æœ¬è´¨æ˜¯å¯¹è±¡ã€‚\n\n```cpp\n#include<vector>\nint main()\n{\n    vector<int> v1;\n    for(int i = 0;i<10;i++)\n    {\n        v1.push_back(i);\n    }\n    vector<int>::iterator it1 = v1.begin();\n    for(;it1!=v1.end();it1++)\n    {\n        cout << \n    }\n}\n```\n\n# Mstring_iterator\n\n```cpp\n//mstring_iterator.h\n//begin end insert erase\n#ifndef MSTRING_ITERATOR_H\n#define MSTRING_ITERATOR_H\nclass Mstring;\n\nclass Mstring_iterator\n{\npublic:\n\tMstring_iterator(Mstring& mstr, int pos)\n        :_mstr(mstr), _pos(_pos)\n    {\n        \n    }\n    Mstring_iterator(const Mstring_iterator& src)\n        :_mstr(src._mstr), _pos(src._pos)\n    {\n        \n    }\n    Mstring_iterator& operator=(const Mstring_iterator& src)\n    {\n        if(&_mstr != &src._mstr)\n        {\n            return *this;\n        }\n        _pos = src._pos;\n        return *this;\n    }\n    \n    bool operator !=(const Mstring_iterator& src)\n    {\n        if(&_mstr != &src._mstr || _pos != src._pos)//ä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–æ²¡æœ‰æŒ‡å‘åŒä¸€ä½ç½®\n        {\n            return true;\n        }\n        return false;\n    }\n    bool operator ==(const Mstring_iterator& src)\n    {\n        if(&_mstr == &src._mstr && _pos == src._pos)//ä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–æ²¡æœ‰æŒ‡å‘åŒä¸€ä½ç½®\n        {\n            return true;\n        }\n        return false;\n    }\n    Mstring_iterator& operator++()\n    {\n        _pos++;\n        return *this;\n    }\n    Mstring_iterator operator++(int)\n    {\n        int pos = _pos;\n        _pos++;\n        return Mstring_iterator(_mstr,pos);\n    }\n\n    Mstring_iterator& operator--()\n    {\n        _pos--;\n        return *this;\n    }\n    Mstring_iterator operator--(int)\n    {\n        int pos = _pos;\n        _pos--;\n        return Mstring_iterator(_mstr,pos);\n    }\n\n    char& operator*();//ç”±äº[]é‡è½½åœ¨æœ¬æ–‡ä»¶ä¸å¯è§ï¼Œåˆ™åœ¨è¿™é‡Œå®ç°ä¸å¯ç¼–è¯‘ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨mstring.cppè¿›è¡Œç±»å¤–å®ç°ã€‚\nprivate:\n    Mstring& _mstr;\n    int _pos;\n}\n```\n\n# Mstring\n\n```cpp\n//mstring.h\n#ifndef MSTRING_H\n#define MSTRING_H\n#include<iostream>\n#include\"mstring_iterator.h\"\n#include<mutex>\nusing namespace std;\n\n#define MSTRING_MORE_SIZE sizeof(int)\n#define DEFEALT_LEN (10+MSTRING_MORE_SIZE)\n\nclass Mstring\n{\npublic:\n\ttypedef Mstring_iterator iterator;\n\tMstring(const char* str = NULL);\n\tMstring(const Mstring& src);\n\tMstring& operator=(const Mstring& src);\n\t~Mstring();\n\n\tvoid push_back(char c);\n\tvoid pop_back();\n\tchar back()const;\n\tchar front()const;\n\tbool empty()const;\n\tint size()const;\n\n\tMstring operator+(const Mstring& str)const;\n\tchar& operator[](int pos);\n\tchar operator[](int pos)const;\n\n\titerator begin();\n\titerator end();\n\tvoid insert(iterator it, char val);\n\tvoid erase(iterator it);\n\n\tfriend ostream& operator<<(ostream& out, const Mstring& src);\n\tfriend istream& operator>>(istream& in, Mstring& src);\nprivate:\n\tbool full()const;\n\tvoid expand();\n\tvoid init_num();\n\tint& get_num();\n\tint get_num()const;\n\tconst char* get_str_begin()const;\n\tchar* get_str_begin();\n\tvoid write_copy();\n\tint down_num();//å¼•ç”¨è®¡æ•°-1\n\tint up_num();//å¼•ç”¨è®¡æ•°+1\n\n\tchar* _str;//èƒ½å¦ç›´æ¥ä½¿ç”¨æµ…æ‹·è´------æ€ä¹ˆåŠ å¼•ç”¨è®¡æ•°\n\tint _len;//å½“å‰ç©ºé—´æ€»é•¿åº¦\n\tint _val_len;//å·²ç»å ç”¨çš„é•¿åº¦ï¼Œå®é™…æ•°æ®æ•°é‡\n\t//static mutex* _lock;\n};\n\n#endif\n```\n\n# mstring.cpp\n\n```cpp\n#include\"mstring.h\"\n\nmutex* Mstring::_lock = new mutex();\n\nMstring::Mstring(const char* str)\n{\n\tif (NULL == str)\n\t{\n\t\t_len = DEFEALT_LEN;\n\t\t_val_len = 0;\n\t\t_str = new char[_len];\n\t\tmemset(_str, 0, _len);\n\t\tinit_num();\n\t\treturn;\n\t}\n\n\t_val_len = strlen(str);\n\n\t//åŠ ä¸Šå¼•ç”¨è®¡æ•°å çš„ç©ºé—´\n\t_len = _val_len + 1 + MSTRING_MORE_SIZE;\n\t_str = new char[_len];\n\tmemset(_str, 0, _len);\n\n\tfor (int i = 0; i < _val_len; i++)\n\t{\n\t\tget_str_begin()[i] = str[i];\n\t}\n\tinit_num();\n}\n\nMstring::Mstring(const Mstring& src)\n{\n\t_val_len = src._val_len;\n\t_len = src._len;\n\t_str = src._str;\n\t//è®©å¼•ç”¨è®¡æ•°+1\n\tup_num();\n}\n\nMstring& Mstring::operator=(const Mstring& src)\n{\n\tif (&src == this)\n\t{\n\t\treturn *this;\n\t}\n\t_val_len = src._val_len;\n\t_len = src._len;\n\t_str = src._str;\n\tup_num();\n\n\treturn *this;\n}\n\nMstring::~Mstring()\n{\n\t//å°†å¼•ç”¨è®¡æ•°-1\n\tdown_num();\n\n\t//æŸ¥çœ‹å½“å‰æ˜¯å¦è¿˜æœ‰äººå¼•ç”¨\n\tif (0 == get_num())\n\t{\n\t\tdelete[]_str;\n\t}\n}\n\nvoid Mstring::push_back(char c)\n{\n\t//åˆ¤æ–­æ˜¯å¦ä¸€ä¸ªäººç‹¬æœ‰\n\tif (get_num() > 1)\n\t{\n\t\t//å†™æ—¶æ‹·è´ï¼Œç»™åˆ†é…ç‹¬æœ‰çš„ç©ºé—´\n\t\twrite_copy();\n\t}\n\n\tif (full())\n\t{\n\t\texpand();\n\t}\n\n\tget_str_begin()[_val_len] = c;\n\t_val_len++;\n}\n\nvoid Mstring::pop_back()\n{\n\tif (get_num() > 1)\n\t{\n\t\twrite_copy();\n\t}\n\n\tif (empty())\n\t{\n\t\treturn;\n\t}\n\n\t_val_len--;\n}\n\nchar Mstring::back()const\n{\n\tif (empty())\n\t{\n\t\treturn 0;\n\t}\n\n\treturn get_str_begin()[_val_len - 1];\n}\n\nchar Mstring::front()const\n{\n\tif (empty())\n\t{\n\t\treturn 0;\n\t}\n\n\treturn get_str_begin()[0];\n}\n\nbool Mstring::empty()const\n{\n\treturn _val_len == 0;\n}\n\nMstring Mstring::operator+(const Mstring& str)const\n{\n\tchar* p;\n\tint len = _val_len + str._val_len + 1;\n\tp = new char[len];\n\tmemset(p, 0, len);\n\n\t//è¿›è¡Œæ•°æ®æ‹·è´-----å°†ä¸¤ä¸ªå­—ç¬¦ä¸²çš„æ•°æ®æ‹¼æ¥èµ·æ¥\n\tint i = 0;\n\tfor (; i < _val_len; i++)\n\t{\n\t\tp[i] = get_str_begin()[i];\n\t}\n\n\tfor (int j = 0; j < str._val_len; j++, i++)\n\t{\n\t\tp[i] = str.get_str_begin()[j];\n\t}\n\n\treturn p;\n}\n\nchar& Mstring::operator[](int pos)\n{\n\tif (get_num() > 1)\n\t{\n\t\twrite_copy();\n\t}\n\treturn  get_str_begin()[pos];\n}\n\nchar Mstring::operator[](int pos)const\n{\n\treturn  get_str_begin()[pos];\n}\n\nbool Mstring::full()const\n{\n\treturn _val_len == _len - 1 - MSTRING_MORE_SIZE;\n}\n\nvoid Mstring::expand()\n{\n\tif (get_num() > 1)\n\t{\n\t\twrite_copy();\n\t}\n\n\t_len = _len << 1;\n\n\tchar* p = new char[_len];\n\tmemset(p, 0, _len);\n\n\tfor(int i = 0;i<_val_len+MSTRING_MORE_SIZE;i++)\n\t{\n\t\tp[i] = _str[i];\n\t}\n\n\tif (down_num() == 0)\n\t{\n\t\tdelete[]_str;\n\t}\n\n\t_str = p;\n}\n\nint Mstring::size()const\n{\n\treturn _val_len;\n}\n\n//åˆå§‹åŒ–å¼•ç”¨è®¡æ•°\nvoid Mstring::init_num()\n{\n\tget_num() = 1;\n}\n\n//è·å–å¼•ç”¨è®¡æ•°\nint& Mstring::get_num()\n{\n\treturn *((int*)_str);\n}\n\n//å¼•ç”¨è®¡æ•°-1\nint Mstring::down_num()\n{\n\t_lock->lock();\n\tint num = --get_num();\n\t_lock->unlock();\n\treturn num;\n}\n\n//å¼•ç”¨è®¡æ•°+1\nint Mstring::up_num()\n{\n\t//get_lock()->lock();\n\t_lock->lock();\n\t/*\n\twhile(1)\n\t{\n\t\tif(_lock->a == 0)\n\t\t{\n\t\t\t_lock->a = 1;\n\t\t\tbreak;\n\t\t}\n\t\tsleep(10);\n\t}\n\t\n\t*/\n\tint num = ++get_num();\n\t_lock->unlock();\n\t/*\n\t_lock->a = 0;\n\t*/\n\n\treturn num;\n}\n\n\n//è·å–å¼•ç”¨è®¡æ•°\nint Mstring::get_num()const\n{\n\treturn *((int*)_str);\n}\n\n//è·å–å­—ç¬¦ä¸²çš„å¼€å¤´æŒ‡é’ˆ\nchar* Mstring::get_str_begin()\n{\n\treturn _str + MSTRING_MORE_SIZE;\n}\n\n//è·å–å­—ç¬¦ä¸²çš„å¼€å¤´æŒ‡é’ˆ\nconst char* Mstring::get_str_begin()const\n{\n\treturn _str + MSTRING_MORE_SIZE;\n}\n\n//å†™æ—¶æ‹·è´\nvoid Mstring::write_copy()\n{\n\tchar* p = new char[_len];\n\n\t//å°†æ‰€æœ‰çš„æ•°æ®å…¨éƒ¨æ‹·è´è¿‡æ¥\n\tfor (int i = 0; i < _len; i++)\n\t{\n\t\tp[i] = _str[i];\n\t}\n\n\t//æ”¹å˜åŸæ¥æŒ‡å‘çš„å†…å­˜çš„å¼•ç”¨è®¡æ•°\n\tif (0 == down_num())\n\t{\n\t\tdelete[]_str;\n\t}\n\n\t//å°†å½“å‰å¼•ç”¨è®¡æ•°æ”¹ä¸º1\n\t_str = p;\n\tinit_num();\n}\n\nostream& operator<<(ostream& out, const Mstring& src)\n{\n\tfor (int i = 0; i < src.size(); i++)\n\t{\n\t\tout << src.get_str_begin()[i];\n\t}\n\tout << \"     :::::num:::\" << src.get_num();\n\tout << endl;\n\treturn out;\n}\n\nistream& operator>>(istream& in, Mstring& src)\n{\n\tif (src.get_num() > 1)\n\t{\n\t\tsrc.write_copy();\n\t}\n\n\tchar tmp[1024];\n\tin >> tmp;\n\t\n\tsrc = tmp;\n\treturn in;\n}\n\n////////////////////////////////è¿­ä»£å™¨\n\niterator Mstring::begin()\n{\n    return iterator(*this, 0);\n}\n\niterator Mstring::end()\n{\n    return iterator(*this, _val_len);\n}\niterator Mstring::insert(iterator it, char val) \n{\n    //åˆ¤æ–­æ˜¯å¦ç‹¬æœ‰\n    if (get_num() > 1)\n    {\n        write_copy();\n    }\n\n    //æ‰©å®¹\n    if (full())\n    {\n        expand();\n    }\n\n    iterator it1 = end();\n    iterator it2 = it1 - 1;\n\n    for (; it1 != it; it1--, it2--)\n    {\n        *it1 = *it2;\n    }\n    *it = val;\n    _val_len++;\n\n    return it;\n}\niterator Mstring::erase(iterator it)\n{\n    //åˆ¤æ–­æ˜¯å¦ç‹¬æœ‰\n    if (get_num() > 1)\n    {\n        write_copy();\n    }\n\n    //åˆ¤ç©º\n    if (empty())\n    {\n        return it;\n    }\n\n    iterator it1 = it;\n    iterator it2 = it + 1;\n    for (; it2 != end(); it1++, it2++)\n    {\n        *it1 = *it2;\n    }\n\n    _val_len--;\n    return it;\n}\n\n\nchar& Mstring_iterator::operator*()\n{\n\treturn _mstr[_pos];\n}\n```\n\n# test\n\n```cpp\nint main()\n{\n    Mstring s1 = \"123456\";\n    Mstring::iterator it = s1.begin();\n    for(; it != s1.end(); it++)\n    {\n        cout << *it << \" \";\n        \n    }\n    cout << endl;\n}\n```\n\n# vector\n\né€šè¿‡è¿­ä»£å™¨è¿›è¡Œå¢åˆ æ”¹æŸ¥ã€‚\n\n# åˆ†ç±»\n\n1. é¡ºåºè¿­ä»£å™¨\n    1. `iterator`æ˜¯æ­£å‘è¿­ä»£å™¨\n    2. `reverse_iterator`æ˜¯åå‘è¿­ä»£å™¨\n    3. `const_iterator`æ˜¯å¸¸é‡æ­£å‘è¿­ä»£å™¨\n    4. `const_reverse_iterator`æ˜¯å¸¸é‡åå‘è¿­ä»£å™¨\n2. æ’å…¥å‹è¿­ä»£å™¨\n    1. `insert_iterator`æ˜¯éšæœºæ’å…¥è¿­ä»£å™¨ï¼Œå†…éƒ¨è°ƒç”¨çš„æ˜¯`insert`\n    2. `back_insert_iterator`æ˜¯å°¾æ’è¿­ä»£å™¨ï¼Œè°ƒç”¨çš„æ˜¯`push_back`\n    3. `front_insert_iterator`æ˜¯å¤´æ’è¿­ä»£å™¨ï¼Œè°ƒç”¨çš„æ˜¯`push_front`\n3. æµè¿­ä»£å™¨\n\n# é¡ºåºè¿­ä»£å™¨\n\n```cpp\n//æ­£å‘è¿­ä»£æ‰“å°\ntemplate<class T>\nvoid print(T & obj)\n{\n\ttypename T::iterator it = obj.begin();\n\tfor (; it != obj.end();it++)\n\t{\n\t\tcout << *it << \" \";\n\t}\n\tcout << endl;\n}\n//åå‘è¿­ä»£æ‰“å°\ntemplate<class T>\nvoid r_print(T& obj)\n{\n\ttypename T::reverse_iterator it = obj.rbegin();\n\tfor (;it != obj.rend();it++)\n\t{\n\t\tcout << *it << \" \";\n\t}\n\tcout << endl;\n}\n```\n\n","categories":["Cpp"]},{"title":"Cpp_new_deleteé‡è½½","url":"/Cpp/Cpp_new_deleteé‡è½½/","content":"# å†…å®¹\n\n# newçš„åŠ¨ä½œ\n\nnewæ˜¯å…³é”®å­—ã€‚å…¶å®æ˜¯new operatorï¼Œæœ¬èº«ä¸å¯é‡è½½ã€‚\n\n1. ç”³è¯·å†…å­˜\n    1. newç¬¬ä¸€æ­¥çš„ç”³è¯·å†…å­˜è°ƒç”¨çš„æ˜¯operator new(å¯çœ‹ä½œä¸€ä¸ªè¿ç®—ç¬¦å‡½æ•°)ï¼Œå¯ä»¥é‡è½½ã€‚\n2. è°ƒç”¨æ„é€ \n3. è¿”å›åœ°å€\n# deleteçš„åŠ¨ä½œ\n\ndeleteæ˜¯å…³é”®å­—ã€‚å…¶å®æ˜¯delete operatorï¼Œæœ¬èº«ä¸å¯é‡è½½ã€‚\n\n1. è°ƒç”¨ææ„\n2. å†…å­˜é‡Šæ”¾\n    1. deleteå†…å­˜é‡Šæ”¾è°ƒç”¨çš„æ˜¯operator delete(å¯çœ‹ä½œä¸€ä¸ªè¿ç®—ç¬¦å‡½æ•°)ï¼Œå¯ä»¥é‡è½½ã€‚\n# operator newé‡è½½\n```cpp\nvoid* operator new(size_t size)\n{\n    void* p = malloc(size);\n    cout << \"è°ƒç”¨äº†è‡ªå®šä¹‰operator new\" << endl;\n    return p;\n}\n```\n\næœ‰ä½•ä½œç”¨ï¼Ÿ\n\nå †ä¸Šå†…å­˜ï¼šå±äºæ˜¯å¤–éƒ¨èµ„æºã€‚\n\nç”³è¯·/é‡Šæ”¾å¤–éƒ¨èµ„æºï¼Œç”¨æˆ·æ€æ²¡æœ‰æƒé™è®¿é—®ï¼Œå†…æ ¸æ€æ‰æœ‰æƒé™ã€‚å¤–éƒ¨èµ„æºå¾ˆå¤šï¼Œæ¯”å¦‚æˆ‘ä»¬çš„é¼ æ ‡ã€é”®ç›˜ã€å±å¹•ã€‚\n\næˆ‘ä»¬ç”³è¯·/é‡Šæ”¾èµ„æºçš„è¿‡ç¨‹éœ€è¦å†…æ ¸æ€å®Œæˆï¼Œæ­¤æ—¶ï¼Œéœ€è¦ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œå†åš**ç³»ç»Ÿè°ƒç”¨**ã€‚\n\nå¹³æ—¶æ¥è§¦çš„ç³»ç»Ÿè°ƒç”¨æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼šcoutã€printfã€cinã€scanf\n\nåº”è¿è€Œç”Ÿï¼Œä¼šå‡ºç°å†…å­˜æ± çš„æ¦‚å¿µã€‚`C++`è‡ªå¸¦çš„å†…å­˜æ± ï¼š`_Alloc`\n\nå†…å­˜æ± æ˜¯ï¼šç”¨æˆ·æ€è‡ªå·±ç»´æŠ¤çš„**ä¸€å¤§æ®µ**å†…å­˜ã€‚\n\né‡è½½newå’Œdeleteç›¸å½“äºç•™ä¸‹äº†ä¸€ä¸ªå¯ä¿®æ”¹çš„ç«¯å£ï¼Œå¯ä»¥**è‡ªå®šä¹‰ç”³è¯·ã€é‡Šæ”¾å†…å­˜çš„åŠ¨ä½œ**ã€‚è¿™å°±æ˜¯é‡è½½newå’Œdeleteçš„æ„ä¹‰æ‰€åœ¨ã€‚\næ¯”å¦‚ï¼Œå¯ä»¥è‡ªå·±ç¼–å†™mallocæŠŠå†…å­˜åˆ†é…åˆ°æ˜¾å­˜ä¸­ã€‚é™¤äº†åœ¨æ”¹å˜åˆ†é…å†…å­˜çš„ä¸åŒè®¾å¤‡ï¼Œè¿˜å¯ä»¥åœ¨è¿™é‡Œé¢è¿›è¡Œå†…å­˜åˆ†é…åŠ¨ä½œçš„ç»Ÿè®¡ã€æ ‡è®°ç­‰ï¼Œå¸¸ç”¨äºæ¸¸æˆå¼€å‘ã€å†…å­˜æ± ã€‚\n\nä½†æ˜¯è¦çŸ¥é“ï¼Œ`C++`åªå…è®¸æŠŠåˆ†é…å†…å­˜çš„ä»»åŠ¡äº¤ç»™ç¨‹åºå‘˜è‡ªå®šä¹‰ï¼Œæ²¡æœ‰å¼€æ”¾åœ¨é‡è½½newä¸­è°ƒç”¨æ„é€ å‡½æ•°çš„æƒé™ã€‚\n# operator deleteé‡è½½\n\n```cpp\nvoid operator delete(void* p)\n{\n    cout << \"è°ƒç”¨äº†è‡ªå®šä¹‰operator delete\" << endl;\n    free(p);\n}\n```\n# \n```cpp\n#include<iostream>\nusing namespace std;\nclass Tmp\n{\npublic:\n\tTmp()\n\t{\n\t\tcout << \"Tmp()\" << endl;\n\t}\n\t~Tmp()\n\t{\n\t\tcout << \"~Tmp()\" << endl;\n\t}\n\tvoid* operator new(size_t size)\n\t{\n\t\tvoid* p = malloc(size);\n\t\tcout << \"è°ƒç”¨äº†operator new\" << endl;\n\t\treturn p;\n\t}\n\tvoid operator delete(void* p)\n\t{\n\t\tcout << \"è°ƒç”¨äº†operator delete\" << endl;\n\t\tfree(p);\n\t}\n};\nint main()\n{\n\tTmp* p = new Tmp();\n\n}\n```\n# ä½œä¸š\n\n1. mstringä¸‰ç§ï¼šæ™®é€šçš„ã€å†™æ—¶æ‹·è´çš„ã€è¿­ä»£å™¨çš„\n2. åˆ·é¢˜\n# åŒºåˆ«\n\n1. newæ˜¯å…³é”®å­—ã€‚mallocæ˜¯å‡½æ•°ï¼›\n```c++\nint * p = new int(10);\nint * s = (int*)malloc(sizeof(int));\n```\n2. newä¸éœ€è¦ç±»å‹è½¬æ¢ï¼Œmallocéœ€è¦å¼ºè½¬\n3. newè‡ªåŠ¨è®¡ç®—ç±»å‹å¤§å°ï¼Œmallocéœ€è¦sizeof\n4. newå…ˆmallocï¼Œå†æ„é€ ï¼Œå†è¿”å›æŒ‡é’ˆã€‚mallocåªç”³è¯·å†…å­˜\n5. ç”³è¯·ç©ºé—´å¤±è´¥æ—¶\n    1. newæŠ›å‡º`std::bad_malloc`\n    2. mallocè¿”å›NULL\n6. newå¯ä»¥ç”³è¯·ä¸€ç»„ï¼Œéœ€è¦`new[]`,`delete[]`ã€‚è€Œmallocå¿…é¡»æ‰‹åŠ¨æŒ‡æ˜å­—èŠ‚æ•°ï¼Œfreeä¸çŸ¥é“é‡Šæ”¾çš„æ˜¯ä¸æ˜¯ä¸€ç»„ã€‚\n7. å¯¹äºå†…ç½®ç±»å‹ã€PODç±»å‹ï¼Œnew/mallocå¯ä»¥æ··ç”¨ï¼›å¯¹äºè‡ªå®šä¹‰ç±»å‹èƒ½å¦æ··ç”¨ï¼Ÿä¸»è¦çœ‹ç±»å‹ä¸­æœ‰æ²¡æœ‰ææ„å‡½æ•°ï¼Œå¦‚æœæœ‰ï¼Œåœ¨`new[]`æ—¶ä¼šè®°å½•ç”³è¯·äº†å¤šå°‘å¯¹è±¡ï¼Œäºæ˜¯åœ¨`delete[]`æ—¶å¯ä»¥è‡ªåŠ¨æº¯æºã€‚\n8. newæ˜¯è¿ç®—ç¬¦ï¼Œå¯ä»¥è¿›è¡Œé‡è½½ï¼›mallocåˆ™ä¸è¡Œ\n9. newæœ‰ä¸‰ç§è°ƒç”¨æ–¹å¼ï¼›mallocæ²¡æœ‰\n10. newå¯ä»¥è®¾ç½®`nothrow`ä¸æŠ›å¼‚å¸¸ï¼Œè¿”å›NULL\n11. `set_new_handler`","categories":["Cpp"]},{"title":"Cpp_å°è£…BigNumå®ç°å¤§æ•°åŠ å‡","url":"/Cpp/Cpp_å°è£…BigNumå®ç°å¤§æ•°åŠ å‡/","content":"\n# bignum.h\n\n```cpp\n//bignum.h\n#pragma once\n#include<iostream>\nusing namespace std;\nclass BigNum\n{\npublic:\n\tBigNum();\n\tBigNum(int);\n\tBigNum(const char*);\n\tBigNum(string);\n\tBigNum(const BigNum& src);\n\tBigNum operator=(const BigNum& src);\n\tBigNum operator+(const BigNum& src);\n\tBigNum operator-(const BigNum& src);\n\n\tBigNum& operator++();\n\tBigNum operator++(int);\n\tBigNum& operator--();\n\tBigNum operator--(int);\n\n\tfriend ostream& operator<<(ostream& out, const BigNum& src);\n\tfriend istream& operator>>(istream& in, BigNum& des);\n\tfriend void show_bignum(BigNum& src);\nprivate:\n\tstring _num;\n};\n\n```\n\n# bignum.cpp\n\n```cpp\n//bignum.cpp\n#include\"bignum.h\"\n#include<string>\nint num_digits(int n)\n{\n\tint i = 0;\n\twhile (n != 0)\n\t{\n\t\ti++;\n\t\tn /= 10;\n\t}\n\treturn i;\n}\nint num_string(const char* s)\n{\n\tint i = 0;\n\tconst char* p = s;\n\twhile (*p != 0)\n\t{\n\t\ti++;\n\t\tp++;\n\t}\n\treturn i;\n}\nvoid swap(char* a, char* b)\n{\n\tchar tmp = *a;\n\t*a = *b;\n\t*b = tmp;\n}\nvoid reverse(char* s, int front, int tail)\n{\n\tfor (int i = front; i < (tail - front+1) / 2;++i)\n\t{\n\t\tswap(&s[i], &s[tail - front - i]);\n\t}\n\treturn;\n}\nvoid show_bignum(BigNum& src)\n{\n\tconst char* p = src._num.data();\n\tint n = src._num.length();\n\tfor (int i = n - 1;i >= 0;i--)\n\t{\n\t\tprintf(\"%c\", p[i]);\n\t}\n\tprintf(\"\\n\");\n}\nBigNum::BigNum()\n\t:_num()\n{\n\n}\nBigNum::BigNum(int n)\n{\n\tint i = num_digits(n);\n\tchar* tmp = new char[i+1];\n\t_itoa_s(n,tmp,i+1,10);\n\treverse(tmp, 0, i - 1);\n\t_num.append(tmp);\n}\nBigNum::BigNum(const char* s)\n{\n\tint i = num_string(s);\n\tchar* tmp = new char[i + 1];\n\tconst char* p = s;\n\ti = 0;\n\twhile (*p != 0)\n\t{\n\t\ttmp[i++] = *p++;\n\t}\n\ttmp[i] = 0;\n\treverse(tmp, 0, i - 1);\n\t_num.append(tmp);\n}\nBigNum::BigNum(string s)\n{\n\tint i = s.length();\n\tchar* tmp = new char[i + 1];\n\tconst char* p = s.data();\n\ti = 0;\n\twhile (*p != 0)\n\t{\n\t\ttmp[i++] = *p++;\n\t}\n\ttmp[i] = 0;\n\treverse(tmp, 0, i - 1);\n\t_num.append(tmp);\n}\nBigNum::BigNum(const BigNum& src)\n{\n\tint i = src._num.length();\n\tchar* tmp = new char[i + 1];\n\tconst char* p = src._num.data();\n\ti = 0;\n\twhile (*p != 0)\n\t{\n\t\ttmp[i++] = *p++;\n\t}\n\ttmp[i] = 0;\n\t//reverse(tmp, 0, i - 1);\n\t_num.append(tmp);\n}\nBigNum BigNum::operator=(const BigNum& src)\n{\n\tif (this == &src)\n\t{\n\t\treturn *this;\n\t}\n\t_num.clear();\n\t_num.append(src._num);\n\treturn *this;\n}\nBigNum BigNum::operator+(const BigNum& src)\n{\n\tint i = 0;\n\tstring long_s, short_s;\n\tif (_num.length() >= src._num.length())\n\t{\n\t\tlong_s = _num, short_s = src._num;\n\t}\n\telse\n\t{\n\t\tlong_s = src._num, short_s = _num;\n\t}\n\tconst char* p1 = long_s.data();\n\tconst char* p2 = short_s.data();\n\tchar* new_s = new char[long_s.length() + 1 + 1]();\n\tchar* p = new_s;\n\tint tmp_10 = 0;\n\twhile (*p1 != 0 && *p2 != 0)\n\t{\n\t\ttmp_10 = (*p1 & 15) + (*p2 & 15) + (*p & 15);\n\t\t*p = (tmp_10 % 10) | (0b00110000);\n\t\t*(p + 1) = (tmp_10 / 10) | (0b00110000);\n\t\tif (i == long_s.length() - 1)\n\t\t{\n\t\t\tif (*(p + 1) == (0 | (0b00110000)))\n\t\t\t{\n\t\t\t\t*(p + 1) = '\\0';\n\t\t\t}\n\t\t}\n\t\tp1++;\n\t\tp2++;\n\t\tp++;\n\t\ti++;\n\t}\n\twhile (i != long_s.length())\n\t{\n\t\ttmp_10 = (*p & 15) + (*p1 & 15);//p1ã€p2ä¸º\\0æˆ–æœ‰æ•ˆå€¼ï¼Œä¸å½±å“ç»“æœã€‚\n\t\t*p = (tmp_10 % 10)|(0b00110000);\n\t\t*(p + 1) = (tmp_10 / 10) | (0b00110000);\n\t\tif (i == long_s.length() - 1)\n\t\t{\n\t\t\tif (*(p + 1) == (0 | (0b00110000)))\n\t\t\t{\n\t\t\t\t*(p + 1) = '\\0';\n\t\t\t}\n\t\t}\n\t\tp1++;\n\t\tp++;\n\t\ti++;\n\t}\n\ti = new_s[long_s.length()] == '0' ? long_s.length() : long_s.length() + 1;\n\treverse(new_s, 0, i - 1);\n\treturn string(new_s);\n}\nBigNum BigNum::operator-(const BigNum& src)\n{\n\tint i = 0;\n\tstring long_s, short_s;\n\tif (_num.length() >= src._num.length())\n\t{\n\t\tlong_s = _num, short_s = src._num;\n\t}\n\telse\n\t{\n\t\tlong_s = src._num, short_s = _num;\n\t}\n\tconst char* p1 = long_s.data();\n\tconst char* p2 = short_s.data();\n\tchar* new_s = new char[long_s.length() + 1]();\n\tchar* p = new_s;\n\tint tmp_10 = 0;\n\tint tmp_2 = 0;\n\twhile (*p1 != 0 && *p2 != 0)\n\t{\n\t\ttmp_10 = (*p1 & 15) - (*p2 & 15) - (~(*p)+1);\n\t\t*p = ((tmp_10 + 10) % 10 ) | (0b00110000);\n\t\t*(p + 1) = ((tmp_10-9) / 10);\n\t\tif (i == long_s.length() - 1)\n\t\t{\n\t\t\tif (*(p + 1) == (0 | (0b00110000)))\n\t\t\t{\n\t\t\t\t*(p + 1) = '\\0';\n\t\t\t}\n\t\t}\n\t\tp1++;\n\t\tp2++;\n\t\tp++;\n\t\ti++;\n\t}\n\twhile (i != long_s.length())\n\t{\n\t\ttmp_10 = (*p1 & 15) - (~(*p) + 1);//p1ã€p2ä¸º\\0æˆ–æœ‰æ•ˆå€¼ï¼Œä¸å½±å“ç»“æœã€‚\n\t\t*p = ((tmp_10 + 10) % 10) | (0b00110000);\n\t\t*(p + 1) = ((tmp_10 - 9) / 10);\n\t\tif (i == long_s.length() - 1)\n\t\t{\n\t\t\tif (*(p + 1) == (0 | (0b00110000)))\n\t\t\t{\n\t\t\t\t*(p + 1) = '\\0';\n\t\t\t}\n\t\t}\n\t\tp1++;\n\t\tp++;\n\t\ti++;\n\t}\n\ti = new_s[long_s.length()-1] == '0' ? long_s.length()-1 : long_s.length();\n\tnew_s[i] = 0;\n\treverse(new_s, 0, i - 1);\n\treturn string(new_s);\n}\n\nBigNum& BigNum::operator++()\n{\n\tint i = 0;\n\tconst char* p1 = _num.data();\n\tchar* p = new char[_num.length()+2]();\n\tchar* new_s = p;\n\tint tmp = 0;\n\n\ttmp = (*p1 & 15) + ('1' & 15) + (*p & 15);\n\t*p = (tmp % 10) | (0b00110000);\n\t*(p + 1) = (tmp / 10) | (0b00110000);\n\tif (i == _num.length() - 1)\n\t{\n\t\tif (*(p + 1) == (0 | (0b00110000)))\n\t\t{\n\t\t\t*(p + 1) = '\\0';\n\t\t}\n\t}\n\tp1++;\n\tp++;\n\ti++;\n\n\twhile (i != _num.length())\n\t{\n\t\ttmp = (*p & 15) + (*p1 & 15);\n\t\t*p = (tmp % 10) | (0b00110000);\n\t\t*(p + 1) = (tmp / 10) | (0b00110000);\n\t\tif (i == _num.length() - 1)\n\t\t{\n\t\t\tif (*(p + 1) == (0 | (0b00110000)))\n\t\t\t{\n\t\t\t\t*(p + 1) = '\\0';\n\t\t\t}\n\t\t}\n\t\tp1++;\n\t\tp++;\n\t\ti++;\n\t}\n\ti = new_s[_num.length()] == '0' ? _num.length() : _num.length() + 1;\n\t_num.clear();\n\t_num.append(new_s);\n\treturn *this;\n}\nBigNum BigNum::operator++(int)\n{\n\tBigNum old = *this;\n\t\n\tint i = 0;\n\tconst char* p1 = _num.data();\n\tchar* p = new char[_num.length() + 2]();\n\tchar* new_s = p;\n\tint tmp = 0;\n\n\ttmp = (*p1 & 15) + ('1' & 15) + (*p & 15);\n\t*p = (tmp % 10) | (0b00110000);\n\t*(p + 1) = (tmp / 10) | (0b00110000);\n\tif (i == _num.length() - 1)\n\t{\n\t\tif (*(p + 1) == (0 | (0b00110000)))\n\t\t{\n\t\t\t*(p + 1) = '\\0';\n\t\t}\n\t}\n\tp1++;\n\tp++;\n\ti++;\n\n\twhile (i != _num.length())\n\t{\n\t\ttmp = (*p & 15) + (*p1 & 15);\n\t\t*p = (tmp % 10) | (0b00110000);\n\t\t*(p + 1) = (tmp / 10) | (0b00110000);\n\t\tif (i == _num.length() - 1)\n\t\t{\n\t\t\tif (*(p + 1) == (0 | (0b00110000)))\n\t\t\t{\n\t\t\t\t*(p + 1) = '\\0';\n\t\t\t}\n\t\t}\n\t\tp1++;\n\t\tp++;\n\t\ti++;\n\t}\n\ti = new_s[_num.length()] == '0' ? _num.length() : _num.length() + 1;\n\t_num.clear();\n\t_num.append(new_s);\n\n\treturn old;\n}\nBigNum& BigNum::operator--()\n{\n\tint i = 0;\n\tconst char* p1 = _num.data();\n\tchar* new_s = new char[_num.length() + 1]();\n\tchar* p = new_s;\n\tint tmp_10 = 0;\n\tint tmp_2 = 0;\n\n\ttmp_10 = (*p1 & 15) - ('1' & 15) - (~(*p) + 1);\n\t*p = ((tmp_10 + 10) % 10) | (0b00110000);\n\t*(p + 1) = ((tmp_10 - 9) / 10);\n\tif (i == _num.length() - 1)\n\t{\n\t\tif (*(p + 1) == (0 | (0b00110000)))\n\t\t{\n\t\t\t*(p + 1) = '\\0';\n\t\t}\n\t}\n\tp1++;\n\tp++;\n\ti++;\n\n\twhile (i != _num.length())\n\t{\n\t\ttmp_10 = (*p1 & 15) - (~(*p) + 1);//p1ã€p2ä¸º\\0æˆ–æœ‰æ•ˆå€¼ï¼Œä¸å½±å“ç»“æœã€‚\n\t\t*p = ((tmp_10 + 10) % 10) | (0b00110000);\n\t\t*(p + 1) = ((tmp_10 - 9) / 10);\n\t\tif (i == _num.length() - 1)\n\t\t{\n\t\t\tif (*(p + 1) == (0 | (0b00110000)))\n\t\t\t{\n\t\t\t\t*(p + 1) = '\\0';\n\t\t\t}\n\t\t}\n\t\tp1++;\n\t\tp++;\n\t\ti++;\n\t}\n\ti = new_s[_num.length() - 1] == '0' ? _num.length() - 1 : _num.length();\n\tnew_s[i] = 0;\n\t_num.clear();\n\t_num.append(new_s);\n\n\treturn *this;\n}\nBigNum BigNum::operator--(int)\n{\n\tBigNum old = *this;\n\n\tint i = 0;\n\tconst char* p1 = _num.data();\n\tchar* new_s = new char[_num.length() + 1]();\n\tchar* p = new_s;\n\tint tmp_10 = 0;\n\tint tmp_2 = 0;\n\n\ttmp_10 = (*p1 & 15) - ('1' & 15) - (~(*p) + 1);\n\t*p = ((tmp_10 + 10) % 10) | (0b00110000);\n\t*(p + 1) = ((tmp_10 - 9) / 10);\n\tif (i == _num.length() - 1)\n\t{\n\t\tif (*(p + 1) == (0 | (0b00110000)))\n\t\t{\n\t\t\t*(p + 1) = '\\0';\n\t\t}\n\t}\n\tp1++;\n\tp++;\n\ti++;\n\n\twhile (i != _num.length())\n\t{\n\t\ttmp_10 = (*p1 & 15) - (~(*p) + 1);//p1ã€p2ä¸º\\0æˆ–æœ‰æ•ˆå€¼ï¼Œä¸å½±å“ç»“æœã€‚\n\t\t*p = ((tmp_10 + 10) % 10) | (0b00110000);\n\t\t*(p + 1) = ((tmp_10 - 9) / 10);\n\t\tif (i == _num.length() - 1)\n\t\t{\n\t\t\tif (*(p + 1) == (0 | (0b00110000)))\n\t\t\t{\n\t\t\t\t*(p + 1) = '\\0';\n\t\t\t}\n\t\t}\n\t\tp1++;\n\t\tp++;\n\t\ti++;\n\t}\n\ti = new_s[_num.length() - 1] == '0' ? _num.length() - 1 : _num.length();\n\tnew_s[i] = 0;\n\t_num.clear();\n\t_num.append(new_s);\n\n\treturn *this;\n\n\treturn old;\n}\nostream& operator<<(ostream& out, const BigNum& src)\n{\n\tout << src._num;\n\treturn out;\n}\nistream& operator>>(istream& in, BigNum& des)\n{\n\tdes._num.clear();\n\tstring s;\n\tin >> s;\n\tint i = s.length();\n\n\tchar* new_s = new char[i + 1]();\n\n\tconst char* p = s.data();\n\ti = 0;\n\twhile (*p != 0)\n\t{\n\t\tnew_s[i++] = *p++;\n\t}\n\n\treverse(new_s, 0, i-1);\n\tdes._num.append(new_s);\n\n\treturn in;\n}\n```\n\n# test\n\n```cpp\n//test.cpp\n#include\"bignum.h\"\n#include<math.h>\n#include<iostream>\nusing namespace std;\nint main()\n{\n\tBigNum bn1(99999);\n\tshow_bignum(bn1);cout << \"real:\" << bn1 << endl;\n\tBigNum bn2(bn1);\n\tshow_bignum(bn2);cout << \"real:\" << bn2 << endl;\n\tBigNum bn3(string(\"999\"));\n\tshow_bignum(bn3);cout << \"real:\" << bn3 << endl;\n\tBigNum bn4(\"456\");\n\tshow_bignum(bn4);cout << \"real:\" << bn4 << endl;\n\tbn4 = bn3;\n\tshow_bignum(bn4);cout << \"real:\" << bn4 << endl;\n\tBigNum bn5 = bn1 + bn3;\n\tshow_bignum(bn5);\n\tBigNum bn6(100003);\n\tBigNum bn7(411);\n\tBigNum bn8 = bn6 - bn7;\n\tshow_bignum(bn8);\n\tBigNum bn9(999);\n\t++bn9;\n\tshow_bignum(bn9);\n\tbn9++;\n\tshow_bignum(bn9);\n\t--bn9;--bn9;\n\tshow_bignum(bn9);\n\t++bn9;++bn9;\n\tshow_bignum(bn9);\n\tbn9--;bn9--;\n\tshow_bignum(bn9);\n\tBigNum bn10;\n\tcin >> bn10;\n\tshow_bignum(bn10);\n\tcout << \"real:\" << bn10 << endl;\n}\n```\n\n# æˆªå›¾\n\n![image-20211020232706800](../../images/Cpp%E5%B0%81%E8%A3%85BigNum%E5%AE%9E%E7%8E%B0%E5%A4%A7%E6%95%B0%E5%8A%A0%E5%87%8F/image-20211020232706800.png)\n\n","categories":["Cpp"]},{"title":"Cpp_å°è£…é˜Ÿ/æ ˆ+å•ä¾‹æ¨¡å¼","url":"/Cpp/Cpp_å°è£…é˜Ÿæ ˆ_å•ä¾‹æ¨¡å¼/","content":"# node.h\n\n```cpp\n//node.h\n#ifndef NODE_H\n#define NODE_H\n#include<stdlib.h>\nusing namespace std;\nclass List;\nvoid show(List& list);\nclass Node\n{\npublic:\n\tNode(int val = int())//ç»™å‡½æ•°å½¢å‚é»˜è®¤å€¼\n\t{\n\t\t_val = val;\n\t\t_next = NULL;\n\t\t_pre = NULL;\n\t}\n\tfriend class List;\n\tfriend void show(List& list);\nprivate:\n\tint _val;\n\tNode* _next;\n\tNode* _pre;\n};\n#endif\n```\n\n# list\n\n## list.h\n\n```cpp\n#include\"node.h\"\nusing namespace std;\nclass List\n{\npublic:\n\tList();\n\tList(const List& src);\n\t~List();\n\tList& operator=(const List& src);\n\tvoid push_back(int val);\n\tvoid pop_back();\n\tvoid push_front(int val);\n\tvoid pop_front(int *pval);\n\n\tbool get_back(int * pval);\n\tbool get_front(int* pval);\n\tbool is_empty();\n\tint size();\n\t//void show();\n\tfriend void show(List& list);\nprivate:\n\tclass Node\n\t{\n\tpublic:\n\t\tNode(int val = int())//ç»™å‡½æ•°å½¢å‚é»˜è®¤å€¼\n\t\t{\n\t\t\t_val = val;\n\t\t\t_next = NULL;\n\t\t\t_pre = NULL;\n\t\t}\n\t\tfriend class List;\n\t\tfriend void show(List& list);\n\tprivate:\n\t\tint _val;\n\t\tNode* _next;\n\t\tNode* _pre;\n\t};\n\tNode* _head;\n\tNode* _tail;\n\n};\n```\n\n\n\n## list.cpp\n\n```cpp\n#include\"list.h\"\n#include<stdio.h>\n/*\nç±»å†…å®ç°çš„æˆå‘˜æ–¹æ³•é»˜è®¤ä¼šè¢«å»ºè®®ä¸ºå†…è”ï¼ˆé»˜è®¤åŠ ä¸Š\nå¯¹äºå¤§ç±»æ›´å¤šæ—¶å€™åœ¨ç±»å¤–å®ç°ï¼Œä¸ºäº†äººçœ‹ä»£ç çš„æ–¹ä¾¿ã€æ¸…æ™°\n*/\nList::List()\n{\n\t_head = new Node();\n\t_tail = _head;\n}\nList::List(const List& src)\n{\n\t//ç”³è¯·æ–°ç»“ç‚¹\n\t_head = new Node();\n\t_tail = _head;\n\t//éå†srcé“¾è¡¨ï¼Œå°†æ¯ä¸ªæ•°æ®push_backæ’å…¥åˆ°æ–°é“¾è¡¨\n\tNode* tmp = src._head->_next;//nextæ˜¯ç§æœ‰çš„ï¼Œåªèƒ½åŠ å‹å…ƒ\n\twhile (NULL != tmp)\n\t{\n\t\tpush_back(tmp->_val);\n\t\ttmp = tmp->_next;\n\t}\n\t\n}\nList::~List()\n{\n\twhile (!is_empty())\n\t{\n\t\tpop_back();\n\t}\n\t//åˆ é™¤å¤´ç»“ç‚¹\n\tdelete _head;\n}\nList& List::operator=(const List& src)\n{\n\tif (this == &src)\n\t{\n\t\treturn *this;\n\t}\n\t//1.æ¸…ç©ºç›®æ ‡é“¾è¡¨ã€‚2.é˜²æ­¢å†…å­˜æ³„éœ²\n\twhile (!is_empty())\n\t{\n\t\tpop_back();\n\t}\n\n\t//æ‹·è´\n\tNode* tmp = src._head->_next;\n\twhile (NULL != tmp)\n\t{\n\t\tpush_back(tmp->_val);\n\t\ttmp = tmp->_next;\n\t}\n\treturn *this;\n}\nvoid List::push_back(int val)\n{\n\tNode* node = new Node(val);\n\t_tail->_next = node;\n\tnode->_pre = _tail;\n\t_tail = node;\n}\nvoid List::pop_back()\n{\n\tif (is_empty())\n\t{\n\t\treturn;\n\t}\n\t_tail = _tail->_pre;\n\tdelete _tail->_next;\n\t_tail->_next = NULL;\n}\nvoid List::push_front(int val)\n{\n\t\n\tNode* newnode = new Node(val);//æ„é€ å¥½æ—¶çš„èŠ‚ç‚¹çš„nextå’Œpreå·²ç»ä¸ºNULLäº†\n\tnewnode->_pre = _head;\n\t//ç©ºé“¾è¡¨çš„æƒ…å†µï¼Œå³_head->_nextä¸ºNULL\n\tif (!is_empty())\n\t{\n\t\tnewnode->_next = _head->_next;//æ²¡å¿…è¦ï¼Œæ„é€ å¥½æ—¶çš„èŠ‚ç‚¹çš„nextå’Œpreå·²ç»ä¸ºNULLäº†\n\t\t_head->_next->_pre = newnode;//NULLå°±å¼‚å¸¸äº†\n\t}\n\telse\n\t{\n\t\t_tail = newnode;\n\t}\n\t_head->_next = newnode;\n\t\n}\nvoid List::pop_front(int *pval)\n{\n\tif (is_empty())\n\t{\n\t\treturn;\n\t}\n\tNode* tmp = _head->_next;\n\tif (NULL != tmp->_next)\n\t{\n\t\ttmp->_next->_pre = _head;\n\t}\n\telse\n\t{\n\t\t//å¦‚æœåˆ é™¤çš„æ˜¯å½“å‰é“¾è¡¨çš„å”¯ä¸€å®é™…èŠ‚ç‚¹\n\t\t_tail = _head;\n\t}\n\t_head->_next = tmp->_next;\n\t*pval = tmp->_val;\n\tdelete tmp;\n}\n\nbool List::get_back(int* pval)\n{\n\tif (is_empty())\n\t{\n\t\treturn false;\n\t}\n\t*pval = _tail->_val;\n\treturn true;\n}\nbool List::get_front(int* pval)\n{\n\tif (is_empty())\n\t{\n\t\treturn false;\n\t}\n\t*pval = _head->_next->_val;\n\treturn true;\n}\nbool List::is_empty()\n{\n\treturn _head->_next == NULL;\n}\nint List::size()\n{\n\tint i = 0;\n\tNode* p = _head->_next;\n\twhile (p != NULL)\n\t{\n\t\ti++;\n\t\tp = p->_next;\n\t}\n\treturn i;\n}\nvoid show(List& list)\n{\n\n\tList::Node* p = list._head->_next;\n\twhile (p != NULL)\n\t{\n\t\tprintf(\"%d \", p->_val);\n\t\tp = p->_next;\n\t}\n\tprintf(\"\\n\");\n}\n```\n\n# stack\n\n## stack.h\n\n```cpp\n#include\"list.h\"\n#include<mutex>\nclass Stack\n{\npublic:\n\tstatic Stack* get_stack();\n\t\n\t//~Stack();\n\t//Stack(const Stack& src);\n\t//Stack& operator=(const Stack& src);\n\tvoid push(int val);\n\tvoid pop(int* pval);\n\tint top();\n\tbool is_empty();\n\tfriend void show(Stack& stack);\nprivate:\n\tStack();\n\tList _list;\n\tstatic mutex* _lock;\n\tstatic Stack* _stack;\n};\n```\n\n## stack.cpp\n\n```cpp\n#include\"stack.h\"\n#include<stdio.h>\nStack* Stack::_stack = NULL;\nmutex* Stack::_lock = new mutex();\nStack* Stack::get_stack()\n{\n\tif (NULL == _stack)\n\t{\n\t\t_lock->lock();\n\t\tif (NULL == _stack)\n\t\t{\n\t\t\t_stack = new Stack();\n\t\t}\n\t\t_lock->unlock();\n\t}\n\treturn _stack;\n}\nStack::Stack()\n\t:_list()\n{\n\n}\n/*\nStack::~Stack()\n{\n\n}\nStack::Stack(const Stack& src)\n\t:_list(src._list)\n{\n\t\n}\nStack& Stack::operator=(const Stack& src)\n{\n\tif (this == &src)\n\t{\n\t\treturn *this;\n\t}\n\t_list.operator=(src._list);\n\treturn *this;\n}\n*/\nvoid Stack::push(int val)\n{\n\tStack::_list.push_front(val);\n}\nvoid Stack::pop(int* pval)\n{\n\tStack::_list.pop_front(pval);\n}\nint Stack::top()\n{\n\tint val;\n\t_list.get_back(&val);\n\treturn val;\n}\nbool Stack::is_empty()\n{\n\treturn _list.is_empty();\n}\nvoid show(Stack& stack)\n{\n\tshow(stack._list);\n}\n```\n\n# queue\n\n## queue.h\n\n```cpp\n#ifndef QUEUE_H\n#define QUEUE_H\n\n#include\"list.h\"\n#include<mutex>\nclass Queue\n{\npublic:\n\tstatic Queue* get_Queue();\n\t//~Queue();\n\t//Queue(const Queue& src);\n\t//Queue& operator=(const Queue& src);\n\tvoid push(int val);\n\tvoid pop(int* pval);\n\tint top();\n\tbool is_empty();\n\tfriend void show(Queue& queue);\nprivate:\n\tQueue();\n\tList _list;\n\tstatic mutex* _lock;\n\tstatic Queue* _queue;\n};\n\n#endif // !QUEUE_H\n```\n\n## queue.cpp\n\n```cpp\n#include\"queue.h\"\n#include<stdio.h>\nQueue* Queue::get_Queue()\n{\n\tif (NULL == _queue)\n\t{\n\t\t_lock->lock();\n\t\tif (NULL == _queue)\n\t\t{\n\t\t\t_queue = new Queue();\n\t\t}\n\t\t_lock->unlock();\n\t}\n\treturn _queue;\n}\nQueue::Queue()\n\t:_list()\n{\n}\n/*\nQueue::~Queue(){}\nQueue::Queue(const Queue& src)\n\t:_list(src._list)\n{\n\n}\n\nQueue& Queue::operator=(const Queue& src)\n{\n\tif (this == &src)\n\t{\n\t\treturn *this;\n\t}\n\t_list.operator=(src._list);\n\treturn *this;\n}\n*/\nQueue* Queue::_queue = NULL;\nmutex* Queue::_lock = new mutex();\nvoid Queue::push(int val)\n{\n\tQueue::_list.push_back(val);\n}\nvoid Queue::pop(int* pval)\n{\n\tQueue::_list.pop_front(pval);\n}\nint Queue::top()\n{\n\tint val;\n\t_list.get_front(&val);\n\treturn val;\n}\nbool Queue::is_empty()\n{\n\treturn _list.is_empty();\n}\nvoid show(Queue& queue)\n{\n\tshow(queue._list);\n}\n```\n\n# main\n\n```cpp\n//test\n#if 0\n#include\"queue.h\"\nint main()\n{\n\n\tQueue* queue1 = Queue::get_Queue();\n\n\tfor (int i = 0;i < 5;i++)\n\t{\n\t\tqueue1->push(i);\n\t}\n\tshow(*queue1);\n\n\tint val;\n\tqueue1->pop(&val);\n\tshow(*queue1);\n\treturn 0;\n}\n#endif\n\n\n#include\"stack.h\"\nint main()\n{\n\n\tStack * stack1 = Stack::get_stack();\n\tfor (int i = 0;i < 5;i++)\n\t{\n\t\tstack1->push(i);\n\t}\n\tshow(*stack1);\n\n\tint val;\n\tstack1->pop(&val);\n\tshow(*stack1);\n\treturn 0;\n}\n#if 0 \n#endif\n#if 0\n#include\"list.h\"\nint main()\n{\n\n\tList list1;\n\tfor (int i = 0;i < 5;i++)\n\t{\n\t\tlist1.push_back(i);\n\t}\n\tfor (int i = 0;i < 5;i++)\n\t{\n\t\tlist1.push_front(i);\n\t}\n\tshow(list1);\n\n\tList list2 = list1;\n\tshow(list2);\n\n\tlist1.pop_back();\n\tshow(list1);\n\tshow(list2);\n\treturn 0;\n}\n#endif\n```\n\n","categories":["Cpp"]},{"title":"Linux_ç³»ç»Ÿè°ƒç”¨_æ–‡ä»¶æ“ä½œ","url":"/Linux/Linux_ç³»ç»Ÿè°ƒç”¨_æ–‡ä»¶æ“ä½œ/","content":"# æ–‡ä»¶æ“ä½œ\n\næ‰“å¼€ï¼Œè¯»æˆ–å†™ï¼Œå…³é—­\n\nopen\n\nread\n\nwrite\n\nclose\n\nCè¯­è¨€ä¸­çš„æ‰“å¼€æ–‡ä»¶å‡½æ•°ï¼š`fopen`ï¼Œåº“å‡½æ•°ï¼Œè¿”å›å€¼ä¸º`FILE *`ï¼Œæœ‰`stdin`ã€`stdout`ã€`stderr`ã€‚\n## æ–‡ä»¶æè¿°ç¬¦\nfd\n\næ˜¯ä¸€ä¸ª`>=0`çš„æ•´æ•°ã€‚æ¯æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œå°±æŒ‰ç…§**æœ€å°å¯ç”¨åŸåˆ™**å ç”¨ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆå‡å¦‚ç°åœ¨å·²è¢«å ç”¨çš„fdæœ€å¤§å€¼ä¸º10ï¼Œè€Œ0å·æ˜¯ç©ºç¼ºçš„ï¼Œåˆ™å ç”¨0å·ï¼‰ã€‚\n\nå¤šæ¬¡æ‰“å¼€åŒä¸€ä¸ªæ–‡ä»¶ï¼Œå¯å¾—åˆ°å¤šä¸ªä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ã€‚\n### é¢„å®šä¹‰çš„æ–‡ä»¶æè¿°ç¬¦\n* 0ï¼šæ ‡å‡†è¾“å…¥ï¼Œé»˜è®¤æ˜¯é”®ç›˜\n* 1ï¼šæ ‡å‡†è¾“å‡ºï¼Œé»˜è®¤æ˜¯Shellå¯¹åº”çš„æ˜¾ç¤ºå™¨\n* 2ï¼šæ ‡å‡†é”™è¯¯ï¼Œä¹Ÿæ˜¯Shellå¯¹åº”çš„æ˜¾ç¤ºå™¨\n## write\nwrite to a file descriptorã€‚åŒ…å«äº`<unistd.h>`\n\nå¯é€šè¿‡`man 2 write`æŸ¥è¯¢ç”¨æ³•ã€‚`man 2`ä¸­å¤§å¤šéƒ½æ˜¯ç³»ç»Ÿè°ƒç”¨çš„å‡½æ•°æ‰‹å†Œã€‚\nè€Œ`man 1`ä¹Ÿæœ‰ä¸€ä¸ªå’ŒwriteåŒåçš„ï¼Œå’Œç³»ç»Ÿè°ƒç”¨ä¸åŒï¼Œå®ƒæ˜¯å‘½ä»¤ç¨‹åºï¼Œå¤šç”¨äºshellã€‚\n\næ¥å£ï¼š\n```c\nssize_t write(int fd, const void *buf, size_t count);\n```\nè¿”å›å€¼ï¼šæœ‰ç¬¦å·æ•´æ•°ã€‚\næˆåŠŸåˆ™è¿”å›å·²å†™å…¥çš„å­—èŠ‚å¤§å°ã€‚å¤±è´¥åˆ™è¿”å›`-1`ï¼Œè®¾ç½®errnoå€¼ã€‚\n\n## æ–‡ä»¶æŒ‡é’ˆ\næ–‡ä»¶åˆšæ‰“å¼€æ—¶ï¼Œæ–‡ä»¶çš„ä½ç½®æŒ‡é’ˆåœ¨å¤´éƒ¨ã€‚\n## read\nread from a file descriptorã€‚åŒ…å«äº`<unistd.h>\n\næ¥å£ï¼š\n```c\nssize_t read(int fd, void *buf, size_t count);\n```\nè¿”å›å€¼ï¼šæœ‰ç¬¦å·æ•´æ•°\næˆåŠŸï¼š\n1. è¿”å›å·²ç»è¯»åˆ°çš„å­—èŠ‚å¤§å°ã€‚å¹¶å°†æ–‡ä»¶æŒ‡é’ˆå‘å‰ç§»åŠ¨è¯¥å­—èŠ‚æ•°ã€‚\n2. è¿”å› 0 åˆ™è¡¨ç¤ºå·²ç»è¯»åˆ°äº†æ–‡ä»¶æœ«å°¾ã€‚\n\nå¤±è´¥åˆ™è¿”å›`-1`ï¼Œè®¾ç½®errnoå€¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ–‡ä»¶æŒ‡é’ˆæ˜¯å¦å‘ç”Ÿå˜åŒ–æ˜¯æœªå®šä¹‰çš„ã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰‹å†Œé‡Œæåˆ°ï¼Œå¦‚æœè¿”å›å€¼å°äºæˆ‘ä»¬è¯·æ±‚çš„å¤§å°ï¼Œ**ä¸èƒ½å®šä¹‰ä¸ºå¤±è´¥ï¼š\n1. å¯èƒ½æ˜¯å› ä¸ºç›®å‰å¯è¯»åˆ°çš„å­—èŠ‚æ¯”è¾ƒå°‘ï¼šè¿™ç§æƒ…å†µï¼Œå¯èƒ½æ˜¯å› ä¸ºæ¥è¿‘æ–‡ä»¶æœ«å°¾ï¼Œä¹Ÿå¯èƒ½æ˜¯æ­£åœ¨ä»ä¸€ä¸ªç®¡é“æˆ–ä»ä¸€ä¸ªç»ˆç«¯è¯»å–ã€‚\n2. ä¹Ÿå¯èƒ½è¯»æ“ä½œæ­£åœ¨è¢«ä¸€ä¸ªä¿¡å·ï¼ˆsignalï¼‰ä¸­æ–­ã€‚\n\nERRORSï¼š\n1. EAGAINï¼šæ–‡ä»¶æè¿°ç¬¦ fd æŒ‡å‘ä¸€ä¸ªéå¥—æ¥å­—æ–‡ä»¶ï¼Œä¸”å·²è¢«æ ‡è®°ä¸ºéé˜»å¡ (`O_NONBLOCK`)ï¼Œè¯»å–æ“ä½œå°†é˜»å¡ã€‚æœ‰å…³ `O_NONBLOCK` æ ‡å¿—çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… `open(2)`ã€‚\n2. EAGAIN æˆ– EWOULDBLOCKï¼šæ–‡ä»¶æè¿°ç¬¦ fd æŒ‡å‘ä¸€ä¸ªå¥—æ¥å­—æ–‡ä»¶ï¼Œä¸”å·²è¢«æ ‡è®°ä¸ºéé˜»å¡ (`O_NONBLOCK`)ï¼Œè¯»å–æ“ä½œå°†é˜»å¡ã€‚POSIX.1-2001 å…è®¸åœ¨è¿™ç§æƒ…å†µä¸‹è¿”å›ä»»ä¸€é”™è¯¯ï¼Œå¹¶ä¸”ä¸è¦æ±‚è¿™äº›å¸¸é‡å…·æœ‰ç›¸åŒçš„å€¼ï¼Œå› æ­¤å¯ç§»æ¤åº”ç”¨ç¨‹åºåº”è¯¥æ£€æŸ¥è¿™ä¸¤ç§å¯èƒ½æ€§ã€‚\n\n## open\néœ€è¦åŒ…å«ä»¥ä¸‹å¤´æ–‡ä»¶ï¼š\n1. `<sys/types.h>`\n2. `<sys/stat.h>`\n3. `<fcntl.h>`\n\næ¥å£\n```c\nint open(const char *pathname, int flags);\nint open(const char *pathname, int flags, mode_t mode);\n```\nflagsï¼ŒæŒ‡ç¤ºæ‰“å¼€æ–‡ä»¶çš„æ–¹å¼ã€‚\n\n1. `O_CREAT`ï¼šå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºè¯¥æ–‡ä»¶ã€‚å¹¶ä¸”ä½¿ç”¨ç¬¬3ä¸ªå‚æ•°`mode`è®¾ç½®æƒé™ã€‚\n    1. å¦‚æœæ­é…`O_EXCL`ä½¿ç”¨ï¼Œå¯ä»¥é˜²æ­¢å¤šè¿›ç¨‹åŒæ—¶åˆ›å»ºæ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œåˆ™è¿”å›é”™è¯¯EEXISTã€‚\n2. `O_WRONLY`ï¼šåªå†™\n3. `O_RDONLY`ï¼šåªè¯»\n4. `O_RDWR`ï¼šè¯»å†™\n5. `O_APPEND`ï¼šå°¾éƒ¨è¿½åŠ æ–¹å¼ï¼ˆæ‰“å¼€åæ–‡ä»¶æŒ‡é’ˆæŒ‡å‘æœ«å°¾ï¼‰\n6. `O_TRUNC`ï¼šè‹¥æ–‡ä»¶å­˜åœ¨ï¼Œä¸”åœ¨`O_WRONLY`æˆ–`O_RDWR`çš„å‰æä¸‹ï¼Œåˆ™æ–‡ä»¶é•¿åº¦å°†è¢«æˆªæ–­ä¸º 0ï¼ˆæ¸…ç©ºï¼‰ã€‚å¦‚æœæ–‡ä»¶æ˜¯ FIFO æˆ–ç»ˆç«¯è®¾å¤‡æ–‡ä»¶ï¼Œåˆ™ `O_TRUNC` æ ‡å¿—å°†è¢«å¿½ç•¥ã€‚\n7. `O_NONBLOCK` or `O_NDELAY`ï¼šä»¥éé˜»å¡æ¨¡å¼æ‰“å¼€æ–‡ä»¶ï¼Œ`open()` ä»¥åŠå¯¹è¿”å›çš„æ–‡ä»¶æè¿°ç¬¦æ‰§è¡Œçš„ä»»ä½•åç»­ I/O æ“ä½œéƒ½ä¸ä¼šå¯¼è‡´è°ƒç”¨è¿›ç¨‹ç­‰å¾…ã€‚\n    1. æ³¨æ„ï¼Œæ­¤æ ‡å¿—çš„è®¾ç½®å¯¹ `poll(2)`ã€`select(2)`ã€`epoll(7)` åŠç±»ä¼¼æ¥å£çš„æ“ä½œæ²¡æœ‰å½±å“ï¼Œå› ä¸ºè¿™äº›æ¥å£ä»…é€šçŸ¥è°ƒç”¨è€…æ–‡ä»¶æè¿°ç¬¦æ˜¯å¦â€œå°±ç»ªâ€ï¼Œè¿™æ„å‘³ç€åœ¨ `O_NONBLOCK` æ ‡å¿—å·²æ¸…é™¤çš„æƒ…å†µä¸‹å¯¹æ–‡ä»¶æè¿°ç¬¦æ‰§è¡Œçš„ I/O æ“ä½œä¸ä¼šé˜»å¡ã€‚\n    2. æ³¨æ„ï¼Œæ­¤æ ‡å¿—å¯¹å¸¸è§„æ–‡ä»¶å’Œå—è®¾å¤‡æ²¡æœ‰å½±å“ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œæ— è®ºæ˜¯å¦è®¾ç½®äº† `O_NONBLOCK`ï¼Œå½“éœ€è¦è®¾å¤‡æ´»åŠ¨æ—¶ï¼ŒI/O æ“ä½œéƒ½ä¼šï¼ˆçŸ­æš‚åœ°ï¼‰é˜»å¡ã€‚ç”±äº `O_NONBLOCK` è¯­ä¹‰æœ€ç»ˆå¯èƒ½ä¼šå®ç°ï¼Œå› æ­¤åº”ç”¨ç¨‹åºåœ¨ä¸ºå¸¸è§„æ–‡ä»¶å’Œå—è®¾å¤‡æŒ‡å®šæ­¤æ ‡å¿—æ—¶ä¸åº”ä¾èµ–äºé˜»å¡è¡Œä¸ºã€‚\n\nmodeï¼ŒæŒ‡ç¤º`O_CREAT`åˆ›å»ºæ–‡ä»¶æ—¶ï¼Œèµ‹äºˆçš„æƒé™ã€‚\næœ‰å®šä¹‰å¥½çš„å¸¸é‡ã€‚\nå‘½åæ˜¯æœ‰è§„å¾‹çš„ï¼š\n`S_I`æ˜¯å›ºå®šå¼€å¤´\n`RWX`è¡¨ç¤ºå¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œã€‚\nå½“å‰é¢æ˜¯`RWX`3ä¸ªæƒé™éƒ½æœ‰æ—¶ï¼Œåç¼€åªæœ‰1ä¸ªå­—ç¬¦ï¼š`U`ä»£è¡¨userï¼Œ`G`ä»£è¡¨groupï¼Œ`O`ä»£è¡¨otherã€‚\nå½“å‰é¢åªæœ‰1ä¸ªæƒé™ï¼ˆRã€Wã€Xï¼‰æ—¶ï¼Œåç¼€æ˜¯3ä¸ªå­—ç¬¦ï¼š`USR`ä»£è¡¨userï¼Œ`GRP`ä»£è¡¨groupï¼Œ`OTH`ä»£è¡¨otherã€‚\n![](../../images/Linux_ç³»ç»Ÿè°ƒç”¨_æ–‡ä»¶æ“ä½œ/image-20250719014341777.png)\n\nå®é™…çš„å€¼ï¼ˆæ¯”å¦‚00700ï¼‰ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Ÿ\n1. è¿™æ˜¯ä¸€ä¸ªå…«è¿›åˆ¶æ•°ï¼Œæ‰€ä»¥è¦ä»¥0å¼€å¤´ã€‚\n2. é¦–å…ˆï¼Œå‰é¢ä¸¤ä½éƒ½æ˜¯0\n3. åé¢ä¸‰ä½ï¼š\n    1. ç¬¬1ä¸ªæ•°å¯¹åº”ç”¨æˆ·æƒé™ï¼›ç¬¬2ä¸ªæ•°å¯¹åº”ç»„æƒé™ï¼›ç¬¬3ä¸ªæ•°å¯¹åº”å…¶ä»–äººæƒé™ã€‚\n    2. æ¯ä¸€ä½ä¸Šï¼Œ\n        1. 1ä»£è¡¨å¯æ‰§è¡Œï¼ˆäºŒè¿›åˆ¶çš„001ï¼‰ã€\n        2. 2ä»£è¡¨å¯å†™ï¼ˆäºŒè¿›åˆ¶çš„010ï¼‰ã€\n        3. 4ä»£è¡¨å¯è¯»ï¼ˆäºŒè¿›åˆ¶çš„100ï¼‰ã€\n        4. 7ä»£è¡¨å¯è¯»å¯å†™å¯æ‰§è¡Œï¼ˆäºŒè¿›åˆ¶çš„111ï¼‰ã€‚\n    3. é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥æ¨æ–­å‡ºï¼Œ\n        1. å¯è¯»å¯å†™æ˜¯äºŒè¿›åˆ¶çš„ï¼ˆ110ï¼‰å³6ã€‚\n        2. å¯è¯»å¯æ‰§è¡Œæ˜¯äºŒè¿›åˆ¶çš„ï¼ˆ101ï¼‰å³5ã€‚\n        3. å¯å†™å¯æ‰§è¡Œæ˜¯äºŒè¿›åˆ¶çš„ï¼ˆ011ï¼‰å³3ã€‚\n4. å› æ­¤ï¼Œä¸€èˆ¬çš„æ–‡ä»¶ï¼Œå¯ä»¥è®¾ç½®ä¸º`0666`ï¼Œå³æ‰€æœ‰äººå¯è¯»å¯å†™ã€‚ä¹Ÿå¯ä»¥è®¾ç½®ä¸º`0600`ï¼Œè¡¨ç¤ºåªæœ‰æ‹¥æœ‰è€…å¯è¯»å¯å†™ã€‚\n## close\néœ€è¦åŒ…å«å¤´æ–‡ä»¶`<unistd.h>`\næ¥å£\n```c\nint close(int fd);\n```\nè¿”å›å€¼\næˆåŠŸè¿”å›0ï¼›\nå¤±è´¥è¿”å›-1ã€‚\n## lseek\né‡æ–°å®šä½æ–‡ä»¶åç§»é‡\néœ€è¦åŒ…å«å¤´æ–‡ä»¶ï¼š\n1. `<sys/types.h>`\n2. `<unistd.h>`\n\næ¥å£ï¼š\n```c\noff_t lseek(int fd, off_t offset, int whence);\n```\noffsetï¼Œæœ‰ç¬¦å·ã€‚å¦‚æœè¦å¾€æœ«å°¾æ–¹å‘åç§»åˆ™éœ€è¦æ­£æ•°ï¼Œå¾€å¤´æ–¹å‘åˆ™éœ€è¦è´Ÿæ•°ã€‚\nwhenceï¼ŒæŒ‡ç¤ºåœ¨å“ªä¸ªä½ç½®è¿›è¡Œåç§»ã€‚\n1. `SEEK_SET`ï¼Œä»0åç§»offsetã€‚\n2. `SEEK_CUR`ï¼Œä»å½“å‰ä½ç½®åç§»offsetã€‚\n3. `SEEK_END`ï¼Œä»æœ«å°¾åç§»offsetã€‚å¦‚æœoffsetè¢«è®¾ç½®ä¸º0åˆ™è¿”å›æ–‡ä»¶å¤§å°ã€‚è¿™æ˜¯é€šè¿‡fdå–æ–‡ä»¶å¤§å°çš„å”¯ä¸€æ–¹æ³•ã€‚\n\nè¿”å›å€¼ï¼š\nè¿”å›å½“å‰æ–‡ä»¶æŒ‡é’ˆç›¸å¯¹äºæ–‡ä»¶å¤´éƒ¨çš„åç§»é‡ã€‚\nå‘ç”Ÿé”™è¯¯åˆ™è¿”å›`-1`ã€‚\n# mybash\n\n```c\n#include<stdio.h>\n#include<unistd.h>\n#include<stdlib.h>\n#include<assert.h>\n#include<string.h>\n#include<sys/wait.h>\n#include<errno.h>\n#include<pwd.h>\nchar * get_cmd(char buff[], char* myargv[])\n{\n    if(NULL==buff || NULL==myargv)\n    {\n        return NULL;\n    }\n    char *s = strtok(buff,\" \");\n    int i = 0;\n    while(s != NULL)\n    {\n        myargv[i++] = s;\n        s = strtok(NULL,\" \");\n    }\n    return myargv[0];\n}\nvoid print_info()\n{\n    //getuid -->unistd.h\n    int id = getuid();\n    char *s = \"$\";\n    if(id == 0)//root is 0\n    {\n        s = \"#\";\n    }\n    //#inlcude<pwd.h>\n    //getpwuid\n    struct passwd* ptr = getpwuid(id);//get info of user through uid\n    if(ptr == NULL)\n    {\n        printf(\"$\");\n        fflush(stdout);\n        return;\n    }\n    //gethostname-->unistd.h\n    char hostname[64] = {0};\n    if(gethostname(hostname,64)==-1)\n    { \n        printf(\"$\");\n        fflush(stdout);\n        return;\n    }\n    //chdir & getcwd --> #include<unistd.h>\n    char pwd_buff[128] = {0};\n    if(getcwd(pwd_buff, 128)==NULL)\n    {    \n        printf(\"$\");\n        fflush(stdout);\n        return;\n    }\n    //ptr->pw_name:ç”¨æˆ·åå­—ã€‚ï¼ˆxcgï¼‰\t\t\t\t   -->getpwuid-->pwd.h\n    //hostname:ä¸»æœºåã€‚ï¼ˆubuntuï¼‰\t\t\t\t\t   -->gethostname-->unistd.h\n    //pwd_buff:å½“å‰ç›®å½•å®Œæ•´ä¿¡æ¯ï¼ˆ/home/xcg/c219/1024ï¼‰ -->getcwd-->unistd.h\n    //s:ç®¡ç†å‘˜æˆ–æ™®é€šæ ‡è¯†ï¼ˆ#ä¸ºç®¡ç†å‘˜ï¼Œ$ä¸ºæ™®é€šï¼‰\t\t\t-->getuid-->unistd.h\n    //æœ€åæ•ˆæœï¼šxcg @ ubuntu : /home/xcg/c219/1024 $\n    printf(\"%s@%s:%s%s \", ptr->pw_name, hostname, pwd_buff,s);\n    fflush(stdout);\n    /*\n    char **p = engv;\n    while(*p != NULL)\n    {\n        if(strncmp(*p,\"PWD\",3)==0)\n        {\n            char *s = &((*p)[4]);\n            printf(\"%s\",s);\n            break;\n        }\n        p++;\n    }\n    printf(\"$ \");\n    */\n}\nint main(int argc, char* argv[], char* engv[])\n{\n    while(1)\n    {\n        print_info();//æ‰“å°[ç”¨æˆ·åå­—@ä¸»æœºä¿¡æ¯:å½“å‰ç›®å½•$]\n        \n        //é”®ç›˜è·å–[å‘½ä»¤ã€å‘½ä»¤å‚æ•°]å­—ç¬¦ä¸²\n        char buff[128] = {0};\n        fgets(buff,128,stdin);\n        buff[strlen(buff)-1] = 0;//remove the \\n\n        //å­˜æ”¾è§£æçš„å‘½ä»¤å‚æ•°\n        char * myargv[10] = {0};\n        char * cmd = get_cmd(buff,myargv);\n        if(NULL == cmd)\n        {\n            continue;\n        }\n        else if(strcmp(cmd,\"exit\") == 0)\n        {\n            break;\n        }\n        else if(strcmp(cmd,\"cd\")==0)\n        {\n            //chdir()\n            if(myargv[1] == NULL)\n            {\n                continue;\n            }\n            if(chdir(myargv[1]) == -1)//chdir-->unistd.h\n            {\n                perror(\"cd err\"); //#include<errno.h>\n            }\n            continue;//redo the bash\n        }\n        else\n        {\n            //fork + exec\n            pid_t pid = fork();\n            if(pid == -1)\n            {\n                printf(\"error\\n\");\n                continue;\n            }\n            if(pid == 0)\n            {\n                execvp(cmd,myargv);\n                printf(\"execvp error\\n\");\n                exit(1);\n            }\n            wait(NULL);\n        }\n    }\n}\n\n```\n\n# pwdå’Œls\n\npwdå¯ä»¥è¾“å‡ºå½“å‰ç›®å½•çš„è·¯å¾„ä¿¡æ¯ã€‚\n\nç”¨unistd.hä¸‹çš„getcwdå‡½æ•°è·å–åˆ°buffå­—ç¬¦ä¸²ä¸­å³å¯ã€‚\n\n```c\n#include<unistd.h>\nint main()\n{\n    char buff[128] = {0};\n    if(getcwd(buff,128)==NULL)\n    {\n        return;\n    }\n    printf(\"%s\\n\",buff);\n    exit(0);\n}\n```\n\nlsæ˜¯æ‰“å°å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åã€‚\n\nå³éœ€è¦æ‰«æç›®å½•ã€‚\n\n## ç›®å½•æµ\n\nç›®å½•å®é™…ä¸Šæ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼Œå› ä¸ºå®é™…ä¸Šå¹¶æ²¡æœ‰å®é™…çš„æ–‡ä»¶æ¥å­˜å‚¨ç›®å½•ï¼Œè€Œæ˜¯ä¸€ä¸ªç›®å½•æµã€‚å°±ç±»ä¼¼äºâ€œ219ç­â€è¿™ä¸ªæ¦‚å¿µï¼Œå®é™…ä¸Šå¹¶æ²¡æœ‰219ç­è¿™ä¸ªäººï¼Œåªæ˜¯æŠ½è±¡å‡ºæ¥çš„ä¸€ä¸ªå¯ä»¥ä»£è¡¨ä¸€äº›æ–‡ä»¶çš„é›†åˆåè¯ã€‚\n\nä¸ç›®å½•æ“ä½œæœ‰å…³çš„å‡½æ•°åœ¨dirent.hå¤´æ–‡ä»¶ä¸­å£°æ˜ï¼Œä½¿ç”¨ä¸€ä¸ªåä¸ºDIRçš„ç»“æ„ä½œä¸ºç›®å½•æ“ä½œçš„åŸºç¡€ã€‚æŒ‡å‘è¿™ä¸ªç»“æ„ä½“çš„æŒ‡é’ˆï¼ˆDIR \\*ï¼‰è¢«ç§°ä¸ºç›®å½•æµï¼Œç”¨äºå®Œæˆå„ç§ç›®å½•çš„æ“ä½œã€‚ä¸æ“ä½œæ™®é€šæ–‡ä»¶çš„æ–‡ä»¶æµï¼ˆFILE \\*ï¼‰éå¸¸ç›¸ä¼¼ã€‚\n\næ¶‰åŠåˆ°çš„å‡½æ•°æœ‰ï¼š\n\n1. opendir\n   1. ![image-20211031173750225](../../images/Linux_%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8/image-20211031173750225.png)\n2. readdir\n   1. ![image-20211031173910841](../../images/Linux_%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8/image-20211031173910841.png)\n   2. è¿”å›çš„æŒ‡é’ˆçš„æŒ‡å‘çš„ç»“æ„ä½“æ˜¯direntã€‚åŒ…å«çš„å†…å®¹æœ‰ï¼š\n      ![image-20211031174007909](../../images/Linux_%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8/image-20211031174007909.png)\n3. telldir\n4. seekdir\n5. closedir\n\n```c\n#include<unistd.h>\n#include<string.h>\n#include<dirent.h>\nint main()\n{\n    char buff[128] = {0};\n    if(getcwd(buff,128))==NULL)\n    {\n        return 0;\n    }\n    DIR * p = opendir(buff);//æ‰“å¼€é€šè¿‡getcwdè·å–çš„å½“å‰ç›®å½•å­—ç¬¦ä¸²æ‰€æŒ‡å®šçš„ç›®å½•ï¼Œè·å–ä¸€ä¸ªç›®å½•æµ\n    if(p==NULL)\n    {\n        return 0;\n    }\n    struct dirent * p_dirent = NULL;\n    while((p_dirent = readdir(p))!=NULL)\n    {\n        printf(\"%s  \",p_dirent->d_name);\n    }\n    closedir(p);\n    return 0;\n}\n```\n\n```bash\n\n```\n\n","categories":["æ“ä½œç³»ç»Ÿ","Linux"]},{"title":"åŸºç¡€æ•°æ®ç»“æ„_é˜Ÿåˆ—å’Œæ ˆè½¬æ¢","url":"/åŸºç¡€æ•°æ®ç»“æ„/åŸºç¡€æ•°æ®ç»“æ„_é˜Ÿåˆ—å’Œæ ˆè½¬æ¢/","content":"# é“¾é˜Ÿ\n\nå¤´ç»“ç‚¹éœ€è¦é‡æ–°è®¾è®¡ã€‚\n\nå¦‚æœå¤´ç»“ç‚¹åªæœ‰ä¸€ä¸ªnextèŠ‚ç‚¹ã€‚å…¥é˜Ÿä¸ºO(1)ä½†å‡ºé˜Ÿæ— æ³•éƒ½åŒæ—¶ä¸ºO(1)ã€‚æˆ‘ä»¬éœ€è¦å¦å¤–è®¾è®¡ä¸€ä¸ªå°¾æŒ‡é’ˆã€‚\n\n```c\ntypedef struct LinkQueue\n{\n    struct Node * front;\n    struct Node * tail;\n}LinkQueue,Head;\ntypedef struct QNode\n{\n    ElemType data;\n    struct Node * next;\n}QNode;\n```\n\n\n\n```c\n#pragma once\n//.h\ntypedef int ElemType;\ntypedef struct LinkQueue\n{\n    struct QNode* front;\n    struct QNode* tail;\n}LinkQueue, Head;\ntypedef struct QNode\n{\n    ElemType data;\n    struct QNode* next;\n}QNode;\nvoid Init_lqueue(LinkQueue* plq);\nbool Push_lqueue(LinkQueue* plq, ElemType val);\nbool Pop_lqueue(LinkQueue* plq, ElemType* pval);\nbool Front_lqueue(LinkQueue* plq, ElemType* pval);\nint Get_Length_lqueue(LinkQueue* plq);\nbool Is_Empty_lqueue(LinkQueue* plq);\nvoid Clear_lqueue(LinkQueue* plq);\nvoid Destroy_lqueue(LinkQueue* plq);\nvoid Show_lqueue(LinkQueue* plq);\n```\n\n```c\n//.c\n#include\"lqueue.h\"\n#include<assert.h>\n#include<stdlib.h>\n#include<stdio.h>\nQNode* Buy_node()\n{\n\tQNode* s = (QNode*)malloc(sizeof(QNode));\n\treturn s;\n}\nvoid Init_lqueue(LinkQueue* plq)\n{\n\tassert(plq != NULL);\n\tQNode* node = Buy_node();\n\tnode->next = NULL;\n\tplq->front = node;\n\tplq->tail = node;\n}\n//å…¥é˜Ÿï¼Œå°¾æ’\nbool Push_lqueue(LinkQueue* plq, ElemType val)\n{\n\tassert(plq != NULL);\n\tQNode* newnode = Buy_node();\n\tif (NULL == newnode)return false;\n\tnewnode->next = NULL;\n\tplq->tail->next = newnode;\n\n\tplq->tail = newnode;\n\n\tnewnode->data = val;\n\treturn true;\n}\nbool Pop_lqueue(LinkQueue* plq, ElemType* pval)\n{\n\tassert(plq != NULL);\n\tif (Is_Empty_lqueue(plq))\n\t{\n\t\treturn false;\n\t}\n\tQNode* oldnode = plq->front->next;\n\t*pval = oldnode->data;\n\t//å¤´åˆ \n\tplq->front->next = oldnode->next;\n\tfree(oldnode);\n\toldnode = NULL;\n\treturn true;\n}\nbool Front_lqueue(LinkQueue* plq, ElemType* pval)\n{\n\tassert(plq != NULL);\n\tif (Is_Empty_lqueue(plq))\n\t{\n\t\treturn false;\n\t}\n\t*pval = plq->front->next->data;\n\treturn true;\n}\nbool Is_Empty_lqueue(LinkQueue* plq)\n{\n\tassert(plq != NULL);\n\treturn plq->front->next == NULL;\n}\nint Get_Length_lqueue(LinkQueue* plq)\n{\n\tassert(plq != NULL);\n\tint count = 0;\n\tQNode* p = plq->front->next;\n\twhile (p != NULL)\n\t{\n\t\tcount++;\n\t\tp = p->next;\n\t}\n\treturn count;\n}\nvoid Clear_lqueue(LinkQueue* plq)\n{\n\tassert(plq != NULL);\n\tint val;\n\twhile (!Is_Empty_lqueue(plq))\n\t{\n\t\tPop_lqueue(plq, &val);\n\t}\n}\nvoid Destroy_lqueue(LinkQueue* plq)\n{\n\tassert(plq != NULL);\n\tClear_lqueue(plq);\n\tfree(plq->front);\n\tplq->front = NULL;\n\tplq->tail = NULL;\n}\nvoid Show_lqueue(LinkQueue* plq)\n{\n\tassert(plq != NULL);\n\tQNode* p = plq->front->next;\n\twhile (p != NULL)\n\t{\n\t\tprintf(\"%d \", p->data);\n\t\tp = p->next;\n\t}\n\tprintf(\"\\n\");\n}\n\n```\n\n# é“¾æ ˆ\n\n```c\n//.h\n//LinkStack.h\n#ifndef LINKSTACK_H\n#define LINKSTACK_H\n\n#define TRUE 1\n#define FALSE 0\n#define OK 1\n#define ERROR 0\n#define OVERFLOW -2\n#define NULLPTR -3\n\ntypedef int Status;\n\ntypedef int SElemType;\ntypedef struct StackNode\n{\n    SElemType data;\n    struct StackNode* next;\n}StackNode, * PStackNode;\ntypedef struct\n{\n    StackNode* top;\n    int cursize;\n}LinkStack;\n\nStatus InitStack(LinkStack* ps);\nvoid DestroyStack(LinkStack* ps);\nvoid ClearStack(LinkStack* ps);\nint StackLength(const LinkStack* ps);\nbool StackEmpty(const LinkStack* ps);\nStatus Push_Stack(LinkStack* ps, SElemType val);\nStatus GetTop_Stack(LinkStack* ps, SElemType* pval);\nStatus Pop_Stack(LinkStack* ps, SElemType* pval);\nbool DelFront_Stack(LinkStack* ps);\nvoid Show_Stack(LinkStack* ps);\n#endif\n```\n\n```c\n//LinkStack.cpp\n#include<stdlib.h>\n#include<assert.h>\n#include<string.h>\n#include<stdio.h>\n#include\"LinkStack.h\"\nStackNode* Buynode()\n{\n    StackNode* newnode = (StackNode*)malloc(sizeof(StackNode));\n    if (NULL != newnode)\n    {\n        memset(newnode, 0, sizeof(StackNode));\n    }\n    return newnode;\n}\nStatus InitStack(LinkStack* ps)\n{\n    assert(ps != NULL);\n    ps->top = Buynode();//å¤´ç»“ç‚¹\n    if (NULL == ps->top)return OVERFLOW;\n\n    ps->cursize = 0;\n    return OK;\n}\nvoid DestroyStack(LinkStack* ps)\n{\n    assert(ps != NULL);\n    ClearStack(ps);\n    free(ps->top);\n    ps->top = NULL;\n}\nvoid ClearStack(LinkStack* ps)\n{\n    assert(ps != NULL);\n    while (ps->cursize != 0)\n    {\n        DelFront_Stack(ps);\n    }\n}\nint StackLength(const LinkStack* ps)\n{\n    assert(ps != NULL);\n    return ps->cursize;\n}\nbool StackEmpty(const LinkStack* ps)\n{\n    assert(ps != NULL);\n    return ps->cursize == 0;\n}\nStatus Push_Stack(LinkStack* ps, SElemType val)\n{\n    assert(ps != NULL);\n    StackNode* newnode = Buynode();\n    if (NULL == newnode)return OVERFLOW;\n\n    newnode->next = ps->top->next;\n    ps->top->next = newnode;\n\n    newnode->data = val;\n\n    ps->cursize += 1;\n    return OK;\n}\nStatus GetTop_Stack(LinkStack* ps, SElemType* pval)\n{\n    assert(ps != NULL);\n    if (pval == NULL)return NULLPTR;\n    if (ps->cursize <= 0)return false;\n    *pval = ps->top->next->data;\n    return OK;\n}\nStatus Pop_Stack(LinkStack* ps, SElemType* pval)\n{\n    assert(ps != NULL);\n    if (pval == NULL)return NULLPTR;\n    if (ps->cursize <= 0)return ERROR;\n    GetTop_Stack(ps, pval);\n    DelFront_Stack(ps);\n    return OK;\n}\nbool DelFront_Stack(LinkStack* ps)\n{\n    assert(ps != NULL);\n    if (ps->cursize <= 0)return false;\n    StackNode* p = ps->top->next;\n    ps->top->next = p->next;\n    free(p);\n    ps->cursize -= 1;\n    return true;\n}\nvoid Show_Stack(LinkStack* ps)\n{\n    StackNode* p = ps->top->next;\n    while (p != NULL)\n    {\n        printf(\"%d \", p->data);\n        p = p->next;\n    }\n    //printf(\"\\n\");\n}\n```\n\n# æ ˆè½¬é˜Ÿåˆ—\n\n```c\n//.h\n#ifndef MYQUEUE_H\n#define MYQUEUE_H\n#include\"../../Stack/Stack/LinkStack.h\"\n#include\"../../QueueTest/QueueTest/lqueue.h\"\ntypedef int ElemType;\ntypedef struct MyQueue\n{\n\tLinkStack s1;\n\tLinkStack s2;\n}MyQueue;\n#define TRUE 1\n#define FALSE 0\n#define OK 1\n#define ERROR 0\n#define OVERFLOW -2\n#define NULLPTR -3\n\ntypedef int Status;\nvoid Init_MyQueue(MyQueue* pmyq);\nStatus Push_MyQueue(MyQueue* pmyq, ElemType val);\nStatus Pop_MyQueue(MyQueue* pmyq, ElemType* pval);\nStatus Front_MyQueue(MyQueue* pmyq, ElemType* pval);\nint Get_Length_MyQueue(MyQueue* pmyq);\nbool Is_Empty_MyQueue(MyQueue* pmyq);\nvoid Clear_MyQueue(MyQueue* pmyq);\nvoid Destroy_MyQueue(MyQueue* pmyq);\nvoid Show_MyQueue(MyQueue* pmyq);\n#endif\n\n```\n\n```c\n//.c\n#include\"MyQueue.h\"\n#include<assert.h>\n#include<stdio.h>\n#include<stdlib.h>\n\nvoid Init_MyQueue(MyQueue* pmyq)\n{\n\tInitStack(&pmyq->s1);\n\tInitStack(&pmyq->s2);\n}\nStatus Push_MyQueue(MyQueue* pmyq, ElemType val)\n{\n\treturn Push_Stack(&pmyq->s1, val);\n}\nStatus Pop_MyQueue(MyQueue* pmyq, ElemType* pval)\n{\n\tif (!StackEmpty(&pmyq->s2))\n\t{\n\t\treturn Pop_Stack(&pmyq->s2, pval);\n\t}\n\telse\n\t{\n\t\tint val;\n\t\twhile(!StackEmpty(&pmyq->s1))\n\t\t{\n\t\t\tPop_Stack(&pmyq->s1, &val);\n\t\t\tPush_Stack(&pmyq->s2, val);\n\t\t}\n\t\tif (StackEmpty(&pmyq->s2))\n\t\t{\n\t\t\treturn FALSE;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Pop_Stack(&pmyq->s2, pval);\n\t\t}\n\t}\n}\nStatus Front_MyQueue(MyQueue* pmyq, ElemType* pval)\n{\n\tif (!StackEmpty(&pmyq->s2))\n\t{\n\t\treturn GetTop_Stack(&pmyq->s2, pval);\n\t}\n\telse\n\t{\n\t\tint val;\n\t\twhile (!StackEmpty(&pmyq->s1))\n\t\t{\n\t\t\tPop_Stack(&pmyq->s1, &val);\n\t\t\tPush_Stack(&pmyq->s2, val);\n\t\t}\n\t\tif (StackEmpty(&pmyq->s2))\n\t\t{\n\t\t\treturn FALSE;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn GetTop_Stack(&pmyq->s2, pval);\n\t\t}\n\t}\n}\nint Get_Length_MyQueue(MyQueue* pmyq)\n{\n\treturn StackLength(&pmyq->s1) + StackLength(&pmyq->s2);\n}\nbool Is_Empty_MyQueue(MyQueue* pmyq)\n{\n\treturn Get_Length_MyQueue(pmyq) == 0;\n}\nvoid Clear_MyQueue(MyQueue* pmyq)\n{\n\tClearStack(&pmyq->s1);\n\tClearStack(&pmyq->s2);\n}\nvoid Destroy_MyQueue(MyQueue* pmyq)\n{\n\tDestroyStack(&pmyq->s1);\n\tDestroyStack(&pmyq->s2);\n}\nvoid Show_MyQueue(MyQueue* pmyq)\n{\n\tStackNode* p = pmyq->s1.top->next;\n\tp = pmyq->s1.top->next;\n\twhile (p != NULL)\n\t{\n\t\tprintf(\"%d \", p->data);\n\t\tp = p->next;\n\t}\n\n\tLinkStack s3;\n\tInitStack(&s3);\n\tp = pmyq->s2.top->next;\n\twhile (p != NULL)\n\t{\n\t\tPush_Stack(&s3, p->data);\n\t\tp = p->next;\n\t}\n\n\tp = s3.top->next;\n\twhile (p != NULL)\n\t{\n\t\tprintf(\"%d \", p->data);\n\t\tp = p->next;\n\t}\n\tprintf(\"\\n\");\n}\n```\n\n# é˜Ÿåˆ—è½¬æ ˆ\n\n```c\n//.h\n//MyStack.h\n#ifndef MYSTACK_H\n#define MYSTACK_H\n\n#include\"../../Stack/Stack/LinkStack.h\"\n#include\"../../QueueTest/QueueTest/lqueue.h\"\n\n#define TRUE 1\n#define FALSE 0\n#define OK 1\n#define ERROR 0\n#define OVERFLOW -2\n#define NULLPTR -3\n\ntypedef int Status;\n\ntypedef int ElemType;\n\ntypedef struct MyStack\n{\n    LinkQueue q1;\n    LinkQueue q2;\n}MyStack;\n\nStatus InitMyStack(MyStack* pmys);\nvoid DestroyMyStack(MyStack* pmys);\nvoid ClearMyStack(MyStack* pmys);\nint MyStackLength(const MyStack* pmys);\nbool EmptyMyStack(const MyStack* pmys);\nStatus Push_MyStack(MyStack* pmys, ElemType val);\nStatus GetTop_MyStack(MyStack* pmys, ElemType* pval,int *flag);\nStatus Pop_MyStack(MyStack* pmys, ElemType* pval);\nbool DelFront_LQueue(LinkQueue* plq);\nvoid Show_MyStack(MyStack* pmys);\n#endif\n```\n\n```c\n//.c\n#include\"MyStack.h\"\n#include<stdlib.h>\n#include<stdio.h>\nStatus InitMyStack(MyStack* pmys)\n{\n\tInit_lqueue(&pmys->q1);\n\tInit_lqueue(&pmys->q2);\n\treturn OK;\n}\nvoid DestroyMyStack(MyStack* pmys)\n{\n\tDestroy_lqueue(&pmys->q1);\n\tDestroy_lqueue(&pmys->q2);\n\n}\nvoid ClearMyStack(MyStack* pmys)\n{\n\tClear_lqueue(&pmys->q1);\n\tClear_lqueue(&pmys->q2);\n\n}\nint MyStackLength(MyStack* pmys)\n{\n\treturn Get_Length_lqueue(&pmys->q1) + Get_Length_lqueue(&pmys->q2);\n}\nbool EmptyMyStack(MyStack* pmys)\n{\n\treturn MyStackLength(pmys) == 0;\n}\nStatus Push_MyStack(MyStack* pmys, ElemType val)\n{\n\treturn Push_lqueue(&pmys->q2, val);\n}\nbool MostHaveOneNode_LQueue(LinkQueue* plq)\n{\n\treturn Get_Length_lqueue(plq)<=1;\n}\nStatus GetTop_MyStack(MyStack* pmys, ElemType* pval, int *flag)\n{\n\tint val;\n\tbool goodPop = false;\n\tif (Get_Length_lqueue(&pmys->q1) == 1)\n\t{\n\t\t*pval = pmys->q1.front->next->data;\n\t\t*flag = 1;\n\t\treturn OK;\n\t}\n\tif (!Is_Empty_lqueue(&pmys->q2))\n\t{\n\t\twhile (!MostHaveOneNode_LQueue(&pmys->q2))\n\t\t{\n\t\t\tgoodPop = Pop_lqueue(&pmys->q2, &val);\n\t\t\tif(goodPop)Push_lqueue(&pmys->q1, val);\n\t\t}\n\t\t*flag = 2;\n\t\treturn Front_lqueue(&pmys->q2, pval);\n\t}\n\telse\n\t{\n\t\twhile (!MostHaveOneNode_LQueue(&pmys->q1))\n\t\t{\n\t\t\tgoodPop = Pop_lqueue(&pmys->q1, &val);\n\t\t\tif (goodPop)Push_lqueue(&pmys->q2, val);\n\t\t}\n\t\t*flag = 1;\n\t\treturn Front_lqueue(&pmys->q1, pval);\n\t}\n\t*flag = 0;\n\treturn FALSE;\n}\nStatus Pop_MyStack(MyStack* pmys, ElemType* pval)\n{\n\tif (EmptyMyStack(pmys))return FALSE;\n\tint flag = 0;\n\tGetTop_MyStack(pmys,pval,&flag);\n\tif (flag != 0)\n\t{\n\t\tif (flag == 1)\n\t\t{\n\t\t\tDelFront_LQueue(&pmys->q1);\n\t\t}\n\t\telse if (flag == 2)\n\t\t{\n\t\t\tDelFront_LQueue(&pmys->q2);\n\t\t}\n\t}\n\treturn TRUE;\n\t/*\n\tint val;\n\tif (!Is_Empty_lqueue(&pmys->q2))\n\t{\n\t\twhile (!MostHaveOneNode_LQueue(&pmys->q2))\n\t\t{\n\t\t\tPop_lqueue(&pmys->q2, &val);\n\t\t\tPush_lqueue(&pmys->q1, val);\n\t\t}\n\t\treturn Pop_lqueue(&pmys->q2, pval);\n\t}\n\telse if (!Is_Empty_lqueue(&pmys->q1))\n\t{\n\t\twhile (!MostHaveOneNode_LQueue(&pmys->q1))\n\t\t{\n\t\t\tPop_lqueue(&pmys->q1, &val);\n\t\t\tPush_lqueue(&pmys->q2, val);\n\t\t}\n\t\treturn Pop_lqueue(&pmys->q1, pval);\n\t}\n\treturn FALSE;\n\t*/\n}\nbool DelFront_LQueue(LinkQueue *plq)\n{\n\tif (plq->front->next == NULL)return false;\n\tQNode* s = plq->front->next;\n\tplq->front->next = s->next;\n\tplq->tail = plq->front;\n\tfree(s);\n\treturn true;\n}\nvoid Print_Queue_Reverse(LinkQueue* plq)\n{\n\tLinkStack ls;\n\tInitStack(&ls);\n\tQNode* p = plq->front->next;\n\twhile (p != NULL)\n\t{\n\t\tPush_Stack(&ls, p->data);\n\t\tp = p->next;\n\t}\n\tShow_Stack(&ls);\n\tDestroyStack(&ls);\n}\nvoid Show_MyStack(MyStack* pmys)\n{\n\tPrint_Queue_Reverse(&pmys->q2);\n\tPrint_Queue_Reverse(&pmys->q1);\n\tprintf(\"\\n\");\n}\n```\n\n# æµ‹è¯•\n\n```c\n//TestMyQueue.cpp\n#if 0\n#include\"MyQueue.h\"\nint main()\n{\n\tMyQueue myq;\n\tInit_MyQueue(&myq);\n\tint n = 10;\n\tfor (int i = 0; i < n;i++)\n\t{\n\n\t\tPush_MyQueue(&myq, i);\n\t\tShow_MyQueue(&myq);\n\t}\n\tint val;\n\tfor (int i = 0; i < n;i++)\n\t{\n\n\t\tPop_MyQueue(&myq, &val);\n\t\tShow_MyQueue(&myq);\n\t}\n\tDestroy_MyQueue(&myq);\n\t//Show(&lq);\n\treturn 0;\n}\n#endif\n```\n\n```c\n//TestMyStack.cpp\n\n#include\"MyStack.h\"\nint main()\n{\n\tMyStack myq;\n\tInitMyStack(&myq);\n\tint n = 10;\n\tfor (int i = 0; i < n;i++)\n\t{\n\t\tPush_MyStack(&myq, i);\n\t\tShow_MyStack(&myq);\n\t}\n\tint val;\n\tfor (int i = 0; i < n;i++)\n\t{\n\t\tPop_MyStack(&myq, &val);\n\t\tShow_MyStack(&myq);\n\t}\n\tDestroyMyStack(&myq);\n\t//Show(&lq);\n\treturn 0;\n}\n```\n\n","categories":["åŸºç¡€æ•°æ®ç»“æ„"]},{"title":"Redis_è·³è·ƒè¡¨","url":"/Redis/Redis_è·³è·ƒè¡¨/","content":"\n# å†…å®¹\n\n# å¹³è¡¡æ ‘\n\nå¹³è¡¡æ ‘(Balance Treeï¼ŒBT) æŒ‡çš„æ˜¯ï¼Œ**ä»»æ„èŠ‚ç‚¹çš„å­æ ‘çš„é«˜åº¦å·®éƒ½å°äºç­‰äº1**ã€‚å¸¸è§çš„ç¬¦åˆå¹³è¡¡æ ‘çš„æœ‰ï¼ŒBæ ‘ï¼ˆå¤šè·¯å¹³è¡¡æœç´¢æ ‘ï¼‰ã€AVLæ ‘ï¼ˆäºŒå‰å¹³è¡¡æœç´¢æ ‘ï¼‰ç­‰ã€‚å¹³è¡¡æ ‘å¯ä»¥å®Œæˆé›†åˆçš„ä¸€ç³»åˆ—æ“ä½œ, æ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦ç›¸å¯¹äºâ€œ2-3æ ‘â€è¦ä½ï¼Œåœ¨å®Œæˆé›†åˆçš„ä¸€ç³»åˆ—æ“ä½œä¸­å§‹ç»ˆä¿æŒå¹³è¡¡ï¼Œä¸ºå¤§å‹æ•°æ®åº“çš„ç»„ç»‡ã€ç´¢å¼•æä¾›äº†ä¸€æ¡æ–°çš„é€”å¾„ã€‚\n\n","categories":["é«˜çº§æ•°æ®ç»“æ„","Redis"]},{"title":"è®¡ç®—æœºçŸ¥è¯†ä½“ç³»2021_1009","url":"/è®¡ç®—æœºçŸ¥è¯†ä½“ç³»/è®¡ç®—æœºçŸ¥è¯†ä½“ç³»2021_1009/","content":"# å†…å®¹\n\nä»Šå¤©æ€»ç»“çš„å†…å®¹æ˜¯ä¸€ä¸ªå‘æ•£æ€§å’Œç³»ç»Ÿæ€§éƒ½æœ‰çš„ã€‚\n\nå…ˆè¦æŠŠæ•´ä¸ªæ“ä½œç³»ç»Ÿçš„ä½“ç³»å»ºç«‹èµ·æ¥ï¼Œå­˜å‚¨ä½“ç³»ã€è¿›ç¨‹å’Œçº¿ç¨‹ä½“ç³»ã€‚ä¸‹å»ä¹‹åçœ‹æ“ä½œç³»ç»Ÿå“²å­¦ã€ç¨‹åºå‘˜è‡ªæˆ‘ä¿®å…»ã€æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ\n\nä»åº”ç”¨å±‚ç©¿åˆ°åº•å±‚ã€‚\n\nå†…å­˜æ–¹é¢ï¼šé€šè¿‡newå’ŒmallocåŒºåˆ«ç©¿åˆ°ï¼šå†…å­˜å¼€è¾Ÿåº•å±‚çš„å®ç°ã€å†…å­˜çš„ç®¡ç†ã€é¡µé¢çš„è°ƒæ¢ã€‚\n\nè°·æ­Œçš„tmallocæºç ä¸‹è½½ä¸‹æ¥åˆ†æï¼Œä¸ä¼šé—®è€å¸ˆã€‚\n\n# Cè¯­è¨€çš„æ•´ä¸ªåŸºç¡€\n\n1. ç»“æ„ä½“çš„ä½¿ç”¨--è®¾è®¡ç»“æ„ä½“--æ•°æ®ç»“æ„\n2. å‡½æ•°æŒ‡é’ˆ\n\n# `C++`çš„æ ¸å¿ƒ\n\nå­¦ä¹ `C++`ï¼šå…ˆç»ƒï¼ˆè¿˜æ˜¯å¿µï¼Ÿæ²¡å¬æ¸…ï¼‰ï¼Œå°±æ˜¯å…ˆç†è§£é¢å‘å¯¹è±¡çš„æ€æƒ³ï¼Œç„¶åç”¨ã€‚`C++`ä¸­æœ€ä¸»è¦çš„æ˜¯çµæ´»ä½¿ç”¨STLã€‚STLæœ‰å‡ ä¸ªé‡è¦çš„ç‚¹ï¼šï¼ˆVectorã€Listæ¯”è¾ƒç®€å•ï¼Œåˆ¨é™¤äº†ï¼‰Mapã€HashMapã€HashSetï¼Œä¸è¦å‰–æVS2019çš„æºç ï¼Œå› ä¸ºå¤ªéš¾äº†ï¼Œå‰–æVC6.0æˆ–ç‰ˆæœ¬æ¯”è¾ƒä½çš„ã€‚**Hashç±»çš„STLä¸­ï¼ŒHashMapæ˜¯æœ€é‡è¦çš„ä¸€ä¸ªç‚¹**ï¼Œå…¶åº•å±‚æ˜¯çº¢é»‘æ ‘å®ç°çš„ï¼Œä½†çº¢é»‘æ ‘é—®çš„ä¸å¤šï¼Œæ’‘æ­»é—®ä¸€ä¸ªæ ‘çš„å·¦æ—‹å³æ—‹ã€‚**ä¸»è¦æ˜¯è®©ä½ å®ç°HashMapï¼ˆæ— åºï¼‰ä»£ç **ã€‚\n\n`C++`æ›´é‡è¦çš„æ˜¯ï¼š\n\n`C++11`æ–°ç‰¹æ€§å¾ˆé‡è¦ï¼Œå¯ä»¥çœ‹ä¸€æœ¬ä¹¦`C++11`æ–°ç‰¹æ€§ã€‚**æœ€é‡è¦çš„æ˜¯å³æ™ºèƒ½æŒ‡é’ˆ**ã€‚æ™ºèƒ½æŒ‡é’ˆé—®çš„é—®é¢˜å¤ªå¤šå¤ªå¤šäº†ã€‚**STLã€æ™ºèƒ½æŒ‡é’ˆä¼šç”¨ï¼Œ`C++`å°±åˆ°å¤´äº†**ã€‚\n\n`C++`ç»“æŸåï¼Œæ›´é‡è¦çš„æ˜¯ä¿®ç‚¼å†…åŠŸã€‚\n\næ“ä½œç³»ç»Ÿçš„ä¸¤ä¸ªç‚¹ï¼šè¿›ç¨‹ã€å†…å­˜ã€‚I/Oã€å¤šæ ¸å¯ä»¥äº†è§£ä¸€ä¸‹ï¼Œå…¶ä»–çš„ä¸é‡è¦ã€‚\n\n## å†…å­˜\n\né¡µé¢ç½®æ¢ç®—æ³•ï¼šä¹ä¸ªæˆ–å…«ä¸ªï¼Œè€å¸ˆå®ç°LRUç®—æ³•ï¼Œæ—¶é’Ÿç®—æ³•è‡ªå·±å®ç°ï¼Œå¹¶ä¸”è¦è®²æ¸…æ¥šï¼Œæ‰å¯ä»¥ä¸‹è¾¾`C++`ä»£ç ã€‚\n\n**ä»»åŠ¡1ï¼ˆä¸€å‘¨å®Œæˆï¼‰**ï¼šé¢è¯•å¯èƒ½ä¼šé—®åˆ°ï¼šå¦‚æœä½ å®šä¹‰äº†ä¸€ä¸ªå˜é‡ï¼Œä½ èƒ½å¦**æ‰“å°å‡ºå…¶çœŸå®çš„ç‰©ç†åœ°å€**ï¼Ÿåˆ™æˆ‘ä»¬å¿…é¡»å¯¹æ•´ä¸ªLINUXçš„å†…å­˜ç®¡ç†åŸç†éå¸¸ç†Ÿæ‚‰æ‰å¯ä»¥ã€‚\n\nå¦‚æœèƒ½åˆ†æå‡ºçœŸå®çš„ç‰©ç†åœ°å€ï¼Œåˆ™æŠ¥æ–‡åŸç†ã€å†™æ—¶æ‹·è´åŸç†ï¼ˆforkçš„åŸç†ï¼‰å°±ä¼šç«‹é©¬æ˜ç™½ã€‚\n\n**ä»»åŠ¡2**ï¼šçˆ¶è¿›ç¨‹å»ºç«‹é“¾è¡¨ï¼Œå­è¿›ç¨‹ä¹Ÿè¦ä½¿ç”¨é“¾è¡¨ï¼Œå­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹ä¸æ”¹å˜æ•°æ®å€¼ã€‚\né¦–å…ˆåœ¨çˆ¶è¿›ç¨‹å»ºç«‹é“¾è¡¨ï¼Œåˆ›å»ºå­è¿›ç¨‹ï¼Œæ‰“å°æ¯ä¸ªåœ°å€å’Œå€¼ï¼Œçˆ¶è¿›ç¨‹ä¹Ÿå¦‚æ˜¯ã€‚å½“å­è¿›ç¨‹æˆ–çˆ¶è¿›ç¨‹æ”¹å˜æŸä¸ªèŠ‚ç‚¹æ•°æ®å€¼åï¼Œåœ¨å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹å†æ¬¡æ‰“å°é“¾è¡¨çš„åœ°å€ã€‚å¯¹ç…§é“¾è¡¨æœ‰ä½•å˜åŒ–ã€‚\næœ¬è´¨é—®é¢˜å°±æ˜¯ï¼šåŸæ¥æˆ‘ä»¬è®²è¿‡ï¼Œå±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡äº§ç”Ÿå†™æ—¶æ‹·è´ï¼Œé‚£ä¹ˆæˆ‘ä»¬**åœ¨å †åŒºå¦‚ä½•äº§ç”Ÿå†™æ—¶æ‹·è´**ï¼Ÿ\n\n## è¿›ç¨‹\n\n1. çˆ¶è¿›ç¨‹æ„é€ äº†ä¸ªå¯¹è±¡5ï¼Œ**forkåå­è¿›ç¨‹ä¼šä¸ä¼šè¿˜è¦è°ƒç”¨æ„é€ å‡½æ•°**ï¼Ÿå½“å¯¹è±¡çš„å±€éƒ¨å‘ç”Ÿæ”¹å˜åï¼Œæ‰“å°å¯¹è±¡åœ°å€ã€‚è¿™é—®é¢˜ä¼šç‰µæ‰¯åˆ°åç»­çš„ç»§æ‰¿å†…å®¹ï¼Œæœ‰å¤šæ€ï¼Œå­˜åœ¨è™šè¡¨é—®é¢˜ã€‚\n2. è¿›ç¨‹é—´çš„é€šä¿¡æœ‰å“ªå‡ ç§ï¼Ÿç®¡é“ã€å…±äº«å†…å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—ã€‚å¦‚æœå†…å­˜çŸ¥è¯†ä¸æ‡‚ï¼Œåˆ™ä¸ä¼šç†è§£ã€‚ä¸€æ—¦è¦å…±äº«å†…å­˜ï¼Œå°±ä¼šæœ‰äº’æ–¥ã€åŒæ­¥é—®é¢˜ã€‚äº’æ–¥é‡ã€äº’æ–¥é”ã€ä¿¡å·é‡ã€åŸå­æ“ä½œã€æ¡ä»¶å˜é‡ã€‚**ä»»åŠ¡3**ï¼šåŸå­æ“ä½œçš„åº•å±‚å®ç°æ˜¯ï¼Ÿææ¸…åŸå­æ“ä½œï¼Œå°±å¯ä»¥ææ¸…ä¿¡å·é‡ã€äº’æ–¥é‡ã€‚\n\n# `C/C++`é¢è¯•\n\nCå’Œ`C++`çš„é¢è¯•ï¼Œé‡ç‚¹ä¸åœ¨è¯­æ³•ä¸Šï¼Œè€Œæ˜¯é€è¿‡é—®é¢˜Cå’Œ`C++`ç©¿å…¥åˆ°æ“ä½œç³»ç»Ÿã€‚\n\n## newå’ŒmallocåŒºåˆ«\n\n1. newæ˜¯å…³é”®å­—ï¼Œmallocæ˜¯å‡½æ•°ï¼Œnewè°ƒç”¨mallocã€‚\n2. newå’Œmallocéƒ½æ˜¯åœ¨å †åŒºç”³è¯·ç©ºé—´\n3. newæœ‰ä¸‰ä¸ªæ­¥éª¤\n    1. å¼€è¾Ÿç©ºé—´\n    2. æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–å¯¹è±¡ã€‚\n    3. è¿”å›åœ°å€\nå¦‚æœè€ƒè™‘CPUçš„ä¸²è¡Œã€å¹¶è¡Œï¼Œåˆ™2ã€3æ­¥å¯èƒ½ä¼šé¡ºåºä¸ä¸€è‡´ã€‚æœ‰å¯èƒ½è¿˜æ²¡æ„å»ºå¯¹è±¡å°±æ‹¿åˆ°äº†åœ°å€ï¼Œä¼šå¯¼è‡´é”™è¯¯ã€‚æˆ‘ä»¬éœ€è¦å¼ºåˆ¶å…¶æŒ‰ç…§2ã€3é¡ºåºæ¥ã€‚\n4. newä¸ä¼šå¼ºè½¬è¿”å›å€¼ç±»å‹ï¼Œmallocéœ€è¦ç¨‹åºå‘˜å¼ºè½¬ã€‚\n5. newå°è£…è®¡ç®—sizeofï¼Œè€Œmallocéœ€è¦ç¨‹åºå‘˜æ¸…æ¥šè¦å¼€è¾Ÿçš„ç©ºé—´ã€‚\n6. ç©ºé—´ä¸è¶³æ—¶ï¼Œnewä¼šæŠ›å¼‚å¸¸ï¼ˆ`bad_alloc`ï¼‰ï¼Œä¸ä¼šæ‰§è¡Œè¿”å›æ“ä½œã€‚`malloc`ä¼šè¿”å›ç©ºæŒ‡é’ˆã€‚ï¼ˆ`int *p = new(nothrow) int(20);//æˆ‘ä»¬å¯ä»¥åŠ nothrowç¦æ­¢æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™è¿”å›ç©ºæŒ‡é’ˆ`ï¼‰\n7. é‡Šæ”¾æ—¶ï¼Œå¦‚æœå¯¹è±¡æ˜¯å†…ç½®ç±»å‹ï¼Œdeleteå’Œfreeå¯ä»¥æ··ç”¨ã€‚è‡ªå·±è®¾è®¡çš„ç±»å‹ï¼Œå¦‚æœæ²¡æœ‰ææ„å‡½æ•°ã€ç»§æ‰¿å…³ç³»ï¼Œä¹Ÿæ²¡æœ‰è™šå‡½æ•°ï¼Œåˆ™ä¹Ÿå¯ä»¥æ··ç”¨ï¼›å¦‚æœä½ è®¾è®¡çš„newæ˜¯ä¸€ä¸ªå®Œå…¨çš„é¢å‘å¯¹è±¡çš„å†™æ³•ï¼Œåˆ™ä¸å¯ä»¥æ··ç”¨ã€‚\n8. newæ˜¯ä¸ªå…³é”®å­—ï¼Œå¯ä»¥é‡è½½ï¼›mallocæ˜¯å‡½æ•°ï¼Œä¸å¯ä»¥é‡è½½ã€‚é‡è½½newï¼Œåœ¨ç±»ä¸­é‡è½½çš„newå’Œdeleteçš„æœ€å¤§ç‰¹ç‚¹æ˜¯å…¶å…·æœ‰é™æ€ç‰¹æ€§ï¼Œæ²¡æœ‰thisæŒ‡é’ˆã€‚ä¸ºä»€ä¹ˆç±»ä¸­é‡è½½çš„newæ²¡æœ‰thisæŒ‡é’ˆï¼ŸthisæŒ‡å‘å½“å‰å¯¹è±¡ï¼Œnewéœ€è¦ç»™å½“å‰å¯¹è±¡å¼€è¾Ÿåœ°å€ï¼Œè°ƒåŠ¨newçš„æ—¶å€™ï¼Œè¿˜ä¸å­˜åœ¨å¯¹è±¡ï¼Œé‚£ä¹ˆæ— æ³•ä¼ é€’thisæŒ‡é’ˆã€‚\n\né€è¿‡è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥è”æƒ³åˆ°ï¼š\n\n**C++çš„æ ¸å¿ƒæ€æƒ³**ï¼šåœ°å€å’Œç©ºé—´åˆ†ç¦»ã€‚å°±æ¯”å¦‚ï¼Œå±€éƒ¨å¯¹è±¡çš„å®šä¹‰æ—¶åˆ†é…çš„ç©ºé—´æ˜¯ç³»ç»Ÿç®¡ç†çš„ï¼Œæ„é€ å‡½æ•°æ˜¯æ— èƒ½åŠ›å¼€è¾Ÿç©ºé—´çš„ï¼Œåªæ˜¯åœ¨ç©ºé—´ä¸­æ„å»ºå‡ºæ¥ã€‚æ‰€ä»¥ï¼Œæœ‰ç©ºé—´ä¸ä¸€å®šæœ‰å¯¹è±¡ï¼Œæœ‰å¯¹è±¡ä¸€å®šæœ‰ç©ºé—´ã€‚\n\né’ˆå¯¹è¿™ä¸ªæ€æƒ³ï¼Œæœ‰ä¸€ä¸ªä¾‹å­ï¼šç±»ä¸­æ²¡æœ‰ä»»ä½•æŒ‡ä»¤ã€æˆå‘˜çš„sizeofæ˜¯1ï¼Œå¯¹è±¡å ç©ºé—´å¤§å°ä¹Ÿæ˜¯1å­—èŠ‚ã€‚å› ä¸ºå®ƒè‡³å°‘è¦ä½“ç°å®ƒå­˜åœ¨ç€ï¼Œèµ·å ä½ç¬¦ä½œç”¨ã€‚\n\n## newçš„ä¸‰ç§è°ƒç”¨å½¢å¼\n\n1. å…³é”®å­—\n```c++\nint *p = new int(10);\n```\n2. å‡½æ•°\n```c++\nint *p = ::operator new(sizeof(int));  //malloc\n```\nç±»ä¼¼äºè°ƒç”¨mallocï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰åŒºåˆ«ï¼Œè¿™ä¸ªå½¢å¼çš„newå†…å­˜ä¸è¶³æ—¶è¿˜æ˜¯ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚\n3. å®šä½new\nå®šä½newå°±æ˜¯å¯¹å·²æœ‰çš„ç©ºé—´ï¼Œåœ¨ç©ºé—´ä¸­æ‹¿å®šä½newæ¥æ„å»ºä½ è®¤ä¸ºçš„å¯¹è±¡ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºarä¼ é€’è¿›å»ä¹‹åï¼Œä¼ é€’è¿›çš„æ˜¯ä¸ªæ— ç±»å‹æŒ‡é’ˆï¼Œæ— ç±»å‹æŒ‡é’ˆåœ¨åœ°å€èŒƒå›´å†…æ„å»ºå¯¹è±¡å°±å¯ä»¥äº†ï¼Œä¸ç®¡åŸæ¥æ˜¯ä»€ä¹ˆè´§ï¼Œæˆ‘ç°åœ¨è®¤ä¸ºï¼šæœ‰åœ°å€å³å¯æ„å»ºå¯¹è±¡ã€‚å¯¹ç³»ç»Ÿå†…éƒ¨æ¥è¯´ï¼Œè®¤ä¸ºæœ‰ç©ºé—´æˆ‘å°±èƒ½æŠŠåœ°å€æ„å»ºåˆ°ï¼Œè€Œå›åˆ°ç”¨æˆ·ç©ºé—´ä¸‹åšçš„è¯ï¼Œæ•´å‹æ•°ç»„é‡Œå°±ä¸èƒ½æœ‰å¯¹è±¡äº†ã€‚ä½†å¯¹ç³»ç»Ÿæ¥è¯´ï¼Œä¸ç®¡ç±»å‹ï¼Œæˆ‘å°±æ˜¯å¯ä»¥æ„å»ºã€‚\n```c++\nint ar[10];\nnew(ar) Test(10);//æŠŠå¯¹è±¡æ„å»ºåˆ°æ•°ç»„ä¸­äº†ã€‚è·¨è¶Šäº†ç±»å‹çš„éšœç¢ã€‚\n```\n## malloc\n\n1. newå’Œmallocéƒ½æ˜¯è°ƒç”¨mallocæ¥åˆ†é…ç©ºé—´\n2. mallocçš„åº•å±‚å®ç°æ˜¯è°ƒç”¨tmallocå’Œpmallocï¼Œå¤§å—å†…å­˜ã€å°å—å†…å­˜ç»„ç»‡æ–¹æ¡ˆä¸ä¸€æ ·ã€‚è¿™ä¸ªé—®é¢˜å°±ç‰µæ‰¯åˆ°äº†å†…å­˜æ± ã€‚ç†è§£å†…å­˜æ± åï¼Œmallocåº•å±‚æ•ˆç‡ä½ï¼Œæˆ‘ä»¬éœ€è¦å†™è‡ªå·±çš„å†…å­˜æ± æ¥å¢åŠ æ•ˆç‡ï¼Œæ¯”å¦‚è°·æ­Œçš„tmallocï¼Œé‚£ä¹ˆä¸STLä¸­çš„å†…å­˜æ± æœ‰ä½•åŒºåˆ«ï¼Ÿ\n3. è°·æ­Œçš„tmallocå¦‚æœè€ƒè™‘åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæœ‰å¯èƒ½ä½ è°ƒçš„æ˜¯1å·çº¿ç¨‹ç»™ä½ åˆ†é…ï¼Œæœ‰å¯èƒ½æ˜¯2å·ï¼Œçº¿ç¨‹å¤šäº†ä¹‹åï¼Œå¯ä»¥åŠ é€Ÿåˆ†é…é€Ÿåº¦ã€‚çº¿ç¨‹æœ‰è‡ªå·±çš„çº¿ç¨‹æ± ï¼Œå¹¶ä¸å†²çªã€‚ä½†æ˜¯å¦‚æœè¦çš„ç©ºé—´æ¯”è¾ƒå¤§æ—¶ï¼Œè¦åœ¨åº•å±‚å¯¹å¤§ç©ºé—´è¿›è¡Œä¸€ä¸ªç»Ÿä¸€çš„å¼€è¾Ÿï¼Œå¹¶ä¸”ä¼šäº§ç”Ÿç«äº‰ï¼Œåˆ™ä¼šå‡ºç°åŒæ­¥é—®é¢˜ã€‚åˆ™ä¼šå‡ºç°ä»¥ä¸‹ç°è±¡ï¼šåŸæ¥æ˜¯1å·çº¿ç¨‹åˆ†é…çš„ç©ºé—´ï¼Œé‡Šæ”¾æ—¶ç”¨çš„2å·çº¿ç¨‹ã€‚åŸæ¥æ˜¯2å·çº¿ç¨‹åˆ†é…çš„ç©ºé—´ï¼Œé‡Šæ”¾æ—¶ç”¨çš„1å·çº¿ç¨‹ã€‚é‚£ä¹ˆç©ºé—´å¦‚ä½•æœ‰ä¸€ä¸ªç»Ÿä¸€çš„æ–¹æ³•è¿˜å›å»ï¼Ÿçº¿ç¨‹æ± ä»æŸåœ°æ–¹æ‹¿äº†ä¸€å—ç»™å¦ä¸€æ–¹ï¼Œè¿˜å›çš„æ—¶å€™æ˜¯ç¬¬äºŒä¸ªçº¿ç¨‹è¿˜ï¼Œé‚£ä¹ˆå°±ä¼šæŠŠè¿™ä¸€å—æ”¾åˆ°çº¿ç¨‹ç©ºé—´é‡Œã€‚æ‰€ä»¥æœ‰å¯èƒ½ä»1å·çš„è¿˜ç»™2å·ï¼Œæœ‰å¯èƒ½ä»2å·æ¥çš„ï¼Œè¿˜ç»™1å·ã€‚\n## ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼ï¼Ÿ\n\n1. å†…å­˜æ³„éœ²çš„æœ¬è´¨åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ\n    1. å†…å­˜æ³„æ¼ç»ä¸æ˜¯ç®€å•çš„mallocåæ²¡æœ‰freeã€‚è¿›ç¨‹ç»“æŸåï¼Œmallocçš„å†…å­˜éƒ½ä¼šé‡Šæ”¾ã€‚**å› ä¸ºæˆ‘ä»¬è¿›ç¨‹ä½¿ç”¨çš„æ˜¯è™šæ‹Ÿåœ°å€ï¼Œæˆ‘ä»¬ä¼šåœ¨è¿›ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œæ’¤é”€è™šæ‹Ÿåœ°å€åœ¨ç‰©ç†åœ°å€çš„æ˜ å°„å…³ç³»ã€‚**\n2. å†…å­˜ä¸è¶³æ—¶ï¼Œæˆ‘ä»¬é‡‡å–çš„æ”¿ç­–æ˜¯ä»€ä¹ˆï¼Ÿ\n## è¿›ç¨‹åŒæ­¥ç»å…¸é—®é¢˜\n\n1. ç”Ÿäº§è€…-æ¶ˆè´¹è€…ï¼šé¢è¯•ä¸­ç»ä¹…ä¸è¡°çš„é—®é¢˜ï¼Œå› ä¸ºç”¨åˆ°çš„åœºæ™¯å¤ªå¤šäº†ã€‚ä¸æ’­æ”¾æœ‰å…³çš„éƒ½æ˜¯è¿™ç§é—®é¢˜ã€‚\n    1. çŸ­è§†é¢‘è½¯ä»¶å°±æ˜¯ä¸€ä¸ªç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ã€‚æœ‰ç¯å½¢çš„ç¼“å†²æ± ï¼Œæœ‰å€’æ°´è€…ï¼ˆæœåŠ¡å™¨ï¼‰ã€æ¥æ°´è€…ï¼ˆç”¨æˆ·ï¼‰ã€‚\n    2. å¦‚æœåªæœ‰ä¸€ä¸ªæ± å­ï¼šä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œé˜Ÿå¤´å’Œé˜Ÿå°¾éœ€è¦ä¸€ç›´è¿­ä»£ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦è®¡ç®—é˜Ÿåˆ—ä¸­çš„ä¸ªæ•°ï¼Œéœ€è¦é˜Ÿå°¾ã€é˜Ÿå¤´ç›¸å‡ï¼Œåˆ™éœ€è¦é”ä½é˜Ÿå¤´å’Œé˜Ÿå°¾æŒ‡é’ˆï¼Œåˆ™ä¸èƒ½çŒæ°´ã€å–æ°´ã€‚\n    3. ä¸‰ä¸ªæ± å­æ¥å›å€’ï¼šå…ˆæŠŠä¸€ä¸ªæ± å­æ³¨æ»¡ï¼Œæ³¨æ»¡åæŠŠæ± å­æ‹‰ç»™æ’­æ”¾å™¨ã€‚æ¥ç€ç»™å¦ä¸€ä¸ªæ± å­æ³¨ï¼Œè¿™æ ·æ¥è¯´ï¼Œä¸¤ä¸ªæ± å­æ˜¯ç‹¬ç«‹çš„ã€‚å¹¶è¡Œèƒ½åŠ›æå‡äº†ã€‚ä»£ä»·æ˜¯è¦æœ‰ä¸¤ä¸ªæ± å­çš„èµ„æºã€‚\n2. å“²å­¦å®¶è¿›é¤ï¼Œé¿å…æ­»é”\n3. è¯»è€…-å†™è€…é—®é¢˜ï¼šå®é™…ä¸Šæ˜¯ç”Ÿäº§è€…-æ¶ˆè´¹è€…çš„å˜ç§é—®é¢˜\n    1. è¯»è€…ä¸å¯æ”¹å†…å®¹ï¼Œå†™è€…å¯æ”¹ã€‚è¯»è€…å¯ä»¥å¹¶å‘ï¼Œè¯»è€…å’Œå†™è€…äº’æ–¥ï¼Œè¯»è€…å’Œè¯»è€…å¹¶å‘ï¼Œå†™è€…å’Œå†™è€…äº’æ–¥ã€‚ä»£ç æ¯”è¾ƒå°ï¼Œä½†æ˜¯è¦ä½ è®¾è®¡æ¡†æ¶ã€‚\n4. å®ç°ä¿¡å·é‡ï¼šç»™ä¸Šä¸‰ä¸ªçº¿ç¨‹ï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰“å°Aï¼Œç¬¬äºŒä¸ªçº¿ç¨‹æ‰“å°Bï¼Œç¬¬ä¸‰ä¸ªçº¿ç¨‹æ‰“å°Cã€‚æ€»å…±æ‰“å°10ä¸ªï¼Œè¦æ±‚å…ˆAåBå†Cã€‚ä¸ç»™ä¿¡å·é‡ï¼Œèƒ½ä¸èƒ½æ‹¿åŸå­æ“ä½œå’Œæ¡ä»¶å˜é‡å®Œæˆï¼Ÿèƒ½ä¸èƒ½æ‹¿æ¡ä»¶å˜é‡å’Œäº’æ–¥é‡å®Œæˆï¼Ÿèƒ½ä¸èƒ½æŠŠåŸå­æ“ä½œã€æ¡ä»¶å˜é‡ã€äº’æ–¥é‡ä¸‰è€…åˆèµ·æ¥ç»„æˆä¸€ä¸ªæ–°çš„ä¿¡å·é‡ï¼Ÿçœ‹ä½ æ˜¯ä¸æ˜¯å­¦é€šäº†ã€‚è¿™å°±é¢è¯•åˆ°äº†å¾ˆæ ¹æœ¬çš„éš¾ç‚¹äº†ã€‚å¹´è–ª40-50Wéƒ½ä¼šé¢åˆ°ã€‚\n\n## è¿›ç¨‹æ± ã€çº¿ç¨‹æ± \n\nå¦‚ä½•å®ç°è¿›ç¨‹æ± ã€çº¿ç¨‹æ± ï¼Ÿ\n\nå­¦äº†TCP/IPå°±èƒ½ä½“ä¼šåˆ°çº¿ç¨‹æ± äº†ã€‚\n\n# ä¹¦\n\n1. æ“ä½œç³»ç»Ÿå“²å­¦\n2. ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»\n    1. çœ‹Linuxå°±å¤Ÿäº†ï¼ŒWindowsä¸çœ‹\nä¸¤æœ¬çœ‹å®Œåï¼Œå¯ä»¥å¼„ä¸€ä¸ª4Gæ–‡ä»¶ï¼Œå†…å­˜ä¸­å–500Mç©ºé—´ï¼Œç©åœ°å€æ˜ å°„ã€‚\n3. csapp\n    1. å­˜å‚¨å™¨\n    2. å†…å­˜ç®¡ç†\n        1. é¡µé¢ç½®æ¢ç®—æ³•\n        2. è¿›ç¨‹ã€çº¿ç¨‹\n4. effective C++\n    1. å¯å½“ä½œå¯¹C++çš„æ‰©å……\n    2. æœ€æœ‰ä»·å€¼çš„æ˜¯ç¬¬å…­ç« ï¼Œåº”è¯¥åå¤å»çœ‹ï¼Œå³ç»§æ‰¿å…³ç³»ã€‚\n5. é™ˆç¡•-LINUX C++ç½‘ç»œåº“\n    1. æ™ºèƒ½æŒ‡é’ˆ\n6. æ·±å…¥ç†è§£C++11\n","categories":["è®¡ç®—æœºçŸ¥è¯†ä½“ç³»"]},{"title":"åŸºç¡€æ•°æ®ç»“æ„_é˜Ÿåˆ—","url":"/åŸºç¡€æ•°æ®ç»“æ„/åŸºç¡€æ•°æ®ç»“æ„_é˜Ÿåˆ—/","content":"# å†…å®¹\n\n# ç‰¹ç‚¹\n\n1. å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰ã€‚\n2. ä¸€ç«¯è¿›è¡Œæ’å…¥ï¼Œå¦ä¸€ç«¯è¿›è¡Œåˆ é™¤çš„çº¿æ€§è¡¨ã€‚\n3. æ²¡æœ‰æœ‰æ•ˆæ•°æ®èŠ‚ç‚¹çš„é˜Ÿåˆ—ç§°ä½œç©ºé˜Ÿã€‚\n## éš¾ç‚¹\n\n1. å¦‚ä½•è®©å…¥é˜Ÿå’Œå‡ºé˜Ÿçš„æ—¶é—´å¤æ‚åº¦éƒ½ä¸ºO(1)ï¼šå°†é¡ºåºé˜Ÿåˆ—è‡†æƒ³æˆä¸€ä¸ªç¯å½¢ã€‚\n2. åˆ¤ç©ºå’Œåˆ¤æ»¡æ¡ä»¶å†²çªï¼Œéƒ½æ˜¯é˜Ÿå¤´==é˜Ÿå°¾\n   1. æ–¹æ¡ˆä¸€ï¼šåŠ ä¸ªæ ‡å¿—ï¼Œä¿å­˜æœ‰æ•ˆå€¼ä¸ªæ•°ã€‚\n   2. æ–¹æ¡ˆäºŒï¼šåœ¨é˜Ÿå°¾æµªè´¹ä¸€ä¸ªç©ºé—´ï¼Œä¸å†ä¿å­˜æœ‰æ•ˆå€¼ï¼Œè€Œæ˜¯ä½œä¸ºä¸€ä¸ªæ ‡è®°ã€‚\n\n# å®ç°\n\n```c\n//queue.h\n#pragma once\n\ntypedef int ElemType;\ntypedef struct Queue\n{\n    ELEM_TYPE *base;\n    int front;\n    int tail;\n    //int cursize;\n}Queue, *PQueue;\n//å¢åˆ æ”¹æŸ¥\n//åˆå§‹åŒ–\nvoid Init_queue(Queue *pq);\n//å…¥é˜Ÿ\nbool Push(Queue *pq, ElemType val);\n//å‡ºé˜Ÿ\nbool Pop(Queue *pq, ElemType *pval);\n//è·å–é˜Ÿå¤´å…ƒç´ å€¼\nbool Head(Queue *pq, ElemType *pval);\n//è·å–æœ‰æ•ˆå€¼ä¸ªæ•°\nint GetLength(Queue *pq);\n//åˆ¤ç©º\nbool IsEmpty(Queue *pq);\n//åˆ¤æ»¡\nbool IsFull(Queue *pq);\n//æ¸…ç©º\nvoid Clear(Queue *pq);\n//é”€æ¯\nvoid Destroy(Queue *pq);\n//show\nvoid Show(Queue *pq);\n```\n\n```c\n//åˆå§‹åŒ–\nvoid Init_queue(Queue *pq)\n{\n    assert(pq!=NULL);\n    pq->base = (ElemType*)malloc(sizeof(ElemType)*MAXSIZE);\n    assert(pq->base !=NULL);\n    pq->front = pq->tail = 0;\n}\n//å…¥é˜Ÿ\nbool Push(Queue *pq, ElemType val)\n{\n    assert(pq!=NULL);\n    if(IsFull(pq))\n    {\n        return false;\n    }\n    pq->base[pa->tail] = val;\n    pq->tail = (pq->tail + 1) % MAXSIZE;\n    return true;\n}\n//å‡ºé˜Ÿ\nbool Pop(Queue *pq, ElemType *pval)\n{\n    if(IsEmpty(pq))\n    {\n        return false;\n    }\n    *pval = pq->base[pq->front];\n    pq->front = (pq->front + 1) % MAXSIZE;\n    return true;\n}\n//è·å–é˜Ÿå¤´å…ƒç´ å€¼\nbool Head(Queue *pq, ElemType *pval)\n{\n    if(IsEmpty(pq))\n    {\n        return false;\n    }\n    *pval = pq->base[pq->front];\n    return true;\n}\n//è·å–æœ‰æ•ˆå€¼ä¸ªæ•°\nint GetLength(Queue *pq)\n{\n\treturn (pq->tail - pq-> front + MAXSIZE) % MAXSIZE;\n}\n//åˆ¤ç©º\nbool IsEmpty(Queue *pq)\n{\n    return pq->front == pq->tail;\n}\n//åˆ¤æ»¡\nbool IsFull(Queue *pq)\n{\n    return (pq->tail+1)%MAXSIZE == pq->front;\n}\n//æ¸…ç©º\nvoid Clear(Queue *pq)\n{\n    pq->tail = pq->front = 0;\n}\n//é”€æ¯\nvoid Destroy(Queue *pq)\n{\n    free(pq->base);\n    pq->base = NULL;\n}\n//show\nvoid Show(Queue *pq)\n{\n    int p = pq->front;\n    while(p != pq->tail)\n    {\n        printf(\"%d \",pq->base[p]);\n        p = (p+1) % MAXSIZE;\n    }\n    printf(\"\\n\");\n}\n```\n\n```c\n//test\n#include\"queue.h\"\nint main()\n{\n    Queue q;\n    Init_queue(&q);\n    for(int i = 0;i<20;i++)\n    {\n        Push(&q,i+1);\n    }\n    \n    Show(&q);\n    \n    for(int i = 0;i<5;i++)\n    {\n        int tmp;\n        Pop(&q,&tmp);\n        printf(\"%d\\n\",tmp);\n    }\n    Show(&q);\n    \n    printf(\"%d \\n\",GetLength(&q));\n    \n    Clear(&q);\n    Show(&q);\n    Destroy(&q);\n    return 0;\n}\n```\n\n# é“¾é˜Ÿåˆ—\n\n```c\n//lqueue.h\ntypedef L\n```\n\n\n\n```c\n//lqueue.cpp\n\n```\n\n\n\n```c\n//test.cpp\n```\n\n","categories":["åŸºç¡€æ•°æ®ç»“æ„"]},{"title":"Cpp_é¢å‘å¯¹è±¡_åˆæ¢","url":"/Cpp/Cpp_é¢å‘å¯¹è±¡_åˆæ¢/","content":"# å†…å®¹\n\nå››å¤§ç‰¹æ€§ï¼šæŠ½è±¡ã€å°è£…ã€ç»§æ‰¿ã€å¤šæ€\n# æ¦‚è¿°\n\n1. ç¼–ç¨‹è¯­è¨€ï¼šæ˜¯ä¸ºäº†æ¨¡æ‹Ÿç°å®è€Œäº§ç”Ÿçš„\n    1. å°±æ¯”å¦‚è¦æ¨¡æ‹Ÿpersonç±»ï¼šæˆ‘ä»¬è¦æè¿°äººï¼Œå°±è¦æŠ½è±¡ä¸ºæ•°æ®\n2. é¢å‘å¯¹è±¡å°±æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿç°å®å¾ˆå¥½çš„æ€æƒ³\n    1. å±æ€§----æˆå‘˜å±æ€§ï¼šsex, age\n    2. è¡Œä¸º----æˆå‘˜æ–¹æ³•ï¼šwork, eat\n## thisæŒ‡é’ˆ\n\nthisæŒ‡é’ˆæ˜¯æŒ‡å‘æœ¬å¯¹è±¡çš„æŒ‡é’ˆã€‚\n\n`C++`å’ŒCçš„åŒºåˆ«ï¼Œå¾ˆæ˜æ˜¾çš„æ˜¯ï¼Œ`C++`ä¼šåœ¨ç¼–è¯‘æ—¶æœŸæš—ä¸­åšå¾ˆå¤šäº‹æƒ…ï¼Œå…¶æ¬¡çš„åŒºåˆ«å°±æ˜¯`C++`å°è£…ã€‚\n\nå°±æ¯”å¦‚å®šä¹‰æˆå‘˜æ–¹æ³•æ—¶ï¼Œ`C++`å°±åœ¨ç¼–è¯‘æ—¶æœŸä¸ºæˆ‘ä»¬åŠ ä¸Šäº†ï¼š\n1. åœ¨å‡½æ•°æ™®é€šæˆå‘˜æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°é»˜è®¤æ˜¯æŒ‡å‘æœ¬ç±»å‹çš„thisæŒ‡é’ˆã€‚ï¼ˆ`Class_Name* const this`ï¼‰\n2. åœ¨æ™®é€šæˆå‘˜æ–¹æ³•å†…ï¼Œä½¿ç”¨åˆ°æ™®é€šæˆå‘˜çš„åœ°æ–¹ï¼ŒåŠ ä¸Š\"`this->`\"ã€‚\n3. åœ¨è°ƒç”¨æ™®é€šæˆå‘˜æ–¹æ³•çš„æ—¶å€™åŠ ä¸Šå®å‚æ•°thisæŒ‡é’ˆï¼Œæ–¹ä¾¿æ–¹æ³•å†…ä½¿ç”¨ã€‚\n```c++\nclass Person\n{\npublic:\n    int _age;\n    int _sex;\n    char *_name;\n    void work()\n    {\n        cout << _name << \": work\" << endl;\n    }\n    void eat()\n    {\n        cout << _name << \": eat\" << endl;\n    }\n};//åˆ†å·ä¸è¦ä¸¢\n```\næ¯ä¸€ä¸ªæˆå‘˜æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸€èˆ¬é»˜è®¤åœ¨ç¼–è¯‘æœŸæ—¶ï¼Œä¼ å…¥ä¸€ä¸ª(`Class_name * this`)ã€‚\n\nåœ¨ä½¿ç”¨åˆ°æˆå‘˜æ–¹æ³•ã€æˆå‘˜å˜é‡æ—¶ï¼Œä¼šé»˜è®¤åŠ ä¸Š`è§£å¼•ç”¨`ã€‚\n```c++\nvoid work(Person *this)\n{\n    cout << this->_name << \": work\" << endl;\n    this->eat();\n}\n```\n## æ„é€ å‡½æ•°\n\næ„é€ å‡½æ•°å°±æ˜¯ï¼šåœ¨å¯¹è±¡è¿›è¡Œæ„é€ çš„æ—¶å€™ï¼ˆå…¶å®å°±æ˜¯å®šä¹‰ï¼Œ`Person p;`ï¼‰ï¼Œé»˜è®¤è°ƒç”¨çš„æˆå‘˜æ–¹æ³•ã€‚\n1. å¦‚æœæ²¡æœ‰å®ç°æ„é€ å‡½æ•°ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•°\n    1. è‡ªå·±å®ç°äº†ä¹‹åï¼Œå°±ä¸ä¼šè‡ªåŠ¨ç”Ÿæˆã€‚\n    2. é»˜è®¤æ„é€ å‡½æ•°å°±æ˜¯ï¼šé™¤äº†thisæŒ‡é’ˆä»¥å¤–ï¼Œæ²¡æœ‰å‚æ•°çš„æ„é€ å‡½æ•°ã€‚ \n3. æ„é€ å‡½æ•°åå­—ä¸ç±»åä¸€è‡´ï¼Œæ— è¿”å›å€¼ã€‚\n4. æ„é€ å‡½æ•°å¯ä»¥é‡è½½ï¼Œå‚æ•°åˆ—è¡¨ä¸é™åˆ¶ã€‚\n```c++\nPerson(int age, int sex, const char *name)\n{\n    _age = age;\n    _sex = sex;\n    // _name = name; // è¿™æ˜¯æµ…æ‹·è´ï¼šæŒ‡é’ˆç»™æŒ‡é’ˆèµ‹å€¼ï¼›\n    \n    // ä»¥ä¸‹æ˜¯æ·±æ‹·è´ï¼Œç”³è¯·æ–°çš„ç©ºé—´å¡«å……ç›¸åŒå†…å®¹ã€‚\n    _name = new char[strlen(name) + 1];\n    memset(_name, 0, strlen(name) + 1);\n    for(int i = 0; i < strlen(name); ++i)\n    {\n        _name[i] = name[i];\n    }\n    _name[i] = 0; \n}\n```\n## ææ„å‡½æ•°\n\næ˜¯å¯¹è±¡ç”Ÿå­˜å‘¨æœŸæ»¡äº†ä¹‹åï¼ˆæ­»äº¡ï¼‰ï¼Œè‡ªåŠ¨è°ƒç”¨çš„å‡½æ•°ã€‚\n```c++\n~Person()\n{\n    delete[]_name;\n}\n```\n\n1. åœ¨æ ˆæ¡¢ä¸Šï¼Œå…ˆæ„é€ çš„åææ„ã€‚\n2. å¦‚æœæ²¡æœ‰å®ç°ææ„å‡½æ•°ï¼Œç³»ç»Ÿä¼šé»˜è®¤ç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„ææ„å‡½æ•°ã€‚å‡½æ•°ä½“æ˜¯ç©ºçš„ã€‚\n3. è‡ªå·±å®ç°äº†ä¹‹åï¼Œå°±ä¸ä¼šè‡ªåŠ¨ç”Ÿæˆã€‚\n## æ‹·è´æ„é€ å‡½æ•°\n\n1. ç”¨ä¸€ä¸ªå·²å­˜åœ¨çš„å¯¹è±¡ç»™å¦ä¸€ä¸ªæ­£åœ¨ç”Ÿæˆçš„å¯¹è±¡åˆå§‹åŒ–çš„æ—¶å€™è‡ªåŠ¨è°ƒç”¨çš„æˆå‘˜æ–¹æ³•ã€‚\n2. å¦‚æœæ²¡æœ‰è‡ªå·±å®ç°ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªæµ…æ‹·è´çš„æ‹·è´æ„é€ å‡½æ•°ã€‚\n3. å¦‚æœè‡ªå·±å®ç°ï¼Œä¸ä¼šç”Ÿæˆã€‚\n\n```c++\nPerson(const Person& src)\n{\n\t_age = src._age;\n    _sex = src._sex;\n    //é¢„é˜²æµ…æ‹·è´\n    _name = new char[strlen(src._name) + 1];\n    memset(_name, 0, strlen(_name) + 1);\n    for(int i = 0;i < strlen(_name); ++i)\n    {\n        _name[i] = src._name[i];\n    }\n}\nint main()\n{\n    char name1[] = {\"zhangsan\"};\n    Person p1(32, 1, name1);\n    Person p2(p1);//æ‹·è´æ„é€ å‡½æ•°\n}\n```\n\næ³¨æ„ï¼š\n1. æ‹·è´æ„é€ å‡½æ•°--ä¼ é€’å¼•ç”¨çš„ç›®çš„æ˜¯é˜²æ­¢æ­»é€’å½’ã€‚å› ä¸ºä¼ å‚ï¼ˆä¼ å·²å­˜åœ¨çš„å¯¹è±¡ï¼‰çš„æ—¶å€™ï¼Œä¹Ÿä¼šè°ƒç”¨æ‹·è´æ„é€ å‡½æ•°ï¼Œå°±ä¼šä¸€ç›´é€’å½’ä¸‹å»ã€‚\n2. è¦é˜²æ­¢æµ…æ‹·è´ã€‚\n## è¿ç®—ç¬¦é‡è½½\n\n### ç­‰å·è¿ç®—ç¬¦ï¼ˆèµ‹å€¼è¿ç®—ï¼‰\n\nå½“ä½¿ç”¨ä¸€ä¸ªå·²å­˜åœ¨çš„å¯¹è±¡ï¼Œç»™å¦ä¸€ä¸ªå·²å­˜åœ¨çš„å¯¹è±¡èµ‹å€¼çš„æ—¶å€™ï¼Œè‡ªåŠ¨è°ƒç”¨çš„æˆå‘˜æ–¹æ³•ã€‚\n\nå¦‚æœè‡ªå·±ä¸å®ç°ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªæµ…æ‹·è´çš„ç­‰å·è¿ç®—ç¬¦é‡è½½å‡½æ•°ã€‚è‡ªå·±å®ç°äº†åˆ™ä¸ä¼šã€‚\n\n```c++\nvoid operator=(const Person& src)\n{\n    // å¦‚æœæ˜¯è‡ªèµ‹å€¼ï¼Œå¯ä»¥ç›´æ¥è¿”å›\n    if(this == &src)\n    {\n        return;\n    }\n    // åˆ æ‰åŸæœ‰çš„å †ä¸­æˆå‘˜å±æ€§ï¼Œå› ä¸ºé©¬ä¸Šå°±è¦è¦†ç›–ï¼Œåœ°å€ä¼šä¸¢å¤±ï¼Œé˜²æ­¢å†…å­˜æ³„éœ²\n    delete[]_name;\n    //é˜²æ­¢æµ…æ‹·è´\n    _name = new char[strlen(src._name) + 1];\n    memset(_name, 0, strlen(src.name) + 1);\n    for(int i = 0; i < strlen(src._name); ++i)\n    {\n        _name[i] = src._name[i];\n    }\n}\n\n//ä¸ºäº†å¯ä»¥è¿ç­‰ï¼Œå¯ä»¥åŠ ä¸€ä¸ªè¿”å›å€¼ç±»å‹ã€‚\nPerson& operator=(const Person& src)//ä½¿ç”¨å¼•ç”¨èŠ‚çœå†…å­˜ï¼Œé˜²æ­¢å¤šä½™çš„é‡å¤æ„é€ \n{\n    //é˜²æ­¢è‡ªèµ‹å€¼\n    if(this == &src)\n    {\n        return *this;\n    }\n    //é˜²æ­¢å†…å­˜æ³„éœ²\n    delete[]_name;\n    //é˜²æ­¢æµ…æ‹·è´\n    _name = new char[strlen(src._name) + 1];\n    memset(_name, 0, strlen(src._name) + 1);\n    for(int i = 0; i < strlen(src._name); ++i)\n    {\n        _name[i] = src._name[i];\n    }\n    return *this;\n}\n```\n\næ³¨æ„ï¼š\n1. è·³è¿‡è‡ªèµ‹å€¼\n2. é˜²æ­¢å†…å­˜æ³„æ¼\n3. é˜²æ­¢æµ…æ‹·è´\n### ç­‰å·é‡è½½å’Œæ‹·è´æ„é€ åŒºåˆ«\n```c++\nint d(a); // æ‹·è´æ„é€ æ˜¯ç”¨ä¸€ä¸ªå·²å­˜åœ¨çš„å¯¹è±¡å¯¹æ­£åœ¨å®šä¹‰çš„å¯¹è±¡è¿›è¡Œåˆå§‹åŒ–\nint e = a;\n```\n\n```c++\nint c = int();\nc = a; // ç­‰å·é‡è½½ï¼Œä¸¤ä¸ªå¯¹è±¡éƒ½å·²ç»å­˜åœ¨\n```\n## å¯¹è±¡çš„ç”Ÿå­˜å‘¨æœŸ\n\n```c++\nPerson()\n{\n    _name = NULL;\n}\nPerson fun(Person p)\n{\n    int a = 10;\n}\nint main()\n{\n    Person p1(31, 1, \"zhangsan\");\n}\n```\n\n```c++\nPerson p5 = p3;\nPerson p6(p3);\n//ä¸€æ ·\n```\n\n```c++\nPerson p4 = 20;\n/*\nä½¿ç”¨20ç”Ÿæˆä¸´æ—¶å¯¹è±¡-->çœ‹æœ‰æ²¡æœ‰å¯¹åº”çš„æ„é€ å‡½æ•°\nä½¿ç”¨ä¸´æ—¶å¯¹è±¡æ‹·è´æ„é€ p4\nææ„ä¸´æ—¶å¯¹è±¡\n\nå¦‚æœå‡ºç°ä¸Šè¿°æ­¥éª¤ï¼Œä¼šè¢«ç›´æ¥ä¼˜åŒ–æˆæ„é€ p4\n\n--ä¸´æ—¶å¯¹è±¡çš„ç”Ÿå­˜å‘¨æœŸåªåœ¨å½“ä¸‹è¯­å¥ã€‚\n--åœ¨å½“ä¸‹æ ˆå¸§ä¸Šï¼ˆå¦‚mainä¸­çš„ï¼Œè€Œä¸æ˜¯å­å‡½æ•°ä¸­çš„æ ˆå¸§ï¼‰ï¼Œä¸´æ—¶å¯¹è±¡å¦‚æœè¢«å¼•ç”¨ï¼Œä¸´æ—¶å¯¹è±¡çš„ç”Ÿå­˜å‘¨æœŸå°±ä¼šè¢«æå‡ä¸ºå’Œå¼•ç”¨ä¸€è‡´ã€‚\n--æ ˆå¸§æ²¡æœ‰äº†ï¼Œä¸€åˆ‡éƒ½å¤±æ•ˆäº†ã€‚\n*/\n```\n\n```c++\nPerson fun(Person& p)\n{\n    int a = 10;\n    Person tmp(10);\n    return tmp;\n}\nint main()\n{\n    Person p3;\n    p3 = fun(p3);\n    return 0;\n}\n```\n\n# ç»ƒä¹ \n\n## ä½¿ç”¨classå°è£…ä¸€ä¸ªæ•°ç»„\n\n```c++\nclass Arr\n{\npublic:\n    int *_arr;//æŒ‡å‘å †ç©ºé—´\n    int _cap;//å®¹é‡\n    int _cur_len;//å®é™…\n    Arr();\n    Arr(int len);\n    Arr(const Arr& src);\n    Arr& operator=(const Arr& src);\n    ~Arr();\n    \n    void push_back();\n    void pop_back();\n    int front();\n    int back();\n    void show();\n    bool is_full();\n    bool is_empty();\n}\n```\n## å°è£…List\n\n```c++\nclass List\n{\n\tis_empty();\n    push_back();\n    pop_back();\n    push_front();\n    pop_front();\n    \n    ElemType front();\n    ElemType back();\n    \n    int size();\n    \n}\n```\n## å•ä¾‹æ¨¡å¼å®ç°stack/queue\n\n```cpp\n//å†ä¾èµ–é“¾è¡¨å®ç°stackã€queueâ€”â€”å•ä¾‹æ¨¡å¼\nclass Stack\n{\n    pop()\n    {\n        _list.pop_front();\n    }\n    top()\n    {\n        return _list.front();\n    }\n    List _list;\n}\n```\n# class\n\n```c++\nclass Person\n{\npublic:\n    int _age;\n    int _sex;\n    char *_name;\n    void work()\n    {\n        cout << _name << \": work\" << endl;\n    }\n    void eat()\n    {\n        cout << _name << \": eat\" << endl;\n    }\n};//åˆ†å·ä¸è¦ä¸¢\n```\n## private\n\nclassä¸­é»˜è®¤æƒé™æ˜¯privateã€‚\n\n```c++\nint last_name;\n\nclass Person\n{\nprivate:\n    int _age;\n    const int _sex;//å¸¸é‡å¿…é¡»åˆå§‹åŒ–ã€‚\n    char *_name;\n    int& _last_name;//å¼•ç”¨ä¹Ÿå¿…é¡»åˆå§‹åŒ–ã€‚\npublic:\n    Person()\n        :_sex(1),_last_name(last_name)\n    {\n        \n    }\n    Person(int age)\n    {\n        \n    }\n    Person(int age, int sex, const char *name)\n    {\n        _age = age;\n        _sex = sex;\n        _name = new char[strlen(name)+1];\n        memset(name,0,strlen(name)+1);\n        for(int i = 0;i<strlen(name);++i)\n        {\n            _name[i] = name[i];\n        }\n    }\n    Person(const Person& src)\n    {\n        \n    }\n    void operator=(const Person& src)\n    {\n        //é˜²æ­¢è‡ªèµ‹å€¼\n        if(this==src)\n        {\n            return;\n        }\n        //é˜²æ­¢å†…å­˜æ³„éœ²\n        delete[]_name;\n        _name = new char[strlen(src._name)+1];\n        memset(_name,0,strlen(src.name)+1);\n        for(int i = 0;i<strlen(src._name);++i)\n        {\n            _name[i] = src._name[i];\n        }\n    }\n    const char* get_name()\n    {\n\t\treturn this.name;   \n    }\n    int get_age()\n    {\n        return this.age;\n    }\n    void set_age(int age)\n    {\n        _age = age;\n    }\n    void work()\n    {\n        cout << _name << \": work\" << endl;\n    }\n    void eat()\n    {\n        cout << _name << \": eat\" << endl;\n    }\n};//åˆ†å·ä¸è¦ä¸¢\n```\n### ä¸structåŒºåˆ«\n\nstructæˆå‘˜çš„é»˜è®¤æƒé™æ˜¯publicï¼Œclassæˆå‘˜çš„é»˜è®¤æƒé™æ˜¯privateï¼›\n## æƒé™é€‰æ‹©\n\n1. å¿…é¡»è¦ä¸ºå¤–ç•Œæä¾›çš„ï¼Œæ”¾åœ¨publicã€‚å…¶ä»–çš„éƒ½æ”¾åœ¨privateã€‚\n2. ä¸€èˆ¬æˆå‘˜å±æ€§éƒ½æ”¾åœ¨privateï¼Œå¦‚æœå¤–ç•Œéœ€è¦ä½¿ç”¨å°±æä¾›å…¬æœ‰æ¥å£ã€‚\n## åè¯åŒºåˆ«\n\nå®šä¹‰--åˆ’åˆ†å†…å­˜\n\n```c++\nint a;\nPerson p;\n```\n\nåˆå§‹åŒ–--å®šä¹‰çš„åŒæ—¶ç»™å€¼\n\n```c++\n\n```\n\nèµ‹å€¼--å®šä¹‰ä¹‹åç»™å€¼--å†…å­˜åˆ’åˆ†ä¹‹åç»™å€¼\n\n```c++\n_sex = 1;\n```\n## åˆå§‹åŒ–åˆ—è¡¨\n\n```c++\npublic:\n    Person()\n        : _sex(1)//åˆå§‹åŒ–åˆ—è¡¨ã€‚\n    {\n        \n    }\n```\n\n1. åªæœ‰æ„é€ å‡½æ•°æœ‰åˆå§‹åŒ–åˆ—è¡¨ã€‚\n2. å¿…é¡»åˆå§‹åŒ–çš„æˆå‘˜éœ€è¦æ”¾åœ¨åˆå§‹åŒ–åˆ—è¡¨ã€‚å¦‚constä¿®é¥°çš„æˆå‘˜å±æ€§ã€‚\n3. åœ¨æœ¬å¯¹è±¡æ„é€ ä¹‹å‰å¿…é¡»è¦å®Œæˆçš„åŠ¨ä½œï¼Œå¿…é¡»æ”¾åœ¨åˆå§‹åŒ–åˆ—è¡¨ã€‚\n## å¸¸å¯¹è±¡\n\n```c++\nconst char* get_name() const\n{\n    return this.name;   \n}\nint get_age()\n{\n    return this.age;\n}\nint main()\n{\n    const Person p1(18, 0, \"xiaohua\");\n}\n```\n\n1. å¸¸å¯¹è±¡åªèƒ½è°ƒç”¨å¸¸æ–¹æ³•â€”â€”æ„é€ å‡½æ•°ï¼Œææ„å‡½æ•°ï¼Œé™æ€å‡½æ•°ä¸å½±å“ã€‚\n2. å¸¸æ–¹æ³•ä¸­åªèƒ½è°ƒç”¨å¸¸æ–¹æ³•â€”â€”é™æ€å‡½æ•°ä¸å½±å“ã€‚\n\nä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºï¼Œéconstæ–¹æ³•é‡Œé»˜è®¤çš„ç¬¬ä¸€çš„å‚æ•°æ˜¯`Class_Name * const this`ã€‚æ‰€ä»¥ä¸èƒ½æŠŠ`Class_Name const * const this`èµ‹ç»™å®ƒã€‚ï¼ˆå¸¸é‡ä¸èƒ½èµ‹ç»™éå¸¸é‡ï¼‰ã€‚\n### å“ªäº›æˆå‘˜æ–¹æ³•éœ€è¦å†™æˆå¸¸æ–¹æ³•\n\n1. å¦‚æœæˆå‘˜æ–¹æ³•å†…ä¸éœ€è¦æ”¹åŠ¨æˆå‘˜ï¼Œå¹¶ä¸”æ²¡æœ‰å¯¹å¤–æš´éœ²æˆå‘˜å¼•ç”¨æˆ–æŒ‡é’ˆï¼Œå°±å¯ä»¥ç›´æ¥å†™æˆå¸¸æ–¹æ³•ã€‚\n2. å¦‚æœæˆå‘˜å†…éƒ¨ä¸éœ€è¦æ”¹åŠ¨æˆå‘˜ï¼Œä½†æ˜¯ä¼šå¯¹å¤–æš´éœ²æˆå‘˜å¼•ç”¨æˆ–æŒ‡é’ˆï¼Œå°±å†™ä¸¤ä¸ªæˆå‘˜æ–¹æ³•ï¼Œå¥‡æ·«å·§è®¡ï¼Œæ•ˆæœæ˜¯å½¢æˆé‡è½½ã€‚\n```c++\nint& get_age()\n{\n    return _age;\n}\nint get_age()const\n{\n    return _age;\n}\n```\n3. å¦‚æœæˆå‘˜æ–¹æ³•å†…éƒ¨éœ€è¦æ”¹åŠ¨æˆå‘˜ï¼Œå°±å†™æˆæ™®é€šæ–¹æ³•ã€‚\n## é™æ€æˆå‘˜\n\n### å˜é‡\n\n1. ç±»ä¸­æ¯ä¸ªé™æ€æˆå‘˜åœ¨ä¸€ä¸ªç±»ä¸­åªæœ‰ä¸€ä»½ï¼Œè¿™ä¸ªç±»çš„å¯¹è±¡å…¬ç”¨ã€‚\n2. å­˜å‚¨åœ¨æ•°æ®æ®µã€‚\n3. å¿…é¡»åœ¨ç±»å¤–çš„.cppæ–‡ä»¶ä¸­è¿›è¡Œåˆå§‹åŒ–ï¼Œåªèƒ½åˆå§‹åŒ–ä¸€æ¬¡ã€‚\n\n```c++\n//é™æ€æˆå‘˜å˜é‡çš„ç±»å¤–åˆå§‹åŒ–\nint Person::_num = 0;//å¿…é¡»æŒ‡æ˜ä½œç”¨åŸŸ\n```\n4. é™æ€æˆå‘˜å˜é‡çš„è®¿é—®å¯ä»¥ä¸ä¾èµ–äºå¯¹è±¡--ä¸ä¾èµ–äºthisæŒ‡é’ˆï¼Œä½¿ç”¨ç±»çš„ä½œç”¨åŸŸå¯ä»¥ç›´æ¥è®¿é—®ã€‚\n### æ–¹æ³•\n```c++\nint get_num()\n{\n    return _num;\n}\nint main()\n{\n    cout << p1.get_num() << endl;//æŠ¥é”™ï¼Œå› ä¸ºp1æ˜¯å¸¸é‡å¯¹è±¡ï¼Œä¸å¯è°ƒç”¨éå¸¸æ–¹æ³•\n    cout << p2.get_num() << endl;//å¯ä»¥\n    cout << Person::get_num() << endl;//æŠ¥é”™ï¼Œå› ä¸º\n}\n```\n\n1. é™æ€æˆå‘˜æ–¹æ³•æ²¡æœ‰thisæŒ‡é’ˆã€‚\n2. é™æ€æˆå‘˜æ–¹æ³•çš„è®¿é—®å¯ä»¥ä¸ä¾èµ–äºå¯¹è±¡--ä¸ä¾èµ–äºthisæŒ‡é’ˆï¼Œå¯ä»¥ä½¿ç”¨ç±»çš„ä½œç”¨åŸŸç›´æ¥è®¿é—®ã€‚\n3. é™æ€æˆå‘˜æ–¹æ³•å†…åªèƒ½ä½¿ç”¨é™æ€æˆå‘˜å˜é‡æˆ–æ–¹æ³•ï¼Œå› ä¸ºæ²¡æœ‰thisæŒ‡é’ˆå¯ä»¥æ‹¿æ¥æŒ‡å‘è‡ªå·±çš„æˆå‘˜ã€‚\n## åº”ç”¨\nå•ä¾‹æ¨¡å¼\n1. æŠŠæ„é€ æ–¹æ³•å†™åœ¨privateé‡Œ\n```c++\nclass Only\n{\n    //è¦æ±‚\n    //é™åˆ¶åªèƒ½äº§ç”Ÿä¸€ä¸ªå¯¹è±¡\n    //åœ¨é¡¹ç›®ä¸­ä»»æ„åœ°æ–¹éƒ½å¯ä»¥è·å–åˆ°è¿™ä¸ªæƒŸä¸€çš„å¯¹è±¡\nprivate:\n    static Only* _only;\n    Only();\n    static mutex _lock;//#include<mutex>\npublic:\n    static Only* get_Only()\n    {\n        if(NULL == _only)\n        {\n            _lock.lock;\n            if(NULL==_only)\n            {\n                _only = new Only();\n                return _only;\n            }\n            _lock.unlock;\n        }\n\n        \n    }\n    \n}\n```\n## åµŒå¥—ç±»\n\n1. æŒ‰ç±»ä¸ç±»ä¹‹é—´çš„å…³ç³»æ¥è¯´ï¼Œç»„åˆå…³ç³»ï¼šä¸€ä¸ªç±»æ˜¯å¦ä¸€ä¸ªç±»çš„ä¸€éƒ¨åˆ†ã€‚\n2. ä¸€ä¸ªç±»åœ¨å¦ä¸€ä¸ªç±»çš„å†…éƒ¨å®ç°ã€‚\n3. æƒé™å±æ€§ä¾ç„¶ç”Ÿæ•ˆã€‚\n4. å¤–ç•Œè®¿é—®åµŒå¥—ç±»éœ€è¦ç”¨åˆ°å¤–å±‚ç±»çš„ä½œç”¨åŸŸã€‚\n\n1. æˆå‘˜å¯¹è±¡ï¼šå…ˆæ„é€ å†…éƒ¨ç±»å¯¹è±¡ï¼Œå†æ„é€ è‡ªå·±ã€‚\n2. ææ„æ—¶ï¼Œå…ˆææ„è‡ªå·±ï¼Œå†ææ„å†…éƒ¨ç±»å¯¹è±¡ã€‚\n3. å¦‚æœæˆå‘˜å¯¹è±¡æ²¡æœ‰é»˜è®¤çš„æ„é€ å‡½æ•°ï¼Œå¿…é¡»æ‰‹åŠ¨å†™åœ¨åˆå§‹åŒ–åˆ—è¡¨ã€‚\n## ä»£ç†å…³ç³»\n\nä¸€ä¸ªç±»çš„æ¥å£åŠŸèƒ½å®Œå…¨ä¾èµ–äºå¦ä¸€ä¸ªç±»çš„æ¥å£åŠŸèƒ½ã€‚\n## ç±»çš„ç¼–è¯‘é¡ºåº\n\næˆå‘˜å˜é‡å¿…é¡»æ”¾åœ¨æˆå‘˜æ–¹æ³•çš„å‰é¢ï¼Œå¦åˆ™æˆå‘˜æ–¹æ³•ç¼–è¯‘çš„æ—¶å€™æ— æ³•çŸ¥é“æˆå‘˜å˜é‡çš„å­˜åœ¨ã€‚\n\n1. ç¼–è¯‘ç±»å\n2. ç¼–è¯‘æˆå‘˜å = ç¼–è¯‘åµŒå¥—ç±»\n3. ç¼–è¯‘æˆå‘˜æ–¹æ³•ä½“\n# ç¼ºçœå‡½æ•°\n\n```cpp\nclass Int\n{\n    int value;\n    int sum;\npublic:\n    Int(int x)\n        :\n    {\n        \n    }\n    void Print()const\n    {\n        printf(\"value = %d, sum = %d\\n\",value,sum);\n    }\n}\n```\n\n```cpp\n// ç¼ºçœçš„æ‹·è´æ„é€ å‡½æ•°\n{\n    const& Int(const& Int src)\n    {\n        if(this != &src)\n        {\n            value = src.value;\n            sum = src.value;\n        }\n        return *this;\n    }\n    const& Int operator=(const& Int src)\n    {\n        \n    }\n}\n```\n\n# å¯¹è±¡\n\n```cpp\nclass CGoods\n{\nprivate:\n    char Name[20];\n\tint Amount;\n    float Price;\n    float Total;\npublic:\n    void RegisterGoods(const char *name, int amount, float price);\n    int GetAmount()\n    {\n        return Amount;\n    }\n    float GetTotal()\n    {\n        return Total;\n    }\n};\nvoid CGoods::RegisterGoods(const char *name, int amount, float price)\n{\n    strcpy_s(Name, 20, name);\n    Amount = amount;\n    Price = price;\n    Total = Amount * Price;\n}\nint main()\n{\n    CGoods tea;\n    CGoods book;\n    tea.RegisterGoods(\"black_tea\",12,560);\n    book.RegisterGoods(\"Thinking in C++\",100,98.9f);\n    \n    int x = tea.GetAmount();\n    x = book.GetAmount();\n}\n```\n\n1. ç±»æ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œå®šä¹‰æ—¶ç³»ç»Ÿä¸ä¸ºç±»åˆ†é…å­˜å‚¨ç©ºé—´ï¼Œæ‰€ä»¥ä¸èƒ½å¯¹ç±»çš„æ•°æ®æˆå‘˜åˆå§‹åŒ–ã€‚\n2. ç±»ä¸­çš„ä»»ä½•æ•°æ®æˆå‘˜ä¹Ÿä¸èƒ½ä½¿ç”¨å…³é”®å­—externã€autoæˆ–registeré™å®šå…¶å­˜å‚¨ç±»å‹ã€‚\n3. å‡½æ•°åœ¨ç±»ä¸­å£°æ˜åï¼Œåœ¨ç±»ä¸­å®šä¹‰åˆ™é»˜è®¤ä¸ºå†…è”å‡½æ•°ï¼Œåœ¨ç±»å¤–å®šä¹‰åˆ™é»˜è®¤ä¸ä¸ºå†…è”å‡½æ•°ï¼Œéœ€è¦ä¸»åŠ¨åŠ ä¸Šã€‚\n## å¯¹è±¡çš„åˆ›å»ºä¸ä½¿ç”¨\n\nå¯¹è±¡æ˜¯ç±»çš„å®ä¾‹ã€‚å£°æ˜ä¸€ç§æ•°æ®ç±»å‹åªæ˜¯å‘Šè¯‰ç¼–è¯‘ç³»ç»Ÿè¯¥æ•°æ®ç±»å‹çš„æ„é€ ï¼Œå¹¶æ²¡æœ‰é¢„å®šå†…å­˜ã€‚ç±»åªæ˜¯ä¸€ä¸ªæ ·æ¿ï¼ˆå›¾çº¸ï¼‰ï¼Œä»¥æ­¤æ ·æ¿å¯ä»¥åœ¨å†…å­˜ä¸­å¼€è¾Ÿå‡ºåŒæ ·ç»“æ„çš„å®ä¾‹--å¯¹è±¡ã€‚\n\nåˆ›å»ºç±»çš„å¯¹è±¡æœ‰ä¸¤ç§å¸¸ç”¨æ–¹æ³•ã€‚\nç¬¬ä¸€ç§æ˜¯ç›´æ¥å®šä¹‰ç±»çš„å®ä¾‹--å¯¹è±¡ï¼š\n```cpp\nint a;\nCGoods Car;\n```\n\nè¿™ä¸ªå®šä¹‰åˆ›å»ºäº†CGoodsç±»çš„ä¸€ä¸ªå¯¹è±¡Carï¼ŒåŒæ—¶ä¸ºå®ƒåˆ†é…äº†å±äºå®ƒè‡ªå·±çš„å­˜å‚¨å—ï¼Œç”¨æ¥å­˜æ”¾æ•°æ®å’Œå¯¹è¿™äº›æ•°æ®å®æ–½æ“ä½œçš„æˆå‘˜å‡½æ•°ï¼ˆä»£ç ï¼‰ã€‚å¯¹è±¡åªåœ¨å®šä¹‰å®ƒçš„åŸŸä¸­æœ‰æ•ˆã€‚\n\nç¬¬äºŒç§æ˜¯ç”¨newæ¥åˆ›å»ºã€‚\n```cpp\nCGoods s1;//å¯¹è±¡æ„å»ºåœ¨æ•°æ®åŒºï¼Œè¿˜æ²¡è¿›å…¥ä¸»å‡½æ•°å°±æ„å»ºå¥½äº†ã€‚\nint main()\n{\n    int a = 10;\n    CGoods c1;//æ•´ä¸ªå¯¹è±¡æ„å»ºåœ¨æ ˆåŒºï¼Œé¦–åœ°å€ä¸º&c1\n    CGoods *cp = new CGoods();//å¯¹è±¡ç”¨newæ„å»ºåœ¨å †åŒºï¼Œåœ¨æ ˆåŒºç”¨ä¸€ä¸ªæŒ‡é’ˆä¿å­˜å…¶é¦–åœ°å€cpã€‚\n    delete cp;\n}\n```\n\n# è¿ç®—ç¬¦é‡è½½\n\n1. ä¸€å…ƒè¿ç®—ç¬¦ï¼š`*`ã€`++`ã€`--`\n2. äºŒå…ƒè¿ç®—ç¬¦ï¼š`+`ã€`-`ã€`=`ã€`&&`ã€`||`\n3. ä¸‰å…ƒè¿ç®—ç¬¦ï¼š` : ? `\n\n```cpp\nint main()\n{\n    string s1 = \"aaaa\";\n    string s2 = \"bbbbb\";\n    string s3 = s1 + s2;\n    cout << s3 << endl;\n}\n```\n\n```cpp\nclass Complex\n{\npublic:\n    Complex();\n    Complex(int a, int b);\n    \n    Complex(const Complex& src);\n    Complex& operator=(const Complex& src);\n    Complex  operator+(const Complex& src) const;\n    Complex  operator-(const Complex& src) const;\n    ~Complex();\n    friend ostream& operator <<(ostream& out, const Complex& src);\nprivate:\n    int _a;//å®éƒ¨\n    int _b;//è™šéƒ¨\n};\n```\n\n```cpp\nComplex()\n{\n    \n}\nComplex(int a, int b)\n{\n    _a = a;\n    _b = b;\n}\nComplex operator+(const Complex& src)const\n{\n    int a = _a + src._a;\n    int b = _b + src._b;\n    return Compare(a,b);\n}\nComplex operator-(const Complex& src)const\n{\n    int a = _a - src._a;\n    int b = _b - src._b;\n    return Compare(a,b);\n}\nbool operator&&(const Complex& src)const\n{\n    return _a && src._a;\n}\nvoid operator <<(ostream& out)\n{\n    out << _a << \"+\" << _b << \"i\" << endl;\n}\nvoid operator <<(ostream& out, const Complex& src)\n{\n    out << src._a << \"+\" << src._b << \"i\" << endl;\n}\n\nComplex& operator++()//å‰ç½®++\n{\n    ++_a;\n    return *this;//é€€å‡ºå‡½æ•°æ—¶ï¼ŒthisæŒ‡é’ˆè¿˜æœ‰æ•ˆã€‚\n}\nComplex operator ++(int)//åç½®++ï¼Œintæ²¡ç”¨ï¼Œåªä½œä¸ºæ ‡å¿—æ˜¯åç½®\n{\n    int tmp = _a;\n    _a++;\n    return Complex(tmp, _b);//ä¸´æ—¶å¯¹è±¡ï¼Œä¸èƒ½è¿”å›å¼•ç”¨\n}\n\nostream& operator <<(ostream& out, const Complex& src)\n{\n\tout << src._a << \"+\" << src._b << \"i\" << endl;\n\treturn out;\n}\n\n//- -- || >>\nint main()\n{\n    string s1 = \"aaaa\";\n\tstring s2 = \"bbbbb\";\n\n\tstring s3 = s1 + s2;\n\tcout << s3 << endl;\n\n\n\tComplex c1(1, 2);\n\tComplex c2(2, 3);\n\n\tComplex c3 = c1 + c2;\n\n\tif (c1 && c2)\n\t{\n\t\tcout << \"all 0\" << endl;\n\t}\n\n\tostream& oo = cout;\n\too << s1 << endl;\n\n\t//c1.operator<<(cout);\n\n\tcout << c1 << c2 <<endl;\n\n\n\tc1++;\n\t//++c1;\n\tcout << c1 << endl;\n\t//c1--;\n\t//--c1;\n\n\treturn 0;\n}\n```\n## è¾“å…¥è¾“å‡ºé‡è½½\n\n### `<<`é‡è½½\n\nostreamæ˜¯iostreamçš„ä¸€ä¸ªç±»ã€‚coutå°±æ˜¯è¿™ä¸ªç±»çš„å¯¹è±¡ï¼Œåœ¨å±å¹•ä¸Šè¾“å‡ºä¸œè¥¿ã€‚\n\n```cpp\nostream oo = cout;//ä¸å…è®¸ï¼Œåªèƒ½æœ‰ä¸€ä¸ªostreamå¯¹è±¡ï¼Œé»˜è®¤å·²åˆ›å»ºå¥½ï¼Œä¸ºcoutã€‚\n//æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¼•ç”¨ï¼Œèµ·ä¸ªåˆ«åã€‚\nostream& oo = cout;\noo << \"abc\" << endl;\n```\n### `>>`é‡è½½\n\nistreamä¹Ÿæ˜¯iostreamä¸­çš„ä¸€ä¸ªç±»ã€‚cinå°±æ˜¯è¿™ä¸ªç±»çš„å¯¹è±¡ï¼Œä»é”®ç›˜è·å–æ•°æ®ç»™å…¶ä»–å¯¹è±¡ã€‚\n\n```cpp\nvoid operator <<(ostream& out)\n{\n    out << _a << \"+\" << _b << \"i\" << endl;\n}\nint main()\n{\n    cout << c1 << endl;//æŠ¥é”™\n    //åªèƒ½å†™æˆå¦‚ä¸‹å½¢å¼ï¼š\n    c1 << cout;\n}\n\n```\n\næ”¹è¿›ï¼š\n\n```cpp\nvoid operator <<(ostream& out)\n{\n    \n}\n```\n\n## ç»ƒä¹ \n\nBigNum\n\n```cpp\nclass BigNum\n{\n    BigNum(int);\n    BigNum(const char*);\n    BigNum& operator++();\n    BigNum  operator++(int);\n    BigNum& operator--();\n    BigNum  operator--(int);\nprivate:\n    string _num;\n};\n```","tags":["tulun"],"categories":["Cpp"]},{"title":"åŸºç¡€æ•°æ®ç»“æ„_æ ˆ","url":"/åŸºç¡€æ•°æ®ç»“æ„/åŸºç¡€æ•°æ®ç»“æ„_æ ˆ/","content":"# é¡ºåºæ ˆ\n\n## å¤´æ–‡ä»¶\n\n```c\n#ifndef MY_SEQSTACK_H\n#define MY_SEQSTACK_H\n\n#define TRUE 1\n#define FALSE 0\n#define OK 1\n#define ERROR 0\n#define OVERFLOW -2\n#define NULLPTR -3\n\ntypedef int Status;\n\n#define STACK_INIT_SIZE 100\n#define STACKINC 1.5\ntypedef int SElemType;\ntypedef struct\n{\n    SElemType *base;//æ ˆåº•æŒ‡é’ˆ\n    SElemType *top;//æ ˆé¡¶æŒ‡é’ˆ\n    int stacksize;//æ ˆçš„å®¹é‡\n}SeqStack;\n\nStatus InitStack(SeqStack *ps);\nvoid DestroyStack(SeqStack *ps);\nvoid ClearStack(SeqStack *ps);\nint StackLength(const SeqStack *ps);\nbool StackEmpty(const SeqStack *ps);\nbool StackFull(const SeqStack *ps);\nStatus Push(SeqStack *ps, SElemType val);\nStatus GetTop(SeqStack *ps, SElemType *pval);\nStatus Pop(SeqStack *ps, SElemType *pval);\n\n\n#endif\n```\n\n## å®ç°\n\n```c\n//My_SeqStack.cpp\n#include<stdlib.h>//malloc free\n#include<assert.h>\n\n#include\"My_SeqStack.h\"\nStatus InitStack(SeqStack *ps)\n{\n    assert(ps!=NULL);\n    ps->base = (SElemType *)malloc(sizeof(SElemType)*STACK_INIT_SIZE);\n    if(NULL==ps->base)\n    {\n        return OVERFLOW;\n    }\n    ps->top = ps->base;\n    ps->stacksize = STACK_INIT_SIZE;\n    return OK;\n}\nvoid DestroyStack(SeqStack *ps)\n{\n\tassert(ps!=NULL);\n    free(ps->base);\n    ps->base = NULL;\n    ps->top = NULL;\n    ps->stacksize = 0;\n}\nvoid ClearStack(SeqStack *ps)\n{\n    assert(ps!=NULL);\n    ps->top = ps->base;\n}\nint StackLength(const SeqStack *ps)\n{\n    assert(ps!=NULL);\n    return ps->top - ps->base;\n}\nbool StackEmpty(const SeqStack *ps)\n{\n    assert(ps!=NULL);\n    return ps->top == ps->base;\n    //return StackLength(ps)==0;\n}\nbool StackFull(const SeqStack *ps)\n{\n    assert(ps!=NULL);\n    return StackLength(ps)==ps->stacksize;\n}\nbool IncSize(SeqStack *ps)\n{\n    assert(ps!=NULL);\n    int newsize = ps->stacksize * STACKINC;\n    SElemType *newdata = (SElemType*)realloc(ps->base,sizeof(SElemType)*newsize);\n    \n    if(NULL==newdata)return false;\n    ps->base = newdata;\n    \n    ps->top = ps->base + ps->stacksize;\n    \n    ps->stacksize = newsize;\n    return true;\n}\nStatus Push(SeqStack *ps, SElemType val)\n{\n    assert(ps!=NULL);\n    if(StackFull(ps) && !IncSize(ps))\n    {\n        return OVERFLOW;\n    }\n    *(ps->top) = val;\n    ps->top += 1;\n    return OK;\n}\nStatus GetTop(const SeqStack *ps, SElemType *pval)\n{\n    assert(ps!=NULL);\n    if(StackEmpty(ps))\n    {\n        return ERROR;\n    }\n    if(NULL == pval)return NULLPTR;\n    *pval = *(ps->top-1);\n    return OK;\n}\nStatus Pop(SeqStack *ps, SElemType *pval)\n{\n    assert(ps !=NULL);\n    if(StackEmpty(ps))\n    {\n        return ERROR;\n    }\n    if(NULL==pval)return NULLPTR;\n    \n    ps->top -= 1;\n    *pval = *(ps->top);\n    return OK;\n}\n```\n\n## æµ‹è¯•\n\n```c\n//TestStack.cpp\n#include<stdio.h>\n#include\"My_SeqStack.h\"\nint main()\n{\n    SeqStack mys;\n    InitStack(&mys);\n    for (int i = 0;i < 10;++i)\n    {\n        Push(&mys, i);\n    }\n    int val;\n    while (!StackEmpty(&mys))\n    {\n        Pop(&mys, &val);\n        printf(\"%d \", val);\n    }\n    DestroyStack(&mys);\n}\n```\n\n# é“¾æ ˆ\n\n## å¤´æ–‡ä»¶\n\n```c\n//LinkStack.h\n#ifndef LINKSTACK_H\n#define LINKSTACK_H\n\n#define TRUE 1\n#define FALSE 0\n#define OK 1\n#define ERROR 0\n#define OVERFLOW -2\n#define NULLPTR -3\n\ntypedef int Status;\n\ntypedef int SElemType;\ntypedef struct StackNode\n{\n    SElemType data;\n    struct StackNode *next;\n}StackNode,*PStackNode;\ntypedef struct\n{\n    StackNode *top;\n    int cursize;\n}LinkStack;\n\nStatus InitStack(LinkStack *ps);\nvoid DestroyStack(LinkStack *ps);\nvoid ClearStack(LinkStack *ps);\nint StackLength(const LinkStack *ps);\nbool StackEmpty(const LinkStack *ps);\nbool StackFull(const LinkStack *ps);\nStatus Push(LinkStack *ps, SElemType val);\nStatus GetTop(LinkStack *ps, SElemType *pval);\nStatus Pop(LinkStack *ps, SElemType *pval);\n#endif\n```\n\n## å®ç°\n\n```c\n//LinkStack.cpp\n#include<stdlib.h>\n#include<assert.h>\n#include<string.h>\n#include\"LinkStack.h\"\nStackNode* Buynode()\n{\n    StackNode *newnode = (StackNode*)malloc(sizeof(StackNode));\n    if(NULL!=newnode)\n    {\n        memset(newnode,0,sizeof(StackNode));\n    }\n    return newnode;\n}\nStatus InitStack(LinkStack *ps)\n{\n    assert(ps!=NULL);\n    ps->top = Buynode();//å¤´ç»“ç‚¹\n    if(NULL == ps->top)return OVERFLOW;\n    \n    ps->cursize = 0;\n    return OK;\n}\nvoid DestroyStack(LinkStack *ps)\n{\n    assert(ps!=NULL);\n    ClearStack(ps);\n    free(ps->top);\n    ps->top = NULL;\n    return OK;\n}\nvoid ClearStack(LinkStack *ps)\n{\n    assert(ps!=NULL);\n    while(ps->cursize!=0)\n    {\n        DelFront(ps);\n    }\n    return OK;\n}\nint StackLength(const LinkStack *ps)\n{\n    assert(ps!=NULL);\n    return ps->cursize;\n}\nbool StackEmpty(const LinkStack *ps)\n{\n    assert(ps!=NULL);\n    return ps->cursize == 0;\n}\nStatus Push(LinkStack *ps, SElemType val)\n{\n    assert(ps!=NULL);\n    StackNode *newnode = Buynode();\n    if(NULL==newnode)return OVERFLOW;\n    \n    newnode->next = ps->top->next;\n    ps->top->next = newnode;\n    \n    newnode->data = val;\n    \n    ps->cursize +=1;\n    return OK;\n}\nStatus GetTop(LinkStack *ps, SElemType *pval)\n{\n    assert(ps!=NULL);\n    if(pval==NULL)return NULLPTR;\n    if(ps->cursize<=0)return false;\n    *pval = ps->top->next->data;\n    return OK;\n}\nStatus Pop(LinkStack *ps, SElemType *pval)\n{\n    assert(ps!=NULL);\n    if(pval==NULL)return NULLPTR;\n    if(ps->cursize<=0)return ERROR;\n    GetTop(ps,pval);\n    DelNext(ps);\n    return OK;\n}\nbool DelFront(LinkStack *ps)\n{\n    assert(ps!=NULL);\n    if(ps->cursize<=0)return false;\n    StackNode *p = ps->top->next;\n    ps->top->next = p->next;\n    free(p);\n    ps->cursize-=1;\n    return true;\n}\n```\n\n\n\n## æµ‹è¯•\n\n```c\n```\n\n","categories":["åŸºç¡€æ•°æ®ç»“æ„"]},{"title":"Cpp_å‡½æ•°è°ƒç”¨è¿‡ç¨‹","url":"/Cpp/Cpp_å‡½æ•°è°ƒç”¨è¿‡ç¨‹/","content":"\n# å‡½æ•°è°ƒç”¨è¿‡ç¨‹\n\n1. å‚æ•°å…¥æ ˆ\n2. å‡½æ•°æ ˆå¸§å¼€è¾Ÿ\n3. è¿”å›å€¼è¿”å›\n4. å‡½æ•°æ ˆé€€å‡º\n\n# ä»£ç \n\n```c\n//4å­—èŠ‚å…¥æ ˆ\n#include<stdio.h>\nvoid fun(int a, int b)\n{\n    int c;\n    c = a + b;\n    return c;\n}\nint main()\n{\n    int a = 10;\n    int b = 20;\n    fun(a,b);\n    return 0;\n}\n```\n\n```c\n//8å­—èŠ‚å…¥æ ˆ\nstruct Node\n{\n    int _1;\n    int _2;\n};\nint fun(struct Node a, struct Node b)\n{\n    int c = 30;\n    return c;\n}\nint main()\n{\n    struct Node a = {10, 20};\n    struct Node b = {30, 40};\n    fun(a, b);\n    return 0;\n}\n```\n\n```c\n//12å­—èŠ‚å…¥æ ˆ\nstruct Node\n{\n    int _1;\n    int _2;\n    int _3;\n};\nint fun(struct Node a, struct Node b)\n{\n    int c = 30;\n    return c;\n}\nint main()\n{\n    struct Node a = {10, 20, 30};\n    struct Node b = {40, 50, 60};\n    fun(a, b);\n    return 0;\n}\n```\n\n![image-20211001184239521](../../images/%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B/image-20211001184239521.png)\n\n# å¯„å­˜å™¨\n\nå¯ä»¥ç†è§£ä¸ºCPUä¸­çš„å˜é‡\n\nå¦‚ä½•å»æ ‡å¿—ä¸€ä¸ªæ ˆï¼Ÿâ€”â€”æ ˆåº•å’Œæ ˆé¡¶æŒ‡é’ˆã€‚\n\nespï¼šæ ˆé¡¶å¯„å­˜å™¨ã€‚\n\nebpï¼šæ ˆåº•å¯„å­˜å™¨ã€‚\n\n# å‡½æ•°è°ƒç”¨è¿‡ç¨‹\n\n1. å‚æ•°å…¥æ ˆï¼ˆCè¯­è¨€ï¼‰\n\n   1. 4å­—èŠ‚å‚æ•°ï¼ˆdwordï¼‰å…¥æ ˆ\n\n      1. é¡ºåºï¼šä»å³å‘å·¦\n      2. æ–¹å¼ï¼šä½¿ç”¨å¯„å­˜å™¨pushå¸¦å…¥\n\n   2. 8å­—èŠ‚å‚æ•°å…¥æ ˆ\n\n      1. é¡ºåºï¼šä»å³å‘å·¦\n      2. æ–¹å¼ï¼šä½¿ç”¨å¯„å­˜å™¨åˆ†ä¸¤æ¬¡pushå¸¦å…¥\n\n   3. ï¼ˆ>8å­—èŠ‚ï¼‰12å­—èŠ‚å‚æ•°å…¥æ ˆ\n\n      ![image-20211001184251000](../../images/%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B/image-20211001184251000.png)\n\n      1. é¡ºåºï¼šä»å³å‘å·¦\n      2. æ–¹å¼ï¼šå˜äº†ï¼Œ**æ ˆé¡¶å…ˆä¸Šç§»ï¼Œå³å¼€è¾Ÿè¶³å¤Ÿçš„ç©ºé—´**ï¼Œä¹‹ååˆ©ç”¨å¯„å­˜å™¨å°†æ•°æ®åˆ†æ‰¹æ¬¡å¤åˆ¶è¿›å»ã€‚\n\n   4. C++ä¸­ï¼Œåªè¦æ˜¯è‡ªå®šä¹‰ç±»å‹ï¼Œæ— è®ºå¤šå¤§å­—èŠ‚ï¼Œéƒ½é‡‡ç”¨å…ˆespä¸Šç§»å¼€è¾Ÿç©ºé—´ï¼Œä¹‹ååˆ†æ¬¡èµ‹å€¼çš„æ–¹å¼ï¼ˆå³æ–¹å¼3ï¼‰ï¼Œå³>8å­—èŠ‚çš„æƒ…å†µã€‚\n\n2. å‡½æ•°æ ˆå¸§å¼€è¾Ÿ\n   å…¶ä¸­ï¼Œ1ã€2æ­¥æ˜¯ä¸ºäº†ä¿å­˜ç°åœºã€‚3ã€4æ­¥æ˜¯å¼€è¾Ÿæ–°çš„æ ˆå¸§ã€‚\n\n   1. å‡½æ•°å…¥å‚çš„åŠ¨ä½œå®Œæˆåï¼Œæ±‡ç¼–ä»£ç æ‰§è¡Œcall(_fun)è¯­å¥ï¼Œespå‘ä¸Šç§»4ä½ï¼Œå°†**è°ƒç”¨æ–¹å‡½æ•°åŸæ¥çš„ä¸‹ä¸€è¡ŒæŒ‡ä»¤åœ°å€**å­˜å…¥æ ˆã€‚å› ä¸ºmainä¸­è°ƒç”¨å®Œæˆå¤–éƒ¨å‡½æ•°åï¼Œè¿˜è¦å›åˆ°ä»¥å‰çš„ä½ç½®ã€‚\n      ![image-20211018205543731](../../images/%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B/image-20211018205543731.png)\n      ![image-20211018205624299](../../images/%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B/image-20211018205624299.png)\n   2. å°†**è°ƒç”¨æ–¹å‡½æ•°çš„æ ˆåº•å¯„å­˜å™¨**ï¼ˆebpï¼‰å…¥æ ˆ\n      ![image-20211018205322518](../../images/%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B/image-20211018205322518.png)\n   3. **è®©`ebp=esp`**ï¼ˆè®©ebpä¸Šç§»åˆ°espçš„ä½ç½®ï¼‰\n   4. **è®©`esp=esp-0**h`**ï¼ˆä¸Šç§»è‹¥å¹²ç©ºé—´ï¼Œå¼€è¾Ÿæ­¤å‡½æ•°çš„ç©ºé—´ï¼‰\n   5. å°†æŸäº›å¯„å­˜å™¨ï¼ˆçº¿ç¨‹ä¿æŠ¤ï¼‰å…¥æ ˆ\n   6. å°†æ–°å¼€è¾Ÿçš„æ ˆå¸§ç©ºé—´ä¸­å…¨éƒ¨èµ‹ä¸º`0xcccccccc`\n\n3. å‡½æ•°è¿”å›å€¼\n\n   1. 4å­—èŠ‚è¿”å›å€¼ï¼šå°†è¿”å›å€¼å…ˆå­˜åˆ°eaxå†èµ‹ç»™æ¥æ”¶å˜é‡\n      ![image-20211018210146635](../../images/%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B/image-20211018210146635.png)\n      ![image-20211018210420665](../../images/%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B/image-20211018210420665.png)\n\n   2. 8å­—èŠ‚è¿”å›å€¼ï¼šå°†è¿”å›å€¼åˆ†å¼€æ”¾åˆ°ä¸¤ä¸ªå¯„å­˜å™¨ï¼Œå†èµ‹ç»™æ¥æ”¶å˜é‡\n      ![image-20211018210458734](../../images/%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B/image-20211018210458734.png)\n\n      ![image-20211018210558730](../../images/%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B/image-20211018210558730.png)\n      ![image-20211018210607525](../../images/%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B/image-20211018210607525.png)\n      ![image-20211018210900593](../../images/%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B/image-20211018210900593.png)\n\n   3. ï¼ˆ>8å­—èŠ‚ï¼‰12å­—èŠ‚è¿”å›å€¼ï¼š\n\n      1. åœ¨å‡½æ•°å‚æ•°å…¥æ ˆä¹‹åï¼Œå…¥æ ˆä¸€ä¸ªè°ƒç”¨æ–¹ï¼ˆå¦‚mainï¼‰æ ˆå¸§ä¸Šçš„åœ°å€ï¼ˆé è¿‘æ ˆé¡¶ä½ç½®ï¼‰\n      2. åœ¨è¿”å›å€¼è¿”å›çš„æ—¶å€™ï¼Œå°†è¿”å›æ•°æ®åˆ†æ¬¡å†™å…¥åˆ°ä¹‹å‰å…¥æ ˆçš„è°ƒç”¨æ–¹åœ°å€ä¸Šã€‚\n      3. è¿”å›ä¹‹åï¼Œå°†ä»è¯¥åœ°å€ï¼ˆè°ƒç”¨æ–¹ï¼ˆå¦‚mainï¼‰æ ˆå¸§ä¸Šçš„åœ°å€ï¼‰å°†æ•°æ®åˆ†æ¬¡å–å‡ºï¼ˆä¸€æ¬¡4å­—èŠ‚ï¼‰åˆ°æ¥æ”¶å˜é‡ä¸­ã€‚\n\n      ![image-20211001213921252](../../images/%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B/image-20211001213921252.png)\n\n   4. C++ä¸­ï¼Œè‡ªå®šä¹‰ç±»å‹éƒ½æŒ‰ç…§å…¥æ ˆä¸€ä¸ªè°ƒç”¨æ–¹åœ°å€çš„æ–¹å¼\n\n4. å‡½æ•°æ ˆé€€å‡º\n\n   1. è¿›è¡Œå½“å‰å‡½æ•°æ ˆå¸§çš„æ ¡éªŒ\n   2. å°†çº¿ç¨‹ä¿æŠ¤çš„å¯„å­˜å™¨å‡ºæ ˆ\n   3. è®©`esp=ebp`ï¼ˆå›ç¼©æ ˆå¸§ï¼‰\n   4. `pop`æ“ä½œï¼ˆå³å°†popçš„ä½ç½®æ˜¯espæŒ‡å‘çš„ä½ç½®ï¼‰ã€‚\n      `pop ebp`ï¼Œæ„ä¸ºï¼š`ebp=pop`ï¼Œ`esp`æŒ‡å‘çš„æ˜¯åŸæ¥`main`çš„`ebp`åœ°å€ï¼Œèµ‹ç»™`ebp`ï¼ŒåŒæ—¶`esp`ä¸‹ç§»4å­—èŠ‚ã€‚åˆ™`ebp`å›æŒ‡åˆ°åŸæ¥çš„ä½ç½®ã€‚å½¢æˆç°åœºæ¢å¤ã€‚\n      ![image-20211018233157527](../../images/%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B/image-20211018233157527.png)\n   5. å°†ä¸‹ä¸€è¡ŒæŒ‡ä»¤çš„åœ°å€è¿˜åŸï¼ˆ`ret`ï¼‰ï¼Œå®é™…ä¸Šï¼Œä¹Ÿæ˜¯ä¸€ä¸ª`pop`ï¼Œè¿”å›ä¿ç•™çš„åœ°å€å€¼ï¼Œ`esp`ä¸‹ç§»4å­—èŠ‚ã€‚\n   6. espå†æ¬¡ä¸‹ç§»è‹¥å¹²ï¼Œæ¸…é™¤å‚æ•°å’Œä¹‹å‰å…¥æ ˆçš„è°ƒç”¨æ–¹åœ°å€ã€‚ä¸‹ç§»ä¹‹åï¼Œåˆ™espå’Œebpå›åˆ°äº†mainå‡½æ•°è°ƒç”¨å¤–éƒ¨å‡½æ•°ä¹‹å‰çš„åŸå§‹ä½ç½®ã€‚å‡½æ•°è°ƒç”¨ç»“æŸã€‚\n      ![image-20211018233852672](../../images/%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B/image-20211018233852672.png)\n\n# è¯´æ˜\n\nå½“å‰æ¼”ç¤ºçš„å‡½æ•°è°ƒç”¨è§„åˆ™æ˜¯ä¾èµ–äºCè¯­è¨€é»˜è®¤çš„è°ƒç”¨çº¦å®š`__cdecl`ï¼Œå…¶ä»–çš„è¿˜æœ‰`__stdcall`/`__fastcall`ã€‚ä¸‰ç§å·®å¼‚å¹¶ä¸å¤§ï¼Œåªæ˜¯è´Ÿè´£çš„äº‹æƒ…ä¸åŒï¼Œæ¸…é™¤å‚æ•°æ˜¯è°ƒç”¨æ–¹æ‰§è¡Œçš„ï¼Œ`stdcall`æ˜¯è¢«è°ƒç”¨æ–¹æ‰§è¡Œçš„ã€‚\n\n```c\nstruct Node __cdecl fun(int a, int b)\n{\n    struct Node c = {10, 20, 30};\n    return c;\n}\n```\n\n","categories":["Cpp"]},{"title":"åŸºç¡€æ•°æ®ç»“æ„_å¾ªç¯å•é“¾è¡¨","url":"/åŸºç¡€æ•°æ®ç»“æ„/åŸºç¡€æ•°æ®ç»“æ„_å¾ªç¯å•é“¾è¡¨/","content":"# å£°æ˜\n\n```c\n#ifndef CLIST_H\n#define CLIST_H\ntypedef int ElemType;\ntypedef struct CNode\n{\n    ElemType data;\n    struct CNode* next;//æŒ‡é’ˆåŸŸ\n}CNode, * PCNode;\n//å¯æ‰§è¡Œæ“ä½œ\n//åˆå§‹åŒ–\nvoid Init_clist(struct CNode* plist);\n//å¤´æ’\nbool Push_Front(PCNode plist, int val);\n//å°¾æ’\nbool Push_Back(PCNode plist, int val);\n//æŒ‰ä½ç½®æ’\nbool Insert_Pos(PCNode plist, int pos, int val);\n//å¤´åˆ \nbool Pop_Front(PCNode plist);\n//å°¾åˆ \nbool Pop_Back(PCNode plist);\n//æŒ‰ä½ç½®åˆ \nbool Del_Pos(PCNode plist, int pos);\n//æŒ‰å€¼åˆ é™¤\nbool Del_Val(PCNode plist, int val);\n//æŸ¥æ‰¾\nstruct CNode* Search(PCNode plist, int val);\n//æ‰¾å€¼ä¸ºvalçš„èŠ‚ç‚¹å‰é©±\nstruct CNode* Get_Prev(PCNode plist, int val);\n//æ‰¾å€¼ä¸ºvalçš„èŠ‚ç‚¹åç»§\nstruct CNode* Get_Next(PCNode plist, int val);\n//è·å–å…¶æœ‰æ•ˆèŠ‚ç‚¹çš„ä¸ªæ•°\nint Get_Length(PCNode plist);\n//æ¸…ç©º\nvoid Clear(PCNode plist);\n//é”€æ¯1\nvoid Destroy1(PCNode plist);\n//é”€æ¯2\nvoid Destroy2(PCNode plist);\n//åˆ¤ç©º\nbool IsEmpty(PCNode plist);\n//æ‰“å°\nvoid Show(PCNode plist);\n#endif\n\n\n```\n\n# å®ç°\n\n```c\n#include<stdio.h>\n#include<stdlib.h>\n#include<assert.h>\n#include\"clist.h\"\n\nstruct CNode* Buynode()\n{\n    CNode* newnode = (CNode*)malloc(sizeof(CNode));\n    if (NULL == newnode)\n    {\n        printf(\"memory error\");\n        exit(1);\n    }\n    return newnode;\n}\n//å¯æ‰§è¡Œæ“ä½œ\n//åˆå§‹åŒ–\nvoid Init_clist(struct CNode* head)\n{\n    assert(head != NULL);\n    head->next = head;\n}\n//æŸ¥åˆ°pträ¸‹ä¸€ä¸ª\nbool Insert_Next(CNode* ptr, int val)\n{\n    assert(ptr);\n    CNode* pnewnode = Buynode();\n    pnewnode->next = ptr->next;\n    ptr -> next = pnewnode;\n    pnewnode->data = val;\n    return true;\n}\n//å¤´æ’\nbool Push_Front(PCNode head, int val)\n{\n    assert(head);\n    return Insert_Next(head, val);\n}\n//å°¾æ’\nbool Push_Back(PCNode head, int val)\n{\n    assert(head);\n    CNode* p = head;\n    while (p->next != head)\n    {\n        p = p->next;\n    }\n    return Insert_Next(p, val);\n}\n//æŒ‰ä½ç½®æ’\nbool Insert_Pos(PCNode head, int pos, int val)\n{\n    assert(head);\n    if (pos < 0)return false;\n    CNode* pnode = head;\n    while (pnode->next != head && pos--)\n    {\n        pnode = pnode->next;\n    }\n    if (pos != 0)\n    {\n        return false;\n    }\n    return Insert_Next(pnode, val);\n}\n//åˆ é™¤ä¸‹ä¸€ä¸ª\nbool Del_Next(CNode* ptr)\n{\n    assert(ptr);\n    CNode* p = ptr->next;\n    ptr->next = p->next;\n    free(p);\n    return true;\n}\n//å¤´åˆ \nbool Pop_Front(PCNode head)\n{\n    assert(head);\n    if (head == head->next)//åªæœ‰å¤´ç»“ç‚¹ä¸è¡Œ\n    {\n        return false;\n    }\n    return Del_Next(head);\n}\n//å°¾åˆ \nbool Pop_Back(PCNode head)\n{\n    assert(head);\n    CNode* p = head;\n    if (head == p->next)//åªæœ‰å¤´ç»“ç‚¹ä¸è¡Œ\n    {\n        return false;\n    }\n    while (p->next->next != head)\n    {\n        p = p->next;\n    }\n    return Del_Next(p);\n}\n//æŒ‰ä½ç½®åˆ \nbool Del_Pos(PCNode head, int pos)\n{\n    assert(head);\n    if (pos < 0)return false;\n    CNode* p = head;\n    if (NULL == p->next)return false;\n    int count = pos - 1;\n    while (p->next != head && count--)\n    {\n        p = p->next;\n    }\n    if (count != -1)\n    {\n        return false;\n    }\n    return Del_Next(p);\n}\n//æŒ‰å€¼åˆ é™¤\nbool Del_Val(PCNode head, int val)\n{\n    assert(head);\n    CNode* p = head;\n    if (NULL == p->next)return false;\n    while (p->next != head && val != p->next->data)\n    {\n        p = p->next;\n    }\n    if (p->next == head)\n    {\n        return false;\n    }\n    return Del_Next(p);\n}\n//æŸ¥æ‰¾\nstruct CNode* Search(PCNode plist, int val);\n//æ‰¾å€¼ä¸ºvalçš„èŠ‚ç‚¹å‰é©±\nstruct CNode* Get_Prev(PCNode plist, int val);\n//æ‰¾å€¼ä¸ºvalçš„èŠ‚ç‚¹åç»§\nstruct CNode* Get_Next(PCNode plist, int val);\n//è·å–å…¶æœ‰æ•ˆèŠ‚ç‚¹çš„ä¸ªæ•°\nint Get_Length(PCNode head)\n{\n    assert(head);\n    CNode* p = head;\n    int count = 0;\n    while (p->next != head)\n    {\n        count++;\n    }\n    return count;\n}\n//åˆ¤ç©º\nbool IsEmpty(PCNode head)\n{\n    assert(head);\n    if (head->next == head)return true;\n    return false;\n}\n//æ¸…ç©º\nvoid Clear(PCNode head)\n{\n    assert(head);\n    while (!IsEmpty(head))\n    {\n        Pop_Front(head);\n    }\n}\n//é”€æ¯1\nvoid Destroy1(PCNode head)\n{\n    assert(head);\n    Clear(head);\n}\n//é”€æ¯2\nvoid Destroy2(PCNode plist);\n//æ‰“å°\nvoid Show(PCNode head)\n{\n    assert(head);\n    CNode* p = head->next;\n    while (p != head)\n    {\n        printf(\"%3d \", p->data);\n        p = p->next;\n    }\n    printf(\"\\n\");\n}\nint main()\n{\n    CNode cn;\n    Init_clist(&cn);\n    for (int i = 0;i < 10;i++)\n    {\n        Insert_Pos(&cn, i,i+1);\n\n    }\n    Show(&cn);\n    Push_Front(&cn, 100);\n    Push_Back(&cn, 200);\n    Show(&cn);\n\n    Pop_Front(&cn);\n    Pop_Back(&cn);\n    Show(&cn);\n\n    Del_Val(&cn, 6);\n    Show(&cn);\n    Del_Pos(&cn, 6);\n    Show(&cn);\n    Destroy1(&cn);\n    Show(&cn);\n}\n\n```\n\n","categories":["åŸºç¡€æ•°æ®ç»“æ„"]},{"title":"Cpp_Cå’ŒC++åŒºåˆ«","url":"/Cpp/Cpp_ä½“ç³»å†…å®¹_Cå’ŒC++åŒºåˆ«/","content":"# C++ä½“ç³»å†…å®¹\nè¦æŒæ¡C++ï¼Œéœ€è¦å»ºç«‹ä»¥ä¸‹çŸ¥è¯†ä½“ç³»ï¼š\n* ç¼–è¯‘é“¾æ¥è¿‡ç¨‹\n* å‡½æ•°è°ƒç”¨è¿‡ç¨‹\n* Cå’ŒC++åŒºåˆ«\n    * åŸºç¡€éƒ¨åˆ†å’ŒC++åŸºæœ¬ä¸€æ ·ï¼Œåªéœ€åŒºåˆ†\n    * æ•°ç»„ã€å¾ªç¯ã€åˆ¤æ–­ã€å®ä¸å†è®²ï¼Œä¸€æ ·\n* é¢å‘å¯¹è±¡\n* è¿ç®—ç¬¦é‡è½½\n* æ¨¡æ¿\n* ç»§æ‰¿ä¸å¤šæ€\n* STLï¼šå®¹å™¨ã€æ³›å‹ç®—æ³•ã€å‡½æ•°å¯¹è±¡\n* æ™ºèƒ½æŒ‡é’ˆ\n* C++é¡¹ç›®\n\næœ¬ç¯‡æ–‡ç« é€šè¿‡ä»‹ç»Cå’ŒC++çš„åŒºåˆ«ï¼Œä¸€çª¥C++çš„ä½“ç³»å½¢æ€ã€‚\n# è¾“å…¥è¾“å‡º\n\n```cpp\n#include<stdio.h>\nint main()\n{\n    int a = 0;\n    char ch = '\\0';\n    scanf(\"%d %c\", &a, &ch);\n    printf(\"a = %d , ch = %c \\n\", a, ch);\n    return 0;\n}\n```\n\n```cpp\n#include<iostream>\nusing namespace std;\nint main()\n{\n    int a = 0;\n    char ch = '\\0';\n    cin >> a >> ch;//ä¸å¯å†™ä½œcin >> a, ch;\n    cout << \"a = \" << a << \"\\t\" << \"ch = \" << ch << endl;\n    return 0;\n}\n```\n\n# å‡½æ•°çš„åŒºåˆ«\n\n## å‡½æ•°å‚æ•°é»˜è®¤å€¼\n\n```c++\nint fun(int a, int b, int c)\n{\n    cout << a << endl;\n    cout << b << endl;\n    cout << c << endl;\n    return 0;\n}\n```\n\n\n```c++\nint fun(int a, int b, int c = 10)\n{\n    cout << a << endl;//<<ä¸ºè¾“å‡ºè¿ç®—ç¬¦ã€‚\n    cout << b << endl;\n    cout << c << endl;\n    return 0;\n}\nint main()\n{\n    int a = 1;\n    int b = 2;\n    fun(a,b);\n    //çŸ¥è¯†ç‚¹ï¼šå‡½æ•°çš„é»˜è®¤å€¼å‚æ•°ï¼šå¦‚æœä¸ä¼ cï¼Œåˆ™å¡«å……é»˜è®¤å€¼ï¼Œpush 0Ahï¼Œå…¶ä»–çš„å‚æ•°push eaxã€‚\n    //åœ¨å‡½æ•°å£°æ˜æˆ–è€…å®šä¹‰çš„æ—¶å€™ç»™å®šå‚æ•°é»˜è®¤å€¼ï¼›å¦‚æœå®å‚ä¼ é€’çš„æ—¶å€™ä¸ç»™è¯¥å½¢å‚ä¼ å€¼ï¼Œåˆ™ä¼šæŒ‰ç…§é»˜è®¤å€¼ä¼ å‚ã€‚\n    //å‡½æ•°çš„é»˜è®¤å€¼å‚æ•° æ˜¯åœ¨ç¼–è¯‘æœŸï¼Œç”ŸæˆæŒ‡ä»¤çš„æ—¶å€™ï¼Œç›´æ¥ç”Ÿæˆå…¥å‚æŒ‡ä»¤ã€‚\n    //å‡½æ•°å‚æ•°é»˜è®¤å€¼ä¸èƒ½ä¼ é€’å˜é‡ï¼Œå¿…é¡»æ˜¯å¸¸é‡ã€‚å› ä¸ºå˜é‡åœ¨ç¼–è¯‘æœŸæ—¶æ— æ³•å–å€¼ã€‚\n    return 0;\n}\n```\n\n```c++\n//ä»¥ä¸‹æƒ…å†µä¸å¯ä»¥ï¼Œåœ¨è°ƒç”¨æ­¤å‡½æ•°æ—¶ï¼Œä¼šå‡ºç°æ­§ä¹‰ã€‚å› æ­¤ç¼–è¯‘å™¨ä¸èƒ½é€šè¿‡ã€‚\n//å‡½æ•°çš„å‚æ•°åªèƒ½ä»å³å‘å·¦ä¾æ¬¡è¿ç»­èµ‹å€¼ï¼Œä¸èƒ½è·³è¿‡\nint fun(int a, int b = 10, int c)\n{\n    cout << a << endl;\n    cout << b << endl;\n    cout << c << endl;\n    return 0;\n}\n```\n\n```c++\n//ä½†æ˜¯å¦‚ä¸‹ä»£ç å¯ä»¥è¿è¡Œï¼Œç»“æœä¸º1, 10, 20.\n//ç›¸å½“äºfunå‡½æ•°åœ¨å®šä¹‰æ—¶å®šä¹‰cçš„é»˜è®¤å€¼ä¸º20ï¼Œåœ¨å£°æ˜æ—¶å®šä¹‰bçš„é»˜è®¤å€¼ä¸º10ã€‚\nint fun(int a, int b, int c = 20)\n{\n    cout << a << endl;//<<ä¸ºè¾“å‡ºè¿ç®—ç¬¦ã€‚\n    cout << b << endl;\n    cout << c << endl;\n    return 0;\n}\nint fun(int a, int b = 10, int c);\nint main()\n{\n    int a1=1;\n    fun(a1);\n}\n```\n\n\n\n```c++\n//é”™è¯¯ï¼Œå‡½æ•°çš„é»˜è®¤å€¼å‚æ•°åœ¨åŒä¸€ä½œç”¨åŸŸåªèƒ½èµ‹å€¼ä¸€æ¬¡ï¼Œä¸èƒ½é‡å¤ç»™ç›¸åŒçš„ä¸€ä¸ªå‚æ•°èµ‹å€¼ã€‚\nint fun(int a, int b, int c = 20)\n{\n    cout << a << endl;//<<ä¸ºè¾“å‡ºè¿ç®—ç¬¦ã€‚\n    cout << b << endl;\n    cout << c << endl;\n    return 0;\n}\nint fun(int a, int b, int c = 30);\n//æ— æ³•è¿è¡Œï¼Œæç¤ºå‚æ•°é»˜è®¤å€¼é‡å®šä¹‰èµ‹å€¼ã€‚\n```\n\n```c++\n//ä¸å¯è¡Œã€‚ç¼–è¯‘æ˜¯é’ˆå¯¹å•æ–‡ä»¶çš„ï¼Œæ‰€ä»¥ä¸èƒ½çŸ¥é“åœ¨å…¶ä»–æ–‡ä»¶å‡½æ•°ä¸­å®šä¹‰çš„å‡½æ•°å‚æ•°é»˜è®¤å€¼\n#fun.cpp\nint fun(int a, int b, int c = 20)\n{\n    cout << a << endl;\n    cout << b << endl;\n    cout << c << endl;\n    return 0;\n}\n#main.cpp\nint fun(int a, int b, int c);\nint main()\n{\n    int a1 = 1;\n    int b1 = 2;\n    fun(a1,b1);\n    return 0;\n}\n```\n\n### æ€»ç»“\n\nå› ä¸ºå‡½æ•°å‚æ•°çš„é»˜è®¤å€¼æ˜¯åœ¨ç¼–è¯‘å™¨å¸¦å…¥çš„ï¼Œæ‰€ä»¥å‡½æ•°çš„å‚æ•°çš„é»˜è®¤å€¼åªèƒ½åœ¨æœ¬å•æ–‡ä»¶ï¼ˆä¸åŒ…æ‹¬å¤´æ–‡ä»¶ï¼Œå¤´æ–‡ä»¶çš„ä¿¡æ¯æ˜¯åœ¨é¢„ç¼–è¯‘æœŸå°±å±•å¼€äº†ã€‚ï¼‰ç”Ÿæ•ˆã€‚\n\n## inlineå’Œå†…è”\n\nåœ¨è°ƒç”¨å†…è”å‡½æ•°æ—¶ï¼Œè¯¥å‡½æ•°ä¼šåœ¨è°ƒç”¨ç‚¹å°†ä»£ç å±•å¼€ï¼ˆå¤åˆ¶ï¼‰ã€‚\n\n```c++\ninline int fun1(int a, int b)\n{\n    int c = a + b;\n    cout << c << endl;\n    return c;\n}\nint main()\n{\n    int a1 = 1;\n    int b1 = 2;\n    fun1(a1,b1);\n    return 0;\n}\n```\n\n### ä¸ä¸€èˆ¬å‡½æ•°çš„å¯¹æ¯”\n\n* ä¸€èˆ¬å‡½æ•°è°ƒç”¨æ˜¯ä¸€ä¸ªæ¶ˆè€—å¾ˆå¤§çš„è¿‡ç¨‹\n    1. ä¼ å‚\n    2. callè°ƒç”¨å‡½æ•°\n    3. å¼€è¾Ÿæ ˆå¸§\n    4. å¦‚æœæœ‰è¿”å›å€¼åˆ™è¿”å›ç»“æœ\n    5. æ ˆå¸§å›é€€\n    6. å‚æ•°æ¸…é™¤\n\n\n* å†…è”å‡½æ•°\n    1. åœ¨å‡½æ•°çš„è°ƒç”¨ç‚¹å±•å¼€ï¼ˆå‡½æ•°ä½“ä¸­çš„æŒ‡ä»¤å¤åˆ¶è¿‡å»ï¼‰\n    2. ä¸ç”¨ä¼ å‚\n    3. ä¸ç”¨call\n    4. ä¸ç”¨...\n\n\n### debugå’Œreleaseå¯¹æ¯”\n\n* åœ¨debugç‰ˆæœ¬ï¼Œå†…è”å‡½æ•°å¤±æ•ˆï¼Œå’Œæ­£å¸¸å‡½æ•°è°ƒç”¨æ–¹å¼ä¸€è‡´ï¼›\n* åœ¨releaseç‰ˆæœ¬ï¼Œåœ¨è°ƒç”¨å†…è”å‡½æ•°æ—¶å€™ï¼Œè¯¥å‡½æ•°ä¼šåœ¨è°ƒç”¨ç‚¹å±•å¼€ã€‚\n\n### å“ªäº›å‡½æ•°ä¸èƒ½è¢«å±•å¼€\n\nå†…è”å‡½æ•°æ˜¯åœ¨ç¼–è¯‘æ—¶æœŸï¼Œç”ŸæˆæŒ‡ä»¤æ—¶å±•å¼€çš„ã€‚\n\n* é€’å½’å‡½æ•°æ— æ³•å±•å¼€ã€‚å› ä¸ºé€’å½’å‡½æ•°çš„ç»ˆæ­¢æ¡ä»¶ä¸€å®šéœ€è¦ç”±å˜é‡å†³å®šï¼Œé€’å½’å±‚æ•°ä¸å®šã€‚è€Œç¼–è¯‘æœŸæ˜¯æ— æ³•å¾—çŸ¥å˜é‡çš„å…·ä½“å€¼ã€‚æ‰€ä»¥é€’å½’å‡½æ•°ä¸èƒ½è¢«å¤„ç†ä¸ºå†…è”å‡½æ•°ã€‚\n\n### inlineå’Œå†…è”çš„å…³ç³»\n\n```c++\ninline int fun1(int a, int b)\n{\n    fun1(a,b);\n    //ä¸æŠ¥é”™ï¼Œåªè­¦å‘Š\n}\n```\n\nä¸ºä½•ä¸ä¼šæŠ¥é”™ï¼Ÿ\n\n**inlineåªæ˜¯å¯¹ç¼–è¯‘å™¨ã€CPUçš„å»ºè®®**ï¼Œå£°æ˜å»ºè®®å°†è¯¥å‡½æ•°å¤„ç†ä¸ºå†…è”ã€‚å®é™…æƒ…å†µç”±ç¼–è¯‘å™¨è§†æƒ…å†µå†³å®šã€‚æ„æ€å°±æ˜¯ï¼šè™½ç„¶æœ‰çš„å‡½æ•°åŠ äº†inlineä¿®é¥°ï¼Œä½†æ˜¯ç»“æœä¸ä¸€å®šè¢«å†…è”å¤„ç†ã€‚\n\n## å®å‡½æ•°ã€staticå‡½æ•°ã€å†…è”å‡½æ•°çš„å¯¹æ¯”\n\n### å®å‡½æ•°\n\n```cpp\n#define SUM(a,b) {a+b;}\n```\n\n1. é¢„ç¼–è¯‘æ—¶æœŸåœ¨è°ƒç”¨ç‚¹å±•å¼€\n2. æ— æ³•è°ƒè¯•\n3. æ²¡æœ‰å‚æ•°ç±»å‹å®‰å…¨æ ¡éªŒï¼Œå› ä¸ºå®ƒè¿ç±»å‹éƒ½æ— æ³•æŒ‡å‡º\n4. ä½œç”¨åŸŸï¼šå•æ–‡ä»¶å¯è§\n5. é¢„ç¼–è¯‘æœŸå°±å±•å¼€äº†ï¼Œä¸ç”Ÿæˆç¬¦å·\n\n### staticå‡½æ•°\n\n1. ä¸å±•å¼€\n2. å¯ä»¥è°ƒè¯•\n3. æœ‰å‚æ•°ç±»å‹å®‰å…¨æ ¡éªŒ\n4. ä½œç”¨åŸŸï¼šå•æ–‡ä»¶å¯è§\n5. ç”Ÿæˆlocalå‹ç¬¦å·\n\n### å†…è”å‡½æ•°\n\n1. debugç‰ˆæœ¬ä¸å±•å¼€ï¼›releaseç‰ˆæœ¬åœ¨è°ƒç”¨ç‚¹å±•å¼€\n2. debugç‰ˆæœ¬å¯ä»¥è°ƒè¯•ï¼›releaseç‰ˆæœ¬ä¸å¯è°ƒè¯•\n3. æœ‰å‚æ•°ç±»å‹å®‰å…¨æ ¡éªŒ\n4. ä½œç”¨åŸŸï¼šå•æ–‡ä»¶å¯è§\n5. debugç”Ÿæˆlocalç¬¦å·ï¼›releaseç‰ˆæœ¬ä¸ç”Ÿäº§ç¬¦å·ã€‚\n    * ä¸ºä½•åœ¨releaseç‰ˆæœ¬ä¸ç”Ÿæˆç¬¦å·ï¼Ÿï¼šç¼–è¯‘æœŸé—´å·²ç»å±•å¼€äº†ï¼Œç›¸å½“äºå‡½æ•°ç­¾åæ˜¯é€æ˜çš„ï¼Œä¸èƒ½ç”Ÿæˆç¬¦å·\n    * ä¸ºä½•åœ¨debugç‰ˆæœ¬ç”Ÿæˆç¬¦å·ï¼Ÿï¼šdebugè¦æ±‚èƒ½å¤Ÿè°ƒè¯•å‡½æ•°ï¼Œæ—¢ç„¶è¦è°ƒè¯•å‡½æ•°ï¼Œå°±è¦çŸ¥é“å‡½æ•°çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¸èƒ½å†…è”å¤„ç†ï¼Œæ‰€ä»¥è¦ç”Ÿæˆç¬¦å·ä»¥æ ‡è¯†ã€‚\n    * ä¸ºä½•debugç‰ˆæœ¬ç”Ÿæˆçš„æ˜¯localç¬¦å·ï¼Ÿï¼šç¼–è¯‘æœŸåªå¤„ç†ã€ç”Ÿæˆå•æ–‡ä»¶ï¼Œå†…è”å‡½æ•°æœ¬æ„æ˜¯åªå±•å¼€åœ¨æœ¬å•æ–‡ä»¶ä¸­ï¼Œä¸èƒ½ç”¨äºå…¶ä»–æ–‡ä»¶ï¼Œæ‰€ä»¥åªèƒ½æ˜¯localç¬¦å·ã€‚\n\n### æ™®é€šå‡½æ•°\n\nä¸å±•å¼€ï¼Œå¯ä»¥è°ƒè¯•ï¼Œæœ‰å‚æ•°ç±»å‹æ ¡éªŒï¼Œå¤šæ–‡ä»¶å¯è§ï¼Œç”Ÿæˆglobalç¬¦å·ã€‚\n\n## å‡½æ•°çš„é‡è½½-é™å¤šæ€\n\nå‡½æ•°çš„é‡è½½--é™å¤šæ€--ç¼–è¯‘æ—¶æœŸçš„å¤šæ€--æ—©ç»‘å®š\n\n### å‡½æ•°çš„åŸå‹\n\nå‡½æ•°çš„é‡è½½å°±è¦çœ‹å‡†å‡½æ•°çš„åŸå‹ï¼šåŒ…æ‹¬å‡½æ•°è¿”å›ç±»å‹ã€å‡½æ•°åã€å½¢å‚åˆ—è¡¨ï¼ˆå…¶ä¸­å½¢å‚åå¯çœç•¥ï¼‰ï¼Œä¸”ä¸éœ€è¦å‡½æ•°ä½“ã€‚\n\nä½†æ˜¯æˆ‘ä»¬ä¸èƒ½æ‹¿å‡½æ•°è¿”å›ç±»å‹ä½œä¸ºé‡è½½çš„æ ‡å¿—ï¼Œå› ä¸ºä¼šäº§ç”Ÿ**äºŒä¹‰æ€§**ã€‚\n\n```cpp\nchar Max(char a, char b)\n{\n    return a>b?a:b;\n}\nint Max(char a, char b)\n{\n    return a>b?a:b;\n}\n//å¦‚æ­¤å¦‚æœèƒ½ç¼–è¯‘é€šè¿‡çš„è¯ï¼Œä½ è¯´ä½ æ˜¯è¿”å›charè¿˜æ˜¯è¿”å›intï¼Ÿcharæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªæ•´å‹ï¼æ‰€ä»¥ä¸èƒ½è¿™æ ·ç¼–å†™ã€‚\n```\n\næ‰€ä»¥Cppä¸­çš„é‡è½½å°±æ˜¯ï¼šå‡½æ•°åç›¸åŒï¼Œå‚æ•°åˆ—è¡¨ä¸åŒã€‚\n\n### æŒ‰å‡½æ•°ç”Ÿæˆçš„ç¬¦å·åŒºåˆ†å‡½æ•°\n\nç¬¦å·ä¸èƒ½åŒåï¼Œå¦åˆ™è¢«è®¤ä¸ºæ˜¯é‡å®šä¹‰ã€‚å› æ­¤ç”Ÿæˆçš„ç¬¦å·ä¸èƒ½ä¸€æ ·ã€‚\n\nCppä¸­çš„å‡½æ•°å¯ä»¥é‡è½½ï¼ŒCè¯­è¨€ä¸å¯ä»¥ã€‚å› ä¸ºCè¯­è¨€å’ŒCppç”Ÿæˆå‡½æ•°ç¬¦å·çš„æ•ˆæœä¸åŒã€‚\n\n* Cè¯­è¨€ç”Ÿæˆå‡½æ•°ç¬¦å·**ä»…ä¾èµ–å‡½æ•°å**ã€‚\n\n```c++\n//cè¯­è¨€çš„å†™æ³•\nbool compare1(int a, int b)\n{\n    return a > b;\n}\nbool compare2(char a, char b)\n{\n    return a > b;\n}\nint main()\n{\n    int a1 = 1;\n    int b1 = 2;\n    \n    char a2 = 'c';\n    char b2 = 'b';\n    \n    compare1(a1,b1);\n    compare2(a2,b2);\n}\n```\n\n* C++ç”Ÿæˆå‡½æ•°ç¬¦å·ä¾èµ–**å‡½æ•°åå’Œå‚æ•°åˆ—è¡¨**ï¼ˆè¿”å›å€¼ä¸å½±å“ï¼‰ã€‚\n\n```c++\nbool compare(int a, int b)\n{\n    cout << \"bool compare(int a, int b)\" << endl;\n}\nbool compare(char a, char b)\n{\n    cout << \"bool compare(char a, char b)\" << endl;\n}\n```\n\n### é™å¤šæ€\n\nå‡½æ•°é‡è½½åï¼Œç©¶ç«Ÿè°ƒç”¨å“ªä¸ªå‡½æ•°ï¼Ÿæ˜¯åœ¨ç¼–è¯‘æ—¶æœŸå†³å®šçš„ï¼Œå› ä¸ºç¼–è¯‘ç”ŸæˆæŒ‡ä»¤å’Œç¬¦å·ï¼Œæ‰èƒ½ç¡®å®šcallå“ªä¸ªå…·ä½“çš„å‡½æ•°â€”â€”é™å¤šæ€çš„ä¸€ç§\n\n```c++\n//å¯ä»¥è¿è¡Œï¼Œå› ä¸ºè™½ç„¶mainä¸­åªæ˜¯å£°æ˜ï¼Œä½†æ˜¯ä¼šç”ŸæˆUNDç¬¦å·ï¼Œä¼šå¯»æ‰¾é“¾æ¥ã€‚\n#fun.cpp\nbool compare(int a, int b)\n{\n    cout << \"bool compare(int a, int b)\" << endl;\n}\nbool compare(char a, char b)\n{\n    cout << \"bool compare(char a, char b)\" << endl;\n}\n#main.cpp\nbool compare(int a, int b);//*UND*\nbool compare(char a, char b);\nint main()\n{\n    int a1 = 1;\n    int b1 = 2;\n    \n    char a2 = 'c';\n    char b2 = 'b';\n    \n    compare1(a1,b1);\n    compare2(a2,b2);\n}\n```\n\n### åå­—ä¿®é¥°çº¦å®šï¼ˆåå­—ç²‰ç¢ï¼‰\n\n![image-20220104201210066](../../images/Cppç¬¬ä¸€è¯¾_Cå’ŒC++åŒºåˆ«/image-20220104201210066.png)\n\n#### ä¿®é¥°å(Decoration name)\n\nâ€œCâ€æˆ–è€…â€œC++â€å‡½æ•°åœ¨å†…éƒ¨ï¼ˆç¼–è¯‘å’Œé“¾æ¥ï¼‰é€šè¿‡ä¿®é¥°åè¯†åˆ«ã€‚ä¿®é¥°åæ˜¯ç¼–è¯‘å™¨åœ¨ç¼–è¯‘å‡½æ•°å®šä¹‰æˆ–è€…åŸå‹æ—¶ç”Ÿæˆçš„å­—ç¬¦ä¸²ã€‚æœ‰äº›æƒ…å†µä¸‹ä½¿ç”¨å‡½æ•°çš„ä¿®é¥°åæ˜¯å¿…è¦çš„ï¼Œå¦‚åœ¨æ¨¡å—å®šä¹‰æ–‡ä»¶é‡Œå¤´æŒ‡å®šè¾“å‡ºâ€œC++â€é‡è½½å‡½æ•°ã€æ„é€ å‡½æ•°ã€ææ„å‡½æ•°ï¼Œåˆå¦‚åœ¨æ±‡ç¼–ä»£ç é‡Œè°ƒç”¨â€œCâ€æˆ–â€œC++â€å‡½æ•°ç­‰ã€‚\n\nä¿®é¥°åç”±å‡½æ•°åã€ç±»åã€è°ƒç”¨çº¦å®šã€è¿”å›ç±»å‹ã€å‚æ•°ç­‰å…±åŒå†³å®šã€‚\n\n#### åå­—ä¿®é¥°çº¦å®š\n\nåå­—ä¿®é¥°çº¦å®šéšè°ƒç”¨çº¦å®šå’Œç¼–è¯‘ç§ç±»(Cæˆ–C++æ–‡ä»¶)çš„ä¸åŒè€Œå˜åŒ–ã€‚ä¸‹é¢åˆ†åˆ«è¯´æ˜ã€‚ \n\n* Cç¼–è¯‘æ—¶å‡½æ•°åä¿®é¥°çº¦å®šè§„åˆ™ï¼š\n    1. `__stdcall`è°ƒç”¨çº¦å®šåœ¨è¾“å‡ºå‡½æ•°åå‰åŠ ä¸Šä¸€ä¸ªä¸‹åˆ’çº¿å‰ç¼€ï¼Œåé¢åŠ ä¸Šä¸€ä¸ªâ€œ@â€ç¬¦å·å’Œå…¶å‚æ•°çš„å­—èŠ‚æ•°ï¼Œæ ¼å¼ä¸º`_functionname@number`ã€‚\n    2. `__cdecl`è°ƒç”¨çº¦å®šä»…åœ¨è¾“å‡ºå‡½æ•°åå‰åŠ ä¸Šä¸€ä¸ªä¸‹åˆ’çº¿å‰ç¼€ï¼Œæ ¼å¼ä¸º`_functionname`ã€‚\n    3. `__fastcall`è°ƒç”¨çº¦å®šåœ¨è¾“å‡ºå‡½æ•°åå‰åŠ ä¸Šä¸€ä¸ªâ€œ@â€ç¬¦å·ï¼Œåé¢ä¹Ÿæ˜¯ä¸€ä¸ªâ€œ@â€ç¬¦å·å’Œå…¶å‚æ•°çš„å­—èŠ‚æ•°ï¼Œæ ¼å¼ä¸º`@functionname@number`ã€‚\n\nå®ƒä»¬å‡ä¸æ”¹å˜è¾“å‡ºå‡½æ•°åä¸­çš„å­—ç¬¦å¤§å°å†™ï¼Œè¿™å’ŒPASCALè°ƒç”¨çº¦å®šä¸åŒï¼ŒPASCALçº¦å®šè¾“å‡ºçš„å‡½æ•°åæ— ä»»ä½•ä¿®é¥°ä¸”å…¨éƒ¨å¤§å†™ã€‚\n\n* C++ç¼–è¯‘æ—¶å‡½æ•°åä¿®é¥°çº¦å®šè§„åˆ™ï¼š\n    1. `__stdcall`è°ƒç”¨çº¦å®šï¼š\n        1. ä»¥â€œ`?`â€æ ‡è¯†å‡½æ•°åçš„å¼€å§‹ï¼Œåè·Ÿå‡½æ•°åï¼›\n        2. å‡½æ•°ååé¢ä»¥â€œ`@@YG`â€æ ‡è¯†å‚æ•°è¡¨çš„å¼€å§‹ï¼Œåè·Ÿå‚æ•°è¡¨ï¼›\n        3. å‚æ•°è¡¨ä»¥ä»£å·è¡¨ç¤º\n            1. `X--void ï¼Œ D--charï¼Œ E--unsigned charï¼Œ F--shortï¼Œ H--intï¼ŒI--unsigned intï¼Œ J--longï¼Œ K--unsigned longï¼Œ M--floatï¼ŒN--doubleï¼Œ _N--boolï¼Œ.... `\n            2. `PA`è¡¨ç¤ºæŒ‡é’ˆï¼Œåé¢çš„ä»£å·è¡¨æ˜æŒ‡é’ˆç±»å‹ï¼Œå¦‚æœç›¸åŒç±»å‹çš„æŒ‡é’ˆè¿ç»­å‡ºç°ï¼Œä»¥â€œ`0`â€ä»£æ›¿ï¼Œä¸€ä¸ªâ€œ`0`â€ä»£è¡¨ä¸€æ¬¡é‡å¤ï¼›\n        4. å‚æ•°è¡¨çš„**ç¬¬ä¸€é¡¹ä¸ºè¯¥å‡½æ•°çš„è¿”å›å€¼ç±»å‹**ï¼Œ**å…¶åä¾æ¬¡ä¸ºå‚æ•°**çš„**æ•°æ®ç±»å‹**ï¼Œ**æŒ‡é’ˆæ ‡è¯†åœ¨å…¶æ‰€æŒ‡æ•°æ®ç±»å‹å‰**ï¼›\n        5. å‚æ•°è¡¨åä»¥â€œ`@Z`â€æ ‡è¯†æ•´ä¸ªåå­—çš„ç»“æŸï¼Œå¦‚æœè¯¥å‡½æ•°æ— å‚æ•°ï¼Œåˆ™ä»¥â€œ`Z`â€æ ‡è¯†ç»“æŸã€‚\n            1. å…¶æ ¼å¼ä¸ºâ€œ`?functionname@@YA*****@Z`â€æˆ–â€œ`?functionname@@YG*XZ`â€ã€‚ä¾‹å¦‚`int Test1(char *var1,unsigned long)`ï¼šâ€œ`?Test1@@YGHPADK@Z`â€\n    2. `__cdecl`è°ƒç”¨çº¦å®šï¼šè§„åˆ™åŒä¸Šé¢çš„`_stdcall`è°ƒç”¨çº¦å®šï¼Œåªæ˜¯å‚æ•°è¡¨çš„å¼€å§‹æ ‡è¯†ç”±ä¸Šé¢çš„â€œ`@@YG`â€å˜ä¸ºâ€œ`@@YA`â€ã€‚\n    3. `__fastcall`è°ƒç”¨çº¦å®šï¼šè§„åˆ™åŒä¸Šé¢çš„`_stdcall`è°ƒç”¨çº¦å®šï¼Œåªæ˜¯å‚æ•°è¡¨çš„å¼€å§‹æ ‡è¯†ç”±ä¸Šé¢çš„â€œ`@@YG`â€å˜ä¸ºâ€œ`@@YI`â€\n    4. VC++å¯¹å‡½æ•°çš„ç¼ºçœå£°æ˜æ˜¯\"`__cedcl`\"ï¼Œå°†åªèƒ½è¢«C/C++è°ƒç”¨ã€‚\n\n# ç¬¦å·\n\nç¬¦å·=æ•°æ®+æŒ‡ä»¤\n\n## ç¬¦å·çš„æ¥æº\n\næ‰€æœ‰çš„æ•°æ®éƒ½ä¼šç”Ÿæˆç¬¦å·ã€‚\n\næŒ‡ä»¤ä¸­ï¼ˆæ¯”å¦‚å‡½æ•°å£°æ˜ï¼‰åªæœ‰å‡½æ•°åä¼šç”Ÿæˆç¬¦å·ã€‚\n\n## ç¬¦å·åˆå¯åˆ†ä¸ºä¸¤ç§\n\n* å…¨å±€ç¬¦å·-globalç¬¦å·\n    * æ‰€æœ‰çš„æ–‡ä»¶éƒ½å¯ä»¥å¼•å…¥ã€‚\n\n* å±€éƒ¨ç¬¦å·-localç¬¦å·\n    * åªæœ‰æœ¬æ–‡ä»¶å¯è§ã€‚\n\n## å…·ä½“è¡¨ç°\n\n* æ™®é€šçš„å‡½æ•°ç”Ÿæˆçš„æ˜¯globalç¬¦å·ã€‚\n* è¢«inlineä¿®é¥°çš„å‡½æ•°ï¼Œè¯­ä¹‰ä¸ºåªåœ¨æœ¬æ–‡ä»¶å¯è§ï¼Œæ‰€ä»¥ç”Ÿæˆçš„æ˜¯localç¬¦å·ã€‚\n* å¦‚æœå‡½æ•°åªæ˜¯å£°æ˜è€Œæœªåœ¨æœ¬æ–‡ä»¶å®šä¹‰ï¼Œç”Ÿæˆçš„ç¬¦å·æ˜¯UNDã€‚\n* inlineå‡½æ•°åœ¨debugç‰ˆæœ¬ç”Ÿæˆçš„æ˜¯localå‹ç¬¦å·ï¼›å¦‚æœå¤„ç†ä¸ºå†…è”ä¹‹åï¼Œåœ¨releaseç‰ˆæœ¬ä¸‹ä¸ç”Ÿæˆç¬¦å·ï¼Œå› ä¸ºå®ƒå·²åœ¨è°ƒç”¨ç‚¹å¤„å±•å¼€äº†ã€‚\n\n# externå…³é”®å­—\n\nä¸¤ç§ç”¨æ³•ï¼š\n\n1. C++ä¸­ï¼Œå¹²é¢„ç¼–è¯‘å™¨ï¼Œextern \"C\"æ˜¯ä»¥Cæ–¹å¼ç¼–è¯‘ï¼Œextern \"C++\"æ˜¯ä»¥C++æ–¹å¼ç¼–è¯‘ï¼›\n2. Cè¯­è¨€ä¸­ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨ï¼Œå‡½æ•°æ˜¯å¤–éƒ¨å‡½æ•°ï¼Œæ—¢å¯ä»¥ç”¨åœ¨æœ¬æ–‡ä»¶ï¼Œä¹Ÿå¯ç”¨åœ¨å…¶ä»–æ–‡ä»¶ã€‚\n\n## åœ¨cppæ–‡ä»¶ä¸­è°ƒç”¨cæ–‡ä»¶\n\nçŸ›ç›¾ç‚¹ï¼š\n\n1. C++è°ƒç”¨C--C++äº§ç”Ÿå‡½æ•°ç¬¦å·-ï¼ˆå‡½æ•°å+å‚æ•°ç±»å‹åˆ—è¡¨ï¼‰ï¼ŒCè¯­è¨€äº§ç”Ÿå‡½æ•°ç¬¦å·-ï¼ˆå‡½æ•°åï¼‰\n2. Cè¯­è¨€è°ƒç”¨C++--å¦‚æœå°†C++çš„å‡½æ•°ç¬¦å·æ”¹ä¸ºCè¯­è¨€çš„å‡½æ•°ç¬¦å·--éœ€è¦æ”¹åŠ¨C++æºæ–‡ä»¶--ä¸ç°å®ã€‚æ­£ç¡®è§£å†³åŠæ³•æ˜¯æ·»åŠ è‡ªå·±å®ç°çš„C++æ–‡ä»¶ï¼Œå†™**C++å‡½æ•°ä½œä¸ºä¸­é—´å±‚å»è°ƒç”¨éœ€è¦çš„C++å‡½æ•°ï¼Œç„¶åè®©è‡ªå®ç°çš„C++å‡½æ•°äº§ç”ŸCè¯­è¨€ç¬¦å·ï¼ˆextern Cï¼‰**ã€‚\n\n```c\n#func.c\n\n#include<stdio.h>\nvoid fun_C()\n{\n    printf(\"void fun_C()\");\n}\n#main.cpp\nvoid fun_C();\n//cppç”Ÿæˆçš„ç¬¦å·çš„æ–¹å¼æ˜¯å–å†³äºå‡½æ•°åå’Œå‚æ•°åˆ—è¡¨ã€‚\n//è€Œcç”Ÿæˆçš„ç¬¦å·åªæ˜¯å‡½æ•°å\n//cå’Œcppç”Ÿæˆç¬¦å·çš„è§„åˆ™ä¸ä¸€æ ·ï¼Œæ‰€ä»¥å¯¼è‡´ç¬¦å·æ‰¾ä¸åˆ°ã€‚\nint main()\n{\n    fun_C();\n    return 0;\n}\n```\n\næ‰€ä»¥ï¼Œå¦‚ä½•åœ¨cppæ–‡ä»¶ä¸­è°ƒç”¨cå‡½æ•°ï¼Ÿ\n\n```cpp\n//å¦‚ä½•è§£å†³â€”â€”ä½¿ç”¨Cè¯­è¨€çš„æ–¹å¼ç¼–è¯‘å’Œç”Ÿæˆç¬¦å·ã€‚\nextern \"C\"\n{\n    void fun_C();//å£°æ˜\n}\nint main()\n{\n    fun_C();\n    return 0;\n}\n```\n\nå¦‚æœæƒ³åè¿‡æ¥å‘¢ï¼Ÿåœ¨cæ–‡ä»¶ä¸­æ€ä¹ˆè°ƒç”¨cppçš„ä»£ç ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ\n\n```c++\n#fun.cpp\nvoid fun_CPP()//ç”Ÿæˆçš„ç¬¦å·ï¼šfun_CPP_void\n{\n    printf(\"void fun_CPP()\");\n}\n\n#func.c\nvoid fun_CPP();//ç”Ÿæˆçš„ç¬¦å·ï¼šfun_CPP\nint main()\n{\n    fun_CPP();\n    return 0;\n}\n\n```\n\nè§£å†³æ–¹æ¡ˆï¼šä¸­é—´åŠ ä¸€å±‚\n\n```c++\n//Cè°ƒç”¨C++çš„ä»£ç æ–¹æ³•\n------------------------------------------\n#fun.cpp\nint fun_CPP(int a)//ç”ŸæˆCppç¬¦å·ï¼šfun_CPP_int\n{\n    printf(\"int fun_CPP(int a)\");\n    return a;\n}\n------------------------------------------\n#tmp.cpp\nvoid fun_CPP();\t\t\t//å£°æ˜\nextern \"C\"\n{\n    int fun_CPP_tmp(int a)\t//è¦ä¸fun_CPPå½¢å¼ä¸€è‡´\n    {\n        return fun_CPP(a);\n    }\n}\n-----------------------------------------\n#func.c\nint fun_CPP_tmp(int a);//ç”ŸæˆCç¬¦å·ï¼šfun_CPP\nint main()\n{\n    int n = 100;\n    int res = fun_CPP_tmp(100);\n    return 0;\n}\n```\n\n# namespace\n\nå®é™…ä¸Šæ˜¯ä¸ªå¤´æ–‡ä»¶ã€‚\n\n```c++\n//tmp.h\nnamespace AA\n{\n    typedef int INT;\n    typename char CHAR;\n}\n```\n\n\n\n```c++\n#include<iostream>\nusing namespace AA;\nint main()\n{\n    INT a = 10;//éœ€è¦ä½¿ç”¨å‘½åç©ºé—´AAæ‰èƒ½ç¼–è¯‘é€šè¿‡ã€‚\n    return 0;\n}\n```\n\nå¦å¤–ä¸€ç§ä½¿ç”¨æ–¹å¼\n\n```c++\nusing AA::INT;//æ‹¿å‡ºå‘½åç©ºé—´ä¸­ç‰¹å®šçš„æŸä¸€ä¸ªä½¿ç”¨ã€‚\n```\n\nnamespaceä¸»è¦ä½œç”¨æ˜¯å°è£…ï¼Œé˜²æ­¢å‘½åå†²çªé—®é¢˜ã€‚\n\n# æŒ‡é’ˆå’Œæ•°ç»„\n\n```c++\n//fun.cpp\nint arr[]={0,1,2,3,4,5,6,7,8,9};\n```\n\n```c++\nusing AA::INT;\nextern int* arr;\n/*\næŒ‡é’ˆå’Œæ•°ç»„åçš„åŒºåˆ«â€”â€”ä»€ä¹ˆæ˜¯æŒ‡é’ˆ\n*/\nint main()\n{\n    cout << arr << endl;\t\t//\n    cout << *arr << endl;\t//\n    cout << arr[0] << endl;\n}\n//è¾“å‡º00000000\\n å´©æºƒ\nint main()\n{\n    int a = 10;\n    int *p = &a;\n    int arr1[]={0,1,2,3,4};\n    \n    cout << arr1 <<endl;\n    cout << p <<endl;\n    //è¾“å‡ºçš„éƒ½æ˜¯æ•°ç»„çš„åœ°å€ï¼Œæ­£å¸¸\n    //æ±‡ç¼–ä»£ç ï¼š\n    //1. lea eax,[arr1];  push eaxã€‚ç›´æ¥ä¼ å€¼ç»™eax\n    //2. mov eax,dword ptr [p];  push eaxã€‚æœ‰dword ptrï¼Œå»åœ°å€ä¸­å–å€¼\n    ///////\n    //æ•°ç»„åå°±æ˜¯ä¸ªåœ°å€ã€‚æœ¬è´¨æ˜¯å¸¸é‡ï¼Œæ˜¯ä¸ªæ•°å­—\n    //æŒ‡é’ˆæ˜¯å˜é‡ã€‚\n    \n    \n    \n    \n    //åœ¨ç¼–è¯‘æ—¶ï¼Œç›´æ¥æŠŠå¸¸é‡çš„å€¼æ›¿æ¢äº†å¸¸é‡åå­—ã€‚\n    \n}\n//å˜é‡å’Œå¸¸é‡æœ‰ä½•åŒºåˆ«ï¼Ÿ\nint main()\n{\n    int a = 20;\n    int *p = &a;\n    int b;\n    b = 20;\n    b = a;\n    //ç”¨å¸¸é‡ç»™å˜é‡èµ‹å€¼æ—¶ï¼Œç›´æ¥æ‹¿å€¼æ›¿æ¢ã€‚\n    //ç”¨å˜é‡ç»™å˜é‡èµ‹å€¼æ—¶ï¼Œæœ‰ä¸€æ¬¡è§£å¼•ç”¨\n    \n    b = *p;//å»pçš„å†…å­˜ä¸­å°†å­˜å‚¨çš„åœ°å€æ‹¿å‡ºæ¥ã€‚å†å»æ‹¿å‡ºæ¥çš„åœ°å€ä¸­å–å‡ºå­˜å‚¨çš„æ•°æ®ã€‚\n    //æ±‡ç¼–ï¼š\n    // mov eax,dword ptr [p]\n    // mov ecx,dword ptr [eax]\n    // mov dword ptr [b],ecx\n}\n/*\nå›åˆ°æœ€åˆçš„é—®é¢˜ï¼Œæˆ‘ä»¬æŠŠarrå½“ä½œäº†æŒ‡é’ˆï¼ŒæŠŠå¸¸é‡å½“ä½œäº†å˜é‡æ¥ç”¨ã€‚\nå¸¸é‡ä¸ç”¨ä¸‹åœ°å€ï¼Œå˜é‡éœ€è¦ä¸‹åœ°å€ã€‚\nå¦‚æœæŠŠå¸¸é‡å½“ä½œäº†å˜é‡æ¥ç”¨ï¼Œç¼–è¯‘å™¨ä¼šå°†è§£å¼•ç”¨ï¼ŒæŠŠè§£å¼•ç”¨åˆ°çš„æ•°æ®ï¼ˆæ•°ç»„é¦–å…ƒç´ ï¼‰å½“ä½œç»“æœæ¥è¾“å‡ºäº†ã€‚å³00000000\ncout << arr << endl;\nmov eax,dword [arr]\nmov out,eax\n*/\n```\n\n# const\n\n```c++\n//c_main.c\n#include<stdio.h>\nint main()\n{\n    const int a = 10;\n    a = 20;//æŠ¥é”™ï¼Œå¿…é¡»æ˜¯å¯ä¿®æ”¹çš„å·¦å€¼ã€‚\n    \n    int *p = &a;\n    *p = 20;\n    \n    \n    printf(\"%d\\n\",a);\n    \n    return 0;\n}\n```\n\n## Cï¼šå¸¸-å˜é‡\n\nä¸èƒ½ä½œä¸ºå·¦å€¼ã€‚\n\n## C++ï¼šå¸¸é‡\n\n```c++\nint main()\n{\n    const int a = 10;\n    //a = 20;\n    //int *p = &a;\n    cout << a <<endl;\n    cout << *p <<endl;\n    // 10 10\n    \n    *p = 20;\n    cout << a <<endl;\n    cout << *p <<endl;\n    //10 20\n    //C++ä¸­ï¼Œconstå¸¸é‡å°±æ˜¯çº¯å¸¸é‡ï¼Œè€Œä¸åƒCè¯­è¨€ä¸­å¯ä»¥è½»æ˜“é€šè¿‡æŒ‡é’ˆé—´æ¥ä¿®æ”¹çš„ã€‚\n    //mov out, 0Ah ; cout << a\n    //å¸¸é‡ï¼šåœ¨ç¼–è¯‘æœŸï¼Œå°†å¸¸é‡çš„å€¼ç›´æ¥ä¼ å…¥åˆ°ç›®æ ‡ä¸­ã€‚\n}\n```\n\n## é¢è¯•\n\nä¸ºä»€ä¹ˆå¸¸é‡å¿…é¡»åˆå§‹åŒ–ï¼Ÿ\n\nå› ä¸ºå¦‚æœè¦ä½¿ç”¨å¸¸é‡åˆä¸åˆå§‹åŒ–çš„è¯ï¼ŒåæœŸæ²¡æœ‰æœºä¼šæ”¹ã€‚ä½¿ç”¨ä¸€ä¸ªéšæœºå€¼å¯¹äºç¨‹åºæ²¡æœ‰æ„ä¹‰ã€‚\n\nå¦‚æœä½¿ç”¨å˜é‡ç»™constä¿®é¥°çš„é‡åˆå§‹åŒ–ï¼Œåˆ™è¯¥é‡ä¼šé€€åŒ–ä¸ºå¸¸å˜é‡ã€‚\n\n## æŒ‡é’ˆå’Œconst\n\n```c++\nint main()\n{\n    int *p1 = &a;\n    const int *p2 = &a;\n    int const* p3 = &a;\n    int* const p4 = &a;\n    \n    int *q1 = &a;\n    const int* q2 = &a;\n    int const* q3 = &a;\n    int* const q4 = &a;\n}\n```\n\nè¦ç‚¹1ï¼šconstä¿®é¥°çš„å†…å®¹ä¸èƒ½ä½œä¸ºå·¦å€¼\n\nè¦ç‚¹2ï¼šä¸èƒ½æ³„éœ²å¸¸é‡çš„åœ°å€ç»™éå¸¸é‡çš„æŒ‡é’ˆ\n\nconstä¿®é¥°çš„ç±»å‹æ˜¯ç¦»å®ƒæœ€è¿‘çš„ç¬¬ä¸€ä¸ªæˆå‹çš„ç±»å‹ã€‚å…¶ä½™çš„æ˜¯å®ƒä¿®é¥°çš„å†…å®¹ã€‚\n\n```c++\nint fun(int a)\n{\n    cout << typeid(a).name() << endl;\n    return 0;\n}\nint fun(const int a)\n{\n    cout << typeid(a).name() << endl;\n    return 0;\n}\n```\n\nå¦‚æœconstä¿®é¥°çš„å†…å®¹ä¸åŒ…å«æŒ‡é’ˆï¼Œåˆ™æ— æ³•å‚ä¸ç±»å‹ã€‚\n\n# åŠ¨æ€å†…å­˜\n\n## Cè¯­è¨€\n\nmalloc-free\n\n```c\n//ä½¿ç”¨mallocå’Œfreeç”³è¯·ã€é‡Šæ”¾ä¸€ç»´æ•°ç»„ã€äºŒä½æ•°ç»„\nint main()\n{\n    const int n = 10;\n    //ä¸€ç»´æ•°ç»„\n    int *ar = (int*)malloc(sizeof(int)*n);\n    //äºŒç»´æ•°ç»„\n    int **ar = (int**)malloc(sizeof(int*)*n);\n    if(NULL==ar)\n    {\n        exit(1);\n    }\n    for(int i=0;i<n;i++)\n    {\n        ar[i] = (int*)malloc(sizeof(int)*n);\n        if(NULL==ar[i])\n        {\n            exit(1);\n        }\n        \n    }\n    for(int i = 0;i<n;i++)\n    {\n        free(ar[i]);\n    }\n}\n\n```\n\n## C++\n\nnew-delete\n\n```c++\nint main()\n{\n    int *p = new int;\n    *p = 10;\n    delete p;\n    \n    int *arr = new int[10];\n    arr[0] = 10;\n    delete[]arr;//é‡Šæ”¾æ•°ç»„\n}\n```\n\n```c++\nint main()\n{\n    int **arr1 = new int* [4];\n    for(int i = 0;i<4;i++)\n    {\n        arr1[i] = new int[5];\n    }\n    for(int i =0;i<4;i++)\n    {\n        delete[]arr1[i];\n    }\n}\n```\n\n## newå’ŒmallocåŒºåˆ«\n\n1. newæ˜¯å…³é”®å­—ï¼Œmallocæ˜¯å‡½æ•°ï¼Œnewè°ƒç”¨mallocã€‚\n2. newå’Œmallocéƒ½æ˜¯åœ¨å †åŒºç”³è¯·ç©ºé—´\n3. newæœ‰ä¸‰ä¸ªæ­¥éª¤\n    1. å¼€è¾Ÿç©ºé—´\n    2. æ„é€ å‡½æ•°ã€‚---åˆå§‹åŒ–ï¼Œè¿™æ˜¯ä¸mallocçš„åŒºåˆ«ã€‚\n    3. è¿”å›åœ°å€\n4. newä¸ä¼šå¼ºè½¬è¿”å›å€¼ç±»å‹\n5. å°è£…è®¡ç®—sizeof\n6. ç©ºé—´ä¸è¶³æ—¶ï¼Œnewä¼šæŠ›å¼‚å¸¸ï¼ˆbad_allocï¼‰ã€‚mallocä¼šè¿”å›ç©ºæŒ‡é’ˆã€‚ï¼ˆ`int *p = new(nothrow) int(20);`ï¼‰\n\n## newä¸‰ç§è°ƒç”¨å½¢å¼\n\n1. å…³é”®å­—\n    1. `int *p = new int(10);\n2. å‡½æ•°\n    1. `int *p = ::operator new(sizeof(int));` æŠŠnewå½“å‡½æ•°è°ƒç”¨ï¼Œç±»ä¼¼äºmallocï¼Œæ²¡æœ‰åˆå§‹åŒ–ï¼ä»éœ€å¼ºè½¬å’Œä¼ å…¥sizeofå­—èŠ‚æ•°ã€‚ä½†æ˜¯è¿˜æ˜¯ä¼šæŠ›å¼‚å¸¸ã€‚\n    2. `operator delete(p);`ç›¸å½“äºfreeï¼Œéœ€è¦ç”¨å‡½æ•°å½¢å¼deleteé‡Šæ”¾ï¼Œå³`operator delete(p)`\n    3. ä¸æ­£å¸¸newåŒºåˆ«å°±æ˜¯æ²¡æœ‰åˆå§‹åŒ–ï¼›\n    4. éœ€è¦ç”¨å‡½æ•°å½¢å¼deleteé‡Šæ”¾ï¼Œå³operator delete(p)\n3. å®šä½new\n\n```c++\nint *pa = (int*)::operator new(sizeof(int));\nnew(pa) int(10);//ä¸å¼€è¾Ÿç©ºé—´ï¼Œè€Œæ˜¯ç”¨int(10)å»åˆå§‹åŒ–paæŒ‡å‘çš„ç©ºé—´ã€‚\n```\n# å¼•ç”¨\n\n## æ˜¯ä»€ä¹ˆ\n\nå¼ ä¸‰â€”â€”æœ‰ä¸ªå°åï¼ŒäºŒç‹—å­ã€‚äºŒç‹—å­å’Œå¼ ä¸‰æ˜¯åŒä¸€ä¸ªäººã€‚\n\n```c++\nint main()\n{\n    int a = 10;\n    int& b = a;\n    \n    \n    b = 20;//  mov eax,dword ptr [b]\n    cout << a <<endl;\n    cout << b <<endl;\n\t// 20 20\n\n\tint *p = &a;\n    *p = 20;\n}\n```\n\nå¼•ç”¨çš„åº•å±‚æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œ\n\nåœ¨ä½¿ç”¨åˆ°å¼•ç”¨çš„åœ°æ–¹ï¼Œç¼–è¯‘æœŸä¼šè‡ªåŠ¨æ›¿æ¢æˆæŒ‡é’ˆçš„è§£å¼•ç”¨ã€‚\n\n```cpp\n//c\nvoid Swap_C(int *ap, int *bp)\n{\n    assert(ap!=NULL&&bp!=NULL);\n    int tmp = *ap;\n    *ap = *bp;\n    *bp = tmp;\n}\n//cpp\nvoid Swap_Cpp(int& a, int& b)\n{\n    //æ— éœ€æ–­è¨€åˆ¤ç©ºï¼Œå› ä¸ºä¸å¯èƒ½æœ‰ç©ºå¼•ç”¨ã€‚\n    int tmp = a;\n    a = b;\n    b = tmp;\n}\nint main()\n{\n    int x = 10, y = 20;\n    Swap_C(&x, &y);\n    Swap_Cpp(x, y);\n    return 0;\n}\n```\n\nå¼•ç”¨ä¸ºä»€ä¹ˆå¿…é¡»åˆå§‹åŒ–ï¼Ÿ\n\nå¼•ç”¨ä¸ºä»€ä¹ˆä¸€æ—¦åˆå§‹åŒ–å°±æ— æ³•æ”¹å˜å¼•ç”¨çš„æ–¹å‘ï¼Ÿ\n\n```c++\nint main()\n{\n    const int c = 20;\n    int& d = c;//æŠ¥é”™\n    const int& d = c;\n}\n```\n\nç¬”è¯•å¸¸è§\n\n```c++\nint fun1()\n{\n    return 10;\n}\n\nint main()\n{\n    int& e = fun1();//æŠ¥é”™ï¼Œä¸èƒ½å¼•ç”¨å¯„å­˜å™¨\n    const int& e = fun1();\n    \n    const int& f = 10;\n    \n    //å½“å¼•ç”¨ä¸€ä¸ªä¸å¯å–åœ°å€çš„é‡çš„æ—¶å€™ï¼Œä½¿ç”¨å¸¸å¼•ç”¨\n    //ä¼šç”Ÿæˆä¸€ä¸ªä¸´æ—¶é‡ï¼Œå®é™…å¼•ç”¨çš„æ˜¯è¿™ä¸ªä¸´æ—¶é‡ã€‚\n    //ä¸ºä»€ä¹ˆå¿…é¡»è¦constæ¥ä¿®é¥°ä¸´æ—¶é‡ï¼Ÿå› ä¸ºä¸´æ—¶é‡éƒ½æœ‰å¸¸å±æ€§ã€‚ï¼ˆå…³äºä¸´æ—¶é‡ï¼Œé¢å‘å¯¹è±¡è¿˜ä¼šæ¶‰åŠã€‚\n}\n```\n\n## æ³¨æ„ç‚¹\n\n1. å®šä¹‰æ—¶å¿…é¡»åˆå§‹åŒ–ï¼›\n2. æ²¡æœ‰ç©ºå¼•ç”¨\n3. æ²¡æœ‰äºŒçº§å¼•ç”¨\n\n## å¸¸å¼•ç”¨\n\n```c++\nint a=10;\nint &b=a;\nconst int& c = b;\n```\n\n# ä¸¤ä¸ªæ¦‚å¿µ\n\n## é¢å‘è¿‡ç¨‹\n\n```c++\nint flag = 0;\nvoid echo()\n{\n    if(0 == flag)\n    {\n    \tprintf(\"%s\\n\",\"printf screen\");\n    }\n    else\n    {\n        printf(\"%s\\n\",\"printf file\");\n    }\n}\nvoid set_flag_file()\n{\n    flag = 1;\n}\nvoid set_flag_screen()\n{\n    flag = 0;\n}\n```\n\n\n\n## é¢å‘å¯¹è±¡\n\n```c++\nclass Note\n{\npublic:\n    Note()\n    {\n        _flag = 0;\n    }\n    void echo()\n    {\n        if(0 == _flag)\n        {\n            printf(\"%s\\n\",\"printf screen\");\n        }\n        else\n        {\n            printf(\"%s\\n\",\"printf file\");\n        }\n    }\n    void set_flag_file()\n    {\n        _flag = 1;\n    }\n    void set_flag_screen()\n    {\n        _flag = 0;\n    }\nprivate:\n    int _flag;\n}\nint main()\n{\n    Note n;\n    n.echo();\n    n.set_flag_file();\n    n.echo();\n    \n    \n    return 0;\n}\n```\n\n","categories":["Cpp"]},{"title":"Cè¯­è¨€_constä¸volatileå’Œmutable","url":"/C/Cè¯­è¨€_constä¸volatileå’Œmutable/","content":"# ä¸€å¥è¯ç»“è®º\nvolatileæ˜¯è¦æ±‚è¯»å€¼æ—¶ï¼Œå¿…é¡»æ¯æ¬¡ä»å†…å­˜ä¸­è¯»å–ã€‚ä¸èƒ½ä¼˜åŒ–ç¼“å­˜åˆ°å¯„å­˜å™¨ä¸­ï¼Œå› ä¸ºè¿™ä¸ªå˜é‡å®é™…çš„å€¼å¯èƒ½è¢«ä¿®æ”¹ï¼Œä»å¯„å­˜å™¨ä¸­è¯»å–ç¼“å­˜å¯èƒ½å‡ºç°è„å€¼ã€‚\n\n**å…¸å‹ç”¨é€”â€‹**â€‹ï¼šç¡¬ä»¶å¯„å­˜å™¨å’Œå¤šçº¿ç¨‹å…±äº«çš„åªè¯»çŠ¶æ€ã€‚\n\nåœ¨åµŒå…¥å¼ç¼–ç¨‹ä¸­ï¼Œç¡¬ä»¶å¯„å­˜å™¨å¯èƒ½è¢«æ˜ å°„åˆ°å›ºå®šåœ°å€ã€‚è¿™ä¸ªå¯„å­˜å™¨å¯èƒ½æ˜¯åªè¯»çš„ï¼ˆæ¯”å¦‚çŠ¶æ€å¯„å­˜å™¨ï¼‰ï¼Œ**ä½†å®ƒçš„å€¼ä¼šéšç€ç¡¬ä»¶çŠ¶æ€æ”¹å˜**ã€‚æ‰€ä»¥æˆ‘ä»¬æ—¢éœ€è¦`const`ï¼ˆå› ä¸ºç¨‹åºä¸èƒ½å†™å®ƒï¼‰åˆéœ€è¦`volatile`ï¼ˆå› ä¸ºå€¼ä¼šå˜ï¼Œç¼–è¯‘å™¨ä¸èƒ½ä¼˜åŒ–è¯»å–ï¼‰ã€‚\n\nvolatile ä¸ç¨‹åºæ‰€åšçš„æ›´æ”¹å®Œå…¨æ— å…³ã€‚è¿™æ„å‘³ç€**å†…å­˜å¯èƒ½ä¼šå› ä¸ºç¼–è¯‘å™¨æ— æ³•æ§åˆ¶çš„åŸå› è€Œæ”¹å˜**ï¼Œå› æ­¤ç¼–è¯‘å™¨æ¯æ¬¡éƒ½å¿…é¡»è¯»å–æˆ–å†™å…¥å†…å­˜åœ°å€ï¼Œå¹¶ä¸”ä¸èƒ½å°†å†…å®¹ç¼“å­˜åœ¨å¯„å­˜å™¨ä¸­ã€‚\n\nè€Œconståªæ˜¯ç»™ç¨‹åºå‘˜çš„æŒ‡å¯¼æ€§å»ºè®®ï¼Œå®é™…å¯ä»¥å¼ºåˆ¶ä¿®æ”¹constå˜é‡ã€‚è€Œä¸”conståªé™åˆ¶äº†ç¨‹åºå†…éƒ¨è¡Œä¸ºï¼Œå®ƒä¿®é¥°çš„å˜é‡ä»ç„¶å¯èƒ½è¢«å¤–éƒ¨ä¿®æ”¹ã€‚\n# constå’Œvolatileç»“åˆçš„æ±‡ç¼–åŒºåˆ«\n\n```c\nint main()\n{\n\tvolatile const int a = 0;\n\tint b = a;\n\tint* p = (int*)&a;\n\t*p = 10;\n}\n```\n\n![image-20210926094934967](../../images/C%E8%AF%AD%E8%A8%80_volatile&const/image-20210926094934967.png)\nåŒºåˆ«åœ¨äºï¼š`int b = a;`ï¼šå»å–äº†å†…å­˜ä¸­ a çš„åœ°å€ä¸­å®é™…çš„å€¼åˆ°å¯„å­˜å™¨ï¼Œå¯„å­˜å™¨ç»™ b èµ‹å€¼ã€‚\n\n```c\nint main()\n{\n\tconst int a = 0;\n\tint b = a;\n\tint* p = (int*)&a;\n\t*p = 10;\n}\n```\n\n![image-20210926095031711](../../images/C%E8%AF%AD%E8%A8%80_volatile&const/image-20210926095031711.png)\nåŒºåˆ«åœ¨äºï¼š`int b = a;`ï¼šæ²¡æœ‰å»å–å†…å­˜ä¸­ a çš„åœ°å€ä¸­å®é™…çš„å€¼ï¼Œè€Œæ˜¯ç»è¿‡äº†ä¼˜åŒ–ï¼Œç›´æ¥ç»™ b å¡«äº† 0 ã€‚\n\nå¦‚æœå˜é‡è¢«volatileä¿®é¥°ï¼Œåˆ™æ˜¯åœ¨ç»™ç¼–è¯‘å™¨è¯´æ˜ï¼šè¯¥å˜é‡å¯èƒ½éšæ—¶è¢«æ”¹å†™ã€‚\næ‰€ä»¥ç¼–è¯‘å™¨å°±ä¸ä¼šè½»æ˜“åœ°å»ä¼˜åŒ–ä»£ç ç»“æ„ã€‚\n\nconstï¼šæœ¬ç¨‹åºæ®µä¸­ä¸èƒ½å¯¹æ­¤å˜é‡ä½œä¿®æ”¹ï¼Œä»»ä½•ä¿®æ”¹éƒ½æ˜¯ä¸é€šè¿‡çš„ï¼Œæˆ–è€…è‡³å°‘æ˜¯ç²—å¿ƒï¼Œç¼–è¯‘å™¨åº”è¯¥æŠ¥é”™ï¼Œé˜²æ­¢è¿™ç§ç²—å¿ƒã€‚\nä½†constä¿®é¥°äº†çš„å˜é‡ä¸å…è®¸è¢«ä¿®æ”¹ï¼Œ**ä¸ä»£è¡¨ä¸å…è®¸é€šè¿‡åˆ«åçš„æ–¹å¼ä¿®æ”¹**ï¼Œæ¯”å¦‚ï¼š\n```c\nint i = 5;\nconst int* p = &i;\n*p = 6; // ä¸å¯ä»¥ï¼›\ni = 7;  // å®Œå…¨å¯ä»¥ï¼Œè€Œä¸”é‚£ä¸ªâ€œconstâ€çš„â€œ*pâ€ä¹Ÿè·Ÿç€å˜æˆäº†7ã€‚\n```\n# constå’Œvolatileæ”¾åœ¨ä¸€èµ·çš„æ„ä¹‰\nconstå’Œvolatileæ”¾åœ¨ä¸€èµ·çš„æ„ä¹‰åœ¨äºï¼š\nï¼ˆ1ï¼‰æœ¬ç¨‹åºæ®µä¸­ä¸èƒ½å¯¹aä½œä¿®æ”¹ï¼Œä»»ä½•ä¿®æ”¹éƒ½æ˜¯ä¸é€šè¿‡çš„ï¼Œæˆ–è€…è‡³å°‘æ˜¯ç²—å¿ƒï¼Œç¼–è¯‘å™¨åº”è¯¥æŠ¥é”™ï¼Œé˜²æ­¢è¿™ç§ç²—å¿ƒï¼›\nï¼ˆ2ï¼‰å¦ä¸€ä¸ªç¨‹åºæ®µåˆ™å®Œå…¨æœ‰å¯èƒ½ä¿®æ”¹ï¼Œå› æ­¤ç¼–è¯‘å™¨æœ€å¥½ä¸è¦åšå¤ªæ¿€è¿›çš„ä¼˜åŒ–ã€‚\n\nâ€œconstâ€å«ä¹‰æ˜¯â€œè¯·ä½œä¸ºå¸¸é‡ä½¿ç”¨â€ï¼Œ**ä½†ä¸æ˜¯**ï¼šâ€œæ”¾å¿ƒå§ï¼Œé‚£è‚¯å®šæ˜¯ä¸ªå¸¸é‡â€ã€‚\nâ€œvolatileâ€çš„å«ä¹‰æ˜¯â€œè¯·ä¸è¦åšæ²¡è°±çš„ä¼˜åŒ–ï¼Œè¿™ä¸ªå€¼å¯èƒ½å˜æ‰çš„â€ï¼Œ**ä½†ä¸æ˜¯**â€œä½ å¯ä»¥ä¿®æ”¹è¿™ä¸ªå€¼â€ã€‚\nå› æ­¤ï¼Œå®ƒä»¬ä¸æ˜¯çŸ›ç›¾çš„ã€‚\n## ä¾‹å­\n```c\nconst volatile int i = 10;\n```\nè¿™è¡Œä»£ç æœ‰æ²¡æœ‰é—®é¢˜ï¼Ÿå¦‚æœæ²¡æœ‰ï¼Œé‚£ `i` åˆ°åº•æ˜¯ä»€ä¹ˆå±æ€§?\n\nå›ç­”ä¸€ï¼š\n1. æ²¡æœ‰é—®é¢˜ã€‚\n2. ä¾‹å¦‚åªè¯»çš„çŠ¶æ€å¯„å­˜å™¨ã€‚å®ƒæ˜¯volatileï¼Œå› ä¸ºå®ƒå¯èƒ½è¢«æ„æƒ³ä¸åˆ°åœ°æ”¹å˜ã€‚\n3. å®ƒæ˜¯constï¼Œå› ä¸ºç¨‹åºä¸åº”è¯¥è¯•å›¾å»ä¿®æ”¹å®ƒã€‚\n4. volatileå’Œconstå¹¶ä¸çŸ›ç›¾ï¼Œåªæ˜¯æ§åˆ¶çš„èŒƒå›´ä¸ä¸€æ ·ï¼Œä¸€ä¸ªåœ¨ç¨‹åºæœ¬èº«ä¹‹å¤–ï¼Œå¦ä¸€ä¸ªæ˜¯ç¨‹åºæœ¬èº«ã€‚\n\nå›ç­”äºŒï¼š\n1. æ²¡é—®é¢˜ï¼Œconstå’Œvolatileè¿™ä¸¤ä¸ªç±»å‹é™å®šç¬¦ä¸çŸ›ç›¾ã€‚\n2. constè¡¨ç¤ºï¼ˆè¿è¡Œæ—¶ï¼‰å¸¸é‡è¯­ä¹‰ï¼šè¢«constä¿®é¥°çš„å¯¹è±¡åœ¨æ‰€åœ¨çš„ä½œç”¨åŸŸæ— æ³•è¿›è¡Œä¿®æ”¹æ“ä½œï¼Œç¼–è¯‘å™¨å¯¹äºè¯•å›¾ç›´æ¥ä¿®æ”¹constå¯¹è±¡çš„è¡¨è¾¾å¼ä¼šäº§ç”Ÿç¼–è¯‘é”™è¯¯ã€‚\n3. volatileè¡¨ç¤ºâ€œæ˜“å˜çš„â€ï¼Œå³åœ¨è¿è¡ŒæœŸå¯¹è±¡å¯èƒ½åœ¨å½“å‰ç¨‹åºä¸Šä¸‹æ–‡çš„æ§åˆ¶æµä»¥å¤–è¢«ä¿®æ”¹ï¼ˆä¾‹å¦‚å¤šçº¿ç¨‹ä¸­è¢«å…¶å®ƒçº¿ç¨‹ä¿®æ”¹ï¼›å¯¹è±¡æ‰€åœ¨çš„å­˜å‚¨å™¨å¯èƒ½è¢«å¤šä¸ªç¡¬ä»¶è®¾å¤‡éšæœºä¿®æ”¹ç­‰æƒ…å†µï¼‰ï¼šè¢«volatileä¿®é¥°çš„å¯¹è±¡ï¼Œç¼–è¯‘å™¨ä¸ä¼šå¯¹è¿™ä¸ªå¯¹è±¡çš„æ“ä½œè¿›è¡Œä¼˜åŒ–ã€‚\n4. ä¸€ä¸ªå¯¹è±¡å¯ä»¥åŒæ—¶è¢«constå’Œvolatileä¿®é¥°ï¼Œè¡¨æ˜è¿™ä¸ªå¯¹è±¡ä½“ç°å¸¸é‡è¯­ä¹‰ï¼Œä½†åŒæ—¶å¯èƒ½è¢«å½“å‰å¯¹è±¡æ‰€åœ¨ç¨‹åºä¸Šä¸‹æ–‡æ„å¤–çš„æƒ…å†µä¿®æ”¹ã€‚\n# mutableå’Œconstçš„å…³ç³»\n- **è§„åˆ™â€‹**â€‹ï¼š`mutable`â€‹**â€‹ä¸èƒ½â€‹**â€‹ç›´æ¥ä¸`const`æˆ–`volatile`ç»„åˆä¿®é¥°å˜é‡ï¼ˆå¦‚`mutable const`éæ³•ï¼‰ã€‚\n- â€‹**â€‹è¯­ä¹‰â€‹**â€‹ï¼š\n    - `mutable`ï¼šä¸“é—¨ç”¨äºç±»çš„æˆå‘˜å˜é‡ï¼Œå…è®¸å…¶åœ¨`const`æˆå‘˜å‡½æ•°ä¸­è¢«ä¿®æ”¹ã€‚\n    - `const`ï¼šåœ¨æˆå‘˜å‡½æ•°ä¸­ç¦æ­¢ä¿®æ”¹å¯¹è±¡çŠ¶æ€ã€‚\n- â€‹**â€‹ç”¨é€”â€‹**â€‹ï¼šçªç ´`const`é™åˆ¶ï¼Œä¿®æ”¹ä¸é€»è¾‘æ— å…³çš„å†…éƒ¨çŠ¶æ€ï¼ˆå¦‚ç¼“å­˜ã€äº’æ–¥é”ï¼‰ã€‚\n\n```cpp\nclass Cache\n{\n    mutable int cached_value; // å…è®¸constå‡½æ•°ä¿®æ”¹\n    int expensive_calculation() const;\npublic:\n    int get_value() const\n    {\n        if (!cache_valid)\n        {\n            cached_value = expensive_calculation(); // mutableçªç ´consté™åˆ¶\n        }\n        return cached_value;\n    }\n};\n```\n\n- â€‹**â€‹å…³é”®é™åˆ¶â€‹**â€‹ï¼š\n    - `mutable`â€‹**â€‹ä»…ç”¨äºç±»çš„éé™æ€æ•°æ®æˆå‘˜â€‹**â€‹ã€‚\n    - ä¸å¯ä¿®é¥°ç±»å¤–çš„å±€éƒ¨å˜é‡ã€å‡½æ•°å‚æ•°æˆ–ç±»ä¸­é™æ€æˆå‘˜ã€‚\n    - ä¸å…è®¸ç»„åˆ`mutable const int x;`âŒï¼ˆè¯­æ³•é”™è¯¯ï¼‰ã€‚\n\n# volatile å’Œ mutableå¯ä»¥ç»„åˆå—ï¼Ÿ\n`C++`æ ‡å‡†äººä¸ºè§„å®šäº†ï¼š`volatile`å’Œ`mutable`â€‹**â€‹ä¸èƒ½ç»„åˆâ€‹**â€‹ï¼ˆå¦‚`mutable volatile`éæ³•ï¼‰ã€‚\nvolatileçš„è¯­ä¹‰ï¼šå‘Šè¯‰ç¼–è¯‘å™¨ï¼Œè¿™ä¸ªå˜é‡å¯èƒ½è¢«å¤–éƒ¨ä¿®æ”¹ï¼Œä¸èƒ½ä¼˜åŒ–è®¿é—®çš„æ–¹å¼\nmutableçš„è¯­ä¹‰ï¼šå‘Šè¯‰ç¼–è¯‘å™¨ï¼Œå³ä½¿å¯¹è±¡æ˜¯constï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹è¿™ä¸ªæˆå‘˜å˜é‡\n\nç»„åˆèµ·æ¥çš„è¯­ä¹‰æ˜¯ï¼šæˆ‘å¸Œæœ›è¿™ä¸ªæˆå‘˜å˜é‡ï¼Œå³ä½¿constå¯¹è±¡ä¹Ÿå¯ä»¥ä¿®æ”¹å…¶æˆå‘˜å˜é‡ï¼Œè€Œä¸”æ¯æ¬¡è®¿é—®éƒ½è¦ä»å†…å­˜ä¸­è¯»å–ï¼Œä¸èƒ½ç¼“å­˜ã€‚\n\nè™½ç„¶è¯­ä¹‰æ˜¯ä¸å†²çªçš„ï¼Œé€»è¾‘æ˜¯é€šé¡ºçš„ï¼Œä½†æ˜¯`C++`æ ‡å‡†æ˜ç¡®ç¦æ­¢äº†è¿™ç§ç»„åˆã€‚\nå¯èƒ½æ˜¯ç¢äºç¼–è¯‘å™¨å®ç°çš„å¤æ‚åº¦ã€å®é™…éœ€æ±‚å¤ªå°‘ã€‚\n\nå¯ä»¥æœ‰æ›¿ä»£æ–¹æ¡ˆï¼šç”¨`const_cast`çªç ´ã€‚\n```cpp\nclass Device\n{\n    volatile int status_register;\npublic:\n    void reset() const \n    {\n        const_cast<volatile int&>(status_register) = 0;\n    }\n};\n```\n# æ€»ç»“\n\n| å…³é”®å­—ç»„åˆ              | æ˜¯å¦å…è®¸ | ç”¨é€”åœºæ™¯                                   | å…³é”®é™åˆ¶                                         |\n| ------------------ | ---- | -------------------------------------- | -------------------------------------------- |\n| `const volatile`   | âœ…    | åªè¯»ä½†å¯èƒ½è¢«å¤–éƒ¨ä¿®æ”¹çš„å˜é‡                          | ç¨‹åºè‡ªèº«ä¸å¯å†™                                      |\n| `mutable`          | âœ…    | ç±»çš„æˆå‘˜ï¼ˆåœ¨constå‡½æ•°ä¸­å¯ä¿®æ”¹ï¼‰                     | ä»…é™ç±»çš„éé™æ€æˆå‘˜                                    |\n| `const mutable`    | âŒ    | æ— ï¼                                     | è¯­ä¹‰å†²çª                                         |\n| `volatile mutable` | âŒ    | constå¯¹è±¡ä¹Ÿå¯ä»¥ä¿®æ”¹å…¶æˆå‘˜å˜é‡ï¼Œè€Œä¸”æ¯æ¬¡è®¿é—®éƒ½è¦ä»å†…å­˜ä¸­è¯»å–ï¼Œä¸èƒ½ç¼“å­˜ã€‚ | è¯­ä¹‰ä¸Šä¸å†²çªï¼Œä½†æ˜¯äººä¸ºè§„å®šç¦æ­¢ã€‚å¯ä»¥ç”¨`const_cast`ä»£æ›¿mutableçš„åŠŸèƒ½ã€‚ |\næ ¸å¿ƒåŒºåˆ«\n- `const volatile`â†’ â€‹**â€‹å…¨å±€æ€§é™åˆ¶â€‹**â€‹ï¼ˆç¡¬ä»¶/å¤šçº¿ç¨‹åªè¯»æ•°æ®ï¼‰\n- `mutable`â†’ â€‹**â€‹å±€éƒ¨æ€§çªç ´â€‹**â€‹ï¼ˆé’ˆå¯¹ç±»çš„constæˆå‘˜å‡½æ•°ï¼Œä¿®æ”¹ç‰¹å®šçŠ¶æ€ï¼‰\n","categories":["C","Cpp"]},{"title":"Linux_è¿›ç¨‹","url":"/Linux/Linux_è¿›ç¨‹/","content":"\n# å†…å®¹\n\n1. è¿›ç¨‹çš„æ¦‚å¿µ\n2. è¿›ç¨‹æ§åˆ¶å—ã€pid\n3. è¿›ç¨‹çŠ¶æ€\n4. è¿›ç¨‹çš„å¹¶å‘ã€å¹¶è¡Œ\n5. ç›¸å…³å‘½ä»¤\n6. è¿›ç¨‹çš„å¤åˆ¶\n7. printfå¼•å‡ºçš„æ€è€ƒ\n8. å­¤å„¿è¿›ç¨‹\n9. åƒµæ­»è¿›ç¨‹\n10. å†™æ—¶æ‹·è´æŠ€æœ¯\n11. è¿›ç¨‹çš„æ›¿æ¢\n\n# è¿›ç¨‹\n\nè¿›ç¨‹ï¼šä¸€ä¸ªæ­£åœ¨æ‰§è¡Œï¼ˆè¿è¡Œï¼‰çš„ç¨‹åºã€‚\n\nç¨‹åºï¼šç”±ä¸€æ¡æ¡çš„æŒ‡ä»¤æ„æˆã€‚\n\n# è¿›ç¨‹æ§åˆ¶å—\n\nè¿›ç¨‹æ§åˆ¶å—ï¼Œå³pcbï¼Œprocess control blockï¼Œå¯¹åº”äºLinuxä¸Šçš„æ•°æ®ç»“æ„æ˜¯`struct task_struct`ã€‚\n\né‡Œé¢åŒ…å«äº†å…³äºè¿›ç¨‹çš„è¯¦ç»†çš„ä¿¡æ¯ï¼Œå¦‚**è¿›ç¨‹æ ‡è¯†ç¬¦(pid)**ã€**è¿›ç¨‹åå­—(name)**ã€**ç”¨æˆ·æ ‡è¯†ç¬¦(uid, ç”¨äºåŒºåˆ†è¿›ç¨‹å±äºå“ªä¸ªç”¨æˆ·)**ã€ç»„æ ‡è¯†ç¬¦(gid)ã€**è¿›ç¨‹é€€å‡ºç (`exit_code`)**ç­‰ç­‰ã€‚ä½†æœ€ä¸ºé‡è¦çš„ï¼Œåªéœ€è¦è®°ä½â€”â€”`pid`ï¼Œå³è¿›ç¨‹æ ‡è¯†ç¬¦ï¼Œå®ƒæ˜¯å”¯ä¸€æ ‡è¯†ä¸€ä¸ªè¿›ç¨‹çš„idå·ã€‚\n\n## ç›¸å…³api\n\n* è·å–pid\n\n```c\n#include<unistd.h>\npid_t getpid(void);\t\t//è·å¾—å½“å‰è¿›ç¨‹pid\npit_t getppid(void);\t//è·å¾—å½“å‰è¿›ç¨‹çˆ¶è¿›ç¨‹çš„pid\n```\n\n\n\n# è¿›ç¨‹çŠ¶æ€\n\nå°±ç»ªã€è¿è¡Œã€é˜»å¡\n![image-20220512212116321](../../images/Linux_è¿›ç¨‹/image-20220512212116321.png)\n\n# å¹¶å‘ä¸å¹¶è¡Œ\n\n![image-20220512212251186](../../images/Linux_è¿›ç¨‹/image-20220512212251186.png)\n\nå¹¶å‘ä¸ä¸€å®šå¯ä»¥å¹¶è¡Œã€‚ä½†å¯ä»¥æ¨¡æ‹Ÿå¹¶è¡Œï¼Œå®é™…ä¸æ˜¯å¹¶è¡Œã€‚\n\nå¹¶è¡Œä¸€å®šå¹¶å‘ã€‚å¹¶è¡Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„å¹¶å‘æƒ…å†µã€‚åªæœ‰åœ¨å¤šå¤„ç†å™¨æˆ–å¤šæ ¸ç¯å¢ƒä¸­æ‰èƒ½å¹¶è¡Œã€‚\n\n# ç›¸å…³å‘½ä»¤\n\n## ps\n\nå¯ä»¥æŸ¥çœ‹ç»ˆç«¯ä¸­å½“å‰è¿è¡Œçš„è¿›ç¨‹\n\n```bash\nps -f #æŸ¥çœ‹æ›´è¯¦ç»†çš„ä¿¡æ¯\nps -e #æ˜¾ç¤ºç³»ç»Ÿæ‰€æœ‰çš„è¿›ç¨‹ï¼ˆä¸åŠ eçš„è¯é»˜è®¤åªæ˜¯è¯¥ç”¨æˆ·çš„è¿›ç¨‹ï¼‰\nps -ef #æ˜¯eå’Œfçš„å¤åˆå‘½ä»¤\n```\n\n## kill\n\nç»“æŸè¿›ç¨‹\n\n```bash\nCtrl + Cåªå¯ä»¥ç»“æŸåœ¨å‰å°çš„è¿›ç¨‹ã€‚\nCtrl + Zåœæ­¢ä¸€ä¸ªå‰å°çš„è¿›ç¨‹\nkill pid #\nkill -9 pid #å¼ºåˆ¶\npkill è¿›ç¨‹å #æŠŠæ‰€æœ‰å«æŸåçš„è¿›ç¨‹éƒ½ç»“æŸ\nps -ef | grep sleep\n```\n\n## &\n\nåå°è¿è¡Œç¬¦\n\n```bash\nsleep 100 &\n\n```\n\n## jobs\n\næ˜¾ç¤ºå½“å‰ç»ˆç«¯çš„ä»»åŠ¡\n\n```bash\n#æŠŠå‰å°è¿è¡Œçš„ç¨‹åºè½¬åˆ°åå°è¿è¡Œ\nsleep 200\n^Z\njobs #æ˜¾ç¤ºå½“å‰ç»ˆç«¯ï¼ˆåå°ï¼‰çš„ä»»åŠ¡\n[1] å·²åœæ­¢\t\tsleep 200\nbg %1 \t\n\t\t#bg %ä»»åŠ¡å· å°†åå°è¿è¡Œæˆ–æŒ‚èµ·çš„è¿›ç¨‹æŒªåˆ°å‰å°æ‰§è¡Œ\n\t\t#fg %ä»»åŠ¡å· å°†æŒ‚èµ·çš„è¿›ç¨‹å”¤é†’åˆ°åå°æ‰§è¡Œ\n```\n\n## bg/fg\n\n`bg %ä»»åŠ¡å·`å°†åå°è¿è¡Œæˆ–æŒ‚èµ·çš„è¿›ç¨‹æŒªåˆ°å‰å°æ‰§è¡Œ\n\n`fg %ä»»åŠ¡å·`å°†æŒ‚èµ·çš„è¿›ç¨‹å”¤é†’åˆ°åå°æ‰§è¡Œ\n\n## top\n\næŸ¥çœ‹ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µä»¥åŠè¿›ç¨‹ä¿¡æ¯ï¼ˆæŒ‰qé€€å‡ºï¼‰\n\n# ç¼–è¯‘é“¾æ¥è¿‡ç¨‹\n\nwinå¯æ‰§è¡Œæ–‡ä»¶çš„æ ‡è¯†æ˜¯PEï¼Œlinuxçš„æ ‡è¯†æ˜¯ELFã€‚\n\n* gccåˆ†æ­¥ç¼–è¯‘é“¾æ¥è¿‡ç¨‹\n\n1. é¢„ç¼–è¯‘ - `gcc -E main.c -o main.i`\n   1. å±•å¼€å¤´æ–‡ä»¶ï¼Œæ‰«æ`/usr/include`ä¸­å¼•ç”¨åˆ°çš„å¤´æ–‡ä»¶\n2. ç¼–è¯‘ - `gcc -S main.i -o main.s`\n   1. æ£€æŸ¥è¯­æ³•é”™è¯¯ï¼Œç”Ÿæˆæ±‡ç¼–ä»£ç ã€‚\n3. æ±‡ç¼– - `gcc -c main.s -o main.o`\n   1. è½¬æ¢ä¸ºäºŒè¿›åˆ¶ä»£ç ï¼ˆELFæ–‡ä»¶æ ¼å¼ï¼‰ã€‚è¿˜ä¸å¯æ‰§è¡Œã€‚åªæ˜¯æŠŠè‡ªå·±å†™çš„ä»£ç ç¿»è¯‘æˆäº†äºŒè¿›åˆ¶ä»£ç ï¼Œè¿˜æœ‰å…¶ä»–çš„mainå‡½æ•°ä¹‹å‰çš„å¼•å…¥çš„åº“å‡½æ•°ï¼Œé™¤äº†è‡ªå·±çš„ä»£ç ï¼Œè¿˜è¦é“¾æ¥åˆ«äººçš„ä»£ç ã€‚\n4. é“¾æ¥\n\n* ä¸€æ­¥ç¼–è¯‘é“¾æ¥ï¼š`gcc -o main main.o`\n\n## å¤šæ–‡ä»¶ç¼–è¯‘\n\n```bash\n#ä¸¤æ­¥ç¼–è¯‘é“¾æ¥\n\n#å…ˆå…¨éƒ¨ç¼–è¯‘ä¸ºæœºå™¨æŒ‡ä»¤--.oæ–‡ä»¶\ngcc -c main.c add.c max.c\n#å†é“¾æ¥æˆä¸€ä¸ªæ–‡ä»¶\ngcc -o main add.o max.o main.o\t#æ–‡ä»¶é¡ºåºå¯ä»¥ä¸ä¸€æ ·\n```\n\n```bash\n#ä¸€æ­¥ç¼–è¯‘é“¾æ¥\ngcc -o main main.c add.c max.c\t\n```\n\næ›´å¤šçš„ç¼–è¯‘é“¾æ¥å†…å®¹è¯·æŸ¥çœ‹â€œLinux_åº“â€ã€‚\n\n# è¿›ç¨‹çš„å¤åˆ¶ - fork\n\n`pid_t fork(void);`\n\nå¯¹äºè¿”å›å€¼`pid_t`ï¼ŒLinuxå†…æ ¸`2.4.0`ç‰ˆæœ¬çš„å®šä¹‰ä¸ºï¼š\n\n```c\ntypedef int\t\t__kernel_pid_t;\ntypedef __kernel_pid_t\t pid_t;\n//\tç›¸å½“äºpid_t å°±æ˜¯ intç±»å‹ã€‚\n```\n\nè°ƒç”¨forkå‡½æ•°ä¼šç”Ÿæˆä¸€ä¸ªè¿›ç¨‹ï¼Œè°ƒç”¨è€…çš„è¿›ç¨‹èº«ä»½æˆä¸ºçˆ¶è¿›ç¨‹ï¼Œç”Ÿæˆçš„æ–°è¿›ç¨‹ä¸ºå­è¿›ç¨‹ã€‚åœ¨çˆ¶è¿›ç¨‹ä¸­forkå‡½æ•°è¿”å›å€¼ï¼šæˆåŠŸåˆ™è¿”å›å­è¿›ç¨‹çš„pidï¼Œå¤±è´¥åˆ™è¿”å›-1ï¼›åœ¨å­è¿›ç¨‹ä¸­forkå‡½æ•°è¿”å›å€¼ä¸º0ã€‚\n\n## ä¸€ä¸ªä»£ç è¯´æ˜è¦ç‚¹\n\n```c\n#include<stdio.h>\t//printf\n#include<unistd.h>\t//sleep\tfork\n#include<assert.h>\t//assert\n#include<stdlib.h>\t//exit\nint main()\n{\n    int n = 0;\n    char * s = NULL;\n    pid_t pid = fork();\n    assert(pid != -1);\n    if(pid == 0)\n    {\n        s = \"child\";\n        n = 3;\n    }\n    else\n    {\n        s = \"parent\";\n        n = 7;\n    }\n    for(int i = 0; i < n; ++i)\n    {\n        printf(\"s = %s\\n\", s);\n        sleep(1);\n    }\n    exit(0);\n}\n```\n\nè¿è¡Œç»“æœ\n\n![image-20220513144726751](../../images/Linux_è¿›ç¨‹/image-20220513144726751.png)\n\nåˆ†æ\n\n![image-20220513151002364](../../images/Linux_è¿›ç¨‹/image-20220513151002364.png)\n\n## è¦ç‚¹\n\n1. forkåå­è¿›ç¨‹å¤åˆ¶çˆ¶è¿›ç¨‹çš„åœ°å€ç©ºé—´ä½œä¸ºå‰¯æœ¬ï¼ŒåŒ…æ‹¬æ•°æ®æ®µã€æ ˆæ®µã€å †æ®µç­‰ç­‰ï¼Œä½†å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹å…±äº«ä»£ç æ®µã€‚ï¼ˆæ²¡æœ‰ä½¿ç”¨å†™æ—¶æ‹·è´æŠ€æœ¯æ—¶ï¼‰\n2. çˆ¶è¿›ç¨‹å¤åˆ¶ç”Ÿæˆå­è¿›ç¨‹åï¼Œ**ç”±äºè¿›ç¨‹ä¼šè®°å½•ç›®å‰ä»£ç è¿è¡Œçš„è¿‡ç¨‹ä¿¡æ¯ï¼Œåˆ™å­è¿›ç¨‹å°±ä¼šä»forkå¤„å¼€å§‹æ‰§è¡Œä»£ç ï¼Œå‰é¢çš„ä»£ç ä¸å†æ‰§è¡Œ**ã€‚çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä»forkå¤„å¼€å§‹åˆ†æ”¯ã€‚\n   * è™½ç„¶å­è¿›ç¨‹å‰é¢çš„ä»£ç ä¸å†æ‰§è¡Œï¼Œä½†æ˜¯ä¸æ„å‘³ç€å‰é¢çš„å˜é‡æ˜¯ä¸ªéšæœºå€¼ã€‚è€Œæ˜¯åˆ©ç”¨äº†çˆ¶è¿›ç¨‹æ‰§è¡Œè¿‡å‰é¢çš„æŒ‡ä»¤ï¼Œå­è¿›ç¨‹å¤åˆ¶è¿‡æ¥å¯ä»¥è¯»å–ã€ä½¿ç”¨ã€‚\n3. forkä¹‹åçˆ¶å­è¿›ç¨‹å„è‡ªç‹¬ç«‹ï¼Œå¹¶å‘è¿è¡Œã€‚æ‰€ä»¥ç¨‹åºè¿è¡Œç»“æœå¯èƒ½å‘ˆç°å‡ºä¸ç¡®å®šæ€§ã€‚å› æ­¤æ‰“å°çš„å…ˆåé¡ºåºæ— æ‰€è°“ï¼Œæ²¡æœ‰æ­£ç¡®ä¸æ­£ç¡®ä¹‹åˆ†ã€‚\n\n## forkå‡½æ•°çš„å˜ä½“\n\nLinux 3.2.0æä¾›äº†å¦ä¸€ç§æ–°è¿›ç¨‹åˆ›å»ºå‡½æ•°`clone(2)`ç³»ç»Ÿè°ƒç”¨ã€‚è¿™æ˜¯ä¸€ç§forkçš„æ¨å¹¿å½¢å¼ï¼Œå®ƒå…è®¸è°ƒç”¨è€…æ§åˆ¶å“ªäº›éƒ¨åˆ†ç”±çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹å…±äº«ã€‚\n\nFreeBSD 8.0æä¾›äº†`rfork(2)`ç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒç±»ä¼¼äºLinuxçš„`clone`ç³»ç»Ÿè°ƒç”¨ã€‚`rfork`è°ƒç”¨æ˜¯ä»Plan 9æ“ä½œç³»ç»Ÿæ´¾ç”Ÿå‡ºæ¥çš„ã€‚\n\nSolaris 10æä¾›äº†ä¸¤ä¸ªçº¿ç¨‹åº“ï¼šä¸€ä¸ªç”¨äºPOSIXçº¿ç¨‹(pthreads)ï¼Œå¦ä¸€ä¸ªç”¨äºSolarisçº¿ç¨‹ã€‚åœ¨è¿™ä¸¤ä¸ªçº¿ç¨‹åº“ä¸­ï¼Œforkçš„è¡Œä¸ºæœ‰æ‰€ä¸åŒã€‚å¯¹äºPOSIXçº¿ç¨‹ï¼Œforkåˆ›å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œå®ƒä»…åŒ…å«è°ƒç”¨è¯¥forkçš„çº¿ç¨‹ï¼›ä½†å¯¹äºSolarisçº¿ç¨‹ï¼Œforkåˆ›å»ºçš„è¿›ç¨‹åŒ…å«äº†è°ƒç”¨çº¿ç¨‹æ‰€åœ¨è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹çš„å‰¯æœ¬ã€‚åœ¨Solaris 10ä¸­ï¼Œè¿™ç§è¡Œä¸ºæ”¹å˜äº†ã€‚ä¸ç®¡ä½¿ç”¨å“ªç§çº¿ç¨‹åº“ï¼Œforkåˆ›å»ºçš„å­è¿›ç¨‹åªä¿ç•™è°ƒç”¨çº¿ç¨‹çš„å‰¯æœ¬ã€‚Solarisä¹Ÿæä¾›äº†`fork1`å‡½æ•°ï¼Œå®ƒåˆ›å»ºçš„è¿›ç¨‹åªå¤åˆ¶è°ƒç”¨çº¿ç¨‹ã€‚è¿˜æœ‰`forkall`å‡½æ•°ï¼Œå®ƒåˆ›å»ºçš„è¿›ç¨‹å¤åˆ¶äº†è¿›ç¨‹ä¸­æ‰€æœ‰çš„çº¿ç¨‹ã€‚\n\n# å†™æ—¶æ‹·è´æŠ€æœ¯\n\næ²¡æœ‰æ”¹å˜é¡µé¢å†…å®¹ï¼Œæš‚æ—¶å…±äº«ã€‚è¦æ”¹å˜é¡µé¢ï¼Œå†å¤åˆ¶ã€‚\n\nç”±äºåœ¨forkä¹‹åç»å¸¸è·Ÿéšç€execï¼Œæ‰€ä»¥ç°åœ¨çš„å¾ˆå¤šå®ç°å¹¶ä¸æ‰§è¡Œä¸€ä¸ªçˆ¶è¿›ç¨‹æ•°æ®æ®µã€æ ˆå’Œå †çš„å®Œå…¨å‰¯æœ¬ã€‚ä½œä¸ºæ›¿ä»£ï¼Œä½¿ç”¨äº†å†™æ—¶å¤åˆ¶(Copy-On-Write, COW)æŠ€æœ¯ã€‚è¿™äº›åŒºåŸŸç”±çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹å…±äº«ï¼Œè€Œä¸”å†…æ ¸å°†å®ƒä»¬çš„è®¿é—®æƒé™æ”¹å˜ä¸ºåªè¯»ã€‚**å¦‚æœçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¸­çš„ä»»ä¸€ä¸ªè¯•å›¾ä¿®æ”¹è¿™äº›åŒºåŸŸï¼Œåˆ™å†…æ ¸åªä¸ºä¿®æ”¹åŒºåŸŸçš„é‚£å—å†…å­˜åˆ¶ä½œä¸€ä¸ªå‰¯æœ¬**ï¼Œé€šå¸¸æ˜¯è™šæ‹Ÿå­˜å‚¨ç³»ç»Ÿä¸­çš„ä¸€â€œé¡µâ€ã€‚\n\n## ç»†èŠ‚\n\nè¿›ç¨‹å¤åˆ¶çš„å…·ä½“è¿‡ç¨‹ï¼š\n\n1. å‘ç³»ç»Ÿç”³è¯·ä¸€ä¸ªpcbè¿›ç¨‹æ§åˆ¶å—ï¼Œç”Ÿæˆæ–°çš„pidã€‚\n2. è‹¥ç”³è¯·æˆåŠŸï¼Œåˆ™å¤åˆ¶çˆ¶è¿›ç¨‹çš„pcbè¿›ç¨‹æ§åˆ¶å—ç»“æ„ä½“ä¿¡æ¯åˆ°å­è¿›ç¨‹çš„pcbä¸­ã€‚\n3. æŠŠè¿›ç¨‹ä½“å†…å­˜ç©ºé—´æµ…æ‹·è´ç»™å­è¿›ç¨‹ã€‚å³æ˜ å°„å„ç§èµ„æºã€‚\n4. å­è¿›ç¨‹è¯•å›¾æ”¹å†™è¿›ç¨‹ä½“ç©ºé—´ä¿¡æ¯æ—¶ï¼Œå†å®é™…æ·±æ‹·è´ä¸€ä»½ç©ºé—´ï¼Œæœ€ç»ˆæ”¹çš„æ˜¯è‡ªå·±çš„ç©ºé—´ã€‚\n\n# printfå¼•å‡ºçš„æ€è€ƒ\n\n## å‰æœŸé“ºå«\n\n```c\n#include<stdio.h>\t//printf\n#include<unistd.h>\t//exit\n#include<stdlib.h>\t//sleep\nint main()\n{\n    printf(\"hello\");\n    sleep(3);\n    exit(0);\n}\n//ç¡çœ 3ç§’åï¼Œé€€å‡ºå‰æ‰æ‰“å°ã€‚\n```\n\n```c\n#include<stdio.h>\n#include<unistd.h>\n#include<stdlib.h>\nint main()\n{\n    printf(\"hello\");\n    sleep(3);\n    _exit(0);\n}\n//ç¡çœ 3ç§’åï¼Œä¸æ‰“å°ï¼Œç›´æ¥é€€å‡ºã€‚\n```\n\n```c\n#include<stdio.h>\n#include<unistd.h>\n#include<stdlib.h>\nint main()\n{\n    printf(\"hello\");\n    fflush(stdout);\n    sleep(3);\n    _exit(0);\n}\n//å…ˆæ‰“å°ï¼Œå†ç¡çœ 3ç§’ï¼Œé€€å‡ºã€‚\n```\n\n> `exit`å’Œ`_exit`çš„åŒºåˆ«ï¼š\n>\n> `_exit`å•¥ä¹Ÿä¸å¹²ï¼Œç›´æ¥é²è½é€€å‡ºç¨‹åºã€‚\n>\n> `exit`ä¼šå…ˆå¸®ä½ åˆ·æ–°ç¼“å†²åŒºï¼Œæ‰é€€å‡ºç¨‹åºï¼Œä»¥é¢é”™è¿‡é—ç•™ä¿¡æ¯ã€‚ç›¸å½“äº`fflush(stdout)`+`_exit(0)`ã€‚`return`å’Œ`exit`ç›¸ä¼¼ã€‚\n\nprintfå‡½æ•°å¹¶ä¸ä¼šç›´æ¥å°†æ•°æ®è¾“å‡ºåˆ°å±å¹•ï¼Œè€Œæ˜¯å…ˆæ”¾åˆ°ç¼“å†²åŒºä¸­ï¼Œå¾…æŸæ—¶æŠŠç¼“å†²åŒºæ•°æ®å†å‘é€ç»™å†…æ ¸ï¼Œå†…æ ¸å¤„ç†åå†™å…¥åˆ°IOè®¾å¤‡ä¸­ã€‚åªæœ‰ä»¥ä¸‹ä¸‰ç§æƒ…å†µæ»¡è¶³ï¼Œæ‰ä¼šè¾“å‡ºåˆ°å±å¹•ã€‚ \n\n1. ç¼“å†²åŒºæ»¡\n2. å¼ºåˆ¶åˆ·æ–°ç¼“å†²åŒºï¼Œå³è°ƒç”¨`fflush(stdout)`ã€‚\n3. è°ƒç”¨`exit(0)`ç¨‹åºç»“æŸæ—¶ï¼Œæ³¨æ„ï¼Œå¿…é¡»æ˜¯`exit(0)`ï¼Œä¸èƒ½ç›´æ¥`_exit(0)`ã€‚\n\n## å¼€å§‹è¯•æ¢\n\n```c\n#include<stdio.h>\n#include<stdlib.h>\n#include<unistd.h>\nint main()\n{\n    for(int i = 0; i<2; ++i)\n    {\n        fork();\n        printf(\"A\\n\");\n    }\n    exit(0);\n}\n```\n\nè¿è¡Œç»“æœ\n\n```\nA\nA\nA\nA\nA\nA\n\n```\n\nåˆ†æ\n![image-20220513171739655](../../images/Linux_è¿›ç¨‹/image-20220513171739655.png)\n\næ¯æ¢è¡Œä¸€æ¬¡å³æ¸…ç©º**è¡Œç¼“å†²åŒº**ï¼Œä¼šç«‹å³è¾“å‡ºï¼Œä¸ä¼šé—ç•™ç»™å­è¿›ç¨‹ã€‚\n\n## å†æ¥ä¸€ä¸ª\n\n```c\n#include<stdio.h>\n#include<stdlib.h>\n#include<unistd.h>\nint main()\n{\n    for(int i = 0; i<2; ++i)\n    {\n        fork();\n        printf(\"A\");\n    }\n    exit(0);\n}\n```\n\nè¿è¡Œç»“æœ\n\n```\nAAAAAAAA\n```\n\nåˆ†æ\n![image-20220513171823048](../../images/Linux_è¿›ç¨‹/image-20220513171823048.png)\n\næ¯æ¬¡çš„`printf`å‡½æ•°ä¸ä¼šç«‹å³è¾“å‡ºï¼Œå†…å®¹æ”¾åˆ°äº†ç¼“å†²åŒºï¼Œè€Œä¸”ä¼šé—ç•™ç»™å­è¿›ç¨‹ã€‚ç›´åˆ°è¿›ç¨‹ç»“æŸæ‰ä¼šè¾“å‡ºã€‚æœ¬è´¨ï¼šä¸¤ä¸ªçˆ¶è¿›ç¨‹åˆ†åˆ«è¾“å‡ºä¸¤ä¸ªAï¼Œä¸¤ä¸ªå­è¿›ç¨‹ä¹Ÿåˆ†åˆ«è¾“å‡ºä¸¤ä¸ªAã€‚\n\n## è¯•è¯•è¿™ä¸ª\n\n```c\n#include<stdio.h>\n#include<stdlib.h>\n#include<unistd.h>\nint main()\n{\n    fork() || fork();\n    printf(\"A\\n\");\n    exit(0);\n}\n```\n\nè¿è¡Œç»“æœ\n\n```\nA\nA\nA\n\n```\n\nåˆ†æ\n\n![image-20220513174543556](../../images/Linux_è¿›ç¨‹/image-20220513174543556.png)\nåšå®Œäº†é¢˜ï¼Œåˆ«æ€¥ç€èµ°ï¼ä½ è¿˜æ²¡æ”¶æ‹¾æ‘Šå­ã€‚\n\n# å­¤å„¿è¿›ç¨‹\n\nå­è¿›ç¨‹æœªç»“æŸï¼Œçˆ¶è¿›ç¨‹å…ˆç»“æŸæ—¶ï¼Œå­è¿›ç¨‹å°±å˜æˆäº†å­¤å„¿è¿›ç¨‹ï¼Œå…¶çˆ¶è¿›ç¨‹ä¼šæ”¹å˜ï¼Œé€šå¸¸å˜ä¸º1ã€‚è¯¦è§\"Linux_exit\"ã€‚\n\n# åƒµæ­»è¿›ç¨‹\n\nå­è¿›ç¨‹å…ˆç»“æŸï¼Œçˆ¶è¿›ç¨‹æ²¡æœ‰è°ƒç”¨waitè·å–å­è¿›ç¨‹çš„é€€å‡ºç ï¼Œé‚£ä¹ˆå­è¿›ç¨‹å°±æˆä¸ºåƒµæ­»è¿›ç¨‹ã€‚waitå‡½æ•°çš„å‚æ•°æ˜¯ç”¨äºæ¥æ”¶é€€å‡ºç çš„æŒ‡é’ˆå˜é‡ã€‚è¯¦è§\"Linux_exit\"ã€‚\n\n# è¿›ç¨‹æ›¿æ¢ - exec\n\nç”¨forkå‡½æ•°åˆ›å»ºæ–°çš„å­è¿›ç¨‹åï¼Œå­è¿›ç¨‹å¾€å¾€è¦è°ƒç”¨ä¸€ç§`exec`å‡½æ•°ä»¥æ‰§è¡Œå¦ä¸ªç¨‹åºã€‚å½“è¿›ç¨‹è°ƒç”¨ä¸€ç§`exec`å‡½æ•°æ—¶ï¼Œè¯¥è¿›ç¨‹æ‰§è¡Œçš„ç¨‹åºå®Œå…¨æ›¿æ¢ä¸ºæ–°ç¨‹åºï¼Œè€Œæ–°ç¨‹åºåˆ™ä»å…¶`main`å‡½æ•°å¼€å§‹æ‰§è¡Œã€‚å› ä¸ºè°ƒç”¨`exec`å¹¶ä¸åˆ›å»ºæ–°è¿›ç¨‹ï¼Œæ‰€ä»¥å‰åçš„è¿›ç¨‹IDå¹¶æœªæ”¹å˜ã€‚**execåªæ˜¯ç”¨ç£ç›˜ä¸Šçš„ä¸€ä¸ªæ–°ç¨‹åºæ›¿æ¢äº†å½“å‰è¿›ç¨‹çš„æ­£æ–‡æ®µã€æ•°æ®æ®µã€å †æ®µå’Œæ ˆæ®µã€‚**\n\nexecå‡½æ•°ä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„å‡½æ•°ï¼Œè€Œæ˜¯ä¸€ç³»åˆ—å‡½æ•°ã€‚æœ‰7ç§ä¸åŒçš„execå‡½æ•°å¯ä¾›ä½¿ç”¨ï¼Œå®ƒä»¬å¸¸å¸¸è¢«ç»Ÿç§°ä¸º`exec`å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™7ä¸ªå‡½æ•°ä¸­çš„ä»»ä¸€ä¸ªã€‚è¿™äº›execå‡½æ•°ä½¿å¾—UNIXç³»ç»Ÿè¿›ç¨‹æ§åˆ¶åŸè¯­æ›´åŠ å®Œå–„ã€‚ç”¨`fork`å¯ä»¥åˆ›å»ºæ–°è¿›ç¨‹ï¼Œç”¨`exec`å¯ä»¥åˆå§‹æ‰§è¡Œæ–°çš„ç¨‹åºã€‚`exit`å‡½æ•°å’Œ`wait`å‡½æ•°å¤„ç†ç»ˆæ­¢å’Œç­‰å¾…ç»ˆæ­¢ã€‚è¿™äº›æ˜¯æˆ‘ä»¬éœ€è¦çš„åŸºæœ¬çš„è¿›ç¨‹æ§åˆ¶åŸè¯­ã€‚å¯ä»¥ä½¿ç”¨è¿™äº›åŸè¯­æ„é€ å¦å¤–ä¸€äº›å¦‚`popen`å’Œ`system`ä¹‹ç±»çš„å‡½æ•°ã€‚\n\n> æ§åˆ¶UNIXè¿›ç¨‹çš„å››å¤§åŸè¯­ï¼š`fork`ã€`exec`ã€`exit`ã€`wait`\n\n## API\n\n```c\n#include<unistd.h>\nint execl(const char *pathname, const char *arg0, .../* (char*)0 */);\nint execv(const char *pathname, char * const argv[]);\nint execle(const char *pathname, const char *arg0, ... /* (char*)0, char * const envp[] */);\nint execve(const char *pathname, char * const argv[], char * const envp[]);\n\nint execlp(const char *filename, const char * arg0, ... /* (char*)0 */);\nint execvp(const char * filename, char * const argv[]);\nint fexecve(int fd, char * const argv[], char * const envp[]);\n//7ä¸ªå‡½æ•°è¿”å›å€¼ï¼šè‹¥å‡ºé”™ï¼Œè¿”å›-1ï¼›è‹¥æˆåŠŸï¼Œä¸è¿”å›ã€‚\n```\n\n## åŒºåˆ«\n\nè¿™äº›å‡½æ•°ä¹‹é—´çš„ç¬¬ä¸€ä¸ªåŒºåˆ«æ˜¯å‰4ä¸ªå‡½æ•°å–**è·¯å¾„å**ä½œä¸ºå‚æ•°ï¼Œå2ä¸ªå‡½æ•°åˆ™å–**æ–‡ä»¶å**ä½œä¸ºå‚æ•°ï¼Œæœ€åä¸€ä¸ªå–**æ–‡ä»¶æè¿°ç¬¦**ä½œä¸ºå‚æ•°ã€‚\n\nå½“æŒ‡å®š`filename`ä½œä¸ºå‚æ•°æ—¶ï¼ˆå³`execlp, execvp`ï¼‰ï¼š\n\n1. å¦‚æœfilenameä¸­åŒ…å«`/`ï¼Œåˆ™å°±å°†å…¶è§†ä¸ºè·¯å¾„åï¼›\n2. å¦åˆ™å°±æŒ‰`PATH`ç¯å¢ƒå˜é‡ï¼Œåœ¨å®ƒæ‰€æŒ‡å®šçš„å„ç›®å½•ä¸­æœå¯»å¯æ‰§è¡Œæ–‡ä»¶ã€‚\n\n> `PATH`å˜é‡åŒ…å«äº†ä¸€å¼ ç›®å½•è¡¨ï¼ˆç§°ä¸ºè·¯å¾„å‰ç¼€ï¼‰ï¼Œç›®å½•ä¹‹é—´ç”¨å†’å·ï¼ˆ`:`ï¼‰åˆ†éš”ã€‚ä¾‹å¦‚ï¼Œä¸‹åˆ—`name=value`ç¯å¢ƒå­—ç¬¦ä¸²æŒ‡å®šåœ¨4ä¸ªç›®å½•ä¸­è¿›è¡Œæœç´¢ã€‚\n>\n> `PATH=/bin:/usr/bin:/usr/local/bin:.`\n>\n> æœ€åçš„è·¯å¾„å‰ç¼€`.`è¡¨ç¤ºå½“å‰ç›®å½•ã€‚ï¼ˆé›¶é•¿å‰ç¼€ä¹Ÿè¡¨ç¤ºå½“å‰ç›®å½•ã€‚åœ¨valueçš„å¼€å§‹å¤„å¯ç”¨`:`è¡¨ç¤ºï¼Œåœ¨è¡Œä¸­é—´åˆ™è¦ç”¨`::`è¡¨ç¤ºï¼Œåœ¨è¡Œå°¾ä»¥`:`è¡¨ç¤ºã€‚ï¼‰\n\n> å‡ºäºå®‰å…¨æ€§æ–¹é¢çš„è€ƒè™‘ï¼Œæœ‰äº›äººè¦æ±‚åœ¨æœç´¢è·¯å¾„ä¸­å†³ä¸è¦åŒ…æ‹¬å½“å‰ç›®å½•ã€‚å‚è§`Garfinkelç­‰[2003]`ã€‚\n\n> å¦‚æœ`execlp`æˆ–`execvp`ä½¿ç”¨è·¯å¾„å‰ç¼€ä¸­çš„ä¸€ä¸ªæ‰¾åˆ°äº†ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä½†æ˜¯è¯¥æ–‡ä»¶ä¸æ˜¯ç”±è¿æ¥ç¼–è¾‘å™¨äº§ç”Ÿçš„æœºå™¨å¯æ‰§è¡Œæ–‡ä»¶ï¼Œåˆ™å°±è®¤ä¸ºè¯¥æ–‡ä»¶æ˜¯ä¸€ä¸ªshellè„šæœ¬ï¼Œäºæ˜¯è¯•ç€è°ƒç”¨`/bin/sh`ï¼Œå¹¶ä»¥è¯¥`filename`ä½œä¸ºshellçš„è¾“å…¥ã€‚\n\n`fexecve`å‡½æ•°é¿å…äº†**å¯»æ‰¾**æ­£ç¡®çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè€Œæ˜¯**ä¾èµ–è°ƒç”¨è¿›ç¨‹(rely on the caller)**æ¥å®Œæˆè¿™é¡¹å·¥ä½œã€‚é€šè¿‡ä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œ**è°ƒç”¨è¿›ç¨‹(the caller)**å¯ä»¥ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦éªŒè¯æ‰€éœ€è¦çš„æ–‡ä»¶å¹¶ä¸”æ— ç«äº‰åœ°æ‰§è¡Œè¯¥æ–‡ä»¶ã€‚å¦åˆ™ï¼Œæ‹¥æœ‰ç‰¹æƒçš„æ¶æ„ç”¨æˆ·å°±å¯ä»¥åœ¨**æ‰¾åˆ°æ–‡ä»¶ä½ç½®å¹¶ä¸”éªŒè¯ä¹‹å**ï¼Œä½†**åœ¨è°ƒç”¨è¿›ç¨‹(the caller)æ‰§è¡Œè¯¥æ–‡ä»¶ä¹‹å‰**ï¼Œ**æ›¿æ¢å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆæˆ–å¯æ‰§è¡Œæ–‡ä»¶çš„éƒ¨åˆ†è·¯å¾„ï¼‰**ï¼Œå…·ä½“å¯å‚è€ƒTOCTTOUé”™è¯¯(time-of-check-to-time-of-use)ã€‚\n\n>TOCTTOUé”™è¯¯çš„åŸºæœ¬æ€æƒ³æ˜¯ï¼š\n>\n>å¦‚æœæœ‰ä¸¤ä¸ªåŸºäºæ–‡ä»¶çš„å‡½æ•°è°ƒç”¨ï¼Œå…¶ä¸­äºŒä¸ªè°ƒç”¨ä¾èµ–äºç¬¬ä¸€ä¸ªè°ƒç”¨çš„ç»“æœï¼Œåˆ™ç¨‹åºæ˜¯è„†å¼±çš„ã€‚å› ä¸ºä¸¤ä¸ªè°ƒç”¨å¹¶ä¸æ˜¯åŸå­æ“ä½œï¼Œåœ¨ä¸¤ä¸ªå‡½æ•°è°ƒç”¨ä¹‹é—´æ–‡ä»¶å¯èƒ½æ”¹å˜äº†ï¼Œè¿™æ ·ä¹Ÿå°±é€ æˆäº†ç¬¬ä¸€ä¸ªè°ƒç”¨çš„ç»“æœå°±ä¸å†æœ‰æ•ˆï¼Œä½¿å¾—ç¨‹åºæœ€ç»ˆçš„ç»“æœæ˜¯é”™è¯¯çš„ã€‚\n>\n>æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­çš„TOCTTOUé”™è¯¯é€šå¸¸å¤„ç†çš„å°±æ˜¯é‚£äº›é¢ è¦†æ–‡ä»¶ç³»ç»Ÿæƒé™çš„å°æŠŠæˆï¼Œè¿™äº›å°æŠŠæˆé€šè¿‡éª—å–ç‰¹æƒç¨‹åºé™ä½ç‰¹æƒæ–‡ä»¶çš„æƒé™æ§åˆ¶æˆ–è€…è®©ç‰¹æƒæ–‡ä»¶æ‰“å¼€ä¸€ä¸ªå®‰å…¨æ¼æ´ç­‰æ–¹å¼è¿›è¡Œã€‚\n>\n>`Weiå’ŒPu[2005]`åœ¨UNIXæ–‡ä»¶ç³»ç»Ÿæ¥å£ä¸­è®¨è®ºäº†`TOCTTOU`çš„ç¼ºé™·ã€‚\n\n---\n\nç¬¬äºŒä¸ªåŒºåˆ«ä¸å‚æ•°è¡¨çš„ä¼ é€’æœ‰å…³(`l`è¡¨ç¤ºåˆ—è¡¨`list`ï¼Œ`v`è¡¨ç¤ºçŸ¢é‡`vector`)ã€‚å‡½æ•°`execl`ã€`execlp`å’Œ`execle`è¦æ±‚å°†æ–°ç¨‹åºçš„æ¯ä¸ªå‘½ä»¤è¡Œå‚æ•°éƒ½è¯´æ˜ä¸ºä¸€ä¸ªå•ç‹¬çš„å‚æ•°ã€‚è¿™ç§å‚æ•°è¡¨ä»¥ç©ºæŒ‡é’ˆç»“å°¾ã€‚å¯¹äºå¦å¤–4ä¸ªå‡½æ•°(`execv`ã€`execvp`ã€`execve`å’Œ`fexecve`)ï¼Œåˆ™åº”å…ˆæ„é€ ä¸€ä¸ªæŒ‡å‘å„å‚æ•°çš„æŒ‡é’ˆæ•°ç»„ï¼Œç„¶åå°†è¯¥æ•°ç»„åœ°å€ä½œä¸ºè¿™4ä¸ªå‡½æ•°çš„å‚æ•°ã€‚\n\nåœ¨ä½¿ç”¨`ISO C`åŸå‹ä¹‹å‰ï¼Œå¯¹`execl`ã€`execle`å’Œ`execlp`ä¸‰ä¸ªå‡½æ•°è¡¨ç¤ºå‘½ä»¤è¡Œå‚æ•°çš„ä¸€èˆ¬æ–¹æ³•æ˜¯ï¼š\n`char *arg0, char *arg1, ..., char *argn, (char *)0`\nè¿™ç§è¯­æ³•æ˜¾å¼åœ°è¯´æ˜äº†æœ€åä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°ä¹‹åè·Ÿäº†ä¸€ä¸ªç©ºæŒ‡é’ˆã€‚å¦‚æœç”¨å¸¸é‡0æ¥è¡¨ç¤ºä¸€ä¸ªç©ºæŒ‡é’ˆï¼Œåˆ™å¿…é¡»å°†å®ƒå¼ºåˆ¶è½¬æ¢ä¸ºä¸€ä¸ªæŒ‡é’ˆï¼›å¦åˆ™å®ƒå°†è¢«è§£é‡Šä¸ºæ•´å‹å‚æ•°ã€‚å¦‚æœä¸€ä¸ªæ•´å‹æ•°çš„é•¿åº¦ä¸`char *`çš„é•¿åº¦ä¸åŒï¼Œé‚£ä¹ˆexecå‡½æ•°çš„å®é™…å‚æ•°å°†å‡ºé”™ã€‚\n\n---\n\næœ€åä¸€ä¸ªåŒºåˆ«ä¸å‘æ–°ç¨‹åºä¼ é€’ç¯å¢ƒè¡¨ç›¸å…³ã€‚ä»¥`e`ç»“å°¾çš„3ä¸ªå‡½æ•°(`execle`ï¼Œ`execve`å’Œ`fexecve`)å¯ä»¥ä¼ é€’ä¸€ä¸ªæŒ‡å‘ç¯å¢ƒå­—ç¬¦ä¸²æŒ‡é’ˆæ•°ç»„çš„æŒ‡é’ˆã€‚å…¶ä»–4ä¸ªå‡½æ•°åˆ™ä½¿ç”¨è°ƒç”¨è¿›ç¨‹ä¸­çš„`environ`å˜é‡ä¸ºæ–°ç¨‹åºå¤åˆ¶ç°æœ‰çš„ç¯å¢ƒ(å¦‚æœç³»ç»Ÿæ”¯æŒ`setenv`å’Œ`putenv`è¿™æ ·çš„å‡½æ•°ï¼Œåˆ™å¯æ›´æ”¹å½“å‰ç¯å¢ƒå’Œåé¢ç”Ÿæˆçš„å­è¿›ç¨‹çš„ç¯å¢ƒï¼Œä½†ä¸èƒ½å½±å“çˆ¶è¿›ç¨‹çš„ç¯å¢ƒ)ã€‚\n\né€šå¸¸ï¼Œä¸€ä¸ªè¿›ç¨‹å…è®¸å°†å…¶ç¯å¢ƒä¼ æ’­ç»™å…¶å­è¿›ç¨‹ï¼Œä½†æœ‰æ—¶ä¹Ÿæœ‰è¿™ç§æƒ…å†µï¼šè¿›ç¨‹æƒ³è¦ä¸ºå­è¿›ç¨‹æŒ‡å®šæŸä¸€ä¸ªç¡®å®šçš„ç¯å¢ƒã€‚ä¾‹å¦‚ï¼Œåœ¨åˆå§‹åŒ–ä¸€ä¸ªæ–°ç™»å½•çš„shellæ—¶ï¼Œloginç¨‹åºé€šå¸¸åˆ›å»ºä¸€ä¸ªåªå®šä¹‰å°‘æ•°å‡ ä¸ªå˜é‡çš„ç‰¹æ®Šç¯å¢ƒï¼Œè€Œåœ¨æˆ‘ä»¬ç™»å½•æ—¶ï¼Œå¯ä»¥é€šè¿‡shellå¯åŠ¨æ–‡ä»¶ï¼Œå°†å…¶ä»–å˜é‡åŠ åˆ°ç¯å¢ƒä¸­ã€‚\n\nåœ¨ä½¿ç”¨`ISO C`åŸå‹ä¹‹å‰ï¼Œ`execle`çš„å‚æ•°æ˜¯ï¼š\n\n`char *pathname, char *arg0, ..., char *argn, (char *)O, char *envp[]`\n\nä»ä¸­å¯è§ï¼Œæœ€åä¸€ä¸ªå‚æ•°æ˜¯æŒ‡å‘ç¯å¢ƒå­—ç¬¦ä¸²çš„å„å­—ç¬¦æŒ‡é’ˆæ„æˆçš„æ•°ç»„çš„æŒ‡é’ˆã€‚è€Œåœ¨`ISO C`åŸå‹ä¸­ï¼Œæ‰€æœ‰å‘½ä»¤è¡Œå‚æ•°ã€ç©ºæŒ‡é’ˆå’ŒenvpæŒ‡é’ˆéƒ½ç”¨çœç•¥å·(`...`)è¡¨ç¤ºã€‚\n\nè¿™7ä¸ªexecå‡½æ•°çš„å‚æ•°å¾ˆéš¾è®°å¿†ã€‚å‡½æ•°åä¸­çš„å­—ç¬¦ä¼šç»™æˆ‘ä»¬ä¸€äº›å¸®åŠ©ã€‚å­—æ¯pè¡¨ç¤ºè¯¥å‡½æ•°å–`filename`ä½œä¸ºå‚æ•°ï¼Œå¹¶ä¸”ç”¨`PATH`ç¯å¢ƒå˜é‡å¯»æ‰¾å¯æ‰§è¡Œæ–‡ä»¶ã€‚å­—æ¯`l`è¡¨ç¤ºè¯¥å‡½æ•°å–ä¸€ä¸ªå‚æ•°è¡¨ï¼Œå®ƒä¸å­—æ¯`v`äº’æ–¥ã€‚`v`è¡¨ç¤ºè¯¥å‡½æ•°å–ä¸€ä¸ª`argv[]`çŸ¢é‡ã€‚æœ€åï¼Œå­—æ¯`e`è¡¨ç¤ºè¯¥å‡½æ•°å–`envp[]`æ•°ç»„ï¼Œè€Œä¸ä½¿ç”¨å½“å‰ç¯å¢ƒã€‚\n\n![image-20220515195300517](../../images/Linux_è¿›ç¨‹/image-20220515195300517.png)\n\nexeclï¼šè·¯å¾„åŠ åç§°ï¼ˆæŒ‡å®šçš„æ˜¯å“ªä¸ªç¨‹åºï¼‰ï¼ŒåŠ å¯å˜å‚ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å½“å‰ç¨‹åºçš„**åå­—**ï¼‰ï¼Œç›´åˆ°ç©ºæŒ‡é’ˆã€‚é»˜è®¤æ˜¯å½“å‰ç¯å¢ƒå˜é‡ã€‚\n\nexeclpï¼šå’Œexeclä¸€æ ·ã€‚pæŒ‡çš„æ˜¯å½“å‰ç¯å¢ƒå‘½ä»¤ã€‚å¯ä»¥ç›´æ¥å†™â€œpsâ€ï¼Œä¸ç”¨å†™ç»å¯¹è·¯å¾„ã€‚\n\nexecleï¼šæ¯”execlçš„NULLåå¤šäº†ä¸€ä¸ªå‚æ•°ï¼Œéœ€è¦ä¼ å…¥è‡ªå®šä¹‰çš„ç¯å¢ƒå˜é‡ã€‚\n\n**execv**ï¼šè·¯å¾„åŠ åç§°ï¼ˆæŒ‡å®šçš„æ˜¯å“ªä¸ªç¨‹åºï¼‰ï¼Œä¸­é—´çš„å¯å˜å‚æ¢ä¸ºäº†ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ã€‚æˆ‘ä»¬ä¼ å…¥çš„æ•°ç»„å¯ä»¥å¤šä½™å¼€è¾Ÿç©ºé—´ï¼Œå¡«å……0ã€‚åˆ™NULLå‚æ•°å¯ä»¥çœç•¥ã€‚**è¾ƒçµæ´»ï¼Œå¸¸ç”¨**ã€‚\n\nexecvpï¼špæŒ‡çš„æ˜¯å½“å‰ç¯å¢ƒä¸‹ï¼Œå³**é»˜è®¤ä½¿ç”¨çš„æ˜¯ç³»ç»Ÿ/usr/binä¸‹çš„ç›¸å…³å‘½ä»¤**ã€‚æ¯”å¦‚å¯ä»¥ç›´æ¥å†™â€œpsâ€ï¼Œä¸ç”¨å†™ç»å¯¹è·¯å¾„ã€‚ä¸­é—´çš„å¯å˜å‚æ¢ä¸ºäº†ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ã€‚æˆ‘ä»¬ä¼ å…¥çš„æ•°ç»„å¯ä»¥å¤šä½™å¼€è¾Ÿç©ºé—´ï¼Œå¡«å……0ã€‚åˆ™NULLå‚æ•°å¯ä»¥çœç•¥ã€‚**è¾ƒçµæ´»ï¼Œå¸¸ç”¨**ã€‚\n\nåœ¨å¾ˆå¤šUNIXå®ç°ä¸­ï¼Œè¿™7ä¸ªå‡½æ•°ä¸­åªæœ‰`execve`æ˜¯å†…æ ¸çš„ç³»ç»Ÿè°ƒç”¨ã€‚å¦å¤–6ä¸ªåªæ˜¯åº“å‡½æ•°å®ƒä»¬æœ€ç»ˆéƒ½è¦è°ƒç”¨è¯¥ç³»ç»Ÿè°ƒç”¨ã€‚è¿™7ä¸ªå‡½æ•°ä¹‹é—´çš„å…³ç³»å¦‚å›¾ã€‚\n\n![image-20220515202315518](../../images/Linux_è¿›ç¨‹/image-20220515202315518.png)\n\nåœ¨è¿™ç§å®‰æ’ä¸­ï¼Œåº“å‡½æ•°`execlp`å’Œ`execvp`ä½¿ç”¨`PATH`ç¯å¢ƒå˜é‡ï¼ŒæŸ¥æ‰¾ç¬¬ä¸€ä¸ªåŒ…å«åä¸º`filename`çš„å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„åå‰ç¼€ã€‚`fexecve`åº“å‡½æ•°ä½¿ç”¨`/proc`æŠŠæ–‡ä»¶æè¿°ç¬¦å‚æ•°è½¬æ¢æˆè·¯å¾„åï¼Œ`execve`ç”¨è¯¥è·¯å¾„åå»æ‰§è¡Œç¨‹åºã€‚\n\nè¿™æè¿°äº†åœ¨`FreeBSD 8.0`å’Œ`Linux 3.2.0`ä¸­æ˜¯å¦‚ä½•å®ç°`fexecve`çš„ã€‚å…¶ä»–ç³»ç»Ÿé‡‡ç”¨çš„æ–¹æ³•å¯èƒ½ä¸åŒã€‚ä¾‹å¦‚ï¼Œæ²¡æœ‰`/proc`å’Œ`/dev/fd`çš„ç³»ç»Ÿå¯èƒ½æŠŠ`fexecve`å®ç°ä¸ºç³»ç»Ÿè°ƒç”¨ï¼ŒæŠŠæ–‡ä»¶æè¿°ç¬¦å‚æ•°è½¬æ¢æˆ`ièŠ‚ç‚¹æŒ‡é’ˆ`ï¼ŒæŠŠ`execve`å®ç°ä¸ºç³»ç»Ÿè°ƒç”¨ï¼ŒæŠŠè·¯å¾„åå‚æ•°è½¬æ¢æˆ`ièŠ‚ç‚¹æŒ‡é’ˆ`ï¼Œç„¶åæŠŠ`execve`å’Œ`fexecve`ä¸­å‰©ä½™çš„`exec`å…¬å…±ä»£ç æ”¾åˆ°å•ç‹¬çš„å‡½æ•°ä¸­ï¼Œè°ƒç”¨è¯¥å‡½æ•°æ—¶ä¼ å…¥æ‰§è¡Œæ–‡ä»¶çš„`ièŠ‚ç‚¹æŒ‡é’ˆ`ã€‚\n\n## å±æ€§è¿­ä»£\n\nåœ¨æ‰§è¡Œexecåï¼Œè¿›ç¨‹IDæ²¡æœ‰æ”¹å˜ã€‚ä¸”æ–°ç¨‹åºä»è°ƒç”¨è¿›ç¨‹ç»§æ‰¿äº†ä¸‹åˆ—å±æ€§ï¼š\n\n| ç»§æ‰¿çš„å±æ€§                                               |\n| -------------------------------------------------------- |\n| è¿›ç¨‹IDå’Œçˆ¶è¿›ç¨‹ID                                         |\n| å®é™…ç”¨æˆ·IDå’Œå®é™…ç»„ID                                     |\n| é™„å±ç»„ID                                                 |\n| è¿›ç¨‹ç»„ID                                                 |\n| ä¼šè¯ID                                                   |\n| æ§åˆ¶ç»ˆç«¯                                                 |\n| é—¹é’Ÿå°šä½™ç•™çš„æ—¶é—´                                         |\n| å½“å‰å·¥ä½œç›®å½•                                             |\n| æ ¹ç›®å½•                                                   |\n| æ–‡ä»¶æ¨¡å¼åˆ›å»ºå±è”½å­—                                       |\n| æ–‡ä»¶é”                                                   |\n| è¿›ç¨‹ä¿¡å·å±è”½                                             |\n| æœªå¤„ç†ä¿¡å·                                               |\n| èµ„æºé™åˆ¶                                                 |\n| niceå€¼ï¼ˆéµå¾ªXSIçš„ç³»ç»Ÿï¼‰                                  |\n| `tms_utime`ã€`tms_stime`ã€`tms_cutime`ä»¥åŠ`tms_cstime`å€¼ |\n\n> å¯¹æ‰“å¼€æ–‡ä»¶çš„å¤„ç†ä¸æ¯ä¸ªæè¿°ç¬¦çš„**æ‰§è¡Œæ—¶å…³é—­(close-on-exec)æ ‡å¿—å€¼**æœ‰å…³ã€‚è¿™ä¸ªä¸`FD_CLOEXEC`æ ‡å¿—æœ‰å…³ï¼Œè¿›ç¨‹ä¸­æ¯ä¸ªæ‰“å¼€æè¿°ç¬¦éƒ½æœ‰ä¸€ä¸ªæ‰§è¡Œæ—¶å…³é—­æ ‡å¿—ã€‚è‹¥è®¾ç½®äº†æ­¤æ ‡å¿—ï¼Œåˆ™åœ¨æ‰§è¡Œexecæ—¶å…³é—­è¯¥æè¿°ç¬¦ï¼›å¦åˆ™è¯¥æè¿°ç¬¦ä»æ‰“å¼€ã€‚æ‰€ä»¥ï¼Œé™¤éç‰¹åœ°ç”¨`fcntl`è®¾ç½®äº†è¯¥æ‰§è¡Œæ—¶å…³é—­æ ‡å¿—ï¼Œå¦åˆ™ç³»ç»Ÿçš„é»˜è®¤æ“ä½œæ˜¯åœ¨execåä»ä¿æŒè¿™ç§æè¿°ç¬¦æ‰“å¼€ã€‚\n>\n> `POSIX.1`æ˜ç¡®è¦æ±‚åœ¨`exec`æ—¶å…³é—­**æ‰“å¼€ç›®å½•æµ(open directory streams)**ã€‚è¿™é€šå¸¸æ˜¯ç”±opendirå‡½æ•°å®ç°çš„ï¼Œå®ƒè°ƒç”¨`fcntl`å‡½æ•°ä¸ºå¯¹åº”äºæ‰“å¼€ç›®å½•æµçš„æè¿°ç¬¦è®¾ç½®æ‰§è¡Œæ—¶å…³é—­æ ‡å¿—ã€‚\n\næ³¨æ„ï¼Œåœ¨execå‰åå®é™…ç”¨æˆ·IDå’Œå®é™…ç»„IDä¿æŒä¸å˜ï¼Œè€Œæœ‰æ•ˆIDæ˜¯å¦æ”¹å˜åˆ™å–å†³äºæ‰€æ‰§è¡Œç¨‹åºæ–‡ä»¶çš„è®¾ç½®ç”¨æˆ·IDä½å’Œè®¾ç½®ç»„IDä½æ˜¯å¦è®¾ç½®ã€‚**å¦‚æœæ–°ç¨‹åºçš„è®¾ç½®ç”¨æˆ·IDä½å·²è®¾ç½®ï¼Œåˆ™æœ‰æ•ˆç”¨æˆ·IDå˜æˆç¨‹åºæ–‡ä»¶æ‰€æœ‰è€…çš„IDï¼›å¦åˆ™æœ‰æ•ˆç”¨æˆ·IDä¸å˜**ã€‚å¯¹ç»„IDçš„å¤„ç†æ–¹å¼ä¸æ­¤ç›¸åŒã€‚\n","categories":["æ“ä½œç³»ç»Ÿ","å¤šçº¿ç¨‹","Linux"]},{"title":"åŸºç¡€æ•°æ®ç»“æ„_é“¾è¡¨","url":"/åŸºç¡€æ•°æ®ç»“æ„/åŸºç¡€æ•°æ®ç»“æ„_é“¾è¡¨/","content":"# å†…å®¹\n\n1. å•é“¾è¡¨çš„æ“ä½œ\n2. å•é“¾è¡¨çš„ç»å…¸é¢˜ç›®\n\n# å•é“¾è¡¨ç»å…¸é¢˜ç›®\n\n## Remove\n\n![image-20220321090309971](../../images/åŸºç¡€æ•°æ®ç»“æ„_é“¾è¡¨/image-20220321090309971.png)\n\n* åˆ é™¤å•ä¸ªå…ƒç´ --æŒ‰å€¼\n\næ¯”å¦‚åˆ é™¤34ã€‚\n\nç¬¬1ç§åšæ³•ï¼ŒåŒæŒ‡é’ˆ\n\n```c\nvoid Remove(LinkList head, ElemType val)\n{\n    assert(head != NULL);\n    ListNode* back = head;\n    ListNode* front = head->next; \n    while(front != NULL && front->data != val)\n    {\n        back = front;\n        front = front->next;\n    }\n    if(front == NULL)return;\n    back->next = front->next;\n    free(front);\n    front = NULL;\n    return;\n}\n```\n\nç¬¬2ç§åšæ³•ï¼Œç»“åˆAPIã€‚æŒ‰å€¼æ‰¾åˆ°è¯¥å€¼èŠ‚ç‚¹çš„å‰é©±(è°ƒç”¨FindValue_Prev)ï¼Œç„¶åè°ƒç”¨åˆ é™¤Erase_Nextã€‚\n\n```c\nbool Erase_Next(LinkList head, ListNode *ptr);\nbool Remove(LinkList head, ElemType val)\n{\n    assert(head != NULL);\n    return Erase_Next(head, FindValue_Prev(head, val));\n}\n```\n\n* åˆ é™¤æ‰€æœ‰valå€¼èŠ‚ç‚¹\n\n![image-20220321095517379](../../images/åŸºç¡€æ•°æ®ç»“æ„_é“¾è¡¨/image-20220321095517379.png)\n\nç¬¬1ç§åšæ³•ï¼Œæ¯æ¬¡ä»å¤´å¼€å§‹æ‰¾valï¼Œé‡å¤è‹¥å¹²æ¬¡ï¼Œç›´åˆ°æ‰¾ä¸åˆ°ä¸ºæ­¢ã€‚æ—¶é—´å¤æ‚åº¦ä¸º$O(n^2)$\n\n```c\nbool Erase_Next(LinkList head, ListNode *ptr);\nListNode * FindValue_Prev(LinkList head, ElemType val);\nvoid Remove_All(LinkList head, ElemType val)\n{\n    assert(head != NULL);\n    ListNode * p = NULL;\n    while((p = FindValue_Prev(head, val)) != NULL)\n    {\n        Erase_Next(head, p);\n    }\n}\n```\n\nç¬¬2ç§åšæ³•ï¼Œæ€æƒ³ï¼šbackæŒ‡é’ˆåœ¨åé¢å®ˆæŠ¤ï¼Œfrontåœ¨å‰é¢æ¢æµ‹ï¼š**fronté‡åˆ°évalå€¼æ—¶backå‰ç§»ï¼Œç„¶åäº¤æ¢æ­¤æ—¶backå’Œfrontçš„æ•°æ®åŸŸ**ã€‚æ¯è½®frontéƒ½å‰ç§»ä¸€æ¬¡ï¼Œç›´åˆ°éå†å®Œæ¯•ã€‚\n\n![image-20220321103213898](../../images/åŸºç¡€æ•°æ®ç»“æ„_é“¾è¡¨/image-20220321103213898.png)\n\n![image-20220321103233830](../../images/åŸºç¡€æ•°æ®ç»“æ„_é“¾è¡¨/image-20220321103233830.png)\n\n![image-20220321103315038](../../images/åŸºç¡€æ•°æ®ç»“æ„_é“¾è¡¨/image-20220321103315038.png)\n\n![image-20220321103356110](../../images/åŸºç¡€æ•°æ®ç»“æ„_é“¾è¡¨/image-20220321103356110.png)\n\n```c\nvoid Remove_All(LinkList head, ElemType val)\n{\n    assert(head != NULL);\n    ListNode * back = head;\n    ListNode * front = head->next;\n    while(front != NULL)\n    {\n        if(front->data != val)\n        {\n            back = back->next;\n            Swap(&back->data, &front->data);\n        }\n        front = front->next;\n    }\n    // æ­¤æ—¶ï¼Œæ‰€æœ‰valèŠ‚ç‚¹éƒ½é›†ä¸­åœ¨backæŒ‡å‘çš„èŠ‚ç‚¹ä¹‹åï¼Œwhileç›´åˆ°åˆ å®Œ\n    while(back->next != NULL)\n    {\n        Erase_Next(head, pre);\n    }\n}\n```\n\n## Reverse\n\n### ä¸‰æŒ‡é’ˆ\n\næ—¶é—´å¤æ‚åº¦$O(n)$ï¼Œç©ºé—´å¤æ‚åº¦$O(1)$\n\n```c\nvoid ReverseList(LinkList head)\n{\n    assert(head != NULL);\n    ListNode *back = NULL;\n    ListNode *temp = NULL;\n    ListNode *front = head->next;\n    while(front != NULL)\n    {\n        temp = front;\n        front = front->next;\n        temp->next = back;\n        back = temp;\n    }\n    head->next = back;\n}\n```\n\n\n\n### äºŒæŒ‡é’ˆï¼ˆå¤´æ’ï¼‰\n\n![image-20220321110049606](../../images/åŸºç¡€æ•°æ®ç»“æ„_é“¾è¡¨/image-20220321110049606.png)\n\næ—¶é—´å¤æ‚åº¦$O(n)$ï¼Œç©ºé—´å¤æ‚åº¦$O(1)$\n\n```c\nvoid ReverseList(LinkList head)\n{\n    ListNode *front = head->next;\n    ListNode *temp = NULL;\n    head->next = NULL;\t// ready to push_front\n    while(front != NULL)\n    {\n        // front will move, avoid front->next change, temp log. \n        temp = front;\n        front = front->next;\n        // the next 2 steps : push front\n        temp->next = head->next;\n        head->next = temp;\n    }\n}\n```\n\nå¤´æ’æ³•é€†ç½®è¿˜æœ‰ä¸€ç§å•æŒ‡é’ˆçš„åšæ³•ï¼Œéå†æŠŠæ¯ä¸ªèŠ‚ç‚¹çš„å€¼å–å‡ºï¼Œè°ƒç”¨Push_FrontæŒ‰å€¼è´­ä¹°èŠ‚ç‚¹å¤´æ’ã€‚è¿™ç§åšæ³•çš„ç©ºé—´å¤æ‚åº¦æ˜¯$O(n)$ï¼ŒåŒæ—¶è¿˜ä¼šæ¶‰åŠåˆ°å†…å­˜æ³„æ¼çš„é—®é¢˜ï¼Œå› ä¸ºæ—§æœ‰éå†è¿‡çš„èŠ‚ç‚¹æ²¡æœ‰é‡Šæ”¾ã€‚å¦‚æœè¦åœ¨ä»£ç ä¸­ä¸»åŠ¨é‡Šæ”¾ï¼Œåˆ™åˆéœ€è¦åŠ ä¸ªtempæŒ‡é’ˆæ¥è®°å½•äº†ã€‚ä¸€è¾¹ç”³è¯·ï¼Œä¸€è¾¹é‡Šæ”¾ï¼Œè¿™ç§åšæ³•æ˜¯åŠå…¶è€—è´¹èµ„æºçš„ï¼Œä¸æ¨èã€‚\n\n```c\nvoid ReverseList(LinkList head)\n{\n    ListNode *front = head->next;\n    head->next = NULL;\n    while(front != NULL)\n    {\n        ElemType val = front->val;\n        Push_Front(head, val);\n        \n    /*  ListNode *temp = front;\t*/\n        front = front->next;\n    /*\tfree(temp);\t\t\t\t*/\n    }\n}\n```\n\n\n\n### æ ˆ\n\næ ˆçš„ç‰¹æ€§ï¼šåè¿›å…ˆå‡º\n\nç”¨ä¸€ä¸ªè¿ç»­ç©ºé—´å’Œpush_back/pop_back/get_backæ¨¡æ‹Ÿä¸€ä¸ªæ ˆã€‚\n\næ—¶é—´å¤æ‚åº¦$O(n)$ï¼Œç©ºé—´å¤æ‚åº¦$O(n)$\n\n```c\nvoid ReverseList(LinkList head)\n{\n    assert(head != NULL);\n    int len = 0;\n    ListNode *front = head->next;\n    while(p != NULL)\n    {\n        ++len;\n        front = front->next;\n    }\n    ElemType *stack = (ElemType*)malloc(sizeof(ElemType)*len);\n    int top = -1;\n    front = head->next;\n    while(p != NULL)\n    {\n        top += 1;\n        stack[top] = p->data;\n        front = front->next;\n    }\n    front = head->next;\n    while(front != NULL)\n    {\n        p->data = stack[top];\n        top -= 1;\n        front = front->next;\n    }\n    free(stack);\n    stack = NULL;\n}\n```\n\n\n\n### é€’å½’\n\nåˆ†ææœ€å°çš„é€’å½’å•å…ƒï¼šä¸¤ä¸ªèŠ‚ç‚¹çš„é€†ç½®ã€‚\n\n![image-20220321133942696](../../images/åŸºç¡€æ•°æ®ç»“æ„_é“¾è¡¨/image-20220321133942696.png)\n\nä¸¤ä¸ªèŠ‚ç‚¹çš„é€†ç½®åŠ¨ä½œï¼š**é¦–å…ˆfirstæŒ‡é’ˆæŒ‡å‘23**ï¼Œç„¶ååˆ†æï¼šè¦é€†ç½®23å’Œ34ï¼Œéœ€è¦å…ˆæŠŠ23ä¹‹åçš„é€†ç½®ï¼Œè€Œ34åªæ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸åšåŠ¨ä½œç›´æ¥returnè‡ªèº«ï¼Œ**åˆ™lastæŒ‡é’ˆæŒ‡å‘34**ã€‚ç„¶åfirst->next->nextæŒ‡å‘firstï¼Œå³34æŒ‡å‘è‡ªå·±ï¼Œå…ˆç”»ä¸€ä¸ªç¯ï¼›ç„¶åfirst->next = NULLï¼Œ23ä¸34åˆ‡æ–­è¿æ¥ã€‚å¦‚æ­¤å³å®Œæˆä¸¤ä¸ªèŠ‚ç‚¹çš„é€†ç½®ã€‚ä»¥æ­¤ç±»æ¨å³æ˜¯é“¾è¡¨é€†ç½®çš„é€’å½’è¿‡ç¨‹ã€‚\n\næ—¶é—´å¤æ‚åº¦$O(n)$ï¼Œç©ºé—´å¤æ‚åº¦$O(n)$\n\n```c\nListNode * Reverse(ListNode *first)\t//æ­¤å‡½æ•°ä¹Ÿå¯ä»¥å¤„ç†ä¸å¸¦å¤´èŠ‚ç‚¹çš„å•é“¾è¡¨é€†ç½®\n{\n    if(pnode==NULL || pnode->next==NULL)return first;\n    ListNode * last = Reverse(first->next);\n    first->next->next = first;\n    first->next = NULL;\n    return last;\n}\nvoid ReverseList(LinkList head)\n{\n    assert(head != NULL);\n    ListNode *front = head->next;\n    head->next = Reverse(front);\n}\n```\n\nä¸¾ä¾‹ï¼š\n\n![image-20220321142459489](../../images/åŸºç¡€æ•°æ®ç»“æ„_é“¾è¡¨/image-20220321142459489.png)\n\n![image-20220321142555889](../../images/åŸºç¡€æ•°æ®ç»“æ„_é“¾è¡¨/image-20220321142555889.png)\n\n![image-20220321142645452](../../images/åŸºç¡€æ•°æ®ç»“æ„_é“¾è¡¨/image-20220321142645452.png)\n\n![image-20220321142707390](../../images/åŸºç¡€æ•°æ®ç»“æ„_é“¾è¡¨/image-20220321142707390.png)\n\n### ä¸å¸¦å¤´ç»“ç‚¹å•é“¾è¡¨çš„éé€’å½’é€†ç½®--ä¸‰æŒ‡é’ˆæ³•\n\n```c\nListNode * NiceReverseList(LinkList head)\n{\n    if(head == NULL || head->next == NULL)return head;\n    ListNode *front = head;\n    ListNode *back = NULL;\n    ListNode *temp = NULL;\n    while(front != NULL)\n    {\n        temp = front;\n        front = front->next;\n        temp->next = back;\n        back = temp;\n    }\n    return back;\n}\n```\n\n## å€’æ•°ç¬¬k\n\næ‰“å°ä¸å¸¦å¤´èŠ‚ç‚¹çš„å•é“¾è¡¨ä¸­å€’æ•°ç¬¬kä¸ªèŠ‚ç‚¹çš„æ•°æ®ã€‚\n\n![image-20220321144102473](../../images/åŸºç¡€æ•°æ®ç»“æ„_é“¾è¡¨/image-20220321144102473.png)\n\n### lenå‡kæ³•\n\næ‰“å°ç¬¬n-k+1ä¸ªèŠ‚ç‚¹ã€‚\n\næ¯”å¦‚ï¼Œæˆ‘ä»¬æœ‰5ä¸ªèŠ‚ç‚¹ï¼Œè¦æ±‚æ‰“å°å€’æ•°ç¬¬2ä¸ªèŠ‚ç‚¹ã€‚åˆ™ç­‰æ•ˆäºæ‰“å°æ­£æ•°ç¬¬5-2+1ä¸ªèŠ‚ç‚¹ã€‚\n\n```c\nvoid PrintKth_List(LinkList head, int k)\n{\n    if(head == NULL || k < 1)return;\n    int count = 0;\n    ListNode *front = head;\n    while(front != NULL)\n    {\n        ++count;\n        front = front->next;\n    }\n    if(k > n)return;\n    \n    front = head;\n    while(count-- > k)\n    {\n        front = front->next;\n    }\n    printf(\"%dth data of LinkList : %d. \\n\", front->data);\n    return;\n}\n```\n\n### é€’å½’\n\næ—¶é—´å¤æ‚åº¦$O(n)$ï¼Œç©ºé—´å¤æ‚åº¦$O(n)$\n\n```c\nint PrintKth(ListNode * head, int k)\n{\n    if(head == NULL)return 0;\n    int count = PrintKth(head->next, k) + 1;\n    if(count == k)\n    {\n        printf(\"%dth data of LinkList : %d. \\n\", front->data);\n    }\n    return count;\n}\nvoid PrintKth_List(LinkList head, int k)\n{\n    if(head == NULL || k < 1)return;\n    PrintKth(head, k);\n}\n```\n\n### æ ˆ\n\n### åŒæŒ‡é’ˆ\n\nå³å¿«æ…¢æŒ‡é’ˆæ³•ï¼Œä½¿å¿«æ…¢æŒ‡é’ˆç›¸å·®kè·ç¦»ï¼ŒåŒæ—¶æ­¥è¿›ï¼Œå½“å¿«æŒ‡é’ˆç©ºæ—¶ï¼Œåˆ™æ…¢æŒ‡é’ˆæŒ‡å‘å€’æ•°ç¬¬kå€¼ã€‚\n\n```c\nvoid PrintKth_List(LinkList head, int k)\n{\n    if(head == NULL || k < 1)return;\n    ListNode *front = head;\n    ListNode *back = head;\n    int count = k;\n    while(front!=NULL && count>0)\t//front==NULL æˆ– k==0é€€å‡ºï¼Œfront==NULLé€€å‡ºæ˜¯å› ä¸ºk>=nï¼›front!=NULL&&k==0é€€å‡º åˆ™k<nï¼Œæ­£å¸¸ã€‚\n    {\n        front = front->next;\n        --count;\n    }\n    if(count != 0)\n    {\n        if(front == NULL)return;//kè¶…å‡ºèŠ‚ç‚¹æ•°é‡èŒƒå›´\n        while(front != NULL)\n        {\n            front = front->next;\n            back = back->next;\n        }\n    }\n    printf(\"%dth data of LinkList : %d. \\n\", back->data);\n    return;\n}\n```\n\n## è¿”å›ä¸­é—´èŠ‚ç‚¹\n\nå¿«æ…¢æŒ‡é’ˆæ³•ï¼Œå¿«æŒ‡é’ˆä¸€æ¬¡èµ°ä¸¤ä¸ªï¼Œæ…¢æŒ‡é’ˆä¸€æ¬¡èµ°ä¸€ä¸ªã€‚\n\n```c\nListNode * GetMidNode(LinkList head)\n{\n    if(head==NULL || head->next==NULL)return head;\n    ListNode * front = head;\n    ListNode * back = head;\n    while(front->next!=NULL && front->next->next!=NULL)\n    {\n        front = front->next->next;\n        back = back->next;\n    }\n    return back;\n}\n```\n\n## ç¯è·¯\n\n### æ•°ç»„ä¸­çš„é‡å¤æ•°å­—\n\n\n\n# åˆ·é¢˜\n\n![image-20210921182935780](../../images/%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84_%E9%93%BE%E8%A1%A8/image-20210921182935780.png)\n\n```c\nvoid deleteNode(struct ListNode* node) \n{\n    struct ListNode *p = node->next;\n    *node=*p;\n    free(p);\n}\n```\n\nå¦‚æœè€ƒè™‘æœ€åèŠ‚ç‚¹ï¼Œå°±æ²¡åŠæ³•ç”¨è¿™ç§æ–¹æ³•äº†ï¼Œå› ä¸ºæœ€å¤šåªèƒ½ç»™æœ€åçš„èŠ‚ç‚¹çš„ä¿¡æ¯å…¨èµ‹é›¶å€¼ï¼Œå¹¶ä¸”å‰ç»§èŠ‚ç‚¹çš„nextæŒ‡å‘çš„åœ°å€æ˜¯æ— æ³•æ”¹å˜çš„ã€‚\n\n\n\n","categories":["åŸºç¡€æ•°æ®ç»“æ„"]},{"title":"å­˜ç–‘è®°å½•","url":"/è¯¾å ‚ç¬”è®°/å­˜ç–‘è®°å½•/","content":"\n# åˆ·é¢˜ç¢°åˆ°çš„\n\n## è§£å†³å“ˆå¸Œå†²çª-å…¬å…±æº¢å‡ºåŒºæ³•\n\n![image-20210921020227197](../../images/%E5%AD%98%E7%96%91%E8%AE%B0%E5%BD%95/image-20210921020227197.png)\n\n![image-20210921020240377](../../images/%E5%AD%98%E7%96%91%E8%AE%B0%E5%BD%95/image-20210921020240377.png)\n\nhttps://blog.csdn.net/ycwasdfasdf/article/details/52232502\n\n![image-20210921020448550](../../images/%E5%AD%98%E7%96%91%E8%AE%B0%E5%BD%95/image-20210921020448550.png)\n\n```c++\n//https://blog.csdn.net/HLW0522/article/details/52086598\n#include<iostream>\nusing namespace std;\n#define HASHSIZE 10\n#define NULLKEY -32768\ntypedef struct hash\n{\n\tint *element;\n\tint *extraElement;//æº¢å‡ºåŒºè¡¨\n\tint count; // æº¢å‡ºåŒºçš„å…ƒç´ ä¸ªæ•°\n}HashTable;\n// ç”±äº é€šè¿‡å“ˆå¸Œå‡½æ•° è®¡ç®—åçš„åœ°å€é‡å¤å‡ ç‡å¾ˆå°ï¼Œæ‰€ä»¥æŠŠé‡å¤éƒ¨åˆ†ç”¨é¡ºåºè¡¨æ¥å­˜æ”¾ï¼ŒæŸ¥æ‰¾æ—¶éå†è¿™ä¸ªå…¬å…±æº¢å‡ºåŒºçš„é¡ºåºè¡¨ï¼Œæ•ˆç‡ä¼šæ›´é«˜ã€‚\nvoid Init(HashTable *p)\n{\n\tp->element = (int*)malloc(sizeof(int)*HASHSIZE);\n\tp->extraElement = (int*)malloc(sizeof(int)*HASHSIZE);\n\tfor (int i = 0; i < HASHSIZE; ++i)\n\t{\n\t\tp->element[i] = NULLKEY;\n\t\tp->extraElement[i] = NULLKEY; \n\t}\n\tp->count = 0; \n}\n// é™¤ç•™ä½™æ•°æ³•\nint HASH(int key)\n{\n\treturn key%HASHSIZE;\n}\n//æ’å…¥å…ƒç´ \nvoid InsertHash(HashTable *p, int key)\n{\n\tint addr = HASH(key);\n\t//å¤„ç†å†²çª, ä½¿ç”¨å…¬å…±æº¢å‡ºæ³•\n\tif (p->element[addr] == NULLKEY)\n\t\tp->element[addr] = key;\n\telse //å¦‚æœå…ƒç´ å†…å·²ç»æœ‰å€¼äº†ï¼Œå°±æ”¾åˆ°æº¢å‡ºéƒ¨åˆ†çš„è¡¨ä¸­ï¼Œä¸”æŠŠcountåŠ  1\n\t\tp->extraElement[p->count++] = key;\n}\nint Search(HashTable *p, int key)\n{\n\tint addr = HASH(key);\n\tif (key == p->element[addr])\n\t\treturn addr;\n\telse\n\t{\n\t\tfor (int i = 0; i < p->count; ++i)\n\t\t\tif (p->extraElement[i] == key)\n\t\t\t{\n\t\t\t\tcout << \"æº¢å‡ºè¡¨\" << endl;\n\t\t\t\treturn i;\n\t\t\t}\n\t}\n\treturn -1;\n}\nint main(void)\n{\n\tint a[10] = { 12,45,2,6,78,9,0,1,15 };\n\tHashTable table;\n\tInit(&table);\n\tfor (int i = 0; i < 10; i++)\n\t\tInsertHash(&table, a[i]);\n \n\tint res = Search(&table, 2);\n\tif (res != -1)\n\t\tcout << \"æŸ¥æ‰¾æˆåŠŸï¼åœ°å€ä¸ºï¼š \" << res << endl;\n\telse\n\t\tcout << \"æŸ¥æ‰¾å¤±è´¥ï¼ \" << endl;\n\tsystem(\"pause\");\n\treturn 0;\n}\n```\n\n","categories":["è¯¾å ‚ç¬”è®°"]},{"title":"åŸºç¡€æ•°æ®ç»“æ„_çº¿æ€§è¡¨æ¦‚æ‹¬&é¡ºåºè¡¨","url":"/åŸºç¡€æ•°æ®ç»“æ„/åŸºç¡€æ•°æ®ç»“æ„_çº¿æ€§è¡¨æ¦‚æ‹¬&é¡ºåºè¡¨/","content":"# çº¿æ€§è¡¨\n\nçº¿æ€§è¡¨(linear_list)æ˜¯æœ€å¸¸ç”¨ä¸”æœ€ç®€å•çš„ä¸€ç§æ•°æ®ç»“æ„ã€‚ç®€è¨€ä¹‹ï¼Œ**ä¸€ä¸ªçº¿æ€§è¡¨æ˜¯nä¸ªæ•°æ®å…ƒç´ çš„æœ‰é™åºåˆ—**ã€‚è‡³äºæ¯ä¸ªæ•°æ®å…ƒç´ çš„å…·ä½“å«ä¹‰ï¼Œåœ¨ä¸åŒçš„æƒ…å†µä¸‹å„ä¸ç›¸åŒï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªæ•´æ•°æˆ–ä¸€ä¸ªå­—ç¬¦ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€é¡µä¹¦ï¼Œç”šè‡³å…¶ä»–æ›´å¤æ‚çš„ä¿¡æ¯ã€‚\n\n## çº¿æ€§ç»“æ„çš„ç‰¹ç‚¹\n\n1. å­˜åœ¨æƒŸä¸€çš„ä¸€ä¸ªè¢«ç§°ä½œâ€œç¬¬ä¸€ä¸ªâ€çš„æ•°æ®å…ƒç´ ï¼›\n2. å­˜åœ¨æƒŸä¸€çš„ä¸€ä¸ªè¢«ç§°ä½œâ€œæœ€åä¸€ä¸ªâ€çš„æ•°æ®å…ƒç´ ï¼›\n3. é™¤ç¬¬ä¸€ä¸ªä¹‹å¤–ï¼Œé›†åˆä¸­çš„æ¯ä¸ªæ•°æ®å…ƒç´ å‡åªæœ‰ä¸€ä¸ªå‰é©±ï¼›\n4. é™¤æœ€åä¸€ä¸ªä¹‹å¤–ï¼Œé›†åˆä¸­æ¯ä¸ªæ•°æ®å…ƒç´ å‡åªæœ‰ä¸€ä¸ªåç»§ï¼›\n\n![image-20210914180221393](../../images/%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84_%E7%BA%BF%E6%80%A7%E8%A1%A8%E6%A6%82%E6%8B%AC&%E9%A1%BA%E5%BA%8F%E8%A1%A8/image-20210914180221393.png)\n\næ¦‚æ‹¬æ¥è®²ï¼Œæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯â€œ**å…ƒç´ ä¹‹é—´ä¸€å¯¹ä¸€**â€çš„ç‰¹ç‚¹ï¼Œå³ç‰¹ç‚¹3å’Œ4ï¼›å¦å¤–çš„ä¸€ä¸ªæ ‡å¿—å°±æ˜¯ï¼Œ**å®ƒæ˜¯è¿ç»­ä¸é—´æ–­çš„**ã€‚\n\næœ€åè¿˜è¦è¯´æ˜çš„æ˜¯ï¼Œè™½ç„¶æˆ‘ä»¬å¯¹çº¿æ€§è¡¨çš„å®šä¹‰ä¸­æ²¡æœ‰è¦æ±‚nä¸ªæ•°æ®å…ƒç´ æ˜¯ç›¸åŒç±»å‹çš„ï¼Œä½†æ˜¯**æˆ‘ä»¬åœ¨ç¼–ç¨‹çš„å®é™…åº”ç”¨ä¸­åªç ”ç©¶æ•°æ®å…ƒç´ å…·æœ‰ç›¸åŒç±»å‹çš„çº¿æ€§è¡¨**ã€‚å› ä¸ºæ— ç±»å‹çš„æ³›å‹çº¿æ€§è¡¨æ²¡æœ‰ç ”ç©¶ä»·å€¼å’Œæ„ä¹‰ã€‚\n\n```c\nint main()\n{\n    int ar[10] = {12,23,34,45,56,67};\n    double dx[10] = {12.23, 23.34, 34.45};\n    \n    //ä»¥ä¸‹æ³›å‹çº¿æ€§è¡¨æˆ‘ä»¬ä¸åšç ”ç©¶\n    {12, 45.56, 'a', {\"09001\",\"yhping\",\"man\"}, \"hmin\"};\n}\n```\n\næ•°æ®å…ƒç´ ç±»å‹ç›¸åŒçš„çº¿æ€§è¡¨çš„ç›¸é‚»æ•°æ®å…ƒç´ ä¹‹é—´å­˜åœ¨åºå¶å…³ç³»ã€‚è‹¥å°†å«æœ‰nä¸ªå…ƒç´ çš„çº¿æ€§è¡¨è®°ä¸ºï¼š\n$$\n(a_0,a_1,...,a_{i-1},a_i,a_{i+1},...,a_{n-1})\n$$\nåˆ™è¡¨ä¸­$a_{i-1}$é¢†å…ˆäº$a_{i}$ï¼Œ$a_{i}$é¢†å…ˆäº$a_{i+1}$ã€‚ç§°$a_{i-1}$æ˜¯$a_{i}$çš„ç›´æ¥å‰é©±å…ƒç´ ï¼Œ$a_{i+1}$æ˜¯$a_{i}$çš„ç›´æ¥åç»§å…ƒç´ ã€‚å½“$i=0,2,...,n-2$æ—¶ï¼Œ$a_{i}$æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªç›´æ¥åç»§ï¼Œå½“$i=1,2,...,n-1$æ—¶ï¼Œ$a_{i}$æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªç›´æ¥å‰é©±ã€‚\n\n## æ€»ç»“\n\nçº¿æ€§è¡¨çš„å†³å®šæ€§ç‰¹å¾ï¼š\n\n1. ä¸€å¯¹ä¸€\n2. è¿ç»­ä¸é—´æ–­\n\n# é¡ºåºè¡¨\n\né¡ºåºè¡¨æ˜¯çº¿æ€§è¡¨çš„ä¸€ç§è¡¨ç¤ºå’Œå®ç°æ–¹å¼ã€‚æŒ‡çš„æ˜¯ç”¨ä¸€ç»„åœ°å€è¿ç»­çš„å­˜å‚¨å•å…ƒä¾æ¬¡å­˜å‚¨çº¿æ€§è¡¨çš„æ•°æ®å…ƒç´ ã€‚\n\nç¤ºä¾‹ï¼š\n\n```c\nint main()\n{\n    int ar[10]={12,23,34,45,56,67,78,89,90,100};\n  //ä½åºã€æ•°ç»„ä¸‹æ ‡:0  1  2  3  4  5  6  7  8  9\n    return 0;\n}\n```\n![image-20210914212736157](../../images/åŸºç¡€æ•°æ®ç»“æ„_çº¿æ€§è¡¨æ¦‚æ‹¬&é¡ºåºè¡¨/image-20210914212736157.png)\n\n## å®¹é‡å›ºå®šçš„é¡ºåºè¡¨\n\næœ‰ç¼ºé™·ã€‚å®¹é‡å›ºå®šçš„é¡ºåºè¡¨çš„æ•°æ®å…ƒç´ ä¸€èˆ¬éƒ½æ˜¯ç›´æ¥ä»¥æ•°ç»„çš„å½¢å¼åœ¨æ ˆç©ºé—´ä¸­å­˜æ”¾ï¼Œé¡ºåºè¡¨ä¸€æ—¦å®šä¹‰åœ¨å†…å­˜ä¸­ï¼Œåˆ™å­˜å‚¨ç©ºé—´å°±å®šæ­»äº†ã€‚è€Œæ ˆçš„ç©ºé—´èµ„æºæ˜¯å¾ˆå®è´µçš„ï¼Œé»˜è®¤æƒ…å†µä¸‹æ ˆçš„å¤§å°åªæœ‰1Mï¼Œå¯¼è‡´å›ºå®šçš„é¡ºåºè¡¨æœ€å¤§å®¹é‡å—åˆ°é™åˆ¶ã€‚\n\n```c\n#define SEQ_INIT_SIZE 1024*1024\t//1Mï¼Œå°†ä¼šæ ˆæº¢å‡º\ntypedef char ElemType;\ntypedef struct\n{\n    ElemType data[SEQ_INIT_SIZE];\n    int cursize;\n}SeqList;\n```\n## å®¹é‡å¯å˜é¡ºåºè¡¨\n\nå½“é¡ºåºè¡¨éœ€è¦æ‰©å®¹æ—¶ï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°ç»™é¡ºåºè¡¨åˆ†é…å­˜å‚¨ç©ºé—´ï¼Œå³è°ƒç”¨åŠ¨æ€å†…å­˜ç®¡ç†å‡½æ•°reallocã€‚æˆ‘ä»¬åœ¨è¿™é‡Œé»˜è®¤ä¸€ä¸ªæ–°çš„é¡ºåºè¡¨çš„åˆå§‹å®¹é‡æ˜¯10ï¼Œæ‰©å®¹åçš„å®¹é‡æ˜¯åŸå®¹é‡çš„2å€ã€‚\n\n```c\n#define SEQ_INIT_SIZE 10\n#define SEQ_INC_SIZE 2\n```\n\n### ç»“æ„ä½“è®¾è®¡\n\n```c\ntypedef struct\n{\n    ElemType *data;\t//ä¸“é—¨å®šä¹‰ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘åŠ¨æ€ç©ºé—´çš„é¦–åœ°å€\n    int capacity;\t//å®¹é‡\n    int cursize;\t//ç°å­˜å…ƒç´ ä¸ªæ•°\n}SeqList;\n```\n\n\n\n```c\nint main()\n{\n    SeqList myseq;\n    InitSeqList(&myseq);\n    return 0;\n}\n```\n\nä»¥ä¸‹å³æ˜¯å£°æ˜äº†SeqList myseq;åï¼Œmyseqåœ¨å†…å­˜ä¸­çš„æƒ…å†µã€‚\n\n![image-20210914223828585](../../images/%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84_%E7%BA%BF%E6%80%A7%E8%A1%A8%E6%A6%82%E6%8B%AC&%E9%A1%BA%E5%BA%8F%E8%A1%A8/image-20210914223828585.png)\n\n### åˆå§‹åŒ–\n\nå³å¦‚ä½•ç¼–å†™InitSeqList(&myseq);å‡½æ•°\n\n```c\n//æœ€åŸå§‹çš„å†™æ³•\n#define SEQ_INIT_SIZE 10\n#define SEQ_INC_SIZE 2\ntypedef int ElemType;\nvoid InitSeqList(SeqList seq)\n{\n    seq.capacity = SEQ_INIT_SIZE;\n    seq.cursize = 0;\n    seq.data = (ElemType*)malloc(seq.capacity);\n}\nint main()\n{\n    SeqList myseq = {};\t//æŠŠæˆå‘˜éƒ½åˆå§‹åŒ–ä¸º0ï¼Œå¦åˆ™åœ¨VS2012ç¯å¢ƒä¸‹çš„ä»£ç è¿è¡Œè¿‡ç¨‹ä¸­ä¼šæŠ¥é”™ã€‚å³è¿è¡Œæ—¶å€¼ä¼ é€’ä¸ä¼šè¿›è¡Œã€‚å°±æ¯”å¦‚int a;printf(\"%d\\n\",a);ä¸»è¦æ˜¯å› ä¸ºæ²¡æœ‰è¿›è¡Œåˆå§‹åŒ–çš„å€¼æ˜¯éšæœºå€¼ï¼ŒæŸäº›è¿è¡Œç¯å¢ƒä¼šè®¤ä¸ºæ­¤æ—¶è¿›è¡Œå€¼ä¼ é€’æ˜¯æ¯«æ— æ„ä¹‰çš„ã€‚\n    InitSeqList(myseq);\n    return 0;\n}\n```\n\nä»¥ä¸Šå†™æ³•æ˜¯ä¸å¯ä½¿myseqæ­£ç¡®åˆå§‹åŒ–çš„ï¼Œå› ä¸º**å‡½æ•°åªå¯¹å­å‡½æ•°åŸŸçš„å½¢å‚myseqåˆå§‹åŒ–**ï¼Œå‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œå­å‡½æ•°åŸŸçš„myseqå°±è¢«æ”¶å›èµ„æºï¼Œè€Œ**ä¸»å‡½æ•°åŸŸä¸­çš„myseqçš„å®é™…å†…å®¹ä¸æ¯«æ— å½±å“**ã€‚å› ä¸ºInitSeqList(myseq)åªæ˜¯ç›¸å½“äºå¤åˆ¶äº†ä¸€ä¸ªmyseqï¼Œå³æŠŠè‡ªèº«çš„æˆå‘˜å€¼ä¼ é€’ç»™äº†ä¸€ä¸ªå…¶ä»–åŸŸçš„myseqã€‚\n\nè¿™æ˜¯ç¬¬ä¸€ä¸ªé—®é¢˜ã€‚\n\né™¤äº†è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºï¼šå­å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œå­å‡½æ•°åŸŸçš„myseqå°±è¢«æ”¶å›èµ„æºï¼Œè€Œæ­¤æ—¶dataæŒ‡é’ˆæ‰€æŒ‡å‘çš„åŠ¨æ€ç©ºé—´æœªè¢«é‡Šæ”¾ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚\n\næ‰€ä»¥è¿™ä¸ªåˆå§‹åŒ–å‡½æ•°çš„å†™æ³•æ˜¯é”™ä¸ŠåŠ é”™çš„ã€‚\n\næ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯ä¼ é€’ä¸»å‡½æ•°åŸŸä¸­myseqçš„è‡ªèº«åœ°å€ï¼Œä»è€Œå®ç°å¯¹ä¸»å‡½æ•°åŸŸçš„myseqè¿›è¡Œåˆå§‹åŒ–ã€‚\n\nä¸‹ä¸€ä¸ªé—®é¢˜ï¼Œ(ElemType\\*)malloc(seq.capacity);ï¼Œmallocçš„å‚æ•°æ˜¯å­˜å‚¨å•å…ƒæ•°ï¼Œå³å­—èŠ‚æ•°ã€‚æ­¤å¤„çš„å…ƒç´ ç±»å‹æ˜¯ElemTypeå³intå‹ï¼Œintå‹æ¯ä¸€ä¸ªå…ƒç´ å 4ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥åº”è¯¥åœ¨å‚æ•°ä¸­å†ä¹˜ä»¥4ã€‚å³seq.capacity\\*4\n\nç¬¬ä¸€æ¬¡æ”¹è¿›åçš„ä»£ç \n\n```c\n//ç¬¬ä¸€æ¬¡æ”¹è¿›\n#define SEQ_INIT_SIZE 10\n#define SEQ_INC_SIZE 2\ntypedef int ElemType;\nvoid InitSeqList(SeqList *plist)\n{\n    plist->capacity = SEQ_INIT_SIZE;\n    plist->cursize = 0;\n    plist->data = (ElemType*)malloc(plist->capacity*sizeof(ElemType));\n}\nint main()\n{\n    SeqList myseq = {};\n    InitSeqList(&myseq);\n    return 0;\n}\n```\n\nè¿˜æœ‰ä¸€äº›ç»†èŠ‚ä¸Šçš„é—®é¢˜ï¼Œå‡½æ•°åœ¨æ‰§è¡Œå‰ï¼Œ**è¦è¿›è¡Œåˆ¤ç©ºå¤„ç†**ï¼Œå³ä¼ å…¥çš„plistä¸è¦æ˜¯NULLæŒ‡é’ˆã€‚ç¬¬äºŒï¼Œmallocæ˜¯å‘å †åŒºç”³è¯·ç©ºé—´ï¼Œå †åŒºå¤§å°ä¹Ÿæ˜¯æœ‰é™çš„ï¼Œæ‰€ä»¥æœ‰å¯èƒ½ç”³è¯·ä¸åˆ°ï¼Œæˆ‘ä»¬**è¦å¯¹å¤±è´¥æƒ…å†µè¿›è¡Œå¤„ç†**ã€‚\n\nç¬¬äºŒæ¬¡æ”¹è¿›åçš„ä»£ç \n\n```c\nvoid InitSeqList(SeqList *plist)\n{\n    assert(plist!=NULL);\n    plist->capacity = SEQ_INIT_SIZE;\n    plist->cursize = 0;\n    plist->data = (ElemType*)malloc(plist->capacity*sizeof(ElemType));\n\tif(NULL == plist->data)\n    {\n        printf(\"error \\n\");\n        exit(EXIT_FAILURE);\n    }\n}\n```\n\n### æ•´è¡¨æ‰“å°\n\n```c\nvoid PrintSeqList(SeqList *plist)\n{\n    assert(plist!=NULL);\n    printf(\"Capacity: %d\\n\",plist->capacity);\n    printf(\"Cursize: %d\\n\",plist->cursize);\n    for(int i = 0; i < plist->cursize; ++i)\n    {\n        printf(\"%3d\",plist->data[i]);\n    }\n    printf(\"\\n\");\n}\n```\n\n### æŸ¥è¯¢æŸå€¼çš„ä¸‹æ ‡ä½ç½®\n\n```c\n//ç¬¬ä¸€æ¬¡å†™\nint FindValue(SeqList *plist, ElemType val)\n{\n    assert(plist!=NULL);\n    int pos = -1;\n    for(int i = 0; i < plist->cursize; ++i)\n    {\n        if(val == plist->data[i])\n        {\n            pos = i;\n            break;\n        }\n    }\n    return pos;\n}\n```\n\n\n\n```c\n//æ”¹è¿›ï¼Œå·§å¦™åœ°è¿ç”¨â€œæ‰¾åˆ°â€æƒ…å†µä¸‹çš„è¿”å›å€¼å’Œâ€œæœªæ‰¾åˆ°â€æƒ…å†µä¸‹è¿”å›å€¼çš„å…³è”ã€‚ä½¿ä»£ç çš„é€»è¾‘å¦‚è¡Œäº‘æµæ°´ä¸€èˆ¬é¡ºç•…ã€‚\nint FindValue(SeqList *plist, ElemType val)\n{\n    assert(plist!=NULL);\n    int pos = plist->cursize - 1;\n    while(pos>=0 && plist->data[pos]!=val)//æœ‰ä¸¤ä¸ªå‡ºå£ï¼šä¸€æ˜¯pos<0å³ä¸º-1ï¼Œè¡¨ç¤ºæ•´ä¸ªè¡¨ä¸­æœªæ‰¾åˆ°valï¼›å¦ä¸€ä¸ªå‡ºå£æ˜¯data[pos]==valï¼Œæ­¤æ—¶çš„poså³ä¸ºvalå€¼çš„ä¸‹æ ‡ã€‚\n    {\n        --pos;\n    }\n    return pos;\n}\n```\n\n### æœªè€ƒè™‘å®¹é‡é—®é¢˜\n\nåœ¨æŒ‡å®šä½ç½®æ’å…¥æ•°æ®å…ƒç´ \n\n```c\nbool InsertItem(SeqList *plist, int pos, ElemType val)\n{\n    assert(plist!=NULL);\n    if(pos<0 || pos > plist->cursize)\n    {\n        return false;\n\t}\n    //è¯¥ä½ç½®ä¹‹åçš„å…ƒç´ å…¨éƒ½å‘åç§»ä¸€ä½ã€‚\n    for(int i = plist->cursize; i>pos; --i)\n    {\n        plist->data[i]=plist->data[i-1];//å­˜åœ¨æ¼æ´ï¼Œå¦‚æœè¡¨æ»¡ï¼Œiè¶Šç•Œ\n    }\n    plist->data[pos] = val;\n    plist->cursize += 1;\n    return true;\n}\n//å°¾æ’\nvoid Push_Back(SeqList *plist, ElemType val)\n{\n    assert(plist!=NULL);\n    InsertItem(plist, plist->cursize, val);\n}\n//å¤´æ’\nvoid Push_Front(SeqList *plist, ElemType val)\n{\n    assert(plist!=NULL);\n    InsertItem(plist, 0, val);\n}\n```\n\n### è€ƒè™‘å®¹é‡é—®é¢˜\n\n#### è·å–å¤§å°ã€å®¹é‡\n\n```c\nint GetSize(SeqList *plist)\n{\n    assert(plist!=NULL);\n    return plist->cursize;\n}\nint GetCapacity(SeqList *plist)\n{\n    assert(plist!=NULL);\n    return plist->capacity;\n}\n```\n\n\n\n#### åˆ¤ç©ºã€åˆ¤æ»¡\n\n```c\nbool IsEmpty(SeqList *plist)\n{\n    assert(plist!=NULL);\n    return GetSize(plist) == 0;\n}\nbool IsFull(SeqList *plist)\n{\n    assert(plist!=NULL);\n    return GetSize(plist) == GetCapacity(plist);\n}\n```\n\n\n\n#### å¢å®¹\n\n##### ç”¨mallocå®ç°çš„å¢å®¹\n\nå®Œæˆçš„åŠ¨ä½œï¼š\n\n1. malloc\n2. myseq.dataæ‰€æœ‰æ•°æ®ç§»åŠ¨åˆ°æ–°ç©ºé—´\n3. freeåŸç©ºé—´\n4. dataæŒ‡é’ˆæŒ‡å‘æ–°ç©ºé—´çš„é¦–åœ°å€\n5. æ›´æ–°capacity\n\n```c\nbool Inc_Capacity(SeqList *plist)\n{\n    assert(plist!=NULL);\n    ElemType *newdata = NULL;\n    int newcap = GetCapacity(plist)*SEQ_INC_SIZE;\n    newdata = (ElemType*)malloc(newcap*sizeof(ElemType));\n    if(NULL == newdata)\n    {\n        return false;\n    }\n    \n    for(int i = 0;i < plist->GetCapacity(plist);++i)\n    {\n        newdata[i] = plist->data[i];\n    }\n    \n    free(plist->data);\n    \n    plist->data = newdata;\n    \n    plist->capacity = newcap;\n    return true;\n}\n```\n\nä¼˜åŒ–-ç§»åŠ¨æ•°æ®\n\n```c\n\t/*for(int i = 0;i < plist->GetCapacity(plist);++i)\n    {\n        newdata[i] = plist->data[i];\n    }*/\n\t//å¯ä»¥æ¢ä¸º\n\tmemmove(newdata, plist->data, plist->cursize*sizeof(ElemType));\n```\n\n##### ç”¨reallocå®ç°çš„å¢å®¹\n\n```c\nbool Inc_Capacity(SeqList *plist)\n{\n    assert(plist!=NULL);\n    int newcap = GetCapacity(plist)*SEQ_INC_SIZE;\n    \n    //ä¸è¦ç›´æ¥æŠŠreallocçš„è¿”å›å€¼èµ‹ç»™plist->dataï¼Œå› ä¸ºå¯èƒ½è¿”å›NULLï¼Œå¯¼è‡´æ•°æ®ç©ºé—´ä¸¢å¤±ã€‚\n    ElemType *newdata = (ElemType*)realloc(plist->data, newcap*sizeof(ElemType));\n    if(NULL == newdata)\n    {\n        return false;\n    }\n    \n    plist->data = newdata;\n    \n    plist->capacity = newcap;\n    return true;\n}\n```\n\n\n\n#### åœ¨æŒ‡å®šä½ç½®æ’å…¥æ•°æ®å…ƒç´ \n\n\n\n```c\nbool InsertItem(SeqList *plist, int pos, ElemType val)\n{\n    assert(plist!=NULL);\n    if(pos<0 || pos > plist->cursize)\n    {\n        return false;\n\t}\n    if(IsFull(plist) && !Inc_Capacity(plist))//è¡¨æ»¡ä¸”æ‰©å®¹å¤±è´¥\n    {\n        return false;\n    }\n    //è¯¥ä½ç½®ä¹‹åçš„å…ƒç´ å…¨éƒ½å‘åç§»ä¸€ä½ã€‚\n    for(int i = plist->cursize; i>pos; --i)\n    {\n        plist->data[i]=plist->data[i-1];//æ°¸è¿œä¸ä¼šè¶Šç•Œï¼Œå› ä¸ºç§»åŠ¨å‰å·²ç»ç¡®ä¿ç©ºé—´å……è¶³\n    }\n    plist->data[pos] = val;\n    plist->cursize += 1;\n    return true;\n}\n```\n\nä¼˜åŒ–-è¿”å›çŠ¶æ€å€¼\n\n```c\n//infeasible:ä¸å¯è¡Œ\n//overflow:ç©ºé—´ä¸è¶³ï¼Œå†…å­˜æº¢å‡º\n#define TRUE 1\n#define FALSE 0\n#define OK 1\n#define ERROR 0\n\n#define INFEASIBLE -1\n#define OVERFLOW -2\n\ntypedef int Status;\n\nStatus InsertItem(SeqList *plist, int pos, ElemType val)\n{\n    assert(plist!=NULL);\n    if(pos<0 || pos > plist->cursize)\n    {\n        return INFEASIBLE;\n\t}\n    if(IsFull(plist) && !Inc_Capacity(plist))//è¡¨æ»¡ä¸”æ‰©å®¹å¤±è´¥\n    {\n        return OVERFLOW;\n    }\n    //è¯¥ä½ç½®ä¹‹åçš„å…ƒç´ å…¨éƒ½å‘åç§»ä¸€ä½ã€‚\n    for(int i = plist->cursize; i>pos; --i)\n    {\n        plist->data[i]=plist->data[i-1];//æ°¸è¿œä¸ä¼šè¶Šç•Œï¼Œå› ä¸ºç§»åŠ¨å‰å·²ç»ç¡®ä¿ç©ºé—´å……è¶³\n    }\n    plist->data[pos] = val;\n    plist->cursize += 1;\n    return OK;\n}\n\nint main()\n{\n    Status tag = InsertItem(&myseq,12,23);\n    if(tag == INFEASIBLE)\n    {\n        printf(\"ä½ç½®ä¸å¯è¡Œ\");\n    }\n    else if(tag == OVERFLOW)\n    {\n        printf(\"å†…å­˜æº¢å‡º\");\n    }\n    else if(tag == OK)\n    {\n        printf(\"æˆåŠŸ\");\n    }\n}\n```\n\n\n\n#### å°¾æ’ã€å¤´æ’\n\n```c\nvoid Push_Back(SeqList *plist, ElemType val)\n{\n    assert(plist!=NULL);\n    InsertItem(plist, plist->cursize, val);\n}\n```\n\n```c\nvoid Push_Front(SeqList *plist, ElemType val)\n{\n    assert(plist!=NULL);\n    InsertItem(plist, 0, val);\n}\n```\n\n#### æ’æ•°æ®æµ‹è¯•\n\n```c\nint main()\n{\n    SeqList myseq = {};\n    InitSeqList(&myseq);\n    for(int i = 0; i<20; ++i)\n    {\n        Push_Back(&myseq,i);\n        PrintSeqList(&myseq);\n\t}\n    return 0;\n}\n```\n\n#### åˆ \n\n```c\nStatus EraseItem(SeqList *plist, int pos)\n{\n    assert(plist!=NULL);\n    if(pos < 0 || pos > plist->cursize - 1)\n    {\n        return INFEASIBLE;\n    }\n    for(int i = pos; i < plist->cursize - 1; i++)\n    {\n        plist->data[i] = plist->data[i+1];\n    }\n    plist->cursize -= 1;\n    return OK;\n}\n```\n\n#### å¤´åˆ ã€å°¾åˆ \n\n```c\nvoid Pop_Front(SeqList *plist)\n{\n    assert(plist!=NULL);\n    EraseItem(plist, 0);\n}\nvoid Pop_Back(SeqList *plist)\n{\n    assert(plist!=NULL);\n    EraseItem(plist, plist->cursize-1);\n}\n```\n\n#### åˆ¤æ–­æ•°æ®å…ƒç´ æ˜¯å¦åœ¨è¡¨ä¸­\n\n```c\nbool LocateElem(const SeqList *plist, ElemType val)\n{\n    assert(plist!=NULL);\n    return FindValue(plist,val) != -1;\n}\n```\n\n#### åˆ é™¤æœ€åä¸€ä¸ªæ•°æ®å…ƒç´ val\n\nå› ä¸ºFindå‡½æ•°æ˜¯ä»åå‘å‰æ‰¾çš„ã€‚\n\n```c\nStatus Remove(SeqList *plist, ElemType val)\n{\n    assert(plist!=NULL);\n    return EraseItem(plist, FindValue(plist, val));\n}\n```\n\n#### ç½®ç©ºã€æ‘§æ¯\n\n```c\nvoid ClearSeqList(SeqList *plist)\n{\n    assert(plist!=NULL);\n    plist->cursize = 0;\n}\nvoid Destroy(SeqList *plist)\n{\n    assert(plist!=NULL);\n    plist->cursize = 0;\n    plist->capacity = 0;\n    free(plist->data); \n}\n```\n\n\n\n#### åˆ é™¤æ‰€æœ‰valå…ƒç´ \n\n```c\nvoid Remove_All(SeqList *plist, ElemType val)\n{\n    assert(plist!=NULL);\n    int j = 0;\n    for(int i = 0;i<plist->cursize; ++i)\n    {\n        if(val != plist->data[i])\n        {\n            plist->data[j]=plist->data[i];\n            j++;\n        }\n    }\n    plist->cursize = j;\n}\n```\n\n### æ•´ç†ä»£ç +const\n\n#### å¤´æ–‡ä»¶\n\n```c\n//My_SeqList.h\n#ifndef MY_SEQLIST_H\n#define MY_SEQLIST_H\n\n//infeasible:ä¸å¯è¡Œ\n//overflow:ç©ºé—´ä¸è¶³ï¼Œå†…å­˜æº¢å‡º\n#define TRUE 1\n#define FALSE 0\n#define OK 1\n#define ERROR 0\n\n#define INFEASIBLE -1\n#define OVERFLOW -2\n\ntypedef int Status;\n#define SEQ_INIT_SIZE 4\n#define SEQ_INC_SIZE 2\ntypedef int ElemType;\ntypedef struct\n{\n    ElemType *data;\n    int capacity;\n    int cursize;\n}SeqList;\n\nvoid InitSeqList(SeqList *plist);\nvoid DestroySeqList(SeqList *plist);\n\nvoid ClearSeqList(SeqList *plist);\n\nint GetSize(const SeqList *plist);\nint GetCapacity(const SeqList *plist);\nbool IsEmpty(const SeqList *plist);\nbool IsFull(const SeqList *plist);\n\nint FindValue(const SeqList *plist, ElemType val);\n\nbool Inc_Capacity(SeqList *plist);\nStatus InsertItem(SeqList *plist, int pos, ElemType val);\nvoid Push_Back(SeqList *plist, ElemType val);\nvoid Push_Front(SeqList *plist, ElemType val);\n\nStatus EraseItem(SeqList *plist, int pos);\nvoid Pop_Back(SeqList *plist);\nvoid Pop_Front(SeqList *plist);\nbool LocateElem(const SeqList *plist, ElemType val);\nStatus Remove(SeqList *plist, ElemType val);\n\nvoid PrintSeqList(const SeqList *plist);\n#endif\n```\n\n#### cppæ–‡ä»¶\n\n```c\n//My_SeqList.cpp\n#include<stdio.h>\n#include<stdlib.h>\n#include<string.h>\n#include<assert.h>\n#include\"My_SeqList.h\"\n\nvoid InitSeqList(SeqList seq)\n{\n    seq.capacity = SEQ_INIT_SIZE;\n    seq.cursize = 0;\n    seq.data = (ElemType*)malloc(seq.capacity);\n}\nvoid ClearSeqList(SeqList *plist)\n{\n    assert(plist!=NULL);\n    plist->cursize = 0;\n}\nvoid DestroySeqList(SeqList *plist)\n{\n    assert(plist!=NULL);\n    plist->cursize = 0;\n    plist->capacity = 0;\n    free(plist->data); \n}\n\nint GetSize(const SeqList *plist)\n{\n    assert(plist!=NULL);\n    return plist->cursize;\n}\nint GetCapacity(const SeqList *plist)\n{\n    assert(plist!=NULL);\n    return plist->capacity;\n}\nbool IsEmpty(const SeqList *plist)\n{\n    assert(plist!=NULL);\n    return GetSize(plist) == 0;\n}\nbool IsFull(const SeqList *plist)\n{\n    assert(plist!=NULL);\n    return GetSize(plist) == GetCapacity(plist);\n}\n\nint FindValue(const SeqList *plist, ElemType val)\n{\n    assert(plist!=NULL);\n    int pos = plist->cursize - 1;\n    while(pos>=0 && plist->data[pos]!=val)\n    {\n        --pos;\n    }\n    return pos;\n}\nbool Inc_Capacity(SeqList *plist)\n{\n    assert(plist!=NULL);\n    int newcap = GetCapacity(plist)*SEQ_INC_SIZE;\n    \n    ElemType *newdata = (ElemType*)realloc(plist->data, newcap*sizeof(ElemType));\n    if(NULL == newdata)\n    {\n        return false;\n    }\n    \n    plist->data = newdata;\n    \n    plist->capacity = newcap;\n    return true;\n}\n\nStatus InsertItem(SeqList *plist, int pos, ElemType val)\n{\n    assert(plist!=NULL);\n    if(pos<0 || pos > plist->cursize)\n    {\n        return INFEASIBLE;\n\t}\n    if(IsFull(plist) && !Inc_Capacity(plist))//è¡¨æ»¡ä¸”æ‰©å®¹å¤±è´¥\n    {\n        return OVERFLOW;\n    }\n    //è¯¥ä½ç½®ä¹‹åçš„å…ƒç´ å…¨éƒ½å‘åç§»ä¸€ä½ã€‚\n    for(int i = plist->cursize; i>pos; --i)\n    {\n        plist->data[i]=plist->data[i-1];//æ°¸è¿œä¸ä¼šè¶Šç•Œï¼Œå› ä¸ºç§»åŠ¨å‰å·²ç»ç¡®ä¿ç©ºé—´å……è¶³\n    }\n    plist->data[pos] = val;\n    plist->cursize += 1;\n    return OK;\n}\n\nvoid Push_Back(SeqList *plist, ElemType val)\n{\n    assert(plist!=NULL);\n    InsertItem(plist, plist->cursize, val);\n}\n\nvoid Push_Front(SeqList *plist, ElemType val)\n{\n    assert(plist!=NULL);\n    InsertItem(plist, 0, val);\n}\n\n\nStatus EraseItem(SeqList *plist, int pos)\n{\n    assert(plist!=NULL);\n    if(pos < 0 || pos > plist->cursize - 1)\n    {\n        return INFEASIBLE;\n    }\n    for(int i = pos; i < plist->cursize - 1; i++)\n    {\n        plist->data[i] = plist->data[i+1];\n    }\n    plist->cursize -= 1;\n    return OK;\n}\n\nvoid Pop_Front(SeqList *plist)\n{\n    assert(plist!=NULL);\n    EraseItem(plist, 0);\n}\nvoid Pop_Back(SeqList *plist)\n{\n    assert(plist!=NULL);\n    EraseItem(plist, plist->cursize-1);\n}\n\nbool LocateElem(const SeqList *plist, ElemType val)\n{\n    assert(plist!=NULL);\n    return FindValue(plist,val) != -1;\n}\n\nStatus Remove(SeqList *plist, ElemType val)\n{\n    assert(plist!=NULL);\n    return EraseItem(plist, FindValue(plist, val));\n}\n\nvoid Remove_All(SeqList *plist, ElemType val)\n{\n    assert(plist!=NULL);\n    int j = 0;\n    for(int i = 0;i<plist->cursize; ++i)\n    {\n        if(val != plist->data[i])\n        {\n            plist->data[j]=plist->data[i];\n            j++;\n        }\n    }\n    plist->cursize = j;\n}\nvoid PrintSeqList(const SeqList *plist)\n{\n    assert(plist!=NULL);\n    printf(\"Capacity: %d\\n\",plist->capacity);\n    printf(\"Cursize: %d\\n\",plist->cursize);\n    for(int i = 0; i < plist->cursize; ++i)\n    {\n        printf(\"%3d\",plist->data[i]);\n    }\n    printf(\"\\n\");\n}\n```\n\n```c\nint main()\n{\n    SeqList myseq;\n    InitSeqList(&myseq);\n    \n    \n    \n    DestroySeqList(&myseq);\n}\n```\n\n# é¢è¯•é¢˜\n\n## æŸ¥è¡¨æ³•æ‰¾æ•°ç»„ä¸­é‡å¤çš„å€¼\n\n```c\n//\nint FindDuplicate(int *nums, int size)\n{\n    assert(nums!=NULL);\n    int res = 0;\n    int *ar = (int*)calloc(size,sizeof(int));\n    if(NULL == ar)\n    {\n        exit(1);\n    }\n    for(int i = 0;i<size;++i)\n    {\n        if(ar[nums[i]]++!=0)\n        {\n         \tres = nums[i];\n            break;\n        }\n    }\n    free(ar);\n    ar = NULL;\n    return res;\n}\n```\n\n","categories":["åŸºç¡€æ•°æ®ç»“æ„"]},{"title":"MIT-6.S081","url":"/æ“ä½œç³»ç»Ÿ/MIT-6.S081/","content":"# å†…å®¹\n\nSchedule: [6.S081 / 2020å¹´ç§‹å­£ --- 6.S081 / Fall 2020 (mit.edu)](https://pdos.csail.mit.edu/6.828/2020/schedule.html)\n1. Basic ideas of OS\n2. Study of the code in xv6 (a small teaching OS)\n    1. talk about how it works\n    2. look at the code and show the code executing\n    3. reading assignments, a book that describes how xv6 operates and why it's designed that way.\n    4. xv6 is a simplified unix-like operating system, which runs on the RISC-V microprocessor that is the same microprocessor and the focus of 6.004, but in this course we will run xv6 under the QEMU machine emulator which runs on Linux.\n3. Background to help do the labs, like about C works, how the RISC-V which is the microprocessor that will be used.\n# Labs\n\nEither implementing basic operating system features or adding a kernel extensions to the xv6 operating system.\n\n2023 Guidance: [6.1810 / 2023 å¹´ç§‹å­£ --- 6.1810 / Fall 2023 (mit.edu)](https://pdos.csail.mit.edu/6.828/2023/tools.html)\n## å®‰è£…ä¸­é‡åˆ°çš„æ£˜æ‰‹é—®é¢˜ï¼ˆApple MèŠ¯ç‰‡ã€macOS 14ï¼‰\n\n1. ä¸éœ€è¦å®‰è£…xcode IDEï¼Œåªéœ€è¦å®‰è£…`$ xcode-select --install`å³å¯ï¼Œæ˜¯xcodeçš„å‘½ä»¤è¡Œå·¥å…·\n2. å®‰è£…Homebrewï¼ŒæŒ‰ç…§å®˜ç½‘ç»™çš„ä¸€å¥è¯å‘½ä»¤å®‰è£…\n3. https://github.com/riscv/homebrew-riscv è¿™æ˜¯homebrewä¸‹å®‰è£…risc-vï¼Œæ—§ç³»ç»Ÿã€æ—§èŠ¯ç‰‡å¯èƒ½ä¼šè£…åˆ°`/usr/local/opt/riscv-gnu-toolchain/bin`ï¼Œä½†æ–°ç³»ç»Ÿã€æ–°èŠ¯ç‰‡åˆ™è£…åˆ°äº†`/opt/homebrew/Cellar/riscv-gnu-toolchain/main.reinstall/bin`ã€‚\n4. The brew formula may not link intoÂ /usr/local. You will need to update your shell's rc file (e.g.Â [~/.bashrc](https://www.gnu.org/software/bash/manual/html_node/Bash-Startup-Files.html)) to add the appropriate directory toÂ [$PATH](http://www.linfo.org/path_env_var.html).\n    1. æ­¤å¤„éœ€è¦æ‰‹åŠ¨æ·»åŠ PATHï¼Œä¾‹å­ä¸­è¯´çš„æ˜¯bashrcï¼ŒM2ã€macOS14ç³»ç»Ÿä¸‹é»˜è®¤ç»ˆç«¯æ˜¯zshï¼Œå› æ­¤éœ€è¦åœ¨å®¶ç›®å½•ä¸‹çš„`.zshrc`ä¸­æ·»åŠ ï¼š`PATH=$PATH:/opt/homebrew/Cellar/riscv-gnu-toolchain/main.reinstall/bin`ã€‚æ„å‘³ç€å°†æ­¤ç›®å½•æ·»åŠ åˆ°å½“å‰ç”¨æˆ·çš„ç¯å¢ƒå˜é‡ `PATH` ä¸­ã€‚è¿™ä¸ªæ“ä½œçš„ä½œç”¨æ˜¯å°†è¯¥ç›®å½•ä¸‹çš„å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„åŒ…å«è¿›ç³»ç»Ÿçš„æ‰§è¡Œè·¯å¾„ä¸­ï¼Œä½¿å¾—ç³»ç»Ÿå¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­æ‰¾åˆ°å¹¶æ‰§è¡Œè¿™äº›å‘½ä»¤ã€‚\n    2. ä¿®æ”¹ `.zshrc` åï¼Œéœ€è¦æ‰§è¡Œ `source ~/.zshrc` å‘½ä»¤ä½¿å…¶ç”Ÿæ•ˆï¼Œæˆ–è€…å…³é—­å½“å‰ç»ˆç«¯çª—å£é‡æ–°æ‰“å¼€ä¸€ä¸ªæ–°çª—å£ã€‚\n5. ç”¨brewå®‰è£…qemuï¼Œé»˜è®¤è£…åˆ°äº†`/opt/homebrew/Cellar/qemu/9.0.1`\n6. ç„¶åï¼Œä»¥ä¸Šè¿™äº›å’Œxv6æ²¡å…³ç³»ï¼Œç¬¬ä¸€èŠ‚è¯¾æ¼”ç¤ºçš„xv6ç³»ç»Ÿéœ€è¦gitæºç ï¼š`git clone git://g.csail.mit.edu/xv6-labs-2023`ç„¶åè¿›å…¥make qemuã€‚\n7. å¦‚ä½•é€€å‡ºxv6ï¼šå…ˆæŒ‰`Ctrl+A`åå•å‡»`X`ã€‚\n## Lab1\n\nWriting applications that make the system calls\n## The Last Lab\n\nAdd a network stack and a network driver, to be able to connect in over the network to the operating system that you run.\n# é›¶ç¢\n\n## Xv6 I/O ä¸æ–‡ä»¶æè¿°ç¬¦\n\nhttps://blog.csdn.net/u012419550/article/details/113850465\n\n# OSè®¾è®¡åŸåˆ™\n\nOS should be defensive.\n- app cannot crash the OS\n- app cannot break out of its isolation\n\nStrong isolation between app and OS\n- typical : Hardware Support\n    - user / kernel mode\n    - virtual memory system\n# E01 - open & fork\n\nOperating Systems provide a lot of features and a lot of services, but they actually tend to interact, and sometimes in odd ways that require a lot of thought, even the simple examples given with **open** and **fork**.\nif a program allocates a file descriptor with the **open** system call, and then that same program forks.\nThe semantics of fork turned out to be that you create a new process that's a copy of the current process, this file descriptor you opened is truly to be a copy, this file descriptor still has to be present and usable in the child. So that is the files, the opened file descriptors, interact with fork in this interesting way. \nforkçš„è¯­ä¹‰æ˜¯ï¼šåˆ›å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œæ˜¯å½“å‰è¿›ç¨‹çš„å‰¯æœ¬ã€‚\nåˆšæ‰æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦åœ¨å­è¿›ç¨‹ä¸­ä»ç„¶å­˜åœ¨å¹¶å¯ç”¨ã€‚\n# Page Faults\nPlanï¼š\n1. Implement Virtual Memory features using page faults\n    1. lazy allocation\n    2. copy on write fork\n    3. demand paging\n    4. memory mapped files","categories":["æ“ä½œç³»ç»Ÿ"]},{"title":"Cè¯­è¨€_åŠ¨æ€å†…å­˜åˆ†é…","url":"/C/Cè¯­è¨€_åŠ¨æ€å†…å­˜åˆ†é…/","content":"# malloc\n\n1. è¿”å›ç±»å‹ä¸ºvoid *\n2. å‚æ•°ä¸º(unsigned int size)ï¼Œè¡¨ç¤ºæ€»å…±è¦å¼€è¾Ÿçš„å­—èŠ‚æ•°\n\n```c\nint* p = nullptr;\nint n = 0;\nscanf_s(\"%d\", &n);\n//p = (int*)malloc(n);//è¿™æ˜¯é”™è¯¯çš„å‚æ•°ï¼Œå› ä¸ºmallocçš„å‚æ•°è¦å†™è¦å¼€è¾Ÿçš„å­—èŠ‚æ•°ï¼Œè€Œä¸æ˜¯ä»¥å˜é‡æ•°ä¸ºå•ä½ã€‚\np = (int*)malloc(sizeof(int) * n);\n```\n\n\n\n# calloc\n\n1. è¿”å›ç±»å‹ä¸º*void\n2. å‚æ•°ä¸º(unsigned int count, unsigned int size)ï¼Œcountè¡¨ç¤ºå˜é‡æ•°ï¼Œsizeè¡¨ç¤ºå•ä¸ªå˜é‡(ç±»å‹)çš„å­—èŠ‚æ•°ã€‚\n\n```c\n#include<stdio.h>\n#include<stdlib.h>\n#include<string.h>//åŒ…å«memsetå‡½æ•°\ntypedef unsigned int size_t;\nvoid* My_Calloc(size_t count, size_t size)\n{\n    void* p = malloc(count * size);\n    if(nullptr != p)\n    {\n        memset(p, 0, count * size);//æŠŠpæŒ‡å‘çš„å†…å­˜ç©ºé—´ä¸­çš„æ•°æ®èµ‹å€¼ä¸º0x00\n    }\n    return p;\n}\n```\n\n# free\n\n1. ä¸ç®¡æ˜¯mallocè¿˜æ˜¯callocå¼€è¾Ÿçš„ç©ºé—´éƒ½æ˜¯ç”¨free(p)æ¥é‡Šæ”¾çš„ã€‚\n\n2. freeå¹¶ä¸æ˜¯æŠŠpé‡Šæ”¾æ‰äº†ï¼Œè€Œæ˜¯æŠŠpæŒ‡å‘å †åŒºçš„ç©ºé—´ä»å¼•ç”¨çŠ¶æ€è½¬æ¢æˆæœªå¼•ç”¨çŠ¶æ€ã€‚\n\n3. ç©ºé—´çš„é‡Šæ”¾åªèƒ½é‡Šæ”¾ä¸€æ¬¡ï¼Œä¸èƒ½é‡Šæ”¾å¤šæ¬¡\n\n4. free(p)é‡Šæ”¾åï¼Œè¦ç»™pèµ‹å€¼nullptrï¼Œé˜²æ­¢æŒ‡é’ˆå¤±æ•ˆå¸¦æ¥çš„éº»çƒ¦ã€‚\n\n   ```c\n   int* p = (int*)My_Calloc(10, sizeof(int));\n   free(p);\n   p = nullptr;\n   return 0;\n   ```\n\n   \n\n# realloc\n\nreallocæ‰©å……æˆ–æ”¶ç¼©ä¹‹å‰åˆ†é…çš„å†…å­˜å—ï¼ˆé‡æ–°åˆ†é…å†…å­˜å—ï¼‰\n\n```c\nvoid *realloc(void *ptr, size_t new_size);\n```\n1. å‚æ•°ä¸­çš„ptræŒ‡å‘éœ€è¦é‡æ–°åˆ†é…çš„å†…å­˜åŒºåŸŸçš„åœ°å€ï¼Œnew_sizeä¸ºæ–°çš„å­—èŠ‚æ•°\n2. è¿”å›å€¼ï¼šæˆåŠŸæ—¶ï¼Œè¿”å›æŒ‡å‘æ–°åˆ†é…å†…å­˜çš„æŒ‡é’ˆï¼Œè¿”å›çš„æŒ‡é’ˆå¿…é¡»ç”¨freeæˆ–reallocå½’è¿˜ã€‚ï¼›å¤±è´¥æ—¶ï¼Œè¿”å›ç©ºæŒ‡é’ˆã€‚åŸæŒ‡é’ˆpträ¿æŒæœ‰æ•ˆï¼Œå¹¶éœ€è¦é€šè¿‡freeæˆ–reallocå½’è¿˜ã€‚\n\né‡æ–°åˆ†é…ç»™å®šçš„å†…å­˜åŒºåŸŸã€‚å®ƒå¿…é¡»æ˜¯ä¹‹å‰ä¸ºmalloc/calloc/reallocåˆ†é…çš„ï¼Œå¹¶ä¸”ä»æœªè¢«freeæˆ–reallocçš„è°ƒç”¨æ‰€é‡Šæ”¾ã€‚å¦åˆ™ï¼Œç»“æœæœªå®šä¹‰ã€‚\n\n```c\nint size=5;//åˆ†é…ç©ºé—´çš„å˜é‡æ•°ä¸º5\nint new_size=10;//æœ€ç»ˆè¦åˆ†é…ç©ºé—´çš„å˜é‡æ•°ä¸º10\nint* p = (int*)malloc(sizeof(int)*size);//å¼€è¾Ÿsizeä¸ªintç©ºé—´\nfor(int i=0;i<size;++i)\n{\n    p[i]=1;\n}\np = (int*)realloc(p, sizeof(int) * new_size);//å¢åŠ åˆ°new_sizeä¸ªintç©ºé—´ï¼Œå³ç”±åŸæ¥5ä¸ªæ‰©å……åˆ°10ä¸ª\np = (int*)realloc(p, sizeof(int) * 2);//å‡å°‘åˆ°2ä¸ªintç©ºé—´ï¼Œå³ç”±åŸæ¥5ä¸ªæ”¶ç¼©åˆ°2ä¸ª\n```\n\n","categories":["C"]},{"title":"åŸºç¡€æ•°æ®ç»“æ„_Cè¯­è¨€å®ç°","url":"/åŸºç¡€æ•°æ®ç»“æ„/åŸºç¡€æ•°æ®ç»“æ„_Cè¯­è¨€å®ç°/","content":"# å†…å®¹\n\n1. æ•°æ®ç»“æ„çš„åŸºç¡€æ¦‚å¿µå’Œæ—¶é—´ç©ºé—´å¤æ‚åº¦\n2. çº¿æ€§è¡¨ï¼šé¡ºåºè¡¨ã€é“¾è¡¨\n   1. é¡ºåºè¡¨ï¼ˆå®šé•¿çš„ã€æ‰©å®¹çš„ï¼‰\n   2. å•é“¾è¡¨ï¼ˆå¸¦å¤´ç»“ç‚¹çš„ã€ä¸å¸¦å¤´ç»“ç‚¹çš„ï¼‰\n      1. éœ€è¦åŠ¨æ‰‹å®è·µï¼Œå¤§é‡çš„é¢è¯•é¢˜\n3. æ ˆï¼ˆé¡ºåºæ ˆã€é“¾æ ˆï¼‰\n   1. ç”¨ä¸¤ä¸ªæ ˆå®ç°ä¸€ä¸ªé˜Ÿåˆ—\n4. é˜Ÿåˆ—ï¼ˆé¡ºåºé˜Ÿã€é“¾é˜Ÿï¼‰\n   1. ç”¨ä¸¤ä¸ªé˜Ÿå®ç°ä¸€ä¸ªæ ˆ\n5. ä¸²ï¼ˆå­—ç¬¦æ•°ç»„ï¼‰\n   1. APIå®ç°ï¼ˆstrcpy strcat srtcmp strlenï¼‰\n   2. å­—ç¬¦ä¸²çš„æŸ¥æ‰¾ï¼ˆBFã€KMPç®—æ³•ï¼‰\n6. åŒå‘é“¾è¡¨ã€å¾ªç¯é“¾è¡¨ã€åŒå‘å¾ªç¯é“¾è¡¨\n7. å…«å¤§æ’åºç®—æ³•\n   1. å†’æ³¡æ’åº\n   2. äºŒè·¯å½’å¹¶æ’åº\n   3. æ’å…¥æ’åº\n   4. å¸Œå°”æ’åº\n   5. å †æ’åº\n   6. åŸºæ•°æ’åºï¼ˆæ¡¶æ’åºï¼‰\n   7. å¿«é€Ÿæ’åº\n   8. é€‰æ‹©æ’åº\n\n# æ¦‚å¿µ\n\n## æ•°æ®ç»“æ„\n\n1. é›†åˆ\n2. çº¿æ€§ï¼ˆç°å®ç”Ÿæ´»ä¸­çš„æ’é˜Ÿï¼‰\n3. æ ‘å‹ï¼ˆéƒ¨é—¨æ¶æ„ã€æ—è°±ï¼‰\n4. å›¾å‹ï¼ˆäº¤é€šç½‘ç»œã€å…­åº¦åˆ†å‰²ç†è®ºã€ç½‘ç»œæ‹“æ‰‘ï¼‰\n\n## æ—¶é—´å¤æ‚åº¦\n\næ‰§è¡Œè¯­å¥ä¸é—®é¢˜è§„æ¨¡ä¹‹é—´çš„å‡½æ•°\n\n1. O(1): æ²¡æœ‰å¾ªç¯ï¼Œæˆ–è€…æœ‰å¾ªç¯ä½†æ˜¯å¾ªç¯çš„é€€å‡ºæ¡ä»¶å’Œé—®é¢˜è§„æ¨¡ä¹‹é—´æ²¡æœ‰å…³ç³»ï¼›\n2. O(n): æœ‰å¾ªç¯ï¼Œå¾ªç¯çš„é€€å‡ºæ¡ä»¶ä¸é—®é¢˜è§„æ¨¡ä¹‹é—´å­˜åœ¨å…³ç³»ï¼Œå¹¶ä¸”æ§åˆ¶å¾ªç¯çš„å˜é‡ä»¥++æˆ–è€…--çš„æ–¹å¼æ‰§è¡Œ\n3. O(n^2): æœ‰å¾ªç¯ï¼ŒåµŒå¥—ä¸€å±‚ã€‚\n4. O(logn): æœ‰å¾ªç¯ï¼Œå¾ªç¯çš„é€€å‡ºæ¡ä»¶ä¸é—®é¢˜è§„æ¨¡ä¹‹é—´å­˜åœ¨å…³ç³»ï¼Œå¹¶ä¸”æ§åˆ¶å¾ªç¯çš„å˜é‡æ¯æ¬¡\\*2æˆ–/2çš„æ–¹å¼æ‰§è¡Œã€‚\n\n## ç©ºé—´å¤æ‚åº¦\n\nç®—æ³•æ‰€éœ€çš„é¢å¤–å­˜å‚¨ç©ºé—´ï¼ˆé™¤äº†å‡½æ•°æœ¬èº«è®¡ç®—ç”³è¯·çš„å†…å­˜å¤–ï¼‰ä¸é—®é¢˜è§„æ¨¡ä¹‹é—´çš„å…³ç³»ã€‚\n\n```c\nvoid Show(int arr[], int len)\n{\n    for(int i = 0;i<len;++i)\n    {\n        printf(\"%d \",arr[i]);\n    }\n}\n```\n\næ­¤å¤„ï¼Œå‡½æ•°å‚æ•°ä¸­çš„int arr[]å’Œint lenä¸æ˜¯é¢å¤–å­˜å‚¨ç©ºé—´ã€‚è€Œæ˜¯forå¾ªç¯ã€‚\n\n# çº¿æ€§è¡¨\n\n* å”¯ä¸€çš„å¤´ï¼ˆæ­¤å¤„çš„å¤´æŒ‡çš„æ˜¯ç¬¬ä¸€ä¸ªæœ‰æ•ˆèŠ‚ç‚¹ï¼‰ï¼Œå”¯ä¸€çš„å°¾ã€‚\n* é™¤äº†å¤´ï¼Œå‰©ä½™çš„èŠ‚ç‚¹éƒ½æœ‰å‰é©±ã€‚é™¤äº†å°¾ï¼Œå‰©ä½™çš„èŠ‚ç‚¹éƒ½æœ‰åç»§ã€‚\n\n## å®šé•¿é¡ºåºè¡¨\n\nç›¸å½“äºä¸€ä¸ªç‰¹æ®Šä½¿ç”¨çš„æ•°ç»„ã€‚\n\nä½†å­˜æ”¾æ•°æ®æ˜¯æŒ‰é¡ºåºæ¥å­˜çš„ï¼Œä¸èƒ½éšæ„ä½ç½®å­˜æ”¾ã€‚\n\n```c\n//sqlist.h\n#pragma once\t//é˜²æ­¢å¤´æ–‡ä»¶é‡å¤\ntypedef int ElemType;\ntypedef struct Sqlist\n{\n    ElemType arr[10];//èŠ‚ç‚¹\n    int length;//å½“å‰æœ‰æ•ˆæ•°æ®èŠ‚ç‚¹çš„ä¸ªæ•°\n}Sqlist,*PSqlist;\n//åˆå§‹åŒ–\nvoid Init_sqlist(PSqlist plist);\n//å¢åˆ æ”¹æŸ¥\n//æŒ‰ä½ç½®æ’å…¥ï¼ˆå¤´æ’ã€å°¾æ’ï¼‰\nbool Insert_Pos(PSqlist plist, int pos, int val);\n//åˆ é™¤ï¼šæŒ‰å€¼åˆ ã€æŒ‰ä½ç½®åˆ ï¼ˆåˆ é™¤è¿™ä¸ªå€¼ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼‰\nbool Del_val(PSqlist plist, int val);\nbool Del_pos(PSqlist plist, int pos);\n//æŸ¥æ‰¾å€¼ä¸ºvalçš„èŠ‚ç‚¹\nSqlist* FindNode(PSqlist plist, int val);\n//åˆ¤ç©º åˆ¤æ»¡\nbool IsEmpty(PSqlist plist);\nbool IsFull(PSqlist plist);\n//æ¸…ç©º\nvoid Clear(PSqlist plist);\n//é”€æ¯\nvoid Destory(PSplist plist);\n```\n\n```c\n#include<stdio.h>\n#include<assert.h>\n#include<stdlib.h>\n#include\"sqlist.h\"\n#include<string.h>\n//åˆå§‹åŒ–\nvoid Init_sqlist(PSqlist plist)\n{\n    assert(plist!=NULL);\n    memset(plist->arr,0,sizeof(arr));\n    plist->length = 0;\n}\n//å¢åˆ æ”¹æŸ¥\n//æŒ‰ä½ç½®æ’å…¥ï¼ˆå¤´æ’ã€å°¾æ’ï¼‰\nbool Insert_Pos(PSqlist plist, int pos, int val)\n{\n    assert(plist!=NULL);\n    if( pos<0 || pos > plist->length || IsFull(plist) )return false;\n    \n    //ç§»åŠ¨æ•°æ®\n    for(int i = plist->length-1; i>=pos ;i--)\n    {\n        //ä¸ä¼šè¶Šç•Œï¼Œå› ä¸ºå¦‚æœlengthä¸º10æ—¶ï¼Œä¸èƒ½è¿›å…¥æ­¤å¾ªç¯\n        plist->arr[i+1] = plist->arr[i];\n    }\n    //æ’ç©º\n    plist->arr[pos] = val;\n    //é•¿åº¦åŠ 1\n    plist->length++;\n    return true;\n}\n//å¤´æ’\nbool Push_Front(PSqlist plist, int val)\n{\n    assert(plist!=NULL);\n    return Insert_Pos(plist, 0, val);\n}\n//å°¾æ’\nbool Push_Back(PSqlist plist, int val)\n{\n    assert(plist!=NULL);\n    return Insert_Pos(plist, plist->length, val);\n}\n//åˆ é™¤ï¼šï¼ˆåˆ é™¤è¿™ä¸ªå€¼ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼‰\n//æŒ‰å€¼åˆ \nbool Del_val(PSqlist plist, int val)\n{\n    assert(plist!=NULL);\n    return Del_pos(plist, FindPos_withVal(plist, val) );\n}\n//æŒ‰ä½ç½®åˆ \nbool Del_pos(PSqlist plist, int pos)\n{\n    assert(plist!=NULL);\n    if( pos<0 || pos > plist->length || IsEmpty(plist) )return false;\n    //é•¿åº¦å‡1\n    plist->length--;\n    //ç§»åŠ¨æ•°æ®ï¼ˆç›¸å½“äºæ¸…é™¤äº†arr[pos]ï¼‰\n    for(int i = pos; i < plist->length-1 ;++i)//i < plist->length-1  å®¹æ˜“å‡ºé”™\n    {\n        plist->arr[i] = plist->arr[i+1];\n    }\n    return true;\n}\n//å¤´åˆ \nbool Pop_Front(PSqlist plist)\n{\n    assert(plist!=NULL);\n    Del_pos(plist, 0);\n}\n//å°¾åˆ \nbool Pop_Back(PSqlist plist)\n{\n    assert(plist!=NULL);\n    Del_pos(plist, plist->length);\n}\n//æŸ¥æ‰¾å€¼ä¸ºvalçš„èŠ‚ç‚¹\nint FindPos_withVal(PSqlist plist, int val)\n{\n    assert(plist!=NULL);\n    int pos = -1;\n    int i = 0;\n    while(i< plist->length && val!=plist->arr[i])\n    {\n        ++i;\n    }\n    if(i!=length)//åˆ™whileæ˜¯å› ä¸ºval==plist->arr[i]è·³å‡ºçš„ã€‚\n    {\n        pos = i;\n    }\n    return pos;\n}\n//åˆ¤ç©º åˆ¤æ»¡\nbool IsEmpty(PSqlist plist)\n{\n    return plist->length == 0;\n}\nbool IsFull(PSqlist plist)\n{\n    return plist->length == sizeof(plist->arr)/sizeof(plist->arr[0]);\n}\n//æ¸…ç©º\nvoid Clear(PSqlist plist)\n{\n    assert(plist!=NULL);\n    plist->length = 0;\n}\n//é”€æ¯\nvoid Destory(PSplist plist)\n{\n    assert(plist!=NULL);\n    Clear(plist);\n}\n```\n\n## ä¸å®šé•¿é¡ºåºè¡¨\n\n```c\n//sqlist.h\n#pragma once\t//é˜²æ­¢å¤´æ–‡ä»¶é‡å¤\ntypedef int ElemType;\n#define INIT_SIZE 10\ntypedef struct DSqlist\n{\n    ElemType* ar;//åŸºåœ°å€\n    int cursize;//å½“å‰æœ‰æ•ˆæ•°æ®èŠ‚ç‚¹çš„ä¸ªæ•°\n    int capacity;//å½“å‰æœ€é•¿å®¹é‡\n}DSqlist,*PDSqlist;\n//åˆå§‹åŒ–\nvoid Init_sqlist(PDSqlist plist);\n//å¢åˆ æ”¹æŸ¥\n//æŒ‰ä½ç½®æ’å…¥ï¼ˆå¤´æ’ã€å°¾æ’ï¼‰\nbool Insert_Pos(PDSqlist plist, int pos, int val);\n//å¤´æ’\nbool Push_Front(PDSqlist plist, int val);\n//å°¾æ’\nbool Push_Back(PDSqlist plist, int val);\n//åˆ é™¤ï¼šæŒ‰å€¼åˆ ã€æŒ‰ä½ç½®åˆ ï¼ˆåˆ é™¤è¿™ä¸ªå€¼ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼‰\nbool Del_val(PDSqlist plist, int val);\nbool Del_pos(PDSqlist plist, int pos);\n//å¤´åˆ \nbool Pop_Front(PDSqlist plist);\n//å°¾åˆ \nbool Pop_Back(PDSqlist plist);\n//æŸ¥æ‰¾å€¼ä¸ºvalçš„èŠ‚ç‚¹\nint FindPos_withVal(PDSqlist plist, int val);\n//åˆ¤ç©º åˆ¤æ»¡\nbool IsEmpty(PDSqlist plist);\nbool IsFull(PDSqlist plist);\n//æ¸…ç©º\nvoid Clear(PDSqlist plist);\n//é”€æ¯\nvoid Destory(PDSplist plist);\nvoid Inc(PDsqlist plist);\n```\n\n```c\nvoid Inc(PDsqlist plist)\n{\n    \n}\n```\n\n# å•é“¾è¡¨\n\n![image-20210902180653639](../../images/C%E8%AF%AD%E8%A8%80_%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/image-20210902180653639.png)\n\n\n\n![image-20210902181055988](../../images/C%E8%AF%AD%E8%A8%80_%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/image-20210902181055988.png)\n\n1. ç¬¬ä¸€ç§å¤§å‚ç¬”è¯•/é¢è¯•ä¸­å¸¸ç”¨ï¼Œä¸»è¦è€ƒå¯Ÿå¯¹è¾¹ç•Œæ¡ä»¶æ£€æµ‹çš„æŒæ¡åŠ›ï¼›\n   * ä¸å¸¦å¤´ç»“ç‚¹çš„é€†ç½®å’Œå¸¦å¤´ç»“ç‚¹çš„é€†ç½®éš¾åº¦ä¸ä¸€æ ·ã€‚\n2. ç¬¬äºŒç§å®é™…ç¼–ç¨‹ä¸­å¸¸ç”¨ï¼Œæ–¹ä¾¿å¥½ç”¨ï¼›\n3. ç¬¬ä¸‰ç§çš„å¾ªç¯æ— æ„ä¹‰ï¼Œå› ä¸ºåŠŸèƒ½å’Œå¤´æŒ‡é’ˆå·®ä¸å¤šã€‚\n4. ç¬¬å››ç§æ˜¯åŠ äº†ä¸€ä¸ªå°¾æŒ‡é’ˆï¼Œä½¿å°¾æ’ä¹Ÿå˜O(1)ï¼Œä½†ä»£ä»·æ˜¯éœ€è¦å¯¹å°¾æŒ‡é’ˆè¿›è¡Œå¯†åˆ‡ç»´æŠ¤ã€‚\n\n\n\n# é¢è¯•\n\n![image-20210904191948363](../../images/C%E8%AF%AD%E8%A8%80_%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/image-20210904191948363.png)\n","categories":["C","åŸºç¡€æ•°æ®ç»“æ„"]},{"title":"Cè¯­è¨€_ç¼–è¯‘å’Œé¢„å¤„ç†","url":"/C/Cè¯­è¨€_ç¼–è¯‘å’Œé¢„å¤„ç†/","content":"# å†…å®¹\n\næœ¬ç« ä¸»è¦è®²è§£äº†é¢„å¤„ç†çš„ä¸‰ç§æ–¹å¼ï¼šå®å®šä¹‰ã€æ–‡ä»¶åŒ…å«ã€æ¡ä»¶ç¼–è¯‘\n\n# å­¦ä¹ ç›®æ ‡\n\n1. æŒæ¡æ— å‚æ•°å®å®šä¹‰å’Œå¸¦å‚æ•°å®å®šä¹‰çš„ä½¿ç”¨æ–¹æ³•\n2. å­¦ä¼šä½¿ç”¨æ–‡ä»¶åŒ…å«\n3. ç†Ÿæ‚‰æ¡ä»¶ç¼–è¯‘æŒ‡ä»¤çš„ä½¿ç”¨æ–¹æ³•\n\né¢„å¤„ç†å‘½ä»¤çš„ä½œç”¨ä¸æ˜¯å®ç°ç¨‹åºçš„åŠŸèƒ½ï¼Œè€Œæ˜¯ç»™Cè¯­è¨€ç¼–è¯‘ç³»ç»Ÿæä¾›ä¿¡æ¯ï¼Œé€šçŸ¥Cç¼–è¯‘å™¨åœ¨å¯¹æºç¨‹åºè¿›è¡Œç¼–è¯‘ä¹‹å‰åº”è¯¥åšå“ªäº›é¢„å¤„ç†å·¥ä½œã€‚é¢„å¤„ç†æ˜¯æŒ‡åœ¨è¿›è¡Œç¼–è¯‘ä¹‹å‰æ‰€ä½œçš„å¤„ç†ï¼Œç”±é¢„å¤„ç†ç¨‹åºè´Ÿè´£å®Œæˆã€‚æ¥ä¸‹æ¥è¿˜è¦ç»è¿‡ç¼–è¯‘ã€é“¾æ¥ï¼Œæ‰èƒ½å˜æˆå¯æ‰§è¡Œç¨‹åºã€‚æœ¬ç« èŠ‚å°†ç»“åˆæ¡ˆä¾‹å¯¹ç¼–è¯‘å’Œé¢„å¤„ç†çš„ç›¸å…³çŸ¥è¯†è¿›è¡Œè¯¦ç»†è®²è§£ã€‚\n\n# æœ€ç®€å•çš„é¢„å¤„ç†-ä¸å¸¦å‚å®å®šä¹‰\n\n## æ¡ˆä¾‹æè¿°\n\nä¸ºäº†å¼•å…¥â€œé¢„å¤„ç†â€è¿™ä¸ªæ¦‚å¿µï¼Œæœ¬æ¡ˆä¾‹è¦æ±‚å°†çŸ©å½¢çš„é•¿å’Œå®½è®¾ç½®ä¸ºå®ï¼Œç„¶åå†æ±‚å‡ºçŸ©å½¢çš„é¢ç§¯ã€‚è¿™äº‹æœ€ç®€å•çš„é¢„å¤„ç†ã€‚\n\n## æ¡ˆä¾‹åˆ†æ\n\nå®å®šä¹‰æ˜¯é¢„å¤„ç†æœ€å¸¸ç”¨çš„åŠŸèƒ½ä¹‹ä¸€ï¼Œå®ƒç”¨äºå°†ä¸€ä¸ªæ ‡è¯†ç¬¦å®šä¹‰ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚è¿™æ ·ï¼Œåœ¨æºç¨‹åºè¢«ç¼–è¯‘å™¨å¤„ç†ä¹‹å‰ï¼Œé¢„å¤„ç†å™¨ä¼šå°†æ ‡è¯†ç¬¦æ›¿æ¢æˆå®šä¹‰çš„å­—ç¬¦ä¸²ã€‚æ ¹æ®æ˜¯å¦å¸¦å‚æ•°ï¼Œå¯ä»¥å°†å®å®šä¹‰åˆ†ä¸ºæ— å‚æ•°å®å®šä¹‰å’Œå¸¦å‚æ•°å®å®šä¹‰ã€‚æœ¬æ¡ˆä¾‹è¦å­¦ä¹ çš„æ˜¯ä¸å¸¦å‚æ•°çš„å®å®šä¹‰ã€‚\n\n## å¿…å¤‡çŸ¥è¯†\n\n### ä¸å¸¦å‚æ•°çš„å®å®šä¹‰\n\nåœ¨ç¨‹åºä¸­ï¼Œç»å¸¸ä¼šå®šä¹‰ä¸€äº›å¸¸é‡ï¼Œä¾‹å¦‚ï¼Œ3.14ã€\"ABC\"ã€‚å¦‚æœè¿™äº›å¸¸é‡åœ¨ç¨‹åºä¸­è¢«é¢‘ç¹ä½¿ç”¨ï¼Œéš¾å…ä¼šå‡ºç°ä¹¦å†™é”™è¯¯çš„æƒ…å†µã€‚ä¸ºäº†é¿å…ç¨‹åºä¹¦å†™é”™è¯¯ï¼Œå¯ä»¥ä½¿ç”¨ä¸å¸¦å‚æ•°çš„å®å®šä¹‰æ¥å®šä¹‰è¿™äº›å¸¸é‡ï¼Œå…¶è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š\n\n```c\n#define æ ‡è¯†ç¬¦ å­—ç¬¦ä¸²\n```\n\nåœ¨ä¸Šè¿°è¯­æ³•æ ¼å¼ä¸­ï¼Œ\"#define\"ç”¨äºæ ‡è¯†ä¸€ä¸ªå®å®šä¹‰ï¼Œ\"æ ‡è¯†ç¬¦\"æŒ‡çš„æ˜¯æ‰€å®šä¹‰çš„å®åï¼Œ\"å­—ç¬¦ä¸²\"æŒ‡çš„æ˜¯å®ä½“ï¼Œå®ƒå¯ä»¥æ˜¯å¸¸é‡ã€è¡¨è¾¾å¼ç­‰ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå®å®šä¹‰éœ€è¦æ”¾åœ¨æºç¨‹åºçš„å¼€å¤´ï¼Œå‡½æ•°å®šä¹‰ä¹‹å¤–ã€‚å®ƒçš„æœ‰æ•ˆèŒƒå›´æ˜¯ä»å®å®šä¹‰è¯­å¥å¼€å§‹åˆ°æºæ–‡ä»¶ç»“æŸã€‚ä¸€èˆ¬å®åéƒ½æ˜¯å¤§å†™å­—æ¯ï¼Œä»¥ä¾¿äºä¸å…¶ä»–çš„æ“ä½œç¬¦åŒºåˆ«ã€‚\n\n```c\n#define PI 3.141592\n```\n\n### `#undef`æŒ‡ä»¤å–æ¶ˆå®å®šä¹‰\n\nä¸#defineç›¸å¯¹ï¼Œè¿˜æœ‰#undefæŒ‡ä»¤ç”¨äºå–æ¶ˆå®å®šä¹‰ï¼Œå½“ä½¿ç”¨#defineå®šä¹‰äº†ä¸€ä¸ªå®ä¹‹åï¼Œå¦‚æœé¢„å¤„ç†å™¨åœ¨æ¥ä¸‹æ¥çš„æºä»£ç ä¸­çœ‹åˆ°äº†#undefæŒ‡ä»¤ï¼Œé‚£ä¹ˆ#undefåé¢çš„ä»£ç ä¸­è¿™ä¸ªå®å°†ä¼šå¤±æ•ˆï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºã€‚\n\n```c\n#include<stdio.h>\n#define PI 3.14\nint main()\n{\n    printf(\"%f\\n\",PI);\n#undef PI\n    printf(\"%f\\n\",PI);\n    return 0;\n}\n```\n\nè¿è¡Œè¿™æ®µç¨‹åºï¼Œä¼šæŠ¥é”™\n\n```c\nIntelliSense: æœªå®šä¹‰æ ‡è¯†ç¬¦ \"PI\"\t\t//7è¡Œ17åˆ—\nerror C2065: \"PI\": æœªå£°æ˜çš„æ ‡è¯†ç¬¦\t   //7è¡Œ1åˆ—\n```\n\n# ç¬¬äºŒç®€å•çš„é¢„å¤„ç†-å¸¦å‚å®å®šä¹‰\n\n## æ¡ˆä¾‹æè¿°\n\nåœ¨ä¹‹å‰çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»å­¦è¿‡ç®€å•çš„æ•°æ®äº¤æ¢ã€‚æœ¬æ¡ˆä¾‹è¦æ±‚ä½¿ç”¨å®å®šä¹‰ï¼Œä¾æ¬¡äº¤æ¢ä¸¤ä¸ªä¸€ç»´æ•°ç»„ä¸­çš„å…ƒç´ ã€‚\n\n## æ¡ˆä¾‹åˆ†æ\n\næœ¬æ¡ˆä¾‹è¦å®ç°ä¸¤ä¸ªä¸€ç»´æ•°ç»„ä¸­å…ƒç´ çš„ä¾æ¬¡äº¤æ¢ï¼Œæ•´ä¸ªäº¤æ¢è¿‡ç¨‹åŒ…å«å¤šæ¬¡æ•°ç»„å…ƒç´ çš„äº¤æ¢ã€‚ç»“åˆä¹‹å‰å­¦ä¹ çš„çŸ¥è¯†ï¼Œå¯ä»¥ä½¿ç”¨å‡½æ•°å®ç°ç®€å•çš„æ•°æ®äº¤æ¢åŠŸèƒ½ï¼Œåœ¨ä½¿ç”¨å¾ªç¯éå†æ•°ç»„çš„åŒæ—¶ï¼Œè°ƒç”¨äº¤æ¢å‡½æ•°ï¼Œå®ç°æ•°ç»„å…ƒç´ çš„äº¤æ¢ã€‚æœ¬æ¡ˆä¾‹è¦æ±‚ä½¿ç”¨å®å®šä¹‰å®ç°æ­¤åŠŸèƒ½ã€‚\n\nå› ä¸ºæ•°ç»„éå†çš„è¿‡ç¨‹ä¸­ï¼Œæ•°æ®åœ¨ä¸æ–­æ”¹å˜ï¼Œè€Œä¸å¸¦å‚å®å®šä¹‰ä¸­åªèƒ½å®šä¹‰å›ºå®šçš„å†…å®¹ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ç¬¬äºŒç®€å•çš„é¢„å¤„ç†æ–¹æ³•â€”â€”å¸¦å‚å®å®šä¹‰æ¥å®Œæˆæœ¬æ¡ˆä¾‹ã€‚\n\n## å¿…å¤‡çŸ¥è¯†\n\n### å¸¦å‚æ•°çš„å®å®šä¹‰\n\nè¯­æ³•æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```c\n#define æ ‡è¯†ç¬¦(å½¢å‚è¡¨) å­—ç¬¦ä¸²\n```\n\nä¸Šè¿°è¯­æ³•æ ¼å¼å’Œä¸å¸¦å‚æ•°çš„å®å®šä¹‰æœ‰äº›ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯å¤šäº†ä¸€ä¸ªæ‹¬å·ï¼Œæ‹¬å·ä¸­çš„â€œå½¢å‚è¡¨â€ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå½¢å‚ç»„æˆï¼Œå½“å¤šäºä¸€ä¸ªå½¢å‚æ—¶ï¼Œå½¢å‚ä¹‹é—´è¦ç”¨é€—å·è¿›è¡Œåˆ†éš”ã€‚\n\nå¯¹äºå¸¦å‚æ•°çš„å®å®šä¹‰æ¥è¯´ï¼ŒåŒæ ·éœ€è¦ä½¿ç”¨å­—ç¬¦ä¸²æ›¿æ¢å®åï¼Œä½¿ç”¨å®å‚æ›¿æ¢å½¢å‚ã€‚\n\n### ä¸å¸¦å‚å‡½æ•°çš„åŒºåˆ«\n\nå¸¦å‚å®å®šä¹‰å’Œå¸¦å‚å‡½æ•°æœ‰æ—¶å¯ä»¥å®ç°åŒæ ·çš„åŠŸèƒ½ï¼Œä½†ä¸¤è€…æœ‰æœ¬è´¨çš„ä¸åŒï¼Œå…·ä½“å¦‚è¡¨æ‰€ç¤ºã€‚\n\n| åŸºæœ¬æ“ä½œ     | å¸¦å‚æ•°çš„å®å®šä¹‰             | å¸¦å‚æ•°çš„å‡½æ•°                                                 |\n| ------------ | -------------------------- | ------------------------------------------------------------ |\n| å¤„ç†æ—¶é—´èŠ‚ç‚¹ | é¢„å¤„ç†æ—¶                   | ç¨‹åºè¿è¡Œæ—¶                                                   |\n| å‚æ•°ç±»å‹     | æ—                          | éœ€å®šä¹‰å‚æ•°ç±»å‹                                               |\n| å‚æ•°ä¼ é€’     | ä¸åˆ†é…å†…å­˜ï¼Œæ— å€¼ä¼ é€’çš„é—®é¢˜ | åˆ†é…å†…å­˜ï¼Œå°†å®å‚å€¼ä»£å…¥å½¢å‚                                   |\n| è¿è¡Œé€Ÿåº¦     | å¿«                         | ç›¸å¯¹è¾ƒæ…¢ï¼Œå› ä¸ºå‡½æ•°çš„è°ƒç”¨ä¼šæ¶‰åŠåˆ°å‚æ•°çš„ä¼ é€’ã€å‹æ ˆã€å‡ºæ ˆç­‰æ“ä½œ |\n\n## åŠ¡å¿…è¦æ³¨æ„çš„é—®é¢˜\n\næ¥çœ‹ä¸€ä¸ªä¾‹å­\n\n```c\n#define ABS(x) ((x)>=0 ? (x): -(x))\n```\n\nè¿™æ˜¯ä¸€ä¸ªæ±‚ç»å¯¹å€¼çš„å¸¦å‚å®å®šä¹‰ï¼Œè°ƒç”¨è¿™ä¸ªå®å®šä¹‰ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```c\ndouble x = 12;\nprintf(\"%d \\n\",ABS(++x));\n```\n\nè¾“å‡ºçš„ç»“æœæ˜¯14ï¼Œæ˜¾ç„¶ä¸æˆ‘ä»¬çš„åˆæ„ä¸­çš„12ä¸ç›¸ç¬¦ã€‚è¿™æ˜¯å› ä¸ºåœ¨é¢„å¤„ç†æ—¶ï¼Œè¡¨è¾¾å¼\"ABS(++x)\"ä¼šè¢«æ›¿æ¢ä¸º\"( (++x)>=0 ? (++x): -(++x) ) \"ï¼Œå› æ­¤ç»“æœæ˜¯14ã€‚\n\né‚£ä¹ˆï¼Œè¿™å°±æ˜¯å¸¦å‚å®å®šä¹‰æ—¶è¦æ³¨æ„çš„é—®é¢˜ï¼Œ**å®å®šä¹‰ä¸­çš„å‚æ•°æ›¿æ¢æ˜¯â€œæ•´ä½“â€æ›¿æ¢**ï¼Œä¸åƒæ˜¯å‡½æ•°ä¸­åªæ˜¯å‚æ•°ä¹‹é—´çš„å€¼ä¼ é€’ã€‚\n\n## æ¡ˆä¾‹å®ç°\n\n```c\n#include<stdio.h>\n#define SWAP(a,b) {int temp = a; a=b; b=temp;}\nint main()\n{\n    int i,j;\n    int a[5]={3,4,5,6,7};\n    int b[5]={5,6,7,8,9};\n    for(int i = 0;i<5;i++)\n    {\n        SWAP(a[i],b[i]);\n    }\n    printf(\"After swaping:\\n\");\n    for(int i = 0;i<5;i++)\n    {\n        printf(\"%d \",a[i]);\n    }\n    printf(\"\\n\");\n    for(int i = 0;i<5;i++)\n    {\n        printf(\"%d \",b[i]);\n    }\n    printf(\"\\n\");\n    return 0;\n}\n//è¿è¡Œç»“æœï¼š\nAfter swaping\n5 6 7 8 9\n3 4 5 6 7\n```\n\n## å…³äºå®å®šä¹‰ä¸­å‚æ•°çš„æ›¿æ¢-è¦æ³¨æ„çš„é—®é¢˜\n\n### è¡¨è¾¾å¼å­—ç¬¦ä¸²ä¸­å‡ºç°è¿ç®—ç¬¦\n\nè‹¥å®å®šä¹‰ä¸­çš„å­—ç¬¦ä¸²å‡ºç°è¿ç®—ç¬¦ï¼Œéœ€è¦åœ¨åˆé€‚çš„ä½ç½®ä¸ŠåŠ ä¸Šæ‹¬å·ï¼Œå¦‚æœä¸æ·»åŠ æ‹¬å·å¯èƒ½ä¼šå‡ºç°é”™è¯¯ã€‚ä¾‹å¦‚\n\n```c\n#define S 3+4\nint c = 100;\nint a = S*c\t\t//3+4*c == 403 è€Œé 7*c ==700\n```\n\n### å®å®šä¹‰çš„æœ«å°¾ä¸è¦åŠ åˆ†å·\n\nå¦‚æœåŠ äº†åˆ†å·ï¼Œå°†è¢«è§†ä¸ºè¢«æ›¿æ¢å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ã€‚\n\nå®å®šä¹‰ä¸ä¼šè¿›è¡Œä¸¥æ ¼çš„è¯­æ³•æ£€æŸ¥ï¼Œå› æ­¤å®æ›¿æ¢çš„é”™è¯¯è¦ç­‰åˆ°ç³»ç»Ÿç¼–è¯‘æ—¶æ‰èƒ½è¢«å‘ç°ï¼Œä¾‹å¦‚ï¼š\n\n```c\n#define Max=20;\n....\nif(result == Max)\t//if(result==20;)\n{\n    printf(\"equal\");\n}\n//æ˜¾ç„¶ifè¯­å¥ä¼šå‡ºé”™\n```\n\n### å®å®šä¹‰å…è®¸åµŒå¥—\n\nåœ¨å®å®šä¹‰çš„å­—ç¬¦ä¸²ä¸­å¯ä»¥ä½¿ç”¨å·²ç»å®šä¹‰çš„å®åã€‚\n\n```c\n#define PI 3.141592\n#define P PI*x\nprintf(\"%f\",P);\t\t//æ›¿æ¢åçš„è¯­å¥ä¸ºprintf(\"%f\",3.141592*x);\n```\n\nä½†å®å®šä¹‰ä¸æ”¯æŒé€’å½’ï¼Œå› æ­¤ä¸‹é¢çš„å®å®šä¹‰æ˜¯é”™è¯¯çš„ï¼š\n\n```c\n#define Max Max+5\n```\n\n# é¢„å¤„ç†çš„ç¬¬äºŒç§æ–¹å¼-æ–‡ä»¶åŒ…å«\n\n## æ¡ˆä¾‹æè¿°\n\nè¦æ±‚è®¾è®¡ä¸€ä¸ªå¤´æ–‡ä»¶ï¼Œå°†ç»å¸¸ä½¿ç”¨çš„è¾“å‡ºæ¨¡å¼éƒ½å†™è¿›å¤´æ–‡ä»¶ä¸­ï¼Œæ–¹ä¾¿ç¼–å†™ä»£ç ã€‚\n\n## æ¡ˆä¾‹åˆ†æ\n\né™¤å®å®šä¹‰å¤–ï¼Œæ–‡ä»¶åŒ…å«ä¹Ÿæ˜¯ä¸€ç§é¢„å¤„ç†è¯­å¥ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯å°†ä¸€ä¸ªæºç¨‹åºæ–‡ä»¶åŒ…å«åˆ°å¦å¤–ä¸€ä¸ªæºç¨‹åºæ–‡ä»¶ä¸­ã€‚\n\n## å¿…å¤‡çŸ¥è¯†\n\n### æ–‡ä»¶åŒ…å«å‘½ä»¤çš„å½¢å¼\n\nåŒå¼•å…¥å¤´æ–‡ä»¶ä¸€æ ·ï¼Œæ–‡ä»¶åŒ…å«ä¹Ÿæ˜¯ä½¿ç”¨#includeæŒ‡ä»¤å®ç°çš„ï¼Œå®ƒçš„è¯­æ³•æ ¼å¼æœ‰ä¸¤ç§ï¼Œå…·ä½“å¦‚ä¸‹\n\n#### æ ¼å¼ä¸€\n\n```c\n#include <æ–‡ä»¶å>\n```\n\n#### æ ¼å¼äºŒ\n\n```c\n#include \"æ–‡ä»¶åâ€œ\n```\n\n#### åŒºåˆ«\n\nä¸Šè¿°ä¸¤ç§æ ¼å¼éƒ½å¯ä»¥å®ç°æ–‡ä»¶åŒ…å«ï¼Œä¸åŒçš„æ˜¯ï¼Œ**æ ¼å¼ä¸€æ˜¯æ ‡å‡†å½¢å¼ï¼Œå½“ä½¿ç”¨è¿™ç§æ ¼å¼æ—¶ï¼ŒCç¼–è¯‘ç³»ç»Ÿåœ¨ç³»ç»ŸæŒ‡å®šçš„è·¯å¾„ä¸‹æœç´¢å°–æ‹¬å·(<>)ä¸­çš„æ–‡ä»¶**ï¼›å½“ä½¿ç”¨**ç¬¬äºŒç§æ ¼å¼æ—¶ï¼Œç³»ç»Ÿé¦–å…ˆä¼šåœ¨ç”¨æˆ·å½“å‰å·¥ä½œçš„ç›®å½•ä¸­æœç´¢åŒå¼•å·(\"\")ä¸­çš„æ–‡ä»¶ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œå†æŒ‰ç³»ç»ŸæŒ‡å®šçš„è·¯å¾„è¿›è¡Œæœç´¢ã€‚**\n\n## æ¡ˆä¾‹å®ç°\n\nfoo.hä»£ç å¦‚ä¸‹ï¼š\n\n```c\n#define INT(x) printf(\"%d\\n\",x)\n```\n\nmain.cä»£ç å¦‚ä¸‹ï¼š\n\n```c\n#include <stdio.h>\n#include \"foo.h\"\nint main()\n{\n    int a;\n    printf(\"Please input an integer:\\n\");\n    scanf(\"%d\",&a);\n    INT(a);\t\t//æ›¿æ¢ä¸º\"printf(\"%d\\n\",a)\" + \";\"\n    return 0;\n}\n```\n\n# 32è¿˜æ˜¯64-æ¡ä»¶ç¼–è¯‘\n\n## æ¡ˆä¾‹æè¿°\n\nè¦æ±‚ä½¿ç”¨æ¡ä»¶ç¼–è¯‘ï¼Œæ ¹æ®æ¡ä»¶è¾“å‡ºå¯¹åº”çš„åˆ¤å®šç»“æœï¼šå¦‚æœç³»ç»Ÿæ˜¯32ä½çš„ï¼Œå°±è¾“å‡ºâ€œç³»ç»Ÿæ˜¯32ä½çš„â€ï¼›å¦‚æœç³»ç»Ÿæ˜¯64ä½çš„ï¼Œå°±è¾“å‡ºâ€œç³»ç»Ÿæ˜¯64ä½çš„â€ã€‚\n\n## æ¡ˆä¾‹åˆ†æ\n\nä¸Šæ–‡æåˆ°çš„â€œæ¡ä»¶ç¼–è¯‘â€ä¹Ÿæ˜¯é¢„å¤„ç†çš„ä¸€ç§æ–¹å¼ã€‚\n\nä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒCè¯­è¨€ç¨‹åºä¸­çš„æ‰€æœ‰ä»£ç éƒ½è¦å‚ä¸ç¼–è¯‘ï¼Œä½†æœ‰æ—¶å‡ºäºç¨‹åºä»£ç ä¼˜åŒ–çš„è€ƒè™‘ï¼Œå¸Œæœ›æºä»£ç ä¸­ä¸€éƒ¨åˆ†å†…å®¹åªåœ¨æŒ‡å®šæ¡ä»¶ä¸‹è¿›è¡Œç¼–è¯‘ã€‚è¿™ç§æ ¹æ®æŒ‡å®šæ¡ä»¶ï¼Œåªå¯¹ç¨‹åºä¸€éƒ¨åˆ†å†…å®¹ç¼–è¯‘çš„æƒ…å†µï¼Œç§°ä¸ºæ¡ä»¶ç¼–è¯‘ã€‚\n\nåœ¨Cè¯­è¨€ä¸­æ¡ä»¶ç¼–è¯‘æŒ‡ä»¤çš„å½¢å¼æœ‰å¾ˆå¤šç§ï¼Œæ¥ä¸‹æ¥å°†è¯¦ç»†è®²è§£ä¸€ç§æœ€å¸¸è§çš„æ¡ä»¶ç¼–è¯‘æŒ‡ä»¤ï¼š#if/#else/#endifï¼Œè¯¥æŒ‡ä»¤æ ¹æ®å¸¸æ•°è¡¨è¾¾å¼æ¥å†³å®šæŸæ®µä»£ç æ˜¯å¦æ‰§è¡Œã€‚\n\n## å¿…å¤‡çŸ¥è¯†\n\n### #if/#else/#endifæŒ‡ä»¤\n\né€šå¸¸æƒ…å†µä¸‹ï¼Œ#ifæŒ‡ä»¤ã€#elseæŒ‡ä»¤å’Œ#endifæŒ‡ä»¤æ˜¯ç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨çš„ï¼Œå…¶è¯­æ³•æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```c\n#if åˆ¤æ–­è¡¨è¾¾å¼\n\tç¨‹åºæ®µ\n#else\n    ç¨‹åºæ®µ2\n#endif\n```\n\nåœ¨ä¸Šè¿°è¯­æ³•æ ¼å¼ä¸­ï¼Œç¼–è¯‘å™¨åªä¼šç¼–è¯‘ç¨‹åºæ®µ1å’Œç¨‹åºæ®µ2ä¸­çš„ä¸€æ®µã€‚å½“æ¡ä»¶ä¸ºçœŸæ—¶ï¼Œç¼–è¯‘å™¨ä¼šç¼–è¯‘ç¨‹åºæ®µ1ï¼Œå¦åˆ™ç¼–è¯‘ç¨‹åºæ®µ2ã€‚\n\n## æ¡ˆä¾‹å®ç°\n\n### æ¡ˆä¾‹è®¾è®¡\n\n1. å®šä¹‰ä¸¤ä¸ªå®ï¼Œåˆ†åˆ«è¡¨ç¤ºWindows32ä½å’Œ64ä½å¹³å°ï¼›\n2. å®šä¹‰å®SYSTEMè¡¨ç¤ºå…¶ä¸­æŸä¸ªå¹³å°ï¼›\n3. ä½¿ç”¨æ¡ä»¶ç¼–è¯‘æŒ‡ä»¤åˆ¤æ–­SYSTEMå€¼ï¼Œå¹¶è¾“å‡ºç»“æœåˆ°å±å¹•ä¸Šã€‚\n\n### å®Œæ•´ä»£ç \n\n```c\n#include <stdio.h>\n#define Win32 0\n#define x64 1\n#define SYSTEM Win32\t\t//å®šä¹‰å®SYSTEMæ˜¯32ä½çš„\nint main()\n{\n#if SYSTEM == Win32\t\t\t//æ­¤å¤„æ¡ä»¶æˆç«‹\n    printf(\"Win32\\n\");\n#else\n    printf(\"x64\");\n#endif\n    return 0;\n}\n//æ‰§è¡Œprintf(\"Win32\\n\");\nè¿è¡Œç»“æœä¸º Win32\n```\n\n# #ifdef-ç¥å¥‡çš„#include<stdio.h>\n\n## æ¡ˆä¾‹æè¿°\n\nåœ¨åŒä¸€æ–‡ä»¶ä¸­å†™ä¸¤é\"#include\\<stdio.h\\>\"ï¼Œç¼–è¯‘å™¨è¿›è¡Œç¼–è¯‘æ—¶ä¸ºä»€ä¹ˆæ²¡æœ‰æŠ¥é”™å‘¢ï¼ŸæŒ‰å¸¸ç†è€Œè¨€ï¼Œæ–‡ä»¶\"stdio.h\"ä¸­çš„å‡½æ•°å’Œæ•°æ®ç±»å‹ç­‰å¿…ç„¶è¢«å®šä¹‰äº†ä¸¤æ¬¡ï¼Œæ­¤æ—¶ç¼–è¯‘å™¨åº”è¯¥æŠ¥å‡º\"é‡å®šä¹‰\"çš„é”™è¯¯ï¼Œä½†å®é™…ä¸Šç¼–è¯‘ååˆ†é¡ºåˆ©ã€‚\n\n## æ¡ˆä¾‹åˆ†æ\n\nåœ¨ä¸Šä¸€ä¸ªæ¡ˆä¾‹ä¸­æˆ‘ä»¬æåˆ°Cè¯­è¨€ä¸­æ¡ä»¶ç¼–è¯‘æŒ‡ä»¤çš„å½¢å¼æœ‰å¾ˆå¤šç§ï¼Œå¦‚æœç°åœ¨çš„ä½ ç™¾æ€ä¸å¾—å…¶è§£ï¼Œé‚£æ˜¯å› ä¸ºä½ æ²¡æœ‰å­¦è¿‡å¦ä¸€ç§æ¡ä»¶ç¼–è¯‘æŒ‡ä»¤ï¼š#ifdefå’Œ#ifndefã€‚ä¸‹é¢æ¥è®²è§£ã€‚\n\n## å¿…å¤‡çŸ¥è¯†\n\n### #ifdefæŒ‡ä»¤\n\nå¦‚æœæƒ³åˆ¤æ–­æŸä¸ªå®æ˜¯å¦è¢«å®šä¹‰ï¼Œå¯ä»¥ä½¿ç”¨#ifdefæŒ‡ä»¤ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œè¯¥æŒ‡ä»¤éœ€è¦å’Œ#endifä¸€èµ·ä½¿ç”¨ï¼Œ#ifdefæŒ‡ä»¤çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```c\n#ifdef å®å\n\tç¨‹åºæ®µ1\n#else\n    ç¨‹åºæ®µ2\n#endif\n```\n\nåœ¨ä¸Šè¿°è¯­æ³•æ ¼å¼ä¸­ï¼Œ#ifdefæŒ‡ä»¤ç”¨äºæ§åˆ¶å•ç‹¬çš„ä¸€æ®µæºç æ˜¯å¦éœ€è¦ç¼–è¯‘ï¼Œå®ƒçš„åŠŸèƒ½ç±»ä¼¼äºä¸€ä¸ªå•ç‹¬çš„#if/#endif\n\n### #ifndefæŒ‡ä»¤\n\nå’Œ#ifdefç›¸åï¼Œ#ifdefç”¨æ¥ç¡®å®šæŸä¸€ä¸ªå®æ˜¯å¦æ²¡æœ‰è¢«å®šä¹‰ï¼Œå¦‚æœå®æ²¡æœ‰è¢«å®šä¹‰ï¼Œé‚£ä¹ˆå°±ç¼–è¯‘#ifndefå’Œ#endifä¸­é—´çš„å†…å®¹ï¼Œå¦åˆ™å°±è·³è¿‡ã€‚å…¶è¯­æ³•æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```c\n#ifndef å®å\n    ç¨‹åºæ®µ1\n#else\n    ç¨‹åºæ®µ2\n#endif\n```\n\n## æ¡ˆä¾‹å®ç°\n\nå¦‚æœæˆ‘ä»¬æ‰“å¼€\"stdio.h\"è¿™ä¸ªæ–‡ä»¶ï¼Œä¾¿ä¼šå‘ç°å…¶å¼€å¤´æ˜¯è¿™æ ·çš„ä¸¤è¡Œä»£ç ã€‚\n\n```c\n#ifndef _STDIO_H_\n#define _STDIO_H_\n```\n\nåœ¨å…¶ç»“å°¾æœ‰è¿™æ ·ä¸€è¡Œä»£ç ï¼š\n\n```c\n#endif /* _STDIO_H_ */\n```\n\nè¿™ä¸‰è¡Œä»£ç æ˜¯ä¸‰æ¡é¢„å¤„ç†æŒ‡ä»¤ï¼Œä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå†™ä¸¤é\"#include<stdio.h>\"ä¹Ÿä¸ä¼šæŠ¥é”™ã€‚å½“ç„¶ï¼Œå†™æ›´å¤šéä¹Ÿä¸ä¼šæŠ¥é”™ã€‚\n\nè¿™ä¸‰è¡Œä»£ç çš„å«ä¹‰æ˜¯ï¼šå¦‚æœ\"\\_STDIO\\_H\\_\"æ²¡æœ‰å®šä¹‰è¿‡ï¼Œé‚£ä¹ˆå°±å®šä¹‰\"\\_STDIO\\_H\\_\"ã€‚ä»”ç»†è§‚å¯Ÿåæˆ‘ä»¬ä¼šå‘ç°**\"#define \\_STDIO\\_H\\_\"åé¢ä»€ä¹ˆéƒ½æ²¡å†™ï¼Œå…¶å®è¿™ä¹Ÿæ˜¯å®å®šä¹‰çš„ä¸€ç§å†™æ³•â€”â€”å¹¶ä¸å…³æ³¨\"\\_STDIO\\_H\\_\"è¢«å®šä¹‰æˆäº†ä»€ä¹ˆï¼Œåªå…³æ³¨ä»–æ˜¯å¦è¢«å®šä¹‰è¿‡ã€‚**\n\nç»¼ä¸Šåˆ†æå¯çŸ¥ï¼Œåˆæ¬¡é‡åˆ°\"\\_STDIO\\_H\\_\"çš„æ—¶å€™ï¼Œç”±äºå®\"\\_STDIO\\_H\\_\"å°šæœªå®šä¹‰ï¼Œå› æ­¤ï¼Œ#ifndefæ¡ä»¶æˆç«‹ï¼Œå®šä¹‰\"\\_STDIO\\_H\\_\"ã€‚å½“å†æ¬¡é‡åˆ°\"\\_STDIO\\_H\\_\"çš„æ—¶å€™ï¼Œ#ifndefçš„æ¡ä»¶ä¸æˆç«‹ï¼Œå› æ­¤å®ƒä¸\"#endif\"ä¹‹é—´çš„å†…å®¹å°±ä¸ä¼šè¢«ç¼–è¯‘äº†ã€‚\n\n## åˆ©ç”¨é¢„å®šä¹‰å®å¾—çŸ¥ç¨‹åºå…è®¸åˆ°äº†ä½•å¤„\n\nä¸‹é¢æ˜¯\\<stdio.h\\>å¤´æ–‡ä»¶ä¸­çš„äº”ä¸ªé¢„å®šä¹‰å®ï¼Œåˆ©ç”¨è¿™äº›å®å¯ä»¥è½»æ¾å¾—çŸ¥ç¨‹åºè¿è¡Œåˆ°äº†ä½•å¤„ï¼Œæœ‰åŠ©äºç¼–ç¨‹äººå‘˜è¿›è¡Œç¨‹åºè°ƒè¯•ï¼Œå…·ä½“å¦‚ä¸‹è¡¨ã€‚\n\n| é¢„å®šä¹‰å®     | è¯´æ˜                   |\n| ------------ | ---------------------- |\n| \\_DATE\\_     | å®šä¹‰æºæ–‡ä»¶ç¼–è¯‘æ—¥æœŸçš„å® |\n| \\_FILE\\_     | å®šä¹‰æºä»£ç æ–‡ä»¶åçš„å®   |\n| \\_LINE\\_     | å®šä¹‰æºä»£ç ä¸­è¡Œå·çš„å®   |\n| \\_TIME\\_     | å®šä¹‰æºä»£ç ç¼–è¯‘æ—¶é—´çš„å® |\n| \\_FUNCTION\\_ | å®šä¹‰å½“å‰æ‰€åœ¨å‡½æ•°åçš„å® |\n\n","categories":["C"]},{"title":"Cè¯­è¨€_é“¾è¡¨","url":"/C/Cè¯­è¨€_é“¾è¡¨å…¥é—¨/","content":"# å•é“¾è¡¨\n\n## ä¸å¸¦å¤´\n\n```c\ntypedef int ElemType;\ntypedef struct ListNode\n{\n    ElemType data;\n    struct ListNode* next;\n}ListNode;\ntypedef struct\n{\n\tListNode* first;\n\tint cursize;\n}LinkList;\n//1.åˆå§‹åŒ–\nvoid InitList(LinkList* plist);\n//2.æ¸…ç©ºé“¾è¡¨\nvoid ClearList(LinkList* plist);\n//3.é”€æ¯é“¾è¡¨\nvoid DestroyList(LinkList* plist);\n//4.è·å–é“¾è¡¨çš„æ•°æ®å…ƒç´ çš„ä¸ªæ•°\nint GetSize(const LinkList* plist);\n//5.é“¾è¡¨åˆ¤ç©º\nbool IsEmpty(const LinkList* plist);\n//6.åœ¨ptræŒ‡é’ˆä¹‹åæ’å…¥æ•°æ®å…ƒç´ \nbool Insert_Next(LinkList* plist, ListNode* ptr, ElemType val);\n//7.å¤´æ’æ•°æ®å…ƒç´ \nvoid Push_Front(LinkList* plist, ElemType val);\n//8.å°¾æ’æ•°æ®å…ƒç´ \nvoid Push_Back(LinkList* plist, ElemType val);\n//9.åˆ é™¤ptræ‰€æŒ‡å‘çš„åç»­ç»“ç‚¹ï¼ˆæ•°æ®å…ƒç´ ï¼‰\nbool Erase_Next(LinkList* plist, ListNode* ptr);\n//10.åˆ é™¤ç¬¬ä¸€ä¸ªæ•°æ®ç»“ç‚¹\nvoid Pop_Front(LinkList* plist);\n//11.åˆ é™¤å°¾éƒ¨æ•°æ®èŠ‚ç‚¹\nvoid Pop_Back(LinkList* plist);\n//12.åˆ é™¤ä¸valå€¼ç›¸ç­‰çš„æ•°æ®èŠ‚ç‚¹\nvoid Remove(LinkList* plist, ElemType val);\n//13.åˆ é™¤ä¸valå€¼ç›¸ç­‰çš„æ‰€æœ‰æ•°æ®èŠ‚ç‚¹\nvoid Remove_All(LinkList* plist, ElemType val);\n//14.æ‰“å°é“¾è¡¨ä¸­çš„æ•°æ®å…ƒç´ \nvoid PrintList(const LinkList* plist);\n//15.è¿”å›ä¸valå€¼ç›¸ç­‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹æŒ‡é’ˆ\nListNode* FindValue_pre(const LinkList* plist, ElemType val);\n//16.è¿”å›ä¸valå€¼ç›¸ç­‰èŠ‚ç‚¹æŒ‡é’ˆ\nListNode* FindValue(const LinkList* plist, ElemType val);\n//17.è¿”å›posä½ç½®çš„å‰é©±èŠ‚ç‚¹æŒ‡é’ˆ\nListNode* FindPos_pre(const LinkList* plist, int pos);\n//18.è¿”å›posä½ç½®çš„èŠ‚ç‚¹æŒ‡é’ˆ\nListNode* FindPos(const LinkList* plist, int pos);\n```\n\n```c\n//1.åˆå§‹åŒ–\nvoid InitList(LinkList* plist);\n//2.æ¸…ç©ºé“¾è¡¨\nvoid ClearList(LinkList* plist);\n//3.é”€æ¯é“¾è¡¨\nvoid DestroyList(LinkList* plist);\n//4.è·å–é“¾è¡¨çš„æ•°æ®å…ƒç´ çš„ä¸ªæ•°\nint GetSize(const LinkList* plist);\n//5.é“¾è¡¨åˆ¤ç©º\nbool IsEmpty(const LinkList* plist);\n//6.åœ¨ptræŒ‡é’ˆä¹‹åæ’å…¥æ•°æ®å…ƒç´ \nbool Insert_Next(LinkList* plist, ListNode* ptr, ElemType val);\n//7.å¤´æ’æ•°æ®å…ƒç´ \nvoid Push_Front(LinkList* plist, ElemType val);\n//8.å°¾æ’æ•°æ®å…ƒç´ \nvoid Push_Back(LinkList* plist, ElemType val);\n//9.åˆ é™¤ptræ‰€æŒ‡å‘çš„åç»­ç»“ç‚¹ï¼ˆæ•°æ®å…ƒç´ ï¼‰\nbool Erase_Next(LinkList* plist, ListNode* ptr);\n//10.åˆ é™¤ç¬¬ä¸€ä¸ªæ•°æ®ç»“ç‚¹\nvoid Pop_Front(LinkList* plist);\n//11.åˆ é™¤å°¾éƒ¨æ•°æ®èŠ‚ç‚¹\nvoid Pop_Back(LinkList* plist);\n//12.åˆ é™¤ä¸valå€¼ç›¸ç­‰çš„æ•°æ®èŠ‚ç‚¹\nvoid Remove(LinkList* plist, ElemType val);\n//13.åˆ é™¤ä¸valå€¼ç›¸ç­‰çš„æ‰€æœ‰æ•°æ®èŠ‚ç‚¹\nvoid Remove_All(LinkList* plist, ElemType val);\n//14.æ‰“å°é“¾è¡¨ä¸­çš„æ•°æ®å…ƒç´ \nvoid PrintList(const LinkList* plist);\n//15.è¿”å›ä¸valå€¼ç›¸ç­‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹æŒ‡é’ˆ\nListNode* FindValue_pre(const LinkList* plist, ElemType val);\n//16.è¿”å›ä¸valå€¼ç›¸ç­‰èŠ‚ç‚¹æŒ‡é’ˆ\nListNode* FindValue(const LinkList* plist, ElemType val);\n//17.è¿”å›posä½ç½®çš„å‰é©±èŠ‚ç‚¹æŒ‡é’ˆ\nListNode* FindPos_pre(const LinkList* plist, int pos);\n//18.è¿”å›posä½ç½®çš„èŠ‚ç‚¹æŒ‡é’ˆ\nListNode* FindPos(const LinkList* plist, int pos);\n```\n\n","tags":["tulun"],"categories":["C","åŸºç¡€æ•°æ®ç»“æ„"]},{"title":"Cè¯­è¨€_æ–‡ä»¶å…¥é—¨","url":"/C/Cè¯­è¨€_æ–‡ä»¶å…¥é—¨/","content":"# æœ¬ç« å†…å®¹\n\n1. C è¯­è¨€ä¸­çš„æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ\n2. æµçš„æ¦‚å¿µåŠåˆ†ç±»\n3. æ–‡æœ¬æ–‡ä»¶å’ŒäºŒè¿›åˆ¶æ–‡ä»¶åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«\n4. C è¯­è¨€ä¸æ–‡ä»¶è¯»å†™\n5. ç¼“å†²å’Œéç¼“å†²æ–‡ä»¶ç³»ç»Ÿ\n6. æ–‡ä»¶çš„é¡ºåºè¯»å†™\n7. æ–‡ä»¶çš„éšæœºè¯»å†™\n\né‡ç‚¹æŒæ¡ï¼šç¬¬ä¸€ï¼ŒFILEï¼Œå³æ–‡ä»¶ç»“æ„ä½“ã€‚ç¬¬äºŒï¼Œæ–‡ä»¶ä½ç½®æŒ‡é’ˆã€‚\n\n# C è¯­è¨€ä¸­çš„æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ\n\nã€€ã€€æ‰€è°“æ–‡ä»¶ï¼ˆfileï¼‰ä¸€èˆ¬æŒ‡å­˜å‚¨åœ¨å¤–éƒ¨ä»‹è´¨ä¸Šæ•°æ®çš„é›†åˆï¼Œæ¯”å¦‚æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„txtã€bmpã€jpgã€exeã€rmvb ç­‰ç­‰ã€‚è¿™äº›æ–‡ä»¶å„æœ‰å„çš„ç”¨é€”ï¼Œæˆ‘ä»¬é€šå¸¸å°†å®ƒä»¬å­˜æ”¾åœ¨ç£ç›˜æˆ–è€…å¯ç§»åŠ¨ç›˜ç­‰ä»‹è´¨ä¸­ã€‚\nã€€ã€€æ–‡ä»¶æ— éå°±æ˜¯ä¸€æ®µæ•°æ®çš„é›†åˆï¼Œè¿™äº›æ•°æ®å¯ä»¥æ˜¯æœ‰è§„åˆ™çš„é›†åˆï¼Œä¹Ÿå¯ä»¥æ˜¯æ— åºçš„é›†åˆã€‚æ“ä½œç³»ç»Ÿä¹Ÿå°±æ˜¯ä»¥æ–‡ä»¶ä¸ºå•ä½å¯¹æ•°æ®è¿›è¡Œç®¡ç†çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦è®¿é—®å¤–éƒ¨ä»‹è´¨ä¸Šçš„æ•°æ®ï¼Œå¿…é¡»å…ˆæŒ‰ç…§æ–‡ä»¶åè¿›è¡ŒæŸ¥æ‰¾ï¼Œç„¶åä»è¯¥æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚è¦æƒ³å†™æ•°æ®åˆ°å¤–éƒ¨ä»‹è´¨ï¼Œå¿…é¡»å¾—å»ºç«‹ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åå†å†™å…¥ã€‚å› æ­¤ï¼Œä½ çœ¼å‰çš„æ–‡ä»¶åªæ˜¯æ•°æ®çš„é›†åˆã€‚\n\n## ä¸‰è¦ç´ ï¼šæ–‡ä»¶è·¯å¾„ã€æ–‡ä»¶åã€åç¼€\n\nã€€ã€€ç”±äºåœ¨ C è¯­è¨€ä¸­'\\\\'ä¸€èˆ¬æ˜¯è½¬ä¹‰å­—ç¬¦çš„èµ·å§‹æ ‡å¿—ï¼Œæ•…åœ¨è·¯å¾„ä¸­éœ€è¦ç”¨ä¸¤ä¸ª'\\\\'è¡¨ç¤ºè·¯å¾„ä¸­ç›®å½•å±‚æ¬¡çš„é—´éš”ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ '/' ä½œä¸ºè·¯å¾„ä¸­çš„åˆ†éš”ç¬¦ã€‚\n\nã€€ã€€ä¾‹å¦‚: \"D:\\\\\\\\tulun\\\\\\\\test.c\"æˆ–è€…\"D:/tulun/test.c\"ï¼Œè¡¨ç¤ºæ–‡ä»¶ test.c ä¿å­˜åœ¨ D ç›˜tulun ç›®å½•ä¸‹ï¼›\"tu.txt\" è¡¨ç¤ºå½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ tu.txtã€‚\n\n### æ–‡ä»¶è·¯å¾„\n\n* **ä»¥ç›˜ç¬¦å¼€å¤´çš„**ï¼Œå¯ä»¥æ˜¾å¼æŒ‡å‡ºå…¶ç»å¯¹è·¯å¾„ï¼Œå¦‚ä¸Šé¢çš„â€D:\\\\\\\\â€æˆ–è€…â€D:/â€ç­‰ã€‚\n* å¦‚æœæ²¡æœ‰æ˜¾å¼æŒ‡å‡ºå…¶è·¯å¾„ï¼Œé»˜è®¤ä¸ºå½“å‰è·¯å¾„ã€‚ä¹Ÿå°±æ˜¯ç›¸å¯¹è·¯å¾„ã€‚\n\nã€€ã€€**æ•°æ®çš„è¾“å…¥å’Œè¾“å‡ºå‡ ä¹ä¼´éšç€æ¯ä¸ª C è¯­è¨€ç¨‹åºï¼Œæ‰€è°“è¾“å…¥å°±æ˜¯ä»â€œæºç«¯â€è·å–æ•°æ®ï¼Œæ‰€è°“è¾“å‡ºå¯ä»¥ç†è§£ä¸ºå‘â€œç»ˆç«¯â€å†™å…¥æ•°æ®ã€‚**è¿™é‡Œçš„æºç«¯å¯ä»¥æ˜¯é”®ç›˜ã€é¼ æ ‡ã€ç¡¬ç›˜ã€å…‰ç›˜ã€æ‰«æä»ªç­‰è¾“å…¥è®¾å¤‡ï¼Œç»ˆç«¯å¯ä»¥æ˜¯æ˜¾ç¤ºå™¨ã€ç¡¬ç›˜ã€æ‰“å°æœºç­‰è¾“å‡ºè®¾å¤‡ã€‚åœ¨ C è¯­è¨€ä¸­ï¼ŒæŠŠè¿™äº›è¾“å…¥å’Œè¾“å‡ºè®¾å¤‡ä¹Ÿçœ‹ä½œâ€œæ–‡ä»¶â€ã€‚**è¦æ³¨æ„ï¼Œæˆ‘ä»¬æ‰€ç«™çš„è§’åº¦æ˜¯æ‰§è¡Œç¨‹åºçš„è§’åº¦ï¼Œä»¥æ‰§è¡Œç¨‹åºä¸ºä¸»è®¨è®ºè¾“å…¥è¾“å‡º**ã€‚\n\n## C è¯­è¨€æ–‡ä»¶ç³»ç»Ÿä¸­çš„ç±»å‹\n\n* FILEï¼šå¯¹è±¡ç±»å‹ï¼Œè¶³ä»¥ä¿æœ‰æ§åˆ¶ C I/O æµæ‰€éœ€çš„å…¨éƒ¨ä¿¡æ¯\n* fpos_tï¼šéæ•°ç»„å®Œæ•´å¯¹è±¡ç±»å‹ï¼Œè¶³ä»¥å”¯ä¸€æŒ‡å®šæ–‡ä»¶çš„ä½ç½®å’Œå¤šå­—èŠ‚å‰–æçŠ¶æ€\n\næ¯ä¸ª FILE å¯¹è±¡ç›´æ¥æˆ–é—´æ¥ä¿æœ‰ä¸‹åˆ—ä¿¡æ¯ï¼š\n\n1. (C95)å­—ç¬¦å®½åº¦ï¼šæœªè®¾ç½®ã€çª„æˆ–å®½ã€‚\n2. (C95)å¤šå­—èŠ‚ä¸å®½å­—ç¬¦é—´è½¬æ¢çš„åˆ†æçŠ¶æ€ï¼ˆ mbstate_t ç±»å‹å¯¹è±¡ï¼‰\n3. ç¼“å†²çŠ¶æ€ï¼šæ— ç¼“å†²ã€è¡Œç¼“å†²ã€å…¨ç¼“å†²ã€‚\n4. ç¼“å†²åŒºï¼Œå¯ä¸ºå¤–éƒ¨çš„ç”¨æˆ·æä¾›ç¼“å†²åŒºæ‰€æ›¿æ¢ã€‚\n5. I/O æ¨¡å¼ï¼šè¾“å…¥ã€è¾“å‡ºæˆ–æ›´æ–°ï¼ˆå…¼å…·è¾“å…¥ä¸è¾“å‡ºï¼‰ã€‚\n6. äºŒè¿›åˆ¶/æ–‡æœ¬æ¨¡å¼æŒ‡ç¤ºå™¨ã€‚\n7. æ–‡ä»¶å°¾æŒ‡ç¤ºå™¨ã€‚\n8. é”™è¯¯çŠ¶æ€æŒ‡ç¤ºå™¨ã€‚\n9. æ–‡ä»¶ä½ç½®æŒ‡ç¤ºå™¨ï¼Œå¯ä½œä¸º fpos_t ç±»å‹å¯¹è±¡è®¿é—®ï¼Œå¯¹äºå®½æµåŒ…å«å‰–æçŠ¶æ€ã€‚\n10. (C11)åœ¨å¤šä¸ªçº¿ç¨‹è¯»ã€å†™ã€å¯»ä½æˆ–æŸ¥è¯¢æµæ—¶é¿å…æ•°æ®ç«äº‰çš„å†å…¥é”ã€‚\n\n## é¢„å®šä¹‰æ ‡å‡†æµ\n\n1. stdin ä¸æ ‡å‡†è¾“å…¥æµå…³è”çš„ FILE\\* ç±»å‹è¡¨è¾¾å¼\n2. stdout ä¸æ ‡å‡†è¾“å‡ºæµå…³è”çš„ FILE\\* ç±»å‹è¡¨è¾¾å¼ï¼ˆæœ‰ç¼“å†²åŒºï¼‰\n3. stderr ä¸æ ‡å‡†é”™è¯¯è¾“å‡ºæµå…³è”çš„ FILE\\* ç±»å‹è¡¨è¾¾å¼ï¼ˆå®é™…ä¸Šå’Œstdoutä¸€æ ·ï¼Œåªä¸è¿‡æ— ç¼“å†²åŒºï¼‰\n\n## å®å¸¸é‡\n\n| åç§°         | æè¿°                                      | ä¸¾ä¾‹                    |\n| ------------ | ----------------------------------------- | ----------------------- |\n| EOF          | int ç±»å‹çš„è´Ÿå€¼æ•´æ•°å¸¸é‡è¡¨è¾¾å¼              | #define EOF (-1)        |\n| FOPEN_MAX    | èƒ½åŒæ—¶æ‰“å¼€çš„æ–‡ä»¶æ•°                        | #define FOPEN_MAX 20    |\n| FILENAME_MAX | ä¿æœ‰æœ€é•¿å—æ”¯æŒæ–‡ä»¶åæ‰€éœ€çš„ char æ•°ç»„å¤§å°  | define FILENAME_MAX 260 |\n| BUFSIZ       | setbuf() æ‰€ç”¨çš„ç¼“å†²åŒºå¤§å°                 | #define BUFSIZ 512      |\n| _IOFBF       | æŒ‡ç¤ºå…¨ç¼“å†² I/O çš„ setvbuf() å‚æ•°          | #define _IOFBF 0x0000   |\n| _IOLBF       | æŒ‡ç¤ºè¡Œç¼“å†² I/O çš„ setvbuf() å‚æ•°          | #define _IOLBF 0x0040   |\n| _IONBF       | æŒ‡ç¤ºæ— ç¼“å†² I/O çš„ setvbuf() å‚æ•°          | #define _IONBF 0x0004   |\n| SEEK_SET     | æŒ‡ç¤ºä»æ–‡ä»¶é¦–å¼€å§‹å¯»ä½çš„ fseek() å‚æ•°       | #define SEEK_SET 0      |\n| SEEK_CUR     | æŒ‡ç¤ºä»æ–‡ä»¶å½“å‰ä½ç½®å¼€å§‹å¯»ä½çš„ fseek() å‚æ•° | #define SEEK_CUR 1      |\n| SEEK_END     | æŒ‡ç¤ºä»æ–‡ä»¶å°¾å¼€å§‹å¯»ä½çš„ fseek() å‚æ•°       | #define SEEK_END 2      |\n| TMP_MAX      | tmpnam æ‰€èƒ½ç”Ÿæˆçš„æœ€å¤§ç‹¬æœ‰æ–‡ä»¶æ•°           | #define TMP_MAX 32767   |\n| TMP_MAX_S    | tmpnam_s æ‰€èƒ½ç”Ÿæˆçš„æœ€å¤§ç‹¬æœ‰æ–‡ä»¶æ•°         |                         |\n| L_tmpnam     | ä¿æœ‰ tmpnam ç»“æœæ‰€éœ€çš„ char æ•°ç»„å¤§å°      |                         |\n| L_tmpnam_s   | ä¿æœ‰ tmpnam_s ç»“æœæ‰€éœ€çš„ char æ•°ç»„å¤§å°    |                         |\n\n# æµçš„æ¦‚å¿µåŠåˆ†ç±»\n\nã€€ã€€I/O è®¾å¤‡çš„å¤šæ ·æ€§åŠå¤æ‚æ€§ï¼Œç»™ç¨‹åºè®¾è®¡è€…è®¿é—®è¿™äº›è®¾å¤‡å¸¦æ¥äº†å¾ˆå¤§çš„éš¾åº¦å’Œä¸ä¾¿ã€‚ä¸ºæ­¤ï¼ŒANSIC çš„ I/O ç³»ç»Ÿå³æ ‡å‡† I/O ç³»ç»Ÿï¼ˆå³â€œæµâ€ï¼‰ï¼ŒæŠŠä»»æ„è¾“å…¥çš„æºç«¯æˆ–ä»»æ„è¾“å‡ºçš„ç»ˆç«¯ï¼Œéƒ½æŠ½è±¡è½¬æ¢æˆäº†æ¦‚å¿µä¸Šçš„â€œæ ‡å‡† I/O è®¾å¤‡â€æˆ–ç§°â€œæ ‡å‡†é€»è¾‘è®¾å¤‡â€ã€‚\n\nã€€ã€€æµæ˜¯ä¸€ç§æŠ½è±¡çš„æ¦‚å¿µï¼Œè´Ÿè´£åœ¨æ•°æ®çš„äº§ç”Ÿè€…å’Œæ•°æ®çš„ä½¿ç”¨è€…ä¹‹é—´å»ºç«‹è”ç³»ï¼Œå¹¶ç®¡ç†æ•°æ®çš„æµåŠ¨ã€‚\n\nã€€ã€€**ä¸ºä»€ä¹ˆå¦‚æ­¤è®¾è®¡ï¼šå› ä¸ºç¨‹åºå†™å‡ºåˆ°çš„å¤–éƒ¨è®¾å¤‡çš„ç§ç±»å¾ˆå¤šï¼Œåªéœ€è¦ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œä½¿ç¨‹åºç»•è¿‡å…·ä½“è®¾å¤‡ï¼Œç›´æ¥ä¸è¯¥â€œæ ‡å‡†é€»è¾‘è®¾å¤‡â€è¿›è¡Œäº¤äº’ã€‚**è¿™æ ·å°±ä¸ºç¨‹åºè®¾è®¡è€…æä¾›äº†ä¸€ä¸ªä¸ä¾èµ–äºä»»ä½•å…·ä½“ I/O è®¾å¤‡çš„ç»Ÿä¸€çš„æ“ä½œæ¥å£ï¼Œé€šå¸¸æŠŠæŠ½è±¡å‡ºæ¥çš„â€œæ ‡å‡†é€»è¾‘è®¾å¤‡â€æˆ–â€œæ ‡å‡†æ–‡ä»¶â€ç§°ä½œâ€œæµâ€ã€‚**æ€æƒ³ï¼šé€‚é…å™¨è®¾è®¡æ–¹æ¡ˆã€‚**\nã€€ã€€æŠŠä»»æ„ I/O è®¾å¤‡ï¼Œè½¬æ¢æˆé€»è¾‘æ„ä¹‰ä¸Šçš„æ ‡å‡† I/O è®¾å¤‡æˆ–æ ‡å‡†æ–‡ä»¶çš„è¿‡ç¨‹ï¼Œå¹¶ä¸éœ€è¦ç¨‹åºè®¾è®¡è€…æ„ŸçŸ¥å’Œå¤„ç†ï¼Œæ˜¯ç”±æ ‡å‡† I/O ç³»ç»Ÿè‡ªåŠ¨è½¬æ¢å®Œæˆçš„ã€‚æ•…ä»è¿™ä¸ªæ„ä¹‰ä¸Šï¼Œå¯ä»¥è®¤ä¸ºä»»æ„è¾“å…¥çš„æºç«¯å’Œä»»æ„è¾“å‡ºçš„ç»ˆç«¯å‡å¯¹åº”ä¸€ä¸ªâ€œæµâ€ã€‚\n\n* æµæŒ‰**æ–¹å‘**åˆ†ä¸ºï¼šè¾“å…¥æµå’Œè¾“å‡ºæµã€‚ä»æ–‡ä»¶è·å–æ•°æ®çš„æµç§°ä¸ºè¾“å…¥æµï¼Œå‘æ–‡ä»¶è¾“å‡ºæ•°æ®ç§°ä¸ºè¾“å‡ºæµã€‚\n* æµæŒ‰**æ•°æ®å½¢å¼**åˆ†ä¸ºï¼šæ–‡æœ¬æµå’ŒäºŒè¿›åˆ¶æµã€‚æ–‡æœ¬æµæ˜¯ ASCII ç å­—ç¬¦ï¼ˆ0 000 0000\\~0  111 1111å³0\\~127ï¼‰åºåˆ—ï¼Œè€ŒäºŒè¿›åˆ¶æµæ˜¯å­—èŠ‚åºåˆ—ã€‚ä»æŸç§æ„ä¹‰ä¸Šæ¥è¯´ï¼Œæ–‡æœ¬æµæ˜¯ä¸€ç§ç‰¹æ®Šçš„äºŒè¿›åˆ¶æµã€‚\n\nå›¾ç¤ºï¼š\n\n![image-20210819010628605](../../images/C_%E6%96%87%E4%BB%B6/image-20210819010628605.png)\n\n# æ–‡æœ¬æ–‡ä»¶å’ŒäºŒè¿›åˆ¶æ–‡ä»¶åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«\n\nhttps://www.zhihu.com/question/19971994/answer/17256634\n\nhttps://www.zhihu.com/question/24662572/answer/28541822\n\nhttps://zhuanlan.zhihu.com/p/51828216\n\næ ¹æ®æ–‡ä»¶ä¸­æ•°æ®çš„ç»„ç»‡å½¢å¼çš„ä¸åŒï¼Œå¯ä»¥æŠŠæ–‡ä»¶åˆ†ä¸ºï¼šæ–‡æœ¬æ–‡ä»¶å’ŒäºŒè¿›åˆ¶æ–‡ä»¶ã€‚\n\n* æ–‡æœ¬æ–‡ä»¶ï¼šæŠŠè¦å­˜å‚¨çš„æ•°æ®å½“æˆä¸€ç³»åˆ—å­—ç¬¦ç»„æˆï¼ŒæŠŠæ¯ä¸ªå­—ç¬¦çš„ ASCII ç å€¼å­˜å…¥æ–‡ä»¶ä¸­ã€‚æ¯ä¸ª ASCII ç å€¼å ä¸€ä¸ªå­—èŠ‚ï¼Œæ¯ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ã€‚æ•…æ–‡æœ¬æ–‡ä»¶ä¹Ÿç§°ä½œå­—ç¬¦æ–‡ä»¶æˆ– ASCII æ–‡ä»¶ï¼Œæ˜¯å­—ç¬¦åºåˆ—æ–‡ä»¶ã€‚\n* äºŒè¿›åˆ¶æ–‡ä»¶ï¼šæŠŠæ•°æ®å¯¹åº”çš„äºŒè¿›åˆ¶å½¢å¼å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ï¼Œæ˜¯å­—èŠ‚åºåˆ—æ–‡ä»¶ã€‚\n\n![image-20210819010658360](../../images/C_%E6%96%87%E4%BB%B6/image-20210819010658360.png)\n\n## å…³äºå­—ç¬¦é›†çš„ä¸ªäººæ€»ç»“\n\nç†è®ºä¸Šï¼Œæ–‡æœ¬æ–‡ä»¶å¯ä»¥çœ‹ä½œç‰¹æ®Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚\n\nä½ æ¯”å¦‚è¯´ï¼Œå›¾ç‰‡å’Œè§†é¢‘éƒ½æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»–ä»¬çš„åŒºåˆ«å°±åœ¨äºç¼–ç ä¸è§£ç çš„æ ¼å¼ä¸åŒï¼Œæ¯”å¦‚æŸç§å›¾ç‰‡ä»¥jpgæ ¼å¼æ‰“å¼€ï¼ŒæŸç§è§†é¢‘ä»¥mp4æ ¼å¼æ‰“å¼€ã€‚\n\nè€Œæ–‡æœ¬æ–‡ä»¶åŒæ ·å¯ä»¥ç±»æ¯”ï¼Œæ–‡æœ¬æ–‡ä»¶å®é™…ä¸Šå°±æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œåªä¸è¿‡æœ‰å¥½å‡ ç§æ–‡æœ¬æ–‡ä»¶ï¼Œæœ‰ä¸åŒçš„ç¼–ç å’Œè§£ç æ–¹å¼ã€‚æ¯”å¦‚æ±‰å­—â€œæˆ‘â€åœ¨ASCIIç ä¸­æ²¡æœ‰è§„å®šï¼Œè€Œåœ¨GBKå­—ç¬¦é›†çš„ç¼–ç ä¸ºï¼š(CE D2)16ï¼ŒUnicodeå­—ç¬¦é›†çš„UTF-8æ–¹å¼ç¼–ç ä¸ºï¼š(62 11)16ã€‚æ‰€ä»¥ï¼Œä¸åŒæ ¼å¼çš„æ–‡æœ¬æ–‡ä»¶ç”¨ä¸åŒçš„è§£ç æ–¹å¼è½¬æ¢å‡ºæ¥çš„æ–‡æœ¬å°±ä¸ä¸€æ ·ã€‚å¾ˆå®¹æ˜“å°±å¯¼è‡´ä¹±ç ç°è±¡çš„äº§ç”Ÿã€‚è€ŒUnicodeå­—ç¬¦é›†è§„èŒƒäº†ä¸–ç•Œä¸Šæ‰€æœ‰åœ°åŒºçš„è¯­è¨€ã€‚\n\nUTF-8ï¼ˆ8ä½å…ƒï¼ŒUniversal Character Set/Unicode Transformation Formatï¼‰æ˜¯é’ˆå¯¹Unicodeçš„ä¸€ç§å¯å˜é•¿åº¦å­—ç¬¦ç¼–ç ã€‚å®ƒå¯ä»¥ç”¨æ¥è¡¨ç¤ºUnicodeæ ‡å‡†ä¸­çš„ä»»ä½•å­—ç¬¦ï¼Œè€Œä¸”å…¶ç¼–ç ä¸­çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ä»ä¸[ASCII](https://baike.baidu.com/item/ASCII/309296)ç›¸å®¹ï¼Œä½¿å¾—åŸæ¥å¤„ç†ASCIIå­—ç¬¦çš„è½¯ä»¶æ— é¡»æˆ–åªè¿›è¡Œå°‘éƒ¨åˆ†ä¿®æ”¹åï¼Œä¾¿å¯ç»§ç»­ä½¿ç”¨ã€‚\n\n# C è¯­è¨€ä¸æ–‡ä»¶è¯»å†™ï¼Œæ–‡ä»¶åº“å‡½æ•°stdio.h\n\né“¾æ¥ï¼š http://www.cplusplus.com/reference/cstdio/\n\nC è¯­è¨€æ“ä½œæ–‡ä»¶åˆ†ä¸ºä¸‰æ­¥\n\n1. æ‰“å¼€æ–‡ä»¶\n2. è¯»å†™æ–‡ä»¶\n3. å…³é—­æ–‡ä»¶\n\n## æ‰“å¼€æ–‡ä»¶fopen\n\nFILE \\* fopen ( const char \\* filename, const char \\* mode );\n\n### å‡½æ•°å‚æ•°\n\n| å‚æ•°å   | æè¿°                                                         |\n| -------- | ------------------------------------------------------------ |\n| filename | æ–‡ä»¶åï¼ŒåŒ…æ‹¬è·¯å¾„ï¼Œå¦‚æœä¸æ˜¾å¼å«æœ‰è·¯å¾„ï¼Œåˆ™è¡¨ç¤ºå½“å‰è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œâ€œD:\\\\text.txtâ€è¡¨ç¤º D ç›˜æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶ text.txt æ–‡ä»¶ã€‚â€œtulun.txtâ€è¡¨ç¤ºå½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ tulun.txt |\n| mode     | æ–‡ä»¶æ‰“å¼€æ¨¡å¼ï¼ŒæŒ‡å‡ºå¯¹è¯¥æ–‡ä»¶å¯è¿›è¡Œçš„æ“ä½œã€‚å¸¸è§çš„æ‰“å¼€æ¨¡å¼å¦‚ \"r\" è¡¨ç¤ºåªè¯»ï¼Œ\"w\" è¡¨ç¤ºåªå†™ï¼Œ\"rw\" è¡¨ç¤ºè¯»å†™ï¼Œ\"a\" è¡¨ç¤ºè¿½åŠ å†™å…¥ã€‚**æ³¨æ„ï¼Œ\" \"ä»£è¡¨ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸æ˜¯å­—ç¬¦ã€‚** |\n\n![image-20210819010757148](../../images/C_%E6%96%87%E4%BB%B6/image-20210819010757148.png)\n\nè™½ç„¶fopenä»¥å†™æ–¹å¼æ‰“å¼€æ–‡ä»¶æ—¶ï¼Œè‹¥æ–‡ä»¶ä¸å­˜åœ¨å¯ä»¥åˆ›å»ºæ–°æ–‡ä»¶åå†™å…¥ï¼Œä½†åªæ˜¯é’ˆå¯¹å­˜åœ¨çš„ç›®å½•è€Œè¨€çš„ï¼Œå¦‚æœå‰é¢çš„ç›®å½•ä½ç½®ä¸å­˜åœ¨ï¼Œæ˜¯ä¸ä¼šç»™ä½ åˆ›å»ºæ–‡ä»¶å¤¹çš„ã€‚æ¯”å¦‚fopen(\"D:/yhp.txt\",\"w\");æ˜¯å¯ä»¥çš„ã€‚è€Œfopen(\"D:/yhp/yhp.txt\",\"w\");åœ¨D:/yhpç›®å½•ä¸å­˜åœ¨æ—¶å°†æ— æ³•åˆ›å»ºyhp.txtï¼Œå¹¶ä¸”è¿”å›ç©ºæŒ‡é’ˆã€‚\n\n![image-20210824212604457](../../images/C_%E6%96%87%E4%BB%B6/image-20210824212604457.png)\n\n### è¿”å›å€¼\n\n| çŠ¶æ€     | è¿”å›å€¼                           |\n| -------- | -------------------------------- |\n| æ‰“å¼€æˆåŠŸ | è¿”å›è¯¥æ–‡ä»¶å¯¹åº”çš„ FILE ç±»å‹çš„æŒ‡é’ˆ |\n| æ‰“å¼€å¤±è´¥ | è¿”å› NULL                        |\n\næ ¹æ®è¿”å›å€¼è¡¨ï¼Œéœ€å®šä¹‰ FILE ç±»å‹çš„æŒ‡é’ˆå˜é‡ï¼Œä¿å­˜è¯¥å‡½æ•°çš„è¿”å›å€¼ã€‚å¯æ ¹æ®è¯¥å‡½æ•°çš„è¿”å›å€¼åˆ¤æ–­æ–‡ä»¶æ‰“å¼€æ˜¯å¦æˆåŠŸã€‚\n\n### å†™å…¥æ–‡ä»¶-ä»£ç æ¡ˆä¾‹\n\n```c\n#include<stdio.h>\nint main()\n{\n    //ç¬¬ä¸€éƒ¨åˆ†ä»£ç -æ‰“å¼€æ–‡ä»¶\n    FILE* fp = NULL;\n    fp = fopen(\"yhping\",\"w\"); //ä¸mallocç±»ä¼¼ï¼Œè¦ä»ç³»ç»Ÿé‡Œç”³è¯·æ–‡ä»¶èµ„æºã€‚å¦‚æœæ²¡æœ‰ç”³è¯·åˆ°ï¼Œåˆ™è¿”å›ç©ºã€‚\n    if(NULL==fp)\n    {\n        printf(\"file open error\\n\");\n        return 1;\n    }\n    \n    //ç¬¬äºŒéƒ¨åˆ†ä»£ç -å®šä¹‰æ•°æ®\n    int ar[10]={12,23,34,45,56,67,78,89,90,100};\n    int n = sizeof(ar)/sizeof(ar[0]);\n    \n    //ç¬¬ä¸‰éƒ¨åˆ†ä»£ç -å†™æ•°æ®åˆ°æ–‡ä»¶\n    for(int i= 0;i<n;++i)\n    {\n        //printf(\"%d \",ar[i]);\t\t//é»˜è®¤å†™åˆ°stdoutï¼Œç­‰æ•ˆäºfprintf(stdout, \"%d \", ar[i]);\n        fprintf(fp, \"%d \", ar[i]);\t//å†™åˆ°fpä¸­ï¼Œä½†æ˜¯åªæ˜¯å†™åˆ°äº†ç¼“å†²åŒºï¼Œè¿˜æ²¡å†™åˆ°ç£ç›˜ä¸­ã€‚å†…éƒ¨è¿˜è¦è°ƒç”¨itoaå‡½æ•°ï¼ŒæŠŠæ•´å‹è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼ˆASCIIç ä¸²ï¼‰\n    }\n    \n    //ç¬¬å››éƒ¨åˆ†ä»£ç -å–„åå¤„ç†\n    fclose(fp);//ä¸ä»…æŠŠæ–‡ä»¶æµå¯¹è±¡èµ„æºå½’è¿˜ç³»ç»Ÿï¼Œè¿˜æŠŠç¼“å†²åŒºçš„æ•°æ®è¾“å‡ºåˆ°æ–‡ä»¶ä¸­ã€‚ä¹‹åï¼ŒfpæŒ‡é’ˆå°±å¤±æ•ˆäº†ï¼Œè®°å¾—free\n    free(fp);\n    \n    return 0;\n}\n```\n\næ³¨æ„è§‚å¯ŸFILEç»“æ„ä½“çš„cntä¿¡æ¯ï¼Œå†™äº†ç¬¬ä¸€ä¸ªæ•°åŠ ä¸€ä¸ªç©ºæ ¼åï¼Œcntç”±4096å‡å»äº†3ã€‚\n\n![image-20210824203452627](../../images/C_%E6%96%87%E4%BB%B6/image-20210824203452627.png)\n\nä¸¤ç§ç¼“å†²åŒºï¼š\n\n1. å…¨ç¼“å†²åŒºâ€”â€”ç¼“å†²åŒºæ»¡åå†™åˆ°ç£ç›˜ã€‚\n2. è¡Œç¼“å†²åŒºâ€”â€”é‡åˆ°\\\\nå†™åˆ°ç£ç›˜ã€‚\n3. æ— ç¼“å†²åŒºâ€”â€”ä¸ç»è¿‡ç¼“å†²åŒºï¼Œç›´æ¥æŠŠæ–‡ä»¶æµå†™å…¥åˆ°ç£ç›˜ä¸­ã€‚\n\n### è¯»å‡ºæ–‡ä»¶-ä»£ç æ¡ˆä¾‹\n\n```c\nint main()\n{\n    //1.\n    FILE* fp = fopen(\"yhp.txt\",\"r\");\n    if(NULL==fp)\n    {\n        return 1;\n    }\n    //2.\n    int ar[10]={};\n    \n    //3.\n    for(int i = 0;i<10;++i)\n    {\n        fscanf(fp,\"%d\",&ar[i]);//å†…éƒ¨è°ƒç”¨atoi(),æŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´å‹æ•°æ®\n    }\n    //4.\n    fclose(fp);\n    fp = nullptr;\n}\n```\n\næ³¨æ„è§‚å¯ŸFILEç»“æ„ä½“cntçš„ä¿¡æ¯ï¼ŒåŸæœ¬\"12 23 34 45 56 67 78 89 90 100 \"åä¸ªæ•°æ®åŠ ä¸Šåä¸ªç©ºæ ¼ï¼Œä¸åŒ…æ‹¬'\\\\0'çš„é•¿åº¦ä¸º9\\*2+3+10=31ã€‚å½“æˆ‘ä»¬è¯»å‡ºäº†1ä¸ªæ•°æ®åï¼Œï¼ˆæ²¡è¯»ç©ºæ ¼ï¼‰ï¼Œ31å‡å»äº†2å˜ä¸ºäº†29ã€‚\n\n![image-20210824213744839](../../images/C_%E6%96%87%E4%BB%B6/image-20210824213744839.png)\n\n![image-20210824214430960](../../images/C_%E6%96%87%E4%BB%B6/image-20210824214430960.png)\n\n#### å›å¿†çŸ¥è¯†\n\nä¸‰ç§scanfï¼š\n\n1. scanfæ˜¯ä»æ ‡å‡†è¾“å…¥è®¾å¤‡è¯»å‡º\n2. sscanfæ˜¯ä»è¾“å…¥ç¼“å†²åŒºï¼ˆbuffå­—ç¬¦ä¸²ï¼‰ä¸­è¯»å‡º\n3. fscanfæ˜¯ä»æŒ‡å®šæ–‡ä»¶ä¸­è¯»å‡º\n\n## å…³é—­å‡½æ•°fclose\n\nint fclose (FILE \\* stream);\n\n### å‡½æ•°å‚æ•°\n\n| åç§°  | æè¿°                   |\n| ----- | ---------------------- |\n| strem | æŒ‡å‘è¦å…³é—­æµå¯¹è±¡çš„æŒ‡é’ˆ |\n\n### è¿”å›å€¼\n\n| çŠ¶æ€         | è¿”å›å€¼      |\n| ------------ | ----------- |\n| æµè¢«æˆåŠŸå…³é—­ | è¿”å›0 å€¼    |\n| å¤±è´¥         | è¿”å›EOF(-1) |\n\nå³ä½¿è°ƒç”¨å¤±è´¥ï¼Œä½œä¸ºå‚æ•°ä¼ é€’çš„æµå°†ä¸å†ä¸æ–‡ä»¶æˆ–å…¶ç¼“å†²åŒºå…³è”ã€‚\n\n## å­—ç¬¦ä¸²æ ¼å¼åŒ–å‡½æ•°sprintf\n\nint sprintf (char \\* str, const char \\* format, ... );\n\n### å‡½æ•°å‚æ•°\n\n| å‚æ•°å | æè¿°                                                         |\n| ------ | ------------------------------------------------------------ |\n| str    | æŒ‡å‘ç¼“å†²åŒºæŒ‡é’ˆï¼Œç¼“å†²åŒºè¶³å¤Ÿå¤§                                 |\n| format | æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²éµå¾ªä¸printf ä¸­çš„æ ¼å¼ç›¸åŒçš„è§„èŒƒ        |\n| ...    | é™„åŠ å¯å˜å‚æ•°ã€‚ æ ¹æ®æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ä¸åŒï¼Œå‡½æ•°å¯èƒ½éœ€è¦ä¸€ç³»åˆ—é™„åŠ å‚æ•°ï¼Œæ¯ä¸ªå‚æ•°éƒ½åŒ…å«ä¸€ä¸ªå€¼ï¼Œç”¨äºæ›¿æ¢æ ¼å¼å­—ç¬¦ä¸²ä¸­çš„æ ¼å¼è¯´æ˜ç¬¦ã€‚ |\n\n### è¿”å›å€¼\n\nå¦‚æœæˆåŠŸï¼Œå°†è¿”å›å†™å…¥çš„å­—ç¬¦æ€»æ•°ã€‚æ­¤è®¡æ•°ä¸åŒ…æ‹¬è‡ªåŠ¨é™„åŠ åœ¨å­—ç¬¦ä¸²æœ«å°¾çš„é¢å¤–ç©ºå­—ç¬¦ã€‚å¤±è´¥è¿”å›è´Ÿæ•°ã€‚\n\n![image-20210819010851930](../../images/C_%E6%96%87%E4%BB%B6/image-20210819010851930.png)\n\næ³¨æ„ï¼š Windows OS ä¸Šçš„ C æµåœ¨è¾“å‡ºæ—¶å°† '\\\\n' è½¬æ¢ä¸º '\\\\r\\\\n' ï¼Œè¾“å…¥æ—¶å°† '\\\\r\\\\n' è½¬æ¢ä¸º '\\\\n' ã€‚\n\n## æ ¼å¼åŒ–å†™å…¥å‡½æ•°\n\nint fprintf ( FILE \\* stream, const char \\* format, ... )ï¼›\n\n![image-20210819010921972](../../images/C_%E6%96%87%E4%BB%B6/image-20210819010921972.png)\n\n![image-20210819010941058](../../images/C_%E6%96%87%E4%BB%B6/image-20210819010941058.png)\n\n## ä»æµä¸­è¯»å–æ ¼å¼åŒ–æ•°æ®å‡½æ•°\n\nint fscanf ( FILE \\* stream, const char \\* format, ... );\n\n### å‡½æ•°å‚æ•°\n\n| å‚æ•°å | å‚æ•°æè¿°                                               |\n| ------ | ------------------------------------------------------ |\n| stream | æŒ‡å‘æ–‡ä»¶å¯¹è±¡çš„æŒ‡é’ˆï¼Œè¯¥å¯¹è±¡æ ‡è¯†è¦ä»ä¸­è¯»å–æ•°æ®çš„è¾“å…¥æµã€‚ |\n| format | æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²éµå¾ªä¸scanf ä¸­çš„æ ¼å¼ç›¸åŒçš„è§„èŒƒã€‚ |\n\n### è¿”å›å€¼\n\n| çŠ¶æ€                                                         | å€¼                                                           |\n| ------------------------------------------------------------ | ------------------------------------------------------------ |\n| receiving arguments successfully assigned. ä¼ å…¥çš„å‚æ•°è¾“å…¥æˆåŠŸï¼ŒåŒ¹é…æˆåŠŸã€‚ | Number of receiving arguments successfully assigned. æˆåŠŸèµ‹å€¼çš„æ¥æ”¶å‚æ•°çš„æ•°é‡ |\n| in case a matching failure occurred before the first receiving argument was assigned. è¾“å…¥æˆåŠŸï¼Œä½†ä¼ å…¥çš„å‚æ•°ç¬¬ä¸€æ¬¡å°±åŒ¹é…å¤±è´¥äº† | 0                                                            |\n| if input failure occurs before the first receiving argument was assigned | EOFï¼ˆ-1ï¼‰                                                    |\n![image-20210819011017608](../../images/C_æ–‡ä»¶/image-20210819011017608.png)\n## äºŒè¿›åˆ¶æ–‡ä»¶çš„è¯»å†™\n\n### ï¼ˆå­—èŠ‚ï¼‰å—æ•°æ®å†™å…¥å‡½æ•°\n\n`size_t fwrite ( const void * ptr, size_t size, size_t count, FILE * stream );`\n\nå°†å†…å­˜ä¸­æ•°ç»„çš„å†…å®¹å†™åˆ°æ–‡ä»¶ä¸­ã€‚åŠŸèƒ½ç±»ä¼¼äº`fprintf`\n\n#### å‡½æ•°å‚æ•°\n\n| å‚æ•°å | å‚æ•°æè¿°                                                     |\n| ------ | ------------------------------------------------------------ |\n| buffer | æŒ‡å‘å°†è¦**è¢«å†™å‡º**åˆ°æ–‡ä»¶é‡Œçš„å…ƒç´ æ•°ç»„çš„æŒ‡é’ˆ                   |\n| size   | è¿™æ˜¯è¦**è¢«å†™å‡ºåˆ°æ–‡ä»¶é‡Œ**çš„æ¯ä¸ªå…ƒç´ çš„å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ã€‚     |\n| count  | è¿™æ˜¯**è¦å†™çš„**æ€»å…±çš„å…ƒç´ ä¸ªæ•°ï¼Œæ¯ä¸ªå…ƒç´ çš„å¤§å°ä¸º size å­—èŠ‚ã€‚   |\n| stream | è¿™æ˜¯æŒ‡å‘ FILE å¯¹è±¡çš„æŒ‡é’ˆï¼Œè¯¥ FILE å¯¹è±¡æŒ‡å®šäº†ä¸€ä¸ªè¾“å‡ºæµï¼ˆç›¸å¯¹å†…å­˜è€Œè¨€ï¼Œè¾“å‡ºåˆ°æ–‡ä»¶çš„æµï¼‰ã€‚ |\n\n#### è¿”å›å€¼\n\nè¿”å›æˆåŠŸåœ°è¢«å†™å‡ºçš„å…ƒç´ çš„ä¸ªæ•°ï¼Œå¦‚æœå‡ºç°é”™è¯¯ï¼Œå¯èƒ½æ¯”countå°ã€‚\nå¦‚æœä¼ å…¥çš„å‚æ•°size æˆ–count ä¸ºé›¶ï¼Œfwriteè¿”å›0ä¸”ä¸åšä»»ä½•åŠ¨ä½œã€‚\n\n### å—æ•°æ®è¯»å‡ºå‡½æ•°\n\n`size_t fread ( void * ptr, size_t size, size_t count, FILE * stream );`\n\n#### å‡½æ•°å‚æ•°\n\n| å‚æ•°å | å‚æ•°æè¿°                                                     |\n| ------ | ------------------------------------------------------------ |\n| buffer | æŒ‡å‘å¤§å°è‡³å°‘ä¸ºï¼ˆsize\\*countï¼‰å­—èŠ‚çš„å†…å­˜å—çš„æŒ‡é’ˆï¼Œä»æµä¸­è¯»å‡ºçš„æ•°æ®å­˜å‚¨åˆ°bufferæŒ‡å‘çš„å†…å­˜ã€‚ |\n| size   | è¯»å–å…ƒç´ çš„å¤§å°ï¼Œunsigned intã€‚                               |\n| count  | è¢«è¯»å–å…ƒç´ çš„ä¸ªæ•°                                             |\n| stream | æ˜¯æŒ‡å‘ FILE å¯¹è±¡çš„æŒ‡é’ˆï¼Œè¯¥ FILE å¯¹è±¡æŒ‡å®šäº†ä¸€ä¸ªè¾“å…¥æµï¼ˆç›¸å¯¹å†…å­˜è€Œè¨€çš„ï¼Œä»å¤–éƒ¨çš„æ–‡ä»¶è¾“å…¥åˆ°å†…å­˜ä¸­ï¼‰ã€‚ |\n\n#### è¿”å›å€¼\n\nè¿”å›æˆåŠŸè¢«è¯»å–çš„å…ƒç´ ä¸ªæ•°countï¼Œè‹¥å‡ºç°é”™è¯¯æˆ–åˆ°è¾¾æ–‡ä»¶æœ«å°¾ï¼Œåˆ™å¯èƒ½å°äºcountã€‚\nå¦‚æœä¼ å…¥çš„å‚æ•°size æˆ–count ä¸ºé›¶ï¼Œfreadè¿”å›0ä¸”ä¸åšä»»ä½•åŠ¨ä½œã€‚\nfread ä¸åŒºåˆ†æ–‡ä»¶å°¾å’Œé”™è¯¯ï¼Œå› æ­¤è°ƒç”¨è€…å¿…é¡»ç”¨feof å’Œferror æ‰èƒ½åˆ¤æ–­å‘ç”Ÿäº†ä»€ä¹ˆã€‚\n\n### äºŒè¿›åˆ¶æ–¹å¼-ä»£ç æ¡ˆä¾‹\n\næ³¨æ„ï¼Œä¸ä»…è¦æ‰“å¼€æ—¶æŒ‰ç…§wbæ‰“å¼€ï¼Œè¿˜è¦æŠŠè¯»å†™å‡½æ•°æ”¹ä¸ºfwriteå’Œfread\n\n```c\n#include<stdio.h>\nint main()\n{\n    int ar[10]={12,23,34,45,56,67,78,89,90,100};\n    int n = sizeof(ar)/sizeof(ar[0]);\n    FILE* fp = NULL;\n    fp = fopen(\"yhpBin.txt\",\"wb\"); //ä¸mallocç±»ä¼¼ï¼Œè¦ä»ç³»ç»Ÿé‡Œç”³è¯·æ–‡ä»¶èµ„æºã€‚å¦‚æœæ²¡æœ‰ç”³è¯·åˆ°ï¼Œåˆ™è¿”å›ç©ºã€‚\n    if(NULL==fp)\n    {\n        printf(\"file open error\\n\");\n        return 1;\n    }\n    \n    fwrite(ar,sizeof(int),n,fp);\t//ä¸“é—¨å†™å…¥äºŒè¿›åˆ¶æ–‡ä»¶\n    \n    fclose(fp);//ä¸ä»…æŠŠæ–‡ä»¶æµå¯¹è±¡èµ„æºå½’è¿˜ç³»ç»Ÿï¼Œè¿˜æŠŠç¼“å†²åŒºçš„æ•°æ®è¾“å‡ºåˆ°æ–‡ä»¶ä¸­ã€‚ä¹‹åï¼ŒfpæŒ‡é’ˆå°±å¤±æ•ˆäº†ï¼Œè®°å¾—free\n    free(fp);\n    \n    return 0;\n}\n//é€šè¿‡è®°äº‹æœ¬æ‰“å¼€æ–‡ä»¶ï¼Œå‘ç°æ˜¾ç¤ºçš„æ˜¯ï¼šâ–¡ â–¡ - 8 C N Y Z d ã€‚é€šè¿‡è§‚å¯Ÿï¼Œå‘ç°æ­£å¥½å¯¹åº”äºå„è‡ªçš„ASCIIç å€¼\"\\12 \\23 \\34 \\45 \\56 \\67 \\78 \\89 \\90 \\100 \"\n```\n\nå› ä¸ºæˆ‘ä»¬æ˜¯ç”¨è®°äº‹æœ¬æ‰“å¼€çš„ï¼ˆç³»ç»Ÿè‡ªåŠ¨è§£æä¸ºUTF-8ç¼–ç ï¼‰ï¼Œ**ç³»ç»Ÿå¯¹è¿™äº›æ•°æ®çš„å¤„ç†æ˜¯æŒ‰ç…§ASCIIç å¤„ç†çš„**ã€‚æ‰€ä»¥å‡ºç°äº†ä»¥ä¸‹çš„æƒ…å†µï¼\n\n![image-20210824221223042](../../images/C_%E6%96%87%E4%BB%B6/image-20210824221223042.png)\n\n![image-20210824221905601](../../images/C_%E6%96%87%E4%BB%B6/image-20210824221905601.png)\n\næ¯ä¸ªintå‹æ•°æ®å æ®äº†4å­—èŠ‚ã€‚æˆ‘ä»¬è¾“å…¥çš„æ•°æ®éƒ½æ²¡æœ‰ç”¨åˆ°ç¬¬äºŒä¸ªå­—èŠ‚ï¼Œåˆ™æ­£å¥½é™åˆ¶åœ¨äº†0~127è¿™ä¸ªASCIIç åŒºé—´å†…ï¼Œ12å’Œ23è¡¨ç¤ºæ§åˆ¶ç¬¦ï¼Œæ˜¾ç¤ºä¸å‡ºæ¥ï¼Œæ•…æ˜¾ç¤ºä¸ºâ–¡ã€‚å‰©ä¸‹çš„00é€šè¿‡æ–‡æœ¬æ ¼å¼è§£ç å˜æˆäº†ç©ºæ ¼ã€‚\n\n![image-20210824221601975](../../images/C_%E6%96%87%E4%BB%B6/image-20210824221601975.png)\n\n```c\nint main()\n{\n    int ar[10]={};\n    FILE* fp = fopen(\"yhpBin.txt\",\"rb\");\n    if(NULL==fp)\n    {\n        return 1;\n    }\n    \n    fread(ar,sizeof(int),n,fp);//ä»fpè¯»å‡ºæ•°æ®åˆ°aræ•°ç»„ä¸­\n    \n    fclose(fp);\n    fp = nullptr;\n}\n```\n\n### æ€»ç»“\n\näºŒè¿›åˆ¶è¯»å†™ï¼ˆfwriteå’Œfreadï¼‰æ˜¯æŒ‰ç€æŠŠæ•°æ®â€œæœ¬è¯¥åœ¨å†…å­˜ä¸­çš„æ ·å­â€åŸå°ä¸åŠ¨åœ°å­˜å…¥åˆ°æ–‡ä»¶ä¸­ã€‚\n\n# ç¼“å†²å’Œéç¼“å†²æ–‡ä»¶ç³»ç»Ÿ\n\nåœ¨ANSI C æ ‡å‡†ä¸­ï¼Œä½¿ç”¨çš„æ˜¯â€œç¼“å†²æ–‡ä»¶ç³»ç»Ÿâ€ã€‚\n\næ‰€è°“ç¼“å†²æ–‡ä»¶ç³»ç»ŸæŒ‡ç³»ç»Ÿè‡ªåŠ¨åœ°åœ¨å†…å­˜ä¸ºæ¯ä¸€ä¸ªæ­£åœ¨ä½¿ç”¨çš„æ–‡ä»¶åå¼€è¾Ÿä¸€ä¸ªç¼“å†²åŒºï¼Œä»å†…å­˜å‘ç£ç›˜è¾“å‡ºæ•°æ®å¿…é¡»å…ˆé€åˆ°å†…å­˜ä¸­çš„ç¼“å†²åŒºï¼Œè£…æ»¡åå†ä¸€èµ·é€åˆ°ç£ç›˜å»ã€‚åå‘ä¹Ÿæ˜¯å¦‚æ­¤ã€‚\n\n## vs2012ä¸­çš„FILE ç»“æ„ä½“\n\n![image-20210819011136329](../../images/C_%E6%96%87%E4%BB%B6/image-20210819011136329.png)\n\n## å†™æ•°æ®\n\n![image-20210819011222800](../../images/C_%E6%96%87%E4%BB%B6/image-20210819011222800.png)\n\n## è¯»æ•°æ®\n\n![image-20210819011232955](../../images/C_%E6%96%87%E4%BB%B6/image-20210819011232955.png)\n## fflush\n```cpp\nint fflush( FILE *stream);\n```\n### åŠŸèƒ½\n\næ¸…é™¤è¯»å†™ç¼“å†²åŒºï¼Œåœ¨éœ€è¦ç«‹å³æŠŠè¾“å‡ºç¼“å†²åŒºçš„æ•°æ®è¿›è¡Œç‰©ç†å†™å…¥æ—¶ã€‚\n### å‡½æ•°è¯´æ˜\n\nå¦‚æœæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªè¾“å‡ºæµæˆ–è€…æ˜¯ä¸€ä¸ªæœ€è¿‘çš„ä¸€æ¬¡æ“ä½œä¸æ˜¯è¾“å…¥çš„æ›´æ–°æµï¼Œè¾“å‡ºåˆ·æ–°å°†ä¼šåˆ›é€ ä»»æ„æœªå†™å…¥çš„æ•°æ®ç»™å°†è¦è¢«å†™å…¥æ–‡ä»¶çš„æµå’Œæœ€è¿‘çš„æ•°æ®è¢«ä¿®æ”¹æµï¼Œå¹¶ä¸”æœ€åçš„æ–‡ä»¶çŠ¶æ€æ”¹å˜åº”è¯¥è¢«æ ‡è®°ä¸ºæ›´æ–°çš„åŸºç¡€æ–‡ä»¶çš„æ—¶é—´æˆ³ã€‚\nå¯¹äºæ‰“å¼€ä»¥ä½¿ç”¨åŸºç¡€æ–‡ä»¶æè¿°è¿›è¡Œè¯»å–çš„æµï¼Œå¦‚æœæ–‡ä»¶å°šæœªå¤„äºEOFï¼Œå¹¶ä¸”è¯¥æ–‡ä»¶æ˜¯èƒ½å¤Ÿæœç´¢çš„æ–‡ä»¶ï¼Œåˆ™åŸºç¡€æ‰“å¼€æ–‡ä»¶æè¿°çš„æ–‡ä»¶åç§»é‡åº”è®¾ç½®ä¸ºæµçš„æ–‡ä»¶ä½ç½®ï¼Œå¹¶ä¸”ä»»ä½•æœªè¢«ä»æµä¸­è¯»å–çš„`ungetcï¼ˆï¼‰`æˆ–`ungetwcï¼ˆï¼‰`æ¨å›åˆ°æµä¸Šçš„å­—ç¬¦éƒ½å°†è¢«ä¸¢å¼ƒï¼ˆä¸å†è¿›ä¸€æ­¥æ”¹å˜æ–‡ä»¶åç§»é‡ï¼‰ã€‚\nå¦‚æœstream æ˜¯ç©ºæŒ‡é’ˆï¼Œåˆ™fflush()å°†å¯¹ä¸Šé¢å®šä¹‰äº†è¡Œä¸ºçš„æ‰€æœ‰æµæ‰§è¡Œæ­¤åˆ·æ–°æ“ä½œã€‚\n\n### è¿”å›å€¼\n\nå¦‚æœæˆåŠŸåˆ·æ–°ï¼Œfflush è¿”å›0ã€‚æŒ‡å®šçš„æµæ²¡æœ‰ç¼“å†²åŒºæˆ–è€…åªè¯»æ‰“å¼€æ—¶ä¹Ÿè¿”å›0 å€¼ã€‚è¿”å›EOF æŒ‡å‡ºä¸€ä¸ªé”™è¯¯ã€‚\n\n### æ³¨æ„\n\nå¦‚æœfflush è¿”å›EOF,æ•°æ®å¯èƒ½ç”±äºå†™é”™è¯¯å·²ç»ä¸¢å¤±ã€‚å½“è®¾ç½®ä¸€ä¸ªé‡è¦é”™è¯¯å¤„ç†å™¨æ—¶,æœ€å®‰å…¨çš„æ˜¯ç”¨setvbufå‡½æ•°å…³é—­ç¼“å†²æˆ–è€…ä½¿ç”¨ä½çº§IOä¾‹ç¨‹,å¦‚openã€close å’Œwrite æ¥ä»£æ›¿æµI/O å‡½æ•°ã€‚\n\n### å…¶ä»–ç”¨æ³•\n\n`fflush(stdin)`åˆ·æ–°æ ‡å‡†è¾“å…¥ç¼“å†²åŒºï¼ŒæŠŠè¾“å…¥ç¼“å†²åŒºé‡Œçš„ä¸œè¥¿ä¸¢å¼ƒ[éæ ‡å‡†]\n`fflush(stdout)`åˆ·æ–°æ ‡å‡†è¾“å‡ºç¼“å†²åŒºï¼ŒæŠŠè¾“å‡ºç¼“å†²åŒºé‡Œçš„ä¸œè¥¿æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡ä¸Š\n\n### æ³¨æ„äº‹é¡¹\n\nC å’Œ`C++`çš„æ ‡å‡†é‡Œä»æ¥æ²¡æœ‰å®šä¹‰è¿‡`fflush(stdin)`ã€‚ä¹Ÿè®¸æœ‰äººä¼šè¯´ï¼šâ€œå¯æ˜¯æˆ‘ç”¨`flush(stdin)`è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œä½ æ€ä¹ˆèƒ½è¯´æ˜¯é”™çš„å‘¢ï¼Ÿâ€çš„ç¡®ï¼ŒæŸäº›ç¼–è¯‘å™¨ï¼ˆå¦‚VC6ï¼‰æ”¯æŒç”¨ `fflush(stdin)`æ¥æ¸…ç©ºè¾“å…¥ç¼“å†²ï¼Œä½†æ˜¯å¹¶éæ‰€æœ‰ç¼–è¯‘å™¨éƒ½æ”¯æŒè¿™ä¸ªåŠŸèƒ½ï¼ˆlinux ä¸‹çš„gcc å°±ä¸æ”¯æŒï¼‰ï¼Œå› ä¸ºæ ‡å‡†ä¸­æ ¹æœ¬æ²¡æœ‰å®šä¹‰`fflush(stdin)`ã€‚MSDN æ–‡æ¡£é‡Œä¹Ÿæ¸…æ¥šåœ°å†™ç€ï¼šfflush on input stream is an extension to the C standard ï¼ˆfflush æ“ä½œè¾“å…¥æµæ˜¯å¯¹C æ ‡å‡†çš„æ‰©å……ï¼‰ã€‚\nä»¥ä¸‹æ˜¯ C99 å¯¹ fflush å‡½æ•°çš„å®šä¹‰ï¼š\n`int fflush(FILE *stream);`\nå¦‚æœstream æŒ‡å‘è¾“å‡ºæµæˆ–è€…æ›´æ–°æµï¼ˆupdate streamï¼‰ï¼Œå¹¶ä¸”è¿™ä¸ªæ›´æ–°æµæœ€è¿‘æ‰§è¡Œçš„æ“ä½œä¸æ˜¯è¾“å…¥ï¼Œé‚£ä¹ˆfflushå‡½æ•°å°†æŠŠä»»ä½•æœªè¢«å†™å…¥çš„æ•°æ®å†™å…¥stream æŒ‡å‘çš„æ–‡ä»¶ï¼ˆå¦‚æ ‡å‡†è¾“å‡ºæ–‡ä»¶stdoutï¼‰ã€‚å¦åˆ™ï¼Œfflush å‡½æ•°çš„è¡Œä¸ºæ˜¯ä¸ç¡®å®šçš„ã€‚`fflushï¼ˆNULLï¼‰`æ¸…ç©ºæ‰€æœ‰è¾“å‡ºæµå’Œä¸Šé¢æåˆ°çš„æ›´æ–°æµã€‚å¦‚æœå‘ç”Ÿå†™é”™è¯¯ï¼Œflush å‡½æ•°ä¼šç»™é‚£äº›æµæ‰“ä¸Šé”™è¯¯æ ‡è®°ï¼Œå¹¶ä¸”è¿”å›EOFï¼Œå¦åˆ™è¿”å›0ã€‚\nç”±æ­¤å¯çŸ¥ï¼Œå¦‚æœ stream æŒ‡å‘è¾“å…¥æµï¼ˆå¦‚ stdinï¼‰ï¼Œé‚£ä¹ˆ fflush å‡½æ•°çš„è¡Œä¸ºæ˜¯ä¸ç¡®å®šçš„ã€‚æ•…è€Œä½¿ç”¨`fflush(stdin)`æ˜¯ä¸æ­£ç¡®çš„ã€‚\n\n## setbuf\n```cpp\nvoid setbuf( FILE *stream, char *buffer );\n```\n### åŠŸèƒ½\n\nè®¾ç½®ç”¨äºæµæ“ä½œçš„å†…éƒ¨ç¼“å†²åŒºã€‚å…¶é•¿åº¦è‡³å°‘åº”è¯¥ä¸º BUFSIZ ä¸ªå­—ç¬¦ã€‚\nè‹¥ buffer éç©ºï¼Œåˆ™ç­‰ä»·äº`setvbuf(stream, buffer, _IOFBF, BUFSIZ)`\nè‹¥ buffer ä¸ºç©ºï¼Œåˆ™ç­‰ä»·äº`setvbuf(stream, NULL, _IONBF, 0)`ï¼Œè¿™ä¼šå…³é—­ç¼“å†²ã€‚\n\n### å‚æ•°\n\nstream :è¦è®¾ç½®ç¼“å†²åŒºçš„æ–‡ä»¶æµ\nbuffer:æŒ‡å‘æ–‡ä»¶æµæ‰€ç”¨çš„ç¼“å†²åŒºçš„æŒ‡é’ˆã€‚è‹¥æä¾›ç©ºæŒ‡é’ˆï¼Œåˆ™å…³é—­ç¼“å†²ã€‚\n\n### è¿”å›å€¼\n\næ— \n\n### æ³¨è§£\n\nè‹¥ BUFSIZ ä¸æ˜¯é€‚åˆçš„ç¼“å†²åŒºå¤§å°ï¼Œåˆ™èƒ½ç”¨ setvbuf æ›´æ”¹å®ƒã€‚\nsetvbuf äº¦åº”å½“ç”¨äºæ£€æµ‹é”™è¯¯ï¼Œå› ä¸º setbuf ä¸æŒ‡ç¤ºæˆåŠŸæˆ–å¤±è´¥ã€‚\næ­¤å‡½æ•°ä»…å¯åœ¨å·²å°† stream å…³è”åˆ°æ‰“å¼€çš„æ–‡ä»¶åï¼Œä½†è¦åœ¨ä»»ä½•å…¶ä»–æ“ä½œï¼ˆé™¤äº†å¯¹ setbuf/setvbuf çš„å¤±è´¥è°ƒç”¨ï¼‰å‰ä½¿ç”¨ã€‚\n\nä¸€ä¸ªå¸¸è§é”™è¯¯æ˜¯è®¾ç½® stdin æˆ– stdout çš„ç¼“å†²åŒºä¸ºç”Ÿå­˜æœŸåœ¨ç¨‹åºç»ˆæ­¢å‰ç»“æŸçš„æ•°ç»„ï¼š\n\n```c\nint main(void) {\nchar buf[BUFSIZ];\nsetbuf(stdin, buf);\n} // buf çš„ç”Ÿå­˜æœŸç»“æŸï¼Œæœªå®šä¹‰è¡Œä¸º\n```\n\nç¤ºä¾‹\n\n```c\nint main()\n{\n\tchar buff[256];\n\tint a = 10, b = 20;\n\tFILE *pf = fopen(\"yhp.txt\",\"w\");\n\tsetbuf(pf,buff);\n\tfprintf(pf,\"a = %d b = %d \\n\",a,b);\n\tfclose(pf);\n\tpf = NULL;\n\treturn 0;\n}\n```\n\n## setvbuf\n```cpp\nint setvbuf( FILE * stream, char * buffer, int mode, size_t size );\n```\nä»¥ mode æ‰€æŒ‡ç¤ºå€¼æ›´æ”¹ç»™å®šæ–‡ä»¶æµ stream çš„ç¼“å†²æ¨¡å¼ã€‚å¦å¤–ï¼Œ\nâ–ª è‹¥ buffer ä¸ºç©ºæŒ‡é’ˆï¼Œåˆ™é‡è®¾å†…éƒ¨ç¼“å†²åŒºå¤§å°ä¸º size ã€‚\nâ–ª è‹¥ buffer ä¸æ˜¯ç©ºæŒ‡é’ˆï¼Œåˆ™æŒ‡ç¤ºæµä½¿ç”¨å§‹äº buffer è€Œå¤§å°ä¸º size çš„ç”¨æˆ·æä¾›ç¼“å†²åŒºã€‚å¿…é¡»åœ¨ buffer æ‰€æŒ‡å‘çš„æ•°ç»„çš„ç”Ÿå­˜æœŸç»“æŸå‰ï¼ˆç”¨ fclose ï¼‰å…³é—­æµã€‚æˆåŠŸè°ƒç”¨ setvbuf åï¼Œæ•°ç»„å†…å®¹ä¸ç¡®å®šï¼Œè€Œä»»ä½•ä½¿ç”¨å®ƒçš„å°è¯•æ˜¯æœªå®šä¹‰è¡Œä¸ºã€‚\n### å‚æ•°\n\nstreamï¼šè¦è®¾ç½®ç¼“å†²çš„æ–‡ä»¶æµ\nbufferï¼šæŒ‡å‘è¦ä½¿ç”¨çš„æµç¼“å†²åŒºçš„æŒ‡é’ˆï¼Œæˆ–è‹¥ä»…æ›´æ”¹å¤§å°å’Œæ¨¡å¼åˆ™ä¸ºç©ºæŒ‡é’ˆ\nmodeï¼šä½¿ç”¨çš„ç¼“å†²æ¨¡å¼ã€‚å®ƒèƒ½æ˜¯ä¸‹åˆ—å€¼ä¹‹ä¸€ï¼š\n\n1. \\_IOFBF: å…¨ç¼“å†²ï¼Œå½“ç¼“å†²åŒºä¸ºç©ºæ—¶ï¼Œä»æµè¯»å…¥æ•°æ®ã€‚æˆ–è€…å½“ç¼“å†²åŒºæ»¡æ—¶ï¼Œå‘æµå†™å…¥æ•°æ®ã€‚\n2. \\_IOLBF: è¡Œç¼“å†²ï¼Œæ¯æ¬¡ä»æµä¸­è¯»å…¥ä¸€è¡Œæ•°æ®æˆ–å‘æµä¸­å†™å…¥ä¸€è¡Œæ•°æ®ã€‚\n3. \\_IONBF: æ— ç¼“å†²ï¼Œç›´æ¥ä»æµä¸­è¯»å…¥æ•°æ®æˆ–ç›´æ¥å‘æµä¸­å†™å…¥æ•°æ®ï¼Œç¼“å†²è®¾ç½®æ— æ•ˆã€‚\n\nsizeï¼šç¼“å†²åŒºçš„å¤§å°\n\n### è¿”å›å€¼\n\næˆåŠŸæ—¶ä¸º0ï¼Œå¤±è´¥æ—¶ä¸ºéé›¶ã€‚\n\n### æ³¨æ„\n\næ­¤å‡½æ•°ä»…å¯åœ¨å·²å°† stream å…³è”åˆ°æ‰“å¼€çš„æ–‡ä»¶åï¼Œä½†è¦åœ¨ä»»ä½•å…¶ä»–æ“ä½œï¼ˆé™¤äº†å¯¹ setbuf/setvbuf çš„å¤±è´¥è°ƒç”¨ï¼‰å‰ä½¿ç”¨ã€‚ä¸æ˜¯æ‰€æœ‰ size å­—èŠ‚éƒ½éœ€è¦ç”¨äºç¼“å†²ï¼šå®é™…ç¼“å†²åŒºå¤§å°é€šå¸¸å‘ä¸‹å–æ•´åˆ° 2 çš„å€æ•°ã€é¡µé¢å¤§å°çš„å€æ•°ç­‰ã€‚\nå¤šæ•°å®ç°ä¸Šï¼Œè¡Œç¼“å†²ä»…å¯¹ç»ˆç«¯è¾“å…¥æµå¯ç”¨ã€‚\nä¸€ä¸ªå¸¸è§é”™è¯¯æ˜¯è®¾ç½® stdin æˆ– stdout çš„ç¼“å†²åŒºä¸ºç”Ÿå­˜æœŸåœ¨ç¨‹åºç»ˆæ­¢å‰ç»“æŸçš„æ•°ç»„ï¼š\n\n```c\nint main(void) {\nchar buf[BUFSIZ];\nsetbuf(stdin, buf);\n} // buf çš„ç”Ÿå­˜æœŸç»“æŸï¼Œæœªå®šä¹‰è¡Œä¸º\n```\n\næœŸå¾…é»˜è®¤ç¼“å†²åŒºå¤§å° BUFSIZ ä¸ºå®ç°ä¸Šæ–‡ä»¶ I/O çš„æœ€é«˜æ•ˆç¼“å†²åŒºå¤§å°ï¼Œä½† POSIX fstat ç»å¸¸æä¾›æ›´å¥½çš„ä¼°è®¡ã€‚\n\n# æ–‡ä»¶ä½ç½®\n\n| å‡½æ•°å  | æè¿°                                   |\n| ------- | -------------------------------------- |\n| ftell   | è¿”å›å½“å‰çš„æ–‡ä»¶ä½ç½®æŒ‡ç¤ºå€¼               |\n| fgetpos | è·å–æ–‡ä»¶ä½ç½®æŒ‡ç¤ºå™¨                     |\n| fseek   | å°†æ–‡ä»¶ä½ç½®æŒ‡ç¤ºç¬¦ç§»åŠ¨åˆ°æ–‡ä»¶ä¸­çš„æŒ‡å®šä½ç½® |\n| fsetpos | å°†æ–‡ä»¶ä½ç½®æŒ‡ç¤ºå™¨ç§»åŠ¨åˆ°æ–‡ä»¶ä¸­çš„æŒ‡å®šä½ç½® |\n| rewind  | å°†æ–‡ä»¶ä½ç½®æŒ‡ç¤ºå™¨ç§»åŠ¨åˆ°æ–‡ä»¶é¦–           |\n\n## å½“å‰çš„æ–‡ä»¶ä½ç½®\n```cpp\nlong ftell(FILE *stream);\n```\n\næ³¨ï¼šlongå å››ä¸ªå­—èŠ‚ï¼ŒèŒƒå›´ä¸º`-2^31~2^31-1`ã€‚å®é™…ä¸Šå’Œintä¸€æ ·ã€‚å› ä¸ºintå½“å¹´æœ‰æ—¶æ˜¯å ä¸¤ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥å‡ºç°äº†longã€‚è€Œåæ¥intä¹Ÿå˜ä¸º4äº†ï¼Œlongæ²¡å˜ã€‚\n\nè¿”å›streamçš„**æ–‡ä»¶ä½ç½®æŒ‡ç¤ºå€¼**ã€‚\nè‹¥æµä»¥äºŒè¿›åˆ¶æ¨¡å¼æ‰“å¼€ï¼Œåˆ™ç”±æ­¤å‡½æ•°è·å¾—çš„å€¼æ˜¯ä»æ–‡ä»¶å¼€å§‹çš„å­—èŠ‚æ•°ã€‚\nè‹¥æµä»¥æ–‡æœ¬æ¨¡å¼æ‰“å¼€ï¼Œåˆ™ç”±æ­¤å‡½æ•°è¿”å›çš„å€¼æœªæŒ‡å®šï¼Œä¸”ä»…ä½œä¸º `fseek()` çš„è¾“å…¥æ‰æœ‰æ„ä¹‰ã€‚\n\n### å‚æ•°\n\nstreamï¼šè¦æ£€éªŒçš„æ–‡ä»¶æµ\n\n### è¿”å›å€¼\n\næˆåŠŸæ—¶ä¸ºæ–‡ä»¶ä½ç½®æŒ‡ç¤ºå™¨ï¼Œè‹¥å¤±è´¥å‘ç”Ÿåˆ™ä¸º `-1L` ã€‚å¤±è´¥æ—¶ï¼Œè®¾ errno å¯¹è±¡ä¸ºå®ç°å®šä¹‰çš„æ­£å€¼ã€‚\n\n```c\nint main()\n{\n    int ar[]={12,23,34,45,56,67,78,89,90,100};\n    int n = sizeof(ar)/sizeof(ar[0]);\n    FILE* pf = NULL;\n    //pfa = fopen(\"yhp.txt\",\"w\");//VS2019ä¸­ä¸èƒ½è¿è¡Œ\n    erron_t tag = fopen_s(&pf,\"yhp.txt\",\"w\");//æ­¤æ—¶pfaæŒ‡é’ˆå°±æŒ‡å‘äº†ç³»ç»Ÿäº§ç”Ÿçš„ä¸€ä¸ªæ–‡ä»¶æµå¯¹è±¡ã€‚é‚£ä¹ˆå¯¹æ–‡ä»¶æµå¯¹è±¡çš„æ“ä½œå°±å¯ä»¥é—´æ¥æ“ä½œç£ç›˜ä¸­çš„æ•°æ®ã€‚æ–‡ä»¶æµå¯¹è±¡å†…éƒ¨åŒ…å«ç¼“å†²åŒºã€‚//\"a\"ä»£è¡¨è¿½åŠ å†™å…¥ï¼Œå¹¶ä¸”æ‰¾ä¸åˆ°æ–‡ä»¶æ—¶ä¸»åŠ¨åˆ›å»ºã€‚\n    if(NULL==pfa)\n    {\n        printf(\"open file error: %d\\n\",tag);\n        exit(EXIT_FAILURE);\n    }\n    \n    long pos;\n    for(int i=0;i<n;++i)\n    {\n        pos = ftell(pf);\n        printf(\"%d \",pos);\n        fprintf(pf,\"%5d\",ar[i]);\n        //posä»0å¼€å§‹ï¼Œæ¯æ¬¡è°ƒç”¨ä¸€æ¬¡fprintfåposéƒ½ä¼šåŠ 5\n        //å³å±å¹•è¾“å‡º0 5 10 15 20 ...\n    }\n    fclose(pf);\n    pfa = NULL;\n    return 0;\n}\n```\n\n## fgetpos\n```cpp\nint fgetpos(FILE * stream, fpos_t * pos );\n```\n\næ³¨ï¼š`fpos_t`æ˜¯`__int`ç±»å‹ï¼Œå³64ä½æ•´å‹ã€‚åœ¨32ä½æœºä¸­ï¼Œç”¨è¿™ç§è¡¨ç¤º64ä½æ•´å‹æ•°æ®ï¼Œè€Œåœ¨C99åæ–°å¢äº†long longç±»å‹ï¼Œå®é™…ä¸Šå’Œ`__int`ä¸€æ ·ã€‚åªæ˜¯ä¸åŒç¼–è¯‘å™¨ç¯å¢ƒä¸‹æ•ˆæœä¸åŒã€‚\nå…³äºCè¯­è¨€ä¸­long longä¸`__int64`çš„åŒºåˆ«ï¼šhttp://c.biancheng.net/cpp/html/2975.html\n\nè·å¾—æ–‡ä»¶æµ stream çš„æ–‡ä»¶ä½ç½®æŒ‡ç¤ºå™¨å’Œå½“å‰åˆ†æçŠ¶æ€ï¼ˆè‹¥å­˜åœ¨ï¼‰ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨äº pos æ‰€æŒ‡å‘çš„å¯¹è±¡ã€‚å­˜å‚¨çš„å€¼ä»…åœ¨ä½œä¸º fsetpos çš„è¾“å…¥çš„æƒ…å†µæœ‰æ„ä¹‰ã€‚\n\n### å‚æ•°\n\nstream è¦æ£€éªŒçš„æ–‡ä»¶æµ\npos æŒ‡å‘è¦å­˜å‚¨æ–‡ä»¶ä½ç½®æŒ‡ç¤ºå™¨åˆ°çš„ fpos_t å¯¹è±¡çš„æŒ‡é’ˆ\n\n### è¿”å›å€¼\n\næˆåŠŸæ—¶ä¸º0ï¼Œå¦åˆ™éé›¶å€¼ã€‚\n\n```c\nint main()\n{\n    int ar[]={12,23,34,45,56,67,78,89,90,100};\n    int n = sizeof(ar)/sizeof(ar[0]);\n    FILE* pf = NULL;\n    //pfa = fopen(\"yhp.txt\",\"w\");//VS2019ä¸­ä¸èƒ½è¿è¡Œ\n    erron_t tag = fopen_s(&pf,\"yhp.txt\",\"a\");//æ­¤æ—¶pfaæŒ‡é’ˆå°±æŒ‡å‘äº†ç³»ç»Ÿäº§ç”Ÿçš„ä¸€ä¸ªæ–‡ä»¶æµå¯¹è±¡ã€‚é‚£ä¹ˆå¯¹æ–‡ä»¶æµå¯¹è±¡çš„æ“ä½œå°±å¯ä»¥é—´æ¥æ“ä½œç£ç›˜ä¸­çš„æ•°æ®ã€‚æ–‡ä»¶æµå¯¹è±¡å†…éƒ¨åŒ…å«ç¼“å†²åŒºã€‚//\"a\"ä»£è¡¨è¿½åŠ å†™å…¥ï¼Œå¹¶ä¸”æ‰¾ä¸åˆ°æ–‡ä»¶æ—¶ä¸»åŠ¨åˆ›å»ºã€‚\n    if(NULL==pf)\n    {\n        printf(\"open file error: %d\\n\",tag);\n        exit(EXIT_FAILURE);\n    }\n    \n    fpos_t pos; //64ä½æ•´å‹\n    \n    for(int i=0;i<n;++i)\n    {\n        pos = ftell(pf);\n        fgetpos(pf,&pos)\n        printf(\"%d \",pos);\n        fprintf(pf,\"%d \",ar[i]);\n        //posä»0å¼€å§‹ï¼Œæ¯æ¬¡poséƒ½ä¼šåŠ è‹¥å¹²å€¼\n        //å³å±å¹•è¾“å‡º0 5 10 15 20 ...\n    }\n    fclose(pf);\n    pfa = NULL;\n    return 0;\n}\n```\n\n## â­æ–‡ä»¶ä½ç½®æŒ‡é’ˆç§»åŠ¨fseek\n```cpp\nint fseek(FILE *stream, long offset, int origin);\n```\n\nè®¾ç½®æ–‡ä»¶æµ stream çš„æ–‡ä»¶ä½ç½®æŒ‡ç¤ºå™¨ä¸º offset æ‰€æŒ‡å‘çš„å€¼ã€‚\n\n1. è‹¥ stream ä»¥äºŒè¿›åˆ¶æ¨¡å¼æ‰“å¼€ï¼Œåˆ™æ–°ä½ç½®å‡†ç¡®åœ°æ˜¯æ–‡ä»¶èµ·å§‹åï¼ˆè‹¥ origin ä¸º `SEEK_SET` ï¼‰æˆ–å½“å‰æ–‡ä»¶ä½ç½®åï¼ˆè‹¥ origin ä¸º `SEEK_CUR` ï¼‰ï¼Œæˆ–æ–‡ä»¶ç»“å°¾åï¼ˆè‹¥ origin ä¸º `SEEK_END` ï¼‰çš„ offset å­—èŠ‚ã€‚ä¸è¦æ±‚äºŒè¿›åˆ¶æµæ”¯æŒ `SEEK_END` ï¼Œå°¤å…¶æ˜¯æ˜¯å¦è¾“å‡ºé™„åŠ çš„ç©ºå­—èŠ‚ã€‚\n2. è‹¥ stream ä»¥æ–‡æœ¬æ¨¡å¼æ‰“å¼€ï¼Œåˆ™ä»…æœ‰çš„å—æ”¯æŒ offset å€¼ä¸ºé›¶ï¼ˆå¯ç”¨äºä»»ä½• origin ï¼‰å’Œå…ˆå‰åœ¨å…³è”åˆ°åŒä¸€ä¸ªæ–‡ä»¶çš„æµä¸Šå¯¹ ftell çš„è°ƒç”¨çš„è¿”å›å€¼ï¼ˆä»…å¯ç”¨äº SEEK_SET çš„ origin ï¼‰ã€‚\n3. è‹¥ stream ä¸ºå®½é¢å‘ï¼Œåˆ™ä¸€åŒåº”ç”¨å¯¹æ–‡æœ¬å’ŒäºŒè¿›åˆ¶æµçš„é™åˆ¶ï¼ˆå…è®¸ ftell çš„ç»“æœä¸ `SEEK_SET` ä¸€åŒä½¿ç”¨ï¼Œå¹¶å…è®¸é›¶ offset ä»¥ `SEEK_SET` å’Œ `SEEK_CUR` ä½†é `SEEK_END` ä¸ºåŸºå‡†ï¼‰ã€‚é™¤äº†æ›´æ”¹æ–‡ä»¶ä½ç½®æŒ‡ç¤ºå™¨ï¼Œ fseek è¿˜æ’¤é”€ ungetc çš„æ•ˆæœå¹¶æ¸…é™¤æ–‡ä»¶å°¾çŠ¶æ€ï¼Œè‹¥å¯åº”ç”¨ã€‚\nè‹¥å‘ç”Ÿè¯»æˆ–å†™é”™è¯¯ï¼Œåˆ™è®¾ç½®æµçš„é”™è¯¯æŒ‡ç¤ºå™¨ï¼ˆ ferror ï¼‰è€Œä¸å½±å“æ–‡ä»¶ä½ç½®ã€‚\n\n### å‚æ•°\n\nstreamï¼šè¦ä¿®æ”¹çš„æ–‡ä»¶æµ\noffsetï¼šç›¸å¯¹ origin è¿ç§»çš„å­—ç¬¦æ•°\noriginï¼šoffset æ‰€åŠ ä¸Šçš„ä½ç½®ã€‚å®ƒèƒ½æ‹¥æœ‰ä¸‹åˆ—å€¼ä¹‹ä¸€ï¼š `SEEK_SET`ï¼ˆä»èµ·å§‹ä½ç½®å¼€å§‹ç§»åŠ¨ï¼‰ã€ `SEEK_CUR`ï¼ˆå½“å‰ä½ç½®ï¼‰ã€ `SEEK_END`ï¼ˆæœ«å°¾ä½ç½®ï¼‰\n\n### è¿”å›å€¼\n\næˆåŠŸæ—¶ä¸º 0 ï¼Œå¦åˆ™ä¸ºéé›¶ã€‚\n\n### ä¸¾ä¾‹\n\næ¯”å¦‚æˆ‘ä»¬è°ƒç”¨äº†`fseek(pf, 2, SEEK_CUR);`é‚£ä¹ˆï¼Œæ–‡ä»¶ä½ç½®æŒ‡é’ˆå°†ä¼šä»å½“å‰ä½ç½®ï¼ˆ`SEEK_CUR`ï¼‰å‘ååç§»2å­—èŠ‚ã€‚å‡å¦‚è°ƒç”¨å‰æ–‡ä»¶ä½ç½®æŒ‡é’ˆæŒ‡å‘4ä½ç½®ï¼Œé‚£ä¹ˆè°ƒç”¨åæ–‡ä»¶ä½ç½®æŒ‡é’ˆå°†æŒ‡å‘6ã€‚\n\nç›¸åº”åœ°ï¼Œ`SEEK_SET`æ˜¯ä»0ä½ç½®å¼€å§‹ç§»åŠ¨çš„ã€‚`SEEK_END`æ˜¯ä»æ–‡ä»¶æœ«å°¾å¼€å§‹ç§»åŠ¨çš„ã€‚å¦‚æœæˆ‘ä»¬è°ƒç”¨`fseek(pf, 0, SEEK_END);`ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†ä½¿æ–‡ä»¶ä½ç½®æŒ‡é’ˆæŒ‡å‘æ–‡ä»¶æœ«å°¾ã€‚\n\n![image-20210825205704520](../../images/C_%E6%96%87%E4%BB%B6/image-20210825205704520.png)\n\n```C\n#include<stdio.h>\n#include<stdlib.h>\nint main()\n{\n    FILE* pf = NULL;\n    errno_t tag = fopen_s(&pf, \"Test8_25.cpp\", \"rb\");\n    if (NULL == pf)\n    {\n        printf(\"file open error: %d\\n\", tag);\n        exit(1);\n    }\n\n    fseek(pf, 0, SEEK_END);//ä¸ºäº†å¯ä»¥è·å–æ–‡ä»¶çš„é•¿åº¦ï¼Œæˆ‘ä»¬è¦è°ƒç”¨fseekå®ç°äº†æ–‡ä»¶ä½ç½®æŒ‡é’ˆæŒ‡å‘æ–‡ä»¶æœ«å°¾\n    //fseek(pfs, 1, SET_END);//æ–‡ä»¶ä½ç½®æŒ‡é’ˆæŒ‡å‘äº†æ–‡ä»¶æœ«å°¾å‰ä¸€ä¸ªï¼Œä¸æ˜¯åä¸€ä¸ª\n    int len = ftell(pf);\n    printf(\"%d \\n\", len);\n\n    fseek(pf, 0, SEEK_SET);//ç°åœ¨ä¸ºäº†è¦ä»å¤´è¾“å‡ºæ–‡ä»¶å†…å®¹ï¼Œæˆ‘ä»¬éœ€è¦å°†æ–‡ä»¶ä½ç½®æŒ‡é’ˆæŒ‡å‘æ–‡ä»¶å¼€å¤´ã€‚\n    //ä¹Ÿå¯ä»¥ä½¿ç”¨rewind(pf);\n    char ch;\n    for (int i = 0;i < len;++i)\n    {\n        fscanf_s(pf,\"%c\", &ch,1);\n        printf(\"%c\", ch);\n    }\n    fclose(pf);\n    pf = NULL;\n    return 0;\n}\n```\n### æ£˜æ‰‹çš„é—®é¢˜\n\nå¦‚æœæˆ‘ä»¬æ‰§è¡Œä¸Šè¿°ç¨‹åºã€‚ä¼šå‘ç°ï¼Œæ‰“å°å‡ºæ¥çš„æœ€åä¸€ä¸ªå­—ç¬¦ä¼šé‡å¤å¤šæ¬¡æ‰“å°ã€‚\n\n![image-20210825213347468](../../images/C_%E6%96%87%E4%BB%B6/image-20210825213347468.png)\n\næˆ‘ä»¬åœ¨scanfè¯­å¥æ‰§è¡Œä¸€æ¬¡åè¿›è¡Œå¯¹å˜é‡çš„ç›‘è§†ï¼Œå‘ç°æ–‡ä»¶ç»“æ„ä½“ä¸­çš„æˆå‘˜çš„ä¿¡æ¯æœ‰æ‰€ç«¯å€ªï¼š\n\n![image-20210825214922278](../../images/C_%E6%96%87%E4%BB%B6/image-20210825214922278.png)\n\næˆ‘ä»¬è®¡ç®—æ±‚å¾—çš„lenå€¼æ˜¯760ã€‚æ­¤å¤„çš„`_cnt`è¡¨ç¤ºè¿˜æœªè¯»å…¥çš„å‰©ä½™å­—èŠ‚æ•°ï¼Œä¸º731ä¸ªå·¦å³ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»–å®é™…æœ€å¤šå¯è¯»çš„æœ‰æ•ˆæ•°æ®æ˜¯731å·¦å³ä¸ªå­—èŠ‚ï¼Œä½†æˆ‘ä»¬å´è¾“å‡ºäº†760ä¸ªå­—èŠ‚ã€‚è¿™æ˜¾ç„¶ä¼šå‡ºé”™çš„ã€‚\n\né‚£ä¹ˆï¼Œ`_cnt`å’Œ`len`ä¸ºä½•æœ‰å·®å¼‚ï¼Ÿ\n\næ­¤æ—¶å°±è¦è°ˆè®ºåˆ°äºŒè¿›åˆ¶æ‰“å¼€å’Œæ–‡æœ¬æ ¼å¼æ‰“å¼€çš„å·®å¼‚äº†ï¼\n\næˆ‘ä»¬è¿™é‡Œçš„æ–‡ä»¶åœ¨VS2019ä¸­çš„ç¼–è¾‘å™¨ç¼–å†™çš„ï¼Œå³ä¸‹è§’çš„ç¼–è¾‘æ–¹å¼é»˜è®¤ä¸ºâ€œCRLFâ€ï¼Œå³æˆ‘ä»¬æŒ‰ä¸‹é”®ç›˜çš„â€œenterâ€é”®æ—¶ï¼Œç›¸å½“äºåœ¨æ–‡ä»¶ä¸­å­˜æ”¾äº†0D 0Aä¸¤ä¸ªæ§åˆ¶ç¬¦ï¼Œå³å›è½¦+æ¢è¡Œã€‚\n\n![image-20210825222544799](../../images/C_%E6%96%87%E4%BB%B6/image-20210825222544799.png)\n\nåˆ†æäº†å®é™…ä¿å­˜çš„å†…å®¹åã€‚å†åˆ†æï¼šæˆ‘ä»¬ä¸Šé¢çš„ç¨‹åºæ˜¯ræ–¹å¼æ‰“å¼€çš„ï¼Œå³æ–‡æœ¬æ–¹å¼æ‰“å¼€ã€‚æ–‡æœ¬æ–¹å¼æ‰“å¼€ï¼Œå¯¹äºfscanfå‡½æ•°æ¥è¯´ï¼Œâ€œ0D 0Aâ€åªè¯†åˆ«â€œ0Aâ€å³æ¢è¡Œç¬¦ï¼Œå¿½ç•¥â€œ0Dâ€å³å›è½¦ç¬¦ã€‚è¿™æ˜¯æ–‡æœ¬æ–‡ä»¶çš„ç‰¹æ®Šä¹‹å¤„ã€‚ä½†ï¼è™½ç„¶æ˜¯æ–‡æœ¬æ ¼å¼æ‰“å¼€çš„ï¼Œè€Œå¯¹äºfseekå‡½æ•°å’Œftellè€Œè¨€ä¸€è§†åŒä»ï¼Œéƒ½çœ‹ä½œæ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼ŒæŠŠ0Dä¹Ÿç®—äº†è¿›å»ã€‚æ‰€ä»¥ï¼Œlenæ¯”`_cnt`å¤šäº†29ä¸ªå­—èŠ‚ï¼ˆåˆšåˆšå¥½å’Œç¨‹åºä»£ç çš„è¡Œæ•°ä¸€æ ·ï¼Œæ‰€ä»¥è¿™ä¸æ˜¯å·§åˆï¼‰ã€‚\n\n**æ‰€ä»¥ï¼Œæ–‡æœ¬æ–‡ä»¶æ˜¯ä¸€ç§ç‰¹æ®Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œåœ¨æœ‰äº›ç¯å¢ƒä¸‹ï¼Œå¦‚æœä»¥æ–‡æœ¬æ–¹å¼æ‰“å¼€æ–‡ä»¶ï¼Œè§£ç å™¨å°†ä¼šè‡ªåŠ¨å¤„ç†å…¶ä¸­çš„æŸäº›æ•°æ®ï¼Œæ¯”å¦‚æŠŠ0D0Aä¸­çš„0Då»æ‰ï¼**\n\nç»è¿‡è°ƒè¯•ï¼Œfscanfè¯»å–äº†731ä¸ªå­—èŠ‚ä¹‹åï¼Œfscanfå°±ä¸ä¼šå†è¯»å…¥æœ‰æ•ˆæ•°æ®ç»™chäº†ï¼Œå› æ­¤chçš„å€¼ä¸ä¼šæ”¹å˜ï¼Œå°†ä¼šå®šæ ¼åœ¨æ–‡ä»¶çš„æœ€åä¸€ä¸ªå­—ç¬¦ã€‚æ“è›‹çš„åœ°æ–¹å°±åœ¨äº`fscanf_s`å‡½æ•°ä¹Ÿæ²¡ç»™æˆ‘ä»¬æŠ¥é”™ï¼Œå·å·åœ°å°†å…¶ç»“æ„ä½“ä¸­æˆå‘˜`_ptr`æŒ‡å‘äº†æ–‡ä»¶çš„å¼€å¤´ï¼Œå³`_base`çš„å€¼ã€‚\n\n![image-20210825222217114](../../images/C_%E6%96%87%E4%BB%B6/image-20210825222217114.png)\n\nåˆ†æè‡³æ­¤ï¼Œå› ä¸ºchçš„å€¼æ²¡æœ‰å˜åŒ–ï¼Œä¾æ—§æ˜¯`}`ï¼Œè€Œå¾ªç¯ä»åœ¨ç»§ç»­ï¼Œæ‰€ä»¥æ‰“å°äº†æ–‡æœ¬æ–‡ä»¶çš„è¡Œæ•°çš„ä¸ªæ•°çš„`}`ï¼\n\nå› æ­¤ï¼Œç»è¿‡ä¸Šè¿°åˆ†æåï¼Œæˆ‘ä»¬è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ä¸ªã€‚\n\nä¸€æ˜¯ä»¥â€œrbâ€æ–¹å¼æ‰“å¼€æ–‡æœ¬æ–‡ä»¶ã€‚\n\näºŒæ˜¯ç”¨pfç»“æ„ä½“ä¸­çš„å®é™…å‰©ä½™è¯»å…¥æ•°ç›®å€¼æ¥ä»£æ›¿lenã€‚\n\n```c\n#include<stdio.h>\n#include<stdlib.h>\nint main()\n{\n    FILE* pf = NULL;\n    errno_t tag = fopen_s(&pf, \"Test8_25.cpp\", \"rb\");\n    if (NULL == pf)\n    {\n        printf(\"file open error: %d\\n\", tag);\n        exit(1);\n    }\n\n    fseek(pf, 0, SEEK_END);//ä¸ºäº†å¯ä»¥è·å–æ–‡ä»¶çš„é•¿åº¦ï¼Œæˆ‘ä»¬è¦è°ƒç”¨fseekå®ç°äº†æ–‡ä»¶ä½ç½®æŒ‡é’ˆæŒ‡å‘æ–‡ä»¶æœ«å°¾\n    //fseek(pfs, 1, SET_END);//æ–‡ä»¶ä½ç½®æŒ‡é’ˆæŒ‡å‘äº†æ–‡ä»¶æœ«å°¾å‰ä¸€ä¸ªï¼Œä¸æ˜¯åä¸€ä¸ª\n    fseek(pf, 0, SEEK_SET);//ç°åœ¨ä¸ºäº†è¦ä»å¤´è¾“å‡ºæ–‡ä»¶å†…å®¹ï¼Œæˆ‘ä»¬éœ€è¦å°†æ–‡ä»¶ä½ç½®æŒ‡é’ˆæŒ‡å‘æ–‡ä»¶å¼€å¤´ã€‚\n    \n    \n    char ch;\n    fscanf_s(pf,\"%c\",&ch);\n    int len = pf->_cnt;\t//æ”¹ä¸ºå®é™…çš„å‰©ä½™è¦è¯»çš„æ•°ç›®\n    for (int i = 0;i < len;++i)\n    {\n        fscanf_s(pf,\"%c\", &ch,1);\n        printf(\"%c\", ch);\n    }\n    fclose(pf);\n    pf = NULL;\n    return 0;\n}\n```\n\n### äºŒè¿›åˆ¶æ–‡ä»¶çš„æ¡ˆä¾‹\n\n```c\nint main()\n{\n    const int n = 10;\n    int ar[n] = {0,1,2,3,4,5,6,7,8,9};\n    FILE* pf = NULL;\n    errno_t tag = fopen_s(&pf,\"TestBin.txt\",\"wb\");\n    if(NULL==pf)\n    {\n        exit(1);\n    }\n    fwrite(ar,sizeof(int),n,pf);\n    fclose(pf);\n    pf=nullptr;\n    ////////////////\n    tag = fopen_s(&pf,\"TestBin.txt\".\"rb\");\n    if(NULL=pf)\n    {\n        exit(1);\n    }\n    int val;\n    int pos;\n    while(1)\n    {\n        scanf_s(\"%d\",&pos);\n        if(pos<0)break;\n        fseek(pf,pos,SEEK_SET);//åç§»posä¸ªå­—èŠ‚\n        fread(&val,sizeof(int),1,pf);//å‚æ•°æ„ä¹‰ï¼šè¯»å‡ºåˆ°å“ªä¸ªå˜é‡ï¼Œä¸€æ¬¡è¯»å¤šå°‘å­—èŠ‚ï¼Œä¸€æ¬¡è¯»å‡ ä¸ªï¼Œä»å“ªä¸ªæ–‡ä»¶è¯»\n        printf(\"%d \\n\",val);\n    }\n    fclose(pf);\n    pf=nullptr;\n    return 0;\n}\n```\n\n**æ•…æ„ç•™å‘**ï¼šè¿™ä¸ªç¨‹åºåŸæœ¬çš„æ„æ€æƒ³è¦è¾¾åˆ°â€œæ–‡ä»¶ä¸­å­˜å‚¨äº†æ•°æ®`â€˜0 1 2 3 4 5 6 7 8 9â€™`ï¼Œæˆ‘ä»¬è¾“å…¥`0`ï¼Œå°±è¾“å‡ºæ–‡ä»¶ä¸­åç§»0ä½ç½®çš„æ•´å‹å€¼0ï¼›è¾“å…¥1ï¼Œæœ¬åº”è¯¥è¾“å‡ºæ–‡ä»¶ä¸­åç§»1ä½ç½®çš„æ•´å‹å€¼1â€ã€‚ä½†æ˜¯ï¼Œè¿è¡Œæµ‹è¯•å‘ç°è¾“å…¥1ç¨‹åºè¾“å‡ºçš„æ˜¯16777216ã€‚\n\n![image-20210825225705167](../../images/C_%E6%96%87%E4%BB%B6/image-20210825225705167.png)\n\né€šè¿‡å¯¹è¿™ä¸ªæ•°çš„è§‚å¯Ÿï¼Œè½¬ä¸º16è¿›åˆ¶æˆ‘ä»¬å‘ç°ä»–æ˜¯â€œ0100 0000â€ã€‚\n\nå·²ç»æœ‰äº›ç«¯å€ªäº†ï¼Œé‚£å°±æ˜¯â€œ`fseek(pf,pos,SEEK_SET);//åç§»posä¸ªå­—èŠ‚`â€è¿™é‡Œå‡ºé”™äº†ã€‚æ­£ç¡®çš„å†™æ³•åº”è¯¥æ˜¯`fseek(pf,pos*(sizeof(int) )  ),SEEK_SET);//åç§»4*posä¸ªå­—èŠ‚`ï¼Œå› ä¸ºintå‹å 4å­—èŠ‚ã€‚\n\né‚£ä¹ˆæˆ‘ä»¬åˆ†æä¸€ä¸‹ï¼Œä¸ºä½•åªåç§»1ä¸ªå­—èŠ‚æ—¶ä¼šæ‰“å°16777216?\n\nå› ä¸ºå‰å››ä¸ªå­—èŠ‚å­˜çš„æ˜¯â€œ00 00 00 00â€ï¼Œä¹‹åæ˜¯â€œ01 00 00 00â€ã€‚æˆ‘ä»¬åªåç§»äº†ä¸€ä¸ªå­—èŠ‚ï¼Œè¯»å–çš„æ˜¯â€œ00 00 00 01â€ï¼ç„¶è€Œï¼æˆ‘ä»¬è¿˜è¦æ¸…é†’çš„æ˜¯ï¼æˆ‘ä»¬åœ¨å†…å­˜ä¸­é»˜è®¤ä¸‹çš„çŠ¶æ€æ˜¯å°ç«¯å­˜æ”¾æ•°æ®ï¼Œå› æ­¤01æ˜¯é«˜ä½ï¼äººç±»çš„è¯»æ•°æ®é¡ºåºåº”è¯¥æ˜¯â€œ01 00 00 00â€ï¼Œå› æ­¤ç®—ä¸‹æ¥æ˜¯16777216ï¼åˆ°æ­¤ï¼Œæˆ‘åªæœ‰ä¸€å¥æ„Ÿæ…¨ï¼Œé‚£å°±æ˜¯è®¡ç®—æœºä¸­å¤„å¤„éƒ½æ˜¯å‘å•Šï¼éƒ½æ˜¯åŸºç¡€çŸ¥è¯†ç‚¹çš„ä½“ç°ï¼\n\n![image-20210825230416632](../../images/C_%E6%96%87%E4%BB%B6/image-20210825230416632.png)\n\nå› æ­¤ï¼Œæ”¹æ­£ä»¥ä¸‹è¯­å¥ã€‚ç¨‹åºæ‰èƒ½è¾¾åˆ°é¢„æœŸçš„æ•ˆæœã€‚\n\n```c\nfseek(pf,pos*sizeof(int),SEEK_SET);//åç§»(pos*intå¤§å°)ä¸ªå­—èŠ‚\n```\n\n### æ€»ç»“\n\næ–‡ä»¶å®šä½æŒ‡é’ˆå‡½æ•°å¦‚fseekã€ftellå¯¹äºŒè¿›åˆ¶æ–‡ä»¶æ˜¯æœ€åˆé€‚çš„ã€‚\n\nscanfå¯¹æ–‡æœ¬æ–‡ä»¶æ“ä½œæ›´åˆé€‚ã€‚\n\nå› æ­¤ï¼Œä¸è¦æ‹¿scanfå»è¯»å–fseekã€ftellæ“ä½œè¿‡çš„æ–‡ä»¶ã€‚\n\n## fsetpos\n```cpp\nint fsetpos( FILE *stream, const fpos_t *pos );\n```\næŒ‰ç…§ pos æ‰€æŒ‡å‘çš„å€¼ï¼Œè®¾ç½®æ–‡ä»¶æµ stream çš„æ–‡ä»¶ä½ç½®æŒ‡ç¤ºå™¨å’Œå¤šå­—èŠ‚åˆ†æçŠ¶æ€ï¼ˆè‹¥å­˜åœ¨ï¼‰ã€‚\né™¤äº†å»ºç«‹æ–°çš„åˆ†æçŠ¶æ€å’Œä½ç½®ï¼Œè°ƒç”¨æ­¤å‡½æ•°è¿˜ä¼šæ’¤é”€ ungetc çš„æ•ˆæœï¼Œå¹¶è‹¥è®¾ç½®äº†æ–‡ä»¶å°¾çŠ¶æ€åˆ™æ¸…é™¤ä¹‹ã€‚\nè‹¥è¯»æˆ–å†™å‡ºç°é”™è¯¯ï¼Œåˆ™è®¾ç½®æµçš„é”™è¯¯æŒ‡ç¤ºå™¨ï¼ˆ ferror ï¼‰ã€‚\nå‚æ•°\nstream è¦ä¿®æ”¹çš„æ–‡ä»¶æµ\npos æŒ‡å‘ fpos_t å¯¹è±¡çš„æŒ‡é’ˆï¼Œç”¨ä½œæ–‡ä»¶ä½ç½®æŒ‡ç¤ºå™¨çš„æ–°å€¼\nè¿”å›å€¼\næˆåŠŸæ—¶ä¸º 0 ï¼Œå¦åˆ™ä¸ºéé›¶å€¼ã€‚\n## rewind\n```cpp\nvoid rewind( FILE *stream );\n```\nç§»åŠ¨æ–‡ä»¶ä½ç½®æŒ‡ç¤ºå™¨åˆ°ç»™å®šæ–‡ä»¶æµçš„èµ·å§‹ã€‚å‡½æ•°ç­‰ä»·äº fseek(stream, 0, SEEK_SET); ï¼Œé™¤äº†å®ƒæ¸…é™¤æ–‡ä»¶å°¾å’Œé”™è¯¯\næŒ‡ç¤ºå™¨ã€‚\næ­¤å‡½æ•°ä¸¢å¼ƒä»»ä½•æ¥è‡ªå…ˆå‰å¯¹ ungetc è°ƒç”¨çš„æ•ˆæœã€‚\nå‚æ•°\nstream è¦ä¿®æ”¹çš„æ–‡ä»¶æµ\nè¿”å›å€¼ï¼ˆæ— ï¼‰\n\n# é”™è¯¯å¤„ç†\n\n| å‡½æ•°å   | å‡½æ•°åŠŸèƒ½                         |\n| -------- | -------------------------------- |\n| clearerr | æ¸…æ¥šé”™è¯¯                         |\n| feof     | æ£€æŸ¥æ–‡ä»¶ç»“å°¾                     |\n| ferror   | æ£€æŸ¥æ–‡ä»¶é”™è¯¯                     |\n| perror   | æ˜¾ç¤ºå¯¹åº”å½“å‰é”™è¯¯çš„å­—ç¬¦ä¸²åˆ°stderr |\n\n## clearerr\n```cpp\nvoid clearerr( FILE *stream );\n```\né‡ç½®ç»™å®šæ–‡ä»¶æµçš„é”™è¯¯æ ‡å¿—å’Œ EOF æŒ‡ç¤ºå™¨ã€‚\n\n### å‚æ•°\n\nstreamï¼š è¦é‡ç½®é”™è¯¯æ ‡å¿—çš„æ–‡ä»¶æµ\n\n### è¿”å›å€¼\n\næ— \n\n## â­feof\n```cpp\nint feof( FILE *stream );\n\n```\næ£€æŸ¥æ˜¯å¦å·²æŠµè¾¾ç»™å®šæ–‡ä»¶æµçš„ç»“å°¾ã€‚\n\n### å‚æ•°\n\nstream è¦æ£€éªŒçš„æ–‡ä»¶æµ\n\n### è¿”å›å€¼\n\nè‹¥å·²æŠµè¾¾æµå°¾åˆ™ä¸ºéé›¶å€¼ï¼Œå¦åˆ™ï¼ˆæœªæŠµè¾¾ï¼‰ä¸º 0\n\n### æ³¨æ„\n\næ­¤å‡½æ•°ä»…æŠ¥å‘Šæœ€è¿‘ä¸€æ¬¡ I/O æ“ä½œæ‰€æŠ¥å‘Šçš„æµçŠ¶æ€ï¼Œè€Œä¸æ£€éªŒå…³è”çš„æ•°æ®æºã€‚ä¾‹å¦‚ï¼Œè‹¥æœ€è¿‘ä¸€æ¬¡ I/O æ˜¯æŠµè¾¾æ–‡ä»¶æœ€\nåå­—èŠ‚çš„ fgetc ï¼Œåˆ™ feof è¿”å›é›¶ã€‚ä¸‹ä¸ª fgetc å¤±è´¥å¹¶æ›´æ”¹æµçŠ¶æ€ä¸ºæ–‡ä»¶å°¾ã€‚ç„¶å feof æ‰è¿”å›éé›¶ã€‚\nå…¸å‹ç”¨æ³•ä¸­ï¼Œè¾“å…¥æµå¤„ç†åœ¨ä»»ä½•é”™è¯¯æ—¶åœæ­¢ï¼›è€Œ feof å’Œ ferror ç”¨äºåŒºåˆ«ä¸åŒé”™è¯¯æ¡ä»¶ã€‚\n\n```c\n//æœ¬æ–‡ä»¶åä¸ºFileTest.cpp\n#include<stdio.h>\n#include<stdlib.h>\nint main()\n{\n    char ch;\n    FILE* pf = nullptr;\n    errno_t tag = fopen_s(&pf,\"FileTest.cpp\",\"r\");\n    if(nullptr==pf)\n    {\n        exit(1);\n    }\n    while(!feof(pf))//æœªæŠµè¾¾æœ«å°¾\n    {\n        ch = fgetc(pf);\n        printf(\"%c\",ch);\n    }\n    fclose(pf);\n    pf = nullptr;\n    return 0;\n}\n```\n\næ€ä¹ˆè¾¾åˆ°æ¨¡æ‹Ÿç¼“æ…¢æ‰“å­—çš„æ•ˆæœ\n\n```c\n#include<stdio.h>\n#include<stdlib.h>\n#include<Windows.h>\nint main()\n{\n    char ch;\n    FILE* pf = nullptr;\n    errno_t tag = fopen_s(&pf, \"Test8_25.cpp\", \"rb\");\n    if (nullptr == pf)\n    {\n        exit(1);\n    }\n    while (!feof(pf))//æœªæŠµè¾¾æœ«å°¾\n    {\n        ch = fgetc(pf);\n        printf(\"%c\", ch);\n        Sleep(50);\n    }\n    fclose(pf);\n    pf = nullptr;\n    return 0;\n}\n```\n\nå¦‚æœæƒ³è®©è¿™ä¸ªé€Ÿåº¦æ›´å¿«ä¸€äº›ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡å–â€œç¼“å­˜åŒºâ€æ€æƒ³ï¼Œæ¯æ¬¡å­˜20ä¸ªï¼Œæ‰“å°20ä¸ªã€‚ å¯ä»¥æé«˜æ‰“å°æ•ˆç‡\n\n```c\n#include<stdio.h>\n#include<stdlib.h>\n#include<Windows.h>\nint main()\n{\n    //char ch;\n    char str[20];\n    FILE* pf = nullptr;\n    errno_t tag = fopen_s(&pf, \"Test8_25.cpp\", \"rb\");\n    if (nullptr == pf)\n    {\n        exit(1);\n    }\n    while (!feof(pf))//æœªæŠµè¾¾æœ«å°¾\n    {\n        fgets(str,20,pf);\n        //puts(str);//printf(\"%s\\n\",str);\n        printf(\"%s\", str);\n        Sleep(1);\n    }\n    fclose(pf);\n    pf = nullptr;\n    return 0;\n}\n```\n\n## ferror\n```cpp\nint ferror( FILE *stream );\n\n```\næ£€æŸ¥ç»™å®šæ–‡ä»¶æµçš„é”™è¯¯ã€‚\n\n### å‚æ•°\n\nstream è¦æ£€æŸ¥çš„æ–‡ä»¶æµ\n\n### è¿”å›å€¼\n\nè‹¥æ–‡ä»¶æµå·²å‡ºç°é”™è¯¯åˆ™ä¸ºéé›¶å€¼ï¼Œå¦åˆ™ä¸º 0\n\n## perror\n```cpp\nvoid perror( const char *s );\n\n```\næ‰“å°å½“å‰å­˜å‚¨äºç³»ç»Ÿå˜é‡ errno çš„é”™è¯¯ç åˆ° stderr ã€‚\n\né€šè¿‡è¿æ¥ä¸‹åˆ—ç»„åˆ†æ„æˆæè¿°ï¼š\n* s æ‰€æŒ‡å‘çš„ç©ºç»ˆæ­¢å­—èŠ‚å­—ç¬¦ä¸²çš„å†…å®¹åéš \": \" ï¼ˆé™¤é s ä¸ºç©ºæŒ‡é’ˆæˆ– s æ‰€æŒ‡å‘å­—ç¬¦ä¸ºç©ºå­—ç¬¦ï¼‰å®ç°å®šä¹‰çš„ï¼Œæè¿°å­˜å‚¨äº errno çš„é”™è¯¯ç çš„é”™è¯¯æ¶ˆæ¯å­—ç¬¦ä¸²åéš`'\\n'`ã€‚\n* é”™è¯¯æ¶ˆæ¯å­—ç¬¦ä¸²ç­‰åŒäº `strerror(errno)` çš„ç»“æœã€‚\n### å‚æ•°\n\ns æŒ‡å‘å¸¦è§£é‡Šæ¶ˆæ¯çš„ç©ºç»ˆæ­¢å­—ç¬¦ä¸²çš„æŒ‡é’ˆ\n### è¿”å›å€¼\n\næ— \n\n# æ–‡ä»¶æ“ä½œ\n\n| å‡½æ•°å    | æè¿°                   |\n| --------- | ---------------------- |\n| remove    | åˆ é™¤æ–‡ä»¶               |\n| rename    | é‡å‘½åæ–‡ä»¶             |\n| tmpfile   | è¿”å›æŒ‡å‘ä¸´æ—¶æ–‡ä»¶çš„æŒ‡é’ˆ |\n| tmpfile_s | ï¼ˆc11ï¼‰                |\n\n## remove\n```cpp\nint remove( const char *fname );\n\n```\nåˆ é™¤ fname æ‰€æŒ‡å‘çš„å­—ç¬¦ä¸²æ‰€æ ‡è¯†çš„æ–‡ä»¶ã€‚è‹¥æ–‡ä»¶ä¸ºå½“å‰è¿›ç¨‹æˆ–å¦ä¸€è¿›ç¨‹æ‰“å¼€ï¼Œåˆ™æ­¤å‡½æ•°è¡Œä¸ºæ˜¯å®ç°å®šä¹‰çš„ã€‚å…·ä½“è€Œè¨€ï¼Œ POSIX ç³»ç»Ÿè§£é“¾æ¥æ–‡ä»¶åï¼Œåˆ°æœ€åä¸€ä¸ªè¿è¡Œçš„è¿›ç¨‹å…³é—­è¯¥æ–‡ä»¶ä¸ºæ­¢ï¼Œå³ä½¿è¿™æ˜¯æœ€åä¸€ä¸ªåˆ°æ–‡ä»¶çš„ç¡¬é“¾æ¥ä¹Ÿä¸å›æ”¶æ–‡ä»¶ç³»ç»Ÿç©ºé—´ã€‚ Windows ä¸å…è®¸åˆ é™¤è¯¥æ–‡ä»¶ã€‚\n\n### å‚æ•°\n\nfname æŒ‡å‘ç©ºç»ˆæ­¢å­—ç¬¦ä¸²çš„æŒ‡é’ˆï¼Œå­—ç¬¦ä¸²å«æ ‡è¯†å¾…åˆ é™¤æ–‡ä»¶çš„è·¯å¾„\n\n### è¿”å›å€¼\n\næˆåŠŸæ—¶ä¸º0ï¼Œé”™è¯¯æ—¶ä¸ºéé›¶å€¼ã€‚\n\n### æ³¨æ„\n\nPOSIX æŒ‡å®šæ­¤å‡½æ•°è¡Œä¸ºçš„è®¸å¤šé¢å¤–ç»†èŠ‚ã€‚\n\n## rename\n```cpp\nint rename( const char *old_filename, const char *new_filename );\n```\næ›´æ”¹æ–‡ä»¶çš„æ–‡ä»¶åã€‚è¯¥æ–‡ä»¶ä»¥ old_filename æ‰€æŒ‡å‘çš„å­—ç¬¦ä¸²æ ‡è¯†ã€‚æ–°æ–‡ä»¶åä»¥ `new_filename` æ‰€æŒ‡å‘çš„å­—ç¬¦ä¸²æ ‡è¯†ã€‚è‹¥ `new_filename` å­˜åœ¨ï¼Œåˆ™è¡Œä¸ºæ˜¯å®ç°å®šä¹‰çš„ã€‚\n\n### å‚æ•°\n\n`old_filename` æŒ‡å‘åŒ…å«æ ‡è¯†è¦é‡å‘½åçš„æ–‡ä»¶çš„è·¯å¾„çš„ç©ºç»ˆæ­¢å­—ç¬¦ä¸²çš„æŒ‡é’ˆ\n`new_filename` æŒ‡å‘åŒ…å«æ–‡ä»¶æ–°è·¯å¾„çš„ç©ºç»ˆæ­¢å­—ç¬¦ä¸²çš„æŒ‡é’ˆ\n\n### è¿”å›å€¼\n\næˆåŠŸæ—¶ä¸º0ï¼Œå¤±è´¥æ—¶ä¸ºéé›¶å€¼ã€‚\n\n# æ— æ ¼å¼è¾“å…¥/è¾“å‡º\n\nè¿™é‡Œçš„æ— æ ¼å¼çš„æ„æ€æ˜¯ï¼Œå¯¹äºŒè¿›åˆ¶æ–‡ä»¶å’Œæ–‡æœ¬æ–‡ä»¶éƒ½é€šç”¨ã€‚æ— è®ºæ˜¯ä»€ä¹ˆæ–‡ä»¶ï¼Œéƒ½ä¼šä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚åœ°è¯»å‡ºã€‚\n\nå°±æ¯”å¦‚putcharå‡½æ•°ï¼Œå½“æˆ‘ä»¬è¾“å…¥äº†ä¸€ä¸ªâ€œçƒ«â€æ—¶ï¼Œgetcharå´è¢«è°ƒç”¨äº†ä¸¤æ¬¡ã€‚è€Œä¸”åœ¨ç¬¬ä¸€ä¸ªputcharæ–­ç‚¹æ—¶ï¼Œè¾“ä¸å‡ºçƒ«ï¼Œè¿è¡Œå®Œç¬¬äºŒä¸ªputcharæ—¶ï¼Œæ‰å‡ºç°â€œçƒ«â€ã€‚è¯æ˜æ­¤ç±»`get/put`è¯»å†™å‡½æ•°æ˜¯é’ˆå¯¹å­—èŠ‚è€Œè¨€çš„ï¼Œè€Œä¸æ˜¯å®˜æ–¹æ–‡æ¡£ä¸­é’ˆå¯¹â€œå­—ç¬¦â€æ“ä½œã€‚\n\n```c\n#include<stdio.h>\n#include<stdlib.h>\nint main()\n{\n    char* pch = (char*)calloc(1,3);\n    for(int i = 0;i<2;++i)\n    {\n        pch[i] = getchar();\n    }\n    getchar();//æ¶ˆé™¤å›è½¦\n\tputchar(pch[0]);\n\tputchar(pch[1]);\n    return 0;\n}\n```\n\næ¯”å¦‚`getchar()`ï¼Œé€šè¿‡è°ƒè¯•ï¼Œæˆ‘ä»¬å‘ç°ï¼š\n\n```c\nint main()\n{\n    char test = getchar();\n    printf(\"%d\\n\",test);\n    test = getchar();\n    printf(\"%d\\n\",test);\n}\n```\n\nç¨‹åºè®©ä½ è¾“å…¥æ—¶ï¼Œä½ æŒ‰ä½Alté”®+å°é”®ç›˜çš„10ï¼Œæ„æ€æ˜¯å°†10è½¬æ¢ä¸ºä¸€ä¸ªASCIIç å­—ç¬¦ï¼Œ10è¡¨ç¤ºæ¢è¡Œï¼Œè¿™æ—¶æ§åˆ¶å°çš„è¾“å…¥æŒ‡ç¤ºæ ‡å¿—æŒªåˆ°äº†ä¸‹ä¸€è¡Œï¼Œä½†æ˜¯å±å¹•ä¸Šæ²¡æœ‰è¾“å‡ºâ€œ10â€ã€‚è¯´æ˜getcharå¯¹ASCIIç ä¸º10å¯¹åº”çš„æ¢è¡Œç¬¦ä¸æ•æ„Ÿã€‚\n\né‡æ–°è¿›å…¥ç¨‹åºï¼Œç¬¬ä¸€æ¬¡è¾“å…¥ï¼ŒæŒ‰ä½Alté”®+å°é”®ç›˜çš„13ï¼ˆä»…ä»…è¿›è¡Œæ­¤æ“ä½œï¼Œæ²¡æœ‰å¦å¤–æŒ‰enteré”®ï¼‰ï¼Œæ„æ€æ˜¯å°†13è½¬æ¢ä¸ºä¸€ä¸ªASCIIç å­—ç¬¦ï¼Œ13è¡¨ç¤ºå›è½¦ï¼Œè¿™æ—¶æ§åˆ¶å°ç«‹é©¬åœ¨ä¸‹ä¸€è¡Œæ˜¾ç¤ºäº†â€œ10â€å­—æ ·ã€‚è¿™è¯´æ˜ï¼Œæˆ‘ä»¬åœ¨æ§åˆ¶å°è¾“å…¥ä¸€ä¸ªâ€œASCIIç ä¸º13å¯¹åº”çš„å›è½¦ç¬¦â€æ—¶ï¼Œgetcharå¯¹å›è½¦ç¬¦æ•æ„Ÿï¼Œä»¿ä½›æ˜¯æŠŠå›è½¦ç¬¦å˜æˆäº†æ¢è¡Œç¬¦ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çŒœæµ‹ï¼Œç³»ç»Ÿå¯¹æ ‡å‡†è¾“å…¥è®¾å¤‡çš„å›è½¦æ“ä½œè§†ä¸ºæŸä¸€é˜¶æ®µçš„è¾“å…¥å®Œæˆï¼Œå¯ä»¥å¼€å§‹æ¨æµï¼Œå¹¶ä¸”æœ€ååŠ äº†ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚**ä»¥å‰æˆ‘ä»¬ä»¥ä¸ºæ¢è¡Œç¬¦æ‰æ˜¯æ§åˆ¶è¾“å…¥ç»“æŸçš„æ ‡å¿—ï¼Œç°åœ¨çœ‹æ¥ï¼Œå›è½¦ç¬¦æ‰æ˜¯ï¼**\n\n![image-20210826175900462](../../images/C_%E6%96%87%E4%BB%B6/image-20210826175900462.png)\n\næ¥ç€æµ‹è¯•ï¼Œé‡æ–°è¿›å…¥ç¨‹åºã€‚æˆ‘ä»¬ç¬¬ä¸€æ¬¡è¾“å…¥ï¼ŒæŒ‰ä½ALTé”®+10ï¼Œæ§åˆ¶å°çš„è¾“å…¥æ ‡å¿—åˆ‡åˆ°äº†ä¸‹ä¸€è¡Œï¼Œæ²¡æœ‰è¾“å‡ºæ•°æ®ã€‚ç¬¬äºŒæ¬¡è¾“å…¥ï¼ŒæŒ‰ä½ALTé”®+13ï¼ŒæŒ‰å®Œåï¼Œæ²¡æœ‰å…¶ä»–æ“ä½œï¼Œæ§åˆ¶å°è¾“å‡ºäº†ä¸¤è¡Œ10ã€‚è¿›ä¸€æ­¥è¯æ˜äº†æ¢è¡Œç¬¦10ä¸æ˜¯æ§åˆ¶è¾“å…¥ç»“æŸçš„æ ‡å¿—ï¼Œè€Œæ˜¯å›è½¦ç¬¦13ã€‚\n\n![image-20210826180447679](../../images/C_%E6%96%87%E4%BB%B6/image-20210826180447679.png)\n\nç„¶åï¼Œæˆ‘ä»¬åœ¨VS2019ç¼–è¾‘å™¨ä¸­åˆ›å»ºäº†ä¸€ä¸ªtxtæ–‡ä»¶ï¼Œä»¥æ–‡æœ¬æ ¼å¼ç¼–è¾‘æ—¶ï¼Œå³ä¸‹è§’æœ‰`CRLF/LF/CR`ä¸‰ç§æ¨¡å¼å¯ä»¥åˆ‡æ¢ï¼Œå½“ä½ é€‰æ‹©äº†å…¶ä¸­çš„ä¸€ç§æ¨¡å¼ï¼Œé‚£ä¹ˆä½ é”®ç›˜ä¸Šçš„enteré”®å°±å¯¹åº”ç€ä»€ä¹ˆæ„æ€ã€‚æ¯”å¦‚ï¼Œè‹¥æˆ‘ä»¬é€‰æ‹©äº†LFæ¨¡å¼ï¼ˆenterä¸ºæ¢è¡Œï¼‰ï¼Œé‚£ä¹ˆæŒ‰ä¸€ä¸‹enteré”®å°±æ„å‘³ç€ç»™æ–‡ä»¶è¾“å…¥äº†ä¸€ä¸ªâ€œ0Aâ€ï¼›è‹¥æˆ‘ä»¬é€‰æ‹©äº†CRæ¨¡å¼ï¼ˆenterä¸ºå›è½¦ï¼‰ï¼Œé‚£ä¹ˆæŒ‰ä¸€ä¸‹enteré”®å°±æ„å‘³ç€ç»™æ–‡ä»¶è¾“å…¥äº†ä¸€ä¸ªâ€œ0Dâ€ï¼›è‹¥æˆ‘ä»¬é€‰æ‹©äº†CRLFæ¨¡å¼ï¼ˆenterä¸ºå›è½¦+æ¢è¡Œï¼‰ï¼Œé‚£ä¹ˆæŒ‰ä¸€ä¸‹enteré”®å°±æ„å‘³ç€ç»™æ–‡ä»¶è¾“å…¥äº†ä¸€ä¸ªâ€œ0D 0Aâ€ï¼›\n\né‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥æ¨æ–­ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨è¾“å…¥æ—¶ï¼Œæ‰“ä¸€ä¸ªå›è½¦ä¼šç»“æŸè¾“å…¥å‘¢ï¼Ÿå…³é”®åœ¨äºæ§åˆ¶å°æ”¶åˆ°äº†â€œé˜¶æ®µç»“æŸæ ‡å¿—â€ï¼Œè¿™ä¸ªæ ‡å¿—å¾ˆæœ‰å¯èƒ½æ˜¯å›è½¦ç¬¦0Dï¼Œå› ä¸ºæˆ‘ä»¬çš„ç¨‹åºç»éªŒè¡¨æ˜ï¼ŒæŒ‰ä¸‹enteré”®æ—¶ï¼Œä¸ä½†ç»“æŸäº†è¾“å…¥ï¼Œè€Œä¸”ç¼“å†²åŒºä¸­å¤šäº†æ¢è¡Œç¬¦ï¼Œå› æ­¤ç»™å¾ˆå¤šè¾“å…¥çš„æ§åˆ¶å¸¦æ¥äº†å¹²æ‰°ï¼Œæ¯”å¦‚èœå•é€‰æ‹©çš„ç¨‹åºä¸­ï¼Œå¦‚æœä¸æ³¨æ„æ¶ˆé™¤ç¼“å†²åŒºçš„æ¢è¡Œç¬¦ï¼Œé‚£ä¹ˆç”¨æˆ·åœ¨æ²¡æœ‰è¾“å…¥ä¸‹ä¸€ä¸ªå­—ç¬¦æ—¶ï¼Œç¼“å†²åŒºä¸­çš„æ¢è¡Œç¬¦å°±å·å·åœ°æ›¿ä»£äº†ç”¨æˆ·çš„è¾“å…¥å·¥ä½œï¼Œé€ æˆè¾“å…¥å¹²æ‰°ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬çš„æ§åˆ¶å°æŠŠæ¢è¡Œç¬¦0Açœ‹ä½œæ˜¯ä¸€ä¸ªå¯ä»¥å®é™…è¾“å…¥çš„å­—ç¬¦ï¼Œè€Œä¸æ˜¯å½“ä½œä¸€ä¸ªç»“æŸè¾“å…¥çš„æ ‡å¿—ã€‚ç”±æ­¤å¯ä»¥æ¨æ–­ï¼Œæˆ‘ä»¬åœ¨Windowsæ§åˆ¶å°çš„enteré”®å®é™…ä¸Šé»˜è®¤æ˜¯CRLFæ¨¡å¼ã€‚å³ï¼šæ—¢å‘Šè¯‰æ§åˆ¶å°æˆ‘ä»¬ç»“æŸäº†è¾“å…¥ï¼Œåˆç»™ä½ æ‰“äº†ä¸ªæ¢è¡Œç¬¦ã€‚\n\næœ€åï¼Œå¯¹äºä»¥ä¸‹ç¨‹åºï¼Œæˆ‘ä»¬å†å½’çº³ä¸€ä¸‹0D0Açš„å‘ï¼š\n\n```c\n//æœ¬æ–‡ä»¶åä¸ºTest8_25.cpp\n#include<stdio.h>\n#include<stdlib.h>\nint main()\n{\n    FILE* pf = NULL;\n    errno_t tag = fopen_s(&pf, \"Test8_25.cpp\", \"rb\");\n    if (NULL == pf)\n    {\n        printf(\"file open error: %d\\n\", tag);\n        exit(1);\n    }\n\n    fseek(pf, 0, SEEK_END);//ä¸ºäº†å¯ä»¥è·å–æ–‡ä»¶çš„é•¿åº¦ï¼Œæˆ‘ä»¬è¦è°ƒç”¨fseekå®ç°äº†æ–‡ä»¶ä½ç½®æŒ‡é’ˆæŒ‡å‘æ–‡ä»¶æœ«å°¾\n    //fseek(pfs, 1, SET_END);//æ–‡ä»¶ä½ç½®æŒ‡é’ˆæŒ‡å‘äº†æ–‡ä»¶æœ«å°¾å‰ä¸€ä¸ªï¼Œä¸æ˜¯åä¸€ä¸ª\n    int len = ftell(pf);\n    printf(\"%d \\n\", len);\n\n    fseek(pf, 0, SEEK_SET);//ç°åœ¨ä¸ºäº†è¦ä»å¤´è¾“å‡ºæ–‡ä»¶å†…å®¹ï¼Œæˆ‘ä»¬éœ€è¦å°†æ–‡ä»¶ä½ç½®æŒ‡é’ˆæŒ‡å‘æ–‡ä»¶å¼€å¤´ã€‚\n    //ä¹Ÿå¯ä»¥ä½¿ç”¨rewind(pf);\n    char ch;\n    for (int i = 0;i < len;++i)\n    {\n        fscanf_s(pf,\"%c\", &ch,1);\n        printf(\"%c\", ch);\n    }\n    fclose(pf);\n    pf = NULL;\n    return 0;\n}\n```\n\n* rbæ‰“å¼€æ–‡æœ¬æ–‡ä»¶æ—¶ï¼Œå¯¹äº0D0Açš„å¤„ç†ç­‰åŒäºç”¨æˆ·åŸå…ˆåœ¨ç¼–è¾‘æ­¤æ–‡æœ¬æ–‡ä»¶é€‰æ‹©çš„enteræ¨¡å¼ã€‚\n* freadè¯»å–rbæ‰“å¼€çš„æ–‡æœ¬æ–‡ä»¶æ—¶ï¼Œå¯¹äº0D0Açš„å¤„ç†ç­‰åŒäºç”¨æˆ·åŸå…ˆåœ¨ç¼–è¾‘æ­¤æ–‡æœ¬æ–‡ä»¶é€‰æ‹©çš„enteræ¨¡å¼ã€‚\n* scanfè¯»å–ræ¨¡å¼æ‰“å¼€çš„æ–‡æœ¬æ–‡ä»¶æ—¶ï¼Œå¯¹äº0D0Açš„å¤„ç†åªè¯»å–äº†0Aï¼ŒæŠŠ0Då»é™¤äº†ã€‚è¿™è¯´æ˜ræ¨¡å¼ä¸‹çš„enteræ¨¡å¼å¾ˆæœ‰å¯èƒ½æ˜¯LFæ¨¡å¼ï¼›scanfè¯»å–rbæ¨¡å¼æ‰“å¼€çš„æ–‡æœ¬æ–‡ä»¶æ—¶ï¼Œå¯¹äº0D0Açš„å¤„ç†ç­‰åŒäºç”¨æˆ·åŸå…ˆåœ¨ç¼–è¾‘æ­¤æ–‡æœ¬æ–‡ä»¶é€‰æ‹©çš„enteræ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœç”¨æˆ·æ˜¯CRLFç¼–è¾‘çš„ï¼Œé‚£ä¹ˆè¯»å…¥çš„æ•°æ®0D0Aéƒ½åŒ…å«ã€‚\n* **ç»¼ä¸Šä¸‰ä¸ªç°è±¡ï¼Œè¯´æ˜ï¼šå¯¹äº0D0Açš„å¤„ç†æ–¹å¼ï¼Œå–å†³äºä½ æ‰“å¼€æ–‡ä»¶çš„æ–¹å¼ã€‚æœ€å¥½ä»¥rbæ–¹å¼æ‰“å¼€ï¼ŒåŸæ ·å‘ˆç°ã€‚ä¸å»ºè®®ä»¥ræ‰“å¼€ï¼ˆå³æ–‡æœ¬æ¨¡å¼ï¼‰ï¼Œå› ä¸ºä¼šä½¿æºæ–‡ä»¶çš„çœŸå®æ•°æ®ä¸¢å¤±ï¼Œæ¯”å¦‚åŸæœ¬çš„0D0Aï¼ŒæŠ›å¼ƒäº†0Dã€‚**\n\n| å‡½æ•°å     | æè¿°                    |\n| ---------- | ----------------------- |\n| fgetc/getc | ä»æ–‡ä»¶æµè·å–ä¸€ä¸ªå­—èŠ‚    |\n| fgets      | ä»æ–‡ä»¶æµè·å–ä¸€ä¸ªå­—èŠ‚ä¸²  |\n| fputc/putc | å°†ä¸€ä¸ªå­—èŠ‚å†™å…¥æ–‡ä»¶æµ    |\n| fputs      | å°†ä¸€ä¸ªå­—èŠ‚ä¸²å†™å…¥æ–‡ä»¶æµ  |\n| getchar    | ä» stdin è¯»å–ä¸€ä¸ªå­—èŠ‚   |\n| gets       | (C11 ä¸­ç§»é™¤)            |\n| gets_s     | ä» stdin è¯»å–ä¸€ä¸ªå­—èŠ‚ä¸² |\n| putchar    | å°†ä¸€ä¸ªå­—èŠ‚å†™å…¥ stdout   |\n| puts       | å°†ä¸€ä¸ªå­—èŠ‚ä¸²å†™å…¥ stdout |\n| ungetc     | å°†ä¸€ä¸ªå­—èŠ‚é€å›æ–‡ä»¶æµ    |\n\n\n```c\nint main()\n{\n    char buff[128];\n    scanf_s(\"%s\",buff,128);\n    printf(\"%s \\n\",buff);\n    gets_s(\"%s\",buff,128);\n    printf(\"%s \\n\",buff);\n    return 0;\n}//å¦‚æœæˆ‘ä»¬åªè¾“å…¥ä¸€æ¬¡\"123 345 567 789\"å¹¶å›è½¦ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„å±å¹•ä¸Šå°†ä¼šæ‰“å°ï¼š\n123\n 345 567 789\n/*åŸå› ï¼š\nscanf(\"%s\",...);æˆ‘ä»¬æ˜¯ç»™äº†æ ¼å¼æ§åˆ¶çš„ï¼Œé‡åˆ°ç©ºæ ¼å°±ç»“æŸäº†ã€‚\ngets();æ˜¯é‡åˆ°å›è½¦å°±ç»“æŸã€‚æ³¨æ„ï¼Œä¸Šé¢å·²ç»è®¨è®ºè¿‡äº†ï¼Œæ˜¯é‡åˆ°â€œå›è½¦ç¬¦â€ç»“æŸï¼Œé‡åˆ°â€œæ¢è¡Œç¬¦â€ä¸ä¼šæ§åˆ¶è¾“å…¥ç»“æŸã€‚\n*/\n```\n\n\n```c\nint main()\n{\n    char ch;\n    int select;\n    do\n    {\n        printf(\"**********\\n\");\n        printf(\" 1.       \\n\");\n        printf(\" 2.       \\n\");\n        printf(\" 3.       \\n\");\n        printf(\" 4.       \\n\");\n        printf(\"select:\\n\");\n        scanf_s(\"%d\",&select);\n        switch(select)\n    \t{\n            case 1:\n                break;\n            case 2:\n                break;\n            default:\n                break;\n    \t}\n        printf(\"æ˜¯å¦ç»§ç»­(y/n):\");\n        getchar();//æ¶ˆé™¤å›è½¦çš„å½±å“ã€‚\n        ch = getchar();\n    }while(ch=='y'||ch=='Y');\n    \n    printf(\"main end \\n\");\n    return 0;\n}\n```\n\n## getc/fgetc\n```cpp\nint fgetc( FILE * stream );\nint getc( FILE * stream );\n```\n\nä»ç»™å®šçš„è¾“å…¥æµè¯»å–ä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚ `getc()` å¯ä»¥å®ç°ä¸ºå®ã€‚\n### å‚æ•°\n\nstream è¯»å–å­—ç¬¦çš„æ¥æº\n\n### è¿”å›å€¼\n\næˆåŠŸæ—¶ä¸ºè·å¾—çš„å­—ç¬¦ï¼Œå¤±è´¥æ—¶ä¸º EOF ã€‚\nè‹¥æ–‡ä»¶å°¾æ¡ä»¶å¯¼è‡´å¤±è´¥ï¼Œåˆ™å¦å¤–è®¾ç½® stream ä¸Šçš„æ–‡ä»¶å°¾æŒ‡ç¤ºå™¨ï¼ˆè§ `feof()` ï¼‰ã€‚è‹¥æŸäº›å…¶ä»–é”™è¯¯å¯¼è‡´å¤±è´¥ï¼Œåˆ™è®¾\nç½® stream ä¸Šçš„é”™è¯¯æŒ‡ç¤ºå™¨ï¼ˆè§ `ferror()` ï¼‰ã€‚\n\n## fgets\n```cpp\nchar * fgets(char * str, int count, FILE * stream );\n\n```\nä»ç»™å®šæ–‡ä»¶æµè¯»å–æœ€å¤š `count - 1` ä¸ªå­—ç¬¦å¹¶å°†å®ƒä»¬å­˜å‚¨äº str æ‰€æŒ‡å‘çš„å­—ç¬¦æ•°ç»„ã€‚è‹¥æ–‡ä»¶å°¾å‡ºç°æˆ–å‘ç°æ¢è¡Œç¬¦åˆ™ç»ˆ\næ­¢åˆ†æï¼Œåä¸€æƒ…å†µä¸‹ str å°†åŒ…å«ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚è‹¥è¯»å…¥å­—èŠ‚ä¸”æ— é”™è¯¯å‘ç”Ÿï¼Œåˆ™ç´§éšå†™å…¥åˆ° str çš„æœ€åä¸€ä¸ªå­—ç¬¦åå†™å…¥ç©ºå­—\nç¬¦ã€‚\n\n### å‚æ•°\n\nstr æŒ‡å‘ char æ•°ç»„å…ƒç´ çš„æŒ‡é’ˆ\ncount å†™å…¥çš„æœ€å¤§å­—ç¬¦æ•°ï¼ˆå…¸å‹çš„ä¸º str çš„é•¿åº¦ï¼‰\nstream è¯»å–æ•°æ®æ¥æºçš„æ–‡ä»¶æµ\n\n### è¿”å›å€¼\n\næˆåŠŸæ—¶ä¸º str ï¼Œå¤±è´¥æ—¶ä¸ºç©ºæŒ‡é’ˆã€‚\nè‹¥é‡åˆ°æ–‡ä»¶å°¾æ¡ä»¶å¯¼è‡´äº†å¤±è´¥ï¼Œåˆ™è®¾ç½® stream ä¸Šçš„æ–‡ä»¶å°¾æŒ‡ç¤ºå™¨ï¼ˆè§ feof() ï¼‰ã€‚è¿™ä»…è‹¥å®ƒå¯¼è‡´æœªè¯»å–å­—ç¬¦æ‰æ˜¯å¤±\nè´¥ï¼Œè¯¥æƒ…å†µä¸‹è¿”å›ç©ºæŒ‡é’ˆä¸”ä¸æ”¹å˜ str æ‰€æŒ‡å‘æ•°ç»„çš„å†…å®¹ï¼ˆå³ä¸ä»¥ç©ºå­—ç¬¦è¦†å†™é¦–å­—èŠ‚ï¼‰ã€‚\nè‹¥æŸäº›å…¶ä»–é”™è¯¯å¯¼è‡´äº†å¤±è´¥ï¼Œåˆ™è®¾ç½® stream ä¸Šçš„é”™è¯¯æŒ‡ç¤ºå™¨ï¼ˆè§ ferror() ï¼‰ã€‚ str æ‰€æŒ‡å‘çš„æ•°ç»„å†…å®¹æ˜¯ä¸ç¡®å®šçš„\nï¼ˆç”šè‡³å¯ä»¥ä¸æ˜¯ç©ºç»ˆæ­¢ï¼‰ã€‚\n\n### æ³¨è§£\n\nPOSIX é¢å¤–è¦æ±‚è‹¥ fgets é‡åˆ°å¼‚äºæ–‡ä»¶å°¾æ¡ä»¶çš„å¤±è´¥åˆ™è®¾ç½® errno ã€‚\nå°½ç®¡æ ‡å‡†è§„èŒƒåœ¨ count<=1 çš„æƒ…å†µä¸‹ä¸æ˜ï¼Œå¸¸è§çš„å®ç°\n* è‹¥ count < 1 åˆ™ä¸åšä»»ä½•äº‹å¹¶æŠ¥å‘Šé”™è¯¯\n* è‹¥ count == 1 ï¼Œåˆ™æŸäº›å®ç°ä¸åšä»»ä½•äº‹å¹¶æŠ¥å‘Šé”™è¯¯ï¼Œå…¶ä»–å®ç°ä¸è¯»å†…å®¹ï¼Œå­˜å‚¨é›¶äº str[0] å¹¶æŠ¥å‘ŠæˆåŠŸ\n## putc/fputc\n```cpp\nint fputc( int ch, FILE *stream );\nint putc( int ch, FILE *stream );\n```\n\nå†™å…¥å­—ç¬¦ ch åˆ°ç»™å®šè¾“å‡ºæµ stream ã€‚ putc() å¯ä»¥å®ç°ä¸ºå®å¹¶å¯¹ stream æ±‚å€¼è¶…è¿‡ä¸€æ¬¡ï¼Œæ•…å¯¹åº”çš„å‚æ•°å†³ä¸åº”æ˜¯æœ‰å‰¯\næ•ˆåº”çš„è¡¨è¾¾å¼ã€‚åœ¨å†…éƒ¨ï¼Œåœ¨å†™å…¥å‰å°†å­—ç¬¦è½¬æ¢ä¸º unsigned char ã€‚\n\n### å‚æ•°\n\nch è¦è¢«å†™å…¥çš„å­—ç¬¦\nstream è¾“å‡ºæµ\n\n### è¿”å›å€¼\n\næˆåŠŸæ—¶ï¼Œè¿”å›è¢«å†™å…¥å­—ç¬¦ã€‚\nå¤±è´¥æ—¶ï¼Œè¿”å› EOF å¹¶è®¾ç½® stream ä¸Šçš„é”™è¯¯æŒ‡ç¤ºå™¨ï¼ˆè§ ferror() ï¼‰ã€‚\n\n## fputs\n```cpp\nint fputs( const char \\* str, FILE \\* stream );\nint fputs( const char \\* restrict str, FILE \\* restrict stream );\n```\n\nå°†ä»¥NULL ç»“å°¾çš„å­—ç¬¦ä¸² str çš„æ¯ä¸ªå­—ç¬¦å†™å…¥åˆ°è¾“å‡ºæµ stream ï¼Œå¦‚åŒé€šè¿‡é‡å¤æ‰§è¡Œ fputc ã€‚\nä¸å°† str çš„ç©ºå­—ç¬¦å†™å…¥ã€‚\n\n### å‚æ•°\n\nstr è¦å†™å…¥çš„ç©ºç»ˆæ­¢å­—ç¬¦ä¸²\nstream è¾“å‡ºæµ\n\n### è¿”å›å€¼\n\næˆåŠŸæ—¶ï¼Œè¿”å›éè´Ÿå€¼ã€‚\nå¤±è´¥æ—¶ï¼Œè¿”å› EOF å¹¶è®¾ç½® stream ä¸Šçš„é”™è¯¯æŒ‡ç¤ºå™¨ï¼ˆè§ ferror ï¼‰ã€‚\n\n### æ³¨æ„\n\nç›¸å…³å‡½æ•° puts åé™„æ–°æ¢è¡Œç¬¦åˆ°è¾“å‡ºï¼Œè€Œ fputs å†™å…¥ä¸ä¿®æ”¹çš„å­—ç¬¦ä¸²ã€‚ä¸åŒçš„å®ç°è¿”å›ä¸åŒçš„éè´Ÿæ•°ï¼šä¸€äº›è¿”å›æœ€åå†™å…¥çš„å­—ç¬¦ï¼Œä¸€äº›è¿”å›å†™å…¥çš„å­—ç¬¦æ•°ï¼ˆæˆ–è‹¥å­—ç¬¦ä¸²é•¿äº INT_MAX åˆ™ä¸ºè¯¥å€¼ï¼‰ï¼Œä¸€äº›ç®€å•åœ°éè´Ÿå¸¸é‡ï¼Œä¾‹å¦‚é›¶ã€‚\n\n## getchar\n```cpp\nint getchar(void);\n```\nä» stdin è¯»å–ä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚ç­‰ä»·äº `getc(stdin)`ã€‚\n\n### å‚æ•°\n\næ— \n\n### è¿”å›å€¼\n\næˆåŠŸæ—¶ä¸ºè·å¾—çš„å­—ç¬¦ï¼Œå¤±è´¥æ—¶ä¸º EOF ã€‚\nè‹¥å¤±è´¥ç”±æ–‡ä»¶å°¾æ¡ä»¶äº§ç”Ÿï¼Œåˆ™å¦å¤–è®¾ç½® stdin ä¸Šçš„æ–‡ä»¶å°¾æŒ‡ç¤ºå™¨ï¼ˆè§ feof() ï¼‰ã€‚è‹¥å¤±è´¥ç”±æŸäº›å…¶ä»–é”™è¯¯äº§ç”Ÿï¼Œåˆ™è®¾\nç½® stdin ä¸Šçš„é”™è¯¯æŒ‡ç¤ºå™¨ï¼ˆè§ ferror() ï¼‰ã€‚\n\n## gets/gets_s\n```cpp\nchar * gets(char * str); //C11 ä¸­ç§»é™¤\nchar * gets_s(char * str, rsize_t n); //C11 èµ·\n```\n\n1. ä» stdin è¯»å…¥ str æ‰€æŒ‡å‘çš„å­—ç¬¦æ•°ç»„ï¼Œç›´åˆ°å‘ç°æ¢è¡Œç¬¦æˆ–å‡ºç°æ–‡ä»¶å°¾ã€‚åœ¨è¯»å…¥æ•°ç»„çš„æœ€åä¸€ä¸ªå­—ç¬¦åç«‹å³å†™å…¥ç©ºå­—ç¬¦ã€‚æ¢è¡Œç¬¦è¢«èˆå¼ƒï¼Œä½†ä¸ä¼šå­˜å‚¨äºç¼“å†²åŒºä¸­ã€‚\n2. ä» stdin è¯»å–å­—ç¬¦ç›´åˆ°å‘ç°æ¢è¡Œç¬¦æˆ–å‡ºç°æ–‡ä»¶å°¾ã€‚è‡³å¤šå†™å…¥ n-1 ä¸ªå­—ç¬¦åˆ° str æ‰€æŒ‡å‘çš„æ•°ç»„ï¼Œå¹¶å§‹ç»ˆå†™å…¥ç©ºç»ˆæ­¢å­—ç¬¦ï¼ˆé™¤é str æ˜¯ç©ºæŒ‡é’ˆï¼‰ã€‚è‹¥å‘ç°æ¢è¡Œç¬¦ï¼Œåˆ™å¿½ç•¥å®ƒå¹¶ä¸”ä¸å°†å®ƒè®¡å…¥å†™å…¥ç¼“å†²åŒºçš„å­—ç¬¦æ•°ã€‚\n\nåœ¨è¿è¡Œæ—¶æ£€æµ‹ä¸‹åˆ—é”™è¯¯å¹¶è°ƒç”¨å½“å‰å®‰è£…çš„åˆ¶çº¦å¤„ç†å‡½æ•°ï¼š\n* n ä¸ºé›¶\n* n å¤§äº RSIZE_MAX\n* str æ˜¯ç©ºæŒ‡é’ˆ\n* åœ¨å­˜å‚¨ n-1 ä¸ªå­—ç¬¦åˆ°ç¼“å†²åŒºåæ²¡æœ‰é‡åˆ°æ¢è¡Œç¬¦æˆ–æ–‡ä»¶å°¾ã€‚\n\nä»»ä½•æƒ…å†µä¸‹ï¼Œ`gets_s` é¦–å…ˆç»“æŸè¯»å–å¹¶å¿½ç•¥æ¥è‡ª stdin çš„å­—ç¬¦ï¼Œç›´åˆ°æ¢è¡Œç¬¦ã€æ–‡ä»¶å°¾æ¡ä»¶ï¼Œæˆ–åœ¨è°ƒç”¨åˆ¶çº¦å¤„ç†å‰çš„\nè¯»å–é”™è¯¯ã€‚\nåŒæ‰€æœ‰è¾¹ç•Œæ£€æŸ¥å‡½æ•°ï¼Œ `gets_s` ä»…è‹¥å®ç°å®šä¹‰ `__STDC_LIB_EXT1__`ä¸”ç”¨æˆ·åœ¨åŒ…å« `stdio.h` å‰å®š\nä¹‰`__STDC_WANT_LIB_EXT1__`ä¸ºæ•´æ•°å¸¸é‡ 1 æ‰ä¿è¯å¯ç”¨ã€‚\n\n### å‚æ•°\n\nstr è¦è¢«å†™å…¥çš„å­—ç¬¦ä¸²\nn char æ•°ç»„çš„æœ€å¤§é•¿åº¦\n\n### è¿”å›å€¼\n\næˆåŠŸæ—¶ä¸º str ï¼Œå¤±è´¥æ—¶ä¸ºç©ºæŒ‡é’ˆã€‚\nè‹¥æ–‡ä»¶å°¾æ¡ä»¶å¯¼è‡´äº†å¤±è´¥ï¼Œåˆ™é™„åŠ è®¾ç½® stdin çš„æ–‡ä»¶å°¾æŒ‡ç¤ºå™¨ï¼ˆè§ feof() ï¼‰ã€‚è‹¥å…¶ä»–æŸäº›åŸå› å¯¼è‡´äº†å¤±è´¥ï¼Œåˆ™è®¾\nç½® stdin çš„é”™è¯¯æŒ‡ç¤ºå™¨ï¼ˆè§ ferror() ï¼‰ã€‚\n\n### æ³¨è§£\n\ngets() å‡½æ•°ä¸è¿›è¡Œè¾¹ç•Œæ£€æŸ¥ï¼Œä»è€Œæ­¤å‡½æ•°å¯¹ç¼“å†²åŒºæº¢å‡ºæ”»å‡»æåº¦è„†å¼±ã€‚æ— æ³•å®‰å…¨ä½¿ç”¨å®ƒï¼ˆé™¤éç¨‹åºè¿è¡Œçš„ç¯å¢ƒé™å®š\nèƒ½å‡ºç°åœ¨ stdin ä¸Šçš„å†…å®¹ï¼‰ã€‚å› æ­¤ï¼Œæ­¤å‡½æ•°åœ¨ C99 çš„ç¬¬ä¸‰æ¬¡å‹˜è¯¯ä¸­è¢«å¼ƒç”¨ï¼Œè€Œåœ¨ C11 æ ‡å‡†å‘å¸ƒæ—¶è¢«ç§»é™¤ã€‚æ¨èçš„æ›¿ä»£\nå“æ˜¯ fgets() å’Œ `gets_s()` ã€‚ç»å¯¹ä¸è¦ç”¨ gets() ã€‚\n\n## putchar\n```cpp\nint putchar( int ch );\n\n```\nå†™å­—ç¬¦ ch åˆ° stdout ã€‚åœ¨å†…éƒ¨ï¼Œå­—ç¬¦äºå†™å…¥å‰è¢«è½¬æ¢åˆ° unsigned char ã€‚\nç­‰ä»·äº `putc(ch, stdout)`ã€‚\n\n### å‚æ•°\n\nch è¦è¢«å†™å…¥çš„å­—ç¬¦\n\n### è¿”å›å€¼\n\næˆåŠŸæ—¶è¿”å›å†™å…¥çš„å­—ç¬¦ã€‚\nå¤±è´¥æ—¶è¿”å› EOF å¹¶è®¾ç½® stdout ä¸Šçš„é”™è¯¯æŒ‡ç¤ºå™¨ï¼ˆè§ ferror() ï¼‰\n\nç¤ºä¾‹ï¼šputchar å¸¦é”™è¯¯æ£€æŸ¥\n\n## puts\n```cpp\nint puts( const char *str );\n```\nå†™å…¥æ¯ä¸ªæ¥è‡ªç©ºç»ˆæ­¢å­—ç¬¦ä¸² str çš„å­—ç¬¦åŠé™„åŠ æ¢è¡Œç¬¦`'\\n'`åˆ°è¾“å‡ºæµ stdout ï¼Œå¦‚åŒä»¥é‡å¤æ‰§è¡Œ putc å†™å…¥ã€‚\nä¸å†™å…¥æ¥è‡ª str çš„ç©ºç»ˆæ­¢å­—ç¬¦ã€‚\n\n### å‚æ•°\n\nstr è¦å†™å…¥çš„å­—ç¬¦ä¸²\n\n### è¿”å›å€¼\n\næˆåŠŸæ—¶è¿”å›éè´Ÿå€¼\nå¤±è´¥æ—¶ï¼Œè¿”å› EOF å¹¶è®¾ç½® stdout çš„é”™è¯¯æŒ‡ç¤ºå™¨ï¼ˆè§ ferror() ï¼‰ã€‚\n\n### æ³¨æ„\n\nputs å‡½æ•°åé™„ä¸€ä¸ªæ¢è¡Œå­—ç¬¦åˆ°è¾“å‡ºï¼Œè€Œ fputs ä¸è¿™ä¹ˆåšã€‚\nä¸åŒçš„å®ç°è¿”å›ä¸åŒçš„éè´Ÿæ•°ï¼šä¸€äº›è¿”å›æœ€åå†™å…¥çš„å­—ç¬¦ï¼Œä¸€äº›è¿”å›å†™å…¥çš„å­—ç¬¦æ•°ï¼ˆæˆ–è‹¥å­—ç¬¦ä¸²é•¿äº`INT_MAX`åˆ™è¿”å›\nå®ƒï¼‰ï¼Œä¸€äº›ç®€å•åœ°è¿”å›éè´Ÿå¸¸é‡ã€‚\nåœ¨é‡å®šå‘ stdout åˆ°æ–‡ä»¶æ—¶ï¼Œå¯¼è‡´ puts å¤±è´¥çš„å…¸å‹åŸå› æ˜¯ç”¨å°½äº†æ–‡ä»¶ç³»ç»Ÿçš„ç©ºé—´ã€‚\n\n## ungetc\n```cpp\nint ungetc( int ch, FILE *stream );\n\n```\nè‹¥ ch ä¸ç­‰äº EOF ï¼Œåˆ™æ¨å…¥å­—ç¬¦ ch ï¼ˆè½¬è¯‘ä¸º unsigned char ï¼‰åˆ°ä¸æµ stream å…³è”çš„è¾“å…¥ç¼“å†²åŒºï¼Œæ–¹å¼æ»¡è¶³ä» stream çš„åç»§è¯»å–æ“ä½œå°†å–å¾—è¯¥å­—ç¬¦ã€‚ä¸ä¿®æ”¹ä¸æµå…³è”çš„å¤–éƒ¨è®¾å¤‡ã€‚\næµé‡å¯»ä½æ“ä½œ fseek ã€ fsetpos å’Œ rewind å¼ƒå» ungetc çš„æ•ˆæœã€‚\nè‹¥è°ƒç”¨ ungetc å¤šäºä¸€æ¬¡ï¼Œè€Œæ— ä¸­é—´è¯»å–æˆ–é‡å¯»ä½ï¼Œåˆ™å¯èƒ½å¤±è´¥ï¼ˆæ¢è¨€ä¹‹ï¼Œä¿è¯å¤§å°ä¸º 1 çš„å›æ”¾ç¼“å†²åŒºï¼Œä½†ä»»ä½•æ›´å¤§çš„ç¼“å†²åŒºæ˜¯å®ç°å®šä¹‰çš„ï¼‰ã€‚è‹¥æˆåŠŸè¿›è¡Œå¤šæ¬¡ ungetc ï¼Œåˆ™è¯»å–æ“ä½œä»¥ ungetc çš„é€†åºå–å¾—å›æ”¾çš„å­—ç¬¦ã€‚\nè‹¥ ch ç­‰äº EOF ï¼Œåˆ™æ“ä½œå¤±è´¥è€Œä¸å½±å“æµã€‚\nå¯¹ ungetc çš„æˆåŠŸè°ƒç”¨æ¸…é™¤æ–‡ä»¶å°¾çŠ¶æ€æ ‡å¿— feof ã€‚\nåœ¨äºŒè¿›åˆ¶æµä¸Šå¯¹ ungetc çš„æˆåŠŸè°ƒç”¨å°†æµä½ç½®æŒ‡ç¤ºå™¨å‡å°‘ä¸€ï¼ˆè‹¥æµä½ç½®æŒ‡ç¤ºå™¨ä¸ºé›¶ï¼Œåˆ™è¡Œä¸ºä¸ç¡®å®šï¼‰ã€‚\nåœ¨æ–‡æœ¬æµä¸Šå¯¹ ungetc çš„æˆåŠŸè°ƒç”¨ä»¥æœªæŒ‡å®šæ–¹å¼ä¿®æ”¹æµä½ç½®æŒ‡ç¤ºå™¨ï¼Œä½†ä¿è¯åœ¨ä»¥è¯»å–æ“ä½œå–å¾—æ‰€æœ‰å›æ”¾å­—ç¬¦åï¼Œæµä½ç½®æŒ‡ç¤ºå™¨ç­‰äºå…¶åœ¨ ungetc ä¹‹å‰çš„å€¼ã€‚\n\n### å‚æ•°\n\nch è¦æ¨å…¥è¾“å…¥æµç¼“å†²åŒºçš„å­—ç¬¦\nstream è¦å›æ”¾å­—ç¬¦åˆ°çš„æ–‡ä»¶æµ\n\n### è¿”å›å€¼\n\næˆåŠŸæ—¶è¿”å› ch ã€‚\nå¤±è´¥æ—¶è¿”å› EOF ï¼Œè€Œç»™å®šçš„æµä¿æŒä¸å˜ã€‚\n\n### æ³¨æ„\n\nå®è·µä¸­ï¼Œå›æ”¾ç¼“å†²åŒºçš„å¤§å°ä¼šåœ¨ 4k ï¼ˆ Linux ã€ MacOS ï¼‰å’Œ 4 ï¼ˆ Solaris ï¼‰æˆ–ä¿è¯çš„æœ€å°å€¼ 1 ï¼ˆ HPUX ã€AIX ï¼‰é—´å˜åŒ–ã€‚\nè‹¥å›æ”¾çš„å­—ç¬¦ç­‰äºå­˜åœ¨äºå¤–éƒ¨å­—ç¬¦åºåˆ—ä¸­è¯¥ä½ç½®çš„å­—ç¬¦ï¼Œåˆ™å›æ”¾ç¼“å†²åŒºçš„è¡¨è§‚å¤§å°å¯ä»¥æ›´å¤§ï¼ˆå®ç°å¯ä»¥ç®€å•åœ°è‡ªå‡è¯»å–çš„æ–‡ä»¶ä½ç½®æŒ‡ç¤ºå™¨ï¼Œå¹¶é¿å…ç»´æŠ¤å›æ”¾ç¼“å†²åŒºï¼‰ã€‚\n\n# é™„å½•ï¼šC11 æ ‡å‡†\n\nfopenå˜æ¢äº†ï¼Œè¦ç”¨`fopen_s`ã€‚é‡Œé¢çš„pfæŒ‡é’ˆè¦å–å…¶åœ°å€å†™æˆ`&pf`ã€‚è¦è¿”å›ä¸€ä¸ª`errno_t`å€¼ã€‚å¯ä»¥è¿”å›é”™è¯¯æ ‡è¯†å€¼ã€‚\n\n```c\n#include<stdio.h>\n#include<stdlib.h>\nint main()\n{\n    float ar[]={1.2,2.3,3.4,4.5,5.6,6.7,7.8,8.9,9.0,1.00};\n    int n = sizeof(ar)/sizeof(ar[0]);\n    FILE* pf = NULL;\n    //pfa = fopen(\"yhp.txt\",\"w\");//VS2019ä¸­ä¸èƒ½è¿è¡Œ\n    errno_t tag = fopen_s(&pf,\"yhp.txt\",\"a\");//æ­¤æ—¶pfæŒ‡é’ˆå°±æŒ‡å‘äº†ç³»ç»Ÿäº§ç”Ÿçš„ä¸€ä¸ªæ–‡ä»¶æµå¯¹è±¡ã€‚é‚£ä¹ˆå¯¹æ–‡ä»¶æµå¯¹è±¡çš„æ“ä½œå°±å¯ä»¥é—´æ¥å¯¹ç£ç›˜ä¸­çš„æ–‡ä»¶è¿›è¡Œæ“ä½œã€‚æ–‡ä»¶æµå¯¹è±¡å†…éƒ¨åŒ…å«ç¼“å†²åŒºã€‚//\"a\"ä»£è¡¨è¿½åŠ å†™å…¥ï¼Œå¹¶ä¸”æ‰¾ä¸åˆ°æ–‡ä»¶æ—¶ä¸»åŠ¨åˆ›å»ºã€‚\n    if(NULL==pf)\n    {\n        printf(\"open file error: %d\\n\",tag);\n        exit(EXIT_FAILURE);\n    }\n    for(int i=0;i<n;++i)\n    {\n        fprintf(pf,\"%f \",ar[i]);\n    }\n    fclose(pf);\n    pf = NULL;\n    return 0;\n}\n```\n\n![image-20210824211918339](../../images/C_%E6%96%87%E4%BB%B6/image-20210824211918339.png)\n\n# å…³äºå›è½¦å’Œæ¢è¡Œåœ¨æ–‡ä»¶ä¸­çš„è¡¨ç°æ–¹å¼\n\n# ä¸»å‡½æ•°å¸¦å‚\n\n## è¿™æ˜¯ä¸å¸¦å‚çš„\n\n```c\nint main()\n{\n    \n}\n```\n\n## è¿™æ˜¯ä¸¤ä¸ªå‚æ•°çš„\n\nä»¥ä¸‹ç¨‹åºå¯ä»¥è¾“å‡ºç›®å‰argvæ•°ç»„çš„å…ƒç´ ä¸ªæ•°å’Œå†…å®¹ï¼Œä½†æ˜¯ç›´æ¥è¿è¡Œçš„è¯åªä¼šè¾“å‡º1ã€‚\næˆ‘ä»¬åœ¨cmd.exeä¸­è¿è¡Œæ­¤ç¨‹åºæ—¶ï¼Œå¯ä»¥åœ¨åé¢åŠ å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚`tulun219.exe yhp hello newdata print`\nä¼šè¾“å‡º5ï¼ˆå­—ç¬¦ä¸²ä¸ªæ•°ï¼‰ï¼Œä»¥åŠå„å­—ç¬¦ä¸²çš„å†…å®¹ã€‚\n\n```c\nint main(int argc, char* argv[])\n{\n    printf(\"%d \\n\",argc);\n    for(int i = 0;i<argc;++i)\n    {\n        printf(\"%s \\n\",argv[i]);\n    }\n    return 0;\n}\n```\n\n![image-20210826214859920](../../images/C_%E6%96%87%E4%BB%B6/image-20210826214859920.png)\n\n![image-20210826215126981](../../images/C_%E6%96%87%E4%BB%B6/image-20210826215126981.png)\n\næ­¤å¤„çš„åº”ç”¨ä»·å€¼æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚æˆ‘ä»¬æ“ä½œæ§åˆ¶å°çš„æ—¶å€™ï¼Œdirè¡¨ç¤ºæŸ¥çœ‹ç›®å½•ä¿¡æ¯çš„**å‘½ä»¤ç¨‹åº**ï¼Œåé¢è·Ÿçš„/Då°±æ˜¯å…¶å‚æ•°ã€‚å¾ˆå¥½åœ°ç±»æ¯”äº†â€œç¨‹åºå str1 str2â€çš„å‘½ä»¤æ§åˆ¶æ ¼å¼ã€‚\n\n![image-20210826215343314](../../images/C_%E6%96%87%E4%BB%B6/image-20210826215343314.png)\n\n### å®ç°cmdä¸‹ä¾é ç¨‹åºè¿›è¡Œæ–‡ä»¶çš„å¤åˆ¶\n\n`tulun219.exe Test.cpp yhp.cpp`\n\nè¾“å…¥ä»¥ä¸Šä¿¡æ¯å¯ä»¥è¾¾åˆ°ä¸€ä¸ªä¼ å‚çš„æ•ˆæœã€‚é€šè¿‡fopenæŠŠTest.cppæ‰“å¼€ï¼Œé€šè¿‡fopenï¼Œåˆ›å»ºyhp.cppã€‚ç„¶åè¯»å–æ•°æ®å†™å…¥åˆ°yhp.cppä¸­ã€‚å°±å¯ä»¥å®ç°æ–‡ä»¶çš„å¤åˆ¶ã€‚\n\n```c\nint main(int argc, char* argv[])//tulun219.exe Test.cpp yhp.cpp\n{\n    char ch;\n    if(argc<3)return 1;\n    FILE* fpr = nullptr;FILE* fpw = nullptr;\n    errno_t tag = fopen_s(&fpr,argv[1],\"rb\");\n    if(nullptr==fpr)\n    {\n        printf(\"src file open error:%d\\n\",tag);\n        return 1;\n    }\n    tag = fopen_s(&fpw,argv[2],\"wb\");\n    if(nullptr==fpw)\n    {\n        printf(\"des file open error:%d\\n\",tag);\n        return 1;\n    }\n    fseek(pfr,0,SEEK_END);\n    int len = ftell(pf);\n    printf(\"len:%d \\n\",len);\n    rewind(pfr);\n    \n    char* str = (char*)malloc(sizeof(char)*len);\n    fread(str,sizeof(char),len,fpr);\n    fwrite(str,sizeof(char),len,fpw);\n    fclose(fpr);\n    fclose(fpw);\n    fpr = fpw = nullptr;\n    return 0;\n}\n```\n\n#### é—®é¢˜ï¼šargvé‡Œçš„å­—ç¬¦ä¸²å­˜æ”¾åœ¨å“ªä¸ªåŒºåŸŸï¼Ÿ\n\n```c\n#include<stdio.h>\nint main(int argc, char* argv[])\n{\n    printf(\"%s \\n\",argv[0]);\n    return 0;\n}\n```\n\nä¸Šé¢è¿™ä¸ªç¨‹åºä¼šæ‰“å°ï¼š\n\n![image-20210826222047730](../../images/C_%E6%96%87%E4%BB%B6/image-20210826222047730.png)\n\né‚£ä¹ˆå°±åƒè¿™æ ·çš„å­—ç¬¦ä¸²æ˜¯åœ¨å“ªå‘¢ï¼Ÿä»£ç åŒºä¸å¯èƒ½ï¼Œå› ä¸ºä¼ å‚çš„æ—¶å€™ä»£ç æ—©å·²ç»åŠ è½½å®Œäº†ã€‚å †åŒºä¹Ÿä¸å¯èƒ½ï¼Œå› ä¸ºå †åŒºçš„æ•°æ®éƒ½æ˜¯mallocäº§ç”Ÿçš„ã€‚ç›®å‰å‰©ä¸‹æ•°æ®åŒºå’Œæ ˆåŒºã€‚æˆ‘ä»¬ä»”ç»†è§‚å¯Ÿï¼Œæ€è€ƒï¼Œæ—¢ç„¶æˆ‘ä»¬ç»™çš„å‚æ•°å­—ç¬¦ä¸²å¯ä»¥ä¿®æ”¹ï¼Œè€Œä¸”char \\* argv[]å‰é¢æ²¡æœ‰constä¿®é¥°ï¼Œæ‰€ä»¥è‚¯å®šä¸æ˜¯åœ¨æ•°æ®åŒºçš„ã€‚é‚£ä¹ˆï¼Œç»“è®ºå°±æ˜¯å­—ç¬¦ä¸²æŒ‡é’ˆæ•°ç»„å’Œå­—ç¬¦ä¸²å‡åœ¨ä¸»å‡½æ•°çš„æ ˆå¸§ä¹‹ä¸‹ã€‚\n\n![image-20210826223218635](../../images/C_%E6%96%87%E4%BB%B6/image-20210826223218635.png)\n\n## è¿™æ˜¯ä¸‰ä¸ªå‚æ•°çš„\n\nä¸‰ä¸ªå‚æ•°çš„mainå‡½æ•°ï¼Œå‰ä¸¤ä¸ªå‚æ•°æ˜¯é…åˆä½¿ç”¨çš„ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°engvå¯ä»¥è¯»å–ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ã€‚\n\n```c\nint main(int argc, char* argv[], char* engv[])\n{\n    for(int i = 0;engv[i]!=NULL;++i)\n    {\n        printf(\"%s\\n\",engv[i]);\n    }\n    return 0;\n}\n```\n\n![image-20210826223348266](../../images/C_%E6%96%87%E4%BB%B6/image-20210826223348266.png)\n\n# åºåˆ—åŒ–-ååºåˆ—åŒ–\n\næŠŠé“¾è¡¨å˜æˆä¸€ç»„æ•°æ®ã€‚\n\nè¦æ±‚å¯ä»¥æ ¹æ®è¿™ç»„æ•°æ®åœ¨å¦ä¸€ä¸ªæœºå­ä¸Šæ„å»ºå‡ºæ¥é“¾è¡¨ã€‚\n\n```c\n//æœ¬æ–‡ä»¶åä¸ºMyLinkList.h\n#ifndef MYLINKLIST_H\n#define MYLINKLIST_H\ntypedef int ElemType;\ntypedef struct ListNode\n{\n\tElemType data;\n\tstruct ListNode* next;\n}ListNode;\ntypedef struct\n{\n\tListNode* head;\n\tint cursize;\n}LinkList;\nvoid InitLink(LinkList* plist);\nvoid ClearLink(LinkList* plist);\nvoid DestroyLink(LinkList* plist);\nint GetSize(const LinkList* plist);\nbool IsEmpty(const LinkList* plist);\nvoid Insert_Next(LinkList* plist, ListNode* ptr, ElemType val);\nvoid Push_Front(LinkList* plist, ElemType val);\nvoid Push_Back(LinkList* plist, ElemType val);\nbool Erase_Next(LinkList* plist, ListNode* ptr);\nvoid Pop_Front(LinkList* plist);\nvoid Pop_Back(LinkList* plist);\nvoid Remove(LinkList* plist, ElemType val);\nvoid Remove_All(LinkList* plist, ElemType val);\nvoid PrintLink(const LinkList* plist);\nListNode* FindValue_pre(const LinkList* plist, ElemType val);\nListNode* FindValue(const LinkList* plist, ElemType val);\nListNode* FindPos_pre(const LinkList* plist, int pos);\nListNode* FindPos(const LinkList* plist, int pos);\n#endif\n```\n\nç°è¦æ±‚å†™ä¸¤ä¸ªå‡½æ•°ï¼š\n1. `void ListSave(LinkList* plist);`æŠŠé“¾è¡¨çš„æ•°æ®ä¿å­˜åˆ°æœ¬è®¡ç®—æœºçš„ç£ç›˜ä¸­ã€‚é€šè¿‡å†™å…¥åˆ°æ–‡ä»¶å®ç°ã€‚åºåˆ—åŒ–ã€‚\n2. `void ListLoad(LinkList* plist);`åŠ è½½æ”¶åˆ°çš„æ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œåœ¨å†…å­˜ä¸­æ„å»ºä¸€ä¸ªé“¾è¡¨ï¼Œé‡è½½æ•°æ®ã€‚ååºåˆ—åŒ–ã€‚\n\n```c\n//MyLinkList.cpp\n#include<stdio.h>\n#include\"MyLinkList.h\"\nvoid ListSave(LinkList* plist)\n{\n    assert(plist!=NULL);\n    if(IsEmpty(plist))return;\n    FILE* pf = NULL;\n    errno_t tag = fopen_s(&pf,\"List.dat\",\"wb\");\n    if(fp == NULL)\n    {\n\t\tprintf(\"file open error:%d\\n\",tag);\n        exit(1);\n    }\n    fprintf(pf,\"%d\\n\",plist->cursize);\n    ListNode* pnode = plist->head->next;\n    while(pnode!=NULL)\n    {\n        fprintf(pf,\"%d\\n\",pnode->data);\n        pnode=pnode->next;\n    }\n    fclose(pf);\n    pf=NULL;\n}\nvoid ListLoad(LinkList* plist)\n{\n    assert(plist!=NULL);\n    FILE* pf = NULL;\n    errno_t tag = fopen_s(&pf,\"List.dat\",\"rb\");\n    if(pf==NULL)\n    {\n        printf(\"file open error:%d\\n\");\n        exit(1);\n    }\n    int n = 0;\n    fscanf_s(pf,\"%d\",&n);\n    for(int i = 0;i<n;++i)\n    {\n        int val=0;\n        fscanf_s(pf,\"%d\",&val);\n        Push_Back(plist,val);\n    }\n    fclose(pf);\n    pf=NULL;\n}\nint main()\n{\n    LinkList mylist;\n    InitLink(&mylist);\n    \n    int val;\n    while(scanf_s(\"%d\",&val),val!=-1)\n    {\n        Push_Front(&mylist,val);\n    }\n    PrintLink(&mylist);\n    //ä»¥ä¸Šç¨‹åºè¿è¡Œæ—¶ï¼Œè¾“å…¥12 23 34 45 56 67 78 89 90 100 -1\n    //è¾“å…¥100 90 89 78 67 56 45 34 23 12 ï¼ˆå› ä¸ºæ˜¯å¤´æ’ï¼‰\n    ListSave(&mylist);\n    \n    LinkList newlist;\n    InitLink(&newlist);\n    ListLoad(&newlist);\n    PrintLink(&newlist);\n    \n    \n    DestoryLink(&mylist);\n    DestoryLink(&newlist);\n    return 0;\n}\n```\n\n# jsonä¸“é¢˜\n\n```c\n//jsonå¯¹è±¡ç»“æ„ï¼š\n/* The cJSON structure: */\ntypedef struct cJSON {\n\tstruct cJSON *next,*prev;\n\tstruct cJSON *child;\n\tint type;\n\tchar *valuestring;\n\tint valueint;\n\tdouble valuedouble;\n\tchar *string;\n}cJSON;\n```\n\n```json\n//yhp.jsonæ–‡ä»¶\n{\n    \"name\":\"æ¨å’Œå¹³\",\n    \"age\":17,\n    \"LOVE\":[\"Study\",\"Programming\",\"Go shopping\"],\n    \"score\":145,\n    \"address\":\"shanxi\"\n}\n```\n\n![image-20210827202745517](../../images/C_%E6%96%87%E4%BB%B6/image-20210827202745517.png)\n\n## æœ‰ä»·å€¼çš„é—®é¢˜\n\nå¦‚ä½•æŠŠæ•°æ®é€šè¿‡jsonæŠŠæ•°æ®å†™åˆ°æ–‡ä»¶ï¼Œ\n\nå¦‚ä½•é€šè¿‡æ–‡ä»¶å†™åˆ°ç¨‹åºä¸­ã€‚\n\n## `cJSON_InitHooks`\n\n`extern void cJSON_InitHooks(cJSON_Hooks* hooks);`\n\nå‘cJSON æä¾›malloc å’Œfree å‡½æ•°ï¼šæŒ‚æ¥å†…å­˜æ± \n\n## `cJSON_Parse`\n\n`extern cJSON* cJSON_Parse(const char *value);`\n\næä¾›ä¸€ä¸ªJSON å—ï¼Œç„¶åè¿”å›ä¸€ä¸ªå¯ä»¥æŸ¥è¯¢çš„cJSON å¯¹è±¡ã€‚å®Œæˆåä¸è¦å¿˜äº†è°ƒç”¨`cJSON_Delete`ã€‚\n\n## `cJSON_Print`\n\n`extern char* cJSON_Print(cJSON\\* item);`\n\nå°†cJSON å®ä½“å‘ˆç°ä¸ºç”¨äºä¼ è¾“/å­˜å‚¨çš„æ–‡æœ¬ã€‚å®Œæˆåé‡Šæ”¾char\\*ã€‚\n\n\n```c\n#include<stdio.h>\n#include<stdlib.h>  // malloc free  exit\n#include<assert.h>\n#include<string.h>\n#include\"cJSON.h\"\nstruct Student\n{\n    char s_id[20];\n    char s_name[20];\n    char s_sex[8];\n    int s_age;\n};\nint main()\n{\n    struct Student *pstud;\n    int n = 0;\n    char *buff = NULL;\n    int len = 0;\n    FILE *fp = fopen(\"Student.json\",\"rb\");\n    if(fp == NULL) exit(1);\n    fseek(fp,0,SEEK_END);\n    len = ftell(fp);  // file size \n    rewind(fp);\n    \n    buff = (char*)calloc(sizeof(char),len+1);\n    //fgets(buff,len+1,fp); // \n    fread(buff,sizeof(char),len+1,fp);\n    fclose(fp); \n    fp = NULL;\n    printf(\"%s\\n\",buff);\n    cJSON *json = cJSON_Parse(buff);\n    free(buff); buff = NULL;\n    cJSON *array = cJSON_GetObjectItem(json,\"Student\");\n    \n    n = cJSON_GetArraySize(array);\n    \n    printf(\"n : %d \\n\",n);\n    \n    pstud = (struct Student*)calloc(sizeof(struct Student),n);\n    for(int i = 0;i<n;++i)\n    {\n        cJSON *obj = cJSON_GetArrayItem(array,i);\n        cJSON *id = cJSON_GetObjectItem(obj,\"id\");\n        cJSON *name = cJSON_GetObjectItem(obj,\"name\");\n        cJSON *sex = cJSON_GetObjectItem(obj,\"sex\");\n        cJSON *age = cJSON_GetObjectItem(obj,\"age\");\n        strcpy(pstud[i].s_id,id->valuestring);\n        strcpy(pstud[i].s_name,name->valuestring);\n        strcpy(pstud[i].s_sex,sex->valuestring);\n        pstud[i].s_age=age->valueint;\n        char *s = cJSON_Print(obj);\n        printf(\"%s \\n\",s);\n        free(s);\n        printf(\"id: %s,name: %s,sex: %s,age: %d\\n\",pstud[i].s_id,pstud[i].s_name,pstud[i].s_sex,pstud[i].s_age);\n    }\n\n    return 0;\n}\n\n#if 0\nint main()\n{\n    struct Student stud[]=\n    {\n        {\"09001\",\"yhping\",\"man\",23},\n        {\"09002\",\"lijianli\",\"man\",90},\n        {\"09003\",\"tianjia\",\"man\",12},\n        {\"09004\",\"liulu\",\"woman\",18},\n        {\"09005\",\"baihen\",\"man\",17}\n    };\n    int n = sizeof(stud)/sizeof(stud[0]); \n    cJSON *json = cJSON_CreateObject();\n    cJSON *array = cJSON_CreateArray();\n    cJSON_AddItemToObject(json,\"Student\",array);\n    for(int i = 0;i<n;++i)\n    { // 11:53\n        cJSON *obj = cJSON_CreateObject();\n        cJSON_AddItemToArray(array,obj);\n        //cJSON_AddItemToObject(obj,\"id\",cJSON_CreateString(stud[i].s_id));\n        cJSON_AddStringToObject(obj,\"id\",stud[i].s_id);\n        cJSON_AddStringToObject(obj,\"name\",stud[i].s_name);\n        cJSON_AddStringToObject(obj,\"sex\",stud[i].s_sex);\n        cJSON_AddNumberToObject(obj,\"age\",stud[i].s_age);\n    }\n    char *s = cJSON_Print(json);\n    printf(\"%s \\n\",s);\n    FILE *fp = fopen(\"Student.json\",\"wb\");\n    if(fp == NULL) exit(1);\n    fwrite(s,sizeof(char),strlen(s),fp);\n    fclose(fp);\n    fp = NULL;\n    free(s);\n    s = NULL;\n    cJSON_Delete(json);\n    json = NULL;\n    return 0;\n}\nint main()\n{\n    cJSON *json = cJSON_CreateObject();\n    // \"{}\"\n    cJSON_AddItemToObject(json,\"name\",cJSON_CreateString(\"yhping\"));\n    //\" {\\\"name\\\":\\\"yhping\\\"} \"\n    cJSON_AddItemToObject(json,\"sex\",cJSON_CreateString(\"man\"));// object =>key:value\n    //cJSON *sex = cJSON_CreateString(\"man\");\n    //cJSON_AddItemToObject(json,\"sex\",sex);\n    //\"  {\\\"name\\\":\\\"yhping\\\" , \\\"sex\\\":\\\"man\\\"} \"\n    cJSON_AddItemToObject(json,\"age\",cJSON_CreateNumber(23));\n    //\"  {\\\"name\\\":\\\"yhping\\\" , \\\"sex\\\":\\\"man\\\", \\\"age\\\":23} \"\n    \n    cJSON *array = NULL;\n    cJSON_AddItemToObject(json,\"LOVE\",array = cJSON_CreateArray());\n    // \"  {\\\"name\\\":\\\"yhping\\\" , \\\"sex\\\":\\\"man\\\", \\\"age\\\":23,\"LOVE\":[]} \"\n    cJSON_AddItemToArray(array,cJSON_CreateString(\"Study\"));\n    // \"  {\\\"name\\\":\\\"yhping\\\" , \\\"sex\\\":\\\"man\\\", \\\"age\\\":23,\"LOVE\":[\"Study\"]} \"\n    cJSON_AddItemToArray(array,cJSON_CreateString(\"Programming\"));\n    cJSON_AddItemToArray(array,cJSON_CreateString(\"Go shopping\"));\n    \n    cJSON_AddItemToObject(json,\"score\",cJSON_CreateNumber(145));\n    //cJSON_AddNumberToObject(json,\"score\",145);\n    \n    cJSON_AddItemToObject(json,\"address\",cJSON_CreateString(\"shanxi\"));\n    //cJSON_AddStringToObject(json,\"addree\",\"shanxi\");\n    \n    char *str = cJSON_Print(json);\n    printf(\"%s \\n\",str);\n    \n    free(str);\n    str = NULL;\n    cJSON_Delete(json);\n    json = NULL;\n    \n    return 0;\n}\n\nint main()\n{\n    char *buff = NULL;\n    int len = 0;\n    FILE *fp = fopen(\"Testcjson.json\",\"rb\");\n    if(fp == NULL) exit(1);\n    fseek(fp,0,SEEK_END);\n    len = ftell(fp);  // file size \n    rewind(fp);\n    \n    buff = (char*)calloc(sizeof(char),len+1);\n    //fgets(buff,len+1,fp); // \n    fread(buff,sizeof(char),len+1,fp);\n    \n    cJSON *json = cJSON_Parse(buff);\n    \n    int n = cJSON_GetArraySize(json);\n    \n    fclose(fp);\n    fp = NULL;\n    free(buff);\n    buff = NULL;\n    return 0;\n}\nint main()\n{\n    char str[]=\"{ \\\"name\\\":\\\"yhping\\\" ,\\\"sex\\\":\\\"man\\\",\\\"age\\\":23 }\";\n    \n    char stra[]=\"{name: yhping,sex:man,age:23}\";\n    cJSON *json = cJSON_Parse(str);\n    \n    char *s = cJSON_Print(json);\n    char *p = cJSON_PrintUnformatted(json);\n    FILE *fp = fopen(\"Testcjson.json\",\"w\");\n    \n    printf(\"%s \\n\",s);\n    printf(\"%s \\n\",p);\n    fprintf(fp,\"%s\",s);\n    fclose(fp);\n    \n    free(s);\n    s = NULL;\n    \n    return 0;\n}\n#endif\n```\n\næ”¹è¿›\n\n```c\ntypedef struct cJSON\n{\n    struct cJSON* next,*prev;\n    struct cJSON* child;\n    int type;\n    union\n    {\n        char* valuestring;\n        int valueint;\n        double valuedouble;\n    }\n    char* string;\n}\n```\n# æ€»ç»“\n\nw/aå¯ä»¥ä¸»åŠ¨åˆ›å»ºæ–‡ä»¶ï¼Œrä¸èƒ½åˆ›å»ºæ–‡ä»¶ã€‚","tags":["tulun"],"categories":["C"]},{"title":"Cè¯­è¨€_åŠ¨æ€å†…å­˜ç®¡ç†","url":"/C/Cè¯­è¨€_åŠ¨æ€å†…å­˜ç®¡ç†/","content":"\n# æœ¬ç« å†…å®¹\n\n1. ä»€ä¹ˆæ˜¯åŠ¨æ€å†…å­˜\n2. åŠ¨æ€å†…å­˜ç®¡ç†å‡½æ•°\n3. åŠ¨æ€å†…å­˜çš„ä½¿ç”¨\n4. åŠ¨æ€å†…å­˜ä¸ç»“æ„ä½“\n\n# ä»€ä¹ˆæ˜¯åŠ¨æ€å†…å­˜\n\nå…ˆçœ‹ä¸€æ®µç¨‹åºï¼š\n\n```c\n#include<stdio.h>\nint main()\n{\n    char str[1024 * 1024];\t// éœ€è¦1MBå­˜å‚¨ç©ºé—´\n    print(\"hehe \\n\");\n    return 0;\n}\n```\n\n![image-20210819005329023](../../images/C_%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image-20210819005329023.png)\n\nè¿è¡Œæ—¶ç¨‹åºå´©æºƒï¼ˆåœ¨Windowsç³»ç»Ÿä¸‹ï¼‰ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ\n\n> æ³¨æ„æŠ¥é”™ä¿¡æ¯ï¼š\n>\n> `0xC00000FD`: Stackoverflow\n\nå†æ¬¡åˆ†æç¼–è¯‘é“¾æ¥è¿‡ç¨‹ï¼š\n\n![image-20220604082515963](../../images/C_åŠ¨æ€å†…å­˜ç®¡ç†/image-20220604082515963.png)\n\nå…ˆæ¥è°ˆæ ˆåŒºï¼Œæˆ‘ä»¬çŸ¥é“æ ˆåŒºçš„ç©ºé—´åœ¨å‡½æ•°è¢«è°ƒæ—¶ä¼šåˆ†é…ï¼Œç”¨äºå­˜æ”¾å‡½æ•°çš„å‚æ•°å€¼ï¼Œå±€éƒ¨å˜é‡ç­‰å€¼ã€‚åœ¨Windowsä¸­æ ˆçš„é»˜è®¤å¤§å°æ˜¯`1MB`ï¼Œåœ¨vsä¸­å¯ä»¥è®¾ç½®æ ˆåŒºçš„å¤§å°ï¼›åœ¨Linuxä¸­æ ˆçš„é»˜è®¤å¤§å°æ˜¯`10MB`ï¼Œåœ¨gccç¼–è¯‘æ—¶å¯ä»¥è®¾ç½®æ ˆåŒºçš„å¤§å°ã€‚\n\nå†çœ‹å †åŒºï¼Œç¨‹åºè¿è¡Œæ—¶å¯ä»¥åœ¨å †åŒºåŠ¨æ€åœ°è¯·æ±‚ä¸€å®šå¤§å°çš„å†…å­˜ï¼Œå¹¶åœ¨ç”¨å®Œä¹‹åå½’è¿˜ç»™å †åŒºã€‚åœ¨Liunxç³»ç»Ÿä¸­ç”¨æˆ·å¯ç”¨çš„å †åŒºçš„å¤§å°æ¥è¿‘`3GB`ã€‚Windowsä¸‹çš„ç”¨æˆ·å †åŒºå¤§å°æ˜¯æ¥è¿‘`2G`ã€‚å¯å‚è€ƒæ­¤æ–‡ç« ï¼š[æ ˆå’Œå †çš„å¤§å°ï¼Œç”³è¯·ä¸€ä¸ªæ•´å½¢æ•°ç»„æœ€å¤§å¯ä»¥è¾¾åˆ°å¤šå°‘ï¼ˆLinuxå’ŒWindowsï¼‰](https://www.its203.com/article/qq_37200329/97949658)\n\n**å¦‚æœæˆ‘ä»¬éœ€è¦å¤§å—å†…å­˜ï¼Œæˆ–è€…ç¨‹åºåœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­æ‰çŸ¥é“æ‰€éœ€å†…å­˜å¤§å°ï¼Œæˆ‘ä»¬å°±ä»å †åŒºåˆ†é…ç©ºé—´**ã€‚\n\n## åŠ¨æ€å†…å­˜åˆ†é…å‡½æ•°\n\nCè¯­è¨€ä¸­åŠ¨æ€å†…å­˜ç®¡ç†çš„æœ‰å››ä¸ªå‡½æ•°ï¼š`malloc`ï¼Œ`calloc`ï¼Œ`realloc`ï¼Œ`free`ï¼Œéƒ½éœ€è¦å¼•ç”¨`stdlib.h`æˆ–`malloc.h`æ–‡ä»¶ã€‚\n\n# malloc\n\nå‘å †åŒºç”³è¯·ä¸€å—æŒ‡å®šå¤§å°çš„è¿ç»­å†…å­˜ç©ºé—´ã€‚\n```c\nusing size_t = unsigned int;\nvoid* malloc(size_t size);\nå‚æ•°ï¼š\n\tsize\t- è¦åˆ†é…çš„å­—èŠ‚æ•°\nè¿”å›å€¼ï¼š\n\tæˆåŠŸæ—¶, è¿”å›æŒ‡å‘æ–°åˆ†é…å†…å­˜çš„æŒ‡é’ˆ;\n\tå¤±è´¥æ—¶, è¿”å›ç©ºæŒ‡é’ˆã€‚\n```\n\n1. åˆ†é…`size`å­—èŠ‚çš„æœªåˆå§‹åŒ–å†…å­˜ã€‚\n2. è‹¥åˆ†é…æˆåŠŸï¼Œåˆ™è¿”å›ä¸ºä»»ä½•æ‹¥æœ‰**åŸºç¡€å¯¹é½**çš„å¯¹è±¡ç±»å‹å¯¹é½çš„æŒ‡é’ˆã€‚\n3. è‹¥`size`ä¸ºé›¶ï¼Œåˆ™`malloc`çš„è¡Œä¸ºæ˜¯å®ç°å®šä¹‰çš„ã€‚ä¾‹å¦‚å¯è¿”å›ç©ºæŒ‡é’ˆï¼Œäº¦å¯è¿”å›éç©ºæŒ‡é’ˆï¼Œä½†ä¸åº”å½“**è§£å¼•ç”¨**è¿™ç§éç©ºæŒ‡é’ˆï¼Œè€Œä¸”åº”å°†å®ƒä¼ é€’ç»™ä»¥é¿å…å†…å­˜æ³„æ¼ã€‚\n\n# free\n\nç”¨æ¥é‡Šæ”¾ä¸”ä»…èƒ½é‡Šæ”¾ä»`malloc`ï¼Œ`realloc`ï¼Œ`calloc`æˆåŠŸè·å–åˆ°çš„åŠ¨æ€å†…å­˜åˆ†é…çš„ç©ºé—´ã€‚é‡Šæ”¾çš„ä¸æ˜¯æŒ‡é’ˆæœ¬èº«ï¼Œè€Œæ˜¯æŒ‡é’ˆæ‰€æŒ‡çš„å †åŒºç©ºé—´ã€‚\n\n```cpp\nvoid free(void * ptr);\n```\n\né‡Šæ”¾ä¹‹å‰ç”±`malloc()`ã€`calloc()`ã€`aligned_alloc() (C11èµ·)`æˆ–`realloc()`åˆ†é…çš„ç©ºé—´ã€‚\n\n1. è‹¥`ptr`ä¸ºç©ºæŒ‡é’ˆï¼Œåˆ™å‡½æ•°ä¸è¿›è¡Œæ“ä½œã€‚\n2. è‹¥`ptr`çš„å€¼ä¸æ˜¯ä¹‹å‰ä»`malloc()`ã€`calloc()`ã€`realloc()`æˆ–`aligned_alloc() (C11èµ·)`è¿”å›çš„å€¼ï¼Œåˆ™è¡Œä¸ºæœªå®šä¹‰ã€‚\n3. è‹¥`ptr`æ‰€æŒ‡ä»£çš„å†…å­˜åŒºåŸŸå·²ç»è¢«è§£åˆ†é…ï¼Œåˆ™è¡Œä¸ºæœªå®šä¹‰ã€‚\n4. è‹¥åœ¨`free()`è¿”å›åé€šè¿‡æŒ‡é’ˆ`ptr`è®¿é—®å†…å­˜ï¼Œåˆ™è¡Œä¸ºæœªå®šä¹‰ï¼ˆé™¤éå¦ä¸€ä¸ªåˆ†é…å‡½æ•°æ°å¥½è¿”å›ç­‰äº`ptr`çš„å€¼ï¼‰ã€‚\n\n**å‚æ•°**\nptr æŒ‡å‘è¦è§£åˆ†é…çš„å†…å­˜çš„æŒ‡é’ˆ\n**è¿”å›å€¼ï¼ˆæ— ï¼‰**\næ³¨è§£\næ­¤å‡½æ•°æ¥æ”¶ç©ºæŒ‡é’ˆï¼ˆå¹¶å¯¹å…¶ä¸å¤„ç†ï¼‰ä»¥å‡å°‘ç‰¹ä¾‹çš„æ•°é‡ã€‚ä¸ç®¡åˆ†é…æˆåŠŸä¸å¦ï¼Œåˆ†é…å‡½æ•°è¿”å›çš„æŒ‡é’ˆéƒ½èƒ½ä¼ é€’ç»™ free() ã€‚\n\n## ç¤ºä¾‹\n\n\n\n## é¢è¯•é‡ç‚¹\n\n\n\n\n\n# calloc\n\nåˆ†é…å¹¶ä½¿ç”¨é›¶åˆå§‹åŒ–è¿ç»­å†…å­˜ç©ºé—´\n\n```c\nvoid * calloc(size_t num, size_t size);\nå‚æ•°:\n\tnum\t\t- å¯¹è±¡ï¼ˆå…ƒç´ ï¼‰æ•°ç›®\n\tsize\t- æ¯ä¸ªå¯¹è±¡ï¼ˆå…ƒç´ ï¼‰çš„å¤§å°\nè¿”å›å€¼:\n\tæˆåŠŸæ—¶ï¼Œè¿”å›æŒ‡å‘æ–°åˆ†é…å†…å­˜çš„æŒ‡é’ˆã€‚\n\tå¤±è´¥æ—¶ï¼Œè¿”å›ç©ºæŒ‡é’ˆã€‚\n```\n\nä¸º`num`ä¸ªå¯¹è±¡ï¼ˆå…ƒç´ ï¼‰çš„æ•°ç»„åˆ†é…å†…å­˜ï¼Œå¹¶åˆå§‹åŒ–æ‰€æœ‰åˆ†é…å­˜å‚¨ä¸­çš„å­—èŠ‚ä¸ºé›¶ã€‚\n\n1. è‹¥åˆ†é…æˆåŠŸï¼Œä¼šè¿”å›æŒ‡å‘åˆ†é…å†…å­˜å—æœ€ä½ä½ï¼ˆé¦–ä½ï¼‰å­—èŠ‚çš„æŒ‡é’ˆï¼Œå®ƒä¸ºä»»ä½•ç±»å‹é€‚å½“åœ°å¯¹é½ã€‚\n2. è‹¥`size`ä¸ºé›¶ï¼Œåˆ™è¡Œä¸ºæ˜¯å®ç°å®šä¹‰çš„ï¼ˆå¯è¿”å›ç©ºæŒ‡é’ˆï¼Œæˆ–è¿”å›ä¸å¯ç”¨äºè®¿é—®å­˜å‚¨çš„éç©ºæŒ‡é’ˆï¼‰ã€‚\n\n## æ¨¡æ‹Ÿå®ç°\n\nå®é™…ä¸Šï¼Œcallocæ˜¯åŸºäºmallocå®ç°çš„ã€‚\n\n```c\nvoid* my_calloc(size_t count, size_t size)\n{\n    void* s = malloc(count * size);\n    if(s != NULL)\n    {\n        memset(s, 0, count * size);\n    }\n    return s;\n}\n```\n\n# realloc\n\næ‰©å……ä¹‹å‰åˆ†é…çš„å†…å­˜å—(é‡æ–°åˆ†é…å†…å­˜å—)ã€‚\n\n```c\nvoid * realloc(void * ptr, size_t new_size);\nå‚æ•°:\n\tptr\t\t\t- æŒ‡å‘éœ€è¦é‡æ–°åˆ†é…çš„å†…å­˜åŒºåŸŸçš„æŒ‡é’ˆ\n\tnew_size\t- æ•°ç»„çš„æ–°å¤§å°ï¼ˆå­—èŠ‚æ•°ï¼‰\nè¿”å›å€¼:\n\tæˆåŠŸæ—¶ï¼Œè¿”å›æŒ‡å‘æ–°åˆ†é…å†…å­˜çš„æŒ‡é’ˆã€‚åŸæŒ‡é’ˆptrå¤±æ•ˆï¼Œè€Œä¸”ä»»ä½•é€šè¿‡å®ƒçš„è®¿é—®æ˜¯æœªå®šä¹‰è¡Œä¸ºï¼ˆå³ä½¿é‡åˆ†é…æ˜¯å°±åœ°çš„ï¼‰ã€‚\n\tå¤±è´¥æ—¶ï¼Œè¿”å›ç©ºæŒ‡é’ˆã€‚åŸæŒ‡é’ˆpträ¿æŒæœ‰æ•ˆã€‚\n```\n\né‡æ–°åˆ†é…ç»™å®šçš„å†…å­˜åŒºåŸŸã€‚å®ƒå¿…é¡»æ˜¯ä¹‹å‰ä¸º`malloc()`ã€`calloc()`æˆ–`realloc()`æ‰€åˆ†é…ï¼Œå¹¶ä¸”ä»æœªè¢«`free`æˆ–`realloc`çš„è°ƒç”¨æ‰€é‡Šæ”¾ã€‚å¦åˆ™ï¼Œç»“æœæœªå®šä¹‰ã€‚\n\né‡æ–°åˆ†é…æŒ‰ä»¥ä¸‹äºŒè€…ä¹‹ä¸€æ‰§è¡Œï¼š\n\n1. å¯èƒ½çš„è¯ï¼Œæ‰©å¼ æˆ–æ”¶ç¼©`ptr`æ‰€æŒ‡å‘çš„å·²å­˜åœ¨å†…å­˜ã€‚å†…å®¹åœ¨æ–°æ—§å¤§å°ä¸­çš„è¾ƒå°è€…èŒƒå›´å†…ä¿æŒä¸å˜ã€‚è‹¥æ‰©å¼ èŒƒå›´ï¼Œåˆ™æ•°ç»„æ–°å¢éƒ¨åˆ†çš„å†…å®¹æ˜¯æœªå®šä¹‰çš„ã€‚\n2. åˆ†é…ä¸€ä¸ªå¤§å°ä¸º`new_size`å­—èŠ‚çš„æ–°å†…å­˜å—ï¼Œå¹¶å¤åˆ¶å¤§å°ç­‰äºæ–°æ—§å¤§å°ä¸­è¾ƒå°è€…çš„å†…å­˜åŒºåŸŸï¼Œç„¶åé‡Šæ”¾æ—§å†…å­˜å—ã€‚\n\n1. è‹¥æ— è¶³å¤Ÿå†…å­˜ï¼Œåˆ™ä¸é‡Šæ”¾æ—§å†…å­˜å—ï¼Œå¹¶è¿”å›ç©ºæŒ‡é’ˆã€‚\n2. è‹¥`ptr`æ˜¯`NULL`ï¼Œåˆ™è¡Œä¸ºä¸è°ƒç”¨`malloc(new_size)`ç›¸åŒã€‚\n3. è‹¥`new_size`ä¸ºé›¶ï¼Œåˆ™è¡Œä¸ºæ˜¯å®ç°å®šä¹‰çš„ï¼ˆå¯è¿”å›ç©ºæŒ‡é’ˆï¼Œæ­¤æƒ…å†µä¸‹å¯èƒ½æˆ–å¯èƒ½ä¸é‡Šæ”¾æ—§å†…å­˜ï¼Œæˆ–è¿”å›ä¸ä¼šç”¨äºè®¿é—®å­˜å‚¨çš„éç©ºæŒ‡é’ˆï¼‰ã€‚\n\n## ç¤ºä¾‹\n\n```c\n#include<stdlib.h>\n#include<stdio.h>\nint main()\n{\n    int n = 10;\n    int m = 5;\n    int dm = 3;\n    //ç°åœ¨ç”³è¯· m ä¸ªintç©ºé—´ã€‚\n    int* p = (int*)malloc(sizeof(int) * m);\n    if (p == NULL)\n    {\n        exit(1);\n    }\n    for (int i = 0; i < m; ++i)\n    {\n        p[i] = i;\n    }\n\t//ç°åœ¨æ‰©å±•åˆ° n ä¸ªintç©ºé—´ã€‚\n    int* newdata = (int*)realloc(p, sizeof(int) * n);//æ‰©å±•åˆ°nä¸ªï¼Œä¸æ˜¯æ‰©å±•nä¸ª\n    if (NULL == newdata)\n    {\n        printf(\"å †æ— æ›´å¤šç©ºé—´ï¼Œå¢å®¹å¤±è´¥\\n\");\n        exit(1);\n    }\n    p = newdata;\n}\n```\n\n## æ‰©å®¹\n\nreallocæ‰©å®¹æœ‰3ç§æƒ…å†µã€‚\n\n### 1 - åé¢è¶³å¤Ÿ, å°±åœ°\n\nåç»­æœ‰è¶³å¤Ÿçš„å¯åˆ†é…ç©ºé—´ã€‚å›¾ç¤ºå¦‚ä¸‹ï¼š\n\n![image-20220604184349335](../../images/C_åŠ¨æ€å†…å­˜ç®¡ç†/image-20220604184349335.png)\n\n1. ä¸‹è¶Šç•Œæ ‡è®°åç§»ã€‚\n2. ä¿®æ”¹ä¸Šè¶Šç•Œæ ‡è®°ä¹‹ä¸Šçš„ä¿¡æ¯ä¸ºæœ€æ–°å¤§å°å€¼ã€‚\n\n### 2 - åé¢ä¸è¶³, æ¬åˆ°æ›´å¤§çš„ç©ºåœ°\n\nåç»­æœªåˆ†é…å†…å­˜ç©ºé—´ä¸è¶³å¤Ÿå¤§ï¼Œä¸èƒ½åˆ†é…ç©ºé—´ã€‚å›¾ç¤ºå¦‚ä¸‹ï¼š\n\n![image-20220604184421960](../../images/C_åŠ¨æ€å†…å­˜ç®¡ç†/image-20220604184421960.png)\n\n1. åœ¨å †å†…å­˜å…¶ä»–åŒºåŸŸå¼€è¾Ÿè¦æ‰©å±•çš„å¤§å°ã€‚\n2. åŸæœ¬çš„å†…å­˜å†…å®¹æ‹·è´åˆ°æ–°ç©ºé—´ã€‚\n3. åŸæœ¬çš„å†…å­˜é‡Šæ”¾ã€‚\n4. åŸæ¥çš„æŒ‡é’ˆå¤±æ•ˆï¼Œéœ€è¦é‡æ–°æ¥æ”¶æ–°æŒ‡é’ˆï¼ˆè¿”å›å€¼ï¼‰ã€‚\n\n### 3 - å †ç©ºé—´ä¸è¶³, ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼\n\n```c\nint main()\n{\n    int m = 100;\n    int n = 1000;\n    int * p = (int*)malloc(sizeof(int) * m);\n    for(int i = 0; i<m; ++i)\n    {\n        p[i] = i;\n    }\n    // ç”± 100ä¸ªç©ºé—´æ‰©å±•åˆ°1000ä¸ªç©ºé—´\n    p = (int*)realloc(p, sizeof(int) * n);\n    //å¦‚æœè¿”å›äº†ä¸€ä¸ªNULLå‘¢ï¼ŸæŠŠpç»™å†²æ‰äº†ï¼\n}\n```\n\nå †å†…å­˜ä¸è¶³ï¼Œæ‰©å±•ç©ºé—´å¤±è´¥ï¼Œ`realloc`å‡½æ•°è¿”å›NULLã€‚\n\næ­¤æ—¶ä¼šäº§ç”Ÿä¸€ä¸ª**å·¨å¤§çš„å‘**ã€‚\n\nå¦‚æœä½ æ²¡æœ‰äº‹å…ˆä¿å­˜æŒ‡é’ˆpçš„å€¼ï¼Œé‚£ä¹ˆpçš„å€¼å°†ä¼šä¸¢å¤±ã€‚å°±äº§ç”Ÿäº†å†…å­˜æ³„æ¼ã€‚\n\n> å†…å­˜æ³„æ¼æŒ‡çš„ä¸æ˜¯pæ‰€æŒ‡çš„ç©ºé—´è¢«é‡Šæ”¾äº†ï¼Œè€Œæ˜¯pæŒ‡é’ˆæ‰€æŒ‡çš„åœ°å€æ— ä»æŸ¥æ‰¾äº†ï¼Œä»è€Œæ— æ³•ç®¡ç†åŸæœ‰çš„å†…å­˜ç©ºé—´äº†ã€‚\n\n#### å®‰å…¨çš„æ–¹æ¡ˆ\n\n```c\nint main()\n{\n    int m = 100;\n    int n = 1000;\n    int * p = (int*)malloc(sizeof(int) * m);\n    for(int i = 0; i<m; ++i)\n    {\n        p[i] = i;\n    }\n    // ç”± 100ä¸ªç©ºé—´æ‰©å±•åˆ°1000ä¸ªç©ºé—´\n    int * newdata = (int*)realloc(p, sizeof(int)*n);\n    if(newdata == NULL)\n    {\n        printf(\"å†…å­˜ä¸è¶³, reallocå¤±è´¥\\n\");\n    }\n    else\n    {\n        free(p);\t\t//å†…å­˜è¶³å¤Ÿ, freeæ‰åŸæœ‰ç©ºé—´\n        p = newdata;\n    }\n}\n```\n\n## æ¨¡æ‹Ÿå®ç° - æ‰©å®¹\n\n```c\nvoid my_realloc(void* p, size_t old_sz, size_t new_sz)\n{\n    void* newdata = malloc(size);\n    if(newdata!=NULL)\n    {\n        memmove(newdata, p, old_sz);\n    }\n    return newdata;\n}//åªèƒ½æ¨¡æ‹Ÿç¬¬äºŒç§æƒ…å†µï¼Œç¬¬ä¸€ç§æƒ…å†µéœ€è¦çŸ¥é“å†…å­˜åé¢æ˜¯å¦æœ‰è¶³å¤Ÿç©ºé—´ï¼Œéœ€è¦ç³»ç»Ÿè°ƒç”¨ã€‚\n```\n\n# å•é“¾è¡¨\n\n```c\n#pragma once\n#include<stdio.h>\n#include<stdlib.h>\n#include<string.h>\n#include<assert.h>\ntypedef int ElemType;\ntypedef struct ListNode\n{\n    ElemType data;\n    struct ListNode* next;\n}ListNode;\ntypedef struct\n{\n    ListNode* head;\n    int cursize;\n}LinkList;//é“¾è¡¨\nListNode* Buynode()\n{\n    ListNode* s = (ListNode*)malloc(sizeof(ListNode));\n    if (NULL == s)\n    {\n        exit(1);\n    }\n    memset(s, 0, sizeof(ListNode));\n    return s;\n}\nvoid Freenode(ListNode* p)\n{\n    free(p);\n}\nvoid InitList(LinkList* plist)\n{\n    assert(plist != nullptr);\n    plist->head = Buynode();\n    plist->cursize = 0;\n}\nint GetSize(const LinkList* plist)\n{\n    assert(plist != nullptr);\n    return plist->cursize;\n}\nbool isEmpty(const LinkList* plist)\n{\n    return GetSize(plist) == 0;\n}\nvoid PrintList(LinkList* plist)\n{\n    assert(plist != nullptr);\n    ListNode* p = plist->head->next;\n    while (p != NULL)\n    {\n        printf(\"%d \", p->data);\n        p = p->next;\n    }\n    printf(\"\\n\");\n}\nListNode* FindValue(LinkList* plist, ElemType val)\n{\n    assert(plist != nullptr);\n    ListNode* p = plist->head->next;\n    while (p != NULL && p->data != val)\n    {\n        p = p->next;\n    }\n    return p;\n}\nListNode* FindValue_Prev(LinkList* plist, ElemType val)\n{\n    assert(plist != nullptr);\n    ListNode* pre = plist->head;\n    ListNode* pnode = pre->next;\n    while (pnode != NULL && pnode->data != val)\n    {\n        pre = pnode;\n        pnode = pnode->next;\n    }\n    if (pnode == NULL)\n    {\n        pre = NULL;\n    }\n    return pre;\n}\nbool Insert_Next(LinkList* plist, ListNode* ptr, ElemType val)//å‘plisté“¾è¡¨ä¸­çš„ptrç»“ç‚¹ï¼ˆå‡è®¾å·²ç»æ‰¾åˆ°ï¼‰ä¹‹åæ’å…¥æ–°ç»“ç‚¹ã€‚ä¸ºå…¶ä»–æ’å…¥å‡½æ•°æœåŠ¡\n{\n    assert(plist != nullptr);\n    if (ptr == NULL)return false;\n    ListNode* pnode = Buynode();\n    pnode->data = val;\n    pnode->next = ptr->next;\n    ptr->next = pnode;\n    plist->cursize += 1;\n    return true;\n}\nvoid Push_Front(LinkList* plist, ElemType val)\n{\n    Insert_Next(plist, plist->head, val);\n}\nvoid Push_Back(LinkList* plist, ElemType val)\n{\n    ListNode* pnode = plist->head;\n    while (pnode->next != nullptr)\n    {\n        pnode = pnode->next;\n    }\n    Insert_Next(plist, pnode, val);\n}\nbool Remove(LinkList* plist, ElemType val)\n{\n    assert(plist != NULL);\n    ListNode* p = FindValue_Prev(plist, val);\n    return Erase_Next(plist, p);\n}\n//æœ€åƒåœ¾çš„219ç‰ˆ\nvoid Remove_All(LinkList* plist, ElemType val)\n{\n    assert(plist != NULL);\n    ListNode* p = NULL;\n    while ((p = FindValue_Prev(plist, val)) != NULL)\n    {\n        Erase_Next(plist, p);\n    }\n}\n//æŠ€èƒ½æå‡ç­ç‰ˆæœ¬\nvoid Remove_All(LinkList* plist, ElemType val)\n{\n    assert(plist != NULL);\n    ListNode* p = plist->head;\n    while (p->next != NULL)//è¯´æ˜pæœ‰åç»§\n    {\n        if (p->next->data == val)\n        {\n            ListNode* q = p->next;\n            p->next = q->next;\n            Freenode(q);\n            plist->cursize--;\n        }\n        else\n        {\n            p = p->next;\n        }\n    }\n}\n//æŠ€èƒ½æå‡ç­ç‰ˆæœ¬æ”¹è¿›ï¼Œ215ç‰ˆæœ¬\nvoid Remove_All(LinkList* plist, ElemType val)\n{\n    assert(plist != NULL);\n    ListNode* p = plist->head;\n    while (p->next != NULL)//è¯´æ˜pæœ‰åç»§\n    {\n        if (p->next->data == val)\n        {\n            Erase_Next(plist, p);\n        }\n        else\n        {\n            p = p->next;\n        }\n    }\n}\n//Bç«™ç‰ˆæœ¬\nvoid Remove_All(LinkList *plist, ElemType val)\n{\n    assert(plist != NULL);\n    ListNode *pre = plist->head;\n    ListNode *p = plist->head->next;\n    while(p!=NULL)\n    {\n        if(val!=p->data)\n        {\n            pre = pre->next;\n            Swap(&pre->data,&p->data);\n        }\n        p = p->next;\n    }\n    while(pre->next!=NULL)\n    {\n        Erase_Next(plist,pre);\n    }\n}\nbool IsEmpty(const LinkList* plist)\n{\n    assert(plist != NULL);\n    return plist->cursize == 0;\n}\nvoid ClearList(LinkList* plist)\n{\n    assert(plist);\n    while (!IsEmpty(plist))\n    {\n        Pop_Front(plist);\n    }\n}\nvoid DestroyList(LinkList* plist)\n{\n    assert(plist);\n    ClearList(plist);\n    Freenode(plist->head);\n    plist->head = NULL;\n}\nListNode* FindPrevNode_Pos(const LinkList* plist, int pos)\n{\n    assert(plist != nullptr);\n    if (pos<1 || pos > plist->cursize + 1)return NULL;\n    ListNode* pnode = plist->head;  //0\n    for (int i = 0; i < pos - 1;++i)\t//pos: pos=5->1 2 3 4;pos=1 -> 0\n    {\n        pnode = pnode->next;\n    }\n    return pnode;\n}\nListNode* FindNode_Pos(const LinkList* plist, int pos)\n{\n    assert(plist != nullptr);\n    if (pos<1 || pos > plist->cursize)return NULL;\n    ListNode* pnode = FindPrevNode_Pos(plist, pos);\n    return pnode->next;\n}\nvoid Insert_Item(LinkList* plist, ElemType x, ElemType val)\n{\n\n}\nbool Erase_Next(LinkList* plist, ListNode* ptr)//åˆ é™¤ptrçš„åç»­èŠ‚ç‚¹\n{\n    assert(plist != nullptr);\n    ListNode* pnode = ptr->next;\n    if (NULL == ptr || pnode == nullptr)return false;\n    ptr->next = pnode->next;\n    free(pnode);\n    plist->cursize -= 1;\n    return true;\n}\nvoid Pop_Front(LinkList* plist)//å¤´åˆ æ³•\n{\n    Erase_Next(plist, plist->head);\n}\nvoid Pop_Back(LinkList* plist)//å°¾åˆ æ³•\n{\n    ListNode* pnode = FindPrevNode_Pos(plist, plist->cursize);\n    Erase_Next(plist, pnode);\n}\n```\n\n# åŒé“¾è¡¨\n\n```c\n//My_DuLinkList.h\n#ifndef MY_DULINKLIST_H\n#define MY_DULINKLIST_H\ntypedef int ElemType;\ntypedef struct DuLNode\n{\n    struct DuLNode* prev;\n    struct DuLNode* next;\n    ElemType data;\n}DuLNode,*PDuLNode;\ntypedef struct\n{\n    PDuLNode head;\n    int cursize;\n}DuLinkList;\nDuLNode* Buynode();\nvoid Freenode(DuLNode* p);\nvoid InitDuList(DuLinkList* plist);\nvoid ClearDuList(DuLinkList* plist);\nvoid DestroyDuList(DuLinkList* plist);\nint GetSize(const DuLinkList* plist);\nbool IsEmpty(const DuLinkList* plist);\nbool Insert_Prev(DuLinkList* plist, DuLNode* ptr, ElemType val);\nvoid Push_Front(DuLinkList* plist, ElemType val);\nvoid Push_Back(DuLinnkList* plist, ElemType val);\nbool Erase(DuLinkList* plist, DuLNode* ptr);\nvoid Pop_Front(DuLinkList* plist);\nvoid Pop_Back(DuLinkList* plist);\nvoid Remove(DuLinkList* plist, ElemType val);\nvoid RemoveAll(DuLinkList* plist, ElemType val);\nvoid PrintDuList(const DuLinkList* plist);\nDuLNode* FindValue(const DuLinkList* plist, ElemType val);\nDuLNode* FindPos(const DuLinkList* plist, int pos);\n#endif\n```\n\n```c\n//My_DuLinkList.cpp\n#include<stdlib.h>//malloc free\n#include<string.h>//memset\n#include<stdio.h>//printf scanf\n#include\"My_DuLinkList.h\"\n#include<assert.h>\nDuLNode* Buynode()\n{\n    DuLNode* s = (DuLNode*)malloc(sizeof(DuLNode));\n    if(NULL==s)exit(1);\n    memset(s,0,sizeof(DuLNode));\n    return s;\n}\nvoid Freenode(DuLNode* p)\n{\n    free(p);\n}\nvoid InitDuList(DuLinkList* plist)\n{\n    assert(plist !=NULL);\n    plist->cursize = 0;\n    plist->head = Buynode();\n    plist->head->prev = plist->head;\n    plist->head->next = plist->head;\n}\nvoid PrintDuList(const DuLinkList* plist)\n{\n    assert(plist!=NULL);\n    DuLNode* pnode = plist->head->next;\n    while(pnode!=plist->head)\n    {\n        printf(\"%d \",pnode->data);\n        pnode = pnode->next;\n    }\n    printf(\"\\n\");\n}\nint GetSize(const DuLinkList* plist)\n{\n    assert(plist!=NULL);\n    return plist->cursize;\n}\nbool IsEmpty(const DuLinkList* plist)\n{\n    assert(plist != NULL);\n    return Getsize(plist)==0;\n}\nDuLNode* FindValue(const DuLinkList* plist, ElemType val)\n{\n    assert(plist!=NULL);\n    DuLNode* pnode = plist->head->next;\n    while(pnode!=plist->head&&pnode->data!=val)\n    {\n        pnode = pnode->next;\n    }\n    if(plist->head == p)pnode = NULL;\n    return pnode;\n}\n//æ’åˆ°èŠ‚ç‚¹ptrçš„å‰é©±\nbool Insert_Prev(DuLinkList* plist, DuLNode* ptr, ElemType val)\n{\n    assert(plist!=NULL);\n    if(ptr==NULL)return false;\n    DuLNode* s = Buynode();\n    \n    s->prev = ptr->prev;\n    s->next = ptr;\n    ptr->prev->next = s;\n    ptr->prev = s;\n    /*ç¬¬äºŒç§å†™æ³•\n    s->prev = ptr->prev;\n    s->next = ptr;\n    ptr->prev = s;\n    s->prev->next = s;\n    */\n    /*ç¬¬ä¸‰ç§å†™æ³•\n    \t//å…ˆå¤„ç†next\n    s->next = ptr;\n    s->prev->next = s;\n    \t//åå¤„ç†prev\n    s->prev = ptr->prev;\n    ptr->prev = s;\n    */\n    \n    s->data = val;\n    plist->cursize++;\n    return true;\n}\nvoid Push_Front(DuLinkList* plist, ElemType val)\n{\n    assert(plist!=NULL);\n    Insert_Prev(plist, plist->head->next, val);\n}\nvoid Push_Back(DuLinnkList* plist, ElemType val)\n{\n    assert(plist!=NULL);\n    Insert_Prev(plist, plist->head, val);\n}\nbool Erase(DuLinkList* plist, DuLNode* ptr)\n{\n    assert(plist!=NULL);\n    if(ptr==NULL)return false;\n    ptr->prev->next = ptr->next;\n    ptr->next->prev = ptr->prev;\n    Freenode(ptr);\n    plist->cursize--;\n    return true;\n}\nvoid Pop_Front(DuLinkList* plist)\n{\n    assert(plist!=NULL);\n    if(!IsEmpty(plist))\n    {\n        Erase(plist,plist->head->next);\n    }\n}\nvoid Pop_Back(DuLinkList* plist)\n{\n    assert(plist!=NULL);\n    if(!IsEmpty(plist))\n    {\n        Erase(plist,plist->head->prev);\n    }\n}\nvoid Remove(DuLinKList* plist, ElemType val)\n{\n    assert(plist!=NULL);\n    Erase(plist, FindValue(plist, val));\n}\nvoid RemoveAll(DuLinkList* plist, ElemType val)\n{\n    \n}\nvoid ClearDuList(DuLinkList* plist)\n{\n    assert(plist != NULL);\n    while(!Empty(plist))\n    {\n        Pop_Front(plist);\n    }\n}\nvoid DestroyDuList(DuLinkList* plist)\n{\n    assert(plist!=NULL);\n    ClearDuList(plist);\n    Freenode(plist->head);\n}\nDuLNode* FindPos(const DuLinkList* plist, int pos)\n{\n    assert(plist!=NULL);\n    \n}\n```\n\n\n\n```c\n//test.cpp\n#include<assert.h>\n#include<string.h>\n#include\"My_DuLinkList.h\"\nint main()\n{\n    int ar[] = {12,23,34,45,56,67,78,89,90,100};\n    int n = sizeof(ar)/sizeof(ar[0]);\n    DuLinkList mylist;\n    InitDuList(&mylist);\n    for(int i = 0;i<n;++i)\n    {\n        Push_Back(&mylist);\n        PrintDuList(&mylist);\n    }\n}\n```\n\n","categories":["C"]},{"title":"Cè¯­è¨€_æ•°æ®ç±»å‹_æµ®ç‚¹å‹","url":"/C/Cè¯­è¨€_æ•°æ®ç±»å‹_æµ®ç‚¹å‹/","content":"# è¯¾ä»¶\n\n![image-20210818232054410](../../images/C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/image-20210818232054410.png)\n\n![image-20210818232259910](../../images/C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/image-20210818232259910.png)\n![image-20210818232907404](../../images/Cæ•°æ®ç±»å‹/image-20210818232907404.png)\n\n![image-20210818231225754](../../images/C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/image-20210818231225754.png)\n\n![image-20210818231301755](../../images/C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/image-20210818231301755.png)\n![image-20210818231320838](../../images/Cæ•°æ®ç±»å‹/image-20210818231320838.png)\n![image-20210818231341094](../../images/Cæ•°æ®ç±»å‹/image-20210818231341094.png)\n![image-20210818231554889](../../images/Cæ•°æ®ç±»å‹/image-20210818231554889.png)\n![image-20210818231457059](../../images/Cæ•°æ®ç±»å‹/image-20210818231457059.png)\n\n![image-20210818231917144](../../images/C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/image-20210818231917144.png)\n\n# äºŒè¿›åˆ¶\n\näºŒè¿›åˆ¶æ€ä¹ˆè½¬æ¢ä¸ºåè¿›åˆ¶ï¼Ÿ`0101  ->  5`\n\n```\næ¬¡æ•°ï¼š  3  2  1  0\næƒå€¼ï¼š  0  1  0  1\n  0 + 1 * 2^2 + 0 + 1 * 2^0\n= 0 +   4     + 0 +    1\n= 5\n```\n\nåè¿›åˆ¶æ€ä¹ˆè½¬æ¢ä¸ºäºŒè¿›åˆ¶ï¼Ÿ`5   ->  101`\n\n```\n    2  | 5                     \n       ---------               _\n      2  | 2   ......     1   /|\\    å3ä½\n         ---------             |\n        2  | 1   .....    0    |     å2ä½\n            -------            |\n              0   ......  1    |     å1ä½\n```\n\n## è´Ÿæ•°æ€ä¹ˆè¡¨ç¤º\n\nä»¥ä¸‹å‡æ˜¯åœ¨4ä½æœºä¸‹è®¨è®º\n\nè´Ÿ5ï¼Ÿ\n\n`5 + x = 0 -> 0101 + x = 0 -> 0101 + 1010 = 1111, 1111 + 1 = 0, x = 1010 + 1 = 1011`\n\nè´Ÿæ•°ç”¨è¡¥ç è¡¨ç¤ºï¼Œæ˜¯åŸç çš„åç åŠ 1ã€‚\n\nè´Ÿ8ï¼Ÿ\n\nå…ˆæ±‚8çš„åŸç çš„åç ï¼Œå†åŠ 1ï¼š`8: 1000 -> 0111 + 1 -> 1000`\n\nè´Ÿ8çš„è¡¥ç å±…ç„¶æ˜¯å®ƒè‡ªå·±ï¼Ÿ\n\næäº†åŠå¤©å‘ç°ï¼Œæˆ‘ä»¬ä¸€å¼€å§‹å°±è¯´æ˜äº†ï¼Œåœ¨4ä½æœºä¸‹è®¨è®ºï¼Œé‚£ä¹ˆæœ‰ç¬¦å·æ•°çš„èŒƒå›´åªæœ‰`-8 ~ 7`ï¼Œæ ¹æœ¬å°±ä¸å­˜åœ¨8ä¸€è¯´ã€‚æ‰€ä»¥ï¼Œæ— æ³•æ±‚å¾—8çš„åŸç ï¼Œä¹Ÿå› æ­¤æ— æ³•æ±‚8çš„è¡¥ç ã€‚ï¼ˆä¸ºä»€ä¹ˆ1000ä¸èƒ½ä»£è¡¨8çš„åŸç ï¼Ÿå› ä¸ºæœ‰ç¬¦å·æ•°ä¸­ç¬¬ä¸€ä½ä»£è¡¨ç¬¦å·ä½ï¼ï¼‰\n\n## 16è¿›åˆ¶\n\n```\n    0101 1100\n     5    C\n   => 0x5C\n```\n\næ•°å­—å­—é¢å¸¸é‡çš„è§„åˆ™ï¼šåªè¦ç¬¬ä¸€ä½æ˜¯æ•°å­—ï¼Œé‚£ä¹ˆä»£è¡¨è¿™æ˜¯ä¸ªæ•°å­—ã€‚è€Œ0å¼€å¤´çš„æ•°å­—ï¼Œä¸å¸¦xçš„æ˜¯8è¿›åˆ¶ï¼ˆ`0___`ï¼‰ï¼Œå¸¦xçš„æ˜¯16è¿›åˆ¶ï¼ˆ`0x___`ï¼‰ï¼Œå¸¦bçš„æ˜¯2è¿›åˆ¶ï¼ˆ`0b___`ï¼‰ã€‚\n\n16è¿›åˆ¶çš„æ ¼å¼åŒ–è¾“å‡ºçš„æè¿°ç¬¦ä¸º`%x`ï¼Œä»£è¡¨`unsigned hexadecimal integer`ï¼Œæ˜¯æ— ç¬¦å·åå…­è¿›åˆ¶æ•´å‹ã€‚\n\n```c\nint main()\n{\n    unsigned char ucVal = 0x5cu;//0x5cæ˜¯æ•°å­—ï¼Œuæ˜¯æ— ç¬¦å·æŒ‡ç¤º\n    printf(\"%hhu\\n\", ucVal);    //92\n    printf(\"%hhx\\n\", ucVal);    //5c\n}\n```\n\n### 8è¿›åˆ¶\n\n8è¿›åˆ¶çš„æ ¼å¼åŒ–è¾“å‡ºçš„æè¿°ç¬¦ä¸º`%o`ï¼Œä»£è¡¨`unsigned octal`ï¼Œæ˜¯æ— ç¬¦å·8è¿›åˆ¶æ•°ã€‚\n\n```\n    01 011 100\n     1   3   4\n   => 0134\n```\n\n```c\nint main()\n{\n    unsigned char ucVal = 0134u;//0134æ˜¯æ•°å­—ï¼Œuæ˜¯æ— ç¬¦å·æŒ‡ç¤º\n    printf(\"%hhu\\n\", ucVal);    //92\n    printf(\"%hho\\n\", ucVal);    //134\n}\n```\n\n### 2è¿›åˆ¶\n\nè¾“å‡º2è¿›åˆ¶ï¼šéœ€è¦æŠŠCè¯­è¨€è®¾ç½®ä¸º17æ ‡å‡†ã€‚\n\n2è¿›åˆ¶æ²¡æœ‰æ ¼å¼åŒ–è¾“å‡ºçš„æè¿°ç¬¦ã€‚\n\n```\n       0101 1100\n => 0b 0101 1100\n```\n\n```c\nint main()\n{\n    unsigned char ucVal = 0b0101'1100u; // 'ä¸ºåˆ†å‰²ç¬¦å·ï¼Œä¾¿äºäººæ€§åŒ–è¾“å…¥ï¼Œå¯æœ‰å¯æ— \n    printf(\"%hhu\\n\", ucVal);    //92\n    printf(\"%hho\\n\", ucVal);    //134\n}\n```\n# integer\n\n32 bits, 4 Bytes\n\n1. åŒºåˆ†æœ‰ç¬¦å·ã€æ— ç¬¦å·ï¼Œå…¶ä¸­æœ‰ç¬¦å·çš„`signed`å¯ä»¥çœç•¥ï¼›æ— ç¬¦å·å¸¦intçš„æ•´å‹çš„intå¯ä»¥çœç•¥ï¼Œå…¶ä»–æ— ç¬¦å·æ•´å‹ä¸èƒ½çœï¼›long intä¸­çš„intå¯ä»¥çœç•¥\n2. å­—é¢å¸¸é‡ï¼ˆ8ã€8uï¼‰ä¹Ÿæ˜¯æœ‰ç±»å‹çš„ï¼Œä¸å¸¦åç¼€é»˜è®¤æ˜¯æœ‰ç¬¦å·æ•°ï¼Œå¸¦uæ˜¯æ— ç¬¦å·æ•°ã€‚\n\n## long int\n\nISOæ ‡å‡†ä¸­æåˆ°ï¼Œlong intçš„å¤§å°ä¸å¾—å°äºintã€‚ç›®å‰å¾®è½¯long intçš„å¤§å°ä¸º32bitsã€4å­—èŠ‚ï¼›è€Œåœ¨Linuxä¸‹ä¸º64bitsã€8å­—èŠ‚ã€‚\n\nlongæŒ‡ç¤ºç±»å‹çš„é•¿åº¦ï¼Œæ¶‰åŠåˆ°é•¿åº¦ï¼Œæ ¼å¼åŒ–è¾“å‡ºæ—¶ï¼Œéœ€è¦æ³¨æ„åŠ ä¸Šlength specifiersï¼Œå³é•¿åº¦æè¿°ç¬¦ã€‚\n\n## long long int\n\n64bitsã€8å­—èŠ‚\n\n## short int\n\n16bitsã€2å­—èŠ‚\n\né’ˆå¯¹äºæ•´å‹å­—é¢å¸¸é‡çš„é•¿åº¦æè¿°ç¬¦æ²¡æœ‰ä¸“é—¨ç”¨äºshortçš„ï¼Œå› ä¸ºCè¯­è¨€å­—é¢å¸¸é‡æœ€å°ä¸º32ä½ã€‚å¦‚æœæ¯”32ä½å°çš„ï¼Œä¸€å¾‹å‘ä¸‹å…¼å®¹ã€‚å½’æ ¹ç»“åº•æ˜¯å› ä¸ºæ•°æ®æ€»çº¿æœ€å°‘ä¸€æ¬¡ä¼ 32ä½ã€‚\n\nä½†æ˜¯ï¼Œé’ˆå¯¹äºprintfä¸­çš„æ ¼å¼åŒ–è¾“å‡ºï¼Œè¿˜æ˜¯è¦åŒºåˆ†é•¿åº¦çš„ï¼Œå¯¹åº”shortçš„é•¿åº¦æè¿°ç¬¦ä¸ºhã€‚\n\n## char\n\nå¦‚æœè¦æ‰“å°åè¿›åˆ¶æ•´æ•°ï¼Œé‚£ä¹ˆå¯¹åº”charçš„é•¿åº¦æè¿°ç¬¦ä¸º`hh`ã€‚æ ¼å¼æè¿°ç¬¦ä¸º`i`æˆ–`u`ã€‚\n\nè€Œå¦‚æœè¦æ‰“å°å­—ç¬¦ï¼Œé‚£ä¹ˆå¯¹åº”çš„æ ¼å¼æè¿°ç¬¦ä¸º`c`ã€‚\n\nASCIIç ï¼šå½¢å¼ä¸Šæ˜¯å­—ç¬¦å›¾å½¢ï¼Œä½†æœ¬è´¨ä¸Šæ˜¯æ•´æ•°ï¼Œå¦‚`'a'`æ˜¯97ã€‚\n\n## æ•´å‹ç±»æµ‹è¯•\n\n```c\nint main()\n{\n    /* integer: 32bits */\n    /*signed*/ int iVal = 8;\n    unsigned /*int*/ uVal = 8u;\n    printf(\"%i\\n\", iVal);\n    printf(\"%u\\n\", uVal);\n    /* long int: 32bits */\n    /*signed*/ long /*int*/ lVal = 9l;\n    unsigned long /*int*/ ulVal = 9ul;\n    printf(\"%li\\n\", lVal);\n    printf(\"%lu\\n\", ulVal);\n    /* long long int: 64bits */\n    /*signed*/ long long /*int*/ llVal = 9ll;\n    unsigned long long /*int*/ ullVal = 9ull;\n    printf(\"%lli\\n\", llVal);\n    printf(\"%llu\\n\", ullVal);\n    /* short int: 16bits */\n    /*signed*/ short /*int*/ sVal = 9; //9åé¢æ²¡æœ‰ä¸“é—¨ç”¨äºshortçš„é•¿åº¦æŒ‡ç¤ºç¬¦\n    /*unsigned*/ short /*int*/ usVal = 9u;\n    printf(\"%hi\\n\", sVal);             //ä½†æ˜¯æ ¼å¼åŒ–è¾“å‡ºæœ‰ï¼Œè¦åŠ ä¸Šh\n    printf(\"%hu\\n\", usVal);\n    /* char: 8bits */\n    /*signed*/ char cVal = 9;\n    unsigned char ucVal = 9u;\n    printf(\"%hhi\\n\", cVal);\n    printf(\"%hhu\\n\", ucVal);\n    unsigned char ucVal2 = 'a';\n    printf(\"%c\\n\", ucVal2);\n}\n```\n\n# æµ®ç‚¹å‹\n\nè®¡ç®—æœºä¸­æ•´å‹å’Œæµ®ç‚¹å‹çš„è®¡ç®—æ˜¯åœ¨ä¸åŒçš„å¤„ç†å™¨ä¸‹å®Œæˆçš„ã€‚æ•´å‹å¤„ç†å™¨æ˜¯ç”±x86éƒ¨åˆ†å®Œæˆçš„ï¼Œæµ®ç‚¹å‹å¤„ç†å™¨æ˜¯ç”±x87éƒ¨åˆ†å®Œæˆçš„ã€‚å› ä¸ºæ•´å‹å’Œæµ®ç‚¹å‹çš„æ ¼å¼æ˜¯ä¸ä¸€æ ·çš„ã€‚\n\n> å°æ•°é»˜è®¤éƒ½æ˜¯æœ‰ç¬¦å·æ•°ã€‚\n\n1010.1101äºŒè¿›åˆ¶å°æ•°åŒ–ä¸ºåè¿›åˆ¶å°æ•°ã€‚ä¾ç„¶æŒ‰ç…§æ¯ä¸€ä½çš„æƒé‡å±•å¼€è®¡ç®—ï¼š\n$$\n\\begin{align}\n& 1\\times2^3+0\\times2^2+1\\times2^1+0\\times2^0+1\\times2^{-1}+1\\times2^{-2}+0\\times2^{-3}+1\\times2^{-4}\\\\\n& =8+2+\\frac{1}{2}+\\frac{1}{4}+\\frac{1}{16}\\\\\n& =10.8125\n\\end{align}\n$$\n10.8125åè¿›åˆ¶å°æ•°å¦‚ä½•åŒ–ä¸ºäºŒè¿›åˆ¶å°æ•°ï¼Ÿæ•´æ•°éƒ¨åˆ†æ˜¯ä¸€ç›´è¿›è¡Œä½™2è¿ç®—ï¼Œè€Œå°æ•°éƒ¨åˆ†å¦‚ä½•åŒ–ï¼Ÿå³0.1101ã€‚\n$$\n\\begin{align}\n0.8125\\times2&=1.625\\cdots1\\\\\n0.625\\times2&=1.250\\cdots1\\\\\n0.25\\times2&=0.500\\cdots0\\\\\n0.5\\times2&=1.000\\cdots1\\\\\n&end\n\\end{align}\n$$\nä¸æ±‚æ•´æ•°çš„äºŒè¿›åˆ¶ä¸åŒï¼Œæ±‚ä½™ä¹‹åï¼Œæ•´æ•°äºŒè¿›åˆ¶çš„ç»“æœä»ä¸‹å¾€ä¸Šé¡ºä½ã€‚è€Œå°æ•°äºŒè¿›åˆ¶æ˜¯ä»ä¸Šå¾€ä¸‹é¡ºä½ã€‚\n\n0.13åŒ–ä¸ºäºŒè¿›åˆ¶å°æ•°æ—¶ä¼šé‡åˆ°æ— é™å¾ªç¯çš„ç°è±¡ï¼š\n$$\n\\begin{align}\n0.13\\times2&=0.26\\cdots0\\\\\n0.26\\times2&=0.52\\cdots0\\\\\n0.52\\times2&=1.04\\cdots1\\\\\n0.04\\times2&=0.08\\cdots0 -- cycle\\\\\n0.08\\times2&=0.16\\cdots0\\\\\n0.16\\times2&=0.32\\cdots0\\\\\n0.32\\times2&=0.64\\cdots0\\\\\n0.64\\times2&=1.28\\cdots1\\\\\n0.28\\times2&=0.56\\cdots0\\\\\n0.56\\times2&=1.02\\cdots1\\\\\n0.02\\times2&=0.04\\cdots0\\\\\n0.04\\times2&=0.08\\cdots0 -- cycle\\\\\n&\\cdots\n\\end{align}\n$$\n\n## floatï¼ˆå•ç²¾åº¦ï¼‰\n\nå…¨ç§°ï¼šsingle point floatï¼Œå•ç²¾åº¦æµ®ç‚¹æ•°ã€‚32 bits, 4 Bytes\n\næ ¼å¼æè¿°ç¬¦ç”¨`f`ã€‚ä»£è¡¨åè¿›åˆ¶æµ®ç‚¹æ•°ï¼ˆDecimal floating pointï¼‰\n\n```c\nint main()\n{\n    float fVal = 5.0f;   //åŠ fåç¼€æŒ‡ç¤ºå…¶ä¸ºfloatç±»å‹å­—é¢å¸¸é‡\n    printf(\"%f\\n\", fVal);\n}\n```\n\n## doubleï¼ˆåŒç²¾åº¦ï¼‰\n\nå…¨ç§°ï¼šdouble point floatï¼ŒåŒç²¾åº¦æµ®ç‚¹æ•°ã€‚64 bits, 8 Bytes\n\næ ¼å¼æè¿°ç¬¦ä¹Ÿæ˜¯ç”¨`f`ã€‚ä»£è¡¨åè¿›åˆ¶æµ®ç‚¹æ•°ï¼ˆDecimal floating pointï¼‰\n\n```c\nint main()\n{\n    double dVal = 5.0;  //å­—é¢å°æ•°å¸¸é‡ä¸åŠ åç¼€ï¼Œé»˜è®¤ä¸ºdoubleç±»å‹\n    printf(\"%f\\n\", dVal);\n}\n```\n\n## long double\n\nModern Cppå’Œæ–°çš„Cæ ‡å‡†æ‰æœ‰çš„ã€‚æ ‡å‡†æŒ‡å‡ºlong doubleé•¿åº¦ä¸å¾—å°äºdoubleã€‚åœ¨å¾®è½¯ç¼–è¯‘å™¨ä¸‹ç­‰äºdoubleé•¿åº¦ï¼Œæœ‰äº›ç¼–è¯‘å™¨æ˜¯å¤§äºdoubleé•¿åº¦çš„ã€‚ä¸ºä»€ä¹ˆå¾®è½¯å¦‚æ­¤ä¿å®ˆå‘¢ï¼Ÿå› ä¸ºCPUçš„å­—é•¿ä¸€èˆ¬è¿˜æ˜¯64ä½ã€‚å¦‚æœå¤§å°è®¾è®¡è¶…è¿‡64ä½çš„è¯ï¼Œå°±éœ€è¦ä¸¤ä¸ªæ—¶é’Ÿå‘¨æœŸæ¥å®Œæˆæ•°æ®çš„ä¼ è¾“ã€‚\n\néœ€è¦æ³¨æ„ï¼Œlong doubleçš„æ ¼å¼æè¿°ç¬¦ä¾æ—§ä¸º`f`ï¼Œ`%`åé¢çš„é•¿åº¦æè¿°ç¬¦ä¸å†æ˜¯`l`è€Œæ˜¯å¤§å†™çš„`L`ã€‚è€Œå­—é¢å¸¸é‡çš„åç¼€è¿˜æ˜¯å°å†™çš„`l`ã€‚\n\n```c\nint main()\n{\n    long double ldVal = 5.0l; // åŠ låç¼€\n    printf(\"%Lf\\n\", ldVal);   // åŠ Lå‰ç¼€ï¼Œæ ¼å¼æè¿°ç¬¦\n}\n```\n\n## ç§‘å­¦è®¡æ•°æ³•\n\n651.32æ€ä¹ˆè¡¨ç¤ºï¼ˆå­—é¢å¸¸é‡ï¼‰ï¼Ÿ\n\n1. `651.32`\n2. `6.52132e+2`ï¼Œå…¶ä¸­`+`å¯ä»¥çœç•¥\n\nç§‘å­¦è®¡æ•°æ³•çš„æ ¼å¼æè¿°ç¬¦ä¸º`e`æˆ–`E`ã€‚è¡¨ç¤ºï¼šScientific notation (mantissa/exponent), lowercase/uppercase\n\n0.065132å‘¢ï¼Ÿ`6.5132e-2`\n\n```c\nint main()\n{\n    double dVal = 6.52132e+2;\n    printf(\"%f\\n\", dVal); // 652.132000\n    printf(\"%e\\n\", dVal); // 6.521320e+02\n    printf(\"%E\\n\", dVal); // 6.521320E+02\n}\n```\n\n## floatå†…å­˜ç»“æ„ï¼ˆIEEE754æ ‡å‡†ï¼‰\n\nIEEE754æ ‡å‡†ã€‚æ‰€æœ‰å¤„ç†å™¨ï¼Œæ— è®ºæ‰‹æœºä¸Šçš„ARMæ¶æ„è¿˜æ˜¯æœåŠ¡å™¨å¤„ç†å™¨éƒ½æ˜¯éµå¾ªè¿™ä¸ªæ ‡å‡†ã€‚\n\nä¸‰éƒ¨åˆ†ï¼šsignï¼ˆç¬¦å·ä½ï¼‰ã€exponentï¼ˆæŒ‡æ•°ï¼‰ã€mantissaï¼ˆåº•æ•°ï¼‰\n### signï¼ˆç¬¦å·ä½ï¼‰\nsignï¼ˆç¬¦å·ä½ï¼‰ - 1 bit - 1ä»£è¡¨è´Ÿï¼Œ0ä»£è¡¨æ­£\n### exponentï¼ˆæŒ‡æ•°ï¼‰\n\né¦–å…ˆï¼ŒæŒ‡æ•°æ˜¯ä¸€ä¸ªæœ‰ç¬¦å·æ•°ã€‚\nè´Ÿæ•°ï¼Œæ˜¯è¡¥ç è¡¨è¾¾çš„ã€‚å…«ä½äºŒè¿›åˆ¶æ¥è¯´ï¼Œ0000 0000è¡¨ç¤º0ï¼Œåˆ™ 1111 1111è¡¨ç¤º-1ï¼Œ1000 0000è¡¨ç¤º-128ï¼Œ0111 1111è¡¨ç¤º127ï¼Œè¿™æ˜¯æœ‰ç¬¦å·æ­£æ•°çš„æœ€å¤§å€¼ï¼Œå†åŠ 1å°±æº¢å‡ºäº†ã€‚æœ¬æ¥çš„èŒƒå›´æ˜¯ï¼š`-128 ~ 127`\nä½†æ˜¯ï¼Œæµ®ç‚¹æ•°ä¸­æŒ‡æ•°ä½ç½®å­˜å‚¨çš„æ˜¯åç§»å€¼ï¼Œå¦‚æœæ˜¯floatï¼Œå­˜å‚¨çš„å€¼æ˜¯åŠ äº†127çš„ã€‚å› æ­¤ï¼ŒæŒ‡æ•°ä¸º1æ—¶ï¼Œåº”è¯¥å­˜å‚¨`1 + 127 = 128`ï¼Œå­˜å‚¨`1000 0000`ï¼›æŒ‡æ•°ä¸º2æ—¶ï¼Œåº”è¯¥å­˜å‚¨`2 + 127 = 129`ï¼Œå­˜å‚¨`1000 0001`ã€‚å› æ­¤ï¼ŒåŠ 127åï¼ŒèŒƒå›´å°±å˜æˆäº†ï¼š`-1 ~ 254`ã€‚\nè€ŒæŒ‡æ•°å…¨0ã€å…¨1ï¼Œåœ¨æµ®ç‚¹æ•°ä¸­æœ‰ç‰¹æ®Šå«ä¹‰ã€‚æ‰€ä»¥ï¼ŒèŒƒå›´å°±å˜æˆäº†ï¼š`1 ~ 254`ã€‚å‡å»127ä¹‹åï¼Œå®é™…çš„èŒƒå›´å°±å˜æˆäº†ï¼š`-126 ~ 127`ã€‚\n\nä¸¾ä¸€ä¸ªä¾‹å­ï¼š`7.25`æ€ä¹ˆè¡¨ç¤ºï¼Ÿå…ˆè½¬åŒ–ä¸ºäºŒè¿›åˆ¶ï¼š`0111.01`ï¼Œå¸¦æƒçš„å½¢å¼åˆ™æ˜¯ï¼š`1.1101 * 2^2`ï¼Œå³å³ç§»2ä½ï¼ŒæŒ‡æ•°ä¸º2ã€‚\nå®é™…å­˜å‚¨çš„äºŒè¿›åˆ¶å½¢å¼ï¼š\n```\n0     1000 0001            (1)110 1000 0000 0000 0000 0000`\nç¬¦   æŒ‡æ•°ä½ï¼ˆ2+127=129ï¼‰    åº•æ•°ä½ï¼ˆ23ä½ï¼‰å‰é¢æœ‰ä¸ªéšè—çš„1ï¼Œä¸åœ¨è¿™23ä½ä¸­\n```\n\nexponentï¼ˆæŒ‡æ•°ï¼‰ - 8 bits - æ ‡å‡†é‡Œè§„å®šï¼š\n\nåœ¨expä½æ¨¡å¼ï¼ˆthe bit pattern of expï¼‰æ—¢ä¸å…¨ä¸º0ï¼Œä¹Ÿä¸å…¨ä¸º1æ—¶ï¼Œæµ®ç‚¹æ•°å€¼ä¸º**è§„æ ¼åŒ–çš„å€¼**ã€‚\né˜¶ç å­—æ®µåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¢«è§£é‡Šä¸ºä»¥åç½®ï¼ˆbiasedï¼‰å½¢å¼è¡¨ç¤ºçš„**æœ‰ç¬¦å·æ•´æ•°**ï¼ˆåŸæ–‡ï¼šthe exponent field is interpreted as representing a signed integer in *biased* formï¼‰ã€‚\né‚£ä¹ˆï¼Œé˜¶ç å­—æ®µçš„å€¼ä¸ºï¼š$E = e - Bias$ã€‚\nå…¶ä¸­$e$æ˜¯æ— ç¬¦å·æ•°ï¼Œå³ç›´æ¥é€šè¿‡expä½æ¨¡å¼è®¡ç®—å¾—å‡ºã€‚\n$Bias$æ˜¯ä¸€ä¸ªå›ºå®šå€¼$2^{k-1}-1, k = expçš„ä½æ•°, å•ç²¾åº¦ä¸‹æ˜¯8ä½, åŒç²¾åº¦ä¸‹æ˜¯11ä½$ã€‚æ¯”å¦‚ï¼Œfloatï¼ŒæŒ‡æ•°äºŒè¿›åˆ¶ä½æ•°ä¸º8ä½æ—¶ï¼ŒBiaså°±æ˜¯128-1=127ã€‚\nå•ç²¾åº¦ä¸‹$Bias=2^7-1=127$ã€‚\nå› æ­¤$E$èŒƒå›´ï¼š$(1-127)\\sim(254-127)=-126\\sim127$ï¼Œè¡¨ç¤ºåœ¨2è¿›åˆ¶ä¸‹å¯ä»¥å³ç§»127ä½ã€å·¦ç§»126ä½ã€‚\neå’Œæœ€ç»ˆçš„ç§»ä½å€¼ä¹‹é—´çš„å¯¹åº”å…³ç³»ï¼š`1 = -126`ã€`2 = -125`ï¼Œ...ï¼Œ`253 = 126`ã€`254 = 127`ã€‚\n\n> ç”±æ­¤ï¼Œçœ‹å‡ºï¼Œä¸èƒ½ç®€å•åœ°æŠŠexpä½æ¨¡å¼çœ‹åšæœ‰ç¬¦å·æ•°ç›´æ¥è®¡ç®—å¾—åˆ°ç§»ä½æ•°å€¼ï¼Œå¦‚æœç›´æ¥å½“åšæœ‰ç¬¦å·æ•°è®¡ç®—çš„è¯ï¼ŒèŒƒå›´å˜æˆäº†ï¼š`1000'0000 ~ 0111'1111 = -128 ~ 127`ã€‚å’Œæ ‡å‡†è§„å®šçš„å¯¹åº”ä¸ä¸Šï¼\n\nä¸ºä»€ä¹ˆè¦é¢„ç•™å‡ºæ¥expä½æ¨¡å¼å…¨0æˆ–å…¨1çš„æƒ…å†µï¼Ÿ\n1. **å…¨0æ˜¯ä¸ºäº†èƒ½è®©æµ®ç‚¹æ•°å¯ä»¥è¡¨ç¤º0æˆ–è€…è¡¨ç¤ºéå¸¸æ¥è¿‘äº0.0çš„æ•°**ã€‚æ­¤æƒ…å†µåœ¨æ ‡å‡†ä¸­ç§°ä¸ºï¼šâ€œ**éè§„æ ¼åŒ–**çš„å€¼â€ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œé˜¶ç å€¼ï¼ˆç§»ä½å€¼ï¼‰è§„å®šä¸º$E=1-Bias$ã€‚å¹¶ä¸”è¦ç‰¹åˆ«æ³¨æ„ï¼šåº•æ•°çš„å€¼æ˜¯ä½æ¨¡å¼ç›´æ¥è®¡ç®—å‡ºæ¥çš„ï¼Œä¹Ÿå°±æ˜¯å°æ•°å­—æ®µçš„å€¼ï¼Œä¸åŒ…å«éšå«çš„å¼€å¤´çš„1ã€‚å³ï¼š`0.XXXX`ï¼Œä¸å†æ˜¯`1.XXXX`ï¼\n\n>ä½¿é˜¶ç å€¼ä¸º$1-Bias$è€Œä¸æ˜¯ç®€å•çš„$-Bias$â€‹ä¼¼ä¹æ˜¯è¿åç›´è§‰çš„ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼æä¾›äº†ä¸€ç§ä»éè§„æ ¼åŒ–å€¼å¹³æ»‘è½¬æ¢åˆ°è§„æ ¼åŒ–å€¼çš„æ–¹æ³•ã€‚\n\n2. éè§„æ ¼åŒ–æ•°æœ‰ä¸¤ä¸ªç”¨é€”ã€‚é¦–å…ˆï¼Œå®ƒä»¬æä¾›äº†ä¸€ç§è¡¨ç¤ºæ•°å€¼0çš„æ–¹æ³•ï¼Œå› ä¸ºä½¿ç”¨è§„æ ¼åŒ–æ•°ï¼Œæˆ‘ä»¬å¿…é¡»æ€»æ˜¯ä½¿$M\\geq1$ï¼Œå› æ­¤å°±ä¸èƒ½è¡¨ç¤º0ã€‚å®é™…ä¸Šï¼Œ$+0.0$çš„æµ®ç‚¹è¡¨ç¤ºçš„ä½æ¨¡å¼ä¸ºå…¨0ï¼šç¬¦å·ä½æ˜¯0ï¼Œé˜¶ç å­—æ®µå…¨ä¸º0ï¼ˆè¡¨æ˜æ˜¯ä¸€ä¸ªéè§„æ ¼åŒ–å€¼ï¼‰ï¼Œè€Œå°æ•°åŸŸä¹Ÿå…¨ä¸º0ï¼Œè¿™å°±å¾—åˆ°$M=f=0$ã€‚ä»¤äººå¥‡æ€ªçš„æ˜¯ï¼Œå½“ç¬¦å·ä½ä¸º1ï¼Œè€Œå…¶ä»–åŸŸå…¨ä¸º0æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°å€¼$-0.0$ã€‚æ ¹æ®IEEçš„æµ®ç‚¹æ ¼å¼ï¼Œå€¼$+0.0$å’Œ$-0.0$åœ¨æŸäº›æ–¹é¢è¢«è®¤ä¸ºæ˜¯ä¸åŒçš„ï¼Œè€Œåœ¨å…¶ä»–æ–¹é¢æ˜¯ç›¸åŒçš„ã€‚\n3. éè§„æ ¼åŒ–æ•°çš„å¦å¤–ä¸€ä¸ªåŠŸèƒ½æ˜¯è¡¨ç¤ºé‚£äº›éå¸¸æ¥è¿‘äº$0.0$çš„æ•°ã€‚è¿™æä¾›äº†ä¸€ç§å±æ€§ï¼Œç§°ä¸ºé€æ¸æº¢å‡ºï¼ˆgradual underflowï¼‰ï¼Œå…¶ä¸­ï¼Œå¯èƒ½çš„æ•°å€¼åˆ†å¸ƒå‡åŒ€åœ°æ¥è¿‘äº$0.0$ã€‚è€Œåˆšæ‰æåˆ°çš„ä½¿é˜¶ç å€¼ä¸º$1-Bias$è€Œä¸æ˜¯ç®€å•çš„$-Bias$ï¼Œå°±æ˜¯ä¸ºè¿™ä¸ªåšé“ºå«çš„ï¼**è¯¦çœ‹CSAPP-3rd P80**ã€‚\n4. å…¨1æ˜¯ä¸ºäº†èƒ½è®©æµ®ç‚¹æ•°è¡¨ç¤º\n     1. æ— ç©·å¤§ - åº•æ•°å…¨0æ—¶\n     2. NaN - åº•æ•°é0æ—¶\n### mantissaï¼ˆåº•æ•°ï¼‰\n4. mantissaï¼ˆåº•æ•°ï¼‰ - 23 bits - èŒƒå›´ã€**ç²¾åº¦**ï¼š$\\lg 2^{24} \\approx 7.2247$ï¼Œå³å¯ä»¥è¡¨ç¤º7ä½åè¿›åˆ¶æ•°ã€‚\n    1. å› ä¸ºè¦ç”¨ç§‘å­¦è®¡æ•°æ³•ï¼Œåº•æ•°ç¬¬ä¸€ä½å¿…é¡»æ˜¯1ï¼Œå› æ­¤å¯ä»¥çœç•¥ç¬¬ä¸€ä½ã€‚å› æ­¤æ­¤å¤„çš„23ä½å¯ä»¥è¡¨è¾¾24ä½äºŒè¿›åˆ¶æ•°ã€‚\n\n7.25çš„IEEE754è¡¨ç¤ºï¼š\n\n`0 1000'0001 110'1000'0000'0000'0000'0000`\n\n## æµ®ç‚¹æ•°çš„å¥½å¤„\n\n1. è™½ç„¶ç²¾åº¦å°ï¼Œä½†æ˜¯å¯è¡¨ç¤ºçš„èŒƒå›´å¤§ï¼ˆæŒ‡æ•°çš„ä½œç”¨ï¼‰ã€‚\n2. èƒ½è¡¨è¾¾å®æ•°ï¼ˆé™¤äº†å°æ•°ï¼Œä¹Ÿèƒ½è¡¨ç¤ºæ•´æ•°ã€0ï¼‰\n3. èƒ½è¡¨è¾¾NaNï¼ˆNot A Numberï¼‰ï¼Œ0é™¤ä»¥0çš„ç»“æœå°±æ˜¯NaNã€‚\n    1. `0 1111'1111 100'0000'0000'0000'0000'0000`\n4. èƒ½è¡¨è¾¾æ­£è´Ÿinfï¼ˆæ— ç©·å¤§ï¼‰ï¼Œæ¯”å¦‚1é™¤ä»¥0ã€‚\n    1. æ­£æ— ç©·ï¼š`0 1111'1111 000'0000'0000'0000'0000'0000`\n    2. è´Ÿæ— ç©·ï¼š`1 1111'1111 000'0000'0000'0000'0000'0000`\n## æ€ä¹ˆæ¯”è¾ƒæµ®ç‚¹æ•°\n### é¦–å…ˆæ˜¯ä¸å¸¦ç­‰å·çš„å¤§å°åˆ¤æ–­ï¼ˆ<ã€>ï¼‰\n- å¯¹äºÂ `a < b`ã€`a > b`Â è¿™ç§â€‹**â€‹å¤§å°å…³ç³»æ¯”è¾ƒâ€‹**â€‹ï¼Œé€šå¸¸å¯ä»¥â€‹**â€‹å®‰å…¨åœ°ç›´æ¥ä½¿ç”¨è¿ç®—ç¬¦â€‹**â€‹ã€‚\n- å› ä¸ºå³ä½¿å­˜åœ¨å¾®å°çš„èˆå…¥è¯¯å·®ï¼Œåªè¦è¿™ä¸ªè¯¯å·®ä¸è¶³ä»¥æ”¹å˜å¤§å°å…³ç³»çš„æœ¬è´¨ï¼ˆå³è¯¯å·®è¿œå°äºÂ `a`Â å’ŒÂ `b`Â æœ¬èº«çš„å·®å€¼ï¼‰ï¼Œç»“æœå°±æ˜¯æ­£ç¡®çš„ã€‚\n- åˆ¤æ–­Â `a`Â æ˜¯å¦ä¸¥æ ¼å¤§äºÂ `b`Â æ—¶ï¼Œåº”è¯¥ä½¿ç”¨Â `a > b`ï¼Œè€Œä¸æ˜¯Â `!(a <= b)`ï¼ˆåè€…æ¶‰åŠç›¸ç­‰åˆ¤æ–­ï¼Œä¸ç²¾ç¡®ï¼‰ã€‚\n### ç‰¹æ®Šå€¼çš„æ¯”è¾ƒ\n- ç‰¹æ®Šå€¼å¦‚Â `NaN`Â (Not a Number) ä¸ä»»ä½•å€¼ï¼ˆåŒ…æ‹¬è‡ªå·±ï¼‰æ¯”è¾ƒï¼Œ`==`Â éƒ½è¿”å›Â `false`ï¼Œ`!=`Â éƒ½è¿”å›Â `true`ã€‚å¿…é¡»ç”¨ä¸“é—¨çš„å‡½æ•°æ£€æŸ¥ï¼š\n    - Python:Â `math.isnan(x)`\n    - C/C++:Â `isnan(x)`Â (æ¥è‡ªÂ `math.h`Â æˆ–Â `cmath`)\n    - Java:Â `Double.isNaN(x)`Â /Â `Float.isNaN(x)`\n- æ£€æŸ¥æ— ç©·å¤§ï¼š\n    - Python:Â `math.isinf(x)`\n    - C/C++:Â `isinf(x)`\n    - Java:Â `Double.isInfinite(x)`Â /Â `Float.isInfinite(x)`\n### æ¶‰åŠåˆ°ä¸¤ä¸ªæµ®ç‚¹æ•°æ˜¯å¦ç›¸ç­‰æ—¶\n**ç»å¯¹ä¸èƒ½ç›´æ¥ç”¨Â `==`Â æˆ–Â `!=`Â æ¥åˆ¤æ–­ä¸¤ä¸ªæµ®ç‚¹æ•°æ˜¯å¦â€œç›¸ç­‰â€ï¼â€‹**â€‹ \nå› ä¸ºæµ®ç‚¹æ•°åœ¨è®¡ç®—æœºå†…éƒ¨ä½¿ç”¨ IEEE 754 æ ‡å‡†ä»¥äºŒè¿›åˆ¶å­˜å‚¨å°æ•°ï¼Œå¾ˆå¤šåè¿›åˆ¶å°æ•°æ— æ³•ç²¾ç¡®è¡¨ç¤ºï¼ˆä¾‹å¦‚Â `0.1`ï¼‰ï¼Œè®¡ç®—è¿‡ç¨‹ä¸­ä¹Ÿä¼šç§¯ç´¯å¾®å°çš„èˆå…¥è¯¯å·®ã€‚\næ­£ç¡®çš„æ¯”è¾ƒæ–¹æ³•æ˜¯â€‹**â€‹å…è®¸ä¸€å®šçš„è¯¯å·®èŒƒå›´ï¼ˆå®¹å·® epsilonï¼‰â€‹**â€‹ï¼š\n1. â€‹**â€‹æ£€æŸ¥è¿‘ä¼¼ç›¸ç­‰ (Approximate Equality)ï¼šâ€‹**â€‹\n    - è®¡ç®—ä¸¤ä¸ªæµ®ç‚¹æ•°Â `a`Â å’ŒÂ `b`Â çš„ç»å¯¹å·®å€¼ï¼š`diff = abs(a - b)`\n    - å®šä¹‰ä¸€ä¸ªéå¸¸å°çš„æ­£æ•°ä½œä¸ºå®¹å¿åº¦Â `epsilon`ï¼ˆä¾‹å¦‚Â `1e-9`,Â `1e-12`, å…·ä½“å€¼å–å†³äºä½ çš„ç²¾åº¦è¦æ±‚ï¼‰ã€‚\n    - å¦‚æœÂ `diff <= epsilon`ï¼Œåˆ™è®¤ä¸ºÂ `a`Â å’ŒÂ `b`Â åœ¨Â `epsilon`Â çš„è¯¯å·®èŒƒå›´å†…æ˜¯â€œç›¸ç­‰â€çš„ã€‚\n    - ä½†æ˜¯è¿™ä¸ªå®¹å·®æ˜¯ç»å¯¹å®¹å·®ï¼Œæœ‰ç¼ºé™·ï¼Œè§ä¸‹ï¼š\n- **æ£€æŸ¥ç›¸å¯¹ç›¸ç­‰ (Relative Equality - æ›´ç¨³å¥)ï¼šâ€‹**â€‹\n    - å½“æ•°å€¼å¤§å°å·®å¼‚å·¨å¤§æ—¶ï¼Œå›ºå®šç»å¯¹å®¹å·®å¯èƒ½ä¸åˆé€‚ï¼ˆæ¯”å¦‚æ¯”è¾ƒ 1e9 å’Œ 1e9+1e-9 æ—¶å·®å€¼å¾ˆå°ï¼Œä½†æ¯”è¾ƒ 1e-9 å’Œ 2e-9 æ—¶ç”¨ç»å¯¹å®¹å·® 1e-9 ä¼šè®¤ä¸ºç›¸ç­‰ï¼‰ã€‚ç›¸å¯¹å®¹å·®è€ƒè™‘æ•°å€¼çš„å¤§å°ã€‚\n    - `rel_tol`: ç›¸å¯¹å®¹å·®ï¼ˆå¦‚ 1e-5, 1e-9ï¼‰\n    - `abs_tol`: ç»å¯¹å®¹å·®ä¸‹é™ï¼ˆä¿è¯æ¥è¿‘é›¶çš„æ•°ä¹Ÿèƒ½æ¯”è¾ƒï¼Œä¾‹å¦‚è®¾ä¸ºÂ `1e-12`ï¼‰\n\nä¸‹é¢ä¸»è¦è®ºè¿°ï¼Œä¸ºä»€ä¹ˆéœ€è¦ç›¸å¯¹ç›¸ç­‰ï¼ˆä½¿ç”¨ç›¸å¯¹å®¹å·®ï¼‰\n\nç›´æ¥ä½¿ç”¨ç»å¯¹ç›¸ç­‰çš„å®¹å·®ï¼ˆæ¯”å¦‚Â `abs(a - b) <= 1e-9`ï¼‰åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯æœ‰æ•ˆçš„ã€‚ä½†æ˜¯ï¼Œå®ƒæœ‰ä¸€ä¸ªæ˜¾è‘—çš„ç¼ºç‚¹ï¼šå½“æ¯”è¾ƒçš„æ•°å€¼æœ¬èº«éå¸¸å¤§æˆ–è€…éå¸¸å°ï¼ˆé è¿‘é›¶ï¼‰æ—¶ï¼Œè¿™ä¸ªå›ºå®šå¤§å°çš„ç»å¯¹å®¹å·®å°±æ˜¾å¾—ä¸åˆç†äº†ã€‚\n\n1. â€‹**â€‹é—®é¢˜åœºæ™¯ä¸€ï¼šæ•°å€¼å·¨å¤§â€‹**â€‹\n    \n    - ä¾‹å­ï¼šæ¯”è¾ƒÂ `a = 1, 000, 000, 000 (1e9)`Â å’ŒÂ `b = 1, 000, 000, 001 (1e9 + 1)`\n    - å®ƒä»¬çš„ç»å¯¹å·®æ˜¯Â `|a - b| = 1`ã€‚\n    - å¦‚æœä½ è®¾å®šçš„ç»å¯¹å®¹å·®Â `epsilon = 1e-9`ï¼ˆå³ 0.000000001ï¼‰ï¼Œé‚£ä¹ˆÂ `1 > 1e-9`ï¼Œç¨‹åºä¼šåˆ¤æ–­å®ƒä»¬â€‹**â€‹ä¸ç›¸ç­‰â€‹**â€‹ã€‚\n    - ä½†ç›´è§‰ä¸Šï¼Œ10äº¿å’Œ10äº¿é›¶1ä¹‹é—´çš„_ç›¸å¯¹è¯¯å·®_éå¸¸å°ï¼ˆå¤§çº¦æ˜¯Â `1 / 1e9 = 1e-9`ï¼‰ã€‚åœ¨å¾ˆå¤šç§‘å­¦è®¡ç®—æˆ–å·¥ç¨‹é¢†åŸŸï¼Œè¿™ä¸ªç²¾åº¦å·²ç»è¶³å¤Ÿäº†ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›è®¤ä¸ºå®ƒä»¬_ç›¸å¯¹ç›¸ç­‰_ã€‚\n    - â€‹**â€‹ç»“è®ºï¼šâ€‹**â€‹ å½“æ•°å€¼æœ¬èº«å¾ˆå¤§æ—¶ï¼Œä¸€ä¸ªå›ºå®šçš„å°ç»å¯¹å®¹å·®è¿‡äºä¸¥æ ¼ï¼Œå¿½ç•¥äº†æ•°å€¼çš„é‡çº§ã€‚\n2. â€‹**â€‹é—®é¢˜åœºæ™¯äºŒï¼šæ•°å€¼æå°ï¼ˆæ¥è¿‘é›¶ï¼‰â€‹**â€‹\n    \n    - ä¾‹å­ï¼šæ¯”è¾ƒÂ `a = 0.000001 (1e-6)`Â å’ŒÂ `b = 0.000002 (2e-6)`\n    - å®ƒä»¬çš„ç»å¯¹å·®æ˜¯Â `|a - b| = 0.000001 (1e-6)`ã€‚\n    - å¦‚æœä½ è®¾å®šçš„ç»å¯¹å®¹å·®Â `epsilon = 1e-9`ï¼ˆå³ 0.000000001ï¼‰ï¼Œé‚£ä¹ˆÂ `1e-6 > 1e-9`ï¼Œç¨‹åºä¼šåˆ¤æ–­å®ƒä»¬â€‹**â€‹ä¸ç›¸ç­‰â€‹**â€‹ã€‚\n    - ä½†æ˜¯ï¼Œå®ƒä»¬çš„ç›¸å¯¹å·®éå¸¸å¤§ï¼ˆä¸€ä¸ªæ˜¯å¦ä¸€ä¸ªçš„ä¸¤å€ï¼Œç›¸å¯¹è¯¯å·®é«˜è¾¾Â `1e-6 / 1e-6 = 1`Â æˆ– 100%ï¼‰ã€‚å®é™…ä¸Šï¼Œå®ƒä»¬_ä¸åº”_è¢«çœ‹ä½œæ˜¯è¿‘ä¼¼ç›¸ç­‰çš„ã€‚\n    - â€‹**â€‹ç»“è®ºï¼šâ€‹**â€‹ å½“æ•°å€¼æœ¬èº«å¾ˆå°æ—¶ï¼Œä¸€ä¸ªå›ºå®šçš„å°ç»å¯¹å®¹å·®åˆè¿‡äºå®½æ¾ï¼Œå¯èƒ½æŠŠå·®åˆ«å¾ˆå¤§çš„ä¸¤ä¸ªæ•°åˆ¤æ–­ä¸ºç›¸ç­‰ã€‚\n    - â€‹**â€‹æ›´éº»çƒ¦çš„é—®é¢˜ï¼šæ¯”è¾ƒæ¥è¿‘é›¶çš„æ•°â€‹**â€‹\n        - ä¾‹å­ï¼šæ¯”è¾ƒÂ `a = 0.000000001 (1e-9)`Â å’ŒÂ `b = 0.000000002 (2e-9)`\n        - ç»å¯¹å·®Â `|a - b| = 1e-9`ï¼Œå¦‚æœæˆ‘ä»¬è®¾å®šçš„ç»å¯¹å®¹å·®ä¹Ÿæ˜¯Â `1e-9`ï¼Œé‚£ä¹ˆç¨‹åºä¼šè®¤ä¸ºå®ƒä»¬ç›¸ç­‰ã€‚\n        - ä¾‹å­ï¼šæ¯”è¾ƒÂ `a = 1e-20`Â å’ŒÂ `b = 2e-20`\n        - ç»å¯¹å·®Â `|a - b| = 1e-20`ã€‚ä¸€ä¸ªåˆç†çš„ç»å¯¹å®¹å·®ï¼ˆæ¯”å¦‚Â `1e-9`ï¼‰è¿œè¿œå¤§äºè¿™ä¸ªå·®å€¼ï¼ˆ`1e-9 > 1e-20`ï¼‰ï¼Œæ‰€ä»¥ç¨‹åºä¹Ÿä¼šè®¤ä¸ºå®ƒä»¬ç›¸ç­‰ã€‚ä½†ä»ç›¸å¯¹è§’åº¦çœ‹ï¼Œ`b`Â æ˜¯Â `a`Â çš„ä¸¤å€ï¼\n        - â€‹**â€‹æ€»ç»“ï¼šâ€‹**â€‹ å¯¹äºéå¸¸æ¥è¿‘é›¶çš„æ•°ï¼Œå³ä½¿è®¾ç½®äº†ä¸€ä¸ªçœ‹ä¼¼å¾ˆå°çš„ç»å¯¹å®¹å·®ï¼Œä¹Ÿå¯èƒ½è¿‡äºå®½æ¾ï¼Œæ— æ³•åæ˜ æ•°å€¼ä¹‹é—´çš„çœŸå®ç›¸å¯¹è¯¯å·®ã€‚è¿™æ—¶ç”šè‡³éœ€è¦ä¸€ä¸ªæ›´å°çš„ã€ä¸åˆ‡å®é™…çš„ç»å¯¹å®¹å·®æ‰èƒ½åŒºåˆ†å®ƒä»¬ï¼Œè€Œç›¸å¯¹ç›¸ç­‰å¯ä»¥è‡ªç„¶åœ°å¤„ç†è¿™ç§æƒ…å†µï¼ˆæ­¤æ—¶ç›¸å¯¹è¯¯å·®ä¼šå¾ˆå¤§ï¼‰ã€‚\n\nâ€‹**â€‹ç›¸å¯¹ç›¸ç­‰çš„è§£å†³æ–¹æ¡ˆï¼šå¼•å…¥ç›¸å¯¹å®¹å·®â€‹**â€‹\n\nç›¸å¯¹ç›¸ç­‰çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šâ€‹**â€‹åˆ¤æ–­ä¸¤ä¸ªæ•°æ˜¯å¦è¿‘ä¼¼ç›¸ç­‰çš„æ ‡å‡†ï¼Œåº”è¯¥ä¸å®ƒä»¬è‡ªèº«çš„_å¤§å°_æœ‰å…³ã€‚â€‹**â€‹\n\n1. â€‹**â€‹æ ¸å¿ƒå…¬å¼ï¼šâ€‹**â€‹\n    \n    `abs(a - b) <= max(rel_tol * max(|a|, |b|), abs_tol)`\n    \n    - `rel_tol`: â€‹**â€‹ç›¸å¯¹å®¹å·®ï¼ˆrelative toleranceï¼‰â€‹**â€‹ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå°çš„æ­£æ•°ï¼Œè¡¨ç¤ºä½ èƒ½æ¥å—çš„_æœ€å¤§ç›¸å¯¹è¯¯å·®_ï¼ˆä¾‹å¦‚Â `0.01`Â è¡¨ç¤º 1% çš„ç›¸å¯¹è¯¯å·®ï¼Œ`1e-5`Â è¡¨ç¤º 0.001% çš„ç›¸å¯¹è¯¯å·®ï¼Œ`1e-9`Â è¡¨ç¤ºæå°çš„ç›¸å¯¹è¯¯å·®ï¼‰ã€‚è¿™ä¸ªå€¼éœ€è¦æ ¹æ®ä½ çš„å…·ä½“åº”ç”¨åœºæ™¯ï¼ˆä½ å¯¹ç²¾åº¦çš„è¦æ±‚ï¼‰æ¥è®¾å®šã€‚\n    - `abs_tol`: â€‹**â€‹ç»å¯¹å®¹å·®ä¸‹é™ï¼ˆabsolute toleranceï¼‰â€‹**â€‹ã€‚è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå°çš„æ­£æ•°ï¼ˆä¾‹å¦‚Â `1e-12`ï¼‰ã€‚å®ƒçš„ä½œç”¨æ˜¯ç¡®ä¿å½“Â `a`Â å’ŒÂ `b`Â éƒ½_éå¸¸éå¸¸æ¥è¿‘é›¶_æ—¶ï¼Œå…¬å¼ä»ç„¶æœ‰æ•ˆã€‚\n2. â€‹**â€‹å…¬å¼è§£è¯»ï¼šâ€‹**â€‹\n    \n    - `max(|a|, |b|)`: å–Â `a`Â å’ŒÂ `b`Â çš„ç»å¯¹å€¼ä¸­è¾ƒå¤§çš„é‚£ä¸ªã€‚è¿™ä»£è¡¨äº†å‚ä¸æ¯”è¾ƒçš„ä¸¤ä¸ªæ•°åœ¨æ•°å€¼ä¸Šçš„å¤§è‡´_é‡çº§ï¼ˆScaleï¼‰_ã€‚\n    - `rel_tol * max(|a|, |b|)`: â€‹**â€‹åŠ¨æ€è®¡ç®—çš„ç›¸å¯¹å®¹å·®â€‹**â€‹ã€‚è¿™ä¸ªå®¹å·®ä¼šæ ¹æ®Â `a`Â å’ŒÂ `b`Â çš„å½“å‰é‡çº§è‡ªåŠ¨è°ƒæ•´ï¼š\n        - å½“Â `a`Â å’ŒÂ `b`Â å¾ˆå¤§æ—¶ï¼Œè¿™ä¸ªå€¼ä¼šå˜å¤§ï¼Œå¯ä»¥å®¹å¿è¾ƒå¤§çš„ç»å¯¹å·®å€¼ï¼ˆåªè¦ç›¸å¯¹è¯¯å·®å°ï¼‰ã€‚\n        - å½“Â `a`Â å’ŒÂ `b`Â å¾ˆå°æ—¶ï¼ˆä½†è¿˜æ²¡æœ‰å°åˆ°å¿…é¡»ä¾èµ–Â `abs_tol`ï¼‰ï¼Œè¿™ä¸ªå€¼ä¼šå˜å°ï¼Œè¦æ±‚æ›´å°çš„ç»å¯¹å·®å€¼æ‰èƒ½è¢«è§†ä¸ºç›¸ç­‰ã€‚\n    - `max( ..., abs_tol)`: å–Â `åŠ¨æ€è®¡ç®—çš„ç›¸å¯¹å®¹å·®`Â å’ŒÂ `abs_tol`Â ä¸­â€‹**â€‹è¾ƒå¤§çš„é‚£ä¸ªâ€‹**â€‹ä½œä¸ºæœ€ç»ˆçš„å®¹å·®é˜ˆå€¼ã€‚\n        - å½“Â `a`Â å’ŒÂ `b`Â è¿œç¦»é›¶æ—¶ï¼Œ`åŠ¨æ€è®¡ç®—çš„ç›¸å¯¹å®¹å·®`Â é€šå¸¸ä¼šè¿œå¤§äºÂ `abs_tol`ï¼Œæ‰€ä»¥`max`Â çš„ç»“æœå°±æ˜¯ç›¸å¯¹å®¹å·®ã€‚\n        - å½“Â `a`Â å’ŒÂ `b`Â éå¸¸æ¥è¿‘é›¶ï¼ˆæˆ–è€…å…¶ä¸­ä¸€ä¸ªä¸ºé›¶ï¼‰æ—¶ï¼Œ`åŠ¨æ€è®¡ç®—çš„ç›¸å¯¹å®¹å·®`Â (`rel_tol * max(|a|, |b|)`) ä¼šå˜å¾—éå¸¸å°ï¼ˆæ¥è¿‘äºé›¶ï¼‰ã€‚å¦‚æœæ­¤æ—¶æ²¡æœ‰Â `abs_tol`ï¼Œå³ä½¿ä¸¤ä¸ªéå¸¸æ¥è¿‘é›¶ä½†å½¼æ­¤ä¸åŒçš„æ•°ï¼ˆæ¯”å¦‚Â `1e-20`Â å’ŒÂ `2e-20`ï¼Œå·®å€¼Â `1e-20`ï¼‰ï¼Œä¹Ÿä¼šå› ä¸ºÂ `1e-20`Â >Â `æŸä¸ªå‡ ä¹ä¸ºé›¶çš„åŠ¨æ€ç›¸å¯¹å®¹å·®`Â (æ¯”å¦‚Â `1e-9 * 2e-20 = 2e-29`) è€Œè¢«é”™è¯¯åœ°è®¤ä¸º_ä¸ç›¸ç­‰_ï¼ˆè€Œå®é™…ä¸Šæ ¹æ®ç›¸å¯¹è¯¯å·®ï¼Œå®ƒä»¬å·®å¼‚å¾ˆå¤§ï¼‰ã€‚æ›´æç«¯çš„æ˜¯æ¯”è¾ƒÂ `0`Â å’Œä¸€ä¸ªå¾ˆå°çš„æ•°ï¼ˆæ¯”å¦‚Â `1e-30`ï¼‰ï¼Œ`åŠ¨æ€è®¡ç®—çš„ç›¸å¯¹å®¹å·®`Â ä¼šå˜æˆÂ `0`ï¼Œæ²¡æœ‰Â `abs_tol`Â å°±æ— æ³•è¿›è¡Œæœ‰æ•ˆæ¯”è¾ƒã€‚åŠ å…¥Â `abs_tol`Â æä¾›äº†è¿™ä¸ªç»å¯¹ä¸‹é™ã€‚\n        - `abs_tol`Â å°±æ˜¯ä¸ºäº†ç¡®ä¿åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…¬å¼ä¸ä¼šå› ä¸ºÂ `åŠ¨æ€è®¡ç®—çš„ç›¸å¯¹å®¹å·®`Â å¤ªå°è€Œå¤±æ•ˆã€‚å®ƒä¼šæä¾›ä¸€ä¸ªæœ€ä½é™åº¦çš„ç»å¯¹å®¹å·®ä¿è¯ï¼ˆæ¯”å¦‚Â `1e-12`ï¼‰ã€‚å¦‚æœÂ `|a - b| <= abs_tol`ï¼Œå³ä½¿Â `a`Â å’ŒÂ `b`Â æœ¬èº«å¾ˆå°ï¼ˆå¯¼è‡´Â `rel_tol * max(|a|, |b|)`Â æ›´å°ï¼‰ï¼Œä¹Ÿèƒ½è®¤ä¸ºå®ƒä»¬åœ¨ç»å¯¹æ„ä¹‰ä¸Šè¶³å¤Ÿæ¥è¿‘é›¶ã€‚\n3. â€‹**â€‹ä¸¾ä¾‹è¯´æ˜ï¼šâ€‹**â€‹\n    \n    - â€‹**â€‹æƒ…å†µä¸€ï¼šå¤§æ•°å€¼ï¼ˆç›¸å¯¹å®¹å·®ä¸»å¯¼ï¼‰â€‹**â€‹\n        - `a = 1e9`,Â `b = 1e9 + 1000`Â (`|a-b|=1000`)\n        - è®¾Â `rel_tol=1e-6`,Â `abs_tol=1e-9`\n        - `max(|a|,|b|) â‰ˆ 1e9`\n        - `åŠ¨æ€ç›¸å¯¹å®¹å·® = 1e-6 * 1e9 = 1000`\n        - `max(1000, 1e-9) = 1000`\n        - `1000 (|a-b|) <= 1000 (é˜ˆå€¼)`Â â†’ â€‹**â€‹ç›¸å¯¹ç›¸ç­‰ï¼ˆæˆç«‹ï¼‰â€‹**â€‹\n    - â€‹**â€‹æƒ…å†µäºŒï¼šä¸­ç­‰æ•°å€¼ï¼ˆç›¸å¯¹å®¹å·®ä¸»å¯¼ï¼‰â€‹**â€‹\n        - `a = 3.141592`,Â `b = 3.141593`Â (`|a-b|=0.000001`)\n        - è®¾Â `rel_tol=1e-6`,Â `abs_tol=1e-9`\n        - `max(|a|,|b|) â‰ˆ 3.1416`\n        - `åŠ¨æ€ç›¸å¯¹å®¹å·® â‰ˆ 1e-6 * 3.1416 â‰ˆ 3.1416e-6`\n        - `max(3.1416e-6, 1e-9) â‰ˆ 3.1416e-6`\n        - `0.000001 (1e-6) â‰ˆ 1e-6 < 3.1416e-6 (é˜ˆå€¼)`Â â†’ â€‹**â€‹ç›¸å¯¹ç›¸ç­‰ï¼ˆæˆç«‹ï¼‰â€‹**â€‹\n        - æ³¨æ„ï¼šå¦‚æœåªç”¨Â `abs_tol=1e-9`ï¼Œ`1e-6 > 1e-9`ï¼Œä¼šè¢«åˆ¤ä¸ºä¸ç›¸ç­‰ã€‚ç›¸å¯¹å®¹å·®ï¼ˆ`â‰ˆ 3e-6`ï¼‰æ›´åˆç†ã€‚\n    - â€‹**â€‹æƒ…å†µä¸‰ï¼šå°æ•°å€¼ï¼ˆç»å¯¹å®¹å·®ä¸»å¯¼ï¼‰â€‹**â€‹\n        - `a = 1e-10`,Â `b = 2e-10`Â (`|a-b|=1e-10`)\n        - è®¾Â `rel_tol=1e-6`,Â `abs_tol=1e-12`\n        - `max(|a|,|b|) = 2e-10`\n        - `åŠ¨æ€ç›¸å¯¹å®¹å·® = 1e-6 * 2e-10 = 2e-16`Â (éå¸¸å°ï¼)\n        - `max(2e-16, 1e-12) = 1e-12`Â (å› ä¸ºÂ `1e-12`Â è¿œå¤§äºÂ `2e-16`)\n        - `1e-10 (|a-b|) <= 1e-12`? â€‹**â€‹1e-10 > 1e-12â€‹**â€‹ â†’ â€‹**â€‹ä¸ç›¸ç­‰ï¼ˆæˆç«‹ï¼‰â€‹**â€‹\n            - _è§£é‡Šï¼š_Â è™½ç„¶å®ƒä»¬å¾ˆå°ï¼ˆéƒ½åœ¨Â `1e-10`Â é‡çº§ï¼‰ï¼Œä½†`b`æ˜¯`a`çš„2å€ï¼ç›¸å¯¹è¯¯å·®æå¤§ã€‚ç»å¯¹å®¹å·®Â `1e-12`Â æ— æ³•å®¹å¿Â `1e-10`Â è¿™ä¹ˆå¤§çš„å·®ï¼Œæ‰€ä»¥æ­£ç¡®åˆ¤å®šä¸ç›¸ç­‰ã€‚åŠ¨æ€ç›¸å¯¹å®¹å·®Â `2e-16`Â åœ¨è¿™é‡Œå¤ªå°è€Œæ²¡èµ·ä½œç”¨ï¼Œ`abs_tol`Â `1e-12`Â æä¾›äº†åˆé€‚çš„åˆ¤æ–­ä¾æ®ã€‚\n    - â€‹**â€‹æƒ…å†µå››ï¼šéå¸¸æ¥è¿‘é›¶ï¼ˆç»å¯¹å®¹å·®ä¸»å¯¼ï¼‰â€‹**â€‹\n        - `a = 0`,Â `b = 1.5e-12`\n        - è®¾Â `rel_tol=1e-6`,Â `abs_tol=1e-12`\n        - `max(|a|,|b|) = 1.5e-12`\n        - `åŠ¨æ€ç›¸å¯¹å®¹å·® = 1e-6 * 1.5e-12 = 1.5e-18`Â (æå…¶å°ï¼)\n        - `max(1.5e-18, 1e-12) = 1e-12`\n        - `1.5e-12 (|a-b|) <= 1e-12`? â€‹**â€‹1.5e-12 > 1e-12â€‹**â€‹ â†’ â€‹**â€‹ä¸ç›¸ç­‰ï¼ˆæˆç«‹ï¼‰â€‹**â€‹\n        - _æƒ³è®©å®ƒè¢«åˆ¤å®šä¸ºæ¥è¿‘é›¶ï¼ˆç›¸ç­‰ï¼‰ï¼š_\n            - å¯ä»¥è®¾ç½®æ›´å¤§çš„Â `abs_tol`ï¼Œæ¯”å¦‚Â `abs_tol=1.6e-12`\n            - `1.5e-12 <= 1.6e-12`Â â†’ â€‹**â€‹ç›¸å¯¹ç›¸ç­‰ï¼ˆæˆç«‹ï¼‰â€‹**â€‹\n    - â€‹**â€‹æƒ…å†µäº”ï¼šç›¸å¯¹å®¹å·®å’Œç»å¯¹å®¹å·®éƒ½å‚ä¸ï¼ˆé€šå¸¸å‘ç”Ÿåœ¨ä¸­ç­‰æˆ–è¾ƒå°æ•°å€¼ï¼‰â€‹**â€‹\n        - å…¬å¼é€‰å–ä¸¤è€…ä¸­è¾ƒå¤§çš„ä½œä¸ºæœ€ç»ˆå®¹å·®ï¼Œç¡®ä¿åœ¨ä¸¤ç§æ ‡å‡†ä¸­æ»¡è¶³å…¶ä¸€å³å¯è§†ä¸ºç›¸ç­‰ã€‚\n\n**åœ¨ä»£ç ä¸­ä½¿ç”¨ï¼šâ€‹**â€‹\n\nåœ¨ Python ä¸­ï¼Œæ¨èä½¿ç”¨æ ‡å‡†åº“Â `math.isclose`ï¼š\n```python\nimport math\n\nif math.isclose(a, b, rel_tol=1e-9, abs_tol=1e-12):\n    print(\"a and b are considered close\")\n```\n- `rel_tol`ï¼šç›¸å¯¹å®¹å·®ï¼Œé€šå¸¸Â `1e-9`Â æ˜¯ä¸€ä¸ªè¾ƒé«˜çš„ç²¾åº¦è¦æ±‚ï¼Œ`1e-6`Â æˆ–Â `1e-3`Â å¯èƒ½ç”¨äºç²¾åº¦è¦æ±‚è¾ƒä½çš„é¢†åŸŸã€‚æ ¹æ®ä½ çš„éœ€æ±‚è®¾å®šã€‚\n- `abs_tol`ï¼šç»å¯¹å®¹å·®ä¸‹é™ï¼Œé€šå¸¸è®¾ç½®ä¸ºä¸€ä¸ªéå¸¸å°çš„æ•°ï¼ˆå¦‚Â `0.0`ï¼ŒÂ `1e-12`,Â `1e-15`ï¼‰ï¼Œæˆ–è€…å½“ä½ çŸ¥é“è¦å¤„ç†æ¥è¿‘é›¶çš„æ•°æ—¶ï¼Œè®¾ç½®æˆä¸€ä¸ªåˆé€‚çš„ã€æ¯”â€œæ˜¾è‘—å·®å¼‚â€è¦å°çš„å€¼ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœä½ çš„æ•°æ®ç²¾åº¦æé™æ˜¯Â `1e-10`ï¼Œ`abs_tol=1e-12`Â å¯èƒ½å°±å¤ªå°äº†ï¼Œéœ€è¦è®¾æˆÂ `1e-9`Â æˆ–æ›´å¤§ï¼Œä½†è¿™æ—¶æœ€å¥½é€šè¿‡ç›¸å¯¹å®¹å·®æ¥è¦†ç›–éé›¶åŒºåŸŸï¼‰ã€‚Â `abs_tol`Â æœ€ä¸»è¦çš„ä½œç”¨æ˜¯ç¡®ä¿Â `a`Â å’ŒÂ `b`Â éƒ½æ¥è¿‘é›¶æ—¶æ¯”è¾ƒé€»è¾‘ä»ç„¶å·¥ä½œã€‚\n\nâ€‹**â€‹æ€»ç»“ï¼šâ€‹**â€‹\n\nç›¸å¯¹ç›¸ç­‰ (`abs(a - b) <= max(rel_tol * max(|a|, |b|), abs_tol)`) æ˜¯ä¸€ç§æ›´â€‹**â€‹ç¨³å¥ï¼ˆRobustï¼‰â€‹**â€‹çš„æµ®ç‚¹æ•°è¿‘ä¼¼ç›¸ç­‰åˆ¤æ–­æ–¹æ³•ã€‚å®ƒé€šè¿‡ç»“åˆâ€‹**â€‹ç›¸å¯¹å®¹å·®â€‹**â€‹ï¼ˆ`rel_tol`ï¼‰æ¥è§£å†³å¤§æ•°å€¼æ¯”è¾ƒçš„é—®é¢˜ï¼Œä»¥åŠâ€‹**â€‹ç»å¯¹å®¹å·®ä¸‹é™â€‹**â€‹ï¼ˆ`abs_tol`ï¼‰æ¥è§£å†³éå¸¸æ¥è¿‘é›¶çš„æ•°å€¼æ¯”è¾ƒçš„é—®é¢˜ï¼Œä»è€Œåœ¨å„ç§ä¸åŒçš„æ•°å€¼é‡çº§ä¸Šæä¾›æ›´åˆç†ã€æ›´ä¸€è‡´çš„æ¯”è¾ƒç»“æœã€‚åœ¨å¤æ‚åº”ç”¨ä¸­ï¼Œä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ç›¸å¯¹ç›¸ç­‰è€Œä¸æ˜¯ç®€å•çš„ç»å¯¹å®¹å·®ç›¸ç­‰ã€‚\n## ç»ƒä¹ é¢˜\n\n### CSAPP-3rd P93 2.84\n\n```c\nå¡«å†™ä¸‹åˆ—ç¨‹åºçš„è¿”å›å€¼ï¼Œè¿™ä¸ªç¨‹åºæµ‹è¯•å®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¦å°äºæˆ–è€…ç­‰äºç¬¬äºŒä¸ªå‚æ•°ã€‚å‡å®šå‡½æ•°f2uè¿”å›ä¸€ä¸ªæ— ç¬¦å·32ä½æ•°å­—ï¼Œå…¶ä½è¡¨ç¤ºä¸å®ƒçš„æµ®ç‚¹å‚æ•°ç›¸åŒã€‚ä½ å¯ä»¥å‡è®¾ä¸¤ä¸ªå‚æ•°éƒ½ä¸æ˜¯NaNã€‚ä¸¤ç§0ï¼Œ+0å’Œä¸€0è¢«è®¤ä¸ºæ˜¯ç›¸ç­‰çš„ã€‚\nint float_1e(float x, float y){\nunsigned ux=f2u(x);\nunsigned uy=f2u(y);\n/*Get the sign bits*/\nunsigned sx=ux >>31;\nunsigned sy=uy >>31;\n/*Give an expression using only uxï¼Œuyï¼Œsxï¼Œand sy*/\nreturn;\n}\nå¦‚æœä½¿ç”¨åˆ¤æ–­å°±æ¯”è¾ƒç®€å•ï¼Œä¸‹é¢æ˜¯ä¸ä½¿ç”¨åˆ¤æ–­.\nç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¦å°äºç­‰äºç¬¬äºŒä¸ªå‚æ•°ï¼Œå°†å¯èƒ½æ»¡è¶³çš„æƒ…å†µï¼ˆå³ä¼šè¿”å›1çš„æƒ…å†µï¼‰è¿›è¡Œåˆ†ç±»å¤„ç†ã€‚\næƒ…å†µä¸€ï¼šä¸¤ä¸ªå‚æ•°ç›¸ç­‰ä¸”ä¸º0ï¼Œ æ ¹æ®IEEEè§„åˆ™ï¼Œ0ç”¨Denormalizedè¡¨ç¤ºï¼Œä¸”æœ‰+0(0x0)å’Œ-0(0x80000000)ä¸¤ç§è¡¨ç¤º æ‰€ä»¥é€šè¿‡å·¦ç§»ä¸€ä½æ¥æ¯”è¾ƒ\n==>ux << 1 == 0 && uy << 1 == 0\næƒ…å†µäºŒï¼šç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè´Ÿ(æ­¤æ—¶ux>>31ä¸ºsx=0x1å¾—åˆ°!sx=0) ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸º0æˆ–è€…æ­£æ•°(æ­¤æ—¶uy>>31ä¸ºsy=0x0 !sy=1)\n==>(sx && !sy)\nåä¹‹ï¼Œè‹¥ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ­£æˆ–è€…0ï¼Œ ç¬¬äºŒä¸ªå‚æ•°ä¸ºè´Ÿï¼Œè¿™ç§æƒ…å†µè‚¯å®šè¿”å›0ï¼Œå°±ä¸éœ€è¦ç‰¹æ®Šå¤„ç†ã€‚\næƒ…å†µä¸‰ï¼šä¸¤ä¸ªå‚æ•°éƒ½ä¸ºæ­£\n==>(!sx && !sy && ux <= uy)\næƒ…å†µå››ï¼šä¸¤ä¸ªå‚æ•°éƒ½ä¸ºè´Ÿï¼Œæ­¤æ—¶æ ¹æ®IEEEçš„å®šä¹‰ æ­£æ•°å¯ä»¥ç”¨æ— ç¬¦å·æ•´æ•°çš„å‡åºè¿›è¡Œæ’åˆ—ï¼ˆæ­£æ•°è¶Šå¤§ æ— ç¬¦å·æ•°è¶Šå¤§ï¼‰ è´Ÿæ•°å¯ä»¥ç”¨æ— ç¬¦å·æ•´æ•°çš„å‡åºè¿›è¡Œæ’åˆ—ï¼ˆè´Ÿæ•°è¶Šå°ï¼Œæ— ç¬¦å·æ•°è¶Šå¤§ï¼‰\n==>(sx && sy && ux >= uy)\nå››ç§æƒ…å†µæˆ–è¿ç®—,æ»¡è¶³ä¸€ç§å°±è¿”å›1ã€‚\n```\n### è®¨è®ºé¢˜\nä¸‹åˆ—å“ªäº›æµ®ç‚¹æ•°æ˜¯ç¬¦åˆæ ‡å‡†çš„ï¼Ÿ`1.e0`ã€`1.2e0`ã€`.2e0`ã€`123`ã€`1e0`ã€`2e4.2`ã€`1.2`ã€`.e5`\nâ€‹â€‹`2e4.2`ï¼šä¸ç¬¦åˆâ€‹ã€‚æŒ‡æ•°éƒ¨åˆ† (`e4.2`) åŒ…å«äº†å°æ•°ç‚¹Â `.`ã€‚æŒ‡æ•°å¿…é¡»æ˜¯ä¸€ä¸ªâ€‹**â€‹æ•´æ•°â€‹**â€‹ï¼ˆå¯æ­£å¯è´Ÿï¼Œå¦‚Â `4`,Â `-2`,Â `+10`ï¼‰ã€‚\n`.e5`ï¼šâ€‹â€‹ä¸ç¬¦åˆâ€‹ã€‚å°¾æ•°éƒ¨åˆ†Â `.e5`Â ç¼ºå°‘æœ‰æ•ˆçš„æ•°å­—ã€‚å‰é¢åªæœ‰å°æ•°ç‚¹Â `.`Â è€Œæ²¡æœ‰è·Ÿéšä»»ä½•æ•°å­—ã€‚å¿…é¡»åœ¨å°æ•°ç‚¹å‰åè‡³å°‘æœ‰ä¸€æ–¹åŒ…å«æ•°å­—ï¼ˆå¦‚Â `.1`,Â `1.`,Â `1.2`,Â `1e5`ï¼‰ã€‚\n# ä¸¤é“è¯¡å¼‚çš„é¢˜ç›®\n\n```c\nint main()\n{\n    char a = 100;\n    char b = 200;\n    char c = a + b;\n    printf(\"%d %d\\n\", c, a+b);\n}\n//è¾“å‡ºç»“æœä¸º44 44\n```\n\naå’ŒbåŒä¸º8ä½æœ‰ç¬¦å·æ•´å‹ç±»æ•°æ®ã€‚ç›´æ¥åŠ å’Œï¼Œa+bç­‰äº300ã€‚aå’Œbéƒ½æ˜¯charå‹ï¼Œæœ€åå¾—å‡ºçš„ç»“æœä¹Ÿæ˜¯charå‹ï¼šå› ä¸ºæº¢å‡ºäº†8ä½çš„æœ€å¤§èŒƒå›´ï¼ˆ0~255ï¼‰ï¼Œæ‰€ä»¥éœ€è¦æ¨¡256ï¼Œæœ€ç»ˆ300è½¬æ¢åçš„ç»“æœç­‰æ•ˆäº44ã€‚\n\n44æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­çš„æ•°æ®ï¼Œæœ€ç»ˆæ˜¾ç¤ºç»™äººç±»çš„è¿˜æ˜¯44ï¼Œå› ä¸º44æ²¡æœ‰è¶…è¿‡127ï¼Œä¹Ÿå°±ä¸ç”¨æ¶‰åŠåˆ°è¡¥ç æ¥è¡¨ç¤ºè´Ÿæ•°ã€‚ï¼ˆåä¹‹çš„æƒ…å†µï¼Œå¦‚æœæ¨¡åçš„ç»“æœæ˜¯128ï¼Œåˆ™è¡¨ç¤ºäººç±»æ‰€çœ‹åˆ°çš„è´Ÿæ•°-128ï¼›å¦‚æœæ¨¡åçš„ç»“æœæ˜¯255ï¼Œåˆ™è¡¨ç¤º-1ï¼‰\n\næ—¢ç„¶aå’Œbéƒ½æ˜¯charå‹ï¼Œæœ€åå¾—å‡ºçš„ç»“æœä¹Ÿæ˜¯charå‹ï¼Œæ‰€ä»¥\"c\"å’Œ\"a+b\"ä¸¤è€…ä»£è¡¨çš„æ„ä¹‰æ˜¯ä¸€æ ·çš„ï¼Œæœ€ç»ˆéƒ½æ˜¯charå‹ä¸‹çš„44ã€‚äºæ˜¯è¾“å‡ºç»“æœä¸º44ã€‚\n\nä¸Šé¢çš„é¢˜ç›®åªæ˜¯ä¹å‘µä¸€ä¸‹ï¼Œä¸‹é¢çš„é¢˜ç›®æ‰è¯¡å¼‚è«æµ‹ï¼Œå¦‚æœå¯¹è®¡ç®—æœºçš„åº•å±‚è¿ç®—æ³•åˆ™ã€æµç¨‹ä¸è¯¦ï¼Œé‚£ä¹ˆæ˜¯æ— æ³•é¢†ä¼šçš„ã€‚\n\n```c\nint main()\n{\n    unsigned char a = 100;\n    unsigned char b = 200;\n    char c = a + b;\n    printf(\"%d %d\\n\", c, a+b);\n}\n//è¾“å‡ºç»“æœä¸º44 300\n```\n\næˆ‘ä»¬é»˜è®¤æˆ‘ä»¬åœ¨x86ä½“ç³»æ¶æ„ä¸‹çš„ã€å­—é•¿ä¸º32ä½çš„ç¯å¢ƒä¸‹è¿è¡Œã€‚æ ¹æ®å¾®æœºåŸç†x86çš„æè¿°ï¼Œæˆ‘ä»¬çš„é€šç”¨å¯„å­˜å™¨æœ‰`eax/ebx/ecx/edx`ã€‚å…¶ä¸­ä½16ä½å«åš`ax/bx/cx/dx`ã€‚å†åˆ†ï¼Œä½16ä½ä¸­çš„é«˜8ä½å«åš`ah/bh/ch/dh`ã€ä½8ä½å«åš`al/bl/cl/dl`ã€‚\n\nç»è¿‡æµ‹è¯•ï¼Œåœ¨VS2019ç¼–è¯‘å™¨ä¸‹ï¼Œåæ±‡ç¼–ä»£ç å¾—å‡ºï¼š`a+b`è¿™ä¸ªè¯­å¥çš„è¿ç®—é¦–å…ˆè¦æŠŠaå’Œbçš„å€¼åˆ†åˆ«å­˜æ”¾åˆ°å¯„å­˜å™¨`eax/ecx`ä¸­ã€‚æ³¨æ„ï¼šeaxå’Œecxéƒ½æ˜¯32ä½å¯„å­˜å™¨ï¼Œ**å¦‚æœæŠŠaå’Œbçš„å€¼åˆ†åˆ«å­˜æ”¾åˆ°å¯„å­˜å™¨eax/ecxä¸­ï¼Œæ„å‘³ç€å­˜æ”¾äº†åŸæ¥çš„8ä½æœ‰æ•ˆæ•°æ®å¤–ï¼Œå‰é¢çš„24ä½éƒ½éœ€è¦è¡¥ä½**ï¼Œè€Œæ— ç¬¦å·æ•´å‹æ•°æ®è¡¥å‰ä½æ—¶ç”¨0è¡¥ä½ã€‚\nå­˜æ•°æ®ä¹‹åï¼Œå¯¹ä¸¤æ•°çš„åŠ æ“ä½œæ˜¯ï¼š`add eax,ecx`ã€‚**å³åŠ æ“ä½œæ˜¯åœ¨å¯„å­˜å™¨å†…ç´¯åŠ çš„**ã€‚é‚£ä¹ˆå³ä½¿300è¶…è¿‡äº†255ï¼Œæœ¬åº”æº¢å‡ºçš„æ•°æ®ä»ç„¶èƒ½æœ‰æ•ˆä¿å­˜åœ¨å¯„å­˜å™¨eaxä¸­ï¼ˆå³å…³é”®çš„ç¬¬9ä½â€”â€”\"1\"ï¼‰ã€‚\n\næ¥ä¸‹æ¥ï¼š\n\n**å¯¹äº`char c = a + b`;**ï¼Œå¯¹cçš„èµ‹å€¼æ˜¯é€šè¿‡eaxèµ‹å€¼çš„ï¼Œå› ä¸ºå£°æ˜äº†cæ˜¯æœ‰ç¬¦å·charå‹ï¼Œèµ‹å€¼æ—¶å­˜åœ¨éšå½¢ç±»å‹è½¬æ¢ï¼Œå³è¦è¿›è¡Œéšå¼çš„åˆ‡ç‰‡æ“ä½œï¼Œå°†åˆ‡é™¤å‰24ä½ï¼Œç•™ä¸‹å8ä½ã€‚æ‰€ä»¥ï¼šè¿™é‡Œç¼–è¯‘å™¨åªæŠŠä½å…«ä½å³ALèµ‹ç»™äº†cã€‚å› æ­¤ï¼Œä¸Šè¿°çš„eaxå¯„å­˜å™¨ä¸­å…³é”®çš„ç¬¬9ä½â€”â€”\"1\"å¤±æ•ˆäº†ï¼Œåªä¿ç•™äº†åå…«ä½ï¼Œæœ€ç»ˆæ‰“å°cçš„ç»“æœæ˜¯44ã€‚\n\n![image-20210818214251517](../../images/C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/image-20210818214251517.png)\n\n**å¯¹äº`a + b`;**ï¼Œaå’Œbåœ¨eaxå¯„å­˜å™¨ä¸­ç›´æ¥åŠ å’Œçš„ç»“æœæ˜¯300ï¼Œå³ä½¿è¶…è¿‡äº†255ï¼Œæœ¬åº”æº¢å‡ºçš„æ•°æ®ä»ç„¶èƒ½æœ‰æ•ˆä¿å­˜åœ¨å¯„å­˜å™¨eaxä¸­ï¼ˆå³å…³é”®çš„ç¬¬9ä½â€”â€”\"1\"ï¼‰ã€‚è€Œæˆ‘ä»¬æ ¼å¼åŒ–æ§åˆ¶çš„è¾“å‡ºæ˜¯`%d`ï¼Œå³æˆ‘ä»¬è¦æ‹¿4ä¸ªå­—èŠ‚å³**32ä½æœ‰ç¬¦å·æ•´å‹**æ¥è¯†åˆ«å†…å­˜çš„æ•°æ®ï¼Œ**å¹¶åœ¨æœ€åè½¬ä¸ºåè¿›åˆ¶æ•°**ï¼Œæ‰€ä»¥æ‰“å°å‡ºæ¥æ˜¯300ã€‚ï¼ˆå…¶å®å¦‚æœæ‹¿`%u`æ¥æ‰“å°æ›´åˆé€‚ï¼Œå³**32ä½æ— ç¬¦å·æ•´å‹**æ¥è¯†åˆ«å†…å­˜çš„æ•°æ®ï¼Œ**å¹¶åœ¨æœ€åè½¬ä¸ºåè¿›åˆ¶æ•°**ï¼Œæœ€åæ‰“å°å‡ºæ¥ä¹Ÿæ˜¯300ï¼‰\n\n## ä¹ é¢˜\n\n```c\nint main()\n{\n    char c = 128;\n    unsigned char uc = 128;\n    unsigned short us = 0;\n    us = c + uc;\n    printf(\"%x \\n\",us);//0\n    \n    us = (unsigned char)c+uc;\n    printf(\"%x \\n\",us);//16:100->10:256\n    \n    us = c+(char)uc;\n    printf(\"%x \\n\",us);//2:1111 1111 1000 0000+1111 1111 1000 0000=>(1) 1111 1111 0000 0000 -> 16:ff00\n    \n    //åŒus = c + uc;åŸç†ä¸€æ ·ï¼Œéƒ½æ˜¯ç›¸å½“äºæŠŠcå­˜æ”¾åˆ°16ä½axå¯„å­˜å™¨ä¸­ï¼Œè‡ªç„¶éœ€è¦è¡¥ä½ï¼Œè€ŒcåŸæœ¬æ˜¯æœ‰ç¬¦å·æ•°ï¼Œåˆ™è¡¥ç¬¦å·ä½\"1\"ã€‚\n\t//å¼ºè½¬ä¸º(unsigned short)å°±è¡¨ç¤ºå­˜æ”¾åˆ°16ä½axå¯„å­˜å™¨ä¸­ã€‚å…¶å®æˆ‘ä»¬ä¸ç”¨äººä¸ºåœ°æ˜¾å¼å†™å‡º\"(unsigned short)\"ï¼Œå› ä¸ºc+ucè‚¯å®šéœ€è¦è¾¾åˆ°ç»Ÿä¸€ç±»å‹ï¼Œè‡ªç„¶è¦æŠŠchar céšå¼è½¬ä¸ºunsigned shortï¼Œå³æ— ç¬¦å·16ä½æ•°æ®ã€‚\n    us = (unsigned short)c+uc;\n    printf(\"%x \\n\",us);//1111 1111 1000 0000+0000 0000 1000 0000=>(1) 0000 0000 0000 0000 =>0 -> 16:0\n    \n    return 0;\n}//0 100 ff00 0\n```\n\n![image-20210818224646093](../../images/C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/image-20210818224646093.png)\n\n![image-20210818224658042](../../images/C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/image-20210818224658042.png)\n\n![image-20210818224711482](../../images/C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/image-20210818224711482.png)\n\n![image-20210818224728892](../../images/C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/image-20210818224728892.png)\n\n![image-20210818224743542](../../images/C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/image-20210818224743542.png)\n\n# é«˜è¶…çš„æŠ€è‰º\n\n```c\n//æœ€æ‹‰è·¨çš„\nint Get1Bit(int x)\n{\n    int sum = 0;\n    while(x)\n    {\n        if(x & 0x01)\n        {\n            sum += 1;\n        }\n        x = x >> 1;\n    }\n    return sum;\n}\n//é¢è¯•å®å…¸ä¸­\n//è€å¸ˆä¸è®²ï¼Œå­¦ç”Ÿæ°¸è¿œä¸çŸ¥é“\nint Get1Bit(int x)\n{\n    int sum = 0;\n    while(x)\n    {\n        x = x &(x-1);\n        sum+=1;\n    }\n    return sum;\n}\n//æŸ¥è¡¨æ–¹æ¡ˆ\nint Get1Bit(int x)\n{\n    int ar[] = {0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,4};\n    int sum = 0;\n    for(int i = 0;i<sizeof(x)*2;++i)\n    {\n        sum = sum + ar[x & 0x0f];\n        x = x >> 4;\n    }\n    return sum;\n}\n```\n\nè¿™ä¸ªå‡1å°±ä¸åŸæ•°æŒ‰ä½ä¸ï¼Œæ¯æ¬¡éƒ½ä¼šå°‘ä¸ª1ã€‚\n\n![image-20210823024356781](../../images/C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/image-20210823024356781.png)\n\nè®¡ç®—ä¸€ä¸ª4å­—èŠ‚æ•´å‹çš„äºŒè¿›åˆ¶æ ¼å¼ä¸­1çš„ä¸ªæ•°ã€‚\n\næœ‰ä¸€ä½å›¾è®ºçš„å­¦ç”Ÿï¼Œé¢è¯•æ—¶é€šè¿‡æ­¤é¢˜è¿›å…¥äº†è…¾è®¯ã€‚\n\n![image-20210823021837556](../../images/C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/image-20210823021837556.png)\n\n![image-20210823021900711](../../images/C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/image-20210823021900711.png)\n\n![image-20210823021915500](../../images/C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/image-20210823021915500.png)\n\n# æ–­ä½\n\n```c\nstruct Node\n{\n    char a:4;\n    unsigned char b:3;\n    \n    unsigned char c:5;\n};\nint main()\n{\n    struct Node x={};\n    x.a = 4;\n    x.b = 2;\n    x.c = 5;\n}\n```\n\n# åˆ·é¢˜\n\n![image-20210921200013444](../../images/C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/image-20210921200013444.png)\n\n```c\nint getDecimalValue(struct ListNode* head)\n{\n    int res = 0;\n    struct ListNode* p = head;\n    while (p != NULL)\n    {\n        res = res << 1 | p->val;\n        p = p->next;\n    }\n    return res;\n}\n```\n\n","categories":["C"]},{"title":"Cè¯­è¨€_ç»“æ„ä½“","url":"/C/Cè¯­è¨€_ç»“æ„ä½“/","content":"# æœ¬ç« å†…å®¹\n\n1. ç»“æ„ä½“ç±»å‹çš„è®¾è®¡\n2. ç»“æ„ä½“å˜é‡åˆå§‹åŒ–\n3. ç»“æ„ä½“æˆå‘˜è®¿é—®\n4. ç»“æ„ä½“ä¸æ•°ç»„\n# ç»“æ„ä½“ç±»å‹çš„è®¾è®¡\n\nC è¯­è¨€æä¾›äº†åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå¦‚ `char`, `short`, `int`, `float` ç­‰ç±»å‹ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå†…ç½®ç±»å‹ã€‚\nç¨‹åºå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨ç»“æ„ä½“æ¥å°è£…ä¸€äº›å±æ€§ï¼Œè®¾è®¡å‡ºæ–°çš„ç±»å‹ï¼Œåœ¨ C è¯­è¨€ä¸­ç§°ä¸ºç»“æ„ä½“ç±»å‹ã€‚\nåœ¨ C è¯­è¨€ä¸­ï¼Œç»“æ„ä½“æ˜¯ä¸€ç§æ•°æ®ç±»å‹ã€‚ï¼ˆç”±ç¨‹åºå¼€å‘è€…è‡ªå·±è®¾è®¡çš„ç±»å‹ï¼‰\nå¯ä»¥ä½¿ç”¨ç»“æ„ä½“ï¼ˆstructï¼‰æ¥å­˜æ”¾ä¸€ç»„ä¸åŒç±»å‹çš„æ•°æ®ã€‚ç»“æ„ä½“çš„å®šä¹‰å½¢å¼ä¸ºï¼š\n```c\nstruct ç»“æ„ä½“å\n{\n    æˆå‘˜åˆ—è¡¨ï¼ˆå¯ä»¥æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼ŒæŒ‡é’ˆï¼Œæ•°ç»„æˆ–å…¶å®ƒç»“æ„ç±»å‹ï¼‰\n};\n```\n## æˆ‘ä»¬è‡ªå·±è®¾è®¡ä¸€ä¸ªå­¦ç”Ÿç±»å‹\n\nå®¢è§‚äº‹ç‰©ï¼ˆå®ä½“ï¼‰æ˜¯å¤æ‚çš„ï¼Œè¦æè¿°å®ƒå¿…é¡»ä»å¤šæ–¹é¢è¿›è¡Œï¼Œä¹Ÿå°±æ˜¯ç”¨ä¸åŒçš„æ•°æ®ç±»å‹æ¥æè¿°ä¸åŒçš„æ–¹é¢ã€‚å¦‚å­¦ç”Ÿå®ä½“å¯ä»¥è¿™æ ·æ¥æè¿°ï¼š\n1. å­¦ç”Ÿå­¦å·ï¼ˆç”¨å­—ç¬¦ä¸²æè¿°ï¼‰\n2. å­¦ç”Ÿå§“åï¼ˆç”¨å­—ç¬¦ä¸²æè¿°ï¼‰\n3. æ€§åˆ«ï¼ˆç”¨å­—ç¬¦ä¸²æè¿°ï¼‰\n4. å¹´é¾„ï¼ˆç”¨æ•´å‹æ•°æè¿°ï¼‰ã€‚\nè¿™é‡Œç”¨äº†2ç§ä¸åŒæ•°æ®ç±»å‹ï¼Œä»¥åŠå››ä¸ª**æ•°æ®æˆå‘˜**ï¼ˆdata memberï¼‰æ¥æè¿°å­¦ç”Ÿå®ä½“ã€‚\nï¼ˆæ•°æ®æˆå‘˜ï¼Œä¹Ÿå¯ç§°ä¹‹ä¸ºå±æ€§ï¼Œä¸èƒ½ç§°ä¹‹ä¸ºå‡½æ•°ä¸­çš„å˜é‡æ¦‚å¿µï¼‰\n\n![image-20210815101308997](../../images/C%E8%AF%AD%E8%A8%80_%E7%BB%93%E6%9E%84%E4%BD%93/image-20210815101308997.png)\n# ç»“æ„ä½“å˜é‡çš„å®šä¹‰å’Œåˆå§‹åŒ–\n\næ—¢ç„¶ç»“æ„ä½“æ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨å®ƒæ¥å®šä¹‰å˜é‡ã€‚ç»“æ„ä½“å°±åƒä¸€ä¸ªâ€œæ¨¡æ¿â€ï¼Œå®šä¹‰å‡ºæ¥çš„å˜é‡éƒ½å…·æœ‰ç›¸åŒçš„æ€§è´¨ã€‚\nä¹Ÿå¯ä»¥å°†**ç»“æ„ä½“æ¯”ä½œâ€œå›¾çº¸â€ï¼Œå°†ç»“æ„ä½“å˜é‡æ¯”ä½œâ€œé›¶ä»¶â€**ï¼Œæ ¹æ®åŒä¸€å¼ å›¾çº¸ç”Ÿäº§å‡ºæ¥çš„é›¶ä»¶çš„ç‰¹æ€§éƒ½æ˜¯ä¸€æ ·çš„ã€‚\n**ç»“æ„ä½“æ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œæ˜¯åˆ›å»ºå˜é‡çš„æ¨¡æ¿ï¼Œä¸å ç”¨å†…å­˜ç©ºé—´ï¼›ç»“æ„ä½“å˜é‡æ‰åŒ…å«äº†å®å®åœ¨åœ¨çš„æ•°æ®ï¼Œéœ€è¦å­˜å‚¨ç©ºé—´**ã€‚\n## ç»“æ„ä½“å˜é‡åœ¨å†…å­˜ä¸­è¡¨ç¤º\n\næ€è€ƒä¸‹è¿°ä»£ç ç»“æ„ä½“åœ¨å†…å­˜ä¸­çš„åˆ†é…æ˜¯Aæƒ…å†µè¿˜æ˜¯Bæƒ…å†µï¼Ÿ\n\n```c\nstruct Student\n{\n    char s_id[8];\n    char s_name[8];\n    char s_sex[4];\n    int s_age;\n};\nint main()\n{\n    int a = 10,b = 20;\n    struct Student s1 = {\"09001\",\"yhping\",\"man\",23};\n    return 0;\n}\n```\n\n![image-20210816155806100](../../images/C%E8%AF%AD%E8%A8%80_%E7%BB%93%E6%9E%84%E4%BD%93/image-20210816155806100.png)\n\nç­”æ¡ˆæ˜¯Aï¼Œå³ç»“æ„ä½“æˆå‘˜çš„å†…å­˜åˆ†å¸ƒé¡ºåºæ˜¯ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡æ’åˆ—ã€‚ä¸ºä»€ä¹ˆä¸æ˜¯åƒa,bé‚£æ ·çš„é¡ºåºï¼Ÿ\n\næˆ‘è‡ªå·±çš„è§£é‡Šï¼šç»“æ„ä½“çš„ç±»å‹ç»“æ„å£°æ˜ä¸åƒå‡½æ•°ä¸­å˜é‡çš„å£°æ˜å®šä¹‰ã€‚æˆ‘ä»¬è¦åŒºåˆ†ç±»å‹å†…éƒ¨çš„æˆå‘˜å’Œå‡½æ•°å†…éƒ¨çš„å˜é‡ï¼Œä¸¤è€…æ˜¯æˆªç„¶ä¸åŒçš„ï¼ç»“æ„ä½“ç±»å‹çš„æŠ½è±¡æ˜¯ä¸€ç§ç±»å‹ï¼Œæ˜¯ç”±è‹¥å¹²å…¶ä»–ç±»å‹ç»„æˆçš„ä¸€ç§æ–°ç±»å‹ï¼Œé‚£ä¹ˆç±»å‹å†…éƒ¨çš„æˆå‘˜å¿…ç„¶è¦æŒ‰ç…§æˆ‘ä»¬åœ¨å®šä¹‰æ—¶çš„é¡ºåºä»ä¸Šåˆ°ä¸‹åˆ†å¸ƒå†…å­˜ç©ºé—´ï¼Œæ‰ç¬¦åˆç¨‹åºè®¾è®¡çš„é€»è¾‘æ€è·¯ã€‚æŒ‰ç…§å¦‚æ­¤è§„åˆ™å¦‚æ­¤åˆ†å¸ƒï¼Œæ‰èƒ½æ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œåç»­çš„ç»™ç»“æ„ä½“å˜é‡åˆå§‹åŒ–èµ‹å€¼ï¼Œå¤§æ‹¬å·å†…çš„å€¼çš„é¡ºåºæ˜¯æŒ‰ç…§æˆå‘˜é¡ºåºæ¥çš„ï¼Œè€Œä¸æ˜¯éšæ„é¢ å€’é¡ºåºï¼Œç¼–è¯‘å™¨æ˜¯ä¸ä¼šåŒæ„çš„ã€‚\n\nç¤ºä¾‹\n\n![image-20210815102046756](../../images/Cè¯­è¨€_ç»“æ„ä½“/image-20210815102046756.png)\nå¦‚æœæŠŠ`char`æ•°ç»„æ”¹ä¸ºæŒ‡é’ˆï¼š\n![image-20210815104639636](../../images/Cè¯­è¨€_ç»“æ„ä½“/image-20210815104639636.png)\n## ç»“æ„å˜é‡åˆå§‹åŒ–\n\n![image-20210815102137170](../../images/Cè¯­è¨€_ç»“æ„ä½“/image-20210815102137170.png)\n\nå¤§æ‹¬å·å†…çš„å€¼çš„é¡ºåºæ˜¯æŒ‰ç…§æˆå‘˜é¡ºåºæ¥çš„ï¼Œè€Œä¸æ˜¯éšæ„é¢ å€’é¡ºåºï¼Œç¼–è¯‘å™¨æ˜¯ä¸ä¼šåŒæ„çš„ã€‚\n\n![image-20210816162135598](../../images/Cè¯­è¨€_ç»“æ„ä½“/image-20210816162135598.png)\n\nå¦‚æœæŠŠcharæ•°ç»„æ”¹ä¸ºæŒ‡é’ˆï¼š\n\nè¿™æ—¶æŒ‰ç…§ä¸Šå›¾çš„èµ‹å€¼æ–¹å¼ï¼Œåœ¨VS2019ä¸­æ˜¯ä¸èƒ½é€šè¿‡çš„ï¼Œå› ä¸ºï¼Œ`\"09001\"`è¿™ç§åŒå¼•å·å¼•èµ·æ¥çš„å­—ç¬¦ä¸²çš„ç±»å‹æ˜¯å¸¸é‡å­—ç¬¦ä¸²å‹å³`const char*`ï¼ˆè¦ç»™`s_id`èµ‹çš„å€¼æœ¬è´¨æ˜¯å­—ç¬¦ä¸²é¦–å­—ç¬¦`'0'`çš„æŒ‡é’ˆï¼Œæ­¤æŒ‡é’ˆåªèƒ½è¯»æ•°æ®ä¸èƒ½æ”¹æ•°æ®ï¼Œå› æ­¤ç±»å‹æ˜¯`const char*`ï¼‰ï¼Œä¸æˆ‘ä»¬åœ¨ç»“æ„ä½“ä¸­å£°æ˜çš„`char*`ä¸åŒ¹é…ã€‚\n\n## ç»“æ„ä½“åµŒå¥—ç»“æ„ä½“\n\n![image-20210815104658804](../../images/Cè¯­è¨€_ç»“æ„ä½“/image-20210815104658804.png)\n\næ€è€ƒä»¥ä¸‹ç»“æ„æ˜¯å¦å¯è¡Œï¼Ÿ\n\n```c\nstruct Student\n{\n    char s_name[8];\n    int s_age;\n    float score;\n    struct Student studx;\n};\t\t//sizeof(Student)æ˜¯è®¡ç®—ä¸å‡ºæ¥çš„ï¼Œå› ä¸ºå¦‚æ­¤å®šä¹‰ä¼šå¯¼è‡´æ— ç©·çš„é€’å½’ä¸‹å»ã€‚ä¸èƒ½è¢«sizeofè®¡ç®—çš„ç±»å‹å› æ­¤ä¹Ÿå«åšä¸å®Œæ•´çš„ç±»å‹ã€‚\n```\n\n![image-20210816181150361](../../images/Cè¯­è¨€_ç»“æ„ä½“/image-20210816181150361.png)\n## ç»“æ„ä½“é“¾æ¥ç»“æ„ä½“\n\n```c\nstruct Student\n{\n    char s_name[8];\n    int s_age;\n    float score;\n    struct Student* next;//å¦‚æ­¤å®šä¹‰æ‰å¯è¡Œã€‚\n};\t\t//sizeof(Student)==16\nint main()\n{\n    struct Node a,b,c;\n    struct Node* head = &a;\n    a.data = 10;\n    a.next = &b;\n    b.data = 20;\n    b.next = &c;\n    c.data = 30;\n    c.next = NULL;\n    \n    return 0;\n}\n```\n\n![image-20210816181426848](../../images/Cè¯­è¨€_ç»“æ„ä½“/image-20210816181426848.png)\nå¦‚ä½•ä½¿ç”¨å¾ªç¯æ‰“å°ï¼Ÿ\n\n```c\nvoid Print_List(const struct Node* head)\n{\n    const struct Node* p = head;\n    while(p!=nullptr)\n    {\n        printf(\"%d \",p->data);\n        p = p->next;\n    }\n}\n```\n\n# ç»“æ„ä½“æˆå‘˜çš„è®¿é—®\n\nç»“æ„ä½“å˜é‡çš„æˆå‘˜ä½¿ç”¨`.`è®¿é—®ã€‚\nè·å–å’Œèµ‹å€¼ç»“æ„ä½“å˜é‡æˆå‘˜çš„ä¸€èˆ¬æ ¼å¼ä¸ºï¼š`ç»“æ„ä½“å˜é‡.æˆå‘˜å`ï¼›\n## ç»“æ„ä½“å˜é‡æˆå‘˜çš„è®¿é—®\n\n```c\n#include<stdio.h>\n#include<string.h>\nstruct Date\n{\n\tint year;\n\tint month;\n\tint day;\n};\nstruct Student stud1\n{\n\tchar s_name[20]; //å§“å\n\tstruct Date birthday; //ç”Ÿæ—¥\n\tfloat score; //æˆç»©\n};\nint main()\n{\n\tstruct Student stud1={\"Yhp\",2007,10,1,145.5};\n\tstruct Student stud2={\"Liuwuyang\",{2007,2,2},135.0};\n    \n\tint y = stud1.birthday.year;//ç”¨.è®¿é—®ç»“æ„ä½“å˜é‡çš„æˆå‘˜\n    struct Student* sp = &stud1;\n    sp->s_name;//ç”¨->è®¿é—®ç»“æ„ä½“å˜é‡æŒ‡é’ˆå¯¹åº”çš„ç»“æ„ä½“å˜é‡çš„æˆå‘˜\n    (*sp).s_name;//ç”¨.è®¿é—®ç»“æ„ä½“å˜é‡çš„æˆå‘˜\n    sp->birthday.year;//å‰spæ˜¯æŒ‡é’ˆï¼Œåbirthdayæ˜¯ç»“æ„ä½“ï¼Œæ‰€ä»¥å‰ç”¨->åç”¨.\n    \n\treturn 0;\n}\n```\n\n## ç»“æ„ä½“å˜é‡ï¼ˆçš„æˆå‘˜ï¼‰çš„èµ‹å€¼\n\nå¯¹ç»“æ„å˜é‡æ•´ä½“èµ‹å€¼æœ‰ä¸‰ç§æƒ…å†µï¼š\n1. å®šä¹‰ç»“æ„ä½“å˜é‡ï¼ˆç”¨{ }èŠ±æ‹¬å·åˆå§‹åŒ–ï¼‰ï¼›\n2. ç”¨å·²å®šä¹‰çš„ç»“æ„å˜é‡åˆå§‹åŒ–ï¼›\n3. **ç»“æ„ä½“ç±»å‹ç›¸åŒçš„å˜é‡å¯ä»¥ä½œä¸ºæ•´ä½“ç›¸äº’èµ‹å€¼**ã€‚\n\nåœ¨å…¶ä»–æƒ…å†µçš„ä½¿ç”¨è¿‡ç¨‹ä¸­åªèƒ½å¯¹æˆå‘˜é€ä¸€èµ‹å€¼ã€‚\nåœ¨ C è¯­è¨€ä¸­ä¸å­˜åœ¨å¯¹ç»“æ„ä½“ç±»å‹çš„å¼ºåˆ¶è½¬æ¢ï¼ˆå’Œå†…ç½®ç±»å‹çš„åŒºåˆ«ï¼‰ã€‚\n\n```c\nstruct Student\n{\n\tchar s_id[8];\n    char s_name[8];\n    char s_sex[4];\n    int s_age;\n}Student;\nint main\n{\n    Student stda={\"09001\",\"xcg\",\"M\",23};\n    Student stdb=stda;//è°ƒç”¨äº†memcpy(&stdb,&stda,sizeof(stda));\n    Student stdc;\n    Student stdx;\n    stdc = stda;\n    stdx.s_name = stda.s_name;//æ­¤è¯­å¥æ˜¯é”™è¯¯çš„ã€‚\n    strcpy_s(stdx.s_name,stda.s_name);//æ­£ç¡®çš„åšæ³•ï¼\n}\n```\n\n### å…³äºä¸¤ç»“æ„ä½“å˜é‡æ•´ä½“èµ‹å€¼å¦‚ä½•å®ç°\n\né¦–å…ˆï¼ŒæŠ“ä½ä¸¤ä¸ªç»“æ„ä½“å˜é‡å„è‡ªçš„åœ°å€ï¼Œå†ä¾æ¬¡åŒæ­¥è¿­ä»£æ‹·è´ï¼Œè°ƒç”¨çš„å‡½æ•°æ˜¯`memcpy();`å¦‚`memcpy(&stdb,&stda,sizeof(stda));`\n### å…³äºä¸Šé¢æåˆ°çš„é”™è¯¯èµ‹å€¼\n\n`stdx.s_name = stda.s_name;`æ­¤è¯­å¥æ˜¯é”™è¯¯çš„ã€‚`\n\nä¸ºä»€ä¹ˆï¼Ÿ\n\n`s_name`æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„æ˜¯ä¸å¯èƒ½ç»™å¦ä¸€ä¸ªæ•°ç»„ç›´æ¥èµ‹å€¼çš„ã€‚å› ä¸ºï¼š`s_name`ä»£è¡¨é¦–å…ƒç´ æŒ‡é’ˆï¼Œæ ¹æ®æˆ‘ä»¬æ•°ç»„é‚£ä¸€èŠ‚çš„çŸ¥è¯†å‚¨å¤‡ï¼Œè¿™ä¸ªæŒ‡é’ˆæ˜¯å¸¸é‡ï¼ˆå³æ•°ç»„åæ‰€ä»£è¡¨çš„æŒ‡é’ˆï¼‰ï¼Œ`stdx.s_name = stda.s_name`è¿™ä¸ªè¯­å¥çš„æ„æ€æ˜¯æŠŠ`stda.s_name`è¿™ä¸ªæŒ‡é’ˆèµ‹ç»™`stdx.s_name`è¿™ä¸ªæŒ‡é’ˆï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å¯è¡Œçš„ï¼Œæ•°ç»„é¦–å…ƒç´ æŒ‡é’ˆä¸å¯èƒ½æ”¹å˜ï¼\n\nåŒç†ï¼Œæ•°ç»„åä¸å¯ä»¥`++`ï¼Œå¦‚å·²çŸ¥`int ar[100]={};`çš„`ar`æ•°ç»„ï¼Œ`ar++`è¿™ä¸ªè¯­å¥æ˜¯é”™è¯¯çš„ã€‚\n\nåº”è¯¥å¯¹æ•°ç»„è¿›è¡Œå…¨éƒ¨è¿­ä»£æ‹·è´ï¼Œå¦‚è°ƒç”¨`strcpy_s(stdx.s_name,stda.s_name);`\n\n### ä¸æ•°ç»„`{}`èŠ±æ‹¬å·èµ‹å€¼çš„å¼‚åŒ\n\nä¸åŒç‚¹æ˜¯ï¼šæ•°ç»„çš„èŠ±æ‹¬å·å†…çš„å€¼ç±»å‹å¿…é¡»ä¸€è‡´ï¼Œè€Œç»“æ„ä½“èŠ±æ‹¬å·å†…çš„å€¼å¯èƒ½ä¸ä¸€è‡´ã€‚\n\nå…±åŒç‚¹ï¼šå¦‚æœ`{}`èŠ±æ‹¬å·å†…çš„å†…å®¹ç¼ºçœï¼Œé»˜è®¤èµ‹å€¼ä¸º0ã€‚\n\n## ç»“æ„ä½“å˜é‡å’Œå‡½æ•°\n\næ‹¿æ‰“å°å‡½æ•°ä¸¾ä¾‹\n\n![image-20210816183332238](../../images/C%E8%AF%AD%E8%A8%80_%E7%BB%93%E6%9E%84%E4%BD%93/image-20210816183332238.png)\n\näºŒä¸ªæ‰“å°å‡½æ•°é‚£ä¸ªå¥½ ï¼Ÿ åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ\n\n![image-20210816183348520](../../images/C%E8%AF%AD%E8%A8%80_%E7%BB%93%E6%9E%84%E4%BD%93/image-20210816183348520.png)\n\näºŒä¸ªæ‰“å°å‡½æ•°é‚£ä¸ªå¥½ ï¼Ÿ åŸå› æ˜¯ä»€ä¹ˆï¼Ÿå’ŒæŒ‡é’ˆæ¯”è¾ƒçš„ä¼˜åŠ¿ï¼Ÿ é™åˆ¶æ¡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ\n\nè‚¯å®šæ˜¯`Print_c`å¥½ã€‚ä¼˜åŠ¿åœ¨äºå¦‚æœä¸æ˜¯ç”¨æŒ‡é’ˆæ¥ä¼ å€¼ï¼Œé‚£ä¹ˆè¿˜è¦å†æ¬¡å¼€è¾Ÿç©ºé—´ä¸”ç»™å½¢å‚å¤åˆ¶æºå˜é‡çš„ä¿¡æ¯ï¼Œå¯¼è‡´ç©ºé—´å’Œæ—¶é—´çš„æ•ˆç‡éƒ½å¤§å¤§é™ä½ã€‚è€Œç”¨æŒ‡é’ˆæ¥ä¼ å€¼ï¼Œç›´æ¥èƒ½æ“ä½œæºå˜é‡ã€‚è€Œç”¨`const`æ¥è¯»å–ä¿¡æ¯æ›´ä¸ºè°¨æ…ï¼Œå› ä¸º`const`èƒ½ä¿è¯è¯¥æŒ‡é’ˆåªèƒ½è¯»å–å˜é‡ä¿¡æ¯è€Œä¸èƒ½æ”¹å˜å˜é‡ä¿¡æ¯ã€‚\n\n# ç»“æ„ä½“çš„å¤§å°\n\n```c\nstruct Node_a\n{\n    char ca;\n    int sum;\n    char cb;\n}\nint main()\n{\n    struct Node_a ax;\n    printf(\"%d %d \\n\",sizeof(struct Node_a),sizeof(ax));//12 12\n}\n```\n\n## ä¸ºä»€ä¹ˆè¦ç†è§£å­—èŠ‚å¯¹é½é—®é¢˜\n\n1. å†…å­˜å¤§å°çš„åŸºæœ¬å•ä½æ˜¯å­—èŠ‚ï¼Œç†è®ºä¸Šæ¥è®²ï¼Œå¯ä»¥ä»ä»»æ„åœ°å€è®¿é—®å˜é‡ï¼Œä½†æ˜¯å®é™…ä¸Šï¼Œcpuå¹¶éé€å­—èŠ‚è¯»å†™å†…å­˜ï¼Œè€Œæ˜¯ä»¥ 2, 4 æˆ– 8 çš„å€æ•°çš„å­—èŠ‚å—æ¥è¯»å†™å†…å­˜ï¼Œå› æ­¤å°±ä¼šå¯¹åŸºæœ¬æ•°æ®ç±»å‹çš„åœ°å€ä½œå‡ºä¸€äº›é™åˆ¶ï¼Œå³å®ƒçš„åœ°å€å¿…é¡»æ˜¯ 2ï¼Œ4 æˆ– 8 çš„å€æ•°ã€‚é‚£ä¹ˆå°±è¦æ±‚å„ç§æ•°æ®ç±»å‹æŒ‰ç…§ä¸€å®šçš„è§„åˆ™åœ¨ç©ºé—´ä¸Šæ’åˆ—ï¼Œè¿™å°±æ˜¯å¯¹é½ã€‚\n2. æœ‰äº›å¹³å°æ¯æ¬¡è¯»éƒ½æ˜¯ä»å¶åœ°å€å¼€å§‹ï¼Œå¦‚æœä¸€ä¸ª int å‹ï¼ˆå‡è®¾ä¸º 32 ä½ç³»ç»Ÿï¼‰å¦‚æœå­˜æ”¾åœ¨**å¶åœ°å€**å¼€å§‹çš„åœ°æ–¹ï¼Œé‚£ä¹ˆä¸€ä¸ªè¯»å‘¨æœŸå°±å¯ä»¥è¯»å‡ºè¿™ 32 bitï¼Œè€Œå¦‚æœå­˜æ”¾åœ¨**å¥‡åœ°å€**å¼€å§‹çš„åœ°æ–¹ï¼Œå°±éœ€è¦ 2 ä¸ªè¯»å‘¨æœŸï¼Œå¹¶å¯¹ä¸¤æ¬¡è¯»å‡ºçš„ç»“æœçš„é«˜ä½å­—èŠ‚è¿›è¡Œæ‹¼å‡‘æ‰èƒ½å¾—åˆ°è¯¥ 32 bit æ•°æ®ã€‚æ˜¾ç„¶åœ¨è¯»å–æ•ˆç‡ä¸Šä¸‹é™å¾ˆå¤šã€‚\n3. **ç”±äºä¸åŒå¹³å°å¯¹é½æ–¹å¼å¯èƒ½ä¸åŒï¼Œå¦‚æ­¤ä¸€æ¥ï¼ŒåŒæ ·çš„ç»“æ„åœ¨ä¸åŒçš„å¹³å°å…¶å¤§å°å¯èƒ½ä¸åŒï¼Œåœ¨æ— æ„è¯†çš„æƒ…å†µä¸‹ï¼Œäº’ç›¸å‘é€çš„æ•°æ®å¯èƒ½å‡ºç°é”™ä¹±ï¼Œç”šè‡³å¼•å‘ä¸¥é‡çš„é—®é¢˜**ã€‚\n## è®¡ç®—è§„åˆ™\n\nç”±äºå­˜å‚¨å˜é‡åœ°å€å¯¹é½çš„é—®é¢˜ï¼Œè®¡ç®—ç»“æ„ä½“å¤§å°çš„ 3 æ¡è§„åˆ™ï¼š\n1. ç»“æ„ä½“å˜é‡çš„é¦–åœ°å€ï¼Œå¿…é¡»æ˜¯ç»“æ„ä½“å˜é‡ä¸­çš„â€œæœ€å¤§åŸºæœ¬æ•°æ®ç±»å‹æˆå‘˜æ‰€å å­—èŠ‚æ•°â€çš„æ•´æ•°å€ã€‚\n2. ç»“æ„ä½“å˜é‡ä¸­ï¼Œç›¸å¯¹äº**ç»“æ„ä½“é¦–åœ°å€**ï¼Œ**æ¯ä¸ªæˆå‘˜**çš„**åç§»é‡**ï¼Œéƒ½æ˜¯**æˆå‘˜æœ¬èº«åŸºæœ¬æ•°æ®ç±»å‹**æ‰€å å­—èŠ‚æ•°çš„æ•´æ•°å€ã€‚\n\n   ```c\n   struct Node\n   {\n       char ca;//åç§»åœ°å€ä¸º0ï¼Œå 1å­—èŠ‚ã€‚åç§»åœ°å€1-7èµ·åœ°å€å¯¹é½å ä½ä½œç”¨ï¼Œå†…å®¹æ— å®é™…æ„ä¹‰ã€‚\n       double dx;//åç§»åœ°å€ä¸º8ï¼Œå 8å­—èŠ‚ã€‚å› ä¸ºè¦æ»¡è¶³åŸåˆ™2å³doubleçš„åç§»é‡è¦ç›¸å¯¹äºç»“æ„ä½“é¦–åœ°å€ï¼ˆè§†ä¸º0ï¼‰ï¼Œæ˜¯æˆå‘˜æœ¬èº«åŸºæœ¬æ•°æ®ç±»å‹æ‰€å å­—èŠ‚æ•°çš„æ•´æ•°å€ã€‚åªæœ‰åœ¨åç§»åœ°å€8æ—¶ï¼Œæ‰æ»¡è¶³(8-0)/8==1ã€‚\n       char cb;\n   };//24\n   ```\n3. ç»“æ„ä½“å˜é‡çš„æ€»å¤§å°ï¼Œä¸ºç»“æ„ä½“å˜é‡ä¸­ â€œæœ€å¤§**åŸºæœ¬æ•°æ®ç±»å‹**æˆå‘˜æ‰€å å­—èŠ‚æ•°â€çš„æ•´æ•°å€ã€‚\n![image-20210817015222060](../../images/C%E8%AF%AD%E8%A8%80_%E7%BB%93%E6%9E%84%E4%BD%93/image-20210817015222060.png)\n### å®ä¾‹/æµ‹éªŒ\n\n```c\nstruct node\n{\n    char cha;\n    double da;\n    char chb;\n};//24,å› ä¸ºdaæ˜¯ä»0x08å¼€å§‹çš„ã€‚chaå’Œchbéƒ½å äº†8ä¸ª\n```\n\n```c\nstruct sdate\n{\n    int year;\n    int ia;\n    int day;\n};\nstruct Student\n{\n    char s_id[10];//1-10\n    char s_name[8];//11-18\n    struct sdate birthday;//21-32\n    double grade;//33-40\n};//40\n```\n\n```c\nstruct Inventory\n{\n    char description[15];//è´§ç‰©åç§°\n    char no[10];//è´§å·\n    int quantity;//åº“å­˜æ•°é‡\n    double cost;//æˆæœ¬\n    double retail;//é›¶å”®ä»·æ ¼\n};//48\n```\n\n```c\nstruct Employee\n{\n    char name[27];//1-27\n    char address[30];//28-57\n    long int zip;//61-64\n    long int telenum;//65-68\n    double salary;//72-80\n};//80\n```\n\n### å¦‚ä½•å·§å¦™è®¡ç®—åç§»é‡\n\næœ‰`Employee`ç±»å‹çš„ç»“æ„ä½“ï¼Œæˆå‘˜æœ‰`name`, `address`, `zip`, `telenum`, `salary`ç­‰ï¼Œç°è¦æ±‚ï¼šä¸è¦å®šä¹‰ä»»ä½•ç»“æ„ä½“å˜é‡è®¡ç®—`zip`ç›¸å¯¹ç»“æ„ä½“è‡ªèº«é¦–åœ°å€çš„åç§»é‡ã€‚\nåˆ©ç”¨`å®`+`æ— ä¸­ç”Ÿæœ‰`æ³•ã€‚\n\n```c\n#define my_offset(type,exp) ( (int) & (( (type*)0 )->exp ))\nstruct Employee\n{\n    char name[27];//1-27\n    char address[30];//28-57\n    long int zip;//61-64\n    long int telenum;//65-68\n    double salary;//72-80\n};//80\nint main()\n{\n    int offset = 0;\n    //struct Employee x;\n    //offset = (char*)&x.salary - (char*)&x;  //72-0==72\n    offset = (int) & ( (struct Employee*)0 )->salary;//æ— ä¸­ç”Ÿæœ‰  0x00->0x72\n    offset = my_offer(struct Employee,zip);//åˆ©ç”¨å®å®šä¹‰\n    printf(\"%d \\n\",offset);\n}\n```\n### `#pragma pack`æŒ‡å®šå¯¹é½å€¼\n\né¢„å¤„ç†æŒ‡ä»¤`#pragma pack(n)`å¯ä»¥æ”¹å˜é»˜è®¤å¯¹é½æ•°ã€‚`n`å–å€¼æ˜¯ `1, 2, 4, 8, 16`ã€‚\nVS ä¸­é»˜è®¤å€¼` = 8`ï¼Œgcc ä¸­é»˜è®¤å€¼` = 4`\n\n```c\n#pragma pack(1)\nstruct node\n{\n    char cha;\n    double dx;\n    char chb;\n};\n//è‹¥( )å†…ä¸º1->size:10;\n//\t\tä¸º2->\t12;\n//\t\tä¸º4->\t16;\n//\t\tä¸º8->\t24;\n//\t\tä¸º16->\t24;\n#pragma pack\n```\n### ç»ˆææ€»ç»“\n\n1. ç»“æ„ä½“å˜é‡çš„é¦–åœ°å€ï¼Œå¿…é¡»æ˜¯`MIN{\"ç»“æ„ä½“ æœ€å¤§åŸºæœ¬æ•°æ®ç±»å‹æˆå‘˜ æ‰€å å­—èŠ‚æ•°\", æŒ‡å®šå¯¹é½æ–¹å¼}`çš„æ•´æ•°å€ã€‚\n2. ç»“æ„ä½“ä¸­ï¼Œç›¸å¯¹äºç»“æ„ä½“é¦–åœ°å€ï¼Œæ¯ä¸ªæˆå‘˜çš„åç§»é‡ï¼Œéƒ½æ˜¯`MIN{è¯¥åŸºæœ¬æ•°æ®ç±»å‹æˆå‘˜, æŒ‡å®šå¯¹é½æ–¹å¼}`çš„æ•´æ•°å€ã€‚\n3. ç»“æ„ä½“çš„æ€»å¤§å°ï¼Œä¸º`MIN{ç»“æ„ä½“æœ€å¤§åŸºæœ¬æ•°æ®ç±»å‹æˆå‘˜æ‰€å å­—èŠ‚æ•°, æŒ‡å®šå¯¹é½æ–¹å¼}`çš„æ•´æ•°å€ã€‚\n# æ¯”è¾ƒç»“æ„ä½“å˜é‡\n\nä¸è¦è½»æ˜“åœ°ä½¿ç”¨`memcmp`å‡½æ•°æ¥å¯¹æ¯”ä¸¤ä¸ªç»“æ„ä½“å˜é‡ã€‚å› ä¸ºç»“æ„ä½“å†…å­˜ç»“æ„å±‚é¢ä¸­ï¼Œæˆå‘˜é—´çš„ç©ºéš™å¡«å……çš„å†…å®¹æ˜¯ä¸å¯æ§çš„ï¼Œå³ç»“æ„ä½“æ˜¯ä¸€ç§éè¿ç»­å‹å†…å­˜ç©ºé—´ã€‚\n\n```c\nstruct Node\n{\n    char cha;\n    int ix;\n    char chb;\n};\n//å½“è°ƒç”¨ä¸»å‡½æ•°æ—¶ï¼Œå°†å¯¹åˆ†é…å¾—åˆ°çš„æ ˆå¸§çš„æ¯ä¸ªå­—èŠ‚è¿›è¡Œåˆ·æ–°ï¼Œå…¨éƒ¨èµ‹ä¸º'0xcc'\nint main()\n{\n    int ar[10]={};\n    int br[10]={};\n    int x = memcmp(ar,br,sizeof(ar));\n    printf(\"%d\\n\",x);\n    \n    struct Node x = {'a',12,'b'};\n    struct Node y = {'a',12,'b'};\n    int tag1 = memcmp(&x,&y,sizeof(x));//ä¸è¦è½»æ˜“åœ°ä½¿ç”¨memcmpæ¯”è¾ƒç»“æ„ä½“ã€‚å› ä¸ºç»“æ„ä½“æ˜¯ä¸€ç§éè¿ç»­å‹å†…å­˜ç©ºé—´ã€‚\n    struct Node z = {};//{}ä»£è¡¨:æŠŠ12ä¸ªå­—èŠ‚å…¨èµ‹æˆäº†0\n    z.cha = 'a';\n    z.chb = 'b';\n    z.ix = 12;\n    int tag2 = memcmp(&x,&z,sizeof(x));//è¿”å›å€¼0ä»£è¡¨ç›¸ç­‰ï¼Œ1ä»£è¡¨å¤§äºï¼Œ-1ä»£è¡¨å°äº\n    printf(\"%d %d\\n\",tag1,tag2);//0 1\n    return 0;\n}\n```\n\n![image-20210817153745134](../../images/Cè¯­è¨€_ç»“æ„ä½“/image-20210817153745134.png)\n# ç»“æ„ä½“ä¸æ•°ç»„\n\næ‰€è°“ç»“æ„ä½“æ•°ç»„ï¼Œæ˜¯æŒ‡æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªç»“æ„ä½“ç±»å‹ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒC è¯­è¨€ç»“æ„ä½“æ•°ç»„å¸¸è¢«ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªæ‹¥æœ‰ç›¸åŒæ•°æ®ç»“æ„çš„ç¾¤ä½“ï¼Œæ¯”å¦‚ä¸€ä¸ªç­çš„å­¦ç”Ÿã€ä¸€ä¸ªå…¬å¸çš„å‘˜å·¥ç­‰ã€‚\n# è”åˆä½“\n\nè”åˆä½“(union)ä¸ç»“æ„ä½“(struct)æœ‰ä¸€äº›ç›¸ä¼¼ä¹‹å¤„ã€‚ä½†ä¸¤è€…æœ‰æœ¬è´¨ä¸Šçš„ä¸åŒã€‚åœ¨ç»“æ„ä½“ä¸­,å„æˆå‘˜æœ‰å„è‡ªçš„å†…å­˜ç©ºé—´ã€‚è€Œ**åœ¨è”åˆä½“ä¸­,å„æˆå‘˜å…±äº«åŒä¸€æ®µå†…å­˜ç©ºé—´**, **ä¸€ä¸ªè”åˆä½“å˜é‡çš„é•¿åº¦ç­‰äºæˆå‘˜ä¸­æœ€é•¿çš„é•¿åº¦**ã€‚\nåº”è¯¥è¯´æ˜çš„æ˜¯, è¿™é‡Œæ‰€è°“çš„å…±äº«ä¸æ˜¯æŒ‡æŠŠå¤šä¸ªæˆå‘˜åŒæ—¶è£…å…¥ä¸€ä¸ªè”åˆå˜é‡å†…, è€Œæ˜¯æŒ‡è¯¥è”åˆå˜é‡å¯è¢«èµ‹äºˆä»»ä¸€æˆå‘˜å€¼,ä½†æ¯æ¬¡åªèƒ½èµ‹ä¸€ç§å€¼, èµ‹å…¥æ–°å€¼åˆ™å†²å»æ—§å€¼ã€‚\nä¸€ä¸ªè”åˆä½“ç±»å‹å¿…é¡»ç»è¿‡å®šä¹‰ä¹‹å, æ‰èƒ½ä½¿ç”¨å®ƒï¼Œæ‰èƒ½æŠŠä¸€ä¸ªå˜é‡å£°æ˜å®šä¹‰ä¸ºè¯¥è”åˆä½“ç±»å‹ã€‚\nè”åˆä½“ä¸ä»…å¯ä»¥èŠ‚çœå†…å­˜ç©ºé—´ï¼Œæœ€æœ¬è´¨ã€é‡è¦çš„ç”¨æ³•æ˜¯å¯¹åŒä¸€æ®µç©ºé—´é‡‡å–ä¸åŒçš„ç±»å‹æ ¼å¼å»è¯†åˆ«ã€è¯»å–æ•°æ®ã€‚\n\n![image-20210817164050152](../../images/C%E8%AF%AD%E8%A8%80_%E7%BB%93%E6%9E%84%E4%BD%93/image-20210817164050152.png)\n\n```c\nunion Node\n{\n    short sx;\n    char cx[2];\n};\nint main()\n{\n    union Node x;\n    x.sx = 0x6162;//0x62,0x61\n    printf(\"%c %c \\n\",x.cx[0],x.cx[1]);//b a è€Œéa b \n    \n    x.cx[0]=1;\n    x.cx[1]=2;\n    printf(\"%d \\n\",x.sx); //0x01,0x02=>0x0201\n    return 0;\n}\n```\n\n![image-20210817162154866](../../images/Cè¯­è¨€_ç»“æ„ä½“/image-20210817162154866.png)\n## å£°æ˜å’Œå®šä¹‰æ—¶çš„æ³¨æ„\n\nè®¾è®¡æœ‰åçš„è”åˆä½“ï¼ŒåŒæ—¶æ²¡æœ‰å®šä¹‰å˜é‡ã€‚\n\n```c\nunion UnData\n{\n    short st;\n    char cs[2];\n};\nunion UnData x;\n```\n\nè®¾è®¡æœ‰åçš„è”åˆä½“ï¼ŒåŒæ—¶å®šä¹‰å˜é‡ã€‚ä¸ä¸Šè¿°ä»£ç ç­‰æ•ˆï¼ŒèŠ‚çœäº†ä¸€è¡Œä»£ç ã€‚\n\n```c\nunion UnData\n{\n    short st;\n    char cs[2];\n}x;\n```\n\nè®¾è®¡æ— åçš„è”åˆä½“ï¼ŒåŒæ—¶å®šä¹‰å˜é‡ã€‚è¿™æ ·æ˜¯å¯è¡Œçš„ã€‚\n\n```c\nunion\n{\n    short st;\n    char cs[2];\n}x;\n```\n\nä½†è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚ä¸‹åšæ³•ç¼–è¯‘å™¨æ˜¯ä¸è®¤ä¸ºx,yå±äºåŒä¸€ç§ç±»å‹çš„è”åˆä½“çš„ã€‚\n\n```c\nunion\n{\n    short st;\n    char cs[2];\n}x;\nunion\n{\n    short st;\n    char cs[2];\n}y;\nint main()\n{\n    x = y;//ä¸å¯ç¼–è¯‘é€šè¿‡ã€‚ç¼–è¯‘å™¨ä¸è®¤ä¸ºx,yå±äºåŒä¸€ç§ç±»å‹çš„è”åˆä½“ã€‚\n}\n```\n\nå½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨`typedef`å…³é”®å­—æŠŠæ— åçš„è”åˆä½“å®šä¹‰å‡ºçš„å˜é‡åèµ‹äºˆå…¶ç±»å‹çš„æ€§è´¨ã€‚\n\n```c\ntypedef union\n{\n    short sx;\n    char cx[2];\n}x;\n```\n\n## é‡è¦çš„é¢è¯•ç¬”è¯•é¢˜ç›®\n\nIPåœ°å€æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸²32ä½äºŒè¿›åˆ¶ä»£ç ï¼ˆå¯¹äºipv4æ˜¯32ä½ï¼Œipv6æ˜¯128ä½ï¼‰ï¼Œå¯çœ‹ä½œæ— ç¬¦å·intæ•°ã€‚é¢˜ç›®è¦æ±‚æŠŠ32ä½äºŒè¿›åˆ¶ä»£ç çš„æ¯å…«ä½è½¬æ¢ä¸ºä¸€ä¸ªæ— ç¬¦å·åè¿›åˆ¶æ•°ï¼Œå¹¶ç”¨â€œç‚¹â€éš”å¼€ï¼Œæœ€ç»ˆè½¬ä¸ºå­—ç¬¦ä¸²ã€‚åŒæ—¶ä¹Ÿè¦æ±‚æŠŠè¯¥æ ¼å¼çš„å­—ç¬¦ä¸²èƒ½é€†è½¬æ¢ä¸º32ä½äºŒè¿›åˆ¶ä»£ç æ„æˆçš„æ— ç¬¦å·intæ•°ã€‚\n\n![image-20210817114120334](../../images/C%E8%AF%AD%E8%A8%80_%E7%BB%93%E6%9E%84%E4%BD%93/image-20210817114120334.png)\n\n### è¦è¿ç”¨åˆ°çš„è¾“å…¥/è¾“å‡ºå‡½æ•°\n\n```c\nchar buff[20];\nint a = 10,b = 20;\n\nprintf();//æ‰“å°åˆ°å±å¹•ä¸Š\nint len = printf(\"a = %d b = %d \\n\",a,b);//å°†æ ¼å¼åŒ–å­—ç¬¦ä¸²å†™å…¥åˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡ä¸­\n\nsprintf(buff,\"%d.%d.%d.%d\",x.s4,x.s3,x.s2,x.s1);//å°†æ ¼å¼åŒ–å­—ç¬¦ä¸²å†™å…¥åˆ°buffä¸­\nint sprintf(char* buff,const char* fmt, ...);//è¿”å›çš„å€¼ï¼šæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¢æµ‹åˆ°'\\0'æ—¶ï¼Œè¿”å›æœ‰æ•ˆå­—ç¬¦çš„é•¿åº¦\nint len = sprintf(buff,\"a = %d b = %d \\n\",a,b);\n\nfprintf(stdout,\"a = %d b = %d \\n\",a,b);//å°†æ ¼å¼åŒ–å­—ç¬¦ä¸²å†™å…¥åˆ°æ–‡ä»¶æŒ‡é’ˆå¯¹åº”çš„ä½ç½®ã€‚å¦‚æœè¯¥æ–‡ä»¶æ˜¯æ ‡å‡†è¾“å‡ºè®¾å¤‡åˆ™æ˜¯æ‰“å°åˆ°å±å¹•ä¸Šã€‚\n\n//ç”±æ­¤å¯çŸ¥ï¼Œprintf()å®é™…ä¸Šå†…éƒ¨è°ƒç”¨äº†fprintf()ï¼Œæ–‡ä»¶æŒ‡é’ˆä¸ºstdoutï¼›è€Œfprintf()å®é™…ä¸Šå†…éƒ¨è°ƒç”¨äº†sprintf()ï¼ŒbuffæŒ‡é’ˆæŒ‡å‘æ–‡ä»¶æŒ‡é’ˆã€‚å³sprintfæ‰æ˜¯æ ¹æœ¬æ‰€åœ¨ã€‚\n```\n\n```c\nscanf();//ä»æ ‡å‡†è¾“å…¥è®¾å¤‡stdinä¸­è¾“å…¥çš„æ•°æ®è¯»å–å€¼ã€‚\n\nsscanf(char* buff,\"%...\", &...);//ä»buffï¼ˆå­—ç¬¦ä¸²ï¼‰ä¸­è¯»å€¼ã€‚æŒ‰æ ¼å¼åŒ–æ§åˆ¶å°†%...å¯¹åº”çš„å€¼å†™åˆ°&...ä¸­\n\n\nint main()\n{\n    int a,b;\n    int sum = scanf(\"%d %d\",&a,&b);//scanfè¿”å›æ­£ç¡®è¯»å–åˆ°çš„å€¼çš„ä¸ªæ•°ï¼Œæ­¤å¤„è‹¥æ­£ç¡®è¾“å…¥åˆ™è¿”å›2ã€‚è‹¥è¾“å…¥\"12,23\"åˆ™åªèƒ½æ­£ç¡®è¯»å–ä¸€ä¸ªå€¼\n    //å¦‚æœè¾“å…¥æ—¶ä¸¤æ•°ä¸­é—´åˆ†å¼€çš„ä¸æ˜¯ç©ºæ ¼ï¼Œåˆ™æ— æ³•æ­£å¸¸è¾“å…¥ã€‚å› æ­¤æ­¤å¤„å°±ä½“ç°äº†scanfçš„â€œæ ¼å¼æ§åˆ¶â€ï¼Œé‚£ä¹ˆåŒæ ·çš„ï¼Œæˆ‘ä»¬è‹¥æƒ³è¦ç”¨æˆ·ç”¨.æ¥éš”å¼€æ•°æ®ï¼Œåˆ™å¯ä»¥é€šè¿‡é™åˆ¶æ ¼å¼æ¥è¾¾åˆ°æ§åˆ¶æ•ˆæœã€‚\n    \n    char buff[]={\"12,23,34,45\"};\n    unsigned int s[4];\n    //sum = sscanf(buff,\"%d.%d.%d.%d\",&s[0],&s[1],&s[2],&s[3]);\n    //ä¸ºäº†èƒ½æ£€æµ‹åˆ°ç”¨æˆ·å¤šè¾“å…¥äº†å­—ç¬¦ï¼Œåˆ™æˆ‘ä»¬åœ¨æ ¼å¼åŒ–æ§åˆ¶ä¸­å¤šåŠ ä¸€ä¸ªå“¨å…µä½æ£€æµ‹æ˜¯å¦å¤šè¾“å…¥äº†å€¼ã€‚\n\tchar ch;\n    sum = sscanf(buff,\"%d.%d.%d.%d%c\",&s[0],&s[1],&s[2],&s[3],&ch);\n    //ä¸€æ—¦ç”¨æˆ·å¤šè¾“å…¥äº†å­—ç¬¦å¦‚'.'ï¼Œåˆ™sumå°†å¤§äº4ï¼Œåˆ™å¯ä»¥æ¡ä»¶åˆ¤æ–­æ„å¤–æƒ…å†µã€‚\n    printf(\"%d \\n\",num);//4ä¸ºæ­£å¸¸ï¼Œ5ä¸ºå¤šè¾“å…¥äº†å­—ç¬¦-æ„å¤–æƒ…å†µ\n}\n```\n\n### ä»£ç ç¼–å†™\n\n```c\nunion IPNode\n{\n    unsigned int addr;\n    struct //æ²¡æœ‰åå­—ï¼Œç§°ä¸ºå“‘å…ƒç»“æ„ï¼ˆdummyï¼‰ï¼Œå¯¹åº”äºå®å…ƒã€‚\n    {\n        unsigned char s1,s2,s3,s4;//æˆ–è€…å£°æ˜ä¸€ä¸ªæ•°ç»„ä¹Ÿå¯ä»¥ã€‚unsigned char s[4];\n    };\n    //unsigned char s1,s2,s3,s4;ä¸èƒ½ç®€å•åœ°å†™æˆè¿™æ ·ï¼Œå› ä¸ºè¿™æ ·å†™çš„ç»“æœæ˜¯ï¼šå››ä¸ªå˜é‡éƒ½åªå…±äº«ç¬¬ä¸€ä¸ªå­—èŠ‚ã€‚\n};\nvoid int_to_str(unsigned int ip,char* buff)\n{\n    assert(buff!=nullptr);\n    union IPNode x;\n    x.addr = ip;\n    sprintf_s(buff,20,\"%d.%d.%d.%d\",x.s4,x.s3,x.s2,x.s1);\n}\nint main()\n{\n    unsigned int ip = 2394117684;\n    char buff[20]={};\n    int_to_str(ip,buff);\n    return 0;\n}\n```\n\n```c\nunsigned int str_to_int(const char* buff)\n{\n    unsigned int ip=0;\n    if(buff==NULL)return ip;\n    \n    union IPNode x;\n    \n    unsigned int s[4]={};\n    char ch=0;\n    int sum=sscanf_s(buff,\"%d.%d.%d.%d%c\",&s[3],&s[2],&s[1],&s[0],&ch);\n    if(num>4)return ip;\n    for(int i=3;i>=0;--i)\n    {\n        if(s[i]>255)return ip;\n        x.s[i]=s[i];\n    }\n    ip=x.addr;\n    return ip;\n}\nint main()\n{\n    unsigned int ip = 2394117684;\n    char buff[20];\n    printf(\"%u \\n\",ip);\n    \n    int_to_str(ip,buff);\n    printf(\"%s \\n\",buff);\n    \n    unsigned ipx = str_to_int(buff);\n    printf(\"%u \\n\",ipx);\n}\n```\n\n# ä½œä¸š\n\n1. ç»™ç»“æ„ä½“å˜é‡èµ‹å€¼å’Œè¾“å‡ºç»“æ„ä½“å˜é‡çš„å€¼ã€‚æƒ³å°½åŠæ³•åšåˆå§‹åŒ–ã€‚\n\n   ![image-20210815114633078](../../images/C%E8%AF%AD%E8%A8%80_%E7%BB%93%E6%9E%84%E4%BD%93/image-20210815114633078.png)\n\n","categories":["C"]},{"title":"Cè¯­è¨€_é€’å½’","url":"/C/Cè¯­è¨€_é€’å½’/","content":"# é€’å½’å†…å®¹\n\n1. æ ˆå¸§çš„ç†è§£\n2. åˆ†æ²»ç­–ç•¥å’Œé€’å½’\n\n# å¤ä¹ å‡½æ•°\n\n## ç¼–è¯‘é“¾æ¥å’Œå†…å­˜å¸ƒå±€\n\n![image-20210814025249988](../../images/C%E8%AF%AD%E8%A8%80_%E9%80%92%E5%BD%92/image-20210814025249988.png)\n\nã€€ã€€æ ¹æ®ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œä¸€ä¸ªè¿›ç¨‹å¯èƒ½è¢«åˆ†é…åˆ°ä¸åŒçš„å†…å­˜åŒºåŸŸå»æ‰§è¡Œã€‚ä½†æ˜¯ä¸ç®¡ä»€ä¹ˆæ ·çš„æ“ä½œç³»ç»Ÿã€ä»€ä¹ˆæ ·çš„è®¡ç®—æœºæ¶æ„ï¼Œè¿›ç¨‹ä½¿ç”¨çš„å†…å­˜éƒ½å¯ä»¥æŒ‰ç…§åŠŸèƒ½å¤§è‡´åˆ†ä¸ºä»¥ä¸‹4ä¸ªéƒ¨åˆ†ï¼š\n1) ä»£ç åŒºï¼šè¿™ä¸ªåŒºåŸŸå­˜å‚¨ç€è¢«è£…å…¥æ‰§è¡Œçš„äºŒè¿›åˆ¶æœºå™¨ä»£ç ï¼Œå¤„ç†å™¨(CPU)ä¼šåˆ°è¿™ä¸ªåŒºåŸŸå–æŒ‡å¹¶æ‰§è¡Œã€‚\n2) æ•°æ®åŒºï¼šç”¨äºå­˜å‚¨å…¨å±€å˜é‡, é™æ€å…¨å±€å˜é‡ï¼Œé™æ€å±€éƒ¨å˜é‡ï¼Œå­—ç¬¦ä¸²å¸¸é‡ç­‰ã€‚\n3) å †åŒºï¼šè¿›ç¨‹å¯ä»¥åœ¨å †åŒºåŠ¨æ€åœ°è¯·æ±‚ä¸€å®šå¤§å°çš„å†…å­˜ï¼Œå¹¶åœ¨ç”¨å®Œä¹‹åå½’è¿˜ç»™å †åŒºã€‚åŠ¨æ€åˆ†é…å’Œå›æ”¶æ˜¯å †åŒºçš„ç‰¹ç‚¹ã€‚\n4) æ ˆåŒºï¼šå‡½æ•°è¢«è°ƒæ—¶åˆ†é…æ ˆåŒºï¼Œç”¨äºå­˜æ”¾å‡½æ•°çš„å‚æ•°å€¼ï¼Œå±€éƒ¨å˜é‡ç­‰å€¼ï¼›è¿˜è¦åŠ¨æ€åœ°å­˜å‚¨å‡½æ•°ä¹‹é—´çš„å…³ç³»ï¼Œä»¥ä¿è¯è¢«è°ƒç”¨å‡½æ•°åœ¨è¿”å›æ—¶æ¢å¤åˆ°è¢«è°ƒç”¨å‡½æ•°ä¸­ç»§ç»­æ‰§è¡Œã€‚\n\n## å‡½æ•°è°ƒç”¨æœºåˆ¶\n\nå±€éƒ¨å˜é‡å ç”¨çš„å†…å­˜æ˜¯åœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­â€œåŠ¨æ€â€åœ°å»ºç«‹å’Œé‡Šæ”¾çš„ã€‚è¿™ç§â€œåŠ¨æ€â€æ˜¯é€šè¿‡æ ˆç”±ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†è¿›è¡Œçš„ã€‚å½“ä»»ä½•ä¸€ä¸ªå‡½æ•°è°ƒç”¨å‘ç”Ÿæ—¶ï¼Œç³»ç»Ÿéƒ½è¦ä½œä»¥ä¸‹å·¥ä½œï¼š\n1) å»ºç«‹æ ˆå¸§ç©ºé—´ï¼›\n2) ä¿æŠ¤ç°åœºï¼šä¸»è°ƒå‡½æ•°è¿è¡ŒçŠ¶æ€å’Œè¿”å›åœ°å€å…¥æ ˆï¼›\n3) ä¸ºè¢«è°ƒå‡½æ•°ä¼ é€’æ•°æ®ï¼ˆè¿›è¡Œå®å‚å’Œå½¢å‚çš„ç»“åˆï¼‰ï¼ŒåŒæ—¶å½¢å‚è·å¾—å­˜å‚¨ç©ºé—´ï¼›æ¥ç€ç»™å±€éƒ¨å˜é‡åˆ†é…ç©ºé—´ï¼›\n4) æ‰§è¡Œè¢«è°ƒå‡½æ•°å‡½æ•°ä½“ï¼›\n5) å½“è¢«è°ƒå‡½æ•°æ‰§è¡Œå®Œæˆï¼Œé‡Šæ”¾è¢«è°ƒå‡½æ•°ä¸­å±€éƒ¨å˜é‡å ç”¨çš„æ ˆç©ºé—´ï¼›\n6) æ¢å¤ç°åœºï¼šå–ä¸»è°ƒå‡½æ•°è¿è¡ŒçŠ¶æ€åŠè¿”å›åœ°å€ï¼Œé‡Šæ”¾æ ˆå¸§ç©ºé—´ï¼›\n7) ç»§ç»­ä¸»è°ƒå‡½æ•°åç»­è¯­å¥ã€‚\n\n![image-20210814025448484](../../images/C%E8%AF%AD%E8%A8%80_%E9%80%92%E5%BD%92/image-20210814025448484.png)\n\nåœ¨è¿›å…¥mainå‡½æ•°æ—¶ï¼Œåªåˆ›å»ºäº†mainå‡½æ•°çš„æ ˆå¸§ï¼Œåœ¨è°ƒç”¨Addå‡½æ•°æ—¶æ‰ä¼šå»ºç«‹Addå‡½æ•°çš„æ ˆå¸§ï¼Œå½“Addå‡½æ•°returnæ—¶ï¼Œæ ˆå¸§æ”¶å›ã€‚\n\n### æœ‰å¯å‘çš„ä»£ç \n\n```c\nint* fun()\n{\n    int ar[10]={12,23,34,45,56,67,78,89,90,100};\n    return ar;\n}\nint main()\n{\n    int* p = fun();\n    for(int i = 0;i<10;++i)\n    {\n        printf(\"%d \",p[i]);\n    }\n    printf(\"\\n\");\n    return 0;\n}\n```\n\narå¤§å°ä¸º10æ—¶ï¼Œfunå‡½æ•°è°ƒç”¨æ—¶è¿˜æ­£å¸¸å­˜åœ¨ç€aræ•°ç»„çš„ä¿¡æ¯ï¼Œè€Œfunå‡½æ•°è°ƒç”¨å®Œåï¼Œå†å¾ªç¯è°ƒç”¨printfå‡½æ•°ï¼Œè‡´ä½¿å†²æ‰äº†ä»¥å‰æ ˆå¸§çš„ä¿¡æ¯ï¼Œå¯¼è‡´è¾“å‡ºé”™è¯¯ã€‚\n\n![image-20210814032349532](../../images/C%E8%AF%AD%E8%A8%80_%E9%80%92%E5%BD%92/image-20210814032349532.png)\n\nè€ŒæŠŠfunå‡½æ•°ä¸­çš„arå¤§å°æ”¹ä¸º1000æ—¶ï¼Œè¿è¡Œç»“æœå°±ä¸ä¸€æ ·äº†ï¼Œè¾“å‡ºçš„æ˜¯æ­£å¸¸çš„ã€‚\n\n![image-20210814032439500](../../images/C%E8%AF%AD%E8%A8%80_%E9%80%92%E5%BD%92/image-20210814032439500.png)\n\nå› ä¸ºï¼Œarå ç”¨çš„æ ˆå¸§å¾ˆå¤šï¼Œprintfå‡½æ•°æœªèƒ½å†²åˆ·åˆ°ä¹‹å‰arçš„åŸæœ‰æ•°æ®ã€‚ä½†æ˜¯æœ¬è´¨ä¸Šarçš„ä¿¡æ¯è¿˜æ˜¯å¤±æ•ˆäº†çš„ã€‚æ‡‚äº†è¿™ä¸ªä¾‹å­ï¼Œä¼šå¯¹å‡½æ•°è°ƒç”¨ä¸æ ˆå¸§åˆ†é…çš„å…³ç³»æ·±å…¥ç†è§£ã€‚\n\n# åˆ†æ²»ç­–ç•¥ä¸é€’å½’\n\nã€€ã€€åˆ†æ²»ç­–ç•¥ï¼šæ˜¯å°†è§„æ¨¡æ¯”è¾ƒå¤§çš„é—®é¢˜å¯åˆ†å‰²æˆè§„æ¨¡è¾ƒå°çš„ç›¸åŒé—®é¢˜ã€‚**é—®é¢˜ä¸å˜ï¼Œè§„æ¨¡å˜å°**ã€‚è¿™è‡ªç„¶å¯¼è‡´é€’å½’è¿‡ç¨‹çš„äº§ç”Ÿã€‚åˆ†æ²»ä¸é€’å½’åƒä¸€å¯¹å­ªç”Ÿå…„å¼Ÿï¼Œç»å¸¸åŒæ—¶åº”ç”¨åœ¨ç®—æ³•è®¾è®¡ä¹‹ä¸­ï¼Œå¹¶ç”±æ­¤äº§ç”Ÿè®¸å¤šé«˜æ•ˆç®—æ³•ã€‚\n\n## åˆ†æ²»æ³•æ­¥éª¤\n\nåœ¨åˆ†æ²»ç­–ç•¥ä¸­é€’å½’åœ°æ±‚è§£ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨æ¯å±‚é€’å½’ä¸­åº”ç”¨å¦‚ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š\n\n1. åˆ†è§£ï¼šå°†é—®é¢˜åˆ’åˆ†æˆä¸€äº›å­é—®é¢˜ï¼Œ**å­é—®é¢˜çš„å½¢å¼ä¸åŸé—®é¢˜ä¸€æ ·ï¼Œåªæ˜¯è§„æ¨¡æ›´å°**ã€‚\n2. è§£å†³ï¼šé€’å½’åœ°æ±‚è§£å­é—®é¢˜ã€‚**å¦‚æœå­é—®é¢˜çš„è§„æ¨¡è¶³å¤Ÿå°ï¼Œåˆ™åœæ­¢é€’å½’ï¼Œç›´æ¥æ±‚è§£**ã€‚\n3. åˆå¹¶ï¼šå°†å°è§„æ¨¡çš„è§£ç»„åˆæˆåŸè§„æ¨¡é—®é¢˜çš„è§£ã€‚\n\nã€€ã€€é€’å½’å‡½æ•°çš„æ‰§è¡Œåˆ†ä¸ºâ€œé€’æ¨â€å’Œâ€œå›å½’â€ä¸¤ä¸ªè¿‡ç¨‹ï¼Œè¿™ä¸¤ä¸ªè¿‡ç¨‹ç”±é€’å½’ç»ˆæ­¢æ¡ä»¶æ§åˆ¶ï¼Œå³é€å±‚é€’æ¨ï¼Œç›´è‡³é€’å½’ç»ˆæ­¢æ¡ä»¶æ»¡è¶³ï¼Œç»ˆæ­¢é€’å½’ï¼Œç„¶åé€å±‚å›å½’ã€‚\nã€€ã€€é€’å½’è°ƒç”¨åŒæ™®é€šçš„å‡½æ•°è°ƒç”¨ä¸€æ ·ï¼Œæ¯å½“è°ƒç”¨å‘ç”Ÿæ—¶ï¼Œå°±è¦åˆ†é…æ–°çš„æ ˆå¸§ï¼ˆå½¢å‚æ•°æ®ï¼Œç°åœºä¿æŠ¤ï¼Œå±€éƒ¨å˜é‡ï¼‰ï¼›è€Œä¸æ™®é€šçš„å‡½æ•°è°ƒç”¨ä¸åŒçš„æ˜¯ï¼Œç”±äºé€’æ¨çš„è¿‡ç¨‹æ˜¯ä¸€ä¸ªé€å±‚è°ƒç”¨çš„è¿‡ç¨‹ï¼Œå› æ­¤å­˜åœ¨ä¸€ä¸ªé€å±‚è¿ç»­çš„åˆ†é…æ ˆå¸§è¿‡ç¨‹ï¼Œç›´è‡³é‡åˆ°é€’å½’ç»ˆæ­¢æ¡ä»¶æ—¶ï¼Œæ‰å¼€å§‹å›å½’ï¼Œè¿™æ—¶æ‰é€å±‚é‡Šæ”¾æ ˆå¸§ç©ºé—´ï¼Œè¿”å›åˆ°ä¸Šä¸€å±‚ï¼Œç›´è‡³æœ€åè¿”å›åˆ°ä¸»è°ƒå‡½æ•°ã€‚\n\n## ç»å…¸é¢˜ç›®\n\næˆ‘ä»¬å¯¹äºé€’å½’è¦è¾¾åˆ°çš„åˆçº§æ°´å¹³æ˜¯ï¼šå¯ä»¥æŠŠå¾ªç¯ç¨‹åºæ”¹ä¸ºé€’å½’ç¨‹åºã€‚\n\næœ€ç»ˆçš„ç›®æ ‡æ˜¯ï¼šåœ¨é€’å½’çš„æ´»åŠ¨ä¸­ï¼Œç›´æ¥èƒ½æ•è·åˆ°æŸä¸€æ­¥çš„è¿è¡Œæƒ…å†µã€‚\n\n### æ±‚è§£é˜¶ä¹˜\n![image-20210814032743926](../../images/Cè¯­è¨€_é€’å½’/image-20210814032743926.png)\n```\nn! = (n-1)!\\*n\n(n-1)! = (n-2)!\\*n-1\n(n-2)! = (n-3)!\\*n-1\n...\n2! = 1! \\* 2\n1! = 1\n```\né˜¶ä¹˜å¯é€’å½’çš„å®šä¹‰ä¸ºï¼š\n![image-20210814033732211](../../images/Cè¯­è¨€_é€’å½’/image-20210814033732211.png)\n\nå¯ä»¥çœ‹å‡ºæ˜¯ç”¨é˜¶ä¹˜å®šä¹‰é˜¶ä¹˜ï¼Œè¿™ç§æ‹¿è‡ªå·±å®šä¹‰è‡ªå·±çš„æ–¹æ³•ç§°ä¸ºé€’å½’å®šä¹‰ã€‚\n\nåœ¨å†™å‡ºé€’å½’ç¨‹åºå‰ï¼Œæˆ‘ä»¬å…ˆæ‹¿å¾ªç¯ç¨‹åºè§£å†³ä¸€ä¸‹ã€‚\n\n```c\n//ä¸è€ƒè™‘æ•´å‹æº¢å‡º\nint factorial(int n)\n{\n    int sum=1;\n    for(int i=1;i<=n;++i)\n    {\n        sum=sum*i;\n    }\n    return sum;\n}\n```\n\né€’å½’çš„å†™æ³•ï¼š\n\n```c\nint factorial_recursion(int n)//factorial:é˜¶ä¹˜ recursion:é€’å½’\n{\n    if(n<=1)\n    {\n        return 1;\n    }\n    else//n>1\n    {\n        return factorial_recursion(n-1)*n;\n    }\n}\n```\n\nå¯ä»¥æŠŠä¸€åˆ‡çš„å¾ªç¯æ”¹ä¸ºé€’å½’ï¼Œä¹Ÿå¯æŠŠä¸€åˆ‡çš„é€’å½’æ”¹ä¸ºå¾ªç¯ï¼Œä¸¤è€…æœ¬è´¨ä¸Šå¯ä»¥ç›¸é€šã€‚\n\n### æ•´æ•°å€’åºè¾“å‡º\n\nè¾“å…¥ä¸€ä¸ªæ•´æ•°ï¼ˆæ— ç¬¦å·æ•´å‹ï¼‰ï¼Œç”¨é€’å½’ç®—æ³•å°†æ•´æ•°å€’åºè¾“å‡ºã€‚\n\nå¾ªç¯æ³•\n\n```c\nvoid reverse_print(unsigned int n)\n{\n    while(n!=0)\n    {\n        printf(\"%d \",n%10);//1234%10=4 ...\n        n=n/10;\n    }\n}\n```\n\né€’å½’æ³•\n\n```c\nvoid reverse_print(unsigned int n)\n{\n    if(n!=0)\n    {\n        printf(\"%d \",n%10);\n        reverse_print(n/10);\n    }\n}\n```\n\nä¸Šè¿°é€’å½’ä»£ç æ˜¯æ­£ç¡®çš„ï¼Œå³è¾“å‡ºäº†\"4 3 2 1 \"ã€‚è€Œå¦‚æœè°ƒç”¨å‡½æ•°å’Œæ‰“å°é¡ºåºé¢ å€’ï¼Œåˆ™ç»“æœä¼šå®Œå…¨ä¸ä¸€æ ·ã€‚åˆ†æä»£ç ç»“æ„ï¼Œæ‰“å°å‡½æ•°æ˜¯åœ¨è°ƒç”¨reverse_printä¹‹å‰çš„ï¼Œå°±æ˜¯è¯´æˆ‘ä»¬æ˜¯åœ¨é€’æ¨çš„åŒæ—¶æ‰“å°æ¨¡10ç»“æœçš„ï¼Œè€Œå›å½’æ—¶reverse_printå‡½æ•°åé¢æ²¡æœ‰è¯­å¥ï¼Œå› æ­¤æ²¡æœ‰å…¶ä»–çš„æ“ä½œã€‚\n\n```c\nvoid fun(unsigned int n)\n{\n    if(n!=0)\n    {\n        fun(n/10);\n        printf(\"%d \",n%10);\n    }\n}\n```\n\nä¸Šè¿°ä»£ç ä¸ºå…ˆé€’å½’åˆ‡å‰²ï¼ˆæ¯æ¬¡éƒ½é™¤10ï¼‰ï¼Œæœ€ååˆ™ä»1%10å¼€å§‹æ‰“å°åˆ°1234%10ï¼Œå³\"1 2 3 4 \"ã€‚åˆ†æé€’å½’æ—¶ï¼Œä¸€å®šè¦æ˜ç¡®å„å±‚å‡½æ•°åœ¨æ ˆåŒºä¸­çš„ç»“æ„å’Œæ„ä¹‰ã€‚é‚£ä¹ˆæˆ‘ä»¬åˆ†æï¼Œç”±äºæ‰“å°å‡½æ•°åœ¨funå‡½æ•°ä¹‹åï¼Œæ‰€ä»¥è¿™ä¸ªç¨‹åºåœ¨ä»1234é€’æ¨åˆ°1çš„è¿‡ç¨‹ä¸­æ²¡æœ‰æ‰“å°ï¼Œè€Œæ˜¯åœ¨é€’æ¨å®Œæ¯•å›å½’æ—¶æ‰æ‰“å°ï¼ˆå³æ‰§è¡Œfunå‡½æ•°ä¹‹åçš„è¯­å¥ï¼‰ã€‚\n\n### æ‰“å°æ— åºæ•°ç»„\n\næœ‰ä¸€ä¸ªæ•´å‹æ•°ç»„ï¼Œæ•°å€¼æ— åºï¼Œä½¿ç”¨å¾ªç¯å’Œé€’å½’å®Œæˆæ‰“å°å’ŒæŸ¥è¯¢ã€‚\n\nå¾ªç¯æ–¹æ³•ï¼š\n\n```c\nvoid Print_Ar(const int* ar, int n)\n{\n    assert(ar!=NULL);\n    for(int i=0;i<n;++i)\n    {\n        printf(\"%d \",ar[i]);\n    }\n    printf(\"\\n\");\n}\nint main()\n{\n    int ar[]={12,23,34};\n    int n = sizeof(ar)/size(ar[0]);\n    Print_Ar(ar,n);\n}\n```\n\né€’å½’æ–¹æ³•ï¼š\n\n```c\nvoid Print_recursion(const int* ar, int n)\n{\n    if(n>0)\n    {\n        Print_recursion(ar,n-1);//n-1ä»£è¡¨æ‰“å°å‰n-1ä¸ªå…ƒç´ \n    \tprintf(\"%d \",ar[n-1]);//n-1ä»£è¡¨æ­¤æ—¶çš„ç¬¬nä¸‹æ ‡å€¼\n    }\n}\nvoid Print_Ar(const int* ar, int n)\n{\n    assert(ar!=NULL);\n    Print_recursion(ar, n)ï¼›\n    printf(\"\\n\");\n}\nint main()\n{\n    int ar[]={12,23,34};\n    int n = sizeof(ar)/size(ar[0]);\n    Print_Ar(ar,n);\n}\n```\n\n#### æ€è€ƒ1\n\nå¦‚æœæŠŠé€’å½’å‡½æ•°ä½“ä¸­çš„`Print_recursion(ar,n-1);`ä¸­çš„`\"n-1\"`æ”¹ä¸º`\"n--\"`ä¼šå‘ç”Ÿä»€ä¹ˆç°è±¡ï¼Ÿ\n\n```c\nvoid Print_recursion(const int* ar, int n)\n{\n    if(n>0)\n    {\n        Print_recursion(ar,n--);//n-1ä»£è¡¨æ‰“å°å‰n-1ä¸ªå…ƒç´ \n    \tprintf(\"%d \",ar[n-1]);//n-1ä»£è¡¨æ­¤æ—¶çš„ç¬¬nä¸‹æ ‡å€¼\n    }\n}\nvoid Print_Ar(const int* ar, int n)\n{\n    assert(ar!=NULL);\n    Print_recursion(ar, n);\n    printf(\"\\n\");\n}\nint main()\n{\n    int ar[]={12,23,34};\n    int n = sizeof(ar)/size(ar[0]);\n    Print_Ar(ar,n);\n}\n```\n\nç­”æ¡ˆæ˜¯è¿è¡Œæ—¶å†…å­˜æº¢å‡ºäº†ã€‚å› ä¸º`n--`æ˜¯åç½®`--`ï¼Œå…ˆå–å€¼è¿è¡Œå‡½æ•°ï¼Œå‡½æ•°è°ƒç”¨å®Œæ‰å›å†™å‡ä¸€åçš„ç»“æœã€‚å¼€å§‹æ—¶næ˜¯3ï¼Œå‡½æ•°è°ƒç”¨æ—¶ä¼ çš„å€¼æ°¸è¿œéƒ½æ˜¯2ã€‚\n#### æ€è€ƒ2\n\nå¦‚æœæŠŠé€’å½’å‡½æ•°ä½“ä¸­çš„`Print_recursion(ar,n--);`ä¸­çš„`\"n--\"`æ”¹ä¸º`\"--n\"`ä¼šå‘ç”Ÿä»€ä¹ˆç°è±¡ï¼Ÿ\n\nç­”æ¡ˆæ˜¯`\"éšæœºå€¼ 12 23 \"`ã€‚å› ä¸º`--n`æ˜¯å‰ç½®`--`ï¼Œåœ¨è¿è¡Œå‡½æ•°å‰å°±æŠŠ`n-1`å¹¶å›å†™äº†ï¼Œè¿™å¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼Œå‡½æ•°è°ƒç”¨æ—¶ï¼Œnå·²ç»å‡äº†1ï¼Œé‚£ä¹ˆæ‰“å°`ar[n-1]`åˆä¼šå‡1ï¼Œåˆ™ä¼šå¯¼è‡´`n=1`æ—¶è°ƒç”¨`Print_recursion(ar, n);`æ—¶æ»¡è¶³æ¡ä»¶æ‰§è¡Œè¯­å¥`--n`ï¼Œæ­¤æ—¶nå˜0ï¼Œæ¥ä¸‹æ¥æ‰“å°`ar[n-1]`å³`ar[-1]`ï¼Œå°±äº§ç”Ÿäº†è¶Šç•Œã€‚\n### æŸ¥è¯¢æ— åºæ•°ç»„æŸå€¼çš„ä¸‹æ ‡\n\n```c\nint FindValueIndex(const int* ar, int n, int val)\n{\n\tint pos = -1;\n\tif (n > 0)\n\t{\n\t\tif (ar[n - 1] == val)\n\t\t{\n\t\t\tpos = n - 1;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpos = FindValueIndex(ar, n - 1, val);\n\t\t}\n\t}\n\treturn pos;\n}\nint findValue(const int*ar, int n,int val)\n{\n    if(ar==NULL) return -1;\n    return FindValueIndex(ar, n, val);\n}\n```\n\nè€å¸ˆçš„å†™æ³•ï¼š\n\n```c\nint FindValueIndex(const int* ar, int n, int val)\n{\n\tif (n < 1 || ar[n-1] == val)\n\t{\n\t\treturn n-1;\n\t}\n    else\n    {\n        return FindValueIndex(ar, n-1, val);\n    }\n}\nint findValue(const int*ar, int n,int val)\n{\n    if(ar==NULL) return -1;\n    return FindValueIndex(ar, n, val);\n}\n```\n\n### å…¨æ’åˆ—/å­é›†é—®é¢˜ï¼šæ ‘å½¢ç»“æ„(ç»„åˆæ ‘/å­é›†æ ‘)\n\nç°è¦æ±‚è¾“å‡ºé›†åˆ`{1,2,3}`çš„å…¨éƒ¨å­é›†ã€‚\n\n![image-20210815021627089](../../images/C%E8%AF%AD%E8%A8%80_%E9%80%92%E5%BD%92/image-20210815021627089.png)\n![image-20210816014510751](../../images/Cè¯­è¨€_é€’å½’/image-20210816014510751.png)\n\n```c\nvoid fun(int* ar,int* br,int i,int n)\n{\n    if(i==n)\n    {\n        for(int k=0;i<n;++k)\n        {\n            if(br[k]==1)\n            {\n                printf(\"%d \",ar[k]);\n            }\n        }\n        printf(\"\\n\");\n        \n    }\n    else\n    {\n        br[i]=1;\n        fun(i+1,n);\n        br[i]=0;\n        fun(i+1,n);\n    }\n}\nint main()\n{\n    const int n = 3;\n    int ar[]={1,2,3};\n    int br[]={0,0,0};\n    fun(ar,br,0,n);\n    return 0;\n}\n```\n\næ­¤ç±»é€’å½’ç¨‹åºçš„æ—¶é—´å¤æ‚åº¦ä¸º$O(2^n)$ï¼Œç©ºé—´å¤æ‚åº¦ä¸ºæ ‘çš„é«˜åº¦$S(n)$ã€‚\n\n## å›¾è§£é€’å½’è¿‡ç¨‹\n\n### ä»£ç çš„è°ƒåŠ¨è¿‡ç¨‹\n\n![image-20210814220256021](../../images/C%E8%AF%AD%E8%A8%80_%E9%80%92%E5%BD%92/image-20210814220256021.png)\n\n### æ ˆå¸§çš„åŠ¨æ€è°ƒåŠ¨è¿‡ç¨‹\n\n![image-20210814220321049](../../images/C%E8%AF%AD%E8%A8%80_%E9%80%92%E5%BD%92/image-20210814220321049.png)\n\n# æ€»ç»“\n\n## å…³äºåˆ†é…æ ˆå¸§\n\nå‡½æ•°è¢«è°ƒç”¨ï¼Œä¸ç®¡æ˜¯è‡ªå·±è°ƒç”¨è‡ªå·±ï¼Œè¿˜æ˜¯è¢«å…¶å®ƒå‡½æ•°è°ƒç”¨ï¼Œéƒ½å°†ä¼šç»™è¢«è°ƒç”¨å‡½æ•°åˆ†é…æ ˆå¸§ã€‚\n\n## å…³äºæ­»å¾ªç¯\n\nå­˜åœ¨æ­»å¾ªç¯ï¼Œä½†ä¸å­˜åœ¨æ— ç©·é€’å½’ã€‚å³é€’å½’å‡½æ•°å¿…é¡»è¦æœ‰ä¸€ä¸ªæ˜¯é€’å½’ç»“æŸçš„å‡ºå£ï¼ˆè¦æœ‰é€’å½’ä¸­æ­¢çš„æ¡ä»¶è¯­å¥ï¼‰ã€‚\n\n```c\nint factorial(int n)\n{\n    int sum=1;\n    for(int i=1; ;++i)//ä¸­é—´è¯­å¥ç¼ºçœï¼Œæ„å‘³ç€æ­»å¾ªç¯ã€‚\n    {\n        sum=sum*i;\n    }\n    return sum;\n}\n```\n\n```c\nint factorial_recursion(int n)//factorial:é˜¶ä¹˜ recursion:é€’å½’\n{\n    if(false)//è¾¾ä¸åˆ°åŸæ¥çš„å‡½æ•°å‡ºå£äº†\n    {\n        return 1;\n    }\n    else\n    {\n        return factorial_recursion(n-1)*n;\n    }\n}\n```\n\næ­»å¾ªç¯åªæ˜¯é‡å¤çš„åœ¨å¼€è¾Ÿçš„æŸä¸€ä¸ªç©ºé—´é‡Œåå¤è®¡ç®—èµ‹å€¼ï¼Œè¿‡ç¨‹éƒ½æ˜¯åœ¨ä¸€ä¸ªå†…å­˜ç©ºé—´å®Œæˆçš„ã€‚å³æ—¶é—´å¤æ‚åº¦æ˜¯$O(n)$ï¼Œç©ºé—´å¤æ‚åº¦æ˜¯$S(1)$ã€‚æ­»å¾ªç¯åªæ˜¯å…¨è´Ÿè·çš„ä½¿ç”¨CPUçš„è¿ç®—èµ„æºï¼Œä½†ä¸ä¼šå½±å“å†…å­˜ç»“æ„ã€‚\n\nè€Œæ— ç©·é€’å½’æ˜¯åå¤å¼€è¾Ÿæ–°çš„æ ˆå¸§ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯$O(n)$ï¼Œç©ºé—´å¤æ‚åº¦æ˜¯$S(n)$ï¼Œå› ä¸ºæ ˆåŒºçš„å¤§å°æ˜¯æœ‰é™çš„ï¼Œé»˜è®¤ä¸º1Mï¼Œå¦‚æœä¸€ç›´é€’å½’ä¸‹å»ï¼Œåˆ™ä¼šæº¢å‡ºæ ˆåŒºç ´åå†…å­˜ç»“æ„ï¼Œåˆ™ä¸å¯èƒ½ä¸€ç›´é€’å½’ä¸‹å»ã€‚æ‰€ä»¥é—®é¢˜çš„è§„æ¨¡ä¸è¦è¿‡å¤§ï¼Œé€’å½’è¿‡æ·±ï¼Œå¼•èµ·æ ˆæº¢å‡ºã€‚\n\n# æ‰¾æ•°ç»„æŸä¸€å€¼\n\n```c\nint Find(const int* ar,int n,int val)\n{\n    if(n<1 || ar[n-1]==val)\n    {\n        return n-1;\n    }\n    else\n    {\n        return Find(ar,n-1,val);\n    }\n}\n```\n\n\n\n```c\nint Find(const int* ar,int n,int val)\n{\n\tint pos = -1;\n\tif (n > 0)\n\t{\n\t\tif (ar[n - 1] == val)\n\t\t{\n\t\t\tpos=n-1;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpos = FindValueIndex(ar, n - 1, val);\n\t\t}\n\t}\n\treturn pos;\n}\n```\n\n# ä½“ä¼šé€’å½’çš„åˆ†æ\n\n```c\nvoid Print(const int* ar,int n)\n{\n    if(n>0)\n    {\n        Print(ar,n-1);//æ‹¬å·å†…çš„n-1æ”¹æˆn--å’Œ--n,ç»“æœéƒ½ä¼šä¸ä¸€æ ·ã€‚\n        printf(\"%d \",ar[n-1]);\n    }\n}\nvoid Print_Ar(const int* ar,int n)\n{\n    assert(ar!=nullptr);\n    Print(ar,n);\n    printf(\"\\n\");\n}\nint main()\n{\n    int ar[] = { 12,23,34 };\n\tint n = sizeof(ar) / sizeof(ar[0]);\n\tPrint_Ar(ar, n);\n}\n```\n\n# ä½œä¸š\n\n1. æ–æ³¢é‚£å¥‘æ•°åˆ—\n   å¾ªç¯æ³•\n```c\nint fun(int n)\n{\n   int a=1,b=1,c=1;\n   for(int i=3;i<=n;++i)\n   {\n       c=a+b;\n       b=a;\n       a=c;\n   }\n   return c;\n}\n```\n\n   é€’å½’æ³•ï¼ˆç›®æ ‡è¦è¾¾åˆ°æ—¶é—´å¤æ‚åº¦$O(n)$ï¼‰\n   https://leetcode-cn.com/problems/fei-bo-na-qi-shu-lie-lcof/solution/fei-bo-na-qi-shu-lie-wen-ti-de-si-chong-jie-fa-by-/\n\n```c\nint Fibonacci(int n)\n{\n    if (n == 1 || n == 2)return 1;\n    else if (n > 0)\n    {\n        return Fibonacci(n - 1) + Fibonacci(n - 2);\n    }\n    else\n    {\n        return 0;\n    }\n}\nint Fibonacci_Ar(int* ar,int n)\n{\n    int i = 2;\n    for (i; i <= n;++i)\n    {\n        ar[i] = ar[i - 2] + ar[i - 1];\n    }\n    return ar[n];\n}\nint main()\n{\n    int ar[101] = { 0,1,1 };\n    int fibo = Fibonacci_Ar(ar,30);\n    printf(\"%d \", fibo);\n}\n```\n\n```java\n/*è®°å¿†åŒ–é€’å½’è§£æ³•\nè§£é¢˜æ€è·¯:\næ—¢ç„¶æ™®é€šçš„é€’å½’è§£æ³•äº§ç”Ÿå¤§é‡çš„é‡å¤è®¡ç®—ï¼Œå¦‚æœå·²ç»è®¡ç®—è¿‡çš„f(x) æŠŠç»“æœä¿å­˜ä¸å°±å‡å°‘äº†è®¡ç®—ä¹ˆï¼Ÿ ç”¨ä¸€ä¸ªæ•°ç»„è®°å¿†è®¡ç®—ç»“æœï¼Œå¦‚æœf(x)å·²ç»è®¡ç®—è¿‡äº†ï¼Œç›´æ¥è¿”å›a[x]\næ—¶é—´å¤æ‚åº¦:\nO(n)ï¼Œ ç”±äºè®¡ç®—è¿‡çš„è®°å¿†ä¸‹äº†ï¼Œåªè¦næ¬¡\nç©ºé—´å¤æ‚åº¦:\nO(n)ï¼Œ é€’å½’è°ƒç”¨æ ˆæ¶ˆè€—äº†çº¿æ€§æ•°é‡çº§ï¼Œè®°å¿†æ•°ç»„ä½¿ç”¨äº†nçš„ç©ºé—´\n*/\n#define N 100 + 1\nclass Solution {\nprivate:\n   int arr[N] = {0, 1, 1, } ;\npublic:\n   int fib(int n) {\n       if (arr[n] || !n)\n           return arr[n] ;\n       return arr[n] = (fib(n-1) + fib(n-2))%1000000007 ;\n   }\n};\n``` \n2. äºŒåˆ†æŸ¥æ‰¾é€’å½’æ³•\n```c\nint binary_search(const int* ar, int n, int val, int left, int right)\n{\n    int pos = -1;\n    int mid = (right+left)/2;\n    if (n < 1 || ar[mid] == val)\n    {\n        pos = mid;\n    }\n    else if(ar[mid]>val)\n    {\n        return binary_search(ar, n/2, val, left, right-1);\n    }\n    else\n    {\n        return binary_search(ar, n/2, val, left+1, right);\n    }\n    return pos;\n}\n/*\nint FindValueIndex(const int* ar, int n, int val)\n{\nif (n < 1 || ar[n-1] == val)\n{\n    return n-1;\n}\n   else\n   {\n       return FindValueIndex(ar, n-1, val);\n   }\n}\n*/\nint findValue(const int*ar, int n,int val)\n{\n    if(ar==NULL) return -1;\n    return binary_search(ar, n, val, 0, n-1);\n}\n```\n3. æ€è€ƒä»¥ä¸‹ä»£ç `'#'`ä¼šè¾“å‡ºå‡ æ¬¡ï¼Ÿ\n```c\nvoid fun(int i,int n)\n{\n    if(i==n)\n    {\n        printf(\"# \");\n    }\n    else\n    {\n        fun(i+1,n);\n        fun(i+1,n);\n    }\n}\nint main()\n{\n    int n = 3;\n    fun(0,n);\n    return 0;\n}\n```\n\nç­”æ¡ˆæ˜¯è¾“å‡º8æ¬¡ã€‚å¦‚æœåªå†™äº†ä¸€è¡Œ`fun(i+1,n);`åˆ™åªæ‰“å°1æ¬¡ã€‚æ€è€ƒä¸ºä»€ä¹ˆã€‚\nå¤§ä½“ä¸Šåˆ†æç”¨å±‚æ¬¡åˆ†æï¼Œå…·ä½“è°ƒåŠ¨æ˜¯æ·±åº¦ä¼˜å…ˆæœç´¢åˆ†æã€‚\n![image-20210816010631178](../../images/Cè¯­è¨€_é€’å½’/image-20210816010631178.png)\nåªè°ƒç”¨ä¸€æ¬¡çš„æƒ…å†µï¼š\n![image-20210816010852815](../../images/Cè¯­è¨€_é€’å½’/image-20210816010852815.png)\nåªæœ‰ä¸€æ¡è·¯å¾„ï¼Œå³åªæ‰“å°ä¸€æ¬¡ã€‚\n\nè°ƒç”¨ä¸¤æ¬¡çš„æƒ…å†µï¼š\n![image-20210816012051272](../../images/Cè¯­è¨€_é€’å½’/image-20210816012051272.png)\nè§„å¾‹ï¼šè°ƒç”¨ä¸¤æ¬¡æ—¶ï¼Œæ­¤ç±»é€’å½’ç¨‹åºçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(2^n)ï¼Œç©ºé—´å¤æ‚åº¦ä¸ºæ ‘çš„é«˜åº¦S(n)ã€‚\n\nå±‚æ¬¡åˆ†æï¼šï¼ˆä¸€å±‚ä¸€å±‚çœ‹ï¼Œè€Œä¸æ˜¯å…·ä½“çš„å®ç°æ­¥éª¤ï¼‰\n![image-20210816012904753](../../images/Cè¯­è¨€_é€’å½’/image-20210816012904753.png)\nç”±æ­¤é¢˜å¯ä»¥å»¶ä¼¸å‡ºå…¨æ’åˆ—/å­é›†æ ‘(ç»„åˆæ ‘)é—®é¢˜ï¼\n","categories":["C"]},{"title":"Cè¯­è¨€_äºŒçº§æŒ‡é’ˆ","url":"/C/Cè¯­è¨€_äºŒçº§æŒ‡é’ˆ/","content":"# ç†è§£å„çº§æŒ‡é’ˆ+1çš„å«ä¹‰\n\ntypename\\* p;\np = p + 1; è¢«ç¼–è¯‘å™¨è§£é‡Šæˆï¼š p = p + sizeof(typename)*1ï¼›\n\n## intå‹ä¸ºä¾‹\n\n![image-20210731140231534](../../images/C%E8%AF%AD%E8%A8%80_%E4%BA%8C%E7%BA%A7%E6%8C%87%E9%92%88/image-20210731140231534.png)\n\n```c\nint a3,a2,a1,a0;\nint *p3,*p2,*p1,*p0;\nint **s;\ns+1;\n*s+1;\n**s+1;\n//ä»¥ä¸Šä¸‰å¥ï¼š1ã€åŠ 1çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ2ã€åŠ åçš„ç±»å‹æ˜¯ä»€ä¹ˆ\n```\n\n### s+1\n\nsæ˜¯ä¸€ä¸ªäºŒçº§æŒ‡é’ˆï¼Œç±»å‹ä¸ºint\\*\\*ï¼Œåªè¦æ˜¯x86æ¶æ„ä¸‹çš„æŒ‡é’ˆï¼Œä¸ç®¡å‡ çº§ï¼Œéƒ½æ˜¯å ç”¨4å­—èŠ‚ã€‚\n\nè€ŒæŒ‡é’ˆ+1æˆ‘ä»¬è¦ç†è§£å…¶å«ä¹‰ï¼ŒæŒ‡é’ˆ+1ç­‰æ•ˆäº(æŒ‡é’ˆ+sizeof(\\*æŒ‡é’ˆ))ã€‚\n\nå¦‚æœæ˜¯äºŒçº§æŒ‡é’ˆ+1ï¼Œåˆ™åŠ çš„å¤§å°æ˜¯ä¸€çº§æŒ‡é’ˆçš„å¤§å°ã€‚åˆ™ä¸ç®¡typename\\*\\* p; pçš„ç±»å‹æ— è®ºå¦‚ä½•ï¼Œp+1éƒ½æ˜¯åŠ 4ã€‚ \n\nå¦‚æœæ˜¯ä¸€çº§æŒ‡é’ˆ+1ï¼Œåˆ™åŠ çš„å¤§å°æ˜¯æŒ‡å‘çš„æ•°æ®ç±»å‹çš„å¤§å°ï¼Œä¸åŒæ•°æ®ç±»å‹çš„å¤§å°ä¸ä¸€æ ·ï¼Œintå‹æ­£å¥½å’ŒæŒ‡é’ˆçš„å¤§å°ä¸€æ ·éƒ½æ˜¯4å­—èŠ‚ï¼Œæ‰€ä»¥å®¹æ˜“é€ æˆæ··æ·†ï¼›charå‹å 1å­—èŠ‚ã€‚æ‰€ä»¥int\\* ip; ip+1ä¸º+4ï¼›æ‰€ä»¥char\\* cp; cp+1ä¸º+1ã€‚\n\nåˆ™s+1çš„æ„ä¹‰å°±æ˜¯ï¼Œå®é™…æ˜¯s+4å­—èŠ‚ï¼Œä½¿äºŒçº§æŒ‡é’ˆæŒ‡å‘äº†ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå³äºŒçº§æŒ‡é’ˆæŒ‡å‘äº†ä¸‹ä¸€ä¸ªä¸€çº§æŒ‡é’ˆã€‚åŠ åçš„ç±»å‹ä¾æ—§æ˜¯äºŒçº§æŒ‡é’ˆã€‚\n\n![image-20210731140336842](../../images/C%E8%AF%AD%E8%A8%80_%E4%BA%8C%E7%BA%A7%E6%8C%87%E9%92%88/image-20210731140336842.png)\n\n### \\*s+1\n\n\\*s+1å®é™…ä¸Šæ˜¯\\*s+4å­—èŠ‚ï¼Œå› ä¸ºintå‹å 4å­—èŠ‚ã€‚æ„ä¹‰å°±æ˜¯ä½¿ä¸€çº§æŒ‡é’ˆæŒ‡å‘äº†ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå³ä¸€çº§æŒ‡é’ˆæŒ‡å‘äº†ä¸‹ä¸€ä¸ªintå‹æ•°æ®ã€‚åŠ åçš„ç±»å‹ä¾æ—§æ˜¯ä¸€çº§æŒ‡é’ˆã€‚\n\n### \\*\\*s+1\n\n\\*\\*s+1å®é™…ä¸Šå°±æ˜¯è¡¨é¢æ„æ€\\*\\*s+1ï¼Œå› ä¸º\\*\\*sä¸ºintå‹æ•°æ®ï¼Œè€Œä¸æ˜¯äºŒçº§æŒ‡é’ˆä¹Ÿä¸æ˜¯ä¸€çº§æŒ‡é’ˆï¼Œæ˜¯å®å®åœ¨åœ¨çš„æ•°æ®æœ¬èº«ã€‚åˆ™æ„ä¹‰å°±æ˜¯intå‹æ•°æ®çš„åŠ æ³•è¿ç®—ã€‚åŠ åçš„ç±»å‹ä¸ºintå‹ã€‚\n\n## charå‹ä¸ºä¾‹\n\n![image-20210731140429617](../../images/C%E8%AF%AD%E8%A8%80_%E4%BA%8C%E7%BA%A7%E6%8C%87%E9%92%88/image-20210731140429617.png)\n\n### s+1\n\nsæ˜¯ä¸€ä¸ªäºŒçº§æŒ‡é’ˆï¼Œç±»å‹ä¸ºchar\\*\\*ï¼Œåªè¦æ˜¯x86æ¶æ„ä¸‹çš„æŒ‡é’ˆï¼Œä¸ç®¡å‡ çº§ï¼Œéƒ½æ˜¯å ç”¨4å­—èŠ‚ã€‚\n\nåˆ™æ ¹æ®ä¸Šæ–‡ï¼Œs+1çš„æ„ä¹‰å°±æ˜¯ï¼Œå®é™…æ˜¯s+4å­—èŠ‚ï¼Œä½¿äºŒçº§æŒ‡é’ˆæŒ‡å‘äº†ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå³äºŒçº§æŒ‡é’ˆæŒ‡å‘äº†ä¸‹ä¸€ä¸ªä¸€çº§æŒ‡é’ˆã€‚åŠ åçš„ç±»å‹ä¾æ—§æ˜¯äºŒçº§æŒ‡é’ˆã€‚\n\n![image-20210731140336842](../../images/C%E8%AF%AD%E8%A8%80_%E4%BA%8C%E7%BA%A7%E6%8C%87%E9%92%88/image-20210731140336842.png)\n\n### \\*s+1\n\n\\*s+1å®é™…ä¸Šæ˜¯\\*s+4å­—èŠ‚ï¼Œå› ä¸ºcharå‹å 1å­—èŠ‚ã€‚æ„ä¹‰å°±æ˜¯ä½¿ä¸€çº§æŒ‡é’ˆæŒ‡å‘äº†ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå³ä¸€çº§æŒ‡é’ˆæŒ‡å‘äº†ä¸‹ä¸€ä¸ªcharå‹æ•°æ®ã€‚åŠ åçš„ç±»å‹ä¾æ—§æ˜¯ä¸€çº§æŒ‡é’ˆã€‚\n\n### \\*\\*s+1\n\n\\*\\*s+1å®é™…ä¸Šå°±æ˜¯è¡¨é¢æ„æ€\\*\\*s+1ï¼Œå› ä¸º\\*\\*sä¸ºcharå‹æ•°æ®ï¼Œè€Œä¸æ˜¯äºŒçº§æŒ‡é’ˆä¹Ÿä¸æ˜¯ä¸€çº§æŒ‡é’ˆï¼Œæ˜¯å®å®åœ¨åœ¨çš„æ•°æ®æœ¬èº«ã€‚åˆ™æ„ä¹‰å°±æ˜¯charå‹æ•°æ®ï¼ˆæœ¬è´¨ä¸Šæ˜¯ASCIIç æ•´å‹å€¼ï¼‰çš„åŠ æ³•è¿ç®—ã€‚åŠ åçš„ç±»å‹ä¸ºcharå‹ã€‚\n\n## doubleå‹ä¸ºä¾‹\n\n![image-20210731140641462](../../images/C%E8%AF%AD%E8%A8%80_%E4%BA%8C%E7%BA%A7%E6%8C%87%E9%92%88/image-20210731140641462.png)\n\n### s+1\n\nsæ˜¯ä¸€ä¸ªäºŒçº§æŒ‡é’ˆï¼Œç±»å‹ä¸ºdouble\\*\\*ï¼Œåªè¦æ˜¯x86æ¶æ„ä¸‹çš„æŒ‡é’ˆï¼Œä¸ç®¡å‡ çº§ï¼Œéƒ½æ˜¯å ç”¨4å­—èŠ‚ã€‚\n\nåˆ™æ ¹æ®ä¸Šæ–‡ï¼Œs+1çš„æ„ä¹‰å°±æ˜¯ï¼Œå®é™…æ˜¯s+4å­—èŠ‚ï¼Œä½¿äºŒçº§æŒ‡é’ˆæŒ‡å‘äº†ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå³äºŒçº§æŒ‡é’ˆæŒ‡å‘äº†ä¸‹ä¸€ä¸ªä¸€çº§æŒ‡é’ˆã€‚åŠ åçš„ç±»å‹ä¾æ—§æ˜¯äºŒçº§æŒ‡é’ˆã€‚\n\n![image-20210731140336842](../../images/C%E8%AF%AD%E8%A8%80_%E4%BA%8C%E7%BA%A7%E6%8C%87%E9%92%88/image-20210731140336842.png)\n\n### \\*s+1\n\n\\*s+1å®é™…ä¸Šæ˜¯\\*s+8å­—èŠ‚ï¼Œå› ä¸ºdoubleå‹å 8å­—èŠ‚ã€‚æ„ä¹‰å°±æ˜¯ä½¿ä¸€çº§æŒ‡é’ˆæŒ‡å‘äº†ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå³ä¸€çº§æŒ‡é’ˆæŒ‡å‘äº†ä¸‹ä¸€ä¸ªdoubleå‹æ•°æ®ã€‚åŠ åçš„ç±»å‹ä¾æ—§æ˜¯ä¸€çº§æŒ‡é’ˆã€‚\n\n### \\*\\*s+1\n\n\\*\\*s+1å®é™…ä¸Šå°±æ˜¯è¡¨é¢æ„æ€\\*\\*s+1.0ï¼Œå› ä¸º\\*\\*sä¸ºdoubleå‹æ•°æ®ï¼Œè€Œä¸æ˜¯äºŒçº§æŒ‡é’ˆä¹Ÿä¸æ˜¯ä¸€çº§æŒ‡é’ˆï¼Œæ˜¯å®å®åœ¨åœ¨çš„æ•°æ®æœ¬èº«ã€‚åˆ™æ„ä¹‰å°±æ˜¯doubleå‹æ•°æ®çš„åŠ æ³•è¿ç®—ã€‚åŠ åçš„ç±»å‹ä¸ºdoubleå‹ã€‚\n\n# åè§‚æ•°ç»„æŒ‡é’ˆ\n\né¦–å…ˆåŒºåˆ†ä¸€ä¸ªæ¦‚å¿µï¼Œå³int\\* s[4];çš„æ„ä¹‰æ˜¯sæ˜¯å­˜æ”¾intå‹æŒ‡é’ˆçš„æ•°ç»„ã€‚è€Œint(\\*s)[4];çš„æ„ä¹‰æ˜¯sæ˜¯å­˜æ”¾int[4]æ•°ç»„çš„æŒ‡é’ˆï¼Œç±»ä¼¼äºint[4]\\* s.\n\n```c\nint(*s)[4];//æ„ä¹‰æ˜¯sæ˜¯å­˜æ”¾int[4]æ•°ç»„çš„æŒ‡é’ˆï¼Œç±»ä¼¼äºint[4]* sï¼Œåˆ™sæ˜¯æŒ‡å‘ä¸€ä¸ªint[4]æ•°ç»„ã€‚\n```\n\n\n\n","categories":["C"]},{"title":"Linux_åˆè¯†Linux","url":"/Linux/Linux_åˆè¯†Linux/","content":"# Linuxå­¦ä¹ å†…å®¹\n1. åŸºæœ¬æ“ä½œ\n2. `gcc/g++`ï¼ˆç¨‹åºå¦‚ä½•ç¼–è¯‘ï¼‰\n3. å·¥ç¨‹æ–‡ä»¶ç®¡ç†makefile\n4. è°ƒè¯•gdb\n5. åº“æ–‡ä»¶\n6. è¿›ç¨‹ï¼šå¤åˆ¶è¿›ç¨‹forkã€æ›¿æ¢è¿›ç¨‹\n7. è¿›ç¨‹é—´é€šä¿¡ï¼ˆæ¯”å¦‚QQäº’å‘ä¿¡æ¯ï¼‰ï¼šç®¡é“ã€å…±äº«å†…å­˜ã€ä¿¡å·é‡\n8. çº¿ç¨‹ï¼šåŒæ­¥ã€å¹¶å‘\n9. ç½‘ç»œç¼–ç¨‹ï¼šè·¨ä¸»æœºå‘é€æ•°æ®ï¼ˆæœ€å¥½æœ‰è®¡ç®—æœºç½‘ç»œåŸºç¡€ï¼‰ï¼ŒTCPã€HTTPã€I/Oå¤ç”¨æ–¹æ³•\n## åˆè¯†å†…å®¹\n1. ç›®å½•ç»“æ„ï¼šLinuxä¸­çš„æ–‡ä»¶å¤¹ç§°ä¸ºç›®å½•\n2. æ–‡ä»¶ç±»å‹\n3. æƒé™\n4. å‘½ä»¤\n## æ€»ç»“\n1. ä¸Windowsç›¸æ¯”ï¼šLinuxå¤šç”¨å‘½ä»¤è¡Œï¼Œæˆ‘ä»¬è¦æŒæ¡åŸºæœ¬çš„å‘½ä»¤ã€‚\n2. äº†è§£ç³»ç»Ÿçš„ç›®å½•ç»“æ„ï¼Œæ˜¯ä¸ªå€’çŠ¶æ ‘ï¼Œè®°ä½å¸¸è§çš„å››äº”ä¸ªç›®å½•çš„ä½œç”¨ã€‚\n3. ç”¨æˆ·å­˜æ”¾æ–‡ä»¶ï¼Œè¦æ”¾åˆ°è‡ªå·±çš„å®¶ç›®å½•ã€‚\n# Linuxç›®å½•ç»“æ„\n\n| ç›®å½•   | æè¿°                                                                                                                                          | å…¨æ‹¼                                      |\n| ---- | ------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------- |\n| /    | æ ¹ç›®å½•                                                                                                                                         |                                         |\n| bin  | äºŒè¿›åˆ¶å¯æ‰§è¡Œç¨‹åºï¼Œå¸¸ç”¨çš„å‘½ä»¤å°±å­˜æ”¾åˆ°è¿™äº†ã€‚                                                                                                                       | binary, è¡¨ç¤ºäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶                      |\n| dev  | ç¡¬ä»¶è®¾å¤‡æ–‡ä»¶ï¼ŒæŠŠç¡¬ä»¶è®¾å¤‡æŠ½è±¡æˆä¸ºäº†æ–‡ä»¶                                                                                                                         | device, è®¾å¤‡                              |\n| lib  | è¿™ä¸ªç›®å½•é‡Œå­˜æ”¾ç€ç³»ç»Ÿæœ€åŸºæœ¬çš„åŠ¨æ€åº“ï¼Œå…¶ä½œç”¨ç±»ä¼¼äºWindowsé‡Œçš„DLLæ–‡ä»¶ã€‚å‡ ä¹æ‰€æœ‰çš„åº”ç”¨ç¨‹åºéƒ½éœ€è¦ç”¨åˆ°è¿™äº›å…±äº«åº“ã€‚                                                                                 | library, åº“                              |\n| mnt  | ä¸´æ—¶æŒ‚è½½ç§»åŠ¨è®¾å¤‡                                                                                                                                    | mount                                   |\n| proc | å°†å†…å­˜ä¸­è¿›ç¨‹çš„ä¿¡æ¯æ˜ å°„åˆ°äº†æ–‡ä»¶ä¸­                                                                                                                            | process, è¿›ç¨‹                             |\n| home | æ™®é€šç”¨æˆ·çš„å®¶ç›®å½•ï¼Œä»¥ç”¨æˆ·åä¸ºå‡†ï¼Œå¦‚`/home/xcg`                                                                                                                |                                         |\n| root | ç®¡ç†å‘˜çš„å®¶ç›®å½•                                                                                                                                     |                                         |\n| boot | å­˜æ”¾ç³»ç»Ÿå¯åŠ¨ç›¸å…³çš„å†…æ ¸æ–‡ä»¶                                                                                                                               |                                         |\n| etc  | ç³»ç»Ÿçš„é…ç½®æ–‡ä»¶                                                                                                                                     | et cetera, \"ç­‰ç­‰\"                         |\n| usr  | ç³»ç»Ÿç”¨æˆ·å·¥å…·å’Œç¨‹åºã€‚åœ¨ç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸ç»å¸¸æ”¹å˜çš„å†…å®¹ï¼Œæ¯”å¦‚è¯´å®‰è£…çš„è½¯ä»¶ã€‚å­˜æ”¾æ‰€æœ‰å‘½ä»¤ã€åº“ã€æ‰‹å†Œç­‰å…±äº«èµ„æºã€‚å­ç›®å½•æœ‰`bin`ï¼ˆç”¨æˆ·å‘½ä»¤ï¼‰ã€`sbin`ï¼ˆè¶…çº§ç”¨æˆ·ä½¿ç”¨çš„é«˜çº§ç®¡ç†ç¨‹åºå’Œç³»ç»Ÿå®ˆæŠ¤ç¨‹åºï¼‰ã€`include`ã€`lib`ï¼ˆç”¨æˆ·åæ¥å®‰è£…çš„åº“æ–‡ä»¶ï¼‰ã€`src`ï¼ˆå†…æ ¸æºä»£ç ï¼‰ | æ®è¯´æ˜¯userçš„ç¼©å†™ï¼Œä¹Ÿæ®è¯´æ˜¯Unix Shared Resourcesçš„ç¼©å†™ |\n| var  | usrç›®å½•ä¸‹çš„è½¯ä»¶äº§ç”Ÿçš„æ•°æ®ï¼Œä¼šå­˜æ”¾äºæ­¤ï¼›é™¤æ­¤ä¹‹å¤–è¿˜æœ‰é‚®ä»¶ã€ç³»ç»Ÿæ—¥å¿—ç­‰ã€‚å› æ­¤**ç»å¸¸æ”¹å˜**ã€‚                                                                                             |                                         |\n| proc | æ¯ä¸€ä¸ªè¿›ç¨‹å¯åŠ¨åï¼Œéƒ½ä¼šåœ¨é‡Œé¢åˆ›å»ºä¸€ä¸ªåä¸ºè¿›ç¨‹IDå·çš„ç›®å½•ï¼Œä¿å­˜è¿›ç¨‹ç›¸å…³çš„ä¿¡æ¯ã€‚å…¶ä¸­åŒ…å«fdï¼Œå³è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ã€socketã€‚                                                                              |                                         |\n## etc\n\netcä¸æ˜¯ä»€ä¹ˆç¼©å†™ï¼Œæ˜¯\"and so on\"çš„æ„æ€ï¼Œæ¥æºäºæ³•è¯­çš„\"et cetera\"ï¼Œç¿»è¯‘æˆä¸­æ–‡å°±æ˜¯\"ç­‰ç­‰\"çš„æ„æ€ã€‚è‡³äºä¸ºä»€ä¹ˆåœ¨`/etc`ä¸‹é¢å­˜æ”¾é…ç½®æ–‡ä»¶ï¼ŒæŒ‰ç…§åŸå§‹çš„UNIXçš„è¯´æ³•è¿™ä¸‹é¢æ”¾çš„éƒ½æ˜¯ä¸€å †é›¶é›¶ç¢ç¢çš„ä¸œè¥¿ï¼Œå°±å«etcï¼Œè¿™å…¶å®æ˜¯ä¸ªå†å²é—ç•™ã€‚\n\nè¿™ä¸ªç›®å½•ä¸€èˆ¬ç”¨æ¥å­˜æ”¾ç¨‹åºæ‰€éœ€çš„æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„é…ç½®æ–‡ä»¶ã€‚\n\n`/etc`ç›®å½•åŒ…å«å¾ˆå¤šæ–‡ä»¶ï¼Œè®¸å¤šç½‘ç»œé…ç½®æ–‡ä»¶åœ¨å…¶ä¸­ï¼š\n1. `/etc/rc`or`/etc/rc.d`or`/etc/rc*.d`ï¼šå¯åŠ¨ã€æˆ–æ”¹å˜è¿è¡Œçº§æ—¶è¿è¡Œçš„scriptsæˆ–scriptsçš„ç›®å½•ã€‚\n2. `/etc/passwd`ï¼šç”¨æˆ·æ•°æ®åº“ï¼Œå…¶ä¸­çš„åŸŸç»™å‡ºäº†ç”¨æˆ·åã€çœŸå®å§“åã€å®¶ç›®å½•ã€åŠ å¯†çš„å£ä»¤å’Œç”¨æˆ·çš„å…¶ä»–ä¿¡æ¯ã€‚\n3. `/etc/fstab`ï¼šå¯åŠ¨æ—¶mount -aå‘½ä»¤(åœ¨/etc/rc æˆ–ç­‰æ•ˆçš„å¯åŠ¨æ–‡ä»¶ä¸­)è‡ªåŠ¨mountçš„æ–‡ä»¶ç³»ç»Ÿåˆ—è¡¨ã€‚Linuxä¸‹ä¹ŸåŒ…æ‹¬ç”¨swapon -aå¯ç”¨çš„swapåŒºçš„ä¿¡æ¯ã€‚\n4. `/etc/group`ï¼šç±»ä¼¼`/etc/passwd`ï¼Œä½†è¯´æ˜çš„ä¸æ˜¯ç”¨æˆ·è€Œæ˜¯ç»„\n5. `/etc/issue`ï¼šgettyåœ¨ç™»å½•æç¤ºç¬¦å‰çš„è¾“å‡ºä¿¡æ¯ï¼Œé€šå¸¸åŒ…æ‹¬ç³»ç»Ÿçš„ä¸€æ®µçŸ­è¯´æ˜æˆ–æ¬¢è¿ä¿¡æ¯ï¼Œå†…å®¹ç”±ç³»ç»Ÿç®¡ç†å‘˜ç¡®å®šã€‚\n6. `/etc/magic`ï¼šfileçš„é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«ä¸åŒæ–‡ä»¶æ ¼å¼çš„è¯´æ˜ï¼ŒfileåŸºäºå®ƒçŒœæµ‹æ–‡ä»¶ç±»å‹ã€‚\n7. `/etc/mtab`ï¼šå½“å‰å®‰è£…çš„æ–‡ä»¶ç³»ç»Ÿåˆ—è¡¨ï¼Œç”±scriptsåˆå§‹åŒ–ï¼Œå¹¶ç”±mountå‘½ä»¤è‡ªåŠ¨æ›´æ–°ã€‚éœ€è¦ä¸€ä¸ªå½“å‰å®‰è£…çš„æ–‡ä»¶ç³»ç»Ÿçš„åˆ—è¡¨æ—¶ä½¿ç”¨ï¼Œä¾‹å¦‚dfå‘½ä»¤ã€‚\n8. `/etc/shadow`ï¼šåœ¨å®‰è£…äº†å½±å­å£ä»¤è½¯ä»¶çš„ç³»ç»Ÿä¸Šçš„å½±å­å£ä»¤æ–‡ä»¶ï¼Œå½±å­å£ä»¤æ–‡ä»¶å°†`/etc/passwd`æ–‡ä»¶ä¸­çš„åŠ å¯†å£ä»¤ç§»åŠ¨åˆ°`/etc/shadow`ä¸­ï¼Œè€Œåè€…åªå¯¹`root`å¯è¯»ï¼Œè¿™ä½¿ç ´è¯‘å£ä»¤æ›´å›°éš¾ã€‚\n9. `/etc/login.defs`ï¼šloginå‘½ä»¤çš„é…ç½®æ–‡ä»¶ã€‚\n10. `/etc/profile, /etc/csh.login, /etc/csh.cshrc`ï¼šç™»å½•æˆ–å¯åŠ¨æ—¶Bourneæˆ–Cshellsæ‰§è¡Œçš„æ–‡ä»¶ï¼Œè¿™å…è®¸ç³»ç»Ÿç®¡ç†å‘˜ä¸ºæ‰€æœ‰ç”¨æˆ·å»ºç«‹å…¨å±€ç¼ºçœç¯å¢ƒã€‚\n11. `/etc/shells`ï¼šåˆ—å‡ºå¯ä¿¡ä»»çš„shell.chshå‘½ä»¤å…è®¸ç”¨æˆ·åœ¨æœ¬æ–‡ä»¶æŒ‡å®šèŒƒå›´å†…æ”¹å˜ç™»å½•shellã€‚æä¾›ä¸€å°æœºå™¨FTPæœåŠ¡çš„æœåŠ¡è¿›ç¨‹ftpdæ£€æŸ¥ç”¨æˆ·shellæ˜¯å¦åˆ—åœ¨ `/etc/shells`æ–‡ä»¶ä¸­ï¼Œå¦‚æœä¸æ˜¯å°†ä¸å…è®¸è¯¥ç”¨æˆ·ç™»å½•\n## usr\nä¹‹å‰ä¸€ç›´æ²¡æœ‰æ€ä¹ˆå…³æ³¨è¿‡å®ƒï¼Œåæ­£ç¨‹åºéƒ½æ˜¯å®‰è£…åœ¨é‡Œè¾¹çš„ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆå€¼å¾—è¿½æ ¹æº¯æºçš„ä¸œè¥¿ã€‚é‚£ä¹ˆusråˆ°åº•æ˜¯ä»€ä¹ˆçš„ç¼©å†™å‘¢ï¼Œå®ƒåˆæ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿè®¨è®ºä¸­ï¼Œå¤§éƒ¨åˆ†è§‚ç‚¹è®¤ä¸ºï¼š\n1. usræ˜¯userçš„ç¼©å†™ï¼›\n2. usræ˜¯unix system resourcesçš„ç¼©å†™ï¼›\n3. usræ˜¯unix software resourcesçš„ç¼©å†™ã€‚\n4. usræ˜¯unix shared resources\n\næ ¹æ®å¸¸è¯†åˆ¤æ–­ï¼Œæ˜¯userç¼©å†™çš„å¯èƒ½æ€§ä¸å¤§ï¼Œå› ä¸ºå’Œ`/home`å†²çªäº†ã€‚ä¸è¿‡æ˜¯system resourcesè¿˜æ˜¯software resourcesçš„ç¼©å†™è¿˜çœŸä¸å¥½è¯´ã€‚ç‰¹æ­¤æŸ¥äº†å¥½å¤šä¸œè¥¿ï¼Œå´å‘ç°ç«Ÿç„¶è¿wikipediaä¹Ÿæ¨¡æ£±ä¸¤å¯ã€‚`/usr`æ˜¯linuxç³»ç»Ÿæ ¸å¿ƒæ‰€åœ¨ï¼ŒåŒ…å«äº†æ‰€æœ‰çš„å…±äº«æ–‡ä»¶ã€‚\nå®ƒæ˜¯unixç³»ç»Ÿä¸­æœ€é‡è¦çš„ç›®å½•ä¹‹ä¸€ï¼Œæ¶µç›–äº†äºŒè¿›ä½åˆ¶æ–‡ä»¶ï¼Œå„ç§æ–‡ä»¶ï¼Œå„ç§æ ‡å¤´æ–‡ä»¶ï¼Œè¿˜æœ‰å„ç§åº“æ–‡ä»¶ï¼Œè¿˜æœ‰è¯¸å¤šç¨‹åºï¼Œä¾‹å¦‚ftpï¼Œtelnetç­‰ç­‰ã€‚\n\næ›¾ç»çš„`/usr`è¿˜æ˜¯ä½¿ç”¨è€…çš„å®¶ç›®å½•ï¼Œå­˜æ”¾ç€å„ç§ä½¿ç”¨è€…æ–‡ä»¶ï¼Œä½†ç°åœ¨å·²ç»è¢«`/home`å–ä»£äº†ï¼ˆä¾‹å¦‚`/usr/someone`å·²ç»æ”¹ä¸º`/home/someone`ï¼‰ã€‚\nç°ä»£çš„`/usr`åªä¸“é—¨å­˜æ”¾å„ç§ç¨‹åºå’Œèµ„æ–™ï¼Œä½¿ç”¨è€…ç›®å½•å·²ç»è½¬ç§»ã€‚è™½ç„¶`/usr`åç§°æœªæ”¹ï¼Œä¸è¿‡å…¶å«ä¹‰å·²ç»ä»â€œä½¿ç”¨è€…ç›®å½•â€ å˜æˆäº†â€œunixç³»ç»Ÿèµ„æºâ€ ç›®å½•ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä¸€äº›unixç³»ç»Ÿä¸Šï¼Œä»ç„¶æŠŠ`/usr/someone`å½“åšä½¿ç”¨è€…å®¶ç›®å½•ï¼Œå¦‚Minixã€‚\n\n`/usr`æ–‡ä»¶ç³»ç»Ÿç»å¸¸å¾ˆå¤§ï¼Œå› ä¸ºæ‰€æœ‰ç¨‹åºå®‰è£…åœ¨è¿™é‡Œã€‚`/usr`é‡Œçš„æ‰€æœ‰æ–‡ä»¶ä¸€èˆ¬æ¥è‡ªLinux distributionï¼›æœ¬åœ°å®‰è£…çš„ç¨‹åºå’Œå…¶ä»–ä¸œè¥¿åœ¨`/usr/local`ä¸‹ã€‚è¿™æ ·å¯èƒ½åœ¨å‡çº§æ–°ç‰ˆç³»ç»Ÿæˆ–æ–°distributionæ—¶æ— é¡»é‡æ–°å®‰è£…å…¨éƒ¨ç¨‹åºã€‚\n\nç”±äº`/usr`ä¸­çš„æ–‡ä»¶ä¸å’Œç‰¹å®šçš„è®¡ç®—æœºç›¸å…³ï¼Œä¹Ÿä¸ä¼šåœ¨é€šå¸¸ä½¿ç”¨ä¸­ä¿®æ”¹ï¼Œå› æ­¤å¯ä»¥é€šè¿‡äº’è”ç½‘å…±äº«è¿™ä¸ªç›®å½•ï¼ˆæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œè¿™æ ·ï¼Œå½“ç®¡ç†å‘˜å®‰è£…äº†æ–°çš„ç«™ç¾¤è½¯ä»¶ä¹‹åï¼Œæ‰€æœ‰å…±äº«è¿™ä¸€æ–‡ä»¶ç³»ç»Ÿçš„è®¡ç®—æœºå‡å¯ä»¥ä½¿ç”¨æ–°çš„ç«™ç¾¤è½¯ä»¶ã€‚\n\nè‡³æ­¤ï¼ŒçœŸç›¸å¤§ç™½ã€‚çœ‹æ¥å°±åƒå‰ä¸€é˜µå­çš„`/var/run`ç§»åˆ°`/run`ä¸€æ ·ã€‚\n\nçœŸçš„æ˜¯ä¸çœ‹ä¸çŸ¥é“ï¼Œä¸€çœ‹å“ä¸€è·³å‘€ã€‚åŸæ¥linuxå‡ ç»è¿›åŒ–ï¼Œå¥½å¤šç›®å½•çš„è¯ç”Ÿå’Œç”¨é€”å·²ç»äº§ç”Ÿäº†æ ¹æœ¬çš„å˜åŒ–ã€‚\n\n* `/usr/bin`: æ‰€æœ‰å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¦‚gccç­‰ï¼ˆæŒ‡ä¸åŒ…å«åœ¨ `/sbin` å’Œ `/bin` å†…çš„ï¼‰ï¼›\n* `/usr/include`: å„ç§æ ‡å¤´æ–‡ä»¶ï¼Œç¼–è¯‘æ–‡ä»¶ç­‰æ—¶éœ€è¦ä½¿ç”¨ï¼›\n    * `/usr/include/â€™package-nameâ€™` : ç¨‹åºç‰¹å®šçš„æ ‡å¤´æ–‡ä»¶ï¼›\n* `/usr/lib`: æ‰€æœ‰å¯æ‰§è¡Œæ–‡ä»¶æ‰€éœ€è¦çš„åº“æ–‡ä»¶ï¼›\n* `/usr/local`: è¿™é‡Œä¸»è¦å­˜æ”¾é‚£äº›æ‰‹åŠ¨å®‰è£…çš„ç«™ç¾¤è½¯ä»¶ï¼Œå³ä¸æ˜¯é€šè¿‡â€œæ–°ç«‹å¾—â€ æˆ– `apt-get` å®‰è£…çš„ç«™ç¾¤è½¯ä»¶ã€‚ å®ƒå’Œ`/usr`ç›®å½•å…·æœ‰ç›¸ç±»ä¼¼çš„ç›®å½•ç»“æ„ ã€‚è®©ç«™ç¾¤è½¯ä»¶åŒ…ç®¡ç†å™¨æ¥ç®¡ç†`/usr`ç›®å½•ï¼Œè€ŒæŠŠè‡ªå®šä¹‰çš„æŒ‡ä»¤ç ï¼ˆscriptsï¼‰æ”¾åˆ°`/usr/local`ç›®å½•ä¸‹é¢ï¼Œåº”è¯¥æ˜¯ä¸ªä¸é”™çš„ä¸»æ„ã€‚\n* `/usr/games`: æ›¾ç»åŒ…å«æ¸¸æˆç­‰æ–‡ä»¶ï¼Œç°åœ¨å¾ˆå°‘ç”¨åˆ°ï¼›\n* `/usr/man`: man æ‰‹å†Œï¼Œå·²ç»ç§»è‡³ `/usr/share/man`ï¼›\n* `/usr/sbin`: ç±»ä¼¼ `/sbin`ï¼Œroot å¯ä»¥æ‰§è¡Œã€‚ä½†æ­¤ç›®å½•ä¸åŒ…å«åœ¨ç¯å¢ƒå˜æ•° `$PATH` ä¸­ï¼Œå®ƒåŒ…å«çš„ç¨‹åºç±»ä¼¼äº `chroot`, `useradd`, `in.tftpd` and `pppconfig`ï¼›\n* `/usr/share`: å®ƒåŒ…å«äº†å„ç§ç¨‹åºé—´çš„å…±äº«æ–‡ä»¶ï¼Œå¦‚å­—å‹ï¼Œå›¾ç¤ºï¼Œæ–‡ä»¶ç­‰ã€‚ï¼ˆ`/usr/local` å¯¹åº”çš„ç›®å½•æ˜¯ `/usr/loca/share`ï¼‰;\n    * `/usr/share/doc` : ç±»ä¼¼åº”ç”¨ç¨‹åºçš„ man æ‰‹å†Œã€‚å®ƒåŒ…å«ç¨‹åºçš„è¯´æ˜æ–‡ä»¶ï¼Œé¢„è®¾é…ç½®æ–‡ä»¶ç­‰ï¼›\n    * `/usr/share/info` : ä¸å¸¸ç”¨ï¼Œå·²ç»è¢« man ä»£æ›¿ï¼›\n    * `/usr/share/man` : app çš„ manualï¼›\n    * `/usr/share/icons` : åº”ç”¨ç¨‹åºçš„å›¾ç¤ºç­‰æ–‡ä»¶ï¼Œåˆ†ä¸ºpngï¼Œsvgç­‰å¤šç§æ ¼å¼ï¼›\n* `/usr/src` : linux æ ¸å¿ƒçš„åŸå§‹ç å’Œè¯´æ˜æ–‡ä»¶ç­‰ï¼›\n    * `/usr/src/linux` : linux åŸå§‹ç ï¼›\n# æ–‡ä»¶å±æ€§\n\n![image-20220512112348998](../../images/Linux_åˆè¯†Linux/image-20220512112348998.png)\n\n## æ–‡ä»¶ç±»å‹\n\n| æ–‡ä»¶ç±»å‹           | ç¬¦å·è¡¨ç¤º |\n| ------------------ | -------- |\n| æ™®é€šæ–‡ä»¶ï¼ˆæ–‡æ¡£ï¼‰   | `-`      |\n| ç›®å½•æ–‡ä»¶ï¼ˆæ–‡ä»¶å¤¹ï¼‰ | d        |\n| ç®¡é“æ–‡ä»¶           | p        |\n| è®¾å¤‡æ–‡ä»¶           | `c`ã€`b` |\n| é“¾æ¥æ–‡ä»¶           | `l`      |\n| å¥—æ¥å­—æ–‡ä»¶         | s        |\n\n## æ–‡ä»¶æƒé™\n\n| æ–‡ä»¶æƒé™ | ç¬¦å·è¡¨ç¤º | äºŒè¿›åˆ¶è¡¨ç¤º | åè¿›åˆ¶æ•° |\n| -------- | -------- | ---------- | -------- |\n| æ— æƒé™   | `-`      | 0000       | 0        |\n| å¯è¯»     | r        | 0100       | 4        |\n| å¯å†™     | w        | 0010       | 2        |\n| å¯æ‰§è¡Œ   | x        | 0001       | 1        |\n\n### chmodæ”¹æƒé™\n\n| æ‰€æœ‰æƒèŒƒå›´   | ç¬¦å·è¡¨ç¤º |\n| ------------ | -------- |\n| è‡ªå·±ï¼ˆå±ä¸»ï¼‰ | u        |\n| åŒç»„äºº       | g        |\n| å…¶ä»–äºº       | o        |\n\n```bash\n#chmod æ”¹æƒé™\nchmod u-w main #å±ä¸» å»é™¤ å†™æƒé™\nchmod o+w main #å…¶ä»–äºº å¢åŠ  å†™æƒé™\n```\n\n# åŸºç¡€å‘½ä»¤\n\n## åŸºæœ¬æ–‡ä»¶æ“ä½œ\n\n```bash\n# æ–‡ä»¶æ“ä½œåŸºæœ¬å‘½ä»¤\ncd \t#åˆ‡æ¢ç›®å½•\npwd #æ˜¾ç¤ºå½“å‰ä½ç½®\nls \t#æ˜¾ç¤ºå½“å‰ç›®å½•ä¸‹æœ‰å“ªäº›æ–‡ä»¶\nls -l #æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯\nls -a #æ˜¾ç¤ºéšè—æ–‡ä»¶\ntouch #åˆ›å»ºæ™®é€šæ–‡ä»¶\ntouch a.c\nmkdir tmp #åˆ›å»ºtmpç›®å½•ï¼ˆæ–‡ä»¶å¤¹ï¼‰\ncp\nrm\nmv\ncat\nmore/less/head/tail\t# ä¼˜å…ˆå­¦ä¹ moreã€tail\nvi/vim\t#ç¼–è¾‘æ–‡ä»¶\n```\n\n### ls\n\n```bash\nls \t#æ˜¾ç¤ºå½“å‰ç›®å½•ä¸‹æœ‰å“ªäº›æ–‡ä»¶\nls -l #æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯\nls -a #æ˜¾ç¤ºéšè—æ–‡ä»¶\n```\n\n### cd\n\n```bash\n#cd \t#åˆ‡æ¢ç›®å½•\n\ncd \\\t#åˆ‡æ¢ä½ç½®åˆ°æ ¹ç›®å½•ä¸‹\t#ä¹Ÿå¯å†™ä½œcd /\ncd tmp \t#è¿›å…¥tmpè¿™ä¸ªç›®å½•ï¼ˆæ–‡ä»¶å¤¹ï¼‰\ncd ~ \t#å›åˆ°å®¶ç›®å½•\ncd .. \t#è¿”å›ä¸Šä¸€å±‚\n#ç»å¯¹è·¯å¾„\n#ç›¸å¯¹è·¯å¾„\n```\n\n### cp/mv\n\n```bash\ncp\t#æ‹·è´\ncp a.c b.c #æ‹·è´æ™®é€šæ–‡ä»¶\ncp -r tmp tmp1 #æ‹·è´æ–‡ä»¶å¤¹ï¼ŒåŒ…æ‹¬æ–‡ä»¶å¤¹çš„å†…å®¹ï¼Œå‚æ•°è¦åŠ -r\ncp file.txt tmp\ncp file.txt tmp/file.txt\n\nmv\t#1.ç§»åŠ¨ 2.é‡å‘½å\n#mvå¯¹æ–‡ä»¶å¤¹çš„æ“ä½œä¸éœ€è¦åŠ -r\nmv a.c b.c #å°†a.cé‡å‘½åä¸ºb.c\nmv dir1 dir2#å°†ç›®å½•1é‡å‘½åä¸ºç›®å½•2\nmv b.c dir#å¦‚æœå·²ç»æœ‰dirè¿™ä¸ªç›®å½•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†ä¼šæŠŠb.cç§»åŠ¨åˆ°diré‡Œï¼›å¦‚æœä¸å­˜åœ¨diræ–‡ä»¶ï¼Œåˆ™ä¼šé‡å‘½åb.cä¸ºdir\nmv b.c dir/a.c #å¦‚æœå·²ç»æœ‰dirè¿™ä¸ªç›®å½•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†ä¼šæŠŠb.cç§»åŠ¨åˆ°diré‡Œå¹¶é‡å‘½åä¸ºa.c\n```\n\n### rm\n\n```bash\nrm\t#åˆ é™¤\nrm -f \t#ä¸ç»™æç¤ºæŠ¥é”™çš„åˆ é™¤\nrm -d \t#åˆ é™¤æ–‡ä»¶å¤¹ï¼ˆåªèƒ½åˆ é™¤ç©ºçš„ï¼‰\nrm -r \t#é€’å½’åˆ é™¤æ–‡ä»¶å¤¹ï¼ˆåŒ…å«é‡Œé¢æ‰€æœ‰å†…å®¹ï¼‰\nrm -rf\t#-rå’Œ-fçš„ç»„åˆç”¨æ³•ï¼Œå¼ºæœ‰åŠ›ï¼Œä¸€å®šè¦è°¨æ…ä½¿ç”¨\nrmdir \t#åˆ é™¤ç©ºæ–‡ä»¶å¤¹\n```\n\n## é«˜çº§æ–‡ä»¶æ“ä½œ\n\n### cat/more/less/head/tail\n\n```bash\ncat #1.æ‰“å°æ–‡ä»¶å†…å®¹ 2.å‘æ–‡ä»¶è¾“å…¥å†…å®¹ 3.åˆå¹¶æ–‡ä»¶\ncat a.c #æ‰“å°æ–‡ä»¶å†…å®¹\ncat > a.txt#é”®ç›˜è¾“å…¥å†…å®¹ï¼Œé‡å®šå‘åˆ°æ–‡ä»¶é‡Œã€‚Ctrl+Dç»“æŸè¾“å…¥ã€‚å¦‚æœa.txtä¸å­˜åœ¨ï¼Œè‡ªåŠ¨åˆ›å»ºã€‚\ncat a.c b.c > d.txt#æŠŠa.cå’Œb.cçš„å†…å®¹æŒ‰é¡ºåºå†™åˆ°d.txtä¸­ã€‚åˆå¹¶åˆ°å¦ä¸€æ–‡ä»¶ä¸­ã€‚\nmore #åˆ†å±å¹•æ˜¾ç¤ºï¼Œé€‚äºè¾“å‡ºè¶…è¿‡ä¸€ä¸ªå±å¹•çš„æ–‡ä»¶å†…å®¹ï¼Œä½†åªèƒ½çœ‹ä¸€æ¬¡ï¼Œç©ºæ ¼æ˜¯ç¿»é¡µï¼Œå›è½¦æ˜¯ä¸‹ä¸€è¡Œ\nless #åœ¨moreçš„åŸºç¡€ä¸Šï¼Œå¯ä»¥å›æ»šã€‚é€€å‡ºæŒ‰q\nhead #é»˜è®¤æ‰“å°æ–‡ä»¶å‰10è¡Œ\nhead -3 passwd #æ‰“å°å‰ä¸‰è¡Œ\ntail #é»˜è®¤æ‰“å°æ–‡ä»¶å10è¡Œ\ntail -3 passwd #æ‰“å°åä¸‰è¡Œ \n```\n\n### tar\n\n```bash\ntar zxf name.tar.gz #è§£åŒ…\n```\n\n### find\n\n```bash\nfind /home/xcg -name a.c #æ‰¾æŸä¸ªç›®å½•ä¸‹æœ‰æ— a.c\n```\n\n### grep\n\n## vi/vim\n\n### å…³äºviçš„é…ç½®\n\n[vié»˜è®¤çš„tabç¼©è¿›æ˜¯åˆ¶è¡¨ç¬¦ï¼Œæ€ä¹ˆæ”¹ä¸ºç©ºæ ¼ï¼Ÿ](https://www.cnblogs.com/hydah/archive/2012/04/10/2440225.html)\n\nå¯¹äºä½¿ç”¨vimçš„ç¨‹åºå‘˜æ¥è¯´ï¼Œshiftwidthï¼Œtabstopï¼Œsofttabstopç»å¯¹æ˜¯ç»å¸¸æ¥è§¦çš„ä¸‰ä¸ªç¼©è¿›å› ç´ ã€‚èƒ½å¦æœ‰æ–¹ä¾¿ç¾è§‚çš„ï¼Œæ•´ä½“åŒ–çš„ç¼©è¿›ï¼Œä¸»è¦æ˜¯ç”±ä»–ä»¬ç›¸äº’é—´çš„é…åˆå†³å®šã€‚åœ¨ç»è¿‡ä¸€æ®µæ—¶é—´è¯•ç”¨åï¼Œæ€»ç»“ä¸€ä¸‹æˆ‘çš„è®¾ç½®ç»éªŒã€‚\n\n**shiftwidth**ï¼š\n\nè¿™ä¸ªæ˜¯**ç”¨äºç¨‹åºä¸­è‡ªåŠ¨ç¼©è¿›æ‰€ä½¿ç”¨çš„ç©ºç™½é•¿åº¦**æŒ‡ç¤ºçš„ã€‚ä¸€èˆ¬æ¥è¯´ä¸ºäº†ä¿æŒç¨‹åºçš„ç¾è§‚ï¼Œå’Œä¸‹é¢çš„å‚æ•°æœ€å¥½ä¸€è‡´ã€‚åŒæ—¶å®ƒä¹Ÿæ˜¯ç¬¦å·ç§»ä½é•¿åº¦çš„åˆ¶å®šè€…ã€‚\n\n**tabstop**ï¼š\n\n**å®šä¹‰tabæ‰€ç­‰åŒçš„ç©ºæ ¼é•¿åº¦**ï¼Œä¸€èˆ¬æ¥è¯´æœ€å¥½è®¾ç½®æˆ8ï¼Œå› ä¸ºå¦‚æœæ˜¯å…¶å®ƒå€¼çš„è¯ï¼Œå¯èƒ½å¼•èµ·æ–‡ä»¶åœ¨æ‰“å°ä¹‹ç±»çš„åœºåˆä¸­çœ‹èµ·æ¥å¾ˆåˆ«æ‰­ã€‚é™¤éä½ è®¾ç½®äº† **expandtabæ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯æŠŠtabsè½¬æ¢æˆç©ºæ ¼**ï¼Œè¿™æ ·çš„è¯å°±ä¸ä¼šä¸€èµ·æ··æ·†ï¼Œä¸è¿‡æ¯•ç«Ÿåˆ¶è¡¨ç¬¦ä¸º8æ˜¯æœ€å¸¸ç”¨æœ€æ™®éçš„è®¾ç½®ï¼Œæ‰€ä»¥ä¸€èˆ¬è¿˜æ˜¯ä¸è¦æ”¹ã€‚\n\n**softtabstop**ï¼š\n\nå¦‚æœæˆ‘ä»¬å¸Œæœ›æ”¹å˜ç¨‹åºä¸­çš„ç¼©è¿›æ€ä¹ˆåŠï¼Ÿshiftwidthå’Œtabstopä¸ä¸€æ ·çš„è¯ï¼Œä½ ä¼šå‘ç°ç¨‹åºæ¯”è¾ƒéš¾çœ‹çš„ã€‚è¿™æ—¶å€™ï¼Œsofttabstopå°±èµ·ä½œç”¨äº†ã€‚å¯ä»¥ä»vimçš„è¯´æ˜ä¸­çœ‹åˆ°ï¼Œ**ä¸€æ—¦è®¾ç½®äº†softtabstopçš„å€¼æ—¶ï¼Œä½ æŒ‰ä¸‹tabé”®ï¼Œæ’å…¥çš„æ˜¯ç©ºæ ¼å’Œtabåˆ¶è¡¨ç¬¦çš„æ··åˆ**ï¼Œå…·ä½“å¦‚ä½•æ··åˆå–å†³äºä½ è®¾å®šçš„softtabstopï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœè®¾å®šsofttabstop=8,é‚£ä¹ˆæŒ‰ä¸‹tabé”®ï¼Œæ’å…¥çš„å°±æ˜¯æ­£å¸¸çš„ä¸€ä¸ªåˆ¶è¡¨ç¬¦;å¦‚æœè®¾å®š softtabstop=16,é‚£ä¹ˆæ’å…¥çš„å°±æ˜¯ä¸¤ä¸ªåˆ¶è¡¨ç¬¦ï¼›å¦‚æœsofttabstop=12,é‚£ä¹ˆæ’å…¥çš„å°±æ˜¯ä¸€ä¸ªåˆ¶è¡¨ç¬¦åŠ ä¸Š4ä¸ªç©ºæ ¼ï¼›å¦‚æœ softtabstop=4å‘¢ï¼Ÿé‚£ä¹ˆä¸€å¼€å§‹ï¼Œæ’å…¥çš„å°±æ˜¯4ä¸ªç©ºæ ¼ï¼Œæ­¤æ—¶ä¸€æ—¦ä½ å†æŒ‰ä¸‹ä¸€æ¬¡tabï¼Œè¿™æ¬¡çš„å››ä¸ªç©ºæ ¼å°±ä¼šå’Œä¸Šæ¬¡çš„å››ä¸ªç©ºæ ¼ç»„åˆèµ·æ¥å˜æˆä¸€ä¸ªåˆ¶è¡¨ç¬¦ã€‚æ¢å¥è¯è¯´ï¼Œsofttabstopæ˜¯â€œé€¢8ç©ºæ ¼è¿›1åˆ¶è¡¨ç¬¦â€,å‰ææ˜¯ä½ tabstop=8ã€‚\n\nå…³äº**expandtab**\n\nä¸¾ä¸ªä¾‹å­ï¼Œåœ¨å¤šäººä¸€èµ·å¼€å‘é¡¹ç›®æ—¶ï¼Œä¸ºäº†ä½¿ä»£ç é£æ ¼å°½é‡ä¿æŒä¸€è‡´ï¼Œä¸€èˆ¬**ä¸å…è®¸åœ¨ä»£ç ä½¿ç”¨TABç¬¦ï¼Œè€Œä»¥4ä¸ªç©ºæ ¼ä»£ä¹‹**ã€‚æˆ‘ä»¬å¯ä»¥ç¼–è¾‘ä¸€ä¸ªæ–‡ä»¶ï¼ŒåŒ…å«ä¸‹é¢çš„å†…å®¹ï¼š\nset shiftwidth=4\nset expandtab\n\nç„¶åæŠŠä¸‹é¢çš„å‘½ä»¤åŠ å…¥åˆ°.vimrcä¸­ï¼š\nautocmd FileType c,cpp set shiftwidth=4 | set expandtab\n\nå°±å¯ä»¥åªåœ¨ç¼–è¾‘cå’Œcppæ–‡ä»¶æ—¶å®è¡Œè¿™ç§è®¾ç½®äº†\n\n \n\nåˆ é™¤æ‰æ¯ä¸€è¡Œæœ«å°¾çš„ç©ºæ ¼ï¼š\n\nè¡Œæœ«ï¼š`$`\nè¡Œé¦–ï¼š`^`\nç©ºæ ¼ï¼š`\\s`\nè¡Œæœ«ç©ºæ ¼ï¼š`\\s\\+$`\nè¡Œé¦–ç©ºæ ¼ï¼š`^\\+\\s`\næœ‰äº›äººè®¤ä¸ºè¡Œæœ«çš„ç©ºæ ¼æ˜¯æ— ç”¨ï¼Œæµªè´¹è€Œéš¾çœ‹çš„ã€‚è¦åˆ é™¤è¿™äº›æ¯è¡Œåé¢å¤šä½™çš„ç©ºæ ¼ï¼Œå¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\n`:%s/\\s\\+$//`\nå‘½ä»¤å‰é¢æŒ‡æ˜èŒƒå›´æ˜¯\"%\"ï¼Œæ‰€ä»¥è¿™ä¼šä½œç”¨äºæ•´ä¸ªæ–‡ä»¶ã€‚\"substitute\" å‘½ä»¤çš„åŒ¹é…æ¨¡å¼æ˜¯\n`\"\\s\\+$\"`ã€‚è¿™è¡¨ç¤ºè¡Œæœ«ï¼ˆ$ï¼‰å‰çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªï¼ˆ\\+ï¼‰ç©ºæ ¼ï¼ˆ\\sï¼‰ã€‚åé¢æˆ‘ä»¬ä¼šä»‹ç»æ€æ ·\nå†™è¿™æ ·çš„æ¨¡å¼ã€‚\næ›¿æ¢å‘½ä»¤çš„ \"to\" éƒ¨åˆ†æ˜¯ç©ºçš„ï¼š\"//\"ã€‚è¿™æ ·å°±ä¼šåˆ é™¤é‚£äº›åŒ¹é…çš„ç©ºç™½å­—ç¬¦ã€‚\nå¦ä¸€ç§æ²¡æœ‰ç”¨çš„ç©ºæ ¼æ˜¯ Tab å‰é¢çš„å­—ç¬¦ã€‚é€šå¸¸è¿™å¯ä»¥åˆ é™¤è€Œä¸å½±å“æ ¼å¼ã€‚ä½†å¹¶ä¸æ˜¯æ€»è¿™æ ·ï¼æ‰€ä»¥ï¼Œä½ æœ€å¥½æ‰‹å·¥åˆ é™¤å®ƒã€‚æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\n/\nä½ ä»€ä¹ˆéƒ½çœ‹ä¸è§ï¼Œå…¶å®è¿™æ˜¯ä¸€ä¸ªç©ºæ ¼åŠ ä¸€ä¸ª TAB é”®ã€‚ç›¸å½“äº \"/\"ã€‚ç°åœ¨ï¼Œ\nä½ å¯ä»¥ç”¨ \"x\" åˆ é™¤å¤šä½™çš„ç©ºæ ¼ï¼Œå¹¶ä¿è¯æ ¼å¼æ²¡æœ‰æ”¹å˜ã€‚æ¥ç€ä½ å¯ä»¥ç”¨ \"n\" æ‰¾åˆ°ä¸‹ä¸€ä¸ª\nä½ç½®å¹¶é‡å¤è¿™ä¸ªæ“ä½œã€‚\n\n### æ’å…¥æ¨¡å¼(ç¼–è¾‘æ¨¡å¼)\n\n`å‘½ä»¤æ¨¡å¼--i/a/o/s-->æ’å…¥æ¨¡å¼--ESC-->å‘½ä»¤æ¨¡å¼`\n\n- i:åœ¨å…‰æ ‡æ‰€åœ¨å­—ç¬¦å‰å¼€å§‹æ’å…¥\n- a:åœ¨å…‰æ ‡æ‰€åœ¨å­—ç¬¦åå¼€å§‹æ’å…¥\n- o:åœ¨å…‰æ ‡æ‰€åœ¨è¡Œçš„ä¸‹é¢å¦èµ·ä¸€æ–°è¡Œæ’å…¥\n- s:åˆ é™¤å…‰æ ‡æ‰€åœ¨çš„å­—ç¬¦å¹¶å¼€å§‹æ’å…¥\n- I:åœ¨å…‰æ ‡æ‰€åœ¨è¡Œçš„è¡Œé¦–å¼€å§‹æ’å…¥ å¦‚æœè¡Œé¦–æœ‰ç©ºæ ¼åˆ™åœ¨ç©ºæ ¼ä¹‹åæ’å…¥\n- A:åœ¨å…‰æ ‡æ‰€åœ¨è¡Œçš„è¡Œå°¾å¼€å§‹æ’å…¥\n- O:åœ¨å…‰æ ‡æ‰€åœ¨è¡Œçš„ä¸Šé¢å¦èµ·ä¸€è¡Œå¼€å§‹æ’å…¥\n- S:åˆ é™¤å…‰æ ‡æ‰€åœ¨è¡Œå¹¶å¼€å§‹æ’å…¥\n\n### å‘½ä»¤æ¨¡å¼\n\n`åº•è¡Œå‘½ä»¤æ¨¡å¼/æ’å…¥æ¨¡å¼--ESC-->å‘½ä»¤æ¨¡å¼`\n\n```bash\nr #åªæ›¿æ¢ä¸€ä¸ª\nR #ä¸€ç›´æ›¿æ¢ æŒ‰escç»“æŸ\nx #åˆ é™¤ä¸€ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯ä¸èƒ½åˆ é™¤ç©ºè¡Œ\ncc #æ¸…é™¤æ•´è¡Œå¹¶è¿›å…¥æ’å…¥æ¨¡å¼\nshift+cæˆ–C #æ¸…æ¥šæœ¬è¡Œå…‰æ ‡åŠä»¥åçš„å†…å®¹ï¼Œå¹¶è¿›å…¥æ’å…¥æ¨¡å¼\n/ #å¯¹æ–‡æœ¬è¿›è¡Œå…¨æ–‡å‘ä¸‹æœç´¢å­—ç¬¦ä¸²string\tå¦‚ï¼š/text\n? #å¯¹æ–‡æœ¬è¿›è¡Œå…¨æ–‡å‘ä¸Šæœç´¢å­—ç¬¦ä¸²string å¦‚ï¼š?text\nG #åˆ‡æ¢åˆ°æœ«å°¾è¡Œ\n```\n\nviæ‰“å¼€æ–‡ä»¶ï¼Œä»¥æœç´¢\"port\"ä¸ºä¾‹ï¼š\n\nä»å¼€å¤´å¤„å¼€å§‹æœç´¢ï¼š/port\n\nä»ç»“å°¾å¤„å¼€å§‹æœç´¢ï¼š?port\n\nå‘ä¸‹æœç´¢ï¼šn\n\nå‘ä¸Šæœç´¢ï¼šNï¼Œæˆ–è€…shift+nï¼Œæˆ–è€…shift+#\n\n### åº•è¡Œå‘½ä»¤æ¨¡å¼\n\n`å‘½ä»¤æ¨¡å¼--:-->æœ«è¡Œæ¨¡å¼-->`\n\n1:**wq**ä¿å­˜å¹¶é€€å‡º 2:**q!**å¼ºåˆ¶ä¸ä¿å­˜é€€å‡º 3:**w**åªä¿å­˜ 4:**q**ä»…é€€å‡º\n\n```bash\n:n #åˆ‡æ¢åˆ°ç¬¬nè¡Œ\n```\n\n### ç»ƒä¹ \n\n1. å¤åˆ¶51åˆ°60è¡Œï¼Œå¹¶ä¸”ç²˜è´´åˆ°æœ€åä¸€è¡Œåé¢\n\n   ```bash\n   50G\t\t#å…ˆè·³è½¬åˆ°50è¡Œ\n   10yy\t#å¤åˆ¶å…‰æ ‡ä¸‹10è¡Œ\n   G\t\t#è·³è½¬åˆ°æ–‡ä»¶æœ€æœ«\n   p\t\t#ç²˜è´´å¤åˆ¶å†…å®¹\n   ```\n\n2. åˆ é™¤11åˆ°30è¡Œä¹‹é—´çš„20è¡Œ\n\n   ```bash\n   10G\t\t#å…ˆè·³è½¬åˆ°10è¡Œ\n   20dd\t#åˆ é™¤å…‰æ ‡ä¸‹20è¡Œ\n   ```\n\n3. ç§»åŠ¨åˆ°ç¬¬29è¡Œï¼Œå¹¶ä¸”åˆ é™¤15ä¸ªå­—ç¬¦ã€‚\n\n   ```bash\n   29G\t\t#å…ˆè·³è½¬åˆ°29è¡Œ\n   15x\t\t#xè¡¨ç¤ºåˆ é™¤å…‰æ ‡æ‰€åœ¨ä½ç½®çš„ä¸€ä¸ªå­—ç¬¦ï¼ŒXè¡¨ç¤ºåˆ é™¤å…‰æ ‡æ‰€åœ¨ä½ç½®çš„å‰é¢ä¸€ä¸ªå­—ç¬¦ï¼Œå‰é¢åŠ æ•°å­—å¯ä»¥åˆ é™¤æŒ‡å®šä¸ªã€‚\n   ```\n\n## gcc\n\nå…³äºç¼–è¯‘é“¾æ¥æ›´å¤šå†…å®¹è¯·æŸ¥çœ‹æ–‡ç« â€œLinux_åº“â€ã€‚\n\n```bash\ngcc -o main main.c\n```\n\n## è¿›ç¨‹æ“ä½œ\n\n```bash\n# è¿›ç¨‹æ“ä½œåŸºæœ¬å‘½ä»¤\nps\t\t#æŸ¥çœ‹å½“å‰ç»ˆç«¯ä¸­è¿è¡Œçš„è¿›ç¨‹\nkill\t#ç»“æŸè¿›ç¨‹\njobs \t#æŸ¥çœ‹åå°è¿è¡Œçš„è¿›ç¨‹\n&\t\t#æ”¾åˆ°åå°è¿è¡Œ\n```\n\n## å¸®åŠ©æ‰‹å†Œå‘½ä»¤-man\n\n```bash\nman #å¸®åŠ©æ–‡æ¡£ 1.å‘½ä»¤ 2.ç³»ç»Ÿè°ƒç”¨ 3.åº“å‡½æ•°\n#printf æ—¢æœ‰å‘½ä»¤ä¹Ÿæœ‰åº“å‡½æ•°ï¼Œè€Œmané»˜è®¤è¾“å‡ºå‘½ä»¤ç›¸å…³æ–‡æ¡£ï¼Œæ‰€ä»¥è¦è¾“å‡ºåº“å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬è¦åŠ  3\nman 3 printf\n```\n\n# å¿«æ·é”®\n\n| åŠŸèƒ½     | å¿«æ·é”®     |\n| -------- | ---------- |\n| æ‰“å¼€ç»ˆç«¯ | Ctrl+Alt+T |\n\n# ä¸€äº›éœ€è¦æœç´¢æ‰çŸ¥é“çš„æ“ä½œ\n\n1. ç½‘ä¸Šä¸‹è½½çš„debå®‰è£…åŒ…åŒå‡»åæç¤ºâ€è½¯ä»¶æ— æ³•å®‰è£…:ä¸æ”¯æŒâ€œã€‚\n\n   ```bash\n   sudo dpkg -i google-chrome-stable_current_amd64.deb\n   ```\n\n2. å…³é—­æ²¡æœ‰å¿…è¦çš„åŠ¨ç”»ç‰¹æ•ˆ\n\n   ```bash\n   gsettings set org.gnome.desktop.interface enable-animations false\n   ```\n\n3. æ‰¾ä¸åˆ°ç¯å¢ƒæ–‡ä»¶å¤¹â€”â€”é“¾æ¥\n\n   https://stackoverflow.com/questions/3655306/ubuntu-usr-bin-env-python-no-such-file-or-directory\n\n   ```bash\n   whereis python3\n   sudo ln -s /usr/bin/python3 /usr/bin/python\n   ```\n\n","categories":["Linux"]},{"title":"Redis_dict","url":"/Redis/Redis_dict/","content":"\n# å¼•ä¾‹\n\nå›¾ä¹¦é¦†å€Ÿä¹¦é—®é¢˜ï¼Œå›¾ä¹¦é¦†æœ‰æˆåƒä¸Šä¸‡æœ¬å›¾ä¹¦ï¼Œæœ€åˆï¼Œéœ€è¦æœ‰ä¸€ä¸ªæœ¬å­è®°å½•å“ªä¸€å¤©å­¦ç”Ÿè®°å½•çš„æƒ…å†µã€‚æœ€åˆä»¥æ—¥æœŸä¸ºç¼–å·è®°å½•æŸä¸€å¤©æ¥å€Ÿä¹¦çš„æƒ…å†µã€‚å½“æœ‰äººæ¥è¿˜ä¹¦æ—¶ï¼Œéœ€è¦å…ˆé—®æ¸…å€Ÿä¹¦è€…æ˜¯å‡ å·æ¥å€Ÿçš„ï¼Œç„¶åè¿˜è¦åœ¨è¿™å¤©çš„è®°å½•é‡Œä¾æ¬¡æ‰¾åˆ°å…·ä½“ä¿¡æ¯ã€‚å¦‚æœå€Ÿä¹¦è€…æ¸…æ¥šè‡ªå·±æ˜¯å‡ å·å€Ÿçš„è¿˜å¥½è¯´ï¼Œä½†æ˜¯å¦‚æœä¸è®°å¾—äº†å‘¢ï¼Ÿæ¯”å¦‚è¯´ä»–åªè®°å¾—å¥½åƒæ˜¯ä¸Šä¸Šä¸ªæœˆæ¥å€Ÿçš„ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸€å¤©ä¸€å¤©çš„ä»å¤´åˆ°å°¾æŸ¥æ‰¾è®°å½•ï¼Œæ˜¾ç„¶æ•ˆç‡æ˜¯ä½ä¸‹çš„ã€‚\n![image-20210807233939705](../../images/Redis_dict/image-20210807233939705.png)\né‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¦‚æ­¤æ”¹è¿›ï¼šæˆ‘ä»¬æä¸€ä¸ª`000 0000 0000 ~ 199 9999 9999`é¡µçš„æœ¬å­ï¼ŒæŸåŒå­¦å€Ÿä¹¦æ—¶è®©ä»–æä¾›ç”µè¯å·ç ï¼Œä»¥ç”µè¯å·ç ä¸ºåŸºå‡†è®°å½•ä¿¡æ¯ã€‚å¾…è¿˜ä¹¦æ—¶ï¼Œåªéœ€è¦æŠ¥ç”µè¯å·åˆ™å¯ä»¥ç›´æ¥æ‰¾åˆ°è®°å½•ã€‚ä½†æ­¤æ–¹æ³•ä¸ç°å®ï¼Œå› ä¸ºæœ¬å­å¤ªåšï¼Œè¦èŠ±è´¹çš„ç©ºé—´å¤ªå¤§ã€‚\n![image-20210807234740133](../../images/Redis_dict/image-20210807234740133.png)\nå†æ”¹è¿›ï¼šåšä¸€ä¸ª1000é¡µçš„æœ¬å­ï¼Œå› ä¸ºç”µè¯å·ç çš„èŒƒå›´è¿œè¿œå¤§äºé¡µæ•°ï¼Œæˆ‘ä»¬è¦æƒ³åŠæ³•ä½¿ç”µè¯å·ç æ˜ å°„åˆ°é¡µæ•°ï¼Œåˆ™è¿™ä¸ªæ˜ å°„æ–¹æ¡ˆåˆ™ç§°ä¸ºâ€œå“ˆå¸Œå‡½æ•°â€ã€‚å¦‚AåŒå­¦ç”µè¯å·ç ä¸º137 3456 9090ï¼Œå¯å–åä¸‰ä½090ï¼Œå­˜åˆ°90é¡µã€‚BåŒå­¦ç”µè¯å·ç ä¸º186 7890 1234ï¼Œå–åä¸‰ä½234ï¼Œå­˜åˆ°234é¡µã€‚\n![image-20210807235252067](../../images/Redis_dict/image-20210807235252067.png)\næ­¤æ—¶åˆæ¥äº†ä¸€ä¸ªCåŒå­¦ï¼Œç”µè¯å·ç ä¸º156 9090 1234ï¼Œè™½ç„¶å…³é”®ç ä¸BåŒå­¦ä¸ä¸€æ ·ï¼Œä½†ä½ç½®ä¿¡æ¯ä¸€æ ·ï¼Œåˆ™ç§°ä¹‹ä¸ºâ€œå“ˆå¸Œå†²çªâ€ã€‚\n# å“ˆå¸Œè¡¨\n\n## ä»€ä¹ˆæ˜¯å“ˆå¸Œè¡¨\n\nä¸¥è”šæ•ç‰ˆæœ¬çš„æ•°æ®ç»“æ„æ•™æä¸­æŒ‡å‡ºï¼Œåœ¨è¯¸å¦‚çº¿æ€§è¡¨ã€æ ‘ç»“æ„ä¸­ï¼Œâ€œè®°å½•â€ä¸­ç»“æ„ä¸­çš„ç›¸å¯¹ä½ç½®æ˜¯éšæœºçš„ï¼Œå’Œâ€œè®°å½•â€çš„å…³é”®å­—ä¹‹é—´ä¸å­˜åœ¨ç¡®å®šçš„å…³ç³»ï¼Œå› æ­¤ï¼Œåœ¨ç»“æ„ä¸­æŸ¥æ‰¾è®°å½•æ—¶éœ€è¿›è¡Œä¸€ç³»åˆ—å’Œå…³é”®å­—çš„æ¯”è¾ƒã€‚æ¯”å¦‚ï¼Œæ•°ç»„å­˜æ”¾çš„ä»å°åˆ°å¤§çš„10ä¸ªæ•°æ®ï¼Œè¦ç”¨äºŒåˆ†æŸ¥æ‰¾æ³•æ‰¾å‡ºæŸvalueçš„ä¸‹æ ‡å€¼å°±éœ€è¦ä¸€ç›´æ¢æµ‹ã€‚è¿™ä¸€ç±»æŸ¥æ‰¾æ–¹æ³•å»ºç«‹åœ¨â€œæ¯”è¾ƒâ€çš„åŸºç¡€ä¸Šã€‚åœ¨é¡ºåºæŸ¥æ‰¾æ—¶ï¼Œæ¯”è¾ƒçš„ç»“æœä¸ºâ€œ=â€ä¸â€œâ‰ â€ä¸¤ç§å¯èƒ½ï¼›åœ¨æŠ˜åŠæŸ¥æ‰¾ã€äºŒå‰æ’åºæ ‘æŸ¥æ‰¾å’ŒBæ ‘æŸ¥æ‰¾æ—¶ï¼Œæ¯”è¾ƒçš„ç»“æœä¸ºâ€œ<â€ã€â€œ=â€å’Œâ€œ>â€3ç§å¯èƒ½ã€‚æŸ¥æ‰¾çš„æ•ˆç‡ä¾èµ–äºæŸ¥æ‰¾è¿‡ç¨‹ä¸­æ‰€è¿›è¡Œçš„æ¯”è¾ƒæ¬¡æ•°ã€‚\n\næˆ‘ä»¬æ‰€å‘å¾€çš„ç†æƒ³çš„æƒ…å†µæ˜¯å¸Œæœ›ä¸ç»è¿‡ä»»ä½•æ¯”è¾ƒï¼Œä¸€æ¬¡å­˜å–ä¾¿èƒ½å¾—åˆ°æ‰€æŸ¥è®°å½•ï¼Œé‚£å°±å¿…é¡»åœ¨è®°å½•çš„**å­˜å‚¨ä½ç½®**å’Œå®ƒçš„**å…³é”®å­—**ä¹‹é—´å»ºç«‹ä¸€ä¸ªç¡®å®šçš„å¯¹åº”å…³ç³»fï¼Œä½¿æ¯ä¸ªå…³é”®å­—å’Œç»“æ„ä¸­ä¸€ä¸ªæƒŸä¸€çš„å­˜å‚¨ä½ç½®ç›¸å¯¹åº”ã€‚å› è€Œåœ¨æŸ¥æ‰¾æ—¶åªè¦æ ¹æ®è¿™ä¸ªå¯¹åº”å…³ç³»fæ‰¾åˆ°ç»™å®šå€¼Kçš„â€œåƒâ€f(K)ä¾¿èƒ½æ‰¾åˆ°å…¶å­˜å‚¨ä½ç½®ã€‚è‹¥ç»“æ„ä¸­å­˜åœ¨å…³é”®å­—å’ŒKç›¸ç­‰çš„è®°å½•ï¼Œåˆ™å¿…å®šåœ¨f(K)è¿™ä¸ªå­˜å‚¨ä½ç½®ä¸Šï¼Œç”±æ­¤ä¸éœ€è¦æ¯”è¾ƒä¾¿å¯ç›´æ¥å–å¾—æ‰€æŸ¥è®°å½•ã€‚åœ¨æ­¤æˆ‘ä»¬ç§°è¿™ä¸ªå¯¹åº”å…³ç³»fä¸º**å“ˆå¸Œï¼ˆHashï¼‰å‡½æ•°**ï¼Œç”±æ­¤æ€æƒ³å»ºç«‹çš„è¡¨ç§°ä¸º**å“ˆå¸Œè¡¨**ã€‚\n\n```c\n#include<stdio.h>\n#include<assert.h>\n#define NIL -1\n#define m 13\ntypedef int KeyType;\nstruct ElemType\n{\n  \tKeyType key;\n    void* ptr;\t//value\n};\ntypedef struct\n{\n    ElemType data[m];\n    int cursize;\n}HashTable;\n```\n\n![image-20210808011308669](../../images/Redis_dict/image-20210808011308669.png)\n\n```c\nvoid Init_HashTable(HashTable* pt)\n{\n    assert(pt != nullptr);\n    pt->cursize = 0;\n    for(int i=0;i<m;++i)\n    {\n        pt->data[i].key = NIL;\n        pt->data[i].ptr = nullptr;\n    }\n}\nint Hash(KeyType kx)\n{\n    return kx%m;\n}\nbool Insert_Item(HashTable* pt, ElemType item)\n{\n    assert(pt != nullptr);\n    int index = Hash(item.key);\n    pt->data[index] = item;\n    pt->cursize += 1;\n}\nint main()\n{\n    HashTable ht;\n    Init_HashTable(&ht);\n    int ar[]={12,23,25,8,19,29};\n    int n=sizeof(ar)/sizeof(ar[0]);\n    for(int i=0;i<n;++i)\n    {\n        struct ElemType item = {ar[i],nullptr};\n        bool tag = Insert_Item(&ht,item);\n    }\n}\n```\n\nä½†æ˜¯è¿™ç§Insert_Itemå‡½æ•°æ˜¯æœ‰é—®é¢˜çš„ï¼Œæ²¡æœ‰è§£å†³**å“ˆå¸Œå†²çª**é—®é¢˜ï¼Œæ¯”å¦‚åœ¨æ’å…¥keyä¸º25çš„å…ƒç´ æ—¶ä¼šæ›¿æ¢æ‰å‰æœŸå·²ç»æ’å…¥çš„keyä¸º12çš„å…ƒç´ ã€‚\n\n![image-20210808013500159](../../images/Redis_dict/image-20210808013500159.png)\n\nä»¥ä¸‹æ¥é€šè¿‡ **ï¼ˆå¢é‡ï¼‰çº¿æ€§æ¢æµ‹æ³•**æ¥è§£å†³å“ˆå¸Œå†²çªã€‚\n\n```c\nint Inc(int i)\n{\n    return i;\n}\nint Hash_Inc(KeyType kx, int i)\n{\n    return (Hash(kx) + Inc(i))%m;\n}\nbool Insert_Item(HashTable* pt, ElemType item)\n{\n    assert(pt != nullptr);\n    for(int i = 0;i<m;++i)\n    {\n        int index = Hash_Inc(item.key, i);\n        if(pt->data[i].key == NIL)//éšç€Incæ›´è¿­ï¼Œæ‰¾åˆ°ä¸€ä¸ªç©ºä½ç½®\n        {\n            pt->data[index] = item;\n            pt->cursize += 1;\n            return true;\n        }\n    }\n    return false;\n}\n```\n\n```c\nint main()\n{\n    HashTable ht;\n    Init_HashTable(&ht);\n    int ar[]={12,15,28,23,25,38,36,49,14};\n    int n=sizeof(ar)/sizeof(ar[0]);\n    for(int i=0;i<n;++i)\n    {\n        struct ElemType item = {ar[i],nullptr};\n        bool tag = Insert_Item(&ht,item);\n    }\n}\n```\n\n![image-20210808015044675](../../images/Redis_dict/image-20210808015044675.png)\n\nè¿™ç§**çº¿æ€§æ¢æµ‹æ³•**è™½ç„¶è§£å†³äº†å“ˆå¸Œå†²çªï¼Œä½†æœ€ç»ˆçš„æ•°æ®åˆ†å¸ƒå¤ªå †ç§¯åŒ–ã€‚å¯ä»¥é€šè¿‡**å¹³æ–¹æ¢æµ‹æ³•**æ”¹å–„æ­¤é—®é¢˜ã€‚\n\n```c\nint Inc(int i)\n{\n    return i*i;\n}\n```\n\nä½†æ— è®ºæ˜¯**çº¿æ€§æ¢æµ‹æ³•**å­˜å‚¨è¿˜æ˜¯**å¹³æ–¹æ¢æµ‹æ³•**å­˜å‚¨ï¼Œåœ¨è¿™ç§çº¯é¡ºåºè¡¨ï¼ˆæ•°ç»„ï¼‰ä¸­å®ç°å“ˆå¸Œè¡¨ä¼šé‡åˆ°ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ï¼å³æ’å…¥æ•°æ®åï¼Œä¸èƒ½è½»æ˜“åˆ é™¤æŸä¸€ä¸ªæ•°æ®ï¼Œå› ä¸ºåˆ é™¤äº†æŸä¸€æ•°æ®åï¼ŒæŸ¥æ‰¾å¦å¤–çš„æ•°æ®å°±ä¼šå‡ºç°æ•°æ®æ–­å±‚å¯¼è‡´ä¸èƒ½æ­£å¸¸æ¢æµ‹ã€‚æ¯”å¦‚ä¸‹å›¾ï¼šå¦‚æœæŠŠ3ä¸‹æ ‡çš„28åˆ é™¤ï¼Œåˆ™æŸ¥æ‰¾keyä¸º49çš„å…ƒç´ æ—¶ï¼Œç¬¬ä¸€æ¬¡æ¢æµ‹49%13=10ï¼Œ23ä¸ç­‰äº49ï¼Œç¬¬äºŒæ¬¡æ¢æµ‹ï¼ˆçº¿æ€§æ¢æµ‹ï¼Œä¸‹æ ‡+1ï¼‰ï¼Œ36ä¸ç­‰äº49ï¼Œç¬¬ä¸‰æ¬¡æ¢æµ‹ï¼Œ12ä¸ç­‰äº49ï¼Œâ€¦â€¦ï¼Œç›´åˆ°æ¢æµ‹åˆ°ä¸‹æ ‡3ï¼Œå‘ç°keyå€¼ä¸º-1ã€‚å¦‚æœæˆ‘ä»¬åœæ­¢æ¢æµ‹è¿”å›ï¼Œåˆ™æ˜¯é”™è¯¯çš„ï¼›æ‰€ä»¥æˆ‘ä»¬åªèƒ½é‡åˆ°-1ä¸åœæ­¢ç»§ç»­æ¢æµ‹ï¼Œé‚£ä¹ˆå°±å¤±å»äº†å“ˆå¸Œè¡¨çš„æ„ä¹‰ï¼Œè¿™ç›¸å½“äºåœ¨æŸ¥æŸä¸ªkeyå¯¹åº”çš„valueæ—¶æœ‰å¯èƒ½æŠŠæ•´ä¸ªè¡¨éƒ½éå†äº†ä¸€éã€‚\n\n```c\nvoid* FindValue(HashTable* pt, KeyType kx)\n{\n    assert(pt != nullptr);\n    for(int i = 0;i<m;++i)\n    {\n        int pos = Hash_Inc(kx,i);\n        if(pt->data[pos].key==kx)\n        {\n            return pt->data[pos].ptr;\n        }\n        if(pt->data[pos].key==NIL)\n        {\n            return nullptr;\n        }\n    }\n}\n```\n\n![image-20210808020035825](../../images/Redis_dict/image-20210808020035825.png)\n\n## é“¾åœ°å€æ³•\n\næ‰€ä»¥æˆ‘ä»¬è¦æ”¹å˜è¿™ç§å­˜å‚¨å“ˆå¸Œè¡¨çš„æ–¹å¼ï¼Œæ”¹ç”¨**é“¾åœ°å€æ³•**å­˜å‚¨ã€‚ï¼ˆè§†é¢‘01:27:42ï¼‰\n\n![image-20210808191518194](../../images/Redis_dict/image-20210808191518194.png)\n\nçœ‹å›¾è®¾è®¡ç»“æ„\n\n```c\n#include<stdio.h>\n#include<assert.h>\n#define m 13\ntypedef int KeyType;\ntypedef struct ElemType\n{\n    KeyType key;\n    void* ptr;\n}ElemType;\ntypedef struct HashNode\n{\n    ElemType data;\n    struct HashNode* next;\n}HashNode;\ntypedef struct HashTable\n{\n    HashNode* table[m];\n    int cursize;\n}HashTable;\n```\n\n### æµ‹è¯•ä»£ç \n\n```c\nint Hash(KeyType kx)\n{\n    return kx % m;\n}\nvoid Init_Hash(HashTable* pt)\n{\n    assert(pt!=nullptr);\n    for(int i = 0;i<m;++i)\n    {\n        pt->table[i] = nullptr;\n    }\n    pt->cursize = 0;\n}\nvoid Insert_Item(HashTable* pt, ElemType item)//ä½†æ˜¯æ­¤å‡½æ•°æ²¡æœ‰è§£å†³å­˜åœ¨ç›¸åŒkeyæ—¶çš„æƒ…å†µ\n{\n    assert(pt!=nullptr);\n    int index = Hash(item.key);\n    HashNode* s = (HashNode*)malloc(sizeof(HashNode));\n    if(nullptr == s) exit(1);\n    s->data = item;\n    s->next = pt->table[index];\n    pt->table[index] = s;\n    pt->cursize += 1;\n}\nint main()\n{\n    int ar[]={1,55,19,20,10,11,14,68,84,23,27,79};\n    int n = sizeof(ar)/sizeof(ar[0]);\n    HashTable ht;\n    Init_Hash(&ht);\n    for(int i = 0;i<n;++i)\n    {\n        ElemType elem = {ar[i],nullptr};\n        Insert_Item(&ht,elem);\n    }\n}\n```\n\n## API\n\n### Init\n\n```c\nvoid Init_Hash(HashTable* pt)\n{\n    assert(pt != nullptr);\n    for(int i = 0;i<m;++i)\n    {\n        pt->table[i]=nullptr;\n    }\n    pt->cursize=0;\n}\n```\n\n### Insert\n\n```c\nvoid Insert_Item(HashTable* pt, ElemType item)\n{\n    assert(pt != nullptr);\n    int index = Hash(item.key);\n    HashNode* pnode = (HashNode*)malloc(sizeof(*pnode));\n    if (nullptr == pnode) exit(1);\n    pnode->data = item;//è®²å¤–éƒ¨elemå°è£…åˆ°æ–°å»ºç»“ç‚¹çš„æ•°æ®åŸŸ\n    //ä»¥ä¸‹ä¸¤æ­¥ä¸ºå…¥è¡¨æ“ä½œï¼Œé‡‡ç”¨å¤´æ’æ³•ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œä¸ç”¨åˆ¤å¤´ç»“ç‚¹æ˜¯å¦ä¸ºç©º\n    pnode->next = pt->table[index];\n    pt->table[index] = pnode;\n    \n    pt->cursize++;//ç°æœ‰å¤§å°+1\n}\n```\n\n### FindNode\n\næŸ¥çœ‹å­—å…¸ä¸­æ˜¯å¦å·²å­˜åœ¨æŸkeyå€¼å¯¹åº”çš„èŠ‚ç‚¹å¹¶è¿”å›ã€‚\n\n```c\nHashNode* FindNode(HashTable* pt, KeyType kx)\n{\n\tint index = Hash(kx);\n\tHashNode* p = pt->data[index];\n\twhile (p != nullptr && p->item.key != kx)\n\t{\n\t\tp = p->next;\n\t}\n\treturn p;\n}\n```\n\n### Clear\n\nè‡ªå·±å†™çš„\n\n```c\n//freeæ‰æ‰€æœ‰èŠ‚ç‚¹ï¼ŒHashTableçš„æŒ‡é’ˆæ•°ç»„æ•°æ®å…¨èµ‹ç©º\nvoid ClearTable(HashTable* pt)\n{\n\tfor (int i = 0;i < m;++i)\n\t{\n\t\tHashNode* p = pt->data[i];\n\t\tHashNode* q = nullptr;\n\t\twhile (p)\n\t\t{\n\t\t\tq = p->next;\n\t\t\tfree(p);\n\t\t\tpt->cursize--;\n\t\t\tp = q;\n\t\t}\n\t\tpt->data[i] = nullptr;\n\t}\n}\n```\n\nè€å¸ˆå†™çš„\n\n```c\nvoid ClearHash(HashTable* pt)\n{\n    for(int i = 0;i<m;++i)\n    {\n        while(pt->data[i]!=nullptr)\n        {\n            HashNode* q = pt->data[i];\n            pt->data[i]=q->next;\n            free(q);\n        }\n    }\n    pt->cursize=0;\n}\n```\n\n### Remove\n\n```c\n//åˆ é™¤æŸä¸€èŠ‚ç‚¹ï¼Œéœ€ç”¨åˆ°ä¸¤ä¸ªæŒ‡é’ˆå˜é‡ï¼Œä¸€å‰ä¸€åã€‚\nvoid RemoveNode(HashTable* pt, KeyType kx)\n{\n\n\tint index = Hash(kx);\n\tHashNode* p = pt->data[index];\n\tif (p == nullptr) exit(1);//ä¸å­˜åœ¨è¦åˆ é™¤çš„keyçš„å¯¹åº”èŠ‚ç‚¹ï¼Œå› ä¸ºTableæ•°ç»„æ­¤ä¸‹æ ‡çš„å€¼æ—¢ç„¶ä¸ºç©ºåˆ™è‚¯å®šä¸ä¼šæœ‰keyå€¼ç›¸åº”çš„èŠ‚ç‚¹å­˜åœ¨\n\tHashNode* q = p->next;\n\t//è‹¥åˆ é™¤çš„èŠ‚ç‚¹ä¸ºå¤´ç»“ç‚¹ï¼Œåˆ™ç‰¹æ®Šå¤„ç†\n\tif (p->item.key == kx)\n\t{\n\t\tpt->data[index] = q;\n\t\tfree(p);\n\t}\n\telse//\n\t{\n\t\twhile (q != nullptr && q->item.key != kx)\n\t\t{\n\t\t\tp = p->next;\n\t\t\tq = q->next;\n\t\t}\n\t\tif (q == nullptr) exit(1);//ä¸å­˜åœ¨è¦åˆ é™¤çš„keyçš„å¯¹åº”èŠ‚ç‚¹ï¼Œå› ä¸ºéå†è¿™ä¸€æ¡é“¾åä¸å­˜åœ¨ç›¸åŒçš„keyå€¼å¯¹åº”çš„èŠ‚ç‚¹ã€‚\n\t\telse//q->item.key == kx\n\t\t{\n\t\t\tp->next = q->next;\n\t\t\tfree(q);\n\t\t}\n\t}\n\tpt->cursize--;\n\treturn;\n}\n```\n\nè€å¸ˆå†™æ³•\n\n```c\n//RemoveèŠ‚ç‚¹æ›´è€å¥—çš„å†™æ³•ï¼š\nbool Remove(HashTable* pt,KeyType kx)\n{\n    assert(pt!=nullptr);\n    int index=Hash(kx);\n    HashNode* pr=nullptr;//å‰é©±æŒ‡é’ˆ\n    HashNode* p=pt->table[index];\n    while(p!=nullptr)\n    {\n        if(p->item.key==kx)\n        {\n            if(pr!=nullptr)\n            {\n                pr->next=p->next;\n            }\n            else\n            {\n                pt->table[index]=p->next;\n            }\n            free(p);\n            pt->total-=1;\n            return true;\n        }\n        pr=p;\n        p=p->next;\n    }\n    return false;\n}\n```\n\n## ä¹ é¢˜\n\nå®šä¹‰å¤§å°ä¸º100 çš„æ•´å‹æ•°ç»„ï¼Œä½¿ç”¨éšæœºå‡½æ•°ç»™æ•°ç»„å…ƒç´ èµ‹å€¼ã€‚æ•°å€¼çš„èŒƒå›´æ˜¯1 .. 100 ï¼Œå¹¶ä¸”ä¸å®¹è®¸é‡å¤ã€‚\n\n```c\nint* My_NonRepeating_RandArr(int* ar, int n)\n{\n    assert(ar != nullptr);\n    int br[101];\n    for (int i = 0;i < n + 1;++i)\n    {\n        br[i]=0;\n    }\n    int temp;\n    srand(time(NULL));\n    int i = 0;\n    do\n    {\n        temp = rand() % 100 + 1;\n        if (br[temp] != 1)\n        {\n            br[temp] = 1;\n            ar[i] = temp;\n            ++i;\n        }\n    } while (i<n);\n    return ar;\n}\n```\n\nå¦‚æœé¢˜ä¸­æ•°ç»„å¤§å°æ”¹ä¸º1000000ï¼Œé‚£ä¹ˆæ•°ç»„å¼€è¾Ÿç©ºé—´å°±å¾ˆå¤§ï¼Œå¦‚æœä»ç„¶æŒ‰ç…§æ—§çš„æ–¹å¼å»åšè‚¯å®šæ˜¯å¯¹ç¨‹åºä¸åˆ©çš„ã€‚è€ƒè™‘ç”¨å“ˆå¸Œç®—æ³•è§£å†³ï¼\n\n```c\n#include<stdio.h>\n#include<assert.h>\n#define m 100\ntypedef int KeyType;\ntypedef struct ElemType\n{\n    KeyType key;\n    void* ptr;\n}ElemType;\ntypedef struct HashNode\n{\n    ElemType data;\n    struct HashNode* next;\n}HashNode;\ntypedef struct HashTable\n{\n    HashNode* table[m];\n    int cursize;\n}HashTable;\nvoid Init_Hash(HashTable* pt)\n{\n    assert(pt != nullptr);\n    for(int i = 0;i<m;++i)\n    {\n        pt->table[i]=nullptr;\n    }\n    pt->cursize=0;\n}\nvoid Insert_Item(HashTable* pt, ElemType item)\n{\n    assert(pt != nullptr);\n    int index = Hash(item.key);\n    HashNode* pnode = (HashNode*)malloc(sizeof(*pnode));\n    if (nullptr == pnode) exit(1);\n    pnode->data = item;//è®²å¤–éƒ¨elemå°è£…åˆ°æ–°å»ºç»“ç‚¹çš„æ•°æ®åŸŸ\n    //ä»¥ä¸‹ä¸¤æ­¥ä¸ºå…¥è¡¨æ“ä½œï¼Œé‡‡ç”¨å¤´æ’æ³•ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œä¸ç”¨åˆ¤å¤´ç»“ç‚¹æ˜¯å¦ä¸ºç©º\n    pnode->next = pt->table[index];\n    pt->table[index] = pnode;\n    \n    pt->cursize++;//ç°æœ‰å¤§å°+1\n}\nint Hash(KeyType kx)\n{\n    return kx%m;\n}\nHashNode* FindValue(HashTable* pt, KeyType kx)\n{\n    int index = Hash(kx);\n    HashNode* p = pt->table[index];\n    while(p != nullptr && p->data.key != kx)\n    {\n        p=p->next;\n    }\n    return p;\n}\nint* My_NonRepeating_Hash(int* ar, int n)\n{\n    assert(ar != nullptr);\n    HashTable ht;\n    Init_Hash(&ht);\n    int temp;\n    srand(time(NULL));\n    int i = 0;\n    do\n    {\n        temp = rand()* rand() % 1000000 + 1;\n        if (FindValue(&ht, temp) == nullptr || *(int*)(FindValue(&ht, temp)->data.ptr) != 1)\n        {\n            ElemType item = { temp,new int(1) };\n            Insert_Item(&ht, item);\n            ar[i] = temp;\n            ++i;\n        }\n    } while (i < n);\n    return ar;\n}\nint main()\n{\n    \n}\n```\n\nè€å¸ˆå†™çš„\n\n```c\n#include<assert.h>\n#define m 13\n#define INC\t2\ntypedef int KeyType;\ntypedef struct\n{\n    KeyType key;\n    void* ptr;\n}ElemType;\ntypedef struct HashNode\n{\n    ElemType data;\n    struct HashNode* next;\n}HashNode;\ntypedef struct HashTable\n{\n    HashNode** table;\n    int capacity;\n    int total;\n}HashTable;\nint Hash(HashTable* pt, KeyType kx)\n{\n    //return kx % m; //åŸå§‹ä¸è€ƒè™‘å¢å®¹çš„æƒ…å†µä¸‹é»˜è®¤%m\n    return kx % pt->capacity;\n}\nvoid Init_Hash(HashTable* pt)\n{\n    assert(pt!=nullptr);\n    pt->table = (HashNode**)malloc(sizeof(HashNode*)*m);\n    if(pt->table == nullptr)exit(EXIT_FAILURE);\n    pt->capacity = m;\n    for(int i = 0;i<pt->capacity;++i)\n    {\n        pt->table[i] = nullptr;\n    }\n    pt->total = 0;\n}\nHashNode* FindNode(HashTable* pt, KeyType kx)\n{\n    int index = Hash(pt,kx);\n    HashNode* p = pt->table[index];\n    while(p != nullptr && p->data.key != kx)\n    {\n        p=p->next;\n    }\n    return p;\n}\nbool Inc(HashTable* pt)//å¯¹å“ˆå¸Œè¡¨çš„å¢å®¹æ“ä½œ\n{\n    int incsize = pt->capacity * INC;//INCä¸ºå¢å®¹ç³»æ•°ï¼Œé»˜è®¤ä¸º2ï¼Œincsizeè¡¨ç¤ºå¢å®¹åçš„æ–°å¤§å°ï¼Œä¸ºæ­¤å‰å“ˆå¸Œè¡¨å®¹é‡çš„2å€ã€‚\n    HashNode** newtable = (HashNode**)malloc(sizeof(HashNode*)*incsize);\n    if(newtable == nullptr)return false;\n    for(int i = 0;i<incsize;++i)\n    {\n        newtable[i] = nullptr;\n    }\n    pt->captacity = incsize;\n    //ä»¥ä¸Šï¼Œå¼€è¾Ÿæ–°çš„å“ˆå¸Œè¡¨å®Œæ¯•ï¼Œä¸‹é¢è¦æŠŠæ—§è¡¨å¤åˆ¶åˆ°æ–°è¡¨\n    int oldsize = pt->capacity;\n    for(int i = 0;i<oldsize;++i)\n    {\n        if(pt->table[i]!=nullptr)\n        {\n            \n        }\n    }\n}\nbool Insert_Item(HashTable* pt, ElemType item)\n{\n    assert(pt!=nullptr);\n    HashNode* p = FindNode(pt,item.key);\n    if(p!=nullptr)return false;//å“ˆå¸Œè¡¨ä¸­å·²å­˜åœ¨ç›¸åŒkeyå€¼çš„èŠ‚ç‚¹\n    if(pt->total > pt->capacity && !Inc(pt))//éœ€è¦å¢å®¹ä½†æ²¡æœ‰å¢å®¹æˆåŠŸ\n    {\n        return false;\n    }\n    int index \n}\n```\n\nC++å°±ä¸€ä¸ªä¸œè¥¿å¼•ç”¨è¿”å›ï¼ŒBç«™çš„è€å¸ˆæ°¸è¿œæä¸æ¸…æ¥š\n\n# Rediså­—å…¸\n\nå­—å…¸ï¼Œåˆç§°ä¸ºç¬¦å·è¡¨(symbol table)ã€å…³è”æ•°ç»„(associative array)æˆ–æ˜ å°„(map)ï¼Œæ˜¯ä¸€ç§ç”¨äºä¿å­˜é”®å€¼å¯¹(key-value pair)çš„æŠ½è±¡æ•°æ®ç»“æ„ã€‚\nåœ¨å­—å…¸ä¸­ï¼Œä¸€ä¸ªé”®(key)å¯ä»¥å’Œä¸€ä¸ªå€¼(value)è¿›è¡Œå…³è”ï¼ˆæˆ–è€…è¯´å°†é”®æ˜ å°„ä¸ºå€¼ï¼‰ï¼Œè¿™äº›å…³è”çš„é”®å’Œå€¼å°±ç§°ä¸ºé”®å€¼å¯¹ã€‚\nå­—å…¸ä¸­çš„æ¯ä¸ªé”®éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œç¨‹åºå¯ä»¥åœ¨å­—å…¸ä¸­æ ¹æ®é”®æŸ¥æ‰¾ä¸ä¹‹å…³è”çš„å€¼ï¼Œæˆ–è€…é€šè¿‡é”®æ¥æ›´æ–°å€¼ï¼Œåˆæˆ–è€…æ ¹æ®é”®æ¥åˆ é™¤æ•´ä¸ªé”®å€¼å¯¹ï¼Œç­‰ç­‰ã€‚\nå­—å…¸ç»å¸¸ä½œä¸ºä¸€ç§æ•°æ®ç»“æ„å†…ç½®åœ¨å¾ˆå¤šé«˜çº§ç¼–ç¨‹è¯­è¨€é‡Œé¢ï¼Œä½†Redisæ‰€ä½¿ç”¨çš„Cè¯­è¨€å¹¶æ²¡æœ‰å†…ç½®è¿™ç§æ•°æ®ç»“æ„ï¼Œå› æ­¤ Redisæ„å»ºäº†è‡ªå·±çš„å­—å…¸å®ç°ã€‚\nå­—å…¸åœ¨Redisä¸­çš„åº”ç”¨ç›¸å½“å¹¿æ³›ï¼Œæ¯”å¦‚ Redisçš„æ•°æ®åº“å°±æ˜¯ä½¿ç”¨å­—å…¸æ¥ä½œä¸ºåº•å±‚å®ç°çš„ï¼Œå¯¹æ•°æ®åº“çš„å¢ã€åˆ ã€æŸ¥ã€æ”¹æ“ä½œä¹Ÿæ˜¯æ„å»ºåœ¨å¯¹å­—å…¸çš„æ“ä½œä¹‹ä¸Šçš„ã€‚\n\n## ä¸ç›¸ä¼¼ç»“æ„å¯¹æ¯”\n\nHashTableæ˜¯æ— åºçš„ï¼›\nMapæ˜¯æœ‰åºçš„ï¼›HashMapæ˜¯æ— åºçš„ï¼Œåº•å±‚æœ‰çº¢é»‘æ ‘å®ç°ã€‚å› æ­¤Mapæ•ˆç‡è¾ƒä½ã€‚\n\n## å­—å…¸çš„å®ç°\n\nRedisçš„å­—å…¸ä½¿ç”¨å“ˆå¸Œè¡¨ä½œä¸ºåº•å±‚å®ç°ï¼Œä¸€ä¸ªå“ˆå¸Œè¡¨é‡Œé¢å¯ä»¥æœ‰å¤šä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹ï¼Œè€Œæ¯ä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹å°±ä¿å­˜äº†å­—å…¸ä¸­çš„ä¸€ä¸ªé”®å€¼å¯¹ã€‚\n\n### å“ˆå¸Œè¡¨\n\nRediså­—å…¸æ‰€ä½¿ç”¨çš„å“ˆå¸Œè¡¨ç”±dict.h/dicthtç»“æ„å®šä¹‰ï¼š\n\n```c\ntypedef struct dictht\n{\n    dictEntry** table;//å“ˆå¸Œè¡¨æ•°ç»„\n    unsigned long size;//å“ˆå¸Œè¡¨å¤§å°\n    unsigned long sizemark;//å“ˆå¸Œè¡¨å¤§å°æ©ç ï¼Œç”¨äºè®¡ç®—ç´¢å¼•å€¼ã€‚æ€»æ˜¯ç­‰äºsize-1\n    unsigned long used;//è¡¨ä¸­å·²æœ‰èŠ‚ç‚¹çš„æ•°é‡\n}dictht;\n```\n\næˆå‘˜tableçš„åŠŸèƒ½æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ˆæŒ‡å‘é¦–å…ƒç´ çš„æŒ‡é’ˆï¼‰ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘dict.h/dictEntryç»“æ„çš„æŒ‡é’ˆï¼Œæ¯ä¸ªdictEntryç»“æ„ä¿å­˜ç€ä¸€ä¸ªé”®å€¼å¯¹ã€‚\n\n![image-20210818030916272](../../images/Redis_dict/image-20210818030916272.png)\n\n### å“ˆå¸Œè¡¨èŠ‚ç‚¹\n\nå³dictEntryç»“æ„ã€‚\n\n```c\ntypedef struct dictEntry\n{\n    void* key;\n    union\n    {\n        void* val;\n        uint64_tu64;\n        int64_ts64;\n    }v;\n    struct dictEntry* next;\n}dictEntry;\n```\n\n![image-20210818031224095](../../images/Redis_dict/image-20210818031224095.png)\n\n### å­—å…¸\n\nRedisä¸­çš„å­—å…¸ç”±dict.h/dictç»“æ„è¡¨ç¤º\n\n```c\ntypedef struct dictType \n{\n    // è®¡ç®—å“ˆå¸Œå€¼çš„å‡½æ•°\n    unsigned int (*hashFunction)(const void *key);\n    // å¤åˆ¶é”®çš„å‡½æ•°\n    void *(*keyDup)(void *privdata, const void *key);\n    // å¤åˆ¶å€¼çš„å‡½æ•°\n    void *(*valDup)(void *privdata, const void *obj);\n    // å¯¹æ¯”é”®çš„å‡½æ•°\n    int (*keyCompare)(void *privdata, const void *key1, const void *key2);\n    // é”€æ¯é”®çš„å‡½æ•°\n    void (*keyDestructor)(void *privdata, void *key);\n    // é”€æ¯å€¼çš„å‡½æ•°\n    void (*valDestructor)(void *privdata, void *obj);\n} dictType;\ntypedef struct dict\n{\n    dictType* type;//ç»“æ„ä½“æŒ‡é’ˆï¼Œç”¨äºå­˜æ”¾ç‰¹å®šç±»å‹çš„æ“ä½œå‡½æ•°\n    void* privdata;//ç§æœ‰æ•°æ®\n    dictht ht[2];//å†…éƒ¨å®šä¹‰äº†ä¸¤ä¸ªå“ˆå¸Œè¡¨\n    int rehashidx;//å½“æ²¡æœ‰åœ¨rehashæ—¶å€¼ä¸º-1\n}dict;\n```\n\n![image-20210818032212233](../../images/Redis_dict/image-20210818032212233.png)\n\n# é¢è¯•\n\n1. æ¸è¿›å¼å¢å®¹/ç¼©å®¹\n2. ä¸€è‡´æ€§å“ˆå¸Œ--è§£å†³è´Ÿè½½å‡è¡¡çš„é—®é¢˜ã€‚æ¯”å¦‚ç™»é™†é¡¹ç›®ã€‚ä¸€åƒä¸‡ä¸ªç”¨æˆ·åŒæ—¶ç™»é™†ã€‚\n3. æ“ä½œç³»ç»Ÿä¸€å®šè¦å¼€å§‹çœ‹äº†ï¼Œå†…å­˜ç®¡ç†ã€è¿›ç¨‹ç®¡ç†ã€çº¿ç¨‹ç®¡ç†ã€‚\n\n# dictDelete\n\n1. åˆ é™¤ç¬¬ä¸€èŠ‚ç‚¹\n2. åˆ é™¤åä¸ªæ•°ä¼šå°‘ï¼Œè¦å¤„ç†\n\n# time\n\n```c\n/*\n * è¿”å›ä»¥æ¯«ç§’ä¸ºå•ä½çš„ UNIX æ—¶é—´æˆ³\n *\n * T = O(1)\n */\nlong long timeInMilliseconds(void) \n{\n    struct timeval tv;\n\n    gettimeofday(&tv,NULL);\n    return (((long long)tv.tv_sec)*1000)+(tv.tv_usec/1000);\n}\n/* Rehash for an amount of time between ms milliseconds and ms+1 milliseconds */\n/*\n * åœ¨ç»™å®šæ¯«ç§’æ•°å†…ï¼Œä»¥ 100 æ­¥ä¸ºå•ä½ï¼Œå¯¹å­—å…¸è¿›è¡Œ rehash ã€‚\n *\n * T = O(N)\n */\nint dictRehashMilliseconds(dict *d, int ms) \n{\n    // è®°å½•å¼€å§‹æ—¶é—´\n    long long start = timeInMilliseconds();\n    int rehashes = 0;\n\n    while(dictRehash(d,100)) {\n        rehashes += 100;\n        // å¦‚æœæ—¶é—´å·²è¿‡ï¼Œè·³å‡º\n        if (timeInMilliseconds()-start > ms) break;\n    }\n\n    return rehashes;\n}\n```\n\n","categories":["é«˜çº§æ•°æ®ç»“æ„","Redis"]},{"title":"å¾®æœºåŸç†","url":"/å¾®æœºåŸç†/å¾®æœºåŸç†/","content":"# äºŒè¿›åˆ¶è½¬åŒ–ä¸ºåè¿›åˆ¶\n\nhttps://blog.csdn.net/weixin_42857472/article/details/103966229\n\n## é™¤10å–ä½™æ³•\n\nè®¾è®¡ç¨‹åºæ—¶å€™çš„äºŒè¿›åˆ¶è½¬åŒ–ä¸ºåè¿›åˆ¶çš„ç®—æ³•\näºŒè¿›åˆ¶è½¬åŒ–ä¸ºåè¿›åˆ¶ï¼ˆé™¤10å–ä½™æ³•ï¼‰\n\né™¤10å–ä½™æ³•ä¸­ï¼Œå¯¹äºäºŒè¿›åˆ¶è½¬åŒ–ä¸º10è¿›åˆ¶æ¥è®²è¦é™¤äº1010ï¼Œå°±æ˜¯æŠŠ10è½¬åŒ–ä¸ºäºŒè¿›åˆ¶æ•°ï¼Œå†ç”¨äºŒè¿›åˆ¶æ•°é™¤äº1010\n\nä¾‹å¦‚ï¼šäºŒè¿›åˆ¶11101é™¤äº1010ï¼Œä½™æ•°1001ï¼Œè½¬åŒ–ä¸ºåè¿›åˆ¶æ•°ä¸º9ï¼Œè¿™ä¸ªæ˜¯ç›¸å½“äºåè¿›åˆ¶æ•°çš„ä¸ªä½ï¼Œå†ç”¨ä¸­é—´å•†0010å†é™¤äº1010ï¼Œä½™æ•°ä¸º0010ï¼Œè½¬åŒ–ä¸ºåè¿›åˆ¶æ•°ä¸º2ï¼Œç›¸å½“äºåè¿›åˆ¶æ•°çš„åä½ã€‚\n\n![image-20210725001626129](../../images/%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86/image-20210725001626129.png)\n\n## æ¯”è¾ƒæ³•\n\nå‡å¦‚ä¸€ä¸ªæ•°393\næœ€é«˜ä½ä¸ºç™¾ä½ï¼Œæ‰€ä»¥è®©393å’Œ100æ¯”è¾ƒ\nå¦‚æœ393>=100\nåˆ™393å‡å»100ï¼Œç„¶åç»Ÿè®¡ç™¾ä½çš„æ•°ï¼‹1ï¼Œç„¶åç”¨ç»“æœå·®ç»§ç»­å’Œ100æ¯”è¾ƒï¼Œä¹Ÿå°±æ˜¯293å’Œ100æ¯”è¾ƒï¼Œä»ç„¶å¤§äºï¼Œæ‰€ä»¥293å†å‡å»100ï¼Œç»Ÿè®¡ä¸€ç™¾çš„æ•°å†+1ï¼Œç›´åˆ°ä¸å¤§äºä¸€ç™¾äº†ï¼Œè¯´æ˜è¿™ä¸ªæ•°æ²¡æœ‰ç™¾ä½åªæœ‰åä½å’Œä¸ªä½äº†ï¼Œæ‰€ä»¥å’Œ10æ¯”è¾ƒï¼Œç±»ä¼¼çš„å‡å»10ï¼Œç„¶åç»Ÿè®¡åä½çš„æ•°+1ï¼Œå†ç»§ç»­æ¯”è¾ƒï¼ŒçŸ¥é“ä¸å¤§äºåï¼Œé‚£ä¹ˆå‰©ä¸‹çš„å°±æ˜¯ä¸ªä½çš„æ•°äº†ã€‚\n\näºŒè¿›åˆ¶è½¬åŒ–ä¸ºåè¿›åˆ¶çš„è¯æ¯”è¾ƒçš„å¯¹è±¡100å°±è¦åŒ–æˆäºŒè¿›åˆ¶ï¼Œå³1100100\nåçš„äºŒè¿›åˆ¶å°±æ˜¯1010ã€‚\n\næ¯”å¦‚(11101)2-->(29)10ï¼š11101>1010ï¼Œåä½+1ï¼›11101-1010=10011>1010ï¼Œåä½+1ï¼›10011-1010=1001<1010ï¼Œåä½ç»“æŸï¼Œ(1001)2=(9)10ã€‚åˆ™ç»“æœä¸º(29)10ã€‚\n\n# 8ä½å¯„å­˜å™¨\n\nä»¥8086ä¸ºä¾‹ï¼Œè™½ç„¶8086æ˜¯16ä½å¤„ç†å™¨ï¼Œä½†ä¹Ÿå¯ä»¥ä»¥8ä½æ–¹å¼å­˜å‚¨æ•°æ®åˆ°å¯„å­˜å™¨ä¸­ã€‚\n\n8ä½å¯„å­˜å™¨æœ‰ï¼šAHã€ALã€‚Hä»£è¡¨é«˜å…«ä½ï¼ŒLä»£è¡¨ä½å…«ä½ï¼ŒAHä¸ALä¸€èµ·ç»„æˆAXå¯„å­˜å™¨å³16ä½å¯„å­˜å™¨ã€‚ç›¸åº”åœ°ï¼ŒBHã€BLï¼›CHã€CLï¼›DHã€DLï¼Œä¹Ÿæ˜¯8ä½å¯„å­˜å™¨ã€‚BXã€CXã€DXæ˜¯16ä½å¯„å­˜å™¨ã€‚\n\n# äºŒè¿›åˆ¶æ•°çš„è¿ç®—\n\n## ç®—æœ¯è¿ç®—+ã€-ã€*ã€/\n\næ¯”å¦‚97+89\n\n```x86asm\nmov AL,97\t;æ±‡ç¼–å:B0 61\t;B0hå°±è¡¨ç¤ºâ€œæŠŠä¸€ä¸ªå­—èŠ‚æ•°ä¼ é€ç»™ALå¯„å­˜å™¨ä¸­â€çš„æœºå™¨æºä»£ç ï¼Œ61hä»£è¡¨97çš„åå…­è¿›åˆ¶ã€‚\nadd AL,89\t;(AL)=BAh\t;å¸¦æ‹¬å·å°±è¡¨ç¤ºæ‹¬å·ä¸­åœ°å€çš„å†…å®¹ï¼Œæ­¤å¤„è¡¨ç¤ºALå¯„å­˜å™¨çš„å†…å®¹\n```\n\n\n\nmov AL,97 <---> B0 61    ;B0hå°±è¡¨ç¤ºâ€œæŠŠä¸€ä¸ªå­—èŠ‚æ•°ä¼ é€ç»™ALå¯„å­˜å™¨ä¸­â€çš„æœºå™¨æºä»£ç ï¼Œ61hä»£è¡¨97çš„åå…­è¿›åˆ¶ã€‚\n\n\n\n# å¤„ç†å™¨çŠ¶æ€å­—å¯„å­˜å™¨PSW\n\nä¹Ÿç§°ä¸ºæ ‡å¿—å¯„å­˜å™¨ï¼Œä¸»è¦ç”¨äºCPUè¿ç®—åæ ¹æ®ç»“æœè®¾ç½®å„ä¸ªæ ‡å¿—ï¼Œä¸€ä¸ªæ ‡å¿—ä¸€ä¸ªçŠ¶æ€ï¼Œä¸€ä¸ªçŠ¶æ€ç”¨ä¸€ä¸ªbitä½è¡¨ç¤ºã€‚\n\n# è¡¥ç \n\nè¡¥ç çš„èŒƒå›´æœ‰ä¸€ä¸ªç–‘æƒ‘ç‚¹ã€‚å‡å¦‚ä¸€ä¸ª8ä½è¡¥ç ï¼Œå¯ä»¥è¡¨ç¤ºçš„èŒƒå›´æ˜¯-128~+127ï¼Œå¦‚æœåªæ˜¯æŒ‰ç…§è€å¸ˆä¸Šè¯¾è®²çš„â€œå–ååŠ ä¸€æ³•â€æ¥çœ‹ï¼Œå°±ä¼šä¸æ¸…æ¥š-128è¿™ä¸ªæ•°æ˜¯æ€ä¹ˆæ¥çš„ã€‚å› ä¸ºå¸¦ç¬¦å·ä½ï¼ˆå¸¦ç¬¦å·ä½è¿™ç§è¯´æ³•æ˜¯æœ‰è¯¯çš„ï¼Œä¸‹é¢ä¼šæåˆ°ï¼‰çš„8ä½äºŒè¿›åˆ¶ç çš„ç»å¯¹å€¼æœ€å¤§æ˜¯127ã€‚\n\nè¿™æ—¶ï¼Œæˆ‘ä»¬è¦æ·±åˆ»åœ°çº æ­£æˆ‘ä»¬å¯¹è¡¥ç æ¦‚å¿µçš„è¯¯åŒºã€‚\n\nè¡¥ç çš„èŒƒå›´https://www.zhihu.com/question/20458542/answer/40759880\nè¡¥ç çš„å®šä¹‰https://blog.csdn.net/xiang_shao344/article/details/118490004\n\nç¬¬ä¸€æ­¥ï¼Œå°±åƒç»ƒåŒ—å†¥ç¥åŠŸè¦å…ˆæ•£åŠŸä¸€æ ·ï¼Œå…ˆæŠŠä½ å¿ƒä¸­å¯¹åŸç ï¼Œåç ï¼Œè¡¥ç çš„ä¸€å¥—è®¤è¯†å…¨éƒ¨å¿˜æ‰ã€‚\n\nç¬¬äºŒæ­¥ï¼Œæ­£å¼å¼€è®²\t\n\né¦–å…ˆçŒè¾“ä¸€ä¸ªæ–°çš„æ¦‚å¿µå«ï¼Œ**æ¨¡**\nä»€ä¹ˆæ˜¯â€œæ¨¡â€ï¼Œæƒ³è±¡æ—¥å¸¸ä½¿ç”¨çš„é’Ÿè¡¨ï¼Œå®ƒå¯ä»¥æ˜¾ç¤º0ï½12ç‚¹çš„æ—¶é—´ï¼Œå‡è®¾ç°åœ¨æ˜¯2ç‚¹é’Ÿï¼Œè¯·ç”¨æ‰‹åŠ¨æ‹¨åŠ¨æ—¶é’ˆçš„æ–¹å¼å°†æ—¶é—´å‡4å°æ—¶ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ\næœ‰ä¸¤ç§æ–¹å¼ï¼š\n\n1. é€†æ—¶é’ˆå°†æ—¶é’ˆæ‹¨4å°æ—¶\n2. é¡ºæ—¶é’ˆå°†æ—¶é’ˆæ‹¨8ï¼ˆ12-4ï¼‰å°æ—¶\n\nè¿™é‡Œè¦è®²çš„æ˜¯ç¬¬äºŒç§æ–¹å¼ï¼Œä¸ºä»€ä¹ˆé¡ºæ—¶é’ˆæ‹¨12-4ä¹Ÿå¯ä»¥è¾¾åˆ°å’Œæ­£å¸¸æ€ç»´çš„ç¬¬ä¸€ç§æ–¹å¼ä¸€æ ·çš„ä½ç½®ã€‚\n12å°±æ˜¯æ¨¡ã€‚\nåŒæ ·çš„ï¼Œå¦‚æœæ˜¯åè¿›åˆ¶çš„ä¸¤ä½æ•°ï¼Œ80-10 å’Œ 80ï¼‹90åœ¨ä¸è€ƒè™‘ç™¾ä½æ•°çš„åŸºç¡€ä¸Šéƒ½æ˜¯70ã€‚è¿™é‡Œçš„90å°±æ˜¯100-10å¾—æ¥çš„ï¼Œè¿™ç§æƒ…å†µä¸‹100å°±æ˜¯æ¨¡\næ¨¡å°±å¥½æ¯”æ˜¯ä¸€ä¸ªæé™ï¼Œåœ¨å®ƒçš„èŒƒå›´å†…ï¼Œä¸¤ä¸ªç›¸åŠ ç­‰äºæ¨¡çš„æ•°äº’ä¸ºè¡¥æ•°ï¼Œè¿˜æ˜¯ä¸¾100çš„ä¾‹å­\n90å’Œ10ï¼Œ 55å’Œ45ï¼Œ68å’Œ32ï¼Œäº’ä¸ºè¡¥æ•°\nåœ¨æ¨¡çš„èŒƒå›´å†…åšå‡æ³•ï¼Œå¯ä»¥å°†â€œXï¼Yâ€çš„å‡æ³•å˜æ›´ä¸ºâ€œXï¼‹Yçš„è¡¥æ•°â€œçš„åŠ æ³•ï¼Œå½“ç„¶å‰ææ˜¯ä¸è€ƒè™‘ç™¾ä½æ•°ã€‚\n\n**æ€è€ƒé¢˜**ï¼Œ*ä¸Šé¢ä¸¾çš„ä¾‹å­æ˜¯å¤§æ•°å‡å°æ•°ï¼Œé‚£ä¹ˆå¦‚æœæ˜¯å°æ•°å‡å¤§æ•°ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ*\n\nå¦‚æœæ˜¯10-80ï¼Œç»“æœåº”è¯¥æ˜¯ï¼70ï¼Œä½†å¦‚æœæŒ‰ç…§10+ï¼ˆ100-80ï¼‰ï¼Œç»“æœæ˜¯30ã€‚\nè€Œå¾ˆæ˜æ˜¾ï¼70å’Œ30ä¸æ˜¯ä¸€å›äº‹ï¼Œè¿™é‡Œä¹Ÿæ²¡æœ‰ç™¾ä½æ•°çš„é—®é¢˜ï¼Œè¿™ç§æƒ…å†µåº”è¯¥æ€ä¹ˆç ´ï¼Ÿ\nå½“åˆçš„é‚£äº›å…ˆè´¤ä»¬æƒ³å‡ºæ¥çš„åŠæ³•å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠè¿™ä¸¤ä¸ªæ•°ç›´æ¥åˆ’ä¸Šç­‰å·ï¼Œæ­£å¥½é¡ºä¾¿è§£å†³äº†è´Ÿæ•°çš„è¡¨è¾¾æ–¹å¼ã€‚å†æ¥ä»”ç»†çœ‹çœ‹è¿™ä¸¤ä¸ªæ•°çš„å…³ç³»ï¼šï¼70ç»å¯¹å€¼çš„è¡¥æ•°å°±æ­£å¥½æ˜¯30\næ‰€ä»¥åœ¨è®¡ç®—æœºä¸­ï¼Œ**è´Ÿæ•°çš„è¡¨è¾¾æ–¹å¼å°±æ˜¯å®ƒç»å¯¹å€¼çš„è¡¥æ•°**\nä½†æ˜¯é—®é¢˜åˆæ¥äº†ï¼Œçœ‹èµ·æ¥è¿™ä¸ªè§£å†³æ–¹å¼å¾ˆå®Œç¾äº†ï¼Œä½†åˆ«å¿˜äº†ï¼Œ30ä»–å·²ç»ä»£è¡¨äº†æ­£æ•°çš„30äº†ï¼Œç°åœ¨åˆè¦ç”¨æ¥ä»£è¡¨è´Ÿæ•°çš„ï¼70ï¼Œè°çŸ¥é“å®ƒå‡ºç°çš„æ—¶å€™åˆ°åº•æ˜¯ä»£è¡¨å“ªä¸ªæ•°ï¼Ÿ\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦ç»™è¿™å¥—è§„åˆ™åˆ’å®šä¸€ä¸ªèŒƒå›´ï¼ŒåŸæ¥æ˜¯0ï½99çš„æ­£æ•°ï¼Œç°åœ¨æ—¢ç„¶è¦ç”¨éƒ¨åˆ†æ­£æ•°æ¥ä»£æ›¿è´Ÿæ•°äº†ï¼Œé‚£å°±è¦è§„å®šä¸€ä¸ªèŒƒå›´æ¥ä½¿å¾—ä¸€ä¸ªæ•°åªä»£è¡¨ä¸€ä¸ªå«ä¹‰ï¼Œæ­£å¥½ä¸€äººä¸€åŠï¼Œ0ï½49è¿™ä¸ªåŒºé—´å°±ä»£è¡¨æ­£æ•°ï¼Œ50ï½99çš„åŒºé—´å°±ç”¨æ¥ä»£è¡¨å„è‡ªè¡¥æ•°çš„è´Ÿå€¼ï¼Œä¾‹ï¼š98å°±ä»£è¡¨ï¼2\n\nç¬¬ä¸‰æ­¥ï¼Œç°åœ¨å›åˆ°äºŒè¿›åˆ¶çš„è®¡ç®—æœºä¸–ç•Œ\n\n8ä½äºŒè¿›åˆ¶æ•°ä¸€å…±å¯ä»¥è¡¨ç¤º2çš„8æ¬¡æ–¹ï¼Œ256ä¸ªæ•°ï¼Œå³0ï½255 ï¼ˆåˆ«å¿˜äº†0ä¹Ÿè¦å ä¸€ä½çš„ï¼‰ï¼Œä»–ä»¬çš„æé™å°±æ˜¯256ï¼Œå³256æ˜¯8ä½äºŒè¿›åˆ¶æ•°çš„æ¨¡ ï¼Œåº”è¯¥ä¸éš¾ç†è§£å§ï¼ŒåŒä¸Šåè¿›åˆ¶çš„ä¸¤ä½æ•°0ï½99çš„æ¨¡æ˜¯100ã€‚\nè¿˜æ˜¯ç”¨äºŒè¿›åˆ¶æ¥è¯´æ˜æ¸…æ¥šï¼Œ8ä½äºŒè¿›åˆ¶èƒ½è¡¨ç¤ºçš„æ•°çš„æé™æ˜¯\n1 1 1 1 1 1 1 1ï¼Œ å°±æ˜¯255ï¼Œåœ¨è¿™åŸºç¡€ä¸ŠåŠ 0 0 0 0 0 0 0 1ï¼Œå‡ºç°äº†è¿›ä¸€ä½ å³ 1 0 0 0 0 0 0 0 0\nè¿™ä¸ª1 0 0 0 0 0 0 0 0å°±æ˜¯8ä½äºŒè¿›åˆ¶æ•°çš„æ¨¡ï¼Œ256\n\nåŒæ ·æŒ‰ç…§ç¬¬äºŒæ­¥è®²çš„é€»è¾‘ï¼Œä¸€åŠçš„æ•°0ï½127ï¼Œä»£è¡¨å…¶æ­£æ•°æœ¬èº«ï¼Œå¦ä¸€åŠçš„æ•° 128ï½255ï¼Œä»£è¡¨å…¶è¡¥æ•°çš„è´Ÿå€¼ï¼Œå³â€œï¼1ï½ï¼128â€çš„åŒºé—´ã€‚\nè€Œ â€œXï¼Yâ€çš„å‡æ³• å°±ç”¨ â€œXï¼‹Yçš„è¡¥æ•°â€ çš„åŠ æ³•æ¥è¡¨ç¤ºï¼Œå®Œç¾ï¼ å”¯ä¸€éœ€è¦æ³¨æ„çš„äº‹æƒ…æ˜¯ä»»ä½•è®¡ç®—çš„è¾“å…¥å€¼å’Œè¾“å‡ºç»“æœå€¼éƒ½éœ€è¦ä¸¥æ ¼éµå®ˆï¼128ï½127çš„èŒƒå›´ï¼Œä¸€æ—¦æº¢å‡ºå°±ä¼šæŠ¥é”™ã€‚\nè¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨ç¼–ç¨‹é‡Œå¼ºè°ƒçš„ä¸ºä»€ä¹ˆ byteï¼‹byteè¿˜å¾—æ˜¯byteï¼Œintï¼‹intè¿˜å¾—æ˜¯intï¼Œæ•°æ®æº¢å‡ºé—®é¢˜ä¹Ÿæ˜¯æ¯ä¸€ä¸ªç¨‹åºå‘˜éƒ½éœ€è¦æ³¨æ„çš„é—®é¢˜ã€‚\n\nè¿™æ ·ä¸€è¯´æ˜¯ä¸æ˜¯å¯ä»¥ç†è§£ï¼128çš„è¡¥ç æ˜¯æ€ä¹ˆæ¥çš„äº†å§ï¼Ÿ ä»–å°±æ˜¯256 - |-128|ï¼128\näºŒè¿›åˆ¶çš„128æ˜¯ä¸æ˜¯å°±æ˜¯1 0 0 0 0 0 0 0 ï¼Ÿ\n\næœ€ç»ˆé—®é¢˜ï¼Œé‚£ä¹¦å’Œè€å¸ˆä¸ºä»€ä¹ˆè¦ç”¨åŸç ï¼Œåç æ¥è®²è¡¥ç  ï¼Ÿ\n\nç©ºç©´æ¥é£ï¼Œæœªå¿…æ— å› \né‚£æ˜¯å› ä¸ºè®¡ç®—æœºå°±æ˜¯è¿™æ ·æ±‚è´Ÿæ•°çš„è¡¥ç çš„ï¼Œæˆ‘ä»¬åœ¨é”®ç›˜ä¸Šæ•²ä¸€ä¸ªè´Ÿæ•°çš„æ—¶å€™ï¼Œè®¡ç®—æœºè¦æŠŠå®ƒç”¨è¡¥ç çš„å½¢å¼å­˜å‚¨ä¸‹æ¥ï¼Œè¿˜è®°å¾—ä¸Šé¢æˆ‘ä»¬è®²çš„è¡¥ç æ˜¯æ€ä¹ˆæ¥çš„å—ï¼Ÿ\næ¨¡ï¼ç»å¯¹å€¼ï¼Œè¿™æ˜¯ä¸æ˜¯ä¸ªå‡æ³•å…¬å¼ï¼Ÿä½†è®¡ç®—æœºæ²¡æœ‰å‡æ³•é€»è¾‘ï¼Œæˆ‘ä»¬è´¹äº†é‚£ä¹ˆå¤§çš„åŠ²æäº†ä¸€å¥—è¡¥ç çš„è§„åˆ™å°±æ˜¯ä¸ºäº†ç”¨åŠ æ³•æ¥æ›¿ä»£å‡æ³•ï¼Œä½†ä¸ºäº†å®ç°è¿™ä¹ˆå¥—è§„åˆ™ï¼Œå´è·¨ä¸è¿‡ä¸€ä¸ªåï¼Œå°±æ˜¯æŠŠè´Ÿæ•°è®¡ç®—æˆè¡¥ç ä»ç„¶æ˜¯éœ€è¦å‡æ³•é€»è¾‘çš„ã€‚æ€ä¹ˆåŠå‘¢ï¼Œé‚£äº›ä¼Ÿå¤§çš„å…ˆè´¤ä»¬ ï¼ˆè†œæ‹œï¼‰å°±æƒ³å‡ºäº†è¿™ä¹ˆä¸ªåŠæ³•ï¼š\né¦–ä½ä¸å˜ï¼Œå…¶ä½™ä½å–ååï¼Œå†åŠ ä¸€\n\né—®é¢˜ï¼šä¸Šé¢è¯´åˆ°äº†ï¼Œè´Ÿæ•°è®¡ç®—æˆè¡¥ç éœ€è¦å–ååŠ 1ï¼Œä½†-128åœ¨8ä½æ•°ä¸­ï¼Œæ²¡æœ‰å…¶åŸç è¡¨ç¤ºå½¢å¼ï¼Œå¦‚æœè¦äººå·¥æ‰‹å·¥è®¡ç®—ï¼Œå°†-128å…ˆçœ‹åšæ˜¯9ä½å¸¦ç¬¦å·æ•°ï¼Œå†è½¬æ¢ä¸ºè¡¥ç ï¼š1 1000 0000é¦–ä½ä¸å˜ï¼Œå…¶ä½™å–ååŠ 1ä¼šå˜æˆ1 1000 0000ï¼Œè¿›ä½æº¢å‡ºèˆå»ï¼Œå³ä¸º1000 0000ã€‚\n\nä¸‹é¢æ˜¯åæ§½\n\nä¸çŸ¥é“æ˜¯å“ªä¸ªä¹¦å‘†å­æ•™ä¹¦ï¼Œç…§æ¬äº†æœºå™¨çš„é€»è¾‘ï¼ŒæŠŠå–ååŠ ä¸€çš„æ–¹æ³•å½“åšè¡¥ç çš„è®¡ç®—é€»è¾‘å°±è¿™ä¹ˆæ•™ä¸‹æ¥äº†ã€‚æç¬‘çš„æ˜¯ï¼Œè¿˜ä¿ç•™äº†è¡¥ç è¿™ä¸ªåå­—ï¼Œç…§ç†è¯´è¿™ç§æ•™æ³•åº”è¯¥å« å–ååŠ ä¸€ç  æ›´åˆç†ï¼Œä½ è¿˜è¡¥ä»€ä¹ˆå•Šï¼Ÿ\nä¸ä»…å¦‚æ­¤ï¼Œè¿˜æå‡ºäº†ä¸ªé¦–ä½ç¬¦å·ä½çš„è¯´æ³•ï¼Œå¼„å‡ºäº†ä¸ªæ­£0è´Ÿ0ï¼Œè¿˜ç”¨è´Ÿ0æ¥å……å½“ï¼128ï¼ŒçœŸæ˜¯ä¸æŠŠäººå¼„ç–¯ä¸ç½¢ä¼‘å•Šï¼ï¼\n\n# å¯„å­˜å™¨\n\n## é€šç”¨å¯„å­˜å™¨\n\n### æ•°æ®å¯„å­˜å™¨\n\n#### AX\n\nç´¯åŠ \n\n#### BX\n\nåŸºå€å¯„å­˜å™¨\n\n#### CX\n\nè®¡æ•°å™¨\n\n#### DX\n\næ•°æ®å¯„å­˜å™¨ã€‚åœ¨I/Oç«¯å£çš„IN/OUTæ“ä½œä¸­å……å½“I/Oåœ°å€å¯„å­˜å™¨ã€‚\n\n### åœ°å€æŒ‡é’ˆä¸å˜å€å¯„å­˜å™¨\n\n#### åœ°å€æŒ‡é’ˆå¯„å­˜å™¨\n\n##### SP\n\nå †æ ˆæŒ‡é’ˆå¯„å­˜å™¨--ç”¨æ¥æŒ‡ç¤ºPUSH/POPå †æ ˆæ“ä½œæ—¶æ‰€æ“ä½œå•å…ƒçš„æ®µå†…16ä½åœ°å€çš„å¯„å­˜å™¨ã€‚\n\n##### BP\n\nåœ°å€æŒ‡é’ˆå¯„å­˜å™¨--ä½œç”¨å’ŒBXåŸºå€å¯„å­˜å™¨æ˜¯ä¸€æ ·çš„ï¼Œéƒ½å¯ä»¥å­˜æ”¾16ä½æ®µå†…åç§»åœ°å€ï¼Œä½†æ˜¯æ˜¯æœ‰åŒºåˆ«çš„ï¼Œå­˜æ”¾16ä½æ®µå†…åç§»åœ°å€ä¸åœ¨åŒä¸€ä¸ªé€»è¾‘æ®µï¼ŒCPUé»˜è®¤BXåœ¨DSæ•°æ®æ®µï¼ŒBPåœ¨SSå †æ ˆæ®µã€‚CPUé»˜è®¤BPæŒ‡å‘çš„æ˜¯SSæ®µçš„åœ°å€ã€‚\nå½“ç„¶ï¼Œæƒ³è¦BPæŒ‡å‘æ•°æ®æ®µä¹Ÿå¯ä»¥ï¼Œå¿…é¡»åœ¨æ±‡ç¼–è¯­å¥ä¸­å†™æ˜å‰ç¼€ï¼Œç§°ä¹‹ä¸º**æ®µè¶…è¶Šå‰ç¼€**ï¼Œå¦‚ï¼š\n\n```X86ASM\nMOV AL,56H\nMOV BP,0003H\nMOV DS:[BP],AL\n```\n\n#### å˜å€å¯„å­˜å™¨\n\n##### SI\n\næºå˜å€å¯„å­˜å™¨\n\n##### DI\n\nç›®çš„å˜å€å¯„å­˜å™¨\n\n\n\n#### æ€»ç»“\n\nç”¨BX/SI/DIå¤–åŠ ä¸­æ‹¬å·å³é—´æ¥æ‰¾åˆ°çš„åœ°å€éƒ½é»˜è®¤åœ¨DSæ®µå†…ã€‚åªç”¨BPä¸­æ‹¬å·é—´æ¥æ‰¾åˆ°çš„åœ°å€é»˜è®¤åœ¨SSæ®µå†…ã€‚\n\n![image-20210726185205000](../../images/%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86/image-20210726185205000.png)\n\n## æ®µå¯„å­˜å™¨\n\nåˆ†åˆ«æ”¾çš„æ˜¯å„è‡ªé€»è¾‘æ®µçš„æ®µåœ°å€\n\n### CS\n\nä»£ç æ®µå¯„å­˜å™¨ã€‚CSçš„å€¼æŒ‡æ˜çš„æ˜¯ï¼Œç¨‹åºä»£ç æ‰€åœ¨çš„é‚£ä¸ªé€»è¾‘æ®µçš„æ®µåœ°å€ã€‚\n\nCSåˆå§‹åŒ–çš„å€¼ç”¨æˆ·ä¸å¯è®¾ç½®ï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šã€‚\n\n### DS\n\næ•°æ®æ®µå¯„å­˜å™¨\n\n### ES\n\né™„åŠ æ•°æ®æ®µå¯„å­˜å™¨\n\n### SS\n\nå †æ ˆæ®µå¯„å­˜å™¨\n\n## æ§åˆ¶å¯„å­˜å™¨\n\n### IP\n\næŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨ã€‚ç­‰æ•ˆäºä¸€èˆ¬å¤„ç†å™¨ä¸­ç¨‹åºè®¡æ•°å™¨PCçš„ä½œç”¨ã€‚å³ç”¨äºCPUå–æŒ‡ä»¤æ—¶éœ€è¦ç”¨åˆ°çš„åç§»åœ°å€å¯„å­˜å™¨ã€‚ä¸CSï¼ˆä»£ç æ®µï¼‰ä¸å¯åˆ†å®¶ï¼ŒCS:IPã€‚\n\n### PSW\n\nå¤„ç†å™¨çŠ¶æ€å­—å¯„å­˜å™¨ã€‚16ä½å¯„å­˜å™¨ï¼Œä½†æœ‰ç”¨çš„åªæœ‰9ä½ã€‚\n\n![image-20210726144858440](../../images/%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86/image-20210726144858440.png)\n\n9ä½åˆ†ä¸ºä¸¤ç±»æ ‡å¿—ã€‚\n\n#### çŠ¶æ€æ ‡å¿—ï¼ˆ6ä¸ªï¼‰\n\nZFã€CFã€PFã€OFã€SFã€AFã€‚åæ˜ çš„æ˜¯ALUè¿ç®—åç»“æœçš„çŠ¶æ€ã€‚\n\nåªæœ‰è¿ç®—æŒ‡ä»¤æ‰§è¡Œåæ‰ä¼šå½±å“è¿™äº›çŠ¶æ€å€¼çš„æ”¹å˜ã€‚\n\n#### æ§åˆ¶æ ‡å¿—ï¼ˆ3ä¸ªï¼‰\n\nIFã€PFã€TFã€‚ç”¨æ¥æ§åˆ¶CPUçš„è¿è¡ŒçŠ¶æ€çš„ã€‚\n\n##### DF\n\næ–¹å‘æ§åˆ¶æ ‡å¿—ã€‚ç”¨äºæ§åˆ¶å­—ç¬¦ä¸²æ“ä½œä¸­SIå’ŒDIå˜å€çš„æ–¹å‘ã€‚\n\n```X86ASM\nCLD\t;DF=0;æ§åˆ¶SI/DIåŠ 1æˆ–2\nSTD\t;DF=1;æ§åˆ¶SI/DIå‡1æˆ–2\n```\n\n![image-20210726150833012](../../images/%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86/image-20210726150833012.png)\n\n##### IF\n\nä¸­æ–­å…è®¸æ ‡å¿—ã€‚\n\næ‰§è¡Œç”¨æˆ·ç¨‹åºæœŸé—´ï¼ŒæŸä¸ªç‰¹æ®Šäº‹ä»¶å‘ç”Ÿï¼Œè®©CPUæš‚æ—¶åœæ­¢æ­£åœ¨æ‰§è¡Œçš„ç¨‹åºï¼Œè½¬å»ä¸ºè¯¥äº‹ä»¶æœåŠ¡ï¼Œå³å»æ‰§è¡Œä¸­æ–­æœåŠ¡å­ç¨‹åºã€‚æœåŠ¡å®Œæˆåï¼ŒCPUå°šå¯è¿”å›åˆ°åˆšæ‰ä¸­æ­¢çš„ä½ç½®ç»§ç»­æ‰§è¡Œã€‚\n\nCLIä¼šç½®0ï¼ŒSTLä¼šç½®1ã€‚\n\nå¦‚æœIFä¸º0ï¼Œåˆ™ä¼šå±è”½å¤–éƒ¨ä¸­æ–­è¯·æ±‚ï¼ˆ8086çš„18è„šINTRè¾“å…¥ï¼‰ã€‚ä½†CPUèŠ¯ç‰‡å†…éƒ¨ä¸­æ–­ä¸å¯å±è”½ã€‚\n\n##### TF\n\né™·é˜±ï¼ˆå•æ­¥ï¼‰æ ‡å¿—ã€‚Debugä¸“ç”¨ã€‚\n\næ²¡æœ‰æ¸…é›¶ç½®ä¸€çš„æŒ‡ä»¤ã€‚é‚£è¯¥å¦‚ä½•è®¾è®¡ç¨‹åºä½¿TFç½®1ï¼Ÿ\n\n![image-20210726151453188](../../images/%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86/image-20210726151453188.png)\n\nä»¥ä¸Šç¨‹åºï¼šå…ˆPUSHFï¼ˆFå³PSWï¼‰ï¼Œå†POPç»™AXèµ‹å€¼ï¼›å†ORæŠŠAXä¸­ç¬¬ä¹ä½ç½®1ï¼›å°†AXå‹æ ˆï¼Œåœ¨POPFç»™PSWèµ‹å€¼ã€‚\n\nTFåœ¨PSWå¯„å­˜å™¨çš„ç¬¬ä¹ä½ï¼ˆå¦‚æœä»0å¼€å§‹ï¼Œæ˜¯ç¬¬8ä½ï¼‰ï¼Œæˆ‘ä»¬çŸ¥é“ï¼ŒORè¯­å¥å¯ä»¥è®©æ•°æ®ç½®1ï¼Œåˆ™è®©PSWæˆ–ä¸Š0000 0001 0000 0000å³å¯ä½¿TFç½®1ã€‚\n\nå¦‚æœTFæ ‡å¿—ä¸º1ï¼Œåˆ™ç¨‹åºå°†è¿›è¡Œå•æ­¥æ“ä½œã€‚å¸¸ç”¨äºDebugè°ƒè¯•ã€‚\n\n# 8086å­˜å‚¨å™¨å’ŒI/Oç»„ç»‡\n\n## å­˜å‚¨å™¨åœ°å€ç©ºé—´ä¸æ•°æ®å­˜æ”¾æ ¼å¼\n\n### åœ°å€ç©ºé—´\n\nA_19\\~A_16/A_15\\~A_10/A_9\\~A_0ï¼šå‡ä¸ºå¤–éƒ¨å­˜å‚¨å™¨ç¼–å€ã€‚æ‰€ä»¥èƒ½å¯»å€çš„ç©ºé—´ä¸º2^20å­—èŠ‚å³1MBã€‚\n\nä½16ä½ç»™å¤–éƒ¨I/Oç«¯å£ç¼–å€ã€‚I/Oåœ°å€ç©ºé—´ä¸º2^16å­—èŠ‚=64KBã€‚\n\nåœ¨IBM PCæœºä¸­åªç”¨äº†ä½10ä½ç»™I/Oåˆ†é…åœ°å€ï¼Œåœ°å€ç©ºé—´ä¸º1KBã€‚å‰512ä¸ªI/Oåœ°å€å³000H\\~1FFHç»™ä¸»æ¿ä¸Šçš„I/Oåˆ†é…åœ°å€ï¼›å512ä¸ªI/Oåœ°å€å³200H\\~3FFHç»™æ’ä»¶ç‰ˆä¸Šçš„I/Oåˆ†é…åœ°å€ã€‚\n\n### æ•°æ®å­˜æ”¾æ ¼å¼\n\nå­—èŠ‚å‹ã€å­—å‹ã€åŒå­—å‹ã€‚\n\n#### å­—èŠ‚å‹æ•°æ®\n\nå­—èŠ‚å‹æ•°æ®å®šä¹‰ä¼ªæŒ‡ä»¤ï¼šDBï¼ˆData Byteï¼‰\n\nå­—å‹æ•°æ®å®šä¹‰ä¼ªæŒ‡ä»¤ï¼šDWï¼ˆData Wordï¼‰\n\nåŒå­—å‹æ•°æ®å®šä¹‰ä¼ªæŒ‡ä»¤ï¼šDDï¼ˆData Doubleï¼‰\n\n## å­˜å‚¨å™¨çš„åˆ†æ®µä¸ç‰©ç†åœ°å€çš„å½¢æˆ\n\n### åˆ†æ®µ\n\n#### 1ã€ä¸ºä»€ä¹ˆåˆ†æ®µï¼Ÿ\n\nåœ°å€çº¿æœ‰20æ ¹ï¼Œè€Œå¯„å­˜å™¨åªæœ‰16ä½ï¼Œæ— æ³•ç›´æ¥ç®¡ç†2^20ä½ç©ºé—´ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»™å†…å­˜åˆ†æ®µä½¿16ä½å¯„å­˜å™¨æœ‰æ•ˆç®¡ç†è‹¥å¹²æ®µï¼ˆæœ€å°‘2^4=16æ®µï¼‰çš„æ¯ä¸ªé€»è¾‘æ®µçš„2^16ä½ä¿¡æ¯ã€‚\n\n#### 2ã€æ€ä¹ˆåˆ†ï¼Ÿ\n\næ ¹æ®éœ€æ±‚è¿›è¡Œåˆ†æ®µï¼Œæ¯æ®µæœ€å¤§2^16=64KBã€‚æ¯ä¸ªé€»è¾‘æ®µçš„èµ·å§‹åœ°å€å¿…é¡»èƒ½è¢«16æ•´é™¤ã€‚\n\n### å·²çŸ¥æŸå­˜å‚¨å™¨å•å…ƒçš„é€»è¾‘åœ°å€ï¼Œæ±‚ç‰©ç†åœ°å€\n\n PAï¼ˆPhysical Addressï¼‰=æ®µåœ°å€\\*10H + æ®µå†…åç§»åœ°å€ï¼ˆä¹Ÿç§°æ®µå†…æœ‰æ•ˆåœ°å€EA(Effective Address)ï¼‰\n\næ®µåœ°å€\\*10H å°±ç›¸å½“äºå·¦ç§»ä¸€ä½ã€‚\n\nä¾‹ï¼šé€»è¾‘åœ°å€0001H: 0010Hï¼ŒPA=0001H*10H + 0010H=00010H+0010H=00020H\n\n# 8086CPUçš„æŒ‡ä»¤ç³»ç»Ÿ\n\n## åè¯è§£é‡Š\n\næŒ‡ä»¤ï¼š\n\næŒ‡ä»¤ç³»ç»Ÿï¼šCPUèƒ½è¯†åˆ«çš„æ‰€æœ‰æŒ‡ä»¤çš„é›†åˆ\n\næœºå™¨è¯­è¨€ï¼šæŒ‡ä»¤ä»£ç è¯­è¨€\n\næœºå™¨è¯­è¨€ç¨‹åºï¼šç”¨æˆ·ç”¨æœºå™¨è¯­è¨€ç¼–å†™çš„ç¨‹åº\n\næ±‡ç¼–è¯­è¨€ï¼šä¸€ç§ç¬¦å·åŒ–è¯­è¨€ï¼Œç”¨ä¸€ç»„ç¬¦å·å’Œæ•°å­—æ›¿ä»£CPUèƒ½è®¤è¯†çš„æŒ‡ä»¤ã€‚å¦‚MOV AL,12Hæ›¿æ¢äº†B0 12ã€‚\n\næ±‡ç¼–è¯­è¨€ï¼ˆæºï¼‰ç¨‹åºï¼šç”¨æˆ·ç”¨æ±‡ç¼–è¯­è¨€ç¼–å†™çš„ç¨‹åºï¼Œä½†CPUä¸èƒ½ç›´æ¥æ‰§è¡Œï¼Œå¿…é¡»è¦ç¿»è¯‘ä¸ºæœºå™¨è¯­è¨€ç¨‹åº\n\næ±‡ç¼–ï¼šå°†æ±‡ç¼–è¯­è¨€ï¼ˆæºï¼‰ç¨‹åºç¿»è¯‘ä¸ºæœºå™¨è¯­è¨€ç¨‹åºçš„è¿‡ç¨‹ã€‚\n\nåæ±‡ç¼–ï¼šå°†æœºå™¨è¯­è¨€ç¨‹åºç¿»è¯‘ä¸ºæ±‡ç¼–è¯­è¨€ï¼ˆæºï¼‰ç¨‹åºçš„è¿‡ç¨‹ã€‚\n\n# 8086æ±‡ç¼–è¯­è¨€ç¨‹åº\n\n## è¯­å¥çš„ç§ç±»\n\n### æŒ‡ä»¤è¯­å¥\n\nCPUèƒ½æ‰§è¡Œçš„è¯­å¥ç§°ä¸ºæŒ‡ä»¤è¯­å¥ï¼›\n\nèƒ½æ±‡ç¼–/ç¿»è¯‘æˆäºŒè¿›åˆ¶æŒ‡ä»¤ä»£ç çš„è¯­å¥ï¼Œç§°ä¸ºæŒ‡ä»¤è¯­å¥ã€‚\n\n### ä¼ªæŒ‡ä»¤è¯­å¥\n\nCPUä¸èƒ½æ‰§è¡Œçš„è¯­å¥ç§°ä¸ºæŒ‡ä»¤è¯­å¥ï¼›\n\næ±‡ç¼–æ—¶ä¸èƒ½æ±‡ç¼–/ç¿»è¯‘æˆäºŒè¿›åˆ¶æŒ‡ä»¤ä»£ç çš„è¯­å¥ï¼Œç§°ä¸ºä¼ªæŒ‡ä»¤è¯­å¥ã€‚å¦‚\"DB\"ï¼Œåªæ˜¯å‘Šè¯‰æ±‡ç¼–ç¨‹åºï¼ˆmasm.exeï¼‰å¼€å§‹å®šä¹‰å­—èŠ‚å‹æ•°æ®ï¼Œå¼€å§‹åˆ†é…ç©ºé—´ã€‚è¿™æ¡è¯­å¥æ˜¯æ±‡ç¼–æ—¶å®Œæˆçš„ï¼Œå¹¶ä¸æ˜¯æ‰§è¡Œæ—¶å®Œæˆçš„ã€‚\n\n### å®æŒ‡ä»¤è¯­å¥\n\næœ¬èº«æ˜¯8086æŒ‡ä»¤ç³»ç»Ÿæ²¡æœ‰çš„æŒ‡ä»¤ï¼Œæ˜¯ç”¨æˆ·ç”¨**å®å®šä¹‰ä¼ªæŒ‡ä»¤**å®šä¹‰çš„ä¸€æ¡æ–°çš„è¯­å¥ã€‚\n\n## æ±‡ç¼–è¯­è¨€ä¸­è¯­å¥çš„ç»„æˆ\n\nåç§°+åŠ©è®°ç¬¦+æ“ä½œæ•°+æ³¨é‡Š\n\nå˜é‡åç§°ã€æ ‡å·åå¿…é¡»ä»¥å­—æ¯æ‰“å¤´ï¼Œæ“ä½œæ•°å¿…é¡»ä»¥0~9æ‰“å¤´ã€‚\n\n```x86asm\nDAT1 DB 12H,-12,12\t;æ³¨é‡Š\t;DAT1ä¸ºå˜é‡å\nDAT2 DW ?\t;å®šä¹‰æ—¶è‹¥ä¸èµ‹å€¼ï¼Œåˆ™éœ€æ ‡é—®å·;å¯ä»¥MOV DAT2,AXå†™å…¥æ•°æ®\n...\nNEXT: MOV AX,BX\t\t;NEXTä¸ºæ ‡å·åï¼Œå°†æ­¤å¤„è¯­å¥çš„åœ°å€ç¬¦å·åŒ–\n...\nADD AX,DAT2\t\t\t;\nJZ NEXT\t\t\t\t;åˆ¤ZFæ ‡å¿—æ˜¯å¦ä¸º1ï¼Œè‹¥ä¸º1åˆ™è¯´æ˜AXåŠ å’Œä¸º0ï¼Œåˆ™è·³è½¬çš„æ¡ä»¶æ»¡è¶³ï¼Œåˆ™è·³è‡³NEXT\n```\n\n## æ±‡ç¼–è¯­è¨€ä¸­çš„å¸¸æ•°åŠè¡¨è¾¾å¼\n\n### å¸¸æ•°\n\nåå…­è¿›åˆ¶å¸¸æ•°ï¼Œä»¥Hç»“å°¾ï¼›äºŒè¿›åˆ¶å¸¸æ•°ï¼Œä»¥Bç»“å°¾ï¼›åè¿›åˆ¶å¸¸æ•°ï¼Œä»¥Dç»“å°¾ï¼Œå¯ä»¥ç¼ºçœ\n\nå­—ç¬¦å¸¸æ•°'A'ï¼›å­—ç¬¦ä¸²å¸¸æ•°'THIS IS A ...'\n\n### è¡¨è¾¾å¼\n\n#### ç®—æœ¯è¡¨è¾¾å¼\n\n#### é€»è¾‘è¡¨è¾¾å¼\n\nAND/OR/NOT\n\n#### å…³ç³»è¡¨è¾¾å¼\n\nLT: å°äº\n\n\n#### å±æ€§è¡¨è¾¾å¼\n\n##### æ ‡å·\n\næ ‡å·ä¸€æ—¦å®šä¹‰äº†ï¼Œå°±å…·æœ‰3ä¸ªå±æ€§ã€‚\n\n1. 16ä½æ®µåœ°å€ã€‚è·å–å±æ€§æ“ä½œç¬¦ï¼šSEG\n\n2. 16ä½æ®µå†…åç§»åœ°å€ã€‚è·å–å±æ€§æ“ä½œç¬¦ï¼š**OFFSETï¼ˆå¸¸ç”¨ï¼‰**\n\n   ```x86asm\n   MOV BX,OFFSET NEXT\t;NEXTæ˜¯æ ‡å·åç§°\n   ```\n\n   \n\n3. ç±»å‹ã€‚è·å–æ ‡å·å¯¹åº”çš„ç±»å‹ï¼šTYPE\n\n   æœ‰ä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯è·³è½¬ç›®çš„åœ°å’Œè·³è½¬è¯­å¥åœ¨åŒä¸€ä¸ªä»£ç æ®µï¼Œåˆ™ä¸ºæ®µå†…NEARè¿‘ç¨‹å‹ï¼Œå€¼ä¸º-1ï¼›ä¸€ç§æ˜¯è·³è½¬ç›®çš„åœ°å’Œè·³è½¬è¯­å¥ä¸åœ¨åŒä¸€ä¸ªä»£ç æ®µï¼Œåˆ™æ˜¯æ®µé—´FARè¿œç¨‹å‹ï¼Œå€¼ä¸º-2ã€‚\n\n##### å˜é‡åŠå˜é‡å®šä¹‰ä¼ªæŒ‡ä»¤\n\n| å˜é‡å®šä¹‰ä¼ªæŒ‡ä»¤ | ç”¨é€”                 |\n| -------------- | -------------------- |\n| DB             | å®šä¹‰å­—èŠ‚å‹å˜é‡ï¼Œ8ä½  |\n| DW             | å®šä¹‰å­—å‹å˜é‡ï¼Œ16ä½   |\n| DD             | å®šä¹‰åŒå­—å‹å˜é‡ï¼Œ32ä½ |\n\nå˜é‡ä¸€æ—¦å®šä¹‰äº†ï¼Œå°±å…·æœ‰5ä¸ªå±æ€§ã€‚\n\n1. 16ä½æ®µåœ°å€ã€‚è·å–å±æ€§æ“ä½œç¬¦ï¼šSEG\n\n2. 16ä½æ®µå†…åç§»åœ°å€ã€‚è·å–å±æ€§æ“ä½œç¬¦ï¼š**OFFSETï¼ˆå¸¸ç”¨ï¼‰**\n\n3. ç±»å‹ã€‚è·å–æ ‡å·å¯¹åº”çš„ç±»å‹ï¼šTYPE\n\n   | å˜é‡å®šä¹‰ä¼ª | ç±»å‹       | ç±»å‹å€¼ï¼ˆå­—èŠ‚æ•°ï¼‰ |\n   | ---------- | ---------- | ---------------- |\n   | DB         | å­—èŠ‚å‹å˜é‡ | 1                |\n   | DW         | å­—å‹å˜é‡   | 2                |\n   | DD         | åŒå­—å‹å˜é‡ | 4                |\n\n   ```x86asm\n   MOV AL,TYPE DAT1\t;ç­‰æ•ˆäºMOV AL,1\n   ```\n\n4. é•¿åº¦ã€‚è·å–å±æ€§æ“ä½œç¬¦ï¼šLENGTH\n\n   å˜é‡çš„é•¿åº¦æŒ‡åœ¨å˜é‡åå®šä¹‰è¯­å¥ä¸­ï¼Œæ‰€å®šä¹‰çš„**å˜é‡çš„ä¸ªæ•°**ã€‚æ¯”å¦‚åœ¨å˜é‡å®šä¹‰çš„è¯­å¥ä¸­å‡ºç°äº†DUPé‡å¤æ“ä½œç¬¦ï¼Œé‚£ä¹ˆé‡å¤æ“ä½œç¬¦å‰çš„æ•°å€¼ä¾¿æ˜¯å®šä¹‰çš„**å˜é‡çš„ä¸ªæ•°**ï¼›å¦‚æœæ²¡æœ‰å‡ºç°DUPé‡å¤æ“ä½œç¬¦ï¼Œåˆ™è®¤ä¸ºåªå®šä¹‰äº†ä¸€ä¸ªå˜é‡ã€‚\n\n5. å¤§å°ã€‚è·å–å±æ€§æ“ä½œç¬¦ï¼šSIZE\n\n   å˜é‡çš„é•¿åº¦æŒ‡åœ¨å˜é‡åå®šä¹‰è¯­å¥ä¸­ï¼Œæ‰€å®šä¹‰çš„**æ‰€æœ‰å˜é‡å ç”¨çš„æ€»çš„å­—èŠ‚æ•°**ã€‚é‚£ä¹ˆï¼ŒSIZE=TYPE\\*LENGTH\n\n##### æ€»ç»“\n\nOFFSETè·å–çš„æ®µå†…åç§»åœ°å€å±æ€§æœ€å¥½èµ‹ç»™åœ°å€å¯„å­˜å™¨ï¼ŒBX/BPä¸ºåŸºå€å¯„å­˜å™¨ï¼ŒSI/DIä¸ºå˜å€å¯„å­˜å™¨ã€‚å¦‚æœèµ‹ç»™AXæ²¡æœ‰æ„ä¹‰ã€‚\n\n##### ä¾‹\n\nåœ¨DSæ®µæœ‰ä»¥ä¸‹å˜é‡å®šä¹‰\n\n```x86asm\nDAT1 DB 12,12H,-12,'1'\n```\n\n![image-20210728155350067](../../images/%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86/image-20210728155350067.png)\n\nåœ¨masm.exeç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€ä¸ª\"\\$\"ç¬¦å·â€”â€”ä½ç½®è®¡æ•°å™¨ï¼Œè®°å½•åç§»åœ°å€ã€‚æ¯å®šä¹‰ä¸€ä¸ªå˜é‡ï¼Œ$åˆ™ä¼šæŒ‡å‘ä¸‹ä¸€ä¸ªå°†è¦è¢«ä½¿ç”¨çš„å­˜å‚¨å•å…ƒåœ°å€ã€‚æ˜¯16ä½å˜é‡ã€‚æœ¬èº«çš„å€¼ä¹Ÿæ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œæ—¢ç„¶æ˜¯å¸¸æ•°ï¼Œé‚£ä¹ˆåœ¨ç¨‹åºä¸­ä¹Ÿå¯ä»¥å¼•ç”¨ã€‚\n\n```x86asm\nDAT1 DB 12,12H,-12,'1'\n;DAT2 DB $\t;DBå®šä¹‰ä¸å¯¹ï¼Œå› ä¸º$æ˜¯16ä½æ•°æ®ã€‚\nDAT2 DW $\t;å½“æ‰§è¡Œåˆ°è¿™ä¸€å¥æ—¶ï¼Œ$å·²ç»æŒ‡å‘äº†ä¸‹ä¸€ä¸ªå°†è¦è¢«ä½¿ç”¨çš„å­˜å‚¨å•å…ƒåœ°å€ï¼Œå³$ä¸­çš„å€¼æ˜¯0004Hï¼Œåˆ™è¿™æ¡è¯­å¥çš„æ„æ€æ˜¯å°†0004Hå­˜å…¥0004Hå­˜å‚¨å•å…ƒï¼Œå…¶ä¸­ï¼Œä½åœ°å€å­˜æ”¾ä½ä½æ•°æ®04Hï¼Œé«˜åœ°å€å­˜æ”¾é«˜ä½æ•°æ®00Hã€‚\n```\n\n![image-20210728160206056](../../images/%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86/image-20210728160206056.png)\n\n```x86asm\n;å‡è®¾DAT3çš„æ®µåœ°å€æ˜¯1500Hï¼Œåç§»åœ°å€æ˜¯000AHï¼›DAT6çš„åç§»åœ°å€æ˜¯0016H\nDAT6 DW DAT3\t;æ­¤è¯­å¥çš„æ„æ€ä¸æ˜¯å–DAT3çš„å€¼ç»™DAT6ï¼Œè€Œæ˜¯æŠŠDAT3çš„åç§»åœ°å€èµ‹ç»™DAT6ã€‚å³æŠŠ000AHèµ‹ç»™DAT6å­˜å‚¨ç©ºé—´ã€‚\nDAT7 DD DAT3\t;æ­¤æ—¶DAT7å¯¹åº”çš„åç§»åœ°å€æ˜¯0018Hï¼ŒDDå˜é‡å°†å ç”¨4ä¸ªå­—èŠ‚å­˜å‚¨å•å…ƒï¼Œç”±äº4ä¸ªå­—èŠ‚å¯ä»¥åˆ†ä¸º2ä¸ªåŒå­—ç©ºé—´ï¼Œåˆ™æ±‡ç¼–æ—¶ä¼šå°†DAT3çš„åç§»åœ°å€å’Œæ®µåœ°å€éƒ½å­˜æ”¾åˆ°DAT7ä¸­ã€‚\n```\n\n![image-20210728161510404](../../images/%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86/image-20210728161510404.png)\n\n###### é‡å¤æ“ä½œç¬¦(DUP)\n\n```x86asm\nDAT8 DB 4 DUP(?)\t;DUBä¸ºé‡å¤æ“ä½œç¬¦ï¼Œå·¦è¾¹çš„4æ˜¯æŒ‡è¦é‡å¤çš„æ¬¡æ•°ï¼Œæ‹¬å·å†…æ˜¯è¦é‡å¤å®šä¹‰çš„å€¼ï¼Œè¿™é‡Œçš„?ä»£è¡¨éšæœºå€¼ã€‚\n```\n\n![image-20210728161729544](../../images/%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86/image-20210728161729544.png)\n\n```x86asm\nDAT9 DW 3 DUP(?)\n```\n\n![image-20210728162021258](../../images/%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86/image-20210728162021258.png)\n\n##### æ³¨æ„åŒºåˆ†\n\nè¦åŒºåˆ†å˜é‡å®šä¹‰å’Œèµ‹å€¼æ—¶çš„åŒºåˆ«ã€‚\n\n```x86asm\nMOV AL,DAT1+2\t;æŒ‡çš„æ˜¯æŠŠ(DAT1+2)å­˜å‚¨å•å…ƒä¸­çš„â€œå†…å®¹â€èµ‹ç»™ALå¯„å­˜å™¨ã€‚(DAT1+2)å­˜å‚¨å•å…ƒä¸­çš„å†…å®¹ç›®å‰æ˜¯â€œF4Hâ€ï¼Œåˆ™æŠŠâ€œF4Hâ€ä¼ ç»™äº†ALã€‚é‡‡ç”¨çš„å¯»å€æ–¹å¼æ˜¯ç›´æ¥å¯»å€ã€‚\nDAT123 DW DAT1\t;æŒ‡çš„æ˜¯æŠŠDAT1çš„åç§»åœ°å€å­˜åˆ°DAT123çš„å­˜å‚¨å•å…ƒä¸­å»ã€‚ \n```\n\n##### å±æ€§ä¸´æ—¶ä¿®æ”¹æ“ä½œç¬¦(PTR)\n\n```x86asm\nMOV AX,DAT1\t;æ­¤å¥è¯­æ³•é”™è¯¯ï¼Œå› ä¸ºAXæ˜¯16ä½å¯„å­˜å™¨ï¼Œè€ŒDAT1æ˜¯DBç±»å‹çš„å˜é‡ï¼Œå 8ä½ã€‚ç±»å‹ä¸åŒ¹é…ï¼Œæ— æ³•å®Œæˆèµ‹å€¼ã€‚\n```\n\nç±»å‹ä¸ä¸€è‡´æ— æ³•èµ‹å€¼æ—¶ï¼Œå¯ä»¥ä½¿ç”¨PTR\n\n```x86asm\nMOV AX,WORD PTR DAT1\t;å°†DAT1åœ¨è¿™æ¡è¯­å¥ä¸­ä¸´æ—¶è½¬æ¢ä¸ºå­—å‹æ•°æ®ã€‚è„±ç¦»è¿™æ¡è¯­å¥åä»ç„¶æ˜¯å­—èŠ‚å‹å˜é‡ã€‚\n```\n\n###### åº”ç”¨\n\nBYTE PTR [BX]\n\n```x86asm\nMOV [BX],10H\t;è¯­æ³•é”™è¯¯ï¼Œå› ä¸ºä¸çŸ¥é“[BX]æ‰¾åˆ°çš„åœ°å€çš„é‚£ä¸ªå­˜å‚¨å•å…ƒæ˜¯ä»€ä¹ˆç±»å‹çš„ï¼Œå°±ä¸çŸ¥é“é‚£ä¸ªå­˜å‚¨å•å…ƒå å‡ å­—èŠ‚ï¼Œé‚£ä¹ˆå°±ä¸çŸ¥é“10Hè¯¥å¦‚ä½•å¤„ç†ï¼ˆæ˜¯å¤„ç†ä¸º10Hè¿˜æ˜¯0010Hï¼‰ã€‚\nMOV BYTE PTR [BX],10H\t;è¿ç”¨PTRæ“ä½œç¬¦æ­£ç¡®å¤„ç†\n```\n\n# æ•°æ®ä¸è½¬ç§»åœ°å€çš„å¯»å€æ–¹å¼\n\nå¯»å€æ–¹å¼å°±æ˜¯æ±‚æ“ä½œæ•°çš„**æ‰€åœ¨åœ°**æˆ–è€…**æ‰€åœ¨å­˜å‚¨å™¨å•å…ƒåœ°å€**çš„æ–¹å¼ã€‚æ±‚å¾—çš„æ“ä½œæ•°ä¸€æ˜¯å¯ä»¥ç”¨æ¥ä½œä¸ºæ•°æ®ç”¨ï¼ŒäºŒæ˜¯å¯ä»¥ç”¨æ¥ä½œä¸ºè½¬ç§»åœ°å€ç”¨ã€‚é‚£ä¹ˆå¯»å€æ–¹å¼å°±åˆ†ä¸ºäº†ä¸¤å¤§ç±»ï¼Œç¬¬ä¸€å¤§ç±»æ˜¯å–æ•°æ®çš„å¯»å€æ–¹å¼ï¼Œç¬¬äºŒå¤§ç±»æ˜¯å…³äºè½¬ç§»åˆ°ç›®çš„åœ°åœ°å€çš„æ“ä½œæ•°åœ¨å“ªæ”¾ç€çš„å¯»å€æ–¹å¼ã€‚å¦‚æœæ˜¯æ®µå†…è½¬ç§»ï¼Œåˆ™è¦æ±‚å¾—16ä½åç§»åœ°å€ç»™IPï¼Œå¦‚æœæ˜¯æ®µé—´è½¬ç§»ï¼Œè¿˜è¦æ±‚å¾—16ä½æ®µåœ°å€ç»™CSã€‚\n![image-20210728172308349](../../images/å¾®æœºåŸç†/image-20210728172308349.png)\n## å…³äºå¯»æ‰¾æ•°æ®çš„å¯»å€æ–¹å¼ï¼ˆ8ç§ï¼‰\n\n### ç«‹å³æ•°å¯»å€\n\nç«‹å³æ•°åªèƒ½åšæºæ“ä½œæ•°ï¼Œä¸èƒ½åšç›®çš„æ“ä½œæ•°ã€‚\n\nMOV AX,1234H\n\n#### æ³¨æ„\n\nç«‹å³æ•°åªèƒ½ä¼ é€ç»™é€šç”¨å¯„å­˜å™¨å’Œå­˜å‚¨å™¨å•å…ƒã€‚\n\nå½“æ®µå¯„å­˜å™¨DS/ES/SSä½œä¸ºDSTæ“ä½œæ•°æ—¶ï¼ŒSRCæ“ä½œæ•°ä¸èƒ½æ˜¯ç«‹å³æ•°å¯»å€ã€‚\n\n### å¯„å­˜å™¨å¯»å€\n\nè¦å¯»æ‰¾çš„æ“ä½œæ•°åœ¨å¯„å­˜å™¨å½“ä¸­ã€‚åˆ™æ˜¯å¯„å­˜å™¨å¯»å€ã€‚\n\n```x86asm\nMOV AX,BX\n```\n\n#### æ³¨æ„\n\n##### MOVä¸¤ä¸ªæ“ä½œæ•°æ—¶ç±»å‹è¦ä¸€è‡´\n\n```X86ASM\nMOV AX,CL\t;ERROR\n```\n\n##### ç±»å‹è¦æ˜ç¡®\n\n```x86asm\nMOV [0200H],56H\t\t\t\t;ERROR\nMOV WORD PTR [0200H],56H\t;æŒ‡æ˜äº†è¯¥å•å…ƒæ˜¯ä¸€ä¸ªå­—å•å…ƒ\n```\n\n##### å½“æ®µå¯„å­˜å™¨DS/ES/SSä½œä¸ºDSTæ“ä½œæ•°æ—¶ï¼ŒSRCæ“ä½œæ•°ä¸èƒ½æ˜¯ç«‹å³æ•°å¯»å€ã€‚\n\nä½†å¯ä»¥é‡‡ç”¨å¯„å­˜å™¨å¯»å€ä½œä¸ºä¸­ä»‹ã€‚\n\n```x86asm\nMOV DS,1500H\t;ERROR\nMOV AX,1500H\nMOV DS,AX\n```\n\n##### CS/IPåªèƒ½ä½œæºæ“ä½œæ•°\n\nCSä»£ç æ®µå¯„å­˜å™¨ï¼ŒIPæŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨ï¼Œéƒ½ä¸å¯ä½œDSTæ“ä½œæ•°ã€‚å¾€å¾€åªè¯»ä¸å†™ã€‚ç”¨æˆ·æ— æƒä¸»è§‚æ›´æ”¹CS/IPçš„å€¼ï¼ŒCS/IPçš„å€¼ä¸€æ˜¯åœ¨åˆå§‹å€¼æ˜¯ç¨‹åºä¸­çš„å†…å­˜å¯åŠ¨æ—¶ç”±æ“ä½œç³»ç»Ÿèµ‹äºˆçš„ã€‚äºŒæ˜¯æ‰§è¡ŒæœŸé—´ç”±è½¬ç§»æŒ‡ä»¤CPUæ‰§è¡Œåæ”¹å˜è€Œèµ‹äºˆçš„ã€‚\n\n### å­˜å‚¨å™¨å¯»å€ï¼ˆ5ç§ï¼‰\n\nè¦å¯»æ‰¾çš„OPRï¼ˆæ“ä½œæ•°ï¼‰åœ¨å­˜å‚¨å™¨æŸå•å…ƒä¸­ï¼Œå­˜å‚¨æ“ä½œæ•°å•å…ƒçš„EAï¼ˆæ®µå†…åç§»åœ°å€ï¼‰å¯ä»¥ç”±ä»¥ä¸‹5ç§å¯»å€æ–¹å¼æ±‚å¾—ã€‚\n\n#### ç›´æ¥å¯»å€\n\næ“ä½œæ•°æ‰€åœ¨å•å…ƒçš„EAæŒ‡ä»¤ä¸­ç›´æ¥ç»™å‡ºã€‚\n\n```x86asm\nMOV AL,[2000H]\t;å®é™…ç¼–ç¨‹ä¸­ï¼Œ2000Hå°†ä¼šç¬¦å·åŒ–ä¸ºå˜é‡\n;åœ¨dsæ®µï¼š\n\t\tdat1 DB 12H\n\t\tdat2 DB 34H\n\t\t...\n;åœ¨CSæ®µï¼š\n\t\t...\n\t\tMOV AL,dat1\t\t;ALæ˜¯å¯„å­˜å™¨å¯»å€ï¼Œdat1æ˜¯ç›´æ¥å¯»å€ã€‚è¯­å¥æ‰§è¡Œå®Œæˆåï¼ŒALä¸­çš„å†…å®¹åˆ™ä¸º(AL)=12H\n```\n\n##### æ³¨æ„\n\nä¸¤ä¸ªå­˜å‚¨å™¨å•å…ƒä¹‹é—´ä¸èƒ½ç›´æ¥ä¼ é€æ•°æ®\n\n```x86asm\nMOV DAT2,DAT1\t;é”™è¯¯ï¼Œä¸¤å­˜å‚¨å™¨å•å…ƒä¹‹é—´ä¸èƒ½ç›´æ¥è¿›è¡Œä¸€åˆ‡çš„æ“ä½œ\nMOV AL,DAT1\nMOV DAT2,AL\n```\n\n#### å¯„å­˜å™¨é—´æ¥å¯»å€\n\n[BX/SI/DI]\n\nä¸‰ä¸ªå¯„å­˜å™¨éƒ½æ˜¯é»˜è®¤å­˜æ”¾çš„DSä¸­çš„åœ°å€ã€‚\n\n![image-20210729135603135](../../images/%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86/image-20210729135603135.png)\n\n```x86asm\nMOV BX,OFFSET DAT1\t;å°†dat1çš„16ä½åç§»åœ°å€ç»™äº†BX\nMOV AL,[BX]\t\t\t;(DS:(BX))-->AL\t;ALé»˜è®¤æ˜¯å­—èŠ‚å‹æ•°æ®ï¼Œåˆ™æŠŠ12Hç»™AL\n```\n\n```x86asm\nMOV [BX],56H\t;ERROR,å› ä¸ºæºæ“ä½œæ•°æ˜¯ç«‹å³æ•°å¯»å€è€Œ[BX]æ²¡æœ‰è¯´æ˜ç±»å‹ã€‚\n```\n\n```x86asm\nMOV BX,OFFSET DAT1\nMOV SI,OFFSET DAT2\nMOV [BX],[SI]\t;ERROR,ä¸¤å­˜å‚¨å™¨å•å…ƒä¹‹é—´ä¸èƒ½ç›´æ¥ä¼ é€æ•°æ®ã€‚\nMOV AL,[SI]\nMOV [BX],AL\n```\n\n\n\n#### å¯„å­˜å™¨ç›¸å¯¹å¯»å€\n\nEA=[BX/BP/SI/DI] + 8/16ä½disp(ç›¸å¯¹ä½ç§»é‡)\n\nä¾‹ï¼šMOV **[BX]+3**,AL\t;ä¹Ÿå¯ç­‰æ•ˆä¸º**[BX+3]æˆ–3+[BX]**,**å¦‚æœç›¸å¯¹ä½ç§»é‡å†™åœ¨å·¦è¾¹ï¼Œåˆ™+å·å¯ä»¥ç¼ºçœã€‚**\n\nå¦‚æœç›¸å¯¹ä½ç§»é‡ä¸ºå¸¸æ•°ï¼šå¦‚æœå¯„å­˜å™¨æ˜¯BX,SI,DIåˆ™æ®µåœ°å€é»˜è®¤åœ¨DSæ®µï¼›å¦‚æœå¯„å­˜å™¨æ˜¯BPåˆ™æ®µåœ°å€åœ¨SSæ®µã€‚\n\n```x86asm\nMOV BX,OFFSET DAT1\nMOV [BX]+3,AL\t;ä¹Ÿå¯ç­‰æ•ˆä¸º[BX+3]æˆ–3+[BX],å¦‚æœç›¸å¯¹ä½ç§»é‡å†™åœ¨å·¦è¾¹ï¼Œåˆ™+å·å¯ä»¥ç¼ºçœã€‚\n```\n\n![image-20210729142813193](../../images/%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86/image-20210729142813193.png)\n\n**å¦‚æœç›¸å¯¹ä½ç§»é‡æ˜¯å˜é‡ï¼šæ®µåœ°å€ç”±å˜é‡çš„æ®µåœ°å€å†³å®šã€‚**\n\n```x86asm\nMOV BX,0\nMOV AL,0\nMOV DAT1[BX],AL\t;å®Œæˆçš„åŠŸèƒ½æ˜¯ï¼šå…ˆè®¡ç®—16ä½åç§»åœ°å€ï¼Œå³OFFSET DAT1+(BX)ä½œä¸ºåç§»åœ°å€ï¼Œæ®µåœ°å€ç”±DAT1å†³å®šï¼Œå†æŠŠALçš„å†…å®¹èµ‹ç»™SEG DAT1:BX+OFFSET DAT1è¿™ä¸ªå­˜å‚¨å•å…ƒä¸­ã€‚\n```\n\n\n\n##### é€šè¿‡ä¸€ä¸ªä¾‹å­ä½“ç°ä¸ºä½•è¦è®¾è®¡ä¸€ä¸ªé»˜è®¤åœ¨SSæ®µçš„BP\n\n![image-20210729143703028](../../images/%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86/image-20210729143703028.png)\n\n```x86asm\nMOV BP,SP\nMOV DX,[BP]+4\n```\n\n![image-20210729144042088](../../images/%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86/image-20210729144042088.png)\n\nè¯¥ä¾‹è¯´æ˜äº†ï¼Œå¦‚æœä¸æƒ³ç ´åSPæ ˆé¡¶æŒ‡é’ˆï¼Œåˆ™å¯ä»¥æ–¹ä¾¿çš„ç”¨BPæ¥æ›¿ä»£å…¶æŒ‡å‘æ ˆé¡¶ï¼Œè€Œä¸”é»˜è®¤çš„æ®µåœ°å€åœ¨å †æ ˆæ®µï¼Œæ‰€ä»¥æ“ä½œæ ˆæ¯”è¾ƒæ–¹ä¾¿ã€‚\n\n#### åŸºå€ã€å˜å€å¯»å€\n\nåŸºå€ï¼š[BX/BP]ï¼Œå˜å€ï¼š[SI/DI]ã€‚EA=[BX/BP]+[SI/DI]\n\næ®µåœ°å€çš„ç¡®è®¤ä»¥åŸºå€å¯„å­˜å™¨æ¥å†³å®šã€‚BXé»˜è®¤ä¸ºDSï¼ŒBPé»˜è®¤ä¸ºSSã€‚\n\n```x86asm\n\tDAT1 DB 12H\n\tDAT2 DB 34H\n\t...\n\tMOV CX,10\n\tMOV BX,OFFSET DAT1\n\tMOV SI,0\n\tMOV AL,0\nNEXT: MOV [BX][SI],AL\n\tINC SI\t\t\t;SIçš„å€¼å¢1\n\tLOOP NEXT\t\t;CXçš„å€¼å¾ªç¯å‡1ï¼Œè‹¥ä¸ä¸º0åˆ™è·³è½¬åˆ°NEXT\n```\n\n![image-20210729145047000](../../images/%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86/image-20210729145047000.png)\n\n#### åŸºå€ã€å˜å€ä¸”ç›¸å¯¹å¯»å€\n\nåŸºå€ï¼š[BX/BP]ï¼Œå˜å€ï¼š[SI/DI]ã€‚EA=[BX/BP]+[SI/DI]+8/16disp\n\nå¦‚æœç›¸å¯¹ä½ç§»é‡æ˜¯å˜é‡ï¼Œåˆ™æ®µåœ°å€ä»¥å˜é‡çš„æ®µåœ°å€ä¸ºå‡†ã€‚\n\n### éšå«å¯»å€\n\næŒ‡ä»¤ä¸­å¹¶æœªå†™å‡ºæ“ä½œæ•°ï¼Œä½†CPUæ‰§è¡ŒæŒ‡ä»¤æ—¶çŸ¥é“æ“ä½œæ•°åœ¨å“ªé‡Œã€‚\n\n```x86asm\n...\nPUSH AX\n...\n;1.        SP <-- (SP)-2\n;2. (SS:(SP)) <-- (AX)\n```\n\n## å…³äºè½¬ç§»åœ°å€çš„å¯»å€æ–¹å¼\n\n","categories":["å¾®æœºåŸç†"]},{"title":"å…³äºx86å’Œx64","url":"/å¾®æœºåŸç†/å¾®ä¿¡åŸç†_å…³äºx86å’Œx64/","content":"\nhttps://www.cnblogs.com/netserver/p/11106130.html\n\nhttps://www.zhihu.com/question/47389187/answer/106229744\n\n![image-20210724144729788](../../images/%E5%85%B3%E4%BA%8Ex86%E5%92%8Cx64/image-20210724144729788.png)\n\nhttps://www.zhihu.com/question/47389187/answer/656682145\n\n![image-20210724144752256](../../images/%E5%85%B3%E4%BA%8Ex86%E5%92%8Cx64/image-20210724144752256.png)\n\n","categories":["æ“ä½œç³»ç»Ÿ","å¾®æœºåŸç†"]},{"title":"Cè¯­è¨€_å…³äºæŒ‡é’ˆçš„è§£å¼•ç”¨ä¸++","url":"/C/Cè¯­è¨€_å…³äºæŒ‡é’ˆçš„è§£å¼•ç”¨ä¸++/","content":"# è¿ç®—ç¬¦åŠå…¶ä¼˜å…ˆçº§\n\n![image-20210723180215871](../../images/%E5%85%B3%E4%BA%8E%E6%8C%87%E9%92%88%E7%9A%84%E4%B8%8E++/image-20210723180215871.png)\n\n# int x=++*p++;\n\n![image-20210723175726868](../../images/%E5%85%B3%E4%BA%8E%E6%8C%87%E9%92%88%E7%9A%84%E4%B8%8E++/image-20210723175726868.png)\n\n++ä¸\\*çš„è¿ç®—ä¼˜å…ˆçº§æ˜¯å¹³çº§å…³ç³»ï¼Œéƒ½æ˜¯å•ç›®è¿ç®—ç¬¦ï¼Œè¿ç®—é¡ºåºæ˜¯ä»å³å‘å·¦è¿›è¡Œï¼Œä»€ä¹ˆæ˜¯è¿ç®—é¡ºåºå‘¢ï¼Ÿå°±æ¯”å¦‚åŠ å‡æ³•ä¸¤ä¸ªè¿ç®—ç¬¦æ˜¯å¹³çº§å…³ç³»ï¼Œä½†è¿ç®—é¡ºåºæ˜¯å·¦åˆ°å³è¿›è¡Œï¼Œå°±æ¯”å¦‚1+2-3æ˜¯å…ˆè®¡ç®—å·¦è¾¹çš„'+'å†è®¡ç®—å³è¾¹çš„'-'ã€‚é‚£ä¹ˆæ ¹æ®ä¼˜å…ˆçº§è¡¨ï¼Œ++ä¸\\*æ˜¯ä»å³å‘å·¦é¡ºåºè¿›è¡Œçš„ï¼Œåˆ™æ­¤å¤„çš„++\\*p++ï¼Œå…ˆè®¡ç®—ç¬¬äºŒä¸ª++ï¼Œå†è®¡ç®—\\*ï¼Œå†è®¡ç®—ç¬¬ä¸€ä¸ª++ã€‚\n\nå¯ä»¥å¦‚æ­¤ç†è§£ï¼šåç½®++çš„ç‰¹ç‚¹æ˜¯ï¼šå°†è¦è¿ç®—æ—¶ï¼Œå¾…å‰é¢å…¨éƒ¨çš„è¡¨è¾¾å¼è¿ç®—å®Œæ¯•åæ‰ä¼šè¿›è¡Œï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ++\\*p++çœ‹ä½œæ˜¯ï¼š(++\\*)p++ï¼Œå¾…++\\*på…¨éƒ¨è®¡ç®—å®Œæˆåï¼Œå†å•ç‹¬ç»™p++ã€‚é‚£ä¹ˆï¼šä¸‹ä¸€æ­¥å°±å˜æˆäº†è®¡ç®—++\\*pï¼Œæ­¤å¤„*åœ¨++è¿ç®—ç¬¦çš„å³è¾¹ï¼Œåˆ™å…ˆ\\*på–å€¼ï¼Œå†è¯´++ã€‚å‰ç½®++çš„ç‰¹ç‚¹æ˜¯å…ˆ+1å¹¶å›å†™ï¼Œæ­¤å¤„æ“ä½œçš„å¯¹è±¡æ˜¯\\*pã€‚æ•´ä¸ªå‰ç½®++\\*pæ“ä½œå®Œåï¼Œ(++\\*)p++çš„å‰åŠéƒ¨åˆ†å°±ç»“æŸäº†ã€‚è¿™æ—¶æˆ‘ä»¬å†å•ç‹¬ç»™pè¿›è¡Œåç½®++ï¼Œæ“ä½œçš„å¯¹è±¡æ˜¯æŒ‡é’ˆpè€Œä¸æ˜¯\\*pï¼Œå› ä¸º\\*å·²ç»åšè¿‡äº†è¿ç®—ã€‚\n\næœ€åç»“æœï¼šx=1, a=1.","categories":["C"]},{"title":"Redis_é“¾è¡¨","url":"/Redis/Redis_é“¾è¡¨/","content":"# é“¾è¡¨\n\n```c\nlist list={&node1,&node2,}\n```\n\n","categories":["é«˜çº§æ•°æ®ç»“æ„","Redis"]},{"title":"Cè¯­è¨€_æŒ‡é’ˆ_å…¥é—¨","url":"/C/Cè¯­è¨€_æŒ‡é’ˆ_å…¥é—¨/","content":"æœ¬ç« å†…å®¹ï¼š\n1. ä»€ä¹ˆæ˜¯æŒ‡é’ˆ\n2. æŒ‡é’ˆçš„å®šä¹‰\n3. æŒ‡é’ˆçš„åº”ç”¨\n4. æŒ‡é’ˆçš„è¿ç®—\n5. æŒ‡é’ˆä¸æ•°ç»„çš„å…³ç³»\n6. æŒ‡é’ˆå’Œæ•°ç»„ï¼Œå‡½æ•°ç¤ºä¾‹\n7. äºŒçº§æŒ‡é’ˆ\n# ä»€ä¹ˆæ˜¯æŒ‡é’ˆ\n\nè®¡ç®—æœºä¸­æ‰€æœ‰çš„æ•°æ®éƒ½å¿…é¡»æ”¾åœ¨å†…å­˜ä¸­ï¼Œä¸åŒç±»å‹çš„æ•°æ®å ç”¨çš„å­—èŠ‚æ•°ä¸ä¸€æ ·ï¼Œä¾‹å¦‚`int`å ç”¨ 4 ä¸ªå­—èŠ‚ï¼Œchar å ç”¨ 1 ä¸ªå­—èŠ‚ã€‚ä¸ºäº†æ­£ç¡®åœ°è®¿é—®è¿™äº›æ•°æ®ï¼Œå¿…é¡»ä¸ºæ¯ä¸ªå­—èŠ‚éƒ½ç¼–ä¸Šå·ç ï¼Œå°±åƒé—¨ç‰Œå·ä¸€æ ·ï¼Œæ¯ä¸ªå­—èŠ‚çš„ç¼–å·æ˜¯å”¯ä¸€çš„ï¼Œæ ¹æ®ç¼–å·å¯ä»¥å‡†ç¡®åœ°æ‰¾åˆ°æŸä¸ªå­—èŠ‚ã€‚ æˆ‘ä»¬å°†å†…å­˜ä¸­å­—èŠ‚çš„ç¼–å·ç§°ä¸ºåœ°å€ï¼ˆAddressï¼‰æˆ–æŒ‡é’ˆï¼ˆPointerï¼‰ã€‚åœ°å€ä» 0 å¼€å§‹ä¾æ¬¡å¢åŠ ï¼Œå¯¹äº 32 ä½ç¯å¢ƒï¼Œç¨‹åºèƒ½å¤Ÿä½¿ç”¨çš„å†…å­˜ä¸º 4GBã€‚\næœ€å°çš„åœ°å€ä¸º`0x0000 0000`ï¼Œæœ€å¤§çš„åœ°å€ä¸º`0XFFFF FFFF`ã€‚\n![image-20210720094948057](../../images/Cè¯­è¨€_æŒ‡é’ˆ/image-20210720094948057.png)\n## å¯¹æ˜Ÿå·`*`çš„æ€»ç»“\n1. è¡¨ç¤ºä¹˜æ³•ã€‚\n2. è¡¨ç¤ºå®šä¹‰ä¸€ä¸ªæŒ‡é’ˆå˜é‡ï¼Œä»¥å’Œæ™®é€šå˜é‡åŒºåˆ†å¼€\n3. è¡¨ç¤ºè§£å¼•ç”¨ã€‚è·å–æŒ‡é’ˆæŒ‡å‘çš„æ•°æ®ï¼Œæ˜¯ä¸€ç§é—´æ¥æ“ä½œã€‚\n\n`*`å·è¿ç®—ç¬¦æ‰€åœ¨çš„ç¯å¢ƒä¸ä¸€æ ·ï¼Œ`*`å·çš„å«æ„ä¹Ÿä¸ä¸€æ ·ã€‚\n```c\nint main()\n{\n\tint a = 10, b = 20;\n\tint c = a * b;//è¡¨ç¤ºä¹˜å·\n    \n    int * p;//å£°æ˜æŒ‡é’ˆ\n    p = &a;\n    * p = 100;//è§£å¼•ç”¨\n    \n    return 0;\n}\n```\n# å®šä¹‰æŒ‡é’ˆå˜é‡\n## ä¸€å®šè¦åœ¨å®šä¹‰æ—¶åˆå§‹åŒ–\nè¦ä¹ˆåˆå§‹åŒ–ä¸ºç©ºï¼Œè¦ä¹ˆæŒ‡å‘å·²æœ‰å˜é‡çš„åœ°å€ã€‚å¦åˆ™æŒ‡é’ˆæŒ‡å‘çš„ä½ç½®ä¸å¯æ§ï¼Œå¯èƒ½åœ¨æ“ä½œæŒ‡é’ˆæ—¶ä¼šæ”¹å˜å…¶ä»–æ­£åœ¨è¿è½¬çš„å€¼ã€‚\n```c\nint main()\n{\n    int *p , s; // p æ˜¯æ•´å‹æŒ‡é’ˆå˜é‡ï¼Œs æ˜¯æ•´å‹å˜é‡ã€‚\n    char *cpa , *cpb; // cpa å’Œ cpb éƒ½æ˜¯char ç±»å‹æŒ‡é’ˆå˜é‡ã€‚\n    int a = 10;\n    // ä»¥ä¸‹ä¸¤å¥ä¸ int *p = &a; ç­‰ä»·\n    int * ip; // æœªåˆå§‹åŒ–çš„æŒ‡é’ˆï¼Œä¸è‰¯çš„å®šä¹‰ä¹ æƒ¯\n    ip = &a; \n    return 0;\n}\n```\n## å›¾è§£\n![image-20210720101404483](../../images/Cè¯­è¨€_æŒ‡é’ˆ/image-20210720101404483.png)\nå®šä¹‰æŒ‡é’ˆå˜é‡æ—¶ï¼Œç±»å‹å¯¹æŒ‡é’ˆå˜é‡èµ·åˆ°2ä¸ªä½œç”¨ï¼š\n1. è§£æå­˜å‚¨å•å…ƒçš„å¤§å°;\n2. æŒ‡é’ˆå˜é‡åŠ 1çš„èƒ½åŠ›ã€‚\n\nå¦‚ï¼š\n1. `double da = *dp;`\n2. `int ib = *ip;`\n3. `char cc = *cp;`\n## ç»¼åˆå®ä¾‹\n```c\nvoid fun(int *p)\n{\n    int a = 200;\n    *p = 100;\n    p = &a;\n}\nint main()\n{\n    int x = 0;\n    int *s = &x;\n    fun(s);\n    printf(\"%d %d\\n\",x,*s);//x=100, *s=200æˆ–å¤±æ•ˆï¼Œå› ä¸ºint aåœ¨funå‡½æ•°è°ƒç”¨åé‡Šæ”¾äº†ã€‚é”™ï¼*sæ˜¯100ã€‚\n    return 0;\n}\n```\n![image-20210720105039607](../../images/Cè¯­è¨€_æŒ‡é’ˆ/image-20210720105039607.png)\n# æŒ‡é’ˆçš„è¿ç®—\n## æŒ‡é’ˆ+1\n`typename * p;`\n`p = p + 1;`è¢«ç¼–è¯‘å™¨è§£é‡Šæˆï¼š`p = p + sizeof(typename) * 1;`\n### ç¤ºä¾‹1ï¼šintæŒ‡é’ˆå˜é‡åŠ 1\n```c\n#include<stdio.h>\nint main()\n{\n    const int n = 5;\n    int ar[n]={12,23,34,45,56};\n    int *ip = &ar[0]; // int *ip = ar;\n    for(int i = 0;i<n;++i)\n    {\n        printf(\"0x%08X => %d \\n\",ip,*ip);\n        ip = ip + 1;\n    }\n    printf(\"\\n\");\n    return 0;\n}\n```\n![image-20210720110054100](../../images/Cè¯­è¨€_æŒ‡é’ˆ/image-20210720110054100.png)\n### ç¤ºä¾‹2ï¼šcharç±»å‹æŒ‡é’ˆå˜é‡+1\n```c\n#include<stdio.h>\nint main()\n{\n    const int n = 5;\n    char ar[n]={'t','u','l','u','n'};\n    char *cp = &ar[0]; // char *cp = ar;\n    for(int i = 0;i<n;++i)\n    {\n        printf(\"0x%08X => %c \\n\",cp,*cp);\n        // printf(\"%#p => %c \\n\",cp,*cp);\n        cp = cp + 1;\n    }\n    printf(\"\\n\");\n    return 0;\n}\n```\n![image-20210720110059739](../../images/Cè¯­è¨€_æŒ‡é’ˆ/image-20210720110059739.png)\n### ç¤ºä¾‹3ï¼šdoubleç±»å‹æŒ‡é’ˆå˜é‡+1\n```c\n#include<stdio.h>\nint main()\n{\n    const int n = 5;\n    double ar[n]={1.2, 2.3, 3.4, 4.5, 5.6};\n    double *dp = &ar[0]; // char *cp = ar;\n    for(int i = 0;i<n;++i)\n    {\n        printf(\"0x%08X => %f \\n\",dp,*dp);\n        // printf(\"%#p => %f \\n\",dp,*dp);\n        dp = dp + 1;\n    }\n    printf(\"\\n\");\n    return 0;\n}\n```\n### æŒ‡é’ˆ+1è¯¦è§£\n\n![image-20210720110426346](../../images/Cè¯­è¨€_æŒ‡é’ˆ/image-20210720110426346.png)\n## æ€è€ƒä¸‹é¢ä»£ç è¿è¡Œç»“æœ\n```c\nint main()\n{\n    int ar[5]={12, 23, 34, 45, 56 };\n    int *p = ar; // int *p = &ar[0];\n    int x = 0;\n    int y = 0;\n    x = *p++; //int x = *p; p++;\n    y = *p;\n    printf(\"%d %d \\n\",x,y);\n    x = ++*p;\n    y = *p;\n    printf(\"%d %d \\n\",x,y);\n    x = *++p;\n    y = *p;\n    printf(\"%d %d \\n\",x,y);\n    return 0;\n}\n```\n\n![image-20210722152558428](../../images/C%E8%AF%AD%E8%A8%80_%E6%8C%87%E9%92%88/image-20210722152558428.png)\n\n![image-20210722152657523](../../images/C%E8%AF%AD%E8%A8%80_%E6%8C%87%E9%92%88/image-20210722152657523.png)\n## æ€»ç»“\n### æŒ‡é’ˆçš„ç±»å‹å†³å®šäº†ä¸¤ä¸ªèƒ½åŠ›\n1. +1çš„èƒ½åŠ›ï¼Œåç§»é‡ã€‚\n2. å¯¹å†…å­˜çš„è§£æèƒ½åŠ›ã€‚\n\n![image-20210722154957018](../../images/C%E8%AF%AD%E8%A8%80_%E6%8C%87%E9%92%88/image-20210722154957018.png)\n\n```c\nix=0x12345678  sx=0x5678 cx=0x78\n```\n### æŒ‡é’ˆæœ‰ä¸¤ä¸ªè¦ç´ \n1. åœ°å€å€¼\n2. æŒ‡é’ˆæŒ‡å‘çš„æ•°æ®ç±»å‹\n# æŒ‡é’ˆä¸æ•°ç»„çš„å…³ç³»\n1. æ•°ç»„åè¢«çœ‹ä½œè¯¥æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ åœ¨å†…å­˜ä¸­çš„é¦–åœ°å€ï¼ˆä»…åœ¨`sizeof`æ“ä½œä¸­ä¾‹å¤–ï¼Œè¯¥æ“ä½œç»™å‡ºæ•°ç»„æ‰€å å†…å­˜å¤§å°ï¼‰ã€‚\n2. æ•°ç»„ååœ¨è¡¨è¾¾å¼ä¸­è¢«è‡ªåŠ¨è½¬æ¢ä¸ºä¸€ä¸ªæŒ‡å‘æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆå¸¸é‡ã€‚\n3. æ•°ç»„åæ˜¯æŒ‡é’ˆï¼Œéå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯å´ä¸¢å¤±äº†æ•°ç»„å¦ä¸€ä¸ªè¦ç´ ï¼šæ•°ç»„çš„å¤§å°ï¼Œå³æ•°ç»„å…ƒç´ çš„æ•°é‡ã€‚ç¼–è¯‘å™¨æŒ‰æ•°ç»„å®šä¹‰æ—¶çš„å¤§å°åˆ†é…å†…å­˜ï¼Œä½†è¿è¡Œæ—¶ï¼ˆrun timeï¼‰å¯¹æ•°ç»„çš„è¾¹ç•Œä¸åŠ æ£€æµ‹ã€‚è¿™ä¼šå¸¦æ¥æ— æ³•é¢„çŸ¥çš„ä¸¥é‡é”™è¯¯ã€‚\n\n![image-20210720111145131](../../images/Cè¯­è¨€_æŒ‡é’ˆ/image-20210720111145131.png)\n\nCæä¾›æ ¹æ®æ•°ç»„çš„å­˜å‚¨åœ°å€è®¿é—®æ•°ç»„å…ƒç´ çš„æ–¹æ³•ã€‚ä¸Šå›¾ä¸­`ar`æ˜¯æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ çš„åœ°å€ï¼Œæ‰€ä»¥`*ar`æ˜¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ `ar[0]`ï¼Œè€Œ`ar+1`æ˜¯æ•°ç»„ç¬¬äºŒä¸ªå…ƒç´ çš„åœ°å€ï¼Œ`*(ar+1)`æ˜¯ç¬¬äºŒä¸ªå…ƒç´ `ar[1]`æœ¬èº«ã€‚æŒ‡é’ˆåŠ 1ï¼Œåˆ™åœ°å€ç§»åŠ¨ä¸€ä¸ªæ•°ç»„å…ƒç´ æ‰€å å­—èŠ‚æ•°ã€‚\n\nCè¯­è¨€çš„ä¸‹æ ‡è¿ç®—ç¬¦`[]`æ˜¯ä»¥æŒ‡é’ˆä½œä¸ºæ“ä½œæ•°çš„ï¼Œ`ar[i]`è¢«ç¼–è¯‘ç³»ç»Ÿè§£é‡Šä¸º`*(ar+i)`ï¼Œå³è¡¨ç¤ºä¸º`ar`æ‰€æŒ‡ï¼ˆå›ºå®šä¸å¯å˜ï¼‰å…ƒç´ å‘åç¬¬`i`ä¸ªå…ƒç´ ã€‚æ— è®ºä»¥ä¸‹æ ‡æ–¹å¼æˆ–æŒ‡é’ˆæ–¹å¼å­˜å–æ•°ç»„å…ƒç´ æ—¶ï¼Œç³»ç»Ÿéƒ½æ˜¯è½¬æ¢ä¸ºæŒ‡é’ˆæ–¹æ³•å®ç°ã€‚é€»è¾‘ä¸Šæœ‰ä¸¤ç§æ–¹å¼ï¼Œç‰©ç†ä¸Šåªæœ‰ä¸€ç§æ–¹å¼ã€‚\n## æ•°ç»„åè®¿é—®\n```c\nint main()\n{\n    const int n = 5;\n    int ar[n] = {1, 2, 3, 4, 5};\n    for(int i = 0;i < n;++i)\n    {\n        printf(\"0x%08x %d %d \\n\",ar+i, ar[i], *(ar+i));\n    }\n    return 0;\n}\n```\n![image-20210720111509965](../../images/Cè¯­è¨€_æŒ‡é’ˆ/image-20210720111509965.png)\n## æŒ‡é’ˆè®¿é—®\n\n```c\nint main()\n{\n    const int n = 5;\n    int ar[n] = {1,2,3,4,5};\n    int *p = ar;\n    for(int i = 0;i<n;++i)\n    {\n        printf(\"0x%08x %d %d\\n\",p+i,p[i],*(p+i));\n    }\n    return 0;\n}\n```\n![image-20210720111538163](../../images/Cè¯­è¨€_æŒ‡é’ˆ/image-20210720111538163.png)\n## æ•°ç»„çš„é€€åŒ–\n\nç”¨æ•°ç»„ä½œä¸ºå‡½æ•°çš„å½¢å‚ï¼Œæ•°ç»„å°†é€€åŒ–ä¸ºæŒ‡é’ˆç±»å‹ã€‚\n\nå¦‚æœæƒ³è¦åœ¨å‡½æ•°ä¸­ä¼ é€’ä¸€ä¸ªä¸€ç»´æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œå¿…é¡»ä»¥ä¸‹é¢ä¸‰ç§æ–¹å¼æ¥å£°æ˜å‡½æ•°å½¢å¼å‚æ•°ï¼Œè¿™ä¸‰ç§å£°æ˜æ–¹å¼çš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºæ¯ç§æ–¹å¼éƒ½ä¼šè½¬æˆæŒ‡é’ˆã€‚\n\n```c\nvoid Print_Array(int br[],int n); //å½¢å¼å‚æ•°æ˜¯ä¸€ä¸ªæœªå®šä¹‰å¤§å°çš„æ•°ç»„ï¼š\nvoid Print_Array(int br[5],int n); //å½¢å¼å‚æ•°æ˜¯ä¸€ä¸ªå·²å®šä¹‰å¤§å°çš„æ•°ç»„\nvoid Print_Array(int *br,int n)ï¼› //å½¢å¼å‚æ•°æ˜¯ä¸€ä¸ªæŒ‡é’ˆ\n```\n\nè¦ç‚¹ï¼šä¸ºä»€ä¹ˆæ•°ç»„ä½œä¸ºå‡½æ•°çš„å½¢å‚ä¼šé€€åŒ–ä¸ºæŒ‡é’ˆå‘¢ï¼Ÿæˆ‘ä»¬å°†ä»æ—¶é—´æ•ˆç‡å’Œç©ºé—´æ•ˆç‡ä¸Šåˆ†æã€‚\n\næˆ‘ä»¬å…ˆå‡è®¾æ•°ç»„ä½œä¸ºå‡½æ•°çš„å½¢å‚ï¼Œæˆ‘ä»¬åˆ†æä¸€ä¸‹è°ƒç”¨è¿‡ç¨‹ï¼›\n\n```c\nvoid Print_Array(int br[5],int n)\n{\n\tint ar_len = sizeof(br);\n\tprintf(\"ar_len : %d \\n\",ar_len);\n}\nint main()\n{\n\tconst int n = 5;\n\tint ar[n] = {1,2,3,4,5};\n\tPrint_Array(ar,n);\n\treturn 0;\n}\n```\n\n```c\n#include<stdio.h>\nvoid Print_Ar(int br[10])//å¦‚æœå¦‚æ­¤å®šä¹‰ï¼Œä¼ å‚æ•°å‰ï¼Œä¸»å‡½æ•°å¼€è¾Ÿäº†æ•°ç»„ç©ºé—´ï¼Œä¼ å‚æ•°æ—¶ï¼Œæ ˆåŒºåˆä¼šå¼€è¾Ÿ10ä¸ªç©ºé—´ï¼è€Œä¸”åˆè¦æµªè´¹æ—¶é—´æŠŠæ•°ç»„ä¸­çš„æ•°æ®ä¾æ¬¡ä¼ å…¥ã€‚æ—¢æµªè´¹ç©ºé—´åˆæµªè´¹ç©ºé—´ã€‚\n{\n    int size=sizeof(br);//åªä¼šæ˜¯4ï¼Œå› ä¸º(int br[10]é€€åŒ–æˆäº†(int *br)\n    printf(\"size: %d \\n\",size);\n}\n```\n### äºŒç»´æ•°ç»„çš„é€€åŒ–\n```c\n//æ‰“å°äºŒç»´æ•°ç»„\nvoid Print_Ar(int(*br)[4],int row,int col)\n{\n    //int n = sizeof(**br);//è™½ç„¶å¯ä»¥é€šè¿‡sizeof(**br);ç®—å‡ºcolumnå³åˆ—æ•°ã€‚ä½†ä¸ºäº†ä½¿ç¨‹åºæ›´åŠ æ–¹ä¾¿åŒ–ï¼Œå®šä¹‰å½¢å‚col\n    printf(\"%d %d\\n\", row, n);\n    for (int i = 0;i < row;++i)\n    {\n        for (int j = 0;j < col;++j)\n        {\n            printf(\"%d \", br[i][j]);\n        }\n        printf(\"\\n\");\n    }\n    printf(\"\\n\");\n}\n```\n\nå¦‚æœäºŒç»´æ•°ç»„çš„å½¢å‚å®šä¹‰ä¸ºï¼š`int [4][5]`ï¼ŒåŒä¸€ç»´æ•°ç»„çš„é“ç†ä¸€æ ·ï¼Œå°†ä¼šé€€åŒ–ä¸º`int(*br)[4]`ã€‚\n## æ•°ç»„åè¡¨ç¤ºæ•°ç»„é¦–å…ƒç´ çš„åœ°å€\n\næ•°ç»„åè¡¨ç¤ºæ•°ç»„é¦–å…ƒç´ çš„åœ°å€ï¼Œè€Œä¸æ˜¯æ•°ç»„çš„åœ°å€ã€‚\n## æ•°ç»„çš„åœ°å€\n```c\nint main()\n{\n    const int n =5;\n    int ar[n] = {12,23,34,45,56};\n    \n    int* ip = ar;//&a[0]\n    int (*s)[5] = &ar;//\n    int* pa[5];\n    return 0;\n}\n```\n\n```c\nint main()\n{\n    int a = 10;\n    int* p = &a;\n    //p: int*, *p: int\n    int a[5];\n    int(*p)[5] = &a;\n    //p: int [5]*, *p: int [5]\n}\n```\n## æŒ‡é’ˆä¸å­—ç¬¦ä¸²\n\n```c\nchar c = \"xcgong\"[2];//æ­¤å¥è¯ç¼–è¯‘åç­‰æ•ˆäºï¼šå­—ç¬¦ä¸²æ•°ç»„çš„é¦–å…ƒç´ åœ°å€å³'y'çš„åœ°å€pï¼Œ+2å–å€¼å*(p+2)èµ‹å€¼ç»™cï¼Œå³'g'ã€‚\n```\n## æ€»ç»“\nè®¿é—®æ•°ç»„æ—¶ï¼Œç¼–è¯‘å™¨ä¼šæŠŠ`x[y]`è½¬æ¢ä¸ºï¼š`*(x+y)`ï¼Œå¯¹åº”æœºå™¨ç çš„åŸºå˜å€å¯»å€ã€‚`x`æ˜¯åŸºåœ°å€ã€‚\n# const\nä¸å¸¦constä¿®é¥°çš„æŒ‡é’ˆæ˜¯è‡ªç”±çš„ï¼Œä¸€æ˜¯è‡ªèº«çš„å€¼å¯ä»¥æ”¹å˜ï¼ŒäºŒæ˜¯æŒ‡å‘çš„å€¼å¯ä»¥æ”¹å˜ã€‚\n```c\nint a = 10, b = 20;\nint *p = &a;\n*p = 100;\np = &b;\n```\n## å¸¦const\n```c\nint a=10,b=20;\n//ä»¥ä¸‹çš„conståœ¨*çš„å·¦è¾¹ï¼Œä¿®é¥°çš„æ˜¯æŒ‡å‘èƒ½åŠ›ï¼ˆä¿®é¥°â€œä¿®æ”¹æŒ‡å‘çš„å€¼â€çš„èƒ½åŠ›ï¼‰ï¼Œä¸¤å¥è¯ç­‰ä»·\nconst int *p = &a;\nint const *p = &a;\n*p = 100;//error\np = &b;  //OK\n//ä»¥ä¸‹çš„conståœ¨*çš„å³è¾¹ï¼Œä¿®é¥°æŒ‡é’ˆè‡ªèº«ï¼Œå¯è¯»ä¸å¯æ”¹å˜è‡ªèº«çš„å€¼\nint * const p = &a;\nint x = *p;\n*p = 100;//OK\np = &b;  //error\n//æœ‰ä¸¤ä¸ªconstï¼Œç¬¬ä¸€ä¸ªä¿®é¥°çš„æ˜¯æŒ‡å‘èƒ½åŠ›ï¼ˆä¿®é¥°â€œä¿®æ”¹æŒ‡å‘çš„å€¼â€çš„èƒ½åŠ›ï¼‰ï¼Œç¬¬äºŒä¸ªä¿®é¥°çš„æ˜¯æŒ‡é’ˆè‡ªèº«\nconst int * const p = &a;\nint const * const p = &a;\n*p = 100;//error\np = &b;  //error\n```\n\n```c\nint a=10;\nconst int b=20;\nint *pa=&a;//*pa=100;//ok\nconst int* pa1=&a;//*pa1=100;//error\n\nint* pb=&b;//error\nconst int* pb=&b; //ok\n```\n\n```c\n//.cppä¸‹ç¼–è¯‘\nint main()\n{\n    const int a=10;\n    int b=0;\n    int* p=(int*)&a;\n    *p=100;\n    b=a;//ç¼–è¯‘æ—¶è‡ªåŠ¨æŠŠaæ›¿æ¢æˆäº†10\n    printf(\"a=%d\\n\",a);//æ‰“å°10\n    printf(\"b=%d\\n\",b);//æ‰“å°10\n    printf(\"*p=%d\\n\",*p);//æ‰“å°100\n}\n```\n# strç›¸å…³å‡½æ•°\n## strlen\n### ç¬¬ä¸€æ¬¡ç¼–çš„\n```c\n#include<stdio.h>\nint my_strlen(char* string)\n{\n    int count = 0;\n    while (*string++ != '\\0')\n    {\n        ++count;\n    }\n    return count;\n}\n```\n### è€å¸ˆçš„æ”¹è¿›\n```c\n#include<stdio.h>\n#include<assert.h>\nint my_strlen(const int* string)\n{\n    assert(string != NULL);\n    int i=0;\n    while(string[i]!='\\0')\n    {\n        ++i;\n    }\n    return i;\n}\n```\n### å¦æœ‰æ–¹æ³•ï¼šåˆ©ç”¨æŒ‡é’ˆåœ°å€è®¡ç®—\næŒ‡é’ˆåœ°å€çš„è®¡ç®—â€”â€”ç®—å¤´ä¸ç®—å°¾\n```c\n#include<stdio.h>\n#include<assert.h>\nint my_strlen(const int* str)\n{\n    assert(str!=nullptr);\n    const char* cp = str;\n    while(*cp!='\\0')\n    {\n        cp++;\n    }\n    return (cp-str);\n}\n```\n#### å˜ç§é—®é¢˜\nä¸è®©ç”¨è®¡æ•°å˜é‡è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦--æŒ‡é’ˆåœ°å€è®¡ç®—\n\nä¸è®©ç”¨ä»»ä½•å˜é‡è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦--é€’å½’å‡½æ•°\n```c\nint my_strlen2(const char* string)\n{\n    assert(string != nullptr);\n    if (*string++)\n    {\n        return my_strlen2(string)+1;\n    }\n    else return 0;\n}\n```\n## cpy\n```c\nchar* my_strcpy(char* dest,const char* src)\n{\n    assert(dest != NULL && src != NULL);\n    char* cp = dest;\n    while (*src != '\\0')\n    {\n        *dest = *src;\n        dest++;\n        src++;\n        //ä¹Ÿå¯ä»¥ä¸€å¥è¯è§£å†³ï¼Œwhile(*dest++ = *src++);//å› ä¸ºèµ‹å€¼è¯­å¥æœ‰è¿”å›å€¼æ˜¯èµ‹å€¼çš„å€¼ï¼Œä½†å¯è¯»æ€§ä¸å¥½\n    }\n    *dest = '\\0';\n    return dest;//è¿”å›destå³ç›®çš„æ‹·è´å­—ç¬¦ä¸²ï¼Œä¾¿äºå‡½æ•°åµŒå¥—è¾¾åˆ°å¯ä»¥å®ç°è¿ç»­æ‹·è´\n}\n```\nå¯¹äº`*dest++ = *src++`å¯ä»¥çœ‹ä¸€ä¸‹æ±‡ç¼–ä»£ç ï¼Œå°±æ¸…æ¥šäº†\n![image-20210723160515838](../../images/C%E8%AF%AD%E8%A8%80_%E6%8C%87%E9%92%88/image-20210723160515838.png)\n\n![image-20210723160525560](../../images/C%E8%AF%AD%E8%A8%80_%E6%8C%87%E9%92%88/image-20210723160525560.png)\n## strcat\n### å®šä¹‰ä¸€ä¸ªæŒ‡é’ˆå˜é‡\n```c\n#include<stdio.h>\n#include<assert.h>\nchar* my_strcat(char* dest, const char* src)\n{\n    assert(dest != nullptr && src != nullptr);\n    char* cp = dest;\n    while (*cp != '\\0') ++cp;\n    while (*cp++ = *src++);\n    return dest;\n}\n```\n### ä¸ç”¨å®šä¹‰æŒ‡é’ˆå˜é‡ï¼Œåˆ©ç”¨lenè·å–ä¸‹æ ‡\n```c\n#include<stdio.h>\n#include<assert.h>\nchar* my_strcat(char* dest, const char* src)\n{\n    assert(dest != nullptr && src != nullptr);\n    int index = my_strlen(dest);\n    my_strcpy(dest+len, src);\n    return dest;\n}\n```\n## strcmp\n```c\nint main()\n{\n    char* stra = \"yhp\";\n    char* strb = \"yhp\";\n    \n    char strc[]=\"yhp\";\n    char strd[]=\"yhp\";\n    \n    bool x = (stra==strb);//1\n    bool y = (strc==strd);//0\n    printf(\"x = %d y = %d\\n\",x,y);\n}\n```\n\n```c\n#include<stdio.h>\n#include<assert.h>\nint my_strcmp(const char* ap, const char* bp)\n{\n    //ap=\"yhping\" bp=\"yhping\" 0\n    //ap=\"yhxing\" bp=\"yhping\" >0\n    //ap=\"yhping\" bp=\"yhxing\" <0\n    assert(ap!=nullptr&&bp!=nullptr);\n    while((ap||bp)&&(*ap==*bp))\n    {\n        ap++;\n        bp++;\n        if(*ap=='\\0'||*bp=='\\0')break;\n    }\n    return *ap-*bp;\n}\nint main()\n{\n    char stra[10] = \"yhping\";\n    char strb[10] = \"yhxing\";\n    int ans = my_strcmp(stra,strb);\n    printf(\"%d\\n\", ans);\n}\n```\n# ç»ƒä¹ \n## åˆ¤æ–­å½“å‰ç³»ç»Ÿæ˜¯å°ç«¯åœ°å€è¿˜æ˜¯å¤§ç«¯åœ°å€ï¼ˆå¯é€šè¿‡æŒ‡é’ˆå¼ºè½¬æ¥æ¢æµ‹ï¼‰\n```c\nint main()\n{\n    short st = 0x0001;\n    char* cp = (char*)&st;\n    if(*cp==0x01)\n    {\n        printf(\"å°ç«¯\\n\");\n    }\n    else\n    {\n        printf(\"å¤§ç«¯\\n\");\n    }\n}\n```\n## ä¸è®©ç”¨ä»»ä½•å˜é‡è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦--é€’å½’å‡½æ•°\n```c\nint my_strlen2(const char* string)//ä¸å®šä¹‰å˜é‡ï¼Œé€’å½’æ±‚è§£\n{\n    assert(string != nullptr);\n    if (*string++)\n    {\n        return my_strlen2(string)+1;\n    }\n    else return 0;\n}\n```\n## ç»™å‡ºä»¥ä¸‹çš„ä»£ç è¾“å‡ºç»“æœ\n```c\nint main()\n{\n    char* stra = \"yhp\";\n    char* strb = \"yhp\";\n    \n    char strc[]=\"yhp\";\n    char strd[]=\"yhp\";\n    \n    bool x = (stra==strb);//1\n    bool y = (strc==strd);//0\n    printf(\"x = %d y = %d\\n\",x,y);\n}\n```\n## strcmpå‡½æ•°\n```c\n//ap=\"yhping\" bp=\"yhping\" 0\n//ap=\"yhxing\" bp=\"yhping\" >0\n//ap=\"yhping\" bp=\"yhxing\" <0\nint my_strcmp(const char* ap, const char* bp)\n{\n    assert(ap != nullptr && bp != nullptr);\n    while (ap&&bp&&*ap == *bp)//æœ‰ä¸€ä¸ªä¸ä¸ºç©ºä¸”ä¾æ¬¡ç›¸ç­‰\n    {\n        ap++;\n        bp++;\n    }\n    return *ap - *bp;\n}\n```\n## å†’æ³¡æ’åº\n```c\n\n```\n## äºŒåˆ†æŸ¥æ‰¾\n```c\nint FindValue(int* ar,int n,int val)\n{\n    assert(ar != nullptr);\n    int pos = -1;\n    int left = 0, right = n - 1;\n    //ä¸ºä»€ä¹ˆleftè¿˜è¦ç­‰äºrightå‘¢ï¼Ÿleftå’Œrightè¡¨ç¤ºæ•°æ®çš„è§„æ¨¡ï¼Œå¦‚æœleft=rightè¯´æ˜è¿˜è¦å†å¯»æ‰¾ä¸€æ¬¡ã€‚å½“rightå’Œrighté”™ä½ï¼Œè¯´æ˜æ²¡æœ‰æ•°æ®äº†ã€‚\n    while (left<=right)\n    {\n        int mid = (left + right) >>2;\n        if (val < ar[mid])\n        {\n            right = mid-1;//valå€¼åœ¨midä¸‹æ ‡å‰ï¼Œmidä¸‹æ ‡å·²ç»æ²¡å¿…è¦æ¯”è¾ƒï¼Œè€Œä¸”å¿…é¡»-1ï¼Œå› ä¸ºå¦‚æœè¿™ä¸ªå€¼åœ¨æ•°ç»„ä¸­æ²¡æœ‰ï¼Œè€Œåœ¨midä¸‹æ ‡å€¼å’Œmid-1ä¸‹æ ‡å€¼ä¹‹é—´çš„è¯\n        }\n        else if (val > ar[mid])\n        {\n            left = mid+1;\n        }\n        else\n        {\t//å¦‚æœæœ‰é‡å¤çš„å€¼ï¼Œåˆ™å‘å‰æ¢æµ‹ç›¸åŒå€¼ã€‚\n            //ä½†ä¹Ÿè¦æ³¨æ„è¶Šç•Œé—®é¢˜ã€‚mid-1ä¸è¦<0\n            while (mid > left && ar[mid - 1] == ar[mid])\n            {\n                --mid;\n            }\n            pos = mid;\n            break;\n        }\n    }\n    return pos;\n}\n```\n1. å¦‚æœæ•°æ®é‡éå¸¸å¤§ï¼Œ`left+right`å¯èƒ½ä¼šæº¢å‡ºï¼Œæ€ä¹ˆè§£å†³â€”â€”`left + (right - left) / 2`\n2. çº¿æ€§æ¢æµ‹å¦‚ä½•ä¼˜åŒ–ï¼Œä»¥åŠ é€Ÿæ¢æµ‹é€Ÿåº¦ã€‚\n3. [äºŒåˆ†æŸ¥æ‰¾åŠå…¶å˜ç§](https://www.cnblogs.com/yumingxing/p/9583154.html)ï¼šæ–æ³¢é‚£å¥‘æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦è¿˜æ˜¯$O(\\log_2 n)$ï¼Œä½†æ˜¯ ä¸æŠ˜åŠæŸ¥æ‰¾ç›¸æ¯”ï¼Œæ–æ³¢é‚£å¥‘æŸ¥æ‰¾çš„ä¼˜ç‚¹æ˜¯å®ƒåªæ¶‰åŠåŠ æ³•å’Œå‡æ³•è¿ç®—ï¼Œè€Œä¸ç”¨é™¤æ³•ï¼Œè€Œé™¤æ³•æ¯”åŠ å‡æ³•è¦å ç”¨æ›´å¤šçš„æ—¶é—´ã€‚\n## å¾ªç¯ç§»åŠ¨æ•°ç»„\nç¤ºä¾‹ï¼š`int ar[10]={1, 2 , 3 , 4 , 5 , 6 , 7 , 8 , 9 , 10};`\nå³ç§»ä¸€ä¸ªæ•°æ®å…ƒç´ ï¼šè¾“å‡º`{ 10,1,2,3,4,5,6,7,8,9};`\nå³ç§»`k`ä¸ªæ•°æ®å…ƒç´ ï¼šå¦‚`k = 3;`è¾“å‡º`{8ï¼Œ9ï¼Œ10ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œ7}`\n\nå®ç°å‡½æ•°ï¼š\n`Right_Move_Array; // å³ç§»ä¸€ä¸ªæ•°æ®å…ƒç´ `\n`Right_Move_Array_K; // å³ç§»k ä¸ªæ•°æ®å…ƒç´ `\n`Left_Move_Array;`\n`Left_Move_Array_K;`\n\nhttps://blog.csdn.net/weixin_45007066/article/details/116057402\nhttps://blog.csdn.net/weixin_45332776/article/details/116333199\n## æ”¹è¿›å†’æ³¡æ’åº\n```c\n\n```\n## `my_memset()`\n```c\nvoid my_memset(void* src, int val, int size)\n{\n    assert(src != nullptr);\n    char* cp = (char*)src;\n    for (int i = 0;i < size;++i,++cp)\n    {\n        *cp = 0;\n    }\n}\n```\n## `my_memmove()`\n```c\n\n```\n## `my_atoi()`\nå­—ç¬¦ä¸²æ•°å­—è½¬æ¢ä¸ºæ•´å‹æ•°å­—\n1. `\"123\"=>123`\n2. `\"-123\"=>-123`\n3. `\"0123\"(8è¿›åˆ¶)=>`\n4. `\"0x123Df\"=>`\n5. `\"75894235702389573478903242334537\" =>`\n6. \"505\"é”™å†™ä¸ºäº†\"5o5\"ï¼Œè¦æœ‰çº é”™èƒ½åŠ›è½¬ä¸º505\n\n```c\n\n```","tags":["tulun"],"categories":["C"]},{"title":"Redis_SDS","url":"/Redis/Redis_SDS/","content":"\nSDSæŒ‡simple dynamic stringï¼Œå³ç®€å•åŠ¨æ€å­—ç¬¦ä¸²ã€‚\n\n# Memcachedä¸Redisçš„åŒºåˆ«å’Œé€‰æ‹©\n\nMemcachedä¸Redisçš„åŒºåˆ«å’Œé€‰æ‹©https://blog.csdn.net/qq_18671415/article/details/104540628\n\nhttps://zhuanlan.zhihu.com/p/183993817\n\nRedis è¿™å‡ å¹´çš„å¤§çƒ­ï¼Œç°åœ¨å·²ç»æ›¿ä»£ Memcached æˆä¸ºç¼“å­˜æŠ€æœ¯çš„é¦–è¦ä¸­é—´ä»¶ï¼Œä½œä¸ºå¤§å‚çš„å¸¦å¤´å…µï¼Œåœ¨ BAT é‡Œé¢ï¼ŒRedis ä¹Ÿå·²ç»é€æ¸å–ä»£äº† Memcachedï¼Œå¹¿æ³›ä½¿ç”¨ Redis ä½œä¸ºç¼“å­˜åº”ç”¨æ–¹æ¡ˆã€‚\n\n**1ï¼‰é€Ÿåº¦æ›´å¿«**\n\nMemcached ä½¿ç”¨çš„æ˜¯å¤šçº¿ç¨‹æ¨¡å‹ï¼Œæ—¢ç„¶æ˜¯å¤šçº¿ç¨‹ï¼Œå°±ä¼šå› ä¸ºå…¨å±€åŠ é”è€Œå¸¦æ¥æ€§èƒ½æŸè€—ã€‚è€Œ Redis ä½¿ç”¨çš„æ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œæ²¡æœ‰é”ç«äº‰ï¼Œé€Ÿåº¦éå¸¸å¿«ã€‚\n\n**2ï¼‰æ•°æ®ç±»å‹æ›´ä¸°å¯Œ**\n\nMemcached æ•°æ®ç±»å‹éå¸¸å•ä¸€ï¼Œåªæ”¯æŒ String æ•°æ®ç±»å‹ï¼Œåœ¨ä¸šåŠ¡å®ç°ä¸Šå°±éå¸¸æœ‰ç“¶é¢ˆã€‚\n\nè€Œ Redis æ”¯æŒ string(å­—ç¬¦ä¸²)ã€hash(å“ˆå¸Œ)ã€list(åˆ—è¡¨)ã€set(é›†åˆ)ã€zset(sorted set:æœ‰åºé›†åˆ) ç­‰â€¦â€¦ä¸°å¯Œçš„æ•°æ®ç±»å‹å¯ä»¥è®© Redis åœ¨ä¸šåŠ¡ä¸Šå¤§å±•æ‹³è„šã€‚\n\nè¿™ä¹Ÿæ˜¯ Redis èƒ½ä»£æ›¿ Memcached æœ€é‡è¦çš„åŸå› ä¹‹ä¸€ã€‚\n\nå¹¶ä¸”ï¼ŒMemcached å€¼æœ€å¤§ä¸Šé™ä¸ºï¼š1Mï¼Œè€Œ Redis æœ€å¤§å¯ä»¥åˆ°ï¼š1GBã€‚\n\n**3ï¼‰æ•°æ®æŒä¹…åŒ–**\n\nMemcached ä¸æ”¯æŒæŒä¹…åŒ–ï¼ŒRedis æ”¯æŒã€‚\n\nç¼“å­˜æœåŠ¡å™¨æ–­ç”µåï¼ŒMemcached çš„æ•°æ®æ˜¯ä¸èƒ½æ¢å¤çš„ï¼Œè€Œ Redis å¯ä»¥å°†æ•°æ®ä¿ä¹…åŒ–åœ¨ç£ç›˜ä¸­ï¼ŒæœåŠ¡å™¨é‡å¯çš„åå¯ä»¥åŠ è½½å†æ¬¡ä½¿ç”¨ï¼Œä¸ä¼šé€ æˆæ•°æ®æ–­ç”µä¸¢å¤±ã€‚\n\næ¯”å¦‚ï¼Œæœ‰äº›æ•°æ®æ˜¯ç›´æ¥æ”¾åœ¨ç¼“å­˜æ•°æ®åº“ä¸­çš„ï¼Œå…¶ä»–åœ°æ–¹å¯èƒ½æ²¡æœ‰å¤‡ä»½ï¼Œå¦‚æœä¸¢å¤±äº†ï¼Œé‚£å¯èƒ½ä¼šé€ æˆä¸šåŠ¡å½±å“ï¼Œè¿™ä¹Ÿæ˜¯ Redis éå¸¸æœ‰ç”¨çš„ä¸€ä¸ªä¿éšœç‰¹æ€§ã€‚\n\n# æŸ”æ€§æ•°ç»„\n\nå…ˆçœ‹ä¸€ä¸ªç»“æ„ä½“çš„è®¾è®¡\n\n```c\n#define MAXLEN 1024 //1K  //å¯¹äºæ“ä½œç³»ç»Ÿå±‚é¢æ¥è®²ï¼Œåˆ†é…ã€ç®¡ç†å†…å­˜æ˜¯ä»¥ä¸€é¡µä¸ºå•ä½çš„ï¼Œå 4Kå³1024*4=4096å­—èŠ‚\ntypedef struct kd_node\n{\n    struct kd_node* left;\n    struct kd_node* right;\n    int dim;\n    unsigned long long data[MAXLEN];//æ•°æ®  //å ç”¨äº†1024*sizeof(unsigned long long)=8kå­—èŠ‚\n}kd_node;\n```\n\nåœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œä¸ºäº†å­˜å‚¨æ•°æ®ï¼Œç”³è¯·äº†é•¿åº¦ä¸º1024çš„unsigned long longå‹æ•°ç»„ã€‚è‹¥æ˜¯æ•°æ®çš„é•¿åº¦è¿œè¿œå°äºMAXLENï¼Œè¿™æ ·çš„è®¾è®¡æ˜¯å¾ˆæµªè´¹ç©ºé—´çš„ã€‚\n\nå¯¹äºæ•°ç»„ï¼Œæˆ‘ä»¬çš„åŸåˆ™æ˜¯å¤§å¼€å°ç”¨ï¼ˆå°½å¯èƒ½å¼€è¾Ÿè¶³å¤Ÿçš„ç©ºé—´ï¼Œä½†ä½¿ç”¨æ—¶ä¸èƒ½å…¨éƒ½ç”¨ä¸Šï¼‰ã€‚è€Œå¯¹äºåŠ¨æ€å†…å­˜åˆ†é…ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ›´åŠ çš„çµæ´»è¿ç”¨ï¼Œä½†ä»£ä»·æ˜¯ä½¿ç”¨å®Œåè¦é‡Šæ”¾æ‰ã€‚\n\nC99æ ‡å‡†ä¸­ç»™å‡ºäº†æ–°çš„è®¾è®¡æ–¹æ³•ï¼Œé€šè¿‡æŸ”æ€§æ•°ç»„å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\n\n```c\nstruct sd_node\n{\n    int num;//æ•°æ®çš„é•¿åº¦ï¼Œå³å·²å¡«å…¥çš„æ•°æ®å ç”¨çš„é•¿åº¦\n    int size;//æ€»é•¿åº¦\n    char data[];//æˆ–char data[0];\n    //æ•°ç»„çš„å¤§å°å£°æ˜ä¸º0æˆ–ä¸ç»™å‡ºå¤§å°ï¼Œç§°ä¹‹ä¸ºæŸ”æ€§æ•°ç»„ã€‚å¿…é¡»åœ¨æœ€åä½ç½®å£°æ˜ï¼Œä¸”ä¸€æ—¦å£°æ˜åé¢ä¸èƒ½å†å£°æ˜å…¶ä»–ç»“æ„ã€‚å…¨å±€æ•°ç»„å’Œå±€éƒ¨æ•°ç»„ä¸å¯å¦‚æ­¤å®šä¹‰ã€‚\n};\nint main()\n{\n    sizeof(struct sd_node);//8\n}\n```\n\nåœ¨struct sd_nodeç»“æ„ä½“ä¸­dataä»…ä»…æ˜¯ä¸€ä¸ªå¾…ä½¿ç”¨çš„æ ‡è¯†ç¬¦ï¼Œä¸å ç”¨å­˜å‚¨ç©ºé—´ã€‚\n\nç”¨é€”ï¼šæŸ”æ€§æ•°ç»„çš„ä¸»è¦ç”¨é€”æ˜¯ä¸ºäº†æ»¡è¶³é•¿åº¦å¯å˜çš„ç»“æ„ä½“ã€‚\n\nç”¨æ³•ï¼šåœ¨ä¸€ä¸ªç»“æ„ä½“çš„æœ€åï¼Œå£°æ˜ä¸€ä¸ªé•¿åº¦ä¸º0çš„æ•°ç»„ï¼Œå°±å¯ä»¥ä½¿å¾—è¿™ä¸ªç»“æ„ä½“æ˜¯å¯å˜é•¿çš„ã€‚**å¯¹äºç¼–è¯‘å™¨æ¥è¯´**ï¼Œæ­¤æ—¶é•¿åº¦ä¸º0çš„æ•°ç»„å¹¶ä¸å ç”¨ç©ºé—´ï¼Œå› ä¸ºæ•°ç»„åæœ¬èº«ä¸å ç©ºé—´ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªåç§»é‡ã€‚æ•°ç»„åè¿™ä¸ªç¬¦å·æœ¬èº«ä»£è¡¨äº†ä¸€ä¸ª**ä¸å¯ä¿®æ”¹çš„åœ°å€å¸¸é‡**ã€‚ä½†å¯¹äºè¿™ä¸ªæ•°ç»„çš„å¤§å°ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡ŒåŠ¨æ€åˆ†é…ã€‚\n\næ³¨æ„ï¼šå¦‚æœç»“æ„ä½“æ˜¯é€šè¿‡calloc/malloc/reallocç­‰åŠ¨æ€åˆ†é…æ–¹å¼ç”Ÿæˆçš„ï¼Œåœ¨ä¸ä½¿ç”¨æ—¶éœ€è¦é‡Šæ”¾ç›¸åº”çš„ç©ºé—´ã€‚\n\nä¼˜ç‚¹ï¼šæ¯”èµ·åœ¨ç»“æ„ä½“ä¸­å£°æ˜ä¸€ä¸ªæŒ‡é’ˆå˜é‡å†è¿›è¡ŒåŠ¨æ€åˆ†é…çš„åšæ³•ï¼ŒæŸ”æ€§æ•°ç»„æ–¹æ³•æ•ˆç‡è¦é«˜ï¼Œå› ä¸ºç®€å•ã€‚\n\nç¼ºç‚¹ï¼šåœ¨ç»“æ„ä½“ä¸­ï¼Œæ•°ç»„ä¸º0çš„æ•°ç»„å¿…é¡»åœ¨æœ€åå£°æ˜ï¼Œåœ¨è®¾è®¡ç»“æ„ä½“ç±»å‹æ—¶æœ‰ä¸€å®šé™åˆ¶ã€‚\n\n![image-20210810021047383](../../images/Redis_SDS/image-20210810021047383.png)\n\n```c\nint main()\n{\n    struct kd_node* sp1 = (struct kd_node*)malloc(sizeof(struct kd_node)+20);\n    if(sp1==nullptr)\n    {\n        exit(EXIT_FAILURE);\n    }\n    strcpy_s(sp1->data,20,\"yhping\");//20æŒ‡sp1->dataçš„æœ€å¤§ç©ºé—´ï¼Œä½¿å…¶å®‰å…¨æ‹·è´\n    sp1->num = strlen(\"yhping\");\n    sp1->size = 20;\n    \n    printf(\"size: %d \\n\",sp1->size);\n    printf(\"num: %d \\n\",sp1->num);\n    printf(\"data: %s \\n\",sp1->data);\n    \n    free(sp1);\n    sp1 = nullptr;\n    return 0;\n}\n```\n\n![image-20210810022209189](../../images/Redis_SDS/image-20210810022209189.png)\n\n![image-20210810022351037](../../images/Redis_SDS/image-20210810022351037.png)\n\n## æ˜“é”™\n\n![image-20210810023944795](../../images/Redis_SDS/image-20210810023944795.png)\n\n![image-20210810024031901](../../images/Redis_SDS/image-20210810024031901.png)\n\nè¿è¡Œç»“æœ\n\n![image-20210810024054322](../../images/Redis_SDS/image-20210810024054322.png)\n\nsizeofçš„è¿ç®—åªå‘ç”Ÿåœ¨ç¼–è¯‘æ—¶æœŸï¼Œå› æ­¤åªè®¡ç®—å˜é‡çš„ç±»å‹çš„å¤§å°ï¼Œç»å…¸çš„ä¾‹å­å°±æ˜¯sizeof(++a)ï¼Œå†æ¬¡è¾“å‡ºaæ—¶å‘ç°æ²¡æœ‰+1ï¼Œæ˜¯å› ä¸ºsizeof(++a)æ ¹æœ¬æ²¡æœ‰æ‰§è¡Œã€‚\n\n## ä¸å¦ä¸€ç§å®ç°æ–¹æ³•çš„å¯¹æ¯”\n\n```c\nstruct kd_buff\n{\n    int num;\n    int size;\n    char* buff;\n};\nint main()\n{\n    kd_buff* p = (kd_buff*)malloc(sizeof(kd_buff));\n    \n    p->buff = (char*)malloc(sizeof(char)*strlen(\"yhping\"));\n    strcpy(p->buff,strlen(\"yhping\"),\"yhping\");\n    \n    p->num = strlen(\"yhping\")-1;\n    p->size = strlen(\"yhping\");\n}\n```\n\næ˜¾ç„¶ï¼ŒæŒ‡å‘å­—ç¬¦ä¸²æŒ‡é’ˆçš„æ–¹æ³•çš„æ“ä½œèµ·æ¥æ¯”æŸ”æ€§æ•°ç»„æ“ä½œèµ·æ¥è¦ç¹æ‚ä¸€äº›ã€‚\n![image-20210810025606081](../../images/Redis_SDS/image-20210810025606081.png)\n\nè€Œä¸”ï¼Œè¿™ç§ç»“æ„éœ€è¦åˆ†ä¸¤æ¬¡ç”³è¯·ç©ºé—´ï¼Œå¯¼è‡´åˆ°æœ€åå¿…é¡»é‡Šæ”¾ä¸¤æ¬¡ã€‚è€ŒæŸ”æ€§æ•°ç»„åªç”³è¯·ä¸€æ¬¡ç©ºé—´ï¼Œæœ€åé‡Šæ”¾æ—¶ç›´æ¥é‡Šæ”¾ä¸€æ¬¡å³å¯ã€‚å› æ­¤ï¼Œç»¼åˆè€ƒè™‘ï¼ŒæŸ”æ€§æ•°ç»„æ˜æ˜¾æ˜¯ä¼˜äºä¸Šè¿°ç»“æ„çš„ã€‚\n\n# é€€å‡ºæ–¹æ¡ˆ\n\n`exit()`, `_exit()`, `return`, `abort()`å‡½æ•°çš„åŒºåˆ«\nhttps://blog.csdn.net/lyf47/article/details/44203499\n\nåœ¨Redisä¸­æˆ‘ä»¬é‡‡ç”¨çš„æ˜¯`abort();`\n\n```c\nstatic void adsOomAbort()\n{\n    fprintf(stderr,\"SDS: out of memory \\n\");\n    abort();\n}\n```\n\n## `abort()`\n\n## `exit(EXIT_FAILURE)`\n\n## `_exit()`\n\n# ä»£ç \n\n```c\ntypedef sds char*;\nvoid sdsclear(sds s)\n{\n    struct sdshdr* sh=(struct sdshdr*)s-sizeof(struct*(sdshdr));\n    sh->free+=sh->len;\n    sh->len=0;\n    sh->buf[0]='\\0';\n}\nsds sdscat(sds stra,sds strb)\n{\n    struct sdshar* sh_a=(struct sdshdr*)stra-sizeof(struct*(sdshdr));\n    struct sdshar* sh_b=(struct sdshdr*)strb-sizeof(struct*(sdshdr));\n    if(sh_a->free>=str->free)\n    {\n        memcpy_s(\"\")\n    }\n    stra[6]\n}\n```\n# string.h\n\n## memcpy\n\nå‡½æ•°åŸå‹ä¸º`void *memcpy(void *destin, void *source, unsigned n)`ã€‚å‡½æ•°çš„åŠŸèƒ½æ˜¯ä»æºå†…å­˜åœ°å€çš„èµ·å§‹ä½ç½®å¼€å§‹æ‹·è´è‹¥å¹²ä¸ªå­—èŠ‚åˆ°ç›®æ ‡å†…å­˜åœ°å€ä¸­ï¼Œå³ä»æºsourceä¸­æ‹·è´nä¸ªå­—èŠ‚åˆ°ç›®æ ‡destinä¸­ã€‚\n\n# Cè¯­è¨€ä¼ ç»Ÿçš„å­—ç¬¦ä¸²\n\nå³ä»¥ç©ºå­—ç¬¦ç»“å°¾çš„å­—ç¬¦æ•°ç»„ã€‚\n\n1. åœ¨.rdataæ•°æ®åŒºé‡Œ\n\n```c\nchar* sp = \"yhping\";\n```\n\n2. æ•°ç»„å­˜æ”¾\n\n```c\nchar stra[] = \"yhping\";\n```\n\n3. å †åŒºå¼€è¾Ÿï¼Œå¹¶ç”¨strcpy_s(cp,10,\"yhping\");å¤åˆ¶\n\n```c\nint main()\n{\n    char* cp = (char*)malloc(sizeof(char)*10);\n    strcpy_s(cp,10,\"yhping\");\n}\n```\n# redisçš„å­—ç¬¦ä¸²\n\n```c\ntypedef char* sds;\nstruct sdshdr\n{\n    int len; //å·²è¾“å…¥çš„å­—ç¬¦ä¸²ä¸åŒ…æ‹¬\\0çš„é•¿åº¦\n    int free;//è¿˜æœªä½¿ç”¨çš„å­—èŠ‚æ•°ï¼ŒåŒæ ·ä¸åŒ…æ‹¬\\0\n    char buf[];\n}\n//ä¼ å…¥ä¸€ä¸ªinitæŒ‡é’ˆï¼ˆå¤šä¸ºå­—ç¬¦ä¸²ï¼‰å’Œå…¶é•¿åº¦ï¼Œé•¿åº¦ä¸è®¡ç®—\\0ï¼Œmemcpyå†™å…¥å†…å­˜æ—¶ä¸åŒ…æ‹¬\\0çš„å†™å…¥ï¼Œ\\0æ˜¯å•ç‹¬ç”¨memsetå¤„ç†çš„\nsds sdsnewlen(const void *init, size_t initlen) {\n    struct sdshdr *sh;//å£°æ˜å®šä¹‰ä¸€ä¸ªsdshdrç»“æ„ä½“æŒ‡é’ˆ \n\n    sh = zmalloc(sizeof(struct sdshdr)+initlen+1);//å¼€è¾Ÿsdshdrç»“æ„ä½“ç±»å‹å¤§å°ï¼ˆ8å­—èŠ‚ï¼‰+initlen+1ï¼ˆå­˜æ”¾\\0ï¼‰å­—èŠ‚ã€‚ å¤´éƒ¨èµ‹ç»™æŒ‡é’ˆsh \n#ifdef SDS_ABORT_ON_OOM\n    if (sh == NULL) sdsOomAbort();\n#else\n    if (sh == NULL) return NULL;\n#endif\n    sh->len = initlen;//æŠŠinitlenæ•°å€¼èµ‹ç»™sh->len \n    sh->free = 0;//sh->freeæš‚æ—¶åˆå§‹åŒ–ä¸º0 \n    if (initlen) {\n        if (init) memcpy(sh->buf, init, initlen);//å¦‚æœinitä¸ä¸ºç©º åˆ™ å°†initæŒ‡é’ˆå¼€å§‹çš„initlené•¿åº¦å†…å­˜ç©ºé—´ä¸­çš„å†…å®¹å¤åˆ¶ç»™sh->bufåŒæ ·é•¿åº¦ \n        else memset(sh->buf,0,initlen);//å¦‚æœinitä¸ºç©º åˆ™ å°†sh->å¼€å§‹çš„initlené•¿åº¦çš„ç©ºé—´çš„å†…å®¹èµ‹ä¸º0 \n    }\n    sh->buf[initlen] = '\\0';  //æ— è®ºå¦‚ä½•ï¼Œbufçš„initlenä¸‹æ ‡å¤„ï¼ˆä¹Ÿå°±æ˜¯ä¸åŒ…å«\\0çš„å­—ç¬¦ä¸²çš„å°¾éƒ¨çš„åä¸€ä½ï¼‰èµ‹å€¼ä¸º\\0 \n    return (char*)sh->buf;//è¿”å›ä¸€ä¸ªæŒ‡å‘bufçš„sdsæŒ‡é’ˆ \n}\n//å°†å­—ç¬¦ä¸²ä¼ å…¥ï¼Œç”Ÿæˆå¯¹åº”çš„sdsï¼Œé€‚ç”¨äºç›´æ¥ä¼ ä¸€ä¸ªå¸¸è§„çš„å­—ç¬¦ä¸²ï¼Œåªå†™ä¸€ä¸ªå‚æ•°å³å¯ \nsds sdsnew(const char *init) {\n    size_t initlen = (init == NULL) ? 0 : strlen(init); //å­—ç¬¦ä¸²ä¸ºç©ºåˆ™initlen=0ï¼Œä¸ä¸ºç©ºåˆ™initlenç­‰äºä¸åŒ…å«\\0çš„å­—ç¬¦ä¸²é•¿åº¦ \n    return sdsnewlen(init, initlen);//è°ƒç”¨sdsnewlenåˆ›å»ºsdsç»“æ„ä½“ \n}\nint main()\n{\n\tsds sdsp = sdsnew(\"yhping\");\n}\n```\n\n# sdså‡½æ•°\n\n## åˆ›å»º\n\n### `sdsnew`/`sdsnewlen`\n\nå…¶ä¸­`sdsnew`è°ƒç”¨äº†`sdsnewlen`\n### `sdsempty`\n\nåˆ›å»ºæŸ”æ€§æ•°ç»„å†…åªå«æœ‰`'\\0'`çš„`sdshdr`\n### sdsdup\n\nåˆ›å»ºsdshdrçš„å‰¯æœ¬\n## å±æ€§\n\nsdslenè¿”å›å·²ä½¿ç”¨ç©ºé—´å­—èŠ‚æ•°å³lenï¼›sdsavailè¿”å›æœªä½¿ç”¨ç©ºé—´å­—èŠ‚æ•°å³freeã€‚\n## é‡Šæ”¾\n\n### sdsfree\n\nå¯¹åº”äºåˆ›å»ºsdshdrçš„sdsnewï¼Œå³é‡Šæ”¾sdshdr\n### sdsclear\n\næƒ°æ€§é‡Šæ”¾ï¼Œåªåˆ é™¤å­—ç¬¦ä¸²å†…å®¹ï¼Œæ›´æ–°lenå±æ€§å’Œfreeå±æ€§ï¼Œç»“æ„ä¿ç•™ã€‚\n\n```c\nvoid sdsclear(sds s)\n{\n    struct sdshdr* sh = (struct sdshdr*)(s-sizeof(struct sdshdr));\n    sh->free += sh->len;\n    sh->len=0;\n    sh->buf[0]='\\0';//ä¸æ˜¾å¼æ¸…é›¶å­—ç¬¦ä¸²å†…å­˜ç©ºé—´å†…å®¹ï¼Œè€Œæ˜¯åœ¨é€»è¾‘ä¸Šä½¿å­—ç¬¦ä¸²buf[0]=\\0æ ‡å¿—ï¼Œä½¿ä¹‹æ— æ³•è®¿é—®ã€‚\n}\n```\n\n## æ‰©å±•\n\n### sdsgrowzero\n\nå°†æŸ”æ€§æ•°ç»„é•¿åº¦æ‰©å±•åˆ°æŒ‡å®šé•¿åº¦ï¼Œå¤šä½™ç©ºé—´ç”¨'\\\\0'å¡«å……ã€‚\n### sdscatlen\n\n# å¯å˜å‚æ•°\n\n```c\nint a=10,b=20;\nchar buff[20];\n\nprintf(\"a=%d b=%d\\n\",a,b);//stdout a=10 b=20\nsprintf(buff,\"a=%d b=%d \\n\",a,b);\n//æŠŠæ•°æ®æ”¾åˆ°äº†buffä¸­\nsprintf_s(buff,20,\"a=%d b=%d \\n\",a,b);\n```\n\n```c\nint a = 10,b = 20;\nchar buff[20];\nint len = sprintf(buff,\"a = %d b = %d \\n\",a,b);//è¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦15ï¼Œæ ¼å¼åŒ–è½¬åŒ–åå­˜æ”¾çš„æ˜¯\"a = 10 b = 20 \\n\\0\"ï¼Œä½†ç®—é•¿åº¦æ—¶ä¸åŒ…å«\\0é•¿åº¦\nsprintf(buff,20,\"a = %d b = %d \\n\",a,b);//ç›¸æ¯”äºä¸å¸¦_sçš„sprintfæ›´å®‰å…¨ï¼Œå› ä¸ºé™åˆ¶äº†é•¿åº¦\n```\n\n```c\nvoid funa(int a,char cx,int b,char cy)\n{\n    printf(\"%p => %d \\n\",&a,a);\n    printf(\"%p => %c \\n\",&cx,cx);\n    printf(\"%p => %d \\n\",&b,b);\n    printf(\"%p => %d \\n\",&cy,cy);\n}\nvoid funb(int a,float ft,double dx,char c)\n{\n    printf(\"%p => %d \\n\",&a,a);\n    printf(\"%p => %f \\n\",&ft,ft);\n    printf(\"%p => %f \\n\",&dx,dx);\n    printf(\"%p => %c \\n\",&c,c);\n}\nvoid fun(int num, ...)//fun(3,'a',12,'b');\n{\n    int* p = &num;\n    int* p1 = p+1;\n    printf(\"%d\\n\",*p1);\n    int* p2 = p1+1;\n    printf(\"%c\\n\",*p2);\n    int* p3 = p2+1;\n    printf(\"%d\\n\",*p3);\n    int* p4 = p3+1;\n    printf(\"%c\\n\",*p4);\n}\nint main()\n{\n    funa(12,'a',23,'b');\n    funb(12,12.25,25.50,'b');//80-84-88-å·®äº†8ä¸ªå­—èŠ‚-90\n    //fun(0);\n    //fun(1,23);\n    //fun(2,23,34);\n    fun(3,'a',12,'b');\n    return 0;\n}\n```\n\n\n\n```c\nvoid fun(const char* fmt, ...)\n{\n    \n}\nint main()\n{\n    fun(\"%c %d %c \\n\",'a',12,'b');\n}\n```\n\n![image-20210721204739876](../../images/Redis_SDS/image-20210721204739876.png)\n\n```c\n#include<stdarg.h>\nvoid fun(const char* fmt, ...)\n{\n    va_list ap = nullptr;\n    va_start(ap,fmt);\n    va_start(ap,char);\n    va_start(ap,int);\n    va_start(ap,char);\n    \n    va_end(ap);\n}\n```\n\n\n\n```c\n#include<stdarg.h>\nvoid fun(const char* fmt, ...)\n{\n    va_list ap = nullptr;//typedef char* va_list\n    char* p = nullptr, * sval = nullptr;\n    int ival = 0;\n    double dval = 0;\n    va_start(ap,fmt);\n    for(p=fmt;*p!='\\0';++p)\n    {\n        if(*p!='%')\n        {\n            switch(*++p)\n            {\n                case 'd':\n                    ival = va_arg(ap,int);\n                    printf(\"%d\",ival);\n                    break;\n                case 'f':\n                    fval = va_arg(ap,float);\n                    printf(\"%f\",dval);\n                    break;\n                case 's':\n                    sval = va_arg(ap,char*);\n                    printf(\"%s\",sval);\n                    break;\n                default:\n                    putchar(*p);\n                    break;\n            }\n        }\n    }\n    va_end(ap);\n}\nint main()\n{\n    fun(\"a = %d\\nft = %f\\nstr = %s\\n\",12,12.25f,\"hello tulun\");\n}\n//#define va_start __crt_va_start\n//#define va_arg   __crt_va_arg\n//#define va_end   __crt_va_end\n//#define va_copy(destination, source) ((destination) = (source))\n//#define __crt_va_start(ap, x) __crt_va_start_a(ap, x)\n//#define __crt_va_start_a(ap, v) ((void)(ap = (va_list)_ADDRESSOF(v) + _INTSIZEOF(v)))\n//#define __crt_va_arg(ap, t)     (*(t*)((ap += _INTSIZEOF(t)) - _INTSIZEOF(t)))\n//#define __crt_va_end(ap)        ((void)(ap = (va_list)0))\n```\n\n","categories":["é«˜çº§æ•°æ®ç»“æ„","Redis"]},{"title":"Cè¯­è¨€_æ•°ç»„å…¥é—¨åŠç»ƒä¹ ","url":"/C/Cè¯­è¨€_æ•°ç»„å…¥é—¨åŠç»ƒä¹ /","content":"æœ¬ç« å†…å®¹ï¼š\n1. ä¸€ç»´æ•°ç»„çš„å®šä¹‰å’Œåˆå§‹åŒ–\n2. ä¸€ç»´æ•°ç»„åœ¨å†…å­˜ä¸­çš„å­˜å‚¨\n3. ä¸€ç»´æ•°ç»„çš„ä½¿ç”¨\n4. ä¸€ç»´æ•°ç»„çš„åº”ç”¨å®ä¾‹\n5. äºŒç»´æ•°ç»„çš„å®šä¹‰å’Œåˆå§‹åŒ–\n6. äºŒç»´æ•°ç»„åœ¨å†…å­˜ä¸­çš„å­˜å‚¨\n7. äºŒç»´æ•°ç»„çš„ä½¿ç”¨\n8. äºŒç»´æ•°ç»„çš„åº”ç”¨å®ä¾‹\n# æ•°ç»„çš„å®šä¹‰å’Œåˆå§‹åŒ–\n\næ•°ç»„æ˜¯åŒ…å«ç»™å®šç±»å‹çš„ä¸€ç»„æ•°æ®ï¼Œå¹¶å°†è¿™äº›æ•°æ®ä¾æ¬¡å­˜å‚¨åœ¨è¿ç»­çš„å†…å­˜ç©ºé—´ä¸­ã€‚æ¯ä¸ªç‹¬ç«‹çš„æ•°æ®è¢«ç§°ä¸ºæ•°ç»„çš„å…ƒç´ ï¼ˆelementï¼‰ã€‚å…ƒç´ çš„ç±»å‹å¯ä»¥æ˜¯ä»»æ„ç±»å‹ã€‚ æ•°ç»„æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªç»“æ„ï¼Œå…¶ç±»å‹ç”±å®ƒçš„å…ƒç´ ç±»å‹å»¶ä¼¸è€Œæ¥ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œæ•°ç»„çš„ç±»å‹ç”±**å…ƒç´ çš„ç±»å‹å’Œæ•°é‡**æ‰€å†³å®šã€‚å¦‚æœä¸€ä¸ªæ•°ç»„çš„å…ƒç´ æ˜¯ T ç±»å‹ï¼Œé‚£ä¹ˆè¯¥æ•°ç»„å°±ç§°ä¸ºâ€œT æ•°ç»„â€ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå…ƒç´ ç±»å‹ä¸º intï¼Œé‚£ä¹ˆè¯¥æ•°ç»„çš„ç±»å‹å°±æ˜¯â€œint æ•°ç»„â€ã€‚ç„¶è€Œï¼Œint æ•°ç»„ç±»å‹æ˜¯ä¸å®Œæ•´çš„ç±»å‹ï¼Œé™¤éæŒ‡å®šäº†æ•°ç»„å…ƒç´ çš„æ•°é‡ã€‚å¦‚æœä¸€ä¸ª int æ•°ç»„æœ‰ 16 ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„å¯¹è±¡ç±»å‹ï¼Œå³â€œ16 ä¸ª int å…ƒç´ æ•°ç»„â€ã€‚\n\n## ä¸€ç»´æ•°ç»„çš„å®šä¹‰å’Œåˆå§‹åŒ–\n\næ•°ç»„çš„å®šä¹‰å†³å®šäº†æ•°ç»„åã€å…ƒç´ ç±»å‹ä»¥åŠå…ƒç´ ä¸ªæ•°ã€‚\nå…¶è¯­æ³•å¦‚ä¸‹ï¼š`<ç±»å‹> æ•°ç»„å [ <å…ƒç´ æ•°é‡> ];`\nå…ƒç´ æ•°é‡åœ¨æ–¹æ‹¬å·`[ ]`ä¹‹é—´ï¼Œå®ƒå¿…é¡»æ˜¯å¤§äº`0`çš„æ•´å‹å¸¸é‡è¡¨è¾¾å¼ã€‚\n\n```c\n#include<stdio.h>\nint main()\n{\n    int ar[10]; //elem num;elem type;\n    int br[10] = {};//å¯¹æ•°ç»„çš„10ä¸ªå…ƒç´ éƒ½åˆå§‹åŒ–ä¸º0ã€‚\n    int cr[10] = { 12,23,34 };//åé¢çš„å€¼ä¸º0\n    int a = 10;\n    sizeof(a);//4\n    sizeof(ar);//4*10=40\n    int dr[] = { 12,23,34,45,56,67,78 };//æ–¹æ‹¬å·å†…å¯ä»¥ä¸å†™ï¼Œä½†èŠ±æ‹¬å·ä¸­çš„æ•°æ®å¿…é¡»å¾—å†™ã€‚åˆ™å…ƒç´ æ•°ä¸ºsizeof(dr)/sezeof(dr[0])ã€‚sizeofæ˜¯åœ¨ç¼–è¯‘æ—¶æœŸè®¡ç®—çš„ï¼Œåˆ™dræ•°ç»„çš„å¤§å°æ˜¯ç¼–è¯‘æ—¶æœŸå°±ç¡®å®šäº†ã€‚\n}\n```\n\n### æ€»ç»“\n\næ•°ç»„çš„ç±»å‹æœ‰æ•°ç»„å…ƒç´ çš„ç±»å‹ã€æ•°ç»„å…ƒç´ çš„ä¸ªæ•°ã€‚æ•°ç»„çš„å…ƒç´ ä¸ªæ•°å¯ä»¥é€šè¿‡sizeof è®¡ç®—å¾—åˆ°ã€‚\n\n### ä¸åŒCæ ‡å‡†\n\nC99å¯ä»¥æ‹¿å°†è¦ç”¨é”®ç›˜è¾“å…¥çš„å˜é‡ä½œä¸ºæ–¹æ‹¬å·å†…çš„å¸¸é‡ï¼Œä½†VSè¿™æ ·çš„C11ä¸å¯ä»¥ã€‚\n\n```c\nint n=0;\nscanf(\"%d\",&n);\nint ar[n];\nreturn 0;\n```\n\n# æ•°å€¼åœ¨å†…å­˜çš„è¡¨\n\n```c\nint main()\n{\n    int ar[10]={12,23,34,45,56,67,78,89,100};//0x0c~0x64\n}\n```\n\n![image-20210717150102235](../../images/C%E8%AF%AD%E8%A8%80_%E6%95%B0%E7%BB%84/image-20210717150102235.png)\n\n# ä¸€ç»´æ•°ç»„\n\n## ä¸€ç»´æ•°ç»„çš„ä½¿ç”¨\n\næ•°ç»„åœ¨å­˜å‚¨å•å…ƒä¸­æ˜¯é¡ºåºè¿ç»­å­˜æ”¾çš„ï¼Œä»»ä½•ä¸€ä¸ªå…ƒç´ éƒ½å¯ä»¥å•ç‹¬è®¿é—®ï¼Œå…¶æ ‡è¯†æ–¹æ³•æ˜¯ç”¨æ•°ç»„åå’Œä¸‹æ ‡;\n`æ•°ç»„å[æ•´å‹è¡¨è¾¾å¼];`\n\næ•´å‹è¡¨è¾¾å¼**å¯ä»¥æ˜¯å˜é‡ï¼Œä¹Ÿå¯æ˜¯å¸¸é‡ï¼Œä½†å¿…é¡»æ˜¯æ•´å‹ç±»å‹**ã€‚\n\næ•°ç»„çš„è®¿é—®ï¼ˆè¯»å–ï¼Œå†™å…¥ï¼‰ä¸æ•°ç»„çš„å®šä¹‰ä¸ä¸€æ ·ã€‚\n\n```c\nint main()\n{\n    int ar[10];\n    for(int i=0;i<10;++i)\n    {\n        ar[i]=i+10;\n    }\n    for(int i=0;i<10;++i)\n    {\n        printf(\"%d \",ar[i]);\n    }\n    printf(\"\\n\");\n    return 0;\n}\n```\n\n```c\n//ä¸ºäº†ä¾¿äºä»£ç çš„ç»´æŠ¤\nint main()\n{\n    const int n=5;\n    int ar[n];\n    for(int i=0;i<n;++i)\n    {\n        ar[i]=i+10;\n    }\n    for(int i=0;i<n;++i)\n    {\n        printf(\"%d \",ar[i]);\n    }\n    printf(\"\\n\");\n    return 0;\n}\n```\n\nconstå…³é”®å­—åœ¨ç¼–è¯‘æ—¶æœŸçš„æ›¿æ¢æ˜¯å¯¹äºcppæ–‡ä»¶è€Œè¨€çš„ã€‚å¯¹äº`.c`æ–‡ä»¶ï¼Œconstå°±ä¸é€‚ç”¨äº†ï¼\n```c\nconst int m;//æ— æ„ä¹‰\nconst int br[10];//ä¹Ÿä¸å¯ä»¥ã€‚ä½†æ˜¯const int br[10]={};å¯ä»¥\n//è¯´æ˜constä¿®é¥°çš„å˜é‡å¿…é¡»è¦åœ¨å®šä¹‰æ—¶åˆå§‹åŒ–å€¼ã€‚\n```\n### å…¶ä»–ç±»å‹çš„æ•°ç»„\n\n#### å¸¸æ€§æ•°ç»„\n```c\nconst int ar[5]={1,2,3,4,5};//å¸¸æ€§æ•°ç»„ï¼Œæ•°ç»„å…ƒç´ çš„å€¼åªå¯è¯»ï¼Œä¸å¯å†™ã€‚\n```\n#### å­˜æ”¾å­—ç¬¦ï¼ˆä¸²ï¼‰çš„æ•°ç»„\n```c\n#include<stdio.h>\nint main()\n{\n    //ä»¥ä¸‹ä¸¤ä¸ªæ•°ç»„æ•ˆæœä¸€æ ·ï¼Œæœªå­˜æ”¾çš„ä½ç½®éƒ½æ˜¯'\\0'\n    char str1[10]={\"tulun\"};\n    char str2[10]={'t','u','l','u','n'};\n    //è€Œä»¥ä¸‹ä¸¤ä¸ªæ•°ç»„å°±ä¸ä¸€æ ·äº†ï¼Œå°¤å…¶æ˜¯åœ¨è¢«è¡¨ç¤ºä¸ºå­—ç¬¦ä¸²æ ¼å¼åŒ–è¾“å‡ºæ—¶ï¼š\n    char stra[]={\"tulun\"};//å®šç•Œç¬¦\"\"è¡¨ç¤ºå­˜å…¥çš„æ•°æ®æ˜¯å­—ç¬¦ä¸²ï¼Œéšå½¢åœ¨å°¾éƒ¨æœ‰'\\0'ï¼Œæ•°ç»„å…ƒç´ ä¸ªæ•°è¢«å¼€è¾Ÿ6ä¸ª\n    char strb[]={'t','u','l','u','n'};//æ˜¯ä¸€ä¸ªä¸ªå­˜çš„ï¼Œæ•°ç»„å…ƒç´ ä¸ªæ•°è¢«å¼€è¾Ÿ5ä¸ªï¼Œåé¢æ²¡æœ‰'\\0'\n    sizeof(stra);//6\n    sizeof(strb);//5\n    \n    printf(\"%s \\n\",stra);//å°†è¾“å‡º\"tulun\"\n    printf(\"%s \\n\",strb);//å°†è¾“å‡ºï¼štulun????????...å› ä¸ºç¨‹åºå°†ä»strbè¿™ä¸ªé¦–åœ°å€å¼€å§‹ä¸€ä¸ªä¸€ä¸ªè¾“å‡ºï¼Œç›´åˆ°æ‰¾åˆ°å†…å­˜ä¸­å­˜çš„æ•°å€¼ä¸º0æ‰ç»“æŸ\n}\n```\n#### å­˜æ”¾æŒ‡é’ˆçš„æ•°ç»„\n```c\nint main()\n{\n    //æ¯ä¸ªå…ƒç´ æ˜¯æŸä¸€æŒ‡é’ˆç±»å‹//æ˜¯å­˜æ”¾æŒ‡é’ˆçš„æ•°ç»„\n    int* par[10]={NULL};\n    char* pstr[10]={NULL};\n}\n```\n## ä¸€ç»´æ•°ç»„çš„åº”ç”¨å®ä¾‹\n### æŸ¥è¡¨æ³•\næŸ¥è¡¨æ³•æ˜¯å°†ä¸€äº›äº‹å…ˆè®¡ç®—å¥½çš„ç»“æœï¼Œå­˜å‚¨åœ¨å¸¸é‡æ•°ç»„ä¸­ï¼Œç”¨åˆ°æ˜¯ç›´æ¥æŒ‰ä¸‹æ ‡å–æ•°æ®ï¼Œä»¥èŠ‚çœè¿è¡Œæ—¶çš„è®¡ç®—æ—¶é—´ã€‚æ˜¯ä»¥ç©ºé—´æ¢æ—¶é—´ã€‚\n```c\n//æ–æ³¢é‚£å¥‘æ•°åˆ—\n#include<stdio.h>\nint main()\n{\n    const int n=30;\n    int ar[n]={1,1};\n    ar[0]=ar[1]=1;\n    for(int i=2;i<n;++i)\n    {\n        ar[i]=ar[i-1]+ar[i];\n    }\n    for(int i;i<n;++i)\n    {\n        printf(\"%d \",ar[i]);\n    }\n}\n```\n# äºŒç»´æ•°ç»„\n## äºŒç»´æ•°ç»„çš„å®šä¹‰\n## äºŒç»´æ•°ç»„çš„é€»è¾‘å’Œç‰©ç†ï¼ˆå†…å­˜ï¼‰è¡¨ç¤º\n## äºŒç»´æ•°ç»„çš„ä½¿ç”¨\n# æ•°ç»„ä¸å‡½æ•°\n## ä¸€ç»´æ•°ç»„ä½œä¸ºå‡½æ•°çš„å®å‚\n## äºŒç»´æ•°ç»„ä½œä¸ºå‡½æ•°çš„å®å‚\n# æœ‰å…³æŒ‡é’ˆ\n## `int *p[n]`\n## `int (*p)[n]`\n## å¯¹æ¯”\n# ä¸åŒCæ ‡å‡†\n1. C99å¯ä»¥æ‹¿å°†è¦ç”¨é”®ç›˜è¾“å…¥çš„å˜é‡ä½œä¸ºæ–¹æ‹¬å·å†…çš„å¸¸é‡ï¼Œä½†VSè¿™æ ·çš„C11ä¸å¯ä»¥ã€‚\n```c\nint n=0;\nscanf(\"%d\",&n);\nint ar[n];\nreturn 0;\n```\n\n2. constå…³é”®å­—åœ¨ç¼–è¯‘æ—¶æœŸçš„æ›¿æ¢æ˜¯å¯¹äºcppæ–‡ä»¶è€Œè¨€çš„ã€‚å¯¹äº.cæ–‡ä»¶ï¼Œconstå°±ä¸é€‚ç”¨äº†ï¼\n# ç»ƒä¹ \n## æŠŠaræ•°ç»„ä¸­çš„æ•°æ®èµ‹å€¼ç»™bræ•°ç»„\n```c\nint main()\n{\n    const int n = 5;\n    int ar[5] = {1,2,3,4,5};\n    int br[5];\n    br = ar;//èƒ½ä¸èƒ½æŠŠaræ•°ç»„ä¸­çš„æ•°æ®èµ‹å€¼ç»™bræ•°ç»„ã€‚ä½ å¦‚ä½•å®ç°ï¼Ÿ\n    return 0;\n}\n```\n\n```c\n//å¤´æ–‡ä»¶æ˜¯#include <string.h>,å¦‚æœè¦ä»æ•°ç»„aå¤åˆ¶kä¸ªå…ƒç´ åˆ°æ•°ç»„bï¼Œå¯ä»¥è¿™æ ·åš\n//memcpy(b,a,sizeof(int)*k);\n#include <stdio.h>  \n#include <string.h> \nint main()  \n{\n    int a[5]={0,1,2,3,4};\n    int b[5];\n    memcpy(b,a,sizeof(int)*3);\n    for(int i = 0; i < 3; i++)\n    {\n        printf(\"%d \",b[i]);\n    }\n    return 0;\n}\n//å¦‚æ­¤ï¼Œbæ•°ç»„å˜ä¸ºï¼š0,1,2,??,??\n```\n## ä¸ºä»€ä¹ˆæ•°ç»„çš„ä¸‹æ ‡ä»0 å¼€å§‹è€Œä¸æ˜¯ä»1 å¼€å§‹\nhttps://blog.csdn.net/every__day/article/details/83114080\n\nä»æ•°ç»„ä¸­å­˜å‚¨çš„æ•°æ®æ¨¡å‹æ¥çœ‹ï¼Œä¸‹æ ‡æœ€ç²¾ç¡®çš„æ„æ€æ˜¯â€åç§»é‡â€œï¼Œ`a[0]`çš„åç§»é‡æ˜¯0ï¼Œå³ä¸ºé¦–åœ°å€ã€‚`a[i]`çš„åç§»é‡æ˜¯`i`ï¼Œå¯»å€å…¬å¼å°±æ˜¯`a[i]_address = base_address + i*data_type_size`\n\nå¦‚æœä¸‹æ ‡ä»`1`å¼€å§‹ï¼Œé‚£å¯¹åº”çš„å¯»å€å…¬å¼`a[i]_address = base_address + (i-1) * data_type_size`\nå¯¹CPUæ¥è¯´ï¼Œæ¯æ¬¡éšæœºè®¿é—®ï¼Œå°±å¤šäº†ä¸€æ¬¡è¿ç®—ï¼Œå¤šå‘ä¸€æ¡æŒ‡ä»¤ã€‚\n## å¦‚æœå¸Œæœ›æ•°ç»„çš„ä¸‹æ ‡ä»1 åˆ°10 è€Œä¸æ˜¯ä»0 åˆ°9ï¼Œè¯¥æ€ä¹ˆåš\n![image-20210718004201328](../../images/C%E8%AF%AD%E8%A8%80_%E6%95%B0%E7%BB%84/image-20210718004201328.png)\n## ç”¨æŸ¥è¡¨æ³•å®ç°æ—¥å†çš„ä¸€äº›åŠŸèƒ½\n## éšæœºå‡½æ•°ç»™æ•°ç»„å…ƒç´ èµ‹å€¼å¹¶ä¸”æ’åº\nå®šä¹‰å¤§å°ä¸º100 çš„æ•´å‹æ•°ç»„ï¼Œä½¿ç”¨éšæœºå‡½æ•°ç»™æ•°ç»„å…ƒç´ èµ‹å€¼ã€‚æ•°å€¼èŒƒå›´`1..100`ï¼Œå¹¶ä¸”æ’åºï¼Œä½¿ç”¨å†’æ³¡æ’åºå®ç°ã€‚\n\néšæœºå‡½æ•°ï¼šé“¾æ¥åœ°å€ï¼š http://www.cplusplus.com/reference/cstdlib/rand/\n```c\nvoid Bubble_Sort(int* br,int n)\n{\n    for(int i=1;i<n;++i)\n    {\n        bool tag=true;\n        for(int j=0;j<n-i;++j)\n        {\n            if(br[j]>b[j+1])\n            {\n                Swap_Int(&br[j],&br[j+1]);\n                tag=false;\n            }\n        }\n        if(tag) break;\n    }\n}\n```\n## éšæœºå‡½æ•°ç»™æ•°ç»„å…ƒç´ èµ‹å€¼ï¼Œä¸èƒ½é‡å¤\nå®šä¹‰å¤§å°ä¸º100 çš„æ•´å‹æ•°ç»„ï¼Œä½¿ç”¨éšæœºå‡½æ•°ç»™æ•°ç»„å…ƒç´ èµ‹å€¼ã€‚æ•°å€¼çš„èŒƒå›´æ˜¯`1 .. 100`ï¼Œå¹¶ä¸”ä¸èƒ½é‡å¤ã€‚\n```c\nint* My_NonRepeating_RandArr(int* ar, int n)\n{\n    assert(ar != nullptr);\n    int br[101];\n    for (int i = 0;i < n + 1;++i)\n    {\n        br[i]=0;\n    }\n    int temp;\n    srand(time(NULL));\n    int i = 0;\n    do\n    {\n        temp = rand() % 100 + 1;\n        if (br[temp] != 1)\n        {\n            br[temp] = 1;\n            ar[i] = temp;\n            ++i;\n        }\n    } while (i<n);\n    return ar;\n}\n```\n## ç»Ÿè®¡å­—ç¬¦ä¸²ä¸­æ¯ä¸ªè‹±æ–‡å­—ç¬¦å‡ºç°çš„æ¬¡æ•°ï¼Œä¸åŒºåˆ†å¤§å°å†™\nç»Ÿè®¡å­—ç¬¦ä¸²ä¸­æ¯ä¸ªè‹±æ–‡å­—ç¬¦å‡ºç°çš„æ¬¡æ•°ï¼Œä¸åŒºåˆ†å¤§å°å†™ï¼Œåªç»Ÿè®¡è‹±æ–‡å­—ç¬¦ã€‚\n## ç»Ÿè®¡å­—ç¬¦ä¸²ä¸­æ¯ä¸ªè‹±æ–‡å­—ç¬¦å‡ºç°çš„æ¬¡æ•°ï¼ŒåŒºåˆ†å¤§å°å†™\nç»Ÿè®¡å­—ç¬¦ä¸²ä¸­æ¯ä¸ªè‹±æ–‡å­—ç¬¦å‡ºç°çš„æ¬¡æ•°ï¼ŒåŒºåˆ†å¤§å°å†™ï¼Œåªç»Ÿè®¡è‹±æ–‡å­—ç¬¦ã€‚\n## FindValue\n`FindValue`ï¼ŒValueå¦‚æœæ²¡åœ¨æ•°ç»„ä¸­åˆ™è¿”å›`-1`ï¼Œå¦‚æœåœ¨åˆ™è¿”å›ä¸‹æ ‡ã€‚\n```c\nint FindValue(int* br, int n, int val)\n{\n    int i=0;\n    while(i<n)\n    {\n        if(br[i]==val)\n        {\n            return i;\n        }\n        ++i;\n        }\n        return -1;\n    }\nint main()\n{\n    int br[8]={23,12,67,34,90,100,45,78};\n    FindValue(br,8,34);\n}\n\n//æ”¹è¿›åçš„ä»£ç \nint FindValue(int* br, int n, int val)\n{\n    assert(br != nullptr);\n    int pos=-1;\n    int i=0;\n    while(i<n)\n    {\n        if(br[i]==val)\n        {\n            pos = i;\n        }\n        ++i;\n    }\n    return pos;\n}\n//ç»ˆææ”¹è¿›\nint FindValue(int* br, int n, int val)\n{\n    assert(br != nullptr);\n    int pos=n-1;\n    while(pos>=0 && br[pos]!=val)\n    {\n        --pos;\n    }\n    return pos;\n}\n```\n## ç»™è¶…å¤§æ•°ç»„éšæœºèµ‹å€¼ï¼Œä¸èƒ½é‡å¤ï¼Œç”¨å“ˆå¸Œç®—æ³•\nå¦‚æœç¬¬å…­é¢˜ä¸­æ•°ç»„å¤§å°æ”¹ä¸º1000000ï¼Œé‚£ä¹ˆæ•°ç»„å¼€è¾Ÿç©ºé—´å°±å¾ˆå¤§ï¼Œå¦‚æœä»ç„¶æŒ‰ç…§æ—§çš„æ–¹å¼å»åšè‚¯å®šæ˜¯å¯¹ç¨‹åºä¸åˆ©çš„ã€‚è€ƒè™‘ç”¨å“ˆå¸Œç®—æ³•è§£å†³ï¼\n## æœ‰åºæ•°ç»„ä¸­FindValueï¼Œç”¨äºŒåˆ†æŸ¥æ‰¾\næ¥ç¬¬9é¢˜FindValueï¼Œå¦‚æœæˆ‘ä»¬çš„æ•°ç»„ä¸­çš„æ•°æ®æ˜¯æŒ‰ç…§å¤§å°é¡ºåºæ’åˆ—çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸éœ€è¦æŒ‰é¡ºåºéå†æŸ¥æ‰¾ï¼Œå¯ä»¥é‡‡å–äºŒåˆ†æŸ¥æ‰¾ï¼Œä½•ä¸ºäºŒåˆ†æŸ¥æ‰¾ï¼Œæ•ˆç‡å¦‚ä½•ï¼Œå¦‚ä½•äºŒåˆ†æŸ¥æ‰¾ï¼Ÿ\n## äºŒåˆ†æŸ¥æ‰¾çš„å˜ç§â€”â€”æ–æ³¢é‚£å¥‘æŸ¥æ‰¾\n[äºŒåˆ†æŸ¥æ‰¾åŠå…¶å˜ç§](https://www.cnblogs.com/yumingxing/p/9583154.html)ï¼šæ–æ³¢é‚£å¥‘æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦è¿˜æ˜¯$O(\\log_2 n)$ï¼Œä½†æ˜¯ä¸æŠ˜åŠæŸ¥æ‰¾ç›¸æ¯”ï¼Œæ–æ³¢é‚£å¥‘æŸ¥æ‰¾çš„ä¼˜ç‚¹æ˜¯å®ƒåªæ¶‰åŠåŠ æ³•å’Œå‡æ³•è¿ç®—ï¼Œè€Œä¸ç”¨é™¤æ³•ï¼Œè€Œé™¤æ³•æ¯”åŠ å‡æ³•è¦å ç”¨æ›´å¤šçš„æ—¶é—´ã€‚\n","tags":["tulun"],"categories":["C"]},{"title":"Cè¯­è¨€_åˆ†æ”¯è¯­å¥ã€å¾ªç¯è¯­å¥ã€å‡½æ•°åˆæ­¥","url":"/C/Cè¯­è¨€_åˆ†æ”¯è¯­å¥ã€å¾ªç¯è¯­å¥ã€å‡½æ•°åˆæ­¥/","content":"# boolç±»å‹\n\nboolåªæœ‰true å’Œfalseï¼›åœ¨Cè¯­è¨€ä¸­0æ˜¯falseï¼Œå…¶ä»–æƒ…å†µ(é0)éƒ½ä¸ºtrueã€‚\nåœ¨.cæ–‡ä»¶ä¸­éœ€è¦å¼•å…¥å¤´æ–‡ä»¶<stdbool.h>ï¼›åœ¨.cppæ–‡ä»¶ä¸­ç›´æ¥ä½¿ç”¨ã€‚\næ³¨æ„ï¼šVS2012ä¸å®Œå…¨æ”¯æŒC99æ ‡å‡†ï¼Œä¸èƒ½å¼•å…¥å¤´æ–‡ä»¶stdbool.h ã€‚ä½†æ–‡ä»¶åç¼€ä¸º.cppå¯ä»¥ç›´æ¥ä½¿ç”¨boolç±»å‹ã€‚\n\nä¹Ÿå¯ä»¥è‡ªå·±æ„é€ bool ç±»å‹ï¼ˆä½†æ²¡å¿…è¦ï¼Œå› ä¸ºcppæ–‡ä»¶ä¸‹å¯ä»¥ç›´æ¥ç”¨ï¼‰ã€‚\n## æ„é€ boolç±»å‹ä»£ç ç¤ºä¾‹\n```c\n// test.c æ–‡ä»¶ æ³¨æ„æ–‡ä»¶åç¼€æ˜¯ C æ–‡ä»¶ã€‚\n#include<stdio.h>\ntypedef int bool;\n#define true 1\n#define false 0\nint main()\n{\n\tbool xtag = true;\n\treturn 0;\n}\n```\n\n\n\n```c\n#include<stdio.h>\nint main()\n{\n    bool x = false;\n    printf(\"%d \\n\",x);//0\n    ++x;\n    printf(\"%d \\n\",x);//1\n    ++x;\n    printf(\"%d \\n\",x);//1\n    ++x;\n    printf(\"%d \\n\",x);//1\n    return 0;\n}\n```\n\n```c\n#include<stdio.h>\nint main()\n{\n    bool x = false;\n    printf(\"%d \\n\",x);//0\n    --x;//0 --> -1 è½¬ä¸º1\n    printf(\"%d \\n\",x);//1\n    --x;//1 --> 0\n    printf(\"%d \\n\",x);//0\n    --x;//0 --> -1 è½¬ä¸º1\n    printf(\"%d \\n\",x);//1\n    return 0;\n}\n```\n\n# å…³ç³»è¡¨è¾¾å¼\n\nå…³ç³»è¡¨è¾¾å¼è¿ç®—ç»“æœæ˜¯boolå€¼ã€‚å…³ç³»è¿ç®—ç¬¦éƒ½æ˜¯åŒç›®è¿ç®—ç¬¦ï¼Œå…¶ç»“åˆæ€§å‡ä¸ºå·¦ç»“åˆã€‚å…³ç³»è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§ä½äºç®—æœ¯è¿ç®—ç¬¦ï¼Œé«˜äºèµ‹å€¼è¿ç®—ç¬¦ã€‚åœ¨å…­ä¸ªå…³ç³»è¿ç®—ç¬¦ä¸­ï¼Œ`<`ã€`<=`ã€`>`ã€`>=`çš„ä¼˜å…ˆçº§ç›¸åŒï¼Œé«˜äº`==`å’Œ`!=`ï¼Œ`==`å’Œ`!=`çš„ä¼˜å…ˆçº§ç›¸åŒã€‚\néœ€è¦ç‰¹åˆ«æ³¨æ„ï¼š`==` æ‰è¡¨ç¤ºç­‰äºæ¯”è¾ƒï¼Œè€Œ `=` è¡¨ç¤ºèµ‹å€¼ï¼Œå¤§å®¶è¦æ³¨æ„åŒºåˆ†ï¼Œåˆ‡å‹¿æ··æ·†ã€‚\n\n![image-20210715132315085](../../images/C%E8%AF%AD%E8%A8%80_%E5%88%86%E6%94%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%87%BD%E6%95%B0%E5%88%9D%E6%AD%A5/image-20210715132315085.png)\n\n## è¯¥æ­»çš„`=`å·\n\n```c\n#include<stdio.h>\nint main()\n{\n    int age = 0;\n\tscanf(\"%d\",&age);\n\tif(age = 3)  //if(age==3) //if(3==age)\n\t{\n\t\tprintf(\"è¯¥ä¸Šå¹¼å„¿å›­äº† \\n\");\n\t}\n\telse\n\t{\n\t\tprintf(\"hehe \\n\");\n\t}\n\treturn 0;\n}\n```\n\næ­¤ä¾‹ä¸­ifåœ†æ‹¬å·å†…çš„è¡¨è¾¾å¼ä¸º`\"age=3\"`ï¼Œæ˜¯ä¸€ä¸ªå¸¸é‡èµ‹å€¼ç»™å˜é‡çš„æ“ä½œï¼Œä¸€å®šä¼šé€šè¿‡å¯¼è‡´è¡¨è¾¾å¼ç»“æœå€¼ä¸º1ï¼Œæ‰€ä»¥æ— è®ºåœ¨å¤–è¾“å…¥ä»€ä¹ˆæ­¤å¤„åˆ¤æ–­éƒ½ä¼šä¸ºtrueã€‚è¿™æ˜¯å› ä¸ºå°‘æ‰“äº†ä¸€ä¸ª=å·é€ æˆç­‰å€¼åˆ¤æ–­è¯¯æˆä¸ºäº†èµ‹å€¼è¯­å¥ã€‚ä¸ºäº†è§„é¿è¿™ä¸ªé”™è¯¯ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ä½¿ç”¨ç­‰å€¼åˆ¤æ–­è¯­å¥æ—¶å°½é‡æŠŠå¸¸é‡æ”¾åœ¨å·¦è¾¹ï¼ŒæŠŠå¾…æ¯”è¾ƒçš„å˜é‡æ”¾åœ¨å³è¾¹ã€‚è¿™æ ·çš„è¯ï¼Œå¦‚æœå†™æˆ`\"3=age\"`åï¼Œç¼–è¯‘æ—¶æœŸå³ä¼šæŠ¥é”™ï¼Œè€Œä¸æ˜¯æŠŠé”™è¯¯å»¶ç»­ç»™è¿è¡Œæ—¶æœŸï¼\n# é€»è¾‘è¡¨è¾¾å¼\n\né€»è¾‘è¡¨è¾¾å¼è¿ç®—ç»“æœæ˜¯boolå€¼ã€‚\n\n![image-20210715132551231](../../images/C%E8%AF%AD%E8%A8%80_%E5%88%86%E6%94%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%87%BD%E6%95%B0%E5%88%9D%E6%AD%A5/image-20210715132551231.png)\n## ä¸è¿ç®—(`&&`)\nåˆç§°æˆªæ–­ä¸ã€ç®€æ´ä¸ã€‚å‚ä¸è¿ç®—çš„ä¸¤ä¸ªè¡¨è¾¾å¼éƒ½ä¸ºçœŸæ—¶ï¼Œç»“æœæ‰ä¸ºçœŸï¼Œå¦åˆ™ä¸ºå‡ã€‚\n## æˆ–è¿ç®—(`||`)\nåˆç§°æˆªæ–­æˆ–ã€ç®€æ´æˆ–ã€‚å‚ä¸è¿ç®—çš„ä¸¤ä¸ªè¡¨è¾¾å¼åªè¦æœ‰ä¸€ä¸ªä¸ºçœŸï¼Œç»“æœå°±ä¸ºçœŸï¼›ä¸¤ä¸ªè¡¨è¾¾å¼éƒ½ä¸ºå‡æ—¶ç»“æœæ‰ä¸ºå‡ã€‚\n## éè¿ç®—(`!`)\nå‚ä¸è¿ç®—çš„è¡¨è¾¾å¼ä¸ºçœŸæ—¶ï¼Œç»“æœä¸ºå‡ï¼›å‚ä¸è¿ç®—çš„è¡¨è¾¾å¼ä¸ºå‡æ—¶ï¼Œç»“æœä¸ºçœŸã€‚\n## ä¼˜å…ˆçº§\né€»è¾‘è¿ç®—ç¬¦å’Œå…¶å®ƒè¿ç®—ç¬¦ä¼˜å…ˆçº§ä»ä½åˆ°é«˜ä¾æ¬¡ä¸ºï¼š\nèµ‹å€¼è¿ç®—ç¬¦(`=`)ã€€`<`ã€€`&&`å’Œ`||`ã€€`<`ã€€`å…³ç³»è¿ç®—ç¬¦`ã€€`<`ã€€`ç®—æœ¯è¿ç®—ç¬¦`ã€€`<`ã€€é(`!`)\n`&&`å’Œ`||`ä½äº`å…³ç³»è¿ç®—ç¬¦`ï¼Œ`!`é«˜äº`ç®—æœ¯è¿ç®—ç¬¦`ã€‚\n# åˆ†æ”¯è¯­å¥\n\n## åŒåˆ†æ”¯è¯­å¥åŠ å‡ è¡Œä»£ç å˜å•åˆ†æ”¯\n\n```c\n#include<stdio.h>\nint main()\n{\n    int a=0,b=0;\n    int max=0;\n    scanf(\"%d %d\",&a,&b);\n    if(a>b)\n    {\n        max = a;\n    }else\n    {\n        max = b;\n    }\n    return 0;\n}\n```\n\n```c\n#include<stdio.h>\nint main()\n{\n    int a=0,b=0;\n    int max=0;\n    scanf(\"%d %d\",&a,&b);\n    max = a;\n    if(max<b)\n    {\n        max = b;\n    }\n    return 0;\n}\n```\n\n## ä¸‰ç›®è¿ç®—ç¬¦æ›¿ä»£ç®€å•çš„ifè¯­å¥\n\n```c\n#include<stdio.h>\nint main()\n{\n    int a=0,b=0;\n    int max=0;\n    scanf(\"%d %d\",&a,&b);\n    max = (a>b)?a:b;\n    return 0;\n}\n```\n\nã€€ã€€if è¯­å¥åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥ç”¨æ¡ä»¶è¿ç®—ç¬¦â€œ?:â€æ¥ç®€åŒ–è¡¨è¾¾ã€‚â€œ ? :â€æ˜¯ä¸€ä¸ªä¸‰å…ƒè¿ç®—ç¬¦ï¼Œå…¶æ„æˆçš„è¡¨è¾¾å¼æ ¼å¼ä¸ºï¼š<è¡¨è¾¾å¼1> ? <è¡¨è¾¾å¼2> : <è¡¨è¾¾å¼3>ï¼›æ‰§è¡Œé€»è¾‘ï¼šå…ˆè®¡ç®—è¡¨è¾¾å¼1ï¼Œè‹¥å…¶å€¼ä¸ºçœŸï¼ˆæˆ–é0ï¼‰ï¼Œåˆ™è®¡ç®—è¡¨è¾¾å¼2ï¼ˆä¸è®¡ç®—è¡¨è¾¾å¼3ï¼‰ï¼Œå¹¶å°†è¯¥å€¼ä½œä¸ºæ•´ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼›åä¹‹ï¼Œå³è¡¨è¾¾å¼1 çš„å€¼ä¸ºå‡æˆ–ä¸º0ï¼Œåˆ™è®¡ç®—è¡¨è¾¾å¼3ï¼ˆä¸è®¡ç®—è¡¨è¾¾å¼2ï¼‰ï¼Œå¹¶å°†è¯¥å€¼ä½œä¸ºæ•´ä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚\n\n## if-elseå¤šåˆ†æ”¯è¯­å¥\n\n### åˆ¤æ–­å­—ç¬¦ç±»åˆ«\n\nåˆ¤åˆ«é”®ç›˜è¾“å…¥å­—ç¬¦çš„ç±»åˆ«ï¼Œæ˜¯å¦æ˜¯æ•°å­—å­—ç¬¦ï¼Œæ˜¯å¦æ˜¯å°å†™å­—ç¬¦ï¼Œæ˜¯å¦æ˜¯å¤§å†™å­—ç¬¦ï¼Œè¿˜æœ‰å…¶å®ƒå­—ç¬¦ã€‚\n\n```c\n//è¾“å…¥å­—ç¬¦ç»™å˜é‡æœ‰ä¸¤ç§å†™æ³•ã€‚\nchar ch;\nscanf_s(\"%c\",&ch);//a\nch=getchar();\n//ä»¥ä¸Šä¸¤ç§å†™æ³•æ˜¯ç­‰æ•ˆçš„ã€‚\n```\n\n#### ç›¸åº”çš„å¤´æ–‡ä»¶`<ctype.h>`\n\n##### å‡½æ•°\n\n###### å­—ç¬¦åˆ†ç±»\n\n1. `isalnum(char)`;åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦æ˜¯å¦æ˜¯å­—æ¯æˆ–æ•°å­—\n2. `isalpha(char)`;åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦æ˜¯å¦æ˜¯å­—æ¯\n3. `islower(char);`åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦æ˜¯å¦æ˜¯å°å†™å­—æ¯\n4. `isupper(char);`åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦æ˜¯å¦æ˜¯å¤§å†™å­—æ¯\n5. `isdigit(char);`åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦æ˜¯å¦æ˜¯æ•°å­—\n6. `isxdigit(char);`åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦æ˜¯å¦æ˜¯åå…­è¿›åˆ¶æ•°å­—å­—ç¬¦ï¼ˆ`0123456789abcdefABCDEF`ï¼‰\n7. `iscntrl(char);`åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦æ˜¯å¦æ˜¯æ§åˆ¶å­—ç¬¦\n8. `isspace(char);`åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦æ˜¯å¦æ˜¯ç©ºç™½å­—ç¬¦\n9. `isblank(char);`åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦æ˜¯å¦æ˜¯ç©ºæ ¼å­—ç¬¦ï¼ˆ`C99`ï¼‰\n10. `ispunct(char);`åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦æ˜¯å¦æ˜¯ä¸€ä¸ªæ ‡ç‚¹ç¬¦å·\n###### å­—ç¬¦æ“ä½œ\n1. `tolower(char);`å°†å­—ç¬¦è½¬æ¢æˆå°å†™\n2. `toupper(char);`å°†å­—ç¬¦è½¬æ¢æˆå¤§å†™\n### è‰¯å¥½çš„ä»£ç é£æ ¼\n\n![image-20210716113008168](../../images/C%E8%AF%AD%E8%A8%80_%E5%88%86%E6%94%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%87%BD%E6%95%B0%E5%88%9D%E6%AD%A5/image-20210716113008168.png)\n## switchå¤šåˆ†æ”¯ç»“æ„\n\n# å‡½æ•°åˆæ­¥\n\nåœ¨ç»“æ„åŒ–ç¨‹åºè®¾è®¡ä¸­ï¼Œå‡½æ•°æ˜¯å°†ä»»åŠ¡è¿›è¡Œæ¨¡å—åˆ’åˆ†çš„åŸºæœ¬å•ä½ã€‚é€šè¿‡å‡½æ•°ï¼Œå¯ä»¥æŠŠä¸€ä¸ªå¤æ‚ä»»åŠ¡åˆ†è§£æˆä¸ºè‹¥å¹²ä¸ªæ˜“äºè§£å†³çš„å°ä»»åŠ¡ã€‚å……åˆ†ä½“ç°ç»“æ„åŒ–ç¨‹åºè®¾è®¡ç”±ç²—åˆ°ç²¾ï¼Œé€æ­¥ç»†åŒ–çš„è®¾è®¡æ€æƒ³ã€‚ä¸€ä¸ªå¤§çš„ç¨‹åºä¸€èˆ¬åº”åˆ†ä¸ºè‹¥å¹²ä¸ªç¨‹åºæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—å®ç°ä¸€ä¸ªç‰¹å®šçš„åŠŸèƒ½ï¼Œè¿™äº›æ¨¡å—ç§°ä¸ºå­ç¨‹åºï¼Œåœ¨Cè¯­è¨€ä¸­å­ç¨‹åºç”¨å‡½æ•°å®ç°ã€‚\n\nä»€ä¹ˆæ—¶å€™æˆ‘ä»¬è®¤ä¸ºæ¨¡å—æ˜¯è¶³å¤Ÿå°çš„ï¼šåŠŸèƒ½æ˜¯å•ä¸€çš„ã€‚\n\n![image-20210714181921261](../../images/C%E8%AF%AD%E8%A8%80_%E5%88%86%E6%94%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%87%BD%E6%95%B0%E5%88%9D%E6%AD%A5/image-20210714181921261.png)\n\n## æŒ‰æ˜¯å¦ç³»ç»Ÿé¢„å®šä¹‰åˆ†ä¸¤ç±»\n\n### ç¼–è¯‘ç³»ç»Ÿé¢„å®šä¹‰\n\nä¸€ç±»æ˜¯ç¼–è¯‘ç³»ç»Ÿé¢„å®šä¹‰çš„ï¼Œç§°ä¸ºåº“å‡½æ•°æˆ–æ ‡å‡†å‡½æ•°ï¼Œå¦‚ä¸€äº›å¸¸ç”¨çš„æ•°å­¦è®¡ç®—å‡½æ•°ã€å­—ç¬¦ä¸²å¤„ç†å‡½æ•°ã€å›¾å½¢å¤„ç†å‡½æ•°ã€æ ‡å‡†è¾“å…¥è¾“å‡ºå‡½æ•°ç­‰ã€‚è¿™äº›åº“å‡½æ•°éƒ½æŒ‰åŠŸèƒ½åˆ†ç±»ï¼Œé›†ä¸­è¯´æ˜åœ¨ä¸åŒçš„å¤´æ–‡ä»¶ä¸­ã€‚ç”¨æˆ·åªéœ€åœ¨è‡ªå·±çš„ç¨‹åºä¸­åŒ…å«æŸä¸ªå¤´æ–‡ä»¶ï¼Œå°±å¯ç›´æ¥ä½¿ç”¨è¯¥æ–‡ä»¶ä¸­å®šä¹‰çš„å‡½æ•°ã€‚\n1. `<asserst.h>`\n2. `<ctype.h>`\n3. `<math.h>`\n4. `<stdio.h>`\næŠŠå‡½æ•°åå­—ã€å‡½æ•°åŠŸèƒ½è®°ä¸‹æ¥ã€‚\n### ç”¨æˆ·è‡ªå®šä¹‰\nå¦ä¸€ç±»æ˜¯ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦å°†æŸä¸ªå…·æœ‰ç›¸å¯¹ç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºå®šä¹‰ä¸ºå‡½æ•°ã€‚\nè‡ªå®šä¹‰å‡½æ•°æœ‰ï¼š`å‡½æ•°è¿”å›ç±»å‹` + `å‡½æ•°å` + `å½¢å‚åˆ—è¡¨` + `å‡½æ•°ä½“æ„æˆ` ï¼›\n#### å‡½æ•°çš„å‘½åè¦æ±‚\n1. æ‹¿è‹±æ–‡å‘½åå‡½æ•°\n2. ç¬¬äºŒä¸ªè¦æ±‚ï¼šè§åçŸ¥ä¹‰ï¼Œä¸è¦ç”¨æ±‰è¯­æ‹¼éŸ³ï¼Œæœ‰æ­§ä¹‰ã€‚\n#### å‡½æ•°çš„å£°æ˜ã€å®šä¹‰æ³¨æ„äº‹é¡¹\n##### åŸåˆ™\n1. éœ€è¦å¤–éƒ¨è¾“å…¥çš„ï¼ˆæ¯”å¦‚scanfï¼‰å†™åˆ°å½¢å‚ä¸­ï¼›\n2. éœ€è¦æ‰“å°ã€è¾“å‡ºçš„ï¼Œreturnè¿”å›ã€‚\n##### è¯¥æ­»çš„å½¢å‚\n\n###### å½¢å‚å˜é‡ç±»å‹ååçš„æ ‡è¯†ç¬¦è¦ä¸è¦çœ\n\n1. å‡½æ•°çš„å£°æ˜ä¸­å½¢å‚åˆ—è¡¨å¯ä»¥çœå»å½¢å‚åï¼ˆæ ‡è¯†ç¬¦ï¼‰ï¼Œä½†ä¸èƒ½çœå»ç±»å‹åã€‚å› ä¸ºè™½ç„¶å‡½æ•°ä¸è¯†åˆ«åç§°ï¼Œä½†å¿…é¡»è¯†åˆ«ç±»å‹ï¼›\n2. è€Œå‡½æ•°å®šä¹‰å°±è¦æŠŠå½¢å‚åå†™å…¨ï¼Œå› ä¸ºå‡½æ•°ä½“ä¸­è¦æ“ä½œä¹‹ï¼›\n3. å‡½æ•°çš„è°ƒç”¨ä¸­ï¼Œå‚æ•°å‰ä¸èƒ½åŠ ç±»å‹åã€‚\n###### å½¢å‚å˜é‡çš„å®šä¹‰å¿…é¡»æ¯ä¸ªå‚æ•°éƒ½æœ‰ä¸€ä¸ªç±»å‹å’Œä¸€ä¸ªåç§°\n\nå½¢å‚å˜é‡çš„å®šä¹‰ä¸å±€éƒ¨å˜é‡å®šä¹‰æ˜¯æœ‰åŒºåˆ«çš„ã€‚å±€éƒ¨å˜é‡æ˜¯å¯ä»¥`int x,y;`è¿™æ ·å®šä¹‰çš„ï¼Œä½†å½¢å‚å®šä¹‰ä¸å¯ä»¥ï¼Œå¿…é¡»æ˜¯ä¸€ä¸ªç±»å‹åŒ¹é…ä¸€ä¸ªåç§°ï¼\n##### å‡½æ•°å£°æ˜ã€å®šä¹‰åçš„åˆ†å·\n\nå‡½æ•°å£°æ˜æ˜¯ä¸€ä¸ªè¯­å¥ï¼Œæ‰€ä»¥è¦åŠ åˆ†å·ã€‚ä½†æ˜¯å®šä¹‰å‡½æ•°å®ŒæˆåèŠ±æ‹¬å·ååŠ åˆ†å·ä¹Ÿæ²¡å½±å“ï¼Œå› ä¸ºé‚£æ˜¯ä¸ªç©ºè¯­å¥ï¼Œä½†ä¹Ÿæ²¡å¿…è¦ï¼\n\n##### ä¸€å®šè¦åœ¨å‡½æ•°è¢«è°ƒç”¨å‰å£°æ˜æˆ–å®šä¹‰\n\nè¢«è°ƒç”¨å‡½æ•°è¦åœ¨è°ƒç”¨è€…è°ƒç”¨å®ƒä¹‹å‰çš„åŒºåŸŸå£°æ˜æˆ–å®šä¹‰ï¼Œä¸ç„¶ç¼–è¯‘æ˜¯ä¸ä¼šé€šè¿‡çš„ï¼\n##### ä¸å…è®¸å‡½æ•°çš„åµŒå¥—å®šä¹‰\n\nCè¯­è¨€ä¸­ä¸å…è®¸å‡½æ•°çš„åµŒå¥—å®šä¹‰ï¼Œå³åœ¨ä¸€ä¸ªå‡½æ•°ä¸­å®šä¹‰å¦ä¸€ä¸ªå‡½æ•°ã€‚\n##### å‡½æ•°çš„è°ƒç”¨æ˜¯å…è®¸åµŒå¥—çš„\n![image-20210716124810268](../../images/Cè¯­è¨€_åˆ†æ”¯è¯­å¥ã€å¾ªç¯è¯­å¥ã€å‡½æ•°åˆæ­¥/image-20210716124810268.png)\n![image-20210716124758735](../../images/Cè¯­è¨€_åˆ†æ”¯è¯­å¥ã€å¾ªç¯è¯­å¥ã€å‡½æ•°åˆæ­¥/image-20210716124758735.png)\n### ç¤ºä¾‹\n\n![image-20210714182226592](../../images/C%E8%AF%AD%E8%A8%80_%E5%88%86%E6%94%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%87%BD%E6%95%B0%E5%88%9D%E6%AD%A5/image-20210714182226592.png)\n\nå®šä¹‰å‡½æ•°æ—¶å¯èƒ½ä¼šæ¶‰åŠè‹¥å¹²ä¸ªå˜é‡ï¼Œç©¶ç«Ÿå“ªäº›å˜é‡åº”å½“ä½œä¸ºå‡½æ•°çš„å‚æ•°ï¼Ÿå“ªäº›åº”å½“å®šä¹‰åœ¨å‡½æ•°ä½“å†…ï¼Ÿè¿™æœ‰ä¸€ä¸ªåŸåˆ™ï¼š\nä½œä¸ºä¸€ä¸ªç›¸å¯¹ç‹¬ç«‹çš„æ¨¡å—ï¼Œå‡½æ•°åœ¨ä½¿ç”¨æ—¶å®Œå…¨å¯ä»¥è¢«çœ‹æˆ â€œé»‘åŒ£å­â€ï¼Œé™¤äº†è¾“å…¥è¾“å‡ºå¤–ï¼Œå…¶ä»–éƒ¨åˆ†å¯ä¸å¿…å…³å¿ƒã€‚ä»å‡½æ•°çš„å®šä¹‰çœ‹å‡ºï¼Œå‡½æ•°å¤´æ­£æ˜¯ç”¨æ¥åæ˜ å‡½æ•°çš„åŠŸèƒ½å’Œä½¿ç”¨æ¥å£ï¼Œå®ƒæ‰€å®šä¹‰çš„æ˜¯â€œåšä»€ä¹ˆâ€ï¼Œåœ¨è¿™éƒ¨åˆ†å¿…é¡»æ˜ç¡®â€œé»‘åŒ£å­â€çš„è¾“å…¥è¾“å‡ºéƒ¨åˆ†ï¼Œè¾“å‡ºå°±æ˜¯å‡½æ•°çš„è¿”å›å€¼ï¼Œè¾“å…¥å°±æ˜¯å‚æ•°ã€‚å› æ­¤ï¼Œåªæœ‰é‚£äº›åŠŸèƒ½ä¸Šèµ·è‡ªå˜é‡ä½œç”¨çš„å˜é‡æ‰å¿…é¡»ä½œä¸ºå‚æ•°å®šä¹‰åœ¨å‚æ•°è¡¨ä¸­ï¼›å‡½æ•°ä½“ä¸­å…·ä½“æè¿°â€œå¦‚ä½•åšâ€ï¼Œå› æ­¤é™¤å‚æ•°ä¹‹å¤–çš„ä¸ºå®ç°ç®—æ³•æ‰€éœ€ç”¨çš„å˜é‡åº”å½“å®šä¹‰åœ¨å‡½æ•°ä½“å†…ã€‚\n## å½¢å‚å’Œå®å‚\n\n### å½¢å¼å‚æ•°ï¼ˆå½¢å‚ï¼‰\n\nåªèƒ½ç­‰åˆ°å‡½æ•°è¢«è°ƒç”¨æ—¶æ¥æ”¶ä¼ é€’è¿›æ¥çš„æ•°æ®ï¼Œæ‰€ä»¥ç§°ä¸ºå½¢å¼å‚æ•°ï¼Œç®€ç§°å½¢å‚ã€‚\n\nå½¢å¼å‚æ•°æ˜¯æŒ‡å‡½æ•°ååæ‹¬å·ä¸­å®šä¹‰çš„å˜é‡ï¼Œå½¢å¼å‚æ•°åªæœ‰åœ¨å‡½æ•°è¢«è°ƒç”¨çš„è¿‡ç¨‹ä¸­ç»™äºèµ‹å€¼ï¼ˆåˆ†é…å­˜å‚¨ç©ºé—´ï¼‰ã€‚å‡½æ•°æ‰§è¡Œå®Œåå½¢å¼å‚æ•°å˜é‡å°±è‡ªåŠ¨é‡Šæ”¾äº†ï¼Œæ‰€ä»¥å½¢å¼å‚æ•°åªåœ¨å‡½æ•°ä¸­å¯è§ï¼ˆä½œç”¨åŸŸï¼‰ã€‚\n### å®å‚ï¼ˆå®é™…å‚æ•°ï¼‰\n\nè°ƒç”¨å‡½æ•°æ—¶ç»™å‡ºçš„å‚æ•°åŒ…å«äº†å®å®åœ¨åœ¨çš„æ•°æ®ï¼Œæ‰€ä»¥ç§°ä¸ºå®é™…å‚æ•°ï¼Œç®€ç§°å®å‚ã€‚\n\nå®å‚å¯ä»¥æ˜¯ï¼šå¸¸é‡ã€å˜é‡ã€è¡¨è¾¾å¼æˆ–å‡½æ•°ç­‰ã€‚æ— è®ºå®å‚æ˜¯ä½•ç§ç±»å‹çš„é‡ï¼Œåœ¨è¿›è¡Œå‡½æ•°è°ƒç”¨æ—¶ï¼Œå®ƒä»¬éƒ½**å¿…é¡»æœ‰ç¡®å®šçš„å€¼**ï¼Œä»¥ä¾¿æŠŠè¿™äº›å€¼ä¼ é€ç»™å½¢å‚ã€‚\n### åŠŸèƒ½\n\nå½¢å‚å’Œå®å‚çš„åŠŸèƒ½æ˜¯ä¼ é€’æ•°æ®ï¼Œå‘ç”Ÿå‡½æ•°è°ƒç”¨æ—¶ï¼Œå®å‚çš„å€¼ä¼šä¼ é€’ç»™å½¢å‚ã€‚\n### å½¢å‚å®å‚çš„åŒºåˆ«ä¸è”ç³»\n\n1. å½¢å‚å˜é‡åªæœ‰åœ¨å‡½æ•°è¢«è°ƒç”¨æ—¶æ‰ä¼šåˆ†é…å†…å­˜ï¼ˆåœ¨stack ä¸­ï¼‰ï¼Œè°ƒç”¨ç»“æŸåï¼Œç«‹åˆ»é‡Šæ”¾å†…å­˜ï¼Œæ‰€ä»¥å½¢å‚å˜é‡åªæœ‰åœ¨å‡½æ•°å†…éƒ¨æœ‰æ•ˆï¼Œä¸èƒ½åœ¨å‡½æ•°å¤–éƒ¨ä½¿ç”¨ã€‚\n2. å®å‚å¯ä»¥æ˜¯å¸¸é‡ã€å˜é‡ã€è¡¨è¾¾å¼ã€å‡½æ•°ç­‰ï¼Œæ— è®ºå®å‚æ˜¯ä½•ç§ç±»å‹çš„æ•°æ®ï¼Œåœ¨è¿›è¡Œå‡½æ•°è°ƒç”¨æ—¶ï¼Œå®ƒä»¬éƒ½å¿…é¡»æœ‰ç¡®å®šçš„å€¼ï¼Œä»¥ä¾¿æŠŠè¿™äº›å€¼ä¼ é€ç»™å½¢å‚ï¼Œæ‰€ä»¥åº”è¯¥æå‰ç”¨èµ‹å€¼ã€è¾“å…¥ç­‰åŠæ³•ä½¿å®å‚è·å¾—ç¡®å®šå€¼ã€‚\n3. å®å‚å’Œå½¢å‚åœ¨æ•°é‡ä¸Šã€ç±»å‹ä¸Šã€é¡ºåºä¸Šå¿…é¡»ä¸¥æ ¼ä¸€è‡´ï¼Œå¦åˆ™ä¼šå‘ç”Ÿâ€œç±»å‹ä¸åŒ¹é…â€çš„é”™è¯¯ã€‚å½“ç„¶ï¼Œå¦‚æœèƒ½å¤Ÿè¿›è¡Œè‡ªåŠ¨ç±»å‹è½¬æ¢ï¼Œæˆ–è€…è¿›è¡Œäº†å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œé‚£ä¹ˆå®å‚ç±»å‹ä¹Ÿå¯ä»¥ä¸åŒäºå½¢å‚ç±»å‹ã€‚\n4. å‡½æ•°è°ƒç”¨ä¸­å‘ç”Ÿçš„æ•°æ®ä¼ é€’æ˜¯å•å‘çš„ï¼Œåªèƒ½æŠŠå®å‚çš„å€¼ä¼ é€’ç»™å½¢å‚ï¼Œè€Œä¸èƒ½æŠŠå½¢å‚çš„å€¼åå‘åœ°ä¼ é€’ç»™å®å‚ï¼›æ¢å¥è¯è¯´ï¼Œä¸€æ—¦å®Œæˆæ•°æ®çš„ä¼ é€’ï¼Œå®å‚å’Œå½¢å‚å°±å†ä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œæ‰€ä»¥ï¼Œåœ¨å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œå½¢å‚çš„å€¼å‘ç”Ÿæ”¹å˜å¹¶ä¸ä¼šå½±å“å®å‚çš„å€¼ã€‚\n\n## å‡½æ•°è°ƒç”¨ä¸­çš„å†…å­˜åˆ†é…\n\n![image-20210716123311156](../../images/C%E8%AF%AD%E8%A8%80_%E5%88%86%E6%94%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%87%BD%E6%95%B0%E5%88%9D%E6%AD%A5/image-20210716123311156.png)\n\nå‡å¦‚å†…å­˜å…±æœ‰1Mç©ºé—´ã€‚æˆ‘ä»¬ä¼šæŠŠå®ƒåˆ†è§£æˆè‹¥å¹²ä¸ªæ ˆå¸§ï¼ˆ**ä¸‹å»æŸ¥è¯¢VSå¦‚ä½•è®¾ç½®æ ˆçš„å¤§å°å’Œæ ˆå¸§çš„å¤§å°**ï¼‰ï¼Œä¸»å‡½æ•°è°ƒç”¨æ—¶ï¼Œä¼šæŠŠåº•å±‚çš„æ ˆå¸§åˆ†é…ç»™ä¸»å‡½æ•°ï¼Œå¦‚æœå°†è¦å ç”¨å¾ˆå¤šçš„ç©ºé—´ï¼Œæˆ‘ä»¬å°±å¾—ç»§ç»­å¾€ä¸Šå ç”¨ä¸Šå±‚çš„æ ˆå¸§ã€‚æ¯å½“æœ‰ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œå³åˆ†é…ä¸€ä¸ªæ ˆå¸§ã€‚\n\n```c\nint a = 10;\nint b = 20;\nint* p = &a;//æ˜Ÿå·åœ¨ç±»å‹å’Œæ ‡è¯†ç¬¦ä¹‹é—´æ—¶æ˜¯å£°æ˜ã€‚//p=>&a;  //*pï¼ˆæ˜Ÿå·åœ¨æŒ‡é’ˆå˜é‡å‰æ˜¯è§£å¼•ç”¨ï¼‰=>*&a=>a;\n```\n\n## ä¼ åœ°å€äº¤æ¢å€¼--é—´æ¥æ”¹å˜å€¼\n\n![image-20210715152049764](../../images/C%E8%AF%AD%E8%A8%80_%E5%88%86%E6%94%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%87%BD%E6%95%B0%E5%88%9D%E6%AD%A5/image-20210715152049764.png)\n\n### é—®é¢˜1\n`int tmp = *ap;`é€šè¿‡æŒ‡é’ˆæŒ‡å‘å–xçš„å€¼å¹¶ä¿®æ”¹tmpå€¼çš„åº•å±‚å®ç°æ˜¯å¦‚ä½•çš„ï¼Ÿ\n`mov eax,10;`\n`mov ebx,0x00b3f9f0;`\n`mov [ebx],100h;`\nç›´æ¥è®¿é—®ã€é—´æ¥è®¿é—®ã€‚ä»»ä½•ä¸€æœ¬è®²å¾®æœºåŸç†çš„ä¹¦éƒ½æœ‰è®²è§£ã€‚\n### é—®é¢˜2\n![image-20210716122234042](../../images/Cè¯­è¨€_åˆ†æ”¯è¯­å¥ã€å¾ªç¯è¯­å¥ã€å‡½æ•°åˆæ­¥/image-20210716122234042.png)\nä»”ç»†è§‚å¯Ÿï¼Œå‘ç°æœªæ›¾å¼€è¾Ÿå®šä¹‰çš„å­˜å‚¨ç©ºé—´ä¸­éƒ½æ˜¯éšæœºå€¼\"`cccccccc`\"ï¼Œè€Œæœ‰ä¸¤ä¸ªåœ°å€å¾ˆç‰¹æ®Šï¼Œå°±æ˜¯`Swap_p`çš„å‡½æ•°åŸŸä¸­`ap`æŒ‡é’ˆå˜é‡çš„åœ°å€ä¹‹ä¸Šçš„ä¸¤ä¸ªåœ°å€`\"0X00B3F9F8\"`å’Œ`\"01351459\"`ã€‚è¿™ä¸¤ä¸ªå€¼æ˜¯ä»€ä¹ˆå€¼å‘¢ï¼Ÿ\nCè¯­è¨€çš„é¢è¯•ï¼šæŒ‡é’ˆã€ç¼–è¯‘é“¾æ¥è¿‡ç¨‹ã€å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­**çº¿ç¨‹çš„ä¿æŠ¤ã€æ¢å¤**æ˜¯æ€ä¹ˆå®ç°çš„ã€‚è°ƒç”¨å‡½æ•°ã€ç°åœºä¿æŠ¤ï¼Œè°ƒç”¨å®Œåè¦å®ç°ç°åœºçš„æ¢å¤ã€‚è¿™æ˜¯åŒºåˆ†å­¦çš„å¥½ä¸å¥½ã€è‡ªå­¦èƒ½åŠ›å¼ºä¸å¼ºçš„æ ‡å‡†ã€‚Cè¯­è¨€å…¨éƒ¨è®²å®Œåï¼Œåˆ†æ¨¡å—è®²æ—¶å†è¯´ã€‚\n## å‡½æ•°è°ƒç”¨æœºåˆ¶\n\n![image-20210714182226592](../../images/C%E8%AF%AD%E8%A8%80_%E5%88%86%E6%94%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%87%BD%E6%95%B0%E5%88%9D%E6%AD%A5/image-20210714182226592.png)\n\nCè¯­è¨€ä¸­ï¼Œå…ˆæŠŠyå…¥æ ˆï¼Œå†æŠŠxå…¥æ ˆï¼Œå‡½æ•°å‚æ•°å…¥æ ˆçš„é¡ºåºæ˜¯ä»å³å‘å·¦çš„ï¼æœ‰äº›ç¼–ç¨‹è¯­è¨€æ˜¯ä»å·¦å‘å³çš„ã€‚\n\nå‡½æ•°è°ƒç”¨é¦–å…ˆè¦è¿›è¡Œå‚æ•°ä¼ é€’ï¼Œå‚æ•°ä¼ é€’çš„æ–¹å‘æ˜¯ç”±å®å‚ä¼ é€’ç»™å½¢å‚ã€‚ä¼ é€’è¿‡ç¨‹æ˜¯ï¼Œå…ˆè®¡ç®—å®å‚è¡¨è¾¾å¼çš„å€¼ï¼Œå†å°†è¯¥å€¼ä¼ é€’ç»™å¯¹åº”çš„å½¢å‚å˜é‡ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå®å‚å’Œå½¢å‚çš„ä¸ªæ•°å’Œæ’åˆ—é¡ºåºåº”ä¸€ä¸€å¯¹åº”ï¼Œå¹¶ä¸”å¯¹åº”å‚æ•°åº”ç±»å‹åŒ¹é…ï¼ˆèµ‹å€¼å…¼å®¹ï¼‰,å³å®å‚çš„ç±»å‹å¯ä»¥è½¬åŒ–ä¸ºå½¢å‚ç±»å‹ã€‚è€Œå¯¹åº”å‚æ•°çš„å‚æ•°ååˆ™ä¸è¦æ±‚ç›¸åŒã€‚\nåœ¨ç¤ºä¾‹ä¸­`int MaxInt(int a,int b)`ï¼Œaå’Œbæ˜¯å½¢å‚ï¼Œåœ¨mainä¸­ x, y æ˜¯å®å‚ã€‚\n\næŸ¥ï¼šè¢«è°ƒç”¨å‡½æ•°MaxInt return cç»™ä¸»å‡½æ•°ä¸­çš„maxå˜é‡æ—¶ï¼Œè‚¯å®šä¸èƒ½ç›´æ¥èµ‹å€¼ï¼Œè€Œæ˜¯ç”¨ä¸´æ—¶ç©ºé—´å…ˆå­˜æ”¾ï¼Œå†å–å‡ºé€ç»™è¿™ä¸ªmaxã€‚è¿™ä¸ªä¸´æ—¶ç©ºé—´è°æ¥æ‹…å½“ï¼Ÿ\n\n## å¤šæ–‡ä»¶ç»“æ„\n\n# å¾ªç¯è¯­å¥\n\n## whileè¯­å¥\n\n### ç¤ºä¾‹--æ‰“å°å¹³æ–¹è¡¨\n\n```c\n#include<stdio.h>\nint main()\n{\n\tint i = 0, n = 0;\n\tprintf(\"Enter number of entries in table: \");\n\tscanf(\"%d\",&n);\n\ti = 1;\n\twhile(i <= n)\n\t{\n\t\tprintf(\"%10d%10d\\n\",i,i*i);\n\t\t++i;\n\t}\n\tprintf(\"\\n\");\n\treturn 0;\n}\n```\n\n## do-whileå¾ªç¯\n\nç‰¹ç‚¹æ˜¯å…ˆæ‰§è¡Œï¼Œååˆ¤æ–­ã€‚è¦æœ‰ä¸€ä¸ªæ¡ä»¶ä½¿ä¹‹é€€å‡ºwhileæ‰è¡Œã€‚\n\n```c\n//è®¡ç®—ä¸€ä¸ªæ­£æ•´æ•°çš„ä½æ•°\n#include<stdio.h>\nint main()\n{\n    int digits = 0,n;\n    printf(\"Enter a nonnegative integer: \");\n    scanf(\"%d\",&n);\n    do\n    {\n        n/=10;\n        digits++;\n    }while(n>0);\n    printf(\"The Number has %d digit \\n\",digits);\n    return 0;\n}\n```\n\nä½†æ˜¯do-whileæœ‰ä¸€ä¸ªæ¼æ´ï¼Œå°±æ˜¯å¦‚æœä¸Šä¾‹ä»£ç è¾“å…¥äº†ä¸€ä¸ª\"0\"å€¼çš„è¯ï¼Œè¿˜æ˜¯ä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œæœ€åè¾“å‡º1ä½ã€‚ä½†æ˜¯å®é™…ä¸Š0æ˜¯ä¸å ä½æ•°çš„ã€‚\n\n## forå¾ªç¯\n\n1. è¡¨è¾¾å¼1åªæ‰§è¡Œä¸€æ¬¡\n2. è¡¨è¾¾å¼2åˆ¤æ–­ä¸ºçœŸæ‰æ‰§è¡Œå¾ªç¯ä½“\n3. å¾ªç¯ä½“æ‰§è¡Œå®Œåæ‰æ‰§è¡Œè¡¨è¾¾å¼3\nç‰¹ç‚¹æ˜¯ï¼šç¼–ç¨‹çš„æ‰§è¡Œé¡ºåºå’Œæˆ‘ä»¬ç¼–å†™ä»–çš„é¡ºåºä¸ç¬¦åˆï¼Œæ‰€ä»¥æœ‰äº›äººä¸ä¹ æƒ¯forè¯­å¥ã€‚\n### VSå’ŒVC++ç¼–è¯‘å™¨å¯¹äºforè¯­å¥ä¸­è¡¨è¾¾å¼1çš„åŒºåˆ«\n\nVS2012/2019ä¸­çš„`for(int i=0;i<10;++i)`ä¸­içš„ä½œç”¨åŸŸåªåœ¨forå—å†…\n\nVC++ä¸­içš„ä½œç”¨åŸŸåœ¨å—å¤–ä¹Ÿæœ‰ï¼Œå› æ­¤ä¸èƒ½é‡æ–°å£°æ˜i\n\nVC++ä¸­`.c`æ–‡ä»¶ä¸­çš„forè¯­å¥ä¸­è¡¨è¾¾å¼1ä¸èƒ½åŒæ—¶å®šä¹‰ã€åˆå§‹åŒ–ã€‚åªèƒ½åœ¨forå¤–å…ˆå®šä¹‰iã€‚\n\n### forå¾ªç¯çš„æƒ¯ç”¨æ³•\n\nå¯¹äºå‘ä¸ŠåŠ ï¼ˆå˜é‡è‡ªå¢ï¼‰æˆ–å‘ä¸‹å‡ï¼ˆå˜é‡è‡ªå‡ï¼‰çš„å¾ªç¯æ¥è¯´ï¼Œforè¯­å¥é€šå¸¸æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚\n\n```c\n// ä»0 å‘ä¸ŠåŠ åˆ°n-1\nfor(i = 0; i < n; ++i) ...\n// ä»1 å‘ä¸ŠåŠ åˆ°n\nfor(i = 1; i <= n; ++i) ...\n// ä»n-1 å‘ä¸‹å‡åˆ°0\nfor(i = n-1; i >= 0; --i) ...\n//ä»n å‘ä¸‹å‡åˆ°1\nfor(i = n; i > 0; --i) ...\n//ç¼–å†™çš„æ§åˆ¶è¡¨è¾¾å¼ä¸­æŠŠ i < n å†™æˆ i <= n , ä¼šçŠ¯\"å¾ªç¯æ¬¡æ•°å·®ä¸€æ¬¡\" é”™è¯¯\n```\n\n```c\n#include<stdio.h>\nint main\n{\n    int i = 0;\n    int n = 5;\n    for(i = n; i > 0;--i)\n    {\n        printf(\"%d \",i);//æ‰§è¡Œnæ¬¡\n    }\n    printf(\"for end: \\n\");//è¾“å‡ºforå¾ªç¯é€€å‡ºåiçš„å€¼\n    printf(\"%d \\n\", i);\n    return 0;\n}\n```\n\n### å¾ªç¯è¯­å¥åœ†æ‹¬å·ä¸­çœç•¥è¡¨è¾¾å¼\n\n```c\nint n=10;\nint i=1;\nfor(;;)//for(int i=0;i<n;++i)\n{\n    if(i>=n)\n    {\n        break;\n    }\n    ++i;\n}\n```\n\nå¯¹äºforçœç•¥ï¼šå¦‚æœçœç•¥äº†è¡¨è¾¾å¼2ï¼Œé‚£ä¹ˆæ˜¯æ­»å¾ªç¯çš„æ•ˆæœ\n\nå¯¹äºwhileï¼Œçœç•¥åœ†æ‹¬å·å†…è¡¨è¾¾å¼ï¼Œä¸å¯è¡Œã€‚\n### ä¸‰ç§æ­»å¾ªç¯\n#### for\n\n```c\nfor(;;)\n{\n    ;\n}\n```\n\n```c\n//å¦‚ä½•æŠŠæ­»å¾ªç¯å†™æ³•æ”¹ä¸ºä¹‹å‰for(int i=0;i<n;++i)çš„æ•ˆæœ\nint n=10;\nint i=1;\nfor(;;)//for(int i=0;i<n;++i)\n{\n    if(i>=n)\n    {\n        break;\n    }\n    ++i;\n}\n```\n\n#### while\n\n```c\nwhile(1)\n{\n    ;\n}\n```\n\n#### do-while\n\n```c\ndo\n{\n    ;\n}while(1);\n```\n\n### 0716é‡ç‚¹ï¼šè·³è½¬è¯­å¥\n\nå®é™…ä¸Šï¼Œ`break/continue/return`éƒ½æ˜¯`goto`çš„å˜ç§ã€‚\n#### break\nè¯­å¥åªèƒ½ç”¨åœ¨switchè¯­å¥å’Œå¾ªç¯è¯­å¥ä¸­ï¼Œç”¨æ¥è·³å‡ºswitchè¯­å¥æˆ–æå‰ç»ˆæ­¢å¾ªç¯ï¼Œ**è½¬å»æ‰§è¡Œswitchè¯­å¥æˆ–å¾ªç¯è¯­å¥ä¹‹åçš„è¯­å¥**ã€‚\n\n![image-20210716141723230](../../images/C%E8%AF%AD%E8%A8%80_%E5%88%86%E6%94%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%87%BD%E6%95%B0%E5%88%9D%E6%AD%A5/image-20210716141723230.png)\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼š**breakè¯­å¥åªèƒ½è·³å‡ºä¸€å±‚å¾ªç¯**ã€‚\n#### continue\n\nè¯­å¥åªèƒ½ç”¨åœ¨å¾ªç¯è¯­å¥ä¸­ï¼Œç”¨æ¥ç»ˆæ­¢æœ¬æ¬¡å¾ªç¯ã€‚å½“ç¨‹åºæ‰§è¡Œåˆ°continueè¯­å¥æ—¶ï¼Œå°†**è·³è¿‡å…¶åå°šæœªæ‰§è¡Œçš„å¾ªç¯ä½“è¯­å¥ï¼Œå¼€å§‹ä¸‹ä¸€æ¬¡å¾ªç¯**ã€‚**ä¸‹ä¸€æ¬¡å¾ªç¯æ˜¯å¦æ‰§è¡Œä»ç„¶å–å†³äºå¾ªç¯æ¡ä»¶çš„åˆ¤æ–­**ã€‚continueè¯­å¥ä¸breakè¯­å¥çš„åŒºåˆ«åœ¨äºï¼Œcontinueè¯­å¥ç»“æŸçš„åªæ˜¯æœ¬æ¬¡å¾ªç¯ï¼Œè€Œbreakç»“æŸçš„æ˜¯æ•´ä¸ªå¾ªç¯ã€‚\n\nä½†ä¸Šé¢è¿™æ®µè¯æ²¡è¯´æ˜æœ¬è´¨ã€‚\n\n![image-20210716143039440](../../images/C%E8%AF%AD%E8%A8%80_%E5%88%86%E6%94%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%87%BD%E6%95%B0%E5%88%9D%E6%AD%A5/image-20210716143039440.png)\n\n##### continueå¯¹äºforè¯­å¥\n\ncontinueå¯¹äºforè¯­å¥è·³åˆ°çš„æ˜¯è¡¨è¾¾å¼3ã€‚å¦‚æœå¤„ç†ä¸å½“å°±ä¼šå‡ºé—®é¢˜ï¼š\n\n```c\n//æ‰“å°ï¼š1 3 5 7 9\nint main()\n{\n    int n=10;\n    for(int i=0;i<n;++i)\n    {\n        if(i&2==0)\n        {\n            continue;\n        }\n        printf(\"%d \",i);\n        //++i;//å¦‚æœæŠŠforåœ†æ‹¬å·ä¸­çš„è¡¨è¾¾å¼3æŒªä¸‹æ¥å†™åˆ°å¾ªç¯å—å†…çš„æœ€åä¸€å¥ï¼Œåˆ™æ­¤å¾ªç¯å°†æˆä¸ºæ­»å¾ªç¯ã€‚å› ä¸ºcontinueé’ˆå¯¹forå¾ªç¯æ˜¯è·³åˆ°è¡¨è¾¾å¼3çš„ï¼Œå¦‚æœè¡¨è¾¾å¼3æ˜¯ç©ºè¯­å¥åˆ™ä¸æ‰§è¡Œä»»ä½•è¯­å¥ï¼Œå¾’åŠ³ã€‚\n    }\n    printf(\"\\n\");\n    return 0;\n}\n```\n\n##### continueå¯¹äºwhileå’Œdo-whileè¯­å¥\n\ncontinueå¯¹äºwhileå’Œdo-whileè¯­å¥ï¼Œcontinueè·³åˆ°çš„æ˜¯åœ†æ‹¬å·å†…çš„åˆ¤æ–­ã€‚å¦‚æœå¤„ç†ä¸å½“ï¼Œæ›´ä¼šå‡ºé—®é¢˜ã€‚\n\nå¦‚ä½•å°†ä¸Šè¿°forçš„ä»£ç ç”±foræ”¹ä¸ºwhileå¾ªç¯ï¼Ÿ\n\n```c\n#include<stdio.h>\n//é”™è¯¯ç¤ºèŒƒ\nint main()\n{\n    int n=10;\n    int i=0;\n    while(i<n)\n    {\n        if(i%2==0)\n        {\n            continue;\n        }\n        printf(\"%d \",i);\n        ++i;\n    }\n    printf(\"\\n\");\n}\n```\n\n```c\n#include<stdio.h>\nint main()\n{\n    int n=10;\n    int i=0;\n    while(i<n)\n    {\n        ++i;\n        if(i%2==0)\n        {\n            continue;\n        }\n        printf(\"%d \",i);\n    }\n    printf(\"\\n\");\n}\n```\n\n#### goto\n\n**è¯­å¥**å’Œ**æ ‡å·è¯­å¥**ä¸€èµ·ä½¿ç”¨ï¼Œæ‰€è°“æ ‡å·è¯­å¥æ˜¯**ç”¨æ ‡è¯†ç¬¦æ ‡è¯†çš„è¯­å¥**ï¼Œå®ƒæ§åˆ¶ç¨‹åºä»gotoè¯­å¥æ‰€åœ¨çš„åœ°æ–¹è½¬ç§»åˆ°æ ‡å·è¯­å¥å¤„ã€‚\n\ngotoè¯­å¥ä¼šå¯¼è‡´ç¨‹åºç»“æ„æ··ä¹±ï¼Œå¯è¯»æ€§é™ä½ï¼Œè€Œä¸”å®ƒæ‰€å®Œæˆçš„åŠŸèƒ½å®Œå…¨å¯ä»¥ç”¨ç®—æ³•çš„ä¸‰ç§åŸºæœ¬ç»“æ„å®ç°ï¼Œå› æ­¤ä¸€èˆ¬ä¸æå€¡ä½¿ç”¨gotoè¯­å¥ã€‚\n\n```c\n#include<stdio.h>\nint main()\n{\n\tint i = 0,j = 0,k = 0;\n\tfor(i = 0;i<10;++i)\n\t{\n\t\tfor(j = 0;j<10;++j)\n\t\t{\n\t\t\tfor(k = 0;k<10;++k)\n\t\t\t{\n\t\t\t\tif(i+j+k == 10)\n\t\t\t\t{\n\t\t\t\t\tgoto input;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tinput:\n\tprintf(\" main end \\n\");\n\treturn 0;\n}\n```\n##### é€‚ç”¨åœºåˆ\n\nåœ¨æŸäº›ç‰¹å®šåœºåˆä¸‹gotoè¯­å¥å¯èƒ½ä¼šæ˜¾å‡ºä»·å€¼ï¼Œæ¯”å¦‚åœ¨å¤šå±‚å¾ªç¯åµŒå¥—ä¸­ï¼Œè¦ä»æ·±å±‚åœ°æ–¹è·³å‡ºæ‰€æœ‰å¾ªç¯ï¼Œå¦‚æœç”¨breakè¯­å¥ï¼Œä¸ä»…è¦ä½¿ç”¨å¤šæ¬¡ï¼Œè€Œä¸”å¯è¯»æ€§è¾ƒå·®ï¼Œè¿™æ—¶gotoè¯­å¥å¯ä»¥å‘æŒ¥ä½œç”¨ã€‚\n\n```c\n#include<stdio.h>\nint main()\n{\n    \n}\n```\n\n##### æ³¨æ„\n\n1. gotoæœ€å¥½åªç”¨å®ƒæ¥ä»ä¸Šåˆ°ä¸‹è·³ã€‚ä¸è¦ä»ä¸‹åˆ°ä¸Šè·³ï¼Œå› ä¸ºå¯èƒ½ä¼šäº§ç”Ÿç¨‹åºçš„äºŒä¹‰æ€§ã€‚\n2. ä¸èƒ½åœ¨å‡½æ•°é—´è·³è½¬ï¼Œä¸èƒ½è·¨è¶Šä¸¤ä¸ªå‡½æ•°ã€‚åªèƒ½åœ¨æœ¬å‡½æ•°çš„ä½œç”¨åŸŸã€å¯è§æ€§ä¸­è·³è½¬ã€‚\n##### VS2019\n#### return\n\nè¯­å¥ç”¨äºç»“æŸå‡½æ•°çš„æ‰§è¡Œï¼Œè¿”å›è°ƒç”¨è€…ï¼Œå¦‚æœæ˜¯ä¸»å‡½æ•°ï¼Œåˆ™è¿”å›è‡³æ“ä½œç³»ç»Ÿï¼ˆç»ˆæ­¢ç¨‹åºçš„æ‰§è¡Œï¼‰ã€‚\nåˆ©ç”¨ä¸€ä¸ªreturnè¯­å¥å¯ä»¥å°†ä¸€ä¸ªæ•°æ®è¿”å›ç»™è°ƒç”¨è€…ã€‚\n\nreturnæœ¬è´¨ä¸Šå°±æ˜¯gotoè¿å¸¦ä¸€ä¸ªæ•°æ®è¿”å›ã€‚ä¸gotoçš„åŒºåˆ«å°±æ˜¯gotoä¸èƒ½å¸¦ä¸€ä¸ªæ•°æ®ï¼Œreturnå¯ä»¥ã€‚\n\n##### ä¸»å‡½æ•°ä¸­çš„returnä¸å­å‡½æ•°ä¸­çš„return\n\n1. ä¸»å‡½æ•°returnåï¼Œç¨‹åºç»“æŸã€‚å­å‡½æ•°returnåªæ˜¯æœ¬å‡½æ•°ç»“æŸã€‚\n2. ä¸»å‡½æ•°çš„returnæ˜¯è¿”å›ç»™æ“ä½œç³»ç»Ÿã€‚\n\n##### returnä¸exitå‡½æ•°çš„åŒºåˆ«\n\nåœ¨ä¸»å‡½æ•°ä¸­ï¼Œ`exit(1);`ä¸`return 0;`çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚éƒ½æ˜¯ç»“æŸç¨‹åºçš„æ‰§è¡Œï¼›ä½†åœ¨å­å‡½æ•°ä¸­å°±å’Œreturnè¯­å¥ä¸ä¸€æ ·äº†ï¼Œå­å‡½æ•°ä¸­è°ƒç”¨`exit()`ä¹Ÿä¼šç›´æ¥ç»ˆæ­¢æ•´ä¸ªç¨‹åºçš„æ‰§è¡Œã€‚\n\nè°ƒç”¨exit()å‡½æ•°ä¼šç›´æ¥ç»ˆæ­¢ç¨‹åºçš„è¿›è¡Œï¼Œéœ€è¦å¼•å…¥å¤´æ–‡ä»¶`<stdlib.h>`ã€‚\n\nä¼ é€’ç»™exitå‡½æ•°çš„å®é™…å‚æ•°å’Œmainå‡½æ•°çš„è¿”å›å€¼å…·æœ‰ç›¸åŒçš„å«ä¹‰ï¼šä¸¤è€…éƒ½è¯´æ˜ç¨‹åºç»ˆæ­¢æ—¶çš„çŠ¶æ€ï¼Œä¸ºäº†è¡¨ç¤ºæ­£å¸¸\nç»ˆæ­¢ï¼Œä¼ é€’0ï¼Œå³ exit(0)ï¼›å› ä¸º0 æœ‰ç‚¹æ¨¡ç³Šï¼Œæ‰€ä»¥Cè¯­è¨€å…è®¸ç”¨`EXIT_SUCCESS`æ¥æ›¿ä»£ï¼ˆæ•ˆæœç›¸åŒï¼‰ã€‚exit(0);ç­‰åŒäº`exit(EXIT_SUCCESS)`;ï¼Œè¡¨ç¤ºç¨‹åºæ­£å¸¸é€€å‡ºï¼›exit(1);ç­‰åŒäºexit(EXIT_FAILURE);ï¼Œè¡¨ç¤ºç¨‹åºå¼‚å¸¸é€€å‡ºã€‚\n\n```c\nexit(EXIT_SUCCESS); /* normal termination */\nexit(EXIT_FAILURE); /* abnormal termination */  //ä¼ é€’EXIT_FAILUREè¡¨ç¤ºå¼‚å¸¸ç»ˆæ­¢ï¼š\nEXIT_SUCCESSå’ŒEXIT_FAILUREéƒ½æ˜¯å®šä¹‰åœ¨<stdlib.h>ä¸­çš„å®ã€‚\nEXIT_SUCCESSå’ŒEXIT_FAILUREçš„å€¼éƒ½åˆ†åˆ«æ˜¯0å’Œ1.\n```\n##### è¿”å›ç±»å‹ä¸ºvoid\n\né€šå¸¸ï¼Œå½“å‡½æ•°çš„è¿”å›ç±»å‹ä¸ºvoidæ—¶ï¼Œ returnè¯­å¥å¯ä»¥çœç•¥ï¼Œå¦‚æœä½¿ç”¨ä¹Ÿä»…ä½œä¸ºå‡½æ•°æˆ–ç¨‹åºç»“æŸçš„æ ‡å¿—ã€‚æœ‰äº›ç¼–è¯‘å™¨å¯ä»¥å†™æˆ`return void;`ï¼Œä½†åœ¨VS2019ä¸­ä¸å¯ä»¥ã€‚\n#### æ€»ç»“\n\néƒ½æ˜¯gotoçš„å˜ç§ã€‚\n\n# ç©ºè¯­å¥\n\nè¯­å¥å¯ä»¥ä¸ºç©ºï¼Œä¹Ÿå°±æ˜¯é™¤äº†æœ«å°¾å¤„çš„**åˆ†å·**ä»¥å¤–ä»€ä¹ˆç¬¦å·ä¹Ÿæ²¡æœ‰ã€‚\n\n## æ‰€å¸¦æ¥çš„é—®é¢˜\n\n### åœ†æ‹¬å·åæ”¾ç½®ç©ºè¯­å¥\n\nä¸å°å¿ƒåœ¨ifã€while æˆ– for è¯­å¥çš„åœ†æ‹¬å·åæ”¾ç½®åˆ†å·ä¼šåˆ›å»ºç©ºè¯­å¥ï¼Œä»è€Œé€ æˆifã€ while æˆ– for è¯­å¥æå‰ç»“æŸã€‚if è¯­å¥ä¸­ï¼Œå¦‚æœåœ¨åœ†æ‹¬å·åæ”¾ç½®åˆ†å·ï¼Œæ— è®ºæ¡ä»¶è¡¨è¾¾çš„å€¼æ˜¯ä»€ä¹ˆï¼Œif è¯­å¥æ‰§è¡Œçš„åŠ¨ä½œéƒ½ä¸€æ ·ï¼Œéƒ½ä¼šæ‰§è¡Œifå—å†…çš„ä»£ç ï¼š\n\n#### ifè¯­å¥\n\n```c\nif(d == 0)  ;\n{\n    printf(\"Error: Division by zero \\n\");\n}\n```\n\n#### whileè¯­å¥\n\nwhile è¯­å¥ä¸­ï¼Œå¦‚æœåœ¨åœ†æ‹¬å·åæ”¾ç½®åˆ†å·ï¼Œä¼šäº§ç”Ÿæ— é™å¾ªç¯ï¼š\n\n```c\ni = 10;\nwhile(i>0) ;\n{\n\tprintf(\"%d \",i);\n\t--i;\n}\n```\n\nå¦ä¸€ç§å¯èƒ½æ˜¯å¾ªç¯ç»ˆæ­¢ï¼Œä½†æ˜¯åœ¨å¾ªç¯ç»ˆæ­¢ååªæ‰§è¡Œä¸€æ¬¡å¾ªç¯ä½“è¯­å¥ï¼š\n\n```c\ni = 10;\nwhile(--i>0) ;\n{\n\tprintf(\"%d \",i);\n}\n```\n\n#### forè¯­å¥\n\nfor è¯­å¥ä¸­ï¼Œå¦‚æœåœ¨åœ†æ‹¬å·åæ”¾ç½®åˆ†å·ï¼Œä¼šå¯¼è‡´åªæ‰§è¡Œä¸€æ¬¡å¾ªç¯ä½“è¯­å¥ï¼š\n\n```c\nfor(i = 10; i > 0 ; --i) ;\n{\n    printf(\"value: %d \",i);\n}\n```\n\n## è¦æ³¨æ„çš„åœ°æ–¹\n\n### è¯¥æ­»çš„åˆ†å·;\n\n#### å‡½æ•°åçš„åˆ†å·\n\n##### å‡½æ•°å£°æ˜è¯­å¥\n\nå‡½æ•°å£°æ˜æ—¶åŠ åˆ†å·ã€‚\n\n##### å‡½æ•°å®šä¹‰è¯­å¥\n\nåœ¨å¤§æ‹¬å·ååŠ äº†åˆ†å·ä¹Ÿæ²¡äº‹ï¼Œå› ä¸ºè¿™æ˜¯ç©ºè¯­å¥ï¼Œæ— å¤§ç¢ã€‚\n![image-20210716114054328](../../images/Cè¯­è¨€_åˆ†æ”¯è¯­å¥ã€å¾ªç¯è¯­å¥ã€å‡½æ•°åˆæ­¥/image-20210716114054328.png)\n##### ç»“æ„ä½“å®šä¹‰è¯­å¥\n\nç»“æ„ä½“å®šä¹‰ç»“æŸæ—¶ï¼Œåœ¨å¤§æ‹¬å·åå¿…é¡»åŠ åˆ†å·ã€‚è¡¨ç¤ºç»“æŸã€‚\n![image-20210716114227011](../../images/Cè¯­è¨€_åˆ†æ”¯è¯­å¥ã€å¾ªç¯è¯­å¥ã€å‡½æ•°åˆæ­¥/image-20210716114227011.png)\n# é€—å·è¡¨è¾¾å¼\n\né€—å·è¡¨è¾¾å¼åªèƒ½å†™ç±»å‹ä¸€è‡´çš„å£°æ˜ï¼Œ`int i = 0, float = 2.0`æ˜¯ä¸å¯¹çš„ã€‚\n\n```c\n#include<stdio.h>\nint main()\n{\n    int a=10,b=20,c-30;\n    int x=0;\n    //ä¸‹é¢ä¸¤å¥çœ‹ä¼¼è¯´æ˜é€—å·è¿ç®—ç¬¦å’Œåˆ†å·æ²¡ä»€ä¹ˆåŒºåˆ«\n    x=a,a=b,c+=10;\n    x=a;a=b;c+=10;\n    //ä½†æ˜¯ï¼Œå¦‚ä¸‹ä¸¤å¥å°±èƒ½ä½“ç°å‡ºäº†é€—å·è¿ç®—ç¬¦çš„æ–¹ä¾¿\n    x = (a+10, a=b, c += 10);//ç¼–è¯‘é€šè¿‡\n    x = (a+10; a=b; c += 10);//ç¨‹åºç¼–è¯‘ä¸é€šè¿‡ï¼Œå› ä¸ºåˆ†å·ä¸å¯è¢«åŒ…åœ¨æ‹¬å·é‡Œã€‚\n}\n```\n\nä¸Šä¾‹ä¸­ï¼Œ`x = (a+10, a=b, c += 10);`è¿™å¥è¡¨è¾¾å¼å¦‚ä½•è¿ç®—å‘¢ï¼Ÿé¦–å…ˆæ‰§è¡Œ`a+10`ï¼Œä½†açš„å€¼ä¸å˜ï¼›å†æ‰§è¡Œ`a=b`ï¼Œå°†bçš„å€¼èµ‹ç»™ï¼Œaçš„å€¼å˜æˆ20ï¼›å†è®©`c+=10`ï¼Œcçš„å€¼å˜ä¸º40ã€‚é‚£ä¹ˆxçš„å€¼ä¼šè¢«èµ‹ä¸ºå¤šå°‘å‘¢ï¼Ÿç­”æ¡ˆæ˜¯40ï¼Œå› ä¸ºé€—å·è¡¨è¾¾å¼çš„å€¼æ˜¯å–æœ€åä¸€æ¡è¡¨è¾¾å¼çš„å€¼ã€‚\n\næŒ‰ç…§é€—å·è¡¨è¾¾å¼çš„è¿è¡Œæœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¼˜åŒ–ä¸€ä¸ªäº‹æƒ…ï¼Œå°±æ˜¯ä¸‹é¢è®²åˆ°çš„scanfçš„ä»£ç ä½ç½®ã€‚\n## `scanf_s`å‡½æ•°çš„æœºåˆ¶\n\n```c\n#include<stdio.h>\nint main()\n{\n    int n=0,m=0;\n    printf(\"Enter integers (0 to erminate)\\n\");\n    scanf_s(\"%d\",&n);\n    while(n!=0)\n    {\n        sum = sum + n;\n        scanf_s(\"%d\",&n);\n    }\n    printf(\"sum %d \\n\",sum);\n    return 0;\n}\n```\n\nstdinæ ‡å‡†è¾“å…¥æ–‡ä»¶æµ\nstdoutæ ‡å‡†è¾“å‡ºæ–‡ä»¶æµ\nstderré”™è¯¯æµ\n\næ ‡å‡†è¾“å…¥/è¾“å…¥æ–‡ä»¶æµä»–ä»¬éƒ½å¸¦æœ‰ç¼“å†²åŒºã€‚stdinä»é”®ç›˜ä¸Šè¾“å…¥æ•°æ®çš„æ—¶å€™ï¼Œå°±å…ˆæŠŠæ•°æ®æ”¾åˆ°æ ‡å‡†è¾“å…¥æ–‡ä»¶æµçš„ç¼“å†²åŒºä¸­äº†ã€‚stdinè¿˜æœ‰ä¸€ä¸ªèƒ½åŠ›ï¼Œä¼šæŠŠç¼“å†²åŒºä¸­çš„å†…å®¹å›æ˜¾åœ¨å±å¹•ä¸Šã€‚å¦‚æœæ²¡æœ‰å›è½¦ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºè¿™ä¸ªè¾“å…¥æ²¡æœ‰ç»“æŸã€‚å¦‚æœæ‰“äº†å›è½¦ï¼Œå°±ç›¸å½“äºé€šçŸ¥scanfä»ç¼“å†²åŒºä¸­å–å€¼ã€‚å¯ä»¥æ¯è¾“å…¥ä¸€ä¸ªæ•°æ®å›è½¦ä¸€æ¬¡åscanfè¯»å–æ­¤æ•°ï¼Œæ¥ä¸‹æ¥è¾“å…¥åé¢çš„æ•°æ®å¹¶å›è½¦æ—¶ï¼Œå°±ä¼šæŠŠå‰é¢çš„ç¼“å†²åŒºè¦†ç›–æ‰ï¼›ä¹Ÿå¯ä»¥ä½¿å¤šä¸ªæ•°æ®ç©ºæ ¼éš”å¼€å…¨è¾“å…¥å®Œï¼Œå†ä¸€æ¬¡æ€§å›è½¦ï¼Œäº¤ç»™scanfä¾æ¬¡è¯»å–ã€‚ä¸¤ç§æ–¹å¼æœ€å¤§çš„ä¸åŒå°±åœ¨äºç¼“å†²åŒºå­˜å‚¨çš„æ•°æ®ä¸ä¸€æ ·å¤šã€‚\n\nè¿™ç§è¾“å…¥çš„å½¢å¼ï¼Œæœ‰ä¸ªä¸å¥½çš„åœ°æ–¹ï¼Œå°±æ˜¯whileå¤–ä¸€ä¸ªscanfï¼Œwhileå†…æœ‰ä¸ªscanfã€‚æ€ä¹ˆæ ·ä½¿ä¹‹æ›´ä¸ºç®€æ´å‘¢ï¼Ÿå°±ç”¨åˆ°äº†é€—å·è¡¨è¾¾å¼ã€‚\n\n```c\n#include<stdio.h>\nint main()\n{\n    int n=0,sum=0;\n    printf(\"Enter integers (0 to terminate)\\n\");\n    while(scanf_s(\"%d\",&n),n!=0)\n    {\n        sum = sum + n;\n    }\n    printf(\"sum %d \\n\",sum);\n    return 0;\n}\n```\n\nwhileæœ€ç»ˆè¦åˆ¤æ–­çš„æ˜¯é€—å·è¡¨è¾¾å¼æœ€åçš„ä¸€ä¸ªè¡¨è¾¾å¼å³`n!=0`ã€‚æ‰€ä»¥è¿™æ ·åšä¸ä½†ä¸å½±å“whileçš„æ­£ç¡®åˆ¤æ–­è¿˜ç®€åŒ–äº†ä»£ç ç¼–å†™ã€‚\n# 0715ä½œä¸š\n\n1. ä¸¤ä¸ªforå¾ªç¯ï¼ˆäºŒç»´æ•°ç»„ï¼‰æ‰“å°ä¸€ä¸ªä¹˜æ³•å£è¯€è¡¨ã€‚\n```c\n#include<stdio.h>\nvoid MultiTable(int n)\n{\n    for(int i=1;i<=n;++i)\n    {\n        for(int j=1;j<=i;++j)\n        {\n            printf(\"%d*%d=%d \",j,i,i*j);\n        }\n        printf(\"\\n\");\n    }\n}\nint main()\n{\n    int n = 0;\n    scanf_s(\"%d\",&n);\n    MultiTable(n);\n}\n```\n2. ä»”ç»†è§‚å¯Ÿå¦‚ä½•æŠŠä¸€ç»´æ•°ç»„è½¬åŒ–è¾“å‡ºä¸ºä¸€ä¸ªäºŒç»´å¹³é¢ï¼Ÿ-->ä¸ºNååšå‡†å¤‡\n![image-20210715163945136](../../images/Cè¯­è¨€_åˆ†æ”¯è¯­å¥ã€å¾ªç¯è¯­å¥ã€å‡½æ•°åˆæ­¥/image-20210715163945136.png)\n3. é€‰åšé¢˜ï¼šä»”ç»†è§‚å¯Ÿï¼Œn=5ï¼Œä»è¾“å‡ºçš„è§’åº¦å¦‚ä½•æ‰“å°æˆè¿™æ ·çš„æ•ˆæœï¼š\n![image-20210716012622369](../../images/Cè¯­è¨€_åˆ†æ”¯è¯­å¥ã€å¾ªç¯è¯­å¥ã€å‡½æ•°åˆæ­¥/image-20210716012622369.png)\n   ï¼ˆæç¤ºï¼šç¬¬ä¸€è¡Œæ¯ä¸ªæ•°åªæœ‰1ä½ï¼Œæ¯ä¸€è¡Œéƒ½æ¯”ä¸Šä¸€è¡Œå°‘ä¸€ä¸ªæ•°ï¼‰\n   å¦‚æœæ˜¯æ•´å‹æ•°\n   å¦‚æœæ˜¯å­—ç¬¦æ•°ç»„ï¼šæ»‘åŠ¨åŠ¨æ€çª—å£æ–¹å¼ã€‚\n4. è¾“å…¥ä»»æ„é¡ºåºçš„ä¸‰ä½æ•°ï¼Œéƒ½èƒ½æ­£ç¡®æ‰¾åˆ°å…¶ä¸­é—´å¤§å°çš„æ•°ã€‚\n\n```c\n#include<stdio.h>\nint MaxInt(int x,int y)\n{\n    return x > y ? x : y;\n}\n//é”™è¯¯å†™æ³•\nint MidInt(int a,int b,int c)\n{\n    a = a > b ? a : b;\n    return a < c ? a : c;\n}\n//é€»è¾‘æ³•\nint MidInt(int a, int b, int c)\n{\n    if(a>=b&&a<=c)\n    {\n        return a;\n    }\n    else if(b>=a&&b<=c)\n    {\n        return b;\n    }\n    else\n    {\n        return c;\n    }\n}\n//å…ˆå†’æ³¡æ’åºï¼Œåè¾“å‡ºb\nint MidInt(int a, int b, int c)\n{\n    if(a>b){Swap_Int(&a,&b);}\n    if(b>c){Swap_Int(&b,&c);}\n    if(a>b){Swap_Int(&a,&b);}\n    return b;\n}\n//1 2 3=>2\n//1 3 2=>2\n//2 3 1=>2\n//2 1 3=>2\n//3 1 2=>2\n//3 2 1=>2\nint main()\n{\n    int a,b,c;\n    int max=0,mid=0;\n    scanf_s(\"%d %d %d\",&a,&b,&c);\n    max = MaxInt(a,MaxInt(b,c));\n    mid = MidInt(a,b,c);\n    printf(\"max=%d,mid=%d\",max,mid);\n    return 0;\n}\n```\n5. ä¸‹å»æŸ¥è¯¢VSå¦‚ä½•è®¾ç½®æ ˆçš„å¤§å°å’Œæ ˆå¸§çš„å¤§å°\n![image-20210716013306466](../../images/C%E8%AF%AD%E8%A8%80_%E5%88%86%E6%94%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%87%BD%E6%95%B0%E5%88%9D%E6%AD%A5/image-20210716013306466.png)\n\n![image-20210716013335862](../../images/C%E8%AF%AD%E8%A8%80_%E5%88%86%E6%94%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%87%BD%E6%95%B0%E5%88%9D%E6%AD%A5/image-20210716013335862.png)\n6. ä¸‹å»æŸ¥ï¼šæ¯ä¸€ä¸ªå·¥ç¨‹çš„å…¥å£å‡½æ•°é»˜è®¤æ˜¯ä¸»å‡½æ•°ï¼Œæ€ä¹ˆè®¾ç½®å…¶ä»–å‡½æ•°ä¸ºå…¥å£ï¼Ÿ\n![image-20210716013306466](../../images/C%E8%AF%AD%E8%A8%80_%E5%88%86%E6%94%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%87%BD%E6%95%B0%E5%88%9D%E6%AD%A5/image-20210716013306466.png)\n![image-20210716015329536](../../images/C%E8%AF%AD%E8%A8%80_%E5%88%86%E6%94%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%87%BD%E6%95%B0%E5%88%9D%E6%AD%A5/image-20210716015329536.png)\n7. æŸ¥ï¼šç›´æ¥è®¿é—®ã€é—´æ¥è®¿é—®ã€‚è®²å¾®æœºåŸç†çš„ä¹¦éƒ½æœ‰è®²è§£ã€‚\n   `mov eax,10;`\n   `mov ebx,0x00b3f9f0;`\n   `mov [ebx],100h;`\n8. è¢«è°ƒç”¨å‡½æ•°returnä¸€ä¸ªæ•°ç»™ä¸»å‡½æ•°ä¸­çš„ä¸€ä¸ªå˜é‡æ—¶ï¼Œè‚¯å®šä¸èƒ½ç›´æ¥èµ‹å€¼ï¼Œè€Œæ˜¯ç”¨ä¸´æ—¶ç©ºé—´å…ˆå­˜æ”¾ï¼Œå†å–å‡ºé€ç»™è¿™ä¸ªå˜é‡ã€‚è¿™ä¸ªä¸´æ—¶ç©ºé—´è°æ¥æ‹…å½“ï¼Ÿ\n9. EAXæƒ¯ç”¨äºâ€œç´¯åŠ å™¨â€(accumulator)ï¼Œå®ƒæ˜¯å¾ˆå¤šåŠ æ³•ä¹˜æ³•æŒ‡ä»¤çš„ç¼ºçœå¯„å­˜å™¨ï¼›è¿˜ç”¨æ¥å­˜æ”¾å‡½æ•°è¿”å›å€¼ï¼›å ç”¨32ä¸ª2è¿›åˆ¶ä½ï¼Œ4ä¸ªå­—èŠ‚ã€‚eaxçš„å16ä½ä¸ºaxï¼Œå16ä½ä¸­ï¼Œå‰8ä½ä¸ºahï¼Œå8ä½ä¸ºalï¼Œå‰16ä½çš„è®¿é—®éœ€è¦å³ç§»ã€‚æœ‰æ—¶EAXä¹Ÿç”¨äºç¨‹åºæ•°æ®çš„è¿”å›å€¼ã€‚\n    1. EBXæƒ¯ç”¨äºâ€œåŸºåœ°å€â€(base)å¯„å­˜å™¨ï¼Œåœ¨å†…å­˜å¯»å€æ—¶å­˜æ”¾åŸºåœ°å€ã€‚å¤šä¸æŒ‡é’ˆç›¸å…³ã€‚\n    2. ECXæƒ¯ç”¨äºâ€œè®¡æ•°å™¨â€(counter)ï¼Œæ˜¯é‡å¤(REP)å‰ç¼€æŒ‡ä»¤å’ŒLOOPæŒ‡ä»¤çš„å†…å®šè®¡æ•°å™¨ã€‚ç”¨äºå¾ªç¯çš„è®¡æ•°ã€‚\n    3. EDXï¼šI/Oè®¾å¤‡çš„åœ°å€ç¼–å·å¤§äº255æ—¶ï¼Œå­˜æ”¾è®¾å¤‡çš„ç«¯å£å·ã€‚\n    4. åœ¨è¿›è¡Œä¹˜é™¤æ³•è¿ç®—æ—¶ï¼ŒEAXç”¨æ¥å­˜å•†ï¼ŒEDXç”¨æ¥å­˜ä½™æ•°ã€‚\n    5. ä¸´æ—¶é‡å…·æœ‰å¸¸æ€§ï¼Œåªè¯»ä¸å¯å†™ï¼ŒAdd(x,y)=100;æ˜¯ä¸å¯è¡Œçš„ï¼Œæ˜¯ä¸èƒ½ç»™å‡½æ•°çš„è¿”å›å€¼èµ‹å€¼çš„ã€‚\n# 0716ä½œä¸š\n\n1. æŸ¥ï¼šå¦‚ä½•äº§ç”Ÿéšæœºå€¼\n   https://blog.csdn.net/w_y_x_y/article/details/80199694\n```c\nè¿™é‡Œå¯¹ç¨‹åºä¸­ç”¨åˆ°çš„äº§ç”Ÿéšæœºæ•°çš„å‡½æ•°è¿›è¡Œè§£é‡Šã€‚\n1ã€srandï¼ˆï¼‰å‡½æ•°ï¼šéšæœºæ•°å‘ç”Ÿå™¨çš„åˆå§‹åŒ–å‡½æ•°ï¼Œéœ€è¦æä¾›ä¸€ä¸ªç§å­ï¼Œè¿™ä¸ªç§å­ä¼šå¯¹åº”ä¸€ä¸ªéšæœºæ•°ã€‚å¦‚æœä½¿ç”¨ç›¸åŒçš„ç§å­,rand() å‡½æ•°ä¼šå‡ºç°ä¸€æ ·çš„éšæœºæ•°ã€‚é»˜è®¤ç§å­æ•°æ˜¯1ï¼Œå³srand(1)ã€‚\n2ã€randï¼ˆï¼‰å‡½æ•°ï¼šä¼ªéšæœºæ•°å‘ç”Ÿå™¨ï¼Œéœ€è¦å…ˆè°ƒç”¨srandåˆå§‹åŒ–ï¼Œä¸€èˆ¬ç”¨å½“å‰æ—¥å†æ—¶é—´åˆå§‹åŒ–éšæœºæ•°ç§å­ï¼Œè¿™æ ·æ¯è¡Œä»£ç éƒ½å¯ä»¥äº§ç”Ÿä¸åŒçš„éšæœºæ•°ã€‚\n3ã€éšæœºæ•°äº§ç”Ÿçš„åŸç†ï¼šéšæœºæ•°ä¸­çš„å˜é‡ç§å­randåˆå§‹ä¼šèµ‹å€¼ç»™holdrandï¼Œç„¶åholdrandå’Œä¸€ä¸ªå…¬å¼è®¡ç®—å‡ºæ–°çš„éšæœºæ•°å¹¶èµ‹å€¼ç»™holdrandå†è¿”å›ï¼Œå¾ªç¯äº§ç”Ÿéšæœºæ•°ï¼Œæ¯æ¬¡å¾—åˆ°çš„ç»“æœåªä¸ä¸Šæ¬¡éšæœºæ•°çš„å€¼æœ‰å…³ï¼Œå¦‚æœæƒ³è¦æ¯æ¬¡ç”Ÿæˆçš„æ–°éšæœºæ•°å’Œä¸Šæ¬¡éšæœºæ•°æ²¡æœ‰å…³è”ï¼Œå¯ä»¥é€šè¿‡æ¯æ¬¡åˆ©ç”¨(srand((unsigned)time(0)))æ”¹å˜ç§å­è¿›è€Œåˆå§‹åŒ–holdrandå¾—åˆ°éšæœºæ•°ã€‚\n```\n2. åšä¸€ä¸ªç®€å•çš„è®¡ç®—å™¨ï¼Œå¼„ä¸€ä¸ª.hå’Œ.cppæ–‡ä»¶\n![image-20210716150924442](../../images/C%E8%AF%AD%E8%A8%80_%E5%88%86%E6%94%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5%E3%80%81%E5%87%BD%E6%95%B0%E5%88%9D%E6%AD%A5/image-20210716150924442.png)\n\n```c\n#ifndef\n#è¡¨æ˜æ˜¯é¢„å¤„ç†å‘½ä»¤\nifndefæ„ä¸ºif not defined sth.\nå®ƒä¸ifdeféƒ½å¯ç”¨äºæ¡ä»¶ç¼–è¯‘\nå³\n#ifdef æ ‡è¯†ç¬¦A\nç¨‹åºæ®µ1\n#else\nç¨‹åºæ®µ2\n#endif\næ„ä¸ºè‹¥æ‰€æŒ‡å®šçš„æ ‡è¯†ç¬¦Aå·²ç»è¢«#defineå‘½ä»¤å®šä¹‰è¿‡åˆ™ç¼–è¯‘ç¨‹åºæ®µ1ï¼Œå¦åˆ™ç¼–è¯‘ç¨‹åºæ®µ2\n\nåŒç†\n#ifndef æ ‡è¯†ç¬¦B\nç¨‹åºæ®µ1\n#else\nç¨‹åºæ®µ2\n#endif\næ„ä¸ºè‹¥æ‰€æŒ‡å®šçš„æ ‡è¯†ç¬¦Bæœªè¢«#defineå‘½ä»¤å®šä¹‰è¿‡åˆ™ç¼–è¯‘ç¨‹åºæ®µ1ï¼Œå¦åˆ™ç¼–è¯‘ç¨‹åºæ®µ2\n```\n","categories":["C"]},{"title":"Cè¯­è¨€_æ¦‚è§ˆ","url":"/C/Cè¯­è¨€_æ¦‚è§ˆ/","content":"# å‰è¨€åŠè¯­å½•\n\n1. Cè¯­è¨€çš„æœ€æ ¹æœ¬çš„ä¸€ä¸ªç‰¹ç‚¹ï¼šä¸€å®šè¦ä¼šä¸Šæœºç¼–ç¨‹ã€‚è¿™æ˜¯å®—æ—¨ã€‚ä¸ç®¡å­¦çš„æ€ä¹ˆæ ·ï¼Œç¨‹åºè¦ä¼šç¼–ã€‚ç¨‹åºä¸ä¼šç¼–çš„è¯ï¼Œè®°é‚£ä¹ˆå¤šè§„åˆ™ä¹Ÿæ˜¯æ²¡æœ‰ç”¨çš„ã€‚å³Cè¯­è¨€çš„ç¼–ç¨‹æ˜¯ç¬¬ä¸€ä½çš„è¦æ±‚ã€‚\n2. [Cè¯­è¨€å®˜ç½‘](http://www.cplusplus.com) ï¼›[C++å‚è€ƒæ‰‹å†Œ](https://zh.cppreference.com/w)ï¼šä¸ä¼šäº†å°±å¯ä»¥åœ¨è¿™é‡Œé¢æŸ¥ï¼\n3. æ³¨å†Œåšå®¢ï¼Œè¦æ±‚æ˜¯ï¼šæŠŠå­¦ä¹ å†…å®¹æŒ‰ç…§æˆ‘ä»¬çš„ç†è§£å†™å‡ºæ¥ï¼Œæ€»ç»“è‡ªå·±å­¦åˆ°çš„å†…å®¹ã€‚åšå®¢çš„å¥½å¤„å°±æ˜¯é¿å…é—å¿˜ã€‚å¯ä»¥ç¿»å‡ºæ¥æ¸…æ¥šè‡ªå·±å­¦åˆ°äº†å“ªäº›ï¼ŒåŒæ—¶èƒ½éšæ—¶è¡¥å……ã€‚\n4. åˆ·é¢˜ç½‘ç«™ï¼šç‰›å®¢ç½‘ã€åŠ›æ‰£ç½‘ã€‚å­¦å®Œæ•°ç»„ã€æŒ‡é’ˆã€ç»“æ„ä½“åå³å¯ä¸Šæ­¤å¹³å°åˆ·é¢˜ã€‚ç»å¤§éƒ¨åˆ†çš„é¢˜éƒ½æ˜¯è¦æˆ‘ä»¬è‡ªå·±å»åˆ·çš„ã€‚\n5. çœ‹çš„ç¬¬ä¸€æœ¬Cè¯­è¨€ä¹¦ç±ï¼šã€Šé«˜è´¨é‡ç¨‹åºè®¾è®¡æŒ‡å—â€”â€”`C++/C`è¯­è¨€ã€‹ã€‚å…ˆçœ‹åˆ°56é¡µï¼Œç­‰å­¦åˆ°`C++`å†å¾€åçœ‹ã€‚\n\nCè¯­è¨€æ¦‚è¿°éƒ¨åˆ†å†…å®¹ç®€å•åœ°æŠŠåŸºç¡€çŸ¥è¯†ã€åŸºæœ¬çš„è¯­æ³•ã€æŒ‡é’ˆã€ç»“æ„ä½“ä»‹ç»ã€‚æœ‰çš„è¯¦å°½ï¼Œæœ‰çš„ä¸å¤ªè¯¦å°½ã€‚åæœŸåˆ†ä¸“é¢˜åˆ†æé‡è¦çš„å†…å®¹ã€‚\n# è®¡ç®—æœºåŸºç¡€çŸ¥è¯†\n## è½¯ä»¶çš„æ¦‚å¿µ\n\nä¸€ç³»åˆ—æŒ‰ç…§ç‰¹çš„é‚£ä¸ªé¡ºåºç»„ç»‡çš„è®¡ç®—æœº**æ•°æ®**å’Œ**æŒ‡ä»¤**çš„é›†åˆã€‚ç®€å•åœ°è¯´ï¼Œè½¯ä»¶å°±æ˜¯ç¨‹åºåŠ æ–‡æ¡£çš„é›†åˆã€‚\nè½¯ä»¶ä¸€èˆ¬è¢«åˆ’åˆ†ä¸ºç³»ç»Ÿè½¯ä»¶ï¼ˆå¦‚å®‰å“æ“ä½œç³»ç»Ÿï¼‰ã€åº”ç”¨è½¯ä»¶ï¼ˆå¦‚Wordã€ç¼–è¯‘å™¨ï¼‰å’Œä»‹äºè¿™ä¸¤è€…ä¹‹é—´çš„ä¸­é—´ä»¶ï¼ˆå¦‚Redisï¼‰ã€‚\n## æ–‡ä»¶\n\næ–‡ä»¶ç”±ä¸¤éƒ¨åˆ†æ„æˆï¼šæ–‡ä»¶åå’Œæ–‡ä»¶ä¸»ä½“ã€‚\næ–‡ä»¶çš„ä¸€ç§åˆ†ç±»æ˜¯ï¼šå¯æ‰§è¡Œæ–‡ä»¶å’Œä¸å¯æ‰§è¡Œæ–‡ä»¶ã€‚\n### å¯æ‰§è¡Œæ–‡ä»¶\n1. åœ¨Windowsæ“ä½œç³»ç»Ÿä¸­ï¼Œæ‰©å±•åä¸ºï¼š`*.exe`, `*.bat`, `*.com`ç­‰çš„æ–‡ä»¶æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ï¼›\n2. å¯æ‰§è¡Œæ–‡ä»¶ç”±æŒ‡ä»¤å’Œæ•°æ®æ„æˆã€‚\n3. Linuxæ˜¯é æ–‡ä»¶å±æ€§æ¥åˆ¤æ–­æ˜¯å¦å¯æ‰§è¡Œã€‚\n### ä¸å¯æ‰§è¡Œæ–‡ä»¶\nå…¶å†…å®¹æ˜¯ç”±æ•°æ®æ„æˆã€‚\n### ä¸¾ä¾‹\n\nåœ¨`C/C++`è¯­è¨€ä¸­ï¼Œ`*.c`/`*.cpp`æºæ–‡ä»¶ï¼ˆæ–‡æœ¬--`ASCII`ç å­—ç¬¦æ„æˆçš„ï¼‰ï¼Œ`*.h`å¤´æ–‡ä»¶ï¼ˆæ–‡æœ¬ï¼‰ï¼Œ`*.i`é¢„ç¼–è¯‘æ–‡ä»¶ï¼ˆæ–‡æœ¬ï¼‰ï¼Œ`*.s`æ±‡ç¼–æ–‡ä»¶ï¼Œ`*.o/*.obj`äºŒè¿›åˆ¶ç›®æ ‡æ–‡ä»¶ï¼Œ`*.exe`å¯æ‰§è¡Œæ–‡ä»¶ã€‚\n\n![image-20210712155031576](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210712155031576.png)\n\nåœ¨IDEä¸­ç¼–è¯‘é“¾æ¥åï¼Œå·¥ç¨‹ç›®å½•ä¸‹çš„`Debug`ä¸­å½¢æˆäº†`obj`æ–‡ä»¶å’Œ`exe`æ–‡ä»¶ã€‚\nè¾¾åˆ°å¯æ‰§è¡Œçš„åº•å±‚æ­¥éª¤ï¼šé¢„ç¼–è¯‘ã€ç¼–è¯‘ã€é“¾æ¥ã€‚\n>å®é™…ä¸Šåœ¨ç¼–è¯‘å’Œé“¾æ¥ä¹‹é—´è¿˜æœ‰æ±‡ç¼–è¿™ä¸ªæ­¥éª¤\n## è¿›åˆ¶åŠå…¶è½¬æ¢\n\n![image-20210712180942700](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210712180942700.png)\næˆ‘ä»¬å­¦ä¹ è®¡ç®—æœºæ—¶ï¼Œå¦‚åœ¨è°ƒè¯•çš„æ—¶å€™æˆ‘ä»¬çœ‹åˆ°çš„åº•å±‚æ˜¯ä»¥16è¿›åˆ¶è¡¨è¾¾çš„ã€‚æˆ‘ä»¬è¦ç†è§£è¿›åˆ¶ã€‚\nè¿›åˆ¶ä¹Ÿå°±æ˜¯è¿›ä½è®¡æ•°åˆ¶ï¼Œæ˜¯äººä¸ºå®šä¹‰çš„å¸¦è¿›ä½çš„è®¡æ•°æ–¹æ³•ã€‚ å¯¹äºä»»ä½•ä¸€ç§è¿›åˆ¶--`Xè¿›åˆ¶`ï¼Œå°±è¡¨ç¤ºæ¯ä¸€ä½ç½®ä¸Šçš„æ•°è¿ç®—æ—¶éƒ½æ˜¯é€¢`X`è¿›ä¸€ä½ã€‚ å¦‚ï¼šåè¿›åˆ¶æ˜¯é€¢åè¿›ä¸€ï¼Œåå…­è¿›åˆ¶æ˜¯é€¢åå…­è¿›ä¸€ï¼ŒäºŒè¿›åˆ¶å°±æ˜¯é€¢äºŒè¿›ä¸€ï¼Œä»¥æ­¤ç±»æ¨ï¼Œ`x`è¿›åˆ¶å°±æ˜¯é€¢`x`è¿›ä½ã€‚æˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»ä¸­çš„è¿›åˆ¶éƒ½å“ªäº›ï¼Ÿ\nè®¡ç®—æœºä¸­çš„è¿›åˆ¶åˆ†ä¸ºäºŒè¿›åˆ¶ï¼Œå…«è¿›åˆ¶ï¼Œåè¿›åˆ¶ï¼Œåå…­è¿›åˆ¶ã€‚\näºŒè¿›åˆ¶æ•°ã€å…«è¿›åˆ¶æ•°ã€åå…­è¿›åˆ¶æ•°è½¬æ¢ä¸ºåè¿›åˆ¶æ•°çš„è§„å¾‹æ˜¯ç›¸åŒçš„ã€‚æŠŠäºŒè¿›åˆ¶æ•°ï¼ˆå…«è¿›åˆ¶æˆ–åå…­è¿›åˆ¶æ•°ï¼‰æŒ‰ä½æƒå½¢å¼å±•å¼€å¤šé¡¹å¼å’Œçš„å½¢å¼ï¼Œæ±‚å…¶æœ€åçš„å’Œï¼Œå°±æ˜¯å…¶å¯¹åº”çš„åè¿›åˆ¶æ•°â€”â€”ç®€ç§°â€œæŒ‰æƒæ±‚å’Œâ€ã€‚å¦‚ï¼š\n`(10100)2`â”`(1 * 2^4 + 0*2^3 + 1 * 2^2 + 0*2^1 + 0*2^0)10`â”`(20)10`\n\n`(245)8`â”`(2 * 8^2 + 4 * 8^1 + 5 * 8^0)10`â”`(165)10`\n\n`(1F2)16`â”`(1 * 16^2 + 15 * 16^1 + 2 * 16^0)10`â”`(498)10`\n\n> ç»ƒä¹ ï¼š`(103)10`â”`(    )2â”(    )8`â”`(    )16`\n\n# Cè¯­è¨€ç®€ä»‹\n\nCè¯­è¨€æ˜¯ä¸€ç§ç»“æ„åŒ–è¯­è¨€ï¼Œå®ƒæœ‰ç€æ¸…æ™°çš„å±‚æ¬¡ï¼Œå¯æŒ‰ç…§æ¨¡å—çš„æ–¹å¼å¯¹ç¨‹åºè¿›è¡Œç¼–å†™ï¼Œååˆ†æœ‰åˆ©äºç¨‹åºçš„è°ƒè¯•ï¼Œä¸”Cè¯­è¨€çš„å¤„ç†å’Œè¡¨ç°èƒ½åŠ›éƒ½éå¸¸çš„å¼ºå¤§ï¼Œä¾é éå¸¸å…¨é¢çš„è¿ç®—ç¬¦å’Œå¤šæ ·çš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥è½»æ˜“å®Œæˆå„ç§æ•°æ®ç»“æ„çš„æ„å»ºï¼Œé€šè¿‡æŒ‡é’ˆç±»å‹æ›´å¯å¯¹å†…å­˜ç›´æ¥å¯»å€ä»¥åŠå¯¹ç¡¬ä»¶è¿›è¡Œç›´æ¥æ“ä½œï¼Œå› æ­¤æ—¢èƒ½å¤Ÿç”¨äºå¼€å‘ç³»ç»Ÿç¨‹åºï¼Œä¹Ÿå¯ç”¨äºå¼€å‘åº”ç”¨è½¯ä»¶ã€‚\n1982å¹´æˆç«‹Cæ ‡å‡†å§”å‘˜ä¼šï¼Œå»ºç«‹Cè¯­è¨€çš„æ ‡å‡†ã€‚\n1989å¹´ï¼ŒANSIå‘å¸ƒäº†ç¬¬ä¸€ä¸ªå®Œæ•´çš„Cè¯­è¨€æ ‡å‡†â€”â€”`ANSIX3.159â€”1989`ï¼Œç®€ç§°â€œC89â€ã€‚\n1999å¹´ï¼Œåœ¨åšäº†ä¸€äº›å¿…è¦çš„ä¿®æ­£å’Œå®Œå–„åï¼ŒISO (International Standards Organization)ï¼Œå‘å¸ƒäº†æ–°çš„Cè¯­è¨€æ ‡å‡†ï¼Œå‘½åä¸º`ISO/IEC 9899: 1999`ï¼Œç®€ç§°â€œC99â€ã€‚\nåœ¨2011å¹´12æœˆ8æ—¥ï¼ŒISOåˆæ­£å¼å‘å¸ƒäº†æ–°çš„æ ‡å‡†ï¼Œç§°ä¸º`ISO/IEC9899: 2011`ï¼Œç®€ç§°ä¸ºâ€œC11â€ã€‚ \n## ç¬¬ä¸€ä¸ªCè¯­è¨€ç¨‹åº\n\n```c\n// hello.c  \t\t //æ³¨é‡Š\t// /* ä¸å®¹è®¸åµŒå¥— */\n#include<stdio.h> \t //é¢„ç¼–è¯‘å¤„ç†\nint main() \t\t\t //ä¸»å‡½æ•°\n{\n\tprintf(\"hello word !\\n\"); //è¯­å¥\n\treturn 0;\n}\n```\n## Cæºç¨‹åºçš„ç»“æ„ç‰¹ç‚¹\n1. ä¸€ä¸ªï¼£è¯­è¨€æºç¨‹åºå¯ä»¥ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæºæ–‡ä»¶ç»„æˆã€‚\n2. æ¯ä¸ªæºæ–‡ä»¶å¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå‡½æ•°ç»„æˆã€‚\n3. ä¸€ä¸ªæºç¨‹åºä¸è®ºç”±å¤šå°‘ä¸ªæ–‡ä»¶ç»„æˆï¼Œéƒ½æœ‰ä¸€ä¸ªä¸”**åªèƒ½æœ‰ä¸€ä¸ªmainå‡½æ•°**ï¼Œå³ä¸»å‡½æ•°ã€‚\n4. æºç¨‹åºä¸­å¯ä»¥æœ‰é¢„å¤„ç†å‘½ä»¤(include å‘½ä»¤ä»…ä¸ºå…¶ä¸­çš„ä¸€ç§)ï¼Œé¢„å¤„ç†å‘½ä»¤é€šå¸¸åº”æ”¾åœ¨æºæ–‡ä»¶æˆ–æºç¨‹åºçš„æœ€å‰é¢ã€‚\n5. æ¯ä¸€ä¸ªè¯´æ˜ï¼Œæ¯ä¸€ä¸ªè¯­å¥éƒ½å¿…é¡»ä»¥åˆ†å·ç»“å°¾ã€‚\n6. æ ‡è¯†ç¬¦ï¼Œå…³é”®å­—ä¹‹é—´å¿…é¡»è‡³å°‘åŠ ä¸€ä¸ªç©ºæ ¼ä»¥ç¤ºé—´éš”ã€‚è‹¥å·²æœ‰æ˜æ˜¾çš„é—´éš”ç¬¦ï¼Œä¹Ÿå¯ä¸å†åŠ ç©ºæ ¼æ¥é—´éš”ã€‚\n## Cè¯­è¨€çš„ç‰¹ç‚¹\n1. ä¸Javaå’ŒC++ä¸€æ ·ï¼ŒCè¯­è¨€æ˜¯ä¸€ç§**å¼ºç±»å‹**è¯­è¨€ã€‚å³**ç±»å‹ä¸å¯å˜**æ€§ã€‚åœ¨Cè¯­è¨€ä¸­ï¼Œå˜é‡ã€å‡½æ•°ä¸€æ—¦å®šä¹‰äº†ç±»å‹ï¼Œå®ƒçš„ç±»å‹å°±ä¸å˜ã€‚\n2. Cè¯­è¨€æ˜¯å‡½æ•°å¼ç¼–è¯‘çš„ã€‚å³å°å‡½æ•°æ¥å¥—å‡½æ•°ï¼Œä¸€ä¸ªä¸€ä¸ªå¥—æ¥ã€‚\n### ä¸€æ®µæœ‰å¯å‘çš„ä»£ç \n![image-20210712190620491](../../images/Cè¯­è¨€_210617/image-20210712190620491.png)\næ­¤æ®µä»£ç çš„è¿è¡Œç»“æœæ˜¯ï¼š`â€œ-10 > 10â€`\n# æ•°æ®ç±»å‹\n## åŸºæœ¬æ•°æ®ç±»å‹\nå¿…é¡»è®°ä½ï¼ˆåŒ…æ‹¬å ç”¨å­—èŠ‚æ•°ï¼‰ï¼Œèäºè¡€æ¶²ä¸­ã€‚\n### æ•´å‹\n1. `char`; å­˜æ”¾å­—ç¬¦çš„ASCIIç å€¼ã€‚å ç”¨1å­—èŠ‚\n2. `short`; çŸ­æ•´å‹ï¼Œå ç”¨2å­—èŠ‚\n3. `int`; å ç”¨4å­—èŠ‚\n4. `long int`; å ç”¨4å­—èŠ‚\n5. `long long`; å ç”¨8å­—èŠ‚\n### æµ®ç‚¹\n1. `float`; å•ç²¾åº¦ï¼Œå ç”¨4å­—èŠ‚\n2. `double`; åŒç²¾åº¦ï¼Œå ç”¨8å­—èŠ‚\n3. `long double`; åŒåŒç²¾åº¦ï¼Œå½“å‰VSç¼–è¯‘å™¨å ç”¨8å­—èŠ‚ï¼Œdevç¼–è¯‘å™¨å ç”¨12å­—èŠ‚ï¼Œå°†æ¥å¯èƒ½å ç”¨16å­—èŠ‚\n### æ–°ç±»å‹\n`bool`; å ç”¨1å­—èŠ‚\n### æ— ç±»å‹ - ä¹Ÿå±äºåŸºæœ¬æ•°æ®ç±»å‹\n`void`; ä¸èƒ½å®šä¹‰å˜é‡ï¼Œæ‰€ä»¥ä¸å ç”¨å­—èŠ‚\n## å„æ•°æ®ç±»å‹çš„åŒºåˆ«\n\næœ€å¤§çš„åŒºåˆ«åœ¨äºåœ¨å®šä¹‰å˜é‡æ—¶ï¼Œå®ƒä»¬å¼€è¾Ÿçš„ç©ºé—´çš„å­—èŠ‚ä¸ªæ•°ä¸ä¸€æ ·ã€‚\n## å…³é”®å­—sizeof\n\n1. è®¡ç®—**å˜é‡å ç”¨çš„å­˜å‚¨ç©ºé—´**æˆ–**ä¸€ç§ç±»å‹åœ¨å®šä¹‰å˜é‡æ—¶æ‰€å çš„å­˜å‚¨ç©ºé—´**ã€‚**ä¸æ˜¯å‡½æ•°**ï¼\n2. è®¡ç®—å‡ºæ¥çš„æ•°å€¼ç±»å‹ä¸ºï¼š`unsigned int`\n3. åœ¨ç¼–è¯‘æ—¶è¿›è¡Œè®¡ç®—ï¼Œè€Œä¸æ˜¯è¿è¡Œæ—¶è¿›è¡Œè®¡ç®—ã€‚\n\nç¤ºä¾‹ï¼š`int n = sizeof(char);`\n\n```c\nconst int n = 5;\nint ar[n] = {12,23,34,45,56};\nsizeof(n);//4\nsizeof(ar);//ç­‰äºsizeof(int)*n å³4*5=20\n```\n\n# å˜é‡ã€å¸¸é‡ã€æ ‡è¯†ç¬¦\n\n## å˜é‡\n\nä»¥æŸæ ‡è¯†ç¬¦ä¸ºåå­—ï¼Œå…¶æ•°å€¼å¯ä»¥æ”¹å˜ï¼Œå¯è¯»å¯å†™ã€‚å…±æœ‰ä¸‰ä¸ªå±‚æ¬¡ã€‚\n### å…¨å±€å˜é‡\n\nå®šä¹‰åœ¨å‡½æ•°ï¼ˆåŒ…æ‹¬ä¸»å‡½æ•°ï¼‰ä¹‹å¤–çš„å˜é‡ã€‚\n\n#### ä½œç”¨åŸŸè§£æç¬¦â€”â€”`::`\n\nä¸¤ä¸ªå†’å·ï¼Œä»£è¡¨æˆ‘è¦ç”¨å…¨å±€å˜é‡ã€‚å¸¸ç”¨äºå…¨å±€ã€å±€éƒ¨å˜é‡åå†²çªæ—¶åŒºåˆ«å‡ºå…¨å±€å˜é‡ã€‚\n\n### å±€éƒ¨å˜é‡\n\nå®šä¹‰åœ¨å‡½æ•°å†…éƒ¨çš„å˜é‡ã€‚\n\n### å—å†…å˜é‡\n\nå—å†…å¯è§ã€‚å—å¤–ä¸å¯è§ã€‚\n\n### ä»£ç ç¤ºä¾‹\n![image-20210712233203207](../../images/Cè¯­è¨€_210617/image-20210712233203207.png)\nè¿™æ®µä»£ç çš„è¾“å‡ºç»“æœä¸ºï¼šâ€œb = 0 â€ã€‚\n#### å…¨å±€ä¸å±€éƒ¨å†²çªæ—¶çš„å‘ä¸Šå°±è¿‘åŸåˆ™\n\nè¯´æ˜ä¸€ä¸ªè§„å¾‹ã€é“ç†ï¼šå½“é‡åˆ°çš„å˜é‡åå­—å‡ºç°å…¨å±€ã€å±€éƒ¨çš„å†²çªæ—¶ï¼ŒæŒ‰**å‘ä¸Šå°±è¿‘åŸåˆ™**ä¸ºä¸»ã€‚\n![image-20210712233841613](../../images/Cè¯­è¨€_210617/image-20210712233841613.png)\nè¿™æ®µä»£ç çš„è¾“å‡ºç»“æœä¸ºï¼š`b = 10`ã€‚è¯´æ˜äº†`::`ç¬¦çš„ä½œç”¨ã€‚\n## å¸¸é‡\n\nå…¶å€¼ä¸å¯æ”¹å˜ï¼Œåªè¯»ä¸å†™ã€‚\n### å­—é¢å¸¸é‡\n\nè¦æ³¨æ„çš„æ˜¯å¸¸é‡ä¸åªæ˜¯æœ‰æ•°å€¼ï¼Œå¸¸é‡ä¹Ÿå¸¦æœ‰ç±»å‹çš„æ„ä¹‰ã€‚æ¯”å¦‚`7/2=3`ã€‚\n\nç¼–ç¨‹ä¸æ•°å­¦çš„åŒºåˆ«ï¼šä¸€ä¸ªæœ‰ç©·ä¸€ä¸ªæ— ç©·ï¼›ä¸€ä¸ªæœ‰ç±»å‹ä¸€ä¸ªæ— ç±»å‹ã€‚\n### å®å¸¸é‡\n\nç”¨#defineå®šä¹‰çš„å¸¸é‡ï¼Œå«åšå®å¸¸é‡ã€‚\n\n```C\n#define PI 3.14\n```\n\nå®çš„æ ¹æœ¬æ¦‚å¿µæ˜¯ä¸€ç§æ›¿æ¢åŸåˆ™ã€‚\n\n1. æ— ç±»å‹ï¼Œåªæ˜¯æš‚æ—¶ç”¨å­—ç¬¦ä¸²æ¥è¡¨ç¤º\n2. ä¸å¼€è¾Ÿå­˜å‚¨ç©ºé—´\n3. ç»“å°¾ä¸€èˆ¬ä¸åŠ åˆ†å·ï¼Œå¦‚æœåŠ ä¸Šåˆ†å·åˆ™æŠŠåˆ†å·ä¹Ÿä¸€èµ·çœ‹ä½œæ˜¯æ›¿æ¢çš„å€¼ã€‚\n4. åœ¨é¢„ç¼–è¯‘æ—¶é‡åˆ°å®å¸¸é‡å­—ç¬¦ä¸²æ—¶èµ·ä½œç”¨ï¼Œæ›¿æ¢ã€‚å¯ä»¥åœ¨é¢„ç¼–è¯‘åDebugæ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆçš„\\*.iæ–‡ä»¶ä¸­çœ‹åˆ°ã€‚\n   ![image-20210713003504549](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210713003504549.png)\n\n   ![image-20210713003530909](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210713003530909.png)\n![image-20210713003601640](../../images/Cè¯­è¨€_210617/image-20210713003601640.png)\n### å¸¸å˜é‡\n\nç”¨constå…³é”®å­—ä¿®é¥°çš„å˜é‡ï¼Œç§°ä¸ºå¸¸å˜é‡ã€‚åªå¯è¯»å–ï¼Œä¸å¯æ”¹å˜ã€‚è¦å¼€è¾Ÿç©ºé—´ã€‚\n### æšä¸¾å¸¸é‡ï¼ˆenumï¼‰\n\n```c\nenum week{\n    Mon=1,\n    Tues=2,\n    Wed=3,\n    Thurs=4,\n    Fri=5,\n    Sat=6,\n    Sun=7};\n```\n\næšä¸¾å¸¸é‡å®é™…ä¸Šæ˜¯ä¸€ç§å—åˆ°é™åˆ¶çš„**æ•´å‹é‡**ã€‚ä¸å¯ä»¥æ˜¯å°æ•°ã€‚\n\n1. ç¬¬ä¸€ç§å—é™çš„è¡¨ç°ï¼šxä¸èƒ½éšä¾¿å–å€¼ï¼Œåªèƒ½ä»1ã€2ã€3ã€4ã€5ã€6ã€7ä¸­èµ‹å€¼ã€‚\n![image-20210713004400231](../../images/Cè¯­è¨€_210617/image-20210713004400231.png)\n2. ç¬¬äºŒç§å—é™çš„è¡¨ç°ï¼šå³ä½¿ä»1ã€2ã€3ã€4ã€5ã€6ã€7ä¸­èµ‹å€¼ä¹Ÿè¦ç”¨å®šä¹‰æšä¸¾ç±»çš„å˜é‡åèµ‹å€¼ï¼Œä¸å¯ç›´æ¥ç”¨æ•°å­—ã€‚\n![image-20210713004708901](../../images/Cè¯­è¨€_210617/image-20210713004708901.png)\n3. æ­£ç¡®å†™æ³•ï¼š\n![image-20210713004753195](../../images/Cè¯­è¨€_210617/image-20210713004753195.png)\n4. å…¶ä»–çº¦æŸï¼šè¿ç®—çš„çº¦æŸï¼Œæ¯”å¦‚ä¸å¯ä»¥è‡ªå¢è‡ªå‡ã€‚\n5. å¦‚æœæ²¡ç»™ç¬¬ä¸€ä¸ªå˜é‡èµ‹å€¼ï¼Œåˆ™é»˜è®¤ç¬¬ä¸€ä¸ªå˜é‡ä¸º0ï¼Œå¾€åçš„å˜é‡å€¼ä¸ºä¾æ¬¡åŠ 1ï¼›è‹¥æ²¡ç»™ä¸­é—´æŸä¸ªå˜é‡èµ‹å€¼ï¼Œåˆ™é»˜è®¤ä¸ºä¸Šä¸€ä¸ªå˜é‡å€¼åŠ 1ã€‚\n![image-20210713005317130](../../images/Cè¯­è¨€_210617/image-20210713005317130.png)\nå¦‚ä¸Šå›¾ï¼Œå€¼ä¾æ¬¡ä¸ºï¼š-1ã€0ã€1ã€-2ã€-1ã€0ã€1\n### å­—ç¬¦å¸¸é‡å’Œå­—ç¬¦ä¸²å¸¸é‡\n\n`char ch = 'a';`\n\nç»™å˜é‡chä¸­å­˜æ”¾çš„ä¸æ˜¯å­—ç¬¦`'a'`ï¼Œè€Œæ˜¯å­—ç¬¦`'a'`å¯¹åº”çš„ASCIIç å€¼ã€‚å³ç¼–è¯‘åè½¬æ¢ä¸º`\"char ch = 97;\"`ã€‚\n\næ‰“å¼€å†…å­˜ï¼ŒæŸ¥`ch`å¤„çš„å­˜å‚¨å†…å®¹ã€‚å‘ç°å­˜çš„æ˜¯`97`çš„åå…­è¿›åˆ¶å½¢å¼`61`ã€‚\n\n![image-20210713105853322](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210713105853322.png)\n\n![image-20210713105916869](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210713105916869.png)\n![image-20210713105929580](../../images/Cè¯­è¨€_210617/image-20210713105929580.png)\n`char`æ˜¯æ•´å‹æ•°æ®ç±»å‹ï¼Œ`ch`å­˜å‚¨çš„æ˜¯ASCIIç `97`ï¼Œä½†è¾“å‡ºçš„å½¢å¼ç”±æˆ‘ä»¬å†³å®šï¼Œå¦‚æœæ˜¯`printf(\"%d \\n\", ch);`é‚£ä¹ˆå°±æ˜¯`97`ã€‚å¦‚æœæ˜¯`printf(\"%c \\n\",ch);`é‚£ä¹ˆå°±æ˜¯`a`ã€‚\n\nå…³äºå­—ç¬¦å¯¹åº”çš„ASCIIç ï¼Œæˆ‘ä»¬é‡ç‚¹è®°å¿†å‡ ä¸ªå­—ç¬¦å³å¯ï¼Œæ¯”å¦‚å­—ç¬¦aæ˜¯97ï¼Œåˆ™å¯ä»¥æ¨å‡ºå…¶ä»–å­—ç¬¦çš„å€¼ã€‚\n#### ç‰¹æ®Šç¬¦å· - è½¬ä¹‰å­—ç¬¦åŠå…¶å«ä¹‰\n\n![image-20210713111900791](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210713111900791.png)\n\né‡ç‚¹è®°ä¸‰ä¸ªï¼š\n1. `\\n`æ˜¯æ¢è¡Œç¬¦ï¼ˆLFï¼‰ï¼Œå°†å½“å‰ä½ç½®ç§»åˆ°ä¸‹ä¸€è¡Œå¼€å¤´ã€‚ASCIIç å€¼æ˜¯`10`ã€‚\n2. `\\r`æ˜¯å›è½¦ç¬¦ï¼ˆCRï¼‰ï¼Œå°†å½“å‰ä½ç½®ç§»åˆ°æœ¬è¡Œå¼€å¤´ã€‚ASCIIç å€¼æ˜¯`13`ã€‚\n3. `\\t`æ˜¯æ°´å¹³åˆ¶è¡¨ç¬¦ï¼ˆHTï¼‰ï¼Œè·³åˆ°ä¸‹ä¸€ä¸ªTABä½ç½®ã€‚ASCIIç å€¼æ˜¯`9`ã€‚\n4. `\\0`æ˜¯ç©ºå­—ç¬¦ï¼ŒASCIIç å€¼æ˜¯`0`ã€‚**æ‰€ä»¥ç©ºå­—ç¬¦å¯ä»¥æœ‰ä¸¤ç§èµ‹å€¼å½¢å¼:`char ch1 = 0;æˆ–char ch2 = '\\0';`**\nå¦‚æœè¦è¡¨ç¤ºåæ–œæ å­—ç¬¦ï¼Œå¯ç”¨`\\\\`è½¬ä¹‰ã€‚\n##### å®šç•Œç¬¦\n\nå•å¼•å·æ˜¯å­—ç¬¦çš„å®šç•Œç¬¦ï¼š`'a' -> |97|`ã€‚å¦‚æœè¦è¡¨ç¤ºå•å¼•å·å­—ç¬¦ï¼Œå¯ç”¨`\\'`è½¬ä¹‰ã€‚\nåŒå¼•å·æ˜¯å­—ç¬¦ä¸²çš„å®šç•Œç¬¦ï¼š`\"a\" -> |97|\\0|`ã€‚å¦‚æœè¦è¡¨ç¤ºåŒå¼•å·å­—ç¬¦ï¼Œå¯ç”¨`\\\"`è½¬ä¹‰ã€‚\n#### å…³äºç©ºå­—ç¬¦ï¼ˆ`\\0`ï¼‰ã€ç©ºæ ¼å­—ç¬¦ï¼ˆ`' '`ï¼‰å’Œ`'0'`å­—ç¬¦\n![image-20210713113436447](../../images/Cè¯­è¨€_210617/image-20210713113436447.png)\nä¸€å®šè¦åŒºåˆ†ã€‚åŒºåˆ†çš„å…³é”®æ˜¯ä»ASCIIç å€¼æ¥ç†è§£ã€‚\n1. ç©ºæ ¼å­—ç¬¦**ä¸æ˜¯ç©ºå­—ç¬¦**ã€‚**ç©ºæ ¼å­—ç¬¦çš„ASCIIç å€¼æ˜¯48**ã€‚\n2. `char chb = 0;`å’Œ`char chc = '\\0';`ç­‰æ•ˆï¼Œéƒ½æ˜¯ç»™å˜é‡èµ‹ASCIIç å€¼0ã€‚\n3. å•å¼•å·ä¸­åªæœ‰0çš„æ—¶å€™æ˜¯å­—ç¬¦'0'ï¼Œå…¶ASCIIç å€¼æ˜¯48ã€‚\n#### å¤´æ–‡ä»¶`<ctype.h>`\nç”¨æ¥ç¡®å®šåŒ…å«äºå­—ç¬¦æ•°æ®ä¸­çš„ç±»å‹çš„å‡½æ•°ã€‚\n![image-20210713144419145](../../images/Cè¯­è¨€_210617/image-20210713144419145.png)\n## æ ‡è¯†ç¬¦\n\nå¿…é¡»æ˜¯**ä»¥ä¸‹åˆ’çº¿æˆ–å­—æ¯å¼€å¤´**çš„**ä¸‹åˆ’çº¿ã€å­—æ¯ã€æ•°å­—çš„ç»„åˆä½“**ã€‚\n\n`_a`; `a4`; `_3`;å‡å¯\n\nå˜é‡ã€å‡½æ•°èµ·åæ—¶è¦è§åçŸ¥ä¹‰ï¼Œä¸è¦ç”¨æ±‰è¯­æ‹¼éŸ³ï¼Œå› ä¸ºæœ‰åŒéŸ³å¼‚è¯ï¼Œå®¹æ˜“å¼•èµ·æ­§ä¹‰ã€‚\n# å®šä¹‰å’Œå£°æ˜\n\n## å®šä¹‰\n\næ‰€è°“çš„å®šä¹‰å°±æ˜¯ä¸ºè¿™ä¸ªå˜é‡åˆ†é…ä¸€å—å†…å­˜å¹¶ç»™å®ƒå–ä¸Šä¸€ä¸ªåå­—ï¼Œè¿™ä¸ªåå­—å°±æ˜¯æˆ‘ä»¬ç»å¸¸æ‰€è¯´çš„å˜é‡åã€‚ä½†æ³¨æ„ï¼Œè¿™ä¸ªåå­—ä¸€æ—¦å’Œè¿™å—å†…å­˜åŒ¹é…èµ·æ¥ï¼Œå®ƒä»¬å°±åŒç”Ÿå…±æ­»ï¼Œç»ˆç”Ÿä¸ç¦»ä¸å¼ƒï¼Œå¹¶ä¸”è¿™å—å†…å­˜çš„ä½ç½®ä¹Ÿä¸èƒ½è¢«æ”¹å˜ã€‚**ä¸€ä¸ªå˜é‡åœ¨ä¸€å®šçš„åŒºåŸŸå†…ï¼ˆæ¯”å¦‚å‡½æ•°å†…ï¼Œå…¨å±€ç­‰ï¼‰åªèƒ½è¢«å®šä¹‰ä¸€æ¬¡**ï¼Œå¦‚æœå®šä¹‰å¤šæ¬¡ï¼Œç¼–è¯‘å™¨ä¼šæç¤ºä½ é‡å¤å®šä¹‰åŒä¸€ä¸ªå˜é‡æˆ–å¯¹è±¡ã€‚\n## å£°æ˜\n\nä»€ä¹ˆæ˜¯å£°æ˜ï¼šæœ‰ä¸¤é‡å«ä¹‰ï¼Œå¦‚ä¸‹ï¼š\nç¬¬ä¸€é‡å«ä¹‰ï¼šå‘Šè¯‰ç¼–è¯‘å™¨ï¼Œè¿™ä¸ªåå­—å·²ç»åŒ¹é…åˆ°ä¸€å—å†…å­˜åœ°å€ä¸Šäº†ã€‚ï¼ˆä½†æ˜¯å¦‚æœåªæ˜¯å£°æ˜çš„è¯ï¼Œä¸å¼€è¾Ÿå†…å­˜ç©ºé—´ï¼‰\nç¬¬äºŒé‡å«ä¹‰ï¼šå‘Šè¯‰ç¼–è¯‘å™¨ï¼Œæˆ‘è¿™ä¸ªåå­—æˆ‘å…ˆé¢„å®šäº†ï¼Œåˆ«çš„åœ°æ–¹å†ä¹Ÿä¸èƒ½ç”¨å®ƒæ¥ä½œä¸ºå˜é‡åã€‚\n## ç¤ºä¾‹\n\n![image-20210712231142222](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210712231142222.png)\n\nç¤ºä¾‹ä¸­`float pi = 3.14f;`ï¼Œ`f`è¡¨ç¤ºæ­¤æ•°æ®ä¸ºå•ç²¾åº¦ç±»å‹ï¼Œè‹¥ä¸å¸¦`f`é»˜è®¤ä¸ºåŒç²¾åº¦ã€‚\n\n# é¡ºåºè¯­å¥ã€é€‰æ‹©è¯­å¥ã€å¾ªç¯è¯­å¥\n## é¡ºåºç»“æ„\næŒ‰ç…§è¯­å¥å‡ºç°çš„å…ˆåé¡ºåºä¾æ¬¡æ‰§è¡Œã€‚\n## é€‰æ‹©ç»“æ„\næ ¹æ®æ¡ä»¶åˆ¤æ–­æ˜¯å¦æ‰§è¡Œç›¸å…³è¯­å¥ã€‚\n## å¾ªç¯ç»“æ„\nå½“æ¡ä»¶æˆç«‹æ—¶ï¼Œé‡å¤æ‰§è¡ŒæŸäº›è¯­å¥ã€‚\n\n```c\n//ç»Ÿè®¡ä»é”®ç›˜è¾“å…¥çš„ä¸€è¡Œå­—ç¬¦çš„ä¸ªæ•°ã€‚\nint main()\n{\n    int num = 0;\n    printf(\"input a string\\n\");\n    //char ch = '\\0';\n    //scanf_s(\"%c\",&ch);\n    //ch=getchar();\n    while (getchar()!='\\n')\n    {\n        num += 1;\n    }\n    printf(\"%d \\n\",num);\n    return 0;\n}\n```\n\nå…¶ä¸­ï¼Œ`getchar();`ç­‰æ•ˆäº`scanf_s(\"%c\",&ch);`ï¼Œå‰è€…æ˜æ˜¾æ¯”åè€…ç®€æ´ã€‚\n# å‡½æ•°\n\né€šè¿‡å‡½æ•°ï¼Œå¯ä»¥æŠŠä¸€ä¸ªå¤æ‚ä»»åŠ¡åˆ†è§£ä¸ºè‹¥å¹²ä¸ªæ˜“äºè§£å†³çš„å°ä»»åŠ¡ã€‚å……åˆ†ä½“ç°ç»“æ„åŒ–ç¨‹åºè®¾è®¡ç”±ç²—åˆ°ç²¾ã€é€æ­¥ç»†åŒ–çš„è®¾è®¡æ€æƒ³ã€‚\n\n![image-20210713172544505](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210713172544505.png)\n\n## å‡½æ•°ç»„æˆéƒ¨åˆ†\n\n```\nè¿”å›ç±»å‹ + å‡½æ•°åç§°(å½¢å‚åˆ—è¡¨)\n{\nã€€ã€€å‡½æ•°ä½“\n}\n```\n\n## è¿›ç¨‹ä¸ç¨‹åºçš„å…³ç³»\n\n![image-20210713151216654](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210713151216654.png)\n\n### è¿›ç¨‹\n\nè¿›ç¨‹æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œã€‚è¿›ç¨‹æ˜¯åŠ¨æ€çš„ã€‚\n\næ¯”å¦‚ï¼Œåœ¨ç°å®ä¸–ç•Œä¸­ï¼Œç¨‹åºå¯ä»¥çœ‹ä½œæ˜¯ä¹è°±ï¼Œä¹è°±ä¸ä¼šè‡ªå·±å¼¹å¥ã€‚æœ‰ä¸€é’¢ç´ï¼Œäººåä¸‹æ ¹æ®ä¹è°±è¿›è¡Œå¼¹å¥ï¼Œå¼¹å¥ä¹è°±çš„è¿‡ç¨‹å°±æ˜¯è¿›ç¨‹ã€‚\n\nè¿›ç¨‹éå¸¸é‡è¦çš„æ¦‚å¿µï¼šä»¥æ—¶é—´ä¸ºå•ä½è¿›è¡Œæµå¤±ï¼Œåœ¨ç»è¿‡æŸå‡ ä¸ªæ—¶é—´ç‚¹å†…è¦æŠŠç¨‹åºå…¨éƒ¨æ‰§è¡Œç›´è‡³ç»“æŸã€‚æ—¶é—´ç‚¹æœ‰åˆ›å»ºã€æ‰§è¡Œã€ç»“æŸã€‚\n\n### èµ„æº\n\nåˆå¦‚ï¼Œèœè°±ç»™äº†åšé¥­æ­¥éª¤ï¼Œèœè°±è‡ªå·±ä¸èƒ½å‡­ç©ºåšå‡ºé¥­ã€‚æŒ‰ç…§èœè°±çš„æ¨¡å¼ä¹°èœï¼Œæ¶ç«æŒ‰ç…§èœè°±åšé¥­ã€‚è€Œåšé¥­è¦æœ‰èµ„æºï¼Œæ²¹ã€æ°´ã€è°ƒæ–™ã€ç«ç­‰ã€‚\n\nè®¡ç®—æœºä¸­æœ€é‡è¦çš„ä¸¤ä¸ªèµ„æºï¼š**æ—¶é—´**å’Œ**ç©ºé—´**ã€‚\n\næ—¶é—´é’ˆå¯¹äºCPUï¼Œç©ºé—´é’ˆå¯¹äºå†…å­˜ã€‚\n\nç¨‹åºè¢«æ‰§è¡Œæ—¶ï¼Œä»»ä½•ä¸€ä¸ªè¿›ç¨‹ï¼Œå°†ä¼šæŠŠç”¨åˆ°çš„å­˜å‚¨ç©ºé—´åˆ†é…ç»™å››ä¸ªåŒºåŸŸâ€”â€”**ä»£ç åŒº**(test area)ã€**æ•°æ®åŒº**(data area)ã€**å †åŒº**(heap area)ã€**æ ˆåŒº**(stack area)ã€‚\n\n1. dataåŒºå­˜æ”¾ç¨‹åºçš„å…¨å±€å˜é‡ã€‚\n2. heapåŒºå¯¹åº”ç€mallocå’Œfreeå¼€è¾Ÿå’Œé‡Šæ”¾çš„å­˜å‚¨ç©ºé—´ã€‚\n3. stackåŒºå­˜æ”¾å‡½æ•°ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡ã€‚\n## å¯è§æ€§ï¼ˆä½œç”¨åŸŸï¼‰\n\nå¯è§æ€§æŒ‡æ ‡è¯†ç¬¦èƒ½å¤Ÿè¢«ä½¿ç”¨çš„èŒƒå›´ï¼šåªæœ‰åœ¨ä½œç”¨åŸŸå†…çš„æ ‡è¯†ç¬¦æ‰å¯ä»¥è¢«ä½¿ç”¨ã€‚æ­¤é˜¶æ®µç‰¹æ€§é’ˆå¯¹**ç¼–è¯‘å’Œé“¾æ¥**è¿‡ç¨‹ã€‚\n\n1. å‡½æ•°ä¸­å®šä¹‰çš„æ ‡è¯†ç¬¦ï¼ŒåŒ…æ‹¬**å½¢å‚**å’Œ**å‡½æ•°ä½“ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡**çš„ä½œç”¨åŸŸéƒ½åªåœ¨è¯¥å‡½æ•°å†…ï¼Œä¹Ÿç§°ä½œå‡½æ•°åŸŸã€‚\n2. æ–‡ä»¶ä½œç”¨åŸŸä¹Ÿç§°å…¨å±€ä½œç”¨åŸŸï¼Œå®šä¹‰åœ¨æ‰€æœ‰å‡½æ•°ä¹‹å¤–çš„æ ‡è¯†ç¬¦ï¼Œå…·æœ‰æ–‡ä»¶ä½œç”¨åŸŸã€‚ä½œç”¨åŸŸä¸º**ä»å®šä¹‰å¤„åˆ°æ•´ä¸ªæºæ–‡ä»¶ç»“æŸ**ã€‚æ–‡ä»¶ä¸­å®šä¹‰çš„å…¨å±€å˜é‡å’Œå‡½æ•°éƒ½å…·æœ‰æ–‡ä»¶ä½œç”¨åŸŸã€‚\n## ç”Ÿå­˜æœŸ\n\nç”Ÿå‘½æœŸæŒ‡çš„æ˜¯æ ‡è¯†ç¬¦ä»ç¨‹åºå¼€å§‹è¿è¡Œæ—¶è¢«åˆ›å»ºï¼Œå…·æœ‰å­˜å‚¨ç©ºé—´ï¼Œåˆ°ç¨‹åºè¿è¡Œç»“æŸæ—¶æ¶ˆäº¡æ—¶é‡Šæ”¾å­˜å‚¨ç©ºé—´çš„æ—¶é—´æ®µã€‚æ­¤é˜¶æ®µé’ˆå¯¹çš„æ˜¯ç¨‹åºçš„**æ‰§è¡Œè¿‡ç¨‹**ã€‚\n\n1. å±€éƒ¨å˜é‡çš„ç”Ÿå­˜æœŸæ˜¯ï¼šå‡½æ•°è¢«è°ƒç”¨ï¼Œåˆ†é…å­˜å‚¨ç©ºé—´ï¼›å‡½æ•°æ‰§è¡Œç»“æŸï¼Œé‡Šæ”¾ç©ºé—´ã€‚stackåŒºã€‚\n2. å…¨å±€å˜é‡çš„ç”Ÿå­˜æœŸæ˜¯ï¼šä»ç¨‹åºæ‰§è¡Œå‰å¼€å§‹ï¼Œåˆ°æ‰§è¡Œåç»“æŸã€‚dataåŒºã€‚\n\n### ä»£ç ç¤ºä¾‹_ç”Ÿå­˜æœŸ\n\n```c\n#include<stdio.h>\nint* fun()\n{\n    int ar[10] = {12,23,34,56,78,89,90,100};\n    printf(\"fun \\n\");\n    for(int i = 0;i < 10;++i)\n    {\n        printf(\"%d \",ar[i]);\n    }\n    printf(\"\\n\");\n    return ar;\n}\nint main()\n{\n    int* p = fun();\n    printf(\"main \\n\");\n    for(int i = 0;i < 10;++i)\n    {\n        printf(\"%d \",p[i]);\n    }\n    return 0;\n}\n```\n#### è¿è¡Œç»“æœ_ç”Ÿå­˜æœŸ\n\n![image-20210713163156464](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210713163156464.png)\n\nè°ƒç”¨çš„funç»“æœæ­£å¸¸ã€‚è€Œmainå†éå†aråœ°å€æ—¶å°±å¤±æ•ˆäº†ï¼Œåé¢çš„æ•°éƒ½æ˜¯éšæœºæ•°ã€‚\n\næ­¤ä¾‹è¯´æ˜ï¼Œå‡½æ•°çš„ç”Ÿå­˜æœŸåªæœ‰åœ¨è¢«è°ƒç”¨æ—¶æ‰æ‹¥æœ‰å…¶å­˜å‚¨ç©ºé—´ï¼Œè°ƒç”¨ç»“æŸæ—¶ï¼Œå…¶å­˜å‚¨ç©ºé—´å°†è¢«é‡Šæ”¾ã€‚\n#### æ€è€ƒ\n\næ•°ç»„arçš„å¤´åœ°å€ä¸­çš„å€¼ä¸ºä½•èƒ½ä¸€ç›´ä¿å­˜ï¼Ÿ`main`å‡½æ•°è‡ªå·±è°ƒç”¨æ—¶ï¼Œä¸ºä½•é™¤äº†`12`æ­£ç¡®ï¼Œå…¶ä»–éƒ½æ˜¯ä¹±çš„ï¼Ÿ\n\nåšäº†ä»¥ä¸‹å®éªŒï¼šå¦‚æœè®©`fun`å‡½æ•°`return ar+1`ï¼Œå†åœ¨`main`å‡½æ•°ä¸­éå†ï¼Œå‘ç°è¿è¡Œç»“æœæ˜¯![image-20210713164713434](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210713164713434.png)\n\nå³ï¼šç¬¬ä¸€ä¸ªæ•°æ®`23`æ­£ç¡®ä¿ç•™ï¼Œåé¢å…¨ä¹±ã€‚ç”±æ­¤ï¼Œå¯¹ç¨‹åºçš„ç”Ÿå­˜æœŸåˆå¯è§ä¸€æ–‘ã€‚\n\nä½†åœ¨`dev-C++`ç¯å¢ƒä¸‹ä¸å¯å®ç°`main`ä¸­`for`éå†ï¼ˆè¿è¡Œå‡ºé”™ï¼‰ã€‚è¿™åˆè¯´æ˜ï¼Œ**ä¸åŒç¼–è¯‘å™¨å¯¹äºç”Ÿå­˜æœŸçš„å®šä¹‰ä¹Ÿä¸å°½ç›¸åŒ**ï¼\n\nè¿˜åšäº†å¦ä¸€å®éªŒï¼šå°†`ar`æ•°ç»„å¤§å°è°ƒæ•´è‡³`10000`ã€‚è¿˜æ˜¯è¾“å‡º`10`ä¸ªæ•°ï¼Œè¾“å‡ºå´æ­£å¸¸ã€‚\n\nè¿™ä¸ªä¾‹å­ä½“ç°äº†**æŒ‡é’ˆçš„å¤±æ•ˆ**ï¼\n\n#### è§£é‡Š\n\næˆ‘ä»¬åœ¨è°ƒç”¨å‡½æ•°æ—¶ï¼Œéƒ½ä¼šå¼€è¾Ÿè‹¥å¹²ä¸ªæ ˆå¸§æä¾›å‡½æ•°ä¸­å˜é‡çš„å­˜å‚¨ç©ºé—´ã€‚åœ¨mainå‡½æ•°ä¸­è°ƒç”¨fun()å‡½æ•°æ—¶ï¼Œéšå³å¼€è¾Ÿäº†ä¸€äº›ç©ºé—´å­˜æ”¾æ•°ç»„ã€‚æœ€åè™½ç„¶è¿”å›äº†åŸæœ¬æ•°ç»„çš„é¦–åœ°å€å¹¶èµ‹ç»™äº†pæŒ‡é’ˆï¼Œä½†è°ƒç”¨ç»“æŸåå˜é‡çš„ç”Ÿå­˜æœŸæ®†å°½ï¼Œç©ºé—´è¢«é‡Šæ”¾ã€‚printf()ä¹Ÿæ˜¯ä¸€å‡½æ•°ï¼Œä»–çš„è°ƒç”¨éš¾å…ä¼šè¦†ç›–åˆšæ‰fun()å‡½æ•°å ç”¨çš„æ ˆå¸§ï¼Œå³æ®‹ç•™åœ¨æ ˆå¸§ä¸­çš„æ•°æ®è¢«é‡å†™å¯¼è‡´è¾“å‡ºè¾¾ä¸åˆ°é¢„æœŸä»¥ä¸ºçš„æ•ˆæœã€‚\n\nè€ŒæŠŠæ•°ç»„å¤§å°è°ƒè‡³10000ä½¿fun()å‡½æ•°å ç”¨çš„æ ˆå¸§å¾ˆå¤§ï¼Œå¯¼è‡´printf()å‡½æ•°ç­‰å‡½æ•°æ­£å¥½æ²¡æœ‰è¦†ç›–åˆ°åˆšæ‰æŸäº›æ•°ç»„æ•°æ®å ç”¨çš„ç©ºé—´ï¼Œæœ€åå¯¼è‡´ä¾¥å¹¸è¾“å‡ºæ­£ç¡®ã€‚ä½†æœ¬è´¨ä¸ŠpæŒ‡é’ˆè¿˜æ˜¯ä¸€ä¸ªå¤±æ•ˆæŒ‡é’ˆã€‚\n![image-20210715001423769](../../images/Cè¯­è¨€_210617/image-20210715001423769.png)\n### åŠ¨æ€ç”Ÿå‘½æœŸ\n\nåŠ¨æ€ç”Ÿå‘½æœŸå¯¹åº”åŠ¨æ€å†…å­˜çš„åˆ†é…ã€ç®¡ç†ã€‚\n# æ•°ç»„\n\næ•°ç»„æ˜¯åŒ…å«ç»™å®šç±»å‹çš„ä¸€ç»„æ•°æ®ï¼Œå³ä¸€ç»„ç›¸åŒç±»å‹å…ƒç´ çš„é›†åˆã€‚\n# è¿ç®—ç¬¦\n\n## æ“ä½œæ•°ï¼ˆOperandï¼‰\n\næ“ä½œæ•°ï¼ˆoperandï¼‰æ˜¯ç¨‹åºæ“çºµçš„æ•°æ®å®ä½“ï¼Œè¯¥æ•°æ®å¯ä»¥æ˜¯æ•°å€¼ã€é€»è¾‘å€¼æˆ–å…¶ä»–ç±»å‹ã€‚è¯¥æ“ä½œæ•°æ—¢å¯ä»¥æ˜¯å¸¸é‡ä¹Ÿå¯ä»¥ä¸ºå˜é‡ã€‚\n## è¿ç®—ç¬¦ï¼ˆOperatorï¼‰\n\nè¿ç®—ç¬¦ï¼ˆoperatorï¼‰æ˜¯å¯ä»¥å¯¹æ•°æ®è¿›è¡Œç›¸åº”æ“ä½œçš„ç¬¦å·ã€‚å¦‚å¯¹æ•°æ®æ±‚å’Œæ“ä½œï¼Œç”¨åŠ æ³•è¿ç®—ç¬¦`'+'`ï¼Œæ±‚ç§¯æ“ä½œä½¿ç”¨ä¹˜æ³•è¿ç®—ç¬¦`'*'`ç­‰ã€‚\n\næ ¹æ®è¿ç®—ç¬¦å¯æ“ä½œæ“ä½œæ•°çš„ä¸ªæ•°å¯åˆ†ä¸ºä¸€å…ƒè¿ç®—ç¬¦ï¼ˆå•ç›®è¿ç®—ç¬¦ï¼‰ã€äºŒå…ƒè¿ç®—ç¬¦ï¼ˆåŒç›®è¿ç®—ç¬¦ï¼‰å’Œå¤šå…ƒè¿ç®—ç¬¦ï¼ˆCè¯­è¨€ä¸­åªæœ‰ä¸€ä¸ªä¸‰å…ƒè¿ç®—ç¬¦`\" ? : \"`ï¼‰ã€‚\n## è¿ç®—ç¬¦ä¼˜å…ˆçº§\n\n![image-20210715010003149](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210715010003149.png)\n## è¿ç®—ç¬¦ä¸¾ä¾‹\n### å–æ¨¡è¿ç®—ç¬¦%\nåœ¨Cè¯­è¨€ä¸­æœ‰å¾ˆå¤šåº”ç”¨ï¼š\n1. åˆ¤æ–­æ˜¯å¦èƒ½å¤Ÿæ•´é™¤æŸä¸ªæ•°ï¼›\n2. åˆ¤æ–­å¥‡å¶æ•°ï¼Œåˆ¤åˆ«è´¨æ•°ï¼›\n3. è®¡ç®—èŒƒå›´ã€‚å½¢æˆå¾ªç¯ã€‚\n```c\n#include<stdio.h>\nint main()\n{\n//ä»¥ä¸‹å‡è¦æ±‚æ¯äº”ä¸ªæ•°æ¢ä¸€è¡Œ\n//ä»0è¾“å‡º100ä¸ªæ•°ï¼ˆ0~99ï¼‰\n    for(int i=0;i<100;++i)\n    {\n        if(i%5 == 0 && i!=0)\n        {\n            printf(\"\\n\");\n        }\n    printf(\"%3d\",i);\n}\n//é‡ç‚¹æ˜¯æ¡ä»¶ä¸­åŠ ä¸€ä¸ªè¾¹ç•Œé™åˆ¶æ¡ä»¶i!=0ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ä¼šåœ¨è¾“å‡ºå‰å¤šä½™ä¸€è¡Œ\n//è¾“å‡ºæ•ˆæœ\n//  0  1  2  3  4\n//  5  6  7  8  9\n//  ...\n// 95 96 97 98 99\n\n//ä»1è¾“å‡º100ä¸ªæ•°ï¼ˆ1~100ï¼‰\n//å¦‚æœåªæ”¹å˜ä¸Šè¿°ä»£ç ä¸­forå¾ªç¯ä¸­çš„int i=1;i<=100ä¼šå‡ºç°ä»¥ä¸‹æƒ…å†µï¼š\n//  1  2  3  4\n//  5  6  7  8  9\n//  ...\n// 95 96 97 98 99\n//100\n//æ‰€ä»¥æˆ‘ä»¬è¦è½¬å˜æ€è·¯ï¼Œä¸»è¦è½¬ç§»ç‚¹å°±æ˜¯ï¼šå…ˆè¾“å‡ºï¼Œåæ¢è¡Œï¼Œå¹¶é™åˆ¶å°¾éƒ¨è¾¹ç•Œæ¡ä»¶ï¼Œå³100è¾“å‡ºåä¸æ¢è¡Œã€‚\n    for(int i=1;i<=100;++i)\n    {\n        printf(\"%3d\",i);\n        if(i%5==0 &&ã€€i!=100)\n        {\n            printf(\"\\n\");\n        }\n    }\n//è€Œå…ˆè¾“å‡ºæ•°å­—åæ¢è¡Œçš„æ¨¡å¼å¦‚æœå¯¹äº0~99æ¥è¯´åˆå¤±æ•ˆäº†ï¼Œä¼šå‡ºç°å¦‚ä¸‹æƒ…å†µï¼š\n    for(int i=0;i<100;++i)\n    {\n        printf(\"%3d\",i);\n        if(i%5==0 &&ã€€i!=100)\n        {\n            printf(\"\\n\");\n        }\n    }\n//  0\n//  1  2  3  4  5\n//  6  7  8  9 10\n// ...\n// 96 97 98 99\n//å¯è¿›è¡Œå¦‚ä¸‹æ”¹è¿›\n    for(int i=0;i<100;++i)\n    {\n        printf(\"%3d\",i);\n        if((i+1)%5==0 &&ã€€(i+1)!=100)\n        {\n            printf(\"\\n\");\n        }\n    }\n    return 0;\n}\n```\n\n![image-20210714155735069](../../images/Cè¯­è¨€_210617/image-20210714155735069.png)\n\n```c\n//ç¼–ç¨‹è¾“å‡ºå¦‚ä¸Šæ•ˆæœ\n//ä¸»è¦æ€è·¯ï¼šä¸¤å±‚forå¾ªç¯ï¼Œç”¨å–ä½™æ€æƒ³\n#include<stdio.h>\nint main()\n{\n    const int n = 26;\n    for(int i=0;i<n;++i)\n    {\n        int k=i;\n        for(int j=0;j<n;++j)\n        {\n            printf(\"%d\",k);\n            k=(k+1)%n;//ç²¾é«“æ‰€åœ¨\n        }\n        printf(\"\\n\");\n    }\n    return 0;\n}\n```\n4. æ±‚æœ€å¤§å…¬çº¦æ•°çš„è¾—è½¬ç›¸é™¤æ³•ï¼ˆæ¬§å‡ é‡Œå¾—ç®—æ³•ï¼‰ï¼š`gcd(a, b) = gcd(b, a mod b)`\n```c\n#include<stdio.h>\nint main()\n{\n    int a = 0, b = 0;\n    int i = 0;\n    scanf_s(\"%d %d\",&a,&b);\n//éå†ç®—æ³•\n//i = a < b ? a : b;\n//while(i>1)\n//{\n//    if(a%i==0&&b%i==0)\n//    {\n//        break;\n//    }\n//    --i;\n//}\n//printf(\"%d \\n\",i);\n//è¾—è½¬ç›¸é™¤æ³•--35å’Œ25ï¼š35%25=10;25%10=5;10%5=0\n    while(b!=0)\n    {\n        int c = a % b;\n        a = b;\n        b = c;\n    }\n    printf(\"%d \\n\",a);\n    return 0;\n}\n```\n\n### å–ä½™å’Œå–æ¨¡çš„åŒºåˆ«\n\nå¯¹äºæ•´å‹æ•°aï¼Œbæ¥è¯´ï¼Œå–æ¨¡è¿ç®—æˆ–è€…æ±‚ä½™è¿ç®—çš„æ–¹æ³•éƒ½æ˜¯æ±‚æ•´æ•°å•†\n1. `c = [a/b];`\n2. è®¡ç®—æ¨¡æˆ–è€…ä½™æ•°ï¼š`r = a - c * b`\n\næ±‚æ¨¡è¿ç®—å’Œæ±‚ä½™è¿ç®—åœ¨**ç¬¬ä¸€æ­¥ä¸åŒ**ï¼šå–ä½™è¿ç®—åœ¨å–å•†`c`çš„å€¼æ—¶ï¼Œå‘**0æ–¹å‘**èˆå…¥(`fix()`å‡½æ•°)ï¼›è€Œå–æ¨¡è¿ç®—åœ¨è®¡ç®—å•†`c`çš„å€¼æ—¶ï¼Œå‘**è´Ÿæ— ç©·æ–¹å‘**èˆå…¥(`floor()`å‡½æ•°)ã€‚\nä¾‹å¦‚è®¡ç®—ï¼š`-7 Mod 4`ã€‚é‚£ä¹ˆï¼š `a = -7; b = 4;`\nç¬¬ä¸€æ­¥ï¼šæ±‚æ•´æ•°å•†`c`ï¼Œå¦‚è¿›è¡Œæ±‚æ¨¡è¿ç®—`c=-2`(å‘è´Ÿæ— ç©·æ–¹å‘èˆå…¥)ï¼›æ±‚ä½™`c = -1`(å‘0æ–¹å‘èˆå…¥);\nç¬¬äºŒæ­¥ï¼šè®¡ç®—æ¨¡å’Œä½™æ•°çš„å…¬å¼ç›¸åŒï¼Œä½†å› `c`çš„å€¼ä¸åŒï¼Œæ±‚æ¨¡æ—¶`r = 1`ï¼Œæ±‚ä½™æ—¶`r = -3`ã€‚\nå½’çº³ï¼šå½“`a`å’Œ`b`åŒå·æ—¶ï¼Œæ±‚æ¨¡è¿ç®—å’Œæ±‚ä½™è¿ç®—æ‰€å¾—çš„`c`çš„å€¼ä¸€è‡´ï¼Œå› æ­¤ç»“æœä¸€è‡´ã€‚å½“ç¬¦å·å¼‚å·æ—¶ï¼Œç»“æœä¸â€”æ ·ã€‚\n**å¦å¤–å„ä¸ªç¯å¢ƒä¸‹`%`è¿ç®—ç¬¦çš„å«ä¹‰ä¸åŒï¼Œæ¯”å¦‚`c/c++`ã€javaä¸ºå–ä½™ï¼Œè€Œpythonåˆ™ä¸ºå–æ¨¡ã€‚**\n### `+=, *=`\n\n```c\nint a=3,b=5,c=7;\na *= b + c;\n//a = a * (b+c); //36\n```\n\nè¯´æ˜ï¼šåˆ«çœ‹`*=`é‡Œé¢è™½ç„¶å¸¦ä¹˜å·ï¼Œä½†æ˜¯å®ƒçš„ä¼˜å…ˆçº§æ˜¯å¾ˆä½çš„ã€‚\n### å‰ç½®`++`ã€åç½®`++`\n\nå¦‚æœæ²¡æœ‰èµ‹å€¼è¯­å¥ï¼Œæ•ˆæœå®Œå…¨ä¸€æ ·ï¼šå…ˆå–`a`ã€`b`ä¸­åŸæ•°åˆ°ä¸´æ—¶ç©ºé—´`eax`ï¼ˆcpuçš„å†…éƒ¨å¯„å­˜å™¨ï¼‰ï¼Œä¸´æ—¶ç©ºé—´æ•°æ®`+1`ï¼Œå†æŠŠåŠ `1`åçš„æ•°å€¼æ›´æ–°åˆ°`a`ã€`b`ä¸­ã€‚\n![image-20210713184548788](../../images/Cè¯­è¨€_210617/image-20210713184548788.png)\nå¦‚æœæœ‰èµ‹å€¼è¯­å¥ã€‚åˆ™åç½®++æ˜¯å…ˆæŠŠå€¼èµ‹ç»™cï¼Œå†+1å›å†™ï¼›è€Œå‰ç½®++æ˜¯å…ˆæ›´æ–°å˜é‡å€¼ï¼Œå†èµ‹å€¼åˆ°cã€‚\n![image-20210713184644291](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210713184644291.png)\n## å…¶ä»–è¯´æ˜\n\n1. å¯¹äºCè¯­è¨€ç¨‹åºï¼Œ`++i`å’Œ`i++`æ•ˆç‡æ˜¯ä¸€æ ·çš„ï¼›\n2. å¯¹äºGoLangï¼Œåªæœ‰`++i`ï¼Œæ²¡æœ‰`i++`ï¼›\n3. åœ¨é¢å‘å¯¹è±¡è¯­è¨€ä¸­å¦‚`C++`ã€Javaã€Pythonï¼Œ`++i`æ•ˆç‡æ¯”è¾ƒé«˜ï¼Œ`i++`æ•ˆç‡ä½ã€‚è‡³äºä¸ºä½•ï¼Œåœ¨C++éƒ¨åˆ†è®²è¿°ã€‚\n# å·¦å€¼å’Œå³å€¼\n\næŒ‰å­—é¢æ„æ€é€šä¿—åœ°è¯´ã€‚ä»¥èµ‹å€¼ç¬¦å·`=`ä¸ºç•Œï¼Œ`=`å·¦è¾¹çš„å°±æ˜¯å·¦å€¼ï¼Œ`=`å³è¾¹å°±æ˜¯å³å€¼ã€‚\næ›´æ·±ä¸€å±‚ï¼Œå¯ä»¥å°†`L-value`ç†è§£æˆå¯å¯»å€ã€‚A value (computer science) that has an addressï¼›`R-value`è¡¨ç¤ºå¯è¯»ã€‚\n# æŒ‡é’ˆ\n\nå†…å­˜ï¼ˆåœ¨ç¨‹åºä¸­ç§°ä¸ºä¸»å­˜DRAMï¼‰æ˜¯è®¡ç®—æœºä¸­é‡è¦çš„éƒ¨ä»¶ä¹‹ä¸€ï¼Œå®ƒæ˜¯å¤–å­˜ï¼ˆç¡¬ç›˜ï¼‰ä¸CPUè¿›è¡Œæ²Ÿé€šçš„æ¡¥æ¢ã€‚\n\n![image-20210714162919263](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210714162919263.png)\n\nè®¡ç®—æœºä¸­æ‰€æœ‰ç¨‹åºçš„è¿è¡Œéƒ½æ˜¯åœ¨å†…å­˜ä¸­è¿›è¡Œï¼Œä¸ºäº†æœ‰æ•ˆçš„ä½¿ç”¨å†…å­˜ï¼Œå°±**æŠŠå†…å­˜ä»¥8ä½äºŒè¿›åˆ¶ï¼ˆbitï¼‰åˆ’åˆ†ä¸ºå­˜å‚¨å•å…ƒï¼ˆä¹Ÿå°±æ˜¯ 1 å­—èŠ‚ï¼‰**ã€‚ä¸ºäº†æœ‰æ•ˆçš„è®¿é—®åˆ°å†…å­˜çš„æ¯ä¸ªå­˜å‚¨å•å…ƒï¼Œå°±ç»™å†…å­˜å­˜å‚¨å•å…ƒè¿›è¡Œäº†ç¼–å·ï¼Œè¿™äº›ç¼–å·è¢«ç§°ä¸ºè¯¥**å†…å­˜å­˜å‚¨å•å…ƒçš„åœ°å€**ã€‚\n\n![image-20210714162932627](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210714162932627.png)\n\nå­˜å‚¨åœ°å€çš„å˜é‡ç§°ä¸ºæŒ‡é’ˆå˜é‡ã€‚åœ¨C è¯­è¨€ä¸­æŒ‡é’ˆå°±æ˜¯åœ°å€ã€‚\n## æ‰“å°åœ°å€çš„æ–¹å¼\n### `%x`\n\n```c\n#include<stdio.h>\nint main()\n{\n    int a = 10;\n    printf(\"%x \\n\",&a);//è¾“å‡ºäº†ï¼š93fcb4ï¼ŒåŸæœ¬æ€»å…±æ˜¯8ä½ï¼Œå‰é¢çš„00èˆå»äº†\n    printf(\"%08x \\n\",&a);//è¾“å‡ºäº†006ffbc4ã€‚%åé¢è¡¥ä¸Š08ï¼Œ8ä»£è¡¨å®½åº¦ï¼Œ0ä»£è¡¨å®½åº¦ä¸å¤Ÿçš„æ—¶å€™è¡¥0\n    printf(\"%08X \\n\",&a);//è¾“å‡ºäº†ï¼š001AFDA8ã€‚xç”±å°å†™æ”¹ä¸ºå¤§å†™ï¼Œä»£è¡¨å­—æ¯ä»¥å¤§å†™å½¢å¼è¾“å‡ºã€‚\n    printf(\"0X%08X \\n\",&a);//è¾“å‡ºäº†ï¼š0X0113F944ã€‚%å‰åŠ ä¸Šäº†\"0X\"ï¼Œå®Œæ•´ã€å®Œç¾åœ°è¡¨ç¤ºäº†è¿™æ˜¯ä¸€ä¸ª16è¿›åˆ¶æ•°ã€‚\n    return 0;\n    \n}\n```\n### `%p`\n\n```c\n#include<stdio.h>\nint main()\n{\n    int a = 10;\n    printf(\"%p \\n\",&a);//è¾“å‡ºäº†ï¼š012FFBA4\n    printf(\"%#p \\n\",&a);//è¾“å‡ºäº†ï¼š0X00AFF8BCï¼Œä½†åœ¨VS2019é‡Œä¸æ”¯æŒï¼ŒVS2012ä¸­å¯ä»¥ã€‚\n    return 0;\n}\n```\n## è¯¥æ­»çš„æ˜Ÿå·`*`\n\n```c\nC/C++ *\n    int a = 10, b = 20;\n\tint c = a * b;\n\t\n\tint * p = &a;//*åœ¨æ­¤è¡¨è¾¾å¼ä¸­çš„ä½œç”¨åªæ˜¯å£°æ˜ã€æ ‡è¯†ã€‚açš„åœ°å€ç»™çš„æ˜¯pè€Œä¸æ˜¯*p\n\t*p = 100;//ä¸ä¸Šé¢ä¸€å¥ä¸­çš„*ä½œç”¨ä¸åŒï¼Œæ­¤å¤„*çš„ä½œç”¨æ˜¯æŒ‡å‘ã€è§£å¼•ç”¨ã€‚å¦‚æœpæ˜¯açš„åœ°å€ï¼Œé‚£ä¹ˆ*på°±æ˜¯aæœ¬èº«ã€‚\n```\n\nä¸Šè¿°ç»™äº†å‡ ä¸ªè¡¨è¾¾å¼ã€‚\n\n`a`ã€`b`ã€`c`ã€`p`éƒ½æ˜¯å˜é‡ã€‚**å˜é‡æœ€æ ¹æœ¬çš„åŒºåˆ«åœ¨äºï¼šç±»å‹**ã€‚\n\nè¦å½»åº•ç†è§£æ˜Ÿå·çš„ä¸åŒç”¨å¤„ï¼Œçªç ´ç‚¹åœ¨äºå¯¹å˜é‡çš„ç±»å‹çš„åŒºåˆ†ï¼\n\n`int * p = &a;`æ­¤å¤„`*`åœ¨å·¦ä¾§çš„ä½œç”¨åªæ˜¯ä¸€ä¸ªå£°æ˜ã€‚**å£°æ˜pæ˜¯ä¸€ä¸ªintç±»å‹çš„æŒ‡é’ˆå˜é‡**ã€‚å°±æ˜¯è¯´ï¼Œä½ åªè¦æ˜¯æ•´å‹å˜é‡ï¼Œé‚£ä¹ˆæˆ‘`p`å°±å¯ä»¥å­˜æ”¾ä½ çš„åœ°å€ã€‚æ­¤ä¾‹ï¼Œ`a`çš„åœ°å€ç»™çš„æ˜¯`p`è€Œä¸æ˜¯`*p`ã€‚æ‰€ä»¥`p`å’Œ`a`ã€`b`ã€`c`ä¸åŒä¹‹å¤„åœ¨äºï¼Œ`p`æ˜¯ä¸€ä¸ª`int`å‹æŒ‡é’ˆï¼Œ`a`ã€`b`ã€`c`åªæ˜¯`int`å‹ã€‚å› æ­¤`int p = &a;`è¿™å¥è¯å°±æ˜¯é”™è¯¯çš„ï¼š`&a`æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œè€Œ`p`æ˜¯`int`å‹ï¼Œç±»å‹ä¸åŒ¹é…ï¼Œæ— æ³•å­˜æ”¾ã€‚\n\n`*p = 100;`ä¸`int * p = &a;`ä¸­çš„`*`ä½œç”¨ä¸åŒï¼Œæ­¤å¤„`*`çš„ä½œç”¨æ˜¯æŒ‡å‘ã€è§£å¼•ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ**å¦‚æœpæ˜¯açš„åœ°å€ï¼Œé‚£ä¹ˆ`*p`å°±æ˜¯`a`æœ¬èº«**ã€‚æ­¤å¤„ä¸è¦æ‹¿â€œé—´æ¥è®¿é—®â€æ¥è§£é‡Šï¼Œåœ¨è¯­æ³•ä¸Šæ²¡æœ‰è¿™å›äº‹ã€‚\n## æŒ‡é’ˆçš„ä¸¤ä¸ªå€¼\n\n![image-20210714170927750](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210714170927750.png)\n\næ¯”å¦‚ï¼š`int a = 10;` `int* p = &a;`\n\nä¸€ä¸ªæ˜¯æœ¬èº«çš„å€¼ï¼Œå³æœ¬èº«å­˜å‚¨çš„å€¼ï¼Œå³æœ¬èº«å­˜å‚¨çš„æŸä¸ªåœ°å€å€¼ã€‚å³`0x0055f864`ã€‚æ­¤å€¼è¯´æ˜äº†å…¶æŒ‡å‘è°ã€‚å³`&a`ã€‚\n\nå¦ä¸€ä¸ªæ˜¯æœ¬èº«å­˜å‚¨çš„åœ°å€å€¼çš„çœŸå®å†…å®¹å€¼ï¼Œå³`a`ã€‚\n\nè™½ç„¶`p`æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œä½†å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå˜é‡ï¼Œæ‰€ä»¥ä»–ä¹Ÿæœ‰è‡ªå·±çš„åœ°å€ï¼Œå³`0x0055f84c`ã€‚\n## é€»è¾‘åç§°ä¸ç‰©ç†åœ°å€\n\næ¯”å¦‚ï¼šæˆ‘è¦åˆ°é‚¢åŒå­¦çš„å®¿èˆå»ï¼Œé‚¢åŒå­¦çš„å®¿èˆå°±æ˜¯é€»è¾‘åç§°ï¼Œè€Œ12å…¬å¯“328æ˜¯å…¶ç‰©ç†åœ°å€ã€‚é‚£ä¹ˆï¼Œé‚¢åŒå­¦çš„å®¿èˆå’Œ12å…¬å¯“328å®é™…ä¸Šå°±æ˜¯åŒä¸€ç©ºé—´ã€‚\n## å¯¹åº”åˆ°å†…å­˜æ¡ä¸Š\n\n![image-20210714171543412](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210714171543412.png)\n\n> å¯ä»¥æ‹“å±•çš„çŸ¥è¯†ç‚¹ï¼šå°ç«¯å­˜æ”¾ä¸å¤§ç«¯å­˜æ”¾\n\n## æŒ‡é’ˆç±»å‹çš„sizeof\n\n32ä½æœºçš„æŒ‡é’ˆä¸€æ¦‚éƒ½æ˜¯4ï¼›64ä½æœºçš„æŒ‡é’ˆä¸€æ¦‚éƒ½æ˜¯8ï¼\n\nå› ä¸º**ä¸ç®¡ä½ æ˜¯charç±»å‹ã€çŸ­æ•´å‹ã€æ•´å‹çš„å˜é‡çš„åœ°å€ï¼Œéƒ½åªæ˜¯å­˜æ”¾é¦–åœ°å€**ï¼Œå¯¹äº64ä½æœºï¼ŒæŸä¸€ç±»å‹çš„é¦–åœ°å€å°±å ç”¨64ä½bitä½ï¼Œ8ä¸ªå­—èŠ‚æ‰èƒ½å­˜æ”¾ï¼›åŒç†ï¼Œå¯¹äº32ä½æœºï¼ŒæŸä¸€ç±»å‹çš„é¦–åœ°å€å°±å ç”¨32ä½bitä½ï¼Œ4ä¸ªå­—èŠ‚æ‰èƒ½å­˜æ”¾ã€‚\n\n## æŒ‡é’ˆçš„ç±»å‹\n\n### é‡æŒ‡é’ˆ\n\n```c\n#include<stdio.h>\nint main()\n{\n    int a;\n    int* p;\n}\n```\n\nå°±åƒaæœªåˆå§‹åŒ–ï¼Œä¸æ¸…æ¥šå…¶å€¼æ˜¯å¤šå°‘ä¸€æ ·ã€‚æœªåˆå§‹åŒ–çš„pä¹Ÿä¸çŸ¥é“å…¶æŒ‡å‘çš„æ˜¯å“ªä¸ªåœ°å€ã€‚æ­¤ç±»æŒ‡é’ˆå«åšé‡æŒ‡é’ˆã€‚\n### ç©ºæŒ‡é’ˆ\n\n```c\n#include<stdio.h>\nint main()\n{\n    int* p=NULL;//æ­¤å¤„å°†ç”¨0ä»£æ›¿NULLèµ‹å€¼\n    int* s=nullptr;//æ­¤å¤„å°†ç”¨(void*)0ä»£æ›¿nullptrèµ‹å€¼\n}\n```\n\n![image-20210714234134586](../../images/Cè¯­è¨€_210617/image-20210714234134586.png)\n### å¤±æ•ˆæŒ‡é’ˆ\n\n### [ä»£ç ç¤ºä¾‹](#ä»£ç ç¤ºä¾‹_ç”Ÿå­˜æœŸ)\n\n```c\n#include<stdio.h>\nint * fun()\n{\n    int ar[10]={12,23,34,45,56,67,78,89,90,100};\n    int* p=&ar[0];\n    return p;\n}\nint main()\n{\n    inr* ip=fun();\n    for(int i=0;i<10;++i)\n    {\n        printf(\"%d\",*ip);\n        ip=ip+1;\n    }\n}\n```\n\n[è¿è¡Œç»“æœ](#è¿è¡Œç»“æœ_ç”Ÿå­˜æœŸ)\n## NULLä¸nullptr\n\nå®é™…ä¸Šè¿˜æ˜¯æœ‰ä¸€äº›å°çš„åŒºåˆ«ã€‚\n\n```c\nint* p = NULL;//æ­¤å¤„å°†ç”¨0ä»£æ›¿NULLèµ‹å€¼\nint* s = nullptr;//æ­¤å¤„å°†ç”¨(void*)0ä»£æ›¿nullptrèµ‹å€¼\n```\n\n# ç»“æ„ä½“\n\nç¨‹åºå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨ç»“æ„ä½“æ¥å°è£…ä¸€äº›å±æ€§ï¼Œæ ¹æ®åŸæœ‰çš„ç±»å‹ï¼Œè®¾è®¡å‡ºæ–°çš„ç±»å‹ï¼Œåœ¨Cè¯­è¨€ä¸­ç§°ä¸ºç»“æ„ä½“ç±»å‹ã€‚\nåœ¨Cè¯­è¨€ä¸­ï¼Œç»“æ„ä½“æ˜¯ä¸€ç§æ•°æ®ç±»å‹ã€‚\n## [Cè¯­è¨€ä¸­çš„ç±»å‹](#åŸºæœ¬æ•°æ®ç±»å‹)\n\n`char; short; int; long int; long long; float; double; long double; bool;`éƒ½æ˜¯**åŸºæœ¬ç±»å‹**ã€‚\n\n`char*; short*;`è¿™ç§æŒ‡é’ˆç±»å‹å’Œ`int ar[10]; br[20];`è¿™ç§æ•°ç»„ç±»å‹éƒ½å«åš**ç»“æ„ç±»å‹**ã€‚\n## ç»“æ„ä½“çš„ä½¿ç”¨\n\n```c\n#include<stdio.h>\nstruct Student\n{\n    char s_id[10];//å­¦å·\n    char s_name[10];//å§“å\n    char s_sex[5];//æ€§åˆ«\n    int s_age;//å¹´é¾„\n};\nint main()\n{\n    //å®šä¹‰ç»“æ„ä½“å˜é‡å¹¶åˆå§‹åŒ–\n    struct Student stud={\"202001\",\"tulun\",\"man\",15};\n    //sizeof(stud)?\n    //ä½¿ç”¨.ï¼ˆæˆå‘˜é€‰æ‹©(å¯¹è±¡)è¿ç®—ç¬¦ï¼‰è®¿é—®ç»“æ„ä½“å˜é‡çš„æˆå‘˜\n    printf(\"id: %s \\n\",stud.s_id);\n    printf(\"name: %s \\n\",stud.s_name);\n    printf(\"sex: %s \\n\",stud.s_sex);\n    printf(\"age: %d \\n\",stud.s_age);\n    return 0;\n}\n```\n\n## ç»“æ„ä½“çš„è®¿é—®å½¢å¼\n\n```c\nStudent  sx = {...};\nStudent* sp = &sx;\n\nå½¢å¼ä¸€ï¼š(*sx).s_id = 202001;//æ³¨æ„ï¼Œ*ï¼ˆå–å€¼è¿ç®—ç¬¦ï¼‰ä¼˜å…ˆçº§ä½äº.ï¼ˆæˆå‘˜é€‰æ‹©(å¯¹è±¡)è¿ç®—ç¬¦ï¼‰ï¼Œä½¿ç”¨å¿…é¡»ç»™*sxåŠ ä¸Šæ‹¬å·ï¼Œå¦åˆ™sxç›´æ¥å…ˆå’Œ.ç»“åˆï¼Œå¯¼è‡´é”™è¯¯ã€‚\nå½¢å¼äºŒï¼šsp->s_id   = 202001;//æˆå‘˜é€‰æ‹©(å¯¹è±¡æŒ‡é’ˆ)è¿ç®—ç¬¦\n```\n\n> æŒæ¡å¦‚ä½•è®¡ç®—ç»“æ„ä½“çš„sizeofã€‚\n# æ–‡ä»¶\n\n## æ•°æ®æµ\n\næŒ‡ç¨‹åºä¸æ•°æ®çš„äº¤äº’æ˜¯ä»¥æµçš„å½¢å¼è¿›è¡Œçš„ã€‚è¿›è¡ŒCè¯­è¨€æ–‡ä»¶çš„å­˜å–æ—¶ï¼Œéƒ½ä¼šå…ˆè¿›è¡Œâ€œæ‰“å¼€æ–‡ä»¶â€æ“ä½œï¼Œè¿™ä¸ªæ“ä½œå°±æ˜¯åœ¨æ‰“å¼€æ•°æ®æµï¼Œè€Œâ€œå…³é—­æ–‡ä»¶â€æ“ä½œå°±æ˜¯å…³é—­æ•°æ®æµã€‚\n## ç¼“å†²åŒºï¼ˆBufferï¼‰\n\næŒ‡åœ¨ç¨‹åºæ‰§è¡Œæ—¶ï¼Œæ‰€æä¾›çš„ä¸€å—å­˜å‚¨ç©ºé—´ï¼ˆåœ¨å†…å­˜ä¸­ï¼‰ï¼Œå¯ç”¨æ¥æš‚æ—¶å­˜æ”¾åšå‡†å¤‡æ‰§è¡Œçš„æ•°æ®ã€‚å®ƒçš„è®¾ç½®æ˜¯ä¸ºäº†æé«˜å­˜å–æ•ˆç‡ï¼Œå› ä¸ºå†…å­˜çš„å­˜å–é€Ÿåº¦æ¯”ç£ç›˜é©±åŠ¨å™¨å¿«å¾—å¤šã€‚\n\nCè¯­è¨€çš„æ–‡ä»¶å¤„ç†åŠŸèƒ½ä¾æ®ç³»ç»Ÿæ˜¯å¦è®¾ç½®â€œç¼“å†²åŒºâ€åˆ†ä¸ºä¸¤ç§ï¼šä¸€ç§æ˜¯è®¾ç½®ç¼“å†²åŒºï¼Œå¦ä¸€ç§æ˜¯ä¸è®¾ç½®ç¼“å†²åŒºã€‚ç”±äºä¸è®¾ç½®ç¼“å†²åŒºçš„æ–‡ä»¶å¤„ç†æ–¹å¼ï¼Œå¿…é¡»ä½¿ç”¨è¾ƒä½çº§åˆ«çš„ I/O å‡½æ•°(åŒ…å«åœ¨å¤´æ–‡ä»¶`io.h`å’Œ`fcntl.h`ä¸­)æ¥ç›´æ¥å¯¹ç£ç›˜å­˜å–ï¼Œè¿™ç§æ–¹å¼çš„å­˜å–é€Ÿåº¦æ…¢ï¼Œå¹¶ä¸”ç”±äºä¸æ˜¯Cçš„æ ‡å‡†å‡½æ•°ï¼Œè·¨å¹³å°æ“ä½œæ—¶å®¹æ˜“å‡ºé—®é¢˜ã€‚ä¸‹é¢åªä»‹ç»ç¬¬ä¸€ç§å¤„ç†æ–¹å¼ï¼Œå³è®¾ç½®ç¼“å†²åŒºçš„æ–‡ä»¶å¤„ç†æ–¹å¼ã€‚\n\nå½“ä½¿ç”¨æ ‡å‡†I/Oå‡½æ•°ï¼ˆåŒ…å«åœ¨å¤´æ–‡ä»¶`stdio.h`ä¸­ï¼‰æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è®¾ç½®ç¼“å†²åŒºï¼Œå¹¶é€šè¿‡æ•°æ®æµæ¥è¯»å†™æ–‡ä»¶ã€‚å½“è¿›è¡Œæ–‡ä»¶è¯»å–æ—¶ï¼Œä¸ä¼šç›´æ¥å¯¹ç£ç›˜è¿›è¡Œè¯»å–ï¼Œè€Œæ˜¯å…ˆæ‰“å¼€æ•°æ®æµï¼Œå°†ç£ç›˜ä¸Šçš„æ–‡ä»¶ä¿¡æ¯æ‹·è´åˆ°ç¼“å†²åŒºå†…ï¼Œç„¶åç¨‹åºå†ä»ç¼“å†²åŒºä¸­è¯»å–æ‰€éœ€æ•°æ®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n![image-20210713225323314](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210713225323314.png)\n\n## æ–‡ä»¶ç±»å‹\n\nåˆ†ä¸ºæ–‡æœ¬æ–‡ä»¶å’ŒäºŒè¿›åˆ¶æ–‡ä»¶ä¸¤ç§ã€‚\n\næ–‡æœ¬æ–‡ä»¶æ˜¯ä»¥å­—ç¬¦ç¼–ç çš„æ–¹å¼è¿›è¡Œä¿å­˜çš„ã€‚äºŒè¿›åˆ¶æ–‡ä»¶å°†å†…å­˜ä¸­æ•°æ®åŸå°ä¸è‡³æ–‡ä»¶ä¸­ï¼Œé€‚ç”¨äºéå­—ç¬¦ä¸ºä¸»çš„æ•°æ®ã€‚\n\nå¦‚æœä»¥è®°äº‹æœ¬æ‰“å¼€ï¼Œåªä¼šçœ‹åˆ°ä¸€å †ä¹±ç ã€‚\n\nå…¶å®ï¼Œé™¤äº†æ–‡æœ¬æ–‡ä»¶å¤–ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½å¯ä»¥ç®—æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ã€‚äºŒè¿›åˆ¶æ–‡ä»¶çš„ä¼˜ç‚¹åœ¨äºå­˜å–é€Ÿåº¦å¿«ï¼Œå ç”¨ç©ºé—´å°ï¼Œä»¥åŠå¯éšæœºå­˜å–æ•°æ®ã€‚\n\n## æ–‡ä»¶å­˜å–æ–¹å¼\n\nåŒ…æ‹¬é¡ºåºå­˜å–æ–¹å¼å’Œéšæœºå­˜å–æ–¹å¼ä¸¤ç§ã€‚\n\né¡ºåºè¯»å–ä¹Ÿå°±æ˜¯ä»ä¸Šå¾€ä¸‹ï¼Œä¸€ç¬”ä¸€ç¬”è¯»å–æ–‡ä»¶çš„å†…å®¹ã€‚ä¿å­˜æ•°æ®æ—¶ï¼Œå°†æ•°æ®é™„åŠ åœ¨æ–‡ä»¶çš„æœ«å°¾ã€‚è¿™ç§å­˜å–æ–¹å¼å¸¸ç”¨äºæ–‡æœ¬æ–‡ä»¶ï¼Œè€Œè¢«å­˜å–çš„æ–‡ä»¶åˆ™ç§°ä¸ºé¡ºåºæ–‡ä»¶ã€‚\n\néšæœºå­˜å–æ–¹å¼å¤šåŠä»¥äºŒè¿›åˆ¶æ–‡ä»¶ä¸ºä¸»ã€‚å®ƒä¼šä»¥ä¸€ä¸ªå®Œæ•´çš„å•ä½æ¥è¿›è¡Œæ•°æ®çš„è¯»å–å’Œå†™å…¥ï¼Œé€šå¸¸ä»¥ç»“æ„ä¸ºå•ä½ã€‚\n\n## Cè¯­è¨€æä¾›çš„æ ‡å‡†æ–‡ä»¶\n\né€šå¸¸æŠŠæ˜¾ç¤ºå™¨ç§°ä¸ºæ ‡å‡†è¾“å‡ºæ–‡ä»¶ï¼Œ`printf`å°±æ˜¯å‘è¿™ä¸ªæ–‡ä»¶è¾“å‡ºæ•°æ®ï¼›\n\né€šå¸¸æŠŠé”®ç›˜ç§°ä¸ºæ ‡å‡†è¾“å…¥æ–‡ä»¶ï¼Œ`scanf`å°±æ˜¯ä»è¿™ä¸ªæ–‡ä»¶è¯»å–æ•°æ®ã€‚\n\n![image-20210713225726024](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210713225726024.png)\n# å…³é”®å­—\n## const\n\nconståœ¨å®é™…ç¼–ç¨‹ä¸­ç”¨å¾—æ¯”è¾ƒå¤šï¼Œconstæ˜¯constantçš„ç¼©å†™ï¼Œæ„æ€æ˜¯â€œæ’å®šä¸å˜çš„â€ï¼å®ƒæ˜¯å®šä¹‰**åªè¯»å˜é‡**çš„å…³é”®å­—ï¼Œæˆ–è€…è¯´ const æ˜¯å®šä¹‰å¸¸å˜é‡çš„å…³é”®å­—ã€‚ï¼ˆå¯è¯»ï¼Œä¸å¯å†™ï¼‰\n\nconstå¯ä»¥ä¿®é¥°å˜é‡ï¼Œæ•°ç»„ï¼ŒæŒ‡é’ˆç­‰ï¼›è¯´constå®šä¹‰çš„æ˜¯å˜é‡ï¼Œä½†åˆç›¸å½“äºå¸¸é‡ï¼›è¯´å®ƒå®šä¹‰çš„æ˜¯å¸¸é‡ï¼Œä½†åˆæœ‰å˜é‡çš„å±æ€§ï¼Œæ‰€ä»¥å«å¸¸å˜é‡ã€‚\n\nç”¨constå®šä¹‰å¸¸å˜é‡çš„æ–¹æ³•å¾ˆç®€å•ï¼Œå°±åœ¨é€šå¸¸å®šä¹‰å˜é‡æ—¶å‰é¢åŠ  const å³å¯ï¼Œå¦‚ï¼š`const int a = 10;`æˆ–`int const a = 10;`è€Œä¸”**å¯ä»¥ä¿®é¥°ä»»ä½•ç±»å‹çš„å˜é‡**ï¼ŒåŒ…æ‹¬æ•°ç»„ã€‚\n\né‚£ä¹ˆç”¨constä¿®é¥°åå’Œæœªä¿®é¥°å‰æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿç”¨constå®šä¹‰çš„å˜é‡çš„å€¼æ˜¯ä¸å…è®¸æ”¹å˜çš„ï¼Œå³ä¸å…è®¸ç»™å®ƒé‡æ–°èµ‹å€¼ï¼Œå³ä½¿æ˜¯èµ‹ç›¸åŒçš„å€¼ä¹Ÿä¸å¯ä»¥ã€‚æ‰€ä»¥è¯´å®ƒå®šä¹‰çš„æ˜¯åªè¯»å˜é‡ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€**å¿…é¡»åœ¨å®šä¹‰çš„æ—¶å€™å°±ç»™å®ƒèµ‹åˆå€¼**ã€‚æ— è®ºæ˜¯å…¨å±€å¸¸å˜é‡è¿˜æ˜¯å±€éƒ¨å¸¸å˜é‡éƒ½å¿…é¡»åˆå§‹åŒ–èµ‹å€¼ã€‚\n### æ³¨æ„äº‹é¡¹\n\n```c\n#include<stdio.h>\nint main()\n{\n    const int a = 10;\n    int* ip = &a;//è¿™ç§å†™æ³•æ˜¯é”™è¯¯çš„ï¼Œä¼šäº§ç”ŸäºŒä¹‰æ€§ï¼Œå› ä¸ºè¿™æ ·å†™çš„æ„ä¹‰ä½•åœ¨ï¼Ÿä½ çš„aåˆ°åº•èƒ½å˜è¿˜æ˜¯ä¸èƒ½å˜ï¼\n    //æœ‰ä¸€ç§åŠæ³•èƒ½è®©æ­¤è¯­å¥æˆåŠŸç¼–è¯‘ï¼Œå°±æ˜¯å¼ºè½¬ç±»å‹ï¼šint* ip = (int*)&a;ä½†æ˜¯å¼ºè½¬ç±»å‹ä¼šå‡ºä¹±å­ã€‚è¯¦çœ‹ä¸‹æ–‡ã€Šä¸€å®¶ç½‘ç»œå…¬å¸çš„æŸä¸ªè¯•é¢˜ã€‹ã€‚\n    //è¿˜æœ‰ä¸€ç§åŠæ³•èƒ½æˆç«‹ï¼Œå°±æ˜¯æŠŠå·¦å¼å£°æ˜éƒ¨åˆ†åŠ ä¸Šconstæ¥ä¿®é¥°ï¼Œå³const int* ip = &a;è¿™æ ·åšï¼šipå°±å¯ä»¥æŒ‡å‘aäº†ï¼Œä½†ä¸å¯ä»¥é€šè¿‡ipæ”¹å˜aã€‚è€Œä¸”è¿™æ ·åšä¼šå¯¼è‡´ä¸‹é¢çš„è¯­å¥\"*ip = 100\"æŠ¥é”™ï¼šâ€œè¡¨è¾¾å¼å¿…é¡»æ˜¯å¯ä¿®æ”¹çš„å·¦å€¼â€ã€‚å› ä¸ºipæŒ‡å‘çš„å€¼æ˜¯æ‹¿constä¿®é¥°çš„ï¼Œæ­¤å¤„å°±è¯†åˆ«ä¸ºä¸å¯ä¿®æ”¹äº†ï¼\n    *ip = 100;\n    return 0;\n}\n```\n\næ€»ç»“ï¼šconstä¸åªèƒ½ä¿®é¥°æ™®é€šç±»å‹ã€æ•°ç»„ï¼Œè¿˜èƒ½ä¿®é¥°æŒ‡é’ˆï¼ˆæ¯”å¦‚ä¿®é¥°æŒ‡é’ˆçš„å…¶ä¸€ç§ç‰¹æ€§â€”â€”**ä¿®é¥°æŒ‡é’ˆçš„æŒ‡å‘èƒ½åŠ›**ï¼Œè¾¾åˆ°äº†ä¿æŠ¤çš„æ•ˆæœï¼Œå°±å¦‚`const int* ip = &a`ï¼Œè¾¾åˆ°äº†é€šè¿‡ipåªèƒ½è¯»å–aï¼Œä¸å¯å†™çš„æ•ˆæœï¼‰ã€‚ä»¥æ­¤ç±»æ¨ï¼ŒCè¯­è¨€è¿˜æœ‰ï¼š`int* const is;` `const int* const ir;`å…¶ä¸­`const int* const ir;`çš„å‰ä¸€ä¸ªæŒ‡é’ˆæ˜¯ä¿®é¥°æŒ‡å‘ä¸å¯æ”¹å˜ï¼Œåä¸€ä¸ªconstæ˜¯ä¿®é¥°æŒ‡é’ˆè‡ªèº«ä¸å¯æ”¹å˜ã€‚\n### ä¸€å®¶ç½‘ç»œå…¬å¸çš„æŸä¸ªè¯•é¢˜\n\n```c\n#include<stdio.h>\nint main()\n{\n    const int a = 10;\n    int b = 0;\n    int* ip = (int*)&a;\n    *ip = 100;\n    b = a;\n    printf(\"a = %d \\n\",a);\n    printf(\"b = %d \\n\",b);\n    printf(\"*ip => %d \\n\",*ip);\n    return 0;\n}\n```\n\n`*.cpp`æ–‡ä»¶çš„è¿è¡Œç»“æœå¦‚ä¸‹ï¼Œæ­¤ç»“æœæ˜¯æ¯”è¾ƒç¬¦åˆconstè¿™ä¸ªå…³é”®å­—çš„åŠŸèƒ½çš„ã€‚\n\n![image-20210715011105297](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210715011105297.png)\n\nä½†æ˜¯ï¼Œæ­¤è¿è¡Œç»“æœå´å’Œè°ƒè¯•è¿‡ç¨‹ä¸­çš„æ˜¾ç¤ºç»“æœä¸ä¸€è‡´ï¼\n\n![image-20210715010757756](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210715010757756.png)\n\nå‰ä¹è¡Œè¿è¡Œæ˜¯ç¬¦åˆæ™®é€šäººï¼ˆæ²¡æœ‰æ·±åˆ»ç†è§£constï¼‰çš„æ€è·¯çš„ï¼Œ`a`é€šè¿‡æŒ‡é’ˆ`ip`è¢«èµ‹å€¼`100`ã€‚ä½†å¥‡æ€ªçš„æ˜¯ï¼šç¬¬åè¡Œè¿è¡Œå`b=a;`è¿™ä¸ªè¯­å¥å±…ç„¶æ˜¯ç»™`b`èµ‹å€¼äº†`10`ã€‚\n\nå¦å¤–ï¼Œcæ–‡ä»¶çš„è¾“å‡ºç»“æœå´æ˜¯ï¼š\n\n![image-20210715012709734](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210715012709734.png)\n\nè¿™åˆæ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Ÿè¯¦è§ä¸‹é¢ã€Šè§£é‡Šã€‹çš„è®ºè¿°ã€‚\n#### è§£é‡Š\n##### cppæ–‡ä»¶ä¸‹çš„ç»“æœ\nåœ¨`*.cpp`æ–‡ä»¶ä¸­ï¼Œconstå˜é‡å’Œå®å˜é‡éƒ½æ˜¯æ›¿æ¢æœºåˆ¶æ¥å®ç°çš„ï¼Œä½†constæ˜¯åœ¨ç¼–è¯‘æ—¶æœŸæ›¿æ¢çš„ï¼Œå®å˜é‡æ˜¯åœ¨é¢„ç¼–è¯‘æ—¶æœŸæ›¿æ¢çš„ã€‚\n\n![image-20210715011908929](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210715011908929.png)\n![image-20210715012233908](../../images/Cè¯­è¨€_210617/image-20210715012233908.png)\nå†æ¥ä¸€æ®µæ±‡ç¼–ä»£ç ï¼Œå‘ç°`a=b;`è¿™æ¡è¯­å¥å¹¶ä¸æ˜¯æŠŠaå–å€¼ç»™bï¼Œè€Œæ˜¯ç”¨`0Ah`ï¼ˆ10çš„åå…­è¿›åˆ¶ï¼‰ç›´æ¥èµ‹ç»™bã€‚\n\næ‰€ä»¥ï¼Œæ— è®ºè¾“å‡ºå‰å¯¹aè¿›è¡Œäº†å“ªäº›æ“ä½œéƒ½æ˜¯å¾’åŠ³çš„ï¼Œå› ä¸ºaæ—©å·²â€œå·æ¢æ¢æŸ±â€ï¼Œæ‰€ä»¥å°±ä¼šå‡ºç°äº†æˆ‘ä»¬å•æ­¥è·Ÿè¸ªç»“æœå’Œæœ€ç»ˆè¾“å‡ºç»“æœä¸ä¸€è‡´çš„æƒ…å†µã€‚\n\nä¸Šä¾‹ç»™æˆ‘ä»¬ä¸€ä¸ªå¯å‘ï¼Œä¸è¦ç›¸ä¿¡ä½ çš„çœ¼ç›ï¼Œè€Œè¦ç›¸ä¿¡ä½ æ‰€åˆ†æçš„ä»£ç ã€‚\n##### Cæ–‡ä»¶ä¸‹çš„ç»“æœ\n\nCæ–‡ä»¶ä¸‹çš„ç»“æœå±…ç„¶åˆæˆäº†`a=100, b=100, *ip=100`ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ¥åˆ†æï¼š\n![image-20210715012838790](../../images/Cè¯­è¨€_210617/image-20210715012838790.png)\nå¯¹äº`b=a;`è¿™ä¸ªè¯­å¥ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼šä¸åƒcppæ–‡ä»¶é‚£æ ·ç”¨`0Ah`ç›´æ¥èµ‹å€¼ï¼Œè€Œæ˜¯å…ˆå–açš„å€¼å†èµ‹ç»™bã€‚å› ä¸º`*ip`æ”¹å˜äº†açš„å€¼ï¼Œæ‰€ä»¥bçš„å€¼ä¹Ÿå°†å—åˆ°å½±å“ã€‚\n#### æ€»ç»“\nå¯¹äºè¢«constå…³é”®å­—ä¿®é¥°çš„å˜é‡ï¼šåœ¨cppæ–‡ä»¶ä¸‹æ˜¯ç¼–è¯‘æ—¶æœŸç”¨å…·ä½“å€¼æ›¿æ¢å˜é‡åï¼›è€Œåœ¨cæ–‡ä»¶ä¸‹ï¼Œç¼–è¯‘æ—¶æœŸä¸æ›¿æ¢ã€‚äºæ˜¯é€ æˆäº†è¾“å‡ºç»“æœçš„å·®å¼‚ã€‚\n#### æ‹“å±•--æ±‡ç¼–ä¸ç¨‹åºçš„è”ç³»\n**æ±‡ç¼–å±‚é¢ä¸‹çš„èµ‹å€¼**ï¼ˆ`b=a;`ï¼‰\ncpuä¸­åŒ…å«ç€4ä¸ªé€šç”¨æ•°æ®å¯„å­˜å™¨ï¼šå«åš`eax`ã€`ebx`ã€`ecx`ã€`edx`ã€‚cpuåœ¨è¿›è¡ŒåŠ å‡ä¹˜é™¤ã€æ•°æ®è¿ç®—æ—¶ä¸æ˜¯åœ¨å†…å­˜ä¸­è¿ç®—çš„ï¼Œè€Œæ˜¯æŠŠå†…å­˜æ•°æ®æ‹‰åˆ°å¯„å­˜å™¨ä¸­è®¡ç®—ï¼Œå› ä¸ºå†…å­˜çš„è®¡ç®—é€Ÿåº¦è¿œæ¯”cpuè®¡ç®—é€Ÿåº¦æ…¢ã€‚\næ‰€ä»¥ï¼Œå°±å‡ºç°äº†ä¸ºä½•`b=a;`åœ¨æ±‡ç¼–è¯­è¨€å±‚é¢ä¸Šæ˜¯å–å‡ºaçš„å€¼ç»™eaxå†ç”±eaxèµ‹å€¼ç»™bï¼Œè€Œä¸æ˜¯aç›´æ¥èµ‹å€¼ç»™bã€‚\n![image-20210715014252117](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210715014252117.png)\nDMAæ–¹å¼ï¼Œä¹Ÿå«åšI/Oåå¤„ç†å™¨ã€‚å½“æˆ‘ä»¬å†…å­˜è¦ç§»åŠ¨å¤§å—æ•°æ®æ—¶ï¼Œå¦‚æœè¦ä»‹å…¥cpuçš„è¯å¤ªå½±å“è¿è¡Œæ•ˆç‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¤§å—æ•°æ®äº¤ç»™DMAï¼ˆåå¤„ç†å™¨ï¼‰è¿›è¡Œæ•°æ®ç§»åŠ¨ï¼Œä»è€ŒæŠŠCPUèµ„æºè…¾å‡ºæ¥ç”¨äºè®¡ç®—ï¼Œæé«˜æ•ˆç‡ã€‚\n**æ±‡ç¼–å±‚é¢ä¸‹çš„è§£å¼•ç”¨**ï¼ˆ`*ip=100;`ï¼‰\n![image-20210715014516247](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210715014516247.png)\né¦–å…ˆæŠŠipçš„å€¼æ”¾å…¥åˆ°å¯„å­˜å™¨eaxä¸­ï¼Œé‚£ä¹ˆeaxçš„å€¼å°±ç›¸å½“äºaçš„åœ°å€ï¼Œå†å¾€ä¸‹ï¼ŒæŠŠ`64h`ï¼ˆ100çš„åå…­è¿›åˆ¶ï¼‰ç»™äº†`[eax]`ã€‚æ­¤æ—¶æ³¨æ„ï¼š`mov eax,10;`å’Œ`mov [eax],10;`è¿™ä¸¤ç§è®¿é—®æ–¹å¼ä¸ä¸€æ ·ã€‚å‰è€…æ˜¯ç›´æ¥è®¿é—®æ–¹å¼ï¼ŒæŠŠ10ç»™äº†eaxï¼›åè€…æ˜¯é—´æ¥è®¿é—®æ–¹å¼ï¼Œä¸æ˜¯æŠŠ10ç»™äº†eaxï¼Œè€Œæ˜¯æŠŠ10ç»™äº†eaxæ‰€å­˜æ”¾çš„æŸä¸ªåœ°å€é‡Œã€‚å› æ­¤ï¼Œç›´æ¥è®¿é—®æ˜¯ä¸€æ­¥æ±‡ç¼–å®ç°ï¼Œé—´æ¥è®¿é—®æ˜¯ä¸¤æ­¥æ±‡ç¼–å®ç°ï¼Œæ‰€ä»¥ç›´æ¥è®¿é—®æ•ˆç‡è¦é«˜äºé—´æ¥è®¿é—®ã€‚\n## sizeofå…³é”®å­—\nå·²åœ¨ä¸Šé¢ç« èŠ‚è®ºè¿°ã€‚\n\næ­¤å¤„å†å¼•å…¥å‡ ä¸ªæœ‰å¯å‘çš„ä¾‹å­ã€‚\n![image-20210714003229156](../../images/Cè¯­è¨€_210617/image-20210714003229156.png)\næ­¤é¢˜è¿è¡Œåçš„sizeè¿˜æ˜¯4ï¼Œaè¿˜æ˜¯10ï¼å¯ä»æ±‡ç¼–è§’åº¦è§‚å¯Ÿç©¶ç«Ÿï¼\n![image-20210715021922182](../../images/Cè¯­è¨€_210617/image-20210715021922182.png)\nå¯ç¤ºï¼š**sizeofåªåœ¨ç¼–è¯‘æ—¶æœŸè®¡ç®—**è€Œä¸æ˜¯è¿è¡Œæ—¶æœŸè®¡ç®—ï¼Œç›¸å½“äºç›´æ¥æ›¿æ¢ä¸º4ã€‚å› æ­¤`++a`è¿™ä¸ª`++`çš„åŠ¨ä½œå°±å¤±å»äº†æ„ä¹‰ï¼Œç¼–è¯‘æ—¶å°±ç›´æ¥ç•¥å»äº†`++`è¿™ä¸ªæ“ä½œã€‚å› æ­¤åé¢açš„å€¼æ²¡æœ‰å˜åŒ–ã€‚\n![image-20210714003659077](../../images/Cè¯­è¨€_210617/image-20210714003659077.png)\næ­¤ç¨‹åºè¿è¡Œåçš„sizeå¤§å°ä¸º8ï¼Œå³doubleç±»å‹æ‰€å ç”¨çš„ç©ºé—´ã€‚å› ä¸ºåœ¨ç¼–è¯‘æ—¶æœŸsizeofå°±è¯†åˆ«åˆ°äº†`(a+0.9)`è¿™ä¸ªæ•°å€¼ä¸ºdoubleç±»å‹ã€‚\n**sizeofçš„æœ¬è´¨æ˜¯åªå…³å¿ƒä½ æ­¤å¤„çš„æ•°å€¼æœ€ç»ˆçš„ç±»å‹**ã€‚\n### sizeofå’Œstrlençš„å·®å¼‚\n![image-20210715021416730](../../images/Cè¯­è¨€_210617/image-20210715021416730.png)\nå®é™…ç»“æœä¸ºï¼šlenä¸º6ï¼Œsizeä¸º7ã€‚å› ä¸ºå­—ç¬¦ä¸²å®é™…å ç”¨äº†7ä¸ªå­—èŠ‚ã€‚å­—ç¬¦ä¸²çš„æœ€åæ˜¯è¦æœ‰`\\0`ç»“å°¾çš„ï¼›è€Œlençš„è®¡ç®—æ˜¯ï¼šä¸€ç¢°åˆ°`\\0`å°±ç»“æŸè®¡ç®—ã€‚\n## typedef\n\ntypedefæ˜¯åœ¨è®¡ç®—æœºç¼–ç¨‹è¯­è¨€ä¸­ç”¨æ¥ä¸ºå¤æ‚çš„å£°æ˜å®šä¹‰ç®€å•çš„åˆ«åã€‚å®ƒæœ¬èº«æ˜¯ä¸€ç§å­˜å‚¨ä¹‹ç±»çš„å…³é”®å­—ï¼Œä¸`auto`ã€`extern`ã€`mutable`ã€`static`ã€`register`ç­‰å…³é”®å­—ä¸èƒ½å‡ºç°åœ¨åŒä¸€ä¸ªè¡¨è¾¾å¼ä¸­ã€‚\n\n```c\n#include<stdio.h>\ntypedef unsigned char u_int8;\ntypedef unsigned short u_int16;\ntypedef unsigned int u_int32;\ntypedef unsigned long long u_int64;\nint main()\n{\n    u_int8 a;//ç­‰æ•ˆäºunsigned char a;\n    u_int64 x;//ç­‰æ•ˆäºunsigned long long x;\n    return 0;\n}\n```\n\nä¸€å®šè¦è®°ä½ï¼šå‡¡æ˜¯åˆæ³•çš„å˜é‡åå£°æ˜ã€æ•°æ®å£°æ˜ã€æŒ‡é’ˆå£°æ˜ï¼ŒåŠ ä¸€ä¸ªtypedefåæˆ‘ä»¬å°±å¯ä»¥æŠŠå˜é‡åè½¬æ¢ä¸ºç±»å‹åï¼ŒæŠŠå˜é‡å£°æ˜å®šä¹‰è½¬æ¢ä¸ºç±»å‹å£°æ˜å®šä¹‰ã€‚\n\n```c\nunsigned int UNIT;//åŸæ¥çš„å˜é‡åå£°æ˜\ntypedef unsigned int UNIT;//UNITç”±ä¸€ä¸ªå…¨å±€å˜é‡è½¬æ¢æˆäº†ä¸€ä¸ªç±»å‹ï¼\nUNIT a;\n```\n\n```c\nint Array[10];\ntypedef int Array[10];//Arrayç”±å…¨å±€å˜é‡è½¬æ¢æˆäº†ä¸€ä¸ªâ€œå¼€è¾Ÿ10ä¸ªç©ºé—´çš„æ•´å‹æ•°ç»„ç±»å‹â€\nArray ar,br,cr;\n```\n\næœ‰äººè¿™ä¹ˆè®¤ä¸ºï¼šè®¤ä¸ºtypedefæ˜¯ç”¨æ›¿æ¢åŸåˆ™æ¥å®ç°çš„ï¼Œå¦‚æŠŠ`\"Array\"`æ›¿æ¢ä¸º`\"int[10]\"`ï¼Œå³`Array ar, br, cr;`æ›¿æ¢ä¸º`int[10] ar,br,cr;`ï¼Œè¿™æ˜¯ä¸å¯¹çš„ã€‚å®ƒæ˜¯ä¸€ç§ç±»å‹çš„**å£°æ˜**æ¦‚å¿µã€‚\n\n```c\nint* PINT;\ntypedef int* PINT;\nPINT p,s;//p,sæ˜¯ä»€ä¹ˆç±»å‹å‘¢ï¼Ÿå›åˆ°typedef int* PINT;ï¼ŒæŠŠtypedefå»æ‰å³å¯å¾—çŸ¥â€”â€”på’Œséƒ½æ˜¯int*ç±»å‹ã€‚\n```\n\nä¸Šä¾‹ä¸­ï¼Œ`PINT p,s;`å’Œ`int* x,y;`æ˜¯æœ‰åŒºåˆ«çš„ï¼æˆ‘ä»¬åœ¨ç¼–è¯‘å™¨ä¸­å‘ç°ï¼Œxæ˜¯æ•´å‹æŒ‡é’ˆå˜é‡ï¼Œè€Œyæ˜¯æ•´å‹å˜é‡ã€‚å› ä¸ºå£°æ˜æ—¶ï¼Œæˆ‘ä»¬çš„æ˜Ÿå·`*`è¦å’Œæ ‡è¯†ç¬¦ç»“åˆï¼Œè€Œä¸æ˜¯å’Œç±»å‹åç»“åˆã€‚æ‰€ä»¥å½“æˆ‘ä»¬æ¶‰åŠåˆ°ä¸ºå¤šä¸ªæŒ‡é’ˆå£°æ˜æ—¶ï¼Œç”¨åˆ°typedefçš„æ–¹å¼å°±ç‰¹åˆ«å¥½ã€‚\n![image-20210715121438344](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210715121438344.png)\n\n```c\nstruct ListNode\n{\n    int data;\n    ListNode* next;\n};\nListNode* LinkList;//åŸæœ¬æ˜¯ä¸€ä¸ªâ€œæŸä¸€ç»“æ„ä½“ç±»å‹çš„æŒ‡é’ˆå˜é‡â€\ntypedef ListNode* LinkList;//ç”±å…¨å±€ç»“æ„ä½“æŒ‡é’ˆå˜é‡è½¬å˜ä¸ºäº†ä¸€ä¸ªç±»å‹\n//å¦‚æ­¤å®šä¹‰ï¼Œé‚£ä¹ˆä»¥ä¸‹ä¸¤å¥å°±ç­‰æ•ˆ\nListNode* p;\nLinkList s;\n```\n\n```c\n//æ­¤æ—¶ï¼ŒLinkListåŸæœ¬æ˜¯ä¸€ä¸ªâ€œå…¨å±€ç»“æ„ä½“ç±»å‹çš„æŒ‡é’ˆå˜é‡â€\nstruct ListNode\n{\n    int data;\n    ListNode* next;\n}*LinkList;\n//æˆ‘ä»¬ä¹ŸåŠ ä¸Šä¸€ä¸ªtypedefï¼Œç°åœ¨ï¼ŒLinkListå°±ä¸å†æ˜¯ä¸€ä¸ªæŒ‡é’ˆå˜é‡äº†ï¼Œè€Œæ˜¯ä¸€ä¸ªç±»å‹ã€‚\ntypedef struct ListNode\n{\n    int data;\n    ListNode* next;\n}*LinkList;\n//å®é™…ä¸Šï¼Œä»¥ä¸Šè¿™ç§typedefç›´æ¥åœ¨å®šä¹‰ç»“æ„ä½“æ—¶åŠ åœ¨å‰é¢çš„å†™æ³•å’Œtypedef ListNode* LinkList;è¿™ç§å†™æ³•ä¹Ÿæ˜¯ç­‰ä»·çš„ã€‚\n```\n\n```c\n//å†æ¥ä¸€ä¸ªå¥‡æ€ªçš„ä¾‹å­ï¼š\n//é¦–å…ˆï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œint int;æ˜¯ä¸å¯èƒ½è¿™æ ·å£°æ˜å®šä¹‰å˜é‡åçš„ã€‚å› ä¸ºä»–æ‹¿å…³é”®å­—ï¼ˆåŸºæœ¬æ•°æ®ç±»å‹åï¼‰æ¥èµ·åå­—ã€‚\n//ä½†å¦‚æœæ²¡æ‹¿å…³é”®å­—èµ·åå­—çš„è¯ï¼Œå˜é‡åå’Œç±»å‹åå¯ä»¥ä¸€æ ·å—ï¼Ÿ\nstruct ListNode\n{\n    int data;\n    ListNode* next;\n};\nListNode ListNode;//æ˜¯å¯ä»¥ç¼–è¯‘é€šè¿‡çš„ï¼Œæœ€å¤šå°±æ˜¯è­¦å‘Šã€‚\n//ç­”æ¡ˆæ˜¯å¯ä»¥ä¸€æ ·ï¼å› ä¸ºæ­¤ç±»å‹åã€å˜é‡åå¹¶éå…³é”®å­—ï¼Œåªè¦ç¬¦åˆæ ‡è¯†ç¬¦çš„å‘½åè§„èŒƒï¼Œæ˜¯æ²¡æœ‰ä»»ä½•å½±å“çš„ï¼\n\n//å› æ­¤ï¼Œä¸‹ä¾‹çš„ListNodeåŸæœ¬æ˜¯ä¸€ä¸ªâ€œç»“æ„ä½“ç±»å‹çš„å˜é‡åâ€\nstruct ListNode\n{\n    int data;\n    ListNode* next;\n}ListNode;\n//å¦‚ä»Šæˆ‘ä»¬åœ¨ç»“æ„ä½“å®šä¹‰å‰åŠ ä¸€ä¸ªtypedefï¼Œä»–å°±å¯ä»¥å˜ä¸ºäº†ä¸€ä¸ªç±»å‹åï¼\ntypedef struct ListNode\n{\n    int data;\n    ListNode* next;\n}ListNode;\n//é‚£ä¹ˆï¼Œ\ntypedef ListNode ListNode;//å°±ä¸ä¹‹ç­‰æ•ˆã€‚\n//è¿™ç§å®šä¹‰æ–¹å¼å¸¸å¸¸å‡ºç°åœ¨å¼€æºé¡¹ç›®ä¸­ï¼Œè¿·æƒ‘è°ƒè¯•å™¨ï¼Œè¿½è¸ªå˜é‡æ—¶ææ··å˜é‡åå’Œç±»å‹åã€‚ä¸ºçš„å°±æ˜¯ä¸è®©ä½ çœ‹æ‡‚ã€‚\n```\n\n```c\n//å¦‚æ­¤ï¼Œç†è§£äº†typedefçš„å«ä¹‰ã€‚æˆ‘ä»¬å¯ä»¥å¦‚ä¸‹ä½¿ç”¨\ntypedef struct ListNode\n{\n    int data;\n    ListNode* next;\n}ListNode,*LinkList;\nint main()\n{\n    ListNode a;\n    LinkList p;\n    p = &a;\n    return 0;\n}\n```\n\n```c\n//ä¹Ÿå¯ç”¨ä½œå¯¹æšä¸¾ç±»å‹çš„å®šä¹‰\ntypedef enum{OK = 0,ERROR = 1} Status;\n```\n## static\n### ä¿®é¥°å±€éƒ¨å˜é‡\né™æ€å…³é”®å­—å¯¹äºå±€éƒ¨å˜é‡æ¥è¯´æ˜¯å»¶é•¿å¯¿å‘½çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡½æ•°åªæœ‰è¢«è°ƒç”¨æ—¶ï¼Œå±€éƒ¨å˜é‡æ‰ä¼šè¢«åˆå§‹åŒ–ï¼Œå‡½æ•°è°ƒç”¨ç»“æŸæ—¶ä¼šé‡Šæ”¾æ‰æ‰€æœ‰å±€éƒ¨å˜é‡ã€‚å¦‚æœæˆ‘ä»¬ç»™å±€éƒ¨å˜é‡åŠ ä¸Šäº†staticä¿®é¥°ï¼Œé‚£ä¹ˆå‡½æ•°åœ¨ç¬¬ä¸€æ¬¡è¢«è°ƒç”¨æ—¶åˆå§‹åŒ–äº†å±€éƒ¨å˜é‡ï¼Œå³ä½¿è°ƒç”¨ç»“æŸåï¼Œå±€éƒ¨å˜é‡ä¹Ÿä¸ä¼šé‡Šæ”¾ï¼Œå³å±€éƒ¨å˜é‡çš„å¯¿å‘½æ¯”å‡½æ•°è¦é•¿ã€‚\n\n```c\n#include<stdio.h>\nvoid fun(int x)\n{\n    int a = x;\n    int b = 0;\n    ++a;++b;\n    printf(\"a : %d b = %d \\n\",a,b);\n    return;\n}\nint main()\n{\n    for(int i=10;i>0;--i)\n    {\n        fun(i);\n    }\n    return 0;\n    //å°†è¾“å‡ºï¼š\n    //11 1\n    //10 1\n    //9  1\n    //...\n    //2  1\n}\n```\n\n```c\n#include<stdio.h>\nvoid fun(int x)\n{\n    static int a = x;//è¿™ä¸€æ­¥æ˜¯å®šä¹‰aå¹¶å¯¹aåˆå§‹åŒ–ï¼Œåªæ‰§è¡Œä¸€æ¬¡ã€‚\n    int b = 0;\n    ++a;++b;\n    printf(\"a : %d b = %d \\n\",a,b);\n    return;\n}\nint main()\n{\n    for(int i=10;i>0;--i)\n    {\n        fun(i);\n    }\n    return 0;\n    //å°†è¾“å‡ºï¼š\n    //11 1\n    //12 1\n    //13 1\n    //...\n    //20 1\n    //æ­¤è¾“å‡ºç»“æœè¯´æ˜ï¼Œè™½ç„¶fun(i)ä¸€ç›´åœ¨ç»™xä¼ å‚èµ‹å€¼ç»™aï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯æ— æ•ˆçš„ï¼Œå› ä¸ºå£°æ˜å®šä¹‰è¯­å¥å·²ç»åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨funå‡½æ•°è¿›è¡Œäº†ï¼Œâ€œä¸€åŠ³æ°¸é€¸â€äº†\n}\n```\n\nå¯¹äºç¬¬äºŒæ®µä»£ç ï¼šåœ¨å‡½æ•°è¢«ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬åˆ›å»ºaï¼Œå¹¶æŠŠå®ƒå­˜æ”¾åˆ°æ•°æ®åŒºï¼ˆdata areaï¼‰ã€‚å‡½æ•°ç»“æŸåï¼Œaä¹Ÿä¸é‡Šæ”¾ã€‚ç¬¬äºŒæ¬¡è°ƒç”¨æ—¶ï¼Œ`static int a = x;`è¿™ä¸€è¯­å¥ä¸å†æ‰§è¡Œã€‚è¿™ä¸€æ­¥æ˜¯å®šä¹‰aå¹¶å¯¹aåˆå§‹åŒ–ï¼Œåªæ‰§è¡Œä¸€æ¬¡ã€‚ä½†æ˜¯å†™æˆ`a = x;`å°±ä¸ä¸€æ ·äº†ã€‚`a = x;`æ˜¯ä¸€å¥æ‰§è¡Œè¯­å¥ï¼Œåœ¨æ¯æ¬¡å‡½æ•°è°ƒç”¨ä¹Ÿè¿˜æ˜¯è¦æ‰§è¡Œçš„ï¼\n\nä½†ï¼Œstaticä¿®é¥°å±€éƒ¨å˜é‡ä¸æ”¹å˜å…¶ä½œç”¨åŸŸã€‚\n### ä¿®é¥°å…¨å±€å˜é‡\n\nè€Œstaticä¿®é¥°å…¨å±€å˜é‡æ—¶ï¼Œä¸æ”¹å˜å…¶ç”Ÿå­˜æœŸï¼Œè€Œæ”¹å˜å…¶å¯è§æ€§ï¼ˆåªèƒ½åœ¨å½“å‰cppæ–‡ä»¶ä¸­å¯è§ï¼Œå³ä½¿å…¶ä»–æ–‡ä»¶ä¸­çš„ä»£ç æ‹¿externæ¥ä¿®é¥°è¿™ä¸ªå˜é‡ï¼ŒåŒä¸€å·¥ç¨‹çš„å¦å¤–cppæ–‡ä»¶ä¹Ÿä¸å¯è§ï¼‰ã€‚\n## extern\n\nexternç”¨åœ¨å…¨å±€å˜é‡æˆ–å‡½æ•°çš„å£°æ˜å‰ï¼Œç”¨æ¥è¯´æ˜â€œæ­¤å˜é‡/å‡½æ•°æ˜¯åœ¨åˆ«å¤„å®šä¹‰çš„ï¼Œè¦åœ¨æ­¤å¤„å¼•ç”¨â€ã€‚\n\nå‡å¦‚æˆ‘ä»¬åŒä¸€ä¸ªå·¥ç¨‹ä¸‹æœ‰ä¸¤ä¸ªcppæ–‡ä»¶ï¼Œå…¶ä¸­æœ‰ä¸€cppæ–‡ä»¶ç”¨åˆ°äº†å¦ä¸€ä¸ªcppæ–‡ä»¶çš„å†…å®¹ã€‚ä»ç†è®ºä¸Šè®²ï¼Œä¸¤ä¸ªcppæ–‡ä»¶å„è‡ªç¼–è¯‘åå½¢æˆäº†å„è‡ªçš„objæ–‡ä»¶ï¼Œä¹‹åé“¾æ¥åˆ°äº†ä¸€ä¸ªexeæ–‡ä»¶ä¸‹ï¼ˆè¿™ä¸ªexeæ–‡ä»¶å°±æ˜¯ä»¥å·¥ç¨‹ä¸ºå•ä½ç”Ÿæˆçš„ï¼‰ï¼Œç†è®ºä¸Šï¼Œ`Test7_10`æ–‡ä»¶ä¸­çš„`g_max`å’Œ`fun()`å¯ä»¥è‡ªç„¶åœ°è°ƒç”¨`yhp`æ–‡ä»¶ä¸­çš„å˜é‡ã€å‡½æ•°ã€‚ç¼–è¯‘æ˜¯å¯ä»¥è¿›è¡Œçš„ï¼Œä½†æ˜¯ï¼Œç”Ÿæˆæ˜¯ä¸é€šè¿‡çš„ã€‚\n\n![image-20210715124558882](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210715124558882.png)\n\n![image-20210715125037821](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210715125037821.png)\n\næˆ‘ä»¬è¿™æ—¶å°±éœ€è¦åœ¨`Test7_10.cpp`ä¸­æ·»åŠ ä»£ç äº†ï¼šå¦‚ä¸‹æ‰èƒ½è¿è¡ŒæˆåŠŸã€‚\n![image-20210715125337615](../../images/Cè¯­è¨€_210617/image-20210715125337615.png)\nå¦‚æœåœ¨ä¸€ä¸ªcppæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬ä¸æƒ³è®©å…¶ä»–æ–‡ä»¶ç”¨externæ¥è°ƒç”¨è‡ªå·±çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™äº›å†…å®¹å‰åŠ ä¸Šstaticä¿®é¥°ï¼ˆéœ€è¦æ˜¯å…¨å±€å˜é‡ï¼‰ã€‚å› ä¸ºï¼Œåœ¨å…¨å±€å˜é‡å‰åŠ staticä¼šæ”¹å˜å…¶å¯è§æ€§ã€‚ï¼ˆåªèƒ½åœ¨å½“å‰cppæ–‡ä»¶ä¸­å¯è§ï¼Œå³ä½¿å…¶ä»–æ–‡ä»¶ä¸­çš„ä»£ç æ‹¿externæ¥ä¿®é¥°è¿™ä¸ªå˜é‡ï¼ŒåŒä¸€å·¥ç¨‹çš„å¦å¤–cppæ–‡ä»¶ä¹Ÿä¸å¯è§ï¼‰ã€‚\n\nè€Œå¦‚æœä¸€ä¸ªcppæ–‡ä»¶å·²ç»æ‹¿staticä¿®é¥°äº†å˜é‡åï¼Œå¦ä¸€ä¸ªcppè¿˜ç”¨externæ¥å¼•ç”¨çš„è¯ï¼Œå°±ä¼šå¤±è´¥ï¼Œè¿™æ—¶å‡ºç°äº†ä¸‹é¢è¦è®ºè¿°çš„æŠ€æœ¯ï¼Œä¹Ÿå°±æ˜¯è®©è¿™ä¸ªå¼•ç”¨å¤±è´¥çš„æœºåˆ¶â€”â€”åå­—ç²‰ç¢æŠ€æœ¯ã€‚\n### åå­—ç²‰ç¢æŠ€æœ¯\n![image-20210714175813243](../../images/Cè¯­è¨€_210617/image-20210714175813243.png)\n# VS2019çš„ä½¿ç”¨\n\n### åˆ›å»ºé¡¹ç›®\n\n![image-20210712150544136](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210712150544136.png)\n\n![image-20210712150616048](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210712150616048.png)\n\n![image-20210712150647588](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210712150647588.png)\n\n![image-20210712150735990](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210712150735990.png)\n\n![image-20210712150755672](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210712150755672.png)\n\n![image-20210712150817409](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210712150817409.png)\n\n![image-20210712150827045](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210712150827045.png)\n## scanfçš„æ³¨æ„äº‹é¡¹\n\nS2019ä¸­ä¸å†ä½¿ç”¨`scanf`ï¼Œè€Œæ˜¯æ¢ä¸ºäº†`scanf_s`ã€‚\nè¾“å…¥æ•°æ®æ—¶ï¼Œè¦ä¸¥æ ¼æŒ‰ç…§åŒå¼•å·å†…çš„æ ¼å¼æ¥è¾“å…¥ã€‚\n### ä¸ºä½•è¦ç”¨`scanf_s`æ›¿æ¢`scanf`ï¼Ÿ\n\nscanfä¸å®‰å…¨ã€‚æ¯”å¦‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª`int a = 10;` `char buff[8];`\nå¦‚æœç”¨`scanf(\"%s\",buff);`è¾“å…¥å­—ç¬¦ä¸²è¶…è¿‡8ä½æ—¶ï¼Œæ¯”å¦‚è¾“å…¥`yhpingaaaaaaaa`ï¼Œä¼šæŠŠaä¸­çš„ä¿¡æ¯â€œå†²æ‰â€ã€‚ï¼ˆä»…é™äº`VC++ 6.0`è¿™ç§æ¯”è¾ƒå¤è€çš„ç¼–è¯‘å™¨ä¸­ï¼‰\næœ€åç”¨`printf(\"a=%x\",a);`æŸ¥çœ‹aæ—¶ï¼Œå‘ç°`a=61616161`ã€‚61æ˜¯åå…­è¿›åˆ¶ï¼Œè½¬ä¸ºåè¿›åˆ¶ä¸º97ï¼Œè¡¨ç¤ºå­—ç¬¦`'a'`çš„ASCIIç å€¼ã€‚æ‰€ä»¥æ­¤å¤„å°±ä½“ç°å‡ºäº†scanfå¯¹å†…å­˜çš„ä¸å®‰å…¨æ€§ã€‚\nè€Œ`scanf_s`åˆ™é¿å…äº†è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¾“å…¥æ—¶åŠ ä¸€ä¸ªå‚æ•°ï¼š`scanf_s(\"%s\",buff,8);`é™åˆ¶è¾“å…¥å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚\n# æœ‰å¯å‘æ„ä¹‰çš„ä»£ç å®éªŒ\n\n![image-20210713192127424](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210713192127424.png)\n\n![image-20210714143758025](../../images/C%E8%AF%AD%E8%A8%80_210617/image-20210714143758025.png)\n\né¦–å…ˆæˆ‘ä»¬è¦æ¸…æ¥š16è¿›åˆ¶ä¸2è¿›åˆ¶ä¹‹é—´çš„å…³ç³»ï¼Œæ‰èƒ½æ¸…æ¥šå­˜å‚¨ç©ºé—´æ˜¯å¦‚ä½•å­˜å‚¨æ•°æ®çš„ã€‚**å­˜å‚¨ç©ºé—´ä¸­å¯¹æ•°æ®çš„å­˜æ”¾æ˜¯ä»¥åå…­è¿›åˆ¶å½¢å¼å­˜å‚¨çš„**ï¼Œæ¥ä¸‹æ¥æ˜¯å¯¹æ­¤çš„ä¸¾ä¾‹è§£é‡Šï¼š\n\næ¯”å¦‚intå äº†4ä¸ªå­—èŠ‚ï¼Œç­‰äºå äº†32ä¸ªäºŒè¿›åˆ¶ä½ï¼Œè€Œ4ä¸ªäºŒè¿›åˆ¶ä½å¯ä»¥è½¬æ¢ä¸º1ä¸ª16è¿›åˆ¶ä½ï¼Œäºæ˜¯intå­˜å‚¨çš„æ•°æ®å¯ä»¥ç”±`32/4=8ä½16è¿›åˆ¶ä½`æ¥è¡¨ç¤ºã€‚æ¯”å¦‚æˆ‘ä»¬`int i = 10;`é‚£ä¹ˆåœ¨å­˜å‚¨ç©ºé—´ä¸­å°±æ˜¯`(0a 00 00 00)16`ã€‚åè¿›åˆ¶çš„10è½¬æ¢æˆäº†åå…­è¿›åˆ¶çš„aã€‚\n\næ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥è§£é‡Šä¸ºä½•è¾“å‡ºäº†`\"a=61616161\"`ï¼š\n\nå‡½æ•°ä¸­çš„å˜é‡æ˜¯å­˜æ”¾åœ¨æ ˆåŒºçš„ï¼Œå› ä¸ºå…ˆå®šä¹‰äº†`a`ï¼Œæ ˆåº•å¼€è¾Ÿ`a`çš„ç©ºé—´ï¼Œ`a`å ç”¨4ä¸ªå­—èŠ‚å…ˆå­˜æ”¾æ•°å€¼`12`ã€‚è€Œåï¼Œ`char`ç±»å‹çš„`buff[8]`æ•°ç»„å ç”¨`a`ä¹‹ä¸Šçš„`8`ä¸ªå­—èŠ‚ï¼›`scanf`è¾“å…¥`%s`æ—¶ï¼Œä¸ç›´æ¥å­˜æ”¾å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯å­˜æ”¾å­—ç¬¦ä¸²çš„ASCIIç å€¼ï¼Œæ¯”å¦‚å­—ç¬¦`'a'`çš„ASCIIç å€¼æ˜¯91ï¼Œå†è½¬æ¢ä¸ºåå…­è¿›åˆ¶å€¼`61`ã€‚åœ¨å­˜æ”¾äº†ä¸€éƒ¨åˆ†å­—ç¬¦ä¸²`\"yhpingaa\"`ä¹‹åï¼ŒåŸæœ¬åœ¨å†…å­˜ä¸­ç»™`buff`æ•°ç»„å­˜æ”¾çš„ç©ºé—´ä¸è¶³ï¼Œå‰©ä¸‹çš„`\"aaaaaa\"`å°±ç”±ä¸Šåˆ°ä¸‹ï¼ˆå°ç«¯å­˜æ”¾æ–¹å¼--é«˜ä½åœ°å€å­˜é«˜ä½æ•°æ®ï¼Œä½ä½åœ°å€å­˜ä½ä½æ•°æ®ï¼‰è¦†ç›–åˆ°äº†å†…å­˜ä¸­ç»™aå˜é‡å¼€è¾Ÿçš„å­˜å‚¨ç©ºé—´çš„4ä¸ªå­—èŠ‚ä¸­å»äº†ï¼Œå¹¶ä¸”è¿˜æœ‰å¯èƒ½å ç”¨äº†aç©ºé—´ä»¥å¤–çš„æœªçŸ¥å†…å­˜èµ„æºä¸­ï¼Œå› ä¸º`int a`åªèƒ½å­˜æ”¾4ä¸ªå­—èŠ‚å³4ä¸ªå­—ç¬¦å€¼ï¼Œè€Œå‰©ä½™açš„æ•°ç›®è¶…è¿‡äº†4ä¸ªã€‚","categories":["C"]},{"title":"Blog_æ¨¡æ¿","url":"/Blog_æ¨¡æ¿/","content":"\n# Content\n\n![](../images/Blog_æ¨¡æ¿/image-20240719024203996.png)\n\n","categories":["C"]}]