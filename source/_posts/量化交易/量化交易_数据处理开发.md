---
title: 量化交易_数据处理开发
categories:
  - - 量化交易
tags:
date: 2025/9/8
updated: 2025/9/8
comments:
published: false
---
要的结果：pdiff、ndiff的绝对值 大于 一个阈值，并持续一段时间，报警。最好用Cpp程序编写

这是一段可以参考的程序：

```cpp
        Array<double, Dynamic, 1> pdiff = (ecbps - epaps) + estrikes - fap_; //!< long fut, short opt (buy put sell call)
        Array<double, Dynamic, 1> ndiff = (ecaps - epbps) + estrikes - fbp_; //!< short fut, long opt (buy call sell put)

        // filter false-positive chance as option volumes too small to hedge even 1 hand of futures
        pdiff = (pdiff.isNaN() || ecbvs<ohands_ || epavs<ohands_ || estrikes<fap_).select(0, pdiff);
        ndiff = (ndiff.isNaN() || ecavs<ohands_ || epbvs<ohands_ || estrikes>fbp_).select(0, ndiff);

        LOG_INFO(gOutLogger, "pdiff: {}, ndiff: {}", pdiff.maxCoeff(), ndiff.minCoeff());

        ////TODO commission & order fee (1RMB per order)
        if (Index maxidx; flshr_<=0 && pdiff.maxCoeff(&maxidx) > thresh_)
        {
            LOG_WARNING(gOutLogger, "+F({}) -O({}: -C({}|{}) +P({}|{})) found! CrossSpread Profit({})!", fap_, strikes_[maxidx],
                        ecbps[maxidx], ecbvs[maxidx], epaps[maxidx], epavs[maxidx], pdiff[maxidx]);
            auto& order = orders_[(ordid_++) % kOrderNum];
            memset(&order, 0, sizeof(Order));
            PrepareOrder(order, epaps[maxidx], 1+ocalls_.size()+maxidx);//!< insert order for in-money put, and wait for filled
            const Event event = {Event::EventType::kOrderInsert, reinterpret_cast<std::byte*>(&order)};
            eventq_->TryPush(event);
        }

        if (Index minidx; fsshr_>=0 && ndiff.minCoeff(&minidx) < -thresh_)
        {////TODO might sign of fsshr
            LOG_WARNING(gOutLogger, "-F({}) +O({}: +C({}|{}) -P({}|{})) found! CrossSpread Profit({})!", fbp_, strikes_[minidx],
                        ecaps[minidx], ecavs[minidx], epbps[minidx], epbvs[minidx], ndiff[minidx]);
            auto& order = orders_[(ordid_++) % kOrderNum];
            memset(&order, 0, sizeof(Order));
            PrepareOrder(order, epaps[minidx], 1+minidx);//!< insert order for in-money call, and wait for filled
            const Event event = {Event::EventType::kOrderInsert, reinterpret_cast<std::byte*>(&order)};
            eventq_->TryPush(event);
        }
```

ecbps: 看涨期权的买报价：所有看涨期权合约的买报价组成的数组。
1. e代表类似于SIMD的加速技术（Eigen 库的向量化操作）
2. c代表ticker里面的中缀，`MO2509-[C/P]-XXXX`中间的C。call，代表涨期权
3. b代表bidprice，bidprc
4. p代表price
5. s代表复数

epaps: 看跌期权的卖报价：所有看跌期权合约的卖报价组成的数组。
1. e
2. p代表ticker里面的中缀，`MO2509-[C/P]-XXXX`中间的P。put，代表跌期权
3. a代表askprice，askprc
4. p代表price
5. s代表复数

ecaps: 看涨期权的卖报价
1. e
2. c: call
3. a: ask
4. p: price
5. s: 代表复数

epbps: 看跌期权的买报价
1. e
2. p: put
3. b: bid
4. p: price
5. s: 代表复数

estrikes: 所有期权合约的行权价组成的数组。
strike代表ticker后缀

fap: future ask price，fap 应该是 期货的买入价格（ask price），即期货的 askprc（askprc）。
fbp: future bid price，fbp 应该是 期货的卖出价格（bid price），即期货的 bidprc（bidprc）。

ecbvs: **E​**​igen数组，​**​C​**​all期权，​**​B​**​id ​**​V​**​olume (量)，对应`ecbps`价格上的买入量。

ohands: 期权手数阈值，用于过滤小成交量（避免无法对冲）

thresh: 套利阈值，由策略参数设定（例如，10 表示 10 个最小变动单位）

有2种情况：
1. 同一个时间戳，两个同时出现，直接相减
2. 同一个时间戳，一个出现，用出现的这个 和 未出现的上一个时间数据相减

​​pdiff策略 (Long Fut, Short Opt)​​: `(ecbps - epaps) + estrikes - fap_`
​​动作​​：卖出一个Call期权（收到权利金ecbps），买入一个Put期权（支付权利金epaps），同时买入期货（支付`fap_`）。
​​逻辑​​：如果这个组合的成本`(epaps - ecbps) + fap_`远低于行权价`estrikes`，就存在无风险套利空间。所以公式计算结果`pdiff`越大越好。
​​ndiff策略 (Short Fut, Long Opt)​​: `(ecaps - epbps) + estrikes - fbp_`
​​动作​​：买入一个Call期权（支付权利金ecaps），卖出一个Put期权（收到权利金epbps），同时卖出期货（收到`fbp_`）。
​​逻辑​​：如果这个组合的收入`(epbps - ecaps) + fbp_`远高于行权价`estrikes`，就存在无风险套利空间。所以公式计算结果`ndiff`越小（负得越多）越好。


一共发了3个文件：（截取部分）
1. futopt.csv.xz，内容是不同Ticker的报价信息，因为这些Ticker的条数比较稀疏，所以就写在了一个文件里。
2. IM2509.csv.xz，内容是只有IM2509这个Ticker的报价信息。
3. 20250905.0.csv，内容是有哪些Ticker。

# futopt.csv.xz内容
opt代表的是option。期权。

HO2509-C-2000.CFFEX​​ 这个标识符的意思是：
HO​​：这代表​​标的资产​​，即这个期权合约所对应的期货合约。
在 ​​CFFEX（中国金融期货交易所）​​ 的语境下，​​HO 特指“热轧卷板”期货​​。
（请注意：在国际市场上，HO 有时也代表取暖油期货，但代码后缀是 .CFFEX，明确了这是中国国内的交易所产品，因此毫无疑问是热轧卷板。）
​​在中国金融期货交易所（CFFEX）上市的，以2025年9月交割的热轧卷板期货（HO2509）为标的物的，行权价格为2000元/吨的看涨期权合约。​
特点是：
1. ets 会重复，ticker 也会重复
2. 3个期货的ticker会按照顺序，分别按C、P，以行权价格从低到高循环。比如HO、IO、MO。
3. 重点关注 askprc、bidprc。askprc 是卖报价，一般高一些；bidprc 是买报价，一般低一些。

```csv
ets,              lts,             ticker,             cvol,camnt,oi,last,askprc,askvol,bidprc,bidvol
20250905092900300,1757035740427646,HO2509-C-2000.CFFEX,  0,     0,82, 886, 926.8,     1,   870,     1
20250905092900300,1757035740427648,HO2509-C-2050.CFFEX,0,0,29,860.6,876.6,1,819.8,1
20250905092900300,1757035740427649,HO2509-C-2100.CFFEX,0,0,22,790.2,826.6,1,769.8,1
...
20250905092900300,1757035740427741,HO2509-C-3200.CFFEX,0,0,6709,2.6,5,21,2.4,4
20250905092900300,1757035740427742,HO2509-C-3250.CFFEX,0,0,2074,1.8,2.4,1,1.4,2
20250905092900300,1757035740427751,HO2509-C-3300.CFFEX,0,0,2664,1.6,2.2,1,1.2,15

20250905092900300,1757035740427755,HO2509-P-2000.CFFEX,  0,     0,502,0.4,0.6,       6,    0.2,     1
20250905092900300,1757035740427756,HO2509-P-2050.CFFEX,0,0,195,0.4,29,1,0.2,1
20250905092900300,1757035740427760,HO2509-P-2100.CFFEX,0,0,228,0.4,29,1,0.2,1
...
20250905092900300,1757035740427869,HO2509-P-3200.CFFEX,0,0,269,297.2,318,1,289,1
20250905092900300,1757035740427874,HO2509-P-3250.CFFEX,0,0,108,348.6,367,1,338,1
20250905092900300,1757035740427876,HO2509-P-3300.CFFEX,0,0,46,407,416.2,1,387.2,1

20250905092900300,1757035740427879,HO2510-C-2475.CFFEX,0,0,19,421.2,454.4,1,407,1
20250905092900300,1757035740427882,HO2510-C-2500.CFFEX,0,0,22,404.2,430.2,1,382.8,1
20250905092900300,1757035740427883,HO2510-C-2550.CFFEX,0,0,22,351.4,382,1,334.6,1
...
20250905092900300,1757035740427928,HO2510-C-3200.CFFEX,0,0,190,16.8,18.8,1,6.6,3
20250905092900300,1757035740427934,HO2510-C-3250.CFFEX,0,0,680,12,29,1,5,3
20250905092900300,1757035740427935,HO2510-C-3300.CFFEX,0,0,1340,9.4,9.8,10,9,1

20250905092900300,1757035740427938,HO2510-P-2475.CFFEX,0,0,158,3.6,29,1,1.2,3
20250905092900300,1757035740427945,HO2510-P-2500.CFFEX,0,0,96,4.2,29,1,0.8,5
20250905092900300,1757035740427946,HO2510-P-2550.CFFEX,0,0,205,5.4,29,1,1.6,2
...
20250905092900300,1757035740428009,HO2510-P-3200.CFFEX,0,0,15,314.2,335.8,1,288.4,1
20250905092900300,1757035740428019,HO2510-P-3250.CFFEX,0,0,20,367,382,1,334.8,1
20250905092900300,1757035740428022,HO2510-P-3300.CFFEX,0,0,32,410,429,1,381.8,1

......HO2511
......HO2512

......IO

......MO     ------ 此处及之前的ets都是一样的：20250905092900300

......HO2509 ------ 此处的ets不一样了：       20250905093000300
......
......HO2606
......

......IO2509
......
......MO
```
详细解读与分析
1. 数据范围与结构：文件包含了多个品种的合约，从您提供的数据片段可以看到：
    1. HO (热轧卷板)​​: 主力合约是 HO2509（2025年9月到期），同时也包括 HO2510（2025年10月）、HO2511、HO2512甚至 HO2606（2026年6月）等远期合约。
    2. IO (沪深300股指期权)​​: 您提到了 IO2509。
    3. MO (中证1000股指期权)​​: 您提到了 MO。
    4. （隐含的）IF/IH/IM等期货​​: 虽然没列出，但这类文件通常也包含对应的股指期货合约数据。
2. 对于每个品种的每个合约，数据都按照相同的字段结构排列，这与 IM2509.csv 结构一致。
3. 关键字段的深入解读（以期权为例）以 HO2509-C-2000.CFFEX这行数据为例：
    1. 20250905092900300,1757035740427646,HO2509-C-2000.CFFEX,0,0,82,886,926.8,1,870,1
    2. cvolume=0, camount=0​​: ​​这是一个非常关键的信息​​。这表明从当天开盘到这一时刻（09:29:00.300），​​这个特定的期权合约还没有发生过任何交易​​。市场可能刚刚开盘，或者这个合约的交易非常不活跃。
    3. oi=82​​: 虽然没交易，但市场上存在82手的未平仓合约。这意味着在之前的日子里有投资者开立了这些头寸并持有至今。
    4. last=886​​: 这是​​最后记录到的成交价​​。因为今天还没交易（cvolume=0），所以这个 last价格是​​上一个交易日的结算价或收盘价​​，并不是当前实时产生的。
    5. askprc=926.8, askvol=1​​: 当前市场上的​​卖一价​​是926.8元/吨，并且只有1手合约等待卖出。
    6. bidprc=870, bidvol=1​​: 当前市场上的​​买一价​​是870元/吨，并且只有1手合约等待买入。
    7. 买卖价差（Spread）​​: 926.8 - 870 = 56.8。价差很大，这通常意味着​​流动性较差​​。做市商或交易者不愿意同时提供紧密的买卖报价。
4. 从数据中能看出什么市场信息？
    1. 市场状态​​：这张快照很可能拍摄于​​开盘集合竞价阶段刚结束、连续交易刚开始的瞬间​​（09:29:00）。很多合约的当日累计成交量还为0，说明交易才刚刚开始，市场正在寻找价格和流动性。
    2. 流动性分布​​：平值期权附近流动性较好​​：对于 HO2509期权，行权价围绕标的期货当时价格（例如7000左右）的合约，其买卖挂单量（askvol和 bidvol）会相对大一些，价差也更小。
    3. 虚值和实值期权流动性差​​：从数据中可以看到，越是深度虚值（如行权价3300的看涨期权 C-3300）或深度实值（如行权价3300的看跌期权 P-3300）的合约，买卖价差越大，挂单量也经常只有1手。交易这些合约的成本很高。
    4. 波动率微笑（Volatility Smile）​​：如果将这些不同行权价的期权隐含波动率计算出来并画成曲线，通常不会是一条水平线，而是一个“微笑”或“倾斜”的曲线。这份数据中的买卖报价就是计算隐含波动率的原始输入。
    5. 期限结构​​：文件包含了同一品种（如HO）不同到期月（2509, 2510, 2511...）的合约。可以比较它们的价格，分析市场的远期预期，这被称为期限结构。
5. 总结：futopt.csv.xz 文件是一个​​全市场、多品种、高频的衍生品行情快照数据​​。它的核心价值在于提供了​​同一时间点上​​所有合约的可比信息，用于：
    1. ​​风险管理​​：计算投资组合的整体风险暴露
    2. 量化交易​​：为统计套利、做市商策略、期权定价模型提供输入数据。
    3. 市场研究​​：分析市场流动性、波动率曲面、投资者情绪等。
    4. 合规与监控​​：监控市场在特定时刻的运行状态。
# IM2509.csv.xz内容
一般ets在1秒里2次timestamp，所以500ms一次。

特点是：
1. ets不重复

```csv
ets,lts,cvolume,camount,oi,last,askprc,askvol,bidprc,bidvol
20250905092900300,1757035740327543,272,381964160,188932,7021.400000000001,7021.6,1,7021.4,3
20250905093000300,1757035800352536,334,469035360,188936,7022.8,7022.8,9,7021.8,2
20250905093000800,1757035800852808,457,641814560,188862,7022.8,7023,1,7022.8,12
20250905093001300,1757035801355591,515,723294680,188820,7026.6,7026.6,1,7025,1
20250905093001800,1757035801853825,594,834308000,188758,7026.6,7028,17,7026.2,1
20250905093002300,1757035802353855,652,915827320,188726,7026.6,7029,9,7026.6,6
20250905093002800,1757035802853893,696,977675920,188690,7028.2,7030,10,7028.6,1
20250905093003300,1757035803351431,751,1055008720,188662,7030.4,7033,2,7030.4,3
20250905093003800,1757035803853191,800,1123931880,188629,7033,7033.8,10,7033,4
20250905093004300,1757035804354019,870,1222382680,188580,7033,7033,11,7030,8
```


这个文件是一份中证1000股指期货主力合约在2025年9月5日早上9:29至9:30左右的高频交易数据快照。
它记录了在极短时间内（以毫秒甚至微秒为单位）市场的交易和报价情况，通常用于高频交易分析、市场微观结构研究或程序化交易。
文件各列字段含义解析：
每一行代表在某个特定时刻记录下的市场数据快照。
- ets (Exchange Timestamp) ： 交易所时间戳。
    - 格式为 YYYYMMDDHHMMSSFFF（年月日时分秒毫秒）。
    - 例如 20250905092900300 表示 2025年9月5日 9点29分00秒300毫秒。
- lts (Local Timestamp) ： 本地接收时间戳。
    - 通常是从某个纪元（如1970年1月1日）开始计算的纳秒数。这个时间戳是数据接收者（如券商或数据服务商）本地生成的时间，精度极高，用于记录确切的数据到达时间。1757035740327543 就是一个纳秒级的时间戳。
- cvolume (Cumulative Volume) ： 累计成交量。
    - 表示从当天开盘到当前时间戳为止，该合约的总成交量（单位：手）。从272手逐渐增加到870手。
- camount (Cumulative Amount) ： 累计成交金额。
    - 表示从当天开盘到当前时间戳为止，该合约的总成交金额（单位：元）。从约3.82亿元增加到约12.22亿元。
- oi (Open Interest) ： 持仓量。
    - 表示到当前时间点，市场上所有未平仓的合约总量（单位：手）。它在这一分钟内从188932手缓慢下降到188580手，说明有少量平仓交易发生。
- last (Last Price) ： 最新成交价。
    - 在该时间点最新一笔交易的成交价格。例如 7021.4。
- askprc (Ask Price) ： 卖一价。
    - 当前市场上卖方最低的报价（即最便宜的卖出价格）。如果你想立刻买入，就需要支付这个价格。
- askvol (Ask Volume) ： 卖一量。
    - 在 askprc 这个价格上等待卖出的合约数量（单位：手）。
- bidprc (Bid Price) ： 买一价。
    - 当前市场上买方最高的报价（即最贵的买入价格）。如果你想立刻卖出，就会得到这个价格。
- bidvol (Bid Volume) ： 买一量。
    - 在 bidprc 这个价格上等待买入的合约数量（单位：手）。

结合数据看市场情况（举例分析）：
我们以第一行和最后一行数据为例：
第一行（09:29:00.300）:
1. last: 7021.4
2. askprc: 7021.6, askvol: 1 (只有1手合约挂在7021.6的价格卖)
3. bidprc: 7021.4, bidvol: 3 (有3手合约挂在7021.4的价格买)
4. 此时买卖价差非常小（仅0.2点），市场流动性很好，交易非常活跃。

最后一行（09:30:43.500）:
1. last: 7033.0
2. askprc: 7033.0, askvol: 11 (有11手合约挂在7033.0的价格卖)
3. bidprc: 7030.0, bidvol: 8 (有8手合约挂在7030.0的价格买)
4. 此时的最新成交价 7033.0 正好等于卖一价 7033.0，说明刚刚发生了一笔交易，有人以卖方的价格主动买入成交了（这通常被视为上涨动力较强的信号）。此时的买卖价差较大（3.0点），可能意味着市场波动性在增大或在某个关键点位附近存在分歧。

整体趋势：
在短短1分43秒内：
1. 价格上升：最新价从 7021.4 上涨到 7033.0，上涨了约11.6点。
2. 交易活跃：成交量增加了598手，成交金额增加了约8.4亿元。
3. 持仓微降：持仓量缓慢减少，表明在这波上涨中，部分交易者选择了平仓离场而非开新仓。

这个 IM2509.csv 文件是一个高频时间序列数据文件，它精确地记录了2025年9月到期的中证1000股指期货（IM2509） 在某个特定分钟内的：
1. 每一笔成交（通过累计值体现）
2. 实时价格变化（最新价）
3. 市场深度的瞬时状态（买卖挂单的价格和数量）
4. 市场整体持仓情况（持仓量）

这种数据对于量化交易员、研究员分析市场流动性、交易成本、价格发现过程以及构建交易策略至关重要。

## IM2509内容中没有Ticker标识符所体现的C、P类型，行权价？
IM2509 是期货合约，而不是期权合约。​​ 这正是它没有“C/P类型”和“行权价”的原因。
​​IM2509​​ 代表的是 ​​**中证1000股指期货**​​ 合约，代码是 IM，交割月份是2025年9月。
​​HO2509-C-2000​​ 代表的是 ​​**热轧卷板期权**​​ 合约，它的标的物是 HO2509（热轧卷板期货）。
​​期货和期权是两种完全不同的金融衍生品​​，它们的合约代码结构也因此不同。

| 特性                | ​**​期货 (Futures)​**​                                                                  | ​**​期权 (Options)​**​                                                                                            |
| ----------------- | ------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------- |
| ​**​本质​**​        | 一份​**​未来的交易契约​**​。双方约定在未来某个时间以特定价格买入或卖出某项资产。                                          | 一种​**​权利​**​。买方有权利（但无义务）在到期前以特定价格买入或卖出某项资产。                                                                     |
| ​**​双方义务​**​      | 双方​**​都有​**​义务执行合约。必须到期交割（或平仓）。                                                       | ​**​买方有权利，卖方有义务​**​。买方可以决定行权或不行权；如果买方行权，卖方必须履约。                                                                 |
| ​**​代码结构​**​      | ​**​相对简单​**​。通常为：​**​品种代码 + 到期月份​**​。  <br>例如：`IM2509`(中证1000股指期货), `HO2509`(热轧卷板期货)。 | ​**​相对复杂​**​。因为它需要额外说明这份“权利”的类型和价格。结构为：​**​标的物代码 + 看涨/看跌 + 行权价​**​。  <br>例如：`HO2509-C-2000`(以HO2509期货为标的的看涨期权)。 |
| ​**​在您例子中的标识符​**​ | `IM2509`                                                                              | `HO2509-C-2000`                                                                                                 |
查看中国金融期货交易所（CFFEX）的官方产品列表可知：
1. `IM`开头的合约是​**​中证1000股指期货​**​。
    1. ​​期货​​的标识符像是一个简单的 ​​“名字+生日”​​ （如 IM2509），告诉你它是什么以及何时到期。
2. `MO`开头的合约是​**​中证1000股指期权​**​。期权代码会明确包含 `-C-`或 `-P-`以及行权价。
    1. ​​期权​​的标识符像是一个详细的 ​​“条款说明书”​​ （如 HO2509-C-2000），告诉你它基于什么标的物、是买入还是卖出的权利、以及执行价格是多少。
# 20250905.0.csv内容
有哪些 Ticker。不重复。

```csv
Ticker,ProductClass,DeliveryYear,DeliveryMonth,MaxMarketOrderVolume,MinMarketOrderVolume,MaxLimitOrderVolume,MinLimitOrderVolume,VolumeMultiple,PriceTick,CreateDate,OpenDate,ExpireDate,StartDelivDate,EndDelivDate,InstLifePhase,IsTrading,PositionDateType,LongMarginRatio,ShortMarginRatio,MaxMarginSideAlgorithm,ExchangeInstID,ProductID,StrikePrice,OptionType
AP2510.CZCE,1,2025,10,200,1,1000,1,10,1,20241022,20241022,20251022,,,1,1,2,0.1,0.1,0,AP510,AP,0,^@
AP2511.CZCE,1,2025,11,200,1,1000,1,10,1,20241115,20241115,20251114,,,1,1,2,0.1,0.1,0,AP511,AP,0,^@
AP2511C6300.CZCE,2,2025,9,2,1,100,1,10,0.5,20250611,20250611,20250926,20250926,20250926,1,1,2,nan,nan,0,AP511C6300,APC,6300,1
AP2511C6400.CZCE,2,2025,9,2,1,100,1,10,0.5,20250328,20250328,20250926,20250926,20250926,1,1,2,nan,nan,0,AP511C6400,APC,6400,1
...
AP2511C9100.CZCE,2,2025,9,2,1,100,1,10,0.5,20250820,20250820,20250926,20250926,20250926,1,1,2,nan,nan,0,AP511C9100,APC,9100,1
AP2511C9200.CZCE,2,2025,9,2,1,100,1,10,0.5,20250828,20250828,20250926,20250926,20250926,1,1,2,nan,nan,0,AP511C9200,APC,9200,1
AP2511C9300.CZCE,2,2025,9,2,1,100,1,10,0.5,20250829,20250829,20250926,20250926,20250926,1,1,2,nan,nan,0,AP511C9300,APC,9300,1
AP2511P6300.CZCE,2,2025,9,2,1,100,1,10,0.5,20250611,20250611,20250926,20250926,20250926,1,1,2,nan,nan,0,AP511P6300,APP,6300,2
AP2511P6400.CZCE,2,2025,9,2,1,100,1,10,0.5,20250328,20250328,20250926,20250926,20250926,1,1,2,nan,nan,0,AP511P6400,APP,6400,2
AP2511P6500.CZCE,2,2025,9,2,1,100,1,10,0.5,20250328,20250328,20250926,20250926,20250926,1,1,2,nan,nan,0,AP511P6500,APP,6500,2
...
AP2511P9200.CZCE,2,2025,9,2,1,100,1,10,0.5,20250828,20250828,20250926,20250926,20250926,1,1,2,nan,nan,0,AP511P9200,APP,9200,2
AP2511P9300.CZCE,2,2025,9,2,1,100,1,10,0.5,20250829,20250829,20250926,20250926,20250926,1,1,2,nan,nan,0,AP511P9300,APP,9300,2
AP2512.CZCE,1,2025,12,200,1,1000,1,10,1,20241216,20241216,20251212,,,1,1,2,0.1,0.1,0,AP512,AP,0, 
AP2512C6900.CZCE,2,2025,10,2,1,100,1,10,0.5,20250828,20250828,20251029,20251029,20251029,1,1,2,nan,nan,0,AP512C6900,APC,6900,1
AP2512C7000.CZCE,2,2025,10,2,1,100,1,10,0.5,20250828,20250828,20251029,20251029,20251029,1,1,2,nan,nan,0,AP512C7000,APC,7000,1
...
AP2512C9300.CZCE,2,2025,10,2,1,100,1,10,0.5,20250829,20250829,20251029,20251029,20251029,1,1,2,nan,nan,0,AP512C9300,APC,9300,1
AP2512C9400.CZCE,2,2025,10,2,1,100,1,10,0.5,20250901,20250901,20251029,20251029,20251029,1,1,2,nan,nan,0,AP512C9400,APC,9400,1
AP2512P6900.CZCE,2,2025,10,2,1,100,1,10,0.5,20250828,20250828,20251029,20251029,20251029,1,1,2,nan,nan,0,AP512P6900,APP,6900,2
AP2512P7000.CZCE,2,2025,10,2,1,100,1,10,0.5,20250828,20250828,20251029,20251029,20251029,1,1,2,nan,nan,0,AP512P7000,APP,7000,2
...
AP2512P9300.CZCE,2,2025,10,2,1,100,1,10,0.5,20250829,20250829,20251029,20251029,20251029,1,1,2,nan,nan,0,AP512P9300,APP,9300,2
AP2512P9400.CZCE,2,2025,10,2,1,100,1,10,0.5,20250901,20250901,20251029,20251029,20251029,1,1,2,nan,nan,0,AP512P9400,APP,9400,2
AP2601.CZCE,1,2026,1,200,1,1000,1,10,1,20250116,20250116,20260114,,,1,1,2,0.1,0.1,0,AP601,AP,0, 
AP2601C6400.CZCE,2,2025,11,2,1,100,1,10,0.5,20250526,20250526,20251126,20251126,20251126,1,1,2,nan,nan,0,AP601C6400,APC,6400,1
AP2601C6500.CZCE,2,2025,11,2,1,100,1,10,0.5,20250523,20250523,20251126,20251126,20251126,1,1,2,nan,nan,0,AP601C6500,APC,6500,1
...

```

它不是一个记录实时行情的数据文件，而是一个​​静态信息文件​​，通常被称为 ​​“合约信息表”​​ 或 ​​“Instrument Info”​​。

它回答了“​​在这个市场上（日期：2025年9月5日），有哪些合约可以交易？每个合约的‘游戏规则’是什么？​​”这个问题。

Ticker​​，在这个语境下，指的就是在交易所上市的、唯一的​​合约代码​​或​​合约标识符​​。它就是我们在交易软件上看到的那一串代码，例如 AP2510.CZCE。它​​唯一指定​​了一个金融衍生品合约。
通过Ticker，我们可以区分不同的​​品种​​（如AP苹果 vs. HO热卷）、​​到期月份​​（2510 vs. 2512）、​​类型​​（期货 vs. 看涨期权 vs. 看跌期权）以及​​行权价​​（6300 vs. 6400）。
这个文件就是​​所有可用Ticker（合约）的清单​​，以及每个Ticker的详细规格说明。

文件各列字段详解（以您提供的AP苹果合约为例）
这个表格定义了每个合约的“基本法”或“产品说明书”。我们逐列解析：
1. Ticker​​: 合约的唯一代码。例如 AP2510.CZCE
    1. AP: 品种代码（苹果）
    2. 2510: 到期年月（2025年10月）
    3. CZCE: 交易所后缀（郑州商品交易所）
2. AP2511C6300.CZCE: 这是一个期权代码，C代表看涨，6300代表行权价6300元/吨。
3. ProductClass​​: 产品类别。这是​​区分期货和期权的关键字段​​
    1. 1: 代表​​期货​​ (Futures)
    2. 2: 代表​​期权​​ (Options)
    3. （AP2510.CZCE是1，而AP2511C6300.CZCE是2）
4. DeliveryYear, DeliveryMonth​​: 交割年份和月份。对于期权来说，这通常指的是其标的期货的交割月份。
5. ​​MaxMarketOrderVolume, MinMarketOrderVolume​​: 市价单的最大/最小下单手数。
6. ​​MaxLimitOrderVolume, MinLimitOrderVolume​​: 限价单的最大/最小下单手数。
7. ​​VolumeMultiple​​: ​​合约乘数​​。这是非常关键的一个字段！
    1. 对于苹果(AP)，这里是 10。这意味着：​​1手苹果期货/期权合约，代表10吨苹果​​。行情数据中的价格每变动1元，1手合约的总价值就变动 1元/吨 * 10吨 = 10元。
8. ​​PriceTick​​: ​​最小变动价位​​。
    1. 对于苹果期货，是 1元/吨。报价必须是1的整数倍（如7000, 7001, 7002...）。
    2. 对于苹果期权，是 0.5元/吨。报价必须是0.5的整数倍（如100.5, 101.0, 101.5...）。
9. ​​CreateDate, OpenDate, ExpireDate​​: 合约的创建日期、首日上市日期和最后交易日/到期日。
10. ​​StartDelivDate, EndDelivDate​​: 交割周期的开始和结束日期（主要针对期货）。
11. ​​InstLifePhase​​: 合约生命周期状态（如是否可交易等）。
12. ​​IsTrading​​: 当前是否处于可交易状态。
13. ​​LongMarginRatio, ShortMarginRatio​​: 多头和空头的交易保证金比例。注意，​​期权合约的保证金字段为 nan（非数）​​，因为期权买方不需要缴纳保证金（只需支付权利金），而卖方保证金的计算方式更为复杂。
14. ​​ExchangeInstID​​: 交易所内部的合约代码，通常与Ticker类似。
15. ​​ProductID​​: 产品代码，指品种级别的代码。例如，所有苹果期权的ProductID都是 APC，所有苹果看跌期权的都是 APP。
16. ​​StrikePrice​​: ​​行权价​​。这是期权独有的字段。
    1. 对于期货，此值为 0。
    2. 对于期权，如 AP2511C6300.CZCE，此值为 6300。
17. ​​OptionType​​: ​​期权类型​​。这也是期权独有的字段。
    1. 1: 代表​​看涨期权​​ (Call)
    2. 2: 代表​​看跌期权​​ (Put)
    3. 对于期货，此字段为空（如显示为 ^@或 ，这是空字符的表示）。
# 需求
要的结果：pdiff、ndiff的绝对值 大于 一个阈值，并持续一段时间，报警。可以先用python写一个原型，最终程序最好用Cpp程序编写

这是一段可以参考的程序：
需要去futopt找到c、p，以及当时的strike，。

比如说：
```
futopt.csv。时间戳是重复的。strike不唯一。因此cbps、paps、caps、pbps、strike不唯一。
ets,              lts,             ticker,             cvol,camnt,oi,last,askprc,askvol,bidprc,bidvol
20250905092900300,1757035740427646,HO2509-C-2000.CFFEX,  0,     0,82, 886, 926.8,     1,   870,     1
20250905092900300,1757035740427755,HO2509-P-2000.CFFEX,  0,     0,502,0.4,   0.6,     6,   0.2,     1
```

```
假设这是 HO2509.csv。对应着相同ets的一行数据。时间戳是唯一的。因此fap和fbp唯一。
ets,              lts,             cvolume,    camount,oi,   last,             askprc,askvol,bidprc,bidvol
20250905092900300,1757035740327543,272,381964160,188932,     7021.400000000001,7021.6,     1,7021.4,     3
```

cbps 是 870，   paps  是 0.6。strikes 是 2000，fap 是 7021.6
caps 是 926.8，pbps 是 0.2。strikes 是 2000，fbp 是 7021.4

但是，futopt有好多条不同行权价的行数据，时间戳是一样的，怎么区别？

```cpp
        Array<double, Dynamic, 1> pdiff = (ecbps - epaps) + estrikes - fap_; //!< long fut, short opt (buy put sell call)
        Array<double, Dynamic, 1> ndiff = (ecaps - epbps) + estrikes - fbp_; //!< short fut, long opt (buy call sell put)

        // filter false-positive chance as option volumes too small to hedge even 1 hand of futures
        pdiff = (pdiff.isNaN() || ecbvs<ohands_ || epavs<ohands_ || estrikes<fap_).select(0, pdiff);
        ndiff = (ndiff.isNaN() || ecavs<ohands_ || epbvs<ohands_ || estrikes>fbp_).select(0, ndiff);

        LOG_INFO(gOutLogger, "pdiff: {}, ndiff: {}", pdiff.maxCoeff(), ndiff.minCoeff());

        ////TODO commission & order fee (1RMB per order)
        if (Index maxidx; flshr_<=0 && pdiff.maxCoeff(&maxidx) > thresh_)
        {
            LOG_WARNING(gOutLogger, "+F({}) -O({}: -C({}|{}) +P({}|{})) found! CrossSpread Profit({})!", fap_, strikes_[maxidx],
                        ecbps[maxidx], ecbvs[maxidx], epaps[maxidx], epavs[maxidx], pdiff[maxidx]);
            auto& order = orders_[(ordid_++) % kOrderNum];
            memset(&order, 0, sizeof(Order));
            PrepareOrder(order, epaps[maxidx], 1+ocalls_.size()+maxidx);//!< insert order for in-money put, and wait for filled
            const Event event = {Event::EventType::kOrderInsert, reinterpret_cast<std::byte*>(&order)};
            eventq_->TryPush(event);
        }

        if (Index minidx; fsshr_>=0 && ndiff.minCoeff(&minidx) < -thresh_)
        {////TODO might sign of fsshr
            LOG_WARNING(gOutLogger, "-F({}) +O({}: +C({}|{}) -P({}|{})) found! CrossSpread Profit({})!", fbp_, strikes_[minidx],
                        ecaps[minidx], ecavs[minidx], epbps[minidx], epbvs[minidx], ndiff[minidx]);
            auto& order = orders_[(ordid_++) % kOrderNum];
            memset(&order, 0, sizeof(Order));
            PrepareOrder(order, epaps[minidx], 1+minidx);//!< insert order for in-money call, and wait for filled
            const Event event = {Event::EventType::kOrderInsert, reinterpret_cast<std::byte*>(&order)};
            eventq_->TryPush(event);
        }
```

ecbps: 看涨期权的买报价：所有看涨期权合约的买报价组成的数组。
1. e代表类似于SIMD的加速技术（Eigen 库的向量化操作）
2. c代表ticker里面的中缀，`MO2509-[C/P]-XXXX`中间的C。call，代表涨期权
3. b代表bidprice，bidprc
4. p代表price
5. s代表复数

epaps: 看跌期权的卖报价：所有看跌期权合约的卖报价组成的数组。
1. e
2. p代表ticker里面的中缀，`MO2509-[C/P]-XXXX`中间的P。put，代表跌期权
3. a代表askprice，askprc
4. p代表price
5. s代表复数

ecaps: 看涨期权的卖报价
1. e
2. c: call
3. a: ask
4. p: price
5. s: 代表复数

epbps: 看跌期权的买报价
1. e
2. p: put
3. b: bid
4. p: price
5. s: 代表复数

estrikes: 所有期权合约的行权价组成的数组。
strike代表ticker后缀

fap: future ask price，fap 应该是 期货的买入价格（ask price），即期货的 askprc（askprc）。
fbp: future bid price，fbp 应该是 期货的卖出价格（bid price），即期货的 bidprc（bidprc）。

ecbvs: **E​**​igen数组，​**​C​**​all期权，​**​B​**​id ​**​V​**​olume (量)，对应`ecbps`价格上的买入量。

ohands: 期权手数阈值，用于过滤小成交量（避免无法对冲）

thresh: 套利阈值，由策略参数设定（例如，10 表示 10 个最小变动单位）

有2种情况：
1. 同一个时间戳，两个同时出现，直接相减
2. 同一个时间戳，一个出现，用出现的这个 和 未出现的上一个时间数据相减

​​pdiff策略 (Long Fut, Short Opt)​​: `(ecbps - epaps) + estrikes - fap_`
​​动作​​：卖出一个Call期权（收到权利金ecbps），买入一个Put期权（支付权利金epaps），同时买入期货（支付`fap_`）。
​​逻辑​​：如果这个组合的成本`(epaps - ecbps) + fap_`远低于行权价`estrikes`，就存在无风险套利空间。所以公式计算结果`pdiff`越大越好。
​​ndiff策略 (Short Fut, Long Opt)​​: `(ecaps - epbps) + estrikes - fbp_`
​​动作​​：买入一个Call期权（支付权利金ecaps），卖出一个Put期权（收到权利金epbps），同时卖出期货（收到`fbp_`）。
​​逻辑​​：如果这个组合的收入`(epbps - ecaps) + fbp_`远高于行权价`estrikes`，就存在无风险套利空间。所以公式计算结果`ndiff`越小（负得越多）越好。


一共发了3个文件：（截取部分）
1. futopt.csv.xz，内容是不同Ticker的报价信息，因为这些Ticker的条数比较稀疏，所以就写在了一个文件里。
2. IM2509.csv.xz，内容是只有IM2509这个Ticker的报价信息。
3. 20250905.0.csv，内容是有哪些Ticker。

```
20250905092900300,1757035740432075,MO2509-C-4000.CFFEX,0,0,126,2957,3118.2,1,2890.4,1
20250905092900300,1757035740432077,MO2509-C-4100.CFFEX,0,0,42,3072,3018,1,2790.2,1
20250905092900300,1757035740432078,MO2509-C-4200.CFFEX,0,0,43,2990.8,2918.2,1,2690.4,1
20250905092900300,1757035740432079,MO2509-C-4300.CFFEX,0,0,43,2843.6,2818.4,1,2590.6,1
20250905092900300,1757035740432079,MO2509-C-4400.CFFEX,0,0,83,2795.8,2718.8,1,2491,1
20250905092900300,1757035740432082,MO2509-C-4500.CFFEX,0,0,122,2644.6,2619.2,1,2391.4,1
20250905092900300,1757035740432084,MO2509-C-4600.CFFEX,0,0,91,2597.6,2519,1,2291,1
20250905092900300,1757035740432093,MO2509-C-4700.CFFEX,0,0,78,2266,2419.2,1,2191.4,1
20250905092900300,1757035740432094,MO2509-C-4800.CFFEX,0,0,123,2123.6,2319.6,1,2091.8,1
20250905092900300,1757035740432096,MO2509-C-4900.CFFEX,0,0,110,2023,2211.8,1,2000,1
20250905092900300,1757035740432099,MO2509-C-5000.CFFEX,0,0,129,1970,2062.8,1,1949,1
20250905092900300,1757035740432104,MO2509-C-5200.CFFEX,0,0,152,1723.4,1863.4,1,1749.6,1
20250905092900300,1757035740432107,MO2509-C-5300.CFFEX,0,0,74,1700.4,1763.4,1,1649.4,1
20250905092900300,1757035740432110,MO2509-C-5400.CFFEX,0,0,161,1595.2,1663.8,1,1550,1
20250905092900300,1757035740432115,MO2509-C-5500.CFFEX,0,0,76,1501.2,1564,1,1450.2,1
20250905092900300,1757035740432118,MO2509-C-5600.CFFEX,0,0,448,1395.6,1464,1,1350.2,1
20250905092900300,1757035740432122,MO2509-C-5700.CFFEX,0,0,57,1298.8,1365,1,1251,1
20250905092900300,1757035740432126,MO2509-C-5800.CFFEX,0,0,674,1164.4,1265.2,1,1151.4,1
20250905092900300,1757035740432145,MO2509-C-5900.CFFEX,0,0,124,1109,1166.4,1,1052.4,1
20250905092900300,1757035740432146,MO2509-C-6000.CFFEX,0,0,1513,1000.4,1038,1,981.2,1
20250905092900300,1757035740432153,MO2509-C-6100.CFFEX,0,0,242,907.4,940,1,883,1
20250905092900300,1757035740432154,MO2509-C-6200.CFFEX,0,0,1678,808.8,841,1,784.2,1
20250905092900300,1757035740432156,MO2509-C-6300.CFFEX,0,0,286,711.8,744.4,1,687.6,1
20250905092900300,1757035740432159,MO2509-C-6400.CFFEX,0,0,1399,611.2,647.8,1,591,1
20250905092900300,1757035740432166,MO2509-C-6500.CFFEX,0,0,628,522,556.4,1,500,1
20250905092900300,1757035740432167,MO2509-C-6600.CFFEX,0,0,1480,443.2,453.6,1,449,1
20250905092900300,1757035740432171,MO2509-C-6700.CFFEX,0,0,1072,355,370,1,345,3
20250905092900300,1757035740432177,MO2509-C-6800.CFFEX,0,0,2150,280,295,2,282,1
20250905092900300,1757035740432181,MO2509-C-6900.CFFEX,0,0,2209,214.8,230.4,1,228,1
20250905092900300,1757035740432185,MO2509-C-7000.CFFEX,12,204000,4553,170,173.6,1,170,1
20250905092900300,1757035740432196,MO2509-C-7100.CFFEX,14,182000,5423,130,132.6,4,130,40
20250905092900300,1757035740432200,MO2509-C-7200.CFFEX,29,275500,8795,95,95,9,93,1
20250905092900300,1757035740432201,MO2509-C-7300.CFFEX,3,19560,8112,65.2,66,2,65,1
20250905092900300,1757035740432202,MO2509-C-7400.CFFEX,11,49500,11908,45,46,5,45,12
20250905092900300,1757035740432209,MO2509-C-7500.CFFEX,2,7000,12943,35,36,2,34.4,1
20250905092900300,1757035740432210,MO2509-C-7600.CFFEX,10,20400.000000000004,7217,20.400000000000002,20.4,1,20.2,1
20250905092900300,1757035740432213,MO2509-C-7700.CFFEX,1,1500,7165,15,15.4,1,15,2
20250905092900300,1757035740432219,MO2509-C-7800.CFFEX,0,0,7152,10.6,11.8,10,11,3
20250905092900300,1757035740432228,MO2509-C-7900.CFFEX,0,0,5489,7.8,29,1,8,3
20250905092900300,1757035740432229,MO2509-C-8000.CFFEX,2,1360.0000000000002,6761,6.800000000000001,8,3,6.4,1
20250905092900300,1757035740432234,MO2509-C-8100.CFFEX,0,0,5498,4.4,5,1,4,5
20250905092900300,1757035740432235,MO2509-C-8200.CFFEX,0,0,2186,3.4,4.2,1,0.8,20
20250905092900300,1757035740432238,MO2509-C-8300.CFFEX,1,380,6225,3.8000000000000003,3.8,1,3.2,4
20250905092900300,1757035740432243,MO2509-P-4000.CFFEX,0,0,3586,0.6,1,3,0.2,1
20250905092900300,1757035740432248,MO2509-P-4100.CFFEX,0,0,610,0.8,29,1,0.6,3
20250905092900300,1757035740432252,MO2509-P-4200.CFFEX,0,0,722,0.8,29,1,0.6,6
20250905092900300,1757035740432253,MO2509-P-4300.CFFEX,0,0,294,0.8,16,1,0.6,1
20250905092900300,1757035740432254,MO2509-P-4400.CFFEX,0,0,321,0.8,29,1,0.2,1
20250905092900300,1757035740432264,MO2509-P-4500.CFFEX,0,0,416,0.8,29,1,0.2,1
20250905092900300,1757035740432265,MO2509-P-4600.CFFEX,0,0,227,0.8,29,1,0.2,1
20250905092900300,1757035740432270,MO2509-P-4700.CFFEX,0,0,291,0.8,29,1,0.2,1
20250905092900300,1757035740432275,MO2509-P-4800.CFFEX,0,0,472,1,29,1,0.2,1
20250905092900300,1757035740432279,MO2509-P-4900.CFFEX,0,0,753,1.4,29,1,1,8
20250905092900300,1757035740432287,MO2509-P-5000.CFFEX,0,0,1534,1.4,1.6,20,0.6,40
20250905092900300,1757035740432291,MO2509-P-5200.CFFEX,0,0,1600,1.6,29,1,0.6,32
20250905092900300,1757035740432295,MO2509-P-5300.CFFEX,0,0,579,1.6,29,1,0.2,1
20250905092900300,1757035740432305,MO2509-P-5400.CFFEX,0,0,1555,1.6,29,1,0.2,1
20250905092900300,1757035740432312,MO2509-P-5500.CFFEX,0,0,889,2,29,1,1.8,1
20250905092900300,1757035740432318,MO2509-P-5600.CFFEX,0,0,1626,2.2,2,10,1.6,7
20250905092900300,1757035740432322,MO2509-P-5700.CFFEX,0,0,916,2.4,2.4,15,2,40
20250905092900300,1757035740432325,MO2509-P-5800.CFFEX,0,0,2060,2.6,29,1,2,95
20250905092900300,1757035740432329,MO2509-P-5900.CFFEX,0,0,1118,3.2,29,1,2,100
20250905092900300,1757035740432334,MO2509-P-6000.CFFEX,0,0,3682,3.8,4,6,2.4,1
20250905092900300,1757035740432337,MO2509-P-6100.CFFEX,0,0,3567,5.6,6.6,6,3.2,1
20250905092900300,1757035740432342,MO2509-P-6200.CFFEX,0,0,2788,7.2,8.8,4,2.8,3
20250905092900300,1757035740432346,MO2509-P-6300.CFFEX,0,0,2989,10,12,2,6.4,1
20250905092900300,1757035740432385,MO2509-P-6400.CFFEX,0,0,4878,15,13.8,5,12.4,1
20250905092900300,1757035740432387,MO2509-P-6500.CFFEX,1,2200,6906,22,22.4,3,22,1
20250905092900300,1757035740432390,MO2509-P-6600.CFFEX,0,0,6048,32.6,32,6,30,1
20250905092900300,1757035740432391,MO2509-P-6700.CFFEX,0,0,4479,51.2,51,2,48,7
20250905092900300,1757035740432392,MO2509-P-6800.CFFEX,1,7280,6096,72.8,73,1,70,1
20250905092900300,1757035740432393,MO2509-P-6900.CFFEX,2,20040,5519,100.2,100.2,64,100,1
20250905092900300,1757035740432394,MO2509-P-7000.CFFEX,1,14000,6528,140,140,1,139.8,1
20250905092900300,1757035740432395,MO2509-P-7100.CFFEX,2,40560,5246,202.8,203,1,196.6,1
20250905092900300,1757035740432396,MO2509-P-7200.CFFEX,1,26300,5531,263,280,1,251.2,1
20250905092900300,1757035740432397,MO2509-P-7300.CFFEX,0,0,3793,357.4,368.8,1,339.8,1
20250905092900300,1757035740432398,MO2509-P-7400.CFFEX,0,0,3636,440,438,1,422.8,1
20250905092900300,1757035740432399,MO2509-P-7500.CFFEX,0,0,2760,533.4,548.4,1,500,1
20250905092900300,1757035740432405,MO2509-P-7600.CFFEX,0,0,1181,615.6,642,1,585.2,1
20250905092900300,1757035740432406,MO2509-P-7700.CFFEX,0,0,959,715,735.8,1,679,1
20250905092900300,1757035740432416,MO2509-P-7800.CFFEX,0,0,353,810.2,831.4,1,774.6,1
20250905092900300,1757035740432425,MO2509-P-7900.CFFEX,0,0,145,981.6,929,1,872.2,1
20250905092900300,1757035740432432,MO2509-P-8000.CFFEX,0,0,150,998.2,1026.4,1,969.6,1
20250905092900300,1757035740432433,MO2509-P-8100.CFFEX,0,0,72,1112.4,1153,1,1039.2,1
20250905092900300,1757035740432434,MO2509-P-8200.CFFEX,0,0,50,1221.8,1252.2,1,1138.4,1
20250905092900300,1757035740432438,MO2509-P-8300.CFFEX,0,0,65,1311.6,1351.4,1,1237.6,1
```

```
ets,                           lts,             ticker,cvol,camnt,  oi, last,              askprc,askvol,bidprc,bidvol
20250905092900300,1757035740432238,MO2509-C-8300.CFFEX,1,     380,6225, 3.8000000000000003,  3.8,      1,   3.2,     4
20250905092900300,1757035740432438,MO2509-P-8300.CFFEX,0,       0,  65, 1311.6,           1351.4,      1,1237.6,     1
```

```
ets,lts,                            cvol, camnt,    oi,      last,           askprc,askvol,bidprc, bidvol
20250905092900300,1757035740327543,  272, 381964160,188932,7021.400000000001,7021.6,     1,7021.4,     3
```

cbps 是 3.2，   paps  是 1351.4。strikes 是 8300，fap 是 7021.6
caps 是 3.8，   pbps  是 1237.6。strikes 是 8300，fbp 是 7021.4
3.2 - 1351.4 + 8300 - 7021.6 = -69.8
3.8 - 1237.6 + 8300 - 7021.4 =  44.8
# 解决方案
在 futopt.csv 中，Ticker 和 Timestamp 都有可能是重复的，因此我们需要找到一个合适的方式来唯一地标识每一行数据。在这种情况下，可以通过组合 Ticker 和 Timestamp 作为唯一的键（key）来构建映射。

方案：

复合键（Ticker + Timestamp）：

通过将 Ticker 和 Timestamp 结合起来，作为映射的键（key），确保每一行数据都是唯一的。

这样，tickerMap 可以使用 std::unordered_map<std::pair<std::string, long long>, DataRow> 这样的结构，其中 std::pair<std::string, long long> 表示 Ticker 和 Timestamp 的组合。

std::unordered_map<std::pair<std::string, long long>, DataRow>：

std::pair<std::string, long long> 是键类型，表示 Ticker 和 Timestamp 组合，DataRow 是值类型。